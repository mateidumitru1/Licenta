import{$ as ri,$a as YF,$b as De,A as fv,Aa as bf,Ab as KF,Ac as iL,B as xc,Ba as Vo,Bb as $i,Bc as li,C as gv,Ca as ht,Cb as Zh,Cc as OS,D as Po,Da as oe,Db as Xh,Dc as Bl,E as IF,Ea as _u,Eb as Kh,Ec as Dv,F as io,Fa as Gh,Fb as A,Fc as Zo,G as wn,Ga as vu,Gb as k,Gc as Ii,H as MS,Ha as BF,Hb as dt,Hc as qe,I as zl,Ia as qh,Ib as rr,Ic as nL,J as fu,Ja as Cc,Jb as or,Jc as rL,K as _v,Ka as qn,Kb as ks,Kc as hd,L as DS,La as zr,Lb as Ce,Lc as Lo,M as Ji,Ma as rl,Mb as Rs,Mc as oL,N as AF,Na as uo,Nb as wv,Nc as sL,O as ff,Oa as yu,Ob as ct,Oc as FS,P as gf,Pa as Wh,Pb as Cv,Pc as Tv,Q as nl,Qa as $h,Qb as vt,Qc as Yr,R as Nl,Ra as VF,Rb as Nn,Rc as Bn,S as TS,Sa as jF,Sb as Ti,Sc as Ei,T as kF,Ta as UF,Tb as hs,Tc as Wn,U as RF,Ua as HF,Ub as Qh,Uc as md,V as PF,Va as GF,Vb as mn,Vc as Sn,W as OF,Wa as qF,Wb as Ge,Wc as Iv,X as IS,Xa as WF,Xb as ce,Xc as Av,Y as vv,Ya as Zs,Yb as de,Z as co,Za as $F,Zb as Ir,_ as no,_a as Tr,_b as V,a as Gt,aa as FF,ab as bv,ac as ae,b as Ri,ba as $r,bb as ol,bc as Fo,bd as aL,c as CS,ca as dr,cb as xf,cc as QF,cd as Sf,d as A$,da as ye,db as N,dc as In,dd as kv,e as MF,ea as AS,eb as B,ec as An,f as It,fa as _f,fb as bu,fc as kn,g as nr,ga as Rt,gb as Eo,gc as Ni,h as DF,ha as Et,hb as xv,hc as At,i as ga,ia as xi,ib as wf,ic as Nr,id as lL,j as SS,ja as re,jb as Yh,jc as Xi,jd as Rv,k as pf,ka as yv,kb as Oo,kc as Jh,l as pe,la as te,lb as xu,lc as Ps,ld as cL,m as Ze,ma as ee,mb as Wi,mc as al,n as Ys,na as As,nb as ze,nc as kS,o as pv,oa as gu,ob as Mo,oc as Sv,p as yc,pa as Se,pb as Si,pc as Ev,q as Ro,qa as vf,qb as Tn,qc as Mv,qd as dL,r as Fe,ra as LF,rb as ZF,rc as RS,s as Ll,sa as kt,sb as XF,sc as wu,t as Hh,ta as wi,tb as Cf,tc as PS,u as TF,ua as zF,ub as mt,uc as JF,v as Ve,va as we,vb as oi,vc as tL,w as Fi,wa as yf,wb as Z,wc as Qe,x as bc,xa as NF,xb as Sc,xc as ll,y as Is,ya as wc,yb as ei,yc as tm,z as ES,za as So,zb as sl,zc as eL}from"./chunk-LTZCFDWS.js";var cT=A$((aT,lT)=>{"use strict";(function(a,r){typeof aT=="object"&&typeof lT<"u"?lT.exports=r():typeof define=="function"&&define.amd?define(r):(a=typeof globalThis<"u"?globalThis:a||self,a.mapboxgl=r())})(aT,function(){"use strict";var a,r,l;function n(d,m){if(!a)a=m;else if(!r)r=m;else{var _="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+a+")(sharedChunk); ("+r+")(sharedChunk); self.onerror = null;",w={};a(w),l=m(w),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(l.workerUrl=window.URL.createObjectURL(new Blob([_],{type:"text/javascript"})))}}n(["exports"],function(d){"use strict";var m=typeof self<"u"?self:{},_="3.1.2";let w,S={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(w==null){let e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{w=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):e}catch{w=e}}return w},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!S.API_URL)return null;try{let e=new URL(S.API_URL);return e.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":e.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},T={supported:!1,testSupport:function(e){!q&&H&&(X?it(e):L=e)}},L,H,q=!1,X=!1;function it(e){let t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,H),e.isContextLost())return;T.supported=!0}catch{}e.deleteTexture(t),q=!0}m.document&&(H=m.document.createElement("img"),H.onload=function(){L&&it(L),L=null,X=!0},H.onerror=function(){q=!0,L=null},H.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let at="01";function ut(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Mt=Lt;function Lt(e,t,i,o){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(o-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=i,this.p2y=o}Lt.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(t===void 0&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var i=e,o=0;o<8;o++){var c=this.sampleCurveX(i)-e;if(Math.abs(c)<t)return i;var u=this.sampleCurveDerivativeX(i);if(Math.abs(u)<1e-6)break;i-=c/u}var h=0,p=1;for(i=e,o=0;o<20&&(c=this.sampleCurveX(i),!(Math.abs(c-e)<t));o++)e>c?h=i:p=i,i=.5*(p-h)+h;return i},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var Pt=ut(Mt),Nt=ue;function ue(e,t){this.x=e,this.y=t}ue.prototype={clone:function(){return new ue(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,i=e.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),i=Math.sin(e),o=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=o,this},_rotateAround:function(e,t){var i=Math.cos(e),o=Math.sin(e),c=t.y+o*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-o*(this.y-t.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ue.convert=function(e){return e instanceof ue?e:Array.isArray(e)?new ue(e[0],e[1]):e};var Q=ut(Nt);function $t(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!$t(e[i],t[i]))return!1;return!0}if(typeof e=="object"&&e!==null&&t!==null){if(typeof t!="object"||Object.keys(e).length!==Object.keys(t).length)return!1;for(let i in e)if(!$t(e[i],t[i]))return!1;return!0}return e===t}let Be=Math.PI/180,Ai=180/Math.PI;function fe(e){return e*Be}function ii(e){return e*Ai}let Pi=[[0,0],[1,0],[1,1],[0,1]];function Cr(e){if(e<=0)return 0;if(e>=1)return 1;let t=e*e,i=t*e;return 4*(e<.5?i:3*(e-t)+i-.75)}function ki(e){let t=1/0,i=1/0,o=-1/0,c=-1/0;for(let u of e)t=Math.min(t,u.x),i=Math.min(i,u.y),o=Math.max(o,u.x),c=Math.max(c,u.y);return{min:new Q(t,i),max:new Q(o,c)}}function jn(e,t,i=0,o=!0){let c=new Q(i,i),u=e.sub(c),h=t.add(c),p=[u,new Q(h.x,u.y),h,new Q(u.x,h.y)];return o&&p.push(u.clone()),p}function fn(e,t,i,o){let c=new Pt(e,t,i,o);return function(u){return c.solve(u)}}let fr=fn(.25,.1,.25,1);function ve(e,t,i){return Math.min(i,Math.max(t,e))}function Go(e,t,i){return(i=ve((i-e)/(t-e),0,1))*i*(3-2*i)}function os(e,t,i){let o=i-t,c=((e-t)%o+o)%o+t;return c===t?i:c}function fs(e,t,i){if(!e.length)return i(null,[]);let o=e.length,c=new Array(e.length),u=null;e.forEach((h,p)=>{t(h,(f,g)=>{f&&(u=f),c[p]=g,--o==0&&i(u,c)})})}function Us(e){let t=[];for(let i in e)t.push(e[i]);return t}function ge(e,...t){for(let i of t)for(let o in i)e[o]=i[o];return e}function Ho(e,t){let i={};for(let o=0;o<t.length;o++){let c=t[o];c in e&&(i[c]=e[c])}return i}let Ud=1;function Wu(){return Ud++}function Kg(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function Qg(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Jg(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function _o(e,t){e.forEach(i=>{t[i]&&(t[i]=t[i].bind(t))})}function $u(e,t){return e.indexOf(t,e.length-t.length)!==-1}function Yu(e,t,i){let o={};for(let c in e)o[c]=t.call(i||this,e[c],c,e);return o}function Yt(e,t,i){let o={};for(let c in e)t.call(i||this,e[c],c,e)&&(o[c]=e[c]);return o}function K(e){return Array.isArray(e)?e.map(K):typeof e=="object"&&e?Yu(e,K):e}let et={};function lt(e){et[e]||(typeof console<"u"&&console.warn(e),et[e]=!0)}function zt(e,t,i){return(i.y-e.y)*(t.x-e.x)>(t.y-e.y)*(i.x-e.x)}function Vt(e){let t=0;for(let i,o,c=0,u=e.length,h=u-1;c<u;h=c++)i=e[c],o=e[h],t+=(o.x-i.x)*(i.y+o.y);return t}function _e([e,t,i]){let o=fe(t+90),c=fe(i);return{x:e*Math.cos(o)*Math.sin(c),y:e*Math.sin(o)*Math.sin(c),z:e*Math.cos(c),azimuthal:t,polar:i}}function Ae(e,t,i){let o=Math.sqrt(e*e+t*t+i*i),c=o>0?Math.acos(i/o)*Ai:0,u=e!==0||t!==0?Math.atan2(-t,-e)*Ai+90:0;return u<0&&(u+=360),[o,u,c]}function jt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Pe(e){let t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,o,c,u)=>{let h=c||u;return t[o]=!h||h.toLowerCase(),""}),t["max-age"]){let i=parseInt(t["max-age"],10);isNaN(i)?delete t["max-age"]:t["max-age"]=i}return t}let We=null;function Ke(){return!!m.document.fullscreenElement||!!m.document.webkitFullscreenElement}function Dn(e){try{let t=m[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function gr(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function Io(e,t,i){e[4*t+0]=i[0],e[4*t+1]=i[1],e[4*t+2]=i[2],e[4*t+3]=i[3]}function _r(e,t){return[Math.pow(e[0],2.2)*t,Math.pow(e[1],2.2)*t,Math.pow(e[2],2.2)*t]}function Or(e){return[Math.pow(e[0],1/2.2),Math.pow(e[1],1/2.2),Math.pow(e[2],1/2.2)]}let Un="mapbox-tiles",qo=500,ss=50,as,Wa;function Zu(){try{return m.caches}catch{}}function gs(){Zu()&&!as&&(as=m.caches.open(Un))}function Jl(e){let t=e.indexOf("?");if(t<0)return e;let i=function(c){let u=c.indexOf("?");return u>0?c.slice(u+1).split("&"):[]}(e),o=i.filter(c=>{let u=c.split("=");return u[0]==="language"||u[0]==="worldview"});return o.length?`${e.slice(0,t)}?${o.join("&")}`:e.slice(0,t)}let zc=1/0;function Xu(e){zc++,zc>ss&&(e.getActor().send("enforceCacheSizeLimit",qo),zc=0)}let Dt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Dt);class Ot extends Error{constructor(t,i,o){i===401&&vr(o)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=i,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let Ht=jt()?()=>self.worker&&self.worker.referrer:()=>(m.location.protocol==="blob:"?m.parent:m).location.href,Zt=function(e,t){if(!(/^file:/.test(i=e.url)||/^file:/.test(Ht())&&!/^\w+:/.test(i))){if(m.fetch&&m.Request&&m.AbortController&&m.Request.prototype.hasOwnProperty("signal"))return function(o,c){let u=new m.AbortController,h=new m.Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:Ht(),referrerPolicy:o.referrerPolicy,signal:u.signal}),p=!1,f=!1,g=(v=h.url).indexOf("sku=")>0&&vr(v);var v;o.type==="json"&&h.headers.set("Accept","application/json");let y=(x,C,E)=>{if(f)return;if(x&&x.message!=="SecurityError"&&lt(x.toString()),C&&E)return b(C);let M=Date.now();m.fetch(h).then(D=>{if(D.ok){let I=g?D.clone():null;return b(D,I,M)}return c(new Ot(D.statusText,D.status,o.url))}).catch(D=>{D.name!=="AbortError"&&c(new Error(`${D.message} ${o.url}`))})},b=(x,C,E)=>{(o.type==="arrayBuffer"?x.arrayBuffer():o.type==="json"?x.json():x.text()).then(M=>{f||(C&&E&&function(D,I,P){if(gs(),!as)return;let O={status:I.status,statusText:I.statusText,headers:new m.Headers};I.headers.forEach((z,j)=>O.headers.set(j,z));let R=Pe(I.headers.get("Cache-Control")||"");if(R["no-store"])return;R["max-age"]&&O.headers.set("Expires",new Date(P+1e3*R["max-age"]).toUTCString());let F=O.headers.get("Expires");F&&(new Date(F).getTime()-P<42e4||function(z,j){if(Wa===void 0)try{new Response(new ReadableStream),Wa=!0}catch{Wa=!1}Wa?j(z.body):z.blob().then(j)}(I,z=>{let j=new m.Response(z,O);gs(),as&&as.then(U=>U.put(Jl(D.url),j)).catch(U=>lt(U.message))}))}(h,C,E),p=!0,c(null,M,x.headers.get("Cache-Control"),x.headers.get("Expires")))}).catch(M=>{f||c(new Error(M.message))})};return g?function(x,C){if(gs(),!as)return C(null);let E=Jl(x.url);as.then(M=>{M.match(E).then(D=>{let I=function(P){if(!P)return!1;let O=new Date(P.headers.get("Expires")||0),R=Pe(P.headers.get("Cache-Control")||"");return O>Date.now()&&!R["no-cache"]}(D);M.delete(E),I&&M.put(E,D.clone()),C(null,D,I)}).catch(C)}).catch(C)}(h,y):y(null,null),{cancel:()=>{f=!0,p||u.abort()}}}(e,t);if(jt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var i;return function(o,c){let u=new m.XMLHttpRequest;u.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(let h in o.headers)u.setRequestHeader(h,o.headers[h]);return o.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=o.credentials==="include",u.onerror=()=>{c(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let h=u.response;if(o.type==="json")try{h=JSON.parse(u.response)}catch(p){return c(p)}c(null,h,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else c(new Ot(u.statusText,u.status,o.url))},u.send(o.body),{cancel:()=>u.abort()}}(e,t)},Xt=function(e,t){return Zt(ge(e,{type:"json"}),t)},ie=function(e,t){return Zt(ge(e,{type:"arrayBuffer"}),t)};function se(e){let t=m.document.createElement("a");return t.href=e,t.protocol===m.document.location.protocol&&t.host===m.document.location.host}let Kt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Ee,ne;Ee=[],ne=0;let mi=function(e,t){if(T.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),ne>=S.MAX_PARALLEL_IMAGE_REQUESTS){let u={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Ee.push(u),u}ne++;let i=!1,o=()=>{if(!i)for(i=!0,ne--;Ee.length&&ne<S.MAX_PARALLEL_IMAGE_REQUESTS;){let u=Ee.shift(),{requestParameters:h,callback:p,cancelled:f}=u;f||(u.cancel=mi(h,p).cancel)}},c=ie(e,(u,h,p,f)=>{o(),u?t(u):h&&(m.createImageBitmap?function(g,v){let y=new m.Blob([new Uint8Array(g)],{type:"image/png"});m.createImageBitmap(y).then(b=>{v(null,b)}).catch(b=>{v(new Error(`Could not load image because of ${b.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(h,(g,v)=>t(g,v,p,f)):function(g,v){let y=new m.Image,b=m.URL;y.onload=()=>{v(null,y),b.revokeObjectURL(y.src),y.onload=null,m.requestAnimationFrame(()=>{y.src=Kt})},y.onerror=()=>v(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let x=new m.Blob([new Uint8Array(g)],{type:"image/png"});y.src=g.byteLength?b.createObjectURL(x):Kt}(h,(g,v)=>t(g,v,p,f)))});return{cancel:()=>{c.cancel(),o()}}},gn="NO_ACCESS_TOKEN";class Oe{constructor(t,i,o){this._transformRequestFn=t,this._customAccessToken=i,this._silenceAuthErrors=!!o,this._createSkuToken()}_createSkuToken(){let t=function(){let i="";for(let o=0;o<10;o++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",at,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,i){return this._transformRequestFn&&this._transformRequestFn(t,i)||{url:t}}normalizeStyleURL(t,i){if(!ln(t))return t;let o=vo(t);return o.params.push(`sdk=js-${_}`),o.path=`/styles/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||i)}normalizeGlyphsURL(t,i){if(!ln(t))return t;let o=vo(t);return o.path=`/fonts/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||i)}normalizeModelURL(t,i){if(!ln(t))return t;let o=vo(t);return o.path=`/models/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||i)}normalizeSourceURL(t,i,o,c){if(!ln(t))return t;let u=vo(t);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),o&&u.params.push(`language=${o}`),c&&u.params.push(`worldview=${c}`),this._makeAPIURL(u,this._customAccessToken||i)}normalizeSpriteURL(t,i,o,c){let u=vo(t);return ln(t)?(u.path=`/styles/v1${u.path}/sprite${i}${o}`,this._makeAPIURL(u,this._customAccessToken||c)):(u.path+=`${i}${o}`,ls(u))}normalizeTileURL(t,i,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!ln(t))return t;let c=vo(t);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||o&&c.authority!=="raster"&&o===512?"@2x":""}${T.supported?".webp":"$1"}`),c.authority==="raster"?c.path=`/${S.RASTER_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${S.TILE_URL_VERSION}${c.path}`);let u=this._customAccessToken||function(h){for(let p of h){let f=p.match(/^access_token=(.*)$/);if(f)return f[1]}return null}(c.params)||S.ACCESS_TOKEN;return S.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,u)}canonicalizeTileURL(t,i){let o=vo(t);if(!o.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!o.path.match(/\.[\w]+$/))return t;let c="mapbox://";o.path.match(/^\/raster\/v1\//)?c+=`raster/${o.path.replace(`/${S.RASTER_URL_PREFIX}/`,"")}`:c+=`tiles/${o.path.replace(`/${S.TILE_URL_VERSION}/`,"")}`;let u=o.params;return i&&(u=u.filter(h=>!h.match(/^access_token=/))),u.length&&(c+=`?${u.join("&")}`),c}canonicalizeTileset(t,i){let o=!!i&&ln(i),c=[];for(let u of t.tiles||[])vr(u)?c.push(this.canonicalizeTileURL(u,o)):c.push(u);return c}_makeAPIURL(t,i){let o="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",c=vo(S.API_URL);if(t.protocol=c.protocol,t.authority=c.authority,t.protocol==="http"){let u=t.params.indexOf("secure");u>=0&&t.params.splice(u,1)}if(c.path!=="/"&&(t.path=`${c.path}${t.path}`),!S.REQUIRE_ACCESS_TOKEN)return ls(t);if(i=i||S.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${o}`);if(i[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${o}`)}return t.params=t.params.filter(u=>u.indexOf("access_token")===-1),t.params.push(`access_token=${i||""}`),ls(t)}}function ln(e){return e.indexOf("mapbox:")===0}function vr(e){return S.API_URL_REGEX.test(e)}function Fr(e){return S.API_CDN_URL_REGEX.test(e)}function Qr(e){return S.API_STYLE_REGEX.test(e)&&!Wo(e)}function Wo(e){return S.API_SPRITE_REGEX.test(e)}let oa=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function vo(e){let t=e.match(oa);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function ls(e){let t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}let $o="mapbox.eventData";function Ku(e){if(!e)return null;let t=e.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(m.atob(t[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Nc{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){let i=Ku(S.ACCESS_TOKEN),o="";return o=i&&i.u?m.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(c,u)=>String.fromCharCode(+("0x"+u)))):S.ACCESS_TOKEN||"",t?`${$o}.${t}:${o}`:`${$o}:${o}`}fetchEventData(){let t=Dn("localStorage"),i=this.getStorageKey(),o=this.getStorageKey("uuid");if(t)try{let c=m.localStorage.getItem(i);c&&(this.eventData=JSON.parse(c));let u=m.localStorage.getItem(o);u&&(this.anonId=u)}catch{lt("Unable to read from LocalStorage")}}saveEventData(){let t=Dn("localStorage"),i=this.getStorageKey(),o=this.getStorageKey("uuid");if(t)try{m.localStorage.setItem(o,this.anonId),Object.keys(this.eventData).length>=1&&m.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{lt("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,i,o,c){if(!S.EVENTS_URL)return;let u=vo(S.EVENTS_URL);u.params.push(`access_token=${c||S.ACCESS_TOKEN||""}`);let h={event:this.type,created:new Date(t).toISOString()},p=i?ge(h,i):h,f={url:ls(u),headers:{"Content-Type":"text/plain"},body:JSON.stringify([p])};this.pendingRequest=function(g,v){return Zt(ge(g,{method:"POST"}),v)}(f,g=>{this.pendingRequest=null,o(g),this.saveEventData(),this.processRequests(c)})}queueRequest(t,i){this.queue.push(t),this.processRequests(i)}}let Qu=new class extends Nc{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){S.EVENTS_URL&&S.ACCESS_TOKEN&&Array.isArray(e)&&e.some(i=>ln(i)||vr(i))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let t=Ku(S.ACCESS_TOKEN),i=t?t.u:S.ACCESS_TOKEN,o=i!==this.eventData.tokenU;Jg(this.anonId)||(this.anonId=Kg(),o=!0);let c=this.queue.shift();if(this.eventData.lastSuccess){let u=new Date(this.eventData.lastSuccess),h=new Date(c),p=(c-this.eventData.lastSuccess)/864e5;o=o||p>=1||p<-1||u.getDate()!==h.getDate()}else o=!0;o?this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:_,skuId:at,"enabled.telemetry":!1,userId:this.anonId},u=>{u||(this.eventData.lastSuccess=c,this.eventData.tokenU=i)},e):this.processRequests()}},Nx=Qu.postTurnstileEvent.bind(Qu),ET=new class extends Nc{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,i,o){this.skuToken=t,this.errorCb=o,S.EVENTS_URL&&(i||S.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(gn)))}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;let{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),Jg(this.anonId)||(this.anonId=Kg()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:_,skuId:at,skuToken:this.skuToken,userId:this.anonId},o=>{o?this.errorCb(o):t&&(this.success[t]=!0)},e))}},hj=ET.postMapLoadEvent.bind(ET),MT=new class extends Nc{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){S.EVENTS_URL&&(e||S.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:t,performanceData:i}=this.queue.shift(),o=function(c){let u=m.performance.getEntriesByType("resource"),h=m.performance.getEntriesByType("mark"),p=function(b){let x={};if(b){for(let C in b)if(C!=="other")for(let E of b[C]){let M=`${C}ResolveRangeMin`,D=`${C}ResolveRangeMax`,I=`${C}RequestCount`,P=`${C}RequestCachedCount`;x[M]=Math.min(x[M]||1/0,E.startTime),x[D]=Math.max(x[D]||-1/0,E.responseEnd);let O=R=>{x[R]===void 0&&(x[R]=0),++x[R]};E.transferSize!==void 0&&E.transferSize===0&&O(P),O(I)}}return x}(function(b,x){let C={};if(b)for(let E of b){let M=x(E);C[M]===void 0&&(C[M]=[]),C[M].push(E)}return C}(u,fj)),f=m.devicePixelRatio,g=m.navigator.connection||m.navigator.mozConnection||m.navigator.webkitConnection,v={counters:[],metadata:[],attributes:[]},y=(b,x,C)=>{C!=null&&b.push({name:x,value:C.toString()})};for(let b in p)y(v.counters,b,p[b]);if(c.interactionRange[0]!==1/0&&c.interactionRange[1]!==-1/0&&(y(v.counters,"interactionRangeMin",c.interactionRange[0]),y(v.counters,"interactionRangeMax",c.interactionRange[1])),h)for(let b of Object.keys(e_)){let x=e_[b],C=h.find(E=>E.name===x);C&&y(v.counters,x,C.startTime)}return y(v.counters,"visibilityHidden",c.visibilityHidden),y(v.attributes,"style",function(b){if(b)for(let x of b){let C=x.name.split("?")[0];if(Qr(C)){let E=C.split("/").slice(-2);if(E.length===2)return`mapbox://styles/${E[0]}/${E[1]}`}}}(u)),y(v.attributes,"terrainEnabled",c.terrainEnabled?"true":"false"),y(v.attributes,"fogEnabled",c.fogEnabled?"true":"false"),y(v.attributes,"projection",c.projection),y(v.attributes,"zoom",c.zoom),y(v.metadata,"devicePixelRatio",f),y(v.metadata,"connectionEffectiveType",g?g.effectiveType:void 0),y(v.metadata,"navigatorUserAgent",m.navigator.userAgent),y(v.metadata,"screenWidth",m.screen.width),y(v.metadata,"screenHeight",m.screen.height),y(v.metadata,"windowWidth",m.innerWidth),y(v.metadata,"windowHeight",m.innerHeight),y(v.metadata,"mapWidth",c.width/f),y(v.metadata,"mapHeight",c.height/f),y(v.metadata,"webglRenderer",c.renderer),y(v.metadata,"webglVendor",c.vendor),y(v.metadata,"sdkVersion",_),y(v.metadata,"sdkIdentifier","mapbox-gl-js"),v}(i);for(let c of o.metadata);for(let c of o.counters);for(let c of o.attributes);this.postEvent(t,o,()=>{},e)}},mj=MT.postPerformanceEvent.bind(MT),DT=new class extends Nc{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,i,o){if(!S.API_URL||!S.SESSION_PATH)return;let c=vo(S.API_URL+S.SESSION_PATH);c.params.push(`sku=${t||""}`),c.params.push(`access_token=${o||S.ACCESS_TOKEN||""}`);let u={url:ls(c),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(h,p){return Zt(ge(h,{method:"GET"}),p)}(u,h=>{this.pendingRequest=null,i(h),this.saveEventData(),this.processRequests(o)})}getSessionAPI(e,t,i,o){this.skuToken=t,this.errorCb=o,S.SESSION_PATH&&S.API_URL&&(i||S.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(gn)))}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;let{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||this.getSession(i,this.skuToken,o=>{o?this.errorCb(o):t&&(this.success[t]=!0)},e)}},pj=DT.getSessionAPI.bind(DT),t_=new Set;function TT(e,t){t?t_.add(e):t_.delete(e)}let e_={create:"create",load:"load",fullLoad:"fullLoad"},IT={mark(e){m.performance.mark(e)},measure(e,t,i){m.performance.measure(e,t,i)}};function fj(e){let t=e.name.split("?")[0];return Fr(t)&&t.includes("mapbox-gl.js")?"javascript":Fr(t)&&t.includes("mapbox-gl.css")?"css":function(i){return S.API_FONTS_REGEX.test(i)}(t)?"fontRange":Wo(t)?"sprite":Qr(t)?"style":function(i){return S.API_TILEJSON_REGEX.test(i)}(t)?"tilejson":"other"}let gj=m.performance;function AT(e){let t=e?e.url.toString():void 0;return gj.getEntriesByName(t)}var kT=Bx;function Bx(e){return!function(t){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var o,c,u=new Blob([""],{type:"text/javascript"}),h=URL.createObjectURL(u);try{c=new Worker(h),o=!0}catch{o=!1}return c&&c.terminate(),URL.revokeObjectURL(h),o}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var o=document.createElement("canvas");o.width=o.height=1;var c=o.getContext("2d");if(!c)return!1;var u=c.getImageData(0,0,1,1);return u&&u.width===o.width}()?(Vx[i=t&&t.failIfMajorPerformanceCaveat]===void 0&&(Vx[i]=function(o){var c,u=function(h){var p=document.createElement("canvas"),f=Object.create(Bx.webGLContextAttributes);return f.failIfMajorPerformanceCaveat=h,p.getContext("webgl",f)||p.getContext("experimental-webgl",f)}(o);if(!u)return!1;try{c=u.createShader(u.VERTEX_SHADER)}catch{return!1}return!(!c||u.isContextLost())&&(u.shaderSource(c,"void main() {}"),u.compileShader(c),u.getShaderParameter(c,u.COMPILE_STATUS)===!0)}(i)),Vx[i]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var i}(e)}var Vx={};let jx,i_,Ux,n_,Hd;function RT(){return jx==null&&(jx=m.OffscreenCanvas&&new m.OffscreenCanvas(1,1).getContext("2d")&&typeof m.createImageBitmap=="function"),jx}Bx.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let ni={now:()=>n_!==void 0?n_:m.performance.now(),setNow(e){n_=e},restoreNow(){n_=void 0},frame(e){let t=m.requestAnimationFrame(e);return{cancel:()=>m.cancelAnimationFrame(t)}},getImageData(e,t=0){let{width:i,height:o}=e;Hd||(Hd=m.document.createElement("canvas"));let c=Hd.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(i>Hd.width||o>Hd.height)&&(Hd.width=i,Hd.height=o),c.clearRect(-t,-t,i+2*t,o+2*t),c.drawImage(e,0,0,i,o),c.getImageData(-t,-t,i+2*t,o+2*t)},resolveURL:e=>(i_||(i_=m.document.createElement("a")),i_.href=e,i_.href),get devicePixelRatio(){return m.devicePixelRatio},get prefersReducedMotion(){return!!m.matchMedia&&(Ux==null&&(Ux=m.matchMedia("(prefers-reduced-motion: reduce)")),Ux.matches)},hasCanvasFingerprintNoise(){if(!RT())return!1;let e=new m.OffscreenCanvas(85,1),t=e.getContext("2d",{willReadFrequently:!0}),i=0;for(let c=0;c<e.width;++c)t.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,t.fillRect(c,0,1,1);let o=t.getImageData(0,0,e.width,e.height);i=0;for(let c=0;c<o.data.length;++c)if(c%4!=3&&i++!==o.data[c])return!0;return!1}};function Cn(e,t,i){let o=m.document.createElement(e);return t!==void 0&&(o.className=t),i&&i.appendChild(o),o}function tc(e,t,i){let o=m.document.createElementNS("http://www.w3.org/2000/svg",e);for(let c of Object.keys(t))o.setAttributeNS(null,c,t[c]);return i&&i.appendChild(o),o}let Gd=m.document&&m.document.documentElement.style,op=Gd&&Gd.userSelect!==void 0?"userSelect":"WebkitUserSelect",PT;function OT(){Gd&&op&&(PT=Gd[op],Gd[op]="none")}function FT(){Gd&&op&&(Gd[op]=PT)}function Hx(e){e.preventDefault(),e.stopPropagation(),m.removeEventListener("click",Hx,!0)}function Gx(){m.addEventListener("click",Hx,!0),m.setTimeout(()=>{m.removeEventListener("click",Hx,!0)},0)}function sp(e,t){let i=e.getBoundingClientRect();return zT(e,i,t)}function r_(e,t){let i=e.getBoundingClientRect(),o=[];for(let c=0;c<t.length;c++)o.push(zT(e,i,t[c]));return o}function LT(e){return m.InstallTrigger!==void 0&&e.button===2&&e.ctrlKey&&m.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button}function zT(e,t,i){let o=e.offsetWidth===t.width?1:e.offsetWidth/t.width;return new Q((i.clientX-t.left)*o,(i.clientY-t.top)*o)}function NT(e,t,i){i[e]&&i[e].indexOf(t)!==-1||(i[e]=i[e]||[],i[e].push(t))}function qx(e,t,i){if(i&&i[e]){let o=i[e].indexOf(t);o!==-1&&i[e].splice(o,1)}}class qt{constructor(t,i={}){ge(this,i),this.type=t}}class Xe extends qt{constructor(t,i={}){super("error",ge({error:t},i))}}class Hr{on(t,i){return this._listeners=this._listeners||{},NT(t,i,this._listeners),this}off(t,i){return qx(t,i,this._listeners),qx(t,i,this._oneTimeListeners),this}once(t,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},NT(t,i,this._oneTimeListeners),this):new Promise(o=>this.once(t,o))}fire(t,i){typeof t=="string"&&(t=new qt(t,i||{}));let o=t.type;if(this.listens(o)){t.target=this;let c=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(let p of c)p.call(this,t);let u=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(let p of u)qx(o,p,this._oneTimeListeners),p.call(this,t);let h=this._eventedParent;h&&(ge(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),h.fire(t))}else t instanceof Xe&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,i){return this._eventedParent=t,this._eventedParentData=i,this}}var gt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class be{constructor(t,i,o,c){this.message=(t?`${t}: `:"")+o,c&&(this.identifier=c),i!=null&&i.__line__&&(this.line=i.__line__)}}class qd extends be{}function ec(e,...t){for(let i of t)for(let o in i)e[o]=i[o];return e}function Jr(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function ic(e){if(Array.isArray(e))return e.map(ic);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){let t={};for(let i in e)t[i]=ic(e[i]);return t}return Jr(e)}class _j extends Error{constructor(t,i){super(i),this.message=i,this.key=t}}var xl=_j;class Wx{constructor(t,i=[]){this.parent=t,this.bindings={};for(let[o,c]of i)this.bindings[o]=c}concat(t){return new Wx(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var vj=Wx;let Ju={kind:"null"},he={kind:"number"},Ui={kind:"string"},Ki={kind:"boolean"},sa={kind:"color"},th={kind:"object"},qi={kind:"value"},o_={kind:"collator"},ap={kind:"formatted"},lp={kind:"resolvedImage"};function _s(e,t){return{kind:"array",itemType:e,N:t}}function Gr(e){if(e.kind==="array"){let t=Gr(e.itemType);return typeof e.N=="number"?`array<${t}, ${e.N}>`:e.itemType.kind==="value"?"array":`array<${t}>`}return e.kind}let yj=[Ju,he,Ui,Ki,sa,ap,th,_s(qi),lp];function cp(e,t){if(t.kind==="error")return null;if(e.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!cp(e.itemType,t.itemType))&&(typeof e.N!="number"||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind==="value"){for(let i of yj)if(!cp(i,t))return null}}return`Expected ${Gr(e)} but found ${Gr(t)} instead.`}function $x(e,t){return t.some(i=>i.kind===e.kind)}function dp(e,t){return t.some(i=>i==="null"?e===null:i==="array"?Array.isArray(e):i==="object"?e&&!Array.isArray(e)&&typeof e=="object":i===typeof e)}var Yx,BT={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function s_(e){return(e=Math.round(e))<0?0:e>255?255:e}function Zx(e){return s_(e[e.length-1]==="%"?parseFloat(e)/100*255:parseInt(e))}function a_(e){return(t=e[e.length-1]==="%"?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function Xx(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{Yx={}.parseCSSColor=function(e){var t,i=e.replace(/ /g,"").toLowerCase();if(i in BT)return BT[i].slice();if(i[0]==="#")return i.length===4?(t=parseInt(i.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:i.length===7&&(t=parseInt(i.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var o=i.indexOf("("),c=i.indexOf(")");if(o!==-1&&c+1===i.length){var u=i.substr(0,o),h=i.substr(o+1,c-(o+1)).split(","),p=1;switch(u){case"rgba":if(h.length!==4)return null;p=a_(h.pop());case"rgb":return h.length!==3?null:[Zx(h[0]),Zx(h[1]),Zx(h[2]),p];case"hsla":if(h.length!==4)return null;p=a_(h.pop());case"hsl":if(h.length!==3)return null;var f=(parseFloat(h[0])%360+360)%360/360,g=a_(h[1]),v=a_(h[2]),y=v<=.5?v*(g+1):v+g-v*g,b=2*v-y;return[s_(255*Xx(b,y,f+1/3)),s_(255*Xx(b,y,f)),s_(255*Xx(b,y,f-1/3)),p];default:return null}}return null}}catch{}class vs{constructor(t,i,o,c=1){this.r=t,this.g=i,this.b=o,this.a=c}static parse(t){if(!t)return;if(t instanceof vs)return t;if(typeof t!="string")return;let i=Yx(t);return i?new vs(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){let[t,i,o,c]=this.toArray();return`rgba(${Math.round(t)},${Math.round(i)},${Math.round(o)},${c})`}toArray(){let{r:t,g:i,b:o,a:c}=this;return c===0?[0,0,0,0]:[255*t/c,255*i/c,255*o/c,c]}toArray01(){let{r:t,g:i,b:o,a:c}=this;return c===0?[0,0,0,0]:[t/c,i/c,o/c,c]}toArray01Scaled(t){let{r:i,g:o,b:c,a:u}=this;return u===0?[0,0,0]:[i/u*t,o/u*t,c/u*t]}toArray01PremultipliedAlpha(){let{r:t,g:i,b:o,a:c}=this;return[t,i,o,c]}toArray01Linear(){let{r:t,g:i,b:o,a:c}=this;return c===0?[0,0,0,0]:[Math.pow(t/c,2.2),Math.pow(i/c,2.2),Math.pow(o/c,2.2),c]}}vs.black=new vs(0,0,0,1),vs.white=new vs(1,1,1,1),vs.transparent=new vs(0,0,0,0),vs.red=new vs(1,0,0,1),vs.blue=new vs(0,0,1,1);var fi=vs;class Kx{constructor(t,i,o){this.sensitivity=t?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,i){return this.collator.compare(t,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Qx{constructor(t,i,o,c,u){this.text=t.normalize?t.normalize():t,this.image=i,this.scale=o,this.fontStack=c,this.textColor=u}}class ys{constructor(t){this.sections=t}static fromString(t){return new ys([new Qx(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.namePrimary.length!==0)}static factory(t){return t instanceof ys?t:ys.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){let t=["format"];for(let i of this.sections){if(i.image){t.push(["image",i.image.namePrimary]);continue}t.push(i.text);let o={};i.fontStack&&(o["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(o["font-scale"]=i.scale),i.textColor&&(o["text-color"]=["rgba"].concat(i.textColor.toArray())),t.push(o)}return t}}class aa{constructor(t){this.namePrimary=t.namePrimary,t.nameSecondary&&(this.nameSecondary=t.nameSecondary),this.available=t.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(t,i){return t?new aa({namePrimary:t,nameSecondary:i,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function VT(e,t,i,o){return typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[e,t,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[e,t,i,o]:[e,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function eh(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof fi||e instanceof Kx||e instanceof ys||e instanceof aa)return!0;if(Array.isArray(e)){for(let t of e)if(!eh(t))return!1;return!0}if(typeof e=="object"){for(let t in e)if(!eh(e[t]))return!1;return!0}return!1}function yo(e){if(e===null)return Ju;if(typeof e=="string")return Ui;if(typeof e=="boolean")return Ki;if(typeof e=="number")return he;if(e instanceof fi)return sa;if(e instanceof Kx)return o_;if(e instanceof ys)return ap;if(e instanceof aa)return lp;if(Array.isArray(e)){let t=e.length,i;for(let o of e){let c=yo(o);if(i){if(i===c)continue;i=qi;break}i=c}return _s(i||qi,t)}return th}function up(e){let t=typeof e;return e===null?"":t==="string"||t==="number"||t==="boolean"?String(e):e instanceof fi||e instanceof ys||e instanceof aa?e.toString():JSON.stringify(e)}class Jx{constructor(t,i){this.type=t,this.value=i}static parse(t,i){if(t.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!eh(t[1]))return i.error("invalid value");let o=t[1],c=yo(o),u=i.expectedType;return c.kind!=="array"||c.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(c=u),new Jx(c,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof fi?["rgba"].concat(this.value.toArray()):this.value instanceof ys?this.value.serialize():this.value}}var hp=Jx,Ao=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};let t1={string:Ui,number:he,boolean:Ki,object:th};class e1{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let o,c=1,u=t[0];if(u==="array"){let p,f;if(t.length>2){let g=t[1];if(typeof g!="string"||!(g in t1)||g==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);p=t1[g],c++}else p=qi;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return i.error('The length argument to "array" must be a positive integer literal',2);f=t[2],c++}o=_s(p,f)}else o=t1[u];let h=[];for(;c<t.length;c++){let p=i.parse(t[c],c,qi);if(!p)return null;h.push(p)}return new e1(o,h)}evaluate(t){for(let i=0;i<this.args.length;i++){let o=this.args[i].evaluate(t);if(!cp(this.type,yo(o)))return o;if(i===this.args.length-1)throw new Ao(`Expected value to be of type ${Gr(this.type)}, but found ${Gr(yo(o))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){let t=this.type,i=[t.kind];if(t.kind==="array"){let o=t.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){i.push(o.kind);let c=t.N;(typeof c=="number"||this.args.length>1)&&i.push(c)}}return i.concat(this.args.map(o=>o.serialize()))}}var nc=e1;class mp{constructor(t){this.type=ap,this.sections=t}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let o=t[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");let c=[],u=!1;for(let h=1;h<=t.length-1;++h){let p=t[h];if(u&&typeof p=="object"&&!Array.isArray(p)){u=!1;let f=null;if(p["font-scale"]&&(f=i.parse(p["font-scale"],1,he),!f))return null;let g=null;if(p["text-font"]&&(g=i.parse(p["text-font"],1,_s(Ui)),!g))return null;let v=null;if(p["text-color"]&&(v=i.parse(p["text-color"],1,sa),!v))return null;let y=c[c.length-1];y.scale=f,y.font=g,y.textColor=v}else{let f=i.parse(t[h],1,qi);if(!f)return null;let g=f.type.kind;if(g!=="string"&&g!=="value"&&g!=="null"&&g!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,c.push({content:f,scale:null,font:null,textColor:null})}}return new mp(c)}evaluate(t){return new ys(this.sections.map(i=>{let o=i.content.evaluate(t);return yo(o)===lp?new Qx("",o,null,null,null):new Qx(up(o),null,i.scale?i.scale.evaluate(t):null,i.font?i.font.evaluate(t).join(","):null,i.textColor?i.textColor.evaluate(t):null)}))}eachChild(t){for(let i of this.sections)t(i.content),i.scale&&t(i.scale),i.font&&t(i.font),i.textColor&&t(i.textColor)}outputDefined(){return!1}serialize(){let t=["format"];for(let i of this.sections){t.push(i.content.serialize());let o={};i.scale&&(o["font-scale"]=i.scale.serialize()),i.font&&(o["text-font"]=i.font.serialize()),i.textColor&&(o["text-color"]=i.textColor.serialize()),t.push(o)}return t}}class pp{constructor(t,i){this.type=lp,this.inputPrimary=t,this.inputSecondary=i}static parse(t,i){if(t.length<2)return i.error("Expected two or more arguments.");let o=i.parse(t[1],1,Ui);if(!o)return i.error("No image name provided.");if(t.length===2)return new pp(o);let c=i.parse(t[2],1,Ui);return c?new pp(o,c):i.error("Secondary image variant is not a string.")}evaluate(t){let i=aa.fromString(this.inputPrimary.evaluate(t),this.inputSecondary?this.inputSecondary.evaluate(t):void 0);return i&&t.availableImages&&(i.available=t.availableImages.indexOf(i.namePrimary)>-1,i.nameSecondary&&i.available&&t.availableImages&&(i.available=t.availableImages.indexOf(i.nameSecondary)>-1)),i}eachChild(t){t(this.inputPrimary),this.inputSecondary&&t(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function cn(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}let bj={"to-boolean":Ki,"to-color":sa,"to-number":he,"to-string":Ui};class i1{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let o=t[0],c=[],u=Ju;if(o==="to-array"){if(!Array.isArray(t[1]))return null;let h=t[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);u=_s(i.expectedType.itemType,h)}else{if(!(h>0&&eh(t[1][0])))return null;u=_s(yo(t[1][0]),h)}for(let p=0;p<h;p++){let f=t[1][p],g;if(cn(f)==="array")g=i.parse(f,void 0,u.itemType);else{let v=cn(f);if(v!==u.itemType.kind)return i.error(`Expected ${u.itemType.kind} but found ${v}.`);g=i.registry.literal.parse(["literal",f===void 0?null:f],i)}if(!g)return null;c.push(g)}}else{if((o==="to-boolean"||o==="to-string")&&t.length!==2)return i.error("Expected one argument.");u=bj[o];for(let h=1;h<t.length;h++){let p=i.parse(t[h],h,qi);if(!p)return null;c.push(p)}}return new i1(u,c)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let i,o;for(let c of this.args){if(i=c.evaluate(t),o=null,i instanceof fi)return i;if(typeof i=="string"){let u=t.parseColor(i);if(u)return u}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:VT(i[0],i[1],i[2],i[3]),!o))return new fi(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Ao(o||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(let o of this.args){if(i=o.evaluate(t),i===null)return 0;let c=Number(i);if(!isNaN(c))return c}throw new Ao(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?ys.fromString(up(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?aa.fromString(up(this.args[0].evaluate(t))):this.type.kind==="array"?this.args.map(i=>i.evaluate(t)):up(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new mp([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new pp(this.args[0]).serialize();let t=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{t.push(i.serialize())}),t}}var Wd=i1;let xj=["Unknown","Point","LineString","Polygon"];var jT=class{constructor(e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.options=e}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?xj[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:i,y:o}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*t-e[0])+this.featureDistanceData.bearing[1]*(o*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=fi.parse(e)),t}getConfig(e){return this.options?this.options.get(e):null}};class $d{constructor(t,i,o,c,u){this.name=t,this.type=i,this._evaluate=o,this.args=c,this._overloadIndex=u}evaluate(t){if(!this._evaluate){let i=$d.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,i){let o=t[0],c=$d.definitions[o];if(!c)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);let u=Array.isArray(c)?c[0]:c.type,h=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,p=[],f=null,g=-1;for(let[v,y]of h){if(Array.isArray(v)&&v.length!==t.length-1)continue;p.push(v),g++,f=new rI(i.registry,i.path,null,i.scope,void 0,i.options);let b=[],x=!1;for(let C=1;C<t.length;C++){let E=t[C],M=Array.isArray(v)?v[C-1]:v.type,D=f.parse(E,1+b.length,M);if(!D){x=!0;break}b.push(D)}if(!x)if(Array.isArray(v)&&v.length!==b.length)f.error(`Expected ${v.length} arguments, but found ${b.length} instead.`);else{for(let C=0;C<b.length;C++){let E=Array.isArray(v)?v[C]:v.type,M=b[C];f.concat(C+1).checkSubtype(E,M.type)}if(f.errors.length===0)return new $d(o,u,y,b,g)}}if(p.length===1)i.errors.push(...f.errors);else{let v=(p.length?p:h.map(([b])=>b)).map(wj).join(" | "),y=[];for(let b=1;b<t.length;b++){let x=i.parse(t[b],1+y.length);if(!x)return null;y.push(Gr(x.type))}i.error(`Expected arguments of type ${v}, but found (${y.join(", ")}) instead.`)}return null}static register(t,i){$d.definitions=i;for(let o in i)t[o]=$d}}function wj(e){return Array.isArray(e)?`(${e.map(Gr).join(", ")})`:`(${Gr(e.type)}...)`}var wl=$d;class l_{constructor(t,i,o){this.type=o_,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=i}static parse(t,i){if(t.length!==2)return i.error("Expected one argument.");let o=t[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");let c=i.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Ki);if(!c)return null;let u=i.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Ki);if(!u)return null;let h=null;return o.locale&&(h=i.parse(o.locale,1,Ui),!h)?null:new l_(c,u,h)}evaluate(t){return new Kx(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){let t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}var UT={exports:{}};UT.exports=function(){function e(o,c,u,h,p){for(;h>u;){if(h-u>600){var f=h-u+1,g=c-u+1,v=Math.log(f),y=.5*Math.exp(2*v/3),b=.5*Math.sqrt(v*y*(f-y)/f)*(g-f/2<0?-1:1);e(o,c,Math.max(u,Math.floor(c-g*y/f+b)),Math.min(h,Math.floor(c+(f-g)*y/f+b)),p)}var x=o[c],C=u,E=h;for(t(o,u,c),p(o[h],x)>0&&t(o,u,h);C<E;){for(t(o,C,E),C++,E--;p(o[C],x)<0;)C++;for(;p(o[E],x)>0;)E--}p(o[u],x)===0?t(o,u,E):t(o,++E,h),E<=c&&(u=E+1),c<=E&&(h=E-1)}}function t(o,c,u){var h=o[c];o[c]=o[u],o[u]=h}function i(o,c){return o<c?-1:o>c?1:0}return function(o,c,u,h,p){e(o,c,u||0,h||o.length-1,p||i)}}();var Cj=ut(UT.exports);function Sj(e){let t=0;for(let i,o,c=0,u=e.length,h=u-1;c<u;h=c++)i=e[c],o=e[h],t+=(o.x-i.x)*(i.y+o.y);return t}function fp(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function gp(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Ej(e,t,i){let o=e[0]-t[0],c=e[1]-t[1],u=e[0]-i[0],h=e[1]-i[1];return o*h-u*c==0&&o*u<=0&&c*h<=0}function ih(e,t,i=!1){let o=!1;for(let p=0,f=t.length;p<f;p++){let g=t[p];for(let v=0,y=g.length,b=y-1;v<y;b=v++){let x=g[b],C=g[v];if(Ej(e,x,C))return i;(u=x)[1]>(c=e)[1]!=(h=C)[1]>c[1]&&c[0]<(h[0]-u[0])*(c[1]-u[1])/(h[1]-u[1])+u[0]&&(o=!o)}}var c,u,h;return o}function HT(e,t,i,o){let c=o[0]-i[0],u=o[1]-i[1],h=(e[0]-i[0])*u-c*(e[1]-i[1]),p=(t[0]-i[0])*u-c*(t[1]-i[1]);return h>0&&p<0||h<0&&p>0}function c_(e,t,i,o){return(c=[o[0]-i[0],o[1]-i[1]])[0]*(u=[t[0]-e[0],t[1]-e[1]])[1]-c[1]*u[0]!=0&&!(!HT(e,t,i,o)||!HT(i,o,e,t));var c,u}let Bc=8192;function Mj(e,t){let i=(180+e[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,c=Math.pow(2,t.z);return[Math.round(i*c*Bc),Math.round(o*c*Bc)]}function Dj(e,t){for(let i=0;i<t.length;i++)if(ih(e,t[i]))return!0;return!1}function Tj(e,t,i){for(let o of i)for(let c=0,u=o.length,h=u-1;c<u;h=c++)if(c_(e,t,o[h],o[c]))return!0;return!1}function GT(e,t){for(let i=0;i<e.length;++i)if(!ih(e[i],t))return!1;for(let i=0;i<e.length-1;++i)if(Tj(e[i],e[i+1],t))return!1;return!0}function Ij(e,t){for(let i=0;i<t.length;i++)if(GT(e,t[i]))return!0;return!1}function n1(e,t,i){let o=[];for(let c=0;c<e.length;c++){let u=[];for(let h=0;h<e[c].length;h++){let p=Mj(e[c][h],i);fp(t,p),u.push(p)}o.push(u)}return o}function qT(e,t,i){let o=[];for(let c=0;c<e.length;c++){let u=n1(e[c],t,i);o.push(u)}return o}function WT(e,t,i,o){if(e[0]<i[0]||e[0]>i[2]){let c=.5*o,u=e[0]-i[0]>c?-o:i[0]-e[0]>c?o:0;u===0&&(u=e[0]-i[2]>c?-o:i[2]-e[0]>c?o:0),e[0]+=u}fp(t,e)}function $T(e,t,i,o){let c=Math.pow(2,o.z)*Bc,u=[o.x*Bc,o.y*Bc],h=[];if(!e)return h;for(let p of e)for(let f of p){let g=[f.x+u[0],f.y+u[1]];WT(g,t,i,c),h.push(g)}return h}function YT(e,t,i,o){let c=Math.pow(2,o.z)*Bc,u=[o.x*Bc,o.y*Bc],h=[];if(!e)return h;for(let f of e){let g=[];for(let v of f){let y=[v.x+u[0],v.y+u[1]];fp(t,y),g.push(y)}h.push(g)}if(t[2]-t[0]<=c/2){(p=t)[0]=p[1]=1/0,p[2]=p[3]=-1/0;for(let f of h)for(let g of f)WT(g,t,i,c)}var p;return h}class _p{constructor(t,i){this.type=Ki,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(eh(t[1])){let o=t[1];if(o.type==="FeatureCollection")for(let c=0;c<o.features.length;++c){let u=o.features[c].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new _p(o,o.features[c].geometry)}else if(o.type==="Feature"){let c=o.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new _p(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new _p(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(i,o){let c=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],h=i.canonicalID();if(!h)return!1;if(o.type==="Polygon"){let p=n1(o.coordinates,u,h),f=$T(i.geometry(),c,u,h);if(!gp(c,u))return!1;for(let g of f)if(!ih(g,p))return!1}if(o.type==="MultiPolygon"){let p=qT(o.coordinates,u,h),f=$T(i.geometry(),c,u,h);if(!gp(c,u))return!1;for(let g of f)if(!Dj(g,p))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(i,o){let c=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],h=i.canonicalID();if(!h)return!1;if(o.type==="Polygon"){let p=n1(o.coordinates,u,h),f=YT(i.geometry(),c,u,h);if(!gp(c,u))return!1;for(let g of f)if(!GT(g,p))return!1}if(o.type==="MultiPolygon"){let p=qT(o.coordinates,u,h),f=YT(i.geometry(),c,u,h);if(!gp(c,u))return!1;for(let g of f)if(!Ij(g,p))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var r1=_p,ZT={exports:{}};ZT.exports=function(){var e={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},t=1/298.257223563,i=t*(2-t),o=Math.PI/180,c=function(g,v){if(g===void 0)throw new Error("No latitude given.");if(v&&!e[v])throw new Error("Unknown unit "+v+". Use one of: "+Object.keys(e).join(", "));var y=6378.137*o*(v?e[v]:1),b=Math.cos(g*o),x=1/(1-i*(1-b*b)),C=Math.sqrt(x);this.kx=y*C*b,this.ky=y*C*x*(1-i)},u={units:{configurable:!0}};function h(g,v){return g[0]===v[0]&&g[1]===v[1]}function p(g,v,y){var b=f(v[0]-g[0]);return[g[0]+b*y,g[1]+(v[1]-g[1])*y]}function f(g){for(;g<-180;)g+=360;for(;g>180;)g-=360;return g}return c.fromTile=function(g,v,y){var b=Math.PI*(1-2*(g+.5)/Math.pow(2,v)),x=Math.atan(.5*(Math.exp(b)-Math.exp(-b)))/o;return new c(x,y)},u.units.get=function(){return e},c.prototype.distance=function(g,v){var y=f(g[0]-v[0])*this.kx,b=(g[1]-v[1])*this.ky;return Math.sqrt(y*y+b*b)},c.prototype.bearing=function(g,v){var y=f(v[0]-g[0])*this.kx;return Math.atan2(y,(v[1]-g[1])*this.ky)/o},c.prototype.destination=function(g,v,y){var b=y*o;return this.offset(g,Math.sin(b)*v,Math.cos(b)*v)},c.prototype.offset=function(g,v,y){return[g[0]+v/this.kx,g[1]+y/this.ky]},c.prototype.lineDistance=function(g){for(var v=0,y=0;y<g.length-1;y++)v+=this.distance(g[y],g[y+1]);return v},c.prototype.area=function(g){for(var v=0,y=0;y<g.length;y++)for(var b=g[y],x=0,C=b.length,E=C-1;x<C;E=x++)v+=f(b[x][0]-b[E][0])*(b[x][1]+b[E][1])*(y?-1:1);return Math.abs(v)/2*this.kx*this.ky},c.prototype.along=function(g,v){var y=0;if(v<=0)return g[0];for(var b=0;b<g.length-1;b++){var x=g[b],C=g[b+1],E=this.distance(x,C);if((y+=E)>v)return p(x,C,(v-(y-E))/E)}return g[g.length-1]},c.prototype.pointToSegmentDistance=function(g,v,y){var b=v[0],x=v[1],C=f(y[0]-b)*this.kx,E=(y[1]-x)*this.ky,M=0;return C===0&&E===0||((M=(f(g[0]-b)*this.kx*C+(g[1]-x)*this.ky*E)/(C*C+E*E))>1?(b=y[0],x=y[1]):M>0&&(b+=C/this.kx*M,x+=E/this.ky*M)),C=f(g[0]-b)*this.kx,E=(g[1]-x)*this.ky,Math.sqrt(C*C+E*E)},c.prototype.pointOnLine=function(g,v){for(var y,b,x,C,E=1/0,M=0;M<g.length-1;M++){var D=g[M][0],I=g[M][1],P=f(g[M+1][0]-D)*this.kx,O=(g[M+1][1]-I)*this.ky,R=0;P===0&&O===0||((R=(f(v[0]-D)*this.kx*P+(v[1]-I)*this.ky*O)/(P*P+O*O))>1?(D=g[M+1][0],I=g[M+1][1]):R>0&&(D+=P/this.kx*R,I+=O/this.ky*R));var F=(P=f(v[0]-D)*this.kx)*P+(O=(v[1]-I)*this.ky)*O;F<E&&(E=F,y=D,b=I,x=M,C=R)}return{point:[y,b],index:x,t:Math.max(0,Math.min(1,C))}},c.prototype.lineSlice=function(g,v,y){var b=this.pointOnLine(y,g),x=this.pointOnLine(y,v);if(b.index>x.index||b.index===x.index&&b.t>x.t){var C=b;b=x,x=C}var E=[b.point],M=b.index+1,D=x.index;!h(y[M],E[0])&&M<=D&&E.push(y[M]);for(var I=M+1;I<=D;I++)E.push(y[I]);return h(y[D],x.point)||E.push(x.point),E},c.prototype.lineSliceAlong=function(g,v,y){for(var b=0,x=[],C=0;C<y.length-1;C++){var E=y[C],M=y[C+1],D=this.distance(E,M);if((b+=D)>g&&x.length===0&&x.push(p(E,M,(g-(b-D))/D)),b>=v)return x.push(p(E,M,(v-(b-D))/D)),x;b>g&&x.push(M)}return x},c.prototype.bufferPoint=function(g,v){var y=v/this.ky,b=v/this.kx;return[g[0]-b,g[1]-y,g[0]+b,g[1]+y]},c.prototype.bufferBBox=function(g,v){var y=v/this.ky,b=v/this.kx;return[g[0]-b,g[1]-y,g[2]+b,g[3]+y]},c.prototype.insideBBox=function(g,v){return f(g[0]-v[0])>=0&&f(g[0]-v[2])<=0&&g[1]>=v[1]&&g[1]<=v[3]},Object.defineProperties(c,u),c}();var o1=ut(ZT.exports),XT={exports:{}};XT.exports=function(){var e=function(i,o){if(i===void 0&&(i=[]),o===void 0&&(o=t),this.data=i,this.length=this.data.length,this.compare=o,this.length>0)for(var c=(this.length>>1)-1;c>=0;c--)this._down(c)};function t(i,o){return i<o?-1:i>o?1:0}return e.prototype.push=function(i){this.data.push(i),this.length++,this._up(this.length-1)},e.prototype.pop=function(){if(this.length!==0){var i=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),i}},e.prototype.peek=function(){return this.data[0]},e.prototype._up=function(i){for(var o=this.data,c=this.compare,u=o[i];i>0;){var h=i-1>>1,p=o[h];if(c(u,p)>=0)break;o[i]=p,i=h}o[i]=u},e.prototype._down=function(i){for(var o=this.data,c=this.compare,u=this.length>>1,h=o[i];i<u;){var p=1+(i<<1),f=o[p],g=p+1;if(g<this.length&&c(o[g],f)<0&&(p=g,f=o[g]),c(f,h)>=0)break;o[i]=f,i=p}o[i]=h},e}();var s1=ut(XT.exports),wt=8192;function KT(e,t){return t.dist-e.dist}let a1=100,l1=50;function QT(e){let t=[1/0,1/0,-1/0,-1/0];if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function d_(e){return e[1]-e[0]+1}function rc(e,t){let i=e[1]>=e[0]&&e[1]<t;return i||console.warn("Distance Expression: Index is out of range"),i}function c1(e,t){if(e[0]>e[1])return[null,null];let i=d_(e);if(t){if(i===2)return[e,null];let o=Math.floor(i/2);return[[e[0],e[0]+o],[e[0]+o,e[1]]]}{if(i===1)return[e,null];let o=Math.floor(i/2)-1;return[[e[0],e[0]+o],[e[0]+o+1,e[1]]]}}function Yd(e,t){let i=[1/0,1/0,-1/0,-1/0];if(!rc(t,e.length))return i;for(let o=t[0];o<=t[1];++o)fp(i,e[o]);return i}function u_(e){let t=[1/0,1/0,-1/0,-1/0];for(let i=0;i<e.length;++i)for(let o=0;o<e[i].length;++o)fp(t,e[i][o]);return t}function nh(e,t,i){if(QT(e)||QT(t))return NaN;let o=0,c=0;return e[2]<t[0]&&(o=t[0]-e[2]),e[0]>t[2]&&(o=e[0]-t[2]),e[1]>t[3]&&(c=e[1]-t[3]),e[3]<t[1]&&(c=t[1]-e[3]),i.distance([0,0],[o,c])}function d1(e,t){let i=Math.pow(2,t.z);return[(c=(e.x/wt+t.x)/i,360*c-180),(o=(e.y/wt+t.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,c}function Aj(e,t){let i=[];for(let o=0;o<e.length;++o)i.push(d1(e[o],t));return i}function JT(e,t,i){let o=i.pointOnLine(t,e).point;return i.distance(e,o)}function tI(e,t,i,o,c){let u=i.slice(o[0],o[1]+1),h=1/0;for(let p=t[0];p<=t[1];++p)if((h=Math.min(h,JT(e[p],u,c)))===0)return 0;return h}function u1(e,t,i,o,c){let u=Math.min(c.pointToSegmentDistance(e,i,o),c.pointToSegmentDistance(t,i,o)),h=Math.min(c.pointToSegmentDistance(i,e,t),c.pointToSegmentDistance(o,e,t));return Math.min(u,h)}function kj(e,t,i,o,c){if(!rc(t,e.length)||!rc(o,i.length))return NaN;let u=1/0;for(let h=t[0];h<t[1];++h)for(let p=o[0];p<o[1];++p){if(c_(e[h],e[h+1],i[p],i[p+1]))return 0;u=Math.min(u,u1(e[h],e[h+1],i[p],i[p+1],c))}return u}function Rj(e,t,i,o,c){if(!rc(t,e.length)||!rc(o,i.length))return NaN;let u=1/0;for(let h=t[0];h<=t[1];++h)for(let p=o[0];p<=o[1];++p)if((u=Math.min(u,c.distance(e[h],i[p])))===0)return u;return u}function Pj(e,t,i){if(ih(e,t,!0))return 0;let o=1/0;for(let c of t){let u=c.length;if(u<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(c[0]!==c[u-1]&&(o=Math.min(o,i.pointToSegmentDistance(e,c[u-1],c[0])))===0||(o=Math.min(o,JT(e,c,i)))===0)return o}return o}function Oj(e,t,i,o){if(!rc(t,e.length))return NaN;for(let u=t[0];u<=t[1];++u)if(ih(e[u],i,!0))return 0;let c=1/0;for(let u=t[0];u<t[1];++u)for(let h of i)for(let p=0,f=h.length,g=f-1;p<f;g=p++){if(c_(e[u],e[u+1],h[g],h[p]))return 0;c=Math.min(c,u1(e[u],e[u+1],h[g],h[p],o))}return c}function eI(e,t){for(let i of e)for(let o=0;o<=i.length-1;++o)if(ih(i[o],t,!0))return!0;return!1}function Fj(e,t,i,o=1/0){let c=u_(e),u=u_(t);if(o!==1/0&&nh(c,u,i)>=o)return o;if(gp(c,u)){if(eI(e,t))return 0}else if(eI(t,e))return 0;let h=o;for(let p of e)for(let f=0,g=p.length,v=g-1;f<g;v=f++)for(let y of t)for(let b=0,x=y.length,C=x-1;b<x;C=b++){if(c_(p[v],p[f],y[C],y[b]))return 0;h=Math.min(h,u1(p[v],p[f],y[C],y[b],i))}return h}function h_(e,t,i,o,c,u,h){if(u===null||h===null)return;let p=nh(Yd(o,u),Yd(c,h),i);p<t&&e.push({dist:p,range1:u,range2:h})}function Lj(e,t,i,o,c=1/0){let u=Math.min(o.distance(e[0],i[0][0]),c);if(u===0)return u;let h=new s1([{dist:0,range1:[0,e.length-1],range2:[0,0]}],KT),p=t?l1:a1,f=u_(i);for(;h.length;){let g=h.pop();if(g.dist>=u)continue;let v=g.range1;if(d_(v)<=p){if(!rc(v,e.length))return NaN;if(t){let y=Oj(e,v,i,o);if((u=Math.min(u,y))===0)return u}else for(let y=v[0];y<=v[1];++y){let b=Pj(e[y],i,o);if((u=Math.min(u,b))===0)return u}}else{let y=c1(v,t);if(y[0]!==null){let b=nh(Yd(e,y[0]),f,o);b<u&&h.push({dist:b,range1:y[0],range2:[0,0]})}if(y[1]!==null){let b=nh(Yd(e,y[1]),f,o);b<u&&h.push({dist:b,range1:y[1],range2:[0,0]})}}}return u}function iI(e,t,i,o,c,u=1/0){let h=Math.min(u,c.distance(e[0],i[0]));if(h===0)return h;let p=new s1([{dist:0,range1:[0,e.length-1],range2:[0,i.length-1]}],KT),f=t?l1:a1,g=o?l1:a1;for(;p.length;){let v=p.pop();if(v.dist>=h)continue;let y=v.range1,b=v.range2;if(d_(y)<=f&&d_(b)<=g){if(!rc(y,e.length)||!rc(b,i.length))return NaN;if(t&&o?h=Math.min(h,kj(e,y,i,b,c)):t||o?t&&!o?h=Math.min(h,tI(i,b,e,y,c)):!t&&o&&(h=Math.min(h,tI(e,y,i,b,c))):h=Math.min(h,Rj(e,y,i,b,c)),h===0)return h}else{let x=c1(y,t),C=c1(b,o);h_(p,h,c,e,i,x[0],C[0]),h_(p,h,c,e,i,x[0],C[1]),h_(p,h,c,e,i,x[1],C[0]),h_(p,h,c,e,i,x[1],C[1])}}return h}function h1(e,t,i,o,c=1/0){let u=c,h=Yd(e,[0,e.length-1]);for(let p of i)if(!(u!==1/0&&nh(h,Yd(p,[0,p.length-1]),o)>=u)&&(u=Math.min(u,iI(e,t,p,!0,o,u)),u===0))return u;return u}function m_(e,t,i,o,c=1/0){let u=c,h=Yd(e,[0,e.length-1]);for(let p of i){if(u!==1/0&&nh(h,u_(p),o)>=u)continue;let f=Lj(e,t,p,o,u);if(isNaN(f))return f;if((u=Math.min(u,f))===0)return u}return u}function m1(e){return e==="Point"||e==="MultiPoint"||e==="LineString"||e==="MultiLineString"||e==="Polygon"||e==="MultiPolygon"}class vp{constructor(t,i){this.type=he,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(eh(t[1])){let o=t[1];if(o.type==="FeatureCollection"){for(let c=0;c<o.features.length;++c)if(m1(o.features[c].geometry.type))return new vp(o,o.features[c].geometry)}else if(o.type==="Feature"){if(m1(o.geometry.type))return new vp(o,o.geometry)}else if(m1(o.type))return new vp(o,o)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){let i=t.geometry(),o=t.canonicalID();if(i!=null&&o!=null){if(t.geometryType()==="Point")return function(c,u,h){let p=[];for(let g of c)for(let v of g)p.push(d1(v,u));let f=new o1(p[0][1],"meters");return h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString"?iI(p,!1,h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",f):h.type==="MultiLineString"?h1(p,!1,h.coordinates,f):h.type==="Polygon"||h.type==="MultiPolygon"?m_(p,!1,h.type==="Polygon"?[h.coordinates]:h.coordinates,f):null}(i,o,this.geometries);if(t.geometryType()==="LineString")return function(c,u,h){let p=[];for(let g of c){let v=[];for(let y of g)v.push(d1(y,u));p.push(v)}let f=new o1(p[0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return h1(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",p,f);if(h.type==="MultiLineString"){let g=1/0;for(let v=0;v<h.coordinates.length;v++){let y=h1(h.coordinates[v],!0,p,f,g);if(isNaN(y))return y;if((g=Math.min(g,y))===0)return g}return g}if(h.type==="Polygon"||h.type==="MultiPolygon"){let g=1/0;for(let v=0;v<p.length;v++){let y=m_(p[v],!0,h.type==="Polygon"?[h.coordinates]:h.coordinates,f,g);if(isNaN(y))return y;if((g=Math.min(g,y))===0)return g}return g}return null}(i,o,this.geometries);if(t.geometryType()==="Polygon")return function(c,u,h){let p=[];for(let g of function(v,y){let b=v.length;if(b<=1)return[v];let x=[],C,E;for(let M=0;M<b;M++){let D=Sj(v[M]);D!==0&&(v[M].area=Math.abs(D),E===void 0&&(E=D<0),E===D<0?(C&&x.push(C),C=[v[M]]):C.push(v[M]))}return C&&x.push(C),x}(c)){let v=[];for(let y=0;y<g.length;++y)v.push(Aj(g[y],u));p.push(v)}let f=new o1(p[0][0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return m_(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",p,f);if(h.type==="MultiLineString"){let g=1/0;for(let v=0;v<h.coordinates.length;v++){let y=m_(h.coordinates[v],!0,p,f,g);if(isNaN(y))return y;if((g=Math.min(g,y))===0)return g}return g}return h.type==="Polygon"||h.type==="MultiPolygon"?function(g,v,y){let b=1/0;for(let x of g)for(let C of v){let E=Fj(x,C,y,b);if(isNaN(E))return E;if((b=Math.min(b,E))===0)return b}return b}(h.type==="Polygon"?[h.coordinates]:h.coordinates,p,f):null}(i,o,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var p1=vp;function rh(e){if(e instanceof wl&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof r1||e instanceof p1)return!1;let t=!0;return e.eachChild(i=>{t&&!rh(i)&&(t=!1)}),t}function yp(e){if(e instanceof wl&&e.name==="feature-state")return!1;let t=!0;return e.eachChild(i=>{t&&!yp(i)&&(t=!1)}),t}function f1(e){if(e instanceof wl&&e.name==="config")return!1;let t=!0;return e.eachChild(i=>{t&&!f1(i)&&(t=!1)}),t}function oh(e,t){if(e instanceof wl&&t.indexOf(e.name)>=0)return!1;let i=!0;return e.eachChild(o=>{i&&!oh(o,t)&&(i=!1)}),i}class g1{constructor(t,i){this.type=i.type,this.name=t,this.boundExpression=i}static parse(t,i){if(t.length!==2||typeof t[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");let o=t[1];return i.scope.has(o)?new g1(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var nI=g1;class _1{constructor(t,i=[],o,c=new vj,u=[],h){this.registry=t,this.path=i,this.key=i.map(p=>`[${p}]`).join(""),this.scope=c,this.errors=u,this.expectedType=o,this.options=h}parse(t,i,o,c,u={}){return i||o?this.concat(i,o,c)._parse(t,u):this._parse(t,u)}_parse(t,i){function o(c,u,h){return h==="assert"?new nc(u,[c]):h==="coerce"?new Wd(u,[c]):c}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let c=typeof t[0]=="string"?this.registry[t[0]]:void 0;if(c){let u=c.parse(t,this);if(!u)return null;if(this.expectedType){let h=this.expectedType,p=u.type;if(h.kind!=="string"&&h.kind!=="number"&&h.kind!=="boolean"&&h.kind!=="object"&&h.kind!=="array"||p.kind!=="value")if(h.kind!=="color"&&h.kind!=="formatted"&&h.kind!=="resolvedImage"||p.kind!=="value"&&p.kind!=="string"){if(this.checkSubtype(h,p))return null}else u=o(u,h,i.typeAnnotation||"coerce");else u=o(u,h,i.typeAnnotation||"assert")}if(!(u instanceof hp)&&u.type.kind!=="resolvedImage"&&v1(u)){let h=new jT(this.options);try{u=new hp(u.type,u.evaluate(h))}catch(p){return this.error(p.message),null}}return u}return Wd.parse(["to-array",t],this)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,i,o){let c=typeof t=="number"?this.path.concat(t):this.path,u=o?this.scope.concat(o):this.scope;return new _1(this.registry,c,i||null,u,this.errors,this.options)}error(t,...i){let o=`${this.key}${i.map(c=>`[${c}]`).join("")}`;this.errors.push(new xl(o,t))}checkSubtype(t,i){let o=cp(t,i);return o&&this.error(o),o}}var rI=_1;function v1(e){if(e instanceof nI)return v1(e.boundExpression);if(e instanceof wl&&e.name==="error"||e instanceof wl&&e.name==="config"||e instanceof l_||e instanceof r1||e instanceof p1)return!1;let t=e instanceof Wd||e instanceof nc,i=!0;return e.eachChild(o=>{i=t?i&&v1(o):i&&o instanceof hp}),!!i&&rh(e)&&oh(e,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function p_(e,t){let i=e.length-1,o,c,u=0,h=i,p=0;for(;u<=h;)if(p=Math.floor((u+h)/2),o=e[p],c=e[p+1],o<=t){if(p===i||t<c)return p;u=p+1}else{if(!(o>t))throw new Ao("Input is not a number.");h=p-1}return 0}class y1{constructor(t,i,o){this.type=t,this.input=i,this.labels=[],this.outputs=[];for(let[c,u]of o)this.labels.push(c),this.outputs.push(u)}static parse(t,i){if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");let o=i.parse(t[1],1,he);if(!o)return null;let c=[],u=null;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);for(let h=1;h<t.length;h+=2){let p=h===1?-1/0:t[h],f=t[h+1],g=h,v=h+1;if(typeof p!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',g);if(c.length&&c[c.length-1][0]>=p)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',g);let y=i.parse(f,v,u);if(!y)return null;u=u||y.type,c.push([p,y])}return new y1(u,o,c)}evaluate(t){let i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(t);let c=this.input.evaluate(t);if(c<=i[0])return o[0].evaluate(t);let u=i.length;return c>=i[u-1]?o[u-1].evaluate(t):o[p_(i,c)].evaluate(t)}eachChild(t){t(this.input);for(let i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&t.push(this.labels[i]),t.push(this.outputs[i].serialize());return t}}var b1=y1;function $e(e,t,i){return e*(1-i)+t*i}function oI(e,t,i){return e.map((o,c)=>$e(o,t[c],i))}var f_=Object.freeze({__proto__:null,array:oI,color:function(e,t,i){return new fi($e(e.r,t.r,i),$e(e.g,t.g,i),$e(e.b,t.b,i),$e(e.a,t.a,i))},number:$e});let sI=.95047,aI=1.08883,lI=4/29,sh=6/29,cI=3*sh*sh,zj=sh*sh*sh,Nj=Math.PI/180,Bj=180/Math.PI;function x1(e){return e>zj?Math.pow(e,1/3):e/cI+lI}function w1(e){return e>sh?e*e*e:cI*(e-lI)}function C1(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function S1(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function dI(e){let t=S1(e.r),i=S1(e.g),o=S1(e.b),c=x1((.4124564*t+.3575761*i+.1804375*o)/sI),u=x1((.2126729*t+.7151522*i+.072175*o)/1);return{l:116*u-16,a:500*(c-u),b:200*(u-x1((.0193339*t+.119192*i+.9503041*o)/aI)),alpha:e.a}}function uI(e){let t=(e.l+16)/116,i=isNaN(e.a)?t:t+e.a/500,o=isNaN(e.b)?t:t-e.b/200;return t=1*w1(t),i=sI*w1(i),o=aI*w1(o),new fi(C1(3.2404542*i-1.5371385*t-.4985314*o),C1(-.969266*i+1.8760108*t+.041556*o),C1(.0556434*i-.2040259*t+1.0572252*o),e.alpha)}function Vj(e,t,i){let o=t-e;return e+i*(o>180||o<-180?o-360*Math.round(o/360):o)}let bp={forward:dI,reverse:uI,interpolate:function(e,t,i){return{l:$e(e.l,t.l,i),a:$e(e.a,t.a,i),b:$e(e.b,t.b,i),alpha:$e(e.alpha,t.alpha,i)}}},xp={forward:function(e){let{l:t,a:i,b:o}=dI(e),c=Math.atan2(o,i)*Bj;return{h:c<0?c+360:c,c:Math.sqrt(i*i+o*o),l:t,alpha:e.a}},reverse:function(e){let t=e.h*Nj,i=e.c;return uI({l:e.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:e.alpha})},interpolate:function(e,t,i){return{h:Vj(e.h,t.h,i),c:$e(e.c,t.c,i),l:$e(e.l,t.l,i),alpha:$e(e.alpha,t.alpha,i)}}};var hI=Object.freeze({__proto__:null,hcl:xp,lab:bp});class g_{constructor(t,i,o,c,u){this.type=t,this.operator=i,this.interpolation=o,this.input=c,this.labels=[],this.outputs=[];for(let[h,p]of u)this.labels.push(h),this.outputs.push(p)}static interpolationFactor(t,i,o,c){let u=0;if(t.name==="exponential")u=E1(i,t.base,o,c);else if(t.name==="linear")u=E1(i,1,o,c);else if(t.name==="cubic-bezier"){let h=t.controlPoints;u=new Pt(h[0],h[1],h[2],h[3]).solve(E1(i,1,o,c))}return u}static parse(t,i){let[o,c,u,...h]=t;if(!Array.isArray(c)||c.length===0)return i.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){let g=c[1];if(typeof g!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:g}}else{if(c[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(c[0])}`,1,0);{let g=c.slice(1);if(g.length!==4||g.some(v=>typeof v!="number"||v<0||v>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:g}}}if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(u=i.parse(u,2,he),!u)return null;let p=[],f=null;o==="interpolate-hcl"||o==="interpolate-lab"?f=sa:i.expectedType&&i.expectedType.kind!=="value"&&(f=i.expectedType);for(let g=0;g<h.length;g+=2){let v=h[g],y=h[g+1],b=g+3,x=g+4;if(typeof v!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',b);if(p.length&&p[p.length-1][0]>=v)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',b);let C=i.parse(y,x,f);if(!C)return null;f=f||C.type,p.push([v,C])}return f.kind==="number"||f.kind==="color"||f.kind==="array"&&f.itemType.kind==="number"&&typeof f.N=="number"?new g_(f,o,c,u,p):i.error(`Type ${Gr(f)} is not interpolatable.`)}evaluate(t){let i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(t);let c=this.input.evaluate(t);if(c<=i[0])return o[0].evaluate(t);let u=i.length;if(c>=i[u-1])return o[u-1].evaluate(t);let h=p_(i,c),p=g_.interpolationFactor(this.interpolation,c,i[h],i[h+1]),f=o[h].evaluate(t),g=o[h+1].evaluate(t);return this.operator==="interpolate"?f_[this.type.kind.toLowerCase()](f,g,p):this.operator==="interpolate-hcl"?xp.reverse(xp.interpolate(xp.forward(f),xp.forward(g),p)):bp.reverse(bp.interpolate(bp.forward(f),bp.forward(g),p))}eachChild(t){t(this.input);for(let i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let i=[this.operator,t,this.input.serialize()];for(let o=0;o<this.labels.length;o++)i.push(this.labels[o],this.outputs[o].serialize());return i}}function E1(e,t,i,o){let c=o-i,u=e-i;return c===0?0:t===1?u/c:(Math.pow(t,u)-1)/(Math.pow(t,c)-1)}var Cl=g_;class M1{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expectected at least one argument.");let o=null,c=i.expectedType;c&&c.kind!=="value"&&(o=c);let u=[];for(let p of t.slice(1)){let f=i.parse(p,1+u.length,o,void 0,{typeAnnotation:"omit"});if(!f)return null;o=o||f.type,u.push(f)}let h=c&&u.some(p=>cp(c,p.type));return new M1(h?qi:o,u)}evaluate(t){let i,o=null,c=0;for(let u of this.args){if(c++,o=u.evaluate(t),o&&o instanceof aa&&!o.available&&(i||(i=o),o=null,c===this.args.length))return i;if(o!==null)break}return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){let t=["coalesce"];return this.eachChild(i=>{t.push(i.serialize())}),t}}var mI=M1;class D1{constructor(t,i){this.type=i.type,this.bindings=[].concat(t),this.result=i}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(let i of this.bindings)t(i[1]);t(this.result)}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);let o=[];for(let u=1;u<t.length-1;u+=2){let h=t[u];if(typeof h!="string")return i.error(`Expected string, but found ${typeof h} instead.`,u);if(/[^a-zA-Z0-9_]/.test(h))return i.error("Variable names must contain only alphanumeric characters or '_'.",u);let p=i.parse(t[u+1],u+1);if(!p)return null;o.push([h,p])}let c=i.parse(t[t.length-1],t.length-1,i.expectedType,o);return c?new D1(o,c):null}outputDefined(){return this.result.outputDefined()}serialize(){let t=["let"];for(let[i,o]of this.bindings)t.push(i,o.serialize());return t.push(this.result.serialize()),t}}var pI=D1;class T1{constructor(t,i,o){this.type=t,this.index=i,this.input=o}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let o=i.parse(t[1],1,he),c=i.parse(t[2],2,_s(i.expectedType||qi));return o&&c?new T1(c.type.itemType,o,c):null}evaluate(t){let i=this.index.evaluate(t),o=this.input.evaluate(t);if(i<0)throw new Ao(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new Ao(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new Ao(`Array index must be an integer, but found ${i} instead.`);return o[i]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var jj=T1;class I1{constructor(t,i){this.type=Ki,this.needle=t,this.haystack=i}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let o=i.parse(t[1],1,qi),c=i.parse(t[2],2,qi);return o&&c?$x(o.type,[Ki,Ui,he,Ju,qi])?new I1(o,c):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Gr(o.type)} instead`):null}evaluate(t){let i=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(o==null)return!1;if(!dp(i,["boolean","string","number","null"]))throw new Ao(`Expected first argument to be of type boolean, string, number or null, but found ${Gr(yo(i))} instead.`);if(!dp(o,["string","array"]))throw new Ao(`Expected second argument to be of type array or string, but found ${Gr(yo(o))} instead.`);return o.indexOf(i)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Uj=I1;class __{constructor(t,i,o){this.type=he,this.needle=t,this.haystack=i,this.fromIndex=o}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let o=i.parse(t[1],1,qi),c=i.parse(t[2],2,qi);if(!o||!c)return null;if(!$x(o.type,[Ki,Ui,he,Ju,qi]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Gr(o.type)} instead`);if(t.length===4){let u=i.parse(t[3],3,he);return u?new __(o,c,u):null}return new __(o,c)}evaluate(t){let i=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!dp(i,["boolean","string","number","null"]))throw new Ao(`Expected first argument to be of type boolean, string, number or null, but found ${Gr(yo(i))} instead.`);if(!dp(o,["string","array"]))throw new Ao(`Expected second argument to be of type array or string, but found ${Gr(yo(o))} instead.`);if(this.fromIndex){let c=this.fromIndex.evaluate(t);return o.indexOf(i,c)}return o.indexOf(i)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Hj=__;class A1{constructor(t,i,o,c,u,h){this.inputType=t,this.type=i,this.input=o,this.cases=c,this.outputs=u,this.otherwise=h}static parse(t,i){if(t.length<5)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return i.error("Expected an even number of arguments.");let o,c;i.expectedType&&i.expectedType.kind!=="value"&&(c=i.expectedType);let u={},h=[];for(let g=2;g<t.length-1;g+=2){let v=t[g],y=t[g+1];Array.isArray(v)||(v=[v]);let b=i.concat(g);if(v.length===0)return b.error("Expected at least one branch label.");for(let C of v){if(typeof C!="number"&&typeof C!="string")return b.error("Branch labels must be numbers or strings.");if(typeof C=="number"&&Math.abs(C)>Number.MAX_SAFE_INTEGER)return b.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof C=="number"&&Math.floor(C)!==C)return b.error("Numeric branch labels must be integer values.");if(o){if(b.checkSubtype(o,yo(C)))return null}else o=yo(C);if(u[String(C)]!==void 0)return b.error("Branch labels must be unique.");u[String(C)]=h.length}let x=i.parse(y,g,c);if(!x)return null;c=c||x.type,h.push(x)}let p=i.parse(t[1],1,qi);if(!p)return null;let f=i.parse(t[t.length-1],t.length-1,c);return f?p.type.kind!=="value"&&i.concat(1).checkSubtype(o,p.type)?null:new A1(o,c,p,u,h,f):null}evaluate(t){let i=this.input.evaluate(t);return(yo(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){let t=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),o=[],c={};for(let h of i){let p=c[this.cases[h]];p===void 0?(c[this.cases[h]]=o.length,o.push([this.cases[h],[h]])):o[p][1].push(h)}let u=h=>this.inputType.kind==="number"?Number(h):h;for(let[h,p]of o)t.push(p.length===1?u(p[0]):p.map(u)),t.push(this.outputs[h].serialize());return t.push(this.otherwise.serialize()),t}}var Gj=A1;class k1{constructor(t,i,o){this.type=t,this.branches=i,this.otherwise=o}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);let c=[];for(let h=1;h<t.length-1;h+=2){let p=i.parse(t[h],h,Ki);if(!p)return null;let f=i.parse(t[h+1],h+1,o);if(!f)return null;c.push([p,f]),o=o||f.type}let u=i.parse(t[t.length-1],t.length-1,o);return u?new k1(o,c,u):null}evaluate(t){for(let[i,o]of this.branches)if(i.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(let[i,o]of this.branches)t(i),t(o);t(this.otherwise)}outputDefined(){return this.branches.every(([t,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){let t=["case"];return this.eachChild(i=>{t.push(i.serialize())}),t}}var qj=k1;class v_{constructor(t,i,o,c){this.type=t,this.input=i,this.beginIndex=o,this.endIndex=c}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let o=i.parse(t[1],1,qi),c=i.parse(t[2],2,he);if(!o||!c)return null;if(!$x(o.type,[_s(qi),Ui,qi]))return i.error(`Expected first argument to be of type array or string, but found ${Gr(o.type)} instead`);if(t.length===4){let u=i.parse(t[3],3,he);return u?new v_(o.type,o,c,u):null}return new v_(o.type,o,c)}evaluate(t){let i=this.input.evaluate(t),o=this.beginIndex.evaluate(t);if(!dp(i,["string","array"]))throw new Ao(`Expected first argument to be of type array or string, but found ${Gr(yo(i))} instead.`);if(this.endIndex){let c=this.endIndex.evaluate(t);return i.slice(o,c)}return i.slice(o)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Wj=v_;function fI(e,t){return e==="=="||e==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function gI(e,t,i,o){return o.compare(t,i)===0}function ah(e,t,i){let o=e!=="=="&&e!=="!=";return class uV{constructor(u,h,p){this.type=Ki,this.lhs=u,this.rhs=h,this.collator=p,this.hasUntypedArgument=u.type.kind==="value"||h.type.kind==="value"}static parse(u,h){if(u.length!==3&&u.length!==4)return h.error("Expected two or three arguments.");let p=u[0],f=h.parse(u[1],1,qi);if(!f)return null;if(!fI(p,f.type))return h.concat(1).error(`"${p}" comparisons are not supported for type '${Gr(f.type)}'.`);let g=h.parse(u[2],2,qi);if(!g)return null;if(!fI(p,g.type))return h.concat(2).error(`"${p}" comparisons are not supported for type '${Gr(g.type)}'.`);if(f.type.kind!==g.type.kind&&f.type.kind!=="value"&&g.type.kind!=="value")return h.error(`Cannot compare types '${Gr(f.type)}' and '${Gr(g.type)}'.`);o&&(f.type.kind==="value"&&g.type.kind!=="value"?f=new nc(g.type,[f]):f.type.kind!=="value"&&g.type.kind==="value"&&(g=new nc(f.type,[g])));let v=null;if(u.length===4){if(f.type.kind!=="string"&&g.type.kind!=="string"&&f.type.kind!=="value"&&g.type.kind!=="value")return h.error("Cannot use collator to compare non-string types.");if(v=h.parse(u[3],3,o_),!v)return null}return new uV(f,g,v)}evaluate(u){let h=this.lhs.evaluate(u),p=this.rhs.evaluate(u);if(o&&this.hasUntypedArgument){let f=yo(h),g=yo(p);if(f.kind!==g.kind||f.kind!=="string"&&f.kind!=="number")throw new Ao(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${f.kind}, ${g.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){let f=yo(h),g=yo(p);if(f.kind!=="string"||g.kind!=="string")return t(u,h,p)}return this.collator?i(u,h,p,this.collator.evaluate(u)):t(u,h,p)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){let u=[e];return this.eachChild(h=>{u.push(h.serialize())}),u}}}let $j=ah("==",function(e,t,i){return t===i},gI),Yj=ah("!=",function(e,t,i){return t!==i},function(e,t,i,o){return!gI(0,t,i,o)}),Zj=ah("<",function(e,t,i){return t<i},function(e,t,i,o){return o.compare(t,i)<0}),Xj=ah(">",function(e,t,i){return t>i},function(e,t,i,o){return o.compare(t,i)>0}),Kj=ah("<=",function(e,t,i){return t<=i},function(e,t,i,o){return o.compare(t,i)<=0}),Qj=ah(">=",function(e,t,i){return t>=i},function(e,t,i,o){return o.compare(t,i)>=0});class R1{constructor(t,i,o,c,u,h){this.type=Ui,this.number=t,this.locale=i,this.currency=o,this.unit=c,this.minFractionDigits=u,this.maxFractionDigits=h}static parse(t,i){if(t.length!==3)return i.error("Expected two arguments.");let o=i.parse(t[1],1,he);if(!o)return null;let c=t[2];if(typeof c!="object"||Array.isArray(c))return i.error("NumberFormat options argument must be an object.");let u=null;if(c.locale&&(u=i.parse(c.locale,1,Ui),!u))return null;let h=null;if(c.currency&&(h=i.parse(c.currency,1,Ui),!h))return null;let p=null;if(c.unit&&(p=i.parse(c.unit,1,Ui),!p))return null;let f=null;if(c["min-fraction-digits"]&&(f=i.parse(c["min-fraction-digits"],1,he),!f))return null;let g=null;return c["max-fraction-digits"]&&(g=i.parse(c["max-fraction-digits"],1,he),!g)?null:new R1(o,u,h,p,f,g)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class P1{constructor(t){this.type=he,this.input=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);let o=i.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Gr(o.type)} instead.`):new P1(o):null}evaluate(t){let i=this.input.evaluate(t);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Ao(`Expected value to be of type string or array, but found ${Gr(yo(i))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){let t=["length"];return this.eachChild(i=>{t.push(i.serialize())}),t}}function O1(e){return function(){e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}let _I={"==":$j,"!=":Yj,">":Xj,"<":Zj,">=":Qj,"<=":Kj,array:nc,at:jj,boolean:nc,case:qj,coalesce:mI,collator:l_,format:mp,image:pp,in:Uj,"index-of":Hj,interpolate:Cl,"interpolate-hcl":Cl,"interpolate-lab":Cl,length:P1,let:pI,literal:hp,match:Gj,number:nc,"number-format":R1,object:nc,slice:Wj,step:b1,string:nc,"to-boolean":Wd,"to-color":Wd,"to-number":Wd,"to-string":Wd,var:nI,within:r1,distance:p1};function vI(e,[t,i,o,c]){t=t.evaluate(e),i=i.evaluate(e),o=o.evaluate(e);let u=c?c.evaluate(e):1,h=VT(t,i,o,u);if(h)throw new Ao(h);return new fi(t/255*u,i/255*u,o/255*u,u)}function yI(e,[t,i,o,c]){t=t.evaluate(e),i=i.evaluate(e),o=o.evaluate(e);let u=c?c.evaluate(e):1,h=function(g,v,y,b){return typeof g=="number"&&g>=0&&g<=360?typeof v=="number"&&v>=0&&v<=100&&typeof y=="number"&&y>=0&&y<=100?b===void 0||typeof b=="number"&&b>=0&&b<=1?null:`Invalid hsla value [${[g,v,y,b].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof b=="number"?[g,v,y,b]:[g,v,y]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof b=="number"?[g,v,y,b]:[g,v,y]).join(", ")}]: 'h' must be between 0 and 360.`}(t,i,o,u);if(h)throw new Ao(h);let p=`hsla(${t}, ${i}%, ${o}%, ${u})`,f=fi.parse(p);if(!f)throw new Ao(`Failed to parse HSLA color: ${p}`);return f}function bI(e,t){return e in t}function F1(e,t){let i=t[e];return i===void 0?null:i}function xI(e,t){switch(e){case"string":return String(t);case"number":return+t;case"boolean":return!!t;case"color":return fi.parse(t)}return t}function wI(e,t,i,o){return o!==void 0&&(e=o*Math.round(e/o)),t!==void 0&&e<t&&(e=t),i!==void 0&&e>i&&(e=i),e}function CI(e,t,i){i.length&&(t+=`${i}`);let o=e.getConfig(t);if(!o)return null;let{type:c,value:u,values:h,minValue:p,maxValue:f,stepValue:g}=o,v=o.default.evaluate(e),y=u?u.evaluate(e):v;return c&&(y=xI(c,y)),u!==void 0&&y!==void 0&&h&&!h.includes(y)&&(y=v,c&&(y=xI(c,y))),y===void 0||p===void 0&&f===void 0&&g===void 0||(typeof y=="number"?y=wI(y,p,f,g):Array.isArray(y)&&(y=y.map(b=>typeof b=="number"?wI(b,p,f,g):b))),y}function Zd(e){return{type:e}}wl.register(_I,{error:[{kind:"error"},[Ui],(e,[t])=>{throw new Ao(t.evaluate(e))}],typeof:[Ui,[qi],(e,[t])=>Gr(yo(t.evaluate(e)))],"to-rgba":[_s(he,4),[sa],(e,[t])=>t.evaluate(e).toArray()],rgb:[sa,[he,he,he],vI],rgba:[sa,[he,he,he,he],vI],hsl:[sa,[he,he,he],yI],hsla:[sa,[he,he,he,he],yI],has:{type:Ki,overloads:[[[Ui],(e,[t])=>bI(t.evaluate(e),e.properties())],[[Ui,th],(e,[t,i])=>bI(t.evaluate(e),i.evaluate(e))]]},get:{type:qi,overloads:[[[Ui],(e,[t])=>F1(t.evaluate(e),e.properties())],[[Ui,th],(e,[t,i])=>F1(t.evaluate(e),i.evaluate(e))]]},config:{type:qi,overloads:[[[Ui],(e,[t])=>CI(e,t.evaluate(e),"")],[[Ui,Ui],(e,[t,i])=>CI(e,t.evaluate(e),i.evaluate(e))]]},"feature-state":[qi,[Ui],(e,[t])=>F1(t.evaluate(e),e.featureState||{})],properties:[th,[],e=>e.properties()],"geometry-type":[Ui,[],e=>e.geometryType()],id:[qi,[],e=>e.id()],zoom:[he,[],e=>e.globals.zoom],pitch:[he,[],e=>e.globals.pitch||0],"distance-from-center":[he,[],e=>e.distanceFromCenter()],"measure-light":[he,[Ui],(e,[t])=>e.measureLight(t.evaluate(e))],"heatmap-density":[he,[],e=>e.globals.heatmapDensity||0],"line-progress":[he,[],e=>e.globals.lineProgress||0],"raster-value":[he,[],e=>e.globals.rasterValue||0],"sky-radial-progress":[he,[],e=>e.globals.skyRadialProgress||0],accumulated:[qi,[],e=>e.globals.accumulated===void 0?null:e.globals.accumulated],"+":[he,Zd(he),(e,t)=>{let i=0;for(let o of t)i+=o.evaluate(e);return i}],"*":[he,Zd(he),(e,t)=>{let i=1;for(let o of t)i*=o.evaluate(e);return i}],"-":{type:he,overloads:[[[he,he],(e,[t,i])=>t.evaluate(e)-i.evaluate(e)],[[he],(e,[t])=>-t.evaluate(e)]]},"/":[he,[he,he],(e,[t,i])=>t.evaluate(e)/i.evaluate(e)],"%":[he,[he,he],(e,[t,i])=>t.evaluate(e)%i.evaluate(e)],ln2:[he,[],()=>Math.LN2],pi:[he,[],()=>Math.PI],e:[he,[],()=>Math.E],"^":[he,[he,he],(e,[t,i])=>Math.pow(t.evaluate(e),i.evaluate(e))],sqrt:[he,[he],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[he,[he],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[he,[he],(e,[t])=>Math.log(t.evaluate(e))],log2:[he,[he],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[he,[he],(e,[t])=>Math.sin(t.evaluate(e))],cos:[he,[he],(e,[t])=>Math.cos(t.evaluate(e))],tan:[he,[he],(e,[t])=>Math.tan(t.evaluate(e))],asin:[he,[he],(e,[t])=>Math.asin(t.evaluate(e))],acos:[he,[he],(e,[t])=>Math.acos(t.evaluate(e))],atan:[he,[he],(e,[t])=>Math.atan(t.evaluate(e))],min:[he,Zd(he),(e,t)=>Math.min(...t.map(i=>i.evaluate(e)))],max:[he,Zd(he),(e,t)=>Math.max(...t.map(i=>i.evaluate(e)))],abs:[he,[he],(e,[t])=>Math.abs(t.evaluate(e))],round:[he,[he],(e,[t])=>{let i=t.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[he,[he],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[he,[he],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[Ki,[Ui,qi],(e,[t,i])=>e.properties()[t.value]===i.value],"filter-id-==":[Ki,[qi],(e,[t])=>e.id()===t.value],"filter-type-==":[Ki,[Ui],(e,[t])=>e.geometryType()===t.value],"filter-<":[Ki,[Ui,qi],(e,[t,i])=>{let o=e.properties()[t.value],c=i.value;return typeof o==typeof c&&o<c}],"filter-id-<":[Ki,[qi],(e,[t])=>{let i=e.id(),o=t.value;return typeof i==typeof o&&i<o}],"filter->":[Ki,[Ui,qi],(e,[t,i])=>{let o=e.properties()[t.value],c=i.value;return typeof o==typeof c&&o>c}],"filter-id->":[Ki,[qi],(e,[t])=>{let i=e.id(),o=t.value;return typeof i==typeof o&&i>o}],"filter-<=":[Ki,[Ui,qi],(e,[t,i])=>{let o=e.properties()[t.value],c=i.value;return typeof o==typeof c&&o<=c}],"filter-id-<=":[Ki,[qi],(e,[t])=>{let i=e.id(),o=t.value;return typeof i==typeof o&&i<=o}],"filter->=":[Ki,[Ui,qi],(e,[t,i])=>{let o=e.properties()[t.value],c=i.value;return typeof o==typeof c&&o>=c}],"filter-id->=":[Ki,[qi],(e,[t])=>{let i=e.id(),o=t.value;return typeof i==typeof o&&i>=o}],"filter-has":[Ki,[qi],(e,[t])=>t.value in e.properties()],"filter-has-id":[Ki,[],e=>e.id()!==null&&e.id()!==void 0],"filter-type-in":[Ki,[_s(Ui)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[Ki,[_s(qi)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[Ki,[Ui,_s(qi)],(e,[t,i])=>i.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[Ki,[Ui,_s(qi)],(e,[t,i])=>function(o,c,u,h){for(;u<=h;){let p=u+h>>1;if(c[p]===o)return!0;c[p]>o?h=p-1:u=p+1}return!1}(e.properties()[t.value],i.value,0,i.value.length-1)],all:{type:Ki,overloads:[[[Ki,Ki],(e,[t,i])=>t.evaluate(e)&&i.evaluate(e)],[Zd(Ki),(e,t)=>{for(let i of t)if(!i.evaluate(e))return!1;return!0}]]},any:{type:Ki,overloads:[[[Ki,Ki],(e,[t,i])=>t.evaluate(e)||i.evaluate(e)],[Zd(Ki),(e,t)=>{for(let i of t)if(i.evaluate(e))return!0;return!1}]]},"!":[Ki,[Ki],(e,[t])=>!t.evaluate(e)],"is-supported-script":[Ki,[Ui],(e,[t])=>{let i=e.globals&&e.globals.isSupportedScript;return!i||i(t.evaluate(e))}],upcase:[Ui,[Ui],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[Ui,[Ui],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[Ui,Zd(qi),(e,t)=>t.map(i=>up(i.evaluate(e))).join("")],"resolved-locale":[Ui,[o_],(e,[t])=>t.evaluate(e).resolvedLocale()],random:[he,[he,he,qi],(e,t)=>{let[i,o,c]=t.map(h=>h.evaluate(e));if(i>o||i===o)return i;let u;if(typeof c=="string")u=function(h){let p=0;if(h.length===0)return p;for(let f=0;f<h.length;f++)p=(p<<5)-p+h.charCodeAt(f),p&=p;return p}(c);else{if(typeof c!="number")throw new Ao(`Invalid seed input: ${c}`);u=c}return i+O1(u)()*(o-i)}]});var wp=_I;function SI(e){return{result:"success",value:e}}function Xd(e){return{result:"error",value:e}}function EI(e,t){return!!e&&!!e.parameters&&e.parameters.indexOf(t)>-1}function Kd(e){return e["property-type"]==="data-driven"}function MI(e){return EI(e.expression,"measure-light")}function L1(e){return EI(e.expression,"zoom")}function z1(e){return!!e.expression&&e.expression.interpolated}function y_(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function Jj(e){return e}function DI(e,t){let i=t.type==="color",o=e.stops&&typeof e.stops[0][0]=="object",c=o||!(o||e.property!==void 0),u=e.type||(z1(t)?"exponential":"interval");if(i&&((e=ec({},e)).stops&&(e.stops=e.stops.map(g=>[g[0],fi.parse(g[1])])),e.default=fi.parse(e.default?e.default:t.default)),e.colorSpace&&e.colorSpace!=="rgb"&&!hI[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let h,p,f;if(u==="exponential")h=TI;else if(u==="interval")h=eU;else if(u==="categorical"){h=tU,p=Object.create(null);for(let g of e.stops)p[g[0]]=g[1];f=typeof e.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);h=iU}if(o){let g={},v=[];for(let x=0;x<e.stops.length;x++){let C=e.stops[x],E=C[0].zoom;g[E]===void 0&&(g[E]={zoom:E,type:e.type,property:e.property,default:e.default,stops:[]},v.push(E)),g[E].stops.push([C[0].value,C[1]])}let y=[];for(let x of v)y.push([g[x].zoom,DI(g[x],t)]);let b={name:"linear"};return{kind:"composite",interpolationType:b,interpolationFactor:Cl.interpolationFactor.bind(void 0,b),zoomStops:y.map(x=>x[0]),evaluate:({zoom:x},C)=>TI({stops:y,base:e.base},t,x).evaluate(x,C)}}if(c){let g=u==="exponential"?{name:"exponential",base:e.base!==void 0?e.base:1}:null;return{kind:"camera",interpolationType:g,interpolationFactor:Cl.interpolationFactor.bind(void 0,g),zoomStops:e.stops.map(v=>v[0]),evaluate:({zoom:v})=>h(e,t,v,p,f)}}return{kind:"source",evaluate(g,v){let y=v&&v.properties?v.properties[e.property]:void 0;return y===void 0?Cp(e.default,t.default):h(e,t,y,p,f)}}}function Cp(e,t,i){return e!==void 0?e:t!==void 0?t:i!==void 0?i:void 0}function tU(e,t,i,o,c){return Cp(typeof i===c?o[i]:void 0,e.default,t.default)}function eU(e,t,i){if(cn(i)!=="number")return Cp(e.default,t.default);let o=e.stops.length;if(o===1||i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[o-1][0])return e.stops[o-1][1];let c=p_(e.stops.map(u=>u[0]),i);return e.stops[c][1]}function TI(e,t,i){let o=e.base!==void 0?e.base:1;if(cn(i)!=="number")return Cp(e.default,t.default);let c=e.stops.length;if(c===1||i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[c-1][0])return e.stops[c-1][1];let u=p_(e.stops.map(v=>v[0]),i),h=function(v,y,b,x){let C=x-b,E=v-b;return C===0?0:y===1?E/C:(Math.pow(y,E)-1)/(Math.pow(y,C)-1)}(i,o,e.stops[u][0],e.stops[u+1][0]),p=e.stops[u][1],f=e.stops[u+1][1],g=f_[t.type]||Jj;if(e.colorSpace&&e.colorSpace!=="rgb"){let v=hI[e.colorSpace];g=(y,b)=>v.reverse(v.interpolate(v.forward(y),v.forward(b),h))}return typeof p.evaluate=="function"?{evaluate(...v){let y=p.evaluate.apply(void 0,v),b=f.evaluate.apply(void 0,v);if(y!==void 0&&b!==void 0)return g(y,b,h)}}:g(p,f,h)}function iU(e,t,i){return t.type==="color"?i=fi.parse(i):t.type==="formatted"?i=ys.fromString(i.toString()):t.type==="resolvedImage"?i=aa.fromString(i.toString()):cn(i)===t.type||t.type==="enum"&&t.values[i]||(i=void 0),Cp(i,e.default,t.default)}class N1{constructor(t,i,o){this.expression=t,this._warningHistory={},this._evaluator=new jT(o),this._defaultValue=i?function(c){return c.type==="color"&&(y_(c.default)||Array.isArray(c.default))?new fi(0,0,0,0):c.type==="color"?fi.parse(c.default)||null:c.default===void 0?null:c.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(t,i,o,c,u,h,p,f){return this._evaluator.globals=t,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=c||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=h,this._evaluator.featureTileCoord=p||null,this._evaluator.featureDistanceData=f||null,this.expression.evaluate(this._evaluator)}evaluate(t,i,o,c,u,h,p,f){this._evaluator.globals=t,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=h||null,this._evaluator.featureTileCoord=p||null,this._evaluator.featureDistanceData=f||null;try{let g=this.expression.evaluate(this._evaluator);if(g==null||typeof g=="number"&&g!=g)return this._defaultValue;if(this._enumValues&&!(g in this._enumValues))throw new Ao(`Expected value to be one of ${Object.keys(this._enumValues).map(v=>JSON.stringify(v)).join(", ")}, but found ${JSON.stringify(g)} instead.`);return g}catch(g){return this._warningHistory[g.message]||(this._warningHistory[g.message]=!0,typeof console<"u"&&console.warn(g.message)),this._defaultValue}}}function b_(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in wp}function Vc(e,t,i){let o=new rI(wp,[],t?function(u){let h={color:sa,string:Ui,number:he,enum:Ui,boolean:Ki,formatted:ap,resolvedImage:lp};return u.type==="array"?_s(h[u.value]||qi,u.length):h[u.type]}(t):void 0,void 0,void 0,i),c=o.parse(e,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?SI(new N1(c,t,i)):Xd(o.errors)}class B1{constructor(t,i,o){this.kind=t,this._styleExpression=i,this.isLightConstant=o,this.isStateDependent=t!=="constant"&&!yp(i.expression),this.isConfigDependent=!f1(i.expression)}evaluateWithoutErrorHandling(t,i,o,c,u,h){return this._styleExpression.evaluateWithoutErrorHandling(t,i,o,c,u,h)}evaluate(t,i,o,c,u,h){return this._styleExpression.evaluate(t,i,o,c,u,h)}}class jc{constructor(t,i,o,c,u){this.kind=t,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=t!=="camera"&&!yp(i.expression),this.isLightConstant=u,this.isConfigDependent=!f1(i.expression),this.interpolationType=c}evaluateWithoutErrorHandling(t,i,o,c,u,h){return this._styleExpression.evaluateWithoutErrorHandling(t,i,o,c,u,h)}evaluate(t,i,o,c,u,h){return this._styleExpression.evaluate(t,i,o,c,u,h)}interpolationFactor(t,i,o){return this.interpolationType?Cl.interpolationFactor(this.interpolationType,t,i,o):0}}function V1(e,t,i){if((e=Vc(e,t,i)).result==="error")return e;let o=e.value.expression,c=rh(o);if(!c&&!Kd(t))return Xd([new xl("","data expressions not supported")]);let u=oh(o,["zoom","pitch","distance-from-center"]);if(!u&&!L1(t))return Xd([new xl("","zoom expressions not supported")]);let h=oh(o,["measure-light"]);if(!h&&!MI(t))return Xd([new xl("","measure-light expression not supported")]);let p=t.expression&&t.expression.relaxZoomRestriction,f=w_(o);return f||u||p?f instanceof xl?Xd([f]):f instanceof Cl&&!z1(t)?Xd([new xl("",'"interpolate" expressions cannot be used with this property')]):SI(f?new jc(c?"camera":"composite",e.value,f.labels,f instanceof Cl?f.interpolation:void 0,h):new B1(c?"constant":"source",e.value,h)):Xd([new xl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class x_{constructor(t,i){this._parameters=t,this._specification=i,ec(this,DI(this._parameters,this._specification))}static deserialize(t){return new x_(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function w_(e){let t=null;if(e instanceof pI)t=w_(e.result);else if(e instanceof mI){for(let i of e.args)if(t=w_(i),t)break}else(e instanceof b1||e instanceof Cl)&&e.input instanceof wl&&e.input.name==="zoom"&&(t=e);return t instanceof xl||e.eachChild(i=>{let o=w_(i);o instanceof xl?t=o:t&&o&&t!==o&&(t=new xl("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function la(e){let t=e.key,i=e.value,o=e.valueSpec||{},c=e.objectElementValidators||{},u=e.style,h=e.styleSpec,p=[],f=cn(i);if(f!=="object")return[new be(t,i,`object expected, ${f} found`)];for(let g in i){let v=g.split(".")[0],y;c[v]?y=c[v]:o[v]?y=No:c["*"]?y=c["*"]:o["*"]&&(y=No),y?p=p.concat(y({key:(t&&`${t}.`)+g,value:i[g],valueSpec:o[v]||o["*"],style:u,styleSpec:h,object:i,objectKey:g},i)):p.push(new qd(t,i[g],`unknown property "${g}"`))}for(let g in o)c[g]||o[g].required&&o[g].default===void 0&&i[g]===void 0&&p.push(new be(t,i,`missing required property "${g}"`));return p}function II(e){let t=e.value,i=e.valueSpec,o=e.style,c=e.styleSpec,u=e.key,h=e.arrayElementValidator||No;if(cn(t)!=="array")return[new be(u,t,`array expected, ${cn(t)} found`)];if(i.length&&t.length!==i.length)return[new be(u,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new be(u,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let p={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};c.$version<7&&(p.function=i.function),cn(i.value)==="object"&&(p=i.value);let f=[];for(let g=0;g<t.length;g++)f=f.concat(h({array:t,arrayIndex:g,value:t[g],valueSpec:p,style:o,styleSpec:c,key:`${u}[${g}]`},!0));return f}function AI(e){let t=e.key,i=e.value,o=e.valueSpec,c=cn(i);if(c==="number"&&i!=i&&(c="NaN"),c!=="number")return[new be(t,i,`number expected, ${c} found`)];if("minimum"in o){let u=o.minimum;if(cn(o.minimum)==="array"&&(u=o.minimum[e.arrayIndex]),i<u)return[new be(t,i,`${i} is less than the minimum value ${u}`)]}if("maximum"in o){let u=o.maximum;if(cn(o.maximum)==="array"&&(u=o.maximum[e.arrayIndex]),i>u)return[new be(t,i,`${i} is greater than the maximum value ${u}`)]}return[]}function kI(e){let t=e.valueSpec,i=Jr(e.value.type),o,c,u,h={},p=i!=="categorical"&&e.value.property===void 0,f=!p,g=cn(e.value.stops)==="array"&&cn(e.value.stops[0])==="array"&&cn(e.value.stops[0][0])==="object",v=la({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(x){if(i==="identity")return[new be(x.key,x.value,'identity function may not have a "stops" property')];let C=[],E=x.value;return C=C.concat(II({key:x.key,value:E,valueSpec:x.valueSpec,style:x.style,styleSpec:x.styleSpec,arrayElementValidator:y})),cn(E)==="array"&&E.length===0&&C.push(new be(x.key,E,"array must have at least one stop")),C},default:function(x){return No({key:x.key,value:x.value,valueSpec:t,style:x.style,styleSpec:x.styleSpec})}}});return i==="identity"&&p&&v.push(new be(e.key,e.value,'missing required property "property"')),i==="identity"||e.value.stops||v.push(new be(e.key,e.value,'missing required property "stops"')),i==="exponential"&&e.valueSpec.expression&&!z1(e.valueSpec)&&v.push(new be(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(f&&!Kd(e.valueSpec)?v.push(new be(e.key,e.value,"property functions not supported")):p&&!L1(e.valueSpec)&&v.push(new be(e.key,e.value,"zoom functions not supported"))),i!=="categorical"&&!g||e.value.property!==void 0||v.push(new be(e.key,e.value,'"property" property is required')),v;function y(x){let C=[],E=x.value,M=x.key;if(cn(E)!=="array")return[new be(M,E,`array expected, ${cn(E)} found`)];if(E.length!==2)return[new be(M,E,`array length 2 expected, length ${E.length} found`)];if(g){if(cn(E[0])!=="object")return[new be(M,E,`object expected, ${cn(E[0])} found`)];if(E[0].zoom===void 0)return[new be(M,E,"object stop key must have zoom")];if(E[0].value===void 0)return[new be(M,E,"object stop key must have value")];let D=Jr(E[0].zoom);if(typeof D!="number")return[new be(M,E[0].zoom,"stop zoom values must be numbers")];if(u&&u>D)return[new be(M,E[0].zoom,"stop zoom values must appear in ascending order")];D!==u&&(u=D,c=void 0,h={}),C=C.concat(la({key:`${M}[0]`,value:E[0],valueSpec:{zoom:{}},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{zoom:AI,value:b}}))}else C=C.concat(b({key:`${M}[0]`,value:E[0],valueSpec:{},style:x.style,styleSpec:x.styleSpec},E));return b_(ic(E[1]))?C.concat([new be(`${M}[1]`,E[1],"expressions are not allowed in function stops.")]):C.concat(No({key:`${M}[1]`,value:E[1],valueSpec:t,style:x.style,styleSpec:x.styleSpec}))}function b(x,C){let E=cn(x.value),M=Jr(x.value),D=x.value!==null?x.value:C;if(o){if(E!==o)return[new be(x.key,D,`${E} stop domain type must match previous stop domain type ${o}`)]}else o=E;if(E!=="number"&&E!=="string"&&E!=="boolean"&&typeof M!="number"&&typeof M!="string"&&typeof M!="boolean")return[new be(x.key,D,"stop domain value must be a number, string, or boolean")];if(E!=="number"&&i!=="categorical"){let I=`number expected, ${E} found`;return Kd(t)&&i===void 0&&(I+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new be(x.key,D,I)]}return i!=="categorical"||E!=="number"||typeof M=="number"&&isFinite(M)&&Math.floor(M)===M?i!=="categorical"&&E==="number"&&typeof M=="number"&&typeof c=="number"&&c!==void 0&&M<c?[new be(x.key,D,"stop domain values must appear in ascending order")]:(c=M,i==="categorical"&&M in h?[new be(x.key,D,"stop domain values must be unique")]:(h[M]=!0,[])):[new be(x.key,D,`integer expected, found ${String(M)}`)]}}function Qd(e){let t=(e.expressionContext==="property"?V1:Vc)(ic(e.value),e.valueSpec);if(t.result==="error")return t.value.map(o=>new be(`${e.key}${o.key}`,e.value,o.message));let i=t.value.expression||t.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!i.outputDefined())return[new be(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!yp(i))return[new be(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter")return RI(i,e);if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!oh(i,["zoom","feature-state"]))return[new be(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!rh(i))return[new be(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function RI(e,t){let i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(let c of t.valueSpec.expression.parameters)i.delete(c);if(i.size===0)return[];let o=[];return e instanceof wl&&i.has(e.name)?[new be(t.key,t.value,`["${e.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(e.eachChild(c=>{o.push(...RI(c,t))}),o)}function C_(e){let t=e.key,i=e.value,o=e.valueSpec,c=[];return Array.isArray(o.values)?o.values.indexOf(Jr(i))===-1&&c.push(new be(t,i,`expected one of [${o.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(o.values).indexOf(Jr(i))===-1&&c.push(new be(t,i,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(i)} found`)),c}function j1(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(let t of e.slice(1))if(!j1(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function S_(e,t="fill"){if(e==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};j1(e)||(e=E_(e));let i=e,o=!0;try{o=function(g){if(!lh(g))return g;let v=ic(g);return OI(v),v=PI(v),v}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}let c=gt[`filter_${t}`],u=Vc(o,c),h=null;if(u.result==="error")throw new Error(u.value.map(g=>`${g.key}: ${g.message}`).join(", "));h=(g,v,y)=>u.value.evaluate(g,v,{},y);let p=null,f=null;if(o!==i){let g=Vc(i,c);if(g.result==="error")throw new Error(g.value.map(v=>`${v.key}: ${v.message}`).join(", "));p=(v,y,b,x,C)=>g.value.evaluate(v,y,{},b,void 0,void 0,x,C),f=!rh(g.value.expression)}return{filter:h,dynamicFilter:p||void 0,needGeometry:FI(o),needFeature:!!f}}function PI(e){if(!Array.isArray(e))return e;let t=function(i){if(nU.has(i[0])){for(let o=1;o<i.length;o++)if(lh(i[o]))return!0}return i}(e);return t===!0?t:t.map(i=>PI(i))}function OI(e){let t=!1,i=[];if(e[0]==="case"){for(let o=1;o<e.length-1;o+=2)t=t||lh(e[o]),i.push(e[o+1]);i.push(e[e.length-1])}else if(e[0]==="match"){t=t||lh(e[1]);for(let o=2;o<e.length-1;o+=2)i.push(e[o+1]);i.push(e[e.length-1])}else if(e[0]==="step"){t=t||lh(e[1]);for(let o=1;o<e.length-1;o+=2)i.push(e[o+1])}t&&(e.length=0,e.push("any",...i));for(let o=1;o<e.length;o++)OI(e[o])}function lh(e){if(!Array.isArray(e))return!1;if((t=e[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let i=1;i<e.length;i++)if(lh(e[i]))return!0;return!1}let nU=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function rU(e,t){return e<t?-1:e>t?1:0}function FI(e){if(!Array.isArray(e))return!1;if(e[0]==="within"||e[0]==="distance")return!0;for(let t=1;t<e.length;t++)if(FI(e[t]))return!0;return!1}function E_(e){if(!e)return!0;let t=e[0];return e.length<=1?t!=="any":t==="=="?U1(e[1],e[2],"=="):t==="!="?M_(U1(e[1],e[2],"==")):t==="<"||t===">"||t==="<="||t===">="?U1(e[1],e[2],t):t==="any"?(i=e.slice(1),["any"].concat(i.map(E_))):t==="all"?["all"].concat(e.slice(1).map(E_)):t==="none"?["all"].concat(e.slice(1).map(E_).map(M_)):t==="in"?LI(e[1],e.slice(2)):t==="!in"?M_(LI(e[1],e.slice(2))):t==="has"?zI(e[1]):t!=="!has"||M_(zI(e[1]));var i}function U1(e,t,i){switch(e){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,e,t]}}function LI(e,t){if(t.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(i=>typeof i!=typeof t[0])?["filter-in-large",e,["literal",t.sort(rU)]]:["filter-in-small",e,["literal",t]]}}function zI(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function M_(e){return["!",e]}function H1(e){return j1(ic(e.value))?Qd(ec({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${e.layerType||"fill"}`]})):NI(e)}function NI(e){let t=e.value,i=e.key;if(cn(t)!=="array")return[new be(i,t,`array expected, ${cn(t)} found`)];let o=e.styleSpec,c,u=[];if(t.length<1)return[new be(i,t,"filter array must have at least 1 element")];switch(u=u.concat(C_({key:`${i}[0]`,value:t[0],valueSpec:o.filter_operator,style:e.style,styleSpec:e.styleSpec})),Jr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Jr(t[1])==="$type"&&u.push(new be(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&u.push(new be(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(c=cn(t[1]),c!=="string"&&u.push(new be(`${i}[1]`,t[1],`string expected, ${c} found`)));for(let h=2;h<t.length;h++)c=cn(t[h]),Jr(t[1])==="$type"?u=u.concat(C_({key:`${i}[${h}]`,value:t[h],valueSpec:o.geometry_type,style:e.style,styleSpec:e.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&u.push(new be(`${i}[${h}]`,t[h],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let h=1;h<t.length;h++)u=u.concat(NI({key:`${i}[${h}]`,value:t[h],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":c=cn(t[1]),t.length!==2?u.push(new be(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):c!=="string"&&u.push(new be(`${i}[1]`,t[1],`string expected, ${c} found`))}return u}function BI(e,t){let i=e.key,o=e.style,c=e.layer,u=e.styleSpec,h=e.value,p=e.objectKey,f=u[`${t}_${e.layerType}`];if(!f)return[];let g=p.match(/^(.*)-transition$/);if(t==="paint"&&g&&f[g[1]]&&f[g[1]].transition)return No({key:i,value:h,valueSpec:u.transition,style:o,styleSpec:u});let v=e.valueSpec||f[p];if(!v)return[new qd(i,h,`unknown property "${p}"`)];let y;if(cn(h)==="string"&&Kd(v)&&!v.tokens&&(y=/^{([^}]+)}$/.exec(h))){let x=`\`{ "type": "identity", "property": ${y?JSON.stringify(y[1]):'"_"'} }\``;return[new be(i,h,`"${p}" does not support interpolation syntax
Use an identity property function instead: ${x}.`)]}let b=[];if(e.layerType==="symbol")p!=="text-field"||!o||o.glyphs||o.imports||b.push(new be(i,h,'use of "text-field" requires a style "glyphs" property')),p==="text-font"&&y_(ic(h))&&Jr(h.type)==="identity"&&b.push(new be(i,h,'"text-font" does not support identity functions'));else if(e.layerType==="model"&&t==="paint"&&c&&c.layout&&c.layout.hasOwnProperty("model-id")&&Kd(v)&&(MI(v)||L1(v))){let x=V1(ic(h),v),C=x.value.expression||x.value._styleExpression.expression;C&&!oh(C,["measure-light"])&&(p==="model-emissive-strength"&&rh(C)&&yp(C)||b.push(new be(i,h,`${p} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return b.concat(No({key:e.key,value:h,valueSpec:v,style:o,styleSpec:u,expressionContext:"property",propertyType:t,propertyKey:p}))}function VI(e){return BI(e,"paint")}function jI(e){return BI(e,"layout")}function UI(e){let t=[],i=e.value,o=e.key,c=e.style,u=e.styleSpec;i.type||i.ref||t.push(new be(o,i,'either "type" or "ref" is required'));let h=Jr(i.type),p=Jr(i.ref);if(i.id){let f=Jr(i.id);for(let g=0;g<e.arrayIndex;g++){let v=c.layers[g];Jr(v.id)===f&&t.push(new be(o,i.id,`duplicate layer id "${i.id}", previously used at line ${v.id.__line__}`))}}if("ref"in i){let f;["type","source","source-layer","filter","layout"].forEach(g=>{g in i&&t.push(new be(o,i[g],`"${g}" is prohibited for ref layers`))}),c.layers.forEach(g=>{Jr(g.id)===p&&(f=g)}),f?f.ref?t.push(new be(o,i.ref,"ref cannot reference another ref layer")):h=Jr(f.type):typeof p=="string"&&t.push(new be(o,i.ref,`ref layer "${p}" not found`))}else if(h!=="background"&&h!=="sky"&&h!=="slot")if(i.source){let f=c.sources&&c.sources[i.source],g=f&&Jr(f.type);f?g==="vector"&&h==="raster"?t.push(new be(o,i.source,`layer "${i.id}" requires a raster source`)):g==="raster"&&h!=="raster"?t.push(new be(o,i.source,`layer "${i.id}" requires a vector source`)):g!=="vector"||i["source-layer"]?g==="raster-dem"&&h!=="hillshade"?t.push(new be(o,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):h!=="line"||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||g==="geojson"&&f.lineMetrics||t.push(new be(o,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new be(o,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new be(o,i.source,`source "${i.source}" not found`))}else t.push(new be(o,i,'missing required property "source"'));return t=t.concat(la({key:o,value:i,valueSpec:u.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>No({key:`${o}.type`,value:i.type,valueSpec:u.layer.type,style:e.style,styleSpec:e.styleSpec,object:i,objectKey:"type"}),filter:f=>H1(ec({layerType:h},f)),layout:f=>la({layer:i,key:f.key,value:f.value,valueSpec:{},style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":g=>jI(ec({layerType:h},g))}}),paint:f=>la({layer:i,key:f.key,value:f.value,valueSpec:{},style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":g=>VI(ec({layerType:h,layer:i},g))}})}})),t}function ch(e){let t=e.value,i=e.key,o=cn(t);return o!=="string"?[new be(i,t,`string expected, ${o} found`)]:[]}let HI={promoteId:function({key:e,value:t}){if(cn(t)==="string")return ch({key:e,value:t});{let i=[];for(let o in t)i.push(...ch({key:`${e}.${o}`,value:t[o]}));return i}}};function GI(e){let t=e.value,i=e.key,o=e.styleSpec,c=e.style;if(!t.type)return[new be(i,t,'"type" is required')];let u=Jr(t.type),h=[];switch(["vector","raster","raster-dem"].includes(u)&&(t.url||t.tiles||h.push(new be(i,t,'Either "url" or "tiles" is required.'))),u){case"vector":case"raster":case"raster-dem":return h=h.concat(la({key:i,value:t,valueSpec:o[`source_${u.replace("-","_")}`],style:e.style,styleSpec:o,objectElementValidators:HI})),h;case"geojson":if(h=la({key:i,value:t,valueSpec:o.source_geojson,style:c,styleSpec:o,objectElementValidators:HI}),t.cluster)for(let p in t.clusterProperties){let[f,g]=t.clusterProperties[p],v=typeof f=="string"?[f,["accumulated"],["get",p]]:f;h.push(...Qd({key:`${i}.${p}.map`,value:g,expressionContext:"cluster-map"})),h.push(...Qd({key:`${i}.${p}.reduce`,value:v,expressionContext:"cluster-reduce"}))}return h;case"video":return la({key:i,value:t,valueSpec:o.source_video,style:c,styleSpec:o});case"image":return la({key:i,value:t,valueSpec:o.source_image,style:c,styleSpec:o});case"canvas":return[new be(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return C_({key:`${i}.type`,value:t.type,valueSpec:{values:oU(o)},style:c,styleSpec:o})}}function oU(e){return e.source.reduce((t,i)=>{let o=e[i];return o.type.type==="enum"&&(t=t.concat(Object.keys(o.type.values))),t},[])}function qI(e){let t=e.value,i=[];if(!t)return i;let o=cn(t);return o!=="string"?(i=i.concat([new be(e.key,t,`string expected, "${o}" found`)]),i):(function(c){let u=c.indexOf("://")===-1;try{return new URL(c,u?"http://example.com":void 0),!0}catch{return!1}}(t)||(i=i.concat([new be(e.key,t,`invalid url "${t}"`)])),i)}function WI(e){let t=e.value,i=e.styleSpec,o=i.light,c=e.style,u=[],h=cn(t);if(t===void 0)return u;if(h!=="object")return u=u.concat([new be("light",t,`object expected, ${h} found`)]),u;for(let p in t){let f=p.match(/^(.*)-transition$/);u=u.concat(f&&o[f[1]]&&o[f[1]].transition?No({key:p,value:t[p],valueSpec:i.transition,style:c,styleSpec:i}):o[p]?No({key:p,value:t[p],valueSpec:o[p],style:c,styleSpec:i}):[new be(p,t[p],`unknown property "${p}"`)])}return u}function $I(e){let t=e.value,i=[];if(!t)return i;let o=cn(t);if(o!=="object")return i=i.concat([new be("light-3d",t,`object expected, ${o} found`)]),i;let c=e.styleSpec,u=c["light-3d"],h=e.key,p=e.style,f=e.style.lights;for(let y of["type","id"])if(!(y in t))return i=i.concat([new be("light-3d",t,`missing property ${y} on light`)]),i;if(t.type&&f)for(let y=0;y<e.arrayIndex;y++){let b=Jr(t.type),x=f[y];Jr(x.type)===b&&i.push(new be(h,t.id,`duplicate light type "${t.type}", previously defined at line ${x.id.__line__}`))}let g=`properties_light_${t.type}`;if(!(g in c))return i=i.concat([new be("light-3d",t,`Invalid light type ${t.type}`)]),i;let v=c[g];for(let y in t)if(y==="properties"){let b=t[y],x=cn(b);if(x!=="object")return i=i.concat([new be("properties",b,`object expected, ${x} found`)]),i;for(let C in b)i=i.concat(v[C]?No({key:C,value:b[C],valueSpec:v[C],style:p,styleSpec:c}):[new qd(e.key,b[C],`unknown property "${C}"`)])}else{let b=y.match(/^(.*)-transition$/);i=i.concat(b&&u[b[1]]&&u[b[1]].transition?No({key:y,value:t[y],valueSpec:c.transition,style:p,styleSpec:c}):u[y]?No({key:y,value:t[y],valueSpec:u[y],style:p,styleSpec:c}):[new qd(y,t[y],`unknown property "${y}"`)])}return i}function YI(e){let t=e.value,i=e.key,o=e.style,c=e.styleSpec,u=c.terrain,h=[],p=cn(t);if(t===void 0||p==="null")return h;if(p!=="object")return h=h.concat([new be("terrain",t,`object expected, ${p} found`)]),h;for(let f in t){let g=f.match(/^(.*)-transition$/);h=h.concat(g&&u[g[1]]&&u[g[1]].transition?No({key:f,value:t[f],valueSpec:c.transition,style:o,styleSpec:c}):u[f]?No({key:f,value:t[f],valueSpec:u[f],style:o,styleSpec:c}):[new qd(f,t[f],`unknown property "${f}"`)])}if(t.source){let f=o.sources&&o.sources[t.source],g=f&&Jr(f.type);f?g!=="raster-dem"&&h.push(new be(i,t.source,`terrain cannot be used with a source of type ${String(g)}, it only be used with a "raster-dem" source type`)):h.push(new be(i,t.source,`source "${t.source}" not found`))}else h.push(new be(i,t,'terrain is missing required property "source"'));return h}function ZI(e){let t=e.value,i=e.style,o=e.styleSpec,c=o.fog,u=[],h=cn(t);if(t===void 0)return u;if(h!=="object")return u=u.concat([new be("fog",t,`object expected, ${h} found`)]),u;for(let p in t){let f=p.match(/^(.*)-transition$/);u=u.concat(f&&c[f[1]]&&c[f[1]].transition?No({key:p,value:t[p],valueSpec:o.transition,style:i,styleSpec:o}):c[p]?No({key:p,value:t[p],valueSpec:c[p],style:i,styleSpec:o}):[new qd(p,t[p],`unknown property "${p}"`)])}return u}let XI={"*":()=>[],array:II,boolean:function(e){let t=e.value,i=e.key,o=cn(t);return o!=="boolean"?[new be(i,t,`boolean expected, ${o} found`)]:[]},number:AI,color:function(e){let t=e.key,i=e.value,o=cn(i);return o!=="string"?[new be(t,i,`color expected, ${o} found`)]:Yx(i)===null?[new be(t,i,`color expected, "${i}" found`)]:[]},enum:C_,filter:H1,function:kI,layer:UI,object:la,source:GI,model:qI,light:WI,"light-3d":$I,terrain:YI,fog:ZI,string:ch,formatted:function(e){return ch(e).length===0?[]:Qd(e)},resolvedImage:function(e){return ch(e).length===0?[]:Qd(e)},projection:function(e){let t=e.value,i=e.styleSpec,o=i.projection,c=e.style,u=[],h=cn(t);if(h==="object")for(let p in t)u=u.concat(No({key:p,value:t[p],valueSpec:o[p],style:c,styleSpec:i}));else h!=="string"&&(u=u.concat([new be("projection",t,`object or string expected, ${h} found`)]));return u},import:function(e){let{value:t,styleSpec:i}=e,h=t,{data:o}=h,c=CS(h,["data"]);Object.defineProperty(c,"__line__",{value:t.__line__,enumerable:!1});let u=la(ec({},e,{value:c,valueSpec:i.import}));return Jr(c.id)===""&&u.push(new be(`${e.key}.id`,c,"import id can't be an empty string")),o&&(u=u.concat(KI(o,i,{key:`${e.key}.data`}))),u}};function No(e,t=!1){let i=e.value,o=e.valueSpec,c=e.styleSpec;if(o.expression&&y_(Jr(i)))return kI(e);if(o.expression&&b_(ic(i)))return Qd(e);if(o.type&&XI[o.type]){let u=XI[o.type](e);return t===!0&&u.length>0&&cn(e.value)==="array"?Qd(e):u}return la(ec({},e,{valueSpec:o.type?c[o.type]:o}))}function sU(e){let t=e.value,i=e.key,o=ch(e);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new be(i,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new be(i,t,'"glyphs" url must include a "{range}" token'))),o}function KI(e,t=gt,i={}){return No({key:i.key||"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:sU,"*":()=>[]}})}function dh(e,t=gt){return $a(KI(e,t))}let aU=e=>$a(GI(e)),lU=e=>$a(WI(e)),cU=e=>$a($I(e)),dU=e=>$a(YI(e)),uU=e=>$a(ZI(e)),hU=e=>$a(UI(e)),G1=e=>$a(H1(e)),mU=e=>$a(VI(e)),pU=e=>$a(jI(e)),fU=e=>$a(qI(e));function $a(e){return e.slice().sort((t,i)=>t.line&&i.line?t.line-i.line:0)}function D_(e,t){let i=!1;if(t&&t.length)for(let o of t)o instanceof qd?lt(o.message):(e.fire(new Xe(new Error(o.message))),i=!0);return i}var gU=Sl,Uc=3;function Sl(e,t,i){var o=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var c=new Int32Array(this.arrayBuffer);e=c[0],this.d=(t=c[1])+2*(i=c[2]);for(var u=0;u<this.d*this.d;u++){var h=c[Uc+u],p=c[Uc+u+1];o.push(h===p?null:c.subarray(h,p))}var f=c[Uc+o.length+1];this.keys=c.subarray(c[Uc+o.length],f),this.bboxes=c.subarray(f),this.insert=this._insertReadonly}else{this.d=t+2*i;for(var g=0;g<this.d*this.d;g++)o.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=i,this.scale=t/e,this.uid=0;var v=i/t*e;this.min=-v,this.max=e+v}Sl.prototype.insert=function(e,t,i,o,c){this._forEachCell(t,i,o,c,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(c)},Sl.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Sl.prototype._insertCell=function(e,t,i,o,c,u){this.cells[c].push(u)},Sl.prototype.query=function(e,t,i,o,c){var u=this.min,h=this.max;if(e<=u&&t<=u&&h<=i&&h<=o&&!c)return Array.prototype.slice.call(this.keys);var p=[];return this._forEachCell(e,t,i,o,this._queryCell,p,{},c),p},Sl.prototype._queryCell=function(e,t,i,o,c,u,h,p){var f=this.cells[c];if(f!==null)for(var g=this.keys,v=this.bboxes,y=0;y<f.length;y++){var b=f[y];if(h[b]===void 0){var x=4*b;(p?p(v[x+0],v[x+1],v[x+2],v[x+3]):e<=v[x+2]&&t<=v[x+3]&&i>=v[x+0]&&o>=v[x+1])?(h[b]=!0,u.push(g[b])):h[b]=!1}}},Sl.prototype._forEachCell=function(e,t,i,o,c,u,h,p){for(var f=this._convertToCellCoord(e),g=this._convertToCellCoord(t),v=this._convertToCellCoord(i),y=this._convertToCellCoord(o),b=f;b<=v;b++)for(var x=g;x<=y;x++){var C=this.d*x+b;if((!p||p(this._convertFromCellCoord(b),this._convertFromCellCoord(x),this._convertFromCellCoord(b+1),this._convertFromCellCoord(x+1)))&&c.call(this,e,t,i,o,C,u,h,p))return}},Sl.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},Sl.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},Sl.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=Uc+this.cells.length+1+1,i=0,o=0;o<this.cells.length;o++)i+=this.cells[o].length;var c=new Int32Array(t+i+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var u=t,h=0;h<e.length;h++){var p=e[h];c[Uc+h]=u,c.set(p,u),u+=p.length}return c[Uc+e.length]=u,c.set(this.keys,u),c[Uc+e.length+1]=u+=this.keys.length,c.set(this.bboxes,u),u+=this.bboxes.length,c.buffer};var uh=ut(gU);let T_={};function xe(e,t,i={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),T_[t]={klass:e,omit:i.omit||[]}}xe(Object,"Object"),uh.serialize=function(e,t){let i=e.toArrayBuffer();return t&&t.add(i),{buffer:i}},uh.deserialize=function(e){return new uh(e.buffer)},Object.defineProperty(uh,"name",{value:"Grid"}),xe(uh,"Grid"),xe(fi,"Color"),xe(Error,"Error"),xe(Ot,"AJAXError"),xe(aa,"ResolvedImage"),xe(x_,"StylePropertyFunction"),xe(N1,"StyleExpression",{omit:["_evaluator"]}),xe(jc,"ZoomDependentExpression"),xe(B1,"ZoomConstantExpression"),xe(wl,"CompoundExpression",{omit:["_evaluate"]});for(let e in wp)T_[wp[e]._classRegistryKey]||xe(wp[e],`Expression${e}`);function QI(e){return e&&typeof ArrayBuffer<"u"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function JI(e){return m.ImageBitmap&&e instanceof m.ImageBitmap}function hh(e,t){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(QI(e)||JI(e))return t&&t.add(e),e;if(ArrayBuffer.isView(e)){let i=e;return t&&t.add(i.buffer),i}if(e instanceof m.ImageData)return t&&t.add(e.data.buffer),e;if(Array.isArray(e)){let i=[];for(let o of e)i.push(hh(o,t));return i}if(e instanceof Map){let i={$name:"Map"};for(let[o,c]of e.entries())i[o]=hh(c);return i}if(typeof e=="object"){let i=e.constructor,o=i._classRegistryKey;if(!o)throw new Error(`can't serialize object of unregistered class ${o}`);let c=i.serialize?i.serialize(e,t):{};if(!i.serialize){for(let u in e)e.hasOwnProperty(u)&&(T_[o].omit.indexOf(u)>=0||(c[u]=hh(e[u],t)));e instanceof Error&&(c.message=e.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(c.$name=o),c}throw new Error("can't serialize object of type "+typeof e)}function mh(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||QI(e)||JI(e)||ArrayBuffer.isView(e)||e instanceof m.ImageData)return e;if(Array.isArray(e))return e.map(mh);if(typeof e=="object"){let t=e.$name||"Object";if(t==="Map"){let c=new Map;for(let u of Object.keys(e))u!=="$name"&&c.set(u,mh(e[u]));return c}let{klass:i}=T_[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(e);let o=Object.create(i.prototype);for(let c of Object.keys(e))c!=="$name"&&(o[c]=mh(e[c]));return o}throw new Error("can't deserialize object of type "+typeof e)}let Te={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519,"CJK Unified Ideographs Extension B":e=>e>=131072&&e<=173791};function q1(e){for(let t of e)if(W1(t.charCodeAt(0)))return!0;return!1}function _U(e){for(let t of e)if(!vU(t.charCodeAt(0)))return!1;return!0}function vU(e){return!(Te.Arabic(e)||Te["Arabic Supplement"](e)||Te["Arabic Extended-A"](e)||Te["Arabic Presentation Forms-A"](e)||Te["Arabic Presentation Forms-B"](e))}function W1(e){return!(e!==746&&e!==747&&(e<4352||!(Te["Bopomofo Extended"](e)||Te.Bopomofo(e)||Te["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||Te["CJK Compatibility Ideographs"](e)||Te["CJK Compatibility"](e)||Te["CJK Radicals Supplement"](e)||Te["CJK Strokes"](e)||!(!Te["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||Te["CJK Unified Ideographs Extension A"](e)||Te["CJK Unified Ideographs"](e)||Te["Enclosed CJK Letters and Months"](e)||Te["Hangul Compatibility Jamo"](e)||Te["Hangul Jamo Extended-A"](e)||Te["Hangul Jamo Extended-B"](e)||Te["Hangul Jamo"](e)||Te["Hangul Syllables"](e)||Te.Hiragana(e)||Te["Ideographic Description Characters"](e)||Te.Kanbun(e)||Te["Kangxi Radicals"](e)||Te["Katakana Phonetic Extensions"](e)||Te.Katakana(e)&&e!==12540||!(!Te["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!Te["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||Te["Unified Canadian Aboriginal Syllabics"](e)||Te["Unified Canadian Aboriginal Syllabics Extended"](e)||Te["Vertical Forms"](e)||Te["Yijing Hexagram Symbols"](e)||Te["Yi Syllables"](e)||Te["Yi Radicals"](e))))}function t2(e){return!(W1(e)||function(t){return!!(Te["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Te["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Te["Letterlike Symbols"](t)||Te["Number Forms"](t)||Te["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Te["Control Pictures"](t)&&t!==9251||Te["Optical Character Recognition"](t)||Te["Enclosed Alphanumerics"](t)||Te["Geometric Shapes"](t)||Te["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Te["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Te["CJK Symbols and Punctuation"](t)||Te.Katakana(t)||Te["Private Use Area"](t)||Te["CJK Compatibility Forms"](t)||Te["Small Form Variants"](t)||Te["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(e))}function e2(e){return e>=1424&&e<=2303||Te["Arabic Presentation Forms-A"](e)||Te["Arabic Presentation Forms-B"](e)}function yU(e,t){return!(!t&&e2(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||Te.Khmer(e))}function bU(e){for(let t of e)if(e2(t.charCodeAt(0)))return!0;return!1}let $1="deferred",Y1="loading",Z1="loaded",X1=null,bs="unavailable",Hc=null,i2=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(bs="error"),X1&&X1(e)};function K1(){Q1.fire(new qt("pluginStateChange",{pluginStatus:bs,pluginURL:Hc}))}let Q1=new Hr,J1=function(){return bs},n2=function(){if(bs!==$1||!Hc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");bs=Y1,K1(),Hc&&ie({url:Hc},e=>{e?i2(e):(bs=Z1,K1())})},ca={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>bs===Z1||ca.applyArabicShaping!=null,isLoading:()=>bs===Y1,setState(e){bs=e.pluginStatus,Hc=e.pluginURL},isParsed:()=>ca.applyArabicShaping!=null&&ca.processBidirectionalText!=null&&ca.processStyledBidirectionalText!=null,getPluginURL:()=>Hc};class Jn{constructor(t,i){this.zoom=t,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(i,o){for(let c of i)if(!yU(c.charCodeAt(0),o))return!1;return!0}(t,ca.isLoaded())}}class I_{constructor(t,i,o){this.property=t,this.value=i,this.expression=function(c,u,h){if(y_(c))return new x_(c,u);if(b_(c)||Array.isArray(c)&&c.length>0){let p=V1(c,u,h);if(p.result==="error")throw new Error(p.value.map(f=>`${f.key}: ${f.message}`).join(", "));return p.value}{let p=c;return typeof c=="string"&&u.type==="color"&&(p=fi.parse(c)),{kind:"constant",isConfigDependent:!1,evaluate:()=>p}}}(i===void 0?t.specification.default:i,t.specification,o)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,i,o){return this.property.possiblyEvaluate(this,t,i,o)}}class tw{constructor(t,i){this.property=t,this.value=new I_(t,void 0,i)}transitioned(t,i){return new r2(this.property,this.value,i,ge({},t.transition,this.transition),t.now)}untransitioned(){return new r2(this.property,this.value,null,{},0)}}class Sp{constructor(t,i){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._options=i,this.isConfigDependent=!1}getValue(t){return K(this._values[t].value.value)}setValue(t,i){this._values.hasOwnProperty(t)||(this._values[t]=new tw(this._values[t].property,this._options)),this._values[t].value=new I_(this._values[t].property,i===null?void 0:K(i),this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].value.expression.isConfigDependent}setTransitionOrValue(t,i){i&&(this._options=i);let o=this._properties.properties;if(t)for(let c in t){let u=t[c];if($u(c,"-transition")){let h=c.slice(0,-11);o[h]&&this.setTransition(h,u)}else o[c]&&this.setValue(c,u)}}getTransition(t){return K(this._values[t].transition)}setTransition(t,i){this._values.hasOwnProperty(t)||(this._values[t]=new tw(this._values[t].property)),this._values[t].transition=K(i)||void 0}serialize(){let t={};for(let i of Object.keys(this._values)){let o=this.getValue(i);o!==void 0&&(t[i]=o);let c=this.getTransition(i);c!==void 0&&(t[`${i}-transition`]=c)}return t}transitioned(t,i){let o=new o2(this._properties);for(let c of Object.keys(this._values))o._values[c]=this._values[c].transitioned(t,i._values[c]);return o}untransitioned(){let t=new o2(this._properties);for(let i of Object.keys(this._values))t._values[i]=this._values[i].untransitioned();return t}}class r2{constructor(t,i,o,c,u){let h=c.delay||0,p=c.duration||0;u=u||0,this.property=t,this.value=i,this.begin=u+h,this.end=this.begin+p,t.specification.transition&&(c.delay||c.duration)&&(this.prior=o)}possiblyEvaluate(t,i,o){let c=t.now||0,u=this.value.possiblyEvaluate(t,i,o),h=this.prior;if(h){if(c>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(c<this.begin)return h.possiblyEvaluate(t,i,o);{let p=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(h.possiblyEvaluate(t,i,o),u,Cr(p))}}return u}}class o2{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,i,o){let c=new Ep(this._properties);for(let u of Object.keys(this._values))c._values[u]=this._values[u].possiblyEvaluate(t,i,o);return c}hasTransition(){for(let t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class xU{constructor(t,i){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._options=i,this.isConfigDependent=!1}getValue(t){return K(this._values[t].value)}setValue(t,i){this._values[t]=new I_(this._values[t].property,i===null?void 0:K(i),this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].expression.isConfigDependent}serialize(){let t={};for(let i of Object.keys(this._values)){let o=this.getValue(i);o!==void 0&&(t[i]=o)}return t}possiblyEvaluate(t,i,o){let c=new Ep(this._properties);for(let u of Object.keys(this._values))c._values[u]=this._values[u].possiblyEvaluate(t,i,o);return c}}class ph{constructor(t,i,o){this.property=t,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,i,o,c){return this.property.evaluate(this.value,this.parameters,t,i,o,c)}}class Ep{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Ut{constructor(t){this.specification=t}possiblyEvaluate(t,i){return t.expression.evaluate(i)}interpolate(t,i,o){let c=f_[this.specification.type];return c?c(t,i,o):t}}class Re{constructor(t,i){this.specification=t,this.overrides=i}possiblyEvaluate(t,i,o,c){return new ph(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(i,null,{},o,c)}:t.expression,i)}interpolate(t,i,o){if(t.value.kind!=="constant"||i.value.kind!=="constant")return t;if(t.value.value===void 0||i.value.value===void 0)return new ph(this,{kind:"constant",value:void 0},t.parameters);let c=f_[this.specification.type];return c?new ph(this,{kind:"constant",value:c(t.value.value,i.value.value,o)},t.parameters):t}evaluate(t,i,o,c,u,h){return t.kind==="constant"?t.value:t.evaluate(i,o,c,u,h)}}class Mp{constructor(t){this.specification=t}possiblyEvaluate(t,i,o,c){return!!t.expression.evaluate(i,null,{},o,c)}interpolate(){return!1}}class yr{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let i=new Jn(0,{});for(let o in t){let c=t[o];c.specification.overridable&&this.overridableProperties.push(o);let u=this.defaultPropertyValues[o]=new I_(c,void 0),h=this.defaultTransitionablePropertyValues[o]=new tw(c);this.defaultTransitioningPropertyValues[o]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=u.possiblyEvaluate(i)}}}xe(Re,"DataDrivenProperty"),xe(Ut,"DataConstantProperty"),xe(Mp,"ColorRampProperty");let A_="";function s2(e){return e.indexOf(A_)>=0}function Yo(e,t){return t?`${e}${A_}${t}`:e}function k_(e){let t=e.indexOf(A_);return t>=0?e.slice(0,t):e}let a2="-transition";class Hs extends Hr{constructor(t,i,o){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&t.type!=="sky"&&t.type!=="slot"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),this.options=o,t.slot&&(this.slot=t.slot),i.layout&&(this._unevaluatedLayout=new xU(i.layout,o),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),i.paint)){this._transitionablePaint=new Sp(i.paint,o);for(let c in t.paint)this.setPaintProperty(c,t.paint[c],{validate:!1});for(let c in t.layout)this.setLayoutProperty(c,t.layout[c],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ep(i.paint)}}setScope(t){this.scope=t,this.fqid=Yo(this.id,t)}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,i,o={}){if(i!=null&&this._validate(pU,`layers.${this.id}.layout.${t}`,t,i,o))return;if(this.type==="custom"&&t==="visibility")return void(this.visibility=i);let c=this._unevaluatedLayout;c._properties.properties[t]&&(c.setValue(t,i),this.isConfigDependent=this.isConfigDependent||c.isConfigDependent,t==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(t){return $u(t,a2)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,i,o={}){if(i!=null&&this._validate(mU,`layers.${this.id}.paint.${t}`,t,i,o))return!1;let c=this._transitionablePaint,u=c._properties.properties;if($u(t,a2)){let b=t.slice(0,-11);return u[b]&&c.setTransition(b,i||void 0),!1}if(!u[t])return!1;let h=c._values[t],p=h.value.isDataDriven(),f=h.value;c.setValue(t,i),this.isConfigDependent=this.isConfigDependent||c.isConfigDependent,this._handleSpecialPaintPropertyUpdate(t);let g=c._values[t].value,v=g.isDataDriven(),y=$u(t,"pattern")||t==="line-dasharray";return v||p||y||this._handleOverridablePaintPropertyUpdate(t,f,g)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,i){return null}_handleOverridablePaintPropertyUpdate(t,i,o){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,i)}serialize(){return Yt({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(t,i)=>!(t===void 0||i==="layout"&&!Object.keys(t).length||i==="paint"&&!Object.keys(t).length))}_validate(t,i,o,c,u={}){return(!u||u.validate!==!1)&&D_(this,t.call(dh,{key:i,layerType:this.type,objectKey:o,value:c,styleSpec:gt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(let t in this.paint._values){let i=this.paint.get(t);if(i instanceof ph&&Kd(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=S_(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(){this._stats&&(this._stats.numRenderedVerticesInShadowPass=0,this._stats.numRenderedVerticesInTransparentPass=0)}}class wU{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,i){this._updatedSourceCaches[t]=i,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){let i=t.scope;this._updatedLayers[i]=this._updatedLayers[i]||new Set,this._updatedLayers[i].add(t.id),this.setDirty()}removeLayer(t){let i=t.scope;this._removedLayers[i]=this._removedLayers[i]||{},this._updatedLayers[i]=this._updatedLayers[i]||new Set,this._removedLayers[i][t.id]=t,this._updatedLayers[i].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){let t={};for(let i in this._updatedLayers)t[i]=t[i]||{},t[i].updatedIds=Array.from(this._updatedLayers[i].values());for(let i in this._removedLayers)t[i]=t[i]||{},t[i].removedIds=Object.keys(this._removedLayers[i]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(t),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}let CU={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class R_{constructor(t,i){this._structArray=t,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class tr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,i){return t._trim(),i&&(t.isTransferred=!0,i.add(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){let i=Object.create(this.prototype);return i.arrayBuffer=t.arrayBuffer,i.length=t.length,i.capacity=t.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Qi(e,t=1){let i=0,o=0;return{members:e.map(c=>{let u=CU[c.type].BYTES_PER_ELEMENT,h=i=l2(i,Math.max(t,u)),p=c.components||1;return o=Math.max(o,u),i+=u*p,{name:c.name,type:c.type,components:p,offset:h}}),size:l2(i,Math.max(o,t)),alignment:t}}function l2(e,t){return Math.ceil(e/t)*t}class xs extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i){let o=this.length;return this.resize(o+1),this.emplace(o,t,i)}emplace(t,i,o){let c=2*t;return this.int16[c+0]=i,this.int16[c+1]=o,t}}xs.prototype.bytesPerElement=4,xe(xs,"StructArrayLayout2i4");class P_ extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o){let c=this.length;return this.resize(c+1),this.emplace(c,t,i,o)}emplace(t,i,o,c){let u=3*t;return this.int16[u+0]=i,this.int16[u+1]=o,this.int16[u+2]=c,t}}P_.prototype.bytesPerElement=6,xe(P_,"StructArrayLayout3i6");class Jd extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o,c){let u=this.length;return this.resize(u+1),this.emplace(u,t,i,o,c)}emplace(t,i,o,c,u){let h=4*t;return this.int16[h+0]=i,this.int16[h+1]=o,this.int16[h+2]=c,this.int16[h+3]=u,t}}Jd.prototype.bytesPerElement=8,xe(Jd,"StructArrayLayout4i8");class ew extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u){let h=this.length;return this.resize(h+1),this.emplace(h,t,i,o,c,u)}emplace(t,i,o,c,u,h){let p=5*t;return this.int16[p+0]=i,this.int16[p+1]=o,this.int16[p+2]=c,this.int16[p+3]=u,this.int16[p+4]=h,t}}ew.prototype.bytesPerElement=10,xe(ew,"StructArrayLayout5i10");class iw extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u,h,p){let f=this.length;return this.resize(f+1),this.emplace(f,t,i,o,c,u,h,p)}emplace(t,i,o,c,u,h,p,f){let g=6*t,v=12*t,y=3*t;return this.int16[g+0]=i,this.int16[g+1]=o,this.uint8[v+4]=c,this.uint8[v+5]=u,this.uint8[v+6]=h,this.uint8[v+7]=p,this.float32[y+2]=f,t}}iw.prototype.bytesPerElement=12,xe(iw,"StructArrayLayout2i4ub1f12");class oc extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o,c){let u=this.length;return this.resize(u+1),this.emplace(u,t,i,o,c)}emplace(t,i,o,c,u){let h=4*t;return this.float32[h+0]=i,this.float32[h+1]=o,this.float32[h+2]=c,this.float32[h+3]=u,t}}oc.prototype.bytesPerElement=16,xe(oc,"StructArrayLayout4f16");class Gc extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u){let h=this.length;return this.resize(h+1),this.emplace(h,t,i,o,c,u)}emplace(t,i,o,c,u,h){let p=6*t,f=3*t;return this.uint16[p+0]=i,this.uint16[p+1]=o,this.uint16[p+2]=c,this.uint16[p+3]=u,this.float32[f+2]=h,t}}Gc.prototype.bytesPerElement=12,xe(Gc,"StructArrayLayout4ui1f12");class O_ extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,o,c){let u=this.length;return this.resize(u+1),this.emplace(u,t,i,o,c)}emplace(t,i,o,c,u){let h=4*t;return this.uint16[h+0]=i,this.uint16[h+1]=o,this.uint16[h+2]=c,this.uint16[h+3]=u,t}}O_.prototype.bytesPerElement=8,xe(O_,"StructArrayLayout4ui8");class F_ extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u,h){let p=this.length;return this.resize(p+1),this.emplace(p,t,i,o,c,u,h)}emplace(t,i,o,c,u,h,p){let f=6*t;return this.int16[f+0]=i,this.int16[f+1]=o,this.int16[f+2]=c,this.int16[f+3]=u,this.int16[f+4]=h,this.int16[f+5]=p,t}}F_.prototype.bytesPerElement=12,xe(F_,"StructArrayLayout6i12");class nw extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u,h,p,f,g,v,y,b){let x=this.length;return this.resize(x+1),this.emplace(x,t,i,o,c,u,h,p,f,g,v,y,b)}emplace(t,i,o,c,u,h,p,f,g,v,y,b,x){let C=12*t;return this.int16[C+0]=i,this.int16[C+1]=o,this.int16[C+2]=c,this.int16[C+3]=u,this.uint16[C+4]=h,this.uint16[C+5]=p,this.uint16[C+6]=f,this.uint16[C+7]=g,this.int16[C+8]=v,this.int16[C+9]=y,this.int16[C+10]=b,this.int16[C+11]=x,t}}nw.prototype.bytesPerElement=24,xe(nw,"StructArrayLayout4i4ui4i24");class rw extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u,h){let p=this.length;return this.resize(p+1),this.emplace(p,t,i,o,c,u,h)}emplace(t,i,o,c,u,h,p){let f=10*t,g=5*t;return this.int16[f+0]=i,this.int16[f+1]=o,this.int16[f+2]=c,this.float32[g+2]=u,this.float32[g+3]=h,this.float32[g+4]=p,t}}rw.prototype.bytesPerElement=20,xe(rw,"StructArrayLayout3i3f20");class ow extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){let i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint32[1*t+0]=i,t}}ow.prototype.bytesPerElement=4,xe(ow,"StructArrayLayout1ul4");class qc extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i){let o=this.length;return this.resize(o+1),this.emplace(o,t,i)}emplace(t,i,o){let c=2*t;return this.uint16[c+0]=i,this.uint16[c+1]=o,t}}qc.prototype.bytesPerElement=4,xe(qc,"StructArrayLayout2ui4");class sw extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u,h,p,f,g,v,y,b,x){let C=this.length;return this.resize(C+1),this.emplace(C,t,i,o,c,u,h,p,f,g,v,y,b,x)}emplace(t,i,o,c,u,h,p,f,g,v,y,b,x,C){let E=20*t,M=10*t;return this.int16[E+0]=i,this.int16[E+1]=o,this.int16[E+2]=c,this.int16[E+3]=u,this.int16[E+4]=h,this.float32[M+3]=p,this.float32[M+4]=f,this.float32[M+5]=g,this.float32[M+6]=v,this.int16[E+14]=y,this.uint32[M+8]=b,this.uint16[E+18]=x,this.uint16[E+19]=C,t}}sw.prototype.bytesPerElement=40,xe(sw,"StructArrayLayout5i4f1i1ul2ui40");class L_ extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u,h,p){let f=this.length;return this.resize(f+1),this.emplace(f,t,i,o,c,u,h,p)}emplace(t,i,o,c,u,h,p,f){let g=8*t;return this.int16[g+0]=i,this.int16[g+1]=o,this.int16[g+2]=c,this.int16[g+4]=u,this.int16[g+5]=h,this.int16[g+6]=p,this.int16[g+7]=f,t}}L_.prototype.bytesPerElement=16,xe(L_,"StructArrayLayout3i2i2i16");class aw extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u){let h=this.length;return this.resize(h+1),this.emplace(h,t,i,o,c,u)}emplace(t,i,o,c,u,h){let p=4*t,f=8*t;return this.float32[p+0]=i,this.float32[p+1]=o,this.float32[p+2]=c,this.int16[f+6]=u,this.int16[f+7]=h,t}}aw.prototype.bytesPerElement=16,xe(aw,"StructArrayLayout2f1f2i16");class lw extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o,c){let u=this.length;return this.resize(u+1),this.emplace(u,t,i,o,c)}emplace(t,i,o,c,u){let h=12*t,p=3*t;return this.uint8[h+0]=i,this.uint8[h+1]=o,this.float32[p+1]=c,this.float32[p+2]=u,t}}lw.prototype.bytesPerElement=12,xe(lw,"StructArrayLayout2ub2f12");class qr extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,o){let c=this.length;return this.resize(c+1),this.emplace(c,t,i,o)}emplace(t,i,o,c){let u=3*t;return this.uint16[u+0]=i,this.uint16[u+1]=o,this.uint16[u+2]=c,t}}qr.prototype.bytesPerElement=6,xe(qr,"StructArrayLayout3ui6");class cw extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M,D,I,P,O,R){let F=this.length;return this.resize(F+1),this.emplace(F,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M,D,I,P,O,R)}emplace(t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M,D,I,P,O,R,F){let z=30*t,j=15*t,U=60*t;return this.int16[z+0]=i,this.int16[z+1]=o,this.int16[z+2]=c,this.float32[j+2]=u,this.float32[j+3]=h,this.uint16[z+8]=p,this.uint16[z+9]=f,this.uint32[j+5]=g,this.uint32[j+6]=v,this.uint32[j+7]=y,this.uint16[z+16]=b,this.uint16[z+17]=x,this.uint16[z+18]=C,this.float32[j+10]=E,this.float32[j+11]=M,this.uint8[U+48]=D,this.uint8[U+49]=I,this.uint8[U+50]=P,this.uint32[j+13]=O,this.int16[z+28]=R,this.uint8[U+58]=F,t}}cw.prototype.bytesPerElement=60,xe(cw,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class dw extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M,D,I,P,O,R,F,z,j,U,G,$,Y,tt,W,rt,st){let pt=this.length;return this.resize(pt+1),this.emplace(pt,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M,D,I,P,O,R,F,z,j,U,G,$,Y,tt,W,rt,st)}emplace(t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M,D,I,P,O,R,F,z,j,U,G,$,Y,tt,W,rt,st,pt){let nt=20*t,ot=40*t,_t=80*t;return this.float32[nt+0]=i,this.float32[nt+1]=o,this.int16[ot+4]=c,this.int16[ot+5]=u,this.int16[ot+6]=h,this.int16[ot+7]=p,this.int16[ot+8]=f,this.int16[ot+9]=g,this.int16[ot+10]=v,this.int16[ot+11]=y,this.int16[ot+12]=b,this.uint16[ot+13]=x,this.uint16[ot+14]=C,this.uint16[ot+15]=E,this.uint16[ot+16]=M,this.uint16[ot+17]=D,this.uint16[ot+18]=I,this.uint16[ot+19]=P,this.uint16[ot+20]=O,this.uint16[ot+21]=R,this.uint16[ot+22]=F,this.uint16[ot+23]=z,this.uint16[ot+24]=j,this.uint16[ot+25]=U,this.uint16[ot+26]=G,this.uint16[ot+27]=$,this.uint32[nt+14]=Y,this.float32[nt+15]=tt,this.float32[nt+16]=W,this.float32[nt+17]=rt,this.float32[nt+18]=st,this.uint8[_t+76]=pt,t}}dw.prototype.bytesPerElement=80,xe(dw,"StructArrayLayout2f9i15ui1ul4f1ub80");class Dp extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){let i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.float32[1*t+0]=i,t}}Dp.prototype.bytesPerElement=4,xe(Dp,"StructArrayLayout1f4");class tu extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u){let h=this.length;return this.resize(h+1),this.emplace(h,t,i,o,c,u)}emplace(t,i,o,c,u,h){let p=5*t;return this.float32[p+0]=i,this.float32[p+1]=o,this.float32[p+2]=c,this.float32[p+3]=u,this.float32[p+4]=h,t}}tu.prototype.bytesPerElement=20,xe(tu,"StructArrayLayout5f20");class uw extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u,h,p){let f=this.length;return this.resize(f+1),this.emplace(f,t,i,o,c,u,h,p)}emplace(t,i,o,c,u,h,p,f){let g=7*t;return this.float32[g+0]=i,this.float32[g+1]=o,this.float32[g+2]=c,this.float32[g+3]=u,this.float32[g+4]=h,this.float32[g+5]=p,this.float32[g+6]=f,t}}uw.prototype.bytesPerElement=28,xe(uw,"StructArrayLayout7f28");class hw extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,o,c){let u=this.length;return this.resize(u+1),this.emplace(u,t,i,o,c)}emplace(t,i,o,c,u){let h=6*t;return this.uint32[3*t+0]=i,this.uint16[h+2]=o,this.uint16[h+3]=c,this.uint16[h+4]=u,t}}hw.prototype.bytesPerElement=12,xe(hw,"StructArrayLayout1ul3ui12");class Tp extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){let i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint16[1*t+0]=i,t}}Tp.prototype.bytesPerElement=2,xe(Tp,"StructArrayLayout1ui2");class eu extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o){let c=this.length;return this.resize(c+1),this.emplace(c,t,i,o)}emplace(t,i,o,c){let u=3*t;return this.float32[u+0]=i,this.float32[u+1]=o,this.float32[u+2]=c,t}}eu.prototype.bytesPerElement=12,xe(eu,"StructArrayLayout3f12");class Ip extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i){let o=this.length;return this.resize(o+1),this.emplace(o,t,i)}emplace(t,i,o){let c=2*t;return this.float32[c+0]=i,this.float32[c+1]=o,t}}Ip.prototype.bytesPerElement=8,xe(Ip,"StructArrayLayout2f8");class mw extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M){let D=this.length;return this.resize(D+1),this.emplace(D,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M)}emplace(t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M,D){let I=16*t;return this.float32[I+0]=i,this.float32[I+1]=o,this.float32[I+2]=c,this.float32[I+3]=u,this.float32[I+4]=h,this.float32[I+5]=p,this.float32[I+6]=f,this.float32[I+7]=g,this.float32[I+8]=v,this.float32[I+9]=y,this.float32[I+10]=b,this.float32[I+11]=x,this.float32[I+12]=C,this.float32[I+13]=E,this.float32[I+14]=M,this.float32[I+15]=D,t}}mw.prototype.bytesPerElement=64,xe(mw,"StructArrayLayout16f64");class z_ extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u,h,p){let f=this.length;return this.resize(f+1),this.emplace(f,t,i,o,c,u,h,p)}emplace(t,i,o,c,u,h,p,f){let g=10*t,v=5*t;return this.uint16[g+0]=i,this.uint16[g+1]=o,this.uint16[g+2]=c,this.uint16[g+3]=u,this.float32[v+2]=h,this.float32[v+3]=p,this.float32[v+4]=f,t}}z_.prototype.bytesPerElement=20,xe(z_,"StructArrayLayout4ui3f20");class pw extends tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){let i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint8[1*t+0]=i,t}}pw.prototype.bytesPerElement=1,xe(pw,"StructArrayLayout1ub1");class c2 extends R_{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}c2.prototype.size=40;class fw extends sw{get(t){return new c2(this,t)}}xe(fw,"CollisionBoxArray");class d2 extends R_{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}d2.prototype.size=60;class u2 extends cw{get(t){return new d2(this,t)}}xe(u2,"PlacedSymbolArray");class h2 extends R_{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}h2.prototype.size=80;class m2 extends dw{get(t){return new h2(this,t)}}xe(m2,"SymbolInstanceArray");class p2 extends Dp{getoffsetX(t){return this.float32[1*t+0]}}xe(p2,"GlyphOffsetArray");class f2 extends xs{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}xe(f2,"SymbolLineVertexArray");class g2 extends R_{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}g2.prototype.size=12;class _2 extends hw{get(t){return new g2(this,t)}}xe(_2,"FeatureIndexArray");class v2 extends qc{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}xe(v2,"FillExtrusionCentroidArray");let SU=Qi([{name:"a_pos",components:2,type:"Int16"}],4),EU=Qi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class dn{constructor(t=[]){this.segments=t}_prepareSegment(t,i,o,c){let u=this.segments[this.segments.length-1];return t>dn.MAX_VERTEX_ARRAY_LENGTH&&lt(`Max vertices per segment is ${dn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!u||u.vertexLength+t>dn.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==c)&&(u={vertexOffset:i,primitiveOffset:o,vertexLength:0,primitiveLength:0},c!==void 0&&(u.sortKey=c),this.segments.push(u)),u}prepareSegment(t,i,o,c){return this._prepareSegment(t,i.length,o.length,c)}get(){return this.segments}destroy(){for(let t of this.segments)for(let i in t.vaos)t.vaos[i].destroy()}static simpleSegment(t,i,o,c){return new dn([{vertexOffset:t,primitiveOffset:i,vertexLength:o,primitiveLength:c,vaos:{},sortKey:0}])}}function y2(e,t){return 256*(e=ve(Math.floor(e),0,255))+ve(Math.floor(t),0,255)}dn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,xe(dn,"SegmentVector");let MU=Qi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),DU=Qi([{name:"a_dash",components:4,type:"Uint16"}]);var N_={exports:{}},b2={exports:{}};(function(e){e.exports=function(t,i){var o,c,u,h,p,f,g,v;for(c=t.length-(o=3&t.length),u=i,p=3432918353,f=461845907,v=0;v<c;)g=255&t.charCodeAt(v)|(255&t.charCodeAt(++v))<<8|(255&t.charCodeAt(++v))<<16|(255&t.charCodeAt(++v))<<24,++v,u=27492+(65535&(h=5*(65535&(u=(u^=g=(65535&(g=(g=(65535&g)*p+(((g>>>16)*p&65535)<<16)&4294967295)<<15|g>>>17))*f+(((g>>>16)*f&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(h>>>16)&65535)<<16);switch(g=0,o){case 3:g^=(255&t.charCodeAt(v+2))<<16;case 2:g^=(255&t.charCodeAt(v+1))<<8;case 1:u^=g=(65535&(g=(g=(65535&(g^=255&t.charCodeAt(v)))*p+(((g>>>16)*p&65535)<<16)&4294967295)<<15|g>>>17))*f+(((g>>>16)*f&65535)<<16)&4294967295}return u^=t.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0}})(b2);var TU=b2.exports,x2={exports:{}};(function(e){e.exports=function(t,i){for(var o,c=t.length,u=i^c,h=0;c>=4;)o=1540483477*(65535&(o=255&t.charCodeAt(h)|(255&t.charCodeAt(++h))<<8|(255&t.charCodeAt(++h))<<16|(255&t.charCodeAt(++h))<<24))+((1540483477*(o>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),c-=4,++h;switch(c){case 3:u^=(255&t.charCodeAt(h+2))<<16;case 2:u^=(255&t.charCodeAt(h+1))<<8;case 1:u=1540483477*(65535&(u^=255&t.charCodeAt(h)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0}})(x2);var w2=TU,IU=x2.exports;N_.exports=w2,N_.exports.murmur3=w2,N_.exports.murmur2=IU;var gw=ut(N_.exports);class Ap{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,i,o,c){this.ids.push(C2(t)),this.positions.push(i,o,c)}eachPosition(t,i){let o=C2(t),c=0,u=this.ids.length-1;for(;c<u;){let h=c+u>>1;this.ids[h]>=o?u=h:c=h+1}for(;this.ids[c]===o;)i(this.positions[3*c],this.positions[3*c+1],this.positions[3*c+2]),c++}static serialize(t,i){let o=new Float64Array(t.ids),c=new Uint32Array(t.positions);return _w(o,c,0,o.length-1),i&&(i.add(o.buffer),i.add(c.buffer)),{ids:o,positions:c}}static deserialize(t){let i=new Ap,o;i.ids=t.ids,i.positions=t.positions;for(let c of i.ids)c!==o&&i.uniqueIds.push(c),o=c;return i.indexed=!0,i}}function C2(e){let t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:gw(String(e))}function _w(e,t,i,o){for(;i<o;){let c=e[i+o>>1],u=i-1,h=o+1;for(;;){do u++;while(e[u]<c);do h--;while(e[h]>c);if(u>=h)break;B_(e,u,h),B_(t,3*u,3*h),B_(t,3*u+1,3*h+1),B_(t,3*u+2,3*h+2)}h-i<o-h?(_w(e,t,i,h),i=h+1):(_w(e,t,h+1,o),o=h)}}function B_(e,t,i){let o=e[t];e[t]=e[i],e[i]=o}xe(Ap,"FeaturePositionMap");class sc{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,i),this.initialized=!0),!!this.location}}class yi extends sc{constructor(t){super(t),this.current=0}set(t,i,o){this.fetchUniformLocation(t,i)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}}class Bt extends sc{constructor(t){super(t),this.current=0}set(t,i,o){this.fetchUniformLocation(t,i)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class bi extends sc{constructor(t){super(t),this.current=[0,0]}set(t,i,o){this.fetchUniformLocation(t,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}}class ci extends sc{constructor(t){super(t),this.current=[0,0,0]}set(t,i,o){this.fetchUniformLocation(t,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}}class ws extends sc{constructor(t){super(t),this.current=[0,0,0,0]}set(t,i,o){this.fetchUniformLocation(t,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class fh extends sc{constructor(t){super(t),this.current=fi.transparent}set(t,i,o){this.fetchUniformLocation(t,i)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}let AU=new Float32Array(16);class si extends sc{constructor(t){super(t),this.current=AU}set(t,i,o){if(this.fetchUniformLocation(t,i)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let c=1;c<16;c++)if(o[c]!==this.current[c]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}}let kU=new Float32Array(9);class vw extends sc{constructor(t){super(t),this.current=kU}set(t,i,o){if(this.fetchUniformLocation(t,i)){for(let c=0;c<9;c++)if(o[c]!==this.current[c]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}}}let RU=new Float32Array(4);class yw extends sc{constructor(t){super(t),this.current=RU}set(t,i,o){if(this.fetchUniformLocation(t,i)){for(let c=0;c<4;c++)if(o[c]!==this.current[c]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}}function bw(e){return[y2(255*e.r,255*e.g),y2(255*e.b,255*e.a)]}class kp{constructor(t,i,o){this.value=t,this.uniformNames=i.map(c=>`u_${c}`),this.type=o}setUniform(t,i,o,c,u){i.set(t,u,c.constantOr(this.value))}getBinding(t,i){return this.type==="color"?new fh(t):new Bt(t)}}class gh{constructor(t,i){this.uniformNames=i.map(o=>`u_${o}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,i,o,c,u){let h=u==="u_pattern"||u==="u_dash"?this.pattern:u==="u_pixel_ratio"?this.pixelRatio:null;h&&i.set(t,u,h)}getBinding(t,i){return i==="u_pattern"||i==="u_dash"?new ws(t):new Bt(t)}}class ac{constructor(t,i,o,c){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map(u=>({name:`a_${u}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(t,i,o,c,u,h,p){let f=this.paintVertexArray.length,g=this.expression.evaluate(new Jn(0,{brightness:h}),i,{},u,c,p);this.paintVertexArray.resize(t),this._setPaintValue(f,t,g)}updatePaintArray(t,i,o,c,u,h,p){let f=this.expression.evaluate({zoom:0,brightness:p},o,c,void 0,u);this._setPaintValue(t,i,f)}_setPaintValue(t,i,o){if(this.type==="color"){let c=bw(o);for(let u=t;u<i;u++)this.paintVertexArray.emplace(u,c[0],c[1])}else{for(let c=t;c<i;c++)this.paintVertexArray.emplace(c,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ya{constructor(t,i,o,c,u,h){this.expression=t,this.uniformNames=i.map(p=>`u_${p}_t`),this.type=o,this.useIntegerZoom=c,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=i.map(p=>({name:`a_${p}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,i,o,c,u,h,p){let f=this.expression.evaluate(new Jn(this.zoom,{brightness:h}),i,{},u,c,p),g=this.expression.evaluate(new Jn(this.zoom+1,{brightness:h}),i,{},u,c,p),v=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(v,t,f,g)}updatePaintArray(t,i,o,c,u,h,p){let f=this.expression.evaluate({zoom:this.zoom,brightness:p},o,c,void 0,u),g=this.expression.evaluate({zoom:this.zoom+1,brightness:p},o,c,void 0,u);this._setPaintValue(t,i,f,g)}_setPaintValue(t,i,o,c){if(this.type==="color"){let u=bw(o),h=bw(c);for(let p=t;p<i;p++)this.paintVertexArray.emplace(p,u[0],u[1],h[0],h[1])}else{for(let u=t;u<i;u++)this.paintVertexArray.emplace(u,o,c);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,i,o,c,u){let h=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,p=ve(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);i.set(t,u,p)}getBinding(t,i){return new Bt(t)}}class Wc{constructor(t,i,o,c,u){this.expression=t,this.layerId=u,this.paintVertexAttributes=(o==="array"?DU:MU).members;for(let h=0;h<i.length;++h);this.paintVertexArray=new c}populatePaintArray(t,i,o){let c=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(c,t,i.patterns&&i.patterns[this.layerId],o)}updatePaintArray(t,i,o,c,u,h,p){this._setPaintValues(t,i,o.patterns&&o.patterns[this.layerId],h)}_setPaintValues(t,i,o,c){if(!c||!o)return;let u=c[o];if(!u)return;let{tl:h,br:p,pixelRatio:f}=u;for(let g=t;g<i;g++)this.paintVertexArray.emplace(g,h[0],h[1],p[0],p[1],f)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class iu{constructor(t,i,o=()=>!0){this.binders={},this._buffers=[];let c=[];for(let u in t.paint._values){let h=t.paint.get(u);if(!o(u)||!(h instanceof ph&&Kd(h.property.specification)))continue;let p=OU(u,t.type),f=h.value,g=h.property.specification.type,v=!!h.property.useIntegerZoom,y=u==="line-dasharray"||u.endsWith("pattern"),b=u==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant";if(f.kind!=="constant"||b)if(f.kind==="source"||b||y){let x=S2(u,g,"source");this.binders[u]=y?new Wc(f,p,g,x,t.id):new ac(f,p,g,x),c.push(`/a_${u}`)}else{let x=S2(u,g,"composite");this.binders[u]=new Ya(f,p,g,v,i,x),c.push(`/z_${u}`)}else this.binders[u]=y?new gh(f.value,p):new kp(f.value,p,g),c.push(`/u_${u}`)}this.cacheKey=c.sort().join("")}getMaxValue(t){let i=this.binders[t];return i instanceof ac||i instanceof Ya?i.maxValue:0}populatePaintArrays(t,i,o,c,u,h,p){for(let f in this.binders){let g=this.binders[f];(g instanceof ac||g instanceof Ya||g instanceof Wc)&&g.populatePaintArray(t,i,o,c,u,h,p)}}setConstantPatternPositions(t){for(let i in this.binders){let o=this.binders[i];o instanceof gh&&o.setConstantPatternPositions(t)}}updatePaintArrays(t,i,o,c,u,h,p,f){let g=!1,v=Object.keys(t),y=v.length!==0,b=y?v:i.uniqueIds;for(let x in this.binders){let C=this.binders[x];if((C instanceof ac||C instanceof Ya||C instanceof Wc)&&(C.expression.isStateDependent===!0||C.expression.isLightConstant===!1)){let E=u.paint.get(x);C.expression=E.value;for(let M of b){let D=t[M.toString()];i.eachPosition(M,(I,P,O)=>{let R=c.feature(I);C.updatePaintArray(P,O,R,D,h,p,f)})}if(!y)for(let M of o.uniqueIds){let D=t[M.toString()];o.eachPosition(M,(I,P,O)=>{let R=c.feature(I);C.updatePaintArray(P,O,R,D,h,p,f)})}g=!0}}return g}defines(){let t=[];for(let i in this.binders){let o=this.binders[i];(o instanceof kp||o instanceof gh)&&t.push(...o.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return t}getBinderAttributes(){let t=[];for(let i in this.binders){let o=this.binders[i];if(o instanceof ac||o instanceof Ya||o instanceof Wc)for(let c=0;c<o.paintVertexAttributes.length;c++)t.push(o.paintVertexAttributes[c].name)}return t}getBinderUniforms(){let t=[];for(let i in this.binders){let o=this.binders[i];if(o instanceof kp||o instanceof gh||o instanceof Ya)for(let c of o.uniformNames)t.push(c)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){let i=[];for(let o in this.binders){let c=this.binders[o];if(c instanceof kp||c instanceof gh||c instanceof Ya)for(let u of c.uniformNames)i.push({name:u,property:o,binding:c.getBinding(t,u)})}return i}setUniforms(t,i,o,c,u){for(let{name:h,property:p,binding:f}of o)this.binders[p].setUniform(t,f,u,c.get(p),h)}updatePaintBuffers(){this._buffers=[];for(let t in this.binders){let i=this.binders[t];(i instanceof ac||i instanceof Ya||i instanceof Wc)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(t){for(let i in this.binders){let o=this.binders[i];(o instanceof ac||o instanceof Ya||o instanceof Wc)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(let t in this.binders){let i=this.binders[t];(i instanceof ac||i instanceof Ya||i instanceof Wc)&&i.destroy()}}}class $c{constructor(t,i,o=()=>!0){this.programConfigurations={};for(let c of t)this.programConfigurations[c.id]=new iu(c,i,o);this.needsUpload=!1,this._featureMap=new Ap,this._featureMapWithoutIds=new Ap,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,i,o,c,u,h,p,f){for(let g in this.programConfigurations)this.programConfigurations[g].populatePaintArrays(t,i,c,u,h,p,f);i.id!==void 0?this._featureMap.add(i.id,o,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,o,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,i,o,c,u,h){for(let p of o)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,i,p,c,u,h||0)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(let i in this.programConfigurations)this.programConfigurations[i].upload(t);this.needsUpload=!1}}destroy(){for(let t in this.programConfigurations)this.programConfigurations[t].destroy()}}let PU={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function OU(e,t){return PU[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}let FU={"line-pattern":{source:Gc,composite:Gc},"fill-pattern":{source:Gc,composite:Gc},"fill-extrusion-pattern":{source:Gc,composite:Gc},"line-dasharray":{source:O_,composite:O_}},LU={color:{source:Ip,composite:oc},number:{source:Dp,composite:Ip}};function S2(e,t,i){let o=FU[e];return o&&o[i]||LU[t][i]}xe(kp,"ConstantBinder"),xe(gh,"PatternConstantBinder"),xe(ac,"SourceExpressionBinder"),xe(Wc,"PatternCompositeBinder"),xe(Ya,"CompositeExpressionBinder"),xe(iu,"ProgramConfiguration",{omit:["_buffers"]}),xe($c,"ProgramConfigurationSet");class Cs{constructor(t,i){t&&(i?this.setSouthWest(t).setNorthEast(i):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof Ye?new Ye(t.lng,t.lat):Ye.convert(t),this}setSouthWest(t){return this._sw=t instanceof Ye?new Ye(t.lng,t.lat):Ye.convert(t),this}extend(t){let i=this._sw,o=this._ne,c,u;if(t instanceof Ye)c=t,u=t;else{if(!(t instanceof Cs))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Cs.convert(t)):this.extend(Ye.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(Ye.convert(t)):this;if(c=t._sw,u=t._ne,!c||!u)return this}return i||o?(i.lng=Math.min(c.lng,i.lng),i.lat=Math.min(c.lat,i.lat),o.lng=Math.max(u.lng,o.lng),o.lat=Math.max(u.lat,o.lat)):(this._sw=new Ye(c.lng,c.lat),this._ne=new Ye(u.lng,u.lat)),this}getCenter(){return new Ye((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ye(this.getWest(),this.getNorth())}getSouthEast(){return new Ye(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){let{lng:i,lat:o}=Ye.convert(t),c=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&c}static convert(t){return!t||t instanceof Cs?t:new Cs(t)}}var bo={},xo={};Object.defineProperty(xo,"__esModule",{value:!0}),xo.setMatrixArrayType=function(e){xo.ARRAY_TYPE=M2=e},xo.toRadian=function(e){return e*NU},xo.equals=function(e,t){return Math.abs(e-t)<=E2*Math.max(1,Math.abs(e),Math.abs(t))},xo.RANDOM=xo.ARRAY_TYPE=xo.EPSILON=void 0;var E2=1e-6;xo.EPSILON=E2;var M2=typeof Float32Array<"u"?Float32Array:Array;xo.ARRAY_TYPE=M2;var zU=Math.random;xo.RANDOM=zU;var NU=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var er={};function xw(e){return xw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xw(e)}Object.defineProperty(er,"__esModule",{value:!0}),er.create=function(){var e=new Yc.ARRAY_TYPE(4);return Yc.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},er.clone=function(e){var t=new Yc.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},er.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},er.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},er.fromValues=function(e,t,i,o){var c=new Yc.ARRAY_TYPE(4);return c[0]=e,c[1]=t,c[2]=i,c[3]=o,c},er.set=function(e,t,i,o,c){return e[0]=t,e[1]=i,e[2]=o,e[3]=c,e},er.transpose=function(e,t){if(e===t){var i=t[1];e[1]=t[2],e[2]=i}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},er.invert=function(e,t){var i=t[0],o=t[1],c=t[2],u=t[3],h=i*u-c*o;return h?(e[0]=u*(h=1/h),e[1]=-o*h,e[2]=-c*h,e[3]=i*h,e):null},er.adjoint=function(e,t){var i=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=i,e},er.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},er.multiply=T2,er.rotate=function(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3],p=Math.sin(i),f=Math.cos(i);return e[0]=o*f+u*p,e[1]=c*f+h*p,e[2]=o*-p+u*f,e[3]=c*-p+h*f,e},er.scale=function(e,t,i){var o=t[1],c=t[2],u=t[3],h=i[0],p=i[1];return e[0]=t[0]*h,e[1]=o*h,e[2]=c*p,e[3]=u*p,e},er.fromRotation=function(e,t){var i=Math.sin(t),o=Math.cos(t);return e[0]=o,e[1]=i,e[2]=-i,e[3]=o,e},er.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},er.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},er.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},er.LDU=function(e,t,i,o){return e[2]=o[2]/o[0],i[0]=o[0],i[1]=o[1],i[3]=o[3]-e[2]*i[1],[e,t,i]},er.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e},er.subtract=I2,er.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},er.equals=function(e,t){var i=e[0],o=e[1],c=e[2],u=e[3],h=t[0],p=t[1],f=t[2],g=t[3];return Math.abs(i-h)<=Yc.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-p)<=Yc.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(c-f)<=Yc.EPSILON*Math.max(1,Math.abs(c),Math.abs(f))&&Math.abs(u-g)<=Yc.EPSILON*Math.max(1,Math.abs(u),Math.abs(g))},er.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},er.multiplyScalarAndAdd=function(e,t,i,o){return e[0]=t[0]+i[0]*o,e[1]=t[1]+i[1]*o,e[2]=t[2]+i[2]*o,e[3]=t[3]+i[3]*o,e},er.sub=er.mul=void 0;var Yc=function(e,t){if(e&&e.__esModule)return e;if(e===null||xw(e)!=="object"&&typeof e!="function")return{default:e};var i=D2(void 0);if(i&&i.has(e))return i.get(e);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(u!=="default"&&Object.prototype.hasOwnProperty.call(e,u)){var h=c?Object.getOwnPropertyDescriptor(e,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=e[u]}return o.default=e,i&&i.set(e,o),o}(xo);function D2(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(D2=function(o){return o?i:t})(e)}function T2(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3],p=i[0],f=i[1],g=i[2],v=i[3];return e[0]=o*p+u*f,e[1]=c*p+h*f,e[2]=o*g+u*v,e[3]=c*g+h*v,e}function I2(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}er.mul=T2,er.sub=I2;var cr={};function ww(e){return ww=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ww(e)}Object.defineProperty(cr,"__esModule",{value:!0}),cr.create=function(){var e=new El.ARRAY_TYPE(6);return El.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},cr.clone=function(e){var t=new El.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},cr.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},cr.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},cr.fromValues=function(e,t,i,o,c,u){var h=new El.ARRAY_TYPE(6);return h[0]=e,h[1]=t,h[2]=i,h[3]=o,h[4]=c,h[5]=u,h},cr.set=function(e,t,i,o,c,u,h){return e[0]=t,e[1]=i,e[2]=o,e[3]=c,e[4]=u,e[5]=h,e},cr.invert=function(e,t){var i=t[0],o=t[1],c=t[2],u=t[3],h=t[4],p=t[5],f=i*u-o*c;return f?(e[0]=u*(f=1/f),e[1]=-o*f,e[2]=-c*f,e[3]=i*f,e[4]=(c*p-u*h)*f,e[5]=(o*h-i*p)*f,e):null},cr.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},cr.multiply=k2,cr.rotate=function(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3],p=t[4],f=t[5],g=Math.sin(i),v=Math.cos(i);return e[0]=o*v+u*g,e[1]=c*v+h*g,e[2]=o*-g+u*v,e[3]=c*-g+h*v,e[4]=p,e[5]=f,e},cr.scale=function(e,t,i){var o=t[1],c=t[2],u=t[3],h=t[4],p=t[5],f=i[0],g=i[1];return e[0]=t[0]*f,e[1]=o*f,e[2]=c*g,e[3]=u*g,e[4]=h,e[5]=p,e},cr.translate=function(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3],p=t[4],f=t[5],g=i[0],v=i[1];return e[0]=o,e[1]=c,e[2]=u,e[3]=h,e[4]=o*g+u*v+p,e[5]=c*g+h*v+f,e},cr.fromRotation=function(e,t){var i=Math.sin(t),o=Math.cos(t);return e[0]=o,e[1]=i,e[2]=-i,e[3]=o,e[4]=0,e[5]=0,e},cr.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},cr.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},cr.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},cr.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},cr.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e},cr.subtract=R2,cr.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e},cr.multiplyScalarAndAdd=function(e,t,i,o){return e[0]=t[0]+i[0]*o,e[1]=t[1]+i[1]*o,e[2]=t[2]+i[2]*o,e[3]=t[3]+i[3]*o,e[4]=t[4]+i[4]*o,e[5]=t[5]+i[5]*o,e},cr.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},cr.equals=function(e,t){var i=e[0],o=e[1],c=e[2],u=e[3],h=e[4],p=e[5],f=t[0],g=t[1],v=t[2],y=t[3],b=t[4],x=t[5];return Math.abs(i-f)<=El.EPSILON*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(o-g)<=El.EPSILON*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(c-v)<=El.EPSILON*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(u-y)<=El.EPSILON*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(h-b)<=El.EPSILON*Math.max(1,Math.abs(h),Math.abs(b))&&Math.abs(p-x)<=El.EPSILON*Math.max(1,Math.abs(p),Math.abs(x))},cr.sub=cr.mul=void 0;var El=function(e,t){if(e&&e.__esModule)return e;if(e===null||ww(e)!=="object"&&typeof e!="function")return{default:e};var i=A2(void 0);if(i&&i.has(e))return i.get(e);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(u!=="default"&&Object.prototype.hasOwnProperty.call(e,u)){var h=c?Object.getOwnPropertyDescriptor(e,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=e[u]}return o.default=e,i&&i.set(e,o),o}(xo);function A2(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(A2=function(o){return o?i:t})(e)}function k2(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3],p=t[4],f=t[5],g=i[0],v=i[1],y=i[2],b=i[3],x=i[4],C=i[5];return e[0]=o*g+u*v,e[1]=c*g+h*v,e[2]=o*y+u*b,e[3]=c*y+h*b,e[4]=o*x+u*C+p,e[5]=c*x+h*C+f,e}function R2(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e}cr.mul=k2,cr.sub=R2;var yn={};function Cw(e){return Cw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cw(e)}Object.defineProperty(yn,"__esModule",{value:!0}),yn.create=function(){var e=new Gs.ARRAY_TYPE(9);return Gs.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},yn.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},yn.clone=function(e){var t=new Gs.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},yn.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},yn.fromValues=function(e,t,i,o,c,u,h,p,f){var g=new Gs.ARRAY_TYPE(9);return g[0]=e,g[1]=t,g[2]=i,g[3]=o,g[4]=c,g[5]=u,g[6]=h,g[7]=p,g[8]=f,g},yn.set=function(e,t,i,o,c,u,h,p,f,g){return e[0]=t,e[1]=i,e[2]=o,e[3]=c,e[4]=u,e[5]=h,e[6]=p,e[7]=f,e[8]=g,e},yn.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},yn.transpose=function(e,t){if(e===t){var i=t[1],o=t[2],c=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=o,e[7]=c}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},yn.invert=function(e,t){var i=t[0],o=t[1],c=t[2],u=t[3],h=t[4],p=t[5],f=t[6],g=t[7],v=t[8],y=v*h-p*g,b=-v*u+p*f,x=g*u-h*f,C=i*y+o*b+c*x;return C?(e[0]=y*(C=1/C),e[1]=(-v*o+c*g)*C,e[2]=(p*o-c*h)*C,e[3]=b*C,e[4]=(v*i-c*f)*C,e[5]=(-p*i+c*u)*C,e[6]=x*C,e[7]=(-g*i+o*f)*C,e[8]=(h*i-o*u)*C,e):null},yn.adjoint=function(e,t){var i=t[0],o=t[1],c=t[2],u=t[3],h=t[4],p=t[5],f=t[6],g=t[7],v=t[8];return e[0]=h*v-p*g,e[1]=c*g-o*v,e[2]=o*p-c*h,e[3]=p*f-u*v,e[4]=i*v-c*f,e[5]=c*u-i*p,e[6]=u*g-h*f,e[7]=o*f-i*g,e[8]=i*h-o*u,e},yn.determinant=function(e){var t=e[3],i=e[4],o=e[5],c=e[6],u=e[7],h=e[8];return e[0]*(h*i-o*u)+e[1]*(-h*t+o*c)+e[2]*(u*t-i*c)},yn.multiply=O2,yn.translate=function(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3],p=t[4],f=t[5],g=t[6],v=t[7],y=t[8],b=i[0],x=i[1];return e[0]=o,e[1]=c,e[2]=u,e[3]=h,e[4]=p,e[5]=f,e[6]=b*o+x*h+g,e[7]=b*c+x*p+v,e[8]=b*u+x*f+y,e},yn.rotate=function(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3],p=t[4],f=t[5],g=t[6],v=t[7],y=t[8],b=Math.sin(i),x=Math.cos(i);return e[0]=x*o+b*h,e[1]=x*c+b*p,e[2]=x*u+b*f,e[3]=x*h-b*o,e[4]=x*p-b*c,e[5]=x*f-b*u,e[6]=g,e[7]=v,e[8]=y,e},yn.scale=function(e,t,i){var o=i[0],c=i[1];return e[0]=o*t[0],e[1]=o*t[1],e[2]=o*t[2],e[3]=c*t[3],e[4]=c*t[4],e[5]=c*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},yn.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},yn.fromRotation=function(e,t){var i=Math.sin(t),o=Math.cos(t);return e[0]=o,e[1]=i,e[2]=0,e[3]=-i,e[4]=o,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},yn.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},yn.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},yn.fromQuat=function(e,t){var i=t[0],o=t[1],c=t[2],u=t[3],h=i+i,p=o+o,f=c+c,g=i*h,v=o*h,y=o*p,b=c*h,x=c*p,C=c*f,E=u*h,M=u*p,D=u*f;return e[0]=1-y-C,e[3]=v-D,e[6]=b+M,e[1]=v+D,e[4]=1-g-C,e[7]=x-E,e[2]=b-M,e[5]=x+E,e[8]=1-g-y,e},yn.normalFromMat4=function(e,t){var i=t[0],o=t[1],c=t[2],u=t[3],h=t[4],p=t[5],f=t[6],g=t[7],v=t[8],y=t[9],b=t[10],x=t[11],C=t[12],E=t[13],M=t[14],D=t[15],I=i*p-o*h,P=i*f-c*h,O=i*g-u*h,R=o*f-c*p,F=o*g-u*p,z=c*g-u*f,j=v*E-y*C,U=v*M-b*C,G=v*D-x*C,$=y*M-b*E,Y=y*D-x*E,tt=b*D-x*M,W=I*tt-P*Y+O*$+R*G-F*U+z*j;return W?(e[0]=(p*tt-f*Y+g*$)*(W=1/W),e[1]=(f*G-h*tt-g*U)*W,e[2]=(h*Y-p*G+g*j)*W,e[3]=(c*Y-o*tt-u*$)*W,e[4]=(i*tt-c*G+u*U)*W,e[5]=(o*G-i*Y-u*j)*W,e[6]=(E*z-M*F+D*R)*W,e[7]=(M*O-C*z-D*P)*W,e[8]=(C*F-E*O+D*I)*W,e):null},yn.projection=function(e,t,i){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/i,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},yn.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},yn.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},yn.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e},yn.subtract=F2,yn.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e},yn.multiplyScalarAndAdd=function(e,t,i,o){return e[0]=t[0]+i[0]*o,e[1]=t[1]+i[1]*o,e[2]=t[2]+i[2]*o,e[3]=t[3]+i[3]*o,e[4]=t[4]+i[4]*o,e[5]=t[5]+i[5]*o,e[6]=t[6]+i[6]*o,e[7]=t[7]+i[7]*o,e[8]=t[8]+i[8]*o,e},yn.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},yn.equals=function(e,t){var i=e[0],o=e[1],c=e[2],u=e[3],h=e[4],p=e[5],f=e[6],g=e[7],v=e[8],y=t[0],b=t[1],x=t[2],C=t[3],E=t[4],M=t[5],D=t[6],I=t[7],P=t[8];return Math.abs(i-y)<=Gs.EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(o-b)<=Gs.EPSILON*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(c-x)<=Gs.EPSILON*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(u-C)<=Gs.EPSILON*Math.max(1,Math.abs(u),Math.abs(C))&&Math.abs(h-E)<=Gs.EPSILON*Math.max(1,Math.abs(h),Math.abs(E))&&Math.abs(p-M)<=Gs.EPSILON*Math.max(1,Math.abs(p),Math.abs(M))&&Math.abs(f-D)<=Gs.EPSILON*Math.max(1,Math.abs(f),Math.abs(D))&&Math.abs(g-I)<=Gs.EPSILON*Math.max(1,Math.abs(g),Math.abs(I))&&Math.abs(v-P)<=Gs.EPSILON*Math.max(1,Math.abs(v),Math.abs(P))},yn.sub=yn.mul=void 0;var Gs=function(e,t){if(e&&e.__esModule)return e;if(e===null||Cw(e)!=="object"&&typeof e!="function")return{default:e};var i=P2(void 0);if(i&&i.has(e))return i.get(e);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(u!=="default"&&Object.prototype.hasOwnProperty.call(e,u)){var h=c?Object.getOwnPropertyDescriptor(e,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=e[u]}return o.default=e,i&&i.set(e,o),o}(xo);function P2(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(P2=function(o){return o?i:t})(e)}function O2(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3],p=t[4],f=t[5],g=t[6],v=t[7],y=t[8],b=i[0],x=i[1],C=i[2],E=i[3],M=i[4],D=i[5],I=i[6],P=i[7],O=i[8];return e[0]=b*o+x*h+C*g,e[1]=b*c+x*p+C*v,e[2]=b*u+x*f+C*y,e[3]=E*o+M*h+D*g,e[4]=E*c+M*p+D*v,e[5]=E*u+M*f+D*y,e[6]=I*o+P*h+O*g,e[7]=I*c+P*p+O*v,e[8]=I*u+P*f+O*y,e}function F2(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e}yn.mul=O2,yn.sub=F2;var ui={};function Sw(e){return Sw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sw(e)}Object.defineProperty(ui,"__esModule",{value:!0}),ui.create=function(){var e=new Sr.ARRAY_TYPE(16);return Sr.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},ui.clone=function(e){var t=new Sr.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},ui.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},ui.fromValues=function(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E){var M=new Sr.ARRAY_TYPE(16);return M[0]=e,M[1]=t,M[2]=i,M[3]=o,M[4]=c,M[5]=u,M[6]=h,M[7]=p,M[8]=f,M[9]=g,M[10]=v,M[11]=y,M[12]=b,M[13]=x,M[14]=C,M[15]=E,M},ui.set=function(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M){return e[0]=t,e[1]=i,e[2]=o,e[3]=c,e[4]=u,e[5]=h,e[6]=p,e[7]=f,e[8]=g,e[9]=v,e[10]=y,e[11]=b,e[12]=x,e[13]=C,e[14]=E,e[15]=M,e},ui.identity=z2,ui.transpose=function(e,t){if(e===t){var i=t[1],o=t[2],c=t[3],u=t[6],h=t[7],p=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=o,e[9]=u,e[11]=t[14],e[12]=c,e[13]=h,e[14]=p}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},ui.invert=function(e,t){var i=t[0],o=t[1],c=t[2],u=t[3],h=t[4],p=t[5],f=t[6],g=t[7],v=t[8],y=t[9],b=t[10],x=t[11],C=t[12],E=t[13],M=t[14],D=t[15],I=i*p-o*h,P=i*f-c*h,O=i*g-u*h,R=o*f-c*p,F=o*g-u*p,z=c*g-u*f,j=v*E-y*C,U=v*M-b*C,G=v*D-x*C,$=y*M-b*E,Y=y*D-x*E,tt=b*D-x*M,W=I*tt-P*Y+O*$+R*G-F*U+z*j;return W?(e[0]=(p*tt-f*Y+g*$)*(W=1/W),e[1]=(c*Y-o*tt-u*$)*W,e[2]=(E*z-M*F+D*R)*W,e[3]=(b*F-y*z-x*R)*W,e[4]=(f*G-h*tt-g*U)*W,e[5]=(i*tt-c*G+u*U)*W,e[6]=(M*O-C*z-D*P)*W,e[7]=(v*z-b*O+x*P)*W,e[8]=(h*Y-p*G+g*j)*W,e[9]=(o*G-i*Y-u*j)*W,e[10]=(C*F-E*O+D*I)*W,e[11]=(y*O-v*F-x*I)*W,e[12]=(p*U-h*$-f*j)*W,e[13]=(i*$-o*U+c*j)*W,e[14]=(E*P-C*R-M*I)*W,e[15]=(v*R-y*P+b*I)*W,e):null},ui.adjoint=function(e,t){var i=t[0],o=t[1],c=t[2],u=t[3],h=t[4],p=t[5],f=t[6],g=t[7],v=t[8],y=t[9],b=t[10],x=t[11],C=t[12],E=t[13],M=t[14],D=t[15];return e[0]=p*(b*D-x*M)-y*(f*D-g*M)+E*(f*x-g*b),e[1]=-(o*(b*D-x*M)-y*(c*D-u*M)+E*(c*x-u*b)),e[2]=o*(f*D-g*M)-p*(c*D-u*M)+E*(c*g-u*f),e[3]=-(o*(f*x-g*b)-p*(c*x-u*b)+y*(c*g-u*f)),e[4]=-(h*(b*D-x*M)-v*(f*D-g*M)+C*(f*x-g*b)),e[5]=i*(b*D-x*M)-v*(c*D-u*M)+C*(c*x-u*b),e[6]=-(i*(f*D-g*M)-h*(c*D-u*M)+C*(c*g-u*f)),e[7]=i*(f*x-g*b)-h*(c*x-u*b)+v*(c*g-u*f),e[8]=h*(y*D-x*E)-v*(p*D-g*E)+C*(p*x-g*y),e[9]=-(i*(y*D-x*E)-v*(o*D-u*E)+C*(o*x-u*y)),e[10]=i*(p*D-g*E)-h*(o*D-u*E)+C*(o*g-u*p),e[11]=-(i*(p*x-g*y)-h*(o*x-u*y)+v*(o*g-u*p)),e[12]=-(h*(y*M-b*E)-v*(p*M-f*E)+C*(p*b-f*y)),e[13]=i*(y*M-b*E)-v*(o*M-c*E)+C*(o*b-c*y),e[14]=-(i*(p*M-f*E)-h*(o*M-c*E)+C*(o*f-c*p)),e[15]=i*(p*b-f*y)-h*(o*b-c*y)+v*(o*f-c*p),e},ui.determinant=function(e){var t=e[0],i=e[1],o=e[2],c=e[3],u=e[4],h=e[5],p=e[6],f=e[7],g=e[8],v=e[9],y=e[10],b=e[11],x=e[12],C=e[13],E=e[14],M=e[15];return(t*h-i*u)*(y*M-b*E)-(t*p-o*u)*(v*M-b*C)+(t*f-c*u)*(v*E-y*C)+(i*p-o*h)*(g*M-b*x)-(i*f-c*h)*(g*E-y*x)+(o*f-c*p)*(g*C-v*x)},ui.multiply=N2,ui.translate=function(e,t,i){var o,c,u,h,p,f,g,v,y,b,x,C,E=i[0],M=i[1],D=i[2];return t===e?(e[12]=t[0]*E+t[4]*M+t[8]*D+t[12],e[13]=t[1]*E+t[5]*M+t[9]*D+t[13],e[14]=t[2]*E+t[6]*M+t[10]*D+t[14],e[15]=t[3]*E+t[7]*M+t[11]*D+t[15]):(c=t[1],u=t[2],h=t[3],p=t[4],f=t[5],g=t[6],v=t[7],y=t[8],b=t[9],x=t[10],C=t[11],e[0]=o=t[0],e[1]=c,e[2]=u,e[3]=h,e[4]=p,e[5]=f,e[6]=g,e[7]=v,e[8]=y,e[9]=b,e[10]=x,e[11]=C,e[12]=o*E+p*M+y*D+t[12],e[13]=c*E+f*M+b*D+t[13],e[14]=u*E+g*M+x*D+t[14],e[15]=h*E+v*M+C*D+t[15]),e},ui.scale=function(e,t,i){var o=i[0],c=i[1],u=i[2];return e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o,e[4]=t[4]*c,e[5]=t[5]*c,e[6]=t[6]*c,e[7]=t[7]*c,e[8]=t[8]*u,e[9]=t[9]*u,e[10]=t[10]*u,e[11]=t[11]*u,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},ui.rotate=function(e,t,i,o){var c,u,h,p,f,g,v,y,b,x,C,E,M,D,I,P,O,R,F,z,j,U,G,$,Y=o[0],tt=o[1],W=o[2],rt=Math.hypot(Y,tt,W);return rt<Sr.EPSILON?null:(Y*=rt=1/rt,tt*=rt,W*=rt,c=Math.sin(i),u=Math.cos(i),f=t[1],g=t[2],v=t[3],b=t[5],x=t[6],C=t[7],M=t[9],D=t[10],I=t[11],F=Y*tt*(h=1-u)-W*c,z=tt*tt*h+u,j=W*tt*h+Y*c,U=Y*W*h+tt*c,G=tt*W*h-Y*c,$=W*W*h+u,e[0]=(p=t[0])*(P=Y*Y*h+u)+(y=t[4])*(O=tt*Y*h+W*c)+(E=t[8])*(R=W*Y*h-tt*c),e[1]=f*P+b*O+M*R,e[2]=g*P+x*O+D*R,e[3]=v*P+C*O+I*R,e[4]=p*F+y*z+E*j,e[5]=f*F+b*z+M*j,e[6]=g*F+x*z+D*j,e[7]=v*F+C*z+I*j,e[8]=p*U+y*G+E*$,e[9]=f*U+b*G+M*$,e[10]=g*U+x*G+D*$,e[11]=v*U+C*G+I*$,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},ui.rotateX=function(e,t,i){var o=Math.sin(i),c=Math.cos(i),u=t[4],h=t[5],p=t[6],f=t[7],g=t[8],v=t[9],y=t[10],b=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=u*c+g*o,e[5]=h*c+v*o,e[6]=p*c+y*o,e[7]=f*c+b*o,e[8]=g*c-u*o,e[9]=v*c-h*o,e[10]=y*c-p*o,e[11]=b*c-f*o,e},ui.rotateY=function(e,t,i){var o=Math.sin(i),c=Math.cos(i),u=t[0],h=t[1],p=t[2],f=t[3],g=t[8],v=t[9],y=t[10],b=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=u*c-g*o,e[1]=h*c-v*o,e[2]=p*c-y*o,e[3]=f*c-b*o,e[8]=u*o+g*c,e[9]=h*o+v*c,e[10]=p*o+y*c,e[11]=f*o+b*c,e},ui.rotateZ=function(e,t,i){var o=Math.sin(i),c=Math.cos(i),u=t[0],h=t[1],p=t[2],f=t[3],g=t[4],v=t[5],y=t[6],b=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=u*c+g*o,e[1]=h*c+v*o,e[2]=p*c+y*o,e[3]=f*c+b*o,e[4]=g*c-u*o,e[5]=v*c-h*o,e[6]=y*c-p*o,e[7]=b*c-f*o,e},ui.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},ui.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},ui.fromRotation=function(e,t,i){var o,c,u,h=i[0],p=i[1],f=i[2],g=Math.hypot(h,p,f);return g<Sr.EPSILON?null:(h*=g=1/g,p*=g,f*=g,o=Math.sin(t),c=Math.cos(t),e[0]=h*h*(u=1-c)+c,e[1]=p*h*u+f*o,e[2]=f*h*u-p*o,e[3]=0,e[4]=h*p*u-f*o,e[5]=p*p*u+c,e[6]=f*p*u+h*o,e[7]=0,e[8]=h*f*u+p*o,e[9]=p*f*u-h*o,e[10]=f*f*u+c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},ui.fromXRotation=function(e,t){var i=Math.sin(t),o=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=i,e[7]=0,e[8]=0,e[9]=-i,e[10]=o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},ui.fromYRotation=function(e,t){var i=Math.sin(t),o=Math.cos(t);return e[0]=o,e[1]=0,e[2]=-i,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=i,e[9]=0,e[10]=o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},ui.fromZRotation=function(e,t){var i=Math.sin(t),o=Math.cos(t);return e[0]=o,e[1]=i,e[2]=0,e[3]=0,e[4]=-i,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},ui.fromRotationTranslation=B2,ui.fromQuat2=function(e,t){var i=new Sr.ARRAY_TYPE(3),o=-t[0],c=-t[1],u=-t[2],h=t[3],p=t[4],f=t[5],g=t[6],v=t[7],y=o*o+c*c+u*u+h*h;return y>0?(i[0]=2*(p*h+v*o+f*u-g*c)/y,i[1]=2*(f*h+v*c+g*o-p*u)/y,i[2]=2*(g*h+v*u+p*c-f*o)/y):(i[0]=2*(p*h+v*o+f*u-g*c),i[1]=2*(f*h+v*c+g*o-p*u),i[2]=2*(g*h+v*u+p*c-f*o)),B2(e,t,i),e},ui.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},ui.getScaling=V2,ui.getRotation=function(e,t){var i=new Sr.ARRAY_TYPE(3);V2(i,t);var o=1/i[0],c=1/i[1],u=1/i[2],h=t[0]*o,p=t[1]*c,f=t[2]*u,g=t[4]*o,v=t[5]*c,y=t[6]*u,b=t[8]*o,x=t[9]*c,C=t[10]*u,E=h+v+C,M=0;return E>0?(M=2*Math.sqrt(E+1),e[3]=.25*M,e[0]=(y-x)/M,e[1]=(b-f)/M,e[2]=(p-g)/M):h>v&&h>C?(M=2*Math.sqrt(1+h-v-C),e[3]=(y-x)/M,e[0]=.25*M,e[1]=(p+g)/M,e[2]=(b+f)/M):v>C?(M=2*Math.sqrt(1+v-h-C),e[3]=(b-f)/M,e[0]=(p+g)/M,e[1]=.25*M,e[2]=(y+x)/M):(M=2*Math.sqrt(1+C-h-v),e[3]=(p-g)/M,e[0]=(b+f)/M,e[1]=(y+x)/M,e[2]=.25*M),e},ui.fromRotationTranslationScale=function(e,t,i,o){var c=t[0],u=t[1],h=t[2],p=t[3],f=c+c,g=u+u,v=h+h,y=c*f,b=c*g,x=c*v,C=u*g,E=u*v,M=h*v,D=p*f,I=p*g,P=p*v,O=o[0],R=o[1],F=o[2];return e[0]=(1-(C+M))*O,e[1]=(b+P)*O,e[2]=(x-I)*O,e[3]=0,e[4]=(b-P)*R,e[5]=(1-(y+M))*R,e[6]=(E+D)*R,e[7]=0,e[8]=(x+I)*F,e[9]=(E-D)*F,e[10]=(1-(y+C))*F,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e},ui.fromRotationTranslationScaleOrigin=function(e,t,i,o,c){var u=t[0],h=t[1],p=t[2],f=t[3],g=u+u,v=h+h,y=p+p,b=u*g,x=u*v,C=u*y,E=h*v,M=h*y,D=p*y,I=f*g,P=f*v,O=f*y,R=o[0],F=o[1],z=o[2],j=c[0],U=c[1],G=c[2],$=(1-(E+D))*R,Y=(x+O)*R,tt=(C-P)*R,W=(x-O)*F,rt=(1-(b+D))*F,st=(M+I)*F,pt=(C+P)*z,nt=(M-I)*z,ot=(1-(b+E))*z;return e[0]=$,e[1]=Y,e[2]=tt,e[3]=0,e[4]=W,e[5]=rt,e[6]=st,e[7]=0,e[8]=pt,e[9]=nt,e[10]=ot,e[11]=0,e[12]=i[0]+j-($*j+W*U+pt*G),e[13]=i[1]+U-(Y*j+rt*U+nt*G),e[14]=i[2]+G-(tt*j+st*U+ot*G),e[15]=1,e},ui.fromQuat=function(e,t){var i=t[0],o=t[1],c=t[2],u=t[3],h=i+i,p=o+o,f=c+c,g=i*h,v=o*h,y=o*p,b=c*h,x=c*p,C=c*f,E=u*h,M=u*p,D=u*f;return e[0]=1-y-C,e[1]=v+D,e[2]=b-M,e[3]=0,e[4]=v-D,e[5]=1-g-C,e[6]=x+E,e[7]=0,e[8]=b+M,e[9]=x-E,e[10]=1-g-y,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},ui.frustum=function(e,t,i,o,c,u,h){var p=1/(i-t),f=1/(c-o),g=1/(u-h);return e[0]=2*u*p,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*u*f,e[6]=0,e[7]=0,e[8]=(i+t)*p,e[9]=(c+o)*f,e[10]=(h+u)*g,e[11]=-1,e[12]=0,e[13]=0,e[14]=h*u*2*g,e[15]=0,e},ui.perspectiveNO=j2,ui.perspectiveZO=function(e,t,i,o,c){var u,h=1/Math.tan(t/2);return e[0]=h/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=h,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,c!=null&&c!==1/0?(e[10]=c*(u=1/(o-c)),e[14]=c*o*u):(e[10]=-1,e[14]=-o),e},ui.perspectiveFromFieldOfView=function(e,t,i,o){var c=Math.tan(t.upDegrees*Math.PI/180),u=Math.tan(t.downDegrees*Math.PI/180),h=Math.tan(t.leftDegrees*Math.PI/180),p=Math.tan(t.rightDegrees*Math.PI/180),f=2/(h+p),g=2/(c+u);return e[0]=f,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=g,e[6]=0,e[7]=0,e[8]=-(h-p)*f*.5,e[9]=(c-u)*g*.5,e[10]=o/(i-o),e[11]=-1,e[12]=0,e[13]=0,e[14]=o*i/(i-o),e[15]=0,e},ui.orthoNO=U2,ui.orthoZO=function(e,t,i,o,c,u,h){var p=1/(t-i),f=1/(o-c),g=1/(u-h);return e[0]=-2*p,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*f,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=g,e[11]=0,e[12]=(t+i)*p,e[13]=(c+o)*f,e[14]=u*g,e[15]=1,e},ui.lookAt=function(e,t,i,o){var c,u,h,p,f,g,v,y,b,x,C=t[0],E=t[1],M=t[2],D=o[0],I=o[1],P=o[2],O=i[0],R=i[1],F=i[2];return Math.abs(C-O)<Sr.EPSILON&&Math.abs(E-R)<Sr.EPSILON&&Math.abs(M-F)<Sr.EPSILON?z2(e):(v=C-O,y=E-R,b=M-F,c=I*(b*=x=1/Math.hypot(v,y,b))-P*(y*=x),u=P*(v*=x)-D*b,h=D*y-I*v,(x=Math.hypot(c,u,h))?(c*=x=1/x,u*=x,h*=x):(c=0,u=0,h=0),p=y*h-b*u,f=b*c-v*h,g=v*u-y*c,(x=Math.hypot(p,f,g))?(p*=x=1/x,f*=x,g*=x):(p=0,f=0,g=0),e[0]=c,e[1]=p,e[2]=v,e[3]=0,e[4]=u,e[5]=f,e[6]=y,e[7]=0,e[8]=h,e[9]=g,e[10]=b,e[11]=0,e[12]=-(c*C+u*E+h*M),e[13]=-(p*C+f*E+g*M),e[14]=-(v*C+y*E+b*M),e[15]=1,e)},ui.targetTo=function(e,t,i,o){var c=t[0],u=t[1],h=t[2],p=o[0],f=o[1],g=o[2],v=c-i[0],y=u-i[1],b=h-i[2],x=v*v+y*y+b*b;x>0&&(v*=x=1/Math.sqrt(x),y*=x,b*=x);var C=f*b-g*y,E=g*v-p*b,M=p*y-f*v;return(x=C*C+E*E+M*M)>0&&(C*=x=1/Math.sqrt(x),E*=x,M*=x),e[0]=C,e[1]=E,e[2]=M,e[3]=0,e[4]=y*M-b*E,e[5]=b*C-v*M,e[6]=v*E-y*C,e[7]=0,e[8]=v,e[9]=y,e[10]=b,e[11]=0,e[12]=c,e[13]=u,e[14]=h,e[15]=1,e},ui.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},ui.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},ui.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e[9]=t[9]+i[9],e[10]=t[10]+i[10],e[11]=t[11]+i[11],e[12]=t[12]+i[12],e[13]=t[13]+i[13],e[14]=t[14]+i[14],e[15]=t[15]+i[15],e},ui.subtract=H2,ui.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12]*i,e[13]=t[13]*i,e[14]=t[14]*i,e[15]=t[15]*i,e},ui.multiplyScalarAndAdd=function(e,t,i,o){return e[0]=t[0]+i[0]*o,e[1]=t[1]+i[1]*o,e[2]=t[2]+i[2]*o,e[3]=t[3]+i[3]*o,e[4]=t[4]+i[4]*o,e[5]=t[5]+i[5]*o,e[6]=t[6]+i[6]*o,e[7]=t[7]+i[7]*o,e[8]=t[8]+i[8]*o,e[9]=t[9]+i[9]*o,e[10]=t[10]+i[10]*o,e[11]=t[11]+i[11]*o,e[12]=t[12]+i[12]*o,e[13]=t[13]+i[13]*o,e[14]=t[14]+i[14]*o,e[15]=t[15]+i[15]*o,e},ui.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},ui.equals=function(e,t){var i=e[0],o=e[1],c=e[2],u=e[3],h=e[4],p=e[5],f=e[6],g=e[7],v=e[8],y=e[9],b=e[10],x=e[11],C=e[12],E=e[13],M=e[14],D=e[15],I=t[0],P=t[1],O=t[2],R=t[3],F=t[4],z=t[5],j=t[6],U=t[7],G=t[8],$=t[9],Y=t[10],tt=t[11],W=t[12],rt=t[13],st=t[14],pt=t[15];return Math.abs(i-I)<=Sr.EPSILON*Math.max(1,Math.abs(i),Math.abs(I))&&Math.abs(o-P)<=Sr.EPSILON*Math.max(1,Math.abs(o),Math.abs(P))&&Math.abs(c-O)<=Sr.EPSILON*Math.max(1,Math.abs(c),Math.abs(O))&&Math.abs(u-R)<=Sr.EPSILON*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(h-F)<=Sr.EPSILON*Math.max(1,Math.abs(h),Math.abs(F))&&Math.abs(p-z)<=Sr.EPSILON*Math.max(1,Math.abs(p),Math.abs(z))&&Math.abs(f-j)<=Sr.EPSILON*Math.max(1,Math.abs(f),Math.abs(j))&&Math.abs(g-U)<=Sr.EPSILON*Math.max(1,Math.abs(g),Math.abs(U))&&Math.abs(v-G)<=Sr.EPSILON*Math.max(1,Math.abs(v),Math.abs(G))&&Math.abs(y-$)<=Sr.EPSILON*Math.max(1,Math.abs(y),Math.abs($))&&Math.abs(b-Y)<=Sr.EPSILON*Math.max(1,Math.abs(b),Math.abs(Y))&&Math.abs(x-tt)<=Sr.EPSILON*Math.max(1,Math.abs(x),Math.abs(tt))&&Math.abs(C-W)<=Sr.EPSILON*Math.max(1,Math.abs(C),Math.abs(W))&&Math.abs(E-rt)<=Sr.EPSILON*Math.max(1,Math.abs(E),Math.abs(rt))&&Math.abs(M-st)<=Sr.EPSILON*Math.max(1,Math.abs(M),Math.abs(st))&&Math.abs(D-pt)<=Sr.EPSILON*Math.max(1,Math.abs(D),Math.abs(pt))},ui.sub=ui.mul=ui.ortho=ui.perspective=void 0;var Sr=function(e,t){if(e&&e.__esModule)return e;if(e===null||Sw(e)!=="object"&&typeof e!="function")return{default:e};var i=L2(void 0);if(i&&i.has(e))return i.get(e);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(u!=="default"&&Object.prototype.hasOwnProperty.call(e,u)){var h=c?Object.getOwnPropertyDescriptor(e,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=e[u]}return o.default=e,i&&i.set(e,o),o}(xo);function L2(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(L2=function(o){return o?i:t})(e)}function z2(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function N2(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3],p=t[4],f=t[5],g=t[6],v=t[7],y=t[8],b=t[9],x=t[10],C=t[11],E=t[12],M=t[13],D=t[14],I=t[15],P=i[0],O=i[1],R=i[2],F=i[3];return e[0]=P*o+O*p+R*y+F*E,e[1]=P*c+O*f+R*b+F*M,e[2]=P*u+O*g+R*x+F*D,e[3]=P*h+O*v+R*C+F*I,e[4]=(P=i[4])*o+(O=i[5])*p+(R=i[6])*y+(F=i[7])*E,e[5]=P*c+O*f+R*b+F*M,e[6]=P*u+O*g+R*x+F*D,e[7]=P*h+O*v+R*C+F*I,e[8]=(P=i[8])*o+(O=i[9])*p+(R=i[10])*y+(F=i[11])*E,e[9]=P*c+O*f+R*b+F*M,e[10]=P*u+O*g+R*x+F*D,e[11]=P*h+O*v+R*C+F*I,e[12]=(P=i[12])*o+(O=i[13])*p+(R=i[14])*y+(F=i[15])*E,e[13]=P*c+O*f+R*b+F*M,e[14]=P*u+O*g+R*x+F*D,e[15]=P*h+O*v+R*C+F*I,e}function B2(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3],p=o+o,f=c+c,g=u+u,v=o*p,y=o*f,b=o*g,x=c*f,C=c*g,E=u*g,M=h*p,D=h*f,I=h*g;return e[0]=1-(x+E),e[1]=y+I,e[2]=b-D,e[3]=0,e[4]=y-I,e[5]=1-(v+E),e[6]=C+M,e[7]=0,e[8]=b+D,e[9]=C-M,e[10]=1-(v+x),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function V2(e,t){var i=t[4],o=t[5],c=t[6],u=t[8],h=t[9],p=t[10];return e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(i,o,c),e[2]=Math.hypot(u,h,p),e}function j2(e,t,i,o,c){var u,h=1/Math.tan(t/2);return e[0]=h/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=h,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,c!=null&&c!==1/0?(e[10]=(c+o)*(u=1/(o-c)),e[14]=2*c*o*u):(e[10]=-1,e[14]=-2*o),e}function U2(e,t,i,o,c,u,h){var p=1/(t-i),f=1/(o-c),g=1/(u-h);return e[0]=-2*p,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*f,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*g,e[11]=0,e[12]=(t+i)*p,e[13]=(c+o)*f,e[14]=(h+u)*g,e[15]=1,e}function H2(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e[9]=t[9]-i[9],e[10]=t[10]-i[10],e[11]=t[11]-i[11],e[12]=t[12]-i[12],e[13]=t[13]-i[13],e[14]=t[14]-i[14],e[15]=t[15]-i[15],e}ui.perspective=j2,ui.ortho=U2,ui.mul=N2,ui.sub=H2;var ai={},di={};function Ew(e){return Ew=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ew(e)}Object.defineProperty(di,"__esModule",{value:!0}),di.create=q2,di.clone=function(e){var t=new lc.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},di.length=W2,di.fromValues=function(e,t,i){var o=new lc.ARRAY_TYPE(3);return o[0]=e,o[1]=t,o[2]=i,o},di.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},di.set=function(e,t,i,o){return e[0]=t,e[1]=i,e[2]=o,e},di.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e},di.subtract=$2,di.multiply=Y2,di.divide=Z2,di.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},di.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},di.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e},di.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e},di.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},di.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e},di.scaleAndAdd=function(e,t,i,o){return e[0]=t[0]+i[0]*o,e[1]=t[1]+i[1]*o,e[2]=t[2]+i[2]*o,e},di.distance=X2,di.squaredDistance=K2,di.squaredLength=Q2,di.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},di.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},di.normalize=function(e,t){var i=t[0],o=t[1],c=t[2],u=i*i+o*o+c*c;return u>0&&(u=1/Math.sqrt(u)),e[0]=t[0]*u,e[1]=t[1]*u,e[2]=t[2]*u,e},di.dot=J2,di.cross=function(e,t,i){var o=t[0],c=t[1],u=t[2],h=i[0],p=i[1],f=i[2];return e[0]=c*f-u*p,e[1]=u*h-o*f,e[2]=o*p-c*h,e},di.lerp=function(e,t,i,o){var c=t[0],u=t[1],h=t[2];return e[0]=c+o*(i[0]-c),e[1]=u+o*(i[1]-u),e[2]=h+o*(i[2]-h),e},di.hermite=function(e,t,i,o,c,u){var h=u*u,p=h*(2*u-3)+1,f=h*(u-2)+u,g=h*(u-1),v=h*(3-2*u);return e[0]=t[0]*p+i[0]*f+o[0]*g+c[0]*v,e[1]=t[1]*p+i[1]*f+o[1]*g+c[1]*v,e[2]=t[2]*p+i[2]*f+o[2]*g+c[2]*v,e},di.bezier=function(e,t,i,o,c,u){var h=1-u,p=h*h,f=u*u,g=p*h,v=3*u*p,y=3*f*h,b=f*u;return e[0]=t[0]*g+i[0]*v+o[0]*y+c[0]*b,e[1]=t[1]*g+i[1]*v+o[1]*y+c[1]*b,e[2]=t[2]*g+i[2]*v+o[2]*y+c[2]*b,e},di.random=function(e,t){t=t||1;var i=2*lc.RANDOM()*Math.PI,o=2*lc.RANDOM()-1,c=Math.sqrt(1-o*o)*t;return e[0]=Math.cos(i)*c,e[1]=Math.sin(i)*c,e[2]=o*t,e},di.transformMat4=function(e,t,i){var o=t[0],c=t[1],u=t[2],h=i[3]*o+i[7]*c+i[11]*u+i[15];return e[0]=(i[0]*o+i[4]*c+i[8]*u+i[12])/(h=h||1),e[1]=(i[1]*o+i[5]*c+i[9]*u+i[13])/h,e[2]=(i[2]*o+i[6]*c+i[10]*u+i[14])/h,e},di.transformMat3=function(e,t,i){var o=t[0],c=t[1],u=t[2];return e[0]=o*i[0]+c*i[3]+u*i[6],e[1]=o*i[1]+c*i[4]+u*i[7],e[2]=o*i[2]+c*i[5]+u*i[8],e},di.transformQuat=function(e,t,i){var o=i[0],c=i[1],u=i[2],h=t[0],p=t[1],f=t[2],g=c*f-u*p,v=u*h-o*f,y=o*p-c*h,b=c*y-u*v,x=u*g-o*y,C=o*v-c*g,E=2*i[3];return v*=E,y*=E,x*=2,C*=2,e[0]=h+(g*=E)+(b*=2),e[1]=p+v+x,e[2]=f+y+C,e},di.rotateX=function(e,t,i,o){var c=[],u=[];return c[0]=t[0]-i[0],c[1]=t[1]-i[1],c[2]=t[2]-i[2],u[0]=c[0],u[1]=c[1]*Math.cos(o)-c[2]*Math.sin(o),u[2]=c[1]*Math.sin(o)+c[2]*Math.cos(o),e[0]=u[0]+i[0],e[1]=u[1]+i[1],e[2]=u[2]+i[2],e},di.rotateY=function(e,t,i,o){var c=[],u=[];return c[0]=t[0]-i[0],c[1]=t[1]-i[1],c[2]=t[2]-i[2],u[0]=c[2]*Math.sin(o)+c[0]*Math.cos(o),u[1]=c[1],u[2]=c[2]*Math.cos(o)-c[0]*Math.sin(o),e[0]=u[0]+i[0],e[1]=u[1]+i[1],e[2]=u[2]+i[2],e},di.rotateZ=function(e,t,i,o){var c=[],u=[];return c[0]=t[0]-i[0],c[1]=t[1]-i[1],c[2]=t[2]-i[2],u[0]=c[0]*Math.cos(o)-c[1]*Math.sin(o),u[1]=c[0]*Math.sin(o)+c[1]*Math.cos(o),u[2]=c[2],e[0]=u[0]+i[0],e[1]=u[1]+i[1],e[2]=u[2]+i[2],e},di.angle=function(e,t){var i=e[0],o=e[1],c=e[2],u=t[0],h=t[1],p=t[2],f=Math.sqrt(i*i+o*o+c*c)*Math.sqrt(u*u+h*h+p*p),g=f&&J2(e,t)/f;return Math.acos(Math.min(Math.max(g,-1),1))},di.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e},di.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},di.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},di.equals=function(e,t){var i=e[0],o=e[1],c=e[2],u=t[0],h=t[1],p=t[2];return Math.abs(i-u)<=lc.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-h)<=lc.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(c-p)<=lc.EPSILON*Math.max(1,Math.abs(c),Math.abs(p))},di.forEach=di.sqrLen=di.len=di.sqrDist=di.dist=di.div=di.mul=di.sub=void 0;var lc=function(e,t){if(e&&e.__esModule)return e;if(e===null||Ew(e)!=="object"&&typeof e!="function")return{default:e};var i=G2(void 0);if(i&&i.has(e))return i.get(e);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(u!=="default"&&Object.prototype.hasOwnProperty.call(e,u)){var h=c?Object.getOwnPropertyDescriptor(e,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=e[u]}return o.default=e,i&&i.set(e,o),o}(xo);function G2(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(G2=function(o){return o?i:t})(e)}function q2(){var e=new lc.ARRAY_TYPE(3);return lc.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function W2(e){return Math.hypot(e[0],e[1],e[2])}function $2(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function Y2(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function Z2(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e}function X2(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])}function K2(e,t){var i=t[0]-e[0],o=t[1]-e[1],c=t[2]-e[2];return i*i+o*o+c*c}function Q2(e){var t=e[0],i=e[1],o=e[2];return t*t+i*i+o*o}function J2(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}di.sub=$2,di.mul=Y2,di.div=Z2,di.dist=X2,di.sqrDist=K2,di.len=W2,di.sqrLen=Q2;var cc,BU=(cc=q2(),function(e,t,i,o,c,u){var h,p;for(t||(t=3),i||(i=0),p=o?Math.min(o*t+i,e.length):e.length,h=i;h<p;h+=t)cc[0]=e[h],cc[1]=e[h+1],cc[2]=e[h+2],c(cc,cc,u),e[h]=cc[0],e[h+1]=cc[1],e[h+2]=cc[2];return e});di.forEach=BU;var Mi={};function Mw(e){return Mw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mw(e)}Object.defineProperty(Mi,"__esModule",{value:!0}),Mi.create=eA,Mi.clone=function(e){var t=new da.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Mi.fromValues=function(e,t,i,o){var c=new da.ARRAY_TYPE(4);return c[0]=e,c[1]=t,c[2]=i,c[3]=o,c},Mi.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Mi.set=function(e,t,i,o,c){return e[0]=t,e[1]=i,e[2]=o,e[3]=c,e},Mi.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e},Mi.subtract=iA,Mi.multiply=nA,Mi.divide=rA,Mi.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},Mi.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},Mi.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e[3]=Math.min(t[3],i[3]),e},Mi.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e[3]=Math.max(t[3],i[3]),e},Mi.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},Mi.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},Mi.scaleAndAdd=function(e,t,i,o){return e[0]=t[0]+i[0]*o,e[1]=t[1]+i[1]*o,e[2]=t[2]+i[2]*o,e[3]=t[3]+i[3]*o,e},Mi.distance=oA,Mi.squaredDistance=sA,Mi.length=aA,Mi.squaredLength=lA,Mi.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},Mi.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},Mi.normalize=function(e,t){var i=t[0],o=t[1],c=t[2],u=t[3],h=i*i+o*o+c*c+u*u;return h>0&&(h=1/Math.sqrt(h)),e[0]=i*h,e[1]=o*h,e[2]=c*h,e[3]=u*h,e},Mi.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},Mi.cross=function(e,t,i,o){var c=i[0]*o[1]-i[1]*o[0],u=i[0]*o[2]-i[2]*o[0],h=i[0]*o[3]-i[3]*o[0],p=i[1]*o[2]-i[2]*o[1],f=i[1]*o[3]-i[3]*o[1],g=i[2]*o[3]-i[3]*o[2],v=t[0],y=t[1],b=t[2],x=t[3];return e[0]=y*g-b*f+x*p,e[1]=-v*g+b*h-x*u,e[2]=v*f-y*h+x*c,e[3]=-v*p+y*u-b*c,e},Mi.lerp=function(e,t,i,o){var c=t[0],u=t[1],h=t[2],p=t[3];return e[0]=c+o*(i[0]-c),e[1]=u+o*(i[1]-u),e[2]=h+o*(i[2]-h),e[3]=p+o*(i[3]-p),e},Mi.random=function(e,t){var i,o,c,u,h,p;t=t||1;do h=(i=2*da.RANDOM()-1)*i+(o=2*da.RANDOM()-1)*o;while(h>=1);do p=(c=2*da.RANDOM()-1)*c+(u=2*da.RANDOM()-1)*u;while(p>=1);var f=Math.sqrt((1-h)/p);return e[0]=t*i,e[1]=t*o,e[2]=t*c*f,e[3]=t*u*f,e},Mi.transformMat4=function(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3];return e[0]=i[0]*o+i[4]*c+i[8]*u+i[12]*h,e[1]=i[1]*o+i[5]*c+i[9]*u+i[13]*h,e[2]=i[2]*o+i[6]*c+i[10]*u+i[14]*h,e[3]=i[3]*o+i[7]*c+i[11]*u+i[15]*h,e},Mi.transformQuat=function(e,t,i){var o=t[0],c=t[1],u=t[2],h=i[0],p=i[1],f=i[2],g=i[3],v=g*o+p*u-f*c,y=g*c+f*o-h*u,b=g*u+h*c-p*o,x=-h*o-p*c-f*u;return e[0]=v*g+x*-h+y*-f-b*-p,e[1]=y*g+x*-p+b*-h-v*-f,e[2]=b*g+x*-f+v*-p-y*-h,e[3]=t[3],e},Mi.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},Mi.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},Mi.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},Mi.equals=function(e,t){var i=e[0],o=e[1],c=e[2],u=e[3],h=t[0],p=t[1],f=t[2],g=t[3];return Math.abs(i-h)<=da.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-p)<=da.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(c-f)<=da.EPSILON*Math.max(1,Math.abs(c),Math.abs(f))&&Math.abs(u-g)<=da.EPSILON*Math.max(1,Math.abs(u),Math.abs(g))},Mi.forEach=Mi.sqrLen=Mi.len=Mi.sqrDist=Mi.dist=Mi.div=Mi.mul=Mi.sub=void 0;var da=function(e,t){if(e&&e.__esModule)return e;if(e===null||Mw(e)!=="object"&&typeof e!="function")return{default:e};var i=tA(void 0);if(i&&i.has(e))return i.get(e);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(u!=="default"&&Object.prototype.hasOwnProperty.call(e,u)){var h=c?Object.getOwnPropertyDescriptor(e,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=e[u]}return o.default=e,i&&i.set(e,o),o}(xo);function tA(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(tA=function(o){return o?i:t})(e)}function eA(){var e=new da.ARRAY_TYPE(4);return da.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function iA(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function nA(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}function rA(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e[3]=t[3]/i[3],e}function oA(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3])}function sA(e,t){var i=t[0]-e[0],o=t[1]-e[1],c=t[2]-e[2],u=t[3]-e[3];return i*i+o*o+c*c+u*u}function aA(e){return Math.hypot(e[0],e[1],e[2],e[3])}function lA(e){var t=e[0],i=e[1],o=e[2],c=e[3];return t*t+i*i+o*o+c*c}Mi.sub=iA,Mi.mul=nA,Mi.div=rA,Mi.dist=oA,Mi.sqrDist=sA,Mi.len=aA,Mi.sqrLen=lA;var VU=function(){var e=eA();return function(t,i,o,c,u,h){var p,f;for(i||(i=4),o||(o=0),f=c?Math.min(c*i+o,t.length):t.length,p=o;p<f;p+=i)e[0]=t[p],e[1]=t[p+1],e[2]=t[p+2],e[3]=t[p+3],u(e,e,h),t[p]=e[0],t[p+1]=e[1],t[p+2]=e[2],t[p+3]=e[3];return t}}();function Dw(e){return Dw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dw(e)}Mi.forEach=VU,Object.defineProperty(ai,"__esModule",{value:!0}),ai.create=Tw,ai.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},ai.setAxisAngle=dA,ai.getAxisAngle=function(e,t){var i=2*Math.acos(t[3]),o=Math.sin(i/2);return o>nu.EPSILON?(e[0]=t[0]/o,e[1]=t[1]/o,e[2]=t[2]/o):(e[0]=1,e[1]=0,e[2]=0),i},ai.getAngle=function(e,t){var i=gA(e,t);return Math.acos(2*i*i-1)},ai.multiply=uA,ai.rotateX=function(e,t,i){i*=.5;var o=t[0],c=t[1],u=t[2],h=t[3],p=Math.sin(i),f=Math.cos(i);return e[0]=o*f+h*p,e[1]=c*f+u*p,e[2]=u*f-c*p,e[3]=h*f-o*p,e},ai.rotateY=function(e,t,i){i*=.5;var o=t[0],c=t[1],u=t[2],h=t[3],p=Math.sin(i),f=Math.cos(i);return e[0]=o*f-u*p,e[1]=c*f+h*p,e[2]=u*f+o*p,e[3]=h*f-c*p,e},ai.rotateZ=function(e,t,i){i*=.5;var o=t[0],c=t[1],u=t[2],h=t[3],p=Math.sin(i),f=Math.cos(i);return e[0]=o*f+c*p,e[1]=c*f-o*p,e[2]=u*f+h*p,e[3]=h*f-u*p,e},ai.calculateW=function(e,t){var i=t[0],o=t[1],c=t[2];return e[0]=i,e[1]=o,e[2]=c,e[3]=Math.sqrt(Math.abs(1-i*i-o*o-c*c)),e},ai.exp=hA,ai.ln=mA,ai.pow=function(e,t,i){return mA(e,t),fA(e,e,i),hA(e,e),e},ai.slerp=j_,ai.random=function(e){var t=nu.RANDOM(),i=nu.RANDOM(),o=nu.RANDOM(),c=Math.sqrt(1-t),u=Math.sqrt(t);return e[0]=c*Math.sin(2*Math.PI*i),e[1]=c*Math.cos(2*Math.PI*i),e[2]=u*Math.sin(2*Math.PI*o),e[3]=u*Math.cos(2*Math.PI*o),e},ai.invert=function(e,t){var i=t[0],o=t[1],c=t[2],u=t[3],h=i*i+o*o+c*c+u*u,p=h?1/h:0;return e[0]=-i*p,e[1]=-o*p,e[2]=-c*p,e[3]=u*p,e},ai.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},ai.fromMat3=pA,ai.fromEuler=function(e,t,i,o){var c=.5*Math.PI/180;t*=c,i*=c,o*=c;var u=Math.sin(t),h=Math.cos(t),p=Math.sin(i),f=Math.cos(i),g=Math.sin(o),v=Math.cos(o);return e[0]=u*f*v-h*p*g,e[1]=h*p*v+u*f*g,e[2]=h*f*g-u*p*v,e[3]=h*f*v+u*p*g,e},ai.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},ai.setAxes=ai.sqlerp=ai.rotationTo=ai.equals=ai.exactEquals=ai.normalize=ai.sqrLen=ai.squaredLength=ai.len=ai.length=ai.lerp=ai.dot=ai.scale=ai.mul=ai.add=ai.set=ai.copy=ai.fromValues=ai.clone=void 0;var nu=V_(xo),jU=V_(yn),dc=V_(di),qs=V_(Mi);function cA(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(cA=function(o){return o?i:t})(e)}function V_(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||Dw(e)!=="object"&&typeof e!="function")return{default:e};var i=cA(t);if(i&&i.has(e))return i.get(e);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(u!=="default"&&Object.prototype.hasOwnProperty.call(e,u)){var h=c?Object.getOwnPropertyDescriptor(e,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=e[u]}return o.default=e,i&&i.set(e,o),o}function Tw(){var e=new nu.ARRAY_TYPE(4);return nu.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function dA(e,t,i){i*=.5;var o=Math.sin(i);return e[0]=o*t[0],e[1]=o*t[1],e[2]=o*t[2],e[3]=Math.cos(i),e}function uA(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3],p=i[0],f=i[1],g=i[2],v=i[3];return e[0]=o*v+h*p+c*g-u*f,e[1]=c*v+h*f+u*p-o*g,e[2]=u*v+h*g+o*f-c*p,e[3]=h*v-o*p-c*f-u*g,e}function hA(e,t){var i=t[0],o=t[1],c=t[2],u=t[3],h=Math.sqrt(i*i+o*o+c*c),p=Math.exp(u),f=h>0?p*Math.sin(h)/h:0;return e[0]=i*f,e[1]=o*f,e[2]=c*f,e[3]=p*Math.cos(h),e}function mA(e,t){var i=t[0],o=t[1],c=t[2],u=t[3],h=Math.sqrt(i*i+o*o+c*c),p=h>0?Math.atan2(h,u)/h:0;return e[0]=i*p,e[1]=o*p,e[2]=c*p,e[3]=.5*Math.log(i*i+o*o+c*c+u*u),e}function j_(e,t,i,o){var c,u,h,p,f,g=t[0],v=t[1],y=t[2],b=t[3],x=i[0],C=i[1],E=i[2],M=i[3];return(u=g*x+v*C+y*E+b*M)<0&&(u=-u,x=-x,C=-C,E=-E,M=-M),1-u>nu.EPSILON?(c=Math.acos(u),h=Math.sin(c),p=Math.sin((1-o)*c)/h,f=Math.sin(o*c)/h):(p=1-o,f=o),e[0]=p*g+f*x,e[1]=p*v+f*C,e[2]=p*y+f*E,e[3]=p*b+f*M,e}function pA(e,t){var i,o=t[0]+t[4]+t[8];if(o>0)i=Math.sqrt(o+1),e[3]=.5*i,e[0]=(t[5]-t[7])*(i=.5/i),e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{var c=0;t[4]>t[0]&&(c=1),t[8]>t[3*c+c]&&(c=2);var u=(c+1)%3,h=(c+2)%3;i=Math.sqrt(t[3*c+c]-t[3*u+u]-t[3*h+h]+1),e[c]=.5*i,e[3]=(t[3*u+h]-t[3*h+u])*(i=.5/i),e[u]=(t[3*u+c]+t[3*c+u])*i,e[h]=(t[3*h+c]+t[3*c+h])*i}return e}ai.clone=qs.clone,ai.fromValues=qs.fromValues,ai.copy=qs.copy,ai.set=qs.set,ai.add=qs.add,ai.mul=uA;var fA=qs.scale;ai.scale=fA;var gA=qs.dot;ai.dot=gA,ai.lerp=qs.lerp;var _A=qs.length;ai.length=_A,ai.len=_A;var vA=qs.squaredLength;ai.squaredLength=vA,ai.sqrLen=vA;var Iw=qs.normalize;ai.normalize=Iw,ai.exactEquals=qs.exactEquals,ai.equals=qs.equals;var Za,yA,bA,UU=(Za=dc.create(),yA=dc.fromValues(1,0,0),bA=dc.fromValues(0,1,0),function(e,t,i){var o=dc.dot(t,i);return o<-.999999?(dc.cross(Za,yA,t),dc.len(Za)<1e-6&&dc.cross(Za,bA,t),dc.normalize(Za,Za),dA(e,Za,Math.PI),e):o>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(dc.cross(Za,t,i),e[0]=Za[0],e[1]=Za[1],e[2]=Za[2],e[3]=1+o,Iw(e,e))});ai.rotationTo=UU;var Aw,kw,HU=(Aw=Tw(),kw=Tw(),function(e,t,i,o,c,u){return j_(Aw,t,c,u),j_(kw,i,o,u),j_(e,Aw,kw,2*u*(1-u)),e});ai.sqlerp=HU;var Xa,GU=(Xa=jU.create(),function(e,t,i,o){return Xa[0]=i[0],Xa[3]=i[1],Xa[6]=i[2],Xa[1]=o[0],Xa[4]=o[1],Xa[7]=o[2],Xa[2]=-t[0],Xa[5]=-t[1],Xa[8]=-t[2],Iw(e,pA(e,Xa))});ai.setAxes=GU;var Li={};function Rw(e){return Rw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rw(e)}Object.defineProperty(Li,"__esModule",{value:!0}),Li.create=function(){var e=new cs.ARRAY_TYPE(8);return cs.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},Li.clone=function(e){var t=new cs.ARRAY_TYPE(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},Li.fromValues=function(e,t,i,o,c,u,h,p){var f=new cs.ARRAY_TYPE(8);return f[0]=e,f[1]=t,f[2]=i,f[3]=o,f[4]=c,f[5]=u,f[6]=h,f[7]=p,f},Li.fromRotationTranslationValues=function(e,t,i,o,c,u,h){var p=new cs.ARRAY_TYPE(8);p[0]=e,p[1]=t,p[2]=i,p[3]=o;var f=.5*c,g=.5*u,v=.5*h;return p[4]=f*o+g*i-v*t,p[5]=g*o+v*e-f*i,p[6]=v*o+f*t-g*e,p[7]=-f*e-g*t-v*i,p},Li.fromRotationTranslation=CA,Li.fromTranslation=function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},Li.fromRotation=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},Li.fromMat4=function(e,t){var i=uc.create();xA.getRotation(i,t);var o=new cs.ARRAY_TYPE(3);return xA.getTranslation(o,t),CA(e,i,o),e},Li.copy=SA,Li.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},Li.set=function(e,t,i,o,c,u,h,p,f){return e[0]=t,e[1]=i,e[2]=o,e[3]=c,e[4]=u,e[5]=h,e[6]=p,e[7]=f,e},Li.getDual=function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},Li.setDual=function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},Li.getTranslation=function(e,t){var i=t[4],o=t[5],c=t[6],u=t[7],h=-t[0],p=-t[1],f=-t[2],g=t[3];return e[0]=2*(i*g+u*h+o*f-c*p),e[1]=2*(o*g+u*p+c*h-i*f),e[2]=2*(c*g+u*f+i*p-o*h),e},Li.translate=function(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3],p=.5*i[0],f=.5*i[1],g=.5*i[2],v=t[4],y=t[5],b=t[6],x=t[7];return e[0]=o,e[1]=c,e[2]=u,e[3]=h,e[4]=h*p+c*g-u*f+v,e[5]=h*f+u*p-o*g+y,e[6]=h*g+o*f-c*p+b,e[7]=-o*p-c*f-u*g+x,e},Li.rotateX=function(e,t,i){var o=-t[0],c=-t[1],u=-t[2],h=t[3],p=t[4],f=t[5],g=t[6],v=t[7],y=p*h+v*o+f*u-g*c,b=f*h+v*c+g*o-p*u,x=g*h+v*u+p*c-f*o,C=v*h-p*o-f*c-g*u;return uc.rotateX(e,t,i),e[4]=y*(h=e[3])+C*(o=e[0])+b*(u=e[2])-x*(c=e[1]),e[5]=b*h+C*c+x*o-y*u,e[6]=x*h+C*u+y*c-b*o,e[7]=C*h-y*o-b*c-x*u,e},Li.rotateY=function(e,t,i){var o=-t[0],c=-t[1],u=-t[2],h=t[3],p=t[4],f=t[5],g=t[6],v=t[7],y=p*h+v*o+f*u-g*c,b=f*h+v*c+g*o-p*u,x=g*h+v*u+p*c-f*o,C=v*h-p*o-f*c-g*u;return uc.rotateY(e,t,i),e[4]=y*(h=e[3])+C*(o=e[0])+b*(u=e[2])-x*(c=e[1]),e[5]=b*h+C*c+x*o-y*u,e[6]=x*h+C*u+y*c-b*o,e[7]=C*h-y*o-b*c-x*u,e},Li.rotateZ=function(e,t,i){var o=-t[0],c=-t[1],u=-t[2],h=t[3],p=t[4],f=t[5],g=t[6],v=t[7],y=p*h+v*o+f*u-g*c,b=f*h+v*c+g*o-p*u,x=g*h+v*u+p*c-f*o,C=v*h-p*o-f*c-g*u;return uc.rotateZ(e,t,i),e[4]=y*(h=e[3])+C*(o=e[0])+b*(u=e[2])-x*(c=e[1]),e[5]=b*h+C*c+x*o-y*u,e[6]=x*h+C*u+y*c-b*o,e[7]=C*h-y*o-b*c-x*u,e},Li.rotateByQuatAppend=function(e,t,i){var o=i[0],c=i[1],u=i[2],h=i[3],p=t[0],f=t[1],g=t[2],v=t[3];return e[0]=p*h+v*o+f*u-g*c,e[1]=f*h+v*c+g*o-p*u,e[2]=g*h+v*u+p*c-f*o,e[3]=v*h-p*o-f*c-g*u,e[4]=(p=t[4])*h+(v=t[7])*o+(f=t[5])*u-(g=t[6])*c,e[5]=f*h+v*c+g*o-p*u,e[6]=g*h+v*u+p*c-f*o,e[7]=v*h-p*o-f*c-g*u,e},Li.rotateByQuatPrepend=function(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3],p=i[0],f=i[1],g=i[2],v=i[3];return e[0]=o*v+h*p+c*g-u*f,e[1]=c*v+h*f+u*p-o*g,e[2]=u*v+h*g+o*f-c*p,e[3]=h*v-o*p-c*f-u*g,e[4]=o*(v=i[7])+h*(p=i[4])+c*(g=i[6])-u*(f=i[5]),e[5]=c*v+h*f+u*p-o*g,e[6]=u*v+h*g+o*f-c*p,e[7]=h*v-o*p-c*f-u*g,e},Li.rotateAroundAxis=function(e,t,i,o){if(Math.abs(o)<cs.EPSILON)return SA(e,t);var c=Math.hypot(i[0],i[1],i[2]);o*=.5;var u=Math.sin(o),h=u*i[0]/c,p=u*i[1]/c,f=u*i[2]/c,g=Math.cos(o),v=t[0],y=t[1],b=t[2],x=t[3];e[0]=v*g+x*h+y*f-b*p,e[1]=y*g+x*p+b*h-v*f,e[2]=b*g+x*f+v*p-y*h,e[3]=x*g-v*h-y*p-b*f;var C=t[4],E=t[5],M=t[6],D=t[7];return e[4]=C*g+D*h+E*f-M*p,e[5]=E*g+D*p+M*h-C*f,e[6]=M*g+D*f+C*p-E*h,e[7]=D*g-C*h-E*p-M*f,e},Li.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e},Li.multiply=EA,Li.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e},Li.lerp=function(e,t,i,o){var c=1-o;return MA(t,i)<0&&(o=-o),e[0]=t[0]*c+i[0]*o,e[1]=t[1]*c+i[1]*o,e[2]=t[2]*c+i[2]*o,e[3]=t[3]*c+i[3]*o,e[4]=t[4]*c+i[4]*o,e[5]=t[5]*c+i[5]*o,e[6]=t[6]*c+i[6]*o,e[7]=t[7]*c+i[7]*o,e},Li.invert=function(e,t){var i=U_(t);return e[0]=-t[0]/i,e[1]=-t[1]/i,e[2]=-t[2]/i,e[3]=t[3]/i,e[4]=-t[4]/i,e[5]=-t[5]/i,e[6]=-t[6]/i,e[7]=t[7]/i,e},Li.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},Li.normalize=function(e,t){var i=U_(t);if(i>0){i=Math.sqrt(i);var o=t[0]/i,c=t[1]/i,u=t[2]/i,h=t[3]/i,p=t[4],f=t[5],g=t[6],v=t[7],y=o*p+c*f+u*g+h*v;e[0]=o,e[1]=c,e[2]=u,e[3]=h,e[4]=(p-o*y)/i,e[5]=(f-c*y)/i,e[6]=(g-u*y)/i,e[7]=(v-h*y)/i}return e},Li.str=function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},Li.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},Li.equals=function(e,t){var i=e[0],o=e[1],c=e[2],u=e[3],h=e[4],p=e[5],f=e[6],g=e[7],v=t[0],y=t[1],b=t[2],x=t[3],C=t[4],E=t[5],M=t[6],D=t[7];return Math.abs(i-v)<=cs.EPSILON*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(o-y)<=cs.EPSILON*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(c-b)<=cs.EPSILON*Math.max(1,Math.abs(c),Math.abs(b))&&Math.abs(u-x)<=cs.EPSILON*Math.max(1,Math.abs(u),Math.abs(x))&&Math.abs(h-C)<=cs.EPSILON*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(p-E)<=cs.EPSILON*Math.max(1,Math.abs(p),Math.abs(E))&&Math.abs(f-M)<=cs.EPSILON*Math.max(1,Math.abs(f),Math.abs(M))&&Math.abs(g-D)<=cs.EPSILON*Math.max(1,Math.abs(g),Math.abs(D))},Li.sqrLen=Li.squaredLength=Li.len=Li.length=Li.dot=Li.mul=Li.setReal=Li.getReal=void 0;var cs=Pw(xo),uc=Pw(ai),xA=Pw(ui);function wA(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(wA=function(o){return o?i:t})(e)}function Pw(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||Rw(e)!=="object"&&typeof e!="function")return{default:e};var i=wA(t);if(i&&i.has(e))return i.get(e);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(u!=="default"&&Object.prototype.hasOwnProperty.call(e,u)){var h=c?Object.getOwnPropertyDescriptor(e,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=e[u]}return o.default=e,i&&i.set(e,o),o}function CA(e,t,i){var o=.5*i[0],c=.5*i[1],u=.5*i[2],h=t[0],p=t[1],f=t[2],g=t[3];return e[0]=h,e[1]=p,e[2]=f,e[3]=g,e[4]=o*g+c*f-u*p,e[5]=c*g+u*h-o*f,e[6]=u*g+o*p-c*h,e[7]=-o*h-c*p-u*f,e}function SA(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function EA(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3],p=i[4],f=i[5],g=i[6],v=i[7],y=t[4],b=t[5],x=t[6],C=t[7],E=i[0],M=i[1],D=i[2],I=i[3];return e[0]=o*I+h*E+c*D-u*M,e[1]=c*I+h*M+u*E-o*D,e[2]=u*I+h*D+o*M-c*E,e[3]=h*I-o*E-c*M-u*D,e[4]=o*v+h*p+c*g-u*f+y*I+C*E+b*D-x*M,e[5]=c*v+h*f+u*p-o*g+b*I+C*M+x*E-y*D,e[6]=u*v+h*g+o*f-c*p+x*I+C*D+y*M-b*E,e[7]=h*v-o*p-c*f-u*g+C*I-y*E-b*M-x*D,e}Li.getReal=uc.copy,Li.setReal=uc.copy,Li.mul=EA;var MA=uc.dot;Li.dot=MA;var DA=uc.length;Li.length=DA,Li.len=DA;var U_=uc.squaredLength;Li.squaredLength=U_,Li.sqrLen=U_;var _i={};function Ow(e){return Ow=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ow(e)}Object.defineProperty(_i,"__esModule",{value:!0}),_i.create=IA,_i.clone=function(e){var t=new ru.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},_i.fromValues=function(e,t){var i=new ru.ARRAY_TYPE(2);return i[0]=e,i[1]=t,i},_i.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},_i.set=function(e,t,i){return e[0]=t,e[1]=i,e},_i.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e},_i.subtract=AA,_i.multiply=kA,_i.divide=RA,_i.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},_i.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},_i.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e},_i.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e},_i.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},_i.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e},_i.scaleAndAdd=function(e,t,i,o){return e[0]=t[0]+i[0]*o,e[1]=t[1]+i[1]*o,e},_i.distance=PA,_i.squaredDistance=OA,_i.length=FA,_i.squaredLength=LA,_i.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},_i.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},_i.normalize=function(e,t){var i=t[0],o=t[1],c=i*i+o*o;return c>0&&(c=1/Math.sqrt(c)),e[0]=t[0]*c,e[1]=t[1]*c,e},_i.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},_i.cross=function(e,t,i){var o=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=o,e},_i.lerp=function(e,t,i,o){var c=t[0],u=t[1];return e[0]=c+o*(i[0]-c),e[1]=u+o*(i[1]-u),e},_i.random=function(e,t){t=t||1;var i=2*ru.RANDOM()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e},_i.transformMat2=function(e,t,i){var o=t[0],c=t[1];return e[0]=i[0]*o+i[2]*c,e[1]=i[1]*o+i[3]*c,e},_i.transformMat2d=function(e,t,i){var o=t[0],c=t[1];return e[0]=i[0]*o+i[2]*c+i[4],e[1]=i[1]*o+i[3]*c+i[5],e},_i.transformMat3=function(e,t,i){var o=t[0],c=t[1];return e[0]=i[0]*o+i[3]*c+i[6],e[1]=i[1]*o+i[4]*c+i[7],e},_i.transformMat4=function(e,t,i){var o=t[0],c=t[1];return e[0]=i[0]*o+i[4]*c+i[12],e[1]=i[1]*o+i[5]*c+i[13],e},_i.rotate=function(e,t,i,o){var c=t[0]-i[0],u=t[1]-i[1],h=Math.sin(o),p=Math.cos(o);return e[0]=c*p-u*h+i[0],e[1]=c*h+u*p+i[1],e},_i.angle=function(e,t){var i=e[0],o=e[1],c=t[0],u=t[1],h=Math.sqrt(i*i+o*o)*Math.sqrt(c*c+u*u);return Math.acos(Math.min(Math.max(h&&(i*c+o*u)/h,-1),1))},_i.zero=function(e){return e[0]=0,e[1]=0,e},_i.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},_i.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},_i.equals=function(e,t){var i=e[0],o=e[1],c=t[0],u=t[1];return Math.abs(i-c)<=ru.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(o-u)<=ru.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))},_i.forEach=_i.sqrLen=_i.sqrDist=_i.dist=_i.div=_i.mul=_i.sub=_i.len=void 0;var ru=function(e,t){if(e&&e.__esModule)return e;if(e===null||Ow(e)!=="object"&&typeof e!="function")return{default:e};var i=TA(void 0);if(i&&i.has(e))return i.get(e);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(u!=="default"&&Object.prototype.hasOwnProperty.call(e,u)){var h=c?Object.getOwnPropertyDescriptor(e,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=e[u]}return o.default=e,i&&i.set(e,o),o}(xo);function TA(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(TA=function(o){return o?i:t})(e)}function IA(){var e=new ru.ARRAY_TYPE(2);return ru.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function AA(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function kA(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e}function RA(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e}function PA(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1])}function OA(e,t){var i=t[0]-e[0],o=t[1]-e[1];return i*i+o*o}function FA(e){return Math.hypot(e[0],e[1])}function LA(e){var t=e[0],i=e[1];return t*t+i*i}_i.len=FA,_i.sub=AA,_i.mul=kA,_i.div=RA,_i.dist=PA,_i.sqrDist=OA,_i.sqrLen=LA;var qU=function(){var e=IA();return function(t,i,o,c,u,h){var p,f;for(i||(i=2),o||(o=0),f=c?Math.min(c*i+o,t.length):t.length,p=o;p<f;p+=i)e[0]=t[p],e[1]=t[p+1],u(e,e,h),t[p]=e[0],t[p+1]=e[1];return t}}();function Fw(e){return Fw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fw(e)}_i.forEach=qU,Object.defineProperty(bo,"__esModule",{value:!0});var un=bo.vec4=J=bo.vec3=bo.vec2=bo.quat2=Bo=bo.quat=ft=bo.mat4=ds=bo.mat3=bo.mat2d=_h=bo.mat2=bo.glMatrix=void 0,WU=Ml(xo);bo.glMatrix=WU;var $U=Ml(er),_h=bo.mat2=$U,YU=Ml(cr);bo.mat2d=YU;var ZU=Ml(yn),ds=bo.mat3=ZU,XU=Ml(ui),ft=bo.mat4=XU,KU=Ml(ai),Bo=bo.quat=KU,QU=Ml(Li);bo.quat2=QU;var JU=Ml(_i);bo.vec2=JU;var t6=Ml(di),J=bo.vec3=t6,e6=Ml(Mi);function zA(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(zA=function(o){return o?i:t})(e)}function Ml(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||Fw(e)!=="object"&&typeof e!="function")return{default:e};var i=zA(t);if(i&&i.has(e))return i.get(e);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(u!=="default"&&Object.prototype.hasOwnProperty.call(e,u)){var h=c?Object.getOwnPropertyDescriptor(e,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=e[u]}return o.default=e,i&&i.set(e,o),o}un=bo.vec4=e6;let i6=Qi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:H_}=i6,NA=Qi([{name:"a_pos_3",components:3,type:"Int16"}]);var Zc=Qi([{name:"a_pos",type:"Int16",components:2}]),BA={};(function(e,t){(function(i){function o(u,h,p){var f=c(256*u,256*(h=Math.pow(2,p)-h-1),p),g=c(256*(u+1),256*(h+1),p);return f[0]+","+f[1]+","+g[0]+","+g[1]}function c(u,h,p){var f=2*Math.PI*6378137/256/Math.pow(2,p);return[u*f-2*Math.PI*6378137/2,h*f-2*Math.PI*6378137/2]}i.getURL=function(u,h,p,f,g,v){return v=v||{},u+"?"+["bbox="+o(p,f,g),"format="+(v.format||"image/png"),"service="+(v.service||"WMS"),"version="+(v.version||"1.1.1"),"request="+(v.request||"GetMap"),"srs="+(v.srs||"EPSG:3857"),"width="+(v.width||256),"height="+(v.height||256),"layers="+h].join("&")},i.getTileBBox=o,i.getMercCoords=c,Object.defineProperty(i,"__esModule",{value:!0})})(t)})(0,BA);var n6=BA;class ua{constructor(t,i,o){this.z=t,this.x=i,this.y=o,this.key=Rp(0,t,t,i,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,i){let o=n6.getTileBBox(this.x,this.y,this.z),c=function(u,h,p){let f,g="";for(let v=u;v>0;v--)f=1<<v-1,g+=(h&f?1:0)+(p&f?2:0);return g}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Lw{constructor(t,i){this.wrap=t,this.canonical=i,this.key=Rp(t,i.z,i.z,i.x,i.y)}}class Hi{constructor(t,i,o,c,u){this.overscaledZ=t,this.wrap=i,this.canonical=new ua(o,+c,+u),this.key=i===0&&t===o?this.canonical.key:Rp(i,t,o,c,u)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){let i=this.canonical.z-t;return t>this.canonical.z?new Hi(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Hi(t,this.wrap,t,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(t,i=!0){if(this.overscaledZ===t&&i)return this.key;if(t>this.canonical.z)return Rp(this.wrap*+i,t,this.canonical.z,this.canonical.x,this.canonical.y);{let o=this.canonical.z-t;return Rp(this.wrap*+i,t,t,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;let i=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>i&&t.canonical.y===this.canonical.y>>i}children(t){if(this.overscaledZ>=t)return[new Hi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let i=this.canonical.z+1,o=2*this.canonical.x,c=2*this.canonical.y;return[new Hi(i,this.wrap,i,o,c),new Hi(i,this.wrap,i,o+1,c),new Hi(i,this.wrap,i,o,c+1),new Hi(i,this.wrap,i,o+1,c+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Hi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Hi(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Lw(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Rp(e,t,i,o,c){let u=1<<Math.min(i,22),h=u*(c%u)+o%u;return e&&i<22&&(h+=u*u*((e<0?-2*e-1:2*e)%(1<<2*(22-i)))),16*(32*h+i)+(t-i)}let VA=[e=>{let t=e.canonical.x-1,i=e.wrap;return t<0&&(t=(1<<e.canonical.z)-1,i--),new Hi(e.overscaledZ,i,e.canonical.z,t,e.canonical.y)},e=>{let t=e.canonical.x+1,i=e.wrap;return t===1<<e.canonical.z&&(t=0,i++),new Hi(e.overscaledZ,i,e.canonical.z,t,e.canonical.y)},e=>new Hi(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(e.canonical.y===0?1<<e.canonical.z:e.canonical.y)-1),e=>new Hi(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)];xe(ua,"CanonicalTileID"),xe(Hi,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});class G_{constructor(t,i){this.pos=t,this.dir=i}intersectsPlane(t,i,o){let c=J.dot(i,this.dir);if(Math.abs(c)<1e-6)return!1;let u=((t[0]-this.pos[0])*i[0]+(t[1]-this.pos[1])*i[1]+(t[2]-this.pos[2])*i[2])/c;return o[0]=this.pos[0]+this.dir[0]*u,o[1]=this.pos[1]+this.dir[1]*u,o[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(t,i,o){if(J.equals(this.pos,t)||i===0)return o[0]=o[1]=o[2]=0,!1;let[c,u,h]=this.dir,p=this.pos[0]-t[0],f=this.pos[1]-t[1],g=this.pos[2]-t[2],v=c*c+u*u+h*h,y=2*(p*c+f*u+g*h),b=y*y-4*v*(p*p+f*f+g*g-i*i);if(b<0){let x=Math.max(-y/2,0),C=p+c*x,E=f+u*x,M=g+h*x,D=Math.hypot(C,E,M);return o[0]=C*i/D,o[1]=E*i/D,o[2]=M*i/D,!1}{let x=(-y-Math.sqrt(b))/(2*v);if(x<0){let C=Math.hypot(p,f,g);return o[0]=p*i/C,o[1]=f*i/C,o[2]=g*i/C,!1}return o[0]=p+c*x,o[1]=f+u*x,o[2]=g+h*x,!0}}}class zw{constructor(t,i,o,c,u){this.TL=t,this.TR=i,this.BR=o,this.BL=c,this.horizon=u}static fromInvProjectionMatrix(t,i,o){let c=[-1,1,1],u=[1,1,1],h=[1,-1,1],p=[-1,-1,1],f=J.transformMat4(c,c,t),g=J.transformMat4(u,u,t),v=J.transformMat4(h,h,t),y=J.transformMat4(p,p,t);return new zw(f,g,v,y,i/o)}}function Pp(e,t,i){let o=1/0,c=-1/0,u=[];for(let h of e){J.sub(u,h,t);let p=J.dot(u,i);o=Math.min(o,p),c=Math.max(c,p)}return[o,c]}function jA(e,t){let i=!0;for(let o=0;o<e.planes.length;o++){let c=e.planes[o],u=0;for(let h=0;h<t.length;h++)u+=J.dot(c,t[h])+c[3]>=0;if(u===0)return 0;u!==t.length&&(i=!1)}return i?2:1}function UA(e,t){for(let i of e.projections){let o=Pp(t,e.points[0],i.axis);if(i.projection[1]<o[0]||i.projection[0]>o[1])return 0}return 1}function HA(e,t){let i=0,o=[0,0,0,0];for(let c=0;c<e.length;c++)o[0]=e[c][0],o[1]=e[c][1],o[2]=e[c][2],o[3]=1,un.dot(o,t)>=0&&i++;return i}class hc{constructor(t,i){this.points=t||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Ln.fromPoints(this.points),this.projections=[],this.frustumEdges=[J.sub([],this.points[2],this.points[3]),J.sub([],this.points[0],this.points[3]),J.sub([],this.points[4],this.points[0]),J.sub([],this.points[5],this.points[1]),J.sub([],this.points[6],this.points[2]),J.sub([],this.points[7],this.points[3])];for(let o of this.frustumEdges){let c=[0,-o[2],o[1]],u=[o[2],0,-o[0]];this.projections.push({axis:c,projection:Pp(this.points,this.points[0],c)}),this.projections.push({axis:u,projection:Pp(this.points,this.points[0],u)})}}static fromInvProjectionMatrix(t,i,o,c){let u=Math.pow(2,o),h=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(g=>{let v=un.transformMat4([],g,t),y=1/v[3]/i*u;return un.mul(v,v,[y,y,c?1/v[3]:y,y])}),p=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(g=>{let v=J.sub([],h[g[0]],h[g[1]]),y=J.sub([],h[g[2]],h[g[1]]),b=J.normalize([],J.cross([],v,y)),x=-J.dot(b,h[g[1]]);return b.concat(x)}),f=[];for(let g=0;g<h.length;g++)f.push([h[g][0],h[g][1],h[g][2]]);return new hc(f,p)}intersectsPrecise(t,i,o){for(let c=0;c<i.length;c++)if(!HA(t,i[c]))return 0;for(let c=0;c<this.planes.length;c++)if(!HA(t,this.planes[c]))return 0;for(let c of o)for(let u of this.frustumEdges){let h=J.cross([],c,u),p=J.length(h);if(p===0)continue;J.scale(h,h,1/p);let f=Pp(this.points,this.points[0],h),g=Pp(t,this.points[0],h);if(f[0]>g[1]||g[0]>f[1])return 0}return 1}}class Ln{static fromPoints(t){let i=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(let c of t)J.min(i,i,c),J.max(o,o,c);return new Ln(i,o)}static fromTileIdAndHeight(t,i,o){let c=1<<t.canonical.z,u=t.canonical.x,h=t.canonical.y;return new Ln([u/c,h/c,i],[(u+1)/c,(h+1)/c,o])}static applyTransform(t,i){let o=t.getCorners();for(let c=0;c<o.length;++c)J.transformMat4(o[c],o[c],i);return Ln.fromPoints(o)}static projectAabbCorners(t,i){let o=t.getCorners();for(let c=0;c<o.length;++c)J.transformMat4(o[c],o[c],i);return o}constructor(t,i){this.min=t,this.max=i,this.center=J.scale([],J.add([],this.min,this.max),.5)}quadrant(t){let i=[t%2==0,t<2],o=J.clone(this.min),c=J.clone(this.max);for(let u=0;u<i.length;u++)o[u]=i[u]?this.min[u]:this.center[u],c[u]=i[u]?this.center[u]:this.max[u];return c[2]=this.max[2],new Ln(o,c)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){let t=this.min,i=this.max;return[[t[0],t[1],t[2]],[i[0],t[1],t[2]],[i[0],i[1],t[2]],[t[0],i[1],t[2]],[t[0],t[1],i[2]],[i[0],t[1],i[2]],[i[0],i[1],i[2]],[t[0],i[1],i[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?jA(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?jA(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,i){return i||this.intersects(t)?UA(t,this.getCorners()):0}intersectsPreciseFlat(t,i){return i||this.intersectsFlat(t)?UA(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let i=0;i<3;++i)if(this.min[i]>t.max[i]||t.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],t.min[i]),this.max[i]=Math.max(this.max[i],t.max[i])}encapsulatePoint(t){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],t[i]),this.max[i]=Math.max(this.max[i],t[i])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}xe(Ln,"Aabb");let Op=5,Xc=6,ts=wt/Math.PI/2,r6=16383,vh=64,Nw=[vh,32,16],ha=-ts,ma=ts,o6=[new Ln([ha,ha,ha],[ma,ma,ma]),new Ln([ha,ha,ha],[0,0,ma]),new Ln([0,ha,ha],[ma,0,ma]),new Ln([ha,0,ha],[0,ma,ma]),new Ln([0,0,ha],[ma,ma,ma])];function q_(e){return e*ts/bh}function GA(e,t,i,o=!0){let c=J.scale([],e._camera.position,e.worldSize),u=[t,i,1,1];un.transformMat4(u,u,e.pixelMatrixInverse),un.scale(u,u,1/u[3]);let h=J.sub([],u,c),p=J.normalize([],h),f=e.globeMatrix,g=[f[12],f[13],f[14]],v=J.sub([],g,c),y=J.length(v),b=J.normalize([],v),x=e.worldSize/(2*Math.PI),C=J.dot(b,p),E=Math.asin(x/y);if(E<Math.acos(C)){if(!o)return null;let $=[],Y=[];J.scale($,p,y/C),J.normalize(Y,J.sub(Y,$,v)),J.normalize(p,J.add(p,v,J.scale(p,Y,Math.tan(E)*y)))}let M=[];new G_(c,p).closestPointOnSphere(g,x,M);let D=J.normalize([],gr(f,0)),I=J.normalize([],gr(f,1)),P=J.normalize([],gr(f,2)),O=J.dot(D,M),R=J.dot(I,M),F=J.dot(P,M),z=ii(Math.asin(-R/x)),j=ii(Math.atan2(O,F));j=e.center.lng+function($,Y){let tt=(Y-$+180)%360-180;return tt<-180?tt+360:tt}(e.center.lng,j);let U=to(j),G=ve(lo(z),0,1);return new Oi(U,G)}class s6{constructor(t,i,o){this.a=J.sub([],t,o),this.b=J.sub([],i,o),this.center=o;let c=J.normalize([],this.a),u=J.normalize([],this.b);this.angle=Math.acos(J.dot(c,u))}}function Bw(e,t){if(e.angle===0)return null;let i;return i=e.a[t]===0?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),i<0||i>1?null:function(o,c,u,h){let p=Math.sin(u);return o*(Math.sin((1-h)*u)/p)+c*(Math.sin(h*u)/p)}(e.a[t],e.b[t],e.angle,ve(i,0,1))+e.center[t]}function Ws(e){if(e.z<=1)return o6[e.z+2*e.y+e.x];let t=jw(W_(e));return Ln.fromPoints(t)}function mc(e,t,i){return J.scale(e,e,1-i),J.scaleAndAdd(e,e,t,i)}function qA(e,t){let i=wo(t.zoom);if(i===0)return Ws(e);let o=W_(e),c=jw(o),u=to(o.getWest())*t.worldSize,h=to(o.getEast())*t.worldSize,p=lo(o.getNorth())*t.worldSize,f=lo(o.getSouth())*t.worldSize,g=[u,p,0],v=[h,p,0],y=[u,f,0],b=[h,f,0],x=ft.invert([],t.globeMatrix);return J.transformMat4(g,g,x),J.transformMat4(v,v,x),J.transformMat4(y,y,x),J.transformMat4(b,b,x),c[0]=mc(c[0],y,i),c[1]=mc(c[1],b,i),c[2]=mc(c[2],v,i),c[3]=mc(c[3],g,i),Ln.fromPoints(c)}function WA(e,t,i){for(let o of e)J.transformMat4(o,o,t),J.scale(o,o,i)}function Vw(e,t,i,o){let c=t/e.worldSize,u=e.globeMatrix;if(i.z<=1){let U=Ws(i).getCorners();return WA(U,u,c),Ln.fromPoints(U)}let h=W_(i,o),p=jw(h);WA(p,u,c);let f=Number.MAX_VALUE,g=[-f,-f,-f],v=[f,f,f];if(h.contains(e.center)){for(let $ of p)J.min(v,v,$),J.max(g,g,$);g[2]=0;let U=e.point,G=[U.x*c,U.y*c,0];return J.min(v,v,G),J.max(g,g,G),new Ln(v,g)}let y=[u[12]*c,u[13]*c,u[14]*c],b=h.getCenter(),x=ve(e.center.lat,-Er,Er),C=ve(b.lat,-Er,Er),E=to(e.center.lng),M=lo(x),D=E-to(b.lng),I=M-lo(C);D>.5?D-=1:D<-.5&&(D+=1);let P=0;if(Math.abs(D)>Math.abs(I))P=D>=0?1:3;else{P=I>=0?0:2;let U=[u[4]*c,u[5]*c,u[6]*c],G=-Math.sin(fe(I>=0?h.getSouth():h.getNorth()))*ts;J.scaleAndAdd(y,y,U,G)}let O=p[P],R=p[(P+1)%4],F=new s6(O,R,y),z=[Bw(F,0)||O[0],Bw(F,1)||O[1],Bw(F,2)||O[2]],j=wo(e.zoom);if(j>0){let U=function({x:$,y:Y,z:tt},W,rt,st,pt){let nt=1/(1<<tt),ot=$*nt,_t=ot+nt,bt=Y*nt,yt=bt+nt,Ct=0,St=(ot+_t)/2-st;return St>.5?Ct=-1:St<-.5&&(Ct=1),ot=((ot+Ct)*W-(st*=W))*rt+st,_t=((_t+Ct)*W-st)*rt+st,bt=(bt*W-(pt*=W))*rt+pt,yt=(yt*W-pt)*rt+pt,[[ot,yt,0],[_t,yt,0],[_t,bt,0],[ot,bt,0]]}(i,t,e._pixelsPerMercatorPixel,E,M);for(let $=0;$<p.length;$++)mc(p[$],U[$],j);let G=J.add([],U[P],U[(P+1)%4]);J.scale(G,G,.5),mc(z,G,j)}for(let U of p)J.min(v,v,U),J.max(g,g,U);return v[2]=Math.min(O[2],R[2]),J.min(v,v,z),J.max(g,g,z),new Ln(v,g)}function W_({x:e,y:t,z:i},o=!1){let c=1/(1<<i),u=new Ye(Ss(e*c),t===(1<<i)-1&&o?-90:Wr((t+1)*c)),h=new Ye(Ss((e+1)*c),t===0&&o?90:Wr(t*c));return new Cs(u,h)}function jw(e){let t=fe(e.getNorth()),i=fe(e.getSouth()),o=Math.cos(t),c=Math.cos(i),u=Math.sin(t),h=Math.sin(i),p=e.getWest(),f=e.getEast();return[yh(c,h,p),yh(c,h,f),yh(o,u,f),yh(o,u,p)]}function yh(e,t,i,o=ts){return i=fe(i),[e*Math.sin(i)*o,-t*o,e*Math.cos(i)*o]}function us(e,t,i){return yh(Math.cos(fe(e)),Math.sin(fe(e)),t,i)}function Fp(e,t,i,o){let c=1<<i.z,u=(e/wt+i.x)/c;return us(Wr((t/wt+i.y)/c),Ss(u),o)}function $_({min:e,max:t}){return r6/Math.max(t[0]-e[0],t[1]-e[1],t[2]-e[2])}let $A=new Float64Array(16);function Kc(e){let t=$_(e),i=ft.fromScaling($A,[t,t,t]);return ft.translate(i,i,J.negate([],e.min))}function Uw(e){let t=ft.fromTranslation($A,e.min),i=1/$_(e);return ft.scale(t,t,[i,i,i])}function Hw(e){let t=wt/(2*Math.PI);return e/(2*Math.PI)/t}function YA(e,t){return wt/(512*Math.pow(2,e))*$_(Ws(t))}function ZA(e,t,i,o,c){let u=Hw(i),h=[e,t,-i/(2*Math.PI)],p=ft.identity(new Float64Array(16));return ft.translate(p,p,h),ft.scale(p,p,[u,u,u]),ft.rotateX(p,p,fe(-c)),ft.rotateY(p,p,fe(-o)),p}function XA(e){let t=e.pixelsPerMeter,i=t/_n(1,e.center.lat),o=ft.identity(new Float64Array(16));return ft.translate(o,o,[e.point.x,e.point.y,0]),ft.scale(o,o,[i,i,t]),Float32Array.from(o)}function wo(e){return Go(Op,Xc,e)}function KA(e,t,i){let o=ft.identity(new Float64Array(16)),c=(t/(1<<e)-.5)*Math.PI*2;return ft.rotateY(o,i.globeMatrix,c),Float32Array.from(o)}function QA(e,t,i){let o=wo(i.zoom),c=e.style.map._antialias,u=t.options.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return o===0&&!c&&!u}function JA(e,t,i,o){let c=t.getNorth(),u=t.getSouth(),h=t.getWest(),p=t.getEast(),f=1<<e.z,g=p-h,v=c-u,y=g/vh,b=-v/Nw[i],x=[0,y,0,b,0,0,c,h,0];if(e.z>0){let C=180/o;ds.multiply(x,x,[C/g+1,0,0,0,C/v+1,0,-.5*C/y,.5*C/b,1])}return x[2]=f,x[5]=e.x,x[8]=e.y,x}function a6(e){let t=Er-5;e=ve(e,-t,t)/t*90;let i=Math.pow(Math.abs(Math.sin(fe(e))),3);return Math.round(i*(Nw.length-1))}function tk(e){let t=[0,0,0],i=ft.identity(new Float64Array(16));return ft.multiply(i,e.pixelMatrix,e.globeMatrix),J.transformMat4(t,t,i),new Q(t[0],t[1])}function ek(e,t){let i=us(t.lat,t.lng),o=function(u){let h=us(u._center.lat,u._center.lng),p=J.fromValues(0,1,0),f=J.cross([],p,h),g=ft.fromRotation([],-u.angle,h);f=J.transformMat4(f,f,g),ft.fromRotation(g,-u._pitch,f);let v=J.normalize([],h);return J.scale(v,v,q_(u.cameraToCenterDistance/u.pixelsPerMeter)),J.transformMat4(v,v,g),J.add([],h,v)}(e),c=J.subtract([],o,i);return J.angle(c,i)}function Y_(e,t){return ek(e,t)>Math.PI/2*1.01}let ik=fe(85),l6=Math.cos(ik),c6=Math.sin(ik);class d6{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let t of this._poleSegments)t.destroy();for(let t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,i){let o=new xs,c=new qr,u=[],h=t+1+2,p=i[0]+1,f=i[0]+1+(1+i.length),g=(v,y,b)=>{let x=v===h-1?v-2:v===0?v:v-1;return x+=b?24575:0,[x,y]};for(let v=0;v<h;++v)o.emplaceBack(...g(v,0,!0));for(let v=0;v<p;++v)for(let y=0;y<h;++y)o.emplaceBack(...g(y,v,(y===0||y===h-1)&&!0));for(let v=0;v<i.length;++v){let y=i[v];for(let b=0;b<h;++b)o.emplaceBack(...g(b,y,!0))}for(let v=0;v<i.length;++v){let y=c.length,b=i[v]+1+2,x=new qr;for(let M=0;M<b-1;M++){let D=M===b-2,I=D?h*(f-i.length+v-M):h;for(let P=0;P<h-1;P++){let O=M*h+P;M===0||D||P===0||P===h-2?(x.emplaceBack(O+1,O,O+I),x.emplaceBack(O+I,O+I+1,O+1)):(c.emplaceBack(O+1,O,O+I),c.emplaceBack(O+I,O+I+1,O+1))}}let C=dn.simpleSegment(0,y,o.length,c.length-y);for(let M=0;M<x.uint16.length;M+=3)c.emplaceBack(x.uint16[M],x.uint16[M+1],x.uint16[M+2]);let E=dn.simpleSegment(0,y,o.length,c.length-y);u.push({withoutSkirts:C,withSkirts:E})}return{vertices:o,indices:c,segments:u}}_createGrid(t){let i=this._fillGridMeshWithLods(vh,Nw);this._gridSegments=i.segments,this._gridBuffer=t.createVertexBuffer(i.vertices,Zc.members),this._gridIndexBuffer=t.createIndexBuffer(i.indices,!0)}_createPoles(t){let i=new qr;for(let p=0;p<=vh;p++)i.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=t.createIndexBuffer(i,!0);let o=new tu,c=new tu,u=new tu,h=new tu;this._poleSegments=[];for(let p=0,f=0;p<Op;p++){let g=360/(1<<p);o.emplaceBack(0,-ts,0,.5,0),c.emplaceBack(0,-ts,0,.5,1),u.emplaceBack(0,-ts,0,.5,.5),h.emplaceBack(0,-ts,0,.5,.5);for(let v=0;v<=vh;v++){let y=v/vh,b=0,x=$e(0,g,y),[C,E,M]=yh(l6,c6,x,ts);o.emplaceBack(C,E,M,y,b),c.emplaceBack(C,E,M,y,1-b);let D=fe(x);y=.5+.5*Math.sin(D),b=.5+.5*Math.cos(D),u.emplaceBack(C,E,M,y,b),h.emplaceBack(C,E,M,y,1-b)}this._poleSegments.push(dn.simpleSegment(f,0,66,64)),f+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(o,H_,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(c,H_,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(u,H_,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(h,H_,!1)}getGridBuffers(t,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,i){return[i?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,i?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}}let bh=63710088e-1,Gw=2*Math.PI*bh;class Qc{constructor(t,i){if(isNaN(t)||isNaN(i))throw new Error(`Invalid LngLat object: (${t}, ${i})`);if(this.lng=+t,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Qc(os(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){let i=Math.PI/180,o=this.lat*i,c=t.lat*i,u=Math.sin(o)*Math.sin(c)+Math.cos(o)*Math.cos(c)*Math.cos((t.lng-this.lng)*i);return bh*Math.acos(Math.min(u,1))}toBounds(t=0){let i=360*t/40075017,o=i/Math.cos(Math.PI/180*this.lat);return new Cs(new Qc(this.lng-o,this.lat-i),new Qc(this.lng+o,this.lat+i))}toEcef(t){let i=q_(t);return us(this.lat,this.lng,ts+i)}static convert(t){if(t instanceof Qc)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Qc(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Qc(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Ye=Qc;let u6=0,h6=25.5;function Z_(e){return Gw*Math.cos(e*Math.PI/180)}function to(e){return(180+e)/360}function lo(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function _n(e,t){return e/Z_(t)}function Ss(e){return 360*e-180}function Wr(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function nk(e,t){return e*Z_(Wr(t))}let Er=85.051129;function rk(e){return Math.cos(fe(ve(e,-Er,Er)))}function Jc(e,t){let i=ve(t,u6,h6),o=Math.pow(2,i);return rk(e)*Gw/(512*o)}function qw(e){return 1/Math.cos(e*Math.PI/180)}function Lp(e,t=0){let i=Math.exp(Math.PI*(1-(e.y+t/wt)/(1<<e.z)*2));return 80150034*i/(i*i+1)/wt/(1<<e.z)}class Oi{constructor(t,i,o=0){this.x=+t,this.y=+i,this.z=+o}static fromLngLat(t,i=0){let o=Ye.convert(t);return new Oi(to(o.lng),lo(o.lat),_n(i,o.lat))}toLngLat(){return new Ye(Ss(this.x),Wr(this.y))}toAltitude(){return nk(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Gw*qw(Wr(this.y))}}function Ww(e,t,i,o,c,u,h,p,f){let g=(t+o)/2,v=(i+c)/2,y=new Q(g,v);p(y),function(b,x,C,E,M,D){let I=C-M,P=E-D;return Math.abs((E-x)*I-(C-b)*P)/Math.hypot(I,P)}(y.x,y.y,u.x,u.y,h.x,h.y)>=f?(Ww(e,t,i,g,v,u,y,p,f),Ww(e,g,v,o,c,y,h,p,f)):e.push(h)}function ok(e,t,i){let o=e[0],c=o.x,u=o.y;t(o);let h=[o];for(let p=1;p<e.length;p++){let f=e[p],{x:g,y:v}=f;t(f),Ww(h,c,u,g,v,o,f,t,i),c=g,u=v,o=f}return h}function $w(e,t,i,o){if(o(t,i)){let c=t.add(i)._mult(.5);$w(e,t,c,o),$w(e,c,i,o)}else e.push(i)}function m6(e,t){let i=e[0],o=[i];for(let c=1;c<e.length;c++){let u=e[c];$w(o,i,u,t),i=u}return o}let Yw=Math.pow(2,14)-1,sk=-Yw-1;function p6(e,t){let i=Math.round(e.x*t),o=Math.round(e.y*t);return e.x=ve(i,sk,Yw),e.y=ve(o,sk,Yw),(i<e.x||i>e.x+1||o<e.y||o>e.y+1)&&lt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function Dl(e,t,i){let o=e.loadGeometry(),c=e.extent,u=wt/c;if(t&&i&&i.projection.isReprojectedInTileSpace){let h=1<<t.z,{scale:p,x:f,y:g,projection:v}=i,y=b=>{let x=Ss((t.x+b.x/c)/h),C=Wr((t.y+b.y/c)/h),E=v.project(x,C);b.x=(E.x*p-f)*c,b.y=(E.y*p-g)*c};for(let b=0;b<o.length;b++)if(e.type!==1)o[b]=ok(o[b],y,1);else{let x=[];for(let C of o[b])C.x<0||C.x>=c||C.y<0||C.y>=c||(y(C),x.push(C));o[b]=x}}for(let h of o)for(let p of h)p6(p,u);return o}function td(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Dl(e):[]}}function X_(e,t,i,o,c){e.emplaceBack(2*t+(o+1)/2,2*i+(c+1)/2)}function K_(e,t,i){e.emplaceBack(t.x,t.y,t.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Zw{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new xs,this.indexArray=new qr,this.segments=new dn,this.programConfigurations=new $c(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,o,c){let u=this.layers[0],h=[],p=null;u.type==="circle"&&(p=u.layout.get("circle-sort-key"));for(let{feature:g,id:v,index:y,sourceLayerIndex:b}of t){let x=this.layers[0]._featureFilter.needGeometry,C=td(g,x);if(!this.layers[0]._featureFilter.filter(new Jn(this.zoom),C,o))continue;let E=p?p.evaluate(C,{},o):void 0,M={id:v,properties:g.properties,type:g.type,sourceLayerIndex:b,index:y,geometry:x?C.geometry:Dl(g,o,c),patterns:{},sortKey:E};h.push(M)}p&&h.sort((g,v)=>g.sortKey-v.sortKey);let f=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new F_,f=c.projection);for(let g of h){let{geometry:v,index:y,sourceLayerIndex:b}=g,x=t[y].feature;this.addFeature(g,v,y,i.availableImages,o,f,i.brightness),i.featureIndex.insert(x,v,y,b,this.index)}}update(t,i,o,c,u){let h=Object.keys(t).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,i,h?this.stateDependentLayers:this.layers,o,c,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,SU.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,EU.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,i,o,c,u,h,p){for(let f of i)for(let g of f){let v=g.x,y=g.y;if(v<0||v>=wt||y<0||y>=wt)continue;if(h){let C=h.projectTilePoint(v,y,u),E=h.upVector(u,v,y),M=this.globeExtVertexArray;K_(M,C,E),K_(M,C,E),K_(M,C,E),K_(M,C,E)}let b=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),x=b.vertexLength;X_(this.layoutVertexArray,v,y,-1,-1),X_(this.layoutVertexArray,v,y,1,-1),X_(this.layoutVertexArray,v,y,1,1),X_(this.layoutVertexArray,v,y,-1,1),this.indexArray.emplaceBack(x,x+1,x+2),this.indexArray.emplaceBack(x,x+2,x+3),b.vertexLength+=4,b.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{},c,u,p)}}function ak(e,t){for(let i=0;i<e.length;i++)if(ed(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(ed(e,t[i]))return!0;return!!Xw(e,t)}function f6(e,t,i){return!!ed(e,t)||!!Kw(t,e,i)}function lk(e,t){if(e.length===1)return dk(t,e[0]);for(let i=0;i<t.length;i++){let o=t[i];for(let c=0;c<o.length;c++)if(ed(e,o[c]))return!0}for(let i=0;i<e.length;i++)if(dk(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(Xw(e,t[i]))return!0;return!1}function g6(e,t,i){if(e.length>1){if(Xw(e,t))return!0;for(let o=0;o<t.length;o++)if(Kw(t[o],e,i))return!0}for(let o=0;o<e.length;o++)if(Kw(e[o],t,i))return!0;return!1}function Xw(e,t){if(e.length===0||t.length===0)return!1;for(let i=0;i<e.length-1;i++){let o=e[i],c=e[i+1];for(let u=0;u<t.length-1;u++)if(_6(o,c,t[u],t[u+1]))return!0}return!1}function _6(e,t,i,o){return zt(e,i,o)!==zt(t,i,o)&&zt(e,t,i)!==zt(e,t,o)}function Kw(e,t,i){let o=i*i;if(t.length===1)return e.distSqr(t[0])<o;for(let c=1;c<t.length;c++)if(ck(e,t[c-1],t[c])<o)return!0;return!1}function ck(e,t,i){let o=t.distSqr(i);if(o===0)return e.distSqr(t);let c=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/o;return e.distSqr(c<0?t:c>1?i:i.sub(t)._mult(c)._add(t))}function dk(e,t){let i,o,c,u=!1;for(let h=0;h<e.length;h++){i=e[h];for(let p=0,f=i.length-1;p<i.length;f=p++)o=i[p],c=i[f],o.y>t.y!=c.y>t.y&&t.x<(c.x-o.x)*(t.y-o.y)/(c.y-o.y)+o.x&&(u=!u)}return u}function ed(e,t){let i=!1;for(let o=0,c=e.length-1;o<e.length;c=o++){let u=e[o],h=e[c];u.y>t.y!=h.y>t.y&&t.x<(h.x-u.x)*(t.y-u.y)/(h.y-u.y)+u.x&&(i=!i)}return i}function uk(e,t,i,o,c){for(let h of e)if(t<=h.x&&i<=h.y&&o>=h.x&&c>=h.y)return!0;let u=[new Q(t,i),new Q(t,c),new Q(o,c),new Q(o,i)];if(e.length>2){for(let h of u)if(ed(e,h))return!0}for(let h=0;h<e.length-1;h++)if(v6(e[h],e[h+1],u))return!0;return!1}function v6(e,t,i){let o=i[0],c=i[2];if(e.x<o.x&&t.x<o.x||e.x>c.x&&t.x>c.x||e.y<o.y&&t.y<o.y||e.y>c.y&&t.y>c.y)return!1;let u=zt(e,t,i[0]);return u!==zt(e,t,i[1])||u!==zt(e,t,i[2])||u!==zt(e,t,i[3])}function xh(e,t,i,o,c,u){let h=t.y-e.y,p=e.x-t.x;if(u=u||0){let f=h*h+p*p;if(f===0)return!0;let g=Math.sqrt(f);h/=g,p/=g}return!((i.x-e.x)*h+(i.y-e.y)*p-u<0||(o.x-e.x)*h+(o.y-e.y)*p-u<0||(c.x-e.x)*h+(c.y-e.y)*p-u<0)}function Qw(e,t,i,o,c,u,h){return!(xh(e,t,o,c,u,h)||xh(t,i,o,c,u,h)||xh(i,e,o,c,u,h)||xh(o,c,e,t,i,h)||xh(c,u,e,t,i,h)||xh(u,o,e,t,i,h))}function wh(e,t,i){let o=t.paint.get(e).value;return o.kind==="constant"?o.value:i.programConfigurations.get(t.id).getMaxValue(e)}function Q_(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function hk(e,t,i,o,c){if(!t[0]&&!t[1])return e;let u=Q.convert(t)._mult(c);i==="viewport"&&u._rotate(-o);let h=[];for(let p=0;p<e.length;p++)h.push(e[p].sub(u));return h}function mk(e,t,i,o){let c=Q.convert(e)._mult(o);return t==="viewport"&&c._rotate(-i),c}xe(Zw,"CircleBucket",{omit:["layers"]});let y6=new yr({"circle-sort-key":new Re(gt.layout_circle["circle-sort-key"]),visibility:new Ut(gt.layout_circle.visibility)});var b6={paint:new yr({"circle-radius":new Re(gt.paint_circle["circle-radius"]),"circle-color":new Re(gt.paint_circle["circle-color"]),"circle-blur":new Re(gt.paint_circle["circle-blur"]),"circle-opacity":new Re(gt.paint_circle["circle-opacity"]),"circle-translate":new Ut(gt.paint_circle["circle-translate"]),"circle-translate-anchor":new Ut(gt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ut(gt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ut(gt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Re(gt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Re(gt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Re(gt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Ut(gt.paint_circle["circle-emissive-strength"])}),layout:y6};let x6=ft.create(),w6=(e,t,i,o,c,u)=>{let h=e.transform,p=h.projection.name==="globe",f;if(u.paint.get("circle-pitch-alignment")==="map")if(p){let v=YA(h.zoom,t.canonical)*h._pixelsPerMercatorPixel;f=Float32Array.from([v,0,0,v])}else f=h.calculatePixelsToTileUnitsMatrix(i);else f=new Float32Array([h.pixelsToGLUnits[0],0,0,h.pixelsToGLUnits[1]]);let g={u_camera_to_center_distance:e.transform.getCameraToCenterDistance(h.projection),u_matrix:e.translatePosMatrix(t.projMatrix,i,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ni.devicePixelRatio,u_extrude_scale:f,u_inv_rot_matrix:x6,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:u.paint.get("circle-emissive-strength")};if(p){g.u_inv_rot_matrix=o,g.u_merc_center=c,g.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],g.u_zoom_transition=wo(h.zoom);let v=c[0]*wt,y=c[1]*wt;g.u_up_dir=h.projection.upVector(new ua(0,0,0),v,y)}return g},pk=e=>{let t=[];return e.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),e.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t};function fk(e,t,i,o,c,u,h,p,f){if(u&&e.queryGeometry.isAboveHorizon)return!1;u&&(f*=e.pixelToTileUnitsFactor);let g=e.tileID.canonical,v=i.projection.upVectorScale(g,i.center.lat,i.worldSize).metersToTile;for(let y of t)for(let b of y){let x=b.add(p),C=c&&i.elevation?i.elevation.exaggeration()*c.getElevationAt(x.x,x.y,!0):0,E=i.projection.projectTilePoint(x.x,x.y,g);if(C>0){let P=i.projection.upVector(g,x.x,x.y);E.x+=P[0]*v*C,E.y+=P[1]*v*C,E.z+=P[2]*v*C}let M=u?x:C6(E.x,E.y,E.z,o),D=u?e.tilespaceRays.map(P=>E6(P,C)):e.queryGeometry.screenGeometry,I=un.transformMat4([],[E.x,E.y,E.z,1],o);if(!h&&u?f*=I[3]/i.cameraToCenterDistance:h&&!u&&(f*=i.cameraToCenterDistance/I[3]),u){let P=Wr((b.y/wt+g.y)/(1<<g.z));f/=i.projection.pixelsPerMeter(P,1)/_n(1,P)}if(f6(D,M,f))return!0}return!1}function C6(e,t,i,o){let c=un.transformMat4([],[e,t,i,1],o);return new Q(c[0]/c[3],c[1]/c[3])}let gk=J.fromValues(0,0,0),S6=J.fromValues(0,0,1);function E6(e,t){let i=J.create();return gk[2]=t,e.intersectsPlane(gk,S6,i),new Q(i[0],i[1])}class _k extends Zw{}function vk(e,{width:t,height:i},o,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==t*i*o)throw new RangeError("mismatched image size")}else c=new Uint8Array(t*i*o);return e.width=t,e.height=i,e.data=c,e}function yk(e,t,i){let{width:o,height:c}=t;o===e.width&&c===e.height||(Jw(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,o),height:Math.min(e.height,c)},i),e.width=o,e.height=c,e.data=t.data)}function Jw(e,t,i,o,c,u){if(c.width===0||c.height===0)return t;if(c.width>e.width||c.height>e.height||i.x>e.width-c.width||i.y>e.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>t.width||c.height>t.height||o.x>t.width-c.width||o.y>t.height-c.height)throw new RangeError("out of range destination coordinates for image copy");let h=e.data,p=t.data;for(let f=0;f<c.height;f++){let g=((i.y+f)*e.width+i.x)*u,v=((o.y+f)*t.width+o.x)*u;for(let y=0;y<c.width*u;y++)p[v+y]=h[g+y]}return t}xe(_k,"HeatmapBucket",{omit:["layers"]});class pc{constructor(t,i){vk(this,t,1,i)}resize(t){yk(this,new pc(t),1)}clone(){return new pc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,o,c,u){Jw(t,i,o,c,u,1)}}class Br{constructor(t,i){vk(this,t,4,i)}resize(t){yk(this,new Br(t),4)}replace(t,i){i?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Br({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,o,c,u){Jw(t,i,o,c,u,4)}}class bk{constructor(t,i){this.width=t.width,this.height=t.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}xe(pc,"AlphaImage"),xe(Br,"RGBAImage");let M6=new yr({visibility:new Ut(gt.layout_heatmap.visibility)});var D6={paint:new yr({"heatmap-radius":new Re(gt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Re(gt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ut(gt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Mp(gt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ut(gt.paint_heatmap["heatmap-opacity"])}),layout:M6};function J_(e){let t={},i=e.resolution||256,o=e.clips?e.clips.length:1,c=e.image||new Br({width:i,height:o}),u=(h,p,f)=>{t[e.evaluationKey]=f;let g=e.expression.evaluate(t);g&&(c.data[h+p+0]=Math.floor(255*g.r/g.a),c.data[h+p+1]=Math.floor(255*g.g/g.a),c.data[h+p+2]=Math.floor(255*g.b/g.a),c.data[h+p+3]=Math.floor(255*g.a))};if(e.clips)for(let h=0,p=0;h<o;++h,p+=4*i)for(let f=0,g=0;f<i;f++,g+=4){let v=f/(i-1),{start:y,end:b}=e.clips[h];u(p,g,y*(1-v)+b*v)}else for(let h=0,p=0;h<i;h++,p+=4)u(0,p,h/(i-1));return c}let T6=new yr({visibility:new Ut(gt.layout_hillshade.visibility)});var I6={paint:new yr({"hillshade-illumination-direction":new Ut(gt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ut(gt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ut(gt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ut(gt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ut(gt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ut(gt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Ut(gt.paint_hillshade["hillshade-emissive-strength"])}),layout:T6};let A6=Qi([{name:"a_pos",components:2,type:"Int16"}],4),{members:k6}=A6;var tC={exports:{}};function t0(e,t,i){i=i||2;var o,c,u,h,p,f,g,v=t&&t.length,y=v?t[0]*i:e.length,b=xk(e,0,y,i,!0),x=[];if(!b||b.next===b.prev)return x;if(v&&(b=function(E,M,D,I){var P,O,R,F=[];for(P=0,O=M.length;P<O;P++)(R=xk(E,M[P]*I,P<O-1?M[P+1]*I:E.length,I,!1))===R.next&&(R.steiner=!0),F.push(B6(R));for(F.sort(L6),P=0;P<F.length;P++)D=z6(F[P],D);return D}(e,t,b,i)),e.length>80*i){o=u=e[0],c=h=e[1];for(var C=i;C<y;C+=i)(p=e[C])<o&&(o=p),(f=e[C+1])<c&&(c=f),p>u&&(u=p),f>h&&(h=f);g=(g=Math.max(u-o,h-c))!==0?32767/g:0}return zp(b,x,i,o,c,g,0),x}function xk(e,t,i,o,c){var u,h;if(c===nC(e,t,i,o)>0)for(u=t;u<i;u+=o)h=Sk(u,e[u],e[u+1],h);else for(u=i-o;u>=t;u-=o)h=Sk(u,e[u],e[u+1],h);return h&&e0(h,h.next)&&(Bp(h),h=h.next),h}function ou(e,t){if(!e)return e;t||(t=e);var i,o=e;do if(i=!1,o.steiner||!e0(o,o.next)&&eo(o.prev,o,o.next)!==0)o=o.next;else{if(Bp(o),(o=t=o.prev)===o.next)break;i=!0}while(i||o!==t);return t}function zp(e,t,i,o,c,u,h){if(e){!h&&u&&function(v,y,b,x){var C=v;do C.z===0&&(C.z=eC(C.x,C.y,y,b,x)),C.prevZ=C.prev,C.nextZ=C.next,C=C.next;while(C!==v);C.prevZ.nextZ=null,C.prevZ=null,function(E){var M,D,I,P,O,R,F,z,j=1;do{for(D=E,E=null,O=null,R=0;D;){for(R++,I=D,F=0,M=0;M<j&&(F++,I=I.nextZ);M++);for(z=j;F>0||z>0&&I;)F!==0&&(z===0||!I||D.z<=I.z)?(P=D,D=D.nextZ,F--):(P=I,I=I.nextZ,z--),O?O.nextZ=P:E=P,P.prevZ=O,O=P;D=I}O.nextZ=null,j*=2}while(R>1)}(C)}(e,o,c,u);for(var p,f,g=e;e.prev!==e.next;)if(p=e.prev,f=e.next,u?P6(e,o,c,u):R6(e))t.push(p.i/i|0),t.push(e.i/i|0),t.push(f.i/i|0),Bp(e),e=f.next,g=f.next;else if((e=f)===g){h?h===1?zp(e=O6(ou(e),t,i),t,i,o,c,u,2):h===2&&F6(e,t,i,o,c,u):zp(ou(e),t,i,o,c,u,1);break}}}function R6(e){var t=e.prev,i=e,o=e.next;if(eo(t,i,o)>=0)return!1;for(var c=t.x,u=i.x,h=o.x,p=t.y,f=i.y,g=o.y,v=c<u?c<h?c:h:u<h?u:h,y=p<f?p<g?p:g:f<g?f:g,b=c>u?c>h?c:h:u>h?u:h,x=p>f?p>g?p:g:f>g?f:g,C=o.next;C!==t;){if(C.x>=v&&C.x<=b&&C.y>=y&&C.y<=x&&Ch(c,p,u,f,h,g,C.x,C.y)&&eo(C.prev,C,C.next)>=0)return!1;C=C.next}return!0}function P6(e,t,i,o){var c=e.prev,u=e,h=e.next;if(eo(c,u,h)>=0)return!1;for(var p=c.x,f=u.x,g=h.x,v=c.y,y=u.y,b=h.y,x=p<f?p<g?p:g:f<g?f:g,C=v<y?v<b?v:b:y<b?y:b,E=p>f?p>g?p:g:f>g?f:g,M=v>y?v>b?v:b:y>b?y:b,D=eC(x,C,t,i,o),I=eC(E,M,t,i,o),P=e.prevZ,O=e.nextZ;P&&P.z>=D&&O&&O.z<=I;){if(P.x>=x&&P.x<=E&&P.y>=C&&P.y<=M&&P!==c&&P!==h&&Ch(p,v,f,y,g,b,P.x,P.y)&&eo(P.prev,P,P.next)>=0||(P=P.prevZ,O.x>=x&&O.x<=E&&O.y>=C&&O.y<=M&&O!==c&&O!==h&&Ch(p,v,f,y,g,b,O.x,O.y)&&eo(O.prev,O,O.next)>=0))return!1;O=O.nextZ}for(;P&&P.z>=D;){if(P.x>=x&&P.x<=E&&P.y>=C&&P.y<=M&&P!==c&&P!==h&&Ch(p,v,f,y,g,b,P.x,P.y)&&eo(P.prev,P,P.next)>=0)return!1;P=P.prevZ}for(;O&&O.z<=I;){if(O.x>=x&&O.x<=E&&O.y>=C&&O.y<=M&&O!==c&&O!==h&&Ch(p,v,f,y,g,b,O.x,O.y)&&eo(O.prev,O,O.next)>=0)return!1;O=O.nextZ}return!0}function O6(e,t,i){var o=e;do{var c=o.prev,u=o.next.next;!e0(c,u)&&wk(c,o,o.next,u)&&Np(c,u)&&Np(u,c)&&(t.push(c.i/i|0),t.push(o.i/i|0),t.push(u.i/i|0),Bp(o),Bp(o.next),o=e=u),o=o.next}while(o!==e);return ou(o)}function F6(e,t,i,o,c,u){var h=e;do{for(var p=h.next.next;p!==h.prev;){if(h.i!==p.i&&V6(h,p)){var f=Ck(h,p);return h=ou(h,h.next),f=ou(f,f.next),zp(h,t,i,o,c,u,0),void zp(f,t,i,o,c,u,0)}p=p.next}h=h.next}while(h!==e)}function L6(e,t){return e.x-t.x}function z6(e,t){var i=function(c,u){var h,p=u,f=c.x,g=c.y,v=-1/0;do{if(g<=p.y&&g>=p.next.y&&p.next.y!==p.y){var y=p.x+(g-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(y<=f&&y>v&&(v=y,h=p.x<p.next.x?p:p.next,y===f))return h}p=p.next}while(p!==u);if(!h)return null;var b,x=h,C=h.x,E=h.y,M=1/0;p=h;do f>=p.x&&p.x>=C&&f!==p.x&&Ch(g<E?f:v,g,C,E,g<E?v:f,g,p.x,p.y)&&(b=Math.abs(g-p.y)/(f-p.x),Np(p,c)&&(b<M||b===M&&(p.x>h.x||p.x===h.x&&N6(h,p)))&&(h=p,M=b)),p=p.next;while(p!==x);return h}(e,t);if(!i)return t;var o=Ck(i,e);return ou(o,o.next),ou(i,i.next)}function N6(e,t){return eo(e.prev,e,t.prev)<0&&eo(t.next,e,e.next)<0}function eC(e,t,i,o,c){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function B6(e){var t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function Ch(e,t,i,o,c,u,h,p){return(c-h)*(t-p)>=(e-h)*(u-p)&&(e-h)*(o-p)>=(i-h)*(t-p)&&(i-h)*(u-p)>=(c-h)*(o-p)}function V6(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(i,o){var c=i;do{if(c.i!==i.i&&c.next.i!==i.i&&c.i!==o.i&&c.next.i!==o.i&&wk(c,c.next,i,o))return!0;c=c.next}while(c!==i);return!1}(e,t)&&(Np(e,t)&&Np(t,e)&&function(i,o){var c=i,u=!1,h=(i.x+o.x)/2,p=(i.y+o.y)/2;do c.y>p!=c.next.y>p&&c.next.y!==c.y&&h<(c.next.x-c.x)*(p-c.y)/(c.next.y-c.y)+c.x&&(u=!u),c=c.next;while(c!==i);return u}(e,t)&&(eo(e.prev,e,t.prev)||eo(e,t.prev,t))||e0(e,t)&&eo(e.prev,e,e.next)>0&&eo(t.prev,t,t.next)>0)}function eo(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function e0(e,t){return e.x===t.x&&e.y===t.y}function wk(e,t,i,o){var c=n0(eo(e,t,i)),u=n0(eo(e,t,o)),h=n0(eo(i,o,e)),p=n0(eo(i,o,t));return c!==u&&h!==p||!(c!==0||!i0(e,i,t))||!(u!==0||!i0(e,o,t))||!(h!==0||!i0(i,e,o))||!(p!==0||!i0(i,t,o))}function i0(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function n0(e){return e>0?1:e<0?-1:0}function Np(e,t){return eo(e.prev,e,e.next)<0?eo(e,t,e.next)>=0&&eo(e,e.prev,t)>=0:eo(e,t,e.prev)<0||eo(e,e.next,t)<0}function Ck(e,t){var i=new iC(e.i,e.x,e.y),o=new iC(t.i,t.x,t.y),c=e.next,u=t.prev;return e.next=t,t.prev=e,i.next=c,c.prev=i,o.next=i,i.prev=o,u.next=o,o.prev=u,o}function Sk(e,t,i,o){var c=new iC(e,t,i);return o?(c.next=o.next,c.prev=o,o.next.prev=c,o.next=c):(c.prev=c,c.next=c),c}function Bp(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function iC(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function nC(e,t,i,o){for(var c=0,u=t,h=i-o;u<i;u+=o)c+=(e[h]-e[u])*(e[u+1]+e[h+1]),h=u;return c}tC.exports=t0,tC.exports.default=t0,t0.deviation=function(e,t,i,o){var c=t&&t.length,u=Math.abs(nC(e,0,c?t[0]*i:e.length,i));if(c)for(var h=0,p=t.length;h<p;h++)u-=Math.abs(nC(e,t[h]*i,h<p-1?t[h+1]*i:e.length,i));var f=0;for(h=0;h<o.length;h+=3){var g=o[h]*i,v=o[h+1]*i,y=o[h+2]*i;f+=Math.abs((e[g]-e[y])*(e[v+1]-e[g+1])-(e[g]-e[v])*(e[y+1]-e[g+1]))}return u===0&&f===0?0:Math.abs((f-u)/u)},t0.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},o=0,c=0;c<e.length;c++){for(var u=0;u<e[c].length;u++)for(var h=0;h<t;h++)i.vertices.push(e[c][u][h]);c>0&&i.holes.push(o+=e[c-1].length)}return i};var r0=ut(tC.exports);function rC(e,t){let i=e.length;if(i<=1)return[e];let o=[],c,u;for(let h=0;h<i;h++){let p=Vt(e[h]);p!==0&&(e[h].area=Math.abs(p),u===void 0&&(u=p<0),u===p<0?(c&&o.push(c),c=[e[h]]):c.push(e[h]))}if(c&&o.push(c),t>1)for(let h=0;h<o.length;h++)o[h].length<=t||(Cj(o[h],t,1,o[h].length-1,j6),o[h]=o[h].slice(0,t));return o}function j6(e,t){return t.area-e.area}function oC(e,t,i){let o=i.patternDependencies,c=!1;for(let u of t){let h=u.paint.get(`${e}-pattern`);h.isConstant()||(c=!0);let p=h.constantOr(null);p&&(c=!0,o[p]=!0)}return c}function sC(e,t,i,o,c){let u=c.patternDependencies;for(let h of t){let p=h.paint.get(`${e}-pattern`).value;if(p.kind!=="constant"){let f=p.evaluate({zoom:o},i,{},c.availableImages);f=f&&f.name?f.name:f,u[f]=!0,i.patterns[h.id]=f}}return i}class o0{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new xs,this.indexArray=new qr,this.indexArray2=new qc,this.programConfigurations=new $c(t.layers,t.zoom),this.segments=new dn,this.segments2=new dn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=t.projection}populate(t,i,o,c){this.hasPattern=oC("fill",this.layers,i);let u=this.layers[0].layout.get("fill-sort-key"),h=[];for(let{feature:p,id:f,index:g,sourceLayerIndex:v}of t){let y=this.layers[0]._featureFilter.needGeometry,b=td(p,y);if(!this.layers[0]._featureFilter.filter(new Jn(this.zoom),b,o))continue;let x=u?u.evaluate(b,{},o,i.availableImages):void 0,C={id:f,properties:p.properties,type:p.type,sourceLayerIndex:v,index:g,geometry:y?b.geometry:Dl(p,o,c),patterns:{},sortKey:x};h.push(C)}u&&h.sort((p,f)=>p.sortKey-f.sortKey);for(let p of h){let{geometry:f,index:g,sourceLayerIndex:v}=p;if(this.hasPattern){let y=sC("fill",this.layers,p,this.zoom,i);this.patternFeatures.push(y)}else this.addFeature(p,f,g,o,{},i.availableImages,i.brightness);i.featureIndex.insert(t[g].feature,f,g,v,this.index)}}update(t,i,o,c,u){let h=Object.keys(t).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,i,h?this.stateDependentLayers:this.layers,o,c,u)}addFeatures(t,i,o,c,u,h){for(let p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,i,o,c,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,k6),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,i,o,c,u,h=[],p){for(let f of rC(i,500)){let g=0;for(let E of f)g+=E.length;let v=this.segments.prepareSegment(g,this.layoutVertexArray,this.indexArray),y=v.vertexLength,b=[],x=[];for(let E of f){if(E.length===0)continue;E!==f[0]&&x.push(b.length/2);let M=this.segments2.prepareSegment(E.length,this.layoutVertexArray,this.indexArray2),D=M.vertexLength;this.layoutVertexArray.emplaceBack(E[0].x,E[0].y),this.indexArray2.emplaceBack(D+E.length-1,D),b.push(E[0].x),b.push(E[0].y);for(let I=1;I<E.length;I++)this.layoutVertexArray.emplaceBack(E[I].x,E[I].y),this.indexArray2.emplaceBack(D+I-1,D+I),b.push(E[I].x),b.push(E[I].y);M.vertexLength+=E.length,M.primitiveLength+=E.length}let C=r0(b,x);for(let E=0;E<C.length;E+=3)this.indexArray.emplaceBack(y+C[E],y+C[E+1],y+C[E+2]);v.vertexLength+=g,v.primitiveLength+=C.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,u,h,c,p)}}xe(o0,"FillBucket",{omit:["layers","patternFeatures"]});let U6=new yr({"fill-sort-key":new Re(gt.layout_fill["fill-sort-key"]),visibility:new Ut(gt.layout_fill.visibility)});var H6={paint:new yr({"fill-antialias":new Ut(gt.paint_fill["fill-antialias"]),"fill-opacity":new Re(gt.paint_fill["fill-opacity"]),"fill-color":new Re(gt.paint_fill["fill-color"]),"fill-outline-color":new Re(gt.paint_fill["fill-outline-color"]),"fill-translate":new Ut(gt.paint_fill["fill-translate"]),"fill-translate-anchor":new Ut(gt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Re(gt.paint_fill["fill-pattern"]),"fill-emissive-strength":new Ut(gt.paint_fill["fill-emissive-strength"])}),layout:U6};let G6=Qi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),q6=Qi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),W6=Qi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),$6=Qi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Y6=Qi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Z6}=G6;var s0={},X6=Nt,Ek=Sh;function Sh(e,t,i,o,c){this.properties={},this.extent=i,this.type=0,this._pbf=e,this._geometry=-1,this._keys=o,this._values=c,e.readFields(K6,this,t)}function K6(e,t,i){e==1?t.id=i.readVarint():e==2?function(o,c){for(var u=o.readVarint()+o.pos;o.pos<u;){var h=c._keys[o.readVarint()],p=c._values[o.readVarint()];c.properties[h]=p}}(i,t):e==3?t.type=i.readVarint():e==4&&(t._geometry=i.pos)}function Q6(e){for(var t,i,o=0,c=0,u=e.length,h=u-1;c<u;h=c++)o+=((i=e[h]).x-(t=e[c]).x)*(t.y+i.y);return o}Sh.types=["Unknown","Point","LineString","Polygon"],Sh.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,i=e.readVarint()+e.pos,o=1,c=0,u=0,h=0,p=[];e.pos<i;){if(c<=0){var f=e.readVarint();o=7&f,c=f>>3}if(c--,o===1||o===2)u+=e.readSVarint(),h+=e.readSVarint(),o===1&&(t&&p.push(t),t=[]),t.push(new X6(u,h));else{if(o!==7)throw new Error("unknown command "+o);t&&t.push(t[0].clone())}}return t&&p.push(t),p},Sh.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,i=1,o=0,c=0,u=0,h=1/0,p=-1/0,f=1/0,g=-1/0;e.pos<t;){if(o<=0){var v=e.readVarint();i=7&v,o=v>>3}if(o--,i===1||i===2)(c+=e.readSVarint())<h&&(h=c),c>p&&(p=c),(u+=e.readSVarint())<f&&(f=u),u>g&&(g=u);else if(i!==7)throw new Error("unknown command "+i)}return[h,f,p,g]},Sh.prototype.toGeoJSON=function(e,t,i){var o,c,u=this.extent*Math.pow(2,i),h=this.extent*e,p=this.extent*t,f=this.loadGeometry(),g=Sh.types[this.type];function v(x){for(var C=0;C<x.length;C++){var E=x[C];x[C]=[360*(E.x+h)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*(E.y+p)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var y=[];for(o=0;o<f.length;o++)y[o]=f[o][0];v(f=y);break;case 2:for(o=0;o<f.length;o++)v(f[o]);break;case 3:for(f=function(x){var C=x.length;if(C<=1)return[x];for(var E,M,D=[],I=0;I<C;I++){var P=Q6(x[I]);P!==0&&(M===void 0&&(M=P<0),M===P<0?(E&&D.push(E),E=[x[I]]):E.push(x[I]))}return E&&D.push(E),D}(f),o=0;o<f.length;o++)for(c=0;c<f[o].length;c++)v(f[o][c])}f.length===1?f=f[0]:g="Multi"+g;var b={type:"Feature",geometry:{type:g,coordinates:f},properties:this.properties};return"id"in this&&(b.id=this.id),b};var J6=Ek,Mk=Dk;function Dk(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(t8,this,t),this.length=this._features.length}function t8(e,t,i){e===15?t.version=i.readVarint():e===1?t.name=i.readString():e===5?t.extent=i.readVarint():e===2?t._features.push(i.pos):e===3?t._keys.push(i.readString()):e===4&&t._values.push(function(o){for(var c=null,u=o.readVarint()+o.pos;o.pos<u;){var h=o.readVarint()>>3;c=h===1?o.readString():h===2?o.readFloat():h===3?o.readDouble():h===4?o.readVarint64():h===5?o.readVarint():h===6?o.readSVarint():h===7?o.readBoolean():null}return c}(i))}Dk.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new J6(this._pbf,t,this.extent,this._keys,this._values)};var e8=Mk;function i8(e,t,i){if(e===3){var o=new e8(i,i.readVarint()+i.pos);o.length&&(t[o.name]=o)}}var aC=s0.VectorTile=function(e,t){this.layers=e.readFields(i8,{},t)},a0=s0.VectorTileFeature=Ek;function l0(e,t,i,o){let c=[],u=o===0?(h,p,f,g,v,y)=>{h.push(new Q(y,f+(y-p)/(g-p)*(v-f)))}:(h,p,f,g,v,y)=>{h.push(new Q(p+(y-f)/(v-f)*(g-p),y))};for(let h of e){let p=[];for(let f of h){if(f.length<=2)continue;let g=[];for(let b=0;b<f.length-1;b++){let x=f[b].x,C=f[b].y,E=f[b+1].x,M=f[b+1].y,D=o===0?x:C,I=o===0?E:M;D<t?I>t&&u(g,x,C,E,M,t):D>i?I<i&&u(g,x,C,E,M,i):g.push(f[b]),I<t&&D>=t&&u(g,x,C,E,M,t),I>i&&D<=i&&u(g,x,C,E,M,i)}let v=f[f.length-1],y=o===0?v.x:v.y;y>=t&&y<=i&&g.push(v),g.length&&(v=g[g.length-1],g[0].x===v.x&&g[0].y===v.y||g.push(g[0]),p.push(g))}p.length&&c.push(p)}return c}s0.VectorTileLayer=Mk;class Tk{constructor(t){this._stringToNumber={},this._numberToString=[];for(let i=0;i<t.length;i++){let o=t[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}var n8={read:function(e,t,i,o,c){var u,h,p=8*c-o-1,f=(1<<p)-1,g=f>>1,v=-7,y=i?c-1:0,b=i?-1:1,x=e[t+y];for(y+=b,u=x&(1<<-v)-1,x>>=-v,v+=p;v>0;u=256*u+e[t+y],y+=b,v-=8);for(h=u&(1<<-v)-1,u>>=-v,v+=o;v>0;h=256*h+e[t+y],y+=b,v-=8);if(u===0)u=1-g;else{if(u===f)return h?NaN:1/0*(x?-1:1);h+=Math.pow(2,o),u-=g}return(x?-1:1)*h*Math.pow(2,u-o)},write:function(e,t,i,o,c,u){var h,p,f,g=8*u-c-1,v=(1<<g)-1,y=v>>1,b=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,x=o?0:u-1,C=o?1:-1,E=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(p=isNaN(t)?1:0,h=v):(h=Math.floor(Math.log(t)/Math.LN2),t*(f=Math.pow(2,-h))<1&&(h--,f*=2),(t+=h+y>=1?b/f:b*Math.pow(2,1-y))*f>=2&&(h++,f/=2),h+y>=v?(p=0,h=v):h+y>=1?(p=(t*f-1)*Math.pow(2,c),h+=y):(p=t*Math.pow(2,y-1)*Math.pow(2,c),h=0));c>=8;e[i+x]=255&p,x+=C,p/=256,c-=8);for(h=h<<c|p,g+=c;g>0;e[i+x]=255&h,x+=C,h/=256,g-=8);e[i+x-C]|=128*E}},Ik=Xn,c0=n8;function Xn(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Xn.Varint=0,Xn.Fixed64=1,Xn.Bytes=2,Xn.Fixed32=5;var lC=4294967296,Ak=1/lC,kk=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function fc(e){return e.type===Xn.Bytes?e.readVarint()+e.pos:e.pos+1}function Eh(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Rk(e,t,i){var o=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(o);for(var c=i.pos-1;c>=e;c--)i.buf[c+o]=i.buf[c]}function r8(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function o8(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function s8(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function a8(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function l8(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function c8(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function d8(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function u8(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function h8(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function d0(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Mh(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function Pk(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}Xn.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var o=this.readVarint(),c=o>>3,u=this.pos;this.type=7&o,e(c,t,this),this.pos===u&&this.skip(o)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=d0(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Pk(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=d0(this.buf,this.pos)+d0(this.buf,this.pos+4)*lC;return this.pos+=8,e},readSFixed64:function(){var e=d0(this.buf,this.pos)+Pk(this.buf,this.pos+4)*lC;return this.pos+=8,e},readFloat:function(){var e=c0.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=c0.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,i,o=this.buf;return t=127&(i=o[this.pos++]),i<128?t:(t|=(127&(i=o[this.pos++]))<<7,i<128?t:(t|=(127&(i=o[this.pos++]))<<14,i<128?t:(t|=(127&(i=o[this.pos++]))<<21,i<128?t:function(c,u,h){var p,f,g=h.buf;if(p=(112&(f=g[h.pos++]))>>4,f<128||(p|=(127&(f=g[h.pos++]))<<3,f<128)||(p|=(127&(f=g[h.pos++]))<<10,f<128)||(p|=(127&(f=g[h.pos++]))<<17,f<128)||(p|=(127&(f=g[h.pos++]))<<24,f<128)||(p|=(1&(f=g[h.pos++]))<<31,f<128))return Eh(c,p,u);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=o[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&kk?function(i,o,c){return kk.decode(i.subarray(o,c))}(this.buf,t,e):function(i,o,c){for(var u="",h=o;h<c;){var p,f,g,v=i[h],y=null,b=v>239?4:v>223?3:v>191?2:1;if(h+b>c)break;b===1?v<128&&(y=v):b===2?(192&(p=i[h+1]))==128&&(y=(31&v)<<6|63&p)<=127&&(y=null):b===3?(f=i[h+2],(192&(p=i[h+1]))==128&&(192&f)==128&&((y=(15&v)<<12|(63&p)<<6|63&f)<=2047||y>=55296&&y<=57343)&&(y=null)):b===4&&(f=i[h+2],g=i[h+3],(192&(p=i[h+1]))==128&&(192&f)==128&&(192&g)==128&&((y=(15&v)<<18|(63&p)<<12|(63&f)<<6|63&g)<=65535||y>=1114112)&&(y=null)),y===null?(y=65533,b=1):y>65535&&(y-=65536,u+=String.fromCharCode(y>>>10&1023|55296),y=56320|1023&y),u+=String.fromCharCode(y),h+=b}return u}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Xn.Bytes)return e.push(this.readVarint(t));var i=fc(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Xn.Bytes)return e.push(this.readSVarint());var t=fc(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Xn.Bytes)return e.push(this.readBoolean());var t=fc(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Xn.Bytes)return e.push(this.readFloat());var t=fc(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Xn.Bytes)return e.push(this.readDouble());var t=fc(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Xn.Bytes)return e.push(this.readFixed32());var t=fc(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Xn.Bytes)return e.push(this.readSFixed32());var t=fc(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Xn.Bytes)return e.push(this.readFixed64());var t=fc(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Xn.Bytes)return e.push(this.readSFixed64());var t=fc(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Xn.Varint)for(;this.buf[this.pos++]>127;);else if(t===Xn.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Xn.Fixed32)this.pos+=4;else{if(t!==Xn.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Mh(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Mh(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Mh(this.buf,-1&e,this.pos),Mh(this.buf,Math.floor(e*Ak),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Mh(this.buf,-1&e,this.pos),Mh(this.buf,Math.floor(e*Ak),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,i){var o,c;if(t>=0?(o=t%4294967296|0,c=t/4294967296|0):(c=~(-t/4294967296),4294967295^(o=~(-t%4294967296))?o=o+1|0:(o=0,c=c+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(u,h,p){p.buf[p.pos++]=127&u|128,u>>>=7,p.buf[p.pos++]=127&u|128,u>>>=7,p.buf[p.pos++]=127&u|128,u>>>=7,p.buf[p.pos++]=127&u|128,p.buf[p.pos]=127&(u>>>=7)}(o,0,i),function(u,h){var p=(7&u)<<4;h.buf[h.pos++]|=p|((u>>>=3)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u)))))}(c,i)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(o,c,u){for(var h,p,f=0;f<c.length;f++){if((h=c.charCodeAt(f))>55295&&h<57344){if(!p){h>56319||f+1===c.length?(o[u++]=239,o[u++]=191,o[u++]=189):p=h;continue}if(h<56320){o[u++]=239,o[u++]=191,o[u++]=189,p=h;continue}h=p-55296<<10|h-56320|65536,p=null}else p&&(o[u++]=239,o[u++]=191,o[u++]=189,p=null);h<128?o[u++]=h:(h<2048?o[u++]=h>>6|192:(h<65536?o[u++]=h>>12|224:(o[u++]=h>>18|240,o[u++]=h>>12&63|128),o[u++]=h>>6&63|128),o[u++]=63&h|128)}return u}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&Rk(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),c0.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),c0.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var o=this.pos-i;o>=128&&Rk(i,o,this),this.pos=i-1,this.writeVarint(o),this.pos+=o},writeMessage:function(e,t,i){this.writeTag(e,Xn.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,r8,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,o8,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,l8,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,s8,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,a8,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,c8,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,d8,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,u8,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,h8,t)},writeBytesField:function(e,t){this.writeTag(e,Xn.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Xn.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Xn.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Xn.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Xn.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Xn.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Xn.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Xn.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Xn.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Xn.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,!!t)}};var u0=ut(Ik);let m8=["tile","layer","source","sourceLayer","state"];class Ok{constructor(t,i,o,c,u){this.type="Feature",this._vectorTileFeature=t,this._z=i,this._x=o,this._y=c,this.properties=t.properties,this.id=u}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){let t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(t.id=this.id);for(let i of m8)this[i]!==void 0&&(t[i]=this[i]);return t}}class p8{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,i,o){let c=String(i);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][c]=this.stateChanges[t][c]||{},ge(this.stateChanges[t][c],o),this.deletedStates[t]===null){this.deletedStates[t]={};for(let u in this.state[t])u!==c&&(this.deletedStates[t][u]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][c]===null){this.deletedStates[t][c]={};for(let u in this.state[t][c])o[u]||(this.deletedStates[t][c][u]=null)}else for(let u in o)this.deletedStates[t]&&this.deletedStates[t][c]&&this.deletedStates[t][c][u]===null&&delete this.deletedStates[t][c][u]}removeFeatureState(t,i,o){if(this.deletedStates[t]===null)return;let c=String(i);if(this.deletedStates[t]=this.deletedStates[t]||{},o&&i!==void 0)this.deletedStates[t][c]!==null&&(this.deletedStates[t][c]=this.deletedStates[t][c]||{},this.deletedStates[t][c][o]=null);else if(i!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][c])for(o in this.deletedStates[t][c]={},this.stateChanges[t][c])this.deletedStates[t][c][o]=null;else this.deletedStates[t][c]=null;else this.deletedStates[t]=null}getState(t,i){let o=String(i),c=ge({},(this.state[t]||{})[o],(this.stateChanges[t]||{})[o]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){let u=this.deletedStates[t][i];if(u===null)return{};for(let h in u)delete c[h]}return c}initializeTileState(t,i){t.setFeatureState(this.state,i)}coalesceChanges(t,i){let o={};for(let c in this.stateChanges){this.state[c]=this.state[c]||{};let u={};for(let h in this.stateChanges[c])this.state[c][h]||(this.state[c][h]={}),ge(this.state[c][h],this.stateChanges[c][h]),u[h]=this.state[c][h];o[c]=u}for(let c in this.deletedStates){this.state[c]=this.state[c]||{};let u={};if(this.deletedStates[c]===null)for(let h in this.state[c])u[h]={},this.state[c][h]={};else for(let h in this.deletedStates[c]){if(this.deletedStates[c][h]===null)this.state[c][h]={};else if(this.state[c][h])for(let p of Object.keys(this.deletedStates[c][h]))delete this.state[c][h][p];u[h]=this.state[c][h]}o[c]=o[c]||{},ge(o[c],u)}if(this.stateChanges={},this.deletedStates={},Object.keys(o).length!==0)for(let c in t)t[c].setFeatureState(o,i)}}class Fk{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,i){let o=this.toIdx(t,i);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(t,i){return this.leaves[this.toIdx(t,i)]}toIdx(t,i){return i*this.size+t}}function Lk(e,t,i,o){let c=0,u=Number.MAX_VALUE;for(let h=0;h<3;h++)if(Math.abs(o[h])<1e-15){if(i[h]<e[h]||i[h]>t[h])return null}else{let p=1/o[h],f=(e[h]-i[h])*p,g=(t[h]-i[h])*p;if(f>g){let v=f;f=g,g=v}if(f>c&&(c=f),g<u&&(u=g),c>u)return null}return c}function zk(e,t,i,o,c,u,h,p,f,g,v){let y=o-e,b=c-t,x=u-i,C=h-e,E=p-t,M=f-i,D=v[1]*M-v[2]*E,I=v[2]*C-v[0]*M,P=v[0]*E-v[1]*C,O=y*D+b*I+x*P;if(Math.abs(O)<1e-15)return null;let R=1/O,F=g[0]-e,z=g[1]-t,j=g[2]-i,U=(F*D+z*I+j*P)*R;if(U<0||U>1)return null;let G=z*x-j*b,$=j*y-F*x,Y=F*b-z*y,tt=(v[0]*G+v[1]*$+v[2]*Y)*R;return tt<0||U+tt>1?null:(C*G+E*$+M*Y)*R}function Nk(e,t,i){return(e-t)/(i-t)}function Bk(e,t,i,o,c,u,h,p,f){let g=1<<i,v=u-o,y=h-c,b=(e+1)/g*v+o,x=(t+0)/g*y+c,C=(t+1)/g*y+c;p[0]=(e+0)/g*v+o,p[1]=x,f[0]=b,f[1]=C}class Vk{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let i=function(u){let h=Math.ceil(Math.log2(u.dim/8)),p=[],f=Math.ceil(Math.pow(2,h)),g=1/f,v=(x,C,E,M,D)=>{let I=M?1:0,P=(x+1)*E-I,O=C*E,R=(C+1)*E-I;D[0]=x*E,D[1]=O,D[2]=P,D[3]=R},y=new Fk(f),b=[];for(let x=0;x<f*f;x++){v(x%f,Math.floor(x/f),g,!1,b);let C=id(b[0],b[1],u),E=id(b[2],b[1],u),M=id(b[2],b[3],u),D=id(b[0],b[3],u);y.minimums.push(Math.min(C,E,M,D)),y.maximums.push(Math.max(C,E,M,D)),y.leaves.push(1)}for(p.push(y),f/=2;f>=1;f/=2){let x=p[p.length-1];y=new Fk(f);for(let C=0;C<f*f;C++){v(C%f,Math.floor(C/f),2,!0,b);let E=x.getElevation(b[0],b[1]),M=x.getElevation(b[2],b[1]),D=x.getElevation(b[2],b[3]),I=x.getElevation(b[0],b[3]),P=x.isLeaf(b[0],b[1]),O=x.isLeaf(b[2],b[1]),R=x.isLeaf(b[2],b[3]),F=x.isLeaf(b[0],b[3]),z=Math.min(E.min,M.min,D.min,I.min),j=Math.max(E.max,M.max,D.max,I.max),U=P&&O&&R&&F;y.maximums.push(j),y.minimums.push(z),y.leaves.push(j-z<=5&&U?1:0)}p.push(y)}return p}(this.dem),o=i.length-1,c=i[o];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(i,0,0,o,0)}raycastRoot(t,i,o,c,u,h,p=1){return Lk([t,i,-100],[o,c,this.maximums[0]*p],u,h)}raycast(t,i,o,c,u,h,p=1){if(!this.nodeCount)return null;let f=this.raycastRoot(t,i,o,c,u,h,p);if(f==null)return null;let g=[],v=[],y=[],b=[],x=[{idx:0,t:f,nodex:0,nodey:0,depth:0}];for(;x.length>0;){let{idx:C,t:E,nodex:M,nodey:D,depth:I}=x.pop();if(this.leaves[C]){Bk(M,D,I,t,i,o,c,y,b);let O=1<<I,R=(M+0)/O,F=(M+1)/O,z=(D+0)/O,j=(D+1)/O,U=id(R,z,this.dem)*p,G=id(F,z,this.dem)*p,$=id(F,j,this.dem)*p,Y=id(R,j,this.dem)*p,tt=zk(y[0],y[1],U,b[0],y[1],G,b[0],b[1],$,u,h),W=zk(b[0],b[1],$,y[0],b[1],Y,y[0],y[1],U,u,h),rt=Math.min(tt!==null?tt:Number.MAX_VALUE,W!==null?W:Number.MAX_VALUE);if(rt!==Number.MAX_VALUE)return rt;{let st=J.scaleAndAdd([],u,h,E);if(jk(U,G,Y,$,Nk(st[0],y[0],b[0]),Nk(st[1],y[1],b[1]))>=st[2])return E}continue}let P=0;for(let O=0;O<this._siblingOffset.length;O++){Bk((M<<1)+this._siblingOffset[O][0],(D<<1)+this._siblingOffset[O][1],I+1,t,i,o,c,y,b),y[2]=-100,b[2]=this.maximums[this.childOffsets[C]+O]*p;let R=Lk(y,b,u,h);if(R!=null){let F=R;g[O]=F;let z=!1;for(let j=0;j<P&&!z;j++)F>=g[v[j]]&&(v.splice(j,0,O),z=!0);z||(v[P]=O),P++}}for(let O=0;O<P;O++){let R=v[O];x.push({idx:this.childOffsets[C]+R,t:g[R],nodex:(M<<1)+this._siblingOffset[R][0],nodey:(D<<1)+this._siblingOffset[R][1],depth:I+1})}}return null}_addNode(t,i,o){return this.minimums.push(t),this.maximums.push(i),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(t,i,o,c,u){if(t[c].isLeaf(i,o)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);let h=c-1,p=t[h],f=0,g=0;for(let v=0;v<this._siblingOffset.length;v++){let y=2*i+this._siblingOffset[v][0],b=2*o+this._siblingOffset[v][1],x=p.getElevation(y,b),C=p.isLeaf(y,b),E=this._addNode(x.min,x.max,C);C&&(f|=1<<v),g||(g=E)}for(let v=0;v<this._siblingOffset.length;v++)f&1<<v||this._construct(t,2*i+this._siblingOffset[v][0],2*o+this._siblingOffset[v][1],h,g+v)}}function jk(e,t,i,o,c,u){return $e($e(e,i,u),$e(t,o,u),c)}function id(e,t,i){let o=i.dim,c=ve(e*o-.5,0,o-1),u=ve(t*o-.5,0,o-1),h=Math.floor(c),p=Math.floor(u),f=Math.min(h+1,o-1),g=Math.min(p+1,o-1);return jk(i.get(h,p),i.get(f,p),i.get(h,g),i.get(f,g),c-h,u-p)}let f8={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function g8(e,t,i){return(256*e*256+256*t+i)/10-1e4}function _8(e,t,i){return 256*e+t+i/256-32768}class h0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,i,o,c=!1){if(this.uid=t,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return lt(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;let u=this.dim=i.height-2,h=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=c,this._modifiedForSources={},!c){for(let f=0;f<u;f++)h[this._idx(-1,f)]=h[this._idx(0,f)],h[this._idx(u,f)]=h[this._idx(u-1,f)],h[this._idx(f,-1)]=h[this._idx(f,0)],h[this._idx(f,u)]=h[this._idx(f,u-1)];h[this._idx(-1,-1)]=h[this._idx(0,0)],h[this._idx(u,-1)]=h[this._idx(u-1,0)],h[this._idx(-1,u)]=h[this._idx(0,u-1)],h[this._idx(u,u)]=h[this._idx(u-1,u-1)]}let p=o==="terrarium"?_8:g8;for(let f=0;f<h.length;++f){let g=4*f;this.floatView[f]=p(this.pixels[g],this.pixels[g+1],this.pixels[g+2])}this._timestamp=ni.now()}_buildQuadTree(){this._tree=new Vk(this)}get(t,i,o=!1){o&&(t=ve(t,-1,this.dim),i=ve(i,-1,this.dim));let c=this._idx(t,i);return this.floatView[c]}set(t,i,o){let c=this._idx(t,i),u=this.floatView[c];return this.floatView[c]=o,o-u}static getUnpackVector(t){return f8[t]}_idx(t,i){if(t<-1||t>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(t+1)}static pack(t,i){let o=[0,0,0,0],c=h0.getUnpackVector(i),u=Math.floor((t+c[3])/c[2]);return o[2]=u%256,u=Math.floor(u/256),o[1]=u%256,u=Math.floor(u/256),o[0]=u,o}getPixels(){return new bk({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,i,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let c=i*this.dim,u=i*this.dim+this.dim,h=o*this.dim,p=o*this.dim+this.dim;switch(i){case-1:c=u-1;break;case 1:u=c+1}switch(o){case-1:h=p-1;break;case 1:p=h+1}let f=-i*this.dim,g=-o*this.dim;for(let v=h;v<p;v++)for(let y=c;y<u;y++){let b=4*this._idx(y,v),x=4*this._idx(y+f,v+g);this.pixels[b+0]=t.pixels[x+0],this.pixels[b+1]=t.pixels[x+1],this.pixels[b+2]=t.pixels[x+2],this.pixels[b+3]=t.pixels[x+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}xe(h0,"DEMData"),xe(Vk,"DemMinMaxQuadTree",{omit:["dem"]});class v8{isDataAvailableAtPoint(t){let i=this._source();if(this.isUsingMockSource()||!i||t.y<0||t.y>1)return!1;let o=i.getSource().maxzoom,c=1<<o,u=Math.floor(t.x),h=Math.floor((t.x-u)*c),p=Math.floor(t.y*c),f=this.findDEMTileFor(new Hi(o,u,o,h,p));return!(!f||!f.dem)}getAtPointOrZero(t,i=0){return this.getAtPoint(t,i)||0}getAtPoint(t,i,o=!0){if(this.isUsingMockSource())return null;i==null&&(i=null);let c=this._source();if(!c||t.y<0||t.y>1)return i;let u=c.getSource().maxzoom,h=1<<u,p=Math.floor(t.x),f=t.x-p,g=new Hi(u,p,u,Math.floor(f*h),Math.floor(t.y*h)),v=this.findDEMTileFor(g);if(!v||!v.dem)return i;let y=v.dem,b=1<<v.tileID.canonical.z,x=(f*b-v.tileID.canonical.x)*y.dim,C=(t.y*b-v.tileID.canonical.y)*y.dim,E=Math.floor(x),M=Math.floor(C);return(o?this.exaggeration():1)*$e($e(y.get(E,M),y.get(E,M+1),C-M),$e(y.get(E+1,M),y.get(E+1,M+1),C-M),x-E)}getAtTileOffset(t,i,o){let c=1<<t.canonical.z;return this.getAtPointOrZero(new Oi(t.wrap+(t.canonical.x+i/wt)/c,(t.canonical.y+o/wt)/c))}getAtTileOffsetFunc(t,i,o,c){return u=>{let h=this.getAtTileOffset(t,u.x,u.y),p=c.upVector(t.canonical,u.x,u.y),f=c.upVectorScale(t.canonical,i,o).metersToTile;return J.scale(p,p,h*f),p}}getForTilePoints(t,i,o,c){if(this.isUsingMockSource())return!1;let u=Dh.create(this,t,c);return!!u&&(i.forEach(h=>{h[2]=this.exaggeration()*u.getElevationAt(h[0],h[1],o)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;let i=this.findDEMTileFor(t);if(!i||!i.dem)return null;let o=i.dem.tree,c=i.tileID,u=1<<t.canonical.z-c.canonical.z,h=t.canonical.x/u-c.canonical.x,p=t.canonical.y/u-c.canonical.y,f=0;for(let g=0;g<t.canonical.z-c.canonical.z&&!o.leaves[f];g++){h*=2,p*=2;let v=2*Math.floor(p)+Math.floor(h);f=o.childOffsets[f]+v,h%=1,p%=1}return{min:this.exaggeration()*o.minimums[f],max:this.exaggeration()*o.maximums[f]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,i,o){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let t=this.visibleDemTiles;if(t.length===0)return null;let i=!1,o=Number.MAX_VALUE,c=Number.MIN_VALUE;for(let u of t){let h=this.getMinMaxForTile(u.tileID);h&&(o=Math.min(o,h.min),c=Math.max(c,h.max),i=!0)}return i?{min:o,max:c}:null}}class Dh{constructor(t,i,o){this._demTile=t,this._dem=this._demTile.dem,this._scale=i,this._offset=o}static create(t,i,o){let c=o||t.findDEMTileFor(i);if(!c||!c.dem)return;let u=c.dem,h=c.tileID,p=1<<i.canonical.z-h.canonical.z;return new Dh(c,u.dim/wt/p,[(i.canonical.x/p-h.canonical.x)*u.dim,(i.canonical.y/p-h.canonical.y)*u.dim])}tileCoordToPixel(t,i){let o=i*this._scale+this._offset[1],c=Math.floor(t*this._scale+this._offset[0]),u=Math.floor(o);return new Q(c,u)}getElevationAt(t,i,o,c){let u=t*this._scale+this._offset[0],h=i*this._scale+this._offset[1],p=Math.floor(u),f=Math.floor(h),g=this._dem;return c=!!c,o?$e($e(g.get(p,f,c),g.get(p,f+1,c),h-f),$e(g.get(p+1,f,c),g.get(p+1,f+1,c),h-f),u-p):g.get(p,f,c)}getElevationAtPixel(t,i,o){return this._dem.get(t,i,!!o)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*_n(1,t)*this._dem.stride}}class cC{constructor(t,i){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new uh(wt,16,0),this.featureIndexArray=new _2,this.promoteId=i}insert(t,i,o,c,u,h=0){let p=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,c,u,h);let f=this.grid;for(let g=0;g<i.length;g++){let v=i[g],y=[1/0,1/0,-1/0,-1/0];for(let b=0;b<v.length;b++){let x=v[b];y[0]=Math.min(y[0],x.x),y[1]=Math.min(y[1],x.y),y[2]=Math.max(y[2],x.x),y[3]=Math.max(y[3],x.y)}y[0]<wt&&y[1]<wt&&y[2]>=0&&y[3]>=0&&f.insert(p,y[0],y[1],y[2],y[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new aC(new u0(this.rawTileData)).layers,this.sourceLayerCoder=new Tk(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,i,o,c){this.loadVTLayers();let u=t.params||{},h=S_(u.filter),p=t.tileResult,f=t.transform,g=p.bufferedTilespaceBounds,v=this.grid.query(g.min.x,g.min.y,g.max.x,g.max.y,(C,E,M,D)=>uk(p.bufferedTilespaceGeometry,C,E,M,D));v.sort(y8);let y=null;f.elevation&&v.length>0&&(y=Dh.create(f.elevation,this.tileID));let b={},x;for(let C=0;C<v.length;C++){let E=v[C];if(E===x)continue;x=E;let M=this.featureIndexArray.get(E),D=null;this.loadMatchingFeature(b,M,h,u.layers,u.availableImages,i,o,c,(I,P,O,R=0)=>(D||(D=Dl(I,this.tileID.canonical,t.tileTransform)),P.queryIntersectsFeature(p,I,O,D,this.z,t.transform,t.pixelPosMatrix,y,R)))}return b}loadMatchingFeature(t,i,o,c,u,h,p,f,g){let{featureIndex:v,bucketIndex:y,sourceLayerIndex:b,layoutVertexArrayOffset:x}=i,C=this.bucketLayerIDs[y];if(c&&!function(I,P){for(let O=0;O<I.length;O++)if(P.indexOf(I[O])>=0)return!0;return!1}(c,C))return;let E=this.sourceLayerCoder.decode(b),M=this.vtLayers[E].feature(v);if(o.needGeometry){let I=td(M,!0);if(!o.filter(new Jn(this.tileID.overscaledZ),I,this.tileID.canonical))return}else if(!o.filter(new Jn(this.tileID.overscaledZ),M))return;let D=this.getId(M,E);for(let I=0;I<C.length;I++){let P=C[I];if(c&&c.indexOf(P)<0)continue;let O=h[P];if(!O)continue;let R={};D!==void 0&&f&&(R=f.getState(O.sourceLayer||"_geojsonTileLayer",D));let F=ge({},p[P]);F.paint=Uk(F.paint,O.paint,M,R,u),F.layout=Uk(F.layout,O.layout,M,R,u);let z=!g||g(M,O,R,x);if(!z)continue;let j=new Ok(M,this.z,this.x,this.y,D);j.layer=F;let U=t[P];U===void 0&&(U=t[P]=[]),U.push({featureIndex:v,feature:j,intersectionZ:z})}}lookupSymbolFeatures(t,i,o,c,u,h,p,f){let g={};this.loadVTLayers();let v=S_(u);for(let y of t)this.loadMatchingFeature(g,{bucketIndex:o,sourceLayerIndex:c,featureIndex:y,layoutVertexArrayOffset:0},v,h,p,f,i);return g}loadFeature(t){let{featureIndex:i,sourceLayerIndex:o}=t;this.loadVTLayers();let c=this.sourceLayerCoder.decode(o),u=this.vtFeatures[c];if(u[i])return u[i];let h=this.vtLayers[c].feature(i);return u[i]=h,h}hasLayer(t){for(let i of this.bucketLayerIDs)for(let o of i)if(t===o)return!0;return!1}getId(t,i){let o=t.id;if(this.promoteId){let c=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];c!=null&&(o=t.properties[c]),typeof o=="boolean"&&(o=Number(o))}return o}}function Uk(e,t,i,o,c){return Yu(e,(u,h)=>{let p=t instanceof Ep?t.get(h):null;return p&&p.evaluate?p.evaluate(i,o,c):p})}function y8(e,t){return t-e}xe(cC,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});let b8=Qi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),x8=Qi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),w8=Qi([{name:"a_projected_pos",components:4,type:"Float32"}],4);Qi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let C8=Qi([{name:"a_z_offset",components:1,type:"Float32"}],4),S8=Qi([{name:"a_texb",components:2,type:"Uint16"}]),E8=Qi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),M8=Qi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Qi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let Hk=Qi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),D8=Qi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Qi([{name:"triangle",components:3,type:"Uint16"}]),Qi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Qi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Qi([{type:"Float32",name:"offsetX"}]),Qi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Co=24;let Ka=128;function dC(e,t){let{expression:i}=t;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Jn(e+1))};if(i.kind==="source")return{kind:"source"};{let{zoomStops:o,interpolationType:c}=i,u=0;for(;u<o.length&&o[u]<=e;)u++;u=Math.max(0,u-1);let h=u;for(;h<o.length&&o[h]<e+1;)h++;h=Math.min(o.length-1,h);let p=o[u],f=o[h];return i.kind==="composite"?{kind:"composite",minZoom:p,maxZoom:f,interpolationType:c}:{kind:"camera",minZoom:p,maxZoom:f,minSize:i.evaluate(new Jn(p)),maxSize:i.evaluate(new Jn(f)),interpolationType:c}}}function Vp(e,{uSize:t,uSizeT:i},{lowerSize:o,upperSize:c}){return e.kind==="source"?o/Ka:e.kind==="composite"?$e(o/Ka,c/Ka,i):t}function Tl(e,t){let i=0,o=0;if(e.kind==="constant")o=e.layoutSize;else if(e.kind!=="source"){let{interpolationType:c,minZoom:u,maxZoom:h}=e,p=c?ve(Cl.interpolationFactor(c,t,u,h),0,1):0;e.kind==="camera"?o=$e(e.minSize,e.maxSize,p):i=p}return{uSizeT:i,uSize:o}}var T8=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ka,evaluateSizeForFeature:Vp,evaluateSizeForZoom:Tl,getSizeData:dC});function I8(e,t,i){return e.sections.forEach(o=>{o.text=function(c,u,h){let p=u.layout.get("text-transform").evaluate(h,{});return p==="uppercase"?c=c.toLocaleUpperCase():p==="lowercase"&&(c=c.toLocaleLowerCase()),ca.applyArabicShaping&&(c=ca.applyArabicShaping(c)),c}(o.text,t,i)}),e}let jp={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function A8(e){return e==="\uFE36"||e==="\uFE48"||e==="\uFE38"||e==="\uFE44"||e==="\uFE42"||e==="\uFE3E"||e==="\uFE3C"||e==="\uFE3A"||e==="\uFE18"||e==="\uFE40"||e==="\uFE10"||e==="\uFE13"||e==="\uFE14"||e==="\uFF40"||e==="\uFFE3"||e==="\uFE11"||e==="\uFE12"}function k8(e){return e==="\uFE35"||e==="\uFE47"||e==="\uFE37"||e==="\uFE43"||e==="\uFE41"||e==="\uFE3D"||e==="\uFE3B"||e==="\uFE39"||e==="\uFE17"||e==="\uFE3F"}let uC=3;function R8(e,t,i){t.glyphs=[],e===1&&i.readMessage(P8,t)}function P8(e,t,i){if(e===3){let{id:o,bitmap:c,width:u,height:h,left:p,top:f,advance:g}=i.readMessage(O8,{});t.glyphs.push({id:o,bitmap:new pc({width:u+2*uC,height:h+2*uC},c),metrics:{width:u,height:h,left:p,top:f,advance:g}})}else e===4?t.ascender=i.readSVarint():e===5&&(t.descender=i.readSVarint())}function O8(e,t,i){e===1?t.id=i.readVarint():e===2?t.bitmap=i.readBytes():e===3?t.width=i.readVarint():e===4?t.height=i.readVarint():e===5?t.left=i.readSVarint():e===6?t.top=i.readSVarint():e===7&&(t.advance=i.readVarint())}let Gk=uC,Kn={horizontal:1,vertical:2,horizontalOnly:3},qk=-17;class Up{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,i){let o=new Up;return o.scale=t||1,o.fontStack=i,o}static forImage(t){let i=new Up;return i.imageName=t,i}}class Th{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,i){let o=new Th;for(let c=0;c<t.sections.length;c++){let u=t.sections[c];u.image?o.addImageSection(u):o.addTextSection(u,i)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(i,o){let c="";for(let u=0;u<i.length;u++){let h=i.charCodeAt(u+1)||null,p=i.charCodeAt(u-1)||null;c+=!o&&(h&&t2(h)&&!jp[i[u+1]]||p&&t2(p)&&!jp[i[u-1]])||!jp[i[u]]?i[u]:jp[i[u]]}return c}(this.text,t)}trim(){let t=0;for(let o=0;o<this.text.length&&m0[this.text.charCodeAt(o)];o++)t++;let i=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&m0[this.text.charCodeAt(o)];o--)i--;this.text=this.text.substring(t,i),this.sectionIndex=this.sectionIndex.slice(t,i)}substring(t,i){let o=new Th;return o.text=this.text.substring(t,i),o.sectionIndex=this.sectionIndex.slice(t,i),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,i)=>Math.max(t,this.sections[i].scale),0)}addTextSection(t,i){this.text+=t.text,this.sections.push(Up.forText(t.scale,t.fontStack||i));let o=this.sections.length-1;for(let c=0;c<t.text.length;++c)this.sectionIndex.push(o)}addImageSection(t){let i=t.image?t.image.namePrimary:"";if(i.length===0)return void lt("Can't add FormattedSection with an empty image.");let o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCodePoint(o),this.sections.push(Up.forImage(i)),this.sectionIndex.push(this.sections.length-1)):lt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function hC(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C){let E=Th.fromFeature(e,c);y===Kn.vertical&&E.verticalizePunctuation(b);let M=[],D=function(F,z,j,U,G,$){if(!F)return[];let Y=[],tt=function(pt,nt,ot,_t,bt,yt){let Ct=0;for(let St=0;St<pt.length();St++){let Tt=pt.getSection(St);Ct+=Wk(pt.getCodePoint(St),Tt,_t,bt,nt,yt)}return Ct/Math.max(1,Math.ceil(Ct/ot))}(F,z,j,U,G,$),W=F.text.indexOf("\u200B")>=0,rt=0;for(let pt=0;pt<F.length();pt++){let nt=F.getSection(pt),ot=F.getCodePoint(pt);if(m0[ot]||(rt+=Wk(ot,nt,U,G,z,$)),pt<F.length()-1){let _t=!((st=ot)<11904||!(Te["Bopomofo Extended"](st)||Te.Bopomofo(st)||Te["CJK Compatibility Forms"](st)||Te["CJK Compatibility Ideographs"](st)||Te["CJK Compatibility"](st)||Te["CJK Radicals Supplement"](st)||Te["CJK Strokes"](st)||Te["CJK Symbols and Punctuation"](st)||Te["CJK Unified Ideographs Extension A"](st)||Te["CJK Unified Ideographs"](st)||Te["Enclosed CJK Letters and Months"](st)||Te["Halfwidth and Fullwidth Forms"](st)||Te.Hiragana(st)||Te["Ideographic Description Characters"](st)||Te["Kangxi Radicals"](st)||Te["Katakana Phonetic Extensions"](st)||Te.Katakana(st)||Te["Vertical Forms"](st)||Te["Yi Radicals"](st)||Te["Yi Syllables"](st)));(F8[ot]||_t||nt.imageName)&&Y.push(Yk(pt+1,rt,tt,Y,L8(ot,F.getCodePoint(pt+1),_t&&W),!1))}}var st;return Zk(Yk(F.length(),rt,tt,Y,0,!0))}(E,g,u,t,o,x),{processBidirectionalText:I,processStyledBidirectionalText:P}=ca;if(I&&E.sections.length===1){let F=I(E.toString(),D);for(let z of F){let j=new Th;j.text=z,j.sections=E.sections;for(let U=0;U<z.length;U++)j.sectionIndex.push(0);M.push(j)}}else if(P){let F=P(E.text,E.sectionIndex,D);for(let z of F){let j=new Th;j.text=z[0],j.sectionIndex=z[1],j.sections=E.sections,M.push(j)}}else M=function(F,z){let j=[],U=F.text,G=0;for(let $ of z)j.push(F.substring(G,$)),G=$;return G<U.length&&j.push(F.substring(G,U.length)),j}(E,D);let O=[],R={positionedLines:O,text:E.toString(),top:v[1],bottom:v[1],left:v[0],right:v[0],writingMode:y,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(F,z,j,U,G,$,Y,tt,W,rt,st,pt){let nt=0,ot=0,_t=0,bt=tt==="right"?1:tt==="left"?0:.5,yt=!1;for(let Qt of G){let Jt=Qt.getSections();for(let le of Jt){if(le.imageName)continue;let me=z[le.fontStack];if(me&&(yt=me.ascender!==void 0&&me.descender!==void 0,!yt))break}if(!yt)break}let Ct=0;for(let Qt of G){Qt.trim();let Jt=Qt.getMaxScale(),le=(Jt-1)*Co,me={positionedGlyphs:[],lineOffset:0};F.positionedLines[Ct]=me;let Ue=me.positionedGlyphs,Ie=0;if(!Qt.length()){ot+=$,++Ct;continue}let Bi=0,Ci=0;for(let Ne=0;Ne<Qt.length();Ne++){let ke=Qt.getSection(Ne),Di=Qt.getSectionIndex(Ne),zi=Qt.getCodePoint(Ne),pi=ke.scale,vn=null,Mr=null,hn=null,zn=Co,Lr=0,Dr=!(W===Kn.horizontal||!st&&!W1(zi)||st&&(m0[zi]||(St=zi,Te.Arabic(St)||Te["Arabic Supplement"](St)||Te["Arabic Extended-A"](St)||Te["Arabic Presentation Forms-A"](St)||Te["Arabic Presentation Forms-B"](St))));if(ke.imageName){let Gn=U[ke.imageName];if(!Gn)continue;hn=ke.imageName,F.iconsInText=F.iconsInText||!0,Mr=Gn.paddedRect;let an=Gn.displaySize;pi=pi*Co/pt,vn={width:an[0],height:an[1],left:0,top:-Gk,advance:Dr?an[1]:an[0],localGlyph:!1},Lr=yt?-vn.height*pi:qk+Jt*Co-an[1]*pi,zn=vn.advance;let ko=(Dr?an[0]:an[1])*pi-Co*Jt;ko>0&&ko>Ie&&(Ie=ko)}else{let Gn=j[ke.fontStack];if(!Gn)continue;Gn[zi]&&(Mr=Gn[zi]);let an=z[ke.fontStack];if(!an)continue;let ko=an.glyphs[zi];if(!ko)continue;if(vn=ko.metrics,zn=zi!==8203?Co:0,yt){let Ol=an.ascender!==void 0?Math.abs(an.ascender):0,_c=an.descender!==void 0?Math.abs(an.descender):0,vc=(Ol+_c)*pi;Bi<vc&&(Bi=vc,Ci=(Ol-_c)/2*pi),Lr=-Ol*pi}else Lr=qk+(Jt-pi)*Co}Dr?(F.verticalizable=!0,Ue.push({glyph:zi,imageName:hn,x:nt,y:ot+Lr,vertical:Dr,scale:pi,localGlyph:vn.localGlyph,fontStack:ke.fontStack,sectionIndex:Di,metrics:vn,rect:Mr}),nt+=zn*pi+rt):(Ue.push({glyph:zi,imageName:hn,x:nt,y:ot+Lr,vertical:Dr,scale:pi,localGlyph:vn.localGlyph,fontStack:ke.fontStack,sectionIndex:Di,metrics:vn,rect:Mr}),nt+=vn.advance*pi+rt)}Ue.length!==0&&(_t=Math.max(nt-rt,_t),yt?Xk(Ue,bt,Ie,Ci,$*Jt/2):Xk(Ue,bt,Ie,0,$/2)),nt=0;let He=$*Jt+Ie;me.lineOffset=Math.max(Ie,le),ot+=He,++Ct}var St;let Tt=ot,{horizontalAlign:xt,verticalAlign:Ft}=p0(Y);(function(Qt,Jt,le,me,Ue,Ie){let Bi=(Jt-le)*Ue,Ci=-Ie*me;for(let He of Qt)for(let Ne of He.positionedGlyphs)Ne.x+=Bi,Ne.y+=Ci})(F.positionedLines,bt,xt,Ft,_t,Tt),F.top+=-Ft*Tt,F.bottom=F.top+Tt,F.left+=-xt*_t,F.right=F.left+_t,F.hasBaseline=yt}(R,t,i,o,M,h,p,f,y,g,b,C),!function(F){for(let z of F)if(z.positionedGlyphs.length!==0)return!1;return!0}(O)&&R}let m0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},F8={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Wk(e,t,i,o,c,u){if(t.imageName){let h=o[t.imageName];return h?h.displaySize[0]*t.scale*Co/u+c:0}{let h=i[t.fontStack],p=h&&h.glyphs[e];return p?p.metrics.advance*t.scale+c:0}}function $k(e,t,i,o){let c=Math.pow(e-t,2);return o?e<t?c/2:2*c:c+Math.abs(i)*i}function L8(e,t,i){let o=0;return e===10&&(o-=1e4),i&&(o+=150),e!==40&&e!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function Yk(e,t,i,o,c,u){let h=null,p=$k(t,i,c,u);for(let f of o){let g=$k(t-f.x,i,c,u)+f.badness;g<=p&&(h=f,p=g)}return{index:e,x:t,priorBreak:h,badness:p}}function Zk(e){return e?Zk(e.priorBreak).concat(e.index):[]}function p0(e){let t=.5,i=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function Xk(e,t,i,o,c){if(!(t||i||o||c))return;let u=e.length-1,h=e[u],p=(h.x+h.metrics.advance*h.scale)*t;for(let f=0;f<=u;f++)e[f].x-=p,e[f].y+=i+o+c}function z8(e,t,i,o){let{horizontalAlign:c,verticalAlign:u}=p0(o),h=i[0]-e.displaySize[0]*c,p=i[1]-e.displaySize[1]*u;return{imagePrimary:e,imageSecondary:t,top:p,bottom:p+e.displaySize[1],left:h,right:h+e.displaySize[0]}}function Kk(e,t,i,o,c,u){let h=e.imagePrimary,p;if(h.content){let M=h.content,D=h.pixelRatio||1;p=[M[0]/D,M[1]/D,h.displaySize[0]-M[2]/D,h.displaySize[1]-M[3]/D]}let f=t.left*u,g=t.right*u,v,y,b,x;i==="width"||i==="both"?(x=c[0]+f-o[3],y=c[0]+g+o[1]):(x=c[0]+(f+g-h.displaySize[0])/2,y=x+h.displaySize[0]);let C=t.top*u,E=t.bottom*u;return i==="height"||i==="both"?(v=c[1]+C-o[0],b=c[1]+E+o[2]):(v=c[1]+(C+E-h.displaySize[1])/2,b=v+h.displaySize[1]),{imagePrimary:h,imageSecondary:void 0,top:v,right:y,bottom:b,left:x,collisionPadding:p}}class gc extends Q{constructor(t,i,o,c,u){super(t,i),this.angle=c,this.z=o,u!==void 0&&(this.segment=u)}clone(){return new gc(this.x,this.y,this.z,this.angle,this.segment)}}function Qk(e,t,i,o,c){if(t.segment===void 0)return!0;let u=t,h=t.segment+1,p=0;for(;p>-i/2;){if(h--,h<0)return!1;p-=e[h].dist(u),u=e[h]}p+=e[h].dist(e[h+1]),h++;let f=[],g=0;for(;p<i/2;){let v=e[h],y=e[h+1];if(!y)return!1;let b=e[h-1].angleTo(v)-v.angleTo(y);for(b=Math.abs((b+3*Math.PI)%(2*Math.PI)-Math.PI),f.push({distance:p,angleDelta:b}),g+=b;p-f[0].distance>o;)g-=f.shift().angleDelta;if(g>c)return!1;h++,p+=v.dist(y)}return!0}function Jk(e){let t=0;for(let i=0;i<e.length-1;i++)t+=e[i].dist(e[i+1]);return t}function tR(e,t,i){return e?.6*t*i:0}function eR(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function N8(e,t,i,o,c,u){let h=tR(i,c,u),p=eR(i,o)*u,f=0,g=Jk(e)/2;for(let v=0;v<e.length-1;v++){let y=e[v],b=e[v+1],x=y.dist(b);if(f+x>g){let C=(g-f)/x,E=$e(y.x,b.x,C),M=$e(y.y,b.y,C),D=new gc(E,M,0,b.angleTo(y),v);return!h||Qk(e,D,p,h,t)?D:void 0}f+=x}}function B8(e,t,i,o,c,u,h,p,f){let g=tR(o,u,h),v=eR(o,c),y=v*h,b=e[0].x===0||e[0].x===f||e[0].y===0||e[0].y===f;return t-y<t/4&&(t=y+t/4),iR(e,b?t/2*p%t:(v/2+2*u)*h*p%t,t,g,i,y,b,!1,f)}function iR(e,t,i,o,c,u,h,p,f){let g=u/2,v=Jk(e),y=0,b=t-i,x=[];for(let C=0;C<e.length-1;C++){let E=e[C],M=e[C+1],D=E.dist(M),I=M.angleTo(E);for(;b+i<y+D;){b+=i;let P=(b-y)/D,O=$e(E.x,M.x,P),R=$e(E.y,M.y,P);if(O>=0&&O<f&&R>=0&&R<f&&b-g>=0&&b+g<=v){let F=new gc(O,R,0,I,C);o&&!Qk(e,F,u,o,c)||x.push(F)}}y+=D}return p||x.length||h||(x=iR(e,y/2,i,o,c,u,h,!0,f)),x}function nR(e,t,i,o,c){let u=[];for(let h=0;h<e.length;h++){let p=e[h],f;for(let g=0;g<p.length-1;g++){let v=p[g],y=p[g+1];v.x<t&&y.x<t||(v.x<t?v=new Q(t,v.y+(t-v.x)/(y.x-v.x)*(y.y-v.y))._round():y.x<t&&(y=new Q(t,v.y+(t-v.x)/(y.x-v.x)*(y.y-v.y))._round()),v.y<i&&y.y<i||(v.y<i?v=new Q(v.x+(i-v.y)/(y.y-v.y)*(y.x-v.x),i)._round():y.y<i&&(y=new Q(v.x+(i-v.y)/(y.y-v.y)*(y.x-v.x),i)._round()),v.x>=o&&y.x>=o||(v.x>=o?v=new Q(o,v.y+(o-v.x)/(y.x-v.x)*(y.y-v.y))._round():y.x>=o&&(y=new Q(o,v.y+(o-v.x)/(y.x-v.x)*(y.y-v.y))._round()),v.y>=c&&y.y>=c||(v.y>=c?v=new Q(v.x+(c-v.y)/(y.y-v.y)*(y.x-v.x),c)._round():y.y>=c&&(y=new Q(v.x+(c-v.y)/(y.y-v.y)*(y.x-v.x),c)._round()),f&&v.equals(f[f.length-1])||(f=[v],u.push(f)),f.push(y)))))}}return u}function mC(e){let t=0,i=0;for(let h of e)t+=h.w*h.h,i=Math.max(i,h.w);e.sort((h,p)=>p.h-h.h);let o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}],c=0,u=0;for(let h of e)for(let p=o.length-1;p>=0;p--){let f=o[p];if(!(h.w>f.w||h.h>f.h)){if(h.x=f.x,h.y=f.y,u=Math.max(u,h.y+h.h),c=Math.max(c,h.x+h.w),h.w===f.w&&h.h===f.h){let g=o.pop();p<o.length&&(o[p]=g)}else h.h===f.h?(f.x+=h.w,f.w-=h.w):h.w===f.w?(f.y+=h.h,f.h-=h.h):(o.push({x:f.x+h.w,y:f.y,w:f.w-h.w,h:h.h}),f.y+=h.h,f.h-=h.h);break}}return{w:c,h:u,fill:t/(c*u)||0}}xe(gc,"Anchor");let Es=1;class pC{constructor(t,{pixelRatio:i,version:o,stretchX:c,stretchY:u,content:h}){this.paddedRect=t,this.pixelRatio=i,this.stretchX=c,this.stretchY=u,this.content=h,this.version=o}get tl(){return[this.paddedRect.x+Es,this.paddedRect.y+Es]}get br(){return[this.paddedRect.x+this.paddedRect.w-Es,this.paddedRect.y+this.paddedRect.h-Es]}get displaySize(){return[(this.paddedRect.w-2*Es)/this.pixelRatio,(this.paddedRect.h-2*Es)/this.pixelRatio]}}class rR{constructor(t,i){let o={},c={};this.haveRenderCallbacks=[];let u=[];this.addImages(t,o,u),this.addImages(i,c,u);let{w:h,h:p}=mC(u),f=new Br({width:h||1,height:p||1});for(let g in t){let v=t[g],y=o[g].paddedRect;Br.copy(v.data,f,{x:0,y:0},{x:y.x+Es,y:y.y+Es},v.data)}for(let g in i){let v=i[g],y=c[g].paddedRect,b=y.x+Es,x=y.y+Es,C=v.data.width,E=v.data.height;Br.copy(v.data,f,{x:0,y:0},{x:b,y:x},v.data),Br.copy(v.data,f,{x:0,y:E-1},{x:b,y:x-1},{width:C,height:1}),Br.copy(v.data,f,{x:0,y:0},{x:b,y:x+E},{width:C,height:1}),Br.copy(v.data,f,{x:C-1,y:0},{x:b-1,y:x},{width:1,height:E}),Br.copy(v.data,f,{x:0,y:0},{x:b+C,y:x},{width:1,height:E})}this.image=f,this.iconPositions=o,this.patternPositions=c}addImages(t,i,o){for(let c in t){let u=t[c],h={x:0,y:0,w:u.data.width+2*Es,h:u.data.height+2*Es};o.push(h),i[c]=new pC(h,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(t,i,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>t.hasImage(c,o)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,o);for(let c in t.getUpdatedImages(o))this.patchUpdatedImage(this.iconPositions[c],t.getImage(c,o),i),this.patchUpdatedImage(this.patternPositions[c],t.getImage(c,o),i)}patchUpdatedImage(t,i,o){if(!t||!i||t.version===i.version)return;t.version=i.version;let[c,u]=t.tl;o.update(i.data,void 0,{x:c,y:u})}}xe(pC,"ImagePosition"),xe(rR,"ImageAtlas");let Hp=1e20;function oR(e,t,i,o,c,u,h,p,f){for(let g=t;g<t+o;g++)sR(e,i*u+g,u,c,h,p,f);for(let g=i;g<i+c;g++)sR(e,g*u+t,1,o,h,p,f)}function sR(e,t,i,o,c,u,h){u[0]=0,h[0]=-Hp,h[1]=Hp,c[0]=e[t];for(let p=1,f=0,g=0;p<o;p++){c[p]=e[t+p*i];let v=p*p;do{let y=u[f];g=(c[p]-c[y]+v-y*y)/(p-y)/2}while(g<=h[f]&&--f>-1);f++,u[f]=p,h[f]=g,h[f+1]=Hp}for(let p=0,f=0;p<o;p++){for(;h[f+1]<p;)f++;let g=u[f],v=p-g;e[t+p*i]=c[g]+v*v}}let Qa=2;class Ih{constructor(t,i,o){this.requestManager=t,this.localGlyphMode=i,this.localFontFamily=o,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t,i){this.urls[i]=t}getGlyphs(t,i,o){let c=[],u=this.urls[i]||S.GLYPHS_URL;for(let h in t)for(let p of t[h])c.push({stack:h,id:p});fs(c,({stack:h,id:p},f)=>{let g=this.entries[h];g||(g=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let v=g.glyphs[p];if(v!==void 0)return void f(null,{stack:h,id:p,glyph:v});if(v=this._tinySDF(g,h,p),v)return g.glyphs[p]=v,void f(null,{stack:h,id:p,glyph:v});let y=Math.floor(p/256);if(256*y>65535)return void f(new Error("glyphs > 65535 not supported"));if(g.ranges[y])return void f(null,{stack:h,id:p,glyph:v});let b=g.requests[y];b||(b=g.requests[y]=[],Ih.loadGlyphRange(h,y,u,this.requestManager,(x,C)=>{if(C){g.ascender=C.ascender,g.descender=C.descender;for(let E in C.glyphs)this._doesCharSupportLocalGlyph(+E)||(g.glyphs[+E]=C.glyphs[+E]);g.ranges[y]=!0}for(let E of b)E(x,C);delete g.requests[y]})),b.push((x,C)=>{x?f(x):C&&f(null,{stack:h,id:p,glyph:C.glyphs[p]||null})})},(h,p)=>{if(h)o(h);else if(p){let f={};for(let{stack:g,id:v,glyph:y}of p)f[g]===void 0&&(f[g]={}),f[g].glyphs===void 0&&(f[g].glyphs={}),f[g].glyphs[v]=y&&{id:y.id,bitmap:y.bitmap.clone(),metrics:y.metrics},f[g].ascender=this.entries[g].ascender,f[g].descender=this.entries[g].descender;o(null,f)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==0&&(this.localGlyphMode===2?!!this.localFontFamily:!!this.localFontFamily&&(Te["CJK Unified Ideographs"](t)||Te["Hangul Syllables"](t)||Te.Hiragana(t)||Te.Katakana(t)||Te["CJK Symbols and Punctuation"](t)||Te["CJK Unified Ideographs Extension A"](t)||Te["CJK Unified Ideographs Extension B"](t)))}_tinySDF(t,i,o){let c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(o))return;let u=t.tinySDF;if(!u){let E="400";/bold/i.test(i)?E="900":/medium/i.test(i)?E="500":/light/i.test(i)&&(E="200"),u=t.tinySDF=new Ih.TinySDF({fontFamily:c,fontWeight:E,fontSize:24*Qa,buffer:3*Qa,radius:8*Qa}),u.fontWeight=E}if(this.localGlyphs[u.fontWeight][o])return this.localGlyphs[u.fontWeight][o];let h=String.fromCodePoint(o),{data:p,width:f,height:g,glyphWidth:v,glyphHeight:y,glyphLeft:b,glyphTop:x,glyphAdvance:C}=u.draw(h);return this.localGlyphs[u.fontWeight][o]={id:o,bitmap:new pc({width:f,height:g},p),metrics:{width:v/Qa,height:y/Qa,left:b/Qa,top:x/Qa-27,advance:C/Qa,localGlyph:!0}}}}Ih.loadGlyphRange=function(e,t,i,o,c){let u=256*t,h=u+255,p=o.transformRequest(o.normalizeGlyphsURL(i).replace("{fontstack}",e).replace("{range}",`${u}-${h}`),Dt.Glyphs);ie(p,(f,g)=>{if(f)c(f);else if(g){let v={},y=function(b){return new u0(b).readFields(R8,{})}(g);for(let b of y.glyphs)v[b.id]=b;c(null,{glyphs:v,ascender:y.ascender,descender:y.descender})}})},Ih.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:i=8,cutoff:o=.25,fontFamily:c="sans-serif",fontWeight:u="normal",fontStyle:h="normal"}={}){this.buffer=t,this.cutoff=o,this.radius=i;let p=this.size=e+4*t,f=this._createCanvas(p),g=this.ctx=f.getContext("2d",{willReadFrequently:!0});g.font=`${h} ${u} ${e}px ${c}`,g.textBaseline="alphabetic",g.textAlign="left",g.fillStyle="black",this.gridOuter=new Float64Array(p*p),this.gridInner=new Float64Array(p*p),this.f=new Float64Array(p),this.z=new Float64Array(p+1),this.v=new Uint16Array(p)}_createCanvas(e){let t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){let{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:o,actualBoundingBoxLeft:c,actualBoundingBoxRight:u}=this.ctx.measureText(e),h=Math.ceil(i),p=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(u-c))),f=Math.min(this.size-this.buffer,h+Math.ceil(o)),g=p+2*this.buffer,v=f+2*this.buffer,y=Math.max(g*v,0),b=new Uint8ClampedArray(y),x={data:b,width:g,height:v,glyphWidth:p,glyphHeight:f,glyphTop:h,glyphLeft:0,glyphAdvance:t};if(p===0||f===0)return x;let{ctx:C,buffer:E,gridInner:M,gridOuter:D}=this;C.clearRect(E,E,p,f),C.fillText(e,E,E+h);let I=C.getImageData(E,E,p,f);D.fill(Hp,0,y),M.fill(0,0,y);for(let P=0;P<f;P++)for(let O=0;O<p;O++){let R=I.data[4*(P*p+O)+3]/255;if(R===0)continue;let F=(P+E)*g+O+E;if(R===1)D[F]=0,M[F]=Hp;else{let z=.5-R;D[F]=z>0?z*z:0,M[F]=z<0?z*z:0}}oR(D,0,0,g,v,g,this.f,this.v,this.z),oR(M,E,E,p,f,g,this.f,this.v,this.z);for(let P=0;P<y;P++){let O=Math.sqrt(D[P])-Math.sqrt(M[P]);b[P]=Math.round(255-255*(O/this.radius+this.cutoff))}return x}};let nd=Es;function aR(e,t,i,o){let c=[],u=e.imagePrimary,h=u.pixelRatio,p=u.paddedRect.w-2*nd,f=u.paddedRect.h-2*nd,g=e.right-e.left,v=e.bottom-e.top,y=u.stretchX||[[0,p]],b=u.stretchY||[[0,f]],x=($,Y)=>$+Y[1]-Y[0],C=y.reduce(x,0),E=b.reduce(x,0),M=p-C,D=f-E,I=0,P=C,O=0,R=E,F=0,z=M,j=0,U=D;if(u.content&&o){let $=u.content;I=f0(y,0,$[0]),O=f0(b,0,$[1]),P=f0(y,$[0],$[2]),R=f0(b,$[1],$[3]),F=$[0]-I,j=$[1]-O,z=$[2]-$[0]-P,U=$[3]-$[1]-R}let G=($,Y,tt,W)=>{let rt=g0($.stretch-I,P,g,e.left),st=_0($.fixed-F,z,$.stretch,C),pt=g0(Y.stretch-O,R,v,e.top),nt=_0(Y.fixed-j,U,Y.stretch,E),ot=g0(tt.stretch-I,P,g,e.left),_t=_0(tt.fixed-F,z,tt.stretch,C),bt=g0(W.stretch-O,R,v,e.top),yt=_0(W.fixed-j,U,W.stretch,E),Ct=new Q(rt,pt),St=new Q(ot,pt),Tt=new Q(ot,bt),xt=new Q(rt,bt),Ft=new Q(st/h,nt/h),Qt=new Q(_t/h,yt/h),Jt=t*Math.PI/180;if(Jt){let Ci=Math.sin(Jt),He=Math.cos(Jt),Ne=[He,-Ci,Ci,He];Ct._matMult(Ne),St._matMult(Ne),xt._matMult(Ne),Tt._matMult(Ne)}let le=$.stretch+$.fixed,me=tt.stretch+tt.fixed,Ue=Y.stretch+Y.fixed,Ie=W.stretch+W.fixed,Bi=e.imageSecondary;return{tl:Ct,tr:St,bl:xt,br:Tt,texPrimary:{x:u.paddedRect.x+nd+le,y:u.paddedRect.y+nd+Ue,w:me-le,h:Ie-Ue},texSecondary:Bi?{x:Bi.paddedRect.x+nd+le,y:Bi.paddedRect.y+nd+Ue,w:me-le,h:Ie-Ue}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ft,pixelOffsetBR:Qt,minFontScaleX:z/h/g,minFontScaleY:U/h/v,isSDF:i}};if(o&&(u.stretchX||u.stretchY)){let $=lR(y,M,C),Y=lR(b,D,E);for(let tt=0;tt<$.length-1;tt++){let W=$[tt],rt=$[tt+1];for(let st=0;st<Y.length-1;st++)c.push(G(W,Y[st],rt,Y[st+1]))}}else c.push(G({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:p+1},{fixed:0,stretch:f+1}));return c}function f0(e,t,i){let o=0;for(let c of e)o+=Math.max(t,Math.min(i,c[1]))-Math.max(t,Math.min(i,c[0]));return o}function lR(e,t,i){let o=[{fixed:-nd,stretch:0}];for(let[c,u]of e){let h=o[o.length-1];o.push({fixed:c-h.stretch,stretch:h.stretch}),o.push({fixed:c-h.stretch,stretch:h.stretch+(u-c)})}return o.push({fixed:t+nd,stretch:i}),o}function g0(e,t,i,o){return e/t*i+o}function _0(e,t,i,o){return e-t*i/o}function V8(e,t,i,o){let c=t+e.positionedLines[o].lineOffset;return o===0?i+c/2:i+(c+(t+e.positionedLines[o-1].lineOffset))/2}function j8(e,t=1,i=!1){let o=1/0,c=1/0,u=-1/0,h=-1/0,p=e[0];for(let x=0;x<p.length;x++){let C=p[x];(!x||C.x<o)&&(o=C.x),(!x||C.y<c)&&(c=C.y),(!x||C.x>u)&&(u=C.x),(!x||C.y>h)&&(h=C.y)}let f=Math.min(u-o,h-c),g=f/2,v=new s1([],U8);if(f===0)return new Q(o,c);for(let x=o;x<u;x+=f)for(let C=c;C<h;C+=f)v.push(new Ah(x+g,C+g,g,e));let y=function(x){let C=0,E=0,M=0,D=x[0];for(let I=0,P=D.length,O=P-1;I<P;O=I++){let R=D[I],F=D[O],z=R.x*F.y-F.x*R.y;E+=(R.x+F.x)*z,M+=(R.y+F.y)*z,C+=3*z}return new Ah(E/C,M/C,0,x)}(e),b=v.length;for(;v.length;){let x=v.pop();(x.d>y.d||!y.d)&&(y=x,i&&console.log("found best %d after %d probes",Math.round(1e4*x.d)/1e4,b)),x.max-y.d<=t||(g=x.h/2,v.push(new Ah(x.p.x-g,x.p.y-g,g,e)),v.push(new Ah(x.p.x+g,x.p.y-g,g,e)),v.push(new Ah(x.p.x-g,x.p.y+g,g,e)),v.push(new Ah(x.p.x+g,x.p.y+g,g,e)),b+=4)}return i&&(console.log(`num probes: ${b}`),console.log(`best distance: ${y.d}`)),y.p}function U8(e,t){return t.max-e.max}class Ah{constructor(t,i,o,c){this.p=new Q(t,i),this.h=o,this.d=function(u,h){let p=!1,f=1/0;for(let g=0;g<h.length;g++){let v=h[g];for(let y=0,b=v.length,x=b-1;y<b;x=y++){let C=v[y],E=v[x];C.y>u.y!=E.y>u.y&&u.x<(E.x-C.x)*(u.y-C.y)/(E.y-C.y)+C.x&&(p=!p),f=Math.min(f,ck(u,C,E))}}return(p?1:-1)*Math.sqrt(f)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}}let kh=7,fC=Number.POSITIVE_INFINITY,H8=Math.sqrt(2);function gC(e,[t,i]){let o=0,c=0;if(i===fC){t<0&&(t=0);let u=t/H8;switch(e){case"top-right":case"top-left":c=u-kh;break;case"bottom-right":case"bottom-left":c=-u+kh;break;case"bottom":c=-t+kh;break;case"top":c=t-kh}switch(e){case"top-right":case"bottom-right":o=-u;break;case"top-left":case"bottom-left":o=u;break;case"left":o=t;break;case"right":o=-t}}else{switch(t=Math.abs(t),i=Math.abs(i),e){case"top-right":case"top-left":case"top":c=i-kh;break;case"bottom-right":case"bottom-left":case"bottom":c=-i+kh}switch(e){case"top-right":case"bottom-right":case"right":o=-t;break;case"top-left":case"bottom-left":case"left":o=t}}return[o,c]}function G8(e,t,i,o,c,u,h,p,f,g,v){e.createArrays(),e.tilePixelRatio=wt/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;let y=e.layers[0].layout,b=e.layers[0]._unevaluatedLayout._values,x={};if(e.textSizeData.kind==="composite"){let{minZoom:D,maxZoom:I}=e.textSizeData;x.compositeTextSizes=[b["text-size"].possiblyEvaluate(new Jn(D),p),b["text-size"].possiblyEvaluate(new Jn(I),p)]}if(e.iconSizeData.kind==="composite"){let{minZoom:D,maxZoom:I}=e.iconSizeData;x.compositeIconSizes=[b["icon-size"].possiblyEvaluate(new Jn(D),p),b["icon-size"].possiblyEvaluate(new Jn(I),p)]}x.layoutTextSize=b["text-size"].possiblyEvaluate(new Jn(f+1),p),x.layoutIconSize=b["icon-size"].possiblyEvaluate(new Jn(f+1),p),x.textMaxSize=b["text-size"].possiblyEvaluate(new Jn(18),p);let C=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point",E=y.get("text-size"),M=!1;for(let D of e.features)if(D.icon&&D.icon.nameSecondary){M=!0;break}for(let D of e.features){let I=y.get("text-font").evaluate(D,{},p).join(","),P=E.evaluate(D,{},p),O=x.layoutTextSize.evaluate(D,{},p),R=(x.layoutIconSize.evaluate(D,{},p),{horizontal:{},vertical:void 0}),F=D.text,z,j=[0,0];if(F){let $=F.toString(),Y=y.get("text-letter-spacing").evaluate(D,{},p)*Co,tt=y.get("text-line-height").evaluate(D,{},p)*Co,W=_U($)?Y:0,rt=y.get("text-anchor").evaluate(D,{},p),st=y.get("text-variable-anchor");if(!st){let bt=y.get("text-radial-offset").evaluate(D,{},p);j=bt?gC(rt,[bt*Co,fC]):y.get("text-offset").evaluate(D,{},p).map(yt=>yt*Co)}let pt=C?"center":y.get("text-justify").evaluate(D,{},p),nt=y.get("symbol-placement")==="point",ot=nt?y.get("text-max-width").evaluate(D,{},p)*Co:1/0,_t=bt=>{e.allowVerticalPlacement&&q1($)&&(R.vertical=hC(F,t,i,c,I,ot,tt,rt,bt,W,j,Kn.vertical,!0,O,P))};if(!C&&st){let bt=pt==="auto"?st.map(Ct=>_C(Ct)):[pt],yt=!1;for(let Ct=0;Ct<bt.length;Ct++){let St=bt[Ct];if(!R.horizontal[St])if(yt)R.horizontal[St]=R.horizontal[0];else{let Tt=hC(F,t,i,c,I,ot,tt,"center",St,W,j,Kn.horizontal,!1,O,P);Tt&&(R.horizontal[St]=Tt,yt=Tt.positionedLines.length===1)}}_t("left")}else{if(pt==="auto"&&(pt=_C(rt)),nt||y.get("text-writing-mode").indexOf("horizontal")>=0||!q1($)){let bt=hC(F,t,i,c,I,ot,tt,rt,pt,W,j,Kn.horizontal,!1,O,P);bt&&(R.horizontal[pt]=bt)}_t(nt?"left":pt)}}let U=!1;if(D.icon&&D.icon.namePrimary){let $=o[D.icon.namePrimary];$&&(z=z8(c[D.icon.namePrimary],D.icon.nameSecondary?c[D.icon.nameSecondary]:void 0,y.get("icon-offset").evaluate(D,{},p),y.get("icon-anchor").evaluate(D,{},p)),U=$.sdf,e.sdfIcons===void 0?e.sdfIcons=$.sdf:e.sdfIcons!==$.sdf&&lt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),($.pixelRatio!==e.pixelRatio||y.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}let G=dR(R.horizontal)||R.vertical;e.iconsInText||(e.iconsInText=!!G&&G.iconsInText),(G||z)&&q8(e,D,R,z,o,x,O,0,j,U,h,p,g,v,M)}u&&e.generateCollisionDebugBuffers(f,e.collisionBoxArray)}function _C(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function q8(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C){let E=u.textMaxSize.evaluate(t,{},y);E===void 0&&(E=h);let M=e.layers[0].layout,D=M.get("icon-offset").evaluate(t,{},y),I=dR(i.horizontal)||i.vertical,P=b.name==="globe",O=Co,R=h/O,F=e.tilePixelRatio*E/O,z=(rt=e.overscaling,e.zoom>18&&rt>2&&(rt>>=1),Math.max(wt/(512*rt),1)*M.get("symbol-spacing")),j=M.get("text-padding")*e.tilePixelRatio,U=M.get("icon-padding")*e.tilePixelRatio,G=fe(M.get("text-max-angle")),$=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",Y=M.get("icon-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",tt=M.get("symbol-placement"),W=z/2;var rt;let st=M.get("icon-text-fit").evaluate(t,{},y),pt=M.get("icon-text-fit-padding").evaluate(t,{},y),nt=st!=="none",ot;e.hasAnyIconTextFit===!1&&nt&&(e.hasAnyIconTextFit=!0),o&&nt&&(e.allowVerticalPlacement&&i.vertical&&(ot=Kk(o,i.vertical,st,pt,D,R)),I&&(o=Kk(o,I,st,pt,D,R)));let _t=(bt,yt,Ct)=>{if(yt.x<0||yt.x>=wt||yt.y<0||yt.y>=wt)return;let St=null;if(P){let{x:Tt,y:xt,z:Ft}=b.projectTilePoint(yt.x,yt.y,Ct);St={anchor:new gc(Tt,xt,Ft,0,void 0),up:b.upVector(Ct,yt.x,yt.y)}}(function(Tt,xt,Ft,Qt,Jt,le,me,Ue,Ie,Bi,Ci,He,Ne,ke,Di,zi,pi,vn,Mr,hn,zn,Lr,Dr,Gn,an,ko,Ol){let _c=Tt.addToLineVertexArray(xt,Qt),vc,hf,mf,mv,_F,vF,yF,bF=0,xF=0,wF=0,CF=0,_S=-1,vS=-1,Fl={},SF=gw(""),mu=Ft?Ft.anchor:xt,yS=Ie.layout.get("icon-text-fit").evaluate(zn,{},an)!=="none",bS=0,xS=0;if(Ie._unevaluatedLayout.getValue("text-radial-offset")===void 0?[bS,xS]=Ie.layout.get("text-offset").evaluate(zn,{},an).map(Ds=>Ds*Co):(bS=Ie.layout.get("text-radial-offset").evaluate(zn,{},an)*Co,xS=fC),Tt.allowVerticalPlacement&&Jt.vertical){let Ds=Jt.vertical;if(Di)vF=vC(Ds),Ue&&(yF=vC(Ue));else{let Ts=Ie.layout.get("text-rotate").evaluate(zn,{},an)+90;mf=v0(Bi,mu,xt,Ci,He,Ne,Ds,ke,Ts,zi),Ue&&(mv=v0(Bi,mu,xt,Ci,He,Ne,Ue,vn,Ts))}}if(le){let Ds=Ie.layout.get("icon-rotate").evaluate(zn,{},an),Ts=aR(le,Ds,Dr,yS),Uh=Ue?aR(Ue,Ds,Dr,yS):void 0;hf=v0(Bi,mu,xt,Ci,He,Ne,le,vn,Ds),bF=4*Ts.length;let EF=Tt.iconSizeData,pu=null;EF.kind==="source"?(pu=[Ka*Ie.layout.get("icon-size").evaluate(zn,{},an)],pu[0]>rd&&lt(`${Tt.layerIds[0]}: Value for "icon-size" is >= ${Gp}. Reduce your "icon-size".`)):EF.kind==="composite"&&(pu=[Ka*Lr.compositeIconSizes[0].evaluate(zn,{},an),Ka*Lr.compositeIconSizes[1].evaluate(zn,{},an)],(pu[0]>rd||pu[1]>rd)&&lt(`${Tt.layerIds[0]}: Value for "icon-size" is >= ${Gp}. Reduce your "icon-size".`)),Tt.addSymbols(Tt.icon,Ts,pu,hn,Mr,zn,!1,Ft,xt,_c.lineStartIndex,_c.lineLength,-1,Gn,an,ko,Ol),_S=Tt.icon.placedSymbolArray.length-1,Uh&&(xF=4*Uh.length,Tt.addSymbols(Tt.icon,Uh,pu,hn,Mr,zn,Kn.vertical,Ft,xt,_c.lineStartIndex,_c.lineLength,-1,Gn,an,ko,Ol),vS=Tt.icon.placedSymbolArray.length-1)}for(let Ds in Jt.horizontal){let Ts=Jt.horizontal[Ds];vc||(SF=gw(Ts.text),Di?_F=vC(Ts):vc=v0(Bi,mu,xt,Ci,He,Ne,Ts,ke,Ie.layout.get("text-rotate").evaluate(zn,{},an),zi));let Uh=Ts.positionedLines.length===1;if(wF+=cR(Tt,Ft,xt,Ts,me,Ie,Di,zn,zi,_c,Jt.vertical?Kn.horizontal:Kn.horizontalOnly,Uh?Object.keys(Jt.horizontal):[Ds],Fl,_S,Lr,Gn,an,ko),Uh)break}Jt.vertical&&(CF+=cR(Tt,Ft,xt,Jt.vertical,me,Ie,Di,zn,zi,_c,Kn.vertical,["vertical"],Fl,vS,Lr,Gn,an,ko));let ud=-1,wS=(Ds,Ts)=>Ds?Math.max(Ds,Ts):Ts;ud=wS(_F,ud),ud=wS(vF,ud),ud=wS(yF,ud);let I$=ud>-1?1:0;Tt.glyphOffsetArray.length>=Zp.MAX_GLYPHS&&lt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),zn.sortKey!==void 0&&Tt.addToSortKeyRanges(Tt.symbolInstances.length,zn.sortKey),Tt.symbolInstances.emplaceBack(xt.x,xt.y,mu.x,mu.y,mu.z,Fl.right>=0?Fl.right:-1,Fl.center>=0?Fl.center:-1,Fl.left>=0?Fl.left:-1,Fl.vertical>=0?Fl.vertical:-1,_S,vS,SF,vc!==void 0?vc:Tt.collisionBoxArray.length,vc!==void 0?vc+1:Tt.collisionBoxArray.length,mf!==void 0?mf:Tt.collisionBoxArray.length,mf!==void 0?mf+1:Tt.collisionBoxArray.length,hf!==void 0?hf:Tt.collisionBoxArray.length,hf!==void 0?hf+1:Tt.collisionBoxArray.length,mv||Tt.collisionBoxArray.length,mv?mv+1:Tt.collisionBoxArray.length,Ci,wF,CF,bF,xF,I$,0,bS,xS,ud,0,yS?1:0)})(e,yt,St,bt,i,o,c,ot,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,j,$,f,0,U,Y,D,t,u,g,v,y,x,C)};if(tt==="line")for(let bt of nR(t.geometry,0,0,wt,wt)){let yt=B8(bt,z,G,i.vertical||I,o,O,F,e.overscaling,wt);for(let Ct of yt)I&&W8(e,I.text,W,Ct)||_t(bt,Ct,y)}else if(tt==="line-center"){for(let bt of t.geometry)if(bt.length>1){let yt=N8(bt,G,i.vertical||I,o,O,F);yt&&_t(bt,yt,y)}}else if(t.type==="Polygon")for(let bt of rC(t.geometry,0)){let yt=j8(bt,16);_t(bt[0],new gc(yt.x,yt.y,0,0,void 0),y)}else if(t.type==="LineString")for(let bt of t.geometry)_t(bt,new gc(bt[0].x,bt[0].y,0,0,void 0),y);else if(t.type==="Point")for(let bt of t.geometry)for(let yt of bt)_t([yt],new gc(yt.x,yt.y,0,0,void 0),y)}let Gp=255,rd=Gp*Ka;function cR(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M,D){let I=function(R,F,z,j,U,G,$,Y){let tt=[];if(F.positionedLines.length===0)return tt;let W=j.layout.get("text-rotate").evaluate(G,{})*Math.PI/180,rt=function(_t){let bt=_t[0],yt=_t[1],Ct=bt*yt;return Ct>0?[bt,-yt]:Ct<0?[-bt,yt]:bt===0?[yt,bt]:[yt,-bt]}(z),st=Math.abs(F.top-F.bottom);for(let _t of F.positionedLines)st-=_t.lineOffset;let pt=F.positionedLines.length,nt=st/pt,ot=F.top-z[1];for(let _t=0;_t<pt;++_t){let bt=F.positionedLines[_t];ot=V8(F,nt,ot,_t);for(let yt of bt.positionedGlyphs){if(!yt.rect)continue;let Ct=yt.rect||{},St=Gk+1,Tt=!0,xt=1,Ft=0;if(yt.imageName){let hn=$[yt.imageName];if(!hn)continue;if(hn.sdf){lt("SDF images are not supported in formatted text and will be ignored.");continue}Tt=!1,xt=hn.pixelRatio,St=Es/xt}let Qt=(U||Y)&&yt.vertical,Jt=yt.metrics.advance*yt.scale/2,le=yt.metrics,me=yt.rect;if(me===null)continue;Y&&F.verticalizable&&(Ft=yt.imageName?Jt-yt.metrics.width*yt.scale/2:0);let Ue=U?[yt.x+Jt,yt.y]:[0,0],Ie=[0,0],Bi=[0,0],Ci=!1;U||(Qt?(Bi=[yt.x+Jt+rt[0],yt.y+rt[1]-Ft],Ci=!0):Ie=[yt.x+Jt+z[0],yt.y+z[1]-Ft]);let He=me.w*yt.scale/(xt*(yt.localGlyph?Qa:1)),Ne=me.h*yt.scale/(xt*(yt.localGlyph?Qa:1)),ke,Di,zi,pi;if(Qt){let hn=yt.y-ot,zn=new Q(-Jt,Jt-hn),Lr=-Math.PI/2,Dr=new Q(...Bi);ke=new Q(-Jt+Ie[0],Ie[1]),ke._rotateAround(Lr,zn)._add(Dr),ke.x+=-hn+Jt,ke.y-=(le.left-St)*yt.scale;let Gn=yt.imageName?le.advance*yt.scale:Co*yt.scale,an=String.fromCodePoint(yt.glyph);A8(an)?ke.x+=(1-St)*yt.scale:k8(an)?ke.x+=Gn-le.height*yt.scale+(-St-1)*yt.scale:ke.x+=yt.imageName||le.width+2*St===me.w&&le.height+2*St===me.h?(Gn-Ne)/2:(Gn-(le.height+2*St)*yt.scale)/2,Di=new Q(ke.x,ke.y-He),zi=new Q(ke.x+Ne,ke.y),pi=new Q(ke.x+Ne,ke.y-He)}else{let hn=(le.left-St)*yt.scale-Jt+Ie[0],zn=(-le.top-St)*yt.scale+Ie[1],Lr=hn+He,Dr=zn+Ne;ke=new Q(hn,zn),Di=new Q(Lr,zn),zi=new Q(hn,Dr),pi=new Q(Lr,Dr)}if(W){let hn;hn=U?new Q(0,0):Ci?new Q(rt[0],rt[1]):new Q(z[0],z[1]),ke._rotateAround(W,hn),Di._rotateAround(W,hn),zi._rotateAround(W,hn),pi._rotateAround(W,hn)}let vn=new Q(0,0),Mr=new Q(0,0);tt.push({tl:ke,tr:Di,bl:zi,br:pi,texPrimary:Ct,texSecondary:void 0,writingMode:F.writingMode,glyphOffset:Ue,sectionIndex:yt.sectionIndex,isSDF:Tt,pixelOffsetTL:vn,pixelOffsetBR:Mr,minFontScaleX:0,minFontScaleY:0})}}return tt}(0,o,f,u,h,p,c,e.allowVerticalPlacement),P=e.textSizeData,O=null;P.kind==="source"?(O=[Ka*u.layout.get("text-size").evaluate(p,{},M)],O[0]>rd&&lt(`${e.layerIds[0]}: Value for "text-size" is >= ${Gp}. Reduce your "text-size".`)):P.kind==="composite"&&(O=[Ka*C.compositeTextSizes[0].evaluate(p,{},M),Ka*C.compositeTextSizes[1].evaluate(p,{},M)],(O[0]>rd||O[1]>rd)&&lt(`${e.layerIds[0]}: Value for "text-size" is >= ${Gp}. Reduce your "text-size".`)),e.addSymbols(e.text,I,O,f,h,p,v,t,i,g.lineStartIndex,g.lineLength,x,E,M,D,!1);for(let R of y)b[R]=e.text.placedSymbolArray.length-1;return 4*I.length}function dR(e){for(let t in e)return e[t];return null}function v0(e,t,i,o,c,u,h,p,f,g){let v=h.top,y=h.bottom,b=h.left,x=h.right,C=h.collisionPadding;if(C&&(b-=C[0],v-=C[1],x+=C[2],y+=C[3]),f){let E=new Q(b,v),M=new Q(x,v),D=new Q(b,y),I=new Q(x,y),P=fe(f),O=new Q(0,0);g&&(O=new Q(g[0],g[1])),E._rotateAround(P,O),M._rotateAround(P,O),D._rotateAround(P,O),I._rotateAround(P,O),b=Math.min(E.x,M.x,D.x,I.x),x=Math.max(E.x,M.x,D.x,I.x),v=Math.min(E.y,M.y,D.y,I.y),y=Math.max(E.y,M.y,D.y,I.y)}return e.emplaceBack(t.x,t.y,t.z,i.x,i.y,b,v,x,y,p,o,c,u),e.length-1}function vC(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);let t=e.bottom-e.top;return t>0?Math.max(10,t):null}function W8(e,t,i,o){let c=e.compareText;if(t in c){let u=c[t];for(let h=u.length-1;h>=0;h--)if(o.dist(u[h])<i)return!0}else c[t]=[];return c[t].push(o),!1}function uR(e,t){let i=e.fovAboveCenter,o=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,c=(e._camera.position[2]*e.worldSize-o)/Math.cos(e._pitch),u=Math.sin(i)*c/Math.sin(Math.max(Math.PI/2-e._pitch-i,.01)),h=Math.sin(e._pitch)*u+c;return Math.min(1.01*h,c*(1/e._horizonShift))}function su(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};let i=Math.pow(2,-e.z),o=e.x*i,c=(e.x+1)*i,u=e.y*i,h=(e.y+1)*i,p=Ss(o),f=Ss(c),g=Wr(u),v=Wr(h),y=t.project(p,g),b=t.project(f,g),x=t.project(f,v),C=t.project(p,v),E=Math.min(y.x,b.x,x.x,C.x),M=Math.min(y.y,b.y,x.y,C.y),D=Math.max(y.x,b.x,x.x,C.x),I=Math.max(y.y,b.y,x.y,C.y),P=i/16;function O(F,z,j,U,G,$){let Y=(j+G)/2,tt=(U+$)/2,W=t.project(Ss(Y),Wr(tt)),rt=Math.max(0,E-W.x,M-W.y,W.x-D,W.y-I);E=Math.min(E,W.x),D=Math.max(D,W.x),M=Math.min(M,W.y),I=Math.max(I,W.y),rt>P&&(O(F,W,j,U,Y,tt),O(W,z,Y,tt,G,$))}O(y,b,o,u,c,u),O(b,x,c,u,c,h),O(x,C,c,h,o,h),O(C,y,o,h,o,u),E-=P,M-=P,D+=P,I+=P;let R=1/Math.max(D-E,I-M);return{scale:R,x:E*R,y:M*R,x2:D*R,y2:I*R,projection:t}}function hR(e,t,i,o,c,u,h,p,f){if(f.name==="globe")return Vw(e,t,new ua(i,o,c),!1);let g=su({z:i,x:o,y:c},f);return new Ln([(u+g.x/g.scale)*t,t*(g.y/g.scale),h],[(u+g.x2/g.scale)*t,t*(g.y2/g.scale),p])}function mR(e,{x:t,y:i},o=0){return new Q(((t-o)*e.scale-e.x)*wt,(i*e.scale-e.y)*wt)}function pR(e,t,i=0){return J.fromValues(((t.x-i)*e.scale-e.x)*wt,(t.y*e.scale-e.y)*wt,nk(t.z,t.y))}let $8=ft.identity(new Float32Array(16));class od{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,i){return{x:0,y:0,z:0}}unproject(t,i){return new Ye(0,0)}projectTilePoint(t,i,o){return{x:t,y:i,z:0}}locationPoint(t,i,o=!0){return t._coordinatePoint(t.locationCoordinate(i),o)}pixelsPerMeter(t,i){return _n(1,t)*i}pixelSpaceConversion(t,i,o){return 1}farthestPixelDistance(t){return uR(t,t.pixelsPerMeter)}pointCoordinate(t,i,o,c){let u=t.horizonLineFromTop(!1),h=new Q(i,Math.max(u,o));return t.rayIntersectionCoordinate(t.pointRayIntersection(h,c))}pointCoordinate3D(t,i,o){let c=new Q(i,o);if(t.elevation)return t.elevation.pointCoordinate(c);{let u=this.pointCoordinate(t,c.x,c.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(t,i){if(t.elevation)return!this.pointCoordinate3D(t,i.x,i.y);let o=t.horizonLineFromTop();return i.y<o}createInversionMatrix(t,i){return $8}createTileMatrix(t,i,o){let c,u,h,p=o.canonical,f=ft.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let g=su(p,this);c=1,u=g.x+o.wrap*g.scale,h=g.y,ft.scale(f,f,[c/g.scale,c/g.scale,t.pixelsPerMeter/i])}else c=i/t.zoomScale(p.z),u=(p.x+Math.pow(2,p.z)*o.wrap)*c,h=p.y*c;return ft.translate(f,f,[u,h,0]),ft.scale(f,f,[c/wt,c/wt,1]),f}upVector(t,i,o){return[0,0,1]}upVectorScale(t,i,o){return{metersToTile:1}}}class Y8 extends od{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];let[i,o]=this.parallels=t.parallels||[29.5,45.5],c=Math.sin(fe(i));this.n=(c+Math.sin(fe(o)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(t,i){let{n:o,c,r0:u}=this,h=fe(t-this.center[0]),p=fe(i),f=Math.sqrt(c-2*o*Math.sin(p))/o;return{x:f*Math.sin(h*o),y:f*Math.cos(h*o)-u,z:0}}unproject(t,i){let{n:o,c,r0:u}=this,h=u+i,p=Math.atan2(t,Math.abs(h))*Math.sign(h);h*o<0&&(p-=Math.PI*Math.sign(t)*Math.sign(h));let f=fe(this.center[0])*o;p=os(p,-Math.PI-f,Math.PI-f);let g=ve(ii(p/o)+this.center[0],-180,180),v=Math.asin(ve((c-(t*t+h*h)*o*o)/(2*o),-1,1)),y=ve(ii(v),-Er,Er);return new Ye(g,y)}}let qp=1.340264,Wp=-.081106,$p=893e-6,Yp=.003796,y0=Math.sqrt(3)/2;class Z8 extends od{project(t,i){i=i/180*Math.PI,t=t/180*Math.PI;let o=Math.asin(y0*Math.sin(i)),c=o*o,u=c*c*c;return{x:.5*(t*Math.cos(o)/(y0*(qp+3*Wp*c+u*(7*$p+9*Yp*c)))/Math.PI+.5),y:1-.5*(o*(qp+Wp*c+u*($p+Yp*c))/Math.PI+1),z:0}}unproject(t,i){t=(2*t-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,c=o*o,u=c*c*c;for(let v,y,b,x=0;x<12&&(y=o*(qp+Wp*c+u*($p+Yp*c))-i,b=qp+3*Wp*c+u*(7*$p+9*Yp*c),v=y/b,o=ve(o-v,-Math.PI/3,Math.PI/3),c=o*o,u=c*c*c,!(Math.abs(v)<1e-12));++x);let h=y0*t*(qp+3*Wp*c+u*(7*$p+9*Yp*c))/Math.cos(o),p=Math.asin(Math.sin(o)/y0),f=ve(180*h/Math.PI,-180,180),g=ve(180*p/Math.PI,-Er,Er);return new Ye(f,g)}}class X8 extends od{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,i){return{x:.5+t/360,y:.5-i/360,z:0}}unproject(t,i){let o=360*(t-.5),c=ve(360*(.5-i),-Er,Er);return new Ye(o,c)}}let Rh=Math.PI/2;function b0(e){return Math.tan((Rh+e)/2)}class K8 extends od{constructor(t){super(t),this.center=t.center||[0,30];let[i,o]=this.parallels=t.parallels||[30,30],c=fe(i),u=fe(o);this.southernCenter=c+u<0,this.southernCenter&&(c=-c,u=-u);let h=Math.cos(c),p=b0(c);this.n=c===u?Math.sin(c):Math.log(h/Math.cos(u))/Math.log(b0(u)/p),this.f=h*Math.pow(b0(c),this.n)/this.n}project(t,i){i=fe(i),this.southernCenter&&(i=-i),t=fe(t-this.center[0]);let o=1e-6,{n:c,f:u}=this;u>0?i<-Rh+o&&(i=-Rh+o):i>Rh-o&&(i=Rh-o);let h=u/Math.pow(b0(i),c),p=h*Math.sin(c*t),f=u-h*Math.cos(c*t);return p=.5*(p/Math.PI+.5),f=.5*(f/Math.PI+.5),{x:p,y:this.southernCenter?f:1-f,z:0}}unproject(t,i){t=(2*t-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;let{n:o,f:c}=this,u=c-i,h=Math.sign(u),p=Math.sign(o)*Math.sqrt(t*t+u*u),f=Math.atan2(t,Math.abs(u))*h;u*o<0&&(f-=Math.PI*Math.sign(t)*h);let g=ve(ii(f/o)+this.center[0],-180,180),v=ve(ii(2*Math.atan(Math.pow(c/p,1/o))-Rh),-Er,Er);return new Ye(g,this.southernCenter?-v:v)}}class fR extends od{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,i){return{x:to(t),y:lo(i),z:0}}unproject(t,i){let o=Ss(t),c=Wr(i);return new Ye(o,c)}}let gR=fe(Er);class Q8 extends od{project(t,i){let o=(i=fe(i))*i,c=o*o;return{x:.5*((t=fe(t))*(.8707-.131979*o+c*(c*(.003971*o-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+o*(.015085+c*(.028874*o-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(t,i){t=(2*t-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,c=25,u=0,h=o*o;do{h=o*o;let g=h*h;u=(o*(1.007226+h*(.015085+g*(.028874*h-.044475-.005916*g)))-i)/(1.007226+h*(.045255+g*(.259866*h-.311325-.005916*11*g))),o=ve(o-u,-gR,gR)}while(Math.abs(u)>1e-6&&--c>0);h=o*o;let p=ve(ii(t/(.8707+h*(h*(h*h*h*(.003971-.001529*h)-.013791)-.131979))),-180,180),f=ii(o);return new Ye(p,f)}}let _R=fe(Er);class J8 extends od{project(t,i){i=fe(i),t=fe(t);let o=Math.cos(i),c=2/Math.PI,u=Math.acos(o*Math.cos(t/2)),h=Math.sin(u)/u,p=.5*(t*c+2*o*Math.sin(t/2)/h)||0,f=.5*(i+Math.sin(i)/h)||0;return{x:.5*(p/Math.PI+.5),y:1-.5*(f/Math.PI+1),z:0}}unproject(t,i){let o=t=(2*t-.5)*Math.PI,c=i=(2*(1-i)-1)*Math.PI,u=25,h=1e-6,p=0,f=0;do{let g=Math.cos(c),v=Math.sin(c),y=2*v*g,b=v*v,x=g*g,C=Math.cos(o/2),E=Math.sin(o/2),M=2*C*E,D=E*E,I=1-x*C*C,P=I?1/I:0,O=I?Math.acos(g*C)*Math.sqrt(1/I):0,R=.5*(2*O*g*E+2*o/Math.PI)-t,F=.5*(O*v+c)-i,z=.5*P*(x*D+O*g*C*b)+1/Math.PI,j=P*(M*y/4-O*v*E),U=.125*P*(y*E-O*v*x*M),G=.5*P*(b*C+O*D*g)+.5,$=j*U-G*z;p=(F*j-R*G)/$,f=(R*U-F*z)/$,o=ve(o-p,-Math.PI,Math.PI),c=ve(c-f,-_R,_R)}while((Math.abs(p)>h||Math.abs(f)>h)&&--u>0);return new Ye(ii(o),ii(c))}}class vR extends od{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(fe(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,i){let{scale:o,cosPhi:c}=this;return{x:fe(t)*c*o+.5,y:-Math.sin(fe(i))/c*o+.5,z:0}}unproject(t,i){let{scale:o,cosPhi:c}=this,u=-(i-.5)/o,h=ve(ii((t-.5)/o)/c,-180,180),p=Math.asin(ve(u*c,-1,1)),f=ve(ii(p),-Er,Er);return new Ye(h,f)}}class tH extends fR{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,i,o){let c=Fp(t,i,o),u=Kc(Ws(o));return J.transformMat4(c,c,u),{x:c[0],y:c[1],z:c[2]}}locationPoint(t,i){let o=us(i.lat,i.lng),c=J.normalize([],o),u=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(i),t._centerAltitude):t._centerAltitude,h=_n(1,0)*wt*u;J.scaleAndAdd(o,o,c,h);let p=ft.identity(new Float64Array(16));return ft.multiply(p,t.pixelMatrix,t.globeMatrix),J.transformMat4(o,o,p),new Q(o[0],o[1])}pixelsPerMeter(t,i){return _n(1,0)*i}pixelSpaceConversion(t,i,o){let c=_n(1,t)*i,u=$e(_n(1,45)*i,c,o);return this.pixelsPerMeter(t,i)/u}createTileMatrix(t,i,o){let c=Uw(Ws(o.canonical));return ft.multiply(new Float64Array(16),t.globeMatrix,c)}createInversionMatrix(t,i){let{center:o}=t,c=Kc(Ws(i));return ft.rotateY(c,c,fe(o.lng)),ft.rotateX(c,c,fe(o.lat)),ft.scale(c,c,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(t,i,o,c){return GA(t,i,o,!0)||new Oi(0,0)}pointCoordinate3D(t,i,o){let c=this.pointCoordinate(t,i,o,0);return[c.x,c.y,c.z]}isPointAboveHorizon(t,i){return!GA(t,i.x,i.y,!1)}farthestPixelDistance(t){let i=function(c,u){let h=c.cameraToCenterDistance,p=c._centerAltitude*u,f=c._camera,g=c._camera.forward(),v=J.add([],J.scale([],g,-h),[0,0,p]),y=c.worldSize/(2*Math.PI),b=[0,0,-y],x=c.width/c.height,C=Math.tan(c.fovAboveCenter),E=J.scale([],f.up(),C),M=J.scale([],f.right(),C*x),D=J.normalize([],J.add([],J.add([],g,E),M)),I=[],P;if(new G_(v,D).closestPointOnSphere(b,y,I)){let O=J.add([],I,b),R=J.sub([],O,v);P=Math.cos(c.fovAboveCenter)*J.length(R)}else{let O=J.sub([],v,b),R=J.sub([],b,v);J.normalize(R,R);let F=J.length(O)-y;P=Math.sqrt(F*(F+2*y));let z=Math.acos(P/(y+F))-Math.acos(J.dot(g,R));P*=Math.cos(z)}return 1.01*P}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),o=wo(t.zoom);if(o>0){let c=uR(t,_n(1,t.center.lat)*t.worldSize),u=t.worldSize/(2*Math.PI),h=Math.max(t.width,t.height)/t.worldSize*Math.PI;return $e(i,c+u*(1-Math.cos(h)),Math.pow(o,10))}return i}upVector(t,i,o){return Fp(i,o,t,1)}upVectorScale(t){return{metersToTile:q_($_(Ws(t)))}}}function x0(e){let t=e.parallels,i=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new fR(e);case"equirectangular":return new X8(e);case"naturalEarth":return new Q8(e);case"equalEarth":return new Z8(e);case"winkelTripel":return new J8(e);case"albers":return i?new vR(e):new Y8(e);case"lambertConformalConic":return i?new vR(e):new K8(e);case"globe":return new tH(e)}throw new Error(`Invalid projection name: ${e.name}`)}let eH=new yr({"symbol-placement":new Ut(gt.layout_symbol["symbol-placement"]),"symbol-spacing":new Ut(gt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ut(gt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Re(gt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ut(gt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Ut(gt.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Ut(gt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ut(gt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ut(gt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ut(gt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Re(gt.layout_symbol["icon-size"]),"icon-text-fit":new Re(gt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Re(gt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Re(gt.layout_symbol["icon-image"]),"icon-rotate":new Re(gt.layout_symbol["icon-rotate"]),"icon-padding":new Ut(gt.layout_symbol["icon-padding"]),"icon-keep-upright":new Ut(gt.layout_symbol["icon-keep-upright"]),"icon-offset":new Re(gt.layout_symbol["icon-offset"]),"icon-anchor":new Re(gt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ut(gt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ut(gt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ut(gt.layout_symbol["text-rotation-alignment"]),"text-field":new Re(gt.layout_symbol["text-field"]),"text-font":new Re(gt.layout_symbol["text-font"]),"text-size":new Re(gt.layout_symbol["text-size"]),"text-max-width":new Re(gt.layout_symbol["text-max-width"]),"text-line-height":new Re(gt.layout_symbol["text-line-height"]),"text-letter-spacing":new Re(gt.layout_symbol["text-letter-spacing"]),"text-justify":new Re(gt.layout_symbol["text-justify"]),"text-radial-offset":new Re(gt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ut(gt.layout_symbol["text-variable-anchor"]),"text-anchor":new Re(gt.layout_symbol["text-anchor"]),"text-max-angle":new Ut(gt.layout_symbol["text-max-angle"]),"text-writing-mode":new Ut(gt.layout_symbol["text-writing-mode"]),"text-rotate":new Re(gt.layout_symbol["text-rotate"]),"text-padding":new Ut(gt.layout_symbol["text-padding"]),"text-keep-upright":new Ut(gt.layout_symbol["text-keep-upright"]),"text-transform":new Re(gt.layout_symbol["text-transform"]),"text-offset":new Re(gt.layout_symbol["text-offset"]),"text-allow-overlap":new Ut(gt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ut(gt.layout_symbol["text-ignore-placement"]),"text-optional":new Ut(gt.layout_symbol["text-optional"]),visibility:new Ut(gt.layout_symbol.visibility)});var yC={paint:new yr({"icon-opacity":new Re(gt.paint_symbol["icon-opacity"]),"icon-emissive-strength":new Re(gt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Re(gt.paint_symbol["text-emissive-strength"]),"icon-color":new Re(gt.paint_symbol["icon-color"]),"icon-halo-color":new Re(gt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Re(gt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Re(gt.paint_symbol["icon-halo-blur"]),"icon-translate":new Ut(gt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ut(gt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Re(gt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Re(gt.paint_symbol["text-opacity"]),"text-color":new Re(gt.paint_symbol["text-color"],{runtimeType:sa,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new Re(gt.paint_symbol["text-halo-color"]),"text-halo-width":new Re(gt.paint_symbol["text-halo-width"]),"text-halo-blur":new Re(gt.paint_symbol["text-halo-blur"]),"text-translate":new Ut(gt.paint_symbol["text-translate"]),"text-translate-anchor":new Ut(gt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Ut(gt.paint_symbol["icon-color-saturation"])}),layout:eH};class yR{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Ju,this.defaultValue=t}evaluate(t){if(t.formattedSection){let i=this.defaultValue.property.overrides;if(i&&i.hasOverride(t.formattedSection))return i.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}xe(yR,"FormatSectionOverride",{omit:["defaultValue"]});class w0 extends Hs{constructor(t,i){super(t,yC,i)}recalculate(t,i){super.recalculate(t,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let o=this.layout.get("text-writing-mode");if(o){let c=[];for(let u of o)c.indexOf(u)<0&&c.push(u);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,i,o,c){let u=this.layout.get(t).evaluate(i,{},o,c),h=this._unevaluatedLayout._values[t];return h.isDataDriven()||b_(h.value)||!u?u:function(p,f){return f.replace(/{([^{}]+)}/g,(g,v)=>v in p?String(p[v]):"")}(i.properties,u)}createBucket(t){return new Zp(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let t of yC.paint.overridableProperties){if(!w0.hasPaintOverride(this.layout,t))continue;let i=this.paint.get(t),o=new yR(i),c=new N1(o,i.property.specification),u=null;u=i.value.kind==="constant"||i.value.kind==="source"?new B1("source",c):new jc("composite",c,i.value.zoomStops,i.value._interpolationType),this.paint._values[t]=new ph(i.property,u,i.parameters)}}_handleOverridablePaintPropertyUpdate(t,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&w0.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,i){let o=t.get("text-field"),c=yC.paint.properties[i],u=!1,h=p=>{for(let f of p)if(c.overrides&&c.overrides.hasOverride(f))return void(u=!0)};if(o.value.kind==="constant"&&o.value.value instanceof ys)h(o.value.value.sections);else if(o.value.kind==="source"){let p=g=>{u||(g instanceof hp&&yo(g.value)===ap?h(g.value.sections):g instanceof mp?h(g.sections):g.eachChild(p))},f=o.value;f._styleExpression&&p(f._styleExpression.expression)}return u}getProgramIds(){let t=this.paint.get("icon-opacity").constantOr(1)!==0,i=this.paint.get("text-opacity").constantOr(1)!==0,o=[];return t&&o.push("symbolIcon"),i&&o.push("symbolSDF"),o}getDefaultProgramParams(t,i){return{config:new iu(this,i),overrideFog:!1}}}let iH=a0.types,nH=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function C0(e,t,i,o,c,u,h,p,f,g,v,y,b){let x=p?Math.min(rd,Math.round(p[0])):0,C=p?Math.min(rd,Math.round(p[1])):0;e.emplaceBack(t,i,Math.round(32*o),Math.round(32*c),u,h,(x<<1)+(f?1:0),C,16*g,16*v,256*y,256*b)}function S0(e,t,i){e.emplaceBack(t,i)}function E0(e,t,i,o,c,u,h){e.emplaceBack(t,i,o,c,u,h)}function M0(e,t,i,o,c){let u=5*t+2;e.float32[u+0]=i,e.float32[u+1]=o,e.float32[u+2]=c}function Ph(e,t,i,o,c){e.emplaceBack(t,i,o,c),e.emplaceBack(t,i,o,c),e.emplaceBack(t,i,o,c),e.emplaceBack(t,i,o,c)}function rH(e){for(let t of e.sections)if(bU(t.text))return!0;return!1}class bC{constructor(t){this.layoutVertexArray=new nw,this.indexArray=new qr,this.programConfigurations=t,this.segments=new dn,this.dynamicLayoutVertexArray=new oc,this.opacityVertexArray=new ow,this.placedSymbolArray=new u2,this.iconTransitioningVertexArray=new qc,this.globeExtVertexArray=new rw,this.zOffsetVertexArray=new Dp}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(t,i,o,c,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,b8.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,w8.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,nH,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,S8.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,x8.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||u)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,C8.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||c)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}xe(bC,"SymbolBuffers");class xC{constructor(t,i,o){this.layoutVertexArray=new t,this.layoutAttributes=i,this.indexArray=new o,this.segments=new dn,this.collisionVertexArray=new lw,this.collisionVertexArrayExt=new oc}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,E8.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,M8.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}xe(xC,"CollisionBuffers");class D0{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(h=>h.fqid),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ft.identity([]),this.placementViewportMatrix=ft.identity([]);let i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=dC(this.zoom,i["text-size"]),this.iconSizeData=dC(this.zoom,i["icon-size"]);let o=this.layers[0].layout,c=o.get("symbol-sort-key"),u=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(h=>Kn[h]),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=o.get("symbol-z-elevate")}createArrays(){this.text=new bC(new $c(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new bC(new $c(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new p2,this.lineVertexArray=new f2,this.symbolInstances=new m2}calculateGlyphDependencies(t,i,o,c,u){for(let h=0;h<t.length;h++){let p=t.codePointAt(h);if(p===void 0)break;if(i[p]=!0,c&&u&&p<=65535){let f=jp[t.charAt(h)];f&&(i[f.charCodeAt(0)]=!0)}}}populate(t,i,o,c){let u=this.layers[0],h=u.layout,p=this.projection.name==="globe",f=h.get("text-font"),g=h.get("text-field"),v=h.get("icon-image"),y=(g.value.kind!=="constant"||g.value.value instanceof ys&&!g.value.value.isEmpty()||g.value.value.toString().length>0)&&(f.value.kind!=="constant"||f.value.value.length>0),b=v.value.kind!=="constant"||!!v.value.value||Object.keys(v.parameters).length>0,x=h.get("symbol-sort-key");if(this.features=[],!y&&!b)return;let C=i.iconDependencies,E=i.glyphDependencies,M=i.availableImages,D=new Jn(this.zoom);for(let{feature:I,id:P,index:O,sourceLayerIndex:R}of t){let F=u._featureFilter.needGeometry,z=td(I,F);if(!u._featureFilter.filter(D,z,o))continue;if(F||(z.geometry=Dl(I,o,c)),p&&I.type!==1&&o.z<=5){let $=z.geometry,Y=.98078528056,tt=(W,rt)=>{let st=Fp(W.x,W.y,o,1),pt=Fp(rt.x,rt.y,o,1);return J.dot(st,pt)<Y};for(let W=0;W<$.length;W++)$[W]=m6($[W],tt)}let j,U;if(y){let $=u.getValueAndResolveTokens("text-field",z,o,M),Y=ys.factory($);rH(Y)&&(this.hasRTLText=!0),(!this.hasRTLText||J1()==="unavailable"||this.hasRTLText&&ca.isParsed())&&(j=I8(Y,u,z))}if(b){let $=u.getValueAndResolveTokens("icon-image",z,o,M);U=$ instanceof aa?$:aa.fromString($)}if(!j&&!U)continue;let G=this.sortFeaturesByKey?x.evaluate(z,{},o):void 0;if(this.features.push({id:P,text:j,icon:U,index:O,sourceLayerIndex:R,geometry:z.geometry,properties:I.properties,type:iH[I.type],sortKey:G}),U&&(C[U.namePrimary]=!0,U.nameSecondary&&(C[U.nameSecondary]=!0)),j){let $=f.evaluate(z,{},o).join(","),Y=h.get("text-rotation-alignment")==="map"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Kn.vertical)>=0;for(let tt of j.sections)if(tt.image)C[tt.image.namePrimary]=!0;else{let W=q1(j.toString()),rt=tt.fontStack||$,st=E[rt]=E[rt]||{};this.calculateGlyphDependencies(tt.text,st,Y,this.allowVerticalPlacement,W)}}}h.get("symbol-placement")==="line"&&(this.features=function(I){let P={},O={},R=[],F=0;function z($){R.push(I[$]),F++}function j($,Y,tt){let W=O[$];return delete O[$],O[Y]=W,R[W].geometry[0].pop(),R[W].geometry[0]=R[W].geometry[0].concat(tt[0]),W}function U($,Y,tt){let W=P[Y];return delete P[Y],P[$]=W,R[W].geometry[0].shift(),R[W].geometry[0]=tt[0].concat(R[W].geometry[0]),W}function G($,Y,tt){let W=tt?Y[0][Y[0].length-1]:Y[0][0];return`${$}:${W.x}:${W.y}`}for(let $=0;$<I.length;$++){let Y=I[$],tt=Y.geometry,W=Y.text?Y.text.toString():null;if(!W){z($);continue}let rt=G(W,tt),st=G(W,tt,!0);if(rt in O&&st in P&&O[rt]!==P[st]){let pt=U(rt,st,tt),nt=j(rt,st,R[pt].geometry);delete P[rt],delete O[st],O[G(W,R[nt].geometry,!0)]=nt,R[pt].geometry=null}else rt in O?j(rt,st,tt):st in P?U(rt,st,tt):(z($),P[rt]=F-1,O[st]=F-1)}return R.filter($=>$.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((I,P)=>I.sortKey-P.sortKey)}update(t,i,o,c,u){let h=Object.keys(t).length!==0;if(h&&!this.stateDependentLayers.length)return;let p=h?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(t,i,p,o,c,u),this.icon.programConfigurations.updatePaintArrays(t,i,p,o,c,u)}updateZOffset(){let t=(u,h,p)=>{o+=h,o>u.length&&u.resize(o);for(let f=-h;f<0;f++)u.emplace(f+o,p)},i=(u,h,p)=>{c+=h,c>u.length&&u.resize(c);for(let f=-h;f<0;f++)u.emplace(f+c,p)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let o=0,c=0;for(let u=0;u<this.symbolInstances.length;u++){let h=this.symbolInstances.get(u),{numHorizontalGlyphVertices:p,numVerticalGlyphVertices:f,numIconVertices:g}=h,v=h.zOffset,y=g>0;if((p>0||f>0)&&(t(this.text.zOffsetVertexArray,p,v),t(this.text.zOffsetVertexArray,f,v)),y){let{placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:x}=h;b>=0&&i(this.icon.zOffsetVertexArray,g,v),x>=0&&i(this.icon.zOffsetVertexArray,h.numVerticalIconVertices,v)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=x0(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,i){let o=this.lineVertexArray.length;if(t.segment!==void 0)for(let{x:c,y:u}of i)this.lineVertexArray.emplaceBack(c,u);return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M){let D=t.indexArray,I=t.layoutVertexArray,P=t.globeExtVertexArray,O=t.segments.prepareSegment(4*i.length,I,D,this.canOverlap?h.sortKey:void 0),R=this.glyphOffsetArray.length,F=O.vertexLength,z=this.allowVerticalPlacement&&p===Kn.vertical?Math.PI/2:0,j=h.text&&h.text.sections;for(let G=0;G<i.length;G++){let{tl:$,tr:Y,bl:tt,br:W,texPrimary:rt,texSecondary:st,pixelOffsetTL:pt,pixelOffsetBR:nt,minFontScaleX:ot,minFontScaleY:_t,glyphOffset:bt,isSDF:yt,sectionIndex:Ct}=i[G],St=O.vertexLength,Tt=bt[1];if(C0(I,g.x,g.y,$.x,Tt+$.y,rt.x,rt.y,o,yt,pt.x,pt.y,ot,_t),C0(I,g.x,g.y,Y.x,Tt+Y.y,rt.x+rt.w,rt.y,o,yt,nt.x,pt.y,ot,_t),C0(I,g.x,g.y,tt.x,Tt+tt.y,rt.x,rt.y+rt.h,o,yt,pt.x,nt.y,ot,_t),C0(I,g.x,g.y,W.x,Tt+W.y,rt.x+rt.w,rt.y+rt.h,o,yt,nt.x,nt.y,ot,_t),f){let{x:xt,y:Ft,z:Qt}=f.anchor,[Jt,le,me]=f.up;E0(P,xt,Ft,Qt,Jt,le,me),E0(P,xt,Ft,Qt,Jt,le,me),E0(P,xt,Ft,Qt,Jt,le,me),E0(P,xt,Ft,Qt,Jt,le,me),Ph(t.dynamicLayoutVertexArray,xt,Ft,Qt,z)}else Ph(t.dynamicLayoutVertexArray,g.x,g.y,g.z,z);if(M){let xt=st||rt;S0(t.iconTransitioningVertexArray,xt.x,xt.y),S0(t.iconTransitioningVertexArray,xt.x+xt.w,xt.y),S0(t.iconTransitioningVertexArray,xt.x,xt.y+xt.h),S0(t.iconTransitioningVertexArray,xt.x+xt.w,xt.y+xt.h)}D.emplaceBack(St,St+1,St+2),D.emplaceBack(St+1,St+2,St+3),O.vertexLength+=4,O.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(bt[0]),G!==i.length-1&&Ct===i[G+1].sectionIndex||t.programConfigurations.populatePaintArrays(I.length,h,h.index,{},x,C,E,j&&j[Ct])}let U=f?f.anchor:g;t.placedSymbolArray.emplaceBack(U.x,U.y,U.z,g.x,g.y,R,this.glyphOffsetArray.length-R,F,v,y,g.segment,o?o[0]:0,o?o[1]:0,c[0],c[1],p,0,!1,0,b,0)}_commitLayoutVertex(t,i,o,c,u,h,p){t.emplaceBack(i,o,c,u,h,Math.round(p.x),Math.round(p.y))}_addCollisionDebugVertices(t,i,o,c,u,h,p){let f=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),g=f.vertexLength,v=p.tileAnchorX,y=p.tileAnchorY;for(let x=0;x<4;x++)o.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(o.collisionVertexArrayExt,i,t.padding,p.zOffset),this._commitLayoutVertex(o.layoutVertexArray,c,u,h,v,y,new Q(t.x1,t.y1)),this._commitLayoutVertex(o.layoutVertexArray,c,u,h,v,y,new Q(t.x2,t.y1)),this._commitLayoutVertex(o.layoutVertexArray,c,u,h,v,y,new Q(t.x2,t.y2)),this._commitLayoutVertex(o.layoutVertexArray,c,u,h,v,y,new Q(t.x1,t.y2)),f.vertexLength+=4;let b=o.indexArray;b.emplaceBack(g,g+1),b.emplaceBack(g+1,g+2),b.emplaceBack(g+2,g+3),b.emplaceBack(g+3,g),f.primitiveLength+=4}_addTextDebugCollisionBoxes(t,i,o,c,u,h){for(let p=c;p<u;p++){let f=o.get(p),g=this.getSymbolInstanceTextSize(t,h,i,p);this._addCollisionDebugVertices(f,g,this.textCollisionBox,f.projectedAnchorX,f.projectedAnchorY,f.projectedAnchorZ,h)}}_addIconDebugCollisionBoxes(t,i,o,c,u,h){for(let p=c;p<u;p++){let f=o.get(p),g=this.getSymbolInstanceIconSize(t,i,h.placedIconSymbolIndex);this._addCollisionDebugVertices(f,g,this.iconCollisionBox,f.projectedAnchorX,f.projectedAnchorY,f.projectedAnchorZ,h)}}generateCollisionDebugBuffers(t,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new xC(L_,Hk.members,qc),this.iconCollisionBox=new xC(L_,Hk.members,qc);let o=Tl(this.iconSizeData,t),c=Tl(this.textSizeData,t);for(let u=0;u<this.symbolInstances.length;u++){let h=this.symbolInstances.get(u);this._addTextDebugCollisionBoxes(c,t,i,h.textBoxStartIndex,h.textBoxEndIndex,h),this._addTextDebugCollisionBoxes(c,t,i,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h),this._addIconDebugCollisionBoxes(o,t,i,h.iconBoxStartIndex,h.iconBoxEndIndex,h),this._addIconDebugCollisionBoxes(o,t,i,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h)}}getSymbolInstanceTextSize(t,i,o,c){let u=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:c),h=Vp(this.textSizeData,t,u)/Co;return this.tilePixelRatio*h}getSymbolInstanceIconSize(t,i,o){let c=this.icon.placedSymbolArray.get(o),u=Vp(this.iconSizeData,t,c);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(t,i,o,c){t.emplaceBack(i,-o,-o,c),t.emplaceBack(i,o,-o,c),t.emplaceBack(i,o,o,c),t.emplaceBack(i,-o,o,c)}_updateTextDebugCollisionBoxes(t,i,o,c,u,h){for(let p=c;p<u;p++){let f=o.get(p),g=this.getSymbolInstanceTextSize(t,h,i,p);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,g,f.padding,h.zOffset)}}_updateIconDebugCollisionBoxes(t,i,o,c,u,h){for(let p=c;p<u;p++){let f=o.get(p),g=this.getSymbolInstanceIconSize(t,i,h.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,g,f.padding,h.zOffset)}}updateCollisionDebugBuffers(t,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let o=Tl(this.iconSizeData,t),c=Tl(this.textSizeData,t);for(let u=0;u<this.symbolInstances.length;u++){let h=this.symbolInstances.get(u);this._updateTextDebugCollisionBoxes(c,t,i,h.textBoxStartIndex,h.textBoxEndIndex,h),this._updateTextDebugCollisionBoxes(c,t,i,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h),this._updateIconDebugCollisionBoxes(o,t,i,h.iconBoxStartIndex,h.iconBoxEndIndex,h),this._updateIconDebugCollisionBoxes(o,t,i,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,i,o,c,u,h,p,f,g){let v={};if(i<o){let{x1:y,y1:b,x2:x,y2:C,padding:E,projectedAnchorX:M,projectedAnchorY:D,projectedAnchorZ:I,tileAnchorX:P,tileAnchorY:O,featureIndex:R}=t.get(i);v.textBox={x1:y,y1:b,x2:x,y2:C,padding:E,projectedAnchorX:M,projectedAnchorY:D,projectedAnchorZ:I,tileAnchorX:P,tileAnchorY:O},v.textFeatureIndex=R}if(c<u){let{x1:y,y1:b,x2:x,y2:C,padding:E,projectedAnchorX:M,projectedAnchorY:D,projectedAnchorZ:I,tileAnchorX:P,tileAnchorY:O,featureIndex:R}=t.get(c);v.verticalTextBox={x1:y,y1:b,x2:x,y2:C,padding:E,projectedAnchorX:M,projectedAnchorY:D,projectedAnchorZ:I,tileAnchorX:P,tileAnchorY:O},v.verticalTextFeatureIndex=R}if(h<p){let{x1:y,y1:b,x2:x,y2:C,padding:E,projectedAnchorX:M,projectedAnchorY:D,projectedAnchorZ:I,tileAnchorX:P,tileAnchorY:O,featureIndex:R}=t.get(h);v.iconBox={x1:y,y1:b,x2:x,y2:C,padding:E,projectedAnchorX:M,projectedAnchorY:D,projectedAnchorZ:I,tileAnchorX:P,tileAnchorY:O},v.iconFeatureIndex=R}if(f<g){let{x1:y,y1:b,x2:x,y2:C,padding:E,projectedAnchorX:M,projectedAnchorY:D,projectedAnchorZ:I,tileAnchorX:P,tileAnchorY:O,featureIndex:R}=t.get(f);v.verticalIconBox={x1:y,y1:b,x2:x,y2:C,padding:E,projectedAnchorX:M,projectedAnchorY:D,projectedAnchorZ:I,tileAnchorX:P,tileAnchorY:O},v.verticalIconFeatureIndex=R}return v}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){let o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,i){let o=t.placedSymbolArray.get(i),c=o.vertexStartIndex+4*o.numGlyphs;for(let u=o.vertexStartIndex;u<c;u+=4)t.indexArray.emplaceBack(u,u+1,u+2),t.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let i=Math.sin(t),o=Math.cos(t),c=[],u=[],h=[];for(let p=0;p<this.symbolInstances.length;++p){h.push(p);let f=this.symbolInstances.get(p);c.push(0|Math.round(i*f.tileAnchorX+o*f.tileAnchorY)),u.push(f.featureIndex)}return h.sort((p,f)=>c[p]-c[f]||u[f]-u[p]),h}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((t,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(t).zOffset)}addToSortKeyRanges(t,i){let o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let i of this.symbolInstanceIndexes){let o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex);let{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:u,leftJustifiedTextSymbolIndex:h,verticalPlacedTextSymbolIndex:p,placedIconSymbolIndex:f,verticalPlacedIconSymbolIndex:g}=o;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),u>=0&&u!==c&&this.addIndicesForPlacedSymbol(this.text,u),h>=0&&h!==u&&h!==c&&this.addIndicesForPlacedSymbol(this.text,h),p>=0&&this.addIndicesForPlacedSymbol(this.text,p),f>=0&&this.addIndicesForPlacedSymbol(this.icon,f),g>=0&&this.addIndicesForPlacedSymbol(this.icon,g)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}xe(D0,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),D0.MAX_GLYPHS=65535,D0.addDynamicAttributes=Ph;var Zp=D0;let oH=Qi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:sH}=oH,aH=Qi([{name:"a_packed",components:4,type:"Float32"}]),{members:lH}=aH,cH=a0.types,dH=Math.cos(Math.PI/180*37.5);class T0{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new iw,this.layoutVertexArray2=new oc,this.indexArray=new qr,this.programConfigurations=new $c(t.layers,t.zoom),this.segments=new dn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,o,c){this.hasPattern=oC("line",this.layers,i);let u=this.layers[0].layout.get("line-sort-key"),h=[];for(let{feature:v,id:y,index:b,sourceLayerIndex:x}of t){let C=this.layers[0]._featureFilter.needGeometry,E=td(v,C);if(!this.layers[0]._featureFilter.filter(new Jn(this.zoom),E,o))continue;let M=u?u.evaluate(E,{},o):void 0,D={id:y,properties:v.properties,type:v.type,sourceLayerIndex:x,index:b,geometry:C?E.geometry:Dl(v,o,c),patterns:{},sortKey:M};h.push(D)}u&&h.sort((v,y)=>v.sortKey-y.sortKey);let{lineAtlas:p,featureIndex:f}=i,g=this.addConstantDashes(p);for(let v of h){let{geometry:y,index:b,sourceLayerIndex:x}=v;if(g&&this.addFeatureDashes(v,p),this.hasPattern){let C=sC("line",this.layers,v,this.zoom,i);this.patternFeatures.push(C)}else this.addFeature(v,y,b,o,p.positions,i.availableImages,i.brightness);f.insert(t[b].feature,y,b,x,this.index)}}addConstantDashes(t){let i=!1;for(let o of this.layers){let c=o.paint.get("line-dasharray").value,u=o.layout.get("line-cap").value;if(c.kind!=="constant"||u.kind!=="constant")i=!0;else{let h=u.value,p=c.value;if(!p)continue;t.addDash(p,h)}}return i}addFeatureDashes(t,i){let o=this.zoom;for(let c of this.layers){let u=c.paint.get("line-dasharray").value,h=c.layout.get("line-cap").value;if(u.kind==="constant"&&h.kind==="constant")continue;let p,f;if(u.kind==="constant"){if(p=u.value,!p)continue}else p=u.evaluate({zoom:o},t);f=h.kind==="constant"?h.value:h.evaluate({zoom:o},t),i.addDash(p,f),t.patterns[c.id]=i.getKey(p,f)}}update(t,i,o,c,u){let h=Object.keys(t).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,i,h?this.stateDependentLayers:this.layers,o,c,u)}addFeatures(t,i,o,c,u,h){for(let p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,i,o,c,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,lH)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,sH),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,i,o,c,u,h,p){let f=this.layers[0].layout,g=f.get("line-join").evaluate(t,{}),v=f.get("line-cap").evaluate(t,{}),y=f.get("line-miter-limit"),b=f.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(let x of i)this.addLine(x,t,g,v,y,b);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,u,h,c,p)}addLine(t,i,o,c,u,h){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let D=0;D<t.length-1;D++)this.totalDistance+=t[D].dist(t[D+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let p=cH[i.type]==="Polygon",f=t.length;for(;f>=2&&t[f-1].equals(t[f-2]);)f--;let g=0;for(;g<f-1&&t[g].equals(t[g+1]);)g++;if(f<(p?3:2))return;o==="bevel"&&(u=1.05);let v=this.overscaling<=16?15*wt/(512*this.overscaling):0,y=this.segments.prepareSegment(10*f,this.layoutVertexArray,this.indexArray),b,x,C,E,M;this.e1=this.e2=-1,p&&(b=t[f-2],M=t[g].sub(b)._unit()._perp());for(let D=g;D<f;D++){if(C=D===f-1?p?t[g+1]:void 0:t[D+1],C&&t[D].equals(C))continue;M&&(E=M),b&&(x=b),b=t[D],M=C?C.sub(b)._unit()._perp():E,E=E||M;let I=E.add(M);I.x===0&&I.y===0||I._unit();let P=E.x*M.x+E.y*M.y,O=I.x*M.x+I.y*M.y,R=O!==0?1/O:1/0,F=2*Math.sqrt(2-2*O),z=O<dH&&x&&C,j=E.x*M.y-E.y*M.x>0;if(z&&D>g){let $=b.dist(x);if($>2*v){let Y=b.sub(b.sub(x)._mult(v/$)._round());this.updateDistance(x,Y),this.addCurrentVertex(Y,E,0,0,y),x=Y}}let U=x&&C,G=U?o:p?"butt":c;if(U&&G==="round"&&(R<h?G="miter":R<=2&&(G="fakeround")),G==="miter"&&R>u&&(G="bevel"),G==="bevel"&&(R>2&&(G="flipbevel"),R<u&&(G="miter")),x&&this.updateDistance(x,b),G==="miter")I._mult(R),this.addCurrentVertex(b,I,0,0,y);else if(G==="flipbevel"){if(R>100)I=M.mult(-1);else{let $=R*E.add(M).mag()/E.sub(M).mag();I._perp()._mult($*(j?-1:1))}this.addCurrentVertex(b,I,0,0,y),this.addCurrentVertex(b,I.mult(-1),0,0,y)}else if(G==="bevel"||G==="fakeround"){let $=-Math.sqrt(R*R-1),Y=j?$:0,tt=j?0:$;if(x&&this.addCurrentVertex(b,E,Y,tt,y),G==="fakeround"){let W=Math.round(180*F/Math.PI/20);for(let rt=1;rt<W;rt++){let st=rt/W;if(st!==.5){let nt=st-.5;st+=st*nt*(st-1)*((1.0904+P*(P*(3.55645-1.43519*P)-3.2452))*nt*nt+(.848013+P*(.215638*P-1.06021)))}let pt=M.sub(E)._mult(st)._add(E)._unit()._mult(j?-1:1);this.addHalfVertex(b,pt.x,pt.y,!1,j,0,y)}}C&&this.addCurrentVertex(b,M,-Y,-tt,y)}else if(G==="butt")this.addCurrentVertex(b,I,0,0,y);else if(G==="square"){let $=x?1:-1;x||this.addCurrentVertex(b,I,$,$,y),this.addCurrentVertex(b,I,0,0,y),x&&this.addCurrentVertex(b,I,$,$,y)}else G==="round"&&(x&&(this.addCurrentVertex(b,E,0,0,y),this.addCurrentVertex(b,E,1,1,y,!0)),C&&(this.addCurrentVertex(b,M,-1,-1,y,!0),this.addCurrentVertex(b,M,0,0,y)));if(z&&D<f-1){let $=b.dist(C);if($>2*v){let Y=b.add(C.sub(b)._mult(v/$)._round());this.updateDistance(b,Y),this.addCurrentVertex(Y,M,0,0,y),b=Y}}}}addCurrentVertex(t,i,o,c,u,h=!1){let p=i.y*c-i.x,f=-i.y-i.x*c;this.addHalfVertex(t,i.x+i.y*o,i.y-i.x*o,h,!1,o,u),this.addHalfVertex(t,p,f,h,!0,-c,u)}addHalfVertex({x:t,y:i},o,c,u,h,p,f){this.layoutVertexArray.emplaceBack((t<<1)+(u?1:0),(i<<1)+(h?1:0),Math.round(63*o)+128,Math.round(63*c)+128,1+(p===0?0:p<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let g=f.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,g),f.primitiveLength++),h?this.e2=g:this.e1=g}updateScaledDistance(){if(this.lineClips){let t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,i){this.distance+=t.dist(i),this.updateScaledDistance()}}xe(T0,"LineBucket",{omit:["layers","patternFeatures"]});class ir{constructor(t,i,o,c){this.context=t,this.format=o,this.texture=t.gl.createTexture(),this.update(i,c)}update(t,i,o){let{width:c,height:u}=t,{context:h}=this,{gl:p}=h,{HTMLImageElement:f,HTMLCanvasElement:g,HTMLVideoElement:v,ImageData:y,ImageBitmap:b}=m;if(p.bindTexture(p.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===p.RGBA&&(!i||i.premultiply!==!1)),o||this.size&&this.size[0]===c&&this.size[1]===u){let{x,y:C}=o||{x:0,y:0};if(t instanceof f||t instanceof g||t instanceof v||t instanceof y||b&&t instanceof b)p.texSubImage2D(p.TEXTURE_2D,0,x,C,p.RGBA,p.UNSIGNED_BYTE,t);else{let E=this.format,M=p.UNSIGNED_BYTE;this.format===p.R32F&&(E=p.RED,M=p.FLOAT),p.texSubImage2D(p.TEXTURE_2D,0,x,C,c,u,E,M,t.data)}}else if(this.size=[c,u],t instanceof f||t instanceof g||t instanceof v||t instanceof y||b&&t instanceof b){let x=this.format;this.format===p.R8&&(x=p.RED),p.texImage2D(p.TEXTURE_2D,0,this.format,x,p.UNSIGNED_BYTE,t)}else{let x=this.format,C=this.format,E=p.UNSIGNED_BYTE;this.format===p.DEPTH_COMPONENT&&(x=p.DEPTH_COMPONENT16,E=p.UNSIGNED_SHORT),this.format===p.R32F&&(E=p.FLOAT,C=p.RED),p.texImage2D(p.TEXTURE_2D,0,x,c,u,0,C,E,t.data)}this.useMipmap=!!(i&&i.useMipmap),this.useMipmap&&p.generateMipmap(p.TEXTURE_2D)}bind(t,i){let{context:o}=this,{gl:c}=o;c.bindTexture(c.TEXTURE_2D,this.texture),t!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,t),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap?t===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_NEAREST:t),this.minFilter=t),i!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,i),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(t,i,o,c){let{context:u}=this,{gl:h}=u;h.bindTexture(h.TEXTURE_2D,this.texture),i!==this.magFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,i),this.magFilter=i),t!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?t===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:t),this.minFilter=t),o!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),this.wrapS=o),c!==this.wrapT&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,c),this.wrapT=c)}destroy(){let{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class I0{constructor(t,i){this.context=t,this.texture=i}bind(t,i){let{context:o}=this,{gl:c}=o;c.bindTexture(c.TEXTURE_2D,this.texture),t!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,t),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,t),this.minFilter=t),i!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,i),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,i),this.wrapS=i)}}let pa=32,Il=33,sd=new Uint16Array(8184);for(let e=0;e<2046;e++){let t=e+2,i=0,o=0,c=0,u=0,h=0,p=0;for(1&t?c=u=h=pa:i=o=p=pa;(t>>=1)>1;){let g=i+c>>1,v=o+u>>1;1&t?(c=i,u=o,i=h,o=p):(i=c,o=u,c=h,u=p),h=g,p=v}let f=4*e;sd[f+0]=i,sd[f+1]=o,sd[f+2]=c,sd[f+3]=u}let Al=new Uint16Array(2178),ad=new Uint8Array(1089),A0=new Uint16Array(1089);function bR(e){return e===0?-.03125:e===32?.03125:0}var wC=Qi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);let xR={type:2,extent:wt,loadGeometry:()=>[[new Q(0,0),new Q(wt+1,0),new Q(wt+1,wt+1),new Q(0,wt+1),new Q(0,0)]]};class Xp{constructor(t,i,o,c,u){this.tileID=t,this.uid=Wu(),this.uses=0,this.tileSize=i,this.tileZoom=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=u,c&&c.style&&(this._lastUpdatedBrightness=c.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",c&&c.transform&&(this.projection=c.transform.projection)}registerFadeDuration(t){let i=t+this.timeAdded;i<ni.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=su(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,i,o){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(c,u){let h={};if(!u)return h;for(let p of c){let f=p.layerIds.map(g=>u.getLayer(g)).filter(Boolean);if(f.length!==0){p.layers=f,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(g=>f.filter(v=>v.id===g)[0]));for(let g of f)h[g.fqid]=p}}return h}(t.buckets,i.style),this.hasSymbolBuckets=!1;for(let c in this.buckets){let u=this.buckets[c];if(u instanceof Zp){if(this.hasSymbolBuckets=!0,!o)break;u.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let c in this.buckets){let u=this.buckets[c];if(u instanceof Zp&&u.hasRTLText){this.hasRTLText=!0,ca.isLoading()||ca.isLoaded()||J1()!=="deferred"||n2();break}}this.queryPadding=0;for(let c in this.buckets){let u=this.buckets[c],h=i.style.getOwnLayer(c);if(!h)continue;let p=h.queryRadius(u);this.queryPadding=Math.max(this.queryPadding,p)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new fw}unloadVectorData(){if(this.hasData()){for(let t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.fqid]}upload(t){for(let o in this.buckets){let c=this.buckets[o];c.uploadPending()&&c.upload(t)}let i=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ir(t,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ir(t,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new ir(t,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t,i,o){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,o),!i||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let c=i.style.getBrightness();(this._lastUpdatedBrightness||c)&&(this._lastUpdatedBrightness&&c&&Math.abs(this._lastUpdatedBrightness-c)<.001||(this._lastUpdatedBrightness=c,this.updateBuckets(void 0,i)))}queryRenderedFeatures(t,i,o,c,u,h,p,f){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:c,pixelPosMatrix:p,transform:h,params:u,tileTransform:this.tileTransform},t,i,o):{}}querySourceFeatures(t,i){let o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;let c=o.loadVTLayers(),u=i?i.sourceLayer:"",h=c._geojsonTileLayer||c[u];if(!h)return;let p=S_(i&&i.filter),{z:f,x:g,y:v}=this.tileID.canonical,y={z:f,x:g,y:v};for(let b=0;b<h.length;b++){let x=h.feature(b);if(p.needGeometry){let M=td(x,!0);if(!p.filter(new Jn(this.tileID.overscaledZ),M,this.tileID.canonical))continue}else if(!p.filter(new Jn(this.tileID.overscaledZ),x))continue;let C=o.getId(x,u),E=new Ok(x,f,g,v,C);E.tile=y,t.push(E)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(let t in this.buckets)if(this.buckets[t].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){let i=this.expirationTime;if(t.cacheControl){let o=Pe(t.cacheControl);o["max-age"]&&(this.expirationTime=Date.now()+1e3*o["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){let o=Date.now(),c=!1;if(this.expirationTime>o)c=!1;else if(i)if(this.expirationTime<i)c=!0;else{let u=this.expirationTime-i;u?this.expirationTime=o+Math.max(u,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,i){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0&&i&&this.updateBuckets(t,i)}updateBuckets(t,i){if(!this.latestFeatureIndex)return;let o=this.latestFeatureIndex.loadVTLayers(),c=i.style.listImages(),u=i.style.getBrightness();for(let h in this.buckets){if(!i.style.hasLayer(h))continue;let p=this.buckets[h],f=p.layers[0].sourceLayer||"_geojsonTileLayer",g=o[f],v={};if(t&&(v=t[f],!g||!v||Object.keys(v).length===0))continue;if(p.update(v,g,c,this.imageAtlas&&this.imageAtlas.patternPositions||{},u),p instanceof T0||p instanceof o0){let b=i.style.getOwnSourceCache(p.layers[0].source);i._terrain&&i._terrain.enabled&&b&&p.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(b.id,this.tileID)}let y=i&&i.style&&i.style.getOwnLayer(h);y&&(this.queryPadding=Math.max(this.queryPadding,y.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ni.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=ni.now()+t}setTexture(t,i){let o=i.context,c=o.gl;this.texture=this.texture||i.getTileTexture(t.width),this.texture&&this.texture instanceof ir?this.texture.update(t,{useMipmap:!0}):(this.texture=new ir(o,t,c.RGBA,{useMipmap:!0}),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE))}setDependencies(t,i){let o={};for(let c of i)o[c]=!0;this.dependencies[t]=o}hasDependency(t,i){for(let o of t){let c=this.dependencies[o];if(c){for(let u of i)if(c[u])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;let o=Dl(xR,this.tileID.canonical,this.tileTransform)[0],c=new xs,u=new Tp;for(let h=0;h<o.length;h++){let{x:p,y:f}=o[h];c.emplaceBack(p,f),u.emplaceBack(h)}u.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(u),this._tileDebugBuffer=t.createVertexBuffer(c,Zc.members),this._tileDebugSegments=dn.simpleSegment(0,0,c.length,u.length)}_makeTileBoundsBuffers(t,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;let o=Dl(xR,this.tileID.canonical,this.tileTransform)[0],c,u;if(this.isRaster){let h=function(p,f){let g=su(p,f),v=Math.pow(2,p.z);for(let M=0;M<Il;M++)for(let D=0;D<Il;D++){let I=Ss((p.x+(D+bR(D))/pa)/v),P=Wr((p.y+(M+bR(M))/pa)/v),O=f.project(I,P),R=M*Il+D;Al[2*R+0]=Math.round((O.x*g.scale-g.x)*wt),Al[2*R+1]=Math.round((O.y*g.scale-g.y)*wt)}ad.fill(0),A0.fill(0);for(let M=2045;M>=0;M--){let D=4*M,I=sd[D+0],P=sd[D+1],O=sd[D+2],R=sd[D+3],F=I+O>>1,z=P+R>>1,j=F+z-P,U=z+I-F,G=P*Il+I,$=R*Il+O,Y=z*Il+F,tt=Math.hypot((Al[2*G+0]+Al[2*$+0])/2-Al[2*Y+0],(Al[2*G+1]+Al[2*$+1])/2-Al[2*Y+1])>=16;ad[Y]=ad[Y]||(tt?1:0),M<1022&&(ad[Y]=ad[Y]||ad[(P+U>>1)*Il+(I+j>>1)]||ad[(R+U>>1)*Il+(O+j>>1)])}let y=new Jd,b=new qr,x=0;function C(M,D){let I=D*Il+M;return A0[I]===0&&(y.emplaceBack(Al[2*I+0],Al[2*I+1],M*wt/pa,D*wt/pa),A0[I]=++x),A0[I]-1}function E(M,D,I,P,O,R){let F=M+I>>1,z=D+P>>1;if(Math.abs(M-O)+Math.abs(D-R)>1&&ad[z*Il+F])E(O,R,M,D,F,z),E(I,P,O,R,F,z);else{let j=C(M,D),U=C(I,P),G=C(O,R);b.emplaceBack(j,U,G)}}return E(0,0,pa,pa,pa,0),E(pa,pa,0,0,0,pa),{vertices:y,indices:b}}(this.tileID.canonical,i);c=h.vertices,u=h.indices}else{c=new Jd,u=new qr;for(let{x:p,y:f}of o)c.emplaceBack(p,f,0,0);let h=r0(c.int16,void 0,4);for(let p=0;p<h.length;p+=3)u.emplaceBack(h[p],h[p+1],h[p+2])}this._tileBoundsBuffer=t.createVertexBuffer(c,wC.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(u),this._tileBoundsSegments=dn.simpleSegment(0,0,c.length,u.length)}_makeGlobeTileDebugBuffers(t,i){let o=i.projection;if(!o||o.name!=="globe"||i.freezeTileCoverage)return;let c=this.tileID.canonical,u=Kc(qA(c,i)),h=wo(i.zoom),p;h>0&&(p=ft.invert(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,c,i,u,p,h),this._makeGlobeTileDebugTextBuffer(t,c,i,u,p,h)}_globePoint(t,i,o,c,u,h,p){let f=Fp(t,i,o);if(h){let g=1<<o.z,v=to(c.center.lng),y=lo(c.center.lat),b=(o.x+.5)/g-v,x=0;b>.5?x=-1:b<-.5&&(x=1);let C=(t/wt+o.x)/g+x,E=(i/wt+o.y)/g;C=(C-v)*c._pixelsPerMercatorPixel+v,E=(E-y)*c._pixelsPerMercatorPixel+y;let M=[C*c.worldSize,E*c.worldSize,0];J.transformMat4(M,M,h),f=mc(f,M,p)}return J.transformMat4(f,f,u)}_makeGlobeTileDebugBorderBuffer(t,i,o,c,u,h){let p=new xs,f=new Tp,g=new P_,v=(b,x,C,E,M)=>{let D=(C-b)/(M-1),I=(E-x)/(M-1),P=p.length;for(let O=0;O<M;O++){let R=b+O*D,F=x+O*I;p.emplaceBack(R,F);let z=this._globePoint(R,F,i,o,c,u,h);g.emplaceBack(z[0],z[1],z[2]),f.emplaceBack(P+O)}},y=wt;v(0,0,y,0,16),v(y,0,y,y,16),v(y,y,0,y,16),v(0,y,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(f),this._tileDebugBuffer=t.createVertexBuffer(p,Zc.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(g,NA.members),this._tileDebugSegments=dn.simpleSegment(0,0,p.length,f.length)}_makeGlobeTileDebugTextBuffer(t,i,o,c,u,h){let p=wt/4,f=new xs,g=new qr,v=new P_,y=25;g.reserve(32),f.reserve(y),v.reserve(y);let b=(x,C)=>y*x+C;for(let x=0;x<y;x++){let C=x*p;for(let E=0;E<y;E++){let M=E*p;f.emplaceBack(M,C);let D=this._globePoint(M,C,i,o,c,u,h);v.emplaceBack(D[0],D[1],D[2])}}for(let x=0;x<4;x++)for(let C=0;C<4;C++){let E=b(x,C),M=b(x,C+1),D=b(x+1,C),I=b(x+1,C+1);g.emplaceBack(E,M,D),g.emplaceBack(D,M,I)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(g),this._tileDebugTextBuffer=t.createVertexBuffer(f,Zc.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(v,NA.members),this._tileDebugTextSegments=dn.simpleSegment(0,0,y,32)}destroy(t=!1){for(let i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof ir&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.latestFeatureIndex=null,this.state="unloaded"}}class uH{constructor(t,i){this.max=t,this.onRemove=i,this.reset()}reset(){for(let t in this.data)for(let i of this.data[t])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(t,i,o){let c=t.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);let u={value:i,timeout:void 0};if(o!==void 0&&(u.timeout=setTimeout(()=>{this.remove(t,u)},o)),this.data[c].push(u),this.order.push(c),this.order.length>this.max){let h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){let i=this.data[t].shift();return i.timeout&&clearTimeout(i.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),i.value}getByKey(t){let i=this.data[t];return i?i[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,i){if(!this.has(t))return this;let o=t.wrapped().key,c=i===void 0?0:this.data[o].indexOf(i),u=this.data[o][c];return this.data[o].splice(c,1),u.timeout&&clearTimeout(u.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(u.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){let i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(t){let i=[];for(let o in this.data)for(let c of this.data[o])t(c.value)||i.push(c);for(let o of i)this.remove(o.value.tileID,o)}}let wR=(()=>{class e{constructor(i,o,c,u){this.id=e.uniqueIdxCounter,e.uniqueIdxCounter++,this.context=i;let h=i.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||u||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){this.id=e.uniqueIdxCounter,e.uniqueIdxCounter++;let o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return e.uniqueIdxCounter=0,e})(),hH={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class mH{constructor(t,i,o,c,u,h){this.length=i.length,this.attributes=o,this.itemSize=i.bytesPerElement,this.dynamicDraw=c,this.instanceCount=h,this.context=t;let p=t.gl;this.buffer=p.createBuffer(),t.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||u||i.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){let i=this.context.gl;this.bind(),i.bufferSubData(i.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,i){for(let o=0;o<this.attributes.length;o++){let c=i.attributes[this.attributes[o].name];c!==void 0&&t.enableVertexAttribArray(c)}}setVertexAttribPointers(t,i,o){for(let c=0;c<this.attributes.length;c++){let u=this.attributes[c],h=i.attributes[u.name];h!==void 0&&t.vertexAttribPointer(h,u.components,t[hH[u.type]],!1,this.itemSize,u.offset+this.itemSize*(o||0))}}setVertexAttribDivisor(t,i,o){for(let c=0;c<this.attributes.length;c++){let u=i.attributes[this.attributes[c].name];u!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(u,o)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Hn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class pH extends Hn{getDefault(){return fi.transparent}set(t){let i=this.current;(t.r!==i.r||t.g!==i.g||t.b!==i.b||t.a!==i.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class fH extends Hn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class gH extends Hn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class _H extends Hn{getDefault(){return[!0,!0,!0,!0]}set(t){let i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[3]!==i[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class vH extends Hn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class yH extends Hn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class bH extends Hn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){let i=this.current;(t.func!==i.func||t.ref!==i.ref||t.mask!==i.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class xH extends Hn{getDefault(){let t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){let i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class wH extends Hn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;t?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),this.current=t,this.dirty=!1}}class CH extends Hn{getDefault(){return[0,1]}set(t){let i=this.current;(t[0]!==i[0]||t[1]!==i[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class SH extends Hn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;t?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),this.current=t,this.dirty=!1}}class EH extends Hn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class MH extends Hn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;t?i.enable(i.BLEND):i.disable(i.BLEND),this.current=t,this.dirty=!1}}class DH extends Hn{getDefault(){let t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){let i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[3]!==i[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class TH extends Hn{getDefault(){return fi.transparent}set(t){let i=this.current;(t.r!==i.r||t.g!==i.g||t.b!==i.b||t.a!==i.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class IH extends Hn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class AH extends Hn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;t?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),this.current=t,this.dirty=!1}}class kH extends Hn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class RH extends Hn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let PH=class extends Hn{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}};class OH extends Hn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class FH extends Hn{getDefault(){let t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){let i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[3]!==i[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class LH extends Hn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class zH extends Hn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.bindRenderbuffer(i.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class NH extends Hn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.bindTexture(i.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class BH extends Hn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class VH extends Hn{getDefault(){return null}set(t){let i=this.gl;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class jH extends Hn{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class UH extends Hn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class HH extends Hn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class GH extends Hn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class CC extends Hn{constructor(t,i){super(t),this.context=t,this.parent=i}getDefault(){return null}}class qH extends CC{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class CR extends CC{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,this.attachment(),i.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class WH extends CC{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,this.attachment(),i.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class $H extends CR{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class YH{constructor(t,i,o,c,u){this.context=t,this.width=i,this.height=o;let h=this.framebuffer=t.gl.createFramebuffer();c&&(this.colorAttachment=new qH(t,h)),u&&(this.depthAttachmentType=u,this.depthAttachment=u==="renderbuffer"?new CR(t,h):new WH(t,h))}destroy(){let t=this.context.gl;if(this.colorAttachment){let i=this.colorAttachment.get();i&&t.deleteTexture(i)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let i=this.depthAttachment.get();i&&t.deleteRenderbuffer(i)}else{let i=this.depthAttachment.get();i&&t.deleteTexture(i)}t.deleteFramebuffer(this.framebuffer)}}class je{constructor(t,i,o){this.func=t,this.mask=i,this.range=o}}je.ReadOnly=!1,je.ReadWrite=!0,je.disabled=new je(519,je.ReadOnly,[0,1]);let SC=7680;class gi{constructor(t,i,o,c,u,h){this.test=t,this.ref=i,this.mask=o,this.fail=c,this.depthFail=u,this.pass=h}}gi.disabled=new gi({func:519,mask:0},0,0,SC,SC,SC);let k0=771;class Vi{constructor(t,i,o,c){this.blendFunction=t,this.blendColor=i,this.mask=o,this.blendEquation=c}}Vi.Replace=[1,0,1,0],Vi.disabled=new Vi(Vi.Replace,fi.transparent,[!1,!1,!1,!1]),Vi.unblended=new Vi(Vi.Replace,fi.transparent,[!0,!0,!0,!0]),Vi.alphaBlended=new Vi([1,k0,1,k0],fi.transparent,[!0,!0,!0,!0]),Vi.multiply=new Vi([774,0,774,0],fi.transparent,[!0,!0,!0,!0]);let EC=1029,MC=2305;class vi{constructor(t,i,o){this.enable=t,this.mode=i,this.frontFace=o}}vi.disabled=new vi(!1,EC,MC),vi.backCCW=new vi(!0,EC,MC),vi.backCW=new vi(!0,EC,2304),vi.frontCW=new vi(!0,1028,2304),vi.frontCCW=new vi(!0,1028,MC);class ZH{constructor(t,i){this.gl=t,this.clearColor=new pH(this),this.clearDepth=new fH(this),this.clearStencil=new gH(this),this.colorMask=new _H(this),this.depthMask=new vH(this),this.stencilMask=new yH(this),this.stencilFunc=new bH(this),this.stencilOp=new xH(this),this.stencilTest=new wH(this),this.depthRange=new CH(this),this.depthTest=new SH(this),this.depthFunc=new EH(this),this.blend=new MH(this),this.blendFunc=new DH(this),this.blendColor=new TH(this),this.blendEquation=new IH(this),this.cullFace=new AH(this),this.cullFaceSide=new kH(this),this.frontFace=new RH(this),this.program=new PH(this),this.activeTexture=new OH(this),this.viewport=new FH(this),this.bindFramebuffer=new LH(this),this.bindRenderbuffer=new zH(this),this.bindTexture=new NH(this),this.bindVertexBuffer=new BH(this),this.bindElementBuffer=new VH(this),this.bindVertexArrayOES=new jH(this),this.pixelStoreUnpack=new UH(this),this.pixelStoreUnpackPremultiplyAlpha=new HH(this),this.pixelStoreUnpackFlipY=new GH(this),this.options=i?Gt({},i):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,i,o){return new wR(this,t,i,o)}createVertexBuffer(t,i,o,c,u){return new mH(this,t,i,o,c,u)}createRenderbuffer(t,i,o){let c=this.gl,u=c.createRenderbuffer();return this.bindRenderbuffer.set(u),c.renderbufferStorage(c.RENDERBUFFER,t,i,o),this.bindRenderbuffer.set(null),u}createFramebuffer(t,i,o,c){return new YH(this,t,i,o,c)}clear({color:t,depth:i,stencil:o,colorMask:c}){let u=this.gl,h=0;t&&(h|=u.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(c||[!0,!0,!0,!0])),i!==void 0&&(h|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),o!==void 0&&(h|=u.STENCIL_BUFFER_BIT,this.clearStencil.set(o),this.stencilMask.set(255)),u.clear(h)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){$t(t.blendFunction,Vi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class Ja extends Hr{constructor(t,i,o){super(),this.id=t,this._onlySymbols=o,i.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new uH(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new p8,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let t in this._tiles){let i=this._tiles[t];if(i.state!=="errored"&&(i.state!=="loaded"||!i.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,i){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,i)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let i in this._tiles){let o=this._tiles[i];o.upload(t),o.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Us(this._tiles).map(t=>t.tileID).sort(SR).map(t=>t.key)}getRenderableIds(t,i){let o=[];for(let c in this._tiles)this._isIdRenderable(+c,t,i)&&o.push(this._tiles[c]);return t?o.sort((c,u)=>{let h=c.tileID,p=u.tileID,f=new Q(h.canonical.x,h.canonical.y)._rotate(this.transform.angle),g=new Q(p.canonical.x,p.canonical.y)._rotate(this.transform.angle);return h.overscaledZ-p.overscaledZ||g.y-f.y||g.x-f.x}).map(c=>c.tileID.key):o.map(c=>c.tileID).sort(SR).map(c=>c.key)}hasRenderableParent(t){let i=this.findLoadedParent(t,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(t,i,o){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(i||!this._tiles[t].holdingForFade())&&(o||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,i){let o=this._tiles[t];o&&(o.state!=="loading"&&(o.state=i),this._loadTile(o,this._tileLoaded.bind(this,o,t,i)))}_tileLoaded(t,i,o,c){if(c)if(t.state="errored",c.status!==404)this._source.fire(new Xe(c,{tile:t}));else{if(!(t.tileID.key in this._loadedParentTiles))return void this._source.fire(new qt("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let u=this.map.painter.terrain;this.update(this.transform,u.getScaledDemTileSize(),!0),u.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=ni.now(),o==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(i,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new qt("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){let i=this.getRenderableIds();for(let c=0;c<i.length;c++){let u=i[c];if(t.neighboringTiles&&t.neighboringTiles[u]){let h=this.getTileByID(u);o(t,h),o(h,t)}}function o(c,u){if(!c.dem||c.dem.borderReady)return;c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0;let h=u.tileID.canonical.x-c.tileID.canonical.x,p=u.tileID.canonical.y-c.tileID.canonical.y,f=Math.pow(2,c.tileID.canonical.z),g=u.tileID.key;h===0&&p===0||Math.abs(p)>1||(Math.abs(h)>1&&(Math.abs(h+f)===1?h+=f:Math.abs(h-f)===1&&(h-=f)),u.dem&&c.dem&&(c.dem.backfillBorder(u.dem,h,p),c.neighboringTiles&&c.neighboringTiles[g]&&(c.neighboringTiles[g].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,i,o,c){for(let u in this._tiles){let h=this._tiles[u];if(c[u]||!h.hasData()||h.tileID.overscaledZ<=i||h.tileID.overscaledZ>o)continue;let p=h.tileID;for(;h&&h.tileID.overscaledZ>i+1;){let g=h.tileID.scaledTo(h.tileID.overscaledZ-1);h=this._tiles[g.key],h&&h.hasData()&&(p=g)}let f=p;for(;f.overscaledZ>i;)if(f=f.scaledTo(f.overscaledZ-1),t[f.key]){c[p.key]=p;break}}}findLoadedParent(t,i){if(t.key in this._loadedParentTiles){let o=this._loadedParentTiles[t.key];return o&&o.tileID.overscaledZ>=i?o:null}for(let o=t.overscaledZ-1;o>=i;o--){let c=t.scaledTo(o),u=this._getLoadedTile(c);if(u)return u}}_getLoadedTile(t){let i=this._tiles[t.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,i){i=i||this._source.tileSize;let o=Math.ceil(t.width/i)+1,c=Math.ceil(t.height/i)+1,u=Math.floor(o*c*5),h=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,u):u,p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._cache.setMaxSize(p)}handleWrapJump(t){let i=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,i){let o={};for(let c in this._tiles){let u=this._tiles[c];u.tileID=u.tileID.unwrapTo(u.tileID.wrap+i),o[u.tileID.key]=u}this._tiles=o;for(let c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(let c in this._tiles)this._setTileReloadTimer(+c,this._tiles[c])}}update(t,i,o,c){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!o)return;let u;if(this.updateCacheSize(t,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(f=>new Hi(f.canonical.z,f.wrap,f.canonical.z,f.canonical.x,f.canonical.y)):(u=t.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!o,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(f=>this._source.hasTile(f)))):u=[],u.length>0&&this.castsShadows&&c&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!DC(this._source.type)){let f=t.coveringZoomLevel({tileSize:i||this._source.tileSize,roundZoom:this._source.roundZoom&&!o}),g=Math.min(f,this._source.maxzoom),v=t.extendTileCoverForShadows(u,c,g);for(let y of v)this._shadowCasterTiles[y.key]=!0,u.push(y)}let h=this._updateRetainedTiles(u);if(DC(this._source.type)&&u.length!==0){let f={},g={},v=Object.keys(h);for(let b of v){let x=h[b],C=this._tiles[b];if(!C||C.fadeEndTime&&C.fadeEndTime<=ni.now())continue;let E=this.findLoadedParent(x,Math.max(x.overscaledZ-Ja.maxOverzooming,this._source.minzoom));E&&(this._addTile(E.tileID),f[E.tileID.key]=E.tileID),g[b]=x}let y=u[u.length-1].overscaledZ;for(let b in this._tiles){let x=this._tiles[b];if(h[b]||!x.hasData())continue;let C=x.tileID;for(;C.overscaledZ>y;){C=C.scaledTo(C.overscaledZ-1);let E=this._tiles[C.key];if(E&&E.hasData()&&g[C.key]){h[b]=x.tileID;break}}}for(let b in f)h[b]||(this._coveredTiles[b]=!0,h[b]=f[b])}for(let f in h)this._tiles[f].clearFadeHold();let p=function(f,g){let v=[];for(let y in f)y in g||v.push(y);return v}(this._tiles,h);for(let f of p){let g=this._tiles[f];g.hasSymbolBuckets&&!g.holdingForFade()?g.setHoldDuration(this.map._fadeDuration):g.hasSymbolBuckets&&!g.symbolFadeFinished()||this._removeTile(+f)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){let i={};if(t.length===0)return i;let o={},c=t.reduce((g,v)=>Math.min(g,v.overscaledZ),1/0),u=t[0].overscaledZ,h=Math.max(u-Ja.maxOverzooming,this._source.minzoom),p=Math.max(u+Ja.maxUnderzooming,this._source.minzoom),f={};for(let g of t){let v=this._addTile(g);i[g.key]=g,v.hasData()||c<this._source.maxzoom&&(f[g.key]=g)}this._retainLoadedChildren(f,c,p,i);for(let g of t){let v=this._tiles[g.key];if(v.hasData())continue;if(g.canonical.z>=this._source.maxzoom){let b=g.children(this._source.maxzoom)[0],x=this.getTile(b);if(x&&x.hasData()){i[b.key]=b;continue}}else{let b=g.children(this._source.maxzoom);if(i[b[0].key]&&i[b[1].key]&&i[b[2].key]&&i[b[3].key])continue}let y=v.wasRequested();for(let b=g.overscaledZ-1;b>=h;--b){let x=g.scaledTo(b);if(o[x.key]||(o[x.key]=!0,v=this.getTile(x),!v&&y&&(v=this._addTile(x)),v&&(i[x.key]=x,y=v.wasRequested(),v.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let t in this._tiles){let i=[],o,c=this._tiles[t].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){o=this._loadedParentTiles[c.key];break}i.push(c.key);let u=c.scaledTo(c.overscaledZ-1);if(o=this._getLoadedTile(u),o)break;c=u}for(let u of i)this._loadedParentTiles[u]=o}}_addTile(t){let i=this._tiles[t.key];if(i)return i.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),i;i=this._cache.getAndRemove(t),i&&(this._setTileReloadTimer(t.key,i),i.tileID=t,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,i)));let o=!!i;if(!o){let c=this.map?this.map.painter:null;i=new Xp(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,c,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,t.key,i.state))}return i?(i.uses++,this._tiles[t.key]=i,o||this._source.fire(new qt("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(t,i){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);let o=i.getExpiryTimeout();o&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},o))}_removeTile(t){let i=this._tiles[t];i&&(i.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,i,o){let c=[],u=this.transform;if(!u)return c;let h=u.projection.name==="globe",p=to(u.center.lng);for(let f in this._tiles){let g=this._tiles[f];if(o&&g.clearQueryDebugViz(),g.holdingForFade())continue;let v;if(h){let y=g.tileID.canonical;if(y.z===0){let b=[Math.abs(ve(p,...Kp(y,-1))-p),Math.abs(ve(p,...Kp(y,1))-p)];v=[0,2*b.indexOf(Math.min(...b))-1]}else{let b=[Math.abs(ve(p,...Kp(y,-1))-p),Math.abs(ve(p,...Kp(y,0))-p),Math.abs(ve(p,...Kp(y,1))-p)];v=[b.indexOf(Math.min(...b))-1]}}else v=[0];for(let y of v){let b=t.containsTile(g,u,i,y);b&&c.push(b)}}return c}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,i){let o=this.getRenderableIds(t,i).map(u=>this._tiles[u].tileID),c=this.transform.projection.name==="globe";for(let u of o)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped()),u.expandedProjMatrix=c?this.transform.calculateProjMatrix(u.toUnwrapped(),!1,!0):u.projMatrix;return o}sortCoordinatesByDistance(t){let i=t.slice(),o=this.transform._camera.position,c=this.transform._camera.forward(),u={};for(let h of i){let p=1/(1<<h.canonical.z);u[h.key]=((h.canonical.x+.5)*p+h.wrap-o[0])*c[0]+((h.canonical.y+.5)*p-o[1])*c[1]-o[2]*c[2]}return i.sort((h,p)=>u[h.key]-u[p.key]),i}hasTransition(){if(this._source.hasTransition())return!0;if(DC(this._source.type))for(let t in this._tiles){let i=this._tiles[t];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=ni.now())return!0}return!1}setFeatureState(t,i,o){this._state.updateState(t=t||"_geojsonTileLayer",i,o)}removeFeatureState(t,i,o){this._state.removeFeatureState(t=t||"_geojsonTileLayer",i,o)}getFeatureState(t,i){return this._state.getState(t=t||"_geojsonTileLayer",i)}setDependencies(t,i,o){let c=this._tiles[t];c&&c.setDependencies(i,o)}reloadTilesForDependencies(t,i){for(let o in this._tiles)this._tiles[o].hasDependency(t,i)&&this._reloadTile(+o,"reloading");this._cache.filter(o=>!o.hasDependency(t,i))}_preloadTiles(t,i){if(!this._sourceLoaded){let p=()=>{this._sourceLoaded&&(this._source.off("data",p),this._preloadTiles(t,i))};return void this._source.on("data",p)}let o=new Map,c=Array.isArray(t)?t:[t],u=this.map.painter.terrain,h=this.usedForTerrain&&u?u.getScaledDemTileSize():this._source.tileSize;for(let p of c){let f=p.coveringTiles({tileSize:h,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let g of f)o.set(g.key,g);this.usedForTerrain&&p.updateElevation(!1)}fs(Array.from(o.values()),(p,f)=>{let g=new Xp(p,this._source.tileSize*p.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(g,v=>{this._source.type==="raster-dem"&&g.dem&&this._backfillDEM(g),f(v,g)})},i)}}function SR(e,t){let i=Math.abs(2*e.wrap)-+(e.wrap<0),o=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||o-i||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function DC(e){return e==="raster"||e==="image"||e==="video"||e==="custom"}function Kp(e,t){let i=1<<e.z;return[e.x/i+t,(e.x+1)/i+t]}Ja.maxOverzooming=10,Ja.maxUnderzooming=3;let XH=Qi([{name:"a_pos_3f",components:3,type:"Float32"}]),KH=Qi([{name:"a_color_3f",components:3,type:"Float32"}]),QH=Qi([{name:"a_color_4f",components:4,type:"Float32"}]),JH=Qi([{name:"a_uv_2f",components:2,type:"Float32"}]),tG=Qi([{name:"a_normal_3f",components:3,type:"Float32"}]),eG=Qi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),iG=Qi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class TC{constructor(t=0,i=0,o=0,c=0){if(isNaN(t)||t<0||isNaN(i)||i<0||isNaN(o)||o<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=i,this.left=o,this.right=c}interpolate(t,i,o){return i.top!=null&&t.top!=null&&(this.top=$e(t.top,i.top,o)),i.bottom!=null&&t.bottom!=null&&(this.bottom=$e(t.bottom,i.bottom,o)),i.left!=null&&t.left!=null&&(this.left=$e(t.left,i.left,o)),i.right!=null&&t.right!=null&&(this.right=$e(t.right,i.right,o)),this}getCenter(t,i){let o=ve((this.left+t-this.right)/2,0,t),c=ve((this.top+i-this.bottom)/2,0,i);return new Q(o,c)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new TC(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ER(e,t){let i=gr(e,3);ft.fromQuat(e,t),Io(e,3,i)}function IC(e,t){let i=Bo.identity([]);return Bo.rotateZ(i,i,-t),Bo.rotateX(i,i,-e),i}function MR(e,t){let i=[e[0],e[1],0],o=[t[0],t[1],0];if(J.length(i)>=1e-15){let h=J.normalize([],i);J.scale(o,h,J.dot(o,h)),t[0]=o[0],t[1]=o[1]}let c=J.cross([],t,e);if(J.len(c)<1e-15)return null;let u=Math.atan2(-c[1],c[0]);return IC(Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2]),u)}class DR{constructor(t,i){this.position=t,this.orientation=i}get position(){return this._position}set position(t){if(t){let i=t instanceof Oi?t:new Oi(t[0],t[1],t[2]);this._renderWorldCopies&&(i.x=os(i.x,0,1)),this._position=i}else this._position=null}lookAtPoint(t,i){if(this.orientation=null,!this.position)return;let o=this.position,c=this._elevation?this._elevation.getAtPointOrZero(Oi.fromLngLat(t)):0,u=Oi.fromLngLat(t,c),h=[u.x-o.x,u.y-o.y,u.z-o.z];i||(i=[0,0,1]),i[2]=Math.abs(i[2]),this.orientation=MR(h,i)}setPitchBearing(t,i){this.orientation=IC(fe(t),fe(-i))}}class R0{constructor(t,i){this._transform=ft.identity([]),this.orientation=i,this.position=t}get mercatorPosition(){let t=this.position;return new Oi(t[0],t[1],t[2])}get position(){let t=gr(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var i;t&&Io(this._transform,3,[(i=t)[0],i[1],i[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||Bo.identity([]),t&&ER(this._transform,this._orientation)}getPitchBearing(){let t=this.forward(),i=this.right();return{bearing:Math.atan2(-i[1],i[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,i){this._orientation=IC(t,i),ER(this._transform,this._orientation)}forward(){let t=gr(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){let t=gr(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){let t=gr(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,i){let o=new Float64Array(16);return ft.invert(o,this.getWorldToCamera(t,i)),o}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,i,o){let c=this.position;J.scale(c,c,-t);let u=new Float64Array(16);return ft.fromScaling(u,[o,o,o]),ft.translate(u,u,c),u[10]*=i,u}getWorldToCamera(t,i){let o=new Float64Array(16),c=new Float64Array(4),u=this.position;return Bo.conjugate(c,this._orientation),J.scale(u,u,-t),ft.fromQuat(o,c),ft.translate(o,o,u),o[1]*=-1,o[5]*=-1,o[9]*=-1,o[13]*=-1,o[8]*=i,o[9]*=i,o[10]*=i,o[11]*=i,o}getCameraToClipPerspective(t,i,o,c){let u=new Float64Array(16);return ft.perspective(u,t,i,o,c),u}getCameraToClipOrthographic(t,i,o,c,u,h){let p=new Float64Array(16);return ft.ortho(p,t,i,o,c,u,h),p}getDistanceToElevation(t,i=!1){let o=t===0?0:_n(t,i?Wr(this.position[1]):this.position[1]),c=this.forward();return(o-this.position[2])/c[2]}clone(){return new R0([...this.position],[...this.orientation])}}function TR(e,t){let i=Qp(e.projection,e.zoom,e.width,e.height),o=function(u,h,p,f,g){let v=new Ye(p.lng-180*ld,p.lat),y=new Ye(p.lng+180*ld,p.lat),b=u.project(v.lng,v.lat),x=u.project(y.lng,y.lat),C=-Math.atan2(x.y-b.y,x.x-b.x),E=Oi.fromLngLat(p);E.y=ve(E.y,-1+ld,1-ld);let M=E.toLngLat(),D=u.project(M.lng,M.lat),I=Oi.fromLngLat(M);I.x+=ld;let P=I.toLngLat(),O=u.project(P.lng,P.lat),R=kR(O.x-D.x,O.y-D.y,C),F=Oi.fromLngLat(M);F.y+=ld;let z=F.toLngLat(),j=u.project(z.lng,z.lat),U=kR(j.x-D.x,j.y-D.y,C),G=Math.abs(R.x)/Math.abs(U.y),$=ft.identity([]);ft.rotateZ($,$,-C*(1-(g?0:f)));let Y=ft.identity([]);return ft.scale(Y,Y,[1,1-(1-G)*f,1]),Y[4]=-U.x/U.y*f,ft.rotateZ(Y,Y,C),ft.multiply(Y,$,Y),Y}(e.projection,0,e.center,i,t),c=IR(e);return ft.scale(o,o,[c,c,1]),o}function IR(e){let t=e.projection,i=Qp(e.projection,e.zoom,e.width,e.height),o=AR(t,e.center),c=AR(t,Ye.convert(t.center));return Math.pow(2,o*i+(1-i)*c)}function Qp(e,t,i,o,c=1/0){let u=e.range;if(!u)return 0;let h=Math.min(c,Math.max(i,o)),p=Math.log(h/1024)/Math.LN2;return Go(u[0]+p,u[1]+p,t)}let ld=1/4e4;function AR(e,t){let i=ve(t.lat,-Er,Er),o=new Ye(t.lng-180*ld,i),c=new Ye(t.lng+180*ld,i),u=e.project(o.lng,i),h=e.project(c.lng,i),p=Oi.fromLngLat(o),f=Oi.fromLngLat(c),g=h.x-u.x,v=h.y-u.y,y=f.x-p.x,b=f.y-p.y,x=Math.sqrt((y*y+b*b)/(g*g+v*v));return Math.log(x)/Math.LN2}function kR(e,t,i){let o=Math.cos(i),c=Math.sin(i);return{x:e*o-t*c,y:e*c+t*o}}function au(e,t,i){return t*(wt/(e.tileSize*Math.pow(2,i-e.tileID.overscaledZ)))}let Oh={unknown:0,flipRequired:1,flipNotRequired:2},nG=Math.tan(85*Math.PI/180);function P0(e,t,i,o,c,u,h){let p=ft.create();if(i)if(u.name==="globe"){let f=function(g,v){let{x:y,y:b}=g.point,x=ZA(y,b,g.worldSize/g._pixelsPerMercatorPixel,0,0);return ft.multiply(x,x,Uw(Ws(v)))}(c,t);ft.multiply(p,p,f)}else{let f=_h.invert([],h);p[0]=f[0],p[1]=f[1],p[4]=f[2],p[5]=f[3],o||ft.rotateZ(p,p,c.angle)}else ft.multiply(p,c.labelPlaneMatrix,e);return p}function RR(e,t,i,o,c,u,h){let p=P0(e,t,i,o,c,u,h);return u.name==="globe"&&i||(p[2]=p[6]=p[10]=p[14]=0),p}function PR(e,t,i,o,c,u,h){if(i){if(u.name==="globe"){let p=P0(e,t,i,o,c,u,h);return ft.invert(p,p),ft.multiply(p,e,p),p}{let p=ft.clone(e),f=ft.identity([]);return f[0]=h[0],f[1]=h[1],f[4]=h[2],f[5]=h[3],ft.multiply(p,p,f),o||ft.rotateZ(p,p,-c.angle),p}}return c.glCoordMatrix}function tl(e,t,i,o){let c=[e,t,i,1];i?un.transformMat4(c,c,o):VR(c,c,o);let u=c[3];return c[0]/=u,c[1]/=u,c[2]/=u,c}function OR(e,t){return Math.min(.5+e/t*.5,1.5)}function rG(e,t){let i=e[0]/e[3],o=e[1]/e[3];return i>=-t[0]&&i<=t[0]&&o>=-t[1]&&o<=t[1]}function oG(e,t,i,o,c,u,h,p,f,g){let v=i.transform,y=o?e.textSizeData:e.iconSizeData,b=Tl(y,i.transform.zoom),x=v.projection.name==="globe",C=[256/i.width*2+1,256/i.height*2+1],E=o?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;E.clear();let M=null;x&&(M=o?e.text.globeExtVertexArray:e.icon.globeExtVertexArray);let D=e.lineVertexArray,I=o?e.text.placedSymbolArray:e.icon.placedSymbolArray,P=i.transform.width/i.transform.height,O,R=!1;for(let F=0;F<I.length;F++){let z=I.get(F),{numGlyphs:j,writingMode:U}=z;if(U!==Kn.vertical||R||O===Kn.horizontal||(R=!0),O=U,(z.hidden||U===Kn.vertical)&&!R){Fh(j,E);continue}R=!1;let G=new Q(z.tileAnchorX,z.tileAnchorY),{x:$,y:Y,z:tt}=v.projection.projectTilePoint(G.x,G.y,g.canonical);if(f){let[Ct,St,Tt]=f(G);$+=Ct,Y+=St,tt+=Tt}let W=[$,Y,tt,1];if(un.transformMat4(W,W,t),!rG(W,C)){Fh(j,E);continue}let rt=W[3],st=OR(i.transform.getCameraToCenterDistance(v.projection),rt),pt=Vp(y,b,z),nt=h?pt/st:pt*st,ot=tl($,Y,tt,c);if(ot[3]<=0){Fh(j,E);continue}let _t={},bt=h?null:f,yt=zR(z,nt,!1,p,t,c,u,e.glyphOffsetArray,D,E,M,ot,G,_t,P,bt,v.projection,g,h);R=yt.useVertical,bt&&yt.needsFlipping&&(_t={}),(yt.notEnoughRoom||R||yt.needsFlipping&&zR(z,nt,!0,p,t,c,u,e.glyphOffsetArray,D,E,M,ot,G,_t,P,bt,v.projection,g,h).notEnoughRoom)&&Fh(j,E)}o?(e.text.dynamicLayoutVertexBuffer.updateData(E),M&&e.text.globeExtVertexBuffer&&e.text.globeExtVertexBuffer.updateData(M)):(e.icon.dynamicLayoutVertexBuffer.updateData(E),M&&e.icon.globeExtVertexBuffer&&e.icon.globeExtVertexBuffer.updateData(M))}function FR(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E){let{lineStartIndex:M,glyphStartIndex:D,segment:I}=p,P=D+p.numGlyphs,O=M+p.lineLength,R=t.getoffsetX(D),F=t.getoffsetX(P-1),z=O0(e*R,i,o,c,u,h,I,M,O,f,g,v,y,b,!0,x,C,E);if(!z)return null;let j=O0(e*F,i,o,c,u,h,I,M,O,f,g,v,y,b,!0,x,C,E);return j?{first:z,last:j}:null}function LR(e,t,i,o){return e===Kn.horizontal&&Math.abs(o)>Math.abs(i)?{useVertical:!0}:e===Kn.vertical?o>0?{needsFlipping:!0}:null:t!==Oh.unknown&&function(c,u){return c===0||Math.abs(u/c)>nG}(i,o)?t===Oh.flipRequired?{needsFlipping:!0}:null:i<0?{needsFlipping:!0}:null}function zR(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M,D,I){let P=t/24,O=e.lineOffsetX*P,R=e.lineOffsetY*P,{lineStartIndex:F,glyphStartIndex:z,numGlyphs:j,segment:U,writingMode:G,flipState:$}=e,Y=F+e.lineLength,tt=W=>{if(v){let[nt,ot,_t]=W.up,bt=g.length;M0(v,bt+0,nt,ot,_t),M0(v,bt+1,nt,ot,_t),M0(v,bt+2,nt,ot,_t),M0(v,bt+3,nt,ot,_t)}let[rt,st,pt]=W.point;Ph(g,rt,st,pt,W.angle)};if(j>1){let W=FR(P,p,O,R,i,y,b,e,f,u,x,E,!1,M,D,I);if(!W)return{notEnoughRoom:!0};if(o&&!i){let[rt,st,pt]=W.first.point,[nt,ot,_t]=W.last.point;[rt,st]=tl(rt,st,pt,h),[nt,ot]=tl(nt,ot,_t,h);let bt=LR(G,$,(nt-rt)*C,ot-st);if(e.flipState=bt&&bt.needsFlipping?Oh.flipRequired:Oh.flipNotRequired,bt)return bt}tt(W.first);for(let rt=z+1;rt<z+j-1;rt++){let st=O0(P*p.getoffsetX(rt),O,R,i,y,b,U,F,Y,f,u,x,E,!1,!1,M,D,I);if(!st)return g.length-=4*(rt-z),{notEnoughRoom:!0};tt(st)}tt(W.last)}else{if(o&&!i){let rt=tl(b.x,b.y,0,c),st=F+U+1,pt=new Q(f.getx(st),f.gety(st)),nt=tl(pt.x,pt.y,0,c),ot=nt[3]>0?nt:BR(b,pt,rt,1,c,void 0,M,D.canonical),_t=LR(G,$,(ot[0]-rt[0])*C,ot[1]-rt[1]);if(e.flipState=_t&&_t.needsFlipping?Oh.flipRequired:Oh.flipNotRequired,_t)return _t}let W=O0(P*p.getoffsetX(z),O,R,i,y,b,U,F,Y,f,u,x,E,!1,!1,M,D,I);if(!W)return{notEnoughRoom:!0};tt(W)}return{}}function NR(e,t,i,o,c){let{x:u,y:h,z:p}=o.projectTilePoint(e.x,e.y,t);if(!c)return tl(u,h,p,i);let[f,g,v]=c(e);return tl(u+f,h+g,p+v,i)}function BR(e,t,i,o,c,u,h,p){let f=NR(e.sub(t)._unit()._add(e),p,c,h,u);return J.sub(f,i,f),J.normalize(f,f),J.scaleAndAdd(f,i,f,o)}function O0(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M,D){let I=o?e-t:e+t,P=I>0?1:-1,O=0;o&&(P*=-1,O=Math.PI),P<0&&(O+=Math.PI);let R=p+h+(P>0?0:1)|0,F=c,z=c,j=0,U=0,G=Math.abs(I),$=[],Y=[],tt=u,W=tt,rt=()=>BR(W,tt,z,G-j+1,v,b,E,M.canonical);for(;j+U<=G;){if(R+=P,R<p||R>=f)return null;if(z=F,W=tt,$.push(z),x&&Y.push(W),tt=new Q(g.getx(R),g.gety(R)),F=y[R],!F){let St=NR(tt,M.canonical,v,E,b);F=St[3]>0?y[R]=St:rt()}j+=U,U=J.distance(z,F)}C&&b&&(y[R]&&(F=rt(),U=J.distance(z,F)),y[R]=F);let st=(G-j)/U,pt=tt.sub(W)._mult(st)._add(W),nt=J.sub([],F,z),ot=J.scaleAndAdd([],z,nt,st),_t=[0,0,1],bt=nt[0],yt=nt[1];if(D&&(_t=E.upVector(M.canonical,pt.x,pt.y),_t[0]!==0||_t[1]!==0||_t[2]!==1)){let St=[_t[2],0,-_t[0]],Tt=J.cross([],_t,St);J.normalize(St,St),J.normalize(Tt,Tt),bt=J.dot(nt,St),yt=J.dot(nt,Tt)}if(i){let St=J.cross([],_t,nt);J.normalize(St,St),J.scaleAndAdd(ot,ot,St,i*P)}let Ct=O+Math.atan2(yt,bt);return $.push(ot),x&&Y.push(pt),{point:ot,angle:Ct,path:$,tilePath:Y,up:_t}}function Fh(e,t){let i=t.length,o=i+4*e;t.resize(o),t.float32.fill(-1/0,4*i,4*o)}function VR(e,t,i){let o=t[0],c=t[1];return e[0]=i[0]*o+i[4]*c+i[12],e[1]=i[1]*o+i[5]*c+i[13],e[3]=i[3]*o+i[7]*c+i[15],e}let jR=(e,t,i)=>(1-i)*e+i*t,UR=e=>e*e*e*e*e;class AC{constructor(t,i,o,c,u,h,p){this.tileSize=512,this._renderWorldCopies=u===void 0||u,this._minZoom=t||0,this._maxZoom=i||22,this._minPitch=o??0,this._maxPitch=c??60,this.setProjection(h),this.setMaxBounds(p),this.width=0,this.height=0,this._center=new Ye(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new TC,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new R0,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let t=new AC(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,i=!1){let o=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||o)&&this._updateCameraOnTerrain(),(t||o)&&this._constrainCamera(i),this._calcMatrices()}getProjection(){return Ho(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};let i=this.projection?this.getProjection():void 0;this.projection=x0(this.projectionOptions);let o=!$t(i,this.getProjection());return o&&this._calcMatrices(),this.mercatorFromTransition=!1,o}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){let t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=x0({name:"mercator"});let i=t!==this.projection.name;return i&&this._calcMatrices(),i}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){let t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return _n(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new Q(this.width,this.height)}get bearing(){return os(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){let i=-t*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=_h.create(),_h.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){let i=ve(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=fe(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){let i=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==i&&(this._unmodified=!1,this._setZoom(i),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCameraOnTerrain(){let t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,i=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!i||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let o=this._elevation;i||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&o.exaggeration()&&this._centerAltitudeValidForExaggeration!==o.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*o.exaggeration(),this._centerAltitudeValidForExaggeration=o.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=o.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let t=this._elevation,i=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],o=this.horizonLineFromTop(),c=0,u=0;for(let h=0;h<i.length;h++){let p=new Q(i[h][0]*this.width,o+i[h][1]*(this.height-o)),f=t.pointCoordinate(p);if(!f)continue;let g=1/Math.hypot(f[0]-this._camera.position[0],f[1]-this._camera.position[1]);c+=f[3]*g,u+=g}return u===0?NaN:c/u}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let t=this._seaLevelZoom,i=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),o=this.pixelsPerMeter/this.worldSize*i,c=this._mercatorZfromZoom(t),u=this._mercatorZfromZoom(this._maxZoom),h=Math.max(c-o,u);this._setZoom(this._zoomFromMercatorZ(h))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){let i=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude())),o;o=t.z<this._camera.position[2]?[i.x,i.y,i.z]:[t.x,t.y,t.z];let c=J.length(J.sub([],this._camera.position,o));return ve(this._zoomFromMercatorZ(c),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let i=!1;if(t.orientation&&!Bo.exactEquals(t.orientation,this._camera.orientation)&&(i=this._setCameraOrientation(t.orientation)),t.position){let o=[t.position.x,t.position.y,t.position.z];J.exactEquals(o,this._camera.position)||(this._setCameraPosition(o),i=!0)}i&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let t=this._camera.position,i=new DR;return i.position=new Oi(t[0],t[1],t[2]),i.orientation=this._camera.orientation,i._elevation=this.elevation,i._renderWorldCopies=this.renderWorldCopies,i}_setCameraOrientation(t){if(!Bo.length(t))return!1;Bo.normalize(t,t);let i=J.transformQuat([],[0,0,-1],t),o=J.transformQuat([],[0,-1,0],t);if(o[2]<0)return!1;let c=MR(i,o);return!!c&&(this._camera.orientation=c,!0)}_setCameraPosition(t){let i=this.zoomScale(this.minZoom)*this.tileSize,o=this.zoomScale(this.maxZoom)*this.tileSize,c=this.cameraToCenterDistance;t[2]=ve(t[2],c/o,c/i),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,i,o){this._unmodified=!1,this._edgeInsets.interpolate(t,i,o),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){let i=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,i)}getVisibleUnwrappedCoordinates(t){let i=[new Lw(0,t)];if(this.renderWorldCopies){let o=this.pointCoordinate(new Q(0,0)),c=this.pointCoordinate(new Q(this.width,0)),u=this.pointCoordinate(new Q(this.width,this.height)),h=this.pointCoordinate(new Q(0,this.height)),p=Math.floor(Math.min(o.x,c.x,u.x,h.x)),f=Math.floor(Math.max(o.x,c.x,u.x,h.x)),g=1;for(let v=p-g;v<=f+g;v++)v!==0&&i.push(new Lw(v,t))}return i}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(t,i,o){let c=[];if(i[0]===0&&i[1]===0)return c;for(let h of t){let p=h.canonical,f=h.overscaledZ,g=h.wrap,v=1<<p.z,y=p.x+1<v,b=p.x>0,x=p.y+1<v,C=p.y>0,E=h.wrap-(b?0:1),M=h.wrap+(y?0:1),D=b?p.x-1:v-1,I=y?p.x+1:0;i[0]<0?(c.push(new Hi(f,M,p.z,I,p.y)),i[1]<0&&x&&(c.push(new Hi(f,g,p.z,p.x,p.y+1)),c.push(new Hi(f,M,p.z,I,p.y+1))),i[1]>0&&C&&(c.push(new Hi(f,g,p.z,p.x,p.y-1)),c.push(new Hi(f,M,p.z,I,p.y-1)))):i[0]>0?(c.push(new Hi(f,E,p.z,D,p.y)),i[1]<0&&x&&(c.push(new Hi(f,g,p.z,p.x,p.y+1)),c.push(new Hi(f,E,p.z,D,p.y+1))),i[1]>0&&C&&(c.push(new Hi(f,g,p.z,p.x,p.y-1)),c.push(new Hi(f,E,p.z,D,p.y-1)))):i[1]<0&&x?c.push(new Hi(f,g,p.z,p.x,p.y+1)):C&&c.push(new Hi(f,g,p.z,p.x,p.y-1))}if(c.length>1){c.sort((f,g)=>f.overscaledZ-g.overscaledZ||f.wrap-g.wrap||f.canonical.z-g.canonical.z||f.canonical.x-g.canonical.x||f.canonical.y-g.canonical.y);let h=0,p=0;for(;p<c.length;)c[p].equals(c[h])?++p:c[++h]=c[p++];c.length=h+1}let u=[];for(let h of c)c.some(p=>h.isChildOf(p))||u.push(h);return c=u.filter(h=>!t.some(p=>!!(h.overscaledZ<o&&p.isChildOf(h))||h.equals(p)||h.isChildOf(p))),c}coveringTiles(t){let i=this.coveringZoomLevel(t),o=i,c=this.elevation&&this.elevation.exaggeration(),u=c&&!t.isTerrainDEM,h=this.projection.name==="mercator";if(t.minzoom!==void 0&&i<t.minzoom)return[];t.maxzoom!==void 0&&i>t.maxzoom&&(i=t.maxzoom);let p=this.locationCoordinate(this.center),f=this.center.lat,g=1<<i,v=[g*p.x,g*p.y,0],y=this.projection.name==="globe",b=!y,x=hc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,b),C=y?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),E=g*_n(1,this.center.lat),M=this._camera.position[2]/_n(1,this.center.lat),D=[g*C.x,g*C.y,M*(b?1:E)],I=y||c,P=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),O=this.isLODDisabled(!0)?i:0,R;if(this._elevation&&t.isTerrainDEM)R=1e4*this._elevation.exaggeration();else if(this._elevation){let nt=this._elevation.getMinMaxForVisibleTiles();R=nt?nt.max:this._centerAltitude}else R=this._centerAltitude;let F=t.isTerrainDEM?-R:this._elevation?this._elevation.getMinElevationBelowMSL():0,z=this.projection.isReprojectedInTileSpace?IR(this):1,j=nt=>{let _t=new Oi(nt.x+25e-6,nt.y,nt.z),bt=new Oi(nt.x,nt.y+25e-6,nt.z),yt=nt.toLngLat(),Ct=_t.toLngLat(),St=bt.toLngLat(),Tt=this.locationCoordinate(yt),xt=this.locationCoordinate(Ct),Ft=this.locationCoordinate(St),Qt=Math.hypot(xt.x-Tt.x,xt.y-Tt.y),Jt=Math.hypot(Ft.x-Tt.x,Ft.y-Tt.y);return Math.sqrt(Qt*Jt)*z/25e-6},U=nt=>{let ot=R,_t=F;return{aabb:hR(this,g,0,0,0,nt,_t,ot,this.projection),zoom:0,x:0,y:0,minZ:_t,maxZ:ot,wrap:nt,fullyVisible:!1}},G=[],$=[],Y=i,tt=t.reparseOverscaled?o:i,W=nt=>nt*nt,rt=W((M-this._centerAltitude)*E),st=nt=>{if(!this._elevation||!nt.tileID||!h)return;let ot=this._elevation.getMinMaxForTile(nt.tileID),_t=nt.aabb;ot?(_t.min[2]=ot.min,_t.max[2]=ot.max,_t.center[2]=(_t.min[2]+_t.max[2])/2):(nt.shouldSplit=pt(nt),nt.shouldSplit||(_t.min[2]=_t.max[2]=_t.center[2]=this._centerAltitude))},pt=nt=>{if(nt.zoom<O)return!0;if(nt.zoom===Y)return!1;if(nt.shouldSplit!=null)return nt.shouldSplit;let ot=nt.aabb.distanceX(D),_t=nt.aabb.distanceY(D),bt=rt,yt=1;if(y){bt=W(nt.aabb.distanceZ(D));let Tt=Math.pow(2,nt.zoom),xt=Wr((nt.y+1)/Tt),Ft=Wr(nt.y/Tt),Qt=Math.min(Math.max(f,xt),Ft),Jt=Z_(Qt)/Z_(f);if(yt=Qt===f?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Jt/this._mercatorScaleRatio),this.zoom<=Op&&nt.zoom===Y-1&&Jt>=.9)return!0}else if(u&&(bt=W(nt.aabb.distanceZ(D)*E)),this.projection.isReprojectedInTileSpace&&o<=5){let Tt=Math.pow(2,nt.zoom),xt=j(new Oi((nt.x+.5)/Tt,(nt.y+.5)/Tt));yt=xt>.85?1:xt}let Ct=ot*ot+_t*_t+bt,St=W((1<<Y-nt.zoom)*P*yt*((Tt,xt)=>{if(xt*W(.707)<Tt)return 1;let Ft=Math.sqrt(xt/Tt);return Ft/(1.4144271570014144+(Math.pow(1.1,Ft-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(bt,rt),Ct));return Ct<St};if(this.renderWorldCopies)for(let nt=1;nt<=3;nt++)G.push(U(-nt)),G.push(U(nt));for(G.push(U(0));G.length>0;){let nt=G.pop(),ot=nt.x,_t=nt.y,bt=nt.fullyVisible,yt=()=>this.projection.name==="globe"&&(nt.y===0||nt.y===(1<<nt.zoom)-1);if(!bt){let Ct=I?nt.aabb.intersects(x):nt.aabb.intersectsFlat(x);if(Ct===0&&yt()){let St=new ua(nt.zoom,ot,_t);Ct=Vw(this,g,St,!0).intersects(x)}if(Ct===0)continue;bt=Ct===2}if(nt.zoom!==Y&&pt(nt))for(let Ct=0;Ct<4;Ct++){let St=(ot<<1)+Ct%2,Tt=(_t<<1)+(Ct>>1),xt={aabb:h?nt.aabb.quadrant(Ct):hR(this,g,nt.zoom+1,St,Tt,nt.wrap,nt.minZ,nt.maxZ,this.projection),zoom:nt.zoom+1,x:St,y:Tt,wrap:nt.wrap,fullyVisible:bt,tileID:void 0,shouldSplit:void 0,minZ:nt.minZ,maxZ:nt.maxZ};u&&!y&&(xt.tileID=new Hi(nt.zoom+1===Y?tt:nt.zoom+1,nt.wrap,nt.zoom+1,St,Tt),st(xt)),G.push(xt)}else{let Ct=nt.zoom===Y?tt:nt.zoom;if(t.minzoom&&t.minzoom>Ct)continue;if(!bt){let Ft=I?nt.aabb.intersectsPrecise(x):nt.aabb.intersectsPreciseFlat(x);if(Ft===0&&yt()){let Qt=new ua(nt.zoom,ot,_t);Ft=Vw(this,g,Qt,!0).intersectsPrecise(x)}if(Ft===0)continue}let St=v[0]-(.5+ot+(nt.wrap<<nt.zoom))*(1<<i-nt.zoom),Tt=v[1]-.5-_t,xt=nt.tileID?nt.tileID:new Hi(Ct,nt.wrap,nt.zoom,ot,_t);$.push({tileID:xt,distanceSq:St*St+Tt*Tt})}}if(this.fogCullDistSq){let nt=this.fogCullDistSq,ot=this.horizonLineFromTop();$=$.filter(_t=>{let bt=[0,0,0,1],yt=[wt,wt,0,1],Ct=this.calculateFogTileMatrix(_t.tileID.toUnwrapped());un.transformMat4(bt,bt,Ct),un.transformMat4(yt,yt,Ct);let St=function(Ft,Qt,Jt){let le=0;for(let me=0;me<2;++me)Ft[me]>0&&(le+=(Ft[me]-0)*(Ft[me]-0)),Qt[me]<0&&(le+=(0-Qt[me])*(0-Qt[me]));return le}(un.min([],bt,yt),un.max([],bt,yt));if(St===0)return!0;let Tt=!1,xt=this._elevation;if(xt&&St>nt&&ot!==0){let Ft=this.calculateProjMatrix(_t.tileID.toUnwrapped()),Qt;t.isTerrainDEM||(Qt=xt.getMinMaxForTile(_t.tileID)),Qt||(Qt={min:F,max:R});let Jt=function(me){let Ue=Math.round((me+45+360)%360/90)%4;return Pi[Ue]}(this.rotation),le=[Jt[0]*wt,Jt[1]*wt,Qt.max];J.transformMat4(le,le,Ft),Tt=(1-le[1])*this.height*.5<ot}return St<nt||Tt})}return $.sort((nt,ot)=>nt.distanceSq-ot.distanceSq).map(nt=>nt.tileID)}resize(t,i){this.width=t,this.height=i,this.pixelsToGLUnits=[2/t,-2/i],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){let i=ve(t.lat,-Er,Er),o=this.projection.project(t.lng,i);return new Q(o.x*this.worldSize,o.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/_n(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,i){let o,c,u=this.centerPoint;if(this.projection.name==="globe"){let p=this.worldSize;o=(i.x-u.x)/p,c=(i.y-u.y)/p}else{let p=this.pointCoordinate(i),f=this.pointCoordinate(u);o=p.x-f.x,c=p.y-f.y}let h=this.locationCoordinate(t);this.setLocation(new Oi(h.x-o,h.y-c))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,i){let o=i?_n(i,t.lat):void 0,c=this.projection.project(t.lng,t.lat);return new Oi(c.x,c.y,o)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,i){let o=i??this._centerAltitude,c=[t.x,t.y,0,1],u=[t.x,t.y,1,1];un.transformMat4(c,c,this.pixelMatrixInverse),un.transformMat4(u,u,this.pixelMatrixInverse);let h=u[3];un.scale(c,c,1/c[3]),un.scale(u,u,1/h);let p=c[2],f=u[2];return{p0:c,p1:u,t:p===f?0:(o-p)/(f-p)}}screenPointToMercatorRay(t){let i=[t.x,t.y,0,1],o=[t.x,t.y,1,1];return un.transformMat4(i,i,this.pixelMatrixInverse),un.transformMat4(o,o,this.pixelMatrixInverse),un.scale(i,i,1/i[3]),un.scale(o,o,1/o[3]),i[2]=_n(i[2],this._center.lat)*this.worldSize,o[2]=_n(o[2],this._center.lat)*this.worldSize,un.scale(i,i,1/this.worldSize),un.scale(o,o,1/this.worldSize),new G_([i[0],i[1],i[2]],J.normalize([],J.sub([],o,i)))}rayIntersectionCoordinate(t){let{p0:i,p1:o,t:c}=t,u=_n(i[2],this._center.lat),h=_n(o[2],this._center.lat);return new Oi($e(i[0],o[0],c)/this.worldSize,$e(i[1],o[1],c)/this.worldSize,$e(u,h,c))}pointCoordinate(t,i=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,i)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let i=this.projection.pointCoordinate3D(this,t.x,t.y);if(i)return new Oi(i[0],i[1],i[2]);let o=0,c=this.horizonLineFromTop();if(t.y>c)return this.pointCoordinate(t);let u=.02*c,h=t.clone();for(let p=0;p<10&&c-o>u;p++){h.y=$e(o,c,.66);let f=this.projection.pointCoordinate3D(this,h.x,h.y);f?(c=h.y,i=f):o=h.y}return i?new Oi(i[0],i[1],i[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=Xc)return!this.isPointAboveHorizon(t);let i=this.pointCoordinate(t);return i.y>=0&&i.y<=1}_coordinatePoint(t,i){let o=i&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,c=[t.x*this.worldSize,t.y*this.worldSize,o+t.toAltitude(),1];return un.transformMat4(c,c,this.pixelMatrix),c[3]>0?new Q(c[0]/c[3],c[1]/c[3]):new Q(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:t,left:i}=this._edgeInsets,o=this.height-this._edgeInsets.bottom,c=this.width-this._edgeInsets.right,u=this.pointLocation3D(new Q(i,t)),h=this.pointLocation3D(new Q(c,t)),p=this.pointLocation3D(new Q(c,o)),f=this.pointLocation3D(new Q(i,o)),g=Math.min(u.lng,h.lng,p.lng,f.lng),v=Math.max(u.lng,h.lng,p.lng,f.lng),y=Math.min(u.lat,h.lat,p.lat,f.lat),b=Math.max(u.lat,h.lat,p.lat,f.lat),x=Math.pow(2,-this.zoom)/16*270,C=this.projection.name==="globe"?1:4,E=(M,D,I,P,O)=>{let R=(M+I)/2,F=(D+P)/2,z=new Q(R,F),{lng:j,lat:U}=this.pointLocation3D(z),G=Math.max(0,g-j,y-U,j-v,U-b);g=Math.min(g,j),v=Math.max(v,j),y=Math.min(y,U),b=Math.max(b,U),(O<C||G>x)&&(E(M,D,R,F,O+1),E(R,F,I,P,O+1))};if(E(i,t,c,t,1),E(c,t,c,o,1),E(c,o,i,o,1),E(i,o,i,t,1),this.projection.name==="globe"){let[M,D]=function(I){let P=ft.identity(new Float64Array(16));ft.multiply(P,I.pixelMatrix,I.globeMatrix);let O=[0,ha,0],R=[0,ma,0];return J.transformMat4(O,O,P),J.transformMat4(R,R,P),[O[0]>0&&O[0]<=I.width&&O[1]>0&&O[1]<=I.height&&!Y_(I,new Ye(I.center.lat,90)),R[0]>0&&R[0]<=I.width&&R[1]>0&&R[1]<=I.height&&!Y_(I,new Ye(I.center.lat,-90))]}(this);M?(b=90,v=180,g=-180):D&&(y=-90,v=180,g=-180)}return new Cs(new Ye(g,y),new Ye(v,b))}_getBoundsRectangular(t,i){let{top:o,left:c}=this._edgeInsets,u=this.height-this._edgeInsets.bottom,h=this.width-this._edgeInsets.right,p=new Q(c,o),f=new Q(h,o),g=new Q(h,u),v=new Q(c,u),y=this.pointCoordinate(p,t),b=this.pointCoordinate(f,t),x=this.pointCoordinate(g,i),C=this.pointCoordinate(v,i),E=(M,D)=>(D.y-M.y)/(D.x-M.x);return y.y>1&&b.y>=0?y=new Oi((1-C.y)/E(C,y)+C.x,1):y.y<0&&b.y<=1&&(y=new Oi(-C.y/E(C,y)+C.x,0)),b.y>1&&y.y>=0?b=new Oi((1-x.y)/E(x,b)+x.x,1):b.y<0&&y.y<=1&&(b=new Oi(-x.y/E(x,b)+x.x,0)),new Cs().extend(this.coordinateLocation(y)).extend(this.coordinateLocation(b)).extend(this.coordinateLocation(C)).extend(this.coordinateLocation(x))}_getBoundsRectangularTerrain(){let t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);let i=t.visibleDemTiles.reduce((o,c)=>{if(c.dem){let u=c.dem.tree;o.min=Math.min(o.min,u.minimums[0]),o.max=Math.max(o.max,u.maximums[0])}return o},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(i.min*t.exaggeration(),i.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){let i=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,o=this.height/2-i*(1-this._horizonShift);return t?Math.max(0,o):o}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-Er,this.maxLat=Er,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=to(this.minLng)*this.tileSize,this.worldMaxX=to(this.maxLng)*this.tileSize,this.worldMinY=lo(this.maxLat)*this.tileSize,this.worldMaxY=lo(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,i){return this.projection.createTileMatrix(this,i,t)}calculateDistanceTileData(t){let i=t.key,o=this._distanceTileDataCache;if(o[i])return o[i];let c=t.canonical,u=1/this.height,h=this.cameraWorldSize,p=h/this.zoomScale(c.z),f=(c.x+Math.pow(2,c.z)*t.wrap)*p,g=c.y*p,v=this.point;v.x*=h/this.worldSize,v.y*=h/this.worldSize;let y=this.angle,b=Math.sin(-y),x=-Math.cos(-y);return o[i]={bearing:[b,x],center:[(v.x-f)*u,(v.y-g)*u],scale:p/wt*u},o[i]}calculateFogTileMatrix(t){let i=t.key,o=this._fogTileMatrixCache;if(o[i])return o[i];let c=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return ft.multiply(c,this.worldToFogMatrix,c),o[i]=new Float32Array(c),o[i]}calculateProjMatrix(t,i=!1,o=!1){let c=t.key,u;if(u=o?this._expandedProjMatrixCache:i?this._alignedProjMatrixCache:this._projMatrixCache,u[c])return u[c];let h=this.calculatePosMatrix(t,this.worldSize),p;return p=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:o?this.expandedFarZProjMatrix:i?this.alignedProjMatrix:this.projMatrix,ft.multiply(h,p,h),u[c]=new Float32Array(h),u[c]}calculatePixelsToTileUnitsMatrix(t){let i=t.tileID.key,o=this._pixelsToTileUnitsCache;if(o[i])return o[i];let c=function(u,h){let{scale:p}=u.tileTransform,f=p*wt/(u.tileSize*Math.pow(2,h.zoom-u.tileID.overscaledZ+u.tileID.canonical.z));return _h.scale(new Float32Array(4),h.inverseAdjustmentMatrix,[f,f])}(t,this);return o[i]=c,o[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let t=1/this.worldSize,i=ft.fromScaling([],[t,t,t]);return ft.multiply(i,i,this.globeMatrix),i}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let t=this._elevation;this._updateCameraState();let i=_n(1,this._center.lat)*this.worldSize,o=this._computeCameraPosition(i),c=this._camera.forward(),u=_n(1,this._center.lat);o[2]/=u,c[2]/=u,J.normalize(c,c);let h=t.raycast(o,c,t.exaggeration());if(h){let p=J.scaleAndAdd([],o,c,h),f=new Oi(p[0],p[1],_n(p[2],Wr(p[1]))),g=(f.z+J.length([f.x-o[0],f.y-o[1],f.z-o[2]*u]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(g),this._centerAltitude=f.toAltitude(),this._center=this.coordinateLocation(f),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;let i=this._elevation,o=_n(1,this._center.lat)*this.worldSize,c=this._computeCameraPosition(o),u=i.getAtPointOrZero(new Oi(...c)),h=this.pixelsPerMeter/this.worldSize*u,p=this._minimumHeightOverTerrain(),f=c[2]-h;if(f<=p)if(f<0||t){let g=this.locationCoordinate(this._center,this._centerAltitude),v=[c[0],c[1],g.z-c[2]],y=J.length(v);v[2]-=(p-f)/this._pixelsPerMercatorPixel;let b=J.length(v);if(b===0)return;J.scale(v,v,y/b*this._pixelsPerMercatorPixel),this._camera.position=[c[0],c[1],g.z*this._pixelsPerMercatorPixel-v[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){let b=this.center;return b.lat=ve(b.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(b.lng=ve(b.lng,this.minLng,this.maxLng)),this.center=b,void(this._constraining=!1)}let i=this._unmodified,{x:o,y:c}=this.point,u=0,h=o,p=c,f=this.width/2,g=this.height/2,v=this.worldMinY*this.scale,y=this.worldMaxY*this.scale;if(c-g<v&&(p=v+g),c+g>y&&(p=y-g),y-v<this.height&&(u=Math.max(u,this.height/(y-v)),p=(y+v)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let b=this.worldMinX*this.scale,x=this.worldMaxX*this.scale,C=this.worldSize/2-(b+x)/2;h=(o+C+this.worldSize)%this.worldSize-C,h-f<b&&(h=b+f),h+f>x&&(h=x-f),x-b<this.width&&(u=Math.max(u,this.width/(x-b)),h=(x+b)/2)}h===o&&p===c||(this.center=this.unproject(new Q(h,p))),u&&(this.zoom+=this.scaleZoom(u)),this._constrainCamera(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let t=this.centerOffset,i=this.projection.name==="globe",o=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=_n(1,this.center.lat)/_n(1,45));let c=Qp(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,c),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let u=this.projection.zAxisUnit==="meters"?o:1,h=this._camera.getWorldToCamera(this.worldSize,u),p,f=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(f[8]=2*-t.x/this.width,f[9]=2*t.y/this.height,this.isOrthographic){let U=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),G=U*this.aspect,$=-G,Y=-U;G-=t.x,$-=t.x,U+=t.y,Y+=t.y,p=this._camera.getCameraToClipOrthographic($,G,Y,U,this._nearZ,this._farZ),((tt,W,rt,st)=>{for(let pt=0;pt<16;pt++)tt[pt]=jR(W[pt],rt[pt],st)})(p,p,f,UR(this.pitch>=15?1:this.pitch/15))}else p=f;let g=ft.mul([],f,h),v=ft.mul([],p,h);if(this.projection.isReprojectedInTileSpace){let U=this.locationCoordinate(this.center),G=ft.identity([]);ft.translate(G,G,[U.x*this.worldSize,U.y*this.worldSize,0]),ft.multiply(G,G,TR(this)),ft.translate(G,G,[-U.x*this.worldSize,-U.y*this.worldSize,0]),ft.multiply(v,v,G),ft.multiply(g,g,G),this.inverseAdjustmentMatrix=function($){let Y=TR($,!0);return _h.invert([],[Y[0],Y[1],Y[4],Y[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=ft.scale([],v,[this.worldSize,this.worldSize,this.worldSize/u,1]),this.projMatrix=v,this.invProjMatrix=ft.invert(new Float64Array(16),this.projMatrix),i){let U=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);U[8]=2*-t.x/this.width,U[9]=2*t.y/this.height,this.expandedFarZProjMatrix=ft.mul([],U,h)}else this.expandedFarZProjMatrix=this.projMatrix;let y=ft.invert([],p);this.frustumCorners=zw.fromInvProjectionMatrix(y,this.horizonLineFromTop(),this.height),this.cameraFrustum=hc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!i);let b=new Float32Array(16);ft.identity(b),ft.scale(b,b,[1,-1,1]),ft.rotateX(b,b,this._pitch),ft.rotateZ(b,b,this.angle);let x=ft.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=ft.clone(x);let C=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;x[8]=2*-t.x/this.width,x[9]=2*(t.y+C)/this.height,this.skyboxMatrix=ft.multiply(b,x,b);let E=this.point,M=E.x,D=E.y,I=this.width%2/2,P=this.height%2/2,O=Math.cos(this.angle),R=Math.sin(this.angle),F=M-Math.round(M)+O*I+R*P,z=D-Math.round(D)+O*P+R*I,j=new Float64Array(v);if(ft.translate(j,j,[F>.5?F-1:F,z>.5?z-1:z,0]),this.alignedProjMatrix=j,v=ft.create(),ft.scale(v,v,[this.width/2,-this.height/2,1]),ft.translate(v,v,[1,-1,0]),this.labelPlaneMatrix=v,v=ft.create(),ft.scale(v,v,[1,-1,1]),ft.translate(v,v,[-1,-1,0]),ft.scale(v,v,[2/this.width,2/this.height,1]),this.glCoordMatrix=v,this.pixelMatrix=ft.multiply(new Float64Array(16),this.labelPlaneMatrix,g),this._calcFogMatrices(),this._distanceTileDataCache={},v=ft.invert(new Float64Array(16),this.pixelMatrix),!v)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=v,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=function(G){let{x:$,y:Y}=G.point,{lng:tt,lat:W}=G._center;return ZA($,Y,G.worldSize,tt,W)}(this);let U=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=J.transformMat4(U,U,h),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=v;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let t=this.cameraWorldSizeForFog,i=this.cameraPixelsPerMeter,o=this._camera.position,c=1/this.height/this._pixelsPerMercatorPixel,u=[t,t,i];J.scale(u,u,c),J.scale(o,o,-1),J.multiply(o,o,u);let h=ft.create();ft.translate(h,h,o),ft.scale(h,h,u),this.mercatorFogMatrix=h,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,i,c)}_computeCameraPosition(t){let i=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,o=this._camera.forward(),c=this.point,u=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*i-t/this.worldSize*this._centerAltitude;return[c.x/this.worldSize-o[0]*u,c.y/this.worldSize-o[1]*u,t/this.worldSize*this._centerAltitude-o[2]*u]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){let i=this._maxCameraBoundsDistance()*Math.cos(this._pitch),o=this._camera.position[2],c=t[2],u=1;this.projection.wrap&&(this.center=this.center.wrap()),c>0&&(u=Math.min((i-o)/c,1)),this._camera.position=J.scaleAndAdd([],this._camera.position,t,u),this._updateStateFromCamera()}_updateStateFromCamera(){let t=this._camera.position,i=this._camera.forward(),{pitch:o,bearing:c}=this._camera.getPitchBearing(),u=_n(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,h=this._mercatorZfromZoom(this._maxZoom)*Math.cos(fe(this._maxPitch)),p=Math.max((t[2]-u)/Math.cos(o),h),f=this._zoomFromMercatorZ(p);J.scaleAndAdd(t,t,i,p),this._pitch=ve(o,fe(this.minPitch),fe(this.maxPitch)),this.angle=os(c,-Math.PI,Math.PI),this._setZoom(ve(f,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new Oi(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){let t=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let i=0,o=Xc,c=0,u=1/0;for(;o-i>1e-6&&o>i;){let h=i+.5*(o-i),p=this.tileSize*Math.pow(2,h),f=this.getCameraToCenterDistance(this.projection,h,p),g=this.scaleZoom(f/(t*this.tileSize)),v=Math.abs(h-g);v<u&&(u=v,c=h),h<g?i=h:o=h}return c}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(lt("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,i){let o=Math.min(t.x,i.x),c=Math.max(t.x,i.x),u=Math.min(t.y,i.y),h=Math.max(t.y,i.y);if(u<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let p=[new Q(o,u),new Q(c,h),new Q(o,h),new Q(c,u)],f=this.renderWorldCopies?-3:0,g=this.renderWorldCopies?4:1;for(let v of p){let y=this.pointRayIntersection(v);if(y.t<0)return!0;let b=this.rayIntersectionCoordinate(y);if(b.x<f||b.y<0||b.x>g||b.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+ii(this.fovAboveCenter)>88||this.anyCornerOffEdge(new Q(0,0),new Q(this.width,this.height))}zoomDeltaToMovement(t,i){let o=J.length(J.sub([],this._camera.position,t)),c=this._zoomFromMercatorZ(o)+i;return o-this._mercatorZfromZoom(c)}getCameraPoint(){if(this.projection.name==="globe"){let t=function([i,o,c],u){let h=[i,o,c,1];un.transformMat4(h,h,u);let p=h[3]=Math.max(h[3],1e-6);return h[0]/=p,h[1]/=p,h[2]/=p,h}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new Q(t[0],t[1])}{let t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new Q(0,t))}}getCameraToCenterDistance(t,i=this.zoom,o=this.worldSize){let c=Qp(t,i,this.width,this.height,1024),u=t.pixelSpaceConversion(this.center.lat,o,c),h=.5/Math.tan(.5*this._fov)*this.height*u;return this.isOrthographic&&(h=jR(1,h,UR(this.pitch>=15?1:this.pitch/15))),h}getWorldToCameraMatrix(){let t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&ft.multiply(t,t,this.globeMatrix),t}getFrustum(t){return hc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}function HR(e,t,i){ft.identity(e),ft.rotateZ(e,e,fe(t[2])),ft.rotateX(e,e,fe(t[0])),ft.rotateY(e,e,fe(t[1])),ft.scale(e,e,i),ft.multiply(e,e,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function F0(e,t,i,o,c,u,h,p){let f=[i[0]-t[0],i[1]-t[1],0],g=[o[0]-t[0],o[1]-t[1],0];if(J.length(f)<1e-12||J.length(g)<1e-12)return Bo.identity(e);let v=J.cross([],f,g);J.normalize(v,v),J.subtract(g,o,t),f[2]=(u-c)*p,g[2]=(h-c)*p;let y=f;return J.cross(y,f,g),J.normalize(y,y),Bo.rotationTo(e,v,y)}function GR(e,t,i=!1){let o=wo(t.zoom),c=function(u,h,p){let f=h.worldSize,g=[u[12],u[13],u[14]],v=Wr(g[1]/f),y=Ss(g[0]/f),b=ft.identity([]),x=_n(1,v)*f,C=_n(1,0)*f*Jc(v,h.zoom),E=1/Hw(f),M=C*E;if(p){let O=Qp(h.projection,h.zoom,h.width,h.height,1024);M=E*h.projection.pixelSpaceConversion(h.center.lat,f,O)}let D=us(v,y);J.add(D,D,J.scale([],J.normalize([],D),x*M*g[2]));let I=function(O){let R=[O[0],O[1],O[2]],F=[0,1,0],z=J.cross([],F,R);return J.cross(F,R,z),J.squaredLength(F)===0&&(F=[0,1,0],J.cross(z,R,F)),J.normalize(z,z),J.normalize(F,F),J.normalize(R,R),[z[0],z[1],z[2],0,F[0],F[1],F[2],0,R[0],R[1],R[2],0,O[0],O[1],O[2],1]}(D);ft.scale(b,b,[M,M,M*x]),ft.translate(b,b,[-g[0],-g[1],-g[2]]);let P=ft.multiply([],h.globeMatrix,I);return ft.multiply(P,P,b),ft.multiply(P,P,u),P}(e,t,i);if(o>0){let u=function(h,p){let f=p.worldSize,g=_n(1,0)*f*Jc(p.center.lat,p.zoom)/Hw(f),v=_n(1,p.center.lat)*f,y=ft.identity([]);return ft.rotateY(y,y,fe(p.center.lng)),ft.rotateX(y,y,fe(p.center.lat)),ft.translate(y,y,[0,0,ts]),ft.scale(y,y,[g,g,g*v]),ft.translate(y,y,[p.point.x-.5*f,p.point.y-.5*f,0]),ft.multiply(y,y,h),ft.multiply(y,p.globeMatrix,y)}(e,t);return function(h,p,f){let g=(C,E,M)=>{let D=J.length(C),I=J.length(E),P=mc(C,E,M);return J.scale(P,P,1/J.length(P)*$e(D,I,M))},v=g([h[0],h[1],h[2]],[p[0],p[1],p[2]],f),y=g([h[4],h[5],h[6]],[p[4],p[5],p[6]],f),b=g([h[8],h[9],h[10]],[p[8],p[9],p[10]],f),x=mc([h[12],h[13],h[14]],[p[12],p[13],p[14]],f);return[v[0],v[1],v[2],0,y[0],y[1],y[2],0,b[0],b[1],b[2],0,x[0],x[1],x[2],1]}(c,u,o)}return c}let lu=64,sG=[1,1,1];class qR{constructor(t,i,o,c){this.id=t,this.position=i!=null?new Ye(i[0],i[1]):new Ye(0,0),this.orientation=o??[0,0,0],this.nodes=c,this.uploaded=!1,this.aabb=new Ln([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,i){if(ft.multiply(t.matrix,i,t.matrix),t.meshes)for(let o of t.meshes){let c=Ln.applyTransform(o.aabb,t.matrix);this.aabb.encapsulate(c)}if(t.children)for(let o of t.children)this._applyTransformations(o,t.matrix)}computeBoundsAndApplyParent(){let t=ft.identity([]);for(let i of this.nodes)this._applyTransformations(i,t)}_positionModelOnTerrain(t,i){let o=t.elevation;if(!o)return 0;let c=Ln.projectAabbCorners(this.aabb,this.matrix),u=_n(1,this.position.lat)*t.worldSize,h=function(D,I){let P=[0,0,1],O=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let R of O){let F=D[R.corners[0]],z=D[R.corners[1]],j=D[R.corners[2]],U=[z[0]-F[0],z[1]-F[1],I*(z[2]-F[2])],G=J.cross(U,U,[j[0]-F[0],j[1]-F[1],I*(j[2]-F[2])]);J.normalize(G,G),R.dotProductWithUp=J.dot(G,P)}return O.sort((R,F)=>R.dotProductWithUp-F.dotProductWithUp),O[0].corners}(c,u),p=c[h[0]],f=c[h[1]],g=c[h[2]],v=c[h[3]],y=o.getAtPointOrZero(new Oi(p[0]/t.worldSize,p[1]/t.worldSize),0),b=o.getAtPointOrZero(new Oi(f[0]/t.worldSize,f[1]/t.worldSize),0),x=o.getAtPointOrZero(new Oi(g[0]/t.worldSize,g[1]/t.worldSize),0),C=o.getAtPointOrZero(new Oi(v[0]/t.worldSize,v[1]/t.worldSize),0),E=(y+C)/2,M=(b+x)/2;return E>M?b<x?F0(i,f,v,p,b,C,y,u):F0(i,g,p,v,x,y,C,u):y<C?F0(i,p,f,g,y,b,x,u):F0(i,v,g,f,C,x,b,u),Math.max(E,M)}computeModelMatrix(t,i,o,c,u,h,p=!1){let f=t.transform,g=f.zoom,v=f.project(this.position),y=Jc(this.position.lat,g),b=1/y;ft.identity(this.matrix),ft.translate(this.matrix,this.matrix,[v.x+c[0]*b,v.y+c[1]*b,c[2]]);let x=1,C=1,E=f.worldSize;if(p){if(f.projection.name==="mercator"){let P=0;f.elevation&&(P=f.elevation.getAtPointOrZero(new Oi(v.x/E,v.y/E),0));let O=un.transformMat4([],[v.x,v.y,P,1],f.projMatrix)[3]/f.cameraToCenterDistance;x=O,C=O*Jc(f.center.lat,g)}else if(f.projection.name==="globe"){let P=GR(this.matrix,f),O=ft.multiply([],f.projMatrix,P),R=[0,0,0,1];un.transformMat4(R,R,O);let F=R[3]/f.cameraToCenterDistance,z=wo(g),j=f.projection.pixelsPerMeter(this.position.lat,E)*Jc(this.position.lat,g),U=f.projection.pixelsPerMeter(f.center.lat,E)*Jc(f.center.lat,g);x=F/$e(j,rk(f.center.lat),z),C=F*y/j,x*=U,C*=U}}else x=b;ft.scale(this.matrix,this.matrix,[x,x,C]);let M=[...this.matrix],D=this.orientation,I=[];if(HR(I,[D[0]+i[0],D[1]+i[1],D[2]+i[2]],o),ft.multiply(this.matrix,M,I),u&&f.elevation){let P=0,O=[];if(h&&f.elevation){P=this._positionModelOnTerrain(f,O);let R=ft.fromQuat([],O),F=ft.multiply([],R,I);ft.multiply(this.matrix,M,F)}else P=f.elevation.getAtPointOrZero(new Oi(v.x/E,v.y/E),0);P!==0&&(this.matrix[14]+=P)}}upload(t){if(!this.uploaded){for(let i of this.nodes)kC(i,t);for(let i of this.nodes)L0(i);this.uploaded=!0}}destroy(){for(let t of this.nodes)z0(t)}}function Jp(e,t,i=!1){e.uploaded||(e.gfxTexture=new ir(t,e.image,i?t.gl.R8:t.gl.RGBA,{useMipmap:e.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),e.uploaded=!0,e.image=null)}function aG(e,t,i){e.indexBuffer=t.createIndexBuffer(e.indexArray,!1,!0),e.vertexBuffer=t.createVertexBuffer(e.vertexArray,XH.members,!1,!0),e.normalArray&&(e.normalBuffer=t.createVertexBuffer(e.normalArray,tG.members,!1,!0)),e.texcoordArray&&(e.texcoordBuffer=t.createVertexBuffer(e.texcoordArray,JH.members,!1,!0)),e.colorArray&&(e.colorBuffer=t.createVertexBuffer(e.colorArray,(e.colorArray.bytesPerElement===12?KH:QH).members,!1,!0)),e.featureArray&&(e.pbrBuffer=t.createVertexBuffer(e.featureArray,iG.members,!0)),e.segments=dn.simpleSegment(0,0,e.vertexArray.length,e.indexArray.length);let o=e.material;o.pbrMetallicRoughness.baseColorTexture&&Jp(o.pbrMetallicRoughness.baseColorTexture,t),o.pbrMetallicRoughness.metallicRoughnessTexture&&Jp(o.pbrMetallicRoughness.metallicRoughnessTexture,t),o.normalTexture&&Jp(o.normalTexture,t),o.occlusionTexture&&Jp(o.occlusionTexture,t,i),o.emissionTexture&&Jp(o.emissionTexture,t)}function kC(e,t,i){if(e.meshes)for(let o of e.meshes)aG(o,t,i);if(e.children)for(let o of e.children)kC(o,t,i)}function L0(e){if(e.meshes)for(let t of e.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(e.children)for(let t of e.children)L0(t)}function z0(e){if(e.meshes)for(let i of e.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((t=i.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(e.children)for(let i of e.children)z0(i)}class WR{constructor(t,i){this.feature=t,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class $R{constructor(){this.instancedDataArray=new mw,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class YR{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=t.projection,this.index=t.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(t,i,o,c){this.tileToMeter=Lp(o);let u=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:h,id:p,index:f,sourceLayerIndex:g}of t){let v=td(h,u);if(!this.layers[0]._featureFilter.filter(new Jn(this.zoom),v,o))continue;let y={id:p,sourceLayerIndex:g,index:f,geometry:u?v.geometry:Dl(h,o,c),properties:h.properties,type:h.type,patterns:{}},b=this.addFeature(y,y.geometry,v);b&&i.featureIndex.insert(h,y.geometry,f,g,this.index,this.instancesPerModel[b].instancedDataArray.length)}this.lookup=null}update(t,i,o,c){for(let u in this.instancesPerModel){let h=this.instancesPerModel[u];for(let p in t)h.idToFeaturesIndex.hasOwnProperty(p)&&this.evaluate(h.features[h.idToFeaturesIndex[p]],t[p],h,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(let i in this.instancesPerModel){let o=this.instancesPerModel[i];for(let c of o.features){let u=this.layers[0],h=c.feature,p=this.canonical,f=u.paint.get("model-rotation").evaluate(h,{},p),g=u.paint.get("model-scale").evaluate(h,{},p),v=u.paint.get("model-translation").evaluate(h,{},p);J.exactEquals(c.rotation,f)&&J.exactEquals(c.scale,g)&&J.exactEquals(c.translation,v)||(this.evaluate(c,c.featureStates,o,!0),t=!0)}}return t}isEmpty(){for(let t in this.instancesPerModel)if(this.instancesPerModel[t].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(let i in this.instancesPerModel){let o=this.instancesPerModel[i];o.instancedDataArray.length<0||o.instancedDataArray.length===0||(o.instancedDataBuffer?o.instancedDataBuffer.updateData(o.instancedDataArray):o.instancedDataBuffer=t.createVertexBuffer(o.instancedDataArray,eG.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let t in this.instancesPerModel){let i=this.instancesPerModel[t];i.instancedDataArray.length!==0&&i.instancedDataBuffer&&i.instancedDataBuffer.destroy()}}addFeature(t,i,o){let c=this.layers[0],u=c.layout.get("model-id").evaluate(o,{},this.canonical);if(!u)return lt(`modelId is not evaluated for layer ${c.id} and it is not going to get rendered.`),u;this.instancesPerModel[u]||(this.instancesPerModel[u]=new $R);let h=this.instancesPerModel[u],p=h.instancedDataArray,f=new WR(o,p.length);for(let g of i)for(let v of g){if(v.x<0||v.x>=wt||v.y<0||v.y>=wt)continue;let y=(this.lookupDim-1)/wt,b=this.lookupDim*(v.y*y|0)+v.x*y|0;if(this.lookup){if(this.lookup[b]!==0)continue;this.lookup[b]=1}this.instanceCount++;let x=p.length;p.resize(x+1),h.instancesEvaluatedElevation.push(0),p.float32[16*x]=v.x,p.float32[16*x+1]=v.y}return f.instancedDataCount=h.instancedDataArray.length-f.instancedDataOffset,f.instancedDataCount>0&&(t.id&&(h.idToFeaturesIndex[t.id]=h.features.length),h.features.push(f),this.evaluate(f,{},h,!1)),u}evaluate(t,i,o,c){let u=this.layers[0],h=t.feature,p=this.canonical,f=t.rotation=u.paint.get("model-rotation").evaluate(h,i,p),g=t.scale=u.paint.get("model-scale").evaluate(h,i,p),v=t.translation=u.paint.get("model-translation").evaluate(h,i,p),y=u.paint.get("model-color").evaluate(h,i,p);y.a=u.paint.get("model-color-mix-intensity").evaluate(h,i,p);let b=[];this.maxVerticalOffset<v[2]&&(this.maxVerticalOffset=v[2]),this.maxScale=Math.max(Math.max(this.maxScale,g[0]),Math.max(g[1],g[2])),HR(b,f,g);let x=Math.round(100*y.a)+y.b/1.05;for(let C=0;C<t.instancedDataCount;++C){let E=t.instancedDataOffset+C,M=16*E,D=o.instancedDataArray.float32,I=0;c&&(I=D[M+6]-o.instancesEvaluatedElevation[E]);let P=0|D[M+1];D[M]=(0|D[M])+y.r/1.05,D[M+1]=P+y.g/1.05,D[M+2]=x,D[M+3]=1/(p.z>10?this.tileToMeter:Lp(p,P)),D[M+4]=v[0],D[M+5]=v[1],D[M+6]=v[2]+I,D[M+7]=b[0],D[M+8]=b[1],D[M+9]=b[2],D[M+10]=b[4],D[M+11]=b[5],D[M+12]=b[6],D[M+13]=b[8],D[M+14]=b[9],D[M+15]=b[10],o.instancesEvaluatedElevation[E]=v[2]}}}xe(YR,"ModelBucket",{omit:["layers"]}),xe($R,"PerModelAttributes"),xe(WR,"ModelFeature");let lG=new yr({visibility:new Ut(gt.layout_model.visibility),"model-id":new Re(gt.layout_model["model-id"])});var cG={paint:new yr({"model-opacity":new Ut(gt.paint_model["model-opacity"]),"model-rotation":new Re(gt.paint_model["model-rotation"]),"model-scale":new Re(gt.paint_model["model-scale"]),"model-translation":new Re(gt.paint_model["model-translation"]),"model-color":new Re(gt.paint_model["model-color"]),"model-color-mix-intensity":new Re(gt.paint_model["model-color-mix-intensity"]),"model-type":new Ut(gt.paint_model["model-type"]),"model-cast-shadows":new Ut(gt.paint_model["model-cast-shadows"]),"model-receive-shadows":new Ut(gt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Ut(gt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Re(gt.paint_model["model-emissive-strength"]),"model-roughness":new Re(gt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Re(gt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Ut(gt.paint_model["model-cutoff-fade-range"])}),layout:lG};let RC=new Float32Array(262144),cu=new Uint8Array(262144);function ZR(e){let t=0;if(e.meshes)for(let i of e.meshes)t=Math.max(t,i.aabb.max[2]);if(e.children)for(let i of e.children)t=Math.max(t,ZR(i));return t}let XR=["","wall","door","roof","window","lamp","logo"];class KR{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:t.id,geometry:[],properties:{height:ZR(t)}}}}class QR{constructor(t,i,o,c){this.nodes=t,this.id=i,this.modelTraits|=1,this.uploaded=!1,this.hasPattern=!1,o&&(this.modelTraits|=4),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=c,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;let i=this.getNodesInfo();for(let o of i){let c=o.node;this.uploaded?this.updatePbrBuffer(c):kC(c,t,!0)}for(let o of i)L0(o.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let i=!1;if(!t.meshes)return i;for(let o of t.meshes)o.pbrBuffer&&(o.pbrBuffer.updateData(o.featureArray),i=!0);return i}needsReEvaluation(t,i,o){let c=t.transform.projectionOptions,u=t.style.getBrightness(),h=this.brightness!==u;return!!(!this.uploaded||this.dirty||c.name!==this.projection.name||tf(o.paint.get("model-color").value,h)||tf(o.paint.get("model-color-mix-intensity").value,h)||tf(o.paint.get("model-roughness").value,h)||tf(o.paint.get("model-emissive-strength").value,h)||tf(o.paint.get("model-height-based-emissive-strength-multiplier").value,h))&&(this.projection=c,this.brightness=u,!0)}evaluateScale(t,i){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;let o=this.getNodesInfo(),c=this.id.canonical;for(let u of o){let h=u.feature;u.evaluatedScale=i.paint.get("model-scale").evaluate(h,{},c)}}evaluate(t){let i=this.getNodesInfo();for(let o of i){if(!o.node.meshes)continue;let c=o.feature,u=o.node.meshes&&o.node.meshes[0].featureData,h=o.evaluatedColor[2],p=o.evaluatedRMEA[2],f=this.id.canonical;if(o.hasTranslucentParts=!1,u){for(let g=0;g<XR.length;g++){let v=XR[g];v.length&&(c.properties.part=v);let y=t.paint.get("model-color").evaluate(c,{},f),b=t.paint.get("model-color-mix-intensity").evaluate(c,{},f);o.evaluatedColor[g]=[y.r,y.g,y.b,b],o.evaluatedRMEA[g][0]=t.paint.get("model-roughness").evaluate(c,{},f),o.evaluatedRMEA[g][2]=t.paint.get("model-emissive-strength").evaluate(c,{},f),o.evaluatedRMEA[g][3]=y.a,o.emissionHeightBasedParams[g]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(c,{},f),!o.hasTranslucentParts&&y.a<1&&(o.hasTranslucentParts=!0)}delete c.properties.part,uG(o,h!==o.evaluatedColor[2]||p!==o.evaluatedRMEA[2])}o.evaluatedScale=t.paint.get("model-scale").evaluate(c,{},f),this.updatePbrBuffer(o.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,i,o,c){let u=t.findDEMTileFor(o);if(u&&(u.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(u.dem&&u.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=u.tileID.overscaledZ;let h=Dh.create(t,o,u);if(!h)return;4&this.modelTraits&&this.updateDEM(t,h,o,c);for(let p of this.getNodesInfo()){let f=p.node;if(!f.footprint||!f.footprint.vertices||!f.footprint.vertices.length)continue;let g=f.footprint.vertices,v=h.getElevationAt(g[0].x,g[0].y,!0,!0);for(let y=1;y<g.length;y++)v=Math.min(v,h.getElevationAt(g[y].x,g[y].y,!0,!0));f.elevation=v}}this.terrainTile=u.tileID.canonical,this.terrainExaggeration=i}}updateDEM(t,i,o,c){let u=i._dem._modifiedForSources[c];if(u===void 0&&(i._dem._modifiedForSources[c]=[],u=i._dem._modifiedForSources[c]),u.includes(o.canonical))return;let h=i._dem.dim;u.push(o.canonical);let p=!1;for(let f of this.getNodesInfo()){let g=f.node;if(!g.footprint||!g.footprint.grid)continue;let v=g.footprint.grid,y=i.tileCoordToPixel(v.min.x,v.min.y),b=i.tileCoordToPixel(v.max.x,v.max.y),x=Math.min(Math.min(h-b.y,y.x),Math.min(y.y,h-b.x));if(x<0)continue;let C=ve(x,2,5),E=Math.max(0,y.x-C),M=Math.max(0,y.y-C),D=Math.min(b.x+C,h-1),I=Math.min(b.y+C,h-1);for(let F=M;F<=I;++F)for(let z=E;z<=D;++z)cu[F*h+z]=255;let P=0,O=0;for(let F=0;F<v.cellsY;++F)for(let z=0;z<v.cellsX;++z){if(!v.cells[F*v.cellsX+z])continue;let j=i.tileCoordToPixel(v.min.x+z/v.xScale,v.min.y+F/v.yScale),U=i.tileCoordToPixel(v.min.x+(z+1)/v.xScale,v.min.y+(F+1)/v.yScale);for(let G=j.y;G<=Math.min(U.y+1,h-1);++G)for(let $=j.x;$<=Math.min(U.x+1,h-1);++$)cu[G*h+$]===255&&(cu[G*h+$]=0,P+=i.getElevationAtPixel($,G),O++)}let R=P/O;E=Math.max(1,y.x-C),M=Math.max(1,y.y-C),D=Math.min(b.x+C,h-2),I=Math.min(b.y+C,h-2),p=!0;for(let F=M;F<=I;++F)for(let z=E;z<=D;++z)cu[F*h+z]===0&&(RC[F*h+z]=i._dem.set(z,F,R));for(let F=1;F<C;++F){E=Math.max(1,y.x-F),M=Math.max(1,y.y-F),D=Math.min(b.x+F,h-2),I=Math.min(b.y+F,h-2);for(let z=M;z<=I;++z)for(let j=E;j<=D;++j){let U=z*h+j;if(cu[U]===255){let G=0,$=0,Y=-1,tt=-1;for(let W=-1;W<=1;++W)for(let rt=-1;rt<=1;++rt){let st=(z+W)*h+j+rt;if(cu[st]>=F)continue;let pt=RC[st],nt=Math.abs(pt);nt>$&&(G=pt,$=nt,Y=rt,tt=W)}if($>.1){let W=1-(F+.5*Math.abs(Y*tt))/C,rt=i._dem.get(j,z)+G*W,st=i._dem.get(j+Y,z+tt),pt=i._dem.get(j-Y,z-tt,!0);(rt-st)*(rt-pt)>0&&(rt=(st+pt)/2),RC[U]=i._dem.set(j,z,rt),cu[U]=F}}}}}p&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=ni.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(let t of this.nodes)this.nodesInfo.push(new KR(t));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(let t of this.nodes)z0(t);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();let t=this.getNodesInfo();for(let i of t)L0(i.node),z0(i.node)}isEmpty(){return!this.nodes.length}updateReplacement(t,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;let o=i.getReplacementRegionsForTile(t.toUnwrapped()),c=this.getNodesInfo();for(let u=0;u<this.nodesInfo.length;u++){let h=c[u].node;c[u].hiddenByReplacement=!!h.footprint&&!o.find(p=>p.footprint===h.footprint)}}getHeightAtTileCoord(t,i){let o=this.getNodesInfo(),c=[];for(let u=0;u<this.nodesInfo.length;u++){let h=o[u],p=h.node.meshes[0];if(t<p.aabb.min[0]||i<p.aabb.min[1]||t>p.aabb.max[0]||i>p.aabb.max[1])continue;let f=(t-p.aabb.min[0])/(p.aabb.max[0]-p.aabb.min[0])*lu|0,g=Math.min(63,(i-p.aabb.min[1])/(p.aabb.max[1]-p.aabb.min[1])*lu|0)*lu+Math.min(63,f);if(!(p.heightmap[g]<0&&h.node.footprint))return h.hiddenByReplacement?void 0:{height:p.heightmap[g],maxHeight:h.feature.properties.height,hidden:!1,verticalScale:h.evaluatedScale[2]};if(h.node.footprint.grid.query(new Q(t,i),new Q(t,i),c),c.length>0)return{height:void 0,maxHeight:h.feature.properties.height,hidden:h.hiddenByReplacement,verticalScale:h.evaluatedScale[2]}}}}function tf(e,t){return!e.isLightConstant&&t}function dG(e,t,i,o,c,u,h,p){let f=(61440&t|(61440&t)>>4)>>8,g=(3840&t|(3840&t)>>4)>>4,v=240&t|(240&t)>>4;i[3]>0&&(f=$e(f,255*i[0],i[3]),g=$e(g,255*i[1],i[3]),v=$e(v,255*i[2],i[3]));let y=f<<8|g,b=v<<8|Math.floor(255*o[3]),x=function(F){let z=ve(F,0,2);return Math.min(Math.round(.5*z*255),255)}(o[2])<<8|15*o[0]<<4|15*o[1],C=ve(c[0],0,1),E=ve(c[1],0,1),M=ve(c[2],0,1),D=ve(c[3],0,1),I,P,O,R;if(C!==E&&h!==u&&E!==C){let F=h-u;P=1/(F*(E-C)),O=-(u+F*C)/(F*(E-C));let z=ve(c[4],-1,1);R=Math.pow(10,z),I=255*M<<8|255*D}else I=65535,P=0,O=1,R=1;if(e.emplaceBack(y,b,x,I,P,O,R),p){let F=p.length;p.clear();for(let z=0;z<F;z++)p.emplaceBack(y,b,x,I,P,O,R)}}function uG(e,t){let i=e.node,o=0;for(let c of i.meshes){if(i.lights&&i.lightMeshIndex===o||!c.featureData)continue;c.featureArray=new z_,c.featureArray.reserve(c.featureData.length);let u=t;for(let h of c.featureData){let p,f=65535&h,g=(15&f)<8?15&f:0,v=h>>16&65535,y=e.evaluatedRMEA[g],b=e.evaluatedColor[g],x=e.emissionHeightBasedParams[g];if(u&&g===2&&i.lights&&(p=new z_,p.resize(10*i.lights.length)),dG(c.featureArray,v,b,y,x,c.aabb.min[2],c.aabb.max[2],p),p&&u){u=!1;let C=i.meshes[i.lightMeshIndex];C.featureArray=p,C.featureArray._trim()}}c.featureArray._trim(),o++}}xe(QR,"Tiled3dModelBucket",{omit:["layers"]}),xe(KR,"Tiled3dModelFeature");class hG{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){let i=eP(new Q(0,0),new Q(wt,wt),t),o=[];for(let c of this._activeRegions){if(c.hiddenByOverlap||!tP(i,c))continue;let u=mG(c.min,c.max,t);o.push({min:u.min,max:u.max,sourceId:this._sourceIds[c.priority],footprint:c.footprint,footprintTileId:c.tileId})}return o}setSources(t){this._setSources(t.map(i=>({getSourceId:()=>i.cache.id,getFootprints:()=>{let o=[];for(let c of i.cache.getVisibleCoordinates()){let u=i.cache.getTile(c).buckets[i.layer];if(u)for(let h of u.getNodesInfo()){let p=h.node;p.footprint&&o.push({footprint:p.footprint,id:c.toUnwrapped()})}}return o}})))}_addSource(t){let i=t.getFootprints();if(i.length!==0){for(let o of i){if(!o.footprint)continue;let c=eP(o.footprint.min,o.footprint.max,o.id);this._activeRegions.push({min:c.min,max:c.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:o.id,footprint:o.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((i,o)=>i.priority-o.priority||N0(i.min,o.min)||N0(i.max,o.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let i=0,o=0;for(;!t&&i!==this._activeRegions.length;){let c=this._activeRegions[i],u=this._prevRegions[o];t=c.priority!==u.priority||!JR(c,u),++i,++o}}if(t){++this._updateTime;let i=o=>{let c=this._activeRegions;if(o>=c.length)return o;let u=c[o].priority;for(;o<c.length&&c[o].priority===u;)++o;return o};if(this._sourceIds.length>1){let o=0,c=i(o);for(;o!==c;){let u=o,h=o;for(;u!==c;){let p=this._activeRegions[u];p.hiddenByOverlap=!1;for(let f=0;f<h;f++){let g=this._activeRegions[f];if(!g.hiddenByOverlap&&tP(p,g)&&(p.hiddenByOverlap=nP(p.footprint,p.tileId,g.footprint,g.tileId),p.hiddenByOverlap))break}++u}o=c,c=i(o)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let i=t.length-1;i>=0;i--)this._addSource(t[i]);this._computeReplacement()}}function N0(e,t){return e.x-t.x||e.y-t.y}function JR(e,t){return N0(e.min,t.min)===0&&N0(e.max,t.max)===0}function tP(e,t){return!(e.min.x>t.max.x||e.max.x<t.min.x||e.min.y>t.max.y||e.max.y<t.min.y)}function eP(e,t,i){let o=1/wt,c=1/(1<<i.canonical.z),u=(t.x*o+i.canonical.x)*c+i.wrap,h=(t.y*o+i.canonical.y)*c;return{min:new Q((e.x*o+i.canonical.x)*c+i.wrap,(e.y*o+i.canonical.y)*c),max:new Q(u,h)}}function mG(e,t,i){let o=1<<i.canonical.z,c=((t.x-i.wrap)*o-i.canonical.x)*wt,u=(t.y*o-i.canonical.y)*wt;return{min:new Q(((e.x-i.wrap)*o-i.canonical.x)*wt,(e.y*o-i.canonical.y)*wt),max:new Q(c,u)}}function iP(e,t,i,o,c,u,h){let p=e.indices,f=e.vertices,g=[];for(let v=o;v<o+c;v+=3){let y=t[i[v+0]+u],b=t[i[v+1]+u],x=t[i[v+2]+u],C=Math.min(y.x,b.x,x.x),E=Math.max(y.x,b.x,x.x),M=Math.min(y.y,b.y,x.y),D=Math.max(y.y,b.y,x.y);g.length=0,e.grid.query(new Q(C,M),new Q(E,D),g);for(let I=0;I<g.length;I++){let P=g[I];if(Qw(f[p[3*P+0]],f[p[3*P+1]],f[p[3*P+2]],y,b,x,h))return!0}}return!1}function nP(e,t,i,o){if(!e||!i)return!1;let c=e.vertices;if(!t.canonical.equals(o.canonical)||t.wrap!==o.wrap){if(i.vertices.length<e.vertices.length)return nP(i,o,e,t);let u=t.canonical,h=o.canonical,p=Math.pow(2,h.z-u.z);c=e.vertices.map(f=>new Q(f.x*u.x*wt*p-h.x*wt,f.y*u.y*wt*p-h.y*wt))}return iP(i,c,e.indices,0,e.indices.length,0,0)}let pG=a0.types,fG=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],gG=["fill-extrusion-flood-light-ground-radius"],_G=Math.pow(2,13),vG=Math.pow(2,15)-1,rP=new Q(0,1),kl=2147483648;function ef(e,t,i,o,c,u,h,p){e.emplaceBack((t<<1)+h,(i<<1)+u,(Math.floor(o*_G)<<1)+c,Math.round(p))}function B0(e,t,i,o,c,u){e.emplaceBack(t.x,t.y,(i.x<<1)+o,(i.y<<1)+c,u)}function nf(e,t,i){e.emplaceBack(t.x,t.y,t.z,i[0]*16384,i[1]*16384,i[2]*16384)}class oP{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class sP{constructor(){this.centroidXY=new Q(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Q(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Q(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Q(this.max.x-this.min.x,this.max.y-this.min.y)}}class aP{constructor(){this.acc=new Q(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,i){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=i.x,t.min.y=t.max.y=i.y)}appendEdge(t,i,o){this.accCount++,this.acc._add(i);let c=!!this.borders;i.x<t.min.x?(t.min.x=i.x,c=!0):i.x>t.max.x&&(t.max.x=i.x,c=!0),i.y<t.min.y?(t.min.y=i.y,c=!0):i.y>t.max.y&&(t.max.y=i.y,c=!0),((i.x===0||i.x===wt)&&i.x===o.x)!=((i.y===0||i.y===wt)&&i.y===o.y)&&this.processBorderOverlap(i,o),c&&this.checkBorderIntersection(i,o)}checkBorderIntersection(t,i){i.x<0!=t.x<0&&this.addBorderIntersection(0,$e(i.y,t.y,(0-i.x)/(t.x-i.x))),i.x>wt!=t.x>wt&&this.addBorderIntersection(1,$e(i.y,t.y,(wt-i.x)/(t.x-i.x))),i.y<0!=t.y<0&&this.addBorderIntersection(2,$e(i.x,t.x,(0-i.y)/(t.y-i.y))),i.y>wt!=t.y>wt&&this.addBorderIntersection(3,$e(i.x,t.x,(wt-i.y)/(t.y-i.y)))}addBorderIntersection(t,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let o=this.borders[t];i<o[0]&&(o[0]=i),i>o[1]&&(o[1]=i)}processBorderOverlap(t,i){if(t.x===i.x){if(t.y===i.y)return;let o=t.x===0?0:1;this.addBorderIntersection(o,i.y),this.addBorderIntersection(o,t.y)}else{let o=t.y===0?2:3;this.addBorderIntersection(o,i.x),this.addBorderIntersection(o,t.x)}}centroid(){return this.accCount===0?new Q(0,0):new Q(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((t,i)=>t+ +(i[0]!==Number.MAX_VALUE),0):0}}function lP(e,t){let i=e.add(t)._unit(),o=ve(e.x*i.x+e.y*i.y,-1,1);var c,u,h;return c=Math.acos(o),Math.min(4,Math.max(-4,Math.tan(c)))/4*vG*((u=e).x*(h=t).y-u.y*h.x<0?-1:1)}let yG=[e=>e.x<0,e=>e.x>wt,e=>e.y<0,e=>e.y>wt];function bG(e,t,i,o){let c=[4];if(o===0)return c;i._mult(o);let u=e.sub(i),h=t.sub(i),p=[e,t,u,h];for(let f=0;f<4;f++)for(let g of p)if(yG[f](g)){c.push(f);break}return c}class cP{constructor(t){this.vertexArray=new ew,this.indexArray=new qr,this.programConfigurations=new $c(t.layers,t.zoom,i=>gG.includes(i)),this._segments=new dn,this.hiddenByLandmarkVertexArray=new pw,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new dn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(t,i,o,c=!1){let u=t.length;if(u>2){let h=Math.max(0,this._segments.get().length-1),p=this._segments._prepareSegment(4*u,this.vertexArray.length,2*this._segmentToGroundQuads[h].length),f;h!==this._segments.get().length-1&&(h++,this._segmentToGroundQuads[h]=[],this._segmentToRegionTriCounts[h]=[0,0,0,0,0]);{let g=t[0],v=t[1];f=lP(g.sub(t[u-1])._perp()._unit(),v.sub(g)._perp()._unit())}for(let g=0;g<u;g++){let v=g===u-1?0:g+1,y=t[g],b=t[v],x=t[v===u-1?0:v+1],C=b.sub(y)._perp()._unit(),E=lP(C,x.sub(b)._perp()._unit()),M=f,D=E;if(PC(y,b,i)||c&&hP(y,i)&&hP(b,i)){f=E;continue}let I=p.vertexLength;B0(this.vertexArray,y,b,1,1,M),B0(this.vertexArray,y,b,1,0,M),B0(this.vertexArray,y,b,0,1,D),B0(this.vertexArray,y,b,0,0,D),p.vertexLength+=4;let P=bG(y,b,C,o);for(let O of P)this._segmentToGroundQuads[h].push({id:I,region:O}),this._segmentToRegionTriCounts[h][O]+=2,p.primitiveLength+=2;f=E}}}prepareBorderSegments(){if(!this.hasData())return;let t=this._segments.get(),i=t.length;for(let o=0;o<i;o++)this._segmentToGroundQuads[o].sort((c,u)=>c.region-u.region);for(let o=0;o<i;o++){let c=this._segmentToGroundQuads[o],u=t[o],h=this._segmentToRegionTriCounts[o];h.reduce((f,g)=>f+g,0);let p=0;for(let f=0;f<=4;f++){let g=h[f];if(g!==0){let v=this.regionSegments[f];v||(v=this.regionSegments[f]=new dn);let y={vertexOffset:u.vertexOffset,primitiveOffset:u.primitiveOffset+p,vertexLength:u.vertexLength,primitiveLength:g};v.get().push(y)}p+=g}for(let f=0;f<c.length;f++){let g=c[f].id;this.indexArray.emplaceBack(g,g+1,g+3),this.indexArray.emplaceBack(g,g+3,g+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,i,o,c,u,h){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,i,o,c,u,h)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,q6.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,i,o,c,u,h){this.hasData()&&this.programConfigurations.updatePaintArrays(t,i,o,c,u,h)}updateHiddenByLandmark(t){if(!this.hasData())return;let i=t.groundVertexCount+t.groundVertexArrayOffset;if(t.groundVertexCount===0)return;let o=t.flags&kl?1:0;for(let c=t.groundVertexArrayOffset;c<i;++c)this.hiddenByLandmarkVertexArray.emplace(c,o);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,$6.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){let i=this.regionSegments[t];i&&i.destroy()}}}}class rf{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new qr,this.footprintVertices=new xs,this.footprintSegments=[],this.layoutVertexArray=new Jd,this.centroidVertexArray=new v2,this.indexArray=new qr,this.programConfigurations=new $c(t.layers,t.zoom,i=>fG.includes(i)),this.segments=new dn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new cP(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(t,i,o,c){this.features=[],this.hasPattern=oC("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Lp(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:u,id:h,index:p,sourceLayerIndex:f}of t){let g=this.layers[0]._featureFilter.needGeometry,v=td(u,g);if(!this.layers[0]._featureFilter.filter(new Jn(this.zoom),v,o))continue;let y={id:h,sourceLayerIndex:f,index:p,geometry:g?v.geometry:Dl(u,o,c),properties:u.properties,type:u.type,patterns:{}},b=this.layoutVertexArray.length;this.hasPattern?this.features.push(sC("fill-extrusion",this.layers,y,this.zoom,i)):this.addFeature(y,y.geometry,p,o,{},i.availableImages,c,i.brightness),i.featureIndex.insert(u,y.geometry,p,f,this.index,b)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,i,o,c,u,h){for(let p of this.features){let{geometry:f}=p;this.addFeature(p,f,p.index,i,o,c,u,h)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(t,i,o,c,u){let h=Object.keys(t).length!==0;if(h&&!this.stateDependentLayers.length)return;let p=h?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(t,i,p,o,c,u),this.groundEffect.update(t,i,p,o,c,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Z6),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,Y6.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,W6.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,i,o,c,u,h,p,f){let g=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,v=[new Q(0,0),new Q(wt,wt)],y=p.projection,b=y.name==="globe",x=pG[t.type]==="Polygon",C=new aP;C.centroidDataIndex=this.centroidData.length;let E=new sP,M=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},c)<=0,D=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},c);E.height=D,E.vertexArrayOffset=this.layoutVertexArray.length,E.groundVertexArrayOffset=this.groundEffect.vertexArray.length,b&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new F_);let I=rC(i,500);for(let j=I.length-1;j>=0;j--){let U=I[j];(U.length===0||(P=U[0]).every(G=>G.x<=0)||P.every(G=>G.x>=wt)||P.every(G=>G.y<=0)||P.every(G=>G.y>=wt))&&I.splice(j,1)}var P;let O;if(b)O=gP(I,v,c);else{O=[];for(let j of I)O.push({polygon:j,bounds:v})}let R=x?this.edgeRadius:0,F=R>0&&this.zoom<17,z=(j,U)=>{if(j.length===0)return!1;let G=j[j.length-1];return U.x===G.x&&U.y===G.y};for(let{polygon:j,bounds:U}of O){let G=0,$=0;for(let rt of j)x&&!rt[0].equals(rt[rt.length-1])&&rt.push(rt[0]),$+=x?rt.length-1:rt.length;let Y=this.segments.prepareSegment((x?5:4)*$,this.layoutVertexArray,this.indexArray);E.footprintSegIdx<0&&(E.footprintSegIdx=this.footprintSegments.length),E.polygonSegIdx<0&&(E.polygonSegIdx=this.polygonSegments.length);let tt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},W=new oP;if(W.vertexOffset=this.footprintVertices.length,W.indexOffset=3*this.footprintIndices.length,W.ringIndices=[],x){let rt=[],st=[];G=Y.vertexLength;for(let nt=0;nt<j.length;nt++){let ot=j[nt];ot.length&&nt!==0&&st.push(rt.length/2);let _t=[],bt,yt;bt=ot[1].sub(ot[0])._perp()._unit(),W.ringIndices.push(ot.length-1);for(let Ct=1;Ct<ot.length;Ct++){let St=ot[Ct],Tt=ot[Ct===ot.length-1?1:Ct+1],xt=St.clone();if(R){yt=Tt.sub(St)._perp()._unit();let Ft=bt.add(yt)._unit(),Qt=R*Math.min(4,1/(bt.x*Ft.x+bt.y*Ft.y));xt.x+=Qt*Ft.x,xt.y+=Qt*Ft.y,xt.x=Math.round(xt.x),xt.y=Math.round(xt.y),bt=yt}!M||R!==0&&!F||z(_t,xt)||_t.push(xt),ef(this.layoutVertexArray,xt.x,xt.y,0,0,1,1,0),Y.vertexLength++,this.footprintVertices.emplaceBack(St.x,St.y),rt.push(St.x,St.y),b&&nf(this.layoutVertexExtArray,y.projectTilePoint(xt.x,xt.y,c),y.upVector(c,xt.x,xt.y))}M&&(R===0||F)&&(_t.length!==0&&z(_t,_t[0])&&_t.pop(),this.groundEffect.addData(_t,U,g))}let pt=r0(rt,st);for(let nt=0;nt<pt.length;nt+=3)this.footprintIndices.emplaceBack(W.vertexOffset+pt[nt+0],W.vertexOffset+pt[nt+1],W.vertexOffset+pt[nt+2]),this.indexArray.emplaceBack(G+pt[nt],G+pt[nt+2],G+pt[nt+1]),Y.primitiveLength++;W.indexCount+=pt.length,W.vertexCount+=this.footprintVertices.length-W.vertexOffset}for(let rt=0;rt<j.length;rt++){let st=j[rt];C.startRing(E,st[0]);let pt=st.length>4&&mP(st[st.length-2],st[0],st[1]),nt=R?xG(st[st.length-2],st[0],st[1],R):0,ot=[],_t,bt,yt;bt=st[1].sub(st[0])._perp()._unit();let Ct=!0;for(let St=1,Tt=0;St<st.length;St++){let xt=st[St-1],Ft=st[St],Qt=st[St===st.length-1?1:St+1];if(C.appendEdge(E,Ft,xt),PC(Ft,xt,U)){R&&(bt=Qt.sub(Ft)._perp()._unit(),Ct=!Ct);continue}let Jt=Ft.sub(xt)._perp(),le=Jt.x/(Math.abs(Jt.x)+Math.abs(Jt.y)),me=Jt.y>0?1:0,Ue=xt.dist(Ft);if(Tt+Ue>32768&&(Tt=0),R){yt=Qt.sub(Ft)._perp()._unit();let He=uP(xt,Ft,Qt,dP(bt,yt),R);isNaN(He)&&(He=0);let Ne=Ft.sub(xt)._unit();xt=xt.add(Ne.mult(nt))._round(),Ft=Ft.add(Ne.mult(-He))._round(),nt=He,bt=yt,M&&this.zoom>=17&&(z(ot,xt)||ot.push(xt),z(ot,Ft)||ot.push(Ft))}let Ie=Y.vertexLength,Bi=st.length>4&&mP(xt,Ft,Qt),Ci=pP(Tt,pt,Ct);if(ef(this.layoutVertexArray,xt.x,xt.y,le,me,0,0,Ci),ef(this.layoutVertexArray,xt.x,xt.y,le,me,0,1,Ci),Tt+=Ue,Ci=pP(Tt,Bi,!Ct),pt=Bi,ef(this.layoutVertexArray,Ft.x,Ft.y,le,me,0,0,Ci),ef(this.layoutVertexArray,Ft.x,Ft.y,le,me,0,1,Ci),Y.vertexLength+=4,this.indexArray.emplaceBack(Ie+0,Ie+1,Ie+2),this.indexArray.emplaceBack(Ie+1,Ie+3,Ie+2),Y.primitiveLength+=2,R){let He=G+(St===1?st.length-2:St-2),Ne=St===1?G:He+1;if(this.indexArray.emplaceBack(Ie+1,He,Ie+3),this.indexArray.emplaceBack(He,Ne,Ie+3),Y.primitiveLength+=2,_t===void 0&&(_t=Ie),!PC(Qt,st[St],U)){let ke=St===st.length-1?_t:Y.vertexLength;this.indexArray.emplaceBack(Ie+2,Ie+3,ke),this.indexArray.emplaceBack(Ie+3,ke+1,ke),this.indexArray.emplaceBack(Ie+3,Ne,ke+1),Y.primitiveLength+=3}Ct=!Ct}if(b){let He=this.layoutVertexExtArray,Ne=y.projectTilePoint(xt.x,xt.y,c),ke=y.projectTilePoint(Ft.x,Ft.y,c),Di=y.upVector(c,xt.x,xt.y),zi=y.upVector(c,Ft.x,Ft.y);nf(He,Ne,Di),nf(He,Ne,Di),nf(He,ke,zi),nf(He,ke,zi)}}x&&(G+=st.length-1),M&&R&&this.zoom>=17&&(ot.length!==0&&z(ot,ot[0])&&ot.pop(),this.groundEffect.addData(ot,U,g,R>0))}this.footprintSegments.push(W),tt.triangleCount=this.indexArray.length-tt.triangleArrayOffset,this.polygonSegments.push(tt),++E.footprintSegLen,++E.polygonSegLen}if(E.vertexCount=this.layoutVertexArray.length-E.vertexArrayOffset,E.groundVertexCount=this.groundEffect.vertexArray.length-E.groundVertexArrayOffset,E.vertexCount!==0){if(E.centroidXY=C.borders?rP:this.encodeCentroid(C,E),this.centroidData.push(E),C.borders){this.featuresOnBorder.push(C);let j=this.featuresOnBorder.length-1;for(let U=0;U<C.borders.length;U++)C.borders[U][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[U].push(j)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,u,h,c,f),this.groundEffect.addPaintPropertiesData(t,o,u,h,c,f),this.maxHeight=Math.max(this.maxHeight,D)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort((i,o)=>this.featuresOnBorder[i].borders[t][0]-this.featuresOnBorder[o].borders[t][0])}splitToSubtiles(){let t=[];for(let p=0;p<this.centroidData.length;p++){let f=this.centroidData[p],g=+(f.min.y+f.max.y>wt),v=2*g+(+(f.min.x+f.max.x>wt)^g);for(let y=0;y<f.polygonSegLen;y++){let b=f.polygonSegIdx+y;t.push({centroidIdx:p,subtile:v,polygonSegmentIdx:b,triangleSegmentIdx:this.polygonSegments[b].triangleSegIdx})}}let i=new qr;t.sort((p,f)=>p.triangleSegmentIdx===f.triangleSegmentIdx?p.subtile-f.subtile:p.triangleSegmentIdx-f.triangleSegmentIdx);let o=0,c=0,u=0;for(let p of t){if(p.triangleSegmentIdx!==o)break;u++}let h=t.length;for(;c!==t.length;){o=t[c].triangleSegmentIdx;let p=0,f=c,g=c;for(let v=f;v<u&&t[v].subtile===p;v++)g++;for(;f!==u;){let v=t[f];p=v.subtile;let y=this.centroidData[v.centroidIdx].min.clone(),b=this.centroidData[v.centroidIdx].max.clone(),x={vertexOffset:this.segments.segments[o].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[o].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let C=f;C<g;C++){let E=t[C],M=this.polygonSegments[E.polygonSegmentIdx],D=this.centroidData[E.centroidIdx].min,I=this.centroidData[E.centroidIdx].max,P=this.indexArray.uint16;for(let O=M.triangleArrayOffset;O<M.triangleArrayOffset+M.triangleCount;O++)i.emplaceBack(P[3*O],P[3*O+1],P[3*O+2]);x.primitiveLength+=M.triangleCount,y.x=Math.min(y.x,D.x),y.y=Math.min(y.y,D.y),b.x=Math.max(b.x,I.x),b.y=Math.max(b.y,I.y)}x.primitiveLength>0&&this.triangleSubSegments.push({segment:x,min:y,max:b}),f=g;for(let C=f;C<u&&t[C].subtile===t[f].subtile;C++)g++}c=u;for(let v=c;v<h&&t[v].triangleSegmentIdx===t[c].triangleSegmentIdx;v++)u++}i._trim(),this.indexArray=i}getVisibleSegments(t,i,o){let c=0,u=0,h=1<<t.canonical.z;if(i){let E=i.getMinMaxForTile(t);E&&(c=E.min,u=E.max)}u+=this.maxHeight;let p=t.toUnwrapped(),f,g=[p.canonical.x/h+p.wrap,p.canonical.y/h],v=[(p.canonical.x+1)/h+p.wrap,(p.canonical.y+1)/h],y=new dn,b=(E,M,D)=>[E[0]*(1-D[0])+M[0]*D[0],E[1]*(1-D[1])+M[1]*D[1]],x=[],C=[];for(let E of this.triangleSubSegments){x[0]=E.min.x/wt,x[1]=E.min.y/wt,C[0]=E.max.x/wt,C[1]=E.max.y/wt;let M=b(g,v,x),D=b(g,v,C);if(new Ln([M[0],M[1],c],[D[0],D[1],u]).intersectsPrecise(o)===0){f&&(y.segments.push(f),f=void 0);continue}let I=E.segment;f&&f.vertexOffset!==I.vertexOffset&&(y.segments.push(f),f=void 0),f?(f.vertexLength+=I.vertexLength,f.primitiveLength+=I.primitiveLength):f={vertexOffset:I.vertexOffset,primitiveLength:I.primitiveLength,vertexLength:I.vertexLength,primitiveOffset:I.primitiveOffset,sortKey:void 0,vaos:{}}}return f&&y.segments.push(f),y}encodeCentroid(t,i){let o=t.centroid(),c=i.span(),u=Math.min(7,Math.round(c.x*this.tileToMeter/10)),h=Math.min(7,Math.round(c.y*this.tileToMeter/10));return new Q(ve(o.x,1,wt-1)<<3|u,ve(o.y,1,wt-1)<<3|h)}showCentroid(t){let i=this.centroidData[t.centroidDataIndex];i.flags&=kl,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);let i=t.vertexArrayOffset,o=t.vertexCount+t.vertexArrayOffset,c=t.flags&kl?rP:t.centroidXY,u=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==c.y||u!==c.x){for(let h=i;h<o;++h)this.centroidVertexArray.emplace(h,c.x,c.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;let o=i.getReplacementRegionsForTile(t.toUnwrapped());if(function(u,h){if(u.length!==h.length)return!1;for(let p=0;p<u.length;p++)if(u[p].sourceId!==h[p].sourceId||!JR(u[p],h[p]))return!1;return!0}(this.activeReplacements,o))return;if(this.activeReplacements=o,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let u of this.centroidData)u.flags&=2147483647;let c=[];for(let u of this.activeReplacements){let h=Math.pow(2,u.footprintTileId.canonical.z-t.canonical.z);for(let p of this.centroidData)if(!(p.flags&kl||u.min.x>p.max.x||p.min.x>u.max.x||u.min.y>p.max.y||p.min.y>u.max.y))for(let f=0;f<p.footprintSegLen;f++){let g=this.footprintSegments[p.footprintSegIdx+f];if(c.length=0,wG(this.footprintVertices,g.vertexOffset,g.vertexCount,u.footprintTileId.canonical,t.canonical,c),iP(u.footprint,c,this.footprintIndices.uint16,g.indexOffset,g.indexCount,-g.vertexOffset,-h)){p.flags|=kl;break}}}for(let u of this.centroidData)this.writeCentroidToBuffer(u);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,i,o){let c=!1;for(let u=0;u<o.footprintSegLen;u++){let h=this.footprintSegments[o.footprintSegIdx+u],p=0;for(let f of h.ringIndices){for(let g=p,v=f+p-1;g<f+p;v=g++){let y=this.footprintVertices.int16[2*(g+h.vertexOffset)+0],b=this.footprintVertices.int16[2*(g+h.vertexOffset)+1],x=this.footprintVertices.int16[2*(v+h.vertexOffset)+1];b>i!=x>i&&t<(this.footprintVertices.int16[2*(v+h.vertexOffset)+0]-y)*(i-b)/(x-b)+y&&(c=!c)}p=f}}return c}getHeightAtTileCoord(t,i){let o=Number.NEGATIVE_INFINITY,c=!0,u=4*(t+wt)*wt+(i+wt);if(this.partLookup.hasOwnProperty(u)){let h=this.partLookup[u];return h?{height:h.height,hidden:!!(h.flags&kl)}:void 0}for(let h of this.centroidData)t>h.max.x||h.min.x>t||i>h.max.y||h.min.y>i||this.footprintContainsPoint(t,i,h)&&h&&h.height>o&&(o=h.height,this.partLookup[u]=h,c=!!(h.flags&kl));if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:c};this.partLookup[u]=void 0}}function dP(e,t){let i=e.add(t)._unit();return e.x*i.x+e.y*i.y}function xG(e,t,i,o){let c=t.sub(e)._perp()._unit(),u=i.sub(t)._perp()._unit();return uP(e,t,i,dP(c,u),o)}function uP(e,t,i,o,c){let u=Math.sqrt(1-o*o);return Math.min(e.dist(t)/3,t.dist(i)/3,c*u/o)}function PC(e,t,i){return e.x<i[0].x&&t.x<i[0].x||e.x>i[1].x&&t.x>i[1].x||e.y<i[0].y&&t.y<i[0].y||e.y>i[1].y&&t.y>i[1].y}function hP(e,t){return e.x<t[0].x||e.x>t[1].x||e.y<t[0].y||e.y>t[1].y}function mP(e,t,i){if(e.x<0||e.x>=wt||t.x<0||t.x>=wt||i.x<0||i.x>=wt)return!1;let o=i.sub(t),c=o.perp(),u=e.sub(t);return(o.x*u.x+o.y*u.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(u.x*u.x+u.y*u.y))>-.866&&c.x*u.x+c.y*u.y<0}function pP(e,t,i){let o=t?2|e:-3&e;return i?1|o:-2&o}function fP(){let e=Math.PI/32,t=Math.tan(e),i=bh;return i*Math.sqrt(1+2*t*t)-i}function gP(e,t,i){let o=1<<i.z,c=Ss(i.x/o),u=Ss((i.x+1)/o),h=Wr(i.y/o),p=Wr((i.y+1)/o);return function(f,g,v,y,b=0,x){let C=[];if(!f.length||!v||!y)return C;let E=(F,z)=>{for(let j of F)C.push({polygon:j,bounds:z})},M=Math.ceil(Math.log2(v)),D=Math.ceil(Math.log2(y)),I=M-D,P=[];for(let F=0;F<Math.abs(I);F++)P.push(I>0?0:1);for(let F=0;F<Math.min(M,D);F++)P.push(0),P.push(1);let O=f;if(O=l0(O,g[0].y-b,g[1].y+b,1),O=l0(O,g[0].x-b,g[1].x+b,0),!O.length)return C;let R=[];for(P.length?R.push({polygons:O,bounds:g,depth:0}):E(O,g);R.length;){let F=R.pop(),z=F.depth,j=P[z],U=F.bounds[0],G=F.bounds[1],$=j===0?U.x:U.y,Y=j===0?G.x:G.y,tt=x?x(j,$,Y):.5*($+Y),W=l0(F.polygons,$-b,tt+b,j),rt=l0(F.polygons,tt-b,Y+b,j);if(W.length){let st=[U,new Q(j===0?tt:G.x,j===1?tt:G.y)];P.length>z+1?R.push({polygons:W,bounds:st,depth:z+1}):E(W,st)}if(rt.length){let st=[new Q(j===0?tt:U.x,j===1?tt:U.y),G];P.length>z+1?R.push({polygons:rt,bounds:st,depth:z+1}):E(rt,st)}}return C}(e,t,Math.ceil((u-c)/11.25),Math.ceil((h-p)/11.25),1,(f,g,v)=>{if(f===0)return .5*(g+v);{let y=Wr((i.y+g/wt)/o);return(lo(.5*(Wr((i.y+v/wt)/o)+y))*o-i.y)*wt}})}function wG(e,t,i,o,c,u){let h=Math.pow(2,o.z-c.z);for(let p=0;p<i;p++){let f=e.int16[2*(p+t)+0],g=e.int16[2*(p+t)+1];f=(f+c.x*wt)*h-o.x*wt,g=(g+c.y*wt)*h-o.y*wt,u.push(new Q(f,g))}}xe(rf,"FillExtrusionBucket",{omit:["layers","features"]}),xe(sP,"PartData"),xe(oP,"FootprintSegment"),xe(aP,"BorderCentroidData"),xe(cP,"GroundEffect");let CG=new yr({visibility:new Ut(gt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Ut(gt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var SG={paint:new yr({"fill-extrusion-opacity":new Ut(gt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Re(gt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ut(gt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ut(gt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Re(gt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Re(gt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Re(gt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ut(gt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ut(gt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ut(gt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Ut(gt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Ut(gt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Ut(gt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Ut(gt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Ut(gt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Re(gt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Re(gt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Ut(gt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Ut(gt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Ut(gt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Ut(gt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Ut(gt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:CG};class Lh extends Q{constructor(t,i,o){super(t,i),this.z=o}}function of(e,t){return e.x*t.x+e.y*t.y}function _P(e,t){if(e.length===1){let i=0,o=t[i++],c;for(;!c||o.equals(c);)if(c=t[i++],!c)return 1/0;for(;i<t.length;i++){let u=t[i],h=e[0],p=c.sub(o),f=u.sub(o),g=h.sub(o),v=of(p,p),y=of(p,f),b=of(f,f),x=of(g,p),C=of(g,f),E=v*b-y*y,M=(b*x-y*C)/E,D=(v*C-y*x)/E,I=o.z*(1-M-D)+c.z*M+u.z*D;if(isFinite(I))return I}return 1/0}{let i=1/0;for(let o of t)i=Math.min(i,o.z);return i}}function vP(e,t,i,o,c,u,h,p){let f=h*c.getElevationAt(e,t,!0,!0),g=u[0]!==0,v=g?u[1]===0?h*(u[0]/7-450):h*function(y,b,x){let C=Math.floor(b[0]/8),E=Math.floor(b[1]/8),M=10*(b[0]-8*C),D=10*(b[1]-8*E),I=y.getElevationAt(C,E,!0,!0),P=y.getMeterToDEM(x),O=Math.floor(.5*(M*P-1)),R=Math.floor(.5*(D*P-1)),F=y.tileCoordToPixel(C,E),z=2*O+1,j=2*R+1,U=function(rt,st,pt,nt,ot){return[rt.getElevationAtPixel(st,pt,!0),rt.getElevationAtPixel(st+ot,pt,!0),rt.getElevationAtPixel(st,pt+ot,!0),rt.getElevationAtPixel(st+nt,pt+ot,!0)]}(y,F.x-O,F.y-R,z,j),G=Math.abs(U[0]-U[1]),$=Math.abs(U[2]-U[3]),Y=Math.abs(U[0]-U[2])+Math.abs(U[1]-U[3]),tt=Math.min(.25,.5*P*(G+$)/z),W=Math.min(.25,.5*P*Y/j);return I+Math.max(tt*M,W*D)}(c,u,p):f;return{base:f+(i===0)?-1:i,top:g?Math.max(v+o,f+i+2):f+o}}let EG=new yr({"line-cap":new Re(gt.layout_line["line-cap"]),"line-join":new Re(gt.layout_line["line-join"]),"line-miter-limit":new Ut(gt.layout_line["line-miter-limit"]),"line-round-limit":new Ut(gt.layout_line["line-round-limit"]),"line-sort-key":new Re(gt.layout_line["line-sort-key"]),visibility:new Ut(gt.layout_line.visibility)});var yP={paint:new yr({"line-opacity":new Re(gt.paint_line["line-opacity"]),"line-color":new Re(gt.paint_line["line-color"]),"line-translate":new Ut(gt.paint_line["line-translate"]),"line-translate-anchor":new Ut(gt.paint_line["line-translate-anchor"]),"line-width":new Re(gt.paint_line["line-width"]),"line-gap-width":new Re(gt.paint_line["line-gap-width"]),"line-offset":new Re(gt.paint_line["line-offset"]),"line-blur":new Re(gt.paint_line["line-blur"]),"line-dasharray":new Re(gt.paint_line["line-dasharray"]),"line-pattern":new Re(gt.paint_line["line-pattern"]),"line-gradient":new Mp(gt.paint_line["line-gradient"]),"line-trim-offset":new Ut(gt.paint_line["line-trim-offset"]),"line-emissive-strength":new Ut(gt.paint_line["line-emissive-strength"]),"line-border-width":new Re(gt.paint_line["line-border-width"]),"line-border-color":new Re(gt.paint_line["line-border-color"])}),layout:EG};let MG=(e,t,i,o,c,u,h)=>{let p=e.transform,f=p.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:xP(e,t,i,o),u_pixels_to_tile_units:f,u_device_pixel_ratio:u,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:c,u_texsize:CP(i)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:bP(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:h,u_emissive_strength:i.paint.get("line-emissive-strength")}},DG=(e,t,i,o,c)=>{let u=e.transform;return{u_matrix:xP(e,t,i,o),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:u.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:c,u_image:0,u_tile_units_to_pixels:bP(t,u),u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function bP(e,t){return 1/au(e,1,t.tileZoom)}function xP(e,t,i,o){return e.translatePosMatrix(o||t.tileID.projMatrix,t,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}let wP=e=>{let t=[];CP(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");let i=e.paint.get("line-trim-offset");return i[0]===0&&i[1]===0||t.push("RENDER_LINE_TRIM_OFFSET"),e.paint.get("line-border-width").constantOr(1)!==0&&t.push("RENDER_LINE_BORDER"),t};function CP(e){let t=e.paint.get("line-dasharray").value;return t.value||t.kind!=="constant"}let SP=new class extends Re{possiblyEvaluate(e,t){return t=new Jn(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,i,o){return t=ge({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,i,o)}}(yP.paint.properties["line-width"].specification);function EP(e,t){return t>0?t+2*e:e}SP.useIntegerZoom=!0;let TG=new yr({visibility:new Ut(gt.layout_background.visibility)});var IG={paint:new yr({"background-color":new Ut(gt.paint_background["background-color"]),"background-pattern":new Ut(gt.paint_background["background-pattern"]),"background-opacity":new Ut(gt.paint_background["background-opacity"]),"background-emissive-strength":new Ut(gt.paint_background["background-emissive-strength"])}),layout:TG};let AG=new yr({visibility:new Ut(gt.layout_raster.visibility)});var kG={paint:new yr({"raster-opacity":new Ut(gt.paint_raster["raster-opacity"]),"raster-color":new Mp(gt.paint_raster["raster-color"]),"raster-color-mix":new Ut(gt.paint_raster["raster-color-mix"]),"raster-color-range":new Ut(gt.paint_raster["raster-color-range"]),"raster-hue-rotate":new Ut(gt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ut(gt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ut(gt.paint_raster["raster-brightness-max"]),"raster-saturation":new Ut(gt.paint_raster["raster-saturation"]),"raster-contrast":new Ut(gt.paint_raster["raster-contrast"]),"raster-resampling":new Ut(gt.paint_raster["raster-resampling"]),"raster-fade-duration":new Ut(gt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Ut(gt.paint_raster["raster-emissive-strength"]),"raster-array-band":new Ut(gt.paint_raster["raster-array-band"]),"raster-elevation":new Ut(gt.paint_raster["raster-elevation"])}),layout:AG};function MP(e,t,i,o,c,u,h,p){let f=[e,i,c,t,o,u,1,1,1],g=[h,p,1],v=ds.adjoint([],f),[y,b,x]=J.transformMat3(g,g,ds.transpose(v,v));return ds.multiply(f,[y,0,0,0,b,0,0,0,x],f)}class fa extends Hr{constructor(t,i,o,c){super(),this.id=t,this.dispatcher=o,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(c),this.options=i,this._dirty=!1}load(t,i){if(this._loaded=i||!1,this.fire(new qt("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=mi(this.map._requestManager.transformRequest(this.url,Dt.Image),(o,c)=>{if(this._imageRequest=null,this._loaded=!0,o)this.fire(new Xe(o));else if(c){let{HTMLImageElement:u}=m;this.image=c instanceof u?ni.getImageData(c):c,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading()}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new I0(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new qt("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof I0||this.texture.destroy()}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=t[0][1],o=t[0][1];for(let u of t)u[1]>o&&(o=u[1]),u[1]<i&&(i=u[1]);let c=(o+i)/2;if(c>Er?this.onNorthPole=!0:c<-Er&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let u=t.map(Oi.fromLngLat);this.tileID=function(h){let p=1/0,f=1/0,g=-1/0,v=-1/0;for(let C of h)p=Math.min(p,C.x),f=Math.min(f,C.y),g=Math.max(g,C.x),v=Math.max(v,C.y);let y=Math.max(g-p,v-f),b=Math.max(0,Math.floor(-Math.log(y)/Math.LN2)),x=Math.pow(2,b);return new ua(b,Math.floor((p+g)/2*x),Math.floor((f+v)/2*x))}(u),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new qt("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(t){for(let f in this.tiles){let g=this.tiles[f];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture)}if(this._boundsArray)return;let i=su(this.tileID,this.map.transform.projection),[o,c,u,h]=this.coordinates.map(f=>{let g=i.projection.project(f[0],f[1]);return mR(i,g)._round()});this.perspectiveTransform=function(f,g,v,y,b,x,C,E,M,D){let I=MP(0,0,f,0,0,g,f,g),P=MP(v,y,b,x,C,E,M,D);return ds.multiply(P,ds.adjoint(I,I),P),[P[6]/P[8]*f/wt,P[7]/P[8]*g/wt]}(this.width,this.height,o.x,o.y,c.x,c.y,h.x,h.y,u.x,u.y);let p=this._boundsArray=new Jd;p.emplaceBack(o.x,o.y,0,0),p.emplaceBack(c.x,c.y,wt,0),p.emplaceBack(h.x,h.y,0,wt),p.emplaceBack(u.x,u.y,wt,wt),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=t.createVertexBuffer(p,wC.members),this.boundsSegments=dn.simpleSegment(0,0,4,2)}prepare(){let t=Object.keys(this.tiles).length!==0;if(this.tileID&&!t)return;let i=this.map.painter.context,o=i.gl;!this._dirty||this.texture instanceof I0||(this.texture?this.texture.update(this.image):(this.texture=new ir(i,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(i)}loadTile(t,i){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},i(null)):(t.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class RG extends Hs{constructor(t){super(t,{}),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(t){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}let PG=new yr({visibility:new Ut(gt.layout_sky.visibility)});var OG={paint:new yr({"sky-type":new Ut(gt.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ut(gt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ut(gt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ut(gt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ut(gt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Mp(gt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ut(gt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ut(gt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ut(gt.paint_sky["sky-opacity"])}),layout:PG};function OC(e,t,i){let o=[0,0,1],c=Bo.identity([]);return Bo.rotateY(c,c,i?-fe(e)+Math.PI:fe(e)),Bo.rotateX(c,c,-fe(t)),J.transformQuat(o,o,c),J.normalize(o,o)}var FG={paint:new yr({})};let LG={circle:class extends Hs{constructor(e,t){super(e,b6,t)}createBucket(e){return new Zw(e)}queryRadius(e){let t=e;return wh("circle-radius",this,t)+wh("circle-stroke-width",this,t)+Q_(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,i,o,c,u,h,p){let f=mk(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,e.pixelToTileUnitsFactor),g=this.paint.get("circle-radius").evaluate(t,i)+this.paint.get("circle-stroke-width").evaluate(t,i);return fk(e,o,u,h,p,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",f,g)}getProgramIds(){return["circle"]}getDefaultProgramParams(e,t){let i=pk(this);return{config:new iu(this,t),defines:i,overrideFog:!1}}},heatmap:class extends Hs{createBucket(e){return new _k(e)}constructor(e,t){super(e,D6,t),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=J_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return wh("heatmap-radius",this,e)}queryIntersectsFeature(e,t,i,o,c,u,h,p){let f=this.paint.get("heatmap-radius").evaluate(t,i);return fk(e,o,u,h,p,!0,!0,new Q(0,0),f)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(e,t){return e==="heatmap"?{config:new iu(this,t),overrideFog:!1}:{}}},hillshade:class extends Hs{constructor(e,t){super(e,I6,t)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},fill:class extends Hs{constructor(e,t){super(e,H6,t)}getProgramIds(){let e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),i=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(e,t){return{config:new iu(this,t),overrideFog:!1}}recalculate(e,t){super.recalculate(e,t);let i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new o0(e)}queryRadius(){return Q_(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,i,o,c,u){return!e.queryGeometry.isAboveHorizon&&lk(hk(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,e.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}},"fill-extrusion":class extends Hs{constructor(e,t){super(e,SG,t),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new rf(e)}queryRadius(){return Q_(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(e,t,i,o,c,u,h,p,f){let g=mk(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,e.pixelToTileUnitsFactor),v=this.paint.get("fill-extrusion-height").evaluate(t,i),y=this.paint.get("fill-extrusion-base").evaluate(t,i),b=[0,0],x=p&&u.elevation,C=u.elevation?u.elevation.exaggeration():1,E=e.tile.getBucket(this);if(x&&E instanceof rf){let O=E.centroidVertexArray,R=f+1;R<O.length&&(b[0]=O.geta_centroid_pos0(R),b[1]=O.geta_centroid_pos1(R))}if(b[0]===0&&b[1]===1)return!1;u.projection.name==="globe"&&(o=gP([o],[new Q(0,0),new Q(wt,wt)],e.tileID.canonical).map(O=>O.polygon).flat());let M=x?p:null,[D,I]=function(O,R,F,z,j,U,G,$,Y,tt,W){return O.projection.name==="globe"?function(rt,st,pt,nt,ot,_t,bt,yt,Ct,St,Tt){let xt=[],Ft=[],Qt=rt.projection.upVectorScale(Tt,rt.center.lat,rt.worldSize).metersToTile,Jt=[0,0,0,1],le=[0,0,0,1],me=(Ie,Bi,Ci,He)=>{Ie[0]=Bi,Ie[1]=Ci,Ie[2]=He,Ie[3]=1},Ue=fP();pt>0&&(pt+=Ue),nt+=Ue;for(let Ie of st){let Bi=[],Ci=[];for(let He of Ie){let Ne=He.x+ot.x,ke=He.y+ot.y,Di=rt.projection.projectTilePoint(Ne,ke,Tt),zi=rt.projection.upVector(Tt,He.x,He.y),pi=pt,vn=nt;if(bt){let Mr=vP(Ne,ke,pt,nt,bt,yt,Ct,St);pi+=Mr.base,vn+=Mr.top}pt!==0?me(Jt,Di.x+zi[0]*Qt*pi,Di.y+zi[1]*Qt*pi,Di.z+zi[2]*Qt*pi):me(Jt,Di.x,Di.y,Di.z),me(le,Di.x+zi[0]*Qt*vn,Di.y+zi[1]*Qt*vn,Di.z+zi[2]*Qt*vn),J.transformMat4(Jt,Jt,_t),J.transformMat4(le,le,_t),Bi.push(new Lh(Jt[0],Jt[1],Jt[2])),Ci.push(new Lh(le[0],le[1],le[2]))}xt.push(Bi),Ft.push(Ci)}return[xt,Ft]}(O,R,F,z,j,U,G,$,Y,tt,W):G?function(rt,st,pt,nt,ot,_t,bt,yt,Ct){let St=[],Tt=[],xt=[0,0,0,1];for(let Ft of rt){let Qt=[],Jt=[];for(let le of Ft){let me=le.x+nt.x,Ue=le.y+nt.y,Ie=vP(me,Ue,st,pt,_t,bt,yt,Ct);xt[0]=me,xt[1]=Ue,xt[2]=Ie.base,xt[3]=1,un.transformMat4(xt,xt,ot),xt[3]=Math.max(xt[3],1e-5);let Bi=new Lh(xt[0]/xt[3],xt[1]/xt[3],xt[2]/xt[3]);xt[0]=me,xt[1]=Ue,xt[2]=Ie.top,xt[3]=1,un.transformMat4(xt,xt,ot),xt[3]=Math.max(xt[3],1e-5);let Ci=new Lh(xt[0]/xt[3],xt[1]/xt[3],xt[2]/xt[3]);Qt.push(Bi),Jt.push(Ci)}St.push(Qt),Tt.push(Jt)}return[St,Tt]}(R,F,z,j,U,G,$,Y,tt):function(rt,st,pt,nt,ot){let _t=[],bt=[],yt=ot[8]*st,Ct=ot[9]*st,St=ot[10]*st,Tt=ot[11]*st,xt=ot[8]*pt,Ft=ot[9]*pt,Qt=ot[10]*pt,Jt=ot[11]*pt;for(let le of rt){let me=[],Ue=[];for(let Ie of le){let Bi=Ie.x+nt.x,Ci=Ie.y+nt.y,He=ot[0]*Bi+ot[4]*Ci+ot[12],Ne=ot[1]*Bi+ot[5]*Ci+ot[13],ke=ot[2]*Bi+ot[6]*Ci+ot[14],Di=ot[3]*Bi+ot[7]*Ci+ot[15],zi=He+yt,pi=Ne+Ct,vn=ke+St,Mr=Math.max(Di+Tt,1e-5),hn=He+xt,zn=Ne+Ft,Lr=ke+Qt,Dr=Math.max(Di+Jt,1e-5);me.push(new Lh(zi/Mr,pi/Mr,vn/Mr)),Ue.push(new Lh(hn/Dr,zn/Dr,Lr/Dr))}_t.push(me),bt.push(Ue)}return[_t,bt]}(R,F,z,j,U)}(u,o,y,v,g,h,M,b,C,u.center.lat,e.tileID.canonical),P=e.queryGeometry;return function(O,R,F){let z=1/0;lk(F,R)&&(z=_P(F,R[0]));for(let j=0;j<R.length;j++){let U=R[j],G=O[j];for(let $=0;$<U.length-1;$++){let Y=U[$],tt=[Y,U[$+1],G[$+1],G[$],Y];ak(F,tt)&&(z=Math.min(z,_P(F,tt)))}}return z!==1/0&&z}(D,I,P.isPointQuery()?P.screenBounds:P.screenGeometry)}},line:class extends Hs{constructor(e,t){super(e,yP,t),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){let t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof b1,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=SP.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new T0(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(e,t){let i=wP(this);return{config:new iu(this,t),defines:i,overrideFog:!1}}queryRadius(e){let t=e,i=EP(wh("line-width",this,t),wh("line-gap-width",this,t)),o=wh("line-offset",this,t);return i/2+Math.abs(o)+Q_(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,i,o,c,u){if(e.queryGeometry.isAboveHorizon)return!1;let h=hk(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,e.pixelToTileUnitsFactor),p=e.pixelToTileUnitsFactor/2*EP(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i)),f=this.paint.get("line-offset").evaluate(t,i);return f&&(o=function(g,v){let y=[],b=new Q(0,0);for(let x=0;x<g.length;x++){let C=g[x],E=[];for(let M=0;M<C.length;M++){let D=C[M],I=C[M+1],P=M===0?b:D.sub(C[M-1])._unit()._perp(),O=M===C.length-1?b:I.sub(D)._unit()._perp(),R=P._add(O)._unit();R._mult(1/(R.x*O.x+R.y*O.y)),E.push(R._mult(v)._add(D))}y.push(E)}return y}(o,f*e.pixelToTileUnitsFactor)),function(g,v,y){for(let b=0;b<v.length;b++){let x=v[b];if(g.length>=3){for(let C=0;C<x.length;C++)if(ed(g,x[C]))return!0}if(g6(g,x,y))return!0}return!1}(h,o,p)}isTileClipped(){return!0}},symbol:w0,background:class extends Hs{constructor(e,t){super(e,IG,t)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},raster:class extends Hs{constructor(e,t){super(e,kG,t),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(e){return!(e&&e._source instanceof fa)||!e._source.onNorthPole&&!e._source.onSouthPole&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-color"].value.expression,[t,i]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=J_({expression:e,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:t,end:i}],resolution:256}),this.colorRampTexture=null}},sky:class extends Hs{constructor(e,t){super(e,OG,t),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="sky-gradient"?this._updateColorRamp():e!=="sky-atmosphere-sun"&&e!=="sky-atmosphere-halo-color"&&e!=="sky-atmosphere-color"&&e!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=J_({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if(this.paint.get("sky-type")==="atmosphere"){let o=this.paint.get("sky-atmosphere-sun"),c=!o,u=e.style.light,h=u.properties.get("position");return c&&u.properties.get("anchor")==="viewport"&&lt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?OC(h.azimuthal,90-h.polar,t):OC(o[0],90-o[1],t)}let i=this.paint.get("sky-gradient-center");return OC(i[0],90-i[1],t)}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let e=this.paint.get("sky-type");return e==="atmosphere"?["skyboxCapture","skybox"]:e==="gradient"?["skyboxGradient"]:null}},slot:class extends Hs{constructor(e,t){super(e,FG)}},model:class extends Hs{constructor(e,t){super(e,cG,t)}createBucket(e){return new YR(e)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(e,t,i){return!(!this.layout||t.isDataDriven()||i.isDataDriven()||e!=="model-color"&&e!=="model-color-mix-intensity"&&e!=="model-rotation"&&e!=="model-scale"&&e!=="model-translation"&&e!=="model-emissive-strength")}_isPropertyZoomDependent(e){let t=this._transitionablePaint._values[e];return t!=null&&t.value!=null&&t.value.expression!=null&&t.value.expression instanceof jc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};function V0(e,t){return e.type==="custom"?new RG(e):new LG[e.type](e,t)}function zG(e){let{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class NG extends Hr{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new Br({width:1,height:1})}isLoaded(){for(let t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,i){if(this.loaded[i]!==t&&(this.loaded[i]=t,t)){for(let{ids:o,callback:c}of this.requestors)this._notify(o,i,c);this.requestors=[]}}hasImage(t,i){return!!this.getImage(t,i)}getImage(t,i){return this.images[i][t]}addImage(t,i,o){this._validate(t,o)&&(this.images[i][t]=o)}_validate(t,i){let o=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new Xe(new Error(`Image "${t}" has invalid "stretchX" value`))),o=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new Xe(new Error(`Image "${t}" has invalid "stretchY" value`))),o=!1),this._validateContent(i.content,i)||(this.fire(new Xe(new Error(`Image "${t}" has invalid "content" value`))),o=!1),o}_validateStretch(t,i){if(!t)return!0;let o=0;for(let c of t){if(c[0]<o||c[1]<c[0]||i<c[1])return!1;o=c[1]}return!0}_validateContent(t,i){return!(t&&(t.length!==4||t[0]<0||i.data.width<t[0]||t[1]<0||i.data.height<t[1]||t[2]<0||i.data.width<t[2]||t[3]<0||i.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,i,o){o.version=this.images[i][t].version+1,this.images[i][t]=o,this.updatedImages[i][t]=!0}removeImage(t,i){let o=this.images[i][t];delete this.images[i][t],delete this.patterns[i][t],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,i,o){let c=!0,u=!!this.loaded[i];if(!u)for(let h of t)this.images[i][h]||(c=!1);u||c?this._notify(t,i,o):this.requestors.push({ids:t,scope:i,callback:o})}getUpdatedImages(t){return this.updatedImages[t]}_notify(t,i,o){let c={};for(let u of t){this.images[i][u]||this.fire(new qt("styleimagemissing",{id:u}));let h=this.images[i][u];h?c[u]={data:h.data.clone(),pixelRatio:h.pixelRatio,sdf:h.sdf,version:h.version,stretchX:h.stretchX,stretchY:h.stretchY,content:h.content,hasRenderCallback:!!(h.userImage&&h.userImage.render)}:lt(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}o(null,c)}getPixelSize(t){let{width:i,height:o}=this.atlasImage[t];return{width:i,height:o}}getPattern(t,i){let o=this.patterns[i][t],c=this.getImage(t,i);if(!c)return null;if(o&&o.position.version===c.version)return o.position;if(o)o.position.version=c.version;else{let u={w:c.data.width+2,h:c.data.height+2,x:0,y:0},h=new pC(u,c);this.patterns[i][t]={bin:u,position:h}}return this._updatePatternAtlas(i),this.patterns[i][t].position}bind(t,i){let o=t.gl,c=this.atlasTexture[i];c?this.dirty&&(c.update(this.atlasImage[i]),this.dirty=!1):(c=new ir(t,this.atlasImage[i],o.RGBA),this.atlasTexture[i]=c),c.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(t){let i=[];for(let h in this.patterns[t])i.push(this.patterns[t][h].bin);let{w:o,h:c}=mC(i),u=this.atlasImage[t];u.resize({width:o||1,height:c||1});for(let h in this.patterns[t]){let{bin:p}=this.patterns[t][h],f=p.x+1,g=p.y+1,v=this.images[t][h].data,y=v.width,b=v.height;Br.copy(v,u,{x:0,y:0},{x:f,y:g},{width:y,height:b}),Br.copy(v,u,{x:0,y:b-1},{x:f,y:g-1},{width:y,height:1}),Br.copy(v,u,{x:0,y:0},{x:f,y:g+b},{width:y,height:1}),Br.copy(v,u,{x:y-1,y:0},{x:f-1,y:g},{width:1,height:b}),Br.copy(v,u,{x:0,y:0},{x:f+y,y:g},{width:1,height:b})}this.dirty=!0}beginFrame(){for(let t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,i){for(let o of t){if(this.callbackDispatchedThisFrame[i][o])continue;this.callbackDispatchedThisFrame[i][o]=!0;let c=this.images[i][o];zG(c)&&this.updateImage(o,i,c)}}}let BG=new yr({anchor:new Ut(gt.light.anchor),position:new class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return _e(e.expression.evaluate(t))}interpolate(e,t,i){return{x:$e(e.x,t.x,i),y:$e(e.y,t.y,i),z:$e(e.z,t.z,i),azimuthal:$e(e.azimuthal,t.azimuthal,i),polar:$e(e.polar,t.polar,i)}}}(gt.light.position),color:new Ut(gt.light.color),intensity:new Ut(gt.light.intensity)});class DP extends Hr{constructor(t,i="flat"){super(),this._transitionable=new Sp(BG),this.setLight(t,i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,i,o={}){this._validate(lU,t,o)||(this._transitionable.setTransitionOrValue(t),this.id=i)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,i,o){return(!o||o.validate!==!1)&&D_(this,t.call(dh,ge({value:i,style:{glyphs:!0,sprite:!0},styleSpec:gt})))}}let VG=new yr({source:new Ut(gt.terrain.source),exaggeration:new Ut(gt.terrain.exaggeration)}),jG=class extends Hr{constructor(e,t,i,o){super(),this.scope=i,this._transitionable=new Sp(VG,o),this._transitionable.setTransitionOrValue(e,o),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(e,t){this._transitionable.setTransitionOrValue(e,t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}getExaggeration(e){return this._transitioning.possiblyEvaluate(new Jn(e)).get("exaggeration")}isZoomDependent(){let e=this._transitionable._values.exaggeration;return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof jc}},TP=45,IP=65,du=.05;function j0(e,t,i,o){let c=Go(TP,IP,i),[u,h]=AP(e,o),p=1-Math.min(1,Math.exp((t-u)/(h-u)*-6));return p*=p*p,p=Math.min(1,1.00747*p),p*c*e.alpha}function AP(e,t){let i=.5/Math.tan(.5*t);return[e.range[0]+i,e.range[1]+i]}function kP(e,t,i,o,c){let u=J.transformMat4([],[t,i,o],c.mercatorFogMatrix);return j0(e,J.length(u),c.pitch,c._fov)}function RP(e,t,i,o,c,u,h){let p=[[i,o,0],[c,o,0],[c,u,0],[i,u,0]],f=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let v of p){let y=J.transformMat4([],v,t),b=J.length(y);f=Math.min(f,b),g=Math.max(g,b)}return[j0(e,f,h.pitch,h._fov),j0(e,g,h.pitch,h._fov)]}let UG=new yr({range:new Ut(gt.fog.range),color:new Ut(gt.fog.color),"high-color":new Ut(gt.fog["high-color"]),"space-color":new Ut(gt.fog["space-color"]),"horizon-blend":new Ut(gt.fog["horizon-blend"]),"star-intensity":new Ut(gt.fog["star-intensity"]),"vertical-range":new Ut(gt.fog["vertical-range"])});class HG extends Hr{constructor(t,i){super(),this._transitionable=new Sp(UG),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=i}get state(){let t=this._transform,i=t.projection.name==="globe",o=wo(t.zoom),c=this.properties.get("range"),u=[.5,3];return{range:i?[$e(u[0],c[0],o),$e(u[1],c[1],o)]:c,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,i={}){if(this._validate(uU,t,i))return;let o=ge({},t);for(let c of Object.keys(gt.fog))o[c]===void 0&&(o[c]=gt.fog[c].default);this._transitionable.setTransitionOrValue(o)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;let i=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:Go(TP,IP,t))*i.a}getOpacityAtLatLng(t,i){return this._transform.projection.supportsFog?function(o,c,u){let h=Oi.fromLngLat(c),p=u.elevation?u.elevation.getAtPointOrZero(h):0;return kP(o,h.x,h.y,p,u)}(this.state,t,i):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];let i=this._transform.calculateFogTileMatrix(t.toUnwrapped());return RP(this.state,i,0,0,wt,wt,this._transform)}getOpacityForBounds(t,i,o,c,u){return this._transform.projection.supportsFog?RP(this.state,t,i,o,c,u,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?AP(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;let i=[4,5,6,7];for(let o of i){let c=t.points[o],u;if(c[2]>=0)u=c;else{let h=t.points[o-4];u=oI(h,c,h[2]/(h[2]-c[2]))}if(kP(this.state,u[0],u[1],0,this._transform)>=du)return!0}return!1}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,i,o){return(!o||o.validate!==!1)&&D_(this,t.call(dh,ge({value:i,style:{glyphs:!0,sprite:!0},styleSpec:gt})))}}class GG{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class qG{constructor(){this.tasks={},this.taskQueue=[],_o(["process"],this),this.invoker=new GG(this.process),this.nextId=0}add(t,i){let o=this.nextId++,c=function({type:u,isSymbolTile:h,zoom:p}){return p=p||0,u==="message"?0:u!=="maybePrepare"||h?u!=="parseTile"||h?u==="parseTile"&&h?300-p:u==="maybePrepare"&&h?400-p:500:200-p:100-p}(i);if(c===0){jt();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[o]={fn:t,metadata:i,priority:c,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){jt();try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;let t=this.pick();if(t===null)return;let i=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let t=null,i=1/0;for(let c=0;c<this.taskQueue.length;c++){let u=this.tasks[this.taskQueue[c]];u.priority<i&&(i=u.priority,t=c)}if(t===null)return null;let o=this.taskQueue[t];return this.taskQueue.splice(t,1),o}remove(){this.invoker.remove()}}class PP{constructor(t,i,o){this.target=t,this.parent=i,this.mapId=o,this.callbacks={},this.cancelCallbacks={},_o(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new qG}send(t,i,o,c,u=!1,h){let p=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=h,this.callbacks[p]=o);let f=new Set;return this.target.postMessage({id:p,type:t,hasCallback:!!o,targetMapId:c,mustQueue:u,sourceMapId:this.mapId,data:hh(i,f)},f),{cancel:()=>{o&&delete this.callbacks[p],this.target.postMessage({id:p,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(t){let i=t.data,o=i.id;if(o&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){let c=this.cancelCallbacks[o];delete this.cancelCallbacks[o],c&&c.cancel()}else if(i.mustQueue||jt()){let c=this.callbacks[o];this.cancelCallbacks[o]=this.scheduler.add(()=>this.processTask(o,i),c&&c.metadata||{type:"message"})}else this.processTask(o,i)}processTask(t,i){if(i.type==="<response>"){let o=this.callbacks[t];delete this.callbacks[t],o&&(i.error?o(mh(i.error)):o(null,mh(i.data)))}else{let o=new Set,c=i.hasCallback?(h,p)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:h?hh(h):null,data:hh(p,o)},o)}:h=>{},u=mh(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,u,c);else if(this.parent.getWorkerSource){let h=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,h[0],u.source,u.scope)[h[1]](u,c)}else c(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let U0=(()=>{class e{constructor(i,o){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=Wu();let c=this.workerPool.acquire(this.id);for(let u=0;u<c.length;u++){let h=new e.Actor(c[u],o,this.id);h.name=`Worker ${u}`,this.actors.push(h)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,o,c){fs(this.actors,(u,h)=>{u.send(i,o,h)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}return e.Actor=PP,e})();class OP extends Hr{constructor(t,i,o,c){super(),this.scope=o,this._options=t,this.properties=new Ep(i),this._transitionable=new Sp(i,new Map(c)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,i){this._options=t,this._transitionable.setTransitionOrValue(t.properties,i)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let WG=new yr({color:new Ut(gt.properties_light_ambient.color),intensity:new Ut(gt.properties_light_ambient.intensity)}),$G=new yr({direction:new class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return function([i,o]){let c=_e([1,i,o]);return{x:c.x,y:c.y,z:c.z}}(e.expression.evaluate(t))}interpolate(e,t,i){return{x:$e(e.x,t.x,i),y:$e(e.y,t.y,i),z:$e(e.z,t.z,i)}}}(gt.properties_light_directional.direction),color:new Ut(gt.properties_light_directional.color),intensity:new Ut(gt.properties_light_directional.intensity),"cast-shadows":new Ut(gt.properties_light_directional["cast-shadows"]),"shadow-intensity":new Ut(gt.properties_light_directional["shadow-intensity"])});class FC{constructor(t,i,o,c){this.screenBounds=t,this.cameraPoint=i,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=o,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,c)}static createFromScreenPoints(t,i){let o,c;if(t instanceof Q||typeof t[0]=="number"){let u=Q.convert(t);o=[u],c=i.isPointAboveHorizon(u)}else{let u=Q.convert(t[0]),h=Q.convert(t[1]);o=[u,h],c=jn(u,h).every(p=>i.isPointAboveHorizon(p))}return new FC(o,i.getCameraPoint(),c,i)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return jn(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){let i=this.screenBounds[0],o=this.screenBounds.length===1?this.screenBounds[0].add(new Q(1,1)):this.screenBounds[1],c=jn(i,o,0,!1);return this.cameraPoint.y>o.y&&(this.cameraPoint.x>i.x&&this.cameraPoint.x<o.x?c.splice(3,0,this.cameraPoint):this.cameraPoint.x>=o.x?c[2]=this.cameraPoint:this.cameraPoint.x<=i.x&&(c[3]=this.cameraPoint)),function(u,h){let p=[];for(let f=0;f<u.length;f++){let g=os(f-1,-1,u.length-1),v=os(f+1,-1,u.length-1),y=u[f],b=u[v],x=u[g].sub(y).unit(),C=b.sub(y).unit(),E=C.angleWithSep(x.x,x.y),M=x.add(C).unit().mult(-1*h/Math.sin(E/2));p.push(y.add(M))}return p}(c,t)}bufferedCameraGeometryGlobe(t){let i=this.screenBounds[0],o=this.screenBounds.length===1?this.screenBounds[0].add(new Q(1,1)):this.screenBounds[1],c=jn(i,o,t),u=this.cameraPoint.clone();switch(3*((u.y>i.y)+(u.y>o.y))+((u.x>i.x)+(u.x>o.x))){case 0:c[0]=u,c[4]=u.clone();break;case 1:c.splice(1,0,u);break;case 2:c[1]=u;break;case 3:c.splice(4,0,u);break;case 5:c.splice(2,0,u);break;case 6:c[3]=u;break;case 7:c.splice(3,0,u);break;case 8:c[2]=u}return c}containsTile(t,i,o,c=0){let u=t.queryPadding/i._pixelsPerMercatorPixel+1,h=o?this._bufferedCameraMercator(u,i):this._bufferedScreenMercator(u,i),p=t.tileID.wrap+(h.unwrapped?c:0),f=h.polygon.map(M=>mR(t.tileTransform,M,p));if(!uk(f,0,0,wt,wt))return;p=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?c:0);let g=this.screenGeometryMercator.polygon.map(M=>pR(t.tileTransform,M,p)),v=g.map(M=>new Q(M[0],M[1])),y=i.getFreeCameraOptions().position||new Oi(0,0,0),b=pR(t.tileTransform,y,p),x=g.map(M=>{let D=J.sub(M,M,b);return J.normalize(D,D),new G_(b,D)}),C=au(t,1,i.zoom)*i._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:v,tilespaceRays:x,bufferedTilespaceGeometry:f,bufferedTilespaceBounds:(E=ki(f),E.min.x=ve(E.min.x,0,wt),E.min.y=ve(E.min.y,0,wt),E.max.x=ve(E.max.x,0,wt),E.max.y=ve(E.max.y,0,wt),E),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:C};var E}_bufferedScreenMercator(t,i){let o=FP(t);if(this._screenRaycastCache[o])return this._screenRaycastCache[o];{let c;return c=i.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),i):{polygon:this.bufferedScreenGeometry(t).map(u=>i.pointCoordinate3D(u)),unwrapped:!0},this._screenRaycastCache[o]=c,c}}_bufferedCameraMercator(t,i){let o=FP(t);if(this._cameraRaycastCache[o])return this._cameraRaycastCache[o];{let c;return c=i.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),i):{polygon:this.bufferedCameraGeometry(t).map(u=>i.pointCoordinate3D(u)),unwrapped:!0},this._cameraRaycastCache[o]=c,c}}_projectAndResample(t,i){let o=function(u,h){let p=ft.multiply([],h.pixelMatrix,h.globeMatrix),f=[0,-ts,0,1],g=[0,ts,0,1],v=[0,0,0,1];un.transformMat4(f,f,p),un.transformMat4(g,g,p),un.transformMat4(v,v,p);let y=new Q(f[0]/f[3],f[1]/f[3]),b=new Q(g[0]/g[3],g[1]/g[3]),x=ed(u,y)&&f[3]<v[3],C=ed(u,b)&&g[3]<v[3];if(!x&&!C)return null;let E=function(z,j,U){for(let G=1;G<z.length;G++){let $=sf(j.pointCoordinate3D(z[G-1]).x),Y=sf(j.pointCoordinate3D(z[G]).x);if(U<0){if($<Y)return{idx:G,t:-$/(Y-1-$)}}else if(Y<$)return{idx:G,t:(1-$)/(Y+1-$)}}return null}(u,h,x?-1:1);if(!E)return null;let{idx:M,t:D}=E,I=M>1?LC(u.slice(0,M),h):[],P=M<u.length?LC(u.slice(M),h):[];I=I.map(z=>new Q(sf(z.x),z.y)),P=P.map(z=>new Q(sf(z.x),z.y));let O=[...I];O.length===0&&O.push(P[P.length-1]);let R=$e(O[O.length-1].y,(P.length===0?I[0]:P[0]).y,D),F;return F=x?[new Q(0,R),new Q(0,0),new Q(1,0),new Q(1,R)]:[new Q(1,R),new Q(1,1),new Q(0,1),new Q(0,R)],O.push(...F),P.length===0?O.push(I[0]):O.push(...P),{polygon:O.map(z=>new Oi(z.x,z.y)),unwrapped:!1}}(t,i);if(o)return o;let c=function(u,h){let p=!1,f=-1/0,g=0;for(let y=0;y<u.length-1;y++)u[y].x>f&&(f=u[y].x,g=y);for(let y=0;y<u.length-1;y++){let b=(g+y)%(u.length-1),x=u[b],C=u[b+1];Math.abs(x.x-C.x)>.5&&(x.x<C.x?(x.x+=1,b===0&&(u[u.length-1].x+=1)):(C.x+=1,b+1===u.length-1&&(u[0].x+=1)),p=!0)}let v=to(h.center.lng);return p&&v<Math.abs(v-1)&&u.forEach(y=>{y.x-=1}),{polygon:u,unwrapped:p}}(LC(t,i).map(u=>new Q(sf(u.x),u.y)),i);return{polygon:c.polygon.map(u=>new Oi(u.x,u.y)),unwrapped:c.unwrapped}}}function LC(e,t){return ok(e,i=>{let o=t.pointCoordinate3D(i);i.x=o.x,i.y=o.y},1/256)}function sf(e){return e<0?1+e%1:e%1}function FP(e){return 100*e|0}function zC(e,t,i,o,c){let u=function(h,p){if(h)return c(h);if(p){e.url&&p.tiles&&e.tiles&&delete e.tiles;let f=Ho(ge(p,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);p.vector_layers&&(f.vectorLayers=p.vector_layers,f.vectorLayerIds=f.vectorLayers.map(g=>g.id)),f.tiles=t.canonicalizeTileset(f,e.url),c(null,f)}};return e.url?Xt(t.transformRequest(t.normalizeSourceURL(e.url,null,i,o),Dt.Source),u):ni.frame(()=>u(null,e))}class H0{constructor(t,i,o){this.bounds=Cs.convert(this.validateBounds(t)),this.minzoom=i||0,this.maxzoom=o||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){let i=Math.pow(2,t.z),o=Math.floor(to(this.bounds.getWest())*i),c=Math.floor(lo(this.bounds.getNorth())*i),u=Math.ceil(to(this.bounds.getEast())*i),h=Math.ceil(lo(this.bounds.getSouth())*i);return t.x>=o&&t.x<u&&t.y>=c&&t.y<h}}class LP{constructor(t,i){this.width=t,this.height=i,this.nextRow=0,this.image=new pc({width:t,height:i}),this.positions={},this.uploaded=!1}getDash(t,i){let o=this.getKey(t,i);return this.positions[o]}trim(){let t=this.width,i=this.height=Qg(this.nextRow);this.image.resize({width:t,height:i})}getKey(t,i){return t.join(",")+i}getDashRanges(t,i,o){let c=[],u=t.length%2==1?-t[t.length-1]*o:0,h=t[0]*o,p=!0;c.push({left:u,right:h,isDash:p,zeroLength:t[0]===0});let f=t[0];for(let g=1;g<t.length;g++){p=!p;let v=t[g];u=f*o,f+=v,h=f*o,c.push({left:u,right:h,isDash:p,zeroLength:v===0})}return c}addRoundDash(t,i,o){let c=i/2;for(let u=-o;u<=o;u++){let h=this.width*(this.nextRow+o+u),p=0,f=t[p];for(let g=0;g<this.width;g++){g/f.right>1&&(f=t[++p]);let v=Math.abs(g-f.left),y=Math.abs(g-f.right),b=Math.min(v,y),x,C=u/o*(c+1);if(f.isDash){let E=c-Math.abs(C);x=Math.sqrt(b*b+E*E)}else x=c-Math.sqrt(b*b+C*C);this.image.data[h+g]=Math.max(0,Math.min(255,x+128))}}}addRegularDash(t,i){for(let f=t.length-1;f>=0;--f){let g=t[f],v=t[f+1];g.zeroLength?t.splice(f,1):v&&v.isDash===g.isDash&&(v.left=g.left,t.splice(f,1))}let o=t[0],c=t[t.length-1];o.isDash===c.isDash&&(o.left=c.left-this.width,c.right=o.right+this.width);let u=this.width*this.nextRow,h=0,p=t[h];for(let f=0;f<this.width;f++){f/p.right>1&&(p=t[++h]);let g=Math.abs(f-p.left),v=Math.abs(f-p.right),y=Math.min(g,v);this.image.data[u+f]=Math.max(0,Math.min(255,(p.isDash?y:-y)+i+128))}}addDash(t,i){let o=this.getKey(t,i);if(this.positions[o])return this.positions[o];let c=i==="round",u=c?7:0,h=2*u+1;if(this.nextRow+h>this.height)return lt("LineAtlas out of space"),null;t.length===0&&t.push(1);let p=0;for(let v=0;v<t.length;v++)t[v]<0&&(lt("Negative value is found in line dasharray, replacing values with 0"),t[v]=0),p+=t[v];if(p!==0){let v=this.width/p,y=this.getDashRanges(t,this.width,v);c?this.addRoundDash(y,v,u):this.addRegularDash(y,i==="square"?.5*v:0)}let f=this.nextRow+u;this.nextRow+=h;let g={tl:[f,u],br:[p,0]};return this.positions[o]=g,g}}xe(LP,"LineAtlas");let zP=1*Qa;class NP{constructor(t){let i={},o=[];for(let p in t){let f=t[p],g=i[p]={};for(let v in f.glyphs){let y=f.glyphs[+v];if(!y||y.bitmap.width===0||y.bitmap.height===0)continue;let b=y.metrics.localGlyph?zP:1,x={x:0,y:0,w:y.bitmap.width+2*b,h:y.bitmap.height+2*b};o.push(x),g[v]=x}}let{w:c,h:u}=mC(o),h=new pc({width:c||1,height:u||1});for(let p in t){let f=t[p];for(let g in f.glyphs){let v=f.glyphs[+g];if(!v||v.bitmap.width===0||v.bitmap.height===0)continue;let y=i[p][g],b=v.metrics.localGlyph?zP:1;pc.copy(v.bitmap,h,{x:0,y:0},{x:y.x+b,y:y.y+b},v.bitmap)}}this.image=h,this.positions=i}}xe(NP,"GlyphAtlas");class YG{constructor(t){this.tileID=new Hi(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.scope=t.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.promoteId=t.promoteId,this.isSymbolTile=t.isSymbolTile,this.tileTransform=su(t.tileID.canonical,t.projection),this.projection=t.projection,this.brightness=t.brightness,this.extraShadowCaster=!!t.extraShadowCaster}parse(t,i,o,c,u){this.status="parsing",this.data=t,this.collisionBoxArray=new fw;let h=new Tk(Object.keys(t.layers).sort()),p=new cC(this.tileID,this.promoteId);p.bucketLayerIDs=[];let f={},g=new LP(256,256),v={featureIndex:p,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:g,availableImages:o,brightness:this.brightness},y=i.familiesBySource[this.source];for(let I in y){let P=t.layers[I];if(!P)continue;let O=!1,R=!1,F=!1;for(let U of y[I])U[0].type==="symbol"?O=!0:R=!0,U[0].is3D()&&U[0].type!=="model"&&(F=!0);if(this.extraShadowCaster&&!F||this.isSymbolTile===!0&&!O||this.isSymbolTile===!1&&!R)continue;P.version===1&&lt(`Vector tile source "${this.source}" layer "${I}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let z=h.encode(I),j=[];for(let U=0;U<P.length;U++){let G=P.feature(U),$=p.getId(G,I);j.push({feature:G,id:$,index:U,sourceLayerIndex:z})}for(let U of y[I]){let G=U[0];(!this.extraShadowCaster||G.is3D()&&G.type!=="model")&&(this.isSymbolTile!==void 0&&G.type==="symbol"!==this.isSymbolTile||G.minzoom&&this.zoom<Math.floor(G.minzoom)||G.maxzoom&&this.zoom>=G.maxzoom||G.visibility!=="none"&&(NC(U,this.zoom,v.brightness,o),(f[G.id]=G.createBucket({index:p.bucketLayerIDs.length,layers:U,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:z,sourceID:this.source,projection:this.projection.spec})).populate(j,v,this.tileID.canonical,this.tileTransform),p.bucketLayerIDs.push(U.map($=>$.id))))}}let b,x,C,E;g.trim();let M={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},D=()=>{if(b)return this.status="done",u(b);if(this.extraShadowCaster)this.status="done",u(null,{buckets:Us(f).filter(I=>!I.isEmpty()),featureIndex:p,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:v.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(x&&C&&E){let I=new NP(x),P=new rR(C,E);for(let O in f){let R=f[O];R instanceof Zp?(NC(R.layers,this.zoom,v.brightness,o),G8(R,x,I.positions,C,P.iconPositions,this.showCollisionBoxes,o,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):R.hasPattern&&(R instanceof T0||R instanceof o0||R instanceof rf)&&(NC(R.layers,this.zoom,v.brightness,o),R.addFeatures(v,this.tileID.canonical,P.patternPositions,o,this.tileTransform,this.brightness))}this.status="done",u(null,{buckets:Us(f).filter(O=>!O.isEmpty()),featureIndex:p,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:I.image,lineAtlas:g,imageAtlas:P,brightness:v.brightness})}};if(!this.extraShadowCaster){let I=Yu(v.glyphDependencies,R=>Object.keys(R).map(Number));Object.keys(I).length?c.send("getGlyphs",{uid:this.uid,stacks:I,scope:this.scope},(R,F)=>{b||(b=R,x=F,D())},void 0,!1,M):x={};let P=Object.keys(v.iconDependencies);P.length?c.send("getImages",{icons:P,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(R,F)=>{b||(b=R,C=F,D())},void 0,!1,M):C={};let O=Object.keys(v.patternDependencies);O.length?c.send("getImages",{icons:O,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(R,F)=>{b||(b=R,E=F,D())},void 0,!1,M):E={}}D()}}function NC(e,t,i,o){let c=new Jn(t,{brightness:i});for(let u of e)u.recalculate(c,o)}class BP{constructor(t){this.entries={},this.scheduler=t}request(t,i,o,c){let u=this.entries[t]=this.entries[t]||{callbacks:[]};if(u.result){let[h,p]=u.result;return this.scheduler?this.scheduler.add(()=>{c(h,p)},i):c(h,p),()=>{}}return u.callbacks.push(c),u.cancel||(u.cancel=o((h,p)=>{u.result=[h,p];for(let f of u.callbacks)this.scheduler?this.scheduler.add(()=>{f(h,p)},i):f(h,p);setTimeout(()=>delete this.entries[t],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(h=>h!==c),u.callbacks.length||(u.cancel(),delete this.entries[t]))}}}function VP(e,t,i){let o=JSON.stringify(e.request);return e.data&&(this.deduped.entries[o]={result:[null,e.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},c=>{let u=ie(e.request,(h,p,f,g)=>{h?c(h):p&&c(null,{vectorTile:i?void 0:new aC(new u0(p)),rawData:p,cacheControl:f,expires:g})});return()=>{u.cancel(),c()}},t)}class jP extends Hr{constructor(t,i,o,c){if(super(),this.id=t,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,ge(this,Ho(i,["url","scheme","tileSize","promoteId"])),this._options=ge({type:"vector"},i),this._collectResourceTiming=!!i.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c),this._tileWorkers={},this._deduped=new BP}load(t){this._loaded=!1,this.fire(new qt("dataloading",{dataType:"source"}));let i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map._worldview;this._tileJSONRequest=zC(this._options,this.map._requestManager,i,o,(c,u)=>{this._tileJSONRequest=null,this._loaded=!0,c?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),o&&o.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new Xe(c))):u&&(ge(this,u),u.bounds&&(this.tileBounds=new H0(u.bounds,this.minzoom,this.maxzoom)),Nx(u.tiles,this.map._requestManager._customAccessToken),this.fire(new qt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new qt("data",{dataType:"source",sourceDataType:"content"}))),t&&t(c)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();let t=Yo(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return ge({},this._options)}loadTile(t,i){let o=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),c={request:this.map._requestManager.transformRequest(o,Dt.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:ni.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster};if(c.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=i:t.request=t.actor.send("reloadTile",c,u.bind(this));else if(t.actor=this._tileWorkers[o]=this._tileWorkers[o]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",c,u.bind(this),void 0,!0);else{let h=VP.call({deduped:this._deduped},c,(p,f)=>{p||!f?u.call(this,p):(c.data={cacheControl:f.cacheControl,expires:f.expires,rawData:f.rawData.slice(0)},t.actor&&t.actor.send("loadTile",c,u.bind(this),void 0,!0))},!0);t.request={cancel:h}}function u(h,p){return delete t.request,t.aborted?i(null):h&&h.status!==404?i(h):(p&&p.resourceTiming&&(t.resourceTiming=p.resourceTiming),this.map._refreshExpiredTiles&&p&&t.setExpiryData(p),t.loadVectorData(p,this.map.painter),Xu(this.dispatcher),i(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class BC extends Hr{constructor(t,i,o,c){super(),this.id=t,this.dispatcher=o,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=ge({type:"raster"},i),ge(this,Ho(i,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new qt("dataloading",{dataType:"source"})),this._tileJSONRequest=zC(this._options,this.map._requestManager,null,null,(i,o)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new Xe(i)):o&&(ge(this,o),o.bounds&&(this.tileBounds=new H0(o.bounds,this.minzoom,this.maxzoom)),Nx(o.tiles),this.fire(new qt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new qt("data",{dataType:"source",sourceDataType:"content"}))),t&&t(i)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();let t=Yo(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return ge({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,i){let o=ni.devicePixelRatio>=2,c=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),o,this.tileSize);t.request=mi(this.map._requestManager.transformRequest(c,Dt.Tile),(u,h,p,f)=>(delete t.request,t.aborted?(t.state="unloaded",i(null)):u?(t.state="errored",i(u)):h?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:p,expires:f}),t.setTexture(h,this.map.painter),t.state="loaded",Xu(this.dispatcher),void i(null)):i(null)))}abortTile(t,i){t.request&&(t.request.cancel(),delete t.request),i()}unloadTile(t,i){t.texture&&t.texture instanceof ir?(t.destroy(!0),t.texture&&t.texture instanceof ir&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),i()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function ZG(){return hv.workerClass!=null?new hv.workerClass:new m.Worker(hv.workerUrl)}let VC="mapboxgl_preloaded_worker_pool";class zh{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<zh.workerCount;)this.workers.push(new ZG);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[VC]}numActive(){return Object.keys(this.active).length}}let af;function lf(){return af||(af=new zh),af}zh.workerCount=2;let G0,jC,el,UC=null;function UP(){return jt()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:jC||S.DRACO_URL}let HC=5123,GC=5126,qC={5120:Int8Array,5121:Uint8Array,5122:Int16Array,[HC]:Uint16Array,5125:Uint32Array,[GC]:Float32Array},XG={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",[HC]:"DT_UINT16",5125:"DT_UINT32",[GC]:"DT_FLOAT32"},WC={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function HP(e,t,i){let o=i.json.bufferViews.length,c=i.buffers.length;t.bufferView=o,i.json.bufferViews[o]={buffer:c,byteLength:e.byteLength},i.buffers[c]=e}let $C="KHR_draco_mesh_compression";function KG(e,t){let i=e.extensions&&e.extensions[$C];if(!i)return;let o=new el.Decoder,c=$P(t,i.bufferView),u=new el.Mesh;if(!o.DecodeArrayToMesh(c,c.byteLength,u))throw new Error("Failed to decode Draco mesh");let h=t.json.accessors[e.indices],p=qC[h.componentType],f=h.count*p.BYTES_PER_ELEMENT,g=el._malloc(f);p===Uint16Array?o.GetTrianglesUInt16Array(u,f,g):o.GetTrianglesUInt32Array(u,f,g),HP(el.memory.buffer.slice(g,g+f),h,t),el._free(g);for(let v of Object.keys(i.attributes)){let y=o.GetAttributeByUniqueId(u,i.attributes[v]),b=t.json.accessors[e.attributes[v]],x=XG[b.componentType],C=b.count*WC[b.type]*qC[b.componentType].BYTES_PER_ELEMENT,E=el._malloc(C);o.GetAttributeDataArrayForAllPoints(u,y,el[x],C,E),HP(el.memory.buffer.slice(E,E+C),b,t),el._free(E)}o.destroy(),u.destroy(),delete e.extensions[$C]}let GP=1179937895,qP=new TextDecoder("utf8");function WP(e,t){return new URL(e,t).href}function QG(e,t,i,o){return fetch(WP(e.uri,o)).then(c=>c.arrayBuffer()).then(c=>{t.buffers[i]=c})}function $P(e,t){let i=e.json.bufferViews[t];return new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function JG(e,t,i,o){if(e.uri){let c=WP(e.uri,o);return fetch(c).then(u=>u.blob()).then(u=>m.createImageBitmap(u)).then(u=>{t.images[i]=u})}if(e.bufferView!==void 0){let c=$P(t,e.bufferView),u=new m.Blob([c],{type:e.mimeType});return m.createImageBitmap(u).then(h=>{t.images[i]=h})}}function YP(e,t=0,i){let o={json:null,images:[],buffers:[]};if(new Uint32Array(e,t,1)[0]===GP){let g=new Uint32Array(e,t),v=2,y=(g[v++]>>2)-3,b=g[v++]>>2;if(v++,o.json=JSON.parse(qP.decode(g.subarray(v,v+b))),v+=b,v<y){let x=g[v++];v++;let C=t+(v<<2);o.buffers[0]=e.slice(C,C+x)}}else o.json=JSON.parse(qP.decode(new Uint8Array(e,t)));let{buffers:c,images:u,meshes:h,extensionsUsed:p}=o.json,f=Promise.resolve();if(c){let g=[];for(let v=0;v<c.length;v++){let y=c[v];y.uri?g.push(QG(y,o,v,i)):o.buffers[v]||(o.buffers[v]=null)}f=Promise.all(g)}return f.then(()=>{let g=[],v=p&&p.includes($C);if(v&&g.push(function(){if(!el)return G0||(G0=function(y){let b,x=null;function C(){b=new Uint8Array(x.buffer)}function E(){throw new Error("Unexpected Draco error.")}let M={a:{a:E,d:function(D,I,P){return b.copyWithin(D,I,I+P)},c:function(D){let I=b.length,P=Math.max(D>>>0,Math.ceil(1.2*I)),O=Math.ceil((P-I)/65536);try{return x.grow(O),C(),!0}catch{return!1}},b:E}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(y,M):y.then(D=>D.arrayBuffer()).then(D=>WebAssembly.instantiate(D,M))).then(D=>{let{Rb:I,Qb:P,P:O,T:R,X:F,Ja:z,La:j,Qa:U,Va:G,Wa:$,eb:Y,jb:tt,f:W,e:rt,yb:st,zb:pt,Ab:nt,Bb:ot,Db:_t,Gb:bt}=D.instance.exports;x=rt;let yt=(()=>{let Ct=0,St=0,Tt=0,xt=0;return Ft=>{Tt&&(I(xt),I(Ct),St+=Tt,Tt=Ct=0),Ct||(St+=128,Ct=P(St));let Qt=Ft.length+7&-8,Jt=Ct;Qt>=St&&(Tt=Qt,Jt=xt=P(Qt));for(let le=0;le<Ft.length;le++)b[Jt+le]=Ft[le];return Jt}})();return C(),W(),{memory:rt,_free:I,_malloc:P,Mesh:class{constructor(){this.ptr=O()}destroy(){R(this.ptr)}},Decoder:class{constructor(){this.ptr=z()}destroy(){tt(this.ptr)}DecodeArrayToMesh(Ct,St,Tt){let xt=yt(Ct),Ft=j(this.ptr,xt,St,Tt.ptr);return!!F(Ft)}GetAttributeByUniqueId(Ct,St){return{ptr:U(this.ptr,Ct.ptr,St)}}GetTrianglesUInt16Array(Ct,St,Tt){G(this.ptr,Ct.ptr,St,Tt)}GetTrianglesUInt32Array(Ct,St,Tt){$(this.ptr,Ct.ptr,St,Tt)}GetAttributeDataArrayForAllPoints(Ct,St,Tt,xt,Ft){Y(this.ptr,Ct.ptr,St.ptr,Tt,xt,Ft)}},DT_INT8:st(),DT_UINT8:pt(),DT_INT16:nt(),DT_UINT16:ot(),DT_UINT32:_t(),DT_FLOAT32:bt()}})}(fetch(UP())),G0.then(y=>{el=y,G0=void 0}))}()),u)for(let y=0;y<u.length;y++)g.push(JG(u[y],o,y,i));return(g.length?Promise.all(g):Promise.resolve()).then(()=>{if(v&&h)for(let{primitives:y}of h)for(let b of y)KG(b,o);return o})})}function ZP(e){return fetch(e).then(t=>t.arrayBuffer()).then(t=>YP(t,0,e))}class XP{constructor(t,i,o){if(this.triangleCount=i.length/3,this.min=new Q(0,0),this.max=new Q(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||t.length===0||o===0)return;let c=t.map(v=>v.x),u=t.map(v=>v.y);this.min=new Q(Math.min(...c),Math.min(...u)),this.max=new Q(Math.max(...c),Math.max(...u));let h=this.max.sub(this.min);h.x=Math.max(h.x,1),h.y=Math.max(h.y,1);let p=Math.max(h.x,h.y)/o;this.cellsX=Math.max(1,Math.ceil(h.x/p)),this.cellsY=Math.max(1,Math.ceil(h.y/p)),this.xScale=1/p,this.yScale=1/p;let f=[];for(let v=0;v<this.triangleCount;v++){let y=t[i[3*v+0]].sub(this.min),b=t[i[3*v+1]].sub(this.min),x=t[i[3*v+2]].sub(this.min),C=cd(Math.floor(Math.min(y.x,b.x,x.x)),this.xScale,this.cellsX),E=cd(Math.floor(Math.max(y.x,b.x,x.x)),this.xScale,this.cellsX),M=cd(Math.floor(Math.min(y.y,b.y,x.y)),this.yScale,this.cellsY),D=cd(Math.floor(Math.max(y.y,b.y,x.y)),this.yScale,this.cellsY),I=new Q(0,0),P=new Q(0,0),O=new Q(0,0),R=new Q(0,0);for(let F=M;F<=D;++F){I.y=P.y=F*p,O.y=R.y=(F+1)*p;for(let z=C;z<=E;++z)I.x=O.x=z*p,P.x=R.x=(z+1)*p,(Qw(y,b,x,I,P,R)||Qw(y,b,x,I,R,O))&&f.push({cellIdx:F*this.cellsX+z,triIdx:v})}}if(f.length===0)return;f.sort((v,y)=>v.cellIdx-y.cellIdx||v.triIdx-y.triIdx);let g=0;for(;g<f.length;){let v=f[g].cellIdx,y={start:this.payload.length,len:0};for(;g<f.length&&f[g].cellIdx===v;)++y.len,this.payload.push(f[g++].triIdx);this.cells[v]=y}}query(t,i,o){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>i.x||t.y>this.max.y||this.min.y>i.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let f=0;f<this.lookup.length;f++)this.lookup[f]=0;let c=cd(t.x-this.min.x,this.xScale,this.cellsX),u=cd(i.x-this.min.x,this.xScale,this.cellsX),h=cd(t.y-this.min.y,this.yScale,this.cellsY),p=cd(i.y-this.min.y,this.yScale,this.cellsY);for(let f=h;f<=p;f++)for(let g=c;g<=u;g++){let v=this.cells[f*this.cellsX+g];if(v)for(let y=0;y<v.len;y++){let b=this.payload[v.start+y],x=Math.floor(b/8),C=1<<b%8;if(!(this.lookup[x]&C)&&(this.lookup[x]|=C,o.push(b),o.length===this.triangleCount))return}}}}function cd(e,t,i){return Math.max(0,Math.min(i-1,Math.floor(e*t)))}function uu(e,t){let i=e.json.bufferViews[t.bufferView];return new qC[t.componentType](e.buffers[i.buffer],(t.byteOffset||0)+(i.byteOffset||0),t.count*WC[t.type])}function tq(e,t,i){let o=e.indices,c=e.attributes,u={};u.indexArray=new qr;let h=t.json.accessors[o],p=h.count/3;u.indexArray.reserve(p);let f=uu(t,h);for(let b=0;b<p;b++)u.indexArray.emplaceBack(f[3*b],f[3*b+1],f[3*b+2]);u.indexArray._trim(),u.vertexArray=new eu;let g=t.json.accessors[c.POSITION];u.vertexArray.reserve(g.count);let v=uu(t,g);for(let b=0;b<g.count;b++)u.vertexArray.emplaceBack(v[3*b],v[3*b+1],v[3*b+2]);if(u.vertexArray._trim(),u.aabb=new Ln(g.min,g.max),u.centroid=function(b,x){let C=[0,0,0],E=b.length;if(E>0){for(let M=0;M<E;M++){let D=3*b[M];C[0]+=x[D],C[1]+=x[D+1],C[2]+=x[D+2]}C[0]/=E,C[1]/=E,C[2]/=E}return C}(f,v),c.COLOR_0!==void 0){let b=t.json.accessors[c.COLOR_0],x=WC[b.type];if(b.componentType===GC){u.colorArray=x===3?new eu:new oc,u.colorArray.reserve(b.count);let C=uu(t,b);if(x===3)for(let E=0;E<b.count;E++)u.colorArray.emplaceBack(C[3*E],C[3*E+1],C[3*E+2]);else for(let E=0;E<b.count;E++)u.colorArray.emplaceBack(C[4*E],C[4*E+1],C[4*E+2],C[4*E+3]);u.colorArray._trim()}else if(b.componentType===HC&&x===4){u.colorArray=new oc,u.colorArray.resize(b.count);let C=uu(t,b),E=1/65535,M=u.colorArray.float32;for(let D=0;D<4*C.length;++D)M[D]=C[D]*E}else lt(`glTF color buffer parsing for accessor ${JSON.stringify(b)} is not supported`)}if(c.NORMAL!==void 0){u.normalArray=new eu;let b=t.json.accessors[c.NORMAL];u.normalArray.reserve(b.count);let x=uu(t,b);for(let C=0;C<b.count;C++)u.normalArray.emplaceBack(x[3*C],x[3*C+1],x[3*C+2]);u.normalArray._trim()}if(c.TEXCOORD_0!==void 0&&i.length>0){u.texcoordArray=new Ip;let b=t.json.accessors[c.TEXCOORD_0];u.texcoordArray.reserve(b.count);let x=uu(t,b);for(let C=0;C<b.count;C++)u.texcoordArray.emplaceBack(x[2*C],x[2*C+1]);u.texcoordArray._trim()}let y=e.material;return u.material=function(b,x){let{emissiveFactor:C=[0,0,0],alphaMode:E="OPAQUE",alphaCutoff:M=.5,normalTexture:D,occlusionTexture:I,emissiveTexture:P,doubleSided:O}=b,{baseColorFactor:R=[1,1,1,1],metallicFactor:F=1,roughnessFactor:z=1,baseColorTexture:j,metallicRoughnessTexture:U}=b.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new fi(...R),metallicFactor:F,roughnessFactor:z,baseColorTexture:j?x[j.index]:void 0,metallicRoughnessTexture:U?x[U.index]:void 0},doubleSided:O,emissiveFactor:C,alphaMode:E,alphaCutoff:M,normalTexture:D?x[D.index]:void 0,occlusionTexture:I?x[I.index]:void 0,emissionTexture:P?x[P.index]:void 0,defined:b.defined===void 0}}(y!==void 0?t.json.materials[y]:{defined:!1},i),c._FEATURE_RGBA4444!==void 0&&(u.featureData=new Uint32Array(uu(t,t.json.accessors[c._FEATURE_RGBA4444]).buffer)),u}function KP(e,t,i){let{matrix:o,rotation:c,translation:u,scale:h,mesh:p,extras:f,children:g}=e,v={};if(v.matrix=o||ft.fromRotationTranslationScale([],c||[0,0,0,1],u||[0,0,0],h||[1,1,1]),p!==void 0){v.meshes=i[p];let y=v.anchor=[0,0];for(let b of v.meshes){let{min:x,max:C}=b.aabb;y[0]+=x[0]+C[0],y[1]+=x[1]+C[1]}y[0]=Math.floor(y[0]/v.meshes.length/2),y[1]=Math.floor(y[1]/v.meshes.length/2)}if(f&&(f.id&&(v.id=f.id),f.lights&&(v.lights=function(y){if(!y.length)return[];let b=function(D){let I=atob(D),P=new Uint8Array(I.length);for(let O=0;O<I.length;O++)P[O]=I.codePointAt(O);return P}(y),x=[],C=b.length/24,E=new Uint16Array(b.buffer),M=new Float32Array(b.buffer);for(let D=0;D<C;D++){let I=E[2*D*6]/30,P=E[2*D*6+1]/30,O=E[2*D*6+10]/100,R=M[6*D+1],F=M[6*D+2],z=M[6*D+3],j=M[6*D+4],U=z-R,G=j-F,$=Math.hypot(U,G);x.push({pos:[R+.5*U,F+.5*G,P],normal:[G/$,-U/$,0],width:$,height:I,depth:O,points:[R,F,z,j]})}return x}(f.lights))),g){let y=[];for(let b of g)y.push(KP(t.json.nodes[b],t,i));v.children=y}return v}function eq(e){if(e.vertices.length===0||e.indices.length===0)return null;let[t,i]=[e.vertices[0].clone(),e.vertices[0].clone()];for(let h=1;h<e.vertices.length;++h){let p=e.vertices[h];t.x=Math.min(t.x,p.x),t.y=Math.min(t.y,p.y),i.x=Math.max(i.x,p.x),i.y=Math.max(i.y,p.y)}let o=Math.ceil(Math.max(i.x-t.x,i.y-t.y)/256),c=Math.max(8,o),u=new XP(e.vertices,e.indices,c);return{vertices:e.vertices,indices:e.indices,grid:u,min:t,max:i}}function iq(e){if(!e.extras||!e.extras.ground)return null;let t=e.extras.ground;if(!t||!Array.isArray(t)||t.length===0)return null;let i=t[0];if(!i||!Array.isArray(i)||i.length===0)return null;let o=[];for(let h of i){if(!Array.isArray(h)||h.length!==2)continue;let p=h[0],f=h[1];typeof p=="number"&&typeof f=="number"&&o.push(new Q(p,f))}if(o.length<3)return null;o.length>1&&o[o.length-1].equals(o[0])&&o.pop();let c=0;for(let h=0;h<o.length;h++){let p=o[h],f=o[(h+1)%o.length],g=o[(h+2)%o.length];c+=(p.x-f.x)*(g.y-f.y)-(g.x-f.x)*(p.y-f.y)}c>0&&o.reverse();let u=r0(o.flatMap(h=>[h.x,h.y]),[]);return u.length===0?null:{vertices:o,indices:u}}function nq(e){let t=[],i=[],o=0;for(let c of e){o=t.length;let u=c.vertexArray.float32,h=c.indexArray.uint16;for(let p=0;p<c.vertexArray.length;p++)t.push(new Q(u[3*p+0],u[3*p+1]));for(let p=0;p<3*c.indexArray.length;p++)i.push(h[p]+o)}if(i.length%3!=0)return null;for(let c=0;c<i.length;c+=3){let u=t[i[c+0]],h=t[i[c+1]],p=t[i[c+2]];(u.x-h.x)*(p.y-h.y)-(p.x-h.x)*(u.y-h.y)>0&&([i[c+1],i[c+2]]=[i[c+2],i[c+1]])}return{vertices:t,indices:i}}function YC(e){let t=function(f,g){let v=[],y=m.WebGL2RenderingContext;if(f.json.textures)for(let b of f.json.textures){let x={magFilter:y.LINEAR,minFilter:y.NEAREST,wrapS:y.REPEAT,wrapT:y.REPEAT};b.sampler!==void 0&&Object.assign(x,f.json.samplers[b.sampler]),v.push({image:g[b.source],sampler:x,uploaded:!1})}return v}(e,e.images),i=function(f,g){let v=[];for(let y of f.json.meshes){let b=[];for(let x of y.primitives)b.push(tq(x,f,g));v.push(b)}return v}(e,t),{scenes:o,scene:c,nodes:u}=e.json,h=o?o[c||0].nodes:u,p=[];for(let f of h)p.push(KP(u[f],e,i));return function(f,g,v){let y={},b=new Set;for(let x=0;x<f.length;x++){let C=v[g[x]];if(!C.extras)continue;let E=C.extras["mapbox:footprint:version"],M=C.extras["mapbox:footprint:id"];(E||M)&&b.add(x),E==="1.0.0"&&M&&(y[M]=x)}for(let x=0;x<f.length;x++){if(b.has(x))continue;let C=f[x],E=v[g[x]];if(!E.extras)continue;let M=null;C.id in y&&(M=nq(f[y[C.id]].meshes)),M||(M=iq(E)),M&&(C.footprint=eq(M))}if(b.size>0){let x=Array.from(b.values()).sort((C,E)=>C-E);for(let C=x.length-1;C>=0;C--)f.splice(x[C],1)}}(p,h,e.json.nodes),p}function rq(e){e.heightmap=new Float32Array(4096),e.heightmap.fill(-1);let t=e.vertexArray.float32,i=e.aabb.min[0]-1,o=e.aabb.min[1]-1,c=lu/(e.aabb.max[0]-i+2),u=lu/(e.aabb.max[1]-o+2);for(let h=0;h<t.length;h+=3){let p=t[h+2],f=(t[h+0]-i)*c|0,g=(t[h+1]-o)*u|0;p>e.heightmap[g*lu+f]&&(e.heightmap[g*lu+f]=p)}}function oq(e,t){let i={};i.indexArray=new qr,i.indexArray.reserve(4*e.length),i.vertexArray=new eu,i.vertexArray.reserve(10*e.length),i.colorArray=new oc,i.vertexArray.reserve(10*e.length);let o=0;for(let h of e){let p=Math.min(10,Math.max(4,1.3*h.height))*t,f=[-h.normal[1],h.normal[0],0],g=Math.min(.29,.1*h.width/h.depth),v=h.width-2*h.depth*t*(g+.01),y=J.scaleAndAdd([],h.pos,f,v/2),b=J.scaleAndAdd([],h.pos,f,-v/2),x=[y[0],y[1],y[2]+h.height],C=[b[0],b[1],b[2]+h.height],E=J.scaleAndAdd([],h.normal,f,g);J.scale(E,E,p);let M=J.scaleAndAdd([],h.normal,f,-g);J.scale(M,M,p),J.add(E,y,E),J.add(M,b,M),y[2]+=.1,b[2]+=.1,i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(M[0],M[1],M[2]),i.vertexArray.emplaceBack(y[0],y[1],y[2]),i.vertexArray.emplaceBack(b[0],b[1],b[2]),i.vertexArray.emplaceBack(x[0],x[1],x[2]),i.vertexArray.emplaceBack(C[0],C[1],C[2]),i.vertexArray.emplaceBack(y[0],y[1],y[2]),i.vertexArray.emplaceBack(b[0],b[1],b[2]),i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(M[0],M[1],M[2]);let D=v/p/2;i.colorArray.emplaceBack(-D-g,-1,D,.8),i.colorArray.emplaceBack(D+g,-1,D,.8),i.colorArray.emplaceBack(-D,0,D,1.3),i.colorArray.emplaceBack(D,0,D,1.3),i.colorArray.emplaceBack(D+g,-.8,D,.7),i.colorArray.emplaceBack(D+g,-.8,D,.7),i.colorArray.emplaceBack(0,0,D,1.3),i.colorArray.emplaceBack(0,0,D,1.3),i.colorArray.emplaceBack(D+g,-1.2,D,.8),i.colorArray.emplaceBack(D+g,-1.2,D,.8),i.indexArray.emplaceBack(6+o,4+o,8+o),i.indexArray.emplaceBack(7+o,9+o,5+o),i.indexArray.emplaceBack(0+o,1+o,2+o),i.indexArray.emplaceBack(1+o,3+o,2+o),o+=10}let c={defined:!0,emissiveFactor:[0,0,0]},u={};return u.baseColorFactor=fi.white,c.pbrMetallicRoughness=u,i.material=c,i.aabb=new Ln([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}xe(XP,"TriangleGridIndex");let ZC={vector:jP,raster:BC,"raster-dem":class extends BC{constructor(e,t,i,o){super(e,t,i,o),this.type="raster-dem",this.maxzoom=22,this._options=ge({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(e,t){let i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function o(c,u){c&&(e.state="errored",t(c)),u&&(e.dem=u,e.dem.onDeserialize(),e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0,e.state="loaded",t(null))}e.request=mi(this.map._requestManager.transformRequest(i,Dt.Tile),(function(c,u,h,p){if(delete e.request,e.aborted)e.state="unloaded",t(null);else if(c)e.state="errored",t(c);else if(u){this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:h,expires:p});let g=m.ImageBitmap&&u instanceof m.ImageBitmap&&RT(),v=1-(u.width-((f=u.width)<=1?1:Math.pow(2,Math.floor(Math.log(f)/Math.LN2))))/2;v<1||e.neighboringTiles||(e.neighboringTiles=this._getNeighboringTiles(e.tileID));let y=g?u:ni.getImageData(u,v),b={uid:e.uid,coord:e.tileID,source:this.id,scope:this.scope,rawImageData:y,encoding:this.encoding,padding:v};e.actor&&e.state!=="expired"||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",b,o.bind(this),void 0,!0))}var f}).bind(this))}_getNeighboringTiles(e){let t=e.canonical,i=Math.pow(2,t.z),o=(t.x-1+i)%i,c=t.x===0?e.wrap-1:e.wrap,u=(t.x+1+i)%i,h=t.x+1===i?e.wrap+1:e.wrap,p={};return p[new Hi(e.overscaledZ,c,t.z,o,t.y).key]={backfilled:!1},p[new Hi(e.overscaledZ,h,t.z,u,t.y).key]={backfilled:!1},t.y>0&&(p[new Hi(e.overscaledZ,c,t.z,o,t.y-1).key]={backfilled:!1},p[new Hi(e.overscaledZ,e.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},p[new Hi(e.overscaledZ,h,t.z,u,t.y-1).key]={backfilled:!1}),t.y+1<i&&(p[new Hi(e.overscaledZ,c,t.z,o,t.y+1).key]={backfilled:!1},p[new Hi(e.overscaledZ,e.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},p[new Hi(e.overscaledZ,h,t.z,u,t.y+1).key]={backfilled:!1}),p}},geojson:class extends Hr{constructor(e,t,i,o){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(o),this._data=t.data,this._options=ge({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;let c=wt/this.tileSize;this.workerOptions=ge({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*c,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*c,extent:wt,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:wt,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*c,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterLeaves(e,t,i,o){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:e,limit:t,offset:i},o),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new qt("dataloading",{dataType:"source"})),this._loaded=!1;let e=ge({},this.workerOptions);e.scope=this.scope;let t=this._data;typeof t=="string"?(e.request=this.map._requestManager.transformRequest(ni.resolveURL(t),Dt.Source),e.request.collectResourceTiming=this._collectResourceTiming):e.data=JSON.stringify(t),this._pendingLoad=this.actor.send(`${this.type}.loadData`,e,(i,o)=>{if(this._loaded=!0,this._pendingLoad=null,i)this.fire(new Xe(i));else{let c={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&o&&o.resourceTiming&&o.resourceTiming[this.id]&&(c.resourceTiming=o.resourceTiming[this.id]),this.fire(new qt("data",c)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(e,t){let i=e.actor?"reloadTile":"loadTile";e.actor=this.actor;let o={type:this.type,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:ni.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};e.request=this.actor.send(i,o,(c,u)=>(delete e.request,e.destroy(),e.aborted?t(null):c?t(c):(e.loadVectorData(u,this.map.painter,i==="reloadTile"),t(null))),void 0,i==="loadTile")}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return ge({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends fa{constructor(e,t,i,o){super(e,t,i,o),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;let e=this.options;this.urls=[];for(let t of e.urls)this.urls.push(this.map._requestManager.transformRequest(t,Dt.Source).url);(function(t,i){let o=m.document.createElement("video");o.muted=!0,o.onloadstart=function(){i(null,o)};for(let c=0;c<t.length;c++){let u=m.document.createElement("source");se(t[c])||(o.crossOrigin="Anonymous"),u.src=t[c],o.appendChild(u)}})(this.urls,(t,i)=>{this._loaded=!0,t?this.fire(new Xe(t)):i&&(this.video=i,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){let t=this.video.seekable;e<t.start(0)||e>t.end(0)?this.fire(new Xe(new be(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let e=this.map.painter.context,t=e.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new ir(e,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(e)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:fa,model:class extends Hr{constructor(e,t,i,o){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){let e=[];for(let t in this._options.models){let i=this._options.models[t],o=ZP(this.map._requestManager.transformRequest(i.uri,Dt.Model).url).then(c=>{if(!c)return;let u=YC(c),h=new qR(t,i.position,i.orientation,u);h.computeBoundsAndApplyParent(),this.models.push(h)}).catch(c=>{this.fire(new Xe(new Error(`Could not load model ${t} from ${i.uri}: ${c.message}`)))});e.push(o)}return Promise.allSettled(e).then(()=>{this._loaded=!0,this.fire(new qt("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new Xe(new Error(`Could not load models: ${t.message}`)))})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,t){}serialize(){return{type:"model"}}},"batched-model":class extends Hr{constructor(e,t,i,o){super(),this.type="batched-model",this.id=e,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=i,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(o)}onAdd(e){this.map=e,this.load()}load(e){this._loaded=!1,this.fire(new qt("dataloading",{dataType:"source"}));let t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,i=this.map._worldview;this._tileJSONRequest=zC(this._options,this.map._requestManager,t,i,(o,c)=>{this._tileJSONRequest=null,this._loaded=!0,o?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),i&&i.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${i}`),this.fire(new Xe(o))):c&&(ge(this,c),c.bounds&&(this.tileBounds=new H0(c.bounds,this.minzoom,this.maxzoom)),Nx(c.tiles,this.map._requestManager._customAccessToken),this.fire(new qt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new qt("data",{dataType:"source",sourceDataType:"content"}))),e&&e(o)})}hasTransition(){return!1}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loaded(){return this._loaded}loadTile(e,t){let i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),o={request:this.map._requestManager.transformRequest(i,Dt.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(e.actor&&e.state!=="expired")if(e.state==="loading")e.reloadCallback=t;else{if(e.buckets){let u=Object.values(e.buckets);for(let h of u)h.dirty=!0;return void(e.state="loaded")}e.request=e.actor.send("reloadTile",o,c.bind(this))}else e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",o,c.bind(this),void 0,!0);function c(u,h){return e.aborted?t(null):u&&u.status!==404?t(u):(h&&(h.resourceTiming&&(e.resourceTiming=h.resourceTiming),this.map._refreshExpiredTiles&&e.setExpiryData(h),e.buckets=Gt(Gt({},e.buckets),h.buckets)),e.state="loaded",void t(null))}}serialize(){return ge({},this._options)}},canvas:class extends fa{constructor(e,t,i,o){super(e,t,i,o),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(c=>!Array.isArray(c)||c.length!==2||c.some(u=>typeof u!="number"))||this.fire(new Xe(new be(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new Xe(new be(`sources.${e}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new Xe(new be(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof m.HTMLCanvasElement||this.fire(new Xe(new be(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new Xe(new be(`sources.${e}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof m.HTMLCanvasElement?this.options.canvas:m.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new Xe(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let t=this.map.painter.context;this.texture?!e&&!this._playing||this.texture instanceof I0||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ir(t,this.canvas,t.gl.RGBA,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends Hr{constructor(e,t,i,o){super(),this.id=e,this.type="custom",this._dataType="raster",this._dispatcher=i,this._implementation=t,this.setEventedParent(o),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new Xe(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new Xe(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new H0(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),ge(this,Ho(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return Ho(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new qt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new qt("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(e){this._map=e,this._loaded=!1,this.fire(new qt("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(e),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){let{x:t,y:i,z:o}=e.canonical;return this._implementation.hasTile({x:t,y:i,z:o})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,t){let{x:i,y:o,z:c}=e.tileID.canonical,u=new m.AbortController;e.request=Promise.resolve(this._implementation.loadTile({x:i,y:o,z:c},{signal:u.signal})).then((function(h){return delete e.request,e.aborted?(e.state="unloaded",t(null)):h===void 0?(e.state="errored",t(null)):h===null?(this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",t(null)):function(p){return p instanceof m.ImageData||p instanceof m.HTMLCanvasElement||p instanceof m.ImageBitmap||p instanceof m.HTMLImageElement}(h)?(this.loadTileData(e,h),e.state="loaded",void t(null)):(e.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(h=>{h.code!==20&&(e.state="errored",t(h))}),e.request.cancel=()=>u.abort()}loadTileData(e,t){e.setTexture(t,this._map.painter)}unloadTile(e,t){if(e.texture&&e.texture instanceof ir?(e.destroy(!0),e.texture&&e.texture instanceof ir&&this._map.painter.saveTileTexture(e.texture)):e.destroy(),this._implementation.unloadTile){let{x:i,y:o,z:c}=e.tileID.canonical;this._implementation.unloadTile({x:i,y:o,z:c})}t()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z}))}_clearTiles(){let e=Yo(this.id,this.scope);this._map.style.clearSource(e)}_update(){this.fire(new qt("data",{dataType:"source",sourceDataType:"content"}))}}},XC=function(e,t,i,o){let c=new ZC[t.type](e,t,i,o);if(c.id!==e)throw new Error(`Expected Source id to be ${e} instead of ${c.id}`);return _o(["load","abort","unload","serialize","prepare"],c),c};function sq(e,t){let i=ft.identity([]);return ft.scale(i,i,[.5*e.width,.5*-e.height,1]),ft.translate(i,i,[1,-1,0]),ft.multiply(i,i,e.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(i)}function aq(e,t,i,o,c,u,h,p=!1){let f=e.tilesIn(o,h,p);f.sort(QP);let g=[];for(let y of f)g.push({wrappedTileID:y.tile.tileID.wrapped().key,queryResults:y.tile.queryRenderedFeatures(t,i,e._state,y,c,u,sq(e.transform,y.tile.tileID),p)});let v=function(y){let b={},x={};for(let C of y){let E=C.queryResults,M=C.wrappedTileID,D=x[M]=x[M]||{};for(let I in E){let P=E[I],O=D[I]=D[I]||{},R=b[I]=b[I]||[];for(let F of P)O[F.featureIndex]||(O[F.featureIndex]=!0,R.push(F))}}return b}(g);for(let y in v)v[y].forEach(b=>{let x=b.feature,C=x.layer;C&&C.type!=="background"&&C.type!=="sky"&&C.type!=="slot"&&(x.source=C.source,C["source-layer"]&&(x.sourceLayer=C["source-layer"]),x.state=x.id!==void 0?e.getFeatureState(C["source-layer"],x.id):{})});return v}function lq(e,t){let i=e.getRenderableIds().map(u=>e.getTileByID(u)),o=[],c={};for(let u=0;u<i.length;u++){let h=i[u],p=h.tileID.canonical.key;c[p]||(c[p]=!0,h.querySourceFeatures(o,t))}return o}function QP(e,t){let i=e.tileID,o=t.tileID;return i.overscaledZ-o.overscaledZ||i.canonical.y-o.canonical.y||i.wrap-o.wrap||i.canonical.x-o.canonical.x}class cq{constructor(t){this.style=t}processLayersChanged(){this.layers=[];for(let t in this.style._mergedLayers){let i=this.style._mergedLayers[t];if(i.type==="fill-extrusion")this.layers.push(i);else if(i.type==="model"){let o=this.style.getLayerSource(i);o&&o.type==="batched-model"&&this.layers.push(i)}}}updateZOffset(t,i){this.currentBuildingBuckets=[];for(let c=0;c<this.layers.length;++c){let u=this.layers[c],h=this.style.getLayerSourceCache(u),p=1;u.type==="fill-extrusion"&&(p=u.paint.get("fill-extrusion-opacity")>0?u.paint.get("fill-extrusion-vertical-scale"):0);let f=h?h.getTile(i):null;if(!f&&h&&i.canonical.z>h.getSource().minzoom){let g=i.scaledTo(Math.min(h.getSource().maxzoom,i.overscaledZ-1));for(;g.overscaledZ>=h.getSource().minzoom&&(f=h.getTile(g),!f&&g.overscaledZ!==0);)g=g.scaledTo(g.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:f?f.getBucket(u):null,tileID:f?f.tileID:i,verticalScale:p})}t.hasAnyZOffset=!1;let o=!1;for(let c=0;c<t.symbolInstances.length;c++){let u=t.symbolInstances.get(c),h=u.zOffset,p=this._getHeightAtTileOffset(i,u.tileAnchorX,u.tileAnchorY);u.zOffset=p!==-1?p:h,o||h===u.zOffset||(o=!0),t.hasAnyZOffset||u.zOffset===0||(t.hasAnyZOffset=!0)}o&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,i,o,c){let u=i,h=o;if(t.canonical.z!==c.canonical.z){let p=c.canonical,f=1/(1<<t.canonical.z-p.z);u=(i+t.canonical.x*wt)*f-p.x*wt|0,h=(o+t.canonical.y*wt)*f-p.y*wt|0}return{tileX:u,tileY:h}}_getHeightAtTileOffset(t,i,o){let c;for(let u=0;u<this.layers.length;++u){if(this.layers[u].type!=="fill-extrusion")continue;let{bucket:h,tileID:p,verticalScale:f}=this.currentBuildingBuckets[u];if(!h)continue;let{tileX:g,tileY:v}=this._mapCoordToOverlappingTile(t,i,o,p),y=h.getHeightAtTileCoord(g,v);if(y&&y.height!==void 0){if(!y.hidden)return y.height*f;c=y.height}}for(let u=0;u<this.layers.length;++u){if(this.layers[u].type!=="model")continue;let{bucket:h,tileID:p}=this.currentBuildingBuckets[u];if(!h)continue;let{tileX:f,tileY:g}=this._mapCoordToOverlappingTile(t,i,o,p),v=h.getHeightAtTileCoord(f,g);if(v&&!v.hidden)return v.height===void 0&&c!==void 0?Math.min(v.maxHeight,c)*v.verticalScale:(v.height||0)*v.verticalScale}return-1}}var JP=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function dq(e,t){let i={};for(let o in e)o!=="ref"&&(i[o]=e[o]);return JP.forEach(o=>{o in t&&(i[o]=t[o])}),i}function tO(e){e=e.slice();let t=Object.create(null);for(let i=0;i<e.length;i++)t[e[i].id]=e[i];for(let i=0;i<e.length;i++)"ref"in e[i]&&(e[i]=dq(e[i],t[e[i].ref]));return e}let Zi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function eO(e,t,i){i.push({command:Zi.addSource,args:[e,t[e]]})}function iO(e,t,i){t.push({command:Zi.removeSource,args:[e]}),i[e]=!0}function uq(e,t,i,o){iO(e,i,o),eO(e,t,i)}function hq(e,t,i){let o;for(o in e[i])if(e[i].hasOwnProperty(o)&&o!=="data"&&!$t(e[i][o],t[i][o]))return!1;for(o in t[i])if(t[i].hasOwnProperty(o)&&o!=="data"&&!$t(e[i][o],t[i][o]))return!1;return!0}function q0(e,t,i,o,c,u){let h;for(h in t=t||{},e=e||{})e.hasOwnProperty(h)&&($t(e[h],t[h])||i.push({command:u,args:[o,h,t[h],c]}));for(h in t)t.hasOwnProperty(h)&&!e.hasOwnProperty(h)&&($t(e[h],t[h])||i.push({command:u,args:[o,h,t[h],c]}))}function W0(e){return e.id}function $0(e,t){return e[t.id]=t,e}class mq{constructor(t,i){this.reset(t,i)}reset(t,i){this.points=t||[],this._distances=[0];for(let o=1;o<this.points.length;o++)this._distances[o]=this._distances[o-1]+this.points[o].dist(this.points[o-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(i||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=ve(t,0,1);let i=1,o=this._distances[i],c=t*this.paddedLength+this.padding;for(;o<c&&i<this._distances.length;)o=this._distances[++i];let u=i-1,h=this._distances[u],p=o-h,f=p>0?(c-h)/p:0;return this.points[u].mult(1-f).add(this.points[i].mult(f))}}class nO{constructor(t,i,o){let c=this.boxCells=[],u=this.circleCells=[];this.xCellCount=Math.ceil(t/o),this.yCellCount=Math.ceil(i/o);for(let h=0;h<this.xCellCount*this.yCellCount;h++)c.push([]),u.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=i,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/i,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,i,o,c,u){this._forEachCell(i,o,c,u,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(u)}insertCircle(t,i,o,c){this._forEachCell(i-c,o-c,i+c,o+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(i),this.circles.push(o),this.circles.push(c)}_insertBoxCell(t,i,o,c,u,h){this.boxCells[u].push(h)}_insertCircleCell(t,i,o,c,u,h){this.circleCells[u].push(h)}_query(t,i,o,c,u,h){if(o<0||t>this.width||c<0||i>this.height)return!u&&[];let p=[];if(t<=0&&i<=0&&this.width<=o&&this.height<=c){if(u)return!0;for(let f=0;f<this.boxKeys.length;f++)p.push({key:this.boxKeys[f],x1:this.bboxes[4*f],y1:this.bboxes[4*f+1],x2:this.bboxes[4*f+2],y2:this.bboxes[4*f+3]});for(let f=0;f<this.circleKeys.length;f++){let g=this.circles[3*f],v=this.circles[3*f+1],y=this.circles[3*f+2];p.push({key:this.circleKeys[f],x1:g-y,y1:v-y,x2:g+y,y2:v+y})}return h?p.filter(h):p}return this._forEachCell(t,i,o,c,this._queryCell,p,{hitTest:u,seenUids:{box:{},circle:{}}},h),u?p.length>0:p}_queryCircle(t,i,o,c,u){let h=t-o,p=t+o,f=i-o,g=i+o;if(p<0||h>this.width||g<0||f>this.height)return!c&&[];let v=[];return this._forEachCell(h,f,p,g,this._queryCellCircle,v,{hitTest:c,circle:{x:t,y:i,radius:o},seenUids:{box:{},circle:{}}},u),c?v.length>0:v}query(t,i,o,c,u){return this._query(t,i,o,c,!1,u)}hitTest(t,i,o,c,u){return this._query(t,i,o,c,!0,u)}hitTestCircle(t,i,o,c){return this._queryCircle(t,i,o,!0,c)}_queryCell(t,i,o,c,u,h,p,f){let g=p.seenUids,v=this.boxCells[u];if(v!==null){let b=this.bboxes;for(let x of v)if(!g.box[x]){g.box[x]=!0;let C=4*x;if(t<=b[C+2]&&i<=b[C+3]&&o>=b[C+0]&&c>=b[C+1]&&(!f||f(this.boxKeys[x]))){if(p.hitTest)return h.push(!0),!0;h.push({key:this.boxKeys[x],x1:b[C],y1:b[C+1],x2:b[C+2],y2:b[C+3]})}}}let y=this.circleCells[u];if(y!==null){let b=this.circles;for(let x of y)if(!g.circle[x]){g.circle[x]=!0;let C=3*x;if(this._circleAndRectCollide(b[C],b[C+1],b[C+2],t,i,o,c)&&(!f||f(this.circleKeys[x]))){if(p.hitTest)return h.push(!0),!0;{let E=b[C],M=b[C+1],D=b[C+2];h.push({key:this.circleKeys[x],x1:E-D,y1:M-D,x2:E+D,y2:M+D})}}}}}_queryCellCircle(t,i,o,c,u,h,p,f){let g=p.circle,v=p.seenUids,y=this.boxCells[u];if(y!==null){let x=this.bboxes;for(let C of y)if(!v.box[C]){v.box[C]=!0;let E=4*C;if(this._circleAndRectCollide(g.x,g.y,g.radius,x[E+0],x[E+1],x[E+2],x[E+3])&&(!f||f(this.boxKeys[C])))return h.push(!0),!0}}let b=this.circleCells[u];if(b!==null){let x=this.circles;for(let C of b)if(!v.circle[C]){v.circle[C]=!0;let E=3*C;if(this._circlesCollide(x[E],x[E+1],x[E+2],g.x,g.y,g.radius)&&(!f||f(this.circleKeys[C])))return h.push(!0),!0}}}_forEachCell(t,i,o,c,u,h,p,f){let g=this._convertToXCellCoord(t),v=this._convertToYCellCoord(i),y=this._convertToXCellCoord(o),b=this._convertToYCellCoord(c);for(let x=g;x<=y;x++)for(let C=v;C<=b;C++)if(u.call(this,t,i,o,c,this.xCellCount*C+x,h,p,f))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,i,o,c,u,h){let p=c-t,f=u-i,g=o+h;return g*g>p*p+f*f}_circleAndRectCollide(t,i,o,c,u,h,p){let f=(h-c)/2,g=Math.abs(t-(c+f));if(g>f+o)return!1;let v=(p-u)/2,y=Math.abs(i-(u+v));if(y>v+o)return!1;if(g<=f||y<=v)return!0;let b=g-f,x=y-v;return b*b+x*x<=o*o}}let Rl=100;class pq{constructor(t,i,o=new nO(t.width+200,t.height+200,25),c=new nO(t.width+200,t.height+200,25)){this.transform=t,this.grid=o,this.ignoredGrid=c,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Rl,this.screenBottomBoundary=t.height+Rl,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=i}placeCollisionBox(t,i,o,c,u,h,p,f){let g=o.projectedAnchorX,v=o.projectedAnchorY,y=o.projectedAnchorZ,b=o.elevation,x=o.tileID,C=t.getProjection();if(b&&x){let[F,z,j]=C.upVector(x.canonical,o.tileAnchorX,o.tileAnchorY),U=C.upVectorScale(x.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;g+=F*b*U,v+=z*b*U,y+=j*b*U}let E=this.projectAndGetPerspectiveRatio(p,g,v,y,o.tileID,C.name==="globe"||!!b||this.transform.pitch>0,C),M=h*E.perspectiveRatio,D=(o.x1*i+c.x-o.padding)*M+E.point.x,I=(o.y1*i+c.y-o.padding)*M+E.point.y,P=(o.x2*i+c.x+o.padding)*M+E.point.x,O=(o.y2*i+c.y+o.padding)*M+E.point.y,R=E.perspectiveRatio<=.55||E.occluded;return!this.isInsideGrid(D,I,P,O)||!u&&this.grid.hitTest(D,I,P,O,f)||R?{box:[],offscreen:!1,occluded:E.occluded}:{box:[D,I,P,O],offscreen:this.isOffscreen(D,I,P,O),occluded:!1}}placeCollisionCircles(t,i,o,c,u,h,p,f,g,v,y,b,x,C,E){let M=[],D=this.transform.elevation,I=t.getProjection(),P=D?D.getAtTileOffsetFunc(E,this.transform.center.lat,this.transform.worldSize,I):null,O=new Q(o.tileAnchorX,o.tileAnchorY),{x:R,y:F,z}=I.projectTilePoint(O.x,O.y,E.canonical);if(P){let[pt,nt,ot]=P(O);R+=pt,F+=nt,z+=ot}let j=I.name==="globe",U=this.projectAndGetPerspectiveRatio(p,R,F,z,E,j||!!D||this.transform.pitch>0,I),{perspectiveRatio:G}=U,$=(y?h/G:h*G)/Co,Y=tl(R,F,z,f),tt=U.signedDistanceFromCamera>0?FR($,u,o.lineOffsetX*$,o.lineOffsetY*$,!1,Y,O,o,c,f,{},D&&!y?P:null,y&&!!D,I,E,y):null,W=!1,rt=!1,st=!0;if(tt&&!U.occluded){let pt=.5*x*G+C,nt=new Q(-100,-100),ot=new Q(this.screenRightBoundary,this.screenBottomBoundary),_t=new mq,{first:bt,last:yt}=tt,Ct=bt.path.length,St=[];for(let Ft=Ct-1;Ft>=1;Ft--)St.push(bt.path[Ft]);for(let Ft=1;Ft<yt.path.length;Ft++)St.push(yt.path[Ft]);let Tt=2.5*pt;g&&(St=St.map(([Ft,Qt,Jt],le)=>(P&&!j&&(Jt=P(le<Ct-1?bt.tilePath[Ct-1-le]:yt.tilePath[le-Ct+2])[2]),tl(Ft,Qt,Jt,g))),St.some(Ft=>Ft[3]<=0)&&(St=[]));let xt=[];if(St.length>0){let Ft=1/0,Qt=-1/0,Jt=1/0,le=-1/0;for(let me of St)Ft=Math.min(Ft,me[0]),Jt=Math.min(Jt,me[1]),Qt=Math.max(Qt,me[0]),le=Math.max(le,me[1]);Qt>=nt.x&&Ft<=ot.x&&le>=nt.y&&Jt<=ot.y&&(xt=[St.map(me=>new Q(me[0],me[1]))],(Ft<nt.x||Qt>ot.x||Jt<nt.y||le>ot.y)&&(xt=nR(xt,nt.x,nt.y,ot.x,ot.y)))}for(let Ft of xt){_t.reset(Ft,.25*pt);let Qt=0;Qt=_t.length<=.5*pt?1:Math.ceil(_t.paddedLength/Tt)+1;for(let Jt=0;Jt<Qt;Jt++){let le=Jt/Math.max(Qt-1,1),me=_t.lerp(le),Ue=me.x+Rl,Ie=me.y+Rl;M.push(Ue,Ie,pt,0);let Bi=Ue-pt,Ci=Ie-pt,He=Ue+pt,Ne=Ie+pt;if(st=st&&this.isOffscreen(Bi,Ci,He,Ne),rt=rt||this.isInsideGrid(Bi,Ci,He,Ne),!i&&this.grid.hitTestCircle(Ue,Ie,pt,b)&&(W=!0,!v))return{circles:[],offscreen:!1,collisionDetected:W,occluded:!1}}}}return{circles:!v&&W||!rt?[]:M,offscreen:st,collisionDetected:W,occluded:U.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let i=[],o=1/0,c=1/0,u=-1/0,h=-1/0;for(let v of t){let y=new Q(v.x+Rl,v.y+Rl);o=Math.min(o,y.x),c=Math.min(c,y.y),u=Math.max(u,y.x),h=Math.max(h,y.y),i.push(y)}let p=this.grid.query(o,c,u,h).concat(this.ignoredGrid.query(o,c,u,h)),f={},g={};for(let v of p){let y=v.key;f[y.bucketInstanceId]===void 0&&(f[y.bucketInstanceId]={}),f[y.bucketInstanceId][y.featureIndex]||ak(i,[new Q(v.x1,v.y1),new Q(v.x2,v.y1),new Q(v.x2,v.y2),new Q(v.x1,v.y2)])&&(f[y.bucketInstanceId][y.featureIndex]=!0,g[y.bucketInstanceId]===void 0&&(g[y.bucketInstanceId]=[]),g[y.bucketInstanceId].push(y.featureIndex))}return g}insertCollisionBox(t,i,o,c,u){(i?this.ignoredGrid:this.grid).insert({bucketInstanceId:o,featureIndex:c,collisionGroupID:u},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,i,o,c,u){let h=i?this.ignoredGrid:this.grid,p={bucketInstanceId:o,featureIndex:c,collisionGroupID:u};for(let f=0;f<t.length;f+=4)h.insertCircle(p,t[f],t[f+1],t[f+2])}projectAndGetPerspectiveRatio(t,i,o,c,u,h,p){let f=[i,o,c,1],g=!1;c||this.transform.pitch>0?(un.transformMat4(f,f,t),this.fogState&&u&&p.name!=="globe"&&(g=function(b,x,C,E,M,D){let I=D.calculateFogTileMatrix(M),P=[x,C,E];return J.transformMat4(P,P,I),j0(b,J.length(P),D.pitch,D._fov)}(this.fogState,i,o,c,u.toUnwrapped(),this.transform)>.9)):VR(f,f,t);let v=f[3];return{point:new Q((f[0]/v+1)/2*this.transform.width+Rl,(-f[1]/v+1)/2*this.transform.height+Rl),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(p)/v*.5,1.5),signedDistanceFromCamera:v,occluded:h&&f[2]>v||g}}isOffscreen(t,i,o,c){return o<Rl||t>=this.screenRightBoundary||c<Rl||i>this.screenBottomBoundary}isInsideGrid(t,i,o,c){return o>=0&&t<this.gridRightBoundary&&c>=0&&i<this.gridBottomBoundary}getViewportMatrix(){let t=ft.identity([]);return ft.translate(t,t,[-100,-100,0]),t}}function KC(e,t,i){let o=t.createTileMatrix(e,e.worldSize,i.toUnwrapped());return ft.multiply(new Float32Array(16),e.projMatrix,o)}function fq(e,t,i){if(t.projection.name===i.projection.name)return e.projMatrix;let o=i.clone();return o.setProjection(t.projection),KC(o,t.getProjection(),e)}function QC(e,t,i){return t.name===i.projection.name?e.projMatrix:KC(i,t,e)}class rO{constructor(t,i,o,c){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?i:-i))):c&&o?1:0,this.placed=o}isHidden(){return this.opacity===0&&!this.placed}}class cf{constructor(t,i,o,c,u,h=!1){this.text=new rO(t?t.text:null,i,o,u),this.icon=new rO(t?t.icon:null,i,c,u),this.clipped=h}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class JC{constructor(t,i,o,c=!1){this.text=t,this.icon=i,this.skipFade=o,this.clipped=c}}class gq{constructor(){this.invProjMatrix=ft.create(),this.viewportMatrix=ft.create(),this.circles=[]}}class _q{constructor(t,i,o,c,u){this.bucketInstanceId=t,this.featureIndex=i,this.sourceLayerIndex=o,this.bucketIndex=c,this.tileID=u}}class vq{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){let i=++this.maxGroupID;this.collisionGroups[t]={ID:i,predicate:o=>o.collisionGroupID===i}}return this.collisionGroups[t]}}function oO(e,t,i,o,c){let{horizontalAlign:u,verticalAlign:h}=p0(e),p=-(u-.5)*t,f=-(h-.5)*i,g=gC(e,o);return new Q(p+g[0]*c,f+g[1]*c)}function tS(e,t,i,o,c){let u=new Q(e,t);return i&&u._rotate(o?c:-c),u}class yq{constructor(t,i,o,c,u,h){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new pq(this.transform,u),this.buildingIndex=h,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=i,this.retainedQueryData={},this.collisionGroups=new vq(o),this.collisionCircleArrays={},this.prevPlacement=c,c&&(c.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,i,o,c){let u=o.getBucket(i),h=o.latestFeatureIndex;if(!u||!h||i.fqid!==u.layerIds[0])return;let p=u.layers[0].layout,f=o.collisionBoxArray,g=Math.pow(2,this.transform.zoom-o.tileID.overscaledZ),v=o.tileSize/wt,y=o.tileID.toUnwrapped();this.transform.setProjection(u.projection);let b=(x=o.tileID,C=u.getProjection(),E=this.transform,C.name===this.projection?E.calculateProjMatrix(x.toUnwrapped()):KC(E,C,x));var x,C,E;let M=p.get("text-pitch-alignment")==="map",D=p.get("text-rotation-alignment")==="map";i.compileFilter();let I=i.dynamicFilter(),P=i.dynamicFilterNeedsFeature(),O=this.transform.calculatePixelsToTileUnitsMatrix(o),R=RR(b,o.tileID.canonical,M,D,this.transform,u.getProjection(),O),F=null;if(M){let U=PR(b,o.tileID.canonical,M,D,this.transform,u.getProjection(),O);F=ft.multiply([],this.transform.labelPlaneMatrix,U)}let z=null;I&&o.latestFeatureIndex&&(z={unwrappedTileID:y,dynamicFilter:I,dynamicFilterNeedsFeature:P,featureIndex:o.latestFeatureIndex}),this.retainedQueryData[u.bucketInstanceId]=new _q(u.bucketInstanceId,h,u.sourceLayerIndex,u.index,o.tileID);let j={bucket:u,layout:p,posMatrix:b,textLabelPlaneMatrix:R,labelToScreenMatrix:F,clippingData:z,scale:g,textPixelRatio:v,holdingForFade:o.holdingForFade(),collisionBoxArray:f,partiallyEvaluatedTextSize:Tl(u.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:Tl(u.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(u.sourceID)};if(c)for(let U of u.sortKeyRanges){let{sortKey:G,symbolInstanceStart:$,symbolInstanceEnd:Y}=U;t.push({sortKey:G,symbolInstanceStart:$,symbolInstanceEnd:Y,parameters:j})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:u.symbolInstances.length,parameters:j})}attemptAnchorPlacement(t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M,D,I){let{textOffset0:P,textOffset1:O,crossTileID:R}=b,F=[P,O],z=oO(t,o,c,F,u),j=this.collisionIndex.placeCollisionBox(C,u,i,tS(z.x,z.y,h,p,this.transform.angle),y,f,g,v.predicate);if(M){let U=C.getSymbolInstanceIconSize(I,this.transform.zoom,b.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(C,U,M,tS(z.x,z.y,h,p,this.transform.angle),y,f,g,v.predicate).box.length===0)return}if(j.box.length>0){let U;return this.prevPlacement&&this.prevPlacement.variableOffsets[R]&&this.prevPlacement.placements[R]&&this.prevPlacement.placements[R].text&&(U=this.prevPlacement.variableOffsets[R].anchor),this.variableOffsets[R]={textOffset:F,width:o,height:c,anchor:t,textScale:u,prevAnchor:U},this.markUsedJustification(C,t,b,E),C.allowVerticalPlacement&&(this.markUsedOrientation(C,E,b),this.placedOrientations[R]=E),{shift:z,placedGlyphBoxes:j}}}placeLayerBucketPart(t,i,o,c){let{bucket:u,layout:h,posMatrix:p,textLabelPlaneMatrix:f,labelToScreenMatrix:g,clippingData:v,textPixelRatio:y,holdingForFade:b,collisionBoxArray:x,partiallyEvaluatedTextSize:C,partiallyEvaluatedIconSize:E,collisionGroup:M}=t.parameters,D=h.get("text-optional"),I=h.get("icon-optional"),P=h.get("text-allow-overlap"),O=h.get("icon-allow-overlap"),R=h.get("text-rotation-alignment")==="map",F=h.get("text-pitch-alignment")==="map",z=h.get("symbol-z-order")==="viewport-y",j=h.get("symbol-z-elevate");this.transform.setProjection(u.projection);let U=P&&(O||!u.hasIconData()||I),G=O&&(P||!u.hasTextData()||D);!u.collisionArrays&&x&&u.deserializeCollisionBoxes(x),o&&c&&u.updateCollisionDebugBuffers(this.transform.zoom,x);let $=(Y,tt,W)=>{let{crossTileID:rt,numVerticalGlyphVertices:st}=Y;if(v){let He={zoom:this.transform.zoom,pitch:this.transform.pitch},Ne=null;if(v.dynamicFilterNeedsFeature){let ke=this.retainedQueryData[u.bucketInstanceId];Ne=v.featureIndex.loadFeature({featureIndex:Y.featureIndex,bucketIndex:ke.bucketIndex,sourceLayerIndex:ke.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,v.dynamicFilter)(He,Ne,this.retainedQueryData[u.bucketInstanceId].tileID.canonical,new Q(Y.tileAnchorX,Y.tileAnchorY),this.transform.calculateDistanceTileData(v.unwrappedTileID)))return this.placements[rt]=new JC(!1,!1,!1,!0),void i.add(rt)}if(i.has(rt))return;if(b)return void(this.placements[rt]=new JC(!1,!1,!1));let pt=!1,nt=!1,ot=!0,_t=!1,bt=!1,yt=null,Ct={box:null,offscreen:null,occluded:null},St={box:null,offscreen:null,occluded:null},Tt=null,xt=null,Ft=null,Qt=0,Jt=0,le=0;W.textFeatureIndex?Qt=W.textFeatureIndex:Y.useRuntimeCollisionCircles&&(Qt=Y.featureIndex),W.verticalTextFeatureIndex&&(Jt=W.verticalTextFeatureIndex);let me=He=>{He.tileID=this.retainedQueryData[u.bucketInstanceId].tileID;let Ne=this.transform.elevation;He.elevation=Y.zOffset+(Ne?Ne.getAtTileOffset(He.tileID,He.tileAnchorX,He.tileAnchorY):0)},Ue=W.textBox;if(Ue){me(Ue);let He=ke=>{let Di=Kn.horizontal;if(u.allowVerticalPlacement&&!ke&&this.prevPlacement){let zi=this.prevPlacement.placedOrientations[rt];zi&&(this.placedOrientations[rt]=zi,Di=zi,this.markUsedOrientation(u,Di,Y))}return Di},Ne=(ke,Di)=>{if(u.allowVerticalPlacement&&st>0&&W.verticalTextBox){for(let zi of u.writingModes)if(zi===Kn.vertical?(Ct=Di(),St=Ct):Ct=ke(),Ct&&Ct.box&&Ct.box.length)break}else Ct=ke()};if(h.get("text-variable-anchor")){let ke=h.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[rt]){let pi=this.prevPlacement.variableOffsets[rt];ke.indexOf(pi.anchor)>0&&(ke=ke.filter(vn=>vn!==pi.anchor),ke.unshift(pi.anchor))}let Di=(pi,vn,Mr)=>{let hn=u.getSymbolInstanceTextSize(C,Y,this.transform.zoom,tt),zn=(pi.x2-pi.x1)*hn+2*pi.padding,Lr=(pi.y2-pi.y1)*hn+2*pi.padding,Dr=Y.hasIconTextFit&&!O?vn:null;Dr&&me(Dr);let Gn={box:[],offscreen:!1,occluded:!1},an=P?2*ke.length:ke.length;for(let ko=0;ko<an;++ko){let Ol=this.attemptAnchorPlacement(ke[ko%ke.length],pi,zn,Lr,hn,R,F,y,p,M,ko>=ke.length,Y,tt,u,Mr,Dr,C,E);if(Ol&&(Gn=Ol.placedGlyphBoxes,Gn&&Gn.box&&Gn.box.length)){pt=!0,yt=Ol.shift;break}}return Gn};Ne(()=>Di(Ue,W.iconBox,Kn.horizontal),()=>{let pi=W.verticalTextBox;return pi&&me(pi),u.allowVerticalPlacement&&!(Ct&&Ct.box&&Ct.box.length)&&st>0&&pi?Di(pi,W.verticalIconBox,Kn.vertical):{box:null,offscreen:null,occluded:null}}),Ct&&(pt=Ct.box,ot=Ct.offscreen,_t=Ct.occluded);let zi=He(!(!Ct||!Ct.box));if(!pt&&this.prevPlacement){let pi=this.prevPlacement.variableOffsets[rt];pi&&(this.variableOffsets[rt]=pi,this.markUsedJustification(u,pi.anchor,Y,zi))}}else{let ke=(Di,zi)=>{let pi=u.getSymbolInstanceTextSize(C,Y,this.transform.zoom,tt),vn=this.collisionIndex.placeCollisionBox(u,pi,Di,new Q(0,0),P,y,p,M.predicate);return vn&&vn.box&&vn.box.length&&(this.markUsedOrientation(u,zi,Y),this.placedOrientations[rt]=zi),vn};Ne(()=>ke(Ue,Kn.horizontal),()=>{let Di=W.verticalTextBox;return u.allowVerticalPlacement&&st>0&&Di?(me(Di),ke(Di,Kn.vertical)):{box:null,offscreen:null,occluded:null}}),He(!!(Ct&&Ct.box&&Ct.box.length))}}if(Tt=Ct,pt=Tt&&Tt.box&&Tt.box.length>0,ot=Tt&&Tt.offscreen,_t=Tt&&Tt.occluded,Y.useRuntimeCollisionCircles){let He=u.text.placedSymbolArray.get(Y.centerJustifiedTextSymbolIndex>=0?Y.centerJustifiedTextSymbolIndex:Y.verticalPlacedTextSymbolIndex),Ne=Vp(u.textSizeData,C,He),ke=h.get("text-padding");xt=this.collisionIndex.placeCollisionCircles(u,P,He,u.lineVertexArray,u.glyphOffsetArray,Ne,p,f,g,o,F,M.predicate,Y.collisionCircleDiameter*Ne/Co,ke,this.retainedQueryData[u.bucketInstanceId].tileID),pt=P||xt.circles.length>0&&!xt.collisionDetected,ot=ot&&xt.offscreen,_t=xt.occluded}if(W.iconFeatureIndex&&(le=W.iconFeatureIndex),W.iconBox){let He=Ne=>{me(Ne);let ke=Y.hasIconTextFit&&yt?tS(yt.x,yt.y,R,F,this.transform.angle):new Q(0,0),Di=u.getSymbolInstanceIconSize(E,this.transform.zoom,Y.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(u,Di,Ne,ke,O,y,p,M.predicate)};St&&St.box&&St.box.length&&W.verticalIconBox?(Ft=He(W.verticalIconBox),nt=Ft.box.length>0):(Ft=He(W.iconBox),nt=Ft.box.length>0),ot=ot&&Ft.offscreen,bt=Ft.occluded}let Ie=D||Y.numHorizontalGlyphVertices===0&&st===0,Bi=I||Y.numIconVertices===0;if(Ie||Bi?Bi?Ie||(nt=nt&&pt):pt=nt&&pt:nt=pt=nt&&pt,pt&&Tt&&Tt.box&&this.collisionIndex.insertCollisionBox(Tt.box,h.get("text-ignore-placement"),u.bucketInstanceId,St&&St.box&&Jt?Jt:Qt,M.ID),nt&&Ft&&this.collisionIndex.insertCollisionBox(Ft.box,h.get("icon-ignore-placement"),u.bucketInstanceId,le,M.ID),xt&&(pt&&this.collisionIndex.insertCollisionCircles(xt.circles,h.get("text-ignore-placement"),u.bucketInstanceId,Qt,M.ID),o)){let He=u.bucketInstanceId,Ne=this.collisionCircleArrays[He];Ne===void 0&&(Ne=this.collisionCircleArrays[He]=new gq);for(let ke=0;ke<xt.circles.length;ke+=4)Ne.circles.push(xt.circles[ke+0]),Ne.circles.push(xt.circles[ke+1]),Ne.circles.push(xt.circles[ke+2]),Ne.circles.push(xt.collisionDetected?1:0)}let Ci=u.projection.name!=="globe";U=U&&(Ci||!_t),G=G&&(Ci||!bt),this.placements[rt]=new JC(pt||U,nt||G,ot||u.justReloaded),i.add(rt)};if(j&&this.buildingIndex&&(this.buildingIndex.updateZOffset(u,this.retainedQueryData[u.bucketInstanceId].tileID),u.updateZOffset()),z){let Y=u.getSortedSymbolIndexes(this.transform.angle);for(let tt=Y.length-1;tt>=0;--tt){let W=Y[tt];$(u.symbolInstances.get(W),W,u.collisionArrays[W])}u.hasAnyZOffset&&lt(`${u.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(u.hasAnyZOffset){let Y=u.getSortedIndexesByZOffset();for(let tt=0;tt<Y.length;++tt){let W=Y[tt];$(u.symbolInstances.get(W),W,u.collisionArrays[W])}}else for(let Y=t.symbolInstanceStart;Y<t.symbolInstanceEnd;Y++)$(u.symbolInstances.get(Y),Y,u.collisionArrays[Y]);if(o&&u.bucketInstanceId in this.collisionCircleArrays){let Y=this.collisionCircleArrays[u.bucketInstanceId];ft.invert(Y.invProjMatrix,p),Y.viewportMatrix=this.collisionIndex.getViewportMatrix()}u.justReloaded=!1}markUsedJustification(t,i,o,c){let{leftJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:h,rightJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:f,crossTileID:g}=o,v=_C(i),y=c===Kn.vertical?f:v==="left"?u:v==="center"?h:v==="right"?p:-1;u>=0&&(t.text.placedSymbolArray.get(u).crossTileID=y>=0&&u!==y?0:g),h>=0&&(t.text.placedSymbolArray.get(h).crossTileID=y>=0&&h!==y?0:g),p>=0&&(t.text.placedSymbolArray.get(p).crossTileID=y>=0&&p!==y?0:g),f>=0&&(t.text.placedSymbolArray.get(f).crossTileID=y>=0&&f!==y?0:g)}markUsedOrientation(t,i,o){let c=i===Kn.horizontal||i===Kn.horizontalOnly?i:0,u=i===Kn.vertical?i:0,{leftJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:p,rightJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:g}=o,v=t.text.placedSymbolArray;h>=0&&(v.get(h).placedOrientation=c),p>=0&&(v.get(p).placedOrientation=c),f>=0&&(v.get(f).placedOrientation=c),g>=0&&(v.get(g).placedOrientation=u)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;let i=this.prevPlacement,o=!1;this.prevZoomAdjustment=i?i.zoomAdjustment(this.transform.zoom):0;let c=i?i.symbolFadeChange(t):1,u=i?i.opacities:{},h=i?i.variableOffsets:{},p=i?i.placedOrientations:{};for(let f in this.placements){let g=this.placements[f],v=u[f];v?(this.opacities[f]=new cf(v,c,g.text,g.icon,null,g.clipped),o=o||g.text!==v.text.placed||g.icon!==v.icon.placed):(this.opacities[f]=new cf(null,c,g.text,g.icon,g.skipFade,g.clipped),o=o||g.text||g.icon)}for(let f in u){let g=u[f];if(!this.opacities[f]){let v=new cf(g,c,!1,!1);v.isHidden()||(this.opacities[f]=v,o=o||g.text.placed||g.icon.placed)}}for(let f in h)this.variableOffsets[f]||!this.opacities[f]||this.opacities[f].isHidden()||(this.variableOffsets[f]=h[f]);for(let f in p)this.placedOrientations[f]||!this.opacities[f]||this.opacities[f].isHidden()||(this.placedOrientations[f]=p[f]);o?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=i?i.lastPlacementChangeTime:t)}updateLayerOpacities(t,i){let o=new Set;for(let c of i){let u=c.getBucket(t);u&&c.latestFeatureIndex&&t.fqid===u.layerIds[0]&&(this.updateBucketOpacities(u,o,c.collisionBoxArray),u.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(u,c.tileID),u.updateZOffset()))}}updateBucketOpacities(t,i,o){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();let c=t.layers[0].layout,u=!!t.layers[0].dynamicFilter(),h=new cf(null,0,!1,!1,!0),p=c.get("text-allow-overlap"),f=c.get("icon-allow-overlap"),g=c.get("text-variable-anchor"),v=c.get("text-rotation-alignment")==="map",y=c.get("text-pitch-alignment")==="map",b=new cf(null,0,p&&(f||!t.hasIconData()||c.get("icon-optional")),f&&(p||!t.hasTextData()||c.get("text-optional")),!0);!t.collisionArrays&&o&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(o);let x=(E,M,D)=>{for(let I=0;I<M/4;I++)E.opacityVertexArray.emplaceBack(D)},C=0;for(let E=0;E<t.symbolInstances.length;E++){let M=t.symbolInstances.get(E),{numHorizontalGlyphVertices:D,numVerticalGlyphVertices:I,crossTileID:P,numIconVertices:O}=M,R=i.has(P),F=this.opacities[P];R?F=h:F||(F=b,this.opacities[P]=F),i.add(P);let z=D>0||I>0,j=O>0,U=this.placedOrientations[P],G=U===Kn.vertical,$=U===Kn.horizontal||U===Kn.horizontalOnly;if(!z&&!j||F.isHidden()||C++,z){let Y=sO(F.text);x(t.text,D,G?Z0:Y),x(t.text,I,$?Z0:Y);let tt=F.text.isHidden(),{leftJustifiedTextSymbolIndex:W,centerJustifiedTextSymbolIndex:rt,rightJustifiedTextSymbolIndex:st,verticalPlacedTextSymbolIndex:pt}=M,nt=t.text.placedSymbolArray,ot=tt||G?1:0;W>=0&&(nt.get(W).hidden=ot),rt>=0&&(nt.get(rt).hidden=ot),st>=0&&(nt.get(st).hidden=ot),pt>=0&&(nt.get(pt).hidden=tt||$?1:0);let _t=this.variableOffsets[P];_t&&this.markUsedJustification(t,_t.anchor,M,U);let bt=this.placedOrientations[P];bt&&(this.markUsedJustification(t,"left",M,bt),this.markUsedOrientation(t,bt,M))}if(j){let Y=sO(F.icon),{placedIconSymbolIndex:tt,verticalPlacedIconSymbolIndex:W}=M,rt=t.icon.placedSymbolArray,st=F.icon.isHidden()?1:0;tt>=0&&(x(t.icon,O,G?Z0:Y),rt.get(tt).hidden=st),W>=0&&(x(t.icon,M.numVerticalIconVertices,$?Z0:Y),rt.get(W).hidden=st)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){let Y=t.collisionArrays[E];if(Y){let tt=new Q(0,0),W=!0;if(Y.textBox||Y.verticalTextBox){if(g){let st=this.variableOffsets[P];st?(tt=oO(st.anchor,st.width,st.height,st.textOffset,st.textScale),v&&tt._rotate(y?this.transform.angle:-this.transform.angle)):W=!1}u&&(W=!F.clipped),Y.textBox&&Y0(t.textCollisionBox.collisionVertexArray,F.text.placed,!W||G,tt.x,tt.y),Y.verticalTextBox&&Y0(t.textCollisionBox.collisionVertexArray,F.text.placed,!W||$,tt.x,tt.y)}let rt=W&&!!(!$&&Y.verticalIconBox);Y.iconBox&&Y0(t.iconCollisionBox.collisionVertexArray,F.icon.placed,rt,M.hasIconTextFit?tt.x:0,M.hasIconTextFit?tt.y:0),Y.verticalIconBox&&Y0(t.iconCollisionBox.collisionVertexArray,F.icon.placed,!rt,M.hasIconTextFit?tt.x:0,M.hasIconTextFit?tt.y:0)}}}if(t.fullyClipped=C===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){let E=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=E.invProjMatrix,t.placementViewportMatrix=E.viewportMatrix,t.collisionCircleArray=E.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,i){let o=this.zoomAtLastRecencyCheck===i?1-this.zoomAdjustment(i):1;return this.zoomAtLastRecencyCheck=i,this.commitTime+this.fadeDuration*o>t}setStale(){this.stale=!0}}function Y0(e,t,i,o,c){e.emplaceBack(t?1:0,i?1:0,o||0,c||0),e.emplaceBack(t?1:0,i?1:0,o||0,c||0),e.emplaceBack(t?1:0,i?1:0,o||0,c||0),e.emplaceBack(t?1:0,i?1:0,o||0,c||0)}let bq=Math.pow(2,25),xq=Math.pow(2,24),wq=Math.pow(2,17),Cq=Math.pow(2,16),Sq=Math.pow(2,9),Eq=Math.pow(2,8),Mq=Math.pow(2,1);function sO(e){if(e.opacity===0&&!e.placed)return 0;if(e.opacity===1&&e.placed)return 4294967295;let t=e.placed?1:0,i=Math.floor(127*e.opacity);return i*bq+t*xq+i*wq+t*Cq+i*Sq+t*Eq+i*Mq+t}let Z0=0;class Dq{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,i,o,c,u){let h=this._bucketParts;for(;this._currentTileIndex<t.length;)if(i.getBucketParts(h,c,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,u())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,h.sort((p,f)=>p.sortKey-f.sortKey));this._currentPartIndex<h.length;){let p=h[this._currentPartIndex];if(i.placeLayerBucketPart(p,this._seenCrossTileIDs,o,p.symbolInstanceStart===0),this._currentPartIndex++,u())return!0}return!1}}class Tq{constructor(t,i,o,c,u,h,p,f,g){this.placement=new yq(t,u,h,p,f,g),this._currentPlacementIndex=i.length-1,this._forceFullPlacement=o,this._showCollisionBoxes=c,this._done=!1}isDone(){return this._done}continuePlacement(t,i,o,c){let u=ni.now(),h=()=>{let p=ni.now()-u;return!this._forceFullPlacement&&p>2};for(;this._currentPlacementIndex>=0;){let p=i[t[this._currentPlacementIndex]],f=this.placement.collisionIndex.transform.zoom;if(p.type==="symbol"&&(!p.minzoom||p.minzoom<=f)&&(!p.maxzoom||p.maxzoom>f)){let g=p,v=g.layout.get("symbol-z-elevate"),y=this._inProgressLayer=this._inProgressLayer||new Dq(g),b=Yo(p.source,p.scope);if(y.continuePlacement(v?c[b]:o[b],this.placement,this._showCollisionBoxes,p,h))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}let aO=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class X0{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[i,o]=new Uint8Array(t,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");let c=o>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);let u=aO[15&o];if(!u)throw new Error("Unrecognized array type.");let[h]=new Uint16Array(t,2,1),[p]=new Uint32Array(t,4,1);return new X0(p,h,u,t)}constructor(t,i=64,o=Float64Array,c){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;let u=aO.indexOf(this.ArrayType),h=2*t*this.ArrayType.BYTES_PER_ELEMENT,p=t*this.IndexArrayType.BYTES_PER_ELEMENT,f=(8-p%8)%8;if(u<0)throw new Error(`Unexpected typed array class: ${o}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+p+f,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+h+p+f),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+p+f,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+u]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=t)}add(t,i){let o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=i,o}finish(){let t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return eS(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,i,o,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:u,coords:h,nodeSize:p}=this,f=[0,u.length-1,0],g=[];for(;f.length;){let v=f.pop()||0,y=f.pop()||0,b=f.pop()||0;if(y-b<=p){for(let M=b;M<=y;M++){let D=h[2*M],I=h[2*M+1];D>=t&&D<=o&&I>=i&&I<=c&&g.push(u[M])}continue}let x=b+y>>1,C=h[2*x],E=h[2*x+1];C>=t&&C<=o&&E>=i&&E<=c&&g.push(u[x]),(v===0?t<=C:i<=E)&&(f.push(b),f.push(x-1),f.push(1-v)),(v===0?o>=C:c>=E)&&(f.push(x+1),f.push(y),f.push(1-v))}return g}within(t,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:c,coords:u,nodeSize:h}=this,p=[0,c.length-1,0],f=[],g=o*o;for(;p.length;){let v=p.pop()||0,y=p.pop()||0,b=p.pop()||0;if(y-b<=h){for(let M=b;M<=y;M++)cO(u[2*M],u[2*M+1],t,i)<=g&&f.push(c[M]);continue}let x=b+y>>1,C=u[2*x],E=u[2*x+1];cO(C,E,t,i)<=g&&f.push(c[x]),(v===0?t-o<=C:i-o<=E)&&(p.push(b),p.push(x-1),p.push(1-v)),(v===0?t+o>=C:i+o>=E)&&(p.push(x+1),p.push(y),p.push(1-v))}return f}}function eS(e,t,i,o,c,u){if(c-o<=i)return;let h=o+c>>1;lO(e,t,h,o,c,u),eS(e,t,i,o,h-1,1-u),eS(e,t,i,h+1,c,1-u)}function lO(e,t,i,o,c,u){for(;c>o;){if(c-o>600){let g=c-o+1,v=i-o+1,y=Math.log(g),b=.5*Math.exp(2*y/3),x=.5*Math.sqrt(y*b*(g-b)/g)*(v-g/2<0?-1:1);lO(e,t,i,Math.max(o,Math.floor(i-v*b/g+x)),Math.min(c,Math.floor(i+(g-v)*b/g+x)),u)}let h=t[2*i+u],p=o,f=c;for(df(e,t,o,i),t[2*c+u]>h&&df(e,t,o,c);p<f;){for(df(e,t,p,f),p++,f--;t[2*p+u]<h;)p++;for(;t[2*f+u]>h;)f--}t[2*o+u]===h?df(e,t,o,f):(f++,df(e,t,f,c)),f<=i&&(o=f+1),i<=f&&(c=f-1)}}function df(e,t,i,o){iS(e,i,o),iS(t,2*i,2*o),iS(t,2*i+1,2*o+1)}function iS(e,t,i){let o=e[t];e[t]=e[i],e[i]=o}function cO(e,t,i,o){let c=e-i,u=t-o;return c*c+u*u}let nS=512/wt/2;class Iq{constructor(t,i,o){this.tileID=t,this.bucketInstanceId=o,this.index=new X0(i.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let c=t.canonical.x*wt,u=t.canonical.y*wt;for(let h=0;h<i.length;h++){let{key:p,crossTileID:f,tileAnchorX:g,tileAnchorY:v}=i.get(h),y=Math.floor((c+g)*nS),b=Math.floor((u+v)*nS);this.index.add(y,b),this.keys.push(p),this.crossTileIDs.push(f)}this.index.finish()}findMatches(t,i,o){let c=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z),u=nS/Math.pow(2,i.canonical.z-this.tileID.canonical.z),h=i.canonical.x*wt,p=i.canonical.y*wt;for(let f=0;f<t.length;f++){let g=t.get(f);if(g.crossTileID)continue;let{key:v,tileAnchorX:y,tileAnchorY:b}=g,x=Math.floor((h+y)*u),C=Math.floor((p+b)*u),E=this.index.range(x-c,C-c,x+c,C+c);for(let M of E){let D=this.crossTileIDs[M];if(this.keys[M]===v&&!o.has(D)){o.add(D),g.crossTileID=D;break}}}}}class Aq{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class kq{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){let i=Math.round((t-this.lng)/360);if(i!==0)for(let o in this.indexes){let c=this.indexes[o],u={};for(let h in c){let p=c[h];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+i),u[p.tileID.key]=p}this.indexes[o]=u}this.lng=t}addBucket(t,i,o){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===i.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let u=0;u<i.symbolInstances.length;u++)i.symbolInstances.get(u).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);let c=this.usedCrossTileIDs[t.overscaledZ];for(let u in this.indexes){let h=this.indexes[u];if(Number(u)>t.overscaledZ)for(let p in h){let f=h[p];f.tileID.isChildOf(t)&&f.findMatches(i.symbolInstances,t,c)}else{let p=h[t.scaledTo(Number(u)).key];p&&p.findMatches(i.symbolInstances,t,c)}}for(let u=0;u<i.symbolInstances.length;u++){let h=i.symbolInstances.get(u);h.crossTileID||(h.crossTileID=o.generate(),c.add(h.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Iq(t,i.symbolInstances,i.bucketInstanceId),!0}removeBucketCrossTileIDs(t,i){for(let o of i.crossTileIDs)this.usedCrossTileIDs[t].delete(o)}removeStaleBuckets(t){let i=!1;for(let o in this.indexes){let c=this.indexes[o];for(let u in c)t[c[u].bucketInstanceId]||(this.removeBucketCrossTileIDs(o,c[u]),delete c[u],i=!0)}return i}}class Rq{constructor(){this.layerIndexes={},this.crossTileIDs=new Aq,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,i,o,c){let u=this.layerIndexes[t.fqid];u===void 0&&(u=this.layerIndexes[t.fqid]=new kq);let h=!1,p={};c.name!=="globe"&&u.handleWrapJump(o);for(let f of i){let g=f.getBucket(t);g&&t.fqid===g.layerIds[0]&&(g.bucketInstanceId||(g.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(f.tileID,g,this.crossTileIDs)&&(h=!0),p[g.bucketInstanceId]=!0)}return u.removeStaleBuckets(p)&&(h=!0),h}pruneUnusedLayers(t){let i={};t.forEach(o=>{i[o]=!0});for(let o in this.layerIndexes)i[o]||delete this.layerIndexes[o]}}var dO=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w-0.0001;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,uO="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",hO=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,mO=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,pO=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,fO=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);vec4 _raTexLinearCoord(vec2 texCoord,vec2 texResolution,out vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return (texCoord.xxyy+vec2(1.5,0.5).xyxy)/texResolution.xxyy;}vec2 _raTexLinearMix(vec2 fxy,vec4 colorMix,float colorOffset,vec4 t00,vec4 t10,vec4 t01,vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image0,c.yz),texture(u_image0,c.xz),texture(u_image0,c.yw),texture(u_image0,c.xw)
);}vec2 raTexture2D_image1_linear(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image1,c.yz),texture(u_image1,c.xz),texture(u_image1,c.yw),texture(u_image1,c.xw)
);}vec2 raTexture2D_image0_nearest(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec4 t=texture(u_image0,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec4 t=texture(u_image1,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,gO=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,_O=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let vO=[];J0(dO,vO);let K0={"_prelude_fog.vertex.glsl":mO,"_prelude_terrain.vertex.glsl":hO,"_prelude_shadow.vertex.glsl":gO,"_prelude_fog.fragment.glsl":pO,"_prelude_shadow.fragment.glsl":_O,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":fO},Q0={};on("",hO),on(pO,mO),on(_O,gO),on(fO,"");let yO=on(`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif`,`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`),bO=dO;var xO={background:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:on("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:on(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:on(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:on("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:on("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:on("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in vec2 v_pos;in vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;out vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#ifdef RENDER_CUTOFF
invariant gl_Position;
#endif
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),fillExtrusionDepth:on(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:on(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:on(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;HANDLE_WIREFRAME_DEBUG;
#endif
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;
#ifdef FORCE_ABS_FL_GROUND_RADIUS
fl_ground_radius=abs(flood_light_ground_radius);
#endif
float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:on(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform vec4 u_tl_br;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#elif defined(PROJECTION_GLOBE_VIEW)
in vec2 a_pos;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec2 globe_tl=vec2(u_tl_br.x,u_tl_br.y);vec2 globe_br=vec2(u_tl_br.z,u_tl_br.w);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=1.0-((mercatorY-globe_br.y)/(globe_tl.y-globe_br.y));float mercatorX=mercatorXfromLng(latLng[1]);float uvX=(mercatorX-globe_br.x)/(globe_tl.x-globe_br.x);vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);uv=vec2(uvX,uvY);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
uv=a_texture_pos/8192.0;
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),symbolIcon:on(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
uniform mediump float u_icon_saturation;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;
#else
out_color=texture(u_texture,v_tex_a)*alpha;
#endif
#ifdef SATURATION
vec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:on(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:on(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:on("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:on(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,uO),skyboxGradient:on(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,uO),skyboxCapture:on(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:on(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
texColor.rgb=sRGBToLinear(texColor.rgb);if(u_baseTextureIsAlpha) {if (texColor.w < 0.5) {discard;}albedo*=mix(vec4(texColor.rgb,texColor.a),vec4(texColor.a),float(u_baseTextureIsAlpha));} else {albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 diffuse=getDiffuseShadedColor(getBaseColor().rgb,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(diffuse,1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
ao=(texture(u_occlusionTexture,uv_2f).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=local_pos;
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:on(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:on(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function J0(e,t){let i=e.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let o of i)if(o=o.trim(),o[0]==="#"&&o.includes("if")&&!o.includes("endif")){o=o.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let c=o.split(" ");for(let u of c)t.includes(u)||t.push(u)}}function on(e,t){let i=/#include\s+"([^"]+)"/g,o=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,c=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);c&&(c=c.map(g=>{let v=g.split(" ");return v[v.length-1]}),c=[...new Set(c)]);let u={},h=[],p=[];e=e.replace(i,(g,v)=>(p.push(v),"")),t=t.replace(i,(g,v)=>(h.push(v),""));let f=[...vO];J0(e,f),J0(t,f);for(let g of[...h,...p])K0[g]||console.error(`Undefined include: ${g}`),Q0[g]||(Q0[g]=[],J0(K0[g],Q0[g])),f=[...f,...Q0[g]];return{fragmentSource:e=e.replace(o,(g,v,y,b,x)=>(u[x]=!0,v==="define"?`
#ifndef HAS_UNIFORM_u_${x}
in ${y} ${b} ${x};
#else
uniform ${y} ${b} u_${x};
#endif
`:v==="initialize"?`
#ifdef HAS_UNIFORM_u_${x}
    ${y} ${b} ${x} = u_${x};
#endif
`:v==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${x}
    in ${y} ${b} ${x};
#endif
`:v==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(o,(g,v,y,b,x)=>{let C=b==="float"?"vec2":b,E=x.match(/color/)?"color":C;return v==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${x}
in ${y} ${b} a_${x};
#endif
`:u[x]?v==="define"?`
#ifndef HAS_UNIFORM_u_${x}
uniform lowp float u_${x}_t;
in ${y} ${C} a_${x};
out ${y} ${b} ${x};
#else
uniform ${y} ${b} u_${x};
#endif
`:v==="initialize"?E==="vec4"?`
#ifndef HAS_UNIFORM_u_${x}
    ${x} = a_${x};
#else
    ${y} ${b} ${x} = u_${x};
#endif
`:`
#ifndef HAS_UNIFORM_u_${x}
    ${x} = unpack_mix_${E}(a_${x}, u_${x}_t);
#else
    ${y} ${b} ${x} = u_${x};
#endif
`:v==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${x}
    in ${y} ${b} a_${x};
    out ${y} ${b} ${x};
#endif
`:v==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${x}
    ${x} = a_${x};
#endif
`:void 0:v==="define"?`
#ifndef HAS_UNIFORM_u_${x}
uniform lowp float u_${x}_t;
in ${y} ${C} a_${x};
#else
uniform ${y} ${b} u_${x};
#endif
`:v==="define-instanced"?E==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${x}0;
in vec4 a_${x}1;
in vec4 a_${x}2;
in vec4 a_${x}3;
#else
uniform ${y} ${b} u_${x};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${y} ${C} a_${x};
#else
uniform ${y} ${b} u_${x};
#endif
`:v==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${x}
    ${y} ${b} ${x} = a_${x};
#endif
`:E==="vec4"?`
#ifndef HAS_UNIFORM_u_${x}
    ${y} ${b} ${x} = a_${x};
#else
    ${y} ${b} ${x} = u_${x};
#endif
`:`
#ifndef HAS_UNIFORM_u_${x}
    ${y} ${b} ${x} = unpack_mix_${E}(a_${x}, u_${x}_t);
#else
    ${y} ${b} ${x} = u_${x};
#endif
`}),staticAttributes:c,usedDefines:f,vertexIncludes:h,fragmentIncludes:p}}class Pq{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,i,o,c,u,h,p,f){this.context=t;let g=this.boundPaintVertexBuffers.length!==c.length;for(let y=0;!g&&y<c.length;y++)this.boundPaintVertexBuffers[y]!==c[y]&&(g=!0);let v=this.boundDynamicVertexBuffers.length!==p.length;for(let y=0;!v&&y<p.length;y++)this.boundDynamicVertexBuffers[y]!==p[y]&&(v=!0);if(!this.vao||this.boundProgram!==i||this.boundLayoutVertexBuffer!==o||g||v||this.boundIndexBuffer!==u||this.boundVertexOffset!==h)this.freshBind(i,o,c,u,h,p,f);else{t.bindVertexArrayOES.set(this.vao);for(let y of p)y&&(y.bind(),f&&y.instanceCount&&y.setVertexAttribDivisor(t.gl,i,f));u&&u.dynamicDraw&&u.bind()}}freshBind(t,i,o,c,u,h,p){let f=t.numAttributes,g=this.context,v=g.gl;this.vao&&this.destroy(),this.vao=g.gl.createVertexArray(),g.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=i,this.boundPaintVertexBuffers=o,this.boundIndexBuffer=c,this.boundVertexOffset=u,this.boundDynamicVertexBuffers=h,i.enableAttributes(v,t),i.bind(),i.setVertexAttribPointers(v,t,u);for(let y of o)y.enableAttributes(v,t),y.bind(),y.setVertexAttribPointers(v,t,u);for(let y of h)y&&(y.enableAttributes(v,t),y.bind(),y.setVertexAttribPointers(v,t,u),p&&y.instanceCount&&y.setVertexAttribDivisor(v,t,p));c&&c.bind(),g.currentNumAttributes=f}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Oq(e,t){let i=Math.pow(2,t.canonical.z),o=t.canonical.y;return[new Oi(0,o/i).toLngLat().lat,new Oi(0,(o+1)/i).toLngLat().lat]}function Fq(e,t,i,o,c,u,h){let p=e.context,f=p.gl,g=i.hillshadeFBO;if(!g)return;e.prepareDrawTile();let v=e.isTileAffectedByFog(t),y=e.getOrCreateProgram("hillshade",{overrideFog:v});p.activeTexture.set(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,g.colorAttachment.get());let b=((M,D,I,P)=>{let O=I.paint.get("hillshade-shadow-color"),R=I.paint.get("hillshade-highlight-color"),F=I.paint.get("hillshade-accent-color"),z=I.paint.get("hillshade-emissive-strength"),j=fe(I.paint.get("hillshade-illumination-direction"));if(I.paint.get("hillshade-illumination-anchor")==="viewport")j-=M.transform.angle;else if(M.style&&M.style.enable3dLights()&&M.style.directionalLight){let G=M.style.directionalLight.properties.get("direction");j=fe(Ae(G.x,G.y,G.z)[1])}let U=!M.options.moving;return{u_matrix:P||M.transform.calculateProjMatrix(D.tileID.toUnwrapped(),U),u_image:0,u_latrange:Oq(0,D.tileID),u_light:[I.paint.get("hillshade-exaggeration"),j],u_shadow:O,u_highlight:R,u_emissive_strength:z,u_accent:F}})(e,i,o,e.terrain?t.projMatrix:null);e.uploadCommonUniforms(p,y,t.toUnwrapped());let{tileBoundsBuffer:x,tileBoundsIndexBuffer:C,tileBoundsSegments:E}=e.getTileBoundsBuffers(i);y.draw(e,f.TRIANGLES,c,u,h,vi.disabled,b,o.id,x,C,E)}function wO(e,t,i){if(!t.needsDEMTextureUpload)return;let o=e.context,c=o.gl;o.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||e.getTileTexture(i.stride);let u=i.getPixels();t.demTexture?t.demTexture.update(u,{premultiply:!1}):t.demTexture=new ir(o,u,c.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Lq(e,t,i){let o=e.context,c=o.gl;if(!t.dem)return;let u=t.dem;if(o.activeTexture.set(c.TEXTURE1),wO(e,t,u),!t.demTexture)return;t.demTexture.bind(c.NEAREST,c.CLAMP_TO_EDGE);let h=u.dim;o.activeTexture.set(c.TEXTURE0);let p=t.hillshadeFBO;if(!p){let b=new ir(o,{width:h,height:h,data:null},c.RGBA);b.bind(c.LINEAR,c.CLAMP_TO_EDGE),p=t.hillshadeFBO=o.createFramebuffer(h,h,!0,"renderbuffer"),p.colorAttachment.set(b.texture)}o.bindFramebuffer.set(p.framebuffer),o.viewport.set([0,0,h,h]);let{tileBoundsBuffer:f,tileBoundsIndexBuffer:g,tileBoundsSegments:v}=e.getMercatorTileBoundsBuffers(),y=[];e.linearFloatFilteringSupported()&&y.push("TERRAIN_DEM_FLOAT_FORMAT"),e.getOrCreateProgram("hillshadePrepare",{defines:y}).draw(e,c.TRIANGLES,je.disabled,gi.disabled,Vi.unblended,vi.disabled,((b,x)=>{let C=x.stride,E=ft.create();return ft.ortho(E,0,wt,-wt,0,0,1),ft.translate(E,E,[0,-wt,0]),{u_matrix:E,u_image:1,u_dimension:[C,C],u_zoom:b.overscaledZ}})(t.tileID,u),i.id,f,g,v),t.needsHillshadePrepare=!1}let CO=e=>({u_matrix:new si(e),u_image0:new yi(e),u_skirt_height:new Bt(e),u_ground_shadow_factor:new ci(e)}),SO=(e,t,i)=>({u_matrix:e,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:i}),EO=(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(o),u_merc_matrix:i,u_zoom_transition:c,u_merc_center:u,u_image0:0,u_frustum_tl:h,u_frustum_tr:p,u_frustum_br:f,u_frustum_bl:g,u_globe_pos:v,u_globe_radius:y,u_viewport:b,u_grid_matrix:C?Float32Array.from(C):new Float32Array(9),u_skirt_height:x}),Nh=(e,t)=>{if(t>0&&e.terrain&&lt("Cutoff is currently disabled on terrain"),t<=0||e.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,0]}};let i=e.transform,o=Math.max(Math.abs(i._zoom-(e.minCutoffZoom-1)),1),c=i.isLODDisabled(!1)?Go(60,45,i.pitch):Go(30,15,i.pitch),u=i._farZ-i._nearZ,h=t*i.height,p=((1-(f=c))*(.75*i.cameraToCenterDistance)+f*(i._farZ+h))*o;var f;return{shouldRenderCutoff:c<1,uniformValues:{u_cutoff_params:[i._nearZ,i._farZ,(p-i._nearZ)/u,(p-h-i._nearZ)/u]}}};function MO(e,t){return e!=null&&t!=null&&!(!e.hasData()||!t.hasData())&&e.demTexture!=null&&t.demTexture!=null&&e.tileID.key!==t.tileID.key}let Bh=new class{constructor(){this.operations={}}newMorphing(e,t,i,o,c){if(e in this.operations){let u=this.operations[e];u.to.tileID.key!==i.tileID.key&&(u.queued=i)}else this.operations[e]={startTime:o,phase:0,duration:c,from:t,to:i,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;let t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(let t in this.operations){let i=this.operations[t];for(i.phase=(e-i.startTime)/i.duration;i.phase>=1||!this._validOp(i);)if(!this._nextOp(i,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},DO={0:null,1:"TERRAIN_VERTEX_MORPHING"};function TO(e,t,i){if(t===0)return 0;let o=t<1&&i===514?.25/t:1;return 6*Math.pow(1.5,22-e)*Math.max(t,1)*o}function zq(e,t){let i=1<<e.z;return!t&&(e.x===0||e.x===i-1)||e.y===0||e.y===i-1}let rS=e=>({u_matrix:e});function IO(e,t,i,o,c){if(c>0){let u=ni.now(),h=(u-e.timeAdded)/c,p=t?(u-t.timeAdded)/c:-1,f=i.getSource(),g=o.coveringZoomLevel({tileSize:f.tileSize,roundZoom:f.roundZoom}),v=!t||Math.abs(t.tileID.overscaledZ-g)>Math.abs(e.tileID.overscaledZ-g),y=v&&e.refreshedUponExpiration?1:ve(v?h:1-p,0,1);return e.refreshedUponExpiration&&h>=1&&(e.refreshedUponExpiration=!1),t?{opacity:1,mix:1-y}:{opacity:y,mix:0}}return{opacity:1,mix:0}}class Nq extends Ja{constructor(t){let i={type:"raster-dem",maxzoom:t.transform.maxZoom},o=new U0(lf(),null),c=XC("mock-dem",i,o,t.style);super("mock-dem",c,!1),c.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,i){t.state="loaded",i(null)}}class Bq extends Ja{constructor(t){let i=XC("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new U0(lf(),null),t.style);super("proxy",i,!1),i.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,i,o){if(t.freezeTileCoverage)return;this.transform=t;let c=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((u,h)=>{if(u[h.key]="",!this._tiles[h.key]){let p=new Xp(h,this._source.tileSize*h.overscaleFactor(),t.tileZoom);p.state="loaded",this._tiles[h.key]=p}return u},{});for(let u in this._tiles)u in c||(this.freeFBO(u),this._tiles[u].unloadVectorData(),delete this._tiles[u])}freeFBO(t){let i=this.proxyCachedFBO[t];if(i!==void 0){let o=Object.values(i);this.renderCachePool.push(...o),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class AO extends Hi{constructor(t,i,o){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=i,this.projMatrix=o}}class Vq extends v8{constructor(t,i){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[o,c,u]=function(f){let g=new xs,v=new qr,y=131;g.reserve(17161),v.reserve(33800);let b=wt/128,x=wt+b/2,C=x+b;for(let M=-b;M<C;M+=b)for(let D=-b;D<C;D+=b){let I=D<0||D>x||M<0||M>x?24575:0,P=ve(Math.round(D),0,wt),O=ve(Math.round(M),0,wt);g.emplaceBack(P+I,O)}let E=(M,D)=>{let I=D*y+M;v.emplaceBack(I+1,I,I+y),v.emplaceBack(I+y,I+y+1,I+1)};for(let M=1;M<129;M++)for(let D=1;D<129;D++)E(D,M);return[0,129].forEach(M=>{for(let D=0;D<130;D++)E(D,M),E(M,D)}),[g,v,32768]}(),h=t.context;this.gridBuffer=h.createVertexBuffer(o,Zc.members),this.gridIndexBuffer=h.createIndexBuffer(c),this.gridSegments=dn.simpleSegment(0,0,o.length,c.length),this.gridNoSkirtSegments=dn.simpleSegment(0,0,o.length,u),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Bq(i.map),this.orthoMatrix=ft.create(),ft.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,wt,0,wt,0,1);let p=h.gl;this._overlapStencilMode=new gi({func:p.GEQUAL,mask:255},0,255,p.KEEP,p.KEEP,p.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=i,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Nq(i.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,i,o){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);let c=t.terrain.properties,u=t.terrain.drapeRenderMode===0,h=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=ni.now();let p=t.terrain&&t.terrain.scope,f=c.get("source"),g=u?this._mockSourceCache:t.getSourceCache(f,p);if(!g)return void lt(`Couldn't find terrain source "${f}".`);if(this.sourceCache=g,this._exaggeration=h?this.calculateExaggeration(i):c.get("exaggeration"),!i.projection.requiresDraping&&h&&this._exaggeration===0)return void this._disable();this.enabled=!0;let v=()=>{this.sourceCache.used&&lt(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let y=this.getScaledDemTileSize();this.sourceCache.update(i,y,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,v(),this._initializing=!0),v(),i.updateElevation(!0,o),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(i),this._emptyDEMTextureDirty=!0,this._previousZoom=i.zoom}else this._disable()}calculateExaggeration(t){let i=this._previousCameraAltitude,o=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=o;let c=i!=null?o-i:Number.MAX_VALUE;if(Math.abs(c)<2)return this._exaggeration;let u=t.zoom,h=this._style.terrain;if(!this._previousUpdateTimestamp)return h.getExaggeration(u);let p=u-this._previousZoom,f=this._previousUpdateTimestamp,g=u;this._evaluationZoom!=null&&(g=this._evaluationZoom,Math.abs(u-g)>.5&&(p=.5*(u-g+p)),p*c<0&&(g+=p)),this._evaluationZoom=g;let v=h.getExaggeration(g),y=v===h.getExaggeration(Math.max(0,g-.1));if(y&&Math.abs(v-this._exaggeration)<.01)return v;let b=Math.min(.1,.00375*(this._updateTimestamp-f));return(y||v<.1||Math.abs(p)<1e-4)&&(b=Math.min(.2,4*b)),$e(this._exaggeration,v,b)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let i=this.proxySourceCache,o=this.painter.transform;this._initializing&&(this._initializing=o._centerAltitude===0&&this.getAtPointOrZero(Oi.fromLngLat(o.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let c=this.proxyCoords=i.getIds().map(f=>{let g=i.getTileByID(f).tileID;return g.projMatrix=o.calculateProjMatrix(g.toUnwrapped()),g});(function(f,g){let v=g.transform.pointCoordinate(g.transform.getCameraPoint()),y=new Q(v.x,v.y);f.sort((b,x)=>{if(x.overscaledZ-b.overscaledZ)return x.overscaledZ-b.overscaledZ;let C=new Q(b.canonical.x+(1<<b.canonical.z)*b.wrap,b.canonical.y),E=new Q(x.canonical.x+(1<<x.canonical.z)*x.wrap,x.canonical.y),M=y.mult(1<<b.canonical.z);return M.x-=.5,M.y-=.5,M.distSqr(C)-M.distSqr(E)})})(c,this.painter);let u=this.proxyToSource||{};this.proxyToSource={},c.forEach(f=>{this.proxyToSource[f.key]={}}),this.terrainTileForTile={};let h=this._style._mergedSourceCaches;for(let f in h){let g=h[f];if(!g.used||(g!==this.sourceCache&&this.resetTileLookupCache(g.id),this._setupProxiedCoordsForOrtho(g,t[f],u),g.usedForTerrain))continue;let v=t[f];g.getSource().reparseOverscaled&&this._assignTerrainTiles(v)}this.proxiedCoords[i.id]=c.map(f=>new AO(f,f.key,this.orthoMatrix)),this._assignTerrainTiles(c),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(u),this.renderingToTexture=!1;let p={};this._visibleDemTiles=[];for(let f of this.proxyCoords){let g=this.terrainTileForTile[f.key];if(!g)continue;let v=g.tileID.key;v in p||(this._visibleDemTiles.push(g),p[v]=v)}}_assignTerrainTiles(t){this._initializing||t.forEach(i=>{if(this.terrainTileForTile[i.key])return;let o=this._findTileCoveringTileID(i,this.sourceCache);o&&(this.terrainTileForTile[i.key]=o)})}_prepareDEMTextures(){let t=this.painter.context,i=t.gl;for(let o in this.terrainTileForTile){let c=this.terrainTileForTile[o],u=c.dem;!u||c.demTexture&&!c.needsDEMTextureUpload||(t.activeTexture.set(i.TEXTURE1),wO(this.painter,c,u))}}_prepareDemTileUniforms(t,i,o,c){if(!i||i.demTexture==null)return!1;let u=t.tileID.canonical,h=Math.pow(2,i.tileID.canonical.z-u.z),p=c||"";return o[`u_dem_tl${p}`]=[u.x*h%1,u.y*h%1],o[`u_dem_scale${p}`]=h,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let t=this.painter.context,i=t.gl;if(!this._emptyDepthBufferTexture){let o=new Br({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new ir(t,o,i.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let t=0,i=this._visibleDemTiles.reduce((o,c)=>{if(!c.dem)return o;let u=c.dem.tree.minimums[0];return u>0&&t++,o+u},0);return t?i/t:0}_updateEmptyDEMTexture(){let t=this.painter.context,i=t.gl;t.activeTexture.set(i.TEXTURE2);let o=this._getLoadedAreaMinimum(),[c,u]=(()=>{let p=new bk({width:1,height:1},new Float32Array([o]));return[i.R32F,p]})();this._emptyDEMTextureDirty=!1;let h=this._emptyDEMTexture;return h?h.update(u,{premultiply:!1}):h=this._emptyDEMTexture=new ir(t,u,c,{premultiply:!1}),h}setupElevationDraw(t,i,o){let c=this.painter.context,u=c.gl,h={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};h.u_exaggeration=this.exaggeration();let p=null,f=null,g=1;if(o&&o.morphing&&this._useVertexMorphing){let b=o.morphing.srcDemTile,x=o.morphing.dstDemTile;g=o.morphing.phase,b&&x&&(this._prepareDemTileUniforms(t,b,h,"_prev")&&(f=b),this._prepareDemTileUniforms(t,x,h)&&(p=x))}let v=b=>b&&b.demTexture&&this.painter.linearFloatFilteringSupported()?u.LINEAR:u.NEAREST,y=b=>{h.u_dem_size=b.size[0]===1?1:b.size[0]-2};if(f&&p)c.activeTexture.set(u.TEXTURE2),p.demTexture.bind(v(p),u.CLAMP_TO_EDGE),c.activeTexture.set(u.TEXTURE4),f.demTexture.bind(v(f),u.CLAMP_TO_EDGE),p.demTexture&&y(p.demTexture),h.u_dem_lerp=g;else{p=this.terrainTileForTile[t.tileID.key],c.activeTexture.set(u.TEXTURE2);let b=this._prepareDemTileUniforms(t,p,h)?p.demTexture:this.emptyDEMTexture;b.bind(v(p),u.CLAMP_TO_EDGE),y(b)}if(c.activeTexture.set(u.TEXTURE3),o&&o.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(u.NEAREST,u.CLAMP_TO_EDGE),this._depthFBO&&(h.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(u.NEAREST,u.CLAMP_TO_EDGE),h.u_depth_size_inv=[1,1]),o&&o.useMeterToDem&&p){let b=(1<<p.tileID.canonical.z)*_n(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;h.u_meter_to_dem=b}if(o&&o.labelPlaneMatrixInv&&(h.u_label_plane_matrix_inv=o.labelPlaneMatrixInv),i.setTerrainUniformValues(c,h),this.painter.transform.projection.name==="globe"){let b=this.globeUniformValues(this.painter.transform,t.tileID.canonical,o&&o.useDenormalizedUpVectorScale);i.setGlobeUniformValues(c,b)}}globeUniformValues(t,i,o){let c=t.projection;return{u_tile_tl_up:c.upVector(i,0,0),u_tile_tr_up:c.upVector(i,wt,0),u_tile_br_up:c.upVector(i,wt,wt),u_tile_bl_up:c.upVector(i,0,wt),u_tile_up_scale:o?q_(1):c.upVectorScale(i,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){let i=this.painter,o=this.painter.context;t.length!==0&&(o.bindFramebuffer.set(null),o.viewport.set([0,0,i.width,i.height]),i.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(c,u,h,p,f){if(c.transform.projection.name==="globe")(function(g,v,y,b,x){let C=g.context,E=C.gl,M,D,I=g.transform,P=QA(g,C,I),O=(tt,W)=>{if(D===W)return;let rt=[DO[W],"PROJECTION_GLOBE_VIEW"];P&&rt.push("CUSTOM_ANTIALIASING");let st=g.isTileAffectedByFog(tt);M=g.getOrCreateProgram("globeRaster",{defines:rt,overrideFog:st}),D=W},R=g.colorModeForRenderPass(),F=new je(E.LEQUAL,je.ReadWrite,g.depthRangeFor3D);Bh.update(x);let z=XA(I),j=[to(I.center.lng),lo(I.center.lat)],U=g.globeSharedBuffers,G=[I.width*ni.devicePixelRatio,I.height*ni.devicePixelRatio],$=Float32Array.from(I.globeMatrix),Y={useDenormalizedUpVectorScale:!0};{let tt=g.transform,W=TO(tt.zoom,v.exaggeration(),v.sourceCache._source.tileSize);D=-1;let rt=E.TRIANGLES;for(let st of b){let pt=y.getTile(st),nt=gi.disabled,ot=v.prevTerrainTileForTile[st.key],_t=v.terrainTileForTile[st.key];MO(ot,_t)&&Bh.newMorphing(st.key,ot,_t,x,250),C.activeTexture.set(E.TEXTURE0),pt.texture&&pt.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE);let bt=Bh.getMorphValuesForProxy(st.key),yt=bt?1:0;bt&&ec(Y,{morphing:{srcDemTile:bt.from,dstDemTile:bt.to,phase:Cr(bt.phase)}});let Ct=W_(st.canonical),St=a6(Ct.getCenter().lat),Tt=JA(st.canonical,Ct,St,tt.worldSize/tt._pixelsPerMercatorPixel),xt=Kc(Ws(st.canonical)),Ft=EO(tt.expandedFarZProjMatrix,$,z,xt,wo(tt.zoom),j,tt.frustumCorners.TL,tt.frustumCorners.TR,tt.frustumCorners.BR,tt.frustumCorners.BL,tt.globeCenterInViewSpace,tt.globeRadius,G,W,Tt);if(O(st,yt),M&&(v.setupElevationDraw(pt,M,Y),g.uploadCommonUniforms(C,M,st.toUnwrapped()),U)){let[Qt,Jt,le]=U.getGridBuffers(St,W!==0);M.draw(g,rt,F,nt,R,vi.backCCW,Ft,"globe_raster",Qt,Jt,le)}}}if(U&&(g.renderDefaultNorthPole||g.renderDefaultSouthPole)){let tt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];P&&tt.push("CUSTOM_ANTIALIASING"),M=g.getOrCreateProgram("globeRaster",{defines:tt});for(let W of b){let{x:rt,y:st,z:pt}=W.canonical,nt=st===0,ot=st===(1<<pt)-1,[_t,bt,yt,Ct]=U.getPoleBuffers(pt,!1);if(Ct&&(nt||ot)){let St=y.getTile(W);C.activeTexture.set(E.TEXTURE0),St.texture&&St.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE);let Tt=KA(pt,rt,I),xt=Kc(Ws(W.canonical)),Ft=(Qt,Jt)=>Qt.draw(g,E.TRIANGLES,F,gi.disabled,R,vi.disabled,EO(I.expandedFarZProjMatrix,Tt,Tt,xt,0,j,I.frustumCorners.TL,I.frustumCorners.TR,I.frustumCorners.BR,I.frustumCorners.BL,I.globeCenterInViewSpace,I.globeRadius,G,0),"globe_pole_raster",Jt,yt,Ct);v.setupElevationDraw(St,M,Y),g.uploadCommonUniforms(C,M,W.toUnwrapped()),nt&&g.renderDefaultNorthPole&&Ft(M,_t),ot&&g.renderDefaultSouthPole&&(Tt=ft.scale(ft.create(),Tt,[1,-1,1]),Ft(M,bt))}}}})(c,u,h,p,f);else{let g=c.context,v=g.gl,y,b,x=c.shadowRenderer,C=Nh(c,c.longestCutoffRange),E=R=>{if(b===R)return;let F=[];F.push(DO[R]),C.shouldRenderCutoff&&F.push("RENDER_CUTOFF"),y=c.getOrCreateProgram("terrainRaster",{defines:F}),b=R},M=c.colorModeForRenderPass(),D=new je(v.LEQUAL,je.ReadWrite,c.depthRangeFor3D);Bh.update(f);let I=c.transform,P=TO(I.zoom,u.exaggeration(),u.sourceCache._source.tileSize),O=[0,0,0];if(x){let R=c.style.directionalLight,F=c.style.ambientLight;R&&F&&(O=cS(R,F))}{b=-1;let R=v.TRIANGLES,[F,z]=[u.gridIndexBuffer,u.gridSegments];for(let j of p){let U=h.getTile(j),G=gi.disabled,$=u.prevTerrainTileForTile[j.key],Y=u.terrainTileForTile[j.key];MO($,Y)&&Bh.newMorphing(j.key,$,Y,f,250),g.activeTexture.set(v.TEXTURE0),U.texture&&U.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE);let tt=Bh.getMorphValuesForProxy(j.key),W=tt?1:0,rt;tt&&(rt={morphing:{srcDemTile:tt.from,dstDemTile:tt.to,phase:Cr(tt.phase)}});let st=SO(j.projMatrix,zq(j.canonical,I.renderWorldCopies)?P/10:P,O);if(E(W),!y)continue;u.setupElevationDraw(U,y,rt);let pt=j.toUnwrapped();x&&x.setupShadows(pt,y),c.uploadCommonUniforms(g,y,pt,null,C),y.draw(c,R,D,G,M,vi.backCCW,st,"terrain_raster",u.gridBuffer,F,z)}}}}(i,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,i.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;let i=this.painter,o=this.painter.context,c=this.proxySourceCache,u=this.proxiedCoords[c.id],h=this._drapedRenderBatches.shift(),p=i.style.order,f=[],g=0;for(let v of u){let y=c.getTileByID(v.proxyTileKey),b=c.proxyCachedFBO[v.key]?c.proxyCachedFBO[v.key][t]:void 0,x=b!==void 0?c.renderCache[b]:this.pool[g++],C=b!==void 0;if(y.texture=x.tex,C&&!x.dirty){f.push(y.tileID);continue}let E;o.bindFramebuffer.set(x.fb.framebuffer),this.renderedToTile=!1,x.dirty&&(o.clear({color:fi.transparent,stencil:0}),x.dirty=!1);for(let M=h.start;M<=h.end;++M){let D=i.style._mergedLayers[p[M]];if(D.isHidden(i.transform.zoom))continue;let I=i.style.getLayerSourceCache(D),P=I?this.proxyToSource[v.key][I.id]:[v];if(!P)continue;let O=P;o.viewport.set([0,0,x.fb.width,x.fb.height]),E!==(I?I.id:null)&&(this._setupStencil(x,P,D,I),E=I?I.id:null),i.renderLayer(i,I,D,O)}if(this._drapedRenderBatches.length===0)for(let M of this._pendingGroundEffectLayers){let D=i.style._mergedLayers[p[M]];if(D.isHidden(i.transform.zoom))continue;let I=i.style.getLayerSourceCache(D),P=I?this.proxyToSource[v.key][I.id]:[v];if(!P)continue;let O=P;o.viewport.set([0,0,x.fb.width,x.fb.height]),E!==(I?I.id:null)&&(this._setupStencil(x,P,D,I),E=I?I.id:null),i.renderLayer(i,I,D,O)}this.renderedToTile?(x.dirty=!0,f.push(y.tileID)):C||--g,g===5&&(g=0,this.renderToBackBuffer(f))}return this.renderToBackBuffer(f),this.renderingToTexture=!1,o.bindFramebuffer.set(null),o.viewport.set([0,0,i.width,i.height]),h.end+1}postRender(){}isLayerOrderingCorrect(t){let i=t.order.length,o=-1,c=i;for(let u=0;u<i;++u)this._style.isLayerDraped(t._mergedLayers[t.order[u]])?o=Math.max(o,u):c=Math.min(c,u);return c>o}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(i=>i.dem).forEach(i=>{t=Math.min(t,i.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,i,o){if(!this._visibleDemTiles)return null;let c=this._visibleDemTiles.filter(u=>u.dem).map(u=>{let h=u.tileID,p=1<<h.overscaledZ,{x:f,y:g}=h.canonical,v=f/p,y=(f+1)/p,b=g/p,x=(g+1)/p;return{minx:v,miny:b,maxx:y,maxy:x,t:u.dem.tree.raycastRoot(v,b,y,x,t,i,o),tile:u}});c.sort((u,h)=>(u.t!==null?u.t:Number.MAX_VALUE)-(h.t!==null?h.t:Number.MAX_VALUE));for(let u of c){if(u.t==null)return null;let h=u.tile.dem.tree.raycast(u.minx,u.miny,u.maxx,u.maxy,t,i,o);if(h!=null)return h}return null}_createFBO(){let t=this.painter.context,i=t.gl,o=this.drapeBufferSize;t.activeTexture.set(i.TEXTURE0);let c=new ir(t,{width:o[0],height:o[1],data:null},i.RGBA);c.bind(i.LINEAR,i.CLAMP_TO_EDGE);let u=t.createFramebuffer(o[0],o[1],!0,null);return u.colorAttachment.set(c.texture),u.depthAttachment=new $H(t,u.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,o[0],o[1]),this._stencilRef=0,u.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):u.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&i.texParameterf(i.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:u,tex:c,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.hasLightTransitions())return!0;for(let t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{let i=this._style._mergedLayers[t],o=i.isHidden(this.painter.transform.zoom);return i.type==="custom"?!o&&i.shouldRedrape():!o&&i.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(let o of this._style.getSources())if(o instanceof jP){t=!0;break}if(!t)return;let i={};for(let o=0;o<this._style.order.length;++o){let c=this._style._mergedLayers[this._style.order[o]],u=this._style.getLayerSourceCache(c);if(u&&!i[u.id]&&!c.isHidden(this.painter.transform.zoom)&&c.type==="line"&&c.widthExpression()instanceof jc){i[u.id]=!0;for(let h of this.proxyCoords){let p=this.proxyToSource[h.key][u.id];if(p)for(let f of p)this._clearRenderCacheForTile(u.id,f)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(let o in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[o]._source instanceof BC){t=!0;break}if(!t)return;let i={};for(let o=0;o<this._style.order.length;++o){let c=this._style._mergedLayers[this._style.order[o]],u=this._style.getLayerSourceCache(c);if(!u||i[u.id]||c.isHidden(this.painter.transform.zoom)||c.type!=="raster")continue;let h=c.paint.get("raster-fade-duration");for(let p of this.proxyCoords){let f=this.proxyToSource[p.key][u.id];if(f)for(let g of f){let v=IO(u.getTile(g),u.findLoadedParent(g,0),u,this.painter.transform,h);(v.opacity!==1||v.mix!==0)&&this._clearRenderCacheForTile(u.id,g)}}}}_setupDrapedRenderBatches(){let t=this._style.order,i=t.length;if(i===0)return;let o=[];this._pendingGroundEffectLayers=[];let c,u=0,h=this._style._mergedLayers[t[u]];for(;!this._style.isLayerDraped(h)&&h.isHidden(this.painter.transform.zoom)&&++u<i;)h=this._style._mergedLayers[t[u]];for(;u<i;++u){let p=this._style._mergedLayers[t[u]];p.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(p)?c===void 0&&(c=u):(p.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(u),c!==void 0&&(o.push({start:c,end:u-1}),c=void 0)))}if(c!==void 0&&o.push({start:c,end:u-1}),o.length!==0){let p=o[o.length-1];this._pendingGroundEffectLayers.every(g=>g>p.end)||lt("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=o}_setupRenderCache(t){let i=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,i.renderCache.length>i.renderCachePool.length){let h=Object.values(i.proxyCachedFBO);i.proxyCachedFBO={};for(let p=0;p<h.length;++p){let f=Object.values(h[p]);i.renderCachePool.push(...f)}}return}this._clearRasterLayersFromRenderCache();let o=this.proxyCoords,c=this._tilesDirty;for(let h=o.length-1;h>=0;h--){let p=o[h];if(i.getTileByID(p.key),i.proxyCachedFBO[p.key]!==void 0){let f=t[p.key],g=this.proxyToSource[p.key],v=0;for(let y in g){let b=g[y],x=f[y];if(!x||x.length!==b.length||b.some((C,E)=>C!==x[E]||c[y]&&c[y].hasOwnProperty(C.key))){v=-1;break}++v}for(let y in i.proxyCachedFBO[p.key])i.renderCache[i.proxyCachedFBO[p.key][y]].dirty=v<0||v!==Object.values(f).length}}let u=[...this._drapedRenderBatches];u.sort((h,p)=>p.end-p.start-(h.end-h.start));for(let h of u)for(let p of o){if(i.proxyCachedFBO[p.key])continue;let f=i.renderCachePool.pop();f===void 0&&i.renderCache.length<50&&(f=i.renderCache.length,i.renderCache.push(this._createFBO())),f!==void 0&&(i.proxyCachedFBO[p.key]={},i.proxyCachedFBO[p.key][h.start]=f,i.renderCache[f].dirty=!0)}this._tilesDirty={}}_setupStencil(t,i,o,c){if(!c||!this._sourceTilesOverlap[c.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let u=this.painter.context,h=u.gl;if(i.length<=1)return void(this._overlapStencilType=!1);let p;if(o.isTileClipped())p=i.length,this._overlapStencilMode.test={func:h.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(i[0].overscaledZ>i[i.length-1].overscaledZ))return void(this._overlapStencilType=!1);p=1,this._overlapStencilMode.test={func:h.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+p>255&&(u.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=p,this._overlapStencilMode.ref=this._stencilRef,o.isTileClipped()&&this._renderTileClippingMasks(i,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):gi.disabled}_renderTileClippingMasks(t,i){let o=this.painter,c=this.painter.context,u=c.gl;o._tileClippingMaskIDs={},c.setColorMode(Vi.disabled),c.setDepthMode(je.disabled);let h=o.getOrCreateProgram("clippingMask");for(let p of t){let f=o._tileClippingMaskIDs[p.key]=--i;h.draw(o,u.TRIANGLES,je.disabled,new gi({func:u.ALWAYS,mask:0},f,255,u.KEEP,u.KEEP,u.REPLACE),Vi.disabled,vi.disabled,rS(p.projMatrix),"$clipping",o.tileExtentBuffer,o.quadTriangleIndexBuffer,o.tileExtentSegments)}}pointCoordinate(t){let i=this.painter.transform;if(t.x<0||t.x>i.width||t.y<0||t.y>i.height)return null;let o=[t.x,t.y,1,1];un.transformMat4(o,o,i.pixelMatrixInverse),un.scale(o,o,1/o[3]),o[0]/=i.worldSize,o[1]/=i.worldSize;let c=i._camera.position,u=_n(1,i.center.lat),h=[c[0],c[1],c[2]/u,0],p=J.subtract([],o.slice(0,3),h);J.normalize(p,p);let f=this.raycast(h,p,this._exaggeration);return f!==null&&f?(J.scaleAndAdd(h,h,p,f),h[3]=h[2],h[2]*=u,h):null}drawDepth(){let t=this.painter,i=t.context,o=this.proxySourceCache,c=Math.ceil(t.width),u=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===c&&this._depthFBO.height===u||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let h=i.gl,p=i.createFramebuffer(c,u,!0,"renderbuffer");i.activeTexture.set(h.TEXTURE0);let f=new ir(i,{width:c,height:u,data:null},h.RGBA);f.bind(h.NEAREST,h.CLAMP_TO_EDGE),p.colorAttachment.set(f.texture);let g=i.createRenderbuffer(i.gl.DEPTH_COMPONENT16,c,u);p.depthAttachment.set(g),this._depthFBO=p,this._depthTexture=f}i.bindFramebuffer.set(this._depthFBO.framebuffer),i.viewport.set([0,0,c,u]),function(h,p,f,g){if(h.transform.projection.name==="globe")return;let v=h.context,y=v.gl;v.clear({depth:1});let b=h.getOrCreateProgram("terrainDepth"),x=new je(y.LESS,je.ReadWrite,h.depthRangeFor3D);for(let C of g){let E=f.getTile(C),M=SO(C.projMatrix,0,[0,0,0]);p.setupElevationDraw(E,b),b.draw(h,y.TRIANGLES,x,gi.disabled,Vi.unblended,vi.backCCW,M,"terrain_depth",p.gridBuffer,p.gridIndexBuffer,p.gridNoSkirtSegments)}}(t,this,o,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,i,o){if(t.getSource()instanceof fa)return this._setupProxiedCoordsForImageSource(t,i,o);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};let c=this.proxiedCoords[t.id]=[],u=this.proxyCoords;for(let p=0;p<u.length;p++){let f=u[p],g=this._findTileCoveringTileID(f,t);if(g){let v=this._createProxiedId(f,g,o[f.key]&&o[f.key][t.id]);c.push(v),this.proxyToSource[f.key][t.id]=[v]}}let h=!1;for(let p=0;p<i.length;p++){let f=t.getTile(i[p]);if(!f||!f.hasData())continue;let g=this._findTileCoveringTileID(f.tileID,this.proxySourceCache);if(g&&g.tileID.canonical.z!==f.tileID.canonical.z){let v=this.proxyToSource[g.tileID.key][t.id],y=this._createProxiedId(g.tileID,f,o[g.tileID.key]&&o[g.tileID.key][t.id]);v?v.splice(v.length-1,0,y):this.proxyToSource[g.tileID.key][t.id]=[y],c.push(y),h=!0}}this._sourceTilesOverlap[t.id]=h}_setupProxiedCoordsForImageSource(t,i,o){if(!t.getSource().loaded())return;let c=this.proxiedCoords[t.id]=[],u=this.proxyCoords,h=t.getSource(),p=h.tileID;if(!p)return;let f=new Q(p.x,p.y)._div(1<<p.z),g=h.coordinates.map(Oi.fromLngLat).reduce((y,b)=>(y.min.x=Math.min(y.min.x,b.x-f.x),y.min.y=Math.min(y.min.y,b.y-f.y),y.max.x=Math.max(y.max.x,b.x-f.x),y.max.y=Math.max(y.max.y,b.y-f.y),y),{min:new Q(Number.MAX_VALUE,Number.MAX_VALUE),max:new Q(-Number.MAX_VALUE,-Number.MAX_VALUE)}),v=(y,b)=>{let x=y.wrap+y.canonical.x/(1<<y.canonical.z),C=y.canonical.y/(1<<y.canonical.z),E=wt/(1<<y.canonical.z),M=b.wrap+b.canonical.x/(1<<b.canonical.z),D=b.canonical.y/(1<<b.canonical.z);return x+E<M+g.min.x||x>M+g.max.x||C+E<D+g.min.y||C>D+g.max.y};for(let y=0;y<u.length;y++){let b=u[y];for(let x=0;x<i.length;x++){let C=t.getTile(i[x]);if(!C||!C.hasData()||v(b,C.tileID))continue;let E=this._createProxiedId(b,C,o[b.key]&&o[b.key][t.id]),M=this.proxyToSource[b.key][t.id];M?M.push(E):this.proxyToSource[b.key][t.id]=[E],c.push(E)}}}_createProxiedId(t,i,o){let c=this.orthoMatrix;if(o){let u=o.find(h=>h.key===i.tileID.key);if(u)return u}if(i.tileID.key!==t.key){let u=t.canonical.z-i.tileID.canonical.z,h,p,f;c=ft.create();let g=i.tileID.wrap-t.wrap<<t.overscaledZ;u>0?(h=wt>>u,p=h*((i.tileID.canonical.x<<u)-t.canonical.x+g),f=h*((i.tileID.canonical.y<<u)-t.canonical.y)):(h=wt<<-u,p=wt*(i.tileID.canonical.x-(t.canonical.x+g<<-u)),f=wt*(i.tileID.canonical.y-(t.canonical.y<<-u))),ft.ortho(c,0,h,0,h,0,1),ft.translate(c,c,[p,f,0])}return new AO(i.tileID,t.key,c)}_findTileCoveringTileID(t,i){let o=i.getTile(t);if(o&&o.hasData())return o;let c=this._findCoveringTileCache[i.id],u=c[t.key];if(o=u?i.getTileByID(u):null,o&&o.hasData()||u===null)return o;let h=o?o.tileID:t,p=h.overscaledZ,f=i.getSource().minzoom,g=[];if(!u){let y=i.getSource().maxzoom;if(t.canonical.z>=y){let b=t.canonical.z-y;i.getSource().reparseOverscaled?(p=Math.max(t.canonical.z+2,i.transform.tileZoom),h=new Hi(p,t.wrap,y,t.canonical.x>>b,t.canonical.y>>b)):b!==0&&(p=y,h=new Hi(p,t.wrap,y,t.canonical.x>>b,t.canonical.y>>b))}h.key!==t.key&&(g.push(h.key),o=i.getTile(h))}let v=y=>{g.forEach(b=>{c[b]=y}),g.length=0};for(p-=1;p>=f&&(!o||!o.hasData());p--){o&&v(o.tileID.key);let y=h.calculateScaledKey(p);if(o=i.getTileByID(y),o&&o.hasData())break;let b=c[y];if(b===null)break;b===void 0?g.push(y):o=i.getTileByID(b)}return v(o?o.tileID.key:null),o&&o.hasData()?o:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,i){let o=this._tilesDirty[t];o||(o=this._tilesDirty[t]={}),o[i.key]=!0}}function jq(e,t,i){let o=function(p,f,g){let v=J.dot(f,p),y=J.dot(g,[.2126,.7152,.0722]),b=(C,E,M)=>(1-M)*C+M*E,x=b(1-.3*Math.min(y,1),1,Math.min(v+1,1));return b(.92,1,Math.asin(ve(f[2],-1,1))/Math.PI+.5)*x}(e,[0,0,1],t),c=[0,0,0];J.scale(c,i.slice(0,3),o);let u=[0,0,0];J.scale(u,t.slice(0,3),e[2]);let h=[0,0,0];return J.add(h,c,u),Or(h)}let Uq=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Hq=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class kO{static cacheKey(t,i,o,c){let u=`${i}${c?c.cacheKey:""}`;for(let h of o)t.usedDefines.includes(h)&&(u+=`/${h}`);return u}constructor(t,i,o,c,u,h){let p=t.gl;this.program=p.createProgram(),this.configuration=c,this.name=i,this.fixedDefines=[...h];let f=c?c.getBinderAttributes():[],g=(o.staticAttributes||[]).concat(f),v=c?c.defines():[];v=v.concat(h.map(M=>`#define ${M}`));let y=`#version 300 es
`,b=y+v.concat("precision mediump float;",bO,yO.fragmentSource).join(`
`);for(let M of o.fragmentIncludes)b+=`
${K0[M]}`;b+=`
${o.fragmentSource}`;let x=y+v.concat("precision highp float;",bO,yO.vertexSource).join(`
`);for(let M of o.vertexIncludes)x+=`
${K0[M]}`;x+=`
${o.vertexSource}`;let C=p.createShader(p.FRAGMENT_SHADER);if(p.isContextLost())return void(this.failedToCreate=!0);p.shaderSource(C,b),p.compileShader(C),p.attachShader(this.program,C);let E=p.createShader(p.VERTEX_SHADER);if(p.isContextLost())this.failedToCreate=!0;else{p.shaderSource(E,x),p.compileShader(E),p.attachShader(this.program,E),this.attributes={},this.numAttributes=g.length;for(let M=0;M<this.numAttributes;M++)if(g[M]){let D=g[M].startsWith("a_")?g[M]:`a_${g[M]}`;p.bindAttribLocation(this.program,M,D),this.attributes[D]=M}p.linkProgram(this.program),p.deleteShader(E),p.deleteShader(C),this.fixedUniforms=u(t),this.binderUniforms=c?c.getUniforms(t):[],h.includes("TERRAIN")&&(this.terrainUniforms=(M=>({u_dem:new yi(M),u_dem_prev:new yi(M),u_dem_tl:new bi(M),u_dem_scale:new Bt(M),u_dem_tl_prev:new bi(M),u_dem_scale_prev:new Bt(M),u_dem_size:new Bt(M),u_dem_lerp:new Bt(M),u_exaggeration:new Bt(M),u_depth:new yi(M),u_depth_size_inv:new bi(M),u_meter_to_dem:new Bt(M),u_label_plane_matrix_inv:new si(M)}))(t)),h.includes("GLOBE")&&(this.globeUniforms=(M=>({u_tile_tl_up:new ci(M),u_tile_tr_up:new ci(M),u_tile_br_up:new ci(M),u_tile_bl_up:new ci(M),u_tile_up_scale:new Bt(M)}))(t)),h.includes("FOG")&&(this.fogUniforms=(M=>({u_fog_matrix:new si(M),u_fog_range:new bi(M),u_fog_color:new ws(M),u_fog_horizon_blend:new Bt(M),u_fog_vertical_limit:new bi(M),u_fog_temporal_offset:new Bt(M),u_frustum_tl:new ci(M),u_frustum_tr:new ci(M),u_frustum_br:new ci(M),u_frustum_bl:new ci(M),u_globe_pos:new ci(M),u_globe_radius:new Bt(M),u_globe_transition:new Bt(M),u_is_globe:new yi(M),u_viewport:new bi(M)}))(t)),h.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(M=>({u_cutoff_params:new ws(M)}))(t)),h.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(M=>({u_lighting_ambient_color:new ci(M),u_lighting_directional_dir:new ci(M),u_lighting_directional_color:new ci(M),u_ground_radiance:new ci(M)}))(t)),h.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(M=>({u_light_matrix_0:new si(M),u_light_matrix_1:new si(M),u_fade_range:new bi(M),u_shadow_normal_offset:new ci(M),u_shadow_intensity:new Bt(M),u_shadow_texel_size:new Bt(M),u_shadow_map_resolution:new Bt(M),u_shadow_direction:new ci(M),u_shadow_bias:new ci(M),u_shadowmap_0:new yi(M),u_shadowmap_1:new yi(M)}))(t))}}setTerrainUniformValues(t,i){if(!this.terrainUniforms)return;let o=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let c in i)o[c]&&o[c].set(this.program,c,i[c])}}setGlobeUniformValues(t,i){if(!this.globeUniforms)return;let o=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let c in i)o[c]&&o[c].set(this.program,c,i[c])}}setFogUniformValues(t,i){if(!this.fogUniforms)return;let o=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let c in i)o[c].set(this.program,c,i[c])}}setCutoffUniformValues(t,i){if(!this.cutoffUniforms)return;let o=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let c in i)o[c].set(this.program,c,i[c])}}setLightsUniformValues(t,i){if(!this.lightsUniforms)return;let o=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let c in i)o[c].set(this.program,c,i[c])}}setShadowUniformValues(t,i){if(this.failedToCreate||!this.shadowUniforms)return;let o=this.shadowUniforms;t.program.set(this.program);for(let c in i)o[c].set(this.program,c,i[c])}_drawDebugWireframe(t,i,o,c,u,h,p,f,g,v){let y=t.options.wireframe;if(y.terrain===!1&&y.layers2D===!1&&y.layers3D===!1)return;let b=t.context;if(!(!(!y.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!y.layers2D||t._terrain&&t._terrain.renderingToTexture||!Uq.includes(this.name))||!(!y.layers3D||!Hq.includes(this.name))))return;let x=b.gl,C=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,u,b);if(!C)return;let E=[...this.fixedDefines];E.push("DEBUG_WIREFRAME");let M=t.getOrCreateProgram(this.name,{config:this.configuration,defines:E});b.program.set(M.program);let D=(O,R,F)=>{if(R[O]&&F[O])for(let z in R[O])F[O][z]&&F[O][z].set(F.program,z,R[O][z].current)};g&&g.setUniforms(M.program,b,M.binderUniforms,p,{zoom:f}),D("fixedUniforms",this,M),D("terrainUniforms",this,M),D("globeUniforms",this,M),D("fogUniforms",this,M),D("lightsUniforms",this,M),D("shadowUniforms",this,M),C.bind(),b.setColorMode(new Vi([x.ONE,x.ONE_MINUS_SRC_ALPHA,x.ZERO,x.ONE],fi.transparent,[!0,!0,!0,!1])),b.setDepthMode(new je(i.func===x.LESS?x.LEQUAL:i.func,je.ReadOnly,i.range)),b.setStencilMode(gi.disabled);let I=3*h.primitiveLength*2,P=3*h.primitiveOffset*2*2;v&&v>1?x.drawElementsInstanced(x.LINES,I,x.UNSIGNED_SHORT,P,v):x.drawElements(x.LINES,I,x.UNSIGNED_SHORT,P),u.bind(),b.program.set(this.program),b.setDepthMode(i),b.setStencilMode(o),b.setColorMode(c)}draw(t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M){let D=t.context,I=D.gl;if(this.failedToCreate)return;D.program.set(this.program),D.setDepthMode(o),D.setStencilMode(c),D.setColorMode(u),D.setCullFace(h);for(let R of Object.keys(this.fixedUniforms))this.fixedUniforms[R].set(this.program,R,p[R]);C&&C.setUniforms(this.program,D,this.binderUniforms,b,{zoom:x});let P={[I.LINES]:2,[I.TRIANGLES]:3,[I.LINE_STRIP]:1}[i],O=M&&M>0?1:void 0;for(let R of y.get()){let F=R.vaos||(R.vaos={});(F[f]||(F[f]=new Pq)).bind(D,this,g,C?C.getPaintVertexBuffers():[],v,R.vertexOffset,E||[],O),M&&M>1?I.drawElementsInstanced(i,R.primitiveLength*P,I.UNSIGNED_SHORT,R.primitiveOffset*P*2,M):I.drawElements(i,R.primitiveLength*P,I.UNSIGNED_SHORT,R.primitiveOffset*P*2),i===I.TRIANGLES&&this._drawDebugWireframe(t,o,c,u,v,R,b,x,C,M)}}}function RO(e,t){let i=Math.pow(2,t.tileID.overscaledZ),o=t.tileSize*Math.pow(2,e.transform.tileZoom)/i,c=o*(t.tileID.canonical.x+t.tileID.wrap*i),u=o*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/au(t,1,e.transform.tileZoom),u_pixel_coord_upper:[c>>16,u>>16],u_pixel_coord_lower:[65535&c,65535&u]}}let Gq=ft.create(),PO=(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E)=>{let M=t.style.light,D=M.properties.get("position"),I=[D.x,D.y,D.z],P=ds.create();M.properties.get("anchor")==="viewport"&&(ds.fromRotation(P,-t.transform.angle),J.transformMat3(I,I,P));let O=M.properties.get("color"),R=t.transform,F={u_matrix:e,u_lightpos:I,u_lightintensity:M.properties.get("intensity"),u_lightcolor:[O.r,O.g,O.b],u_vertical_gradient:+i,u_opacity:o,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Gq,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:c,u_edge_radius:u,u_flood_light_color:y,u_vertical_scale:b,u_flood_light_intensity:x,u_ground_shadow_factor:C,u_emissive_strength:E};return R.projection.name==="globe"&&(F.u_tile_id=[h.canonical.x,h.canonical.y,1<<h.canonical.z],F.u_zoom_transition=f,F.u_inv_rot_matrix=v,F.u_merc_center=g,F.u_up_dir=R.projection.upVector(new ua(0,0,0),g[0]*wt,g[1]*wt),F.u_height_lift=p),F},qq=(e,t,i)=>({u_matrix:e,u_edge_radius:t,u_vertical_scale:i}),Wq=(e,t,i,o,c,u,h,p,f,g,v,y,b,x)=>{let C=PO(e,t,i,o,c,u,h,f,g,v,y,b,x,1,[0,0,0],0),E={u_height_factor:-Math.pow(2,h.overscaledZ)/p.tileSize/8};return ge(C,RO(t,p),E)},OO=(e,t)=>({u_matrix:e,u_emissive_strength:t}),FO=(e,t,i,o)=>ge(OO(e,t),RO(i,o)),$q=(e,t,i)=>({u_matrix:e,u_world:i,u_emissive_strength:t}),Yq=(e,t,i,o,c)=>ge(FO(e,t,i,o),{u_world:c}),Zq=(e,t,i,o)=>{let c=wt/i.tileSize;return{u_matrix:e,u_camera_to_center_distance:t.getCameraToCenterDistance(o),u_extrude_scale:[t.pixelsToGLUnits[0]/c,t.pixelsToGLUnits[1]/c]}},LO=(e,t,i=1)=>({u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:i}),Xq=ft.create(),Kq=(e,t,i,o,c,u,h)=>{let p=e.transform,f=p.projection.name==="globe",g=f?YA(p.zoom,t.canonical)*p._pixelsPerMercatorPixel:au(i,1,u),v={u_matrix:t.projMatrix,u_extrude_scale:g,u_intensity:h,u_inv_rot_matrix:Xq,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(f){v.u_inv_rot_matrix=o,v.u_merc_center=c,v.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],v.u_zoom_transition=wo(p.zoom);let y=c[0]*wt,b=c[1]*wt;v.u_up_dir=p.projection.upVector(new ua(0,0,0),y,b)}return v},zO=(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M,D,I,P,O,R)=>{return{u_matrix:e,u_normalize_matrix:t,u_globe_matrix:i,u_merc_matrix:o,u_grid_matrix:c,u_tl_parent:u,u_scale_parent:v,u_fade_t:y.mix,u_opacity:y.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(z=b.paint.get("raster-saturation"),z>0?1-1/(1.001-z):-z),u_contrast_factor:(F=b.paint.get("raster-contrast"),F>0?1/(1-F):1+F),u_spin_weights:Qq(b.paint.get("raster-hue-rotate")),u_perspective_transform:x,u_raster_elevation:C,u_tl_br:h,u_zoom_transition:p,u_merc_center:f,u_cutoff_params:g,u_colorization_mix:Jq(M,I),u_colorization_offset:tW(D,I),u_color_ramp:E,u_texture_offset:[O/(P+2*O),P/(P+2*O)],u_texture_res:[P+2*O,P+2*O],u_emissive_strength:R};var F,z};function Qq(e){e*=Math.PI/180;let t=Math.sin(e),i=Math.cos(e);return[(2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3]}function Jq([e,t,i,o],[c,u]){if(c===u)return[0,0,0,0];let h=259/257/(u-c);return[e*h,t*h,i*h,o*h]}function tW(e,[t,i]){return t===i?0:((e-t)/(i-t)*259-1)/257}let NO=ft.create(),BO=(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M,D)=>{let I=c.transform,P={u_is_size_zoom_constant:+(e==="constant"||e==="source"),u_is_size_feature_constant:+(e==="constant"||e==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:I.getCameraToCenterDistance(E),u_rotate_symbol:+i,u_aspect_ratio:I.width/I.height,u_fade_change:c.options.fadeDuration?c.symbolFadeChange:1,u_matrix:u,u_label_plane_matrix:h,u_coord_matrix:p,u_is_text:+f,u_pitch_with_map:+o,u_texsize:g,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:NO,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:NO,u_up_vector:[0,-1,0],u_icon_transition:D||0,u_icon_saturation:M};return E.name==="globe"&&(P.u_tile_id=[v.canonical.x,v.canonical.y,1<<v.canonical.z],P.u_zoom_transition=y,P.u_inv_rot_matrix=x,P.u_merc_center=b,P.u_camera_forward=I._camera.forward(),P.u_ecef_origin=function(O,R){let F=[0,0,0],z=Kc(Ws(R.canonical));return J.transformMat4(F,F,z),J.transformMat4(F,F,O),F}(I.globeMatrix,v.toUnwrapped()),P.u_tile_matrix=Float32Array.from(I.globeMatrix),P.u_up_vector=C),P},VO=(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M)=>ge(BO(e,t,i,o,c,u,h,p,f,g,y,b,x,C,E,M,1),{u_gamma_scale:o?c.transform.getCameraToCenterDistance(M)*Math.cos(c.terrain?0:c.transform._pitch):1,u_device_pixel_ratio:ni.devicePixelRatio,u_is_halo:+v,undefined:void 0}),eW=(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E)=>ge(VO(e,t,i,o,c,u,h,p,!0,f,!0,v,y,b,x,C,E),{u_texsize_icon:g,u_texture_icon:1}),iW=(e,t,i,o)=>({u_matrix:e,u_emissive_strength:t,u_opacity:i,u_color:o}),nW=(e,t,i,o,c,u,h)=>ge(function(p,f,g,v){let y=g.imageManager.getPattern(p.toString(),f),{width:b,height:x}=g.imageManager.getPixelSize(f),C=Math.pow(2,v.tileID.overscaledZ),E=v.tileSize*Math.pow(2,g.transform.tileZoom)/C,M=E*(v.tileID.canonical.x+v.tileID.wrap*C),D=E*v.tileID.canonical.y;return{u_image:0,u_pattern_tl:y.tl,u_pattern_br:y.br,u_texsize:[b,x],u_pattern_size:y.displaySize,u_tile_units_to_pixels:1/au(v,1,g.transform.tileZoom),u_pixel_coord_upper:[M>>16,D>>16],u_pixel_coord_lower:[65535&M,65535&D]}}(c,u,o,h),{u_matrix:e,u_emissive_strength:t,u_opacity:i}),Ms={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},oS=(e,t,i,o,c,u,h,p,f,g,v,y,b=[0,0,0])=>{let x=o.style.light,C=x.properties.get("position"),E=[-C.x,-C.y,C.z],M=ds.create();x.properties.get("anchor")==="viewport"&&(ds.fromRotation(M,-o.transform.angle),J.transformMat3(E,E,M));let D=g.alphaMode==="MASK",I=x.properties.get("color"),P=y.paint.get("model-ambient-occlusion-intensity"),O=y.paint.get("model-color").constantOr(fi.white),R=y.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:e,u_lighting_matrix:t,u_normal_matrix:i,u_lightpos:E,u_lightintensity:x.properties.get("intensity"),u_lightcolor:[I.r,I.g,I.b],u_camera_pos:b,u_opacity:c,u_baseTextureIsAlpha:0,u_alphaMask:+D,u_alphaCutoff:g.alphaCutoff,u_baseColorFactor:[u.r,u.g,u.b,u.a],u_emissiveFactor:[h[0],h[1],h[2],1],u_metallicFactor:p,u_roughnessFactor:f,u_baseColorTexture:Ms.BaseColor,u_metallicRoughnessTexture:Ms.MetallicRoughness,u_normalTexture:Ms.Normal,u_occlusionTexture:Ms.Occlusion,u_emissionTexture:Ms.Emission,u_color_mix:[O.r,O.g,O.b,R],u_aoIntensity:P,u_emissive_strength:v}},jO=new Float32Array(16),UO=(e,t=jO,i=jO)=>({u_matrix:e,u_instance:t,u_node_matrix:i}),rW={fillExtrusion:e=>({u_matrix:new si(e),u_lightpos:new ci(e),u_lightintensity:new Bt(e),u_lightcolor:new ci(e),u_vertical_gradient:new Bt(e),u_opacity:new Bt(e),u_edge_radius:new Bt(e),u_ao:new bi(e),u_tile_id:new ci(e),u_zoom_transition:new Bt(e),u_inv_rot_matrix:new si(e),u_merc_center:new bi(e),u_up_dir:new ci(e),u_height_lift:new Bt(e),u_flood_light_color:new ci(e),u_vertical_scale:new Bt(e),u_flood_light_intensity:new Bt(e),u_ground_shadow_factor:new ci(e),u_emissive_strength:new Bt(e)}),fillExtrusionDepth:e=>({u_matrix:new si(e),u_edge_radius:new Bt(e),u_vertical_scale:new Bt(e)}),fillExtrusionPattern:e=>({u_matrix:new si(e),u_lightpos:new ci(e),u_lightintensity:new Bt(e),u_lightcolor:new ci(e),u_vertical_gradient:new Bt(e),u_height_factor:new Bt(e),u_edge_radius:new Bt(e),u_ao:new bi(e),u_tile_id:new ci(e),u_zoom_transition:new Bt(e),u_inv_rot_matrix:new si(e),u_merc_center:new bi(e),u_up_dir:new ci(e),u_height_lift:new Bt(e),u_image:new yi(e),u_texsize:new bi(e),u_pixel_coord_upper:new bi(e),u_pixel_coord_lower:new bi(e),u_tile_units_to_pixels:new Bt(e),u_opacity:new Bt(e)}),fillExtrusionGroundEffect:e=>({u_matrix:new si(e),u_opacity:new Bt(e),u_ao_pass:new Bt(e),u_meter_to_tile:new Bt(e),u_ao:new bi(e),u_flood_light_intensity:new Bt(e),u_flood_light_color:new ci(e),u_attenuation:new Bt(e),u_edge_radius:new Bt(e),u_fb:new yi(e),u_fb_size:new Bt(e)}),fill:e=>({u_matrix:new si(e),u_emissive_strength:new Bt(e)}),fillPattern:e=>({u_matrix:new si(e),u_emissive_strength:new Bt(e),u_image:new yi(e),u_texsize:new bi(e),u_pixel_coord_upper:new bi(e),u_pixel_coord_lower:new bi(e),u_tile_units_to_pixels:new Bt(e)}),fillOutline:e=>({u_matrix:new si(e),u_emissive_strength:new Bt(e),u_world:new bi(e)}),fillOutlinePattern:e=>({u_matrix:new si(e),u_emissive_strength:new Bt(e),u_world:new bi(e),u_image:new yi(e),u_texsize:new bi(e),u_pixel_coord_upper:new bi(e),u_pixel_coord_lower:new bi(e),u_tile_units_to_pixels:new Bt(e)}),circle:e=>({u_camera_to_center_distance:new Bt(e),u_extrude_scale:new yw(e),u_device_pixel_ratio:new Bt(e),u_matrix:new si(e),u_inv_rot_matrix:new si(e),u_merc_center:new bi(e),u_tile_id:new ci(e),u_zoom_transition:new Bt(e),u_up_dir:new ci(e),u_emissive_strength:new Bt(e)}),collisionBox:e=>({u_matrix:new si(e),u_camera_to_center_distance:new Bt(e),u_extrude_scale:new bi(e)}),collisionCircle:e=>({u_matrix:new si(e),u_inv_matrix:new si(e),u_camera_to_center_distance:new Bt(e),u_viewport_size:new bi(e)}),debug:e=>({u_color:new fh(e),u_matrix:new si(e),u_overlay:new yi(e),u_overlay_scale:new Bt(e)}),clippingMask:e=>({u_matrix:new si(e)}),heatmap:e=>({u_extrude_scale:new Bt(e),u_intensity:new Bt(e),u_matrix:new si(e),u_inv_rot_matrix:new si(e),u_merc_center:new bi(e),u_tile_id:new ci(e),u_zoom_transition:new Bt(e),u_up_dir:new ci(e)}),heatmapTexture:e=>({u_image:new yi(e),u_color_ramp:new yi(e),u_opacity:new Bt(e)}),hillshade:e=>({u_matrix:new si(e),u_image:new yi(e),u_latrange:new bi(e),u_light:new bi(e),u_shadow:new fh(e),u_highlight:new fh(e),u_emissive_strength:new Bt(e),u_accent:new fh(e)}),hillshadePrepare:e=>({u_matrix:new si(e),u_image:new yi(e),u_dimension:new bi(e),u_zoom:new Bt(e)}),line:e=>({u_matrix:new si(e),u_pixels_to_tile_units:new yw(e),u_device_pixel_ratio:new Bt(e),u_units_to_pixels:new bi(e),u_dash_image:new yi(e),u_gradient_image:new yi(e),u_image_height:new Bt(e),u_texsize:new bi(e),u_tile_units_to_pixels:new Bt(e),u_alpha_discard_threshold:new Bt(e),u_trim_offset:new bi(e),u_emissive_strength:new Bt(e)}),linePattern:e=>({u_matrix:new si(e),u_texsize:new bi(e),u_pixels_to_tile_units:new yw(e),u_device_pixel_ratio:new Bt(e),u_image:new yi(e),u_units_to_pixels:new bi(e),u_tile_units_to_pixels:new Bt(e),u_alpha_discard_threshold:new Bt(e)}),raster:e=>({u_matrix:new si(e),u_normalize_matrix:new si(e),u_globe_matrix:new si(e),u_merc_matrix:new si(e),u_grid_matrix:new vw(e),u_tl_parent:new bi(e),u_scale_parent:new Bt(e),u_fade_t:new Bt(e),u_opacity:new Bt(e),u_image0:new yi(e),u_image1:new yi(e),u_brightness_low:new Bt(e),u_brightness_high:new Bt(e),u_saturation_factor:new Bt(e),u_contrast_factor:new Bt(e),u_spin_weights:new ci(e),u_perspective_transform:new bi(e),u_raster_elevation:new Bt(e),u_tl_br:new ws(e),u_zoom_transition:new Bt(e),u_merc_center:new bi(e),u_cutoff_params:new ws(e),u_colorization_mix:new ws(e),u_colorization_offset:new Bt(e),u_color_ramp:new yi(e),u_texture_offset:new bi(e),u_texture_res:new bi(e),u_emissive_strength:new Bt(e)}),symbolIcon:e=>({u_is_size_zoom_constant:new yi(e),u_is_size_feature_constant:new yi(e),u_size_t:new Bt(e),u_size:new Bt(e),u_camera_to_center_distance:new Bt(e),u_rotate_symbol:new yi(e),u_aspect_ratio:new Bt(e),u_fade_change:new Bt(e),u_matrix:new si(e),u_label_plane_matrix:new si(e),u_coord_matrix:new si(e),u_is_text:new yi(e),u_pitch_with_map:new yi(e),u_texsize:new bi(e),u_tile_id:new ci(e),u_zoom_transition:new Bt(e),u_inv_rot_matrix:new si(e),u_merc_center:new bi(e),u_camera_forward:new ci(e),u_tile_matrix:new si(e),u_up_vector:new ci(e),u_ecef_origin:new ci(e),u_texture:new yi(e),u_icon_transition:new Bt(e),u_icon_saturation:new Bt(e)}),symbolSDF:e=>({u_is_size_zoom_constant:new yi(e),u_is_size_feature_constant:new yi(e),u_size_t:new Bt(e),u_size:new Bt(e),u_camera_to_center_distance:new Bt(e),u_rotate_symbol:new yi(e),u_aspect_ratio:new Bt(e),u_fade_change:new Bt(e),u_matrix:new si(e),u_label_plane_matrix:new si(e),u_coord_matrix:new si(e),u_is_text:new yi(e),u_pitch_with_map:new yi(e),u_texsize:new bi(e),u_texture:new yi(e),u_gamma_scale:new Bt(e),u_device_pixel_ratio:new Bt(e),u_tile_id:new ci(e),u_zoom_transition:new Bt(e),u_inv_rot_matrix:new si(e),u_merc_center:new bi(e),u_camera_forward:new ci(e),u_tile_matrix:new si(e),u_up_vector:new ci(e),u_ecef_origin:new ci(e),u_is_halo:new yi(e)}),symbolTextAndIcon:e=>({u_is_size_zoom_constant:new yi(e),u_is_size_feature_constant:new yi(e),u_size_t:new Bt(e),u_size:new Bt(e),u_camera_to_center_distance:new Bt(e),u_rotate_symbol:new yi(e),u_aspect_ratio:new Bt(e),u_fade_change:new Bt(e),u_matrix:new si(e),u_label_plane_matrix:new si(e),u_coord_matrix:new si(e),u_is_text:new yi(e),u_pitch_with_map:new yi(e),u_texsize:new bi(e),u_texsize_icon:new bi(e),u_texture:new yi(e),u_texture_icon:new yi(e),u_gamma_scale:new Bt(e),u_device_pixel_ratio:new Bt(e),u_is_halo:new yi(e)}),background:e=>({u_matrix:new si(e),u_emissive_strength:new Bt(e),u_opacity:new Bt(e),u_color:new fh(e)}),backgroundPattern:e=>({u_matrix:new si(e),u_emissive_strength:new Bt(e),u_opacity:new Bt(e),u_image:new yi(e),u_pattern_tl:new bi(e),u_pattern_br:new bi(e),u_texsize:new bi(e),u_pattern_size:new bi(e),u_pixel_coord_upper:new bi(e),u_pixel_coord_lower:new bi(e),u_tile_units_to_pixels:new Bt(e)}),terrainRaster:CO,terrainDepth:CO,skybox:e=>({u_matrix:new si(e),u_sun_direction:new ci(e),u_cubemap:new yi(e),u_opacity:new Bt(e),u_temporal_offset:new Bt(e)}),skyboxGradient:e=>({u_matrix:new si(e),u_color_ramp:new yi(e),u_center_direction:new ci(e),u_radius:new Bt(e),u_opacity:new Bt(e),u_temporal_offset:new Bt(e)}),skyboxCapture:e=>({u_matrix_3f:new vw(e),u_sun_direction:new ci(e),u_sun_intensity:new Bt(e),u_color_tint_r:new ws(e),u_color_tint_m:new ws(e),u_luminance:new Bt(e)}),globeRaster:e=>({u_proj_matrix:new si(e),u_globe_matrix:new si(e),u_normalize_matrix:new si(e),u_merc_matrix:new si(e),u_zoom_transition:new Bt(e),u_merc_center:new bi(e),u_image0:new yi(e),u_grid_matrix:new vw(e),u_skirt_height:new Bt(e),u_frustum_tl:new ci(e),u_frustum_tr:new ci(e),u_frustum_br:new ci(e),u_frustum_bl:new ci(e),u_globe_pos:new ci(e),u_globe_radius:new Bt(e),u_viewport:new bi(e)}),globeAtmosphere:e=>({u_frustum_tl:new ci(e),u_frustum_tr:new ci(e),u_frustum_br:new ci(e),u_frustum_bl:new ci(e),u_horizon:new Bt(e),u_transition:new Bt(e),u_fadeout_range:new Bt(e),u_color:new ws(e),u_high_color:new ws(e),u_space_color:new ws(e),u_temporal_offset:new Bt(e),u_horizon_angle:new Bt(e)}),model:e=>({u_matrix:new si(e),u_lighting_matrix:new si(e),u_normal_matrix:new si(e),u_lightpos:new ci(e),u_lightintensity:new Bt(e),u_lightcolor:new ci(e),u_camera_pos:new ci(e),u_opacity:new Bt(e),u_baseColorFactor:new ws(e),u_emissiveFactor:new ws(e),u_metallicFactor:new Bt(e),u_roughnessFactor:new Bt(e),u_baseTextureIsAlpha:new yi(e),u_alphaMask:new yi(e),u_alphaCutoff:new Bt(e),u_baseColorTexture:new yi(e),u_metallicRoughnessTexture:new yi(e),u_normalTexture:new yi(e),u_occlusionTexture:new yi(e),u_emissionTexture:new yi(e),u_color_mix:new ws(e),u_aoIntensity:new Bt(e),u_emissive_strength:new Bt(e)}),modelDepth:e=>({u_matrix:new si(e),u_instance:new si(e),u_node_matrix:new si(e)}),groundShadow:e=>({u_matrix:new si(e),u_ground_shadow_factor:new ci(e)}),stars:e=>({u_matrix:new si(e),u_up:new ci(e),u_right:new ci(e),u_intensity_multiplier:new Bt(e)})},tv;function HO(e,t,i,o,c,u,h){let p=e.context,f=p.gl,g=e.transform,v=e.getOrCreateProgram("collisionBox"),y=[],b=0,x=0;for(let O=0;O<o.length;O++){let R=o[O],F=t.getTile(R),z=F.getBucket(i);if(!z)continue;let j=fq(R,z,g),U=j;c[0]===0&&c[1]===0||(U=e.translatePosMatrix(j,F,c,u));let G=h?z.textCollisionBox:z.iconCollisionBox,$=z.collisionCircleArray;if($.length>0){let Y=ft.create(),tt=U;ft.mul(Y,z.placementInvProjMatrix,g.glCoordMatrix),ft.mul(Y,Y,z.placementViewportMatrix),y.push({circleArray:$,circleOffset:x,transform:tt,invTransform:Y,projection:z.getProjection()}),b+=$.length/4,x=b}G&&(e.terrain&&e.terrain.setupElevationDraw(F,v),v.draw(e,f.LINES,je.disabled,gi.disabled,e.colorModeForRenderPass(),vi.disabled,Zq(U,g,F,z.getProjection()),i.id,G.layoutVertexBuffer,G.indexBuffer,G.segments,null,g.zoom,null,[G.collisionVertexBuffer,G.collisionVertexBufferExt]))}if(!h||!y.length)return;let C=e.getOrCreateProgram("collisionCircle"),E=new aw;E.resize(4*b),E._trim();let M=0;for(let O of y)for(let R=0;R<O.circleArray.length/4;R++){let F=4*R,z=O.circleArray[F+0],j=O.circleArray[F+1],U=O.circleArray[F+2],G=O.circleArray[F+3];E.emplace(M++,z,j,U,G,0),E.emplace(M++,z,j,U,G,1),E.emplace(M++,z,j,U,G,2),E.emplace(M++,z,j,U,G,3)}(!tv||tv.length<2*b)&&(tv=function(O){let R=2*O,F=new qr;F.resize(R),F._trim();for(let z=0;z<R;z++){let j=6*z;F.uint16[j+0]=4*z+0,F.uint16[j+1]=4*z+1,F.uint16[j+2]=4*z+2,F.uint16[j+3]=4*z+2,F.uint16[j+4]=4*z+3,F.uint16[j+5]=4*z+0}return F}(b));let D=p.createIndexBuffer(tv,!0),I=p.createVertexBuffer(E,D8.members,!0);for(let O of y){let R={u_matrix:O.transform,u_inv_matrix:O.invTransform,u_camera_to_center_distance:(P=g).getCameraToCenterDistance(O.projection),u_viewport_size:[P.width,P.height]};C.draw(e,f.TRIANGLES,je.disabled,gi.disabled,e.colorModeForRenderPass(),vi.disabled,R,i.id,I,D,dn.simpleSegment(0,2*O.circleOffset,O.circleArray.length,O.circleArray.length/2),null,g.zoom)}var P;I.destroy(),D.destroy()}let GO=ft.create();function oW({width:e,height:t,anchor:i,textOffset:o,textScale:c},u){let{horizontalAlign:h,verticalAlign:p}=p0(i),f=-(h-.5)*e,g=-(p-.5)*t,v=gC(i,o);return new Q((f/c+v[0])*u,(g/c+v[1])*u)}function sW(e,t,i,o,c,u,h,p,f,g,v){let y=e.text.placedSymbolArray,b=e.text.dynamicLayoutVertexArray,x=e.icon.dynamicLayoutVertexArray,C={},E=e.getProjection(),M=QC(p,E,u),D=u.elevation,I=E.upVectorScale(p.canonical,u.center.lat,u.worldSize).metersToTile;b.clear();for(let P=0;P<y.length;P++){let O=y.get(P),{tileAnchorX:R,tileAnchorY:F,numGlyphs:z}=O,j=O.hidden||!O.crossTileID||e.allowVerticalPlacement&&!O.placedOrientation?null:o[O.crossTileID];if(j){let U=0,G=0,$=0;if(D){let _t=D?D.getAtTileOffset(p,R,F):0,[bt,yt,Ct]=E.upVector(p.canonical,R,F);U=_t*bt*I,G=_t*yt*I,$=_t*Ct*I}let[Y,tt,W,rt]=tl(O.projectedAnchorX+U,O.projectedAnchorY+G,O.projectedAnchorZ+$,i?M:h),st=OR(u.getCameraToCenterDistance(E),rt),pt=c.evaluateSizeForFeature(e.textSizeData,g,O)*st/Co;i&&(pt*=e.tilePixelRatio/f);let nt=oW(j,pt);i?({x:Y,y:tt,z:W}=E.projectTilePoint(R+nt.x,F+nt.y,p.canonical),[Y,tt,W]=tl(Y+U,tt+G,W+$,h)):(t&&nt._rotate(-u.angle),Y+=nt.x,tt+=nt.y,W=0);let ot=e.allowVerticalPlacement&&O.placedOrientation===Kn.vertical?Math.PI/2:0;for(let _t=0;_t<z;_t++)Ph(b,Y,tt,W,ot);v&&O.associatedIconIndex>=0&&(C[O.associatedIconIndex]={x:Y,y:tt,z:W,angle:ot})}else Fh(z,b)}if(v){x.clear();let P=e.icon.placedSymbolArray;for(let O=0;O<P.length;O++){let R=P.get(O),{numGlyphs:F}=R,z=C[O];if(R.hidden||!z)Fh(F,x);else{let{x:j,y:U,z:G,angle:$}=z;for(let Y=0;Y<F;Y++)Ph(x,j,U,G,$)}}e.icon.dynamicLayoutVertexBuffer.updateData(x)}e.text.dynamicLayoutVertexBuffer.updateData(b)}function aW(e,t,i){return i.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function qO(e,t,i,o,c,u,h,p,f,g,v,y,b){let x=e.context,C=x.gl,E=e.transform,M=p==="map",D=f==="map",I=M&&i.layout.get("symbol-placement")!=="point",P=M&&!D&&!I,O=i.layout.get("symbol-sort-key").constantOr(1)!==void 0,R=!1,F=e.depthModeForSublayer(0,je.ReadOnly),z=[to(E.center.lng),lo(E.center.lat)],j=i.layout.get("text-variable-anchor"),U=E.projection.name==="globe",G=[],$=[0,-1,0],Y=$;!U&&!E.mercatorFromTransition||M||(Y=function(tt){let W=tt._camera.getWorldToCamera(tt.worldSize,1),rt=ft.multiply([],W,tt.globeMatrix);ft.invert(rt,rt);let st=[0,0,0],pt=[0,1,0,0];return un.transformMat4(pt,pt,rt),st[0]=pt[0],st[1]=pt[1],st[2]=pt[2],J.normalize(st,st),st}(E));for(let tt of o){let W=t.getTile(tt),rt=W.getBucket(i);if(!rt||rt.projection.name==="mercator"&&U)continue;let st=c?rt.text:rt.icon;if(!st||rt.fullyClipped||!st.segments.get().length)continue;let pt=st.programConfigurations.get(i.id),nt=c||rt.sdfIcons,ot=c?rt.textSizeData:rt.iconSizeData,_t=D||E.pitch!==0,bt=Tl(ot,E.zoom),yt,Ct,St,Tt,xt=[0,0],Ft=null;if(c)Ct=W.glyphAtlasTexture?W.glyphAtlasTexture:null,St=C.LINEAR,yt=W.glyphAtlasTexture?W.glyphAtlasTexture.size:[0,0],rt.iconsInText&&(xt=W.imageAtlasTexture?W.imageAtlasTexture.size:[0,0],Ft=W.imageAtlasTexture?W.imageAtlasTexture:null,Tt=_t||e.options.rotating||e.options.zooming||ot.kind==="composite"||ot.kind==="camera"?C.LINEAR:C.NEAREST);else{let Gn=i.layout.get("icon-size").constantOr(0)!==1||rt.iconsNeedLinear;Ct=W.imageAtlasTexture?W.imageAtlasTexture:null,St=nt||e.options.rotating||e.options.zooming||Gn||_t?C.LINEAR:C.NEAREST,yt=W.imageAtlasTexture?W.imageAtlasTexture.size:[0,0]}let Qt=rt.projection.name==="globe",Jt=Qt?Y:$,le=Qt?wo(E.zoom):0,me=QC(tt,rt.getProjection(),E),Ue=E.calculatePixelsToTileUnitsMatrix(W),Ie=P0(me,W.tileID.canonical,D,M,E,rt.getProjection(),Ue),Bi=e.terrain&&D&&I?ft.invert(ft.create(),Ie):GO,Ci=PR(me,W.tileID.canonical,D,M,E,rt.getProjection(),Ue),He=j&&rt.hasTextData(),Ne=rt.hasIconTextFit()&&He&&rt.hasIconData();if(I){let Gn=E.elevation,an=Gn?Gn.getAtTileOffsetFunc(tt,E.center.lat,E.worldSize,rt.getProjection()):null,ko=RR(me,W.tileID.canonical,D,M,E,rt.getProjection(),Ue);oG(rt,me,e,c,ko,Ci,D,g,an,tt)}let ke=I||c&&j||Ne,Di=e.translatePosMatrix(me,W,u,h),zi=ke?GO:Ie,pi=e.translatePosMatrix(Ci,W,u,h,!0),vn=rt.getProjection().createInversionMatrix(E,tt.canonical),Mr=i.paint.get("icon-image-cross-fade").constantOr(0),hn=[];e.terrainRenderModeElevated()&&D&&hn.push("PITCH_WITH_MAP_TERRAIN"),Qt&&(hn.push("PROJECTION_GLOBE_VIEW"),ke&&hn.push("PROJECTED_POS_ON_VIEWPORT")),Mr>0&&hn.push("ICON_TRANSITION"),st.zOffsetVertexBuffer&&hn.push("Z_OFFSET");let zn=nt&&i.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Lr;nt?Lr=rt.iconsInText?eW(ot.kind,bt,P,D,e,Di,zi,pi,yt,xt,tt,le,z,vn,Jt,rt.getProjection()):VO(ot.kind,bt,P,D,e,Di,zi,pi,c,yt,!0,tt,le,z,vn,Jt,rt.getProjection()):(v<1&&hn.push("SATURATION"),Lr=BO(ot.kind,bt,P,D,e,Di,zi,pi,c,yt,tt,le,z,vn,Jt,rt.getProjection(),v,Mr));let Dr={program:e.getOrCreateProgram(aW(nt,c,rt),{config:pt,defines:hn}),buffers:st,uniformValues:Lr,atlasTexture:Ct,atlasTextureIcon:Ft,atlasInterpolation:St,atlasInterpolationIcon:Tt,isSDF:nt,hasHalo:zn,tile:W,labelPlaneMatrixInv:Bi};if(O&&rt.canOverlap){R=!0;let Gn=st.segments.get();for(let an of Gn)G.push({segments:new dn([an]),sortKey:an.sortKey,state:Dr})}else G.push({segments:st.segments,sortKey:0,state:Dr})}R&&G.sort((tt,W)=>tt.sortKey-W.sortKey);for(let tt of G){let W=tt.state;if(e.terrain&&e.terrain.setupElevationDraw(W.tile,W.program,{useDepthForOcclusion:E.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:W.labelPlaneMatrixInv}),x.activeTexture.set(C.TEXTURE0),W.atlasTexture&&W.atlasTexture.bind(W.atlasInterpolation,C.CLAMP_TO_EDGE),W.atlasTextureIcon&&(x.activeTexture.set(C.TEXTURE1),W.atlasTextureIcon&&W.atlasTextureIcon.bind(W.atlasInterpolationIcon,C.CLAMP_TO_EDGE)),e.uploadCommonLightUniforms(e.context,W.program),W.hasHalo){let rt=W.uniformValues;rt.u_is_halo=1,sS(W.buffers,tt.segments,i,e,W.program,F,y,b,rt,2),rt.u_is_halo=0}else{if(W.isSDF){let rt=W.uniformValues;W.hasHalo&&(rt.u_is_halo=1,sS(W.buffers,tt.segments,i,e,W.program,F,y,b,rt,1)),rt.u_is_halo=0}sS(W.buffers,tt.segments,i,e,W.program,F,y,b,W.uniformValues,1)}}}function sS(e,t,i,o,c,u,h,p,f,g){let v=[e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.iconTransitioningVertexBuffer,e.globeExtVertexBuffer,e.zOffsetVertexBuffer];c.draw(o,o.context.gl.TRIANGLES,u,h,p,vi.disabled,f,i.id,e.layoutVertexBuffer,e.indexBuffer,t,i.paint,o.transform.zoom,e.programConfigurations.get(i.id),v,g)}function WO(e,t,i,o,c,u,h){let p=e.context.gl,f=i.paint.get("fill-pattern"),g=f&&f.constantOr(1),v,y,b,x,C;h?(y=g&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",v=p.LINES):(y=g?"fillPattern":"fill",v=p.TRIANGLES);for(let E of o){let M=t.getTile(E);if(g&&!M.patternsLoaded())continue;let D=M.getBucket(i);if(!D)continue;e.prepareDrawTile();let I=D.programConfigurations.get(i.id),P=e.isTileAffectedByFog(E),O=e.getOrCreateProgram(y,{config:I,overrideFog:P});g&&(e.context.activeTexture.set(p.TEXTURE0),M.imageAtlasTexture&&M.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),I.updatePaintBuffers());let R=f.constantOr(null);if(R&&M.imageAtlas){let j=M.imageAtlas.patternPositions[R.toString()];j&&I.setConstantPatternPositions(j)}let F=e.translatePosMatrix(E.projMatrix,M,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor")),z=i.paint.get("fill-emissive-strength");if(h){x=D.indexBuffer2,C=D.segments2;let j=e.terrain&&e.terrain.renderingToTexture?e.terrain.drapeBufferSize:[p.drawingBufferWidth,p.drawingBufferHeight];b=y==="fillOutlinePattern"&&g?Yq(F,z,e,M,j):$q(F,z,j)}else x=D.indexBuffer,C=D.segments,b=g?FO(F,z,e,M):OO(F,z);e.uploadCommonUniforms(e.context,O,E.toUnwrapped()),O.draw(e,v,c,e.stencilModeForClipping(E),u,vi.disabled,b,i.id,D.layoutVertexBuffer,x,C,i.paint,e.transform.zoom,I,void 0)}}function ev(e,t,i,o,c,u,h,p){i.resetLayerRenderingStats();let f=e.context,g=f.gl,v=e.transform,y=i.paint.get("fill-extrusion-pattern"),b=y.constantOr(1),x=i.paint.get("fill-extrusion-opacity"),C=e.style.enable3dLights(),E=i.paint.get(C&&!b?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),M=[i.paint.get("fill-extrusion-ambient-occlusion-intensity"),E],D=i.layout.get("fill-extrusion-edge-radius"),I=D>0&&!i.paint.get("fill-extrusion-rounded-roof"),P=I?0:D,O=v.projection.name==="globe"?fP():0,R=v.projection.name==="globe",F=R?wo(v.zoom):0,z=[to(v.center.lng),lo(v.center.lat)],j=i.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),U=i.paint.get("fill-extrusion-flood-light-intensity"),G=i.paint.get("fill-extrusion-vertical-scale"),$=Nh(e,i.paint.get("fill-extrusion-cutoff-fade-range")),Y=i.paint.get("fill-extrusion-emissive-strength"),tt=[],W;R&&tt.push("PROJECTION_GLOBE_VIEW"),M[0]>0&&tt.push("FAUX_AO"),I&&tt.push("ZERO_ROOF_RADIUS"),p&&tt.push("HAS_CENTROID"),U>0&&tt.push("FLOOD_LIGHT"),$.shouldRenderCutoff&&tt.push("RENDER_CUTOFF");let rt=e.renderPass==="shadow",st=e.shadowRenderer,pt=rt&&!!st;e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!0);let nt=[0,0,0];if(st){let bt=e.style.directionalLight,yt=e.style.ambientLight;bt&&yt&&(nt=cS(bt,yt)),W=tt.concat(["SHADOWS_SINGLE_CASCADE"])}let ot=pt?"fillExtrusionDepth":b?"fillExtrusionPattern":"fillExtrusion",_t=i.getLayerRenderingStats();for(let bt of o){let yt=t.getTile(bt),Ct=yt.getBucket(i);if(!Ct||Ct.projection.name!==v.projection.name)continue;let St=!1;st&&(St=st.getMaxCascadeForTile(bt.toUnwrapped())===0);let Tt=e.isTileAffectedByFog(bt),xt=Ct.programConfigurations.get(i.id),Ft=e.getOrCreateProgram(ot,{config:xt,defines:St?W:tt,overrideFog:Tt});if(e.terrain&&e.terrain.setupElevationDraw(yt,Ft,{useMeterToDem:!0}),!Ct.centroidVertexBuffer){let Ie=Ft.attributes.a_centroid_pos;Ie!==void 0&&g.vertexAttrib2f(Ie,0,0)}!rt&&st&&st.setupShadows(yt.tileID.toUnwrapped(),Ft,"vector-tile",yt.tileID.overscaledZ),b&&(e.context.activeTexture.set(g.TEXTURE0),yt.imageAtlasTexture&&yt.imageAtlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),xt.updatePaintBuffers());let Qt=y.constantOr(null);if(Qt&&yt.imageAtlas){let Ie=yt.imageAtlas.patternPositions[Qt.toString()];Ie&&xt.setConstantPatternPositions(Ie)}let Jt=i.paint.get("fill-extrusion-vertical-gradient"),le;if(rt&&st){if(hW(yt.tileID,Ct,e))continue;let Ie=st.calculateShadowPassMatrixFromTile(yt.tileID.toUnwrapped());le=qq(Ie,P,G)}else{let Ie=e.translatePosMatrix(bt.expandedProjMatrix,yt,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),Bi=v.projection.createInversionMatrix(v,bt.canonical);le=b?Wq(Ie,e,Jt,x,M,P,bt,yt,O,F,z,Bi,j,G):PO(Ie,e,Jt,x,M,P,bt,O,F,z,Bi,j,G,U,nt,Y)}e.uploadCommonUniforms(f,Ft,bt.toUnwrapped(),null,$);let me=Ct.segments;if(v.projection.name==="mercator"&&!rt&&(me=Ct.getVisibleSegments(yt.tileID,e.terrain,e.transform.getFrustum(0)),!me.get().length))continue;if(_t)if(rt)for(let Ie of me.get())_t.numRenderedVerticesInShadowPass+=Ie.primitiveLength;else for(let Ie of me.get())_t.numRenderedVerticesInTransparentPass+=Ie.primitiveLength;let Ue=[];(e.terrain||p)&&Ue.push(Ct.centroidVertexBuffer),R&&Ue.push(Ct.layoutVertexExtBuffer),Ft.draw(e,f.gl.TRIANGLES,c,u,h,vi.backCCW,le,i.id,Ct.layoutVertexBuffer,Ct.indexBuffer,me,i.paint,e.transform.zoom,xt,Ue)}e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!1)}function Vh(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M,D,I){let P=e.context,O=P.gl,R=e.transform,F=e.transform.zoom,z=[],j=Nh(e,i.paint.get("fill-extrusion-cutoff-fade-range"));g==="clear"?(z.push("CLEAR_SUBPASS"),I&&(z.push("CLEAR_FROM_TEXTURE"),P.activeTexture.set(O.TEXTURE0),I.bind(O.LINEAR,O.CLAMP_TO_EDGE))):g==="sdf"&&z.push("SDF_SUBPASS"),M&&z.push("HAS_CENTROID"),j.shouldRenderCutoff&&z.push("RENDER_CUTOFF");let U=i.layout.get("fill-extrusion-edge-radius"),G=($,Y,tt,W,rt)=>{let st=Y.programConfigurations.get(i.id),pt=e.isTileAffectedByFog($),nt=e.getOrCreateProgram("fillExtrusionGroundEffect",{config:st,defines:z,overrideFog:pt}),ot=((bt,yt,Ct,St,Tt,xt,Ft,Qt,Jt,le,me)=>({u_matrix:yt,u_opacity:Ct,u_ao_pass:St?1:0,u_meter_to_tile:Tt,u_ao:xt,u_flood_light_intensity:Ft,u_flood_light_color:Qt,u_attenuation:Jt,u_edge_radius:le,u_fb:0,u_fb_size:me}))(0,W,v,f,rt,[y,b*rt],x,C,E,F>=17?0:U*rt,I?I.size[0]:0),_t=[];M&&_t.push(Y.hiddenByLandmarkVertexBuffer),e.uploadCommonUniforms(P,nt,$.toUnwrapped(),null,j),nt.draw(e,P.gl.TRIANGLES,c,u,h,p,ot,i.id,Y.vertexBuffer,Y.indexBuffer,tt,i.paint,F,st,_t)};for(let $ of o){let Y=t.getTile($),tt=Y.getBucket(i);if(!tt||tt.projection.name!==R.projection.name||!tt.groundEffect||tt.groundEffect&&!tt.groundEffect.hasData())continue;let W=tt.groundEffect,rt=1/tt.tileToMeter;{let st=e.translatePosMatrix($.projMatrix,Y,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),pt=W.getDefaultSegment();G($,W,pt,st,rt)}if(D)for(let st=0;st<4;st++){let pt=VA[st]($),nt=t.getTile(pt);if(!nt)continue;let ot=nt.getBucket(i);if(!ot||ot.projection.name!==R.projection.name||!ot.groundEffect||ot.groundEffect&&!ot.groundEffect.hasData())continue;let _t=ot.groundEffect,bt,yt;st===0?(bt=[-wt,0,0],yt=1):st===1?(bt=[wt,0,0],yt=0):st===2?(bt=[0,-wt,0],yt=3):(bt=[0,wt,0],yt=2);let Ct=_t.regionSegments[yt];if(!Ct)continue;let St=new Float32Array(16);ft.translate(St,$.projMatrix,bt),G($,_t,Ct,e.translatePosMatrix(St,Y,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),rt)}}}function lW(e,t,i,o,c,u,h){o.centroidVertexArray.length===0&&o.createCentroidsBuffer();let p=u?u.findDEMTileFor(i):null;if(!(p&&p.dem||h))return;let f=D=>{let I=t.getSource().minzoom,P=R=>{let F=t.getTileByID(R);if(F&&F.hasData())return F.getBucket(c)},O=[0,-1,1];for(let R of O){if(D.overscaledZ+R<I)continue;let F=P(D.calculateScaledKey(D.overscaledZ+R));if(F)return F}},g=[0,0,0],v=(D,I)=>(g[0]=Math.min(D.min.y,I.min.y),g[1]=Math.max(D.max.y,I.max.y),g[2]=wt-I.min.x>D.max.x?I.min.x-wt:D.max.x,g),y=(D,I)=>(g[0]=Math.min(D.min.x,I.min.x),g[1]=Math.max(D.max.x,I.max.x),g[2]=wt-I.min.y>D.max.y?I.min.y-wt:D.max.y,g),b=[(D,I)=>v(D,I),(D,I)=>v(I,D),(D,I)=>y(D,I),(D,I)=>y(I,D)],x=(D,I,P,O,R,F,z)=>{if(!u)return 0;let j=[[F?P:D,F?D:P,0],[F?P:I,F?I:P,0]],U=z<0?wt+z:z,G=[F?U:(D+I)/2,F?(D+I)/2:U,0];return P===0&&z<0||P!==0&&z>0?u.getForTilePoints(R,[G],!0,O):j.push(G),u.getForTilePoints(i,j,!0,p),Math.max(j[0][2],j[1][2],G[2])/u.exaggeration()};for(let D=0;D<4;D++){let I=o.borderFeatureIndices[D];if(I.length===0)continue;let P=VA[D](i),O=f(P);if(!(O&&O instanceof rf)||o.borderDoneWithNeighborZ[D]===O.canonical.z)continue;O.centroidVertexArray.length===0&&O.createCentroidsBuffer();let R=u?u.findDEMTileFor(P):null;if(!(R&&R.dem||h))continue;let F=(D<2?1:5)-D,z=O.borderDoneWithNeighborZ[F]!==o.canonical.z,j=O.borderFeatureIndices[F],U=0;if(o.canonical.z!==O.canonical.z){for(let G of I)o.showCentroid(o.featuresOnBorder[G]);if(z)for(let G of j)O.showCentroid(O.featuresOnBorder[G]);o.borderDoneWithNeighborZ[D]=O.canonical.z,O.borderDoneWithNeighborZ[F]=o.canonical.z}for(let G of I){let $=o.featuresOnBorder[G],Y=o.centroidData[$.centroidDataIndex],tt=$.borders[D],W;for(;U<j.length;){W=O.featuresOnBorder[j[U]];let rt=W.borders[F];if(rt[1]>tt[0]+3||rt[0]>tt[0]-3)break;O.showCentroid(W),U++}if(W&&U<j.length){let rt=U,st=0;for(;!(W.borders[F][0]>tt[1]-3)&&(st++,++U!==j.length);)W=O.featuresOnBorder[j[U]];if(W=O.featuresOnBorder[j[rt]],st>1){let ot=W.borders[F];Math.abs(tt[0]-ot[0])<3&&Math.abs(tt[1]-ot[1])<3&&(st=1,U=rt+1)}else if(st===0){o.showCentroid($);continue}let pt=O.centroidData[W.centroidDataIndex];h&&st===1&&(((E=Y).flags|(M=pt).flags)&kl?(E.flags|=kl,M.flags|=kl):(E.flags&=2147483647,M.flags&=2147483647));let nt=new Q(0,0);if(st>1)U=rt;else if(R&&R.dem&&!($.intersectsCount()>1||W.intersectsCount()>1)){let ot=b[D](Y,pt),_t=D%2?wt-1:0;C=x(ot[0],Math.min(wt-1,ot[1]),_t,R,P,D<2,ot[2]),nt=new Q(Math.ceil(7*(C+450)),0)}Y.centroidXY=pt.centroidXY=nt,o.writeCentroidToBuffer(Y),O.writeCentroidToBuffer(pt)}else o.showCentroid($)}o.borderDoneWithNeighborZ[D]=O.canonical.z,O.borderDoneWithNeighborZ[F]=o.canonical.z}var C,E,M;(o.needsCentroidUpdate||!o.centroidVertexBuffer&&o.centroidVertexArray.length!==0)&&o.uploadCentroid(e)}let cW=[1,0,0],dW=[0,1,0],uW=[0,0,1];function hW(e,t,i){let o=i.transform,c=i.shadowRenderer;if(!c)return!0;let u=e.toUnwrapped(),h=o.tileSize*c._cascades[i.currentShadowCascade].scale,p=t.maxHeight;if(o.elevation){let E=o.elevation.getMinMaxForTile(e);E&&(p+=E.max)}let f=[...c.shadowDirection];f[2]=-f[2];let g=c.computeSimplifiedTileShadowVolume(u,p,h,f);if(!g)return!1;let v=[cW,dW,uW,f,[f[0],0,f[2]],[0,f[1],f[2]]],y=o.projection.name==="globe",b=o.scaleZoom(h),x=hc.fromInvProjectionMatrix(o.invProjMatrix,o.worldSize,b,!y),C=c.getCurrentCascadeFrustum();return x.intersectsPrecise(g.vertices,g.planes,v)===0||C.intersectsPrecise(g.vertices,g.planes,v)===0}function mW(e){let t=e._nearZ,i=e.projection.farthestPixelDistance(e),o=i-t,c=.2*e.height,u=t+c;return[t,i,(u-c-t)/o,(u-t)/o]}let pW=new fi(1,0,0,1),fW=new fi(0,1,0,1),gW=new fi(0,0,1,1),_W=new fi(1,0,1,1),vW=new fi(0,1,1,1);function yW(e,t,i){let o=e.context,c=e.transform,u=o.gl,h=c.projection.name==="globe",p=h?["PROJECTION_GLOBE_VIEW"]:[],f=i.projMatrix;if(h&&wo(c.zoom)>0){let G=Uw(qA(i.canonical,c));f=ft.multiply(new Float32Array(16),c.globeMatrix,G),ft.multiply(f,c.projMatrix,f)}let g=e.getOrCreateProgram("debug",{defines:p}),v=t.getTileByID(i.key);e.terrain&&e.terrain.setupElevationDraw(v,g);let y=je.disabled,b=gi.disabled,x=e.colorModeForRenderPass(),C="$debug";o.activeTexture.set(u.TEXTURE0),e.emptyTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),h?v._makeGlobeTileDebugBuffers(e.context,c):v._makeDebugTileBoundsBuffers(e.context,c.projection);let E=v._tileDebugBuffer||e.debugBuffer,M=v._tileDebugIndexBuffer||e.debugIndexBuffer,D=v._tileDebugSegments||e.debugSegments;g.draw(e,u.LINE_STRIP,y,b,x,vi.disabled,LO(f,fi.red),C,E,M,D,null,null,null,[v._globeTileDebugBorderBuffer]);let I=v.latestRawTileData,P=Math.floor((I&&I.byteLength||0)/1024),O=t.getTile(i).tileSize,R=512/Math.min(O,512)*(i.overscaledZ/c.zoom)*.5,F=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(F+=` => ${i.overscaledZ}`),F+=` ${P}kb`,function(G,$){G.initDebugOverlayCanvas();let Y=G.debugOverlayCanvas,tt=G.context.gl,W=G.debugOverlayCanvas.getContext("2d");W.clearRect(0,0,Y.width,Y.height),W.shadowColor="white",W.shadowBlur=2,W.lineWidth=1.5,W.strokeStyle="white",W.textBaseline="top",W.font="bold 36px Open Sans, sans-serif",W.fillText($,5,5),W.strokeText($,5,5),G.debugOverlayTexture.update(Y),G.debugOverlayTexture.bind(tt.LINEAR,tt.CLAMP_TO_EDGE)}(e,F);let z=v._tileDebugTextBuffer||e.debugBuffer,j=v._tileDebugTextIndexBuffer||e.quadTriangleIndexBuffer,U=v._tileDebugTextSegments||e.debugSegments;g.draw(e,u.TRIANGLES,y,b,Vi.alphaBlended,vi.disabled,LO(f,fi.transparent,R),C,z,j,U,null,null,null,[v._globeTileDebugTextBuffer])}function $O(e,t,i,o){iv(e,0,t+i/2,e.transform.width,i,o)}function YO(e,t,i,o){iv(e,t-i/2,0,i,e.transform.height,o)}function iv(e,t,i,o,c,u){let h=e.context,p=h.gl;p.enable(p.SCISSOR_TEST),p.scissor(t*ni.devicePixelRatio,i*ni.devicePixelRatio,o*ni.devicePixelRatio,c*ni.devicePixelRatio),h.clear({color:u}),p.disable(p.SCISSOR_TEST)}let bW=Qi([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:xW}=bW;function dd(e,t,i,o){e.emplaceBack(t,i,o)}class ZO{constructor(t){this.vertexArray=new eu,this.indices=new qr,dd(this.vertexArray,-1,-1,1),dd(this.vertexArray,1,-1,1),dd(this.vertexArray,-1,1,1),dd(this.vertexArray,1,1,1),dd(this.vertexArray,-1,-1,-1),dd(this.vertexArray,1,-1,-1),dd(this.vertexArray,-1,1,-1),dd(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,xW),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=dn.simpleSegment(0,0,36,12)}}function jh(e,t,i,o,c,u){let h=e.context.gl,p=t.paint.get("sky-atmosphere-color"),f=t.paint.get("sky-atmosphere-halo-color"),g=t.paint.get("sky-atmosphere-sun-intensity"),v=((y,b,x,C,E)=>({u_matrix_3f:y,u_sun_direction:b,u_sun_intensity:x,u_color_tint_r:[C.r,C.g,C.b,C.a],u_color_tint_m:[E.r,E.g,E.b,E.a],u_luminance:5e-5}))(ds.fromMat4(ds.create(),o),c,g,p,f);h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_CUBE_MAP_POSITIVE_X+u,t.skyboxTexture,0),i.draw(e,h.TRIANGLES,je.disabled,gi.disabled,Vi.unblended,vi.frontCW,v,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}let wW=Qi([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class CW{constructor(t){let i=new tu;i.emplaceBack(-1,1,1,0,0),i.emplaceBack(1,1,1,1,0),i.emplaceBack(1,-1,1,1,1),i.emplaceBack(-1,-1,1,0,1);let o=new qr;o.emplaceBack(0,1,2),o.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(i,wW.members),this.indexBuffer=t.createIndexBuffer(o),this.segments=dn.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let SW=Qi([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class EW{constructor(){this.colorModeAlphaBlendedWriteRGB=new Vi([1,k0,1,k0],fi.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Vi([1,0,1,0],fi.transparent,[!1,!1,!1,!0])}update(t){let i=t.context;if(!this.atmosphereBuffer){this.atmosphereBuffer=new CW(i);let o=100,c=200,u=function(v){let y=O1(30),b=[];for(let x=0;x<16e3;++x){let C=2*Math.PI*y(),E=Math.acos(1-2*y())-.5*Math.PI;b.push(J.fromValues(Math.cos(E)*Math.cos(C),Math.cos(E)*Math.sin(C),Math.sin(E)))}return b}(),h=O1(300),p=new uw,f=new qr,g=0;for(let v=0;v<u.length;++v){let y=J.scale([],u[v],200),b=Math.max(0,1+.01*o*(1*h()-.5)),x=Math.max(0,1+.01*c*(1*h()-.5));p.emplaceBack(y[0],y[1],y[2],-1,-1,b,x),p.emplaceBack(y[0],y[1],y[2],1,-1,b,x),p.emplaceBack(y[0],y[1],y[2],1,1,b,x),p.emplaceBack(y[0],y[1],y[2],-1,1,b,x),f.emplaceBack(g+0,g+1,g+2),f.emplaceBack(g+0,g+2,g+3),g+=4}this.starsVx=i.createVertexBuffer(p,SW.members),this.starsIdx=i.createIndexBuffer(f),this.starsSegments=dn.simpleSegment(0,0,p.length,f.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,i){let o=t.context,c=o.gl,u=t.transform,h=new je(c.LEQUAL,je.ReadOnly,[0,1]),p=wo(u.zoom),f=i.properties.get("color").toArray01(),g=i.properties.get("high-color").toArray01(),v=i.properties.get("space-color").toArray01PremultipliedAlpha(),y=5e-4,b=ve((i.properties.get("horizon-blend")-0)/1*.2495+y,5e-4,.25),x=QA(t,o,u)&&b===y?u.worldSize/(2*Math.PI*1.025)-1:u.globeRadius,C=t.frameCounter/1e3%1,E=J.length(u.globeCenterInViewSpace),M=Math.sqrt(Math.pow(E,2)-Math.pow(x,2)),D=Math.acos(M/E),I=P=>{let O=u.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];P&&O.push("ALPHA_PASS");let R=t.getOrCreateProgram("globeAtmosphere",{defines:O}),F=((j,U,G,$,Y,tt,W,rt,st,pt,nt,ot)=>({u_frustum_tl:j,u_frustum_tr:U,u_frustum_br:G,u_frustum_bl:$,u_horizon:Y,u_transition:tt,u_fadeout_range:W,u_color:rt,u_high_color:st,u_space_color:pt,u_temporal_offset:nt,u_horizon_angle:ot}))(u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.frustumCorners.horizon,p,b,f,g,v,C,D);t.uploadCommonUniforms(o,R);let z=this.atmosphereBuffer;z&&R.draw(t,c.TRIANGLES,h,gi.disabled,P?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,vi.backCW,F,P?"atmosphere_glow_alpha":"atmosphere_glow",z.vertexBuffer,z.indexBuffer,z.segments)};I(!1),I(!0)}drawStars(t,i){let o=ve(i.properties.get("star-intensity"),0,1);if(o===0)return;let c=t.context,u=c.gl,h=t.transform,p=t.getOrCreateProgram("stars"),f=Bo.identity([]);Bo.rotateX(f,f,-h._pitch),Bo.rotateZ(f,f,-h.angle),Bo.rotateX(f,f,fe(h._center.lat)),Bo.rotateY(f,f,-fe(h._center.lng));let g=ft.fromQuat(new Float32Array(16),f),v=ft.multiply([],h.starsProjMatrix,g),y=ds.fromMat4([],g),b=ds.invert([],y),x=[0,1,0];J.transformMat3(x,x,b),J.scale(x,x,.15);let C=[1,0,0];J.transformMat3(C,C,b),J.scale(C,C,.15);let E=((M,D,I,P)=>({u_matrix:Float32Array.from(M),u_up:D,u_right:I,u_intensity_multiplier:P}))(v,x,C,o);t.uploadCommonUniforms(c,p),this.starsVx&&this.starsIdx&&p.draw(t,u.TRIANGLES,je.disabled,gi.disabled,this.colorModeAlphaBlendedWriteRGB,vi.disabled,E,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function XO(e,t){let i=[...e],o=t.cameraWorldSizeForFog/t.worldSize,c=ft.identity([]);return ft.scale(c,c,[o,o,1]),ft.multiply(i,c,i),ft.multiply(i,t.worldToFogMatrix,i),i}function aS(e,t,i,o){let c=i.material,u=o.context,{baseColorTexture:h,metallicRoughnessTexture:p}=c.pbrMetallicRoughness,{normalTexture:f,occlusionTexture:g,emissionTexture:v}=c;function y(b,x,C){if(b&&(e.push(x),u.activeTexture.set(u.gl.TEXTURE0+C),b.gfxTexture)){let{minFilter:E,magFilter:M,wrapS:D,wrapT:I}=b.sampler;b.gfxTexture.bindExtraParam(E,M,D,I)}}y(h,"HAS_TEXTURE_u_baseColorTexture",Ms.BaseColor),y(p,"HAS_TEXTURE_u_metallicRoughnessTexture",Ms.MetallicRoughness),y(f,"HAS_TEXTURE_u_normalTexture",Ms.Normal),y(g,"HAS_TEXTURE_u_occlusionTexture",Ms.Occlusion),y(v,"HAS_TEXTURE_u_emissionTexture",Ms.Emission),i.texcoordBuffer&&(e.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(i.texcoordBuffer)),i.colorBuffer&&(e.push(i.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(i.colorBuffer)),i.normalBuffer&&(e.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(i.normalBuffer)),i.pbrBuffer&&(e.push("HAS_ATTRIBUTE_a_pbr"),e.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(i.pbrBuffer)),c.alphaMode!=="OPAQUE"&&c.alphaMode!=="MASK"||e.push("UNPREMULT_TEXTURE_IN_SHADER"),c.defined||e.push("DIFFUSE_SHADED"),e.push("USE_STANDARD_DERIVATIVES")}function nv(e,t,i,o,c,u){let h=i.paint.get("model-opacity"),p=t.context,f=new je(t.context.gl.LEQUAL,je.ReadWrite,t.depthRangeFor3D),g=t.transform,v=e.mesh,y=v.material,b=y.pbrMetallicRoughness,x=t.style.fog,C;C=t.transform.projection.zAxisUnit==="pixels"?[...e.nodeModelMatrix]:ft.multiply([],o.zScaleMatrix,e.nodeModelMatrix),ft.multiply(C,o.negCameraPosMatrix,C);let E=ft.invert([],C);ft.transpose(E,E);let M=i.paint.get("model-emissive-strength").constantOr(0),D=oS(new Float32Array(e.worldViewProjection),new Float32Array(C),new Float32Array(E),t,h,b.baseColorFactor,y.emissiveFactor,b.metallicFactor,b.roughnessFactor,y,M,i),I={defines:[]},P=[];aS(I.defines,P,v,t);let O=t.shadowRenderer;O&&(O.useNormalOffset=!1);let R=null;if(x){let j=XO(e.nodeModelMatrix,t.transform);if(R=new Float32Array(j),g.projection.name!=="globe"){let U=v.aabb.min,G=v.aabb.max,[$,Y]=x.getOpacityForBounds(j,U[0],U[1],G[0],G[1]);I.overrideFog=$>=du||Y>=du}}let F=Nh(t,i.paint.get("model-cutoff-fade-range"));F.shouldRenderCutoff&&I.defines.push("RENDER_CUTOFF");let z=t.getOrCreateProgram("model",I);t.uploadCommonUniforms(p,z,null,R,F),t.renderPass!=="shadow"&&O&&O.setupShadowsFromMatrix(e.nodeModelMatrix,z),z.draw(t,p.gl.TRIANGLES,f,c,u,v.material.doubleSided?vi.disabled:vi.backCCW,D,i.id,v.vertexBuffer,v.indexBuffer,v.segments,i.paint,t.transform.zoom,void 0,P)}function KO(e,t,i,o,c,u,h){let p;p=e.projection.name==="globe"?GR(i,e):[...i],ft.multiply(p,p,t.matrix);let f=ft.multiply([],o,p);if(t.meshes)for(let g of t.meshes){if(g.material.alphaMode!=="BLEND"){h.push({mesh:g,depth:0,modelIndex:c,worldViewProjection:f,nodeModelMatrix:p});continue}let v=J.transformMat4([],g.centroid,f);v[2]>0&&u.push({mesh:g,depth:v[2],modelIndex:c,worldViewProjection:f,nodeModelMatrix:p})}if(t.children)for(let g of t.children)KO(e,g,i,o,c,u,h)}function lS(e,t,i,o){let c=i.shadowRenderer;if(!c)return;let u=c.getShadowPassDepthMode(),h=c.getShadowPassColorMode(),p=c.calculateShadowPassMatrixFromMatrix(t),f=UO(p);i.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(i,i.context.gl.TRIANGLES,u,gi.disabled,h,vi.backCCW,f,o.id,e.vertexBuffer,e.indexBuffer,e.segments,o.paint,i.transform.zoom,void 0,void 0)}function MW(e,t,i){let o=t.updateZoomBasedPaintProperties(),c=function(u,h,p){let f,g,v,y=u.terrain?u.terrain.exaggeration():0;if(u.terrain&&y>0){let b=u.terrain,x=b.findDEMTileFor(p);x&&x.dem?f=Dh.create(b,p,x):y=0}if(y===0&&(h.terrainElevationMin=0,h.terrainElevationMax=0),y===h.validForExaggeration&&(y===0||f&&f._demTile&&f._demTile.tileID===h.validForDEMTile.id&&f._dem._timestamp===h.validForDEMTile.timestamp))return!1;for(let b in h.instancesPerModel){let x=h.instancesPerModel[b];for(let C=0;C<x.instancedDataArray.length;++C){let E=(f?y*f.getElevationAt(0|x.instancedDataArray.float32[16*C],0|x.instancedDataArray.float32[16*C+1],!0,!0):0)+x.instancesEvaluatedElevation[C];x.instancedDataArray.float32[16*C+6]=E,g=g?Math.min(h.terrainElevationMin,E):E,v=v?Math.max(h.terrainElevationMax,E):E}}return h.terrainElevationMin=g||0,h.terrainElevationMax=v||0,h.validForExaggeration=y,h.validForDEMTile=f&&f._demTile?{id:f._demTile.tileID,timestamp:f._dem._timestamp}:{id:void 0,timestamp:0},!0}(e,t,i);(o||c)&&(t.uploaded=!1,t.upload(e.context))}let Pl={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new Ln([0,0,0],[wt,wt,0])};function DW(e,t){let i=1<<e.canonical.z,o=t.getFreeCameraOptions().position,c=t.elevation,u=e.canonical.x/i,h=(e.canonical.x+1)/i,p=e.canonical.y/i,f=(e.canonical.y+1)/i,g=t._centerAltitude;if(c){let x=c.getMinMaxForTile(e);x&&x.max>g&&(g=x.max)}let v=ve(o.x,u,h)-o.x,y=ve(o.y,p,f)-o.y,b=_n(g,t.center.lat)-o.z;return t._zoomFromMercatorZ(Math.sqrt(v*v+y*y+b*b))}function QO(e,t,i,o,c,u,h){let p=e.context,f=e.renderPass==="shadow",g=e.shadowRenderer,v=f&&g?g.getShadowPassDepthMode():new je(p.gl.LEQUAL,je.ReadWrite,e.depthRangeFor3D),y=e.isTileAffectedByFog(u);if(i.meshes)for(let b of i.meshes){let x=["MODEL_POSITION_ON_GPU"],C=[],E,M,D;o.instancedDataArray.length>20&&x.push("INSTANCED_ARRAYS");let I=Nh(e,t.paint.get("model-cutoff-fade-range"));if(I.shouldRenderCutoff&&x.push("RENDER_CUTOFF"),f&&g)E=e.getOrCreateProgram("modelDepth",{defines:x}),M=UO(h.shadowTileMatrix,h.shadowTileMatrix,Float32Array.from(i.matrix)),D=g.getShadowPassColorMode();else{aS(x,C,b,e),E=e.getOrCreateProgram("model",{defines:x,overrideFog:y});let O=b.material,R=O.pbrMetallicRoughness,F=t.paint.get("model-opacity"),z=t.paint.get("model-emissive-strength").constantOr(0);M=oS(u.expandedProjMatrix,Float32Array.from(i.matrix),new Float32Array(16),e,F,R.baseColorFactor,O.emissiveFactor,R.metallicFactor,R.roughnessFactor,O,z,t,c),g&&(h.shadowUniformsInitialized?E.setShadowUniformValues(p,g.getShadowUniformValues()):(g.setupShadows(u.toUnwrapped(),E,"model-tile",u.overscaledZ),h.shadowUniformsInitialized=!0)),D=I.shouldRenderCutoff||F<1||O.alphaMode!=="OPAQUE"?Vi.alphaBlended:Vi.unblended}e.uploadCommonUniforms(p,E,u.toUnwrapped(),null,I);let P=b.material.doubleSided?vi.disabled:vi.backCCW;if(o.instancedDataArray.length>20)C.push(o.instancedDataBuffer),E.draw(e,p.gl.TRIANGLES,v,gi.disabled,D,P,M,t.id,b.vertexBuffer,b.indexBuffer,b.segments,t.paint,e.transform.zoom,void 0,C,o.instancedDataArray.length);else{let O=f?"u_instance":"u_normal_matrix";for(let R=0;R<o.instancedDataArray.length;++R)M[O]=new Float32Array(o.instancedDataArray.arrayBuffer,64*R,16),E.draw(e,p.gl.TRIANGLES,v,gi.disabled,D,P,M,t.id,b.vertexBuffer,b.indexBuffer,b.segments,t.paint,e.transform.zoom,void 0,C)}}if(i.children)for(let b of i.children)QO(e,t,b,o,c,u,h)}let TW=[1,-1,1];function IW(e,t,i,o){if(!i.modelManager)return!0;let c=i.modelManager;if(!i.shadowRenderer)return!0;let u=i.shadowRenderer,h=t.aabb,p=!0,f=e.maxHeight;if(f===0){let v=0;for(let y in e.instancesPerModel){let b=c.getModel(y,o);b?v=Math.max(v,Math.max(Math.max(b.aabb.max[0],b.aabb.max[1]),b.aabb.max[2])):p=!1}f=e.maxScale*v*1.41+e.maxVerticalOffset,p&&(e.maxHeight=f)}h.max[2]=f,h.min[2]+=e.terrainElevationMin,h.max[2]+=e.terrainElevationMax,J.transformMat4(h.min,h.min,t.tileMatrix),J.transformMat4(h.max,h.max,t.tileMatrix);let g=h.intersects(u.getCurrentCascadeFrustum());return i.currentShadowCascade===0&&(e.isInsideFirstShadowMapFrustum=g===2),g===0}class AW{}class kW{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,i,o){{let y=this._storage.get(i.id);if(y)return y.lastUsedFrameIdx=t,y.buf}let c=o.gl,u=c.getBufferParameter(c.ELEMENT_ARRAY_BUFFER,c.BUFFER_SIZE),h=new ArrayBuffer(u),p=new Int16Array(h);c.getBufferSubData(c.ELEMENT_ARRAY_BUFFER,0,new Int16Array(h));let f=new qc;for(let y=0;y<u/2;y+=3){let b=p[y],x=p[y+1],C=p[y+2];f.emplaceBack(b,x),f.emplaceBack(x,C),f.emplaceBack(C,b)}let g=o.bindVertexArrayOES.current,v=new AW;return v.buf=new wR(o,f),v.lastUsedFrameIdx=t,this._storage.set(i.id,v),o.bindVertexArrayOES.set(g),v.buf}update(t){for(let[i,o]of this._storage)t-o.lastUsedFrameIdx>30&&(o.buf.destroy(),this._storage.delete(i))}destroy(){for(let[t,i]of this._storage)i.buf.destroy(),this._storage.delete(t)}}let JO={symbol:function(e,t,i,o,c){if(e.renderPass!=="translucent")return;let u=gi.disabled,h=e.colorModeForRenderPass();i.layout.get("text-variable-anchor")&&function(p,f,g,v,y,b,x){let C=f.transform,E=y==="map",M=b==="map";for(let D of p){let I=v.getTile(D),P=I.getBucket(g);if(!P||!P.text||!P.text.segments.get().length)continue;let O=Tl(P.textSizeData,C.zoom),R=QC(D,P.getProjection(),C),F=C.calculatePixelsToTileUnitsMatrix(I),z=P0(R,I.tileID.canonical,M,E,C,P.getProjection(),F),j=P.hasIconTextFit()&&P.hasIconData();if(O){let U=Math.pow(2,C.zoom-I.tileID.overscaledZ);sW(P,E,M,x,T8,C,z,D,U,O,j)}}}(o,e,i,t,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),c),i.paint.get("icon-opacity").constantOr(1)!==0&&qO(e,t,i,o,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright"),i.paint.get("icon-color-saturation"),u,h),i.paint.get("text-opacity").constantOr(1)!==0&&qO(e,t,i,o,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright"),i.paint.get("icon-color-saturation"),u,h),t.map.showCollisionBoxes&&(HO(e,t,i,o,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),HO(e,t,i,o,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1))},circle:function(e,t,i,o){if(e.renderPass!=="translucent")return;let c=i.paint.get("circle-opacity"),u=i.paint.get("circle-stroke-width"),h=i.paint.get("circle-stroke-opacity"),p=i.layout.get("circle-sort-key").constantOr(1)!==void 0,f=i.paint.get("circle-emissive-strength");if(c.constantOr(1)===0&&(u.constantOr(1)===0||h.constantOr(1)===0))return;let g=e.context,v=g.gl,y=e.transform,b=e.depthModeForSublayer(0,je.ReadOnly),x=gi.disabled,C=e.colorModeForDrapableLayerRenderPass(f),E=y.projection.name==="globe",M=[to(y.center.lng),lo(y.center.lat)],D=[];for(let P=0;P<o.length;P++){let O=o[P],R=t.getTile(O),F=R.getBucket(i);if(!F||F.projection.name!==y.projection.name)continue;let z=F.programConfigurations.get(i.id),j=pk(i),U=e.isTileAffectedByFog(O);E&&j.push("PROJECTION_GLOBE_VIEW");let G=e.getOrCreateProgram("circle",{config:z,defines:j,overrideFog:U}),$=F.layoutVertexBuffer,Y=F.globeExtVertexBuffer,tt=F.indexBuffer,W=y.projection.createInversionMatrix(y,O.canonical),rt={programConfiguration:z,program:G,layoutVertexBuffer:$,globeExtVertexBuffer:Y,indexBuffer:tt,uniformValues:w6(e,O,R,W,M,i),tile:R};if(p){let st=F.segments.get();for(let pt of st)D.push({segments:new dn([pt]),sortKey:pt.sortKey,state:rt})}else D.push({segments:F.segments,sortKey:0,state:rt})}p&&D.sort((P,O)=>P.sortKey-O.sortKey);let I={useDepthForOcclusion:y.depthOcclusionForSymbolsAndCircles};for(let P of D){let{programConfiguration:O,program:R,layoutVertexBuffer:F,globeExtVertexBuffer:z,indexBuffer:j,uniformValues:U,tile:G}=P.state,$=P.segments;e.terrain&&e.terrain.setupElevationDraw(G,R,I),e.uploadCommonUniforms(g,R,G.tileID.toUnwrapped()),R.draw(e,v.TRIANGLES,b,x,C,vi.disabled,U,i.id,F,j,$,i.paint,y.zoom,O,[z])}},heatmap:function(e,t,i,o){if(i.paint.get("heatmap-opacity")!==0)if(e.renderPass==="offscreen"){let c=e.context,u=c.gl,h=gi.disabled,p=new Vi([u.ONE,u.ONE,u.ONE,u.ONE],fi.transparent,[!0,!0,!0,!0]);(function(x,C,E,M){let D=x.gl,I=C.width*M,P=C.height*M;x.activeTexture.set(D.TEXTURE1),x.viewport.set([0,0,I,P]);let O=E.heatmapFbo;if(!O||O&&(O.width!==I||O.height!==P)){O&&O.destroy();let R=D.createTexture();D.bindTexture(D.TEXTURE_2D,R),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_S,D.CLAMP_TO_EDGE),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_T,D.CLAMP_TO_EDGE),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,D.LINEAR),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MAG_FILTER,D.LINEAR),O=E.heatmapFbo=x.createFramebuffer(I,P,!0,null),function(F,z,j,U,G,$){let Y=F.gl;Y.texImage2D(Y.TEXTURE_2D,0,F.extRenderToTextureHalfFloat?Y.RGBA16F:Y.RGBA,G,$,0,Y.RGBA,F.extRenderToTextureHalfFloat?Y.HALF_FLOAT:Y.UNSIGNED_BYTE,null),U.colorAttachment.set(j)}(x,0,R,O,I,P)}else D.bindTexture(D.TEXTURE_2D,O.colorAttachment.get()),x.bindFramebuffer.set(O.framebuffer)})(c,e,i,e.transform.projection.name==="globe"?.5:.25),c.clear({color:fi.transparent});let f=e.transform,g=f.projection.name==="globe",v=g?["PROJECTION_GLOBE_VIEW"]:[],y=g?vi.frontCCW:vi.disabled,b=[to(f.center.lng),lo(f.center.lat)];for(let x=0;x<o.length;x++){let C=o[x];if(t.hasRenderableParent(C))continue;let E=t.getTile(C),M=E.getBucket(i);if(!M||M.projection.name!==f.projection.name)continue;let D=e.isTileAffectedByFog(C),I=M.programConfigurations.get(i.id),P=e.getOrCreateProgram("heatmap",{config:I,defines:v,overrideFog:D}),{zoom:O}=e.transform;e.terrain&&e.terrain.setupElevationDraw(E,P),e.uploadCommonUniforms(c,P,C.toUnwrapped());let R=f.projection.createInversionMatrix(f,C.canonical);P.draw(e,u.TRIANGLES,je.disabled,h,p,y,Kq(e,C,E,R,b,O,i.paint.get("heatmap-intensity")),i.id,M.layoutVertexBuffer,M.indexBuffer,M.segments,i.paint,e.transform.zoom,I,g?[M.globeExtVertexBuffer]:null)}c.viewport.set([0,0,e.width,e.height])}else e.renderPass==="translucent"&&(e.context.setColorMode(e.colorModeForRenderPass()),function(c,u){let h=c.context,p=h.gl,f=u.heatmapFbo;if(!f)return;h.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,f.colorAttachment.get()),h.activeTexture.set(p.TEXTURE1);let g=u.colorRampTexture;g||(g=u.colorRampTexture=new ir(h,u.colorRamp,p.RGBA)),g.bind(p.LINEAR,p.CLAMP_TO_EDGE),c.getOrCreateProgram("heatmapTexture").draw(c,p.TRIANGLES,je.disabled,gi.disabled,c.colorModeForRenderPass(),vi.disabled,((v,y,b,x)=>({u_image:0,u_color_ramp:1,u_opacity:y.paint.get("heatmap-opacity")}))(0,u),u.id,c.viewportBuffer,c.quadTriangleIndexBuffer,c.viewportSegments,u.paint,c.transform.zoom)}(e,i))},line:function(e,t,i,o){if(e.renderPass!=="translucent")return;let c=i.paint.get("line-opacity"),u=i.paint.get("line-width");if(c.constantOr(1)===0||u.constantOr(1)===0)return;let h=i.paint.get("line-emissive-strength"),p=e.depthModeForSublayer(0,je.ReadOnly),f=e.colorModeForDrapableLayerRenderPass(h),g=e.terrain&&e.terrain.renderingToTexture?1:ni.devicePixelRatio,v=i.paint.get("line-dasharray"),y=v.constantOr(1),b=i.layout.get("line-cap"),x=i.paint.get("line-pattern"),C=x.constantOr(1),E=i.paint.get("line-pattern").constantOr(1),M=i.paint.get("line-opacity").constantOr(1)!==1,D=!E&&M,I=i.paint.get("line-gradient"),P=C?"linePattern":"line",O=e.context,R=O.gl,F=wP(i);e.terrain&&e.terrain.clipOrMaskOverlapStencilType()&&(D=!1);for(let z of o){let j=t.getTile(z);if(C&&!j.patternsLoaded())continue;let U=j.getBucket(i);if(!U)continue;e.prepareDrawTile();let G=U.programConfigurations.get(i.id),$=e.isTileAffectedByFog(z),Y=e.getOrCreateProgram(P,{config:G,defines:F,overrideFog:$}),tt=x.constantOr(null);if(tt&&j.imageAtlas){let bt=j.imageAtlas.patternPositions[tt.toString()];bt&&G.setConstantPatternPositions(bt)}let W=v.constantOr(null),rt=b.constantOr(null);if(!C&&W&&rt&&j.lineAtlas){let bt=j.lineAtlas.getDash(W,rt);bt&&G.setConstantPatternPositions(bt)}let[st,pt]=i.paint.get("line-trim-offset");(rt==="round"||rt==="square")&&st!==pt&&(st===0&&(st-=1),pt===1&&(pt+=1));let nt=e.terrain?z.projMatrix:null,ot=C?DG(e,j,i,nt,g):MG(e,j,i,nt,U.lineClipsArray.length,g,[st,pt]);if(I){let bt=U.gradients[i.id],yt=bt.texture;if(i.gradientVersion!==bt.version){let Ct=256;if(i.stepInterpolant){let St=t.getSource().maxzoom,Tt=z.canonical.z===St?Math.ceil(1<<e.transform.maxZoom-z.canonical.z):1;Ct=ve(Qg(U.maxLineLength/wt*1024*Tt),256,O.maxTextureSize)}bt.gradient=J_({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:Ct,image:bt.gradient||void 0,clips:U.lineClipsArray}),bt.texture?bt.texture.update(bt.gradient):bt.texture=new ir(O,bt.gradient,R.RGBA),bt.version=i.gradientVersion,yt=bt.texture}O.activeTexture.set(R.TEXTURE1),yt.bind(i.stepInterpolant?R.NEAREST:R.LINEAR,R.CLAMP_TO_EDGE)}y&&(O.activeTexture.set(R.TEXTURE0),j.lineAtlasTexture&&j.lineAtlasTexture.bind(R.LINEAR,R.REPEAT),G.updatePaintBuffers()),C&&(O.activeTexture.set(R.TEXTURE0),j.imageAtlasTexture&&j.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),G.updatePaintBuffers()),e.uploadCommonUniforms(O,Y,z.toUnwrapped());let _t=bt=>{Y.draw(e,R.TRIANGLES,p,bt,f,vi.disabled,ot,i.id,U.layoutVertexBuffer,U.indexBuffer,U.segments,i.paint,e.transform.zoom,G,[U.layoutVertexBuffer2])};if(D){let bt=e.stencilModeForClipping(z).ref;bt===0&&e.terrain&&O.clear({stencil:0});let yt={func:R.EQUAL,mask:255};ot.u_alpha_discard_threshold=.8,_t(new gi(yt,bt,255,R.KEEP,R.KEEP,R.INVERT)),ot.u_alpha_discard_threshold=0,_t(new gi(yt,bt,255,R.KEEP,R.KEEP,R.KEEP))}else _t(e.stencilModeForClipping(z))}D&&(e.resetStencilClippingMasks(),e.terrain&&O.clear({stencil:0}))},fill:function(e,t,i,o){let c=i.paint.get("fill-color"),u=i.paint.get("fill-opacity");if(u.constantOr(1)===0)return;let h=i.paint.get("fill-emissive-strength"),p=e.colorModeForDrapableLayerRenderPass(h),f=i.paint.get("fill-pattern"),g=e.opaquePassEnabledForLayer()&&!f.constantOr(1)&&c.constantOr(fi.transparent).a===1&&u.constantOr(0)===1?"opaque":"translucent";if(e.renderPass===g){let v=e.depthModeForSublayer(1,e.renderPass==="opaque"?je.ReadWrite:je.ReadOnly);WO(e,t,i,o,v,p,!1)}if(e.renderPass==="translucent"&&i.paint.get("fill-antialias")){let v=e.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,je.ReadOnly);WO(e,t,i,o,v,p,!0)}},"fill-extrusion":function(e,t,i,o){let c=i.paint.get("fill-extrusion-opacity"),u=e.context,h=u.gl,p=e.terrain,f=p&&p.renderingToTexture,g=i.paint.get("fill-extrusion-cutoff-fade-range");if(c===0)return;let v=e.conflationActive&&e.layerUsedInConflation(i,t.getSource());if(v&&function(y,b,x,C){for(let E of C){let M=b.getTile(E).getBucket(x);M&&(M.updateReplacement(E,y.replacementSource),M.uploadCentroid(y.context))}}(e,t,i,o),p||v)for(let y of o){let b=t.getTile(y).getBucket(i);b&&lW(e.context,t,y,b,i,p,v)}if(e.renderPass==="shadow"&&e.shadowRenderer){let y=e.shadowRenderer;if(p&&c<.65&&i._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof jc)return;let b=y.getShadowPassDepthMode(),x=y.getShadowPassColorMode();ev(e,t,i,o,b,gi.disabled,x,v)}else if(e.renderPass==="translucent"){let y=!i.paint.get("fill-extrusion-pattern").constantOr(1);if(!f){let b=new je(e.context.gl.LEQUAL,je.ReadWrite,e.depthRangeFor3D);g===0&&c===1&&y?ev(e,t,i,o,b,gi.disabled,Vi.unblended,v):(ev(e,t,i,o,b,gi.disabled,Vi.disabled,v),ev(e,t,i,o,b,e.stencilModeFor3D(),e.colorModeForRenderPass(),v),e.resetStencilClippingMasks())}if(e.style.enable3dLights()&&y&&(!p&&e.transform.projection.name!=="globe"||f)){let b=i.paint.get("fill-extrusion-opacity"),x=i.paint.get("fill-extrusion-ambient-occlusion-intensity"),C=i.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),E=i.paint.get("fill-extrusion-flood-light-intensity"),M=i.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),D=x>0&&C>0,I=E>0,P=(R,F,z)=>(1-z)*R+z*F,O=R=>{let F=e.depthModeForSublayer(1,je.ReadOnly,h.LEQUAL,!0),z=i.paint.get(R?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),j=P(.1,3,z),U=e._showOverdrawInspector;if(!U){let G=new gi({func:h.ALWAYS,mask:255},255,255,h.KEEP,h.KEEP,h.REPLACE),$=new Vi([h.ONE,h.ONE,h.ONE,h.ONE],fi.transparent,[!1,!1,!1,!0],h.MIN);Vh(e,t,i,o,F,G,$,vi.disabled,R,"sdf",b,x,C,E,M,j,v,!1)}{let G=U?gi.disabled:new gi({func:h.EQUAL,mask:255},255,255,h.KEEP,h.DECR,h.DECR),$=U?e.colorModeForRenderPass():new Vi([h.ONE_MINUS_DST_ALPHA,h.DST_ALPHA,h.ONE,h.ONE],fi.transparent,[!0,!0,!0,!0]);Vh(e,t,i,o,F,G,$,vi.disabled,R,"color",b,x,C,E,M,j,v,!1)}};if(f){let R=(F,z,j)=>{let U=e.depthModeForSublayer(1,je.ReadOnly,h.LEQUAL,!1),G=i.paint.get(F?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),$=P(.1,3,G);{let Y=new Vi([h.ONE,h.ONE,h.ONE,h.ONE],fi.transparent,[!1,!1,!1,!0]);Vh(e,t,i,o,U,gi.disabled,Y,vi.disabled,F,"clear",b,x,C,E,M,$,v,z)}{let Y=new gi({func:h.ALWAYS,mask:255},255,255,h.KEEP,h.KEEP,h.REPLACE),tt=new Vi([h.ONE,h.ONE,h.ONE,h.ONE],fi.transparent,[!1,!1,!1,!0],h.MIN);Vh(e,t,i,o,U,Y,tt,vi.disabled,F,"sdf",b,x,C,E,M,$,v,z)}{let Y=F?h.ZERO:h.ONE_MINUS_DST_ALPHA,tt=new gi({func:h.EQUAL,mask:255},255,255,h.KEEP,h.DECR,h.DECR),W=new Vi([Y,h.DST_ALPHA,h.ONE_MINUS_DST_ALPHA,h.ZERO],fi.transparent,[!0,!0,!0,!0]);Vh(e,t,i,o,U,tt,W,vi.disabled,F,"color",b,x,C,E,M,$,v,z)}{let Y=new Vi([h.ONE,h.ONE,h.ONE,F?h.ZERO:h.ONE],fi.transparent,[!1,!1,!1,!0],F?h.FUNC_ADD:h.MAX);Vh(e,t,i,o,U,gi.disabled,Y,vi.disabled,F,"clear",b,x,C,E,M,$,v,z,j)}};if(D||I){let F;if(e.prepareDrawTile(),p){let z=p.drapeBufferSize[0],j=p.drapeBufferSize[1];F=p.framebufferCopyTexture,F&&(!F||F.size[0]===z&&F.size[1]===j)||(F&&F.destroy(),F=p.framebufferCopyTexture=new ir(u,new Br({width:z,height:j}),h.RGBA)),F.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.copyTexImage2D(h.TEXTURE_2D,0,h.RGBA,0,0,z,j,0)}D&&R(!0,!1,F),I&&R(!1,!0,F)}}else D&&O(!0),I&&O(!1)}}},hillshade:function(e,t,i,o){if(e.renderPass!=="offscreen"&&e.renderPass!=="translucent"||e.style.disableElevatedTerrain)return;let c=e.context,u=e.terrain&&e.terrain.renderingToTexture,[h,p]=e.renderPass!=="translucent"||u?[{},o]:e.stencilConfigForOverlap(o);for(let f of p){let g=t.getTile(f);if(g.needsHillshadePrepare&&e.renderPass==="offscreen")Lq(e,g,i);else if(e.renderPass==="translucent"){let v=e.depthModeForSublayer(0,je.ReadOnly),y=i.paint.get("hillshade-emissive-strength"),b=e.colorModeForDrapableLayerRenderPass(y),x=u&&e.terrain?e.terrain.stencilModeForRTTOverlap(f):h[f.overscaledZ];Fq(e,f,g,i,v,x,b)}}c.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()},raster:function(e,t,i,o,c,u){if(e.renderPass!=="translucent"||i.paint.get("raster-opacity")===0)return;let h=e.context,p=h.gl,f=t.getSource(),g=function(z,j,U){let G=z.paint.get("raster-color"),$=[],Y=z.paint.get("raster-resampling"),tt=z.paint.get("raster-color-mix"),W=z.paint.get("raster-color-range"),rt=[tt[0],tt[1],tt[2],0],st=tt[3],pt=Y==="nearest"?U.NEAREST:U.LINEAR;if(G&&$.push("RASTER_COLOR"),G){j.activeTexture.set(U.TEXTURE2);let nt=z.colorRampTexture;nt||(nt=z.colorRampTexture=new ir(j,z.colorRamp,U.RGBA)),nt.bind(U.LINEAR,U.CLAMP_TO_EDGE)}return{mix:rt,range:W,offset:st,defines:$,resampling:pt}}(i,h,p),v=g.defines,y=e.transform.projection.name==="globe",b=!1;if(f instanceof fa&&!o.length){if(!y)return;if(f.onNorthPole)b=!0,v.push("GLOBE_POLES");else{if(!f.onSouthPole)return;b=!0,v.push("GLOBE_POLES")}}let x=i.paint.get("raster-emissive-strength"),C=e.colorModeForDrapableLayerRenderPass(x),E=e.terrain&&e.terrain.renderingToTexture,M=f instanceof fa&&i.paint.get("raster-elevation")!==0,D=!e.options.moving,I=i.paint.get("raster-resampling")==="nearest"?p.NEAREST:p.LINEAR;if(b){let z=t.getSource();if(!(z instanceof fa))return;let j=z.texture;if(!j)return;let U=e.globeSharedBuffers;if(!U)return;let G=new je(p.LEQUAL,je.ReadWrite,e.depthRangeFor3D),$=Float32Array.from(e.transform.expandedFarZProjMatrix),Y=KA(0,0,e.transform),tt=Float32Array.from(Kc(Ws(new ua(0,0,0)))),W={opacity:1,mix:0};e.terrain&&e.terrain.prepareDrawTile(),h.activeTexture.set(p.TEXTURE0),j.bind(I,p.CLAMP_TO_EDGE),h.activeTexture.set(p.TEXTURE1),j.bind(I,p.CLAMP_TO_EDGE),j.useMipmap&&h.extTextureFilterAnisotropic&&e.transform.pitch>20&&p.texParameterf(p.TEXTURE_2D,h.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,h.extTextureFilterAnisotropicMax);let[rt,st,pt,nt]=U.getPoleBuffers(0,!0),ot;z.onNorthPole?(ot=rt,e.renderDefaultNorthPole=!1):(Y=ft.scale(ft.create(),Y,[1,-1,1]),ot=st,e.renderDefaultSouthPole=!1);let _t=((yt,Ct,St,Tt,xt,Ft,Qt,Jt,le,me,Ue,Ie)=>zO(yt,Ct,St,new Float32Array(16),new Float32Array(9),[0,0],[0,0,0,0],0,[0,0],[0,0,0,0],1,Tt,xt,Ft||[0,0],Qt,2,le,me,Ue,1,0,Ie))($,tt,Y,W,i,z.perspectiveTransform||[0,0],i.paint.get("raster-elevation"),0,g.mix,g.offset,g.range,x),bt=e.getOrCreateProgram("raster",{defines:g.defines});return e.uploadCommonUniforms(h,bt,null),void bt.draw(e,p.TRIANGLES,G,gi.disabled,C,vi.disabled,_t,i.id,ot,pt,nt)}if(!o.length)return;let[P,O]=f instanceof fa||E?[{},o]:e.stencilConfigForOverlap(o),R=O[O.length-1].overscaledZ,F=M&&y;F&&g.defines.push("PROJECTION_GLOBE_VIEW"),M&&g.defines.push("RENDER_CUTOFF");for(let z of O){let j=z.toUnwrapped(),U=t.getTile(z);if(E&&(!U||!U.hasData())||!U.texture)continue;let G,$;E?(G=je.disabled,$=z.projMatrix):M?(G=new je(p.LEQUAL,je.ReadWrite,e.depthRangeFor3D),$=y?Float32Array.from(e.transform.expandedFarZProjMatrix):e.transform.calculateProjMatrix(j,D)):(G=e.depthModeForSublayer(z.overscaledZ-R,i.paint.get("raster-opacity")===1?je.ReadWrite:je.ReadOnly,p.LESS),$=e.transform.calculateProjMatrix(j,D));let Y=e.terrain&&E?e.terrain.stencilModeForRTTOverlap(z):P[z.overscaledZ],tt=u?0:i.paint.get("raster-fade-duration");U.registerFadeDuration(tt);let W=t.findLoadedParent(z,0),rt=IO(U,W,t,e.transform,tt),st,pt;e.terrain&&e.terrain.prepareDrawTile(),h.activeTexture.set(p.TEXTURE0),U.texture&&U.texture.bind(I,p.CLAMP_TO_EDGE),h.activeTexture.set(p.TEXTURE1),W?(W.texture&&W.texture.bind(I,p.CLAMP_TO_EDGE),st=Math.pow(2,W.tileID.overscaledZ-U.tileID.overscaledZ),pt=[U.tileID.canonical.x*st%1,U.tileID.canonical.y*st%1]):U.texture&&U.texture.bind(I,p.CLAMP_TO_EDGE),U.texture&&U.texture.useMipmap&&h.extTextureFilterAnisotropic&&e.transform.pitch>20&&p.texParameterf(p.TEXTURE_2D,h.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,h.extTextureFilterAnisotropicMax);let nt=e.transform,ot=f instanceof fa?f.perspectiveTransform:[0,0],_t=M?mW(nt):[0,0,0,0],bt,yt,Ct,St,Tt,xt;if(F&&f instanceof fa&&f.coordinates.length>3){bt=Float32Array.from(Kc(Ws(new ua(0,0,0)))),yt=Float32Array.from(nt.globeMatrix),Ct=Float32Array.from(XA(nt)),St=[to(nt.center.lng),lo(nt.center.lat)],xt=[to(f.coordinates[1][0]),lo(f.coordinates[1][1]),to(f.coordinates[3][0]),lo(f.coordinates[3][1])];let le=new Cs(f.coordinates[1],f.coordinates[3]);Tt=Float32Array.from(JA(new ua(0,0,0),le,0,nt.worldSize/e.transform._pixelsPerMercatorPixel))}else bt=new Float32Array(16),yt=new Float32Array(9),Ct=new Float32Array(16),St=[0,0],Tt=new Float32Array(16),xt=[0,0,0,0];let Ft=zO($,bt,yt,Ct,Tt,pt||[0,0],xt,wo(e.transform.zoom),St,_t,st||1,rt,i,ot,M?i.paint.get("raster-elevation"):0,2,g.mix,g.offset,g.range,1,0,x),Qt=e.isTileAffectedByFog(z),Jt=e.getOrCreateProgram("raster",{defines:g.defines,overrideFog:Qt});if(e.uploadCommonUniforms(h,Jt,j),f instanceof fa){if(E||!y)f.boundsBuffer&&f.boundsSegments&&Jt.draw(e,p.TRIANGLES,G,gi.disabled,C,vi.disabled,Ft,i.id,f.boundsBuffer,e.quadTriangleIndexBuffer,f.boundsSegments);else if(e.globeSharedBuffers){let[le,me,Ue]=e.globeSharedBuffers.getGridBuffers(0,!1);Jt.draw(e,p.TRIANGLES,G,gi.disabled,C,vi.frontCCW,Ft,i.id,le,me,Ue),Jt.draw(e,p.TRIANGLES,G,gi.disabled,C,vi.backCCW,Ft,i.id,le,me,Ue)}}else{let{tileBoundsBuffer:le,tileBoundsIndexBuffer:me,tileBoundsSegments:Ue}=e.getTileBoundsBuffers(U);Jt.draw(e,p.TRIANGLES,G,Y,C,vi.disabled,Ft,i.id,le,me,Ue)}}e.resetStencilClippingMasks()},background:function(e,t,i,o){let c=i.paint.get("background-color"),u=i.paint.get("background-opacity"),h=i.paint.get("background-emissive-strength");if(u===0)return;let p=e.context,f=p.gl,g=e.transform,v=g.tileSize,y=i.paint.get("background-pattern");if(e.isPatternMissing(y,i.scope))return;let b=!y&&c.a===1&&u===1&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==b)return;let x=gi.disabled,C=e.depthModeForSublayer(0,b==="opaque"?je.ReadWrite:je.ReadOnly),E=e.colorModeForDrapableLayerRenderPass(h),M=y?"backgroundPattern":"background",D,I=o;I||(D=e.getBackgroundTiles(),I=Object.values(D).map(P=>P.tileID)),y&&(p.activeTexture.set(f.TEXTURE0),e.imageManager.bind(e.context,i.scope));for(let P of I){let O=e.isTileAffectedByFog(P),R=e.getOrCreateProgram(M,{overrideFog:O}),F=P.toUnwrapped(),z=o?P.projMatrix:e.transform.calculateProjMatrix(F);e.prepareDrawTile();let j=t?t.getTile(P):D?D[P.key]:new Xp(P,v,g.zoom,e),U=y?nW(z,h,u,e,y,i.scope,{tileID:P,tileSize:v}):iW(z,h,u,c);e.uploadCommonUniforms(p,R,F);let{tileBoundsBuffer:G,tileBoundsIndexBuffer:$,tileBoundsSegments:Y}=e.getTileBoundsBuffers(j);R.draw(e,f.TRIANGLES,C,x,E,vi.disabled,U,i.id,G,$,Y)}},sky:function(e,t,i){let o=e._atmosphere?wo(e.transform.zoom):1,c=i.paint.get("sky-opacity")*o;if(c===0)return;let u=e.context,h=i.paint.get("sky-type"),p=new je(u.gl.LEQUAL,je.ReadOnly,[0,1]),f=e.frameCounter/1e3%1;h==="atmosphere"?e.renderPass==="offscreen"?i.needsSkyboxCapture(e)&&(function(g,v,y,b){let x=g.context,C=x.gl,E=v.skyboxFbo;if(!E){E=v.skyboxFbo=x.createFramebuffer(32,32,!0,null),v.skyboxGeometry=new ZO(x),v.skyboxTexture=x.gl.createTexture(),C.bindTexture(C.TEXTURE_CUBE_MAP,v.skyboxTexture),C.texParameteri(C.TEXTURE_CUBE_MAP,C.TEXTURE_WRAP_S,C.CLAMP_TO_EDGE),C.texParameteri(C.TEXTURE_CUBE_MAP,C.TEXTURE_WRAP_T,C.CLAMP_TO_EDGE),C.texParameteri(C.TEXTURE_CUBE_MAP,C.TEXTURE_MIN_FILTER,C.LINEAR),C.texParameteri(C.TEXTURE_CUBE_MAP,C.TEXTURE_MAG_FILTER,C.LINEAR);for(let P=0;P<6;++P)C.texImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+P,0,C.RGBA,32,32,0,C.RGBA,C.UNSIGNED_BYTE,null)}x.bindFramebuffer.set(E.framebuffer),x.viewport.set([0,0,32,32]);let M=v.getCenter(g,!0),D=g.getOrCreateProgram("skyboxCapture"),I=new Float64Array(16);ft.identity(I),ft.rotateY(I,I,.5*-Math.PI),jh(g,v,D,I,M,0),ft.identity(I),ft.rotateY(I,I,.5*Math.PI),jh(g,v,D,I,M,1),ft.identity(I),ft.rotateX(I,I,.5*-Math.PI),jh(g,v,D,I,M,2),ft.identity(I),ft.rotateX(I,I,.5*Math.PI),jh(g,v,D,I,M,3),ft.identity(I),jh(g,v,D,I,M,4),ft.identity(I),ft.rotateY(I,I,Math.PI),jh(g,v,D,I,M,5),x.viewport.set([0,0,g.width,g.height])}(e,i),i.markSkyboxValid(e)):e.renderPass==="sky"&&function(g,v,y,b,x){let C=g.context,E=C.gl,M=g.transform,D=g.getOrCreateProgram("skybox");C.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_CUBE_MAP,v.skyboxTexture);let I=((P,O,R,F,z)=>({u_matrix:P,u_sun_direction:O,u_cubemap:0,u_opacity:F,u_temporal_offset:z}))(M.skyboxMatrix,v.getCenter(g,!1),0,b,x);g.uploadCommonUniforms(C,D),D.draw(g,E.TRIANGLES,y,gi.disabled,g.colorModeForRenderPass(),vi.backCW,I,"skybox",v.skyboxGeometry.vertexBuffer,v.skyboxGeometry.indexBuffer,v.skyboxGeometry.segment)}(e,i,p,c,f):h==="gradient"&&e.renderPass==="sky"&&function(g,v,y,b,x){let C=g.context,E=C.gl,M=g.transform,D=g.getOrCreateProgram("skyboxGradient");v.skyboxGeometry||(v.skyboxGeometry=new ZO(C)),C.activeTexture.set(E.TEXTURE0);let I=v.colorRampTexture;I||(I=v.colorRampTexture=new ir(C,v.colorRamp,E.RGBA)),I.bind(E.LINEAR,E.CLAMP_TO_EDGE);let P=((O,R,F,z,j)=>({u_matrix:O,u_color_ramp:0,u_center_direction:R,u_radius:fe(F),u_opacity:z,u_temporal_offset:j}))(M.skyboxMatrix,v.getCenter(g,!1),v.paint.get("sky-gradient-radius"),b,x);g.uploadCommonUniforms(C,D),D.draw(g,E.TRIANGLES,y,gi.disabled,g.colorModeForRenderPass(),vi.backCW,P,"skyboxGradient",v.skyboxGeometry.vertexBuffer,v.skyboxGeometry.indexBuffer,v.skyboxGeometry.segment)}(e,i,p,c,f)},debug:function(e,t,i){for(let o=0;o<i.length;o++)yW(e,t,i[o])},custom:function(e,t,i,o){let c=e.context,u=i.implementation;if(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes("custom")||e.terrain&&(e.terrain.renderingToTexture||e.renderPass==="offscreen")&&i.isLayerDraped(t)){if(e.renderPass==="offscreen"){let h=u.prerender;if(h){if(e.setCustomLayerDefaults(),c.setColorMode(e.colorModeForRenderPass()),e.transform.projection.name==="globe"){let p=e.transform.pointMerc;h.call(u,c.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),wo(e.transform.zoom),[p.x,p.y],e.transform.pixelsPerMeterRatio)}else h.call(u,c.gl,e.transform.customLayerMatrix());c.setDirty(),e.setBaseState()}}else if(e.renderPass==="translucent"){if(e.terrain&&e.terrain.renderingToTexture){let p=u.renderToTile;if(p){let f=o[0].canonical,g=new Oi(f.x+o[0].wrap*(1<<f.z),f.y,f.z);c.setDepthMode(je.disabled),c.setStencilMode(gi.disabled),c.setColorMode(e.colorModeForRenderPass()),e.setCustomLayerDefaults(),p.call(u,c.gl,g),c.setDirty(),e.setBaseState()}return}e.setCustomLayerDefaults(),c.setColorMode(e.colorModeForRenderPass()),c.setStencilMode(gi.disabled);let h=u.renderingMode==="3d"?new je(e.context.gl.LEQUAL,je.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,je.ReadOnly);if(c.setDepthMode(h),e.transform.projection.name==="globe"){let p=e.transform.pointMerc;u.render(c.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),wo(e.transform.zoom),[p.x,p.y],e.transform.pixelsPerMeterRatio)}else u.render(c.gl,e.transform.customLayerMatrix());c.setDirty(),e.setBaseState(),c.bindFramebuffer.set(null)}}else lt("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(e,t,i,o){if(e.renderPass==="opaque")return;let c=i.paint.get("model-opacity");if(c===0)return;let u=i.paint.get("model-cast-shadows");if(e.renderPass==="shadow"&&(!u||e.terrain&&c<.65&&i._transitionablePaint._values["model-opacity"].value.expression instanceof jc))return;let h=e.shadowRenderer,p=i.paint.get("model-receive-shadows");h&&(h.useNormalOffset=!0,p||(h.enabled=!1));let f=()=>{h&&(h.useNormalOffset=!0,p||(h.enabled=!0))},g=t.getSource();if(e.renderPass==="light-beam"&&g.type!=="batched-model")return;if(g.type==="vector"||g.type==="geojson")return function(D,I,P,O){let R=D.transform;if(R.projection.name!=="mercator")return void lt(`Drawing 3D models for ${R.projection.name} projection is not yet implemented`);let F=R.getFreeCameraOptions().position;if(!D.modelManager)return;let z=D.modelManager,j=D.shadowRenderer;if(!P._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let U=P._unevaluatedLayout._values["model-id"],G=Gt({},P.layout.get("model-id").parameters);for(let $ of O){let Y=I.getTile($).getBucket(P);if(!Y||Y.projection.name!==R.projection.name)continue;let tt=DW($,R);G.zoom=tt;let W=U.possiblyEvaluate(G);if(MW(D,Y,$),Pl.shadowUniformsInitialized=!1,Pl.useSingleShadowCascade=!!j&&j.getMaxCascadeForTile($.toUnwrapped())===0,D.renderPass==="shadow"&&j){if(D.currentShadowCascade===1&&Y.isInsideFirstShadowMapFrustum)continue;let pt=R.calculatePosMatrix($.toUnwrapped(),R.worldSize);if(Pl.tileMatrix.set(pt),Pl.shadowTileMatrix=Float32Array.from(j.calculateShadowPassMatrixFromMatrix(pt)),Pl.aabb.min.fill(0),Pl.aabb.max[0]=Pl.aabb.max[1]=wt,Pl.aabb.max[2]=0,IW(Y,Pl,D,P.scope))continue}let rt=1<<$.canonical.z,st=[((F.x-$.wrap)*rt-$.canonical.x)*wt,(F.y*rt-$.canonical.y)*wt,F.z*rt*wt];for(let pt in Y.instancesPerModel){let nt=Y.instancesPerModel[pt];nt.features.length>0&&(pt=W.evaluate(nt.features[0].feature,{}));let ot=z.getModel(pt,P.scope);if(ot&&ot.uploaded)for(let _t of ot.nodes)QO(D,P,_t,nt,st,$,Pl)}}}(e,t,i,o),void f();if(!g.loaded())return;if(g.type==="batched-model")return function(D,I,P,O){let R=D.context,F=D.transform,z=D.style.fog,j=D.shadowRenderer;if(F.projection.name!=="mercator")return void lt(`Drawing 3D landmark models for ${F.projection.name} projection is not yet implemented`);let U=D.transform.getFreeCameraOptions().position,G=J.scale([],[U.x,U.y,U.z],D.transform.worldSize);J.negate(G,G);let $=ft.identity([]),Y=Jc(F.center.lat,F.zoom),tt=ft.fromScaling([],[1,1,1/Y]);ft.translate($,$,G);let W=P.paint.get("model-opacity"),rt=new je(R.gl.LEQUAL,je.ReadWrite,D.depthRangeFor3D),st=new je(R.gl.LEQUAL,je.ReadOnly,D.depthRangeFor3D),pt=function(nt,ot){for(let _t of O){let bt=I.getTile(_t).getBucket(P);if(!bt||!bt.uploaded)continue;let yt=!1;j&&(yt=j.getMaxCascadeForTile(_t.toUnwrapped())===0);let Ct=F.calculatePosMatrix(_t.toUnwrapped(),F.worldSize),St=bt.modelTraits;for(let Tt of bt.getNodesInfo()){if(Tt.hiddenByReplacement||!Tt.node.meshes)continue;let xt=Tt.node,Ft=D.renderPass==="light-beam",Qt=[...Ct],Jt=Tt.evaluatedScale,le=0;D.terrain&&xt.elevation&&(le=xt.elevation*D.terrain.exaggeration()),ft.translate(Qt,Qt,[(xt.anchor?xt.anchor[0]:0)*(Jt[0]-1),(xt.anchor?xt.anchor[1]:0)*(Jt[1]-1),le]),Jt!==sG&&ft.scale(Qt,Qt,Jt),ft.multiply(Qt,Qt,xt.matrix);let me=ft.multiply([],tt,Qt);ft.multiply(me,$,me);let Ue=ft.invert([],me);ft.transpose(Ue,Ue),ft.scale(Ue,Ue,TW);let Ie=ft.multiply([],F.expandedFarZProjMatrix,Qt);for(let Bi=0;Bi<xt.meshes.length;++Bi){let Ci=xt.meshes[Bi],He=Bi===xt.lightMeshIndex;if(He){if(!Ft&&!D.terrain&&D.shadowRenderer){D.currentLayer<D.firstLightBeamLayer&&(D.firstLightBeamLayer=D.currentLayer);continue}}else if(Ft)continue;let Ne={defines:[]},ke=[];aS(Ne.defines,ke,Ci,D),4&St||Ne.defines.push("DIFFUSE_SHADED"),yt&&Ne.defines.push("SHADOWS_SINGLE_CASCADE");let Di=D.renderPass==="shadow";if(Di){lS(Ci,Qt,D,P);continue}let zi=null;if(z){let Lr=XO(Qt,D.transform);if(zi=new Float32Array(Lr),F.projection.name!=="globe"){let Dr=Ci.aabb.min,Gn=Ci.aabb.max,[an,ko]=z.getOpacityForBounds(Lr,Dr[0],Dr[1],Gn[0],Gn[1]);Ne.overrideFog=an>=du||ko>=du}}let pi=D.getOrCreateProgram("model",Ne);!Di&&j&&(j.useNormalOffset=!!Ci.normalBuffer,j.setupShadowsFromMatrix(Qt,pi,j.useNormalOffset)),D.uploadCommonUniforms(R,pi,_t.toUnwrapped(),zi);let vn=Ci.material,Mr=vn.pbrMetallicRoughness;Mr.metallicFactor=.9,Mr.roughnessFactor=.5;let hn=0,zn=oS(new Float32Array(Ie),new Float32Array(me),new Float32Array(Ue),D,W,Mr.baseColorFactor,vn.emissiveFactor,Mr.metallicFactor,Mr.roughnessFactor,vn,hn,P);pi.draw(D,R.gl.TRIANGLES,ot&&!He?rt:st,gi.disabled,nt?He||W<1||Tt.hasTranslucentParts?Vi.alphaBlended:Vi.unblended:Vi.disabled,vi.backCCW,zn,P.id,Ci.vertexBuffer,Ci.indexBuffer,Ci.segments,P.paint,D.transform.zoom,void 0,ke)}}}};(function(nt,ot,_t,bt){let yt=nt.terrain?nt.terrain.exaggeration():0,Ct=nt.transform.zoom;for(let St of bt){let Tt=ot.getTile(St).getBucket(_t);Tt&&(nt.conflationActive&&Tt.updateReplacement(St,nt.replacementSource),Tt.evaluateScale(nt,_t),nt.terrain&&yt>0&&Tt.elevationUpdate(nt.terrain,yt,St,_t.source),Tt.needsReEvaluation(nt,Ct,_t)&&Tt.evaluate(_t))}})(D,I,P,O),W===1?pt(!0,!0):(pt(!1,!0),pt(!0,!1))}(e,t,i,o),void f();let v=g.getModels(),y=[],b=e.transform.getFreeCameraOptions().position,x=J.scale([],[b.x,b.y,b.z],e.transform.worldSize);J.negate(x,x);let C=[],E=[],M=0;for(let D of v){let I=i.paint.get("model-rotation").constantOr(null),P=i.paint.get("model-scale").constantOr(null),O=i.paint.get("model-translation").constantOr(null);D.computeModelMatrix(e,I,P,O,!0,!0,!1);let R=ft.identity([]),F=Jc(D.position.lat,e.transform.zoom),z=ft.fromScaling([],[1,1,1/F]);ft.translate(R,R,x),y.push({zScaleMatrix:z,negCameraPosMatrix:R});for(let j of D.nodes)KO(e.transform,j,D.matrix,e.transform.expandedFarZProjMatrix,M,C,E);M++}if(C.sort((D,I)=>I.depth-D.depth),e.renderPass!=="shadow"){if(c===1)for(let D of E)nv(D,e,i,y[D.modelIndex],gi.disabled,e.colorModeForRenderPass());else{for(let D of E)nv(D,e,i,y[D.modelIndex],gi.disabled,Vi.disabled);for(let D of E)nv(D,e,i,y[D.modelIndex],e.stencilModeFor3D(),e.colorModeForRenderPass());e.resetStencilClippingMasks()}for(let D of C)nv(D,e,i,y[D.modelIndex],gi.disabled,e.colorModeForRenderPass());f()}else{for(let D of E)lS(D.mesh,D.nodeModelMatrix,e,i);for(let D of C)lS(D.mesh,D.nodeModelMatrix,e,i);f()}}},tF={modelUpload:function(e,t,i){let o=t.getSource();if(!o.loaded())return;if(o.type==="vector"||o.type==="geojson")return void(e.modelManager&&e.modelManager.upload(e,i));if(o.type==="batched-model")return;let c=o.getModels();for(let u of c)u.upload(e.context)}};class RW{constructor(t,i,o){this.context=new ZH(t,i),this.transform=o,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=Ja.maxUnderzooming+Ja.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new hG,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new FW(this),this._wireframeDebugCache=new kW,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(t,i){let o=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(o||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Vq(this,t));let c=this._terrain;this.transform.elevation=o?c:null,c.update(t,this.transform,i),this.transform.elevation&&!c.enabled&&(this.transform.elevation=null)}_updateFog(t){let i=t.fog;if(!i||this.transform.projection.name==="globe"||i.getOpacity(this.transform.pitch)<1||i.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[o,c]=i.getFovAdjustedRange(this.transform._fov);if(o>c)return void(this.transform.fogCullDistSq=null);let u=o+.78*(c-o);this.transform.fogCullDistSq=u*u}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,i){if(this.width=t*ni.devicePixelRatio,this.height=i*ni.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let o of this.style.order)this.style._mergedLayers[o].resize()}setup(){let t=this.context,i=new xs;i.emplaceBack(0,0),i.emplaceBack(wt,0),i.emplaceBack(0,wt),i.emplaceBack(wt,wt),this.tileExtentBuffer=t.createVertexBuffer(i,Zc.members),this.tileExtentSegments=dn.simpleSegment(0,0,4,2);let o=new xs;o.emplaceBack(0,0),o.emplaceBack(wt,0),o.emplaceBack(0,wt),o.emplaceBack(wt,wt),this.debugBuffer=t.createVertexBuffer(o,Zc.members),this.debugSegments=dn.simpleSegment(0,0,4,5);let c=new xs;c.emplaceBack(-1,-1),c.emplaceBack(1,-1),c.emplaceBack(-1,1),c.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(c,Zc.members),this.viewportSegments=dn.simpleSegment(0,0,4,2);let u=new Jd;u.emplaceBack(0,0,0,0),u.emplaceBack(wt,0,wt,0),u.emplaceBack(0,wt,0,wt),u.emplaceBack(wt,wt,wt,wt),this.mercatorBoundsBuffer=t.createVertexBuffer(u,wC.members),this.mercatorBoundsSegments=dn.simpleSegment(0,0,4,2);let h=new qr;h.emplaceBack(0,1,2),h.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(h);let p=new Tp;for(let g of[0,1,3,2,0])p.emplaceBack(g);this.debugIndexBuffer=t.createIndexBuffer(p),this.emptyTexture=new ir(t,new Br({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=ft.create();let f=this.context.gl;this.stencilClearMode=new gi({func:f.ALWAYS,mask:0},0,255,f.ZERO,f.ZERO,f.ZERO),this.loadTimeStamps.push(m.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,je.disabled,this.stencilClearMode,Vi.disabled,vi.disabled,rS(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,i,o){if(!i||this.currentStencilSource===i.id||!t.isTileClipped()||!o||o.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let p=!1;for(let f of o)if(this._tileClippingMaskIDs[f.key]===void 0){p=!0;break}if(!p)return}this.currentStencilSource=i.id;let c=this.context,u=c.gl;this.nextStencilID+o.length>256&&this.clearStencil(),c.setColorMode(Vi.disabled),c.setDepthMode(je.disabled);let h=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let p of o){let f=i.getTile(p),g=this._tileClippingMaskIDs[p.key]=this.nextStencilID++,{tileBoundsBuffer:v,tileBoundsIndexBuffer:y,tileBoundsSegments:b}=this.getTileBoundsBuffers(f);h.draw(this,u.TRIANGLES,je.disabled,new gi({func:u.ALWAYS,mask:0},g,255,u.KEEP,u.KEEP,u.REPLACE),Vi.disabled,vi.disabled,rS(p.projMatrix),"$clipping",v,y,b)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let t=this.nextStencilID++,i=this.context.gl;return new gi({func:i.NOTEQUAL,mask:255},t,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);let i=this.context.gl;return new gi({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,i.KEEP,i.KEEP,i.REPLACE)}stencilConfigForOverlap(t){let i=this.context.gl,o=t.sort((h,p)=>p.overscaledZ-h.overscaledZ),c=o[o.length-1].overscaledZ,u=o[0].overscaledZ-c+1;if(u>1){this.currentStencilSource=void 0,this.nextStencilID+u>256&&this.clearStencil();let h={};for(let p=0;p<u;p++)h[p+c]=new gi({func:i.GEQUAL,mask:255},p+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=u,[h,o]}return[{[c]:gi.disabled},o]}colorModeForRenderPass(){let t=this.context.gl;return this._showOverdrawInspector?new Vi([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new fi(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Vi.unblended:Vi.alphaBlended}colorModeForDrapableLayerRenderPass(t){let i=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Vi([i.ONE,i.ONE_MINUS_SRC_ALPHA,i.CONSTANT_ALPHA,i.ONE_MINUS_SRC_ALPHA],new fi(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,i,o,c=!1){if(!this.opaquePassEnabledForLayer()&&!c)return je.disabled;let u=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new je(o||this.context.gl.LEQUAL,i,[u,u])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,i){this._wireframeDebugCache.update(this.frameCounter),this.style=t,this.options=i;let o=this.style._mergedLayers,c=this.style.order,u=c.map(R=>o[R]),h=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(ni.now()),this.imageManager.beginFrame();let p=0,f=!1;for(let R in h){let F=h[R];F.used&&(F.prepare(this.context),F.getSource().usedInConflation&&++p)}let g={},v={},y={},b={},x={};for(let R in h){let F=h[R];g[R]=F.getVisibleCoordinates(),v[R]=g[R].slice().reverse(),y[R]=F.getVisibleCoordinates(!0).reverse(),b[R]=F.getShadowCasterCoordinates(),x[R]=F.sortCoordinatesByDistance(g[R])}let C=R=>{let F=this.style.getLayerSourceCache(R);return F&&F.used?F.getSource():null};if(p){let R=[];for(let F of u)this.layerUsedInConflation(F,C(F))&&R.push(F);if(R&&R.length>1){let F=[];for(let z of R){let j=this.style.getLayerSourceCache(z);j&&j.used&&j.getSource().usedInConflation&&F.push({layer:z.fqid,cache:j})}this.replacementSource.setSources(F),f=!0}}f||this.replacementSource.clear(),this.conflationActive=f,this.minCutoffZoom=0,this.longestCutoffRange=0;for(let R of u){let F=R.cutoffRange();if(this.longestCutoffRange=Math.max(F,this.longestCutoffRange),F>0){let z=C(R);z&&(this.minCutoffZoom=Math.max(z.minzoom,this.minCutoffZoom)),R.minzoom&&(this.minCutoffZoom=Math.max(R.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let R=0;R<u.length;R++)if(u[R].is3D()){this.opaquePassCutoff=R;break}let E=this.style&&this.style.fog;E?(this._fogVisible=E.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=E.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(y),this.opaquePassCutoff=0);let M=this._shadowRenderer;if(M){M.updateShadowParameters(this.transform,this.style.directionalLight);for(let R in h)for(let F of g[R]){let z={min:0,max:0};this.terrain&&(z=this.terrain.getMinMaxForTile(F)||z),M.addShadowReceiver(F.toUnwrapped(),z.min,z.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new d6(this.context));for(let R of u){if(R.isHidden(this.transform.zoom))continue;let F=t.getLayerSourceCache(R);this.uploadLayer(this,R,F)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new EW),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!t_.has(this.context.gl))return;this.renderPass="offscreen";for(let R of u){let F=t.getLayerSourceCache(R);if(!R.hasOffscreenPass()||R.isHidden(this.transform.zoom))continue;let z=F?v[F.id]:void 0;(R.type==="custom"||R.type==="raster"||R.isSky()||z&&z.length)&&this.renderLayer(this,F,R,z)}this.depthRangeFor3D=[0,1-(u.length+2)*this.numSublayers*this.depthEpsilon];let D=this.terrain;D&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&D.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,b)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let I=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),P=(()=>{if(i.showOverdrawInspector)return fi.black;if(this.style.fog&&this.transform.projection.supportsFog&&!I){let R=this.style.fog.properties.get("color").toArray01();return new fi(...R)}if(this.style.fog&&this.transform.projection.supportsFog&&I){let R=this.style.fog.properties.get("space-color").toArray01();return new fi(...R)}return fi.transparent})();if(this.context.clear({color:P,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&I&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=c.length-1;this.currentLayer>=0;this.currentLayer--){let R=u[this.currentLayer],F=t.getLayerSourceCache(R);if(R.isSky())continue;let z=F?(R.is3D()?x:v)[F.id]:void 0;this._renderTileClippingMasks(R,F,z),this.renderLayer(this,F,R,z)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&I&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||wo(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<c.length;this.currentLayer++){let R=u[this.currentLayer],F=t.getLayerSourceCache(R);R.isSky()&&this.renderLayer(this,F,R,F?v[F.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let O=0;for(M&&(O=M.getShadowCastingLayerCount());this.currentLayer<c.length;){let R=u[this.currentLayer],F=t.getLayerSourceCache(R);if(R.isSky()){++this.currentLayer;continue}if(D&&this.style.isLayerDraped(R)){if(R.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=D.renderBatch(this.currentLayer);continue}let z;if(F&&(z=(R.type==="symbol"?y:R.is3D()?x:v)[F.id]),this._renderTileClippingMasks(R,F,F?g[F.id]:void 0),this.renderLayer(this,F,R,z),!D&&M&&O>0&&R.hasShadowPass()&&--O==0&&(M.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let j=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=j;this.currentLayer++){let U=u[this.currentLayer];if(!U.hasLightBeamPass())continue;let G=t.getLayerSourceCache(U);this.renderLayer(this,G,U,G?v[G.id]:void 0)}this.currentLayer=j,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let R=null;u.forEach(F=>{let z=t.getLayerSourceCache(F);z&&!F.isHidden(this.transform.zoom)&&z.getVisibleCoordinates().length&&(!R||R.getSource().maxzoom<z.getSource().maxzoom)&&(R=z)}),R&&this.options.showTileBoundaries&&JO.debug(this,R,R.getVisibleCoordinates())}this.options.showPadding&&function(R){let F=R.transform.padding;$O(R,R.transform.height-(F.top||0),3,pW),$O(R,F.bottom||0,3,fW),YO(R,F.left||0,3,gW),YO(R,R.transform.width-(F.right||0),3,_W);let z=R.transform.centerPoint;(function(j,U,G,$){iv(j,U-1,G-10,2,20,$),iv(j,U-10,G-1,20,2,$)})(R,z.x,R.transform.height-z.y,vW)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(m.performance.now()),this.saveCanvasCopy()),f||(this.conflationActive=!1)}uploadLayer(t,i,o){this.gpuTimingStart(i),(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes(i.type)||t.terrain&&i.type==="custom")&&tF[`${i.type}Upload`]&&tF[`${i.type}Upload`](t,o,i.scope),this.gpuTimingEnd()}renderLayer(t,i,o,c){o.isHidden(this.transform.zoom)||(o.type==="background"||o.type==="sky"||o.type==="custom"||o.type==="model"||o.type==="raster"||c&&c.length)&&(this.id=o.id,this.gpuTimingStart(o),(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes(o.type)||t.terrain&&o.type==="custom")&&JO[o.type](t,i,o,c,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;let i=this.context.extTimerQuery,o=this.context.gl,c=this.gpuTimers[t.id];c||(c=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:o.createQuery()}),c.calls++,o.beginQuery(i.TIME_ELAPSED_EXT,c.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let t=this.context.extTimerQuery,i=this.context.gl,o=i.createQuery();this.deferredRenderGpuTimeQueries.push(o),i.beginQuery(t.TIME_ELAPSED_EXT,o)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){let t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){let i={};for(let o in t){let c=t[o],u=this.context.extTimerQuery,h=u.getQueryParameter(c.query,this.context.gl.QUERY_RESULT)/1e6;u.deleteQueryEXT(c.query),i[o]=h}return i}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;let i=this.context.extTimerQuery,o=this.context.gl,c=0;for(let u of t)c+=i.getQueryParameter(u,o.QUERY_RESULT)/1e6,i.deleteQueryEXT(u);return c}translatePosMatrix(t,i,o,c,u){if(!o[0]&&!o[1])return t;let h=u?c==="map"?this.transform.angle:0:c==="viewport"?-this.transform.angle:0;if(h){let g=Math.sin(h),v=Math.cos(h);o=[o[0]*v-o[1]*g,o[0]*g+o[1]*v]}let p=[u?o[0]:au(i,o[0],this.transform.zoom),u?o[1]:au(i,o[1],this.transform.zoom),0],f=new Float32Array(16);return ft.translate(f,t,p),f}saveTileTexture(t){let i=t.size[0],o=this._tileTextures[i];o?o.push(t):this._tileTextures[i]=[t]}getTileTexture(t){let i=this._tileTextures[t];return i&&i.length>0?i.pop():null}isPatternMissing(t,i){return t===null||t!==void 0&&!this.imageManager.getPattern(t.toString(),i)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,i,o){let c=o===void 0?this.terrain&&this.terrain.renderingToTexture:o,u=this.terrain&&this.terrain.exaggeration()===0,h=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(h.push("LIGHTING_3D_MODE"),h.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):c||h.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||h.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?h.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):h.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(h.push("TERRAIN"),this.linearFloatFilteringSupported()&&h.push("TERRAIN_DEM_FLOAT_FORMAT"),u&&h.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&h.push("GLOBE"),!this._fogVisible||c||i!==void 0&&!i||h.push("FOG","FOG_DITHERING"),c&&h.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&h.push("OVERDRAW_INSPECTOR"),h}getOrCreateProgram(t,i){this.cache=this.cache||{};let o=i&&i.defines||[],c=i&&i.config,u=this.currentGlobalDefines(t,i&&i.overrideFog,i&&i.overrideRtt).concat(o),h=kO.cacheKey(xO[t],t,u,c);return this.cache[h]||(this.cache[h]=new kO(this.context,t,xO[t],c,rW[t],u)),this.cache[h]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=m.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ir(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,i){if(this.style.enable3dLights()){let o=this.style.directionalLight,c=this.style.ambientLight;if(o&&c){let u=((h,p)=>{let f=h.properties.get("direction"),g=h.properties.get("color").toArray01(),v=h.properties.get("intensity"),y=p.properties.get("color").toArray01(),b=p.properties.get("intensity"),x=[f.x,f.y,f.z],C=_r(y,b),E=_r(g,v);return{u_lighting_ambient_color:C,u_lighting_directional_dir:x,u_lighting_directional_color:E,u_ground_radiance:jq(x,E,C)}})(o,c);i.setLightsUniformValues(t,u)}}}uploadCommonUniforms(t,i,o,c,u){if(this.uploadCommonLightUniforms(t,i),this.terrain&&this.terrain.renderingToTexture)return;let h=this.style.fog;if(h){let p=h.getOpacity(this.transform.pitch),f=((g,v,y,b,x,C,E,M,D,I,P,O)=>{let R=g.transform,F=v.properties.get("color").toArray01();F[3]=b;let z=g.frameCounter/1e3%1,[j,U]=v.properties.get("vertical-range");return{u_fog_matrix:y?R.calculateFogTileMatrix(y):O||g.identityMat,u_fog_range:v.getFovAdjustedRange(R._fov),u_fog_color:F,u_fog_horizon_blend:v.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(j,U),U],u_fog_temporal_offset:z,u_frustum_tl:x,u_frustum_tr:C,u_frustum_br:E,u_frustum_bl:M,u_globe_pos:D,u_globe_radius:I,u_viewport:P,u_globe_transition:wo(R.zoom),u_is_globe:+(R.projection.name==="globe")}})(this,h,o,p,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*ni.devicePixelRatio,this.transform.height*ni.devicePixelRatio],c);i.setFogUniformValues(t,f)}u&&i.setCutoffUniformValues(t,u.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){let t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){let t=this.context.gl,i=t.createTexture();return t.bindTexture(t.TEXTURE_2D,i),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),i}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let t=this._backgroundTiles,i=this._backgroundTiles={},o=this.transform.coveringTiles({tileSize:512});for(let c of o)i[c.key]=t[c.key]||new Xp(c,512,this.transform.tileZoom,this);return i}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(t,i){return!(!t.is3D()||t.minzoom&&t.minzoom>this.transform.zoom||t.sourceLayer!=="building"&&(!i||i.type!=="batched-model"))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let i=this._cachedTileFogOpacities[t.key];return i||(this._cachedTileFogOpacities[t.key]=i=this.style.fog.getOpacityForTile(t)),i[0]>=du||i[1]>=du}}let hu=2048;class PW{constructor(t,i){this.aabb=t,this.lastCascade=i}}class OW{add(t,i){let o=this.receivers[t.key];o!==void 0?(o.aabb.min[0]=Math.min(o.aabb.min[0],i.min[0]),o.aabb.min[1]=Math.min(o.aabb.min[1],i.min[1]),o.aabb.min[2]=Math.min(o.aabb.min[2],i.min[2]),o.aabb.max[0]=Math.max(o.aabb.max[0],i.max[0]),o.aabb.max[1]=Math.max(o.aabb.max[1],i.max[1]),o.aabb.max[2]=Math.max(o.aabb.max[2],i.max[2])):this.receivers[t.key]=new PW(i,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,i,o){let c=Ln.fromPoints(t.points),u=0;for(let h in this.receivers){let p=this.receivers[h];if(!p||!c.intersectsAabb(p.aabb))continue;p.aabb.min=c.closestPoint(p.aabb.min),p.aabb.max=c.closestPoint(p.aabb.max);let f=p.aabb.getCorners();for(let g=0;g<o.length;g++){let v=!0;for(let y of f){let b=[y[0]*i,y[1]*i,y[2]];if(J.transformMat4(b,b,o[g].matrix),b[0]<-1||b[0]>1||b[1]<-1||b[1]>1){v=!1;break}}if(p.lastCascade=g,u=Math.max(u,g),v)break}}return u+1}}class FW{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new OW,this._depthMode=new je(t.context.gl.LEQUAL,je.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1}destroy(){for(let t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,i){let o=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!i||!i.properties)return;let c=i.properties.get("shadow-intensity");if(!i.shadowsEnabled()||c<=0||(this._shadowLayerCount=o.style.order.reduce((x,C)=>{let E=o.style._mergedLayers[C];return x+(E.hasShadowPass()&&!E.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;let u=o.context,h=hu,p=hu;if(this._cascades.length===0)for(let x=0;x<2;++x){let C=o._shadowMapDebug,E=u.gl,M=u.createFramebuffer(h,p,C,"texture"),D=new ir(u,{width:h,height:p,data:null},E.DEPTH_COMPONENT);if(M.depthAttachment.set(D.texture),C){let I=new ir(u,{width:h,height:p,data:null},E.RGBA);M.colorAttachment.set(I.texture)}this._cascades.push({framebuffer:M,texture:D,matrix:[],far:0,boundingSphereRadius:0,frustum:new hc,scale:0})}this.shadowDirection=eF(i);let f=0;if(t.elevation){let x=t.elevation,C=[1e4,-1e4];x.visibleDemTiles.filter(E=>E.dem).forEach(E=>{let M=E.dem.tree;C[0]=Math.min(C[0],M.minimums[0]),C[1]=Math.max(C[1],M.maximums[0])}),C[0]!==1e4&&(f=(C[1]-C[0])*x.exaggeration())}let g=1.5*t.cameraToCenterDistance,v=3*g,y=new Float64Array(16);for(let x=0;x<2;++x){let C=this._cascades[x],E=t.height/50,M=1;x===0?M=g:(E=g,M=v);let[D,I]=LW(t,this.shadowDirection,E,M,hu,f);C.scale=t.scale,C.matrix=D,C.boundingSphereRadius=I,ft.invert(y,C.matrix),C.frustum=hc.fromInvProjectionMatrix(y,1,0,!0),C.far=M}this._uniformValues.u_fade_range=[.75*this._cascades[1].far,this._cascades[1].far],this._uniformValues.u_shadow_intensity=c,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=hu,this._uniformValues.u_shadowmap_0=Ms.ShadowMap0,this._uniformValues.u_shadowmap_1=Ms.ShadowMap0+1,this._groundShadowTiles=o.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let b=o.transform.elevation;for(let x of this._groundShadowTiles){let C={min:0,max:0};if(b){let E=b.getMinMaxForTile(x);E&&(C=E)}this.addShadowReceiver(x.toUnwrapped(),C.min,C.max)}}get enabled(){return this._enabled}set enabled(t){this._enabled=t}drawShadowPass(t,i){if(!this._enabled)return;let o=this.painter,c=o.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(o.transform.getFrustum(0),o.transform.worldSize,this._cascades),c.viewport.set([0,0,hu,hu]);for(let u=0;u<this._numCascadesToRender;++u){o.currentShadowCascade=u,c.bindFramebuffer.set(this._cascades[u].framebuffer.framebuffer),c.clear({color:fi.white,depth:1});for(let h of t.order){let p=t._mergedLayers[h];if(!p.hasShadowPass()||p.isHidden(o.transform.zoom))continue;let f=t.getLayerSourceCache(p),g=f?i[f.id]:void 0;(p.type==="model"||g&&g.length)&&o.renderLayer(o,f,p,g)}}o.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;let t=this.painter,i=t.style,o=t.context,c=i.directionalLight,u=i.ambientLight;if(!c||!u)return;let h=[],p=Nh(t,t.longestCutoffRange);p.shouldRenderCutoff&&h.push("RENDER_CUTOFF");let f=cS(c,u),g=new je(o.gl.LEQUAL,je.ReadOnly,t.depthRangeFor3D);for(let v of this._groundShadowTiles){let y=v.toUnwrapped(),b=t.isTileAffectedByFog(v),x=t.getOrCreateProgram("groundShadow",{defines:h,overrideFog:b});this.setupShadows(y,x),t.uploadCommonUniforms(o,x,y,null,p);let C={u_matrix:t.transform.calculateProjMatrix(y),u_ground_shadow_factor:f};x.draw(t,o.gl.TRIANGLES,g,gi.disabled,Vi.multiply,vi.disabled,C,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Vi.unblended:Vi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){let i=this.painter.transform,o=i.calculatePosMatrix(t,i.worldSize);return ft.multiply(o,this._cascades[this.painter.currentShadowCascade].matrix,o),Float32Array.from(o)}calculateShadowPassMatrixFromMatrix(t){return ft.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,i,o,c=0){if(!this._enabled)return;let u=this.painter.transform,h=this.painter.context,p=h.gl,f=this._uniformValues,g=new Float64Array(16),v=u.calculatePosMatrix(t,u.worldSize);for(let y=0;y<2;y++)ft.multiply(g,this._cascades[y].matrix,v),f[y===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(g),h.activeTexture.set(p.TEXTURE0+Ms.ShadowMap0+y),this._cascades[y].texture.bind(p.NEAREST,p.CLAMP_TO_EDGE);if(this.useNormalOffset=!!o,this.useNormalOffset){let y=Lp(t.canonical),b=2/u.tileSize*wt/hu,x=b*this._cascades[0].boundingSphereRadius,C=b*this._cascades[1].boundingSphereRadius,E=(o==="vector-tile"?1:3)/Math.pow(2,c-t.canonical.z-(1-u.zoom+Math.floor(u.zoom)));f.u_shadow_normal_offset=[y,x*E,C*E],f.u_shadow_bias=[6e-5,.0012,.012]}else f.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(h,f)}setupShadowsFromMatrix(t,i,o=!1){if(!this._enabled)return;let c=this.painter.context,u=c.gl,h=this._uniformValues,p=new Float64Array(16);for(let f=0;f<2;f++)ft.multiply(p,this._cascades[f].matrix,t),h[f===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(p),c.activeTexture.set(u.TEXTURE0+Ms.ShadowMap0+f),this._cascades[f].texture.bind(u.NEAREST,u.CLAMP_TO_EDGE);this.useNormalOffset=o,o?(h.u_shadow_normal_offset=[1,5,5],h.u_shadow_bias=[6e-5,.0012,.012]):h.u_shadow_bias=[36e-5,.0012,.012],i.setShadowUniformValues(c,h)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,i,o,c){if(c[2]>=0)return{};let u=function(f,g,v){let y=v/(1<<f.canonical.z);return new Ln([f.canonical.x*y+f.wrap*v,f.canonical.y*y+f.wrap*v,0],[(f.canonical.x+1)*y+f.wrap*v,(f.canonical.y+1)*y+f.wrap*v,g])}(t,i,o).getCorners(),h=i/-c[2];c[0]<0?(J.add(u[0],u[0],[c[0]*h,0,0]),J.add(u[3],u[3],[c[0]*h,0,0])):c[0]>0&&(J.add(u[1],u[1],[c[0]*h,0,0]),J.add(u[2],u[2],[c[0]*h,0,0])),c[1]<0?(J.add(u[0],u[0],[0,c[1]*h,0]),J.add(u[1],u[1],[0,c[1]*h,0])):c[1]>0&&(J.add(u[2],u[2],[0,c[1]*h,0]),J.add(u[3],u[3],[0,c[1]*h,0]));let p={};return p.vertices=u,p.planes=[rv(u[1],u[0],u[4]),rv(u[2],u[1],u[5]),rv(u[3],u[2],u[6]),rv(u[0],u[3],u[7])],p}addShadowReceiver(t,i,o){this._receivers.add(t,Ln.fromTileIdAndHeight(t,i,o))}getMaxCascadeForTile(t){let i=this._receivers.get(t);return i&&i.lastCascade?i.lastCascade:0}}function rv(e,t,i){let o=J.sub([],i,t),c=J.sub([],e,t),u=J.cross([],o,c),h=J.length(u);return h===0?[0,0,1,0]:(J.scale(u,u,1/h),[u[0],u[1],u[2],-J.dot(u,t)])}function eF(e){let t=e.properties.get("direction"),i=Ae(t.x,t.y,t.z);i[2]=ve(i[2],0,75);let o=_e([i[0],i[1],i[2]]);return J.fromValues(o.x,o.y,o.z)}function cS(e,t){let i=e.properties.get("color"),o=e.properties.get("intensity"),c=e.properties.get("direction"),u=[c.x,c.y,c.z],h=t.properties.get("color"),p=t.properties.get("intensity"),f=Math.max(J.dot([0,0,1],u),0),g=[0,0,0];J.scale(g,h.toArray01Linear().slice(0,3),p);let v=[0,0,0];return J.scale(v,i.toArray01Linear().slice(0,3),f*o),Or([g[0]>0?g[0]/(g[0]+v[0]):0,g[1]>0?g[1]/(g[1]+v[1]):0,g[2]>0?g[2]/(g[2]+v[2]):0])}function LW(e,t,i,o,c,u){let h=e.zoom,p=e.scale,f=e.worldSize,g=1/f,v=e.aspect,y=Math.sqrt(1+v*v)*Math.tan(.5*e.fovX),b=y*y,x=o-i,C=o+i,E,M;b>x/C?(E=o,M=o*y):(E=.5*C*(1+b),M=.5*Math.sqrt(x*x+2*(o*o+i*i)*b+C*C*b*b));let D=e.projection.pixelsPerMeter(e.center.lat,f),I=e._camera.getCameraToWorldMercator(),P=[0,0,-E*g];J.transformMat4(P,P,I);let O=M*g,R=e._edgeInsets;if(!(R.left===0&&R.top===0&&R.right===0&&R.bottom===0||R.left===R.right&&R.top===R.bottom)){let bt=e._camera.getWorldToCamera(e.worldSize,e.projection.zAxisUnit==="meters"?D:1),yt=e._camera.getCameraToClipPerspective(e._fov,e.width/e.height,i,o);yt[8]=2*-e.centerOffset.x/e.width,yt[9]=2*e.centerOffset.y/e.height;let Ct=new Float64Array(16);ft.mul(Ct,yt,bt);let St=new Float64Array(16);ft.invert(St,Ct);let Tt=hc.fromInvProjectionMatrix(St,f,h,!0);for(let xt of Tt.points){let Ft=((F=xt)[0]/=p,F[1]/=p,F[2]=_n(F[2],e._center.lat),F);O=Math.max(O,J.len(J.subtract([],P,Ft)))}}var F;O*=c/(c-1);let z=Math.acos(t[2]),j=Math.atan2(-t[0],-t[1]),U=new R0;U.position=P,U.setPitchBearing(z,j);let G=U.getWorldToCamera(f,D),$=O*f,Y=Math.min(e._mercatorZfromZoom(17)*f*-2,-2*$),tt=U.getCameraToClipOrthographic(-$,$,-$,$,Y,($+u*D)/t[2]),W=new Float64Array(16);ft.multiply(W,tt,G);let rt=J.fromValues(Math.floor(1e6*P[0])/1e6*f,Math.floor(1e6*P[1])/1e6*f,0),st=.5*c,pt=[0,0,0];J.transformMat4(pt,rt,W),J.scale(pt,pt,st);let nt=[Math.floor(pt[0]),Math.floor(pt[1]),Math.floor(pt[2])],ot=[0,0,0];J.sub(ot,pt,nt),J.scale(ot,ot,-1/st);let _t=new Float64Array(16);return ft.identity(_t),ft.translate(_t,_t,ot),ft.multiply(W,_t,W),[W,$]}class zW extends Hr{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.numModelsLoading={}}loadModel(t,i){return ZP(this.requestManager.transformRequest(i,Dt.Model).url).then(o=>{if(!o)return;let c=YC(o),u=new qR(t,void 0,void 0,c);return u.computeBoundsAndApplyParent(),u}).catch(o=>{this.fire(new Xe(new Error(`Could not load model ${t} from ${i}: ${o.message}`)))})}load(t,i){this.models[i]||(this.models[i]={});let o=Object.keys(t);this.numModelsLoading[i]=(this.numModelsLoading[i]||0)+o.length;let c=[];for(let u of o)c.push(this.loadModel(u,t[u]));Promise.allSettled(c).then(u=>{for(let h=0;h<u.length;h++){let{status:p,value:f}=u[h];p==="fulfilled"&&f&&(this.models[i][o[h]]=f)}this.numModelsLoading[i]-=o.length,this.fire(new qt("data",{dataType:"style"}))}).catch(u=>{this.fire(new Xe(new Error(`Could not load models: ${u.message}`)))})}isLoaded(){for(let t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,i){return!!this.getModel(t,i)}getModel(t,i){return this.models[i]||(this.models[i]={}),this.models[i][t]}addModel(t,i,o){this.models[o]||(this.models[o]={}),this.hasModel(t,o)&&this.removeModel(t,o),this.load({[t]:this.requestManager.normalizeModelURL(i)},o)}addModels(t,i){let o={};for(let c in t)o[c]=this.requestManager.normalizeModelURL(t[c]);this.load(o,i)}removeModel(t,i){this.models[i]||(this.models[i]={});let o=this.models[i][t];delete this.models[i][t],o.destroy()}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,i){this.models[i]||(this.models[i]={});for(let o in this.models[i])this.models[i][o].upload(t.context)}}let uf=(e,t)=>D_(e,t&&t.filter(i=>i.identifier!=="source.canvas")),NW=Ho(Zi,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),BW=Ho(Zi,["setCenter","setZoom","setBearing","setPitch"]),iF={version:8,layers:[],sources:{}},nF={duration:300,delay:0},VW=new Set(["fill","line","background","hillshade","raster"]);class il extends Hr{constructor(t,i={}){super(),this.map=t,this.scope=i.scope||"",this.fragments=[],this.importDepth=i.importDepth||0,this.importsCache=i.importsCache||new Map,this.resolvedImports=i.resolvedImports||new Set,this.transition=ge({},nF),this._buildingIndex=new cq(this),this.crossTileSymbolIndex=new Rq,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=i.styleChanges||new wU,this.dispatcher=i.dispatcher?i.dispatcher:new U0(lf(),this),i.imageManager?this.imageManager=i.imageManager:(this.imageManager=new NG,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=i.glyphManager?i.glyphManager:new Ih(t._requestManager,i.localFontFamily?2:i.localIdeographFontFamily?1:0,i.localFontFamily||i.localIdeographFontFamily),i.modelManager?this.modelManager=i.modelManager:(this.modelManager=new zW(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=new Map,this._configDependentLayers=new Set,this._config=i.config,this.dispatcher.broadcast("setReferrer",Ht());let o=this;this._rtlTextPluginCallback=il.registerForPluginStateChange(c=>{o.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:c.pluginStatus,pluginURL:c.pluginURL},(u,h)=>{if(i2(u),h&&h.every(p=>p))for(let p in o._sourceCaches){let f=o._sourceCaches[p],g=f.getSource().type;g!=="vector"&&g!=="geojson"||f.reload()}})}),this.on("data",c=>{if(c.dataType!=="source"||c.sourceDataType!=="metadata")return;let u=this.getOwnSource(c.sourceId);if(u&&u.vectorLayerIds)for(let h in this._layers){let p=this._layers[h];p.source===u.id&&this._validateLayer(p)}})}loadURL(t,i={}){this.fire(new qt("dataloading",{dataType:"style"}));let o=typeof i.validate=="boolean"?i.validate:!ln(t);t=this.map._requestManager.normalizeStyleURL(t,i.accessToken),this.resolvedImports.add(t);let c=this.importsCache.get(t);if(c)return this._load(c,o);let u=this.map._requestManager.transformRequest(t,Dt.Style);this._request=Xt(u,(h,p)=>{if(this._request=null,h)this.fire(new Xe(h));else if(p)return this.importsCache.set(t,p),this._load(p,o)})}loadJSON(t,i={}){this.fire(new qt("dataloading",{dataType:"style"})),this._request=ni.frame(()=>{this._request=null,this._load(t,i.validate!==!1)})}loadEmpty(){this.fire(new qt("dataloading",{dataType:"style"})),this._load(iF,!1)}_loadImports(t,i){if(this.importDepth>=4)return lt("Style doesn't support nesting deeper than 5"),Promise.resolve();let o=[];for(let c of t){let u=this._createFragmentStyle(c),h=new Promise(f=>{u.once("style.import.load",f),u.once("error",f)}).then(()=>this.mergeAll());if(o.push(h),this.resolvedImports.has(c.url)){u.loadEmpty();continue}let p=c.data||this.importsCache.get(c.url);p?u.loadJSON(p,{validate:i}):c.url?u.loadURL(c.url,{validate:i}):u.loadEmpty(),this.fragments.push({style:u,id:c.id,config:c.config})}return Promise.allSettled(o)}_createFragmentStyle(t){let i=this.scope?Yo(t.id,this.scope):t.id,o=new il(this.map,{scope:i,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:t.config});return o.setEventedParent(this.map,{style:o}),o}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});let t=this.isRootStyle();this._shouldPrecompile=t,this.fire(new qt(t?"style.load":"style.import.load"))}_load(t,i){let o=t.schema;if(this.isRootStyle()&&(t.fragment||o&&t.fragment!==!1)){let h=ge({},iF,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(h,i)}if(this.setConfig(this._config,o),i&&uf(this,dh(t)))return;this._loaded=!0,this.stylesheet=K(t);for(let h in t.sources)this.addSource(h,t.sources[h],{validate:!1,isInitialLoad:!0});t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);let c=tO(this.stylesheet.layers);if(this._order=c.map(h=>h.id),this.stylesheet.light&&lt("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let h=this.stylesheet.lights[0];this.light=new DP(h.properties,h.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new DP(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let h of c){let p=V0(h,this.options);p.setScope(this.scope),p.isConfigDependent&&this._configDependentLayers.add(p.fqid),p.setEventedParent(this,{layer:{id:p.id}}),this._layers[p.id]=p,this._serializedLayers[p.id]=p.serialize();let f=this.getOwnLayerSourceCache(p),g=!!this.directionalLight&&this.directionalLight.shadowsEnabled();f&&p.canCastShadows()&&g&&(f.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let u=this.stylesheet.terrain;u&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=ni.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?lt("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(u,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new qt("data",{dataType:"style"})),t.imports?this._loadImports(t.imports,i).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,i,o,c,u,h,p,f;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(g=>{if(g.stylesheet){if(g.light!=null&&(t=g.light),g.stylesheet.lights)for(let v of g.stylesheet.lights)v.type==="ambient"&&g.ambientLight!=null&&(i=g.ambientLight),v.type==="directional"&&g.directionalLight!=null&&(o=g.directionalLight);c=this._prioritizeTerrain(c,g.terrain,g.stylesheet.terrain),g.stylesheet.fog&&g.fog!=null&&(u=g.fog),g.stylesheet.camera!=null&&(f=g.stylesheet.camera),g.stylesheet.projection!=null&&(h=g.stylesheet.projection),g.stylesheet.transition!=null&&(p=g.stylesheet.transition)}}),this.light=t,this.ambientLight=i,this.directionalLight=o,this.fog=u,c===null?delete this.terrain:this.terrain=c,this.camera=f||{"camera-projection":"perspective"},this.projection=h||{name:"mercator"},this.transition=ge({},nF,p),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){let i=o=>{for(let c of o.fragments)i(c.style);t(o)};i(this)}_prioritizeTerrain(t,i,o){let c=t&&t.drapeRenderMode===0;return o===null?i&&i.drapeRenderMode===0?i:c?t:null:i!=null&&(!t||c||i&&i.drapeRenderMode===1)?i:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(i=>{t=this._prioritizeTerrain(t,i.terrain,i.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(i=>{i.stylesheet.projection!=null&&(t=i.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){let t={},i={},o={};this.forEachFragmentStyle(c=>{for(let u in c._sourceCaches){let h=Yo(u,c.scope);t[h]=c._sourceCaches[u]}for(let u in c._otherSourceCaches){let h=Yo(u,c.scope);i[h]=c._otherSourceCaches[u]}for(let u in c._symbolSourceCaches){let h=Yo(u,c.scope);o[h]=c._symbolSourceCaches[u]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=i,this._mergedSymbolSourceCaches=o}mergeLayers(){let t={},i=[],o={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(u=>{for(let h of u._order){let p=u._layers[h];if(p.type==="slot"){let f=k_(h);if(t[f])continue;t[f]=[]}p.slot&&t[p.slot]?t[p.slot].push(p):i.push(p)}}),this._mergedOrder=[];let c=(u=[])=>{for(let h of u)if(h.type==="slot"){let p=k_(h.id);t[p]&&c(t[p])}else{let p=Yo(h.id,h.scope);this._mergedOrder.push(p),o[p]=h,h.is3D()&&(this._has3DLayers=!0),h.type==="circle"&&(this._hasCircleLayers=!0),h.type==="symbol"&&(this._hasSymbolLayers=!0)}};c(i),this._mergedLayers=o,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=ge({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(i,o,c){let u,h,p,f=ni.devicePixelRatio>1?"@2x":"",g=Xt(o.transformRequest(o.normalizeSpriteURL(i,f,".json"),Dt.SpriteJSON),(b,x)=>{g=null,p||(p=b,u=x,y())}),v=mi(o.transformRequest(o.normalizeSpriteURL(i,f,".png"),Dt.SpriteImage),(b,x)=>{v=null,p||(p=b,h=x,y())});function y(){if(p)c(p);else if(u&&h){let b=ni.getImageData(h),x={};for(let C in u){let{width:E,height:M,x:D,y:I,sdf:P,pixelRatio:O,stretchX:R,stretchY:F,content:z}=u[C],j=new Br({width:E,height:M});Br.copy(b,j,{x:D,y:I},{x:0,y:0},{width:E,height:M}),x[C]={data:j,pixelRatio:O,sdf:P,stretchX:R,stretchY:F,content:z}}c(null,x)}}return{cancel(){g&&(g.cancel(),g=null),v&&(v.cancel(),v=null)}}}(t,this.map._requestManager,(i,o)=>{if(this._spriteRequest=null,i)this.fire(new Xe(i));else if(o)for(let c in o)this.imageManager.addImage(c,this.scope,o[c]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new qt("data",{dataType:"style"}))})}_validateLayer(t){let i=this.getOwnSource(t.source);if(!i)return;let o=t.sourceLayer;o&&(i.type==="geojson"||i.vectorLayerIds&&i.vectorLayerIds.indexOf(o)===-1)&&this.fire(new Xe(new Error(`Source layer "${o}" does not exist on source "${i.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(let{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,i)=>{let o=this.fragments[i];return o&&o.style&&(t.data=o.style.serialize()),t})}_serializeSources(){let t={};for(let i in this._sourceCaches){let o=this._sourceCaches[i].getSource();t[o.id]||(t[o.id]=o.serialize())}return t}_serializeLayers(t){let i=[];for(let o of t){let c=this._layers[o];c&&c.type!=="custom"&&i.push(c.serialize())}return i}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(let t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&(typeof t.isLayerDraped=="function"?t.isLayerDraped(this.getLayerSourceCache(t)):VW.has(t.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){let i=this.getOwnLayer(t);if(i)return i;this.fire(new Xe(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){let i=this.getOwnSource(t);if(i)return i;this.fire(new Xe(new Error(`The source '${t}' does not exist in the map's style.`)))}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);let i=this.calculateLightsBrightness();t.brightness=i||0,i!==this._brightness&&(this._brightness=i,this.dispatcher.broadcast("setBrightness",i));let o=this._changes.isDirty();if(this._changes.isDirty()){let u=this._changes.getLayerUpdatesByScope();for(let h in u){let{updatedIds:p,removedIds:f}=u[h];(p||f)&&this._updateWorkerLayers(h,p,f)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._changes.reset()}let c={};for(let u in this._mergedSourceCaches){let h=this._mergedSourceCaches[u];c[u]=h.used,h.used=!1}for(let u of this._mergedOrder){let h=this._mergedLayers[u];if(h.recalculate(t,this._availableImages),!h.isHidden(t.zoom)){let p=this.getLayerSourceCache(h);p&&(p.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let p=h.minzoom||0;p<(h.maxzoom||25.5);p++){let f=this.map.painter;if(f){let g=h.getProgramIds();if(!g)continue;for(let v of g){let y=h.getDefaultProgramParams(v,t.zoom);y&&(f.style=this,this.fog&&(f._fogVisible=!0,y.overrideFog=!0,f.getOrCreateProgram(v,y)),f._fogVisible=!1,y.overrideFog=!1,f.getOrCreateProgram(v,y),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(y.overrideRtt=!0,f.getOrCreateProgram(v,y)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(let u in c){let h=this._mergedSourceCaches[u];c[u]!==h.used&&h.getSource().fire(new qt("data",{sourceDataType:"visibility",dataType:"source",sourceId:h.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),o&&this.fire(new qt("data",{dataType:"style"}))}_updateTilesForChangedImages(){let t=this._changes.getUpdatedImages();if(t.length){for(let i in this._sourceCaches)this._sourceCaches[i].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,i,o){let c=this.getFragmentStyle(t);c&&this.dispatcher.broadcast("updateLayers",{layers:i?c._serializeLayers(i):[],scope:t,removedIds:o||[],options:c.options})}setState(t){if(this._checkLoaded(),uf(this,dh(t)))return!1;(t=K(t)).layers=tO(t.layers);let i=function(c,u){if(!c)return[{command:Zi.setStyle,args:[u]}];let h=[];try{if(!$t(c.version,u.version))return[{command:Zi.setStyle,args:[u]}];$t(c.center,u.center)||h.push({command:Zi.setCenter,args:[u.center]}),$t(c.zoom,u.zoom)||h.push({command:Zi.setZoom,args:[u.zoom]}),$t(c.bearing,u.bearing)||h.push({command:Zi.setBearing,args:[u.bearing]}),$t(c.pitch,u.pitch)||h.push({command:Zi.setPitch,args:[u.pitch]}),$t(c.sprite,u.sprite)||h.push({command:Zi.setSprite,args:[u.sprite]}),$t(c.glyphs,u.glyphs)||h.push({command:Zi.setGlyphs,args:[u.glyphs]}),$t(c.imports,u.imports)||function(y=[],b=[],x){b=b||[];let C=(y=y||[]).map(W0),E=b.map(W0),M=y.reduce($0,{}),D=b.reduce($0,{}),I=C.slice(),P,O,R,F;for(P=0,O=0;P<C.length;P++)R=C[P],D.hasOwnProperty(R)?O++:(x.push({command:Zi.removeImport,args:[R]}),I.splice(I.indexOf(R,O),1));for(P=0,O=0;P<E.length;P++)R=E[E.length-1-P],I[I.length-1-P]!==R&&(M.hasOwnProperty(R)?(x.push({command:Zi.removeImport,args:[R]}),I.splice(I.lastIndexOf(R,I.length-O),1)):O++,F=I[I.length-P],x.push({command:Zi.addImport,args:[D[R],F]}),I.splice(I.length-P,0,R));for(let z of b){let j=M[z.id];if(!j||$t(j,z))continue;$t(j.config,z.config)||x.push({command:Zi.setImportConfig,args:[z.id,z.config]}),$t(j.url,z.url)||x.push({command:Zi.setImportUrl,args:[z.id,z.url]});let U=z.data;$t(j&&j.data,U)||x.push({command:Zi.setImportData,args:[z.id,U]})}}(c.imports,u.imports,h),$t(c.transition,u.transition)||h.push({command:Zi.setTransition,args:[u.transition]}),$t(c.light,u.light)||h.push({command:Zi.setLight,args:[u.light]}),$t(c.fog,u.fog)||h.push({command:Zi.setFog,args:[u.fog]}),$t(c.projection,u.projection)||h.push({command:Zi.setProjection,args:[u.projection]}),$t(c.lights,u.lights)||h.push({command:Zi.setLights,args:[u.lights]}),$t(c.camera,u.camera)||h.push({command:Zi.setCamera,args:[u.camera]});let p={},f=[];(function(y,b,x,C){let E;for(E in b=b||{},y=y||{})y.hasOwnProperty(E)&&(b.hasOwnProperty(E)||iO(E,x,C));for(E in b){if(!b.hasOwnProperty(E))continue;let M=b[E];y.hasOwnProperty(E)?$t(y[E],M)||(y[E].type==="geojson"&&M.type==="geojson"&&hq(y,b,E)?x.push({command:Zi.setGeoJSONSourceData,args:[E,M.data]}):uq(E,b,x,C)):eO(E,b,x)}})(c.sources,u.sources,f,p);let g=[];c.layers&&c.layers.forEach(y=>{y.source&&p[y.source]?h.push({command:Zi.removeLayer,args:[y.id]}):g.push(y)});let v=c.terrain;v&&p[v.source]&&(h.push({command:Zi.setTerrain,args:[void 0]}),v=void 0),h=h.concat(f),$t(v,u.terrain)||h.push({command:Zi.setTerrain,args:[u.terrain]}),function(y,b,x){b=b||[];let C=(y=y||[]).map(W0),E=b.map(W0),M=y.reduce($0,{}),D=b.reduce($0,{}),I=C.slice(),P=Object.create(null),O,R,F,z,j,U,G;for(O=0,R=0;O<C.length;O++)F=C[O],D.hasOwnProperty(F)?R++:(x.push({command:Zi.removeLayer,args:[F]}),I.splice(I.indexOf(F,R),1));for(O=0,R=0;O<E.length;O++)F=E[E.length-1-O],I[I.length-1-O]!==F&&(M.hasOwnProperty(F)?(x.push({command:Zi.removeLayer,args:[F]}),I.splice(I.lastIndexOf(F,I.length-R),1)):R++,U=I[I.length-O],x.push({command:Zi.addLayer,args:[D[F],U]}),I.splice(I.length-O,0,F),P[F]=!0);for(O=0;O<E.length;O++)if(F=E[O],z=M[F],j=D[F],!P[F]&&!$t(z,j))if($t(z.source,j.source)&&$t(z["source-layer"],j["source-layer"])&&$t(z.type,j.type)){for(G in q0(z.layout,j.layout,x,F,null,Zi.setLayoutProperty),q0(z.paint,j.paint,x,F,null,Zi.setPaintProperty),$t(z.slot,j.slot)||x.push({command:Zi.setSlot,args:[F,j.slot]}),$t(z.filter,j.filter)||x.push({command:Zi.setFilter,args:[F,j.filter]}),$t(z.minzoom,j.minzoom)&&$t(z.maxzoom,j.maxzoom)||x.push({command:Zi.setLayerZoomRange,args:[F,j.minzoom,j.maxzoom]}),z)z.hasOwnProperty(G)&&G!=="layout"&&G!=="paint"&&G!=="filter"&&G!=="metadata"&&G!=="minzoom"&&G!=="maxzoom"&&G!=="slot"&&(G.indexOf("paint.")===0?q0(z[G],j[G],x,F,G.slice(6),Zi.setPaintProperty):$t(z[G],j[G])||x.push({command:Zi.setLayerProperty,args:[F,G,j[G]]}));for(G in j)j.hasOwnProperty(G)&&!z.hasOwnProperty(G)&&G!=="layout"&&G!=="paint"&&G!=="filter"&&G!=="metadata"&&G!=="minzoom"&&G!=="maxzoom"&&G!=="slot"&&(G.indexOf("paint.")===0?q0(z[G],j[G],x,F,G.slice(6),Zi.setPaintProperty):$t(z[G],j[G])||x.push({command:Zi.setLayerProperty,args:[F,G,j[G]]}))}else x.push({command:Zi.removeLayer,args:[F]}),U=I[I.lastIndexOf(F)+1],x.push({command:Zi.addLayer,args:[j,U]})}(g,u.layers,h)}catch(p){console.warn("Unable to compute style diff:",p),h=[{command:Zi.setStyle,args:[u]}]}return h}(this.serialize(),t).filter(c=>!(c.command in BW));if(i.length===0)return!1;let o=i.filter(c=>!(c.command in NW));if(o.length>0)throw new Error(`Unimplemented: ${o.map(c=>c.command).join(", ")}.`);return i.forEach(c=>{this[c.command].apply(this,c.args)}),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,i){return this.getImage(t)?this.fire(new Xe(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,i),this._afterImageUpdated(t),this)}updateImage(t,i){this.imageManager.updateImage(t,this.scope,i)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new Xe(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(t),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new qt("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,i,o={}){return this._checkLoaded(),this._validate(fU,`models.${t}`,i,null,o)||(this.modelManager.addModel(t,i,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new Xe(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,i,o={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(aU,`sources.${t}`,i,null,o))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);let c=XC(t,i,this.dispatcher,this);c.scope=this.scope,c.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(c.id),source:c.serialize(),sourceId:c.id}));let u=h=>{let p=(h?"symbol:":"other:")+c.id,f=Yo(p,this.scope),g=this._sourceCaches[p]=new Ja(f,c,h);(h?this._symbolSourceCaches:this._otherSourceCaches)[c.id]=g,g.onAdd(this.map)};u(!1),i.type!=="vector"&&i.type!=="geojson"||u(!0),c.onAdd&&c.onAdd(this.map),o.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();let i=this.getOwnSource(t);if(!i)throw new Error("There is no source with this ID");for(let c in this._layers)if(this._layers[c].source===t)return this.fire(new Xe(new Error(`Source "${t}" cannot be removed while layer "${c}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new Xe(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));let o=this.getOwnSourceCaches(t);for(let c of o){let u=k_(c.id);delete this._sourceCaches[u],this._changes.discardSourceCacheUpdate(c.id),c.fire(new qt("data",{sourceDataType:"metadata",dataType:"source",sourceId:c.getSource().id})),c.setEventedParent(null),c.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),i.setEventedParent(null),i.onRemove&&i.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,i){this._checkLoaded(),this.getOwnSource(t).setData(i),this._changes.setDirty()}getOwnSource(t){let i=this.getOwnSourceCache(t);return i&&i.getSource()}getOwnSources(){let t=[];for(let i in this._otherSourceCaches){let o=this.getOwnSourceCache(i);o&&t.push(o.getSource())}return t}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;let i=this._getTransitionParameters();for(let c of t){if(this._validate(cU,"lights",c))return;switch(c.type){case"ambient":if(this.ambientLight){let u=this.ambientLight;u.set(c),u.updateTransitions(i)}else this.ambientLight=new OP(c,WG,this.scope,this.options);break;case"directional":if(this.directionalLight){let u=this.directionalLight;u.set(c),u.updateTransitions(i)}else this.directionalLight=new OP(c,$G,this.scope,this.options)}}let o=new Jn(this.z||0,i);this.ambientLight&&this.ambientLight.recalculate(o),this.directionalLight&&this.directionalLight.recalculate(o),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let t=this.directionalLight,i=this.ambientLight;if(!t||!i)return;let o=y=>.2126*(y[0]<=.03928?y[0]/12.92:Math.pow((y[0]+.055)/1.055,2.4))+.7152*(y[1]<=.03928?y[1]/12.92:Math.pow((y[1]+.055)/1.055,2.4))+.0722*(y[2]<=.03928?y[2]/12.92:Math.pow((y[2]+.055)/1.055,2.4)),c=t.properties.get("color").toArray01(),u=t.properties.get("intensity"),h=t.properties.get("direction"),p=1-Ae(h.x,h.y,h.z)[2]/90,f=o(c)*u*p,g=i.properties.get("color").toArray01(),v=i.properties.get("intensity");return(f+o(g)*v)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(s2(t)){let i=function(u){let h=u.indexOf(A_);return h>=0?u.slice(h+1):""}(t),o=this.fragments.find(({id:u})=>u===i);if(!o)throw new Error(`Style import not found: ${t}`);let c=k_(t);return o.style.getFragmentStyle(c)}{let i=this.fragments.find(({id:o})=>o===t);if(!i)throw new Error(`Style import not found: ${t}`);return i.style}}getConfigProperty(t,i){let o=this.getFragmentStyle(t);if(!o)return null;let c=o.options.get(i),u=c?c.value||c.default:null;return u?u.serialize():null}setConfigProperty(t,i,o){let c=Vc(o);if(c.result!=="success")return void uf(this,c.value);let u=c.value.expression,h=this.getFragmentStyle(t);if(!h)return;let p=h.options.get(i);p&&(h.options.set(i,Ri(Gt({},p),{value:u})),h.updateConfigDependencies())}setConfig(t,i){if(this._config=t,t||i)if(i){this.options.clear();for(let o in i){let c,u,h=Vc(i[o].default);if(h.result==="success"&&(c=h.value.expression),t&&t[o]!==void 0){let b=Vc(t[o]);b.result==="success"&&(u=b.value.expression)}let{minValue:p,maxValue:f,stepValue:g,type:v,values:y}=i[o];c?this.options.set(o,{default:c,value:u,minValue:p,maxValue:f,stepValue:g,type:v,values:y}):this.fire(new Xe(new Error(`No schema defined for config option "${o}".`)))}}else this.fire(new Xe(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(let t of this._configDependentLayers){let i=this.getLayer(t);i&&(i.possiblyEvaluateVisibility(),this._updateLayer(i))}this.ambientLight&&this.ambientLight.scope===this.scope&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.scope===this.scope&&this.directionalLight.updateConfig(this.options),this._changes.setDirty()}addLayer(t,i,o={}){this._checkLoaded();let c=t.id;if(this._layers[c])return void this.fire(new Xe(new Error(`Layer with id "${c}" already exists on this map`)));let u;if(t.type==="custom"){if(uf(this,function(v){let y=[],b=v.id;return b===void 0&&y.push({message:`layers.${b}: missing required property "id"`}),v.render===void 0&&y.push({message:`layers.${b}: missing required method "render"`}),v.renderingMode&&v.renderingMode!=="2d"&&v.renderingMode!=="3d"&&y.push({message:`layers.${b}: property "renderingMode" must be either "2d" or "3d"`}),y}(t)))return;u=V0(t,this.options)}else{if(typeof t.source=="object"&&(this.addSource(c,t.source),t=ge(t=K(t),{source:c})),this._validate(hU,`layers.${c}`,t,{arrayIndex:-1},o))return;u=V0(t,this.options),this._validateLayer(u),u.setEventedParent(this,{layer:{id:c}}),this._serializedLayers[u.id]=u.serialize()}u.isConfigDependent&&this._configDependentLayers.add(u.fqid),u.setScope(this.scope);let h=this._order.length;if(i){let v=this._order.indexOf(i);if(v===-1)return void this.fire(new Xe(new Error(`Layer with id "${i}" does not exist on this map.`)));u.slot===this._layers[i].slot?h=v:lt(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(h,0,c),this._layerOrderChanged=!0,this._layers[c]=u;let p=this.getOwnLayerSourceCache(u),f=!!this.directionalLight&&this.directionalLight.shadowsEnabled();p&&u.canCastShadows()&&f&&(p.castsShadows=!0);let g=this._changes.getRemovedLayer(u);if(g&&u.source&&p&&u.type!=="custom"){this._changes.discardLayerRemoval(u);let v=Yo(u.source,u.scope);g.type!==u.type?this._changes.updateSourceCache(v,"clear"):(this._changes.updateSourceCache(v,"reload"),p.pause())}this._updateLayer(u),u.onAdd&&u.onAdd(this.map),u.scope=this.scope,this.mergeLayers()}moveLayer(t,i){this._checkLoaded();let o=this._checkLayer(t);if(!o||t===i)return;let c=this._order.indexOf(t);this._order.splice(c,1);let u=this._order.length;if(i){let h=this._order.indexOf(i);if(h===-1)return void this.fire(new Xe(new Error(`Layer with id "${i}" does not exist on this map.`)));o.slot===this._layers[i].slot?u=h:lt(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(u,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();let i=this._checkLayer(t);if(!i)return;i.setEventedParent(null);let o=this._order.indexOf(t);this._order.splice(o,1),delete this._layers[t],delete this._serializedLayers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(i.fqid),this._changes.removeLayer(i);let c=this.getOwnLayerSourceCache(i);if(c&&c.castsShadows){let u=!1;for(let h in this._layers)if(this._layers[h].source===i.source&&this._layers[h].canCastShadows()){u=!0;break}c.castsShadows=u}i.onRemove&&i.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(let i in this._layers)if(this._layers[i].type===t)return!0;return!1}setLayerZoomRange(t,i,o){this._checkLoaded();let c=this._checkLayer(t);c&&(c.minzoom===i&&c.maxzoom===o||(i!=null&&(c.minzoom=i),o!=null&&(c.maxzoom=o),this._updateLayer(c)))}setSlot(t,i){this._checkLoaded();let o=this._checkLayer(t);o&&o.slot!==i&&(o.slot=i,this._updateLayer(o))}setFilter(t,i,o={}){this._checkLoaded();let c=this._checkLayer(t);if(c&&!$t(c.filter,i))return i==null?(c.filter=void 0,void this._updateLayer(c)):void(this._validate(G1,`layers.${c.id}.filter`,i,{layerType:c.type},o)||(c.filter=K(i),this._updateLayer(c)))}getFilter(t){let i=this._checkLayer(t);if(i)return K(i.filter)}setLayoutProperty(t,i,o,c={}){this._checkLoaded();let u=this._checkLayer(t);u&&($t(u.getLayoutProperty(i),o)||(u.setLayoutProperty(i,o,c),u.isConfigDependent&&this._configDependentLayers.add(u.fqid),this._updateLayer(u)))}getLayoutProperty(t,i){let o=this._checkLayer(t);if(o)return o.getLayoutProperty(i)}setPaintProperty(t,i,o,c={}){this._checkLoaded();let u=this._checkLayer(t);if(!u||$t(u.getPaintProperty(i),o))return;let h=u.setPaintProperty(i,o,c);u.isConfigDependent&&this._configDependentLayers.add(u.fqid),h&&this._updateLayer(u),this._changes.updatePaintProperties(u)}getPaintProperty(t,i){let o=this._checkLayer(t);if(o)return o.getPaintProperty(i)}setFeatureState(t,i){this._checkLoaded();let o=t.source,c=t.sourceLayer,u=this._checkSource(o);if(!u)return;let h=u.type;if(h==="geojson"&&c)return void this.fire(new Xe(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(h==="vector"&&!c)return void this.fire(new Xe(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new Xe(new Error("The feature id parameter must be provided.")));let p=this.getOwnSourceCaches(o);for(let f of p)f.setFeatureState(c,t.id,i)}removeFeatureState(t,i){this._checkLoaded();let o=t.source,c=this._checkSource(o);if(!c)return;let u=c.type,h=u==="vector"?t.sourceLayer:void 0;if(u==="vector"&&!h)return void this.fire(new Xe(new Error("The sourceLayer parameter must be provided for vector source types.")));if(i&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new Xe(new Error("A feature id is required to remove its specific state property.")));let p=this.getOwnSourceCaches(o);for(let f of p)f.removeFeatureState(h,t.id,i)}getFeatureState(t){this._checkLoaded();let i=t.source,o=t.sourceLayer,c=this._checkSource(i);if(c){if(c.type!=="vector"||o)return t.id===void 0&&this.fire(new Xe(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(i)[0].getFeatureState(o,t.id);this.fire(new Xe(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=ge({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return ge({},this.stylesheet.transition)}serialize(){this._checkLoaded();let t=this.getTerrain(),i=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return Yt({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:i,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},o=>o!==void 0)}_updateLayer(t){this._changes.updateLayer(t);let i=this.getLayerSourceCache(t),o=Yo(t.source,t.scope),c=this._changes.getUpdatedSourceCaches();t.source&&!c[o]&&i&&i.getSource().type!=="raster"&&(this._changes.updateSourceCache(o,"reload"),i.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){let i=p=>this._mergedLayers[p].type==="fill-extrusion",o=this.order,c={},u=[];for(let p=o.length-1;p>=0;p--){let f=o[p];if(i(f)){c[f]=p;for(let g of t){let v=g[f];if(v)for(let y of v)u.push(y)}}}u.sort((p,f)=>f.intersectionZ-p.intersectionZ);let h=[];for(let p=o.length-1;p>=0;p--){let f=o[p];if(i(f))for(let g=u.length-1;g>=0;g--){let v=u[g].feature;if(c[v.layer.id]<p)break;h.push(v),u.pop()}else for(let g of t){let v=g[f];if(v)for(let y of v)h.push(y.feature)}}return h}queryRenderedFeatures(t,i,o){i&&i.filter&&this._validate(G1,"queryRenderedFeatures.filter",i.filter,null,i),i.scope=this.scope,i.availableImages=this._availableImages,i.serializedLayers=this._serializedLayers;let c={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new Xe(new Error("parameters.layers must be an Array."))),[];for(let g of i.layers){let v=this._mergedLayers[g];if(!v)return this.fire(new Xe(new Error(`The layer '${g}' does not exist in the map's style and cannot be queried for features.`))),[];c[v.source]=!0}}let u=[],h=i.serializedLayers||{},p=i&&i.layers?i.layers.some(g=>{let v=this.getLayer(g);return v&&v.is3D()}):this.has3DLayers(),f=FC.createFromScreenPoints(t,o);for(let g in this._mergedSourceCaches){let v=this._mergedSourceCaches[g].getSource();if(!v||v.scope!==i.scope)continue;let y=this._mergedSourceCaches[g].getSource().id;i.layers&&!c[y]||u.push(aq(this._mergedSourceCaches[g],this._mergedLayers,h,f,i,o,p,!!this.map._showQueryGeometry))}return this.placement&&u.push(function(g,v,y,b,x,C,E){let M={},D=C.queryRenderedSymbols(b),I=[];for(let P of Object.keys(D).map(Number))I.push(E[P]);I.sort(QP);for(let P of I){let O=P.featureIndex.lookupSymbolFeatures(D[P.bucketInstanceId],v,P.bucketIndex,P.sourceLayerIndex,x.filter,x.layers,x.availableImages,g);for(let R in O){let F=M[R]=M[R]||[],z=O[R];z.sort((j,U)=>{let G=P.featureSortOrder;if(G){let $=G.indexOf(j.featureIndex);return G.indexOf(U.featureIndex)-$}return U.featureIndex-j.featureIndex});for(let j of z)F.push(j)}}for(let P in M)M[P].forEach(O=>{let R=O.feature,F=y(g[P]);if(!F)return;let z=F.getFeatureState(R.layer["source-layer"],R.id);R.source=R.layer.source,R.layer["source-layer"]&&(R.sourceLayer=R.layer["source-layer"]),R.state=z});return M}(this._mergedLayers,h,this.getLayerSourceCache.bind(this),f.screenGeometry,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(u)}querySourceFeatures(t,i){i&&i.filter&&this._validate(G1,"querySourceFeatures.filter",i.filter,null,i);let o=this.getOwnSourceCaches(t),c=[];for(let u of o)c=c.concat(lq(u,i));return c}addSourceType(t,i,o){return il.getSourceType(t)?o(new Error(`A source type called "${t}" already exists.`)):(il.setSourceType(t,i),i.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:i.workerSourceURL},o):o(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,i,o={}){this._checkLoaded();let c=this.light.getLight(),u=!1;for(let p in t)if(!$t(t[p],c[p])){u=!0;break}if(!u)return;let h=this._getTransitionParameters();this.light.setLight(t,i,o),this.light.updateTransitions(h)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(t,i=1){if(this._checkLoaded(),!t)return delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let o=t,c=t.source==null;if(i===1){if(typeof o.source=="object"){let p="terrain-dem-src";this.addSource(p,o.source),o=K(o),o=ge(o,{source:p})}let u=ge({},o),h={};if(this.terrain&&c){u.source=this.terrain.get().source;let p=this.terrain?this.getFragmentStyle(this.terrain.scope):null;p&&(h.style=p.serialize())}if(this._validate(dU,"terrain",u,h))return}if(!this.terrain||this.terrain.scope!==this.scope&&!c||this.terrain&&i!==this.terrain.drapeRenderMode){if(!o)return;this._createTerrain(o,i),this.fire(new qt("data",{dataType:"style"}))}else{let u=this.terrain,h=u.get();for(let p of Object.keys(gt.terrain))!o.hasOwnProperty(p)&&gt.terrain[p].default&&(o[p]=gt.terrain[p].default);for(let p in t)if(!$t(t[p],h[p])){u.set(t,this.options),this.stylesheet.terrain=t;let f=this._getTransitionParameters({duration:0});u.updateTransitions(f),this.fire(new qt("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){let i=this.fog=new HG(t,this.map.transform);this.stylesheet.fog=i.get();let o=this._getTransitionParameters({duration:0});i.updateTransitions(o)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let i=this.fog;if(!$t(i.get(),t)){i.set(t),this.stylesheet.fog=i.get();let o=this._getTransitionParameters({duration:0});i.updateTransitions(o)}}else this._createFog(t);this._markersNeedUpdate=!0}_getTransitionParameters(t){return{now:ni.now(),transition:ge(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;let t=[],i=[];for(let o in this._mergedLayers)this.isLayerDraped(this._mergedLayers[o])?t.push(o):i.push(o);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...i)}_createTerrain(t,i){let o=this.terrain=new jG(t,i,this.scope,this.options);i===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let c=this._getTransitionParameters({duration:0});o.updateTransitions(c)}_force3DLayerUpdate(){for(let t in this._layers){let i=this._layers[t];i.type==="fill-extrusion"&&this._updateLayer(i)}}_forceSymbolLayerUpdate(){for(let t in this._layers){let i=this._layers[t];i.type==="symbol"&&this._updateLayer(i)}}_validate(t,i,o,c,u={}){if(u&&u.validate===!1)return!1;let h=ge({},this.serialize());return uf(this,t.call(dh,ge({key:i,style:h,value:o,styleSpec:gt},c)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),Q1.off("pluginStateChange",this._rtlTextPluginCallback);for(let t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(let t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){let i=this.getSourceCaches(t);for(let o of i)o.clearTiles()}clearSources(){for(let t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){let i=this.getSourceCaches(t);for(let o of i)o.resume(),o.reload()}reloadSources(){for(let t of this.getSources())t.reload&&t.reload()}updateSources(t){let i;this.directionalLight&&(i=eF(this.directionalLight));for(let o in this._mergedSourceCaches)this._mergedSourceCaches[o].update(t,void 0,void 0,i)}_generateCollisionBoxes(){for(let t in this._sourceCaches){let i=this._sourceCaches[t];i.resume(),i.reload()}}_updatePlacement(t,i,o,c,u=!1){let h=!1,p=!1,f={},g={};for(let v of this._mergedOrder){let y=this._mergedLayers[v];if(y.type!=="symbol")continue;let b=Yo(y.source,y.scope),x=f[b];if(!x){let E=this.getLayerSourceCache(y);if(!E)continue;let M=E.getRenderableIds(!0).map(D=>E.getTileByID(D));g[b]=M.slice(),x=f[b]=M.sort((D,I)=>I.tileID.overscaledZ-D.tileID.overscaledZ||(D.tileID.isLessThan(I.tileID)?-1:1))}let C=this.crossTileSymbolIndex.addLayer(y,x,t.center.lng,t.projection);h=h||C}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),u=u||this._layerOrderChanged||o===0,this._layerOrderChanged&&this.fire(new qt("neworder")),(u||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ni.now(),t.zoom))&&(this.pauseablePlacement=new Tq(t,this._mergedOrder,u,i,o,c,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,f,g),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ni.now()),p=!0),h&&this.pauseablePlacement.placement.setStale()),p||h)for(let v of this._mergedOrder){let y=this._mergedLayers[v];y.type==="symbol"&&this.placement.updateLayerOpacities(y,f[Yo(y.source,y.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ni.now())}_releaseSymbolFadeTiles(){for(let t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t){this._checkLoaded();let i=this.stylesheet.imports=this.stylesheet.imports||[];return i.findIndex(({id:c})=>c===t.id)!==-1?this.fire(new Xe(new Error(`Import with id '${t.id}' already exists in the map's style.`))):(i.push(t),this._loadImports([t],!0),this)}setImportUrl(t,i){this._checkLoaded();let o=this.stylesheet.imports||[],c=this.getImportIndex(t);if(c===-1)return this;o[c].url=i;let u=this.fragments[c];return u.style=this._createFragmentStyle(o[c]),u.style.on("style.import.load",()=>this.mergeAll()),u.style.loadURL(i),this}setImportData(t,i){this._checkLoaded();let o=this.getImportIndex(t),c=this.stylesheet.imports||[];return o===-1?this:i?(this.fragments[o].style.setState(i),this._reloadImports(),this):(delete c[o].data,this.setImportUrl(t,c[o].url))}setImportConfig(t,i){this._checkLoaded();let o=this.getImportIndex(t),c=this.stylesheet.imports||[];if(o===-1)return this;i?c[o].config=i:delete c[o].config;let u=this.fragments[o],h=u.style.stylesheet&&u.style.stylesheet.schema;return u.config=i,u.style.setConfig(i,h),u.style.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();let i=this.stylesheet.imports||[],o=this.getImportIndex(t);return o===-1||(i.splice(o,1),this.fragments[o].style._remove(),this.fragments.splice(o,1),this._reloadImports()),this}getImportIndex(t){let i=(this.stylesheet.imports||[]).findIndex(o=>o.id===t);return i===-1&&this.fire(new Xe(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),i}getLayer(t){return this._mergedLayers[t]}getSources(){let t=[];for(let i in this._mergedOtherSourceCaches){let o=this._mergedOtherSourceCaches[i];o&&t.push(o.getSource())}return t}getSource(t,i){let o=this.getSourceCache(t,i);return o&&o.getSource()}getLayerSource(t){let i=this.getLayerSourceCache(t);return i&&i.getSource()}getSourceCache(t,i){let o=Yo(t,i);return this._mergedOtherSourceCaches[o]}getLayerSourceCache(t){let i=Yo(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[i]:this._mergedOtherSourceCaches[i]}getSourceCaches(t){let i=[];return this._mergedOtherSourceCaches[t]&&i.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&i.push(this._mergedSymbolSourceCaches[t]),i}updateSourceCaches(){let t=this._changes.getUpdatedSourceCaches();for(let i in t){let o=t[i];o==="reload"?this.reloadSource(i):o==="clear"&&this.clearSource(i)}}updateLayers(t){let i=this._changes.getUpdatedPaintProperties();for(let o of i){let c=this.getLayer(o);c&&c.updateTransitions(t)}}getImages(t,i,o){this.imageManager.getImages(i.icons,i.scope,o),this._updateTilesForChangedImages();let c=u=>{u&&u.setDependencies(i.tileID.key,i.type,i.icons)};c(this._otherSourceCaches[i.source]),c(this._symbolSourceCaches[i.source])}getGlyphs(t,i,o){this.glyphManager.getGlyphs(i.stacks,i.scope,o)}getResource(t,i,o){return Zt(i,o)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){let i=[];return this._otherSourceCaches[t]&&i.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&i.push(this._symbolSourceCaches[t]),i}_isSourceCacheLoaded(t){let i=this.getOwnSourceCaches(t);return i.length===0?(this.fire(new Xe(new Error(`There is no source with ID '${t}'`))),!1):i.every(o=>o.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function rF(e,t){let i=!1,o=null,c=()=>{o=null,i&&(e(),o=setTimeout(c,t),i=!1)};return()=>(i=!0,o||c(),o)}il.getSourceType=function(e){return ZC[e]},il.setSourceType=function(e,t){ZC[e]=t},il.registerForPluginStateChange=function(e){return e({pluginStatus:bs,pluginURL:Hc}),Q1.on("pluginStateChange",e),e};class jW{constructor(t){this._hashName=t&&encodeURIComponent(t),_o(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=rF(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,m.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),m.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let t=this._map;if(!t)return"";let i=oF(t);if(this._hashName){let o=this._hashName,c=!1,u=m.location.hash.slice(1).split("&").map(h=>{let p=h.split("=")[0];return p===o?(c=!0,`${p}=${i}`):h}).filter(h=>h);return c||u.push(`${o}=${i}`),`#${u.join("&")}`}return`#${i}`}_getCurrentHash(){let t=m.location.hash.replace("#","");if(this._hashName){let i;return t.split("&").map(o=>o.split("=")).forEach(o=>{o[0]===this._hashName&&(i=o)}),(i&&i[1]||"").split("/")}return t.split("/")}_onHashChange(){let t=this._map;if(!t)return!1;let i=this._getCurrentHash();if(i.length>=3&&!i.some(o=>isNaN(o))){let o=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(i[3]||0):t.getBearing();return t.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:o,pitch:+(i[4]||0)}),!0}return!1}_updateHashUnthrottled(){let t=m.location.href.replace(/(#.+)?$/,this.getHashString());m.history.replaceState(m.history.state,null,t)}}function oF(e,t){let i=e.getCenter(),o=Math.round(100*e.getZoom())/100,c=Math.ceil((o*Math.LN2+Math.log(512/360/.5))/Math.LN10),u=Math.pow(10,c),h=Math.round(i.lng*u)/u,p=Math.round(i.lat*u)/u,f=e.getBearing(),g=e.getPitch(),v=t?`/${h}/${p}/${o}`:`${o}/${p}/${h}`;return(f||g)&&(v+="/"+Math.round(10*f)/10),g&&(v+=`/${Math.round(g)}`),v}let ov={linearity:.3,easing:fn(0,0,.3,1)},UW=ge({deceleration:2500,maxSpeed:1400},ov),HW=ge({deceleration:20,maxSpeed:1400},ov),GW=ge({deceleration:1e3,maxSpeed:360},ov),qW=ge({deceleration:1e3,maxSpeed:90},ov);class WW{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ni.now(),settings:t})}_drainInertiaBuffer(){let t=this._inertiaBuffer,i=ni.now();for(;t.length>0&&i-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let i={zoom:0,bearing:0,pitch:0,pan:new Q(0,0),pinchAround:void 0,around:void 0};for(let{settings:u}of this._inertiaBuffer)i.zoom+=u.zoomDelta||0,i.bearing+=u.bearingDelta||0,i.pitch+=u.pitchDelta||0,u.panDelta&&i.pan._add(u.panDelta),u.around&&(i.around=u.around),u.pinchAround&&(i.pinchAround=u.pinchAround);let o=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(i.pan.mag()){let u=av(i.pan.mag(),o,ge({},UW,t||{}));c.offset=i.pan.mult(u.amount/i.pan.mag()),c.center=this._map.transform.center,sv(c,u)}if(i.zoom){let u=av(i.zoom,o,HW);c.zoom=this._map.transform.zoom+u.amount,sv(c,u)}if(i.bearing){let u=av(i.bearing,o,GW);c.bearing=this._map.transform.bearing+ve(u.amount,-179,179),sv(c,u)}if(i.pitch){let u=av(i.pitch,o,qW);c.pitch=this._map.transform.pitch+u.amount,sv(c,u)}if(c.zoom||c.bearing){let u=i.pinchAround===void 0?i.around:i.pinchAround;c.around=u?this._map.unproject(u):this._map.getCenter()}return this.clear(),c.noMoveStart=!0,c}}function sv(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function av(e,t,i){let{maxSpeed:o,linearity:c,deceleration:u}=i,h=ve(e*c/(t/1e3),-o,o),p=Math.abs(h)/(u*c);return{easing:i.easing,duration:1e3*p,amount:h*(p/2)}}class $s extends qt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,o,c={}){let u=sp(i.getCanvasContainer(),o);super(t,ge({point:u,lngLat:i.unproject(u),originalEvent:o},c)),this._defaultPrevented=!1,this.target=i}}class lv extends qt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,o){let c=t==="touchend"?o.changedTouches:o.touches,u=r_(i.getCanvasContainer(),c),h=u.map(f=>i.unproject(f)),p=u.reduce((f,g,v,y)=>f.add(g.div(y.length)),new Q(0,0));super(t,{points:u,point:p,lngLats:h,lngLat:i.unproject(p),originalEvent:o}),this._defaultPrevented=!1}}class $W extends qt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,o){super(t,{originalEvent:o}),this._defaultPrevented=!1}}class YW{constructor(t,i){this._map=t,this._clickTolerance=i.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new $W(t.type,this._map,t))}mousedown(t,i){return this._mousedownPos=i,this._firePreventable(new $s(t.type,this._map,t))}mouseup(t){this._map.fire(new $s(t.type,this._map,t))}preclick(t){let i=ge({},t);i.type="preclick",this._map.fire(new $s(i.type,this._map,i))}click(t,i){this._mousedownPos&&this._mousedownPos.dist(i)>=this._clickTolerance||(this.preclick(t),this._map.fire(new $s(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new $s(t.type,this._map,t))}mouseover(t){this._map.fire(new $s(t.type,this._map,t))}mouseout(t){this._map.fire(new $s(t.type,this._map,t))}touchstart(t){return this._firePreventable(new lv(t.type,this._map,t))}touchmove(t){this._map.fire(new lv(t.type,this._map,t))}touchend(t){this._map.fire(new lv(t.type,this._map,t))}touchcancel(t){this._map.fire(new lv(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ZW{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new $s(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new $s("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new $s(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class XW{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=i.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,i){this.isEnabled()&&t.shiftKey&&t.button===0&&(OT(),this._startPos=this._lastPos=i,this._active=!0)}mousemoveWindow(t,i){if(!this._active)return;let o=i,c=this._startPos,u=this._lastPos;if(!c||!u||u.equals(o)||!this._box&&o.dist(c)<this._clickTolerance)return;this._lastPos=o,this._box||(this._box=Cn("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));let h=Math.min(c.x,o.x),p=Math.max(c.x,o.x),f=Math.min(c.y,o.y),g=Math.max(c.y,o.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${h}px,${f}px)`,this._box.style.width=p-h+"px",this._box.style.height=g-f+"px")})}mouseupWindow(t,i){if(!this._active)return;let o=this._startPos,c=i;if(o&&t.button===0){if(this.reset(),Gx(),o.x!==c.x||o.y!==c.y)return this._map.fire(new qt("boxzoomend",{originalEvent:t})),{cameraAnimation:u=>u.fitScreenCoordinates(o,c,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),FT(),delete this._startPos,delete this._lastPos}_fireEvent(t,i){return this._map.fire(new qt(t,{originalEvent:i}))}}function dS(e,t){let i={};for(let o=0;o<e.length;o++)i[e[o].identifier]=t[o];return i}class KW{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,i,o){(this.centroid||o.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),o.length===this.numTouches&&(this.centroid=function(c){let u=new Q(0,0);for(let h of c)u._add(h);return u.div(c.length)}(i),this.touches=dS(o,i)))}touchmove(t,i,o){if(this.aborted||!this.centroid)return;let c=dS(o,i);for(let u in this.touches){let h=c[u];(!h||h.dist(this.touches[u])>30)&&(this.aborted=!0)}}touchend(t,i,o){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),o.length===0){let c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class uS{constructor(t){this.singleTap=new KW(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,i,o){this.singleTap.touchstart(t,i,o)}touchmove(t,i,o){this.singleTap.touchmove(t,i,o)}touchend(t,i,o){let c=this.singleTap.touchend(t,i,o);if(c){let u=t.timeStamp-this.lastTime<500,h=!this.lastTap||this.lastTap.dist(c)<30;if(u&&h||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class QW{constructor(){this._zoomIn=new uS({numTouches:1,numTaps:2}),this._zoomOut=new uS({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,i,o){this._zoomIn.touchstart(t,i,o),this._zoomOut.touchstart(t,i,o)}touchmove(t,i,o){this._zoomIn.touchmove(t,i,o),this._zoomOut.touchmove(t,i,o)}touchend(t,i,o){let c=this._zoomIn.touchend(t,i,o),u=this._zoomOut.touchend(t,i,o);return c?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:h=>h.easeTo({duration:300,zoom:h.getZoom()+1,around:h.unproject(c)},{originalEvent:t})}):u?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:h=>h.easeTo({duration:300,zoom:h.getZoom()-1,around:h.unproject(u)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let JW={0:1,2:2};class hS{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,i){return!1}_move(t,i){return{}}mousedown(t,i){if(this._lastPoint)return;let o=LT(t);this._correctButton(t,o)&&(this._lastPoint=i,this._eventButton=o)}mousemoveWindow(t,i){let o=this._lastPoint;if(o){if(t.preventDefault(),this._eventButton!=null&&function(c,u){let h=JW[u];return c.buttons===void 0||(c.buttons&h)!==h}(t,this._eventButton))this.reset();else if(this._moved||!(i.dist(o)<this._clickTolerance))return this._moved=!0,this._lastPoint=i,this._move(o,i)}}mouseupWindow(t){this._lastPoint&&LT(t)===this._eventButton&&(this._moved&&Gx(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class t$ extends hS{mousedown(t,i){super.mousedown(t,i),this._lastPoint&&(this._active=!0)}_correctButton(t,i){return i===0&&!t.ctrlKey}_move(t,i){return{around:i,panDelta:i.sub(t)}}}class sF extends hS{_correctButton(t,i){return i===0&&t.ctrlKey||i===2}_move(t,i){let o=.8*(i.x-t.x);if(o)return this._active=!0,{bearingDelta:o}}contextmenu(t){t.preventDefault()}}class aF extends hS{_correctButton(t,i){return i===0&&t.ctrlKey||i===2}_move(t,i){let o=-.5*(i.y-t.y);if(o)return this._active=!0,{pitchDelta:o}}contextmenu(t){t.preventDefault()}}class e${constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),_o(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new Q(0,0)}touchstart(t,i,o){return this._calculateTransform(t,i,o)}touchmove(t,i,o){if(this._active&&!(o.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(o.length===1&&!Ke())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,i,o)}}touchend(t,i,o){this._calculateTransform(t,i,o),this._active&&o.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,i,o){o.length>0&&(this._active=!0);let c=dS(o,i),u=new Q(0,0),h=new Q(0,0),p=0;for(let g in c){let v=c[g],y=this._touches[g];y&&(u._add(v),h._add(v.sub(y)),p++,c[g]=v)}if(this._touches=c,p<this._minTouches||!h.mag())return;let f=h.div(p);return this._sum._add(f),this._sum.mag()<this._clickTolerance?void 0:{around:u.div(p),panDelta:f}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Cn("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class mS{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,i,o){return{}}touchstart(t,i,o){this._firstTwoTouches||o.length<2||(this._firstTwoTouches=[o[0].identifier,o[1].identifier],this._start([i[0],i[1]]))}touchmove(t,i,o){let c=this._firstTwoTouches;if(!c)return;t.preventDefault();let[u,h]=c,p=cv(o,i,u),f=cv(o,i,h);if(!p||!f)return;let g=this._aroundCenter?null:p.add(f).div(2);return this._move([p,f],g,t)}touchend(t,i,o){if(!this._firstTwoTouches)return;let[c,u]=this._firstTwoTouches,h=cv(o,i,c),p=cv(o,i,u);h&&p||(this._active&&Gx(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function cv(e,t,i){for(let o=0;o<e.length;o++)if(e[o].identifier===i)return t[o]}function lF(e,t){return Math.log(e/t)/Math.LN2}class i$ extends mS{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,i){let o=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(lF(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:lF(this._distance,o),pinchAround:i}}}function cF(e,t){return 180*e.angleWith(t)/Math.PI}class n$ extends mS{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,i){let o=this._vector;if(this._vector=t[0].sub(t[1]),o&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:cF(this._vector,o),pinchAround:i}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());let i=25/(Math.PI*this._minDiameter)*360,o=this._startVector;if(!o)return!1;let c=cF(t,o);return Math.abs(c)<i}}function pS(e){return Math.abs(e.y)>Math.abs(e.x)}class r$ extends mS{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,pS(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,i,o){let c=this._lastPoints;if(!c)return;let u=t[0].sub(c[0]),h=t[1].sub(c[1]);return this._map._cooperativeGestures&&!Ke()&&o.touches.length<3||(this._valid=this.gestureBeginsVertically(u,h,o.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(u.y+h.y)/2*-.5})}gestureBeginsVertically(t,i,o){if(this._valid!==void 0)return this._valid;let c=t.mag()>=2,u=i.mag()>=2;if(!c&&!u)return;if(!c||!u)return this._firstMove==null&&(this._firstMove=o),o-this._firstMove<100&&void 0;let h=t.y>0==i.y>0;return pS(t)&&pS(i)&&h}}let o$={panStep:100,bearingStep:15,pitchStep:10};class s${constructor(){let t=o$;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let i=0,o=0,c=0,u=0,h=0;switch(t.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:t.shiftKey?o=-1:(t.preventDefault(),u=-1);break;case 39:t.shiftKey?o=1:(t.preventDefault(),u=1);break;case 38:t.shiftKey?c=1:(t.preventDefault(),h=-1);break;case 40:t.shiftKey?c=-1:(t.preventDefault(),h=1);break;default:return}return this._rotationDisabled&&(o=0,c=0),{cameraAnimation:p=>{let f=p.getZoom();p.easeTo({duration:300,easeId:"keyboardHandler",easing:a$,zoom:i?Math.round(f)+i*(t.shiftKey?2:1):f,bearing:p.getBearing()+o*this._bearingStep,pitch:p.getPitch()+c*this._pitchStep,offset:[-u*this._panStep,-h*this._panStep],center:p.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function a$(e){return e*(2-e)}let dF=4.000244140625;class l${constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._handler=i,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,_o(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||Ke()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let i=t.deltaMode===m.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY,o=ni.now(),c=o-(this._lastWheelEventTime||0);this._lastWheelEventTime=o,i!==0&&i%dF==0?this._type="wheel":i!==0&&Math.abs(i)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(c*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),t.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=t,this._delta-=i,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let i=sp(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:i,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let i=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){let g=this._type==="wheel"&&Math.abs(this._delta)>dF?this._wheelZoomRate:this._defaultZoomRate,v=2/(1+Math.exp(-Math.abs(this._delta*g)));this._delta<0&&v!==0&&(v=1/v);let y=i(),b=Math.pow(2,y),x=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):b;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(x*v))),this._type==="wheel"&&(this._startZoom=y,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let o=typeof this._targetZoom=="number"?this._targetZoom:i(),c=this._startZoom,u=this._easing,h,p=!1;if(this._type==="wheel"&&c&&u){let g=Math.min((ni.now()-this._lastWheelEventTime)/200,1);h=$e(c,o,u(g)),g<1?this._frameId||(this._frameId=!0):p=!0}else h=o,p=!0;this._active=!0,p&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let f=h-i();return f*this._lastDelta<0&&(f=0),{noInertia:!0,needsRenderFrame:!p,zoomDelta:f,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let i=fr;if(this._prevEase){let o=this._prevEase,c=(ni.now()-o.start)/o.duration,u=o.easing(c+.01)-o.easing(c),h=.27/Math.sqrt(u*u+1e-4)*.01;i=fn(h,Math.sqrt(.0729-h*h),.25,1)}return this._prevEase={start:ni.now(),duration:t,easing:i},i}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Cn("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(m.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class c${constructor(t,i){this._clickZoom=t,this._tapZoom=i}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class d${constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,i){return t.preventDefault(),{cameraAnimation:o=>{o.easeTo({duration:300,zoom:o.getZoom()+(t.shiftKey?-1:1),around:o.unproject(i)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class u${constructor(){this._tap=new uS({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,i,o){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?o.length>0&&(this._swipePoint=i[0],this._swipeTouch=o[0].identifier):this._tap.touchstart(t,i,o))}touchmove(t,i,o){if(this._tapTime){if(this._swipePoint){if(o[0].identifier!==this._swipeTouch)return;let c=i[0],u=c.y-this._swipePoint.y;return this._swipePoint=c,t.preventDefault(),this._active=!0,{zoomDelta:u/128}}}else this._tap.touchmove(t,i,o)}touchend(t,i,o){this._tapTime?this._swipePoint&&o.length===0&&this.reset():this._tap.touchend(t,i,o)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class h${constructor(t,i,o){this._el=t,this._mousePan=i,this._touchPan=o}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class m${constructor(t,i,o){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=i,this._mousePitch=o}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class p${constructor(t,i,o,c){this._el=t,this._touchZoom=i,this._touchRotate=o,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let dv=e=>e.zoom||e.drag||e.pitch||e.rotate;class f$ extends qt{}class g${constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,i){let o=J.sub([],i,t);this.radius=J.length(o[2]<0?J.div([],o,this.constants):[o[0],o[1],0])}projectRay(t){J.div(t,t,this.constants),J.normalize(t,t),J.mul(t,t,this.constants);let i=J.scale([],t,this.radius);if(i[2]>0){let o=J.scale([],[0,0,1],J.dot(i,[0,0,1])),c=J.scale([],J.normalize([],[i[0],i[1],0]),this.radius),u=J.add([],i,J.scale([],J.sub([],J.add([],c,o),i),2));i[0]=u[0],i[1]=u[1]}return i}}function uv(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class _${constructor(t,i){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new WW(t),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new g$,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(i),_o(["handleEvent","handleWindowEvent"],this);let o=this._el;this._listeners=[[o,"touchstart",{passive:!0}],[o,"touchmove",{passive:!1}],[o,"touchend",void 0],[o,"touchcancel",void 0],[o,"mousedown",void 0],[o,"mousemove",void 0],[o,"mouseup",void 0],[m.document,"mousemove",{capture:!0}],[m.document,"mouseup",void 0],[o,"mouseover",void 0],[o,"mouseout",void 0],[o,"dblclick",void 0],[o,"click",void 0],[o,"keydown",{capture:!1}],[o,"keyup",void 0],[o,"wheel",{passive:!1}],[o,"contextmenu",void 0],[m,"blur",void 0]];for(let[c,u,h]of this._listeners)c.addEventListener(u,c===m.document?this.handleWindowEvent:this.handleEvent,h)}destroy(){for(let[t,i,o]of this._listeners)t.removeEventListener(i,t===m.document?this.handleWindowEvent:this.handleEvent,o)}_addDefaultHandlers(t){let i=this._map,o=i.getCanvasContainer();this._add("mapEvent",new YW(i,t));let c=i.boxZoom=new XW(i,t);this._add("boxZoom",c);let u=new QW,h=new d$;i.doubleClickZoom=new c$(h,u),this._add("tapZoom",u),this._add("clickZoom",h);let p=new u$;this._add("tapDragZoom",p);let f=i.touchPitch=new r$(i);this._add("touchPitch",f);let g=new sF(t),v=new aF(t);i.dragRotate=new m$(t,g,v),this._add("mouseRotate",g,["mousePitch"]),this._add("mousePitch",v,["mouseRotate"]);let y=new t$(t),b=new e$(i,t);i.dragPan=new h$(o,y,b),this._add("mousePan",y),this._add("touchPan",b,["touchZoom","touchRotate"]);let x=new n$,C=new i$;i.touchZoomRotate=new p$(o,C,x,p),this._add("touchRotate",x,["touchPan","touchZoom"]),this._add("touchZoom",C,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ZW(i));let E=i.scrollZoom=new l$(i,this);this._add("scrollZoom",E,["mousePan"]);let M=i.keyboard=new s$;this._add("keyboard",M);for(let D of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[D]&&i[D].enable(t[D])}_add(t,i,o){this._handlers.push({handlerName:t,handler:i,allowed:o}),this._handlersById[t]=i}stop(t){if(!this._updatingCamera){for(let{handler:i}of this._handlers)i.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!dv(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,i,o){for(let c in t)if(c!==o&&(!i||i.indexOf(c)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){let i=[];for(let o of t)this._el.contains(o.target)&&i.push(o);return i}handleEvent(t,i){this._updatingCamera=!0;let o=t.type==="renderFrame",c=o?void 0:t,u={needsRenderFrame:!1},h={},p={},f=t.touches?this._getMapTouches(t.touches):void 0,g=f?r_(this._el,f):o?void 0:sp(this._el,t);for(let{handlerName:b,handler:x,allowed:C}of this._handlers){if(!x.isEnabled())continue;let E;this._blockedByActive(p,C,b)?x.reset():x[i||t.type]&&(E=x[i||t.type](t,g,f),this.mergeHandlerResult(u,h,E,b,c),E&&E.needsRenderFrame&&this._triggerRenderFrame()),(E||x.isActive())&&(p[b]=x)}let v={};for(let b in this._previousActiveHandlers)p[b]||(v[b]=c);this._previousActiveHandlers=p,(Object.keys(v).length||uv(u))&&(this._changes.push([u,h,v]),this._triggerRenderFrame()),(Object.keys(p).length||uv(u))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:y}=u;y&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],y(this._map))}mergeHandlerResult(t,i,o,c,u){if(!o)return;ge(t,o);let h={handlerName:c,originalEvent:o.originalEvent||u};o.zoomDelta!==void 0&&(i.zoom=h),o.panDelta!==void 0&&(i.drag=h),o.pitchDelta!==void 0&&(i.pitch=h),o.bearingDelta!==void 0&&(i.rotate=h)}_applyChanges(){let t={},i={},o={};for(let[c,u,h]of this._changes)c.panDelta&&(t.panDelta=(t.panDelta||new Q(0,0))._add(c.panDelta)),c.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+c.pitchDelta),c.around!==void 0&&(t.around=c.around),c.aroundCoord!==void 0&&(t.aroundCoord=c.aroundCoord),c.pinchAround!==void 0&&(t.pinchAround=c.pinchAround),c.noInertia&&(t.noInertia=c.noInertia),ge(i,u),ge(o,h);this._updateMapTransform(t,i,o),this._changes=[]}_updateMapTransform(t,i,o){let c=this._map,u=c.transform,h=I=>[I.x,I.y,I.z];if((I=>{let P=this._eventsInProgress.drag;return P&&!this._handlersById[P.handlerName].isActive()})()&&!uv(t)){let I=u.zoom;u.cameraElevationReference="sea",this._originalZoom!=null&&u._orthographicProjectionAtLowPitch&&u.projection.name!=="globe"&&u.pitch===0?(u.cameraElevationReference="ground",u.zoom=this._originalZoom):(u.recenterOnTerrain(),u.cameraElevationReference="ground"),I!==u.zoom&&this._map._update(!0)}if(u._isCameraConstrained&&c._stop(!0),!uv(t))return void this._fireEvents(i,o,!0);let{panDelta:p,zoomDelta:f,bearingDelta:g,pitchDelta:v,around:y,aroundCoord:b,pinchAround:x}=t;u._isCameraConstrained&&(f>0&&(f=0),u._isCameraConstrained=!1),x!==void 0&&(y=x),(f||(I=>i[I]&&!this._eventsInProgress[I])("drag"))&&y&&(this._dragOrigin=h(u.pointCoordinate3D(y)),this._originalZoom=u.zoom,this._trackingEllipsoid.setup(u._camera.position,this._dragOrigin)),u.cameraElevationReference="sea",c._stop(!0),y=y||c.transform.centerPoint,g&&(u.bearing+=g),v&&(u.pitch+=v),u._updateCameraState();let C=[0,0,0];if(p)if(u.projection.name==="mercator"){let I=this._trackingEllipsoid.projectRay(u.screenPointToMercatorRay(y).dir),P=this._trackingEllipsoid.projectRay(u.screenPointToMercatorRay(y.sub(p)).dir);C[0]=P[0]-I[0],C[1]=P[1]-I[1]}else{let I=u.pointCoordinate(y);if(u.projection.name==="globe"){p=p.rotate(-u.angle);let P=u._pixelsPerMercatorPixel/u.worldSize;C[0]=-p.x*qw(Wr(I.y))*P,C[1]=-p.y*qw(u.center.lat)*P}else{let P=u.pointCoordinate(y.sub(p));I&&P&&(C[0]=P.x-I.x,C[1]=P.y-I.y)}}let E=u.zoom,M=[0,0,0];if(f){let I=h(b||u.pointCoordinate3D(y)),P={dir:J.normalize([],J.sub([],I,u._camera.position))};if(P.dir[2]<0){let O=u.zoomDeltaToMovement(I,f);J.scale(M,P.dir,O)}}let D=J.add(C,C,M);u._translateCameraConstrained(D),f&&Math.abs(u.zoom-E)>1e-4&&u.recenterOnTerrain(),u.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(i,o,!0)}_fireEvents(t,i,o){let c=dv(this._eventsInProgress),u=dv(t),h={};for(let v in t){let{originalEvent:y}=t[v];this._eventsInProgress[v]||(h[`${v}start`]=y),this._eventsInProgress[v]=t[v]}!c&&u&&this._fireEvent("movestart",u.originalEvent);for(let v in h)this._fireEvent(v,h[v]);u&&this._fireEvent("move",u.originalEvent);for(let v in t){let{originalEvent:y}=t[v];this._fireEvent(v,y)}let p={},f;for(let v in this._eventsInProgress){let{handlerName:y,originalEvent:b}=this._eventsInProgress[v];this._handlersById[y].isActive()||(delete this._eventsInProgress[v],f=i[y]||b,p[`${v}end`]=f)}for(let v in p)this._fireEvent(v,p[v]);let g=dv(this._eventsInProgress);if(o&&(c||u)&&!g){this._updatingCamera=!0;let v=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),y=b=>b!==0&&-this._bearingSnap<b&&b<this._bearingSnap;v?(y(v.bearing||this._map.getBearing())&&(v.bearing=0),this._map.easeTo(v,{originalEvent:f})):(this._map.fire(new qt("moveend",{originalEvent:f})),y(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,i){this._map.fire(new qt(t,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new f$("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let uF="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class v$ extends Hr{constructor(t,i){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=i.bearingSnap,this._respectPrefersReducedMotion=i.respectPrefersReducedMotion!==!1,_o(["_renderFrameCallback"],this)}getCenter(){return new Ye(this.transform.center.lng,this.transform.center.lat)}setCenter(t,i){return this.jumpTo({center:t},i)}panBy(t,i,o){return t=Q.convert(t).mult(-1),this.panTo(this.transform.center,ge({offset:t},i),o)}panTo(t,i,o){return this.easeTo(ge({center:t},i),o)}getZoom(){return this.transform.zoom}setZoom(t,i){return this.jumpTo({zoom:t},i),this}zoomTo(t,i,o){return this.easeTo(ge({zoom:t},i),o)}zoomIn(t,i){return this.zoomTo(this.getZoom()+1,t,i),this}zoomOut(t,i){return this.zoomTo(this.getZoom()-1,t,i),this}getBearing(){return this.transform.bearing}setBearing(t,i){return this.jumpTo({bearing:t},i),this}getPadding(){return this.transform.padding}setPadding(t,i){return this.jumpTo({padding:t},i),this}rotateTo(t,i,o){return this.easeTo(ge({bearing:t},i),o)}resetNorth(t,i){return this.rotateTo(0,ge({duration:1e3},t),i),this}resetNorthPitch(t,i){return this.easeTo(ge({bearing:0,pitch:0,duration:1e3},t),i),this}snapToNorth(t,i){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,i):this}getPitch(){return this.transform.pitch}setPitch(t,i){return this.jumpTo({pitch:t},i),this}cameraForBounds(t,i){t=Cs.convert(t);let o=i&&i.bearing||0,c=i&&i.pitch||0,u=t.getNorthWest(),h=t.getSouthEast();return this._cameraForBounds(this.transform,u,h,o,c,i)}_extendCameraOptions(t){let i={top:0,bottom:0,right:0,left:0};if(typeof(t=ge({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=="number"){let o=t.padding;t.padding={top:o,bottom:o,right:o,left:o}}return t.padding=ge(i,t.padding),t}_minimumAABBFrustumDistance(t,i){let o=i.max[0]-i.min[0],c=i.max[1]-i.min[1];return o/c>t.aspect?o/(2*Math.tan(.5*t.fovX)*t.aspect):c/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,i,o,c,u,h){let p=t.clone(),f=this._extendCameraOptions(h);p.bearing=c,p.pitch=u;let g=Ye.convert(i),v=Ye.convert(o),y=.5*(g.lat+v.lat),b=.5*(g.lng+v.lng),x=us(y,b),C=J.normalize([],x),E=J.normalize([],J.cross([],C,[0,1,0])),M=J.cross([],E,C),D=[E[0],E[1],E[2],0,M[0],M[1],M[2],0,C[0],C[1],C[2],0,0,0,0,1],I=[x,us(g.lat,g.lng),us(v.lat,g.lng),us(v.lat,v.lng),us(g.lat,v.lng),us(y,g.lng),us(y,v.lng),us(g.lat,b),us(v.lat,b)],P=Ln.fromPoints(I.map(ot=>[J.dot(E,ot),J.dot(M,ot),J.dot(C,ot)])),O=J.transformMat4([],P.center,D);J.squaredLength(O)===0&&J.set(O,0,0,1),J.normalize(O,O),J.scale(O,O,ts),p.center=function([ot,_t,bt]){let yt=Math.hypot(ot,_t,bt),Ct=Math.atan2(ot,bt),St=.5*Math.PI-Math.acos(-_t/yt);return new Ye(ii(Ct),ii(St))}(O);let R=p.getWorldToCameraMatrix(),F=ft.invert(new Float64Array(16),R);P=Ln.applyTransform(P,ft.multiply([],R,D)),J.transformMat4(O,O,R);let z=.5*(P.max[2]-P.min[2]),j=this._minimumAABBFrustumDistance(p,P),U=J.scale([],[0,0,1],z),G=J.add(U,O,U),$=j+(p.pitch===0?0:J.distance(O,G)),Y=p.globeCenterInViewSpace,tt=J.sub([],O,[Y[0],Y[1],Y[2]]);J.normalize(tt,tt),J.scale(tt,tt,$);let W=J.add([],O,tt);J.transformMat4(W,W,F);let rt=bh/ts,st=J.length(W),pt=_n(Math.max(st*rt-bh,Number.EPSILON),0),nt=Math.min(p.zoomFromMercatorZAdjusted(pt),f.maxZoom);return nt>.5*(Op+Xc)?(p.setProjection({name:"mercator"}),p.zoom=nt,this._cameraForBounds(p,i,o,c,u,h)):{center:p.center,zoom:nt,bearing:c,pitch:u}}queryTerrainElevation(t,i){let o=this.transform.elevation;return o?(i=ge({},{exaggerated:!0},i),o.getAtPoint(Oi.fromLngLat(t),null,i.exaggerated)):null}_cameraForBounds(t,i,o,c,u,h){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,i,o,c,u,h);let p=t.clone(),f=this._extendCameraOptions(h),g=p.padding;p.bearing=c,p.pitch=u;let v=Ye.convert(i),y=Ye.convert(o),b=new Ye(v.lng,y.lat),x=new Ye(y.lng,v.lat),C=p.project(v),E=p.project(y),M=this.queryTerrainElevation(v),D=this.queryTerrainElevation(y),I=this.queryTerrainElevation(b),P=this.queryTerrainElevation(x),O=[[C.x,C.y,Math.min(M||0,D||0,I||0,P||0)],[E.x,E.y,Math.max(M||0,D||0,I||0,P||0)]],R=Ln.fromPoints(O),F=p.getWorldToCameraMatrix(),z=ft.invert(new Float64Array(16),F);R=Ln.applyTransform(R,F);let j=J.sub([],R.max,R.min),U=g.left||0,G=g.right||0,$=g.bottom||0,Y=g.top||0,{left:tt,right:W,top:rt,bottom:st}=f.padding,pt=.5*(U+G),nt=.5*(Y+$),ot=Math.min(p.scaleZoom(p.scale*Math.min((p.width-(U+G+tt+W))/j[0],(p.height-($+Y+st+rt))/j[1])),f.maxZoom),_t=p.scale/p.zoomScale(ot);R=new Ln([R.min[0]-(tt+pt)*_t,R.min[1]-(st+nt)*_t,R.min[2]],[R.max[0]+(W+pt)*_t,R.max[1]+(rt+nt)*_t,R.max[2]]);let bt=.5*j[2],yt=this._minimumAABBFrustumDistance(p,R),Ct=[0,0,1,0];un.transformMat4(Ct,Ct,F),un.normalize(Ct,Ct);let St=J.scale([],Ct,yt+bt),Tt=J.add([],R.center,St),xt=(typeof f.offset.x=="number"&&typeof f.offset.y=="number"?new Q(f.offset.x,f.offset.y):Q.convert(f.offset)).rotate(-fe(c));R.center[0]-=xt.x*_t,R.center[1]+=xt.y*_t,J.transformMat4(R.center,R.center,z),J.transformMat4(Tt,Tt,z);let Ft=[R.center[0],R.center[1],Tt[2]*p.pixelsPerMeter];J.scale(Ft,Ft,1/p.worldSize);let Qt=Ss(Ft[0]),Jt=Wr(Ft[1]),le=Math.min(p._zoomFromMercatorZ(Ft[2]),f.maxZoom),me=new Ye(Qt,Jt);return p.mercatorFromTransition&&le<.5*(Op+Xc)?(p.setProjection({name:"globe"}),p.zoom=le,this._cameraForBounds(p,i,o,c,u,h)):{center:me,zoom:le,bearing:c,pitch:u}}fitBounds(t,i,o){let c=this.cameraForBounds(t,i);return this._fitInternal(c,i,o)}fitScreenCoordinates(t,i,o,c,u){let h=Q.convert(t),p=Q.convert(i),f=new Q(Math.min(h.x,p.x),Math.min(h.y,p.y)),g=new Q(Math.max(h.x,p.x),Math.max(h.y,p.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(h,p))return this;let v=this.transform.pointLocation3D(f),y=this.transform.pointLocation3D(g),b=this.transform.pointLocation3D(new Q(f.x,g.y)),x=this.transform.pointLocation3D(new Q(g.x,f.y)),C=[Math.min(v.lng,y.lng,b.lng,x.lng),Math.min(v.lat,y.lat,b.lat,x.lat)],E=[Math.max(v.lng,y.lng,b.lng,x.lng),Math.max(v.lat,y.lat,b.lat,x.lat)],M=c&&c.pitch?c.pitch:this.getPitch(),D=this._cameraForBounds(this.transform,C,E,o,M,c);return this._fitInternal(D,c,u)}_fitInternal(t,i,o){return t?(delete(i=ge(t,i)).padding,i.linear?this.easeTo(i,o):this.flyTo(i,o)):this}jumpTo(t,i){this.stop();let o=t.preloadOnly?this.transform.clone():this.transform,c=!1,u=!1,h=!1;return"zoom"in t&&o.zoom!==+t.zoom&&(c=!0,o.zoom=+t.zoom),t.center!==void 0&&(o.center=Ye.convert(t.center)),"bearing"in t&&o.bearing!==+t.bearing&&(u=!0,o.bearing=+t.bearing),"pitch"in t&&o.pitch!==+t.pitch&&(h=!0,o.pitch=+t.pitch),t.padding==null||o.isPaddingEqual(t.padding)||(o.padding=t.padding),t.preloadOnly?(this._preloadTiles(o),this):(this.fire(new qt("movestart",i)).fire(new qt("move",i)),c&&this.fire(new qt("zoomstart",i)).fire(new qt("zoom",i)).fire(new qt("zoomend",i)),u&&this.fire(new qt("rotatestart",i)).fire(new qt("rotate",i)).fire(new qt("rotateend",i)),h&&this.fire(new qt("pitchstart",i)).fire(new qt("pitch",i)).fire(new qt("pitchend",i)),this.fire(new qt("moveend",i)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||lt(uF),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,i){let o=this.transform;if(!o.projection.supportsFreeCamera)return lt(uF),this;this.stop();let c=o.zoom,u=o.pitch,h=o.bearing;o.setFreeCameraOptions(t);let p=c!==o.zoom,f=u!==o.pitch,g=h!==o.bearing;return this.fire(new qt("movestart",i)).fire(new qt("move",i)),p&&this.fire(new qt("zoomstart",i)).fire(new qt("zoom",i)).fire(new qt("zoomend",i)),g&&this.fire(new qt("rotatestart",i)).fire(new qt("rotate",i)).fire(new qt("rotateend",i)),f&&this.fire(new qt("pitchstart",i)).fire(new qt("pitch",i)).fire(new qt("pitchend",i)),this.fire(new qt("moveend",i)),this}easeTo(t,i){this._stop(!1,t.easeId),((t=ge({offset:[0,0],duration:500,easing:fr},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);let o=this.transform,c=this.getZoom(),u=this.getBearing(),h=this.getPitch(),p=this.getPadding(),f="zoom"in t?+t.zoom:c,g="bearing"in t?this._normalizeBearing(t.bearing,u):u,v="pitch"in t?+t.pitch:h,y="padding"in t?t.padding:o.padding,b=Q.convert(t.offset),x,C,E;if(o.projection.name==="globe"){let U=Oi.fromLngLat(o.center),G=b.rotate(-o.angle);U.x+=G.x/o.worldSize,U.y+=G.y/o.worldSize;let $=U.toLngLat(),Y=Ye.convert(t.center||$);this._normalizeCenter(Y),x=o.centerPoint.add(G),C=new Q(U.x,U.y).mult(o.worldSize),E=new Q(to(Y.lng),lo(Y.lat)).mult(o.worldSize).sub(C)}else{x=o.centerPoint.add(b);let U=o.pointLocation(x),G=Ye.convert(t.center||U);this._normalizeCenter(G),C=o.project(U),E=o.project(G).sub(C)}let M=o.zoomScale(f-c),D,I;t.around&&(D=Ye.convert(t.around),I=o.locationPoint(D));let P=this._zooming||f!==c,O=this._rotating||u!==g,R=this._pitching||v!==h,F=!o.isPaddingEqual(y),z=U=>G=>{if(P&&(U.zoom=$e(c,f,G)),O&&(U.bearing=$e(u,g,G)),R&&(U.pitch=$e(h,v,G)),F&&(U.interpolatePadding(p,y,G),x=U.centerPoint.add(b)),D)U.setLocationAtPoint(D,I);else{let $=U.zoomScale(U.zoom-c),Y=f>c?Math.min(2,M):Math.max(.5,M),tt=Math.pow(Y,1-G),W=U.unproject(C.add(E.mult(G*tt)).mult($));U.setLocationAtPoint(U.renderWorldCopies?W.wrap():W,x)}return t.preloadOnly||this._fireMoveEvents(i),U};if(t.preloadOnly){let U=this._emulate(z,t.duration,o);return this._preloadTiles(U),this}let j={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=P,this._rotating=O,this._pitching=R,this._padding=F,this._easeId=t.easeId,this._prepareEase(i,t.noMoveStart,j),this._ease(z(o),U=>{o.cameraElevationReference==="sea"&&o.recenterOnTerrain(),this._afterEase(i,U)},t),this}_prepareEase(t,i,o={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),i||o.moving||this.fire(new qt("movestart",t)),this._zooming&&!o.zooming&&this.fire(new qt("zoomstart",t)),this._rotating&&!o.rotating&&this.fire(new qt("rotatestart",t)),this._pitching&&!o.pitching&&this.fire(new qt("pitchstart",t))}_fireMoveEvents(t){this.fire(new qt("move",t)),this._zooming&&this.fire(new qt("zoom",t)),this._rotating&&this.fire(new qt("rotate",t)),this._pitching&&this.fire(new qt("pitch",t))}_afterEase(t,i){if(this._easeId&&i&&this._easeId===i)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let o=this._zooming,c=this._rotating,u=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,o&&this.fire(new qt("zoomend",t)),c&&this.fire(new qt("rotateend",t)),u&&this.fire(new qt("pitchend",t)),this.fire(new qt("moveend",t))}flyTo(t,i){if(this._prefersReducedMotion(t)){let ot=Ho(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ot,i)}this.stop(),t=ge({offset:[0,0],speed:1.2,curve:1.42,easing:fr},t);let o=this.transform,c=this.getZoom(),u=this.getBearing(),h=this.getPitch(),p=this.getPadding(),f="zoom"in t?ve(+t.zoom,o.minZoom,o.maxZoom):c,g="bearing"in t?this._normalizeBearing(t.bearing,u):u,v="pitch"in t?+t.pitch:h,y="padding"in t?t.padding:o.padding,b=o.zoomScale(f-c),x=Q.convert(t.offset),C=o.centerPoint.add(x),E=o.pointLocation(C),M=Ye.convert(t.center||E);this._normalizeCenter(M);let D=o.project(E),I=o.project(M).sub(D),P=t.curve,O=Math.max(o.width,o.height),R=O/b,F=I.mag();if("minZoom"in t){let ot=ve(Math.min(t.minZoom,c,f),o.minZoom,o.maxZoom),_t=O/o.zoomScale(ot-c);P=Math.sqrt(_t/F*2)}let z=P*P;function j(ot){let _t=(R*R-O*O+(ot?-1:1)*z*z*F*F)/(2*(ot?R:O)*z*F);return Math.log(Math.sqrt(_t*_t+1)-_t)}function U(ot){return(Math.exp(ot)-Math.exp(-ot))/2}function G(ot){return(Math.exp(ot)+Math.exp(-ot))/2}let $=j(0),Y=function(ot){return G($)/G($+P*ot)},tt=function(ot){return O*((G($)*(U(_t=$+P*ot)/G(_t))-U($))/z)/F;var _t},W=(j(1)-$)/P;if(Math.abs(F)<1e-6||!isFinite(W)){if(Math.abs(O-R)<1e-6)return this.easeTo(t,i);let ot=R<O?-1:1;W=Math.abs(Math.log(R/O))/P,tt=function(){return 0},Y=function(_t){return Math.exp(ot*P*_t)}}t.duration="duration"in t?+t.duration:1e3*W/("screenSpeed"in t?+t.screenSpeed/P:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);let rt=u!==g,st=v!==h,pt=!o.isPaddingEqual(y),nt=ot=>_t=>{let bt=_t*W,yt=1/Y(bt);ot.zoom=_t===1?f:c+ot.scaleZoom(yt),rt&&(ot.bearing=$e(u,g,_t)),st&&(ot.pitch=$e(h,v,_t)),pt&&(ot.interpolatePadding(p,y,_t),C=ot.centerPoint.add(x));let Ct=_t===1?M:ot.unproject(D.add(I.mult(tt(bt))).mult(yt));return ot.setLocationAtPoint(ot.renderWorldCopies?Ct.wrap():Ct,C),ot._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(i),ot};if(t.preloadOnly){let ot=this._emulate(nt,t.duration,o);return this._preloadTiles(ot),this}return this._zooming=!0,this._rotating=rt,this._pitching=st,this._padding=pt,this._prepareEase(i,!1),this._ease(nt(o),()=>this._afterEase(i),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,i){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let o=this._onEaseEnd;this._onEaseEnd=void 0,o.call(this,i)}if(!t){let o=this.handlers;o&&o.stop(!1)}return this}_ease(t,i,o){o.animate===!1||o.duration===0?(t(1),i()):(this._easeStart=ni.now(),this._easeOptions=o,this._onEaseFrame=t,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let t=Math.min((ni.now()-this._easeStart)/this._easeOptions.duration,1),i=this._onEaseFrame;i&&i(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,i){t=os(t,-180,180);let o=Math.abs(t-i);return Math.abs(t-360-i)<o&&(t-=360),Math.abs(t+360-i)<o&&(t+=360),t}_normalizeCenter(t){let i=this.transform;if(i.maxBounds||i.projection.name!=="globe"&&!i.renderWorldCopies)return;let o=t.lng-i.center.lng;t.lng+=o>180?-360:o<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&ni.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,i,o){let c=Math.ceil(15*i/1e3),u=[],h=t(o.clone());for(let p=0;p<=c;p++){let f=h(p/c);u.push(f.clone())}return u}}class hF{constructor(t={}){this.options=t,_o(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){let i=this.options&&this.options.compact;return this._map=t,this._container=Cn("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Cn("button","mapboxgl-ctrl-attrib-button",this._container),Cn("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Cn("div","mapboxgl-ctrl-attrib-inner",this._container),i&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),i===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,i){let o=this._map._getUIString(`AttributionControl.${i}`);t.removeAttribute("title"),t.firstElementChild&&t.firstElementChild.setAttribute("title",o)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));let i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||S.ACCESS_TOKEN}];if(t){let o=i.reduce((c,u,h)=>(u.value&&(c+=`${u.key}=${u.value}${h<i.length-1?"&":""}`),c),"?");t.href=`${S.FEEDBACK_URL}/${o}#${oF(this._map,!0)}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){let c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}let i=this._map.style._mergedSourceCaches;for(let c in i){let u=i[c];if(u.used){let h=u.getSource();h.attribution&&t.indexOf(h.attribution)<0&&t.push(h.attribution)}}t.sort((c,u)=>c.length-u.length),t=t.filter((c,u)=>{for(let h=u+1;h<t.length;h++)if(t[h].indexOf(c)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));let o=t.join(" | ");o!==this._attribHTML&&(this._attribHTML=o,t.length?(this._innerContainer.innerHTML=o,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class mF{constructor(){_o(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=Cn("div","mapboxgl-ctrl");let i=Cn("a","mapboxgl-ctrl-logo");return i.target="_blank",i.rel="noopener nofollow",i.href="https://www.mapbox.com/",i.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),i.setAttribute("rel","noopener nofollow"),this._container.appendChild(i),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(let i in t){let o=t[i].getSource();if(o.hasOwnProperty("mapbox_logo")&&!o.mapbox_logo)return!1}return!0}_updateCompact(){let t=this._container.children;if(t.length){let i=t[0];this._map.getCanvasContainer().offsetWidth<250?i.classList.add("mapboxgl-compact"):i.classList.remove("mapboxgl-compact")}}}class pF{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){let i=++this._id;return this._queue.push({callback:t,id:i,cancelled:!1}),i}remove(t){let i=this._currentlyRunning,o=i?this._queue.concat(i):this._queue;for(let c of o)if(c.id===t)return void(c.cancelled=!0)}run(t=0){let i=this._currentlyRunning=this._queue;this._queue=[];for(let o of i)if(!o.cancelled&&(o.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function fF(e,t,i){if(e=new Ye(e.lng,e.lat),t){let o=new Ye(e.lng-360,e.lat),c=new Ye(e.lng+360,e.lat),u=360*Math.ceil(Math.abs(e.lng-i.center.lng)/360),h=i.locationPoint(e).distSqr(t),p=t.x<0||t.y<0||t.x>i.width||t.y>i.height;i.locationPoint(o).distSqr(t)<h&&(p||Math.abs(o.lng-i.center.lng)<u)?e=o:i.locationPoint(c).distSqr(t)<h&&(p||Math.abs(c.lng-i.center.lng)<u)&&(e=c)}for(;Math.abs(e.lng-i.center.lng)>180;){let o=i.locationPoint(e);if(o.x>=0&&o.y>=0&&o.x<=i.width&&o.y<=i.height)break;e.lng>i.center.lng?e.lng-=360:e.lng+=360}return e}let fS={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class gS extends Hr{constructor(t,i){if(super(),(t instanceof m.HTMLElement||i)&&(t=ge({element:t},i)),_o(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=Q.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=Cn("div");let u=41,h=27,p=tc("svg",{display:"block",height:u*this._scale+"px",width:h*this._scale+"px",viewBox:`0 0 ${h} ${u}`},this._element),f=tc("radialGradient",{id:"shadowGradient"},tc("defs",{},p));tc("stop",{offset:"10%","stop-opacity":.4},f),tc("stop",{offset:"100%","stop-opacity":.05},f),tc("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},p),tc("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},p),tc("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},p),tc("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},p),this._offset=Q.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",u=>{u.preventDefault()}),this._element.addEventListener("mousedown",u=>{u.preventDefault()});let o=this._element.classList;for(let u in fS)o.remove(`mapboxgl-marker-anchor-${u}`);o.add(`mapboxgl-marker-anchor-${this._anchor}`);let c=t&&t.className?t.className.trim().split(/\s+/):[];o.add(...c),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){let t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=Ye.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){let c=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){let i=t.code,o=t.charCode||t.keyCode;i!=="Space"&&i!=="Enter"&&o!==32&&o!==13||this.togglePopup()}_onMapClick(t){let i=t.originalEvent.target,o=this._element;this._popup&&(i===o||o.contains(i))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let t=this._map,i=this._pos;if(!t||!i)return!1;let o=t.unproject(i),c=t.getFreeCameraOptions();if(!c.position)return!1;let u=c.position.toLngLat();return u.distanceTo(o)<.9*u.distanceTo(this._lngLat)}_evaluateOpacity(){let t=this._map;if(!t)return;let i=this._pos;if(!i||i.x<0||i.x>t.transform.width||i.y<0||i.y>t.transform.height)return void this._clearFadeTimer();let o=t.unproject(i),c;t._showingGlobe()&&Y_(t.transform,this._lngLat)?c=0:(c=1-t._queryFogOpacity(o),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(c*=this._occludedOpacity)),this._element.style.opacity=`${c}`,this._element.style.pointerEvents=c>0?"auto":"none",this._popup&&this._popup._setOpacity(c),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let t=this._pos;if(!t||!this._map)return;let i=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${fS[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${i.x}px,${i.y}px)
        `}_calculateXYTransform(){let t=this._pos,i=this._map,o=this.getPitchAlignment();if(!i||!t||o!=="map")return"";if(!i._showingGlobe()){let f=i.getPitch();return f?`rotateX(${f}deg)`:""}let c=ii(ek(i.transform,this._lngLat)),u=t.sub(tk(i.transform)),h=Math.abs(u.x)+Math.abs(u.y);if(h===0)return"";let p=c/h;return`rotateX(${-u.y*p}deg) rotateY(${u.x*p}deg)`}_calculateZTransform(){let t=this._pos,i=this._map;if(!i||!t)return"";let o=0,c=this.getRotationAlignment();if(c==="map")if(i._showingGlobe()){let u=i.project(new Ye(this._lngLat.lng,this._lngLat.lat+.001)),h=i.project(new Ye(this._lngLat.lng,this._lngLat.lat-.001)).sub(u);o=ii(Math.atan2(h.y,h.x))-90}else o=-i.getBearing();else if(c==="horizon"){let u=Go(4,6,i.getZoom()),h=tk(i.transform);h.y+=u*i.transform.height;let p=t.sub(h),f=ii(Math.atan2(p.y,p.x));o=(f>90?f-270:f+90)*(1-u)}return o+=this._rotation,o?`rotateZ(${o}deg)`:""}_update(t){m.cancelAnimationFrame(this._updateFrameId);let i=this._map;i&&(i.transform.renderWorldCopies&&(this._lngLat=fF(this._lngLat,this._pos,i.transform)),this._pos=i.project(this._lngLat),t===!0?this._updateFrameId=m.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),i._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(i._showingGlobe()||i.getTerrain()||i.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=Q.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){let i=this._map;if(!i)return;let o=this._pointerdownPos,c=this._positionDelta;if(o&&c){if(!this._isDragging){let u=this._clickTolerance||i._clickTolerance;if(t.point.dist(o)<u)return;this._isDragging=!0}this._pos=t.point.sub(c),this._lngLat=i.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new qt("dragstart"))),this.fire(new qt("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new qt("dragend")),this._state="inactive"}_addDragHandler(t){let i=this._map,o=this._pos;i&&o&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(o),this._pointerdownPos=t.point,this._state="pending",i.on("mousemove",this._onMove),i.on("touchmove",this._onMove),i.once("mouseup",this._onUp),i.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;let i=this._map;return i&&(t?(i.on("mousedown",this._addDragHandler),i.on("touchstart",this._addDragHandler)):(i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let y$={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},b$=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function gF(e=new Q(0,0),t="bottom"){if(typeof e=="number"){let i=Math.round(Math.sqrt(.5*Math.pow(e,2)));switch(t){case"top":return new Q(0,e);case"top-left":return new Q(i,i);case"top-right":return new Q(-i,i);case"bottom":return new Q(0,-e);case"bottom-left":return new Q(i,-i);case"bottom-right":return new Q(-i,-i);case"left":return new Q(e,0);case"right":return new Q(-e,0)}return new Q(0,0)}return e instanceof Q||Array.isArray(e)?Q.convert(e):Q.convert(e[t]||[0,0])}class x${constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;let i=Cr((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-i)+this._end*i}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,i,o){this._start=this.getValue(i),this._end=t,this._startTime=i,this._endTime=i+o}}let w$={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},C$={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},S$={showCompass:!0,showZoom:!0,visualizePitch:!1};class E${constructor(t,i,o=!1){this._clickTolerance=10,this.element=i,this.mouseRotate=new sF({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,o&&(this.mousePitch=new aF({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),_o(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener("mousedown",this.mousedown),i.addEventListener("touchstart",this.touchstart,{passive:!1}),i.addEventListener("touchmove",this.touchmove),i.addEventListener("touchend",this.touchend),i.addEventListener("touchcancel",this.reset)}down(t,i){this.mouseRotate.mousedown(t,i),this.mousePitch&&this.mousePitch.mousedown(t,i),OT()}move(t,i){let o=this.map,c=this.mouseRotate.mousemoveWindow(t,i),u=c&&c.bearingDelta;if(u&&o.setBearing(o.getBearing()+u),this.mousePitch){let h=this.mousePitch.mousemoveWindow(t,i),p=h&&h.pitchDelta;p&&o.setPitch(o.getPitch()+p)}}off(){let t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){FT(),m.removeEventListener("mousemove",this.mousemove),m.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(ge({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),sp(this.element,t)),m.addEventListener("mousemove",this.mousemove),m.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,sp(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=r_(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=r_(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let M$={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},D$={maxWidth:100,unit:"metric"},T$={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},hv={version:_,supported:kT,setRTLTextPlugin:function(e,t,i=!1){if(bs===$1||bs===Y1||bs===Z1)throw new Error("setRTLTextPlugin cannot be called multiple times.");Hc=ni.resolveURL(e),bs=$1,X1=t,K1(),i||n2()},getRTLTextPluginStatus:J1,Map:class extends v${constructor(e){IT.mark(e_.create);let t=e;if((e=ge({},C$,e)).minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(e.antialias&&function(i){let o=i.navigator?i.navigator.userAgent:null;return!!function(c){if(We==null){let u=c.navigator?c.navigator.userAgent:null;We=!!c.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return We}(i)&&o&&(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))}(m)&&(e.antialias=!1,lt("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new AC(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),e),this._interactive=e.interactive,this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=e.crossSourceCollisions,this._collectResourceTiming=e.collectResourceTiming,this._language=this._parseLanguage(e.language),this._worldview=e.worldview,this._renderTaskQueue=new pF,this._domRenderTaskQueue=new pF,this._controls=[],this._markers=[],this._popups=[],this._mapId=Wu(),this._locale=ge({},w$,e.locale),this._clickTolerance=e.clickTolerance,this._cooperativeGestures=e.cooperativeGestures,this._performanceMetricsCollection=e.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new x$(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new Oe(e.transformRequest,e.accessToken,e.testMode),this._silenceAuthErrors=!!e.testMode,this._contextCreateOptions=e.contextCreateOptions?Gt({},e.contextCreateOptions):{},typeof e.container=="string"){if(this._container=m.document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container.toString()}' not found.`)}else{if(!(e.container instanceof m.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(this._container.childNodes.length>0&&lt("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),e.maxBounds&&this.setMaxBounds(e.maxBounds),_o(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),m!==void 0&&(this._fullscreenchangeEvent="onfullscreenchange"in m.document?"fullscreenchange":"webkitfullscreenchange",m.addEventListener("online",this._onWindowOnline,!1),m.addEventListener("resize",this._onWindowResize,!1),m.addEventListener("orientationchange",this._onWindowResize,!1),m.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),m.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new _$(this,e),this._localFontFamily=e.localFontFamily,this._localIdeographFontFamily=e.localIdeographFontFamily,(e.style||!e.testMode)&&this.setStyle(e.style||S.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),e.projection&&this.setProjection(e.projection),e.hash&&(this._hash=new jW(typeof e.hash=="string"&&e.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch});let i=e.bounds;i&&(this.resize(),this.fitBounds(i,ge({},e.fitBoundsOptions,{duration:0})))}this.resize(),e.attributionControl&&this.addControl(new hF({customAttribution:e.customAttribution})),this._logoControl=new mF,this.addControl(this._logoControl,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update(i.dataType==="style"),this.fire(new qt(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new qt(`${i.dataType}dataloading`,i))})}_getMapId(){return this._mapId}addControl(e,t){if(t===void 0&&(t=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new Xe(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let i=e.onAdd(this);this._controls.push(e);let o=this._controlPositions[t];return t.indexOf("bottom")!==-1?o.insertBefore(i,o.firstChild):o.appendChild(i),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new Xe(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let t=this._controls.indexOf(e);return t>-1&&this._controls.splice(t,1),e.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(e){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let t=!this._moving;return t&&this.fire(new qt("movestart",e)).fire(new qt("move",e)),this.fire(new qt("resize",e)),t&&this.fire(new qt("moveend",e)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(e){return this.transform.setMaxBounds(Cs.convert(e)),this._update()}setMinZoom(e){if((e=e??-2)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e?this.setZoom(e):this.fire(new qt("zoomstart")).fire(new qt("zoom")).fire(new qt("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=e??22)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e?this.setZoom(e):this.fire(new qt("zoomstart")).fire(new qt("zoom")).fire(new qt("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=e??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e?this.setPitch(e):this.fire(new qt("pitchstart")).fire(new qt("pitch")).fire(new qt("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=e??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e?this.setPitch(e):this.fire(new qt("pitchstart")).fire(new qt("pitch")).fire(new qt("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(e){return e==="auto"?m.navigator.language:Array.isArray(e)?e.length===0?void 0:e.map(t=>t==="auto"?m.navigator.language:t):e}setLanguage(e){let t=this._parseLanguage(e);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(let i of this._controls)i._setLanguage&&i._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview?(this._worldview=e,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(e){return this._lazyInitEmptyStyle(),e?typeof e=="string"&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let e=this.transform,t=e.projection.name,i;t==="globe"&&e.zoom>=Xc?(e.setMercatorFromTransition(),i=!0):t==="mercator"&&e.zoom<Xc&&(e.setProjection({name:"globe"}),i=!0),i&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(e,t){return this._updateProjection(e||t||{name:"mercator"})}_updateProjection(e){let t;return t=e.name==="globe"&&this.transform.zoom>=Xc?this.transform.setMercatorFromTransition():this.transform.setProjection(e),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(e){return this.transform.locationPoint3D(Ye.convert(e))}unproject(e){return this.transform.pointLocation3D(Q.convert(e))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(e,t,i){if(e==="mouseenter"||e==="mouseover"){let o=!1,c=h=>{let p=t.filter(g=>this.getLayer(g)),f=p.length?this.queryRenderedFeatures(h.point,{layers:p}):[];f.length?o||(o=!0,i.call(this,new $s(e,this,h.originalEvent,{features:f}))):o=!1},u=()=>{o=!1};return{layers:new Set(t),listener:i,delegates:{mousemove:c,mouseout:u}}}if(e==="mouseleave"||e==="mouseout"){let o=!1,c=h=>{let p=t.filter(f=>this.getLayer(f));(p.length?this.queryRenderedFeatures(h.point,{layers:p}):[]).length?o=!0:o&&(o=!1,i.call(this,new $s(e,this,h.originalEvent)))},u=h=>{o&&(o=!1,i.call(this,new $s(e,this,h.originalEvent)))};return{layers:new Set(t),listener:i,delegates:{mousemove:c,mouseout:u}}}{let o=c=>{let u=t.filter(p=>this.getLayer(p)),h=u.length?this.queryRenderedFeatures(c.point,{layers:u}):[];h.length&&(c.features=h,i.call(this,c),delete c.features)};return{layers:new Set(t),listener:i,delegates:{[e]:o}}}}on(e,t,i){if(i===void 0)return super.on(e,t);if(Array.isArray(t)||(t=[t]),t){for(let c of t)if(!this._isValidId(c))return this}let o=this._createDelegatedListener(e,t,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(o);for(let c in o.delegates)this.on(c,o.delegates[c]);return this}once(e,t,i){if(i===void 0)return super.once(e,t);if(Array.isArray(t)||(t=[t]),t){for(let c of t)if(!this._isValidId(c))return this}let o=this._createDelegatedListener(e,t,i);for(let c in o.delegates)this.once(c,o.delegates[c]);return this}off(e,t,i){if(i===void 0)return super.off(e,t);t=new Set(Array.isArray(t)?t:[t]);for(let u of t)if(!this._isValidId(u))return this;let o=(u,h)=>{if(u.size!==h.size)return!1;for(let p of u)if(!h.has(p))return!1;return!0},c=this._delegatedListeners?this._delegatedListeners[e]:void 0;return c&&(u=>{for(let h=0;h<u.length;h++){let p=u[h];if(p.listener===i&&o(p.layers,t)){for(let f in p.delegates)this.off(f,p.delegates[f]);return u.splice(h,1),this}}})(c),this}queryRenderedFeatures(e,t){if(!this.style)return[];if(t!==void 0||e===void 0||e instanceof Q||Array.isArray(e)||(t=e,e=void 0),e=e||[[0,0],[this.transform.width,this.transform.height]],(t=t||{}).layers&&Array.isArray(t.layers)){for(let i of t.layers)if(!this._isValidId(i))return[]}return this.style.queryRenderedFeatures(e,t,this.transform)}querySourceFeatures(e,t){return this._isValidId(e)?this.style.querySourceFeatures(e,t):[]}isPointOnSurface(e){let{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&lt(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(Q.convert(e))}setStyle(e,t){return(t=ge({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&e?(this._diffStyle(e,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(e,t))}_getUIString(e){let t=this._locale[e];if(t==null)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),e&&(this.style=new il(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof e=="string"?this.style.loadURL(e):this.style.loadJSON(e)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new il(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,t){if(typeof e=="string"){let i=this._requestManager.normalizeStyleURL(e),o=this._requestManager.transformRequest(i,Dt.Style);Xt(o,(c,u)=>{c?this.fire(new Xe(c)):u&&this._updateDiff(u,t)})}else typeof e=="object"&&this._updateDiff(e,t)}_updateDiff(e,t){try{this.style.setState(e)&&this._update(!0)}catch(i){lt(`Unable to perform style diff: ${i.message||i.error||i}.  Rebuilding the style from scratch.`),this._updateStyle(e,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(lt("There is no style added to the map."),!1)}_isValidId(e){return e==null?(this.fire(new Xe(new Error("IDs can't be empty."))),!1):!s2(e)||(this.fire(new Xe(new Error(`IDs can't contain special symbols: "${e}".`))),!1)}addSource(e,t){return this._isValidId(e)?(this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)):this}isSourceLoaded(e){return!!this._isValidId(e)&&!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){let e=this.style&&this.style._sourceCaches;for(let t in e){let i=e[t]._tiles;for(let o in i){let c=i[o];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}addSourceType(e,t,i){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,i)}removeSource(e){return this._isValidId(e)?(this.style.removeSource(e),this._updateTerrain(),this._update(!0)):this}getSource(e){return this._isValidId(e)?this.style.getOwnSource(e):null}addImage(e,t,{pixelRatio:i=1,sdf:o=!1,stretchX:c,stretchY:u,content:h}={}){if(this._lazyInitEmptyStyle(),t instanceof m.HTMLImageElement||m.ImageBitmap&&t instanceof m.ImageBitmap){let{width:p,height:f,data:g}=ni.getImageData(t);this.style.addImage(e,{data:new Br({width:p,height:f},g),pixelRatio:i,stretchX:c,stretchY:u,content:h,sdf:o,version:0})}else if(t.width===void 0||t.height===void 0)this.fire(new Xe(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:p,height:f}=t,g=t;this.style.addImage(e,{data:new Br({width:p,height:f},new Uint8Array(g.data)),pixelRatio:i,stretchX:c,stretchY:u,content:h,sdf:o,version:0,userImage:g}),g.onAdd&&g.onAdd(this,e)}}updateImage(e,t){this._lazyInitEmptyStyle();let i=this.style.getImage(e);if(!i)return void this.fire(new Xe(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let o=t instanceof m.HTMLImageElement||m.ImageBitmap&&t instanceof m.ImageBitmap?ni.getImageData(t):t,{width:c,height:u}=o;c!==void 0&&u!==void 0?c===i.data.width&&u===i.data.height?(i.data.replace(o.data,!(t instanceof m.HTMLImageElement||m.ImageBitmap&&t instanceof m.ImageBitmap)),this.style.updateImage(e,i)):this.fire(new Xe(new Error(`The width and height of the updated image (${c}, ${u})
                must be that same as the previous version of the image
                (${i.data.width}, ${i.data.height})`))):this.fire(new Xe(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(e){return e?!!this.style&&!!this.style.getImage(e):(this.fire(new Xe(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(e,t){mi(this._requestManager.transformRequest(e,Dt.Image),(i,o)=>{t(i,o instanceof m.HTMLImageElement?ni.getImageData(o):o)})}listImages(){return this.style.listImages()}addModel(e,t){this._lazyInitEmptyStyle(),this.style.addModel(e,t)}hasModel(e){return e?this.style.hasModel(e):(this.fire(new Xe(new Error("Missing required model id"))),!1)}removeModel(e){this.style.removeModel(e)}listModels(){return this.style.listModels()}addLayer(e,t){return this._isValidId(e.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)):this}moveLayer(e,t){return this._isValidId(e)?(this.style.moveLayer(e,t),this._update(!0)):this}removeLayer(e){return this._isValidId(e)?(this.style.removeLayer(e),this._update(!0)):this}getLayer(e){return this._isValidId(e)?this.style.getOwnLayer(e):null}setLayerZoomRange(e,t,i){return this._isValidId(e)?(this.style.setLayerZoomRange(e,t,i),this._update(!0)):this}setFilter(e,t,i={}){return this._isValidId(e)?(this.style.setFilter(e,t,i),this._update(!0)):this}getFilter(e){return this._isValidId(e)?this.style.getFilter(e):null}setPaintProperty(e,t,i,o={}){return this._isValidId(e)?(this.style.setPaintProperty(e,t,i,o),this._update(!0)):this}getPaintProperty(e,t){return this._isValidId(e)?this.style.getPaintProperty(e,t):null}setLayoutProperty(e,t,i,o={}){return this._isValidId(e)?(this.style.setLayoutProperty(e,t,i,o),this._update(!0)):this}getLayoutProperty(e,t){return this._isValidId(e)?this.style.getLayoutProperty(e,t):null}getConfigProperty(e,t){return this.style.getConfigProperty(e,t)}setConfigProperty(e,t,i){return this.style.setConfigProperty(e,t,i),this._update(!0)}setLights(e){if(this._lazyInitEmptyStyle(),e&&e.length===1&&e[0].type==="flat"){let t=e[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(e),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let e=this.style.getLights()||[];return e.length===0&&e.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),e}setLight(e,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:e}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(e){return this.style.setCamera(e),this._triggerCameraUpdate(e)}_triggerCameraUpdate(e){return this._update(this.transform.setOrthographicProjectionAtLowPitch(e["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(e){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(Ye.convert(e),this.transform):0}setFeatureState(e,t){return this._isValidId(e.source)?(this.style.setFeatureState(e,t),this._update()):this}removeFeatureState(e,t){return this._isValidId(e.source)?(this.style.removeFeatureState(e,t),this._update()):this}getFeatureState(e){return this._isValidId(e.source)?this.style.getFeatureState(e):null}_updateContainerDimensions(){if(!this._container)return;let e=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300,i,o,c,u=this._container;for(;u&&(!o||!c);){let h=m.getComputedStyle(u).transform;h&&h!=="none"&&(i=h.match(/matrix.*\((.+)\)/)[1].split(", "),i[0]&&i[0]!=="0"&&i[0]!=="1"&&(o=i[0]),i[3]&&i[3]!=="0"&&i[3]!=="1"&&(c=i[3])),u=u.parentElement}this._containerWidth=o?Math.abs(e/o):e,this._containerHeight=c?Math.abs(t/c):t}_detectMissingCSS(){m.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&lt("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=Cn("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();let t=this._canvasContainer=Cn("div","mapboxgl-canvas-container",e);this._canvas=Cn("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let i=this._controlContainer=Cn("div","mapboxgl-control-container",e),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(c=>{o[c]=Cn("div",`mapboxgl-ctrl-${c}`,i)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,t){let i=ni.devicePixelRatio||1;this._canvas.width=i*Math.ceil(e),this._canvas.height=i*Math.ceil(t),this._canvas.style.width=`${e}px`,this._canvas.style.height=`${t}px`}_addMarker(e){this._markers.push(e)}_removeMarker(e){let t=this._markers.indexOf(e);t!==-1&&this._markers.splice(t,1)}_addPopup(e){this._popups.push(e)}_removePopup(e){let t=this._popups.indexOf(e);t!==-1&&this._popups.splice(t,1)}_setupPainter(){let e=ge({},kT.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",e);t?(TT(t,!0),this.painter=new RW(t,this._contextCreateOptions,this.transform),this.on("data",i=>{i.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),T.testSupport(t)):this.fire(new Xe(new Error("Failed to initialize WebGL")))}_contextLost(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new qt("webglcontextlost",{originalEvent:e}))}_contextRestored(e){this._setupPainter(),this.resize(),this._update(),this.fire(new qt("webglcontextrestored",{originalEvent:e}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(e){let t;this.fire(new qt("renderstart"));let i=this.painter.context.extTimerQuery,o=ni.now(),c=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=c.createQuery(),c.beginQuery(i.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],m.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],m.performance.now())),this._renderTaskQueue.run(e),this._domRenderTaskQueue.run(e),this._removed)return;this._updateProjectionTransition();let u=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let f=this.transform.zoom,g=this.transform.pitch,v=ni.now(),y=new Jn(f,{now:v,fadeDuration:u,pitch:g,transition:this.style.transition});this.style.update(y)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let h=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),h=this._updateAverageElevation(o),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):h=this._updateAverageElevation(o),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,u,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:u,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new qt("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new qt("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){let f=ni.now()-o;c.endQuery(i.TIME_ELAPSED_EXT),setTimeout(()=>{let g=c.getQueryParameter(t,c.QUERY_RESULT)/1e6;c.deleteQuery(t),this.fire(new qt("gpu-timing-frame",{cpuTime:f,gpuTime:g})),m.performance.mark("frame-gpu",{startTime:o,detail:{gpuTime:g}})},50)}if(this.listens("gpu-timing-layer")){let f=this.painter.collectGpuTimers();setTimeout(()=>{let g=this.painter.queryGpuTimers(f);this.fire(new qt("gpu-timing-layer",{layerTimes:g}))},50)}if(this.listens("gpu-timing-deferred-render")){let f=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let g=this.painter.queryGpuTimeDeferredRender(f);this.fire(new qt("gpu-timing-deferred-render",{gpuTime:g}))},50)}let p=this._sourcesDirty||this._styleDirty||this._placementDirty||h;if(p||this._repaint)this.triggerRepaint();else{let f=!this.isMoving()&&this.loaded();if(f&&(h=this._updateAverageElevation(o,!0)),h)this.triggerRepaint();else if(this._triggerFrame(!1),f&&(this.fire(new qt("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let g=this._calculateSpeedIndex();this.fire(new qt("speedindexcompleted",{speedIndex:g})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,IT.mark(e_.fullLoad),this._performanceMetricsCollection&&mj(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(e){for(let t of this._markers)e&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(let t of this._popups)!e||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(e,t=!1){let i=c=>(this.transform.averageElevation=c,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&i(0);let o=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(o||(t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){let c=this.transform.averageElevation,u=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(u)?u=0:this._averageElevationLastSampledAt=e;let h=Math.abs(c-u);if(h>1){if(this._isInitialLoad||o)return this._averageElevation.jumpTo(u),i(u);this._averageElevation.easeTo(u,e,300)}else if(h>1e-4)return this._averageElevation.jumpTo(u),i(u)}return!!this._averageElevation.isEasing(e)&&i(this._averageElevation.getValue(e))}_authenticate(){pj(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,e=>{if(e&&(e.message===gn||e.status===401)){let t=this.painter.context.gl;TT(t,!1),this._logoControl instanceof mF&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new Xe(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),hj(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){let e=this._isDragging();this.painter.updateTerrain(this.style,e)}_calculateSpeedIndex(){let e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());let i=this.painter.context.gl,o=i.createFramebuffer();function c(u){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,u,0);let h=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,h),h}return i.bindFramebuffer(i.FRAMEBUFFER,o),this._canvasPixelComparison(c(e),t.canvasCopies.map(c),t.timeStamps)}_canvasPixelComparison(e,t,i){let o=i[1]-i[0],c=e.length/4;for(let u=0;u<t.length;u++){let h=t[u],p=0;for(let f=0;f<h.length;f+=4)h[f]===e[f]&&h[f+1]===e[f+1]&&h[f+2]===e[f+2]&&h[f+3]===e[f+3]&&(p+=1);o+=(i[u+2]-i[u+1])*(1-p/c)}return o}remove(){this._hash&&this._hash.remove();for(let t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),m!==void 0&&(m.removeEventListener("resize",this._onWindowResize,!1),m.removeEventListener("orientationchange",this._onWindowResize,!1),m.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),m.removeEventListener("online",this._onWindowOnline,!1),m.removeEventListener("visibilitychange",this._onVisibilityChange,!1));let e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),t_.delete(this.painter.context.gl),this._removed=!0,this.fire(new qt("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(e){this._renderNextFrame=this._renderNextFrame||e,this.style&&!this._frame&&(this._frame=ni.frame(t=>{let i=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,i&&this._render(t)}))}_preloadTiles(e){return fs(this.style?Object.values(this.style._sourceCaches):[],(t,i)=>t._preloadTiles(e,i),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}_onVisibilityChange(){m.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(e){this._showLayers2DWireframe!==e&&(this._showLayers2DWireframe=e,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(e){this._showLayers3DWireframe!==e&&(this._showLayers3DWireframe=e,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&(this._showTileAABBs=e,e&&this._update())}_setCacheLimits(e,t){(function(i,o){qo=i,ss=o})(e,t)}get version(){return _}},NavigationControl:class{constructor(e){this.options=ge({},S$,e),this._container=Cn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(_o(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),Cn("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),Cn("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(_o(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{let i=this._map;i&&(this.options.visualizePitch?i.resetNorthPitch({},{originalEvent:t}):i.resetNorth({},{originalEvent:t}))}),this._compassIcon=Cn("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let e=this._map;if(!e)return;let t=e.getZoom(),i=t===e.getMaxZoom(),o=t===e.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=o,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",o.toString())}_rotateCompassArrow(){let e=this._map;if(!e)return;let t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5)}) rotateX(${e.transform.pitch}deg) rotateZ(${e.transform.angle*(180/Math.PI)}deg)`:`rotate(${e.transform.angle*(180/Math.PI)}deg)`;e._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new E$(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){let e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){let i=Cn("button",e,this._container);return i.type="button",i.addEventListener("click",t),i}_setButtonTitle(e,t){if(!this._map)return;let i=this._map._getUIString(`NavigationControl.${t}`);e.setAttribute("aria-label",i),e.firstElementChild&&e.firstElementChild.setAttribute("title",i)}},GeolocateControl:class extends Hr{constructor(e){super(),this.options=ge({geolocation:m.navigator.geolocation},M$,e),_o(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=rF(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=Cn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(e){let t=(i=!!this.options.geolocation)=>{this._supportsGeolocation=i,e(i)};this._supportsGeolocation!==void 0?e(this._supportsGeolocation):m.navigator.permissions!==void 0?m.navigator.permissions.query({name:"geolocation"}).then(i=>t(i.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(e){let t=this._map.getMaxBounds(),i=e.coords;return!!t&&(i.longitude<t.getWest()||i.longitude>t.getEast()||i.latitude<t.getSouth()||i.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new qt("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new qt("geolocate",e)),this._finish()}}_updateCamera(e){let t=new Ye(e.coords.longitude,e.coords.latitude),i=e.coords.accuracy,o=ge({bearing:this._map.getBearing()},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(i),o,{geolocateSource:!0})}_updateMarker(e){if(e){let t=new Ye(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let e=this._map.transform,t=_n(1,e._center.lat)*e.worldSize,i=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${i}px`,this._circleElement.style.height=`${i}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(e){if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new qt("error",e)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(e){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=Cn("button","mapboxgl-ctrl-geolocate",this._container),Cn("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",e===!1){lt("Geolocation support is not available so the GeolocateControl will be disabled.");let t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{let t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Cn("div","mapboxgl-user-location"),this._dotElement.appendChild(Cn("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Cn("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new gS({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Cn("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new gS({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new qt("trackuserlocationend")))})}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:e.absolute===!0&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return lt("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new qt("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new qt("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new qt("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let e=()=>{m.addEventListener("ondeviceorientationabsolute"in m?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};m.DeviceMotionEvent!==void 0&&typeof m.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&e()}).catch(console.error):e()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),m.removeEventListener("deviceorientation",this._onDeviceOrientation),m.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:hF,ScaleControl:class{constructor(e){this.options=ge({},D$,e),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),_o(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let e=this.options.maxWidth||100,t=this._map,i=t._containerHeight/2,o=t._containerWidth/2-e/2,c=t.unproject([o,i]),u=t.unproject([o+e,i]),h=c.distanceTo(u);if(this.options.unit==="imperial"){let p=3.2808*h;p>5280?this._setScale(e,p/5280,"mile"):this._setScale(e,p,"foot")}else this.options.unit==="nautical"?this._setScale(e,h/1852,"nautical-mile"):h>=1e3?this._setScale(e,h/1e3,"kilometer"):this._setScale(e,h,"meter")}_setScale(e,t,i){this._map._requestDomTask(()=>{let o=function(u){let h=Math.pow(10,`${Math.floor(u)}`.length-1),p=u/h;return p=p>=10?10:p>=5?5:p>=3?3:p>=2?2:p>=1?1:function(f){let g=Math.pow(10,Math.ceil(-Math.log(f)/Math.LN10));return Math.round(f*g)/g}(p),h*p}(t),c=o/t;this._container.innerHTML=this._isNumberFormatSupported&&i!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:i}).format(o):`${o}&nbsp;${T$[i]}`,this._container.style.width=e*c+"px"})}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=Cn("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof m.HTMLElement?this._container=e.container:lt("Full screen control 'container' must be a DOM element.")),_o(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in m.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in m.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=Cn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",lt("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,m.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!m.document.fullscreenEnabled&&!m.document.webkitFullscreenEnabled)}_setupUI(){let e=this._fullscreenButton=Cn("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Cn("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),m.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(m.document.fullscreenElement||m.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?m.document.exitFullscreen?m.document.exitFullscreen():m.document.webkitCancelFullScreen&&m.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends Hr{constructor(e){super(),this.options=ge(Object.create(y$),e),_o(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(e&&e.className?e.className.trim().split(/\s+/):[])}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&e.on("preclick",this._onClose),this.options.closeOnMove&&e.on("move",this._onClose),e.on("remove",this.remove),this._update(),e._addPopup(this),this._focusFirstElement(),this._trackPointer?(e.on("mousemove",this._onMouseEvent),e.on("mouseup",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")):e.on("move",this._update),this.fire(new qt("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let e=this._map;return e&&(e.off("move",this._update),e.off("move",this._onClose),e.off("preclick",this._onClose),e.off("click",this._onClose),e.off("remove",this.remove),e.off("mousemove",this._onMouseEvent),e.off("mouseup",this._onMouseEvent),e.off("drag",this._onMouseEvent),e._canvasContainer&&e._canvasContainer.classList.remove("mapboxgl-track-pointer"),e._removePopup(this),this._map=void 0),this.fire(new qt("close")),this}getLngLat(){return this._lngLat}setLngLat(e){this._lngLat=Ye.convert(e),this._pos=null,this._trackPointer=!1,this._update();let t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(m.document.createTextNode(e))}setHTML(e){let t=m.document.createDocumentFragment(),i=m.document.createElement("body"),o;for(i.innerHTML=e;o=i.firstChild,o;)t.appendChild(o);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=Cn("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){let i=this._closeButton=Cn("button","mapboxgl-popup-close-button",t);i.type="button",i.setAttribute("aria-label","Close popup"),i.setAttribute("aria-hidden","true"),i.innerHTML="&#215;",i.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;let t=this._map,i=this._container,o=this._pos;if(!t||!i||!o)return"bottom";let c=i.offsetWidth,u=i.offsetHeight,h=o.x<c/2,p=o.x>t.transform.width-c/2;if(o.y+e<u)return h?"top-left":p?"top-right":"top";if(o.y>t.transform.height-u){if(h)return"bottom-left";if(p)return"bottom-right"}return h?"left":p?"right":"bottom"}_updateClassList(){let e=this._container;if(!e)return;let t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ")}_update(e){let t=this._map,i=this._content;if(!t||!this._lngLat&&!this._trackPointer||!i)return;let o=this._container;if(o||(o=this._container=Cn("div","mapboxgl-popup",t.getContainer()),this._tip=Cn("div","mapboxgl-popup-tip",o),o.appendChild(i)),this.options.maxWidth&&o.style.maxWidth!==this.options.maxWidth&&(o.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=fF(this._lngLat,this._pos,t.transform)),!this._trackPointer||e){let c=this._pos=this._trackPointer&&e?e:t.project(this._lngLat),u=gF(this.options.offset),h=this._anchor=this._getAnchor(u.y),p=gF(this.options.offset,h),f=c.add(p).round();t._requestDomTask(()=>{this._container&&h&&(this._container.style.transform=`${fS[h]} translate(${f.x}px,${f.y}px)`)})}if(!this._marker&&t._showingGlobe()){let c=Y_(t.transform,this._lngLat)?0:1;this._setOpacity(c)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let e=this._container.querySelector(b$);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity=`${e}`),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:gS,Style:il,LngLat:Ye,LngLatBounds:Cs,Point:Q,MercatorCoordinate:Oi,FreeCameraOptions:DR,Evented:Hr,config:S,prewarm:function(){lf().acquire(VC)},clearPrewarmedResources:function(){let e=af;e&&(e.isPreloaded()&&e.numActive()===1?(e.release(VC),af=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return S.ACCESS_TOKEN},set accessToken(e){S.ACCESS_TOKEN=e},get baseApiUrl(){return S.API_URL},set baseApiUrl(e){S.API_URL=e},get workerCount(){return zh.workerCount},set workerCount(e){zh.workerCount=e},get maxParallelImageRequests(){return S.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){S.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(e){(function(t){if(!Zu())return;let i=m.caches.delete(Un);t&&i.catch(t).then(()=>t())})(e)},workerUrl:"",workerClass:null,get dracoUrl(){return UP()},set dracoUrl(e){(function(t){jC=ni.resolveURL(t),UC||(UC=new U0(lf(),new Hr)),UC.broadcast("setDracoUrl",jC)})(e)},setNow:ni.setNow,restoreNow:ni.restoreNow};d.A=PP,d.D=h0,d.E=wt,d.F=cC,d.K=X0,d.O=Hi,d.P=Q,d.T=QR,d.V=a0,d.a=s0,d.b=Ik,d.c=V0,d.d=class extends Hr{constructor(e,t,i,o,c,u){super(),this.actor=e,this.layerIndex=t,this.availableImages=i,this.loadVectorData=c||VP,this.loading={},this.loaded={},this.deduped=new BP(e.scheduler),this.isSpriteLoaded=o,this.scheduler=e.scheduler,this.brightness=u}loadTile(e,t){let i=e.uid,o=e&&e.request,c=o&&o.collectResourceTiming,u=this.loading[i]=new YG(e);u.abort=this.loadVectorData(e,(h,p)=>{let f=!this.loading[i];if(delete this.loading[i],f||h||!p)return u.status="done",f||(this.loaded[i]=u),t(h);let g=p.rawData,v={};p.expires&&(v.expires=p.expires),p.cacheControl&&(v.cacheControl=p.cacheControl),u.vectorTile=p.vectorTile||new aC(new u0(g));let y=()=>{u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,(b,x)=>{if(b||!x)return t(b);let C={};if(c){let E=AT(o);E.length>0&&(C.resourceTiming=JSON.parse(JSON.stringify(E)))}t(null,ge({rawTileData:g.slice(0)},x,v,C))})};this.isSpriteLoaded?y():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(y,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):y()}),this.loaded=this.loaded||{},this.loaded[i]=u})}reloadTile(e,t){let i=this.loaded,o=e.uid,c=this;if(i&&i[o]){let u=i[o];u.showCollisionBoxes=e.showCollisionBoxes,u.projection=e.projection,u.brightness=e.brightness,u.tileTransform=su(e.tileID.canonical,e.projection),u.extraShadowCaster=e.extraShadowCaster;let h=(p,f)=>{let g=u.reloadCallback;g&&(delete u.reloadCallback,u.parse(u.vectorTile,c.layerIndex,this.availableImages,c.actor,g)),t(p,f)};u.status==="parsing"?u.reloadCallback=h:u.status==="done"&&(u.vectorTile?u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,h):h())}else t(null,void 0)}abortTile(e,t){let i=e.uid,o=this.loading[i];o&&(o.abort&&o.abort(),delete this.loading[i]),t()}removeTile(e,t){let i=this.loaded,o=e.uid;i&&i[o]&&delete i[o],t()}},d.e=Vc,d.f=AT,d.g=ut,d.h=Xt,d.i=ie,d.j=function(e,t){let i=YC(e);for(let o of i){for(let c of o.meshes)rq(c);o.lights&&(o.lightMeshIndex=o.meshes.length,o.meshes.push(oq(o.lights,t)))}return i},d.k=Jn,d.l=function(e){let t=0;if(new Uint32Array(e,0,1)[0]!==GP){let i=new Uint32Array(e,0,7),[,,o,c,u,h]=i;t=i.byteLength+c+u+h+u,(o!==e.byteLength||t>=e.byteLength)&&lt("Invalid b3dm header information.")}return YP(e,t)},d.m=x0,d.n=ca,d.o=qt,d.p=Nt,d.q=function(e){gs(),as&&as.then(t=>{t.keys().then(i=>{for(let o=0;o<i.length-e;o++)t.delete(i[o])})})},d.r=JP,d.s=hv,d.t=Lp,d.v=Us,d.w=m}),n(["./shared"],function(d){"use strict";function m(Yt){if(typeof Yt=="number"||typeof Yt=="boolean"||typeof Yt=="string"||Yt==null)return JSON.stringify(Yt);if(Array.isArray(Yt)){let et="[";for(let lt of Yt)et+=`${m(lt)},`;return`${et}]`}let K="{";for(let et of Object.keys(Yt).sort())K+=`${et}:${m(Yt[et])},`;return`${K}}`}function _(Yt){let K="";for(let et of d.r)K+=`/${m(Yt[et])}`;return K}class w{constructor(K){this.keyCache={},this._layers={},this._layerConfigs={},K&&this.replace(K)}replace(K,et){this._layerConfigs={},this._layers={},this.update(K,[],et)}update(K,et,lt){this._options=lt;for(let Vt of K){this._layerConfigs[Vt.id]=Vt;let _e=this._layers[Vt.id]=d.c(Vt,this._options);_e.setScope(this.scope),_e.compileFilter(),this.keyCache[Vt.id]&&delete this.keyCache[Vt.id]}for(let Vt of et)delete this.keyCache[Vt],delete this._layerConfigs[Vt],delete this._layers[Vt];this.familiesBySource={};let zt=function(Vt,_e){let Ae={};for(let Pe=0;Pe<Vt.length;Pe++){let We=_e&&_e[Vt[Pe].id]||_(Vt[Pe]);_e&&(_e[Vt[Pe].id]=We);let Ke=Ae[We];Ke||(Ke=Ae[We]=[]),Ke.push(Vt[Pe])}let jt=[];for(let Pe in Ae)jt.push(Ae[Pe]);return jt}(d.v(this._layerConfigs),this.keyCache);for(let Vt of zt){let _e=Vt.map(Dn=>this._layers[Dn.id]),Ae=_e[0];if(Ae.visibility==="none")continue;let jt=Ae.source||"",Pe=this.familiesBySource[jt];Pe||(Pe=this.familiesBySource[jt]={});let We=Ae.sourceLayer||"_geojsonTileLayer",Ke=Pe[We];Ke||(Ke=Pe[We]=[]),Ke.push(_e)}}}class S{loadTile(K,et){let{uid:lt,encoding:zt,rawImageData:Vt,padding:_e}=K,Ae=d.w.ImageBitmap&&Vt instanceof d.w.ImageBitmap?this.getImageData(Vt,_e):Vt;et(null,new d.D(lt,Ae,zt,_e<1))}getImageData(K,et){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(K.width,K.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=K.width,this.offscreenCanvas.height=K.height,this.offscreenCanvasContext.drawImage(K,0,0,K.width,K.height);let lt=this.offscreenCanvasContext.getImageData(-et,-et,K.width+2*et,K.height+2*et);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),lt}}function T(Yt,K){if(Yt.length!==0){L(Yt[0],K);for(var et=1;et<Yt.length;et++)L(Yt[et],!K)}}function L(Yt,K){for(var et=0,lt=0,zt=0,Vt=Yt.length,_e=Vt-1;zt<Vt;_e=zt++){var Ae=(Yt[zt][0]-Yt[_e][0])*(Yt[_e][1]+Yt[zt][1]),jt=et+Ae;lt+=Math.abs(et)>=Math.abs(Ae)?et-jt+Ae:Ae-jt+et,et=jt}et+lt>=0!=!!K&&Yt.reverse()}var H=d.g(function Yt(K,et){var lt,zt=K&&K.type;if(zt==="FeatureCollection")for(lt=0;lt<K.features.length;lt++)Yt(K.features[lt],et);else if(zt==="GeometryCollection")for(lt=0;lt<K.geometries.length;lt++)Yt(K.geometries[lt],et);else if(zt==="Feature")Yt(K.geometry,et);else if(zt==="Polygon")T(K.coordinates,et);else if(zt==="MultiPolygon")for(lt=0;lt<K.coordinates.length;lt++)T(K.coordinates[lt],et);return K});let q=d.V.prototype.toGeoJSON;var X={exports:{}},it=d.p,at=d.a.VectorTileFeature,ut=Mt;function Mt(Yt,K){this.options=K||{},this.features=Yt,this.length=Yt.length}function Lt(Yt,K){this.id=typeof Yt.id=="number"?Yt.id:void 0,this.type=Yt.type,this.rawGeometry=Yt.type===1?[Yt.geometry]:Yt.geometry,this.properties=Yt.tags,this.extent=K||4096}Mt.prototype.feature=function(Yt){return new Lt(this.features[Yt],this.options.extent)},Lt.prototype.loadGeometry=function(){var Yt=this.rawGeometry;this.geometry=[];for(var K=0;K<Yt.length;K++){for(var et=Yt[K],lt=[],zt=0;zt<et.length;zt++)lt.push(new it(et[zt][0],et[zt][1]));this.geometry.push(lt)}return this.geometry},Lt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Yt=this.geometry,K=1/0,et=-1/0,lt=1/0,zt=-1/0,Vt=0;Vt<Yt.length;Vt++)for(var _e=Yt[Vt],Ae=0;Ae<_e.length;Ae++){var jt=_e[Ae];K=Math.min(K,jt.x),et=Math.max(et,jt.x),lt=Math.min(lt,jt.y),zt=Math.max(zt,jt.y)}return[K,lt,et,zt]},Lt.prototype.toGeoJSON=at.prototype.toGeoJSON;var Pt=d.b,Nt=ut;function ue(Yt){var K=new Pt;return function(et,lt){for(var zt in et.layers)lt.writeMessage(3,Q,et.layers[zt])}(Yt,K),K.finish()}function Q(Yt,K){var et;K.writeVarintField(15,Yt.version||1),K.writeStringField(1,Yt.name||""),K.writeVarintField(5,Yt.extent||4096);var lt={keys:[],values:[],keycache:{},valuecache:{}};for(et=0;et<Yt.length;et++)lt.feature=Yt.feature(et),K.writeMessage(2,$t,lt);var zt=lt.keys;for(et=0;et<zt.length;et++)K.writeStringField(3,zt[et]);var Vt=lt.values;for(et=0;et<Vt.length;et++)K.writeMessage(4,Pi,Vt[et])}function $t(Yt,K){var et=Yt.feature;et.id!==void 0&&K.writeVarintField(1,et.id),K.writeMessage(2,Be,Yt),K.writeVarintField(3,et.type),K.writeMessage(4,ii,et)}function Be(Yt,K){var et=Yt.feature,lt=Yt.keys,zt=Yt.values,Vt=Yt.keycache,_e=Yt.valuecache;for(var Ae in et.properties){var jt=et.properties[Ae],Pe=Vt[Ae];if(jt!==null){Pe===void 0&&(lt.push(Ae),Vt[Ae]=Pe=lt.length-1),K.writeVarint(Pe);var We=typeof jt;We!=="string"&&We!=="boolean"&&We!=="number"&&(jt=JSON.stringify(jt));var Ke=We+":"+jt,Dn=_e[Ke];Dn===void 0&&(zt.push(jt),_e[Ke]=Dn=zt.length-1),K.writeVarint(Dn)}}}function Ai(Yt,K){return(K<<3)+(7&Yt)}function fe(Yt){return Yt<<1^Yt>>31}function ii(Yt,K){for(var et=Yt.loadGeometry(),lt=Yt.type,zt=0,Vt=0,_e=et.length,Ae=0;Ae<_e;Ae++){var jt=et[Ae],Pe=1;lt===1&&(Pe=jt.length),K.writeVarint(Ai(1,Pe));for(var We=lt===3?jt.length-1:jt.length,Ke=0;Ke<We;Ke++){Ke===1&&lt!==1&&K.writeVarint(Ai(2,We-1));var Dn=jt[Ke].x-zt,gr=jt[Ke].y-Vt;K.writeVarint(fe(Dn)),K.writeVarint(fe(gr)),zt+=Dn,Vt+=gr}lt===3&&K.writeVarint(Ai(7,1))}}function Pi(Yt,K){var et=typeof Yt;et==="string"?K.writeStringField(1,Yt):et==="boolean"?K.writeBooleanField(7,Yt):et==="number"&&(Yt%1!=0?K.writeDoubleField(3,Yt):Yt<0?K.writeSVarintField(6,Yt):K.writeVarintField(5,Yt))}X.exports=ue,X.exports.fromVectorTileJs=ue,X.exports.fromGeojsonVt=function(Yt,K){K=K||{};var et={};for(var lt in Yt)et[lt]=new Nt(Yt[lt].features,K),et[lt].name=lt,et[lt].version=K.version,et[lt].extent=K.extent;return ue({layers:et})},X.exports.GeoJSONWrapper=Nt;var Cr=d.g(X.exports);let ki={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Yt=>Yt},jn=Math.fround||(fn=new Float32Array(1),Yt=>(fn[0]=+Yt,fn[0]));var fn;let fr=3,ve=5,Go=6;class os{constructor(K){this.options=Object.assign(Object.create(ki),K),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(K){let{log:et,minZoom:lt,maxZoom:zt}=this.options;et&&console.time("total time");let Vt=`prepare ${K.length} points`;et&&console.time(Vt),this.points=K;let _e=[];for(let jt=0;jt<K.length;jt++){let Pe=K[jt];if(!Pe.geometry)continue;let[We,Ke]=Pe.geometry.coordinates,Dn=jn(ge(We)),gr=jn(Ho(Ke));_e.push(Dn,gr,1/0,jt,-1,1),this.options.reduce&&_e.push(0)}let Ae=this.trees[zt+1]=this._createTree(_e);et&&console.timeEnd(Vt);for(let jt=zt;jt>=lt;jt--){let Pe=+Date.now();Ae=this.trees[jt]=this._createTree(this._cluster(Ae,jt)),et&&console.log("z%d: %d clusters in %dms",jt,Ae.numItems,+Date.now()-Pe)}return et&&console.timeEnd("total time"),this}getClusters(K,et){let lt=((K[0]+180)%360+360)%360-180,zt=Math.max(-90,Math.min(90,K[1])),Vt=K[2]===180?180:((K[2]+180)%360+360)%360-180,_e=Math.max(-90,Math.min(90,K[3]));if(K[2]-K[0]>=360)lt=-180,Vt=180;else if(lt>Vt){let Ke=this.getClusters([lt,zt,180,_e],et),Dn=this.getClusters([-180,zt,Vt,_e],et);return Ke.concat(Dn)}let Ae=this.trees[this._limitZoom(et)],jt=Ae.range(ge(lt),Ho(_e),ge(Vt),Ho(zt)),Pe=Ae.data,We=[];for(let Ke of jt){let Dn=this.stride*Ke;We.push(Pe[Dn+ve]>1?fs(Pe,Dn,this.clusterProps):this.points[Pe[Dn+fr]])}return We}getChildren(K){let et=this._getOriginId(K),lt=this._getOriginZoom(K),zt="No cluster with the specified id.",Vt=this.trees[lt];if(!Vt)throw new Error(zt);let _e=Vt.data;if(et*this.stride>=_e.length)throw new Error(zt);let Ae=this.options.radius/(this.options.extent*Math.pow(2,lt-1)),jt=Vt.within(_e[et*this.stride],_e[et*this.stride+1],Ae),Pe=[];for(let We of jt){let Ke=We*this.stride;_e[Ke+4]===K&&Pe.push(_e[Ke+ve]>1?fs(_e,Ke,this.clusterProps):this.points[_e[Ke+fr]])}if(Pe.length===0)throw new Error(zt);return Pe}getLeaves(K,et,lt){let zt=[];return this._appendLeaves(zt,K,et=et||10,lt=lt||0,0),zt}getTile(K,et,lt){let zt=this.trees[this._limitZoom(K)],Vt=Math.pow(2,K),{extent:_e,radius:Ae}=this.options,jt=Ae/_e,Pe=(lt-jt)/Vt,We=(lt+1+jt)/Vt,Ke={features:[]};return this._addTileFeatures(zt.range((et-jt)/Vt,Pe,(et+1+jt)/Vt,We),zt.data,et,lt,Vt,Ke),et===0&&this._addTileFeatures(zt.range(1-jt/Vt,Pe,1,We),zt.data,Vt,lt,Vt,Ke),et===Vt-1&&this._addTileFeatures(zt.range(0,Pe,jt/Vt,We),zt.data,-1,lt,Vt,Ke),Ke.features.length?Ke:null}getClusterExpansionZoom(K){let et=this._getOriginZoom(K)-1;for(;et<=this.options.maxZoom;){let lt=this.getChildren(K);if(et++,lt.length!==1)break;K=lt[0].properties.cluster_id}return et}_appendLeaves(K,et,lt,zt,Vt){let _e=this.getChildren(et);for(let Ae of _e){let jt=Ae.properties;if(jt&&jt.cluster?Vt+jt.point_count<=zt?Vt+=jt.point_count:Vt=this._appendLeaves(K,jt.cluster_id,lt,zt,Vt):Vt<zt?Vt++:K.push(Ae),K.length===lt)break}return Vt}_createTree(K){let et=new d.K(K.length/this.stride|0,this.options.nodeSize,Float32Array);for(let lt=0;lt<K.length;lt+=this.stride)et.add(K[lt],K[lt+1]);return et.finish(),et.data=K,et}_addTileFeatures(K,et,lt,zt,Vt,_e){for(let Ae of K){let jt=Ae*this.stride,Pe=et[jt+ve]>1,We,Ke,Dn;if(Pe)We=Us(et,jt,this.clusterProps),Ke=et[jt],Dn=et[jt+1];else{let _r=this.points[et[jt+fr]];We=_r.properties;let[Or,Un]=_r.geometry.coordinates;Ke=ge(Or),Dn=Ho(Un)}let gr={type:1,geometry:[[Math.round(this.options.extent*(Ke*Vt-lt)),Math.round(this.options.extent*(Dn*Vt-zt))]],tags:We},Io;Io=Pe||this.options.generateId?et[jt+fr]:this.points[et[jt+fr]].id,Io!==void 0&&(gr.id=Io),_e.features.push(gr)}}_limitZoom(K){return Math.max(this.options.minZoom,Math.min(Math.floor(+K),this.options.maxZoom+1))}_cluster(K,et){let{radius:lt,extent:zt,reduce:Vt,minPoints:_e}=this.options,Ae=lt/(zt*Math.pow(2,et)),jt=K.data,Pe=[],We=this.stride;for(let Ke=0;Ke<jt.length;Ke+=We){if(jt[Ke+2]<=et)continue;jt[Ke+2]=et;let Dn=jt[Ke],gr=jt[Ke+1],Io=K.within(jt[Ke],jt[Ke+1],Ae),_r=jt[Ke+ve],Or=_r;for(let Un of Io){let qo=Un*We;jt[qo+2]>et&&(Or+=jt[qo+ve])}if(Or>_r&&Or>=_e){let Un,qo=Dn*_r,ss=gr*_r,as=-1,Wa=((Ke/We|0)<<5)+(et+1)+this.points.length;for(let Zu of Io){let gs=Zu*We;if(jt[gs+2]<=et)continue;jt[gs+2]=et;let Jl=jt[gs+ve];qo+=jt[gs]*Jl,ss+=jt[gs+1]*Jl,jt[gs+4]=Wa,Vt&&(Un||(Un=this._map(jt,Ke,!0),as=this.clusterProps.length,this.clusterProps.push(Un)),Vt(Un,this._map(jt,gs)))}jt[Ke+4]=Wa,Pe.push(qo/Or,ss/Or,1/0,Wa,-1,Or),Vt&&Pe.push(as)}else{for(let Un=0;Un<We;Un++)Pe.push(jt[Ke+Un]);if(Or>1)for(let Un of Io){let qo=Un*We;if(!(jt[qo+2]<=et)){jt[qo+2]=et;for(let ss=0;ss<We;ss++)Pe.push(jt[qo+ss])}}}}return Pe}_getOriginId(K){return K-this.points.length>>5}_getOriginZoom(K){return(K-this.points.length)%32}_map(K,et,lt){if(K[et+ve]>1){let _e=this.clusterProps[K[et+Go]];return lt?Object.assign({},_e):_e}let zt=this.points[K[et+fr]].properties,Vt=this.options.map(zt);return lt&&Vt===zt?Object.assign({},Vt):Vt}}function fs(Yt,K,et){return{type:"Feature",id:Yt[K+fr],properties:Us(Yt,K,et),geometry:{type:"Point",coordinates:[(lt=Yt[K],360*(lt-.5)),Ud(Yt[K+1])]}};var lt}function Us(Yt,K,et){let lt=Yt[K+ve],zt=lt>=1e4?`${Math.round(lt/1e3)}k`:lt>=1e3?Math.round(lt/100)/10+"k":lt,Vt=Yt[K+Go],_e=Vt===-1?{}:Object.assign({},et[Vt]);return Object.assign(_e,{cluster:!0,cluster_id:Yt[K+fr],point_count:lt,point_count_abbreviated:zt})}function ge(Yt){return Yt/360+.5}function Ho(Yt){let K=Math.sin(Yt*Math.PI/180),et=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return et<0?0:et>1?1:et}function Ud(Yt){let K=(180-360*Yt)*Math.PI/180;return 360*Math.atan(Math.exp(K))/Math.PI-90}var Wu={exports:{}};Wu.exports=function(){function Yt(Dt,Ot,Ht,Zt){for(var Xt,ie=Zt,se=Ht-Ot>>1,Kt=Ht-Ot,Ee=Dt[Ot],ne=Dt[Ot+1],mi=Dt[Ht],gn=Dt[Ht+1],Oe=Ot+3;Oe<Ht;Oe+=3){var ln=K(Dt[Oe],Dt[Oe+1],Ee,ne,mi,gn);if(ln>ie)Xt=Oe,ie=ln;else if(ln===ie){var vr=Math.abs(Oe-se);vr<Kt&&(Xt=Oe,Kt=vr)}}ie>Zt&&(Xt-Ot>3&&Yt(Dt,Ot,Xt,Zt),Dt[Xt+2]=ie,Ht-Xt>3&&Yt(Dt,Xt,Ht,Zt))}function K(Dt,Ot,Ht,Zt,Xt,ie){var se=Xt-Ht,Kt=ie-Zt;if(se!==0||Kt!==0){var Ee=((Dt-Ht)*se+(Ot-Zt)*Kt)/(se*se+Kt*Kt);Ee>1?(Ht=Xt,Zt=ie):Ee>0&&(Ht+=se*Ee,Zt+=Kt*Ee)}return(se=Dt-Ht)*se+(Kt=Ot-Zt)*Kt}function et(Dt,Ot,Ht,Zt){var Xt={id:Dt===void 0?null:Dt,type:Ot,geometry:Ht,tags:Zt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ie){var se=ie.geometry,Kt=ie.type;if(Kt==="Point"||Kt==="MultiPoint"||Kt==="LineString")lt(ie,se);else if(Kt==="Polygon"||Kt==="MultiLineString")for(var Ee=0;Ee<se.length;Ee++)lt(ie,se[Ee]);else if(Kt==="MultiPolygon")for(Ee=0;Ee<se.length;Ee++)for(var ne=0;ne<se[Ee].length;ne++)lt(ie,se[Ee][ne])}(Xt),Xt}function lt(Dt,Ot){for(var Ht=0;Ht<Ot.length;Ht+=3)Dt.minX=Math.min(Dt.minX,Ot[Ht]),Dt.minY=Math.min(Dt.minY,Ot[Ht+1]),Dt.maxX=Math.max(Dt.maxX,Ot[Ht]),Dt.maxY=Math.max(Dt.maxY,Ot[Ht+1])}function zt(Dt,Ot,Ht,Zt){if(Ot.geometry){var Xt=Ot.geometry.coordinates,ie=Ot.geometry.type,se=Math.pow(Ht.tolerance/((1<<Ht.maxZoom)*Ht.extent),2),Kt=[],Ee=Ot.id;if(Ht.promoteId?Ee=Ot.properties[Ht.promoteId]:Ht.generateId&&(Ee=Zt||0),ie==="Point")Vt(Xt,Kt);else if(ie==="MultiPoint")for(var ne=0;ne<Xt.length;ne++)Vt(Xt[ne],Kt);else if(ie==="LineString")_e(Xt,Kt,se,!1);else if(ie==="MultiLineString"){if(Ht.lineMetrics){for(ne=0;ne<Xt.length;ne++)_e(Xt[ne],Kt=[],se,!1),Dt.push(et(Ee,"LineString",Kt,Ot.properties));return}Ae(Xt,Kt,se,!1)}else if(ie==="Polygon")Ae(Xt,Kt,se,!0);else{if(ie!=="MultiPolygon"){if(ie==="GeometryCollection"){for(ne=0;ne<Ot.geometry.geometries.length;ne++)zt(Dt,{id:Ee,geometry:Ot.geometry.geometries[ne],properties:Ot.properties},Ht,Zt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ne=0;ne<Xt.length;ne++){var mi=[];Ae(Xt[ne],mi,se,!0),Kt.push(mi)}}Dt.push(et(Ee,ie,Kt,Ot.properties))}}function Vt(Dt,Ot){Ot.push(jt(Dt[0])),Ot.push(Pe(Dt[1])),Ot.push(0)}function _e(Dt,Ot,Ht,Zt){for(var Xt,ie,se=0,Kt=0;Kt<Dt.length;Kt++){var Ee=jt(Dt[Kt][0]),ne=Pe(Dt[Kt][1]);Ot.push(Ee),Ot.push(ne),Ot.push(0),Kt>0&&(se+=Zt?(Xt*ne-Ee*ie)/2:Math.sqrt(Math.pow(Ee-Xt,2)+Math.pow(ne-ie,2))),Xt=Ee,ie=ne}var mi=Ot.length-3;Ot[2]=1,Yt(Ot,0,mi,Ht),Ot[mi+2]=1,Ot.size=Math.abs(se),Ot.start=0,Ot.end=Ot.size}function Ae(Dt,Ot,Ht,Zt){for(var Xt=0;Xt<Dt.length;Xt++){var ie=[];_e(Dt[Xt],ie,Ht,Zt),Ot.push(ie)}}function jt(Dt){return Dt/360+.5}function Pe(Dt){var Ot=Math.sin(Dt*Math.PI/180),Ht=.5-.25*Math.log((1+Ot)/(1-Ot))/Math.PI;return Ht<0?0:Ht>1?1:Ht}function We(Dt,Ot,Ht,Zt,Xt,ie,se,Kt){if(Zt/=Ot,ie>=(Ht/=Ot)&&se<Zt)return Dt;if(se<Ht||ie>=Zt)return null;for(var Ee=[],ne=0;ne<Dt.length;ne++){var mi=Dt[ne],gn=mi.geometry,Oe=mi.type,ln=Xt===0?mi.minX:mi.minY,vr=Xt===0?mi.maxX:mi.maxY;if(ln>=Ht&&vr<Zt)Ee.push(mi);else if(!(vr<Ht||ln>=Zt)){var Fr=[];if(Oe==="Point"||Oe==="MultiPoint")Ke(gn,Fr,Ht,Zt,Xt);else if(Oe==="LineString")Dn(gn,Fr,Ht,Zt,Xt,!1,Kt.lineMetrics);else if(Oe==="MultiLineString")Io(gn,Fr,Ht,Zt,Xt,!1);else if(Oe==="Polygon")Io(gn,Fr,Ht,Zt,Xt,!0);else if(Oe==="MultiPolygon")for(var Qr=0;Qr<gn.length;Qr++){var Wo=[];Io(gn[Qr],Wo,Ht,Zt,Xt,!0),Wo.length&&Fr.push(Wo)}if(Fr.length){if(Kt.lineMetrics&&Oe==="LineString"){for(Qr=0;Qr<Fr.length;Qr++)Ee.push(et(mi.id,Oe,Fr[Qr],mi.tags));continue}Oe!=="LineString"&&Oe!=="MultiLineString"||(Fr.length===1?(Oe="LineString",Fr=Fr[0]):Oe="MultiLineString"),Oe!=="Point"&&Oe!=="MultiPoint"||(Oe=Fr.length===3?"Point":"MultiPoint"),Ee.push(et(mi.id,Oe,Fr,mi.tags))}}}return Ee.length?Ee:null}function Ke(Dt,Ot,Ht,Zt,Xt){for(var ie=0;ie<Dt.length;ie+=3){var se=Dt[ie+Xt];se>=Ht&&se<=Zt&&(Ot.push(Dt[ie]),Ot.push(Dt[ie+1]),Ot.push(Dt[ie+2]))}}function Dn(Dt,Ot,Ht,Zt,Xt,ie,se){for(var Kt,Ee,ne=gr(Dt),mi=Xt===0?Or:Un,gn=Dt.start,Oe=0;Oe<Dt.length-3;Oe+=3){var ln=Dt[Oe],vr=Dt[Oe+1],Fr=Dt[Oe+2],Qr=Dt[Oe+3],Wo=Dt[Oe+4],oa=Xt===0?ln:vr,vo=Xt===0?Qr:Wo,ls=!1;se&&(Kt=Math.sqrt(Math.pow(ln-Qr,2)+Math.pow(vr-Wo,2))),oa<Ht?vo>Ht&&(Ee=mi(ne,ln,vr,Qr,Wo,Ht),se&&(ne.start=gn+Kt*Ee)):oa>Zt?vo<Zt&&(Ee=mi(ne,ln,vr,Qr,Wo,Zt),se&&(ne.start=gn+Kt*Ee)):_r(ne,ln,vr,Fr),vo<Ht&&oa>=Ht&&(Ee=mi(ne,ln,vr,Qr,Wo,Ht),ls=!0),vo>Zt&&oa<=Zt&&(Ee=mi(ne,ln,vr,Qr,Wo,Zt),ls=!0),!ie&&ls&&(se&&(ne.end=gn+Kt*Ee),Ot.push(ne),ne=gr(Dt)),se&&(gn+=Kt)}var $o=Dt.length-3;ln=Dt[$o],vr=Dt[$o+1],Fr=Dt[$o+2],(oa=Xt===0?ln:vr)>=Ht&&oa<=Zt&&_r(ne,ln,vr,Fr),$o=ne.length-3,ie&&$o>=3&&(ne[$o]!==ne[0]||ne[$o+1]!==ne[1])&&_r(ne,ne[0],ne[1],ne[2]),ne.length&&Ot.push(ne)}function gr(Dt){var Ot=[];return Ot.size=Dt.size,Ot.start=Dt.start,Ot.end=Dt.end,Ot}function Io(Dt,Ot,Ht,Zt,Xt,ie){for(var se=0;se<Dt.length;se++)Dn(Dt[se],Ot,Ht,Zt,Xt,ie,!1)}function _r(Dt,Ot,Ht,Zt){Dt.push(Ot),Dt.push(Ht),Dt.push(Zt)}function Or(Dt,Ot,Ht,Zt,Xt,ie){var se=(ie-Ot)/(Zt-Ot);return Dt.push(ie),Dt.push(Ht+(Xt-Ht)*se),Dt.push(1),se}function Un(Dt,Ot,Ht,Zt,Xt,ie){var se=(ie-Ht)/(Xt-Ht);return Dt.push(Ot+(Zt-Ot)*se),Dt.push(ie),Dt.push(1),se}function qo(Dt,Ot){for(var Ht=[],Zt=0;Zt<Dt.length;Zt++){var Xt,ie=Dt[Zt],se=ie.type;if(se==="Point"||se==="MultiPoint"||se==="LineString")Xt=ss(ie.geometry,Ot);else if(se==="MultiLineString"||se==="Polygon"){Xt=[];for(var Kt=0;Kt<ie.geometry.length;Kt++)Xt.push(ss(ie.geometry[Kt],Ot))}else if(se==="MultiPolygon")for(Xt=[],Kt=0;Kt<ie.geometry.length;Kt++){for(var Ee=[],ne=0;ne<ie.geometry[Kt].length;ne++)Ee.push(ss(ie.geometry[Kt][ne],Ot));Xt.push(Ee)}Ht.push(et(ie.id,se,Xt,ie.tags))}return Ht}function ss(Dt,Ot){var Ht=[];Ht.size=Dt.size,Dt.start!==void 0&&(Ht.start=Dt.start,Ht.end=Dt.end);for(var Zt=0;Zt<Dt.length;Zt+=3)Ht.push(Dt[Zt]+Ot,Dt[Zt+1],Dt[Zt+2]);return Ht}function as(Dt,Ot){if(Dt.transformed)return Dt;var Ht,Zt,Xt,ie=1<<Dt.z,se=Dt.x,Kt=Dt.y;for(Ht=0;Ht<Dt.features.length;Ht++){var Ee=Dt.features[Ht],ne=Ee.geometry,mi=Ee.type;if(Ee.geometry=[],mi===1)for(Zt=0;Zt<ne.length;Zt+=2)Ee.geometry.push(Wa(ne[Zt],ne[Zt+1],Ot,ie,se,Kt));else for(Zt=0;Zt<ne.length;Zt++){var gn=[];for(Xt=0;Xt<ne[Zt].length;Xt+=2)gn.push(Wa(ne[Zt][Xt],ne[Zt][Xt+1],Ot,ie,se,Kt));Ee.geometry.push(gn)}}return Dt.transformed=!0,Dt}function Wa(Dt,Ot,Ht,Zt,Xt,ie){return[Math.round(Ht*(Dt*Zt-Xt)),Math.round(Ht*(Ot*Zt-ie))]}function Zu(Dt,Ot,Ht,Zt,Xt){for(var ie=Ot===Xt.maxZoom?0:Xt.tolerance/((1<<Ot)*Xt.extent),se={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Ht,y:Zt,z:Ot,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Kt=0;Kt<Dt.length;Kt++){se.numFeatures++,gs(se,Dt[Kt],ie,Xt);var Ee=Dt[Kt].minX,ne=Dt[Kt].minY,mi=Dt[Kt].maxX,gn=Dt[Kt].maxY;Ee<se.minX&&(se.minX=Ee),ne<se.minY&&(se.minY=ne),mi>se.maxX&&(se.maxX=mi),gn>se.maxY&&(se.maxY=gn)}return se}function gs(Dt,Ot,Ht,Zt){var Xt=Ot.geometry,ie=Ot.type,se=[];if(ie==="Point"||ie==="MultiPoint")for(var Kt=0;Kt<Xt.length;Kt+=3)se.push(Xt[Kt]),se.push(Xt[Kt+1]),Dt.numPoints++,Dt.numSimplified++;else if(ie==="LineString")Jl(se,Xt,Dt,Ht,!1,!1);else if(ie==="MultiLineString"||ie==="Polygon")for(Kt=0;Kt<Xt.length;Kt++)Jl(se,Xt[Kt],Dt,Ht,ie==="Polygon",Kt===0);else if(ie==="MultiPolygon")for(var Ee=0;Ee<Xt.length;Ee++){var ne=Xt[Ee];for(Kt=0;Kt<ne.length;Kt++)Jl(se,ne[Kt],Dt,Ht,!0,Kt===0)}if(se.length){var mi=Ot.tags||null;if(ie==="LineString"&&Zt.lineMetrics){for(var gn in mi={},Ot.tags)mi[gn]=Ot.tags[gn];mi.mapbox_clip_start=Xt.start/Xt.size,mi.mapbox_clip_end=Xt.end/Xt.size}var Oe={geometry:se,type:ie==="Polygon"||ie==="MultiPolygon"?3:ie==="LineString"||ie==="MultiLineString"?2:1,tags:mi};Ot.id!==null&&(Oe.id=Ot.id),Dt.features.push(Oe)}}function Jl(Dt,Ot,Ht,Zt,Xt,ie){var se=Zt*Zt;if(Zt>0&&Ot.size<(Xt?se:Zt))Ht.numPoints+=Ot.length/3;else{for(var Kt=[],Ee=0;Ee<Ot.length;Ee+=3)(Zt===0||Ot[Ee+2]>se)&&(Ht.numSimplified++,Kt.push(Ot[Ee]),Kt.push(Ot[Ee+1])),Ht.numPoints++;Xt&&function(ne,mi){for(var gn=0,Oe=0,ln=ne.length,vr=ln-2;Oe<ln;vr=Oe,Oe+=2)gn+=(ne[Oe]-ne[vr])*(ne[Oe+1]+ne[vr+1]);if(gn>0===mi)for(Oe=0,ln=ne.length;Oe<ln/2;Oe+=2){var Fr=ne[Oe],Qr=ne[Oe+1];ne[Oe]=ne[ln-2-Oe],ne[Oe+1]=ne[ln-1-Oe],ne[ln-2-Oe]=Fr,ne[ln-1-Oe]=Qr}}(Kt,ie),Dt.push(Kt)}}function zc(Dt,Ot){var Ht=(Ot=this.options=function(Xt,ie){for(var se in ie)Xt[se]=ie[se];return Xt}(Object.create(this.options),Ot)).debug;if(Ht&&console.time("preprocess data"),Ot.maxZoom<0||Ot.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Ot.promoteId&&Ot.generateId)throw new Error("promoteId and generateId cannot be used together.");var Zt=function(Xt,ie){var se=[];if(Xt.type==="FeatureCollection")for(var Kt=0;Kt<Xt.features.length;Kt++)zt(se,Xt.features[Kt],ie,Kt);else zt(se,Xt.type==="Feature"?Xt:{geometry:Xt},ie);return se}(Dt,Ot);this.tiles={},this.tileCoords=[],Ht&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Ot.indexMaxZoom,Ot.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Zt=function(Xt,ie){var se=ie.buffer/ie.extent,Kt=Xt,Ee=We(Xt,1,-1-se,se,0,-1,2,ie),ne=We(Xt,1,1-se,2+se,0,-1,2,ie);return(Ee||ne)&&(Kt=We(Xt,1,-se,1+se,0,-1,2,ie)||[],Ee&&(Kt=qo(Ee,1).concat(Kt)),ne&&(Kt=Kt.concat(qo(ne,-1)))),Kt}(Zt,Ot)).length&&this.splitTile(Zt,0,0,0),Ht&&(Zt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Xu(Dt,Ot,Ht){return 32*((1<<Dt)*Ht+Ot)+Dt}return zc.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},zc.prototype.splitTile=function(Dt,Ot,Ht,Zt,Xt,ie,se){for(var Kt=[Dt,Ot,Ht,Zt],Ee=this.options,ne=Ee.debug;Kt.length;){Zt=Kt.pop(),Ht=Kt.pop(),Ot=Kt.pop(),Dt=Kt.pop();var mi=1<<Ot,gn=Xu(Ot,Ht,Zt),Oe=this.tiles[gn];if(!Oe&&(ne>1&&console.time("creation"),Oe=this.tiles[gn]=Zu(Dt,Ot,Ht,Zt,Ee),this.tileCoords.push({z:Ot,x:Ht,y:Zt}),ne)){ne>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ot,Ht,Zt,Oe.numFeatures,Oe.numPoints,Oe.numSimplified),console.timeEnd("creation"));var ln="z"+Ot;this.stats[ln]=(this.stats[ln]||0)+1,this.total++}if(Oe.source=Dt,Xt){if(Ot===Ee.maxZoom||Ot===Xt)continue;var vr=1<<Xt-Ot;if(Ht!==Math.floor(ie/vr)||Zt!==Math.floor(se/vr))continue}else if(Ot===Ee.indexMaxZoom||Oe.numPoints<=Ee.indexMaxPoints)continue;if(Oe.source=null,Dt.length!==0){ne>1&&console.time("clipping");var Fr,Qr,Wo,oa,vo,ls,$o=.5*Ee.buffer/Ee.extent,Ku=.5-$o,Nc=.5+$o,Qu=1+$o;Fr=Qr=Wo=oa=null,vo=We(Dt,mi,Ht-$o,Ht+Nc,0,Oe.minX,Oe.maxX,Ee),ls=We(Dt,mi,Ht+Ku,Ht+Qu,0,Oe.minX,Oe.maxX,Ee),Dt=null,vo&&(Fr=We(vo,mi,Zt-$o,Zt+Nc,1,Oe.minY,Oe.maxY,Ee),Qr=We(vo,mi,Zt+Ku,Zt+Qu,1,Oe.minY,Oe.maxY,Ee),vo=null),ls&&(Wo=We(ls,mi,Zt-$o,Zt+Nc,1,Oe.minY,Oe.maxY,Ee),oa=We(ls,mi,Zt+Ku,Zt+Qu,1,Oe.minY,Oe.maxY,Ee),ls=null),ne>1&&console.timeEnd("clipping"),Kt.push(Fr||[],Ot+1,2*Ht,2*Zt),Kt.push(Qr||[],Ot+1,2*Ht,2*Zt+1),Kt.push(Wo||[],Ot+1,2*Ht+1,2*Zt),Kt.push(oa||[],Ot+1,2*Ht+1,2*Zt+1)}}},zc.prototype.getTile=function(Dt,Ot,Ht){var Zt=this.options,Xt=Zt.extent,ie=Zt.debug;if(Dt<0||Dt>24)return null;var se=1<<Dt,Kt=Xu(Dt,Ot=(Ot%se+se)%se,Ht);if(this.tiles[Kt])return as(this.tiles[Kt],Xt);ie>1&&console.log("drilling down to z%d-%d-%d",Dt,Ot,Ht);for(var Ee,ne=Dt,mi=Ot,gn=Ht;!Ee&&ne>0;)ne--,mi=Math.floor(mi/2),gn=Math.floor(gn/2),Ee=this.tiles[Xu(ne,mi,gn)];return Ee&&Ee.source?(ie>1&&console.log("found parent tile z%d-%d-%d",ne,mi,gn),ie>1&&console.time("drilling down"),this.splitTile(Ee.source,ne,mi,gn,Dt,Ot,Ht),ie>1&&console.timeEnd("drilling down"),this.tiles[Kt]?as(this.tiles[Kt],Xt):null):null},function(Dt,Ot){return new zc(Dt,Ot)}}();var Kg=d.g(Wu.exports);function Qg(Yt,K){let et=Yt.tileID.canonical;if(!this._geoJSONIndex)return K(null,null);let lt=this._geoJSONIndex.getTile(et.z,et.x,et.y);if(!lt)return K(null,null);let zt=new class{constructor(_e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.E,this.length=_e.length,this._features=_e}feature(_e){return new class{constructor(Ae){this._feature=Ae,this.extent=d.E,this.type=Ae.type,this.properties=Ae.tags,"id"in Ae&&!isNaN(Ae.id)&&(this.id=parseInt(Ae.id,10))}loadGeometry(){if(this._feature.type===1){let Ae=[];for(let jt of this._feature.geometry)Ae.push([new d.P(jt[0],jt[1])]);return Ae}{let Ae=[];for(let jt of this._feature.geometry){let Pe=[];for(let We of jt)Pe.push(new d.P(We[0],We[1]));Ae.push(Pe)}return Ae}}toGeoJSON(Ae,jt,Pe){return q.call(this,Ae,jt,Pe)}}(this._features[_e])}}(lt.features),Vt=Cr(zt);Vt.byteOffset===0&&Vt.byteLength===Vt.buffer.byteLength||(Vt=new Uint8Array(Vt)),K(null,{vectorTile:zt,rawData:Vt.buffer})}class Jg extends d.d{constructor(K,et,lt,zt,Vt,_e){super(K,et,lt,zt,Qg,_e),Vt&&(this.loadGeoJSON=Vt)}loadData(K,et){let lt=K&&K.request,zt=lt&&lt.collectResourceTiming;this.loadGeoJSON(K,(Vt,_e)=>{if(Vt||!_e)return et(Vt);if(typeof _e!="object")return et(new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`));{H(_e,!0);try{if(K.filter){let jt=d.e(K.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(jt.result==="error")throw new Error(jt.value.map(We=>`${We.key}: ${We.message}`).join(", "));_e={type:"FeatureCollection",features:_e.features.filter(We=>jt.value.evaluate({zoom:0},We))}}this._geoJSONIndex=K.cluster?new os(function({superclusterOptions:jt,clusterProperties:Pe}){if(!Pe||!jt)return jt;let We={},Ke={},Dn={accumulated:null,zoom:0},gr={properties:null},Io=Object.keys(Pe);for(let _r of Io){let[Or,Un]=Pe[_r],qo=d.e(Un),ss=d.e(typeof Or=="string"?[Or,["accumulated"],["get",_r]]:Or);We[_r]=qo.value,Ke[_r]=ss.value}return jt.map=_r=>{gr.properties=_r;let Or={};for(let Un of Io)Or[Un]=We[Un].evaluate(Dn,gr);return Or},jt.reduce=(_r,Or)=>{gr.properties=Or;for(let Un of Io)Dn.accumulated=_r[Un],_r[Un]=Ke[Un].evaluate(Dn,gr)},jt}(K)).load(_e.features):Kg(_e,K.geojsonVtOptions)}catch(jt){return et(jt)}this.loaded={};let Ae={};if(zt){let jt=d.f(lt);jt&&(Ae.resourceTiming={},Ae.resourceTiming[K.source]=JSON.parse(JSON.stringify(jt)))}et(null,Ae)}})}reloadTile(K,et){let lt=this.loaded;return lt&&lt[K.uid]?super.reloadTile(K,et):this.loadTile(K,et)}loadGeoJSON(K,et){if(K.request)d.h(K.request,et);else{if(typeof K.data!="string")return et(new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`));try{return et(null,JSON.parse(K.data))}catch{return et(new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(K,et){try{et(null,this._geoJSONIndex.getClusterExpansionZoom(K.clusterId))}catch(lt){et(lt)}}getClusterChildren(K,et){try{et(null,this._geoJSONIndex.getChildren(K.clusterId))}catch(lt){et(lt)}}getClusterLeaves(K,et){try{et(null,this._geoJSONIndex.getLeaves(K.clusterId,K.limit,K.offset))}catch(lt){et(lt)}}}class _o{constructor(K,et){this.tileID=new d.O(K.tileID.overscaledZ,K.tileID.wrap,K.tileID.canonical.z,K.tileID.canonical.x,K.tileID.canonical.y),this.tileZoom=K.tileZoom,this.uid=K.uid,this.zoom=K.zoom,this.canonical=K.tileID.canonical,this.pixelRatio=K.pixelRatio,this.tileSize=K.tileSize,this.source=K.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=K.projection,this.brightness=et}parse(K,et,lt,zt){this.status="parsing";let Vt=new d.O(lt.tileID.overscaledZ,lt.tileID.wrap,lt.tileID.canonical.z,lt.tileID.canonical.x,lt.tileID.canonical.y),_e={},Ae=et.familiesBySource[lt.source],jt=new d.F(Vt,lt.promoteId);return jt.bucketLayerIDs=[],d.l(K).then(Pe=>{if(!Pe)return zt(new Error("Could not parse tile"));let We=d.j(Pe,1/d.t(lt.tileID.canonical)),Ke=Pe.json.extensionsUsed&&Pe.json.extensionsUsed.includes("MAPBOX_mesh_features"),Dn=new d.k(this.zoom,{brightness:this.brightness});for(let gr in Ae)for(let Io of Ae[gr]){let _r=Io[0],Or=Pe.json.extensionsUsed;_r.recalculate(Dn,[]);let Un=new d.T(We,Vt,Or&&Or.includes("MAPBOX_mesh_features"),this.brightness);Ke||(Un.needsUpload=!0),_e[_r.fqid]=Un,Un.evaluate(_r)}this.status="done",zt(null,{buckets:_e,featureIndex:jt})}).catch(Pe=>zt(new Error(Pe.message)))}}class $u{constructor(K,et,lt,zt,Vt,_e){this.actor=K,this.layerIndex=et,this.brightness=_e,this.loading={},this.loaded={}}loadTile(K,et){let lt=K.uid,zt=this.loading[lt]=new _o(K,this.brightness);d.i(K.request,(Vt,_e)=>{let Ae=!this.loading[lt];return delete this.loading[lt],Ae||Vt?(zt.status="done",Ae||(this.loaded[lt]=zt),et(Vt)):_e&&_e.byteLength!==0?void zt.parse(_e,this.layerIndex,K,(jt,Pe)=>{zt.status="done",this.loaded=this.loaded||{},this.loaded[lt]=zt,jt||!Pe?et(jt):et(null,Pe)}):(zt.status="done",this.loaded[lt]=zt,et())})}reloadTile(K,et){let lt=this.loaded,zt=K.uid;if(lt&&lt[zt]){let Vt=lt[zt];Vt.projection=K.projection,Vt.brightness=K.brightness;let _e=(Ae,jt)=>{Vt.reloadCallback&&(delete Vt.reloadCallback,this.loadTile(K,et)),et(Ae,jt)};Vt.status==="parsing"?Vt.reloadCallback=_e:Vt.status==="done"&&this.loadTile(K,et)}}abortTile(K,et){let lt=K.uid;this.loading[lt]&&delete this.loading[lt],et()}removeTile(K,et){let lt=this.loaded,zt=K.uid;lt&&lt[zt]&&delete lt[zt],et()}}class Yu{constructor(K){this.self=K,this.actor=new d.A(K,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=d.m({name:"mercator"}),this.workerSourceTypes={vector:d.d,geojson:Jg,"batched-model":$u},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(et,lt)=>{if(this.workerSourceTypes[et])throw new Error(`Worker source with name "${et}" already registered.`);this.workerSourceTypes[et]=lt},this.self.registerRTLTextPlugin=et=>{if(d.n.isParsed())throw new Error("RTL text plugin already registered.");d.n.applyArabicShaping=et.applyArabicShaping,d.n.processBidirectionalText=et.processBidirectionalText,d.n.processStyledBidirectionalText=et.processStyledBidirectionalText}}clearCaches(K,et,lt){delete this.layerIndexes[K],delete this.availableImages[K],delete this.workerSources[K],delete this.demWorkerSources[K],lt()}checkIfReady(K,et,lt){lt()}setReferrer(K,et){this.referrer=et}spriteLoaded(K,{scope:et,isLoaded:lt}){if(this.isSpriteLoaded[K]||(this.isSpriteLoaded[K]={}),this.isSpriteLoaded[K][et]=lt,this.workerSources[K]&&this.workerSources[K][et])for(let zt in this.workerSources[K][et]){let Vt=this.workerSources[K][et][zt];for(let _e in Vt)Vt[_e]instanceof d.d&&(Vt[_e].isSpriteLoaded=lt,Vt[_e].fire(new d.o("isSpriteLoaded")))}}setImages(K,{scope:et,images:lt},zt){if(this.availableImages[K]||(this.availableImages[K]={}),this.availableImages[K][et]=lt,this.workerSources[K]&&this.workerSources[K][et]){for(let Vt in this.workerSources[K][et]){let _e=this.workerSources[K][et][Vt];for(let Ae in _e)_e[Ae].availableImages=lt}zt()}else zt()}setProjection(K,et){this.projections[K]=d.m(et)}setBrightness(K,et,lt){this.brightness=et,lt()}setLayers(K,et,lt){this.getLayerIndex(K,et.scope).replace(et.layers,et.options),lt()}updateLayers(K,et,lt){this.getLayerIndex(K,et.scope).update(et.layers,et.removedIds,et.options),lt()}loadTile(K,et,lt){et.projection=this.projections[K]||this.defaultProjection,this.getWorkerSource(K,et.type,et.source,et.scope).loadTile(et,lt)}loadDEMTile(K,et,lt){this.getDEMWorkerSource(K,et.source,et.scope).loadTile(et,lt)}reloadTile(K,et,lt){et.projection=this.projections[K]||this.defaultProjection,this.getWorkerSource(K,et.type,et.source,et.scope).reloadTile(et,lt)}abortTile(K,et,lt){this.getWorkerSource(K,et.type,et.source,et.scope).abortTile(et,lt)}removeTile(K,et,lt){this.getWorkerSource(K,et.type,et.source,et.scope).removeTile(et,lt)}removeSource(K,et,lt){if(!(this.workerSources[K]&&this.workerSources[K][et.scope]&&this.workerSources[K][et.scope][et.type]&&this.workerSources[K][et.scope][et.type][et.source]))return;let zt=this.workerSources[K][et.scope][et.type][et.source];delete this.workerSources[K][et.scope][et.type][et.source],zt.removeSource!==void 0?zt.removeSource(et,lt):lt()}loadWorkerSource(K,et,lt){try{this.self.importScripts(et.url),lt()}catch(zt){lt(zt.toString())}}syncRTLPluginState(K,et,lt){try{d.n.setState(et);let zt=d.n.getPluginURL();if(d.n.isLoaded()&&!d.n.isParsed()&&zt!=null){this.self.importScripts(zt);let Vt=d.n.isParsed();lt(Vt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${zt}`),Vt)}}catch(zt){lt(zt.toString())}}setDracoUrl(K,et){this.dracoUrl=et}getAvailableImages(K,et){this.availableImages[K]||(this.availableImages[K]={});let lt=this.availableImages[K][et];return lt||(lt=[]),lt}getLayerIndex(K,et){this.layerIndexes[K]||(this.layerIndexes[K]={});let lt=this.layerIndexes[K][et];return lt||(lt=this.layerIndexes[K][et]=new w,lt.scope=et),lt}getWorkerSource(K,et,lt,zt){if(this.workerSources[K]||(this.workerSources[K]={}),this.workerSources[K][zt]||(this.workerSources[K][zt]={}),this.workerSources[K][zt][et]||(this.workerSources[K][zt][et]={}),this.isSpriteLoaded[K]||(this.isSpriteLoaded[K]={}),!this.workerSources[K][zt][et][lt]){let Vt={send:(_e,Ae,jt,Pe,We,Ke)=>{this.actor.send(_e,Ae,jt,K,We,Ke)},scheduler:this.actor.scheduler};this.workerSources[K][zt][et][lt]=new this.workerSourceTypes[et](Vt,this.getLayerIndex(K,zt),this.getAvailableImages(K,zt),this.isSpriteLoaded[K][zt],void 0,this.brightness)}return this.workerSources[K][zt][et][lt]}getDEMWorkerSource(K,et,lt){return this.demWorkerSources[K]||(this.demWorkerSources[K]={}),this.demWorkerSources[K][lt]||(this.demWorkerSources[K][lt]={}),this.demWorkerSources[K][lt][et]||(this.demWorkerSources[K][lt][et]=new S),this.demWorkerSources[K][lt][et]}enforceCacheSizeLimit(K,et){d.q(et)}getWorkerPerformanceMetrics(K,et,lt){lt(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Yu(self)),Yu}),n(["./shared"],function(d){"use strict";return d.s});var s=l;return s})});var Mf=class{},Ov=class{},Cu=class a{constructor(r){this.normalizedNames=new Map,this.lazyUpdate=null,r?typeof r=="string"?this.lazyInit=()=>{this.headers=new Map,r.split(`
`).forEach(l=>{let n=l.indexOf(":");if(n>0){let s=l.slice(0,n),d=s.toLowerCase(),m=l.slice(n+1).trim();this.maybeSetNormalizedName(s,d),this.headers.has(d)?this.headers.get(d).push(m):this.headers.set(d,[m])}})}:typeof Headers<"u"&&r instanceof Headers?(this.headers=new Map,r.forEach((l,n)=>{this.setHeaderEntries(n,l)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(r).forEach(([l,n])=>{this.setHeaderEntries(l,n)})}:this.headers=new Map}has(r){return this.init(),this.headers.has(r.toLowerCase())}get(r){this.init();let l=this.headers.get(r.toLowerCase());return l&&l.length>0?l[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(r){return this.init(),this.headers.get(r.toLowerCase())||null}append(r,l){return this.clone({name:r,value:l,op:"a"})}set(r,l){return this.clone({name:r,value:l,op:"s"})}delete(r,l){return this.clone({name:r,value:l,op:"d"})}maybeSetNormalizedName(r,l){this.normalizedNames.has(l)||this.normalizedNames.set(l,r)}init(){this.lazyInit&&(this.lazyInit instanceof a?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(r=>this.applyUpdate(r)),this.lazyUpdate=null))}copyFrom(r){r.init(),Array.from(r.headers.keys()).forEach(l=>{this.headers.set(l,r.headers.get(l)),this.normalizedNames.set(l,r.normalizedNames.get(l))})}clone(r){let l=new a;return l.lazyInit=this.lazyInit&&this.lazyInit instanceof a?this.lazyInit:this,l.lazyUpdate=(this.lazyUpdate||[]).concat([r]),l}applyUpdate(r){let l=r.name.toLowerCase();switch(r.op){case"a":case"s":let n=r.value;if(typeof n=="string"&&(n=[n]),n.length===0)return;this.maybeSetNormalizedName(r.name,l);let s=(r.op==="a"?this.headers.get(l):void 0)||[];s.push(...n),this.headers.set(l,s);break;case"d":let d=r.value;if(!d)this.headers.delete(l),this.normalizedNames.delete(l);else{let m=this.headers.get(l);if(!m)return;m=m.filter(_=>d.indexOf(_)===-1),m.length===0?(this.headers.delete(l),this.normalizedNames.delete(l)):this.headers.set(l,m)}break}}setHeaderEntries(r,l){let n=(Array.isArray(l)?l:[l]).map(d=>d.toString()),s=r.toLowerCase();this.headers.set(s,n),this.maybeSetNormalizedName(r,s)}forEach(r){this.init(),Array.from(this.normalizedNames.keys()).forEach(l=>r(this.normalizedNames.get(l),this.headers.get(l)))}};var zS=class{encodeKey(r){return uL(r)}encodeValue(r){return uL(r)}decodeKey(r){return decodeURIComponent(r)}decodeValue(r){return decodeURIComponent(r)}};function O$(a,r){let l=new Map;return a.length>0&&a.replace(/^\?/,"").split("&").forEach(s=>{let d=s.indexOf("="),[m,_]=d==-1?[r.decodeKey(s),""]:[r.decodeKey(s.slice(0,d)),r.decodeValue(s.slice(d+1))],w=l.get(m)||[];w.push(_),l.set(m,w)}),l}var F$=/%(\d[a-f0-9])/gi,L$={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function uL(a){return encodeURIComponent(a).replace(F$,(r,l)=>L$[l]??r)}function Pv(a){return`${a}`}var Vl=class a{constructor(r={}){if(this.updates=null,this.cloneFrom=null,this.encoder=r.encoder||new zS,r.fromString){if(r.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=O$(r.fromString,this.encoder)}else r.fromObject?(this.map=new Map,Object.keys(r.fromObject).forEach(l=>{let n=r.fromObject[l],s=Array.isArray(n)?n.map(Pv):[Pv(n)];this.map.set(l,s)})):this.map=null}has(r){return this.init(),this.map.has(r)}get(r){this.init();let l=this.map.get(r);return l?l[0]:null}getAll(r){return this.init(),this.map.get(r)||null}keys(){return this.init(),Array.from(this.map.keys())}append(r,l){return this.clone({param:r,value:l,op:"a"})}appendAll(r){let l=[];return Object.keys(r).forEach(n=>{let s=r[n];Array.isArray(s)?s.forEach(d=>{l.push({param:n,value:d,op:"a"})}):l.push({param:n,value:s,op:"a"})}),this.clone(l)}set(r,l){return this.clone({param:r,value:l,op:"s"})}delete(r,l){return this.clone({param:r,value:l,op:"d"})}toString(){return this.init(),this.keys().map(r=>{let l=this.encoder.encodeKey(r);return this.map.get(r).map(n=>l+"="+this.encoder.encodeValue(n)).join("&")}).filter(r=>r!=="").join("&")}clone(r){let l=new a({encoder:this.encoder});return l.cloneFrom=this.cloneFrom||this,l.updates=(this.updates||[]).concat(r),l}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(r=>this.map.set(r,this.cloneFrom.map.get(r))),this.updates.forEach(r=>{switch(r.op){case"a":case"s":let l=(r.op==="a"?this.map.get(r.param):void 0)||[];l.push(Pv(r.value)),this.map.set(r.param,l);break;case"d":if(r.value!==void 0){let n=this.map.get(r.param)||[],s=n.indexOf(Pv(r.value));s!==-1&&n.splice(s,1),n.length>0?this.map.set(r.param,n):this.map.delete(r.param)}else{this.map.delete(r.param);break}}}),this.cloneFrom=this.updates=null)}};var NS=class{constructor(){this.map=new Map}set(r,l){return this.map.set(r,l),this}get(r){return this.map.has(r)||this.map.set(r,r.defaultValue()),this.map.get(r)}delete(r){return this.map.delete(r),this}has(r){return this.map.has(r)}keys(){return this.map.keys()}};function z$(a){switch(a){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function hL(a){return typeof ArrayBuffer<"u"&&a instanceof ArrayBuffer}function mL(a){return typeof Blob<"u"&&a instanceof Blob}function pL(a){return typeof FormData<"u"&&a instanceof FormData}function N$(a){return typeof URLSearchParams<"u"&&a instanceof URLSearchParams}var Ef=class a{constructor(r,l,n,s){this.url=l,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=r.toUpperCase();let d;if(z$(this.method)||s?(this.body=n!==void 0?n:null,d=s):d=n,d&&(this.reportProgress=!!d.reportProgress,this.withCredentials=!!d.withCredentials,d.responseType&&(this.responseType=d.responseType),d.headers&&(this.headers=d.headers),d.context&&(this.context=d.context),d.params&&(this.params=d.params),this.transferCache=d.transferCache),this.headers??=new Cu,this.context??=new NS,!this.params)this.params=new Vl,this.urlWithParams=l;else{let m=this.params.toString();if(m.length===0)this.urlWithParams=l;else{let _=l.indexOf("?"),w=_===-1?"?":_<l.length-1?"&":"";this.urlWithParams=l+w+m}}}serializeBody(){return this.body===null?null:hL(this.body)||mL(this.body)||pL(this.body)||N$(this.body)||typeof this.body=="string"?this.body:this.body instanceof Vl?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||pL(this.body)?null:mL(this.body)?this.body.type||null:hL(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof Vl?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(r={}){let l=r.method||this.method,n=r.url||this.url,s=r.responseType||this.responseType,d=r.body!==void 0?r.body:this.body,m=r.withCredentials!==void 0?r.withCredentials:this.withCredentials,_=r.reportProgress!==void 0?r.reportProgress:this.reportProgress,w=r.headers||this.headers,S=r.params||this.params,T=r.context??this.context;return r.setHeaders!==void 0&&(w=Object.keys(r.setHeaders).reduce((L,H)=>L.set(H,r.setHeaders[H]),w)),r.setParams&&(S=Object.keys(r.setParams).reduce((L,H)=>L.set(H,r.setParams[H]),S)),new a(l,n,d,{params:S,headers:w,context:T,reportProgress:_,responseType:s,withCredentials:m})}},em=function(a){return a[a.Sent=0]="Sent",a[a.UploadProgress=1]="UploadProgress",a[a.ResponseHeader=2]="ResponseHeader",a[a.DownloadProgress=3]="DownloadProgress",a[a.Response=4]="Response",a[a.User=5]="User",a}(em||{}),Df=class{constructor(r,l=Lv.Ok,n="OK"){this.headers=r.headers||new Cu,this.status=r.status!==void 0?r.status:l,this.statusText=r.statusText||n,this.url=r.url||null,this.ok=this.status>=200&&this.status<300}},BS=class a extends Df{constructor(r={}){super(r),this.type=em.ResponseHeader}clone(r={}){return new a({headers:r.headers||this.headers,status:r.status!==void 0?r.status:this.status,statusText:r.statusText||this.statusText,url:r.url||this.url||void 0})}},im=class a extends Df{constructor(r={}){super(r),this.type=em.Response,this.body=r.body!==void 0?r.body:null}clone(r={}){return new a({body:r.body!==void 0?r.body:this.body,headers:r.headers||this.headers,status:r.status!==void 0?r.status:this.status,statusText:r.statusText||this.statusText,url:r.url||this.url||void 0})}},Fv=class extends Df{constructor(r){super(r,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${r.url||"(unknown url)"}`:this.message=`Http failure response for ${r.url||"(unknown url)"}: ${r.status} ${r.statusText}`,this.error=r.error||null}},Lv=function(a){return a[a.Continue=100]="Continue",a[a.SwitchingProtocols=101]="SwitchingProtocols",a[a.Processing=102]="Processing",a[a.EarlyHints=103]="EarlyHints",a[a.Ok=200]="Ok",a[a.Created=201]="Created",a[a.Accepted=202]="Accepted",a[a.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",a[a.NoContent=204]="NoContent",a[a.ResetContent=205]="ResetContent",a[a.PartialContent=206]="PartialContent",a[a.MultiStatus=207]="MultiStatus",a[a.AlreadyReported=208]="AlreadyReported",a[a.ImUsed=226]="ImUsed",a[a.MultipleChoices=300]="MultipleChoices",a[a.MovedPermanently=301]="MovedPermanently",a[a.Found=302]="Found",a[a.SeeOther=303]="SeeOther",a[a.NotModified=304]="NotModified",a[a.UseProxy=305]="UseProxy",a[a.Unused=306]="Unused",a[a.TemporaryRedirect=307]="TemporaryRedirect",a[a.PermanentRedirect=308]="PermanentRedirect",a[a.BadRequest=400]="BadRequest",a[a.Unauthorized=401]="Unauthorized",a[a.PaymentRequired=402]="PaymentRequired",a[a.Forbidden=403]="Forbidden",a[a.NotFound=404]="NotFound",a[a.MethodNotAllowed=405]="MethodNotAllowed",a[a.NotAcceptable=406]="NotAcceptable",a[a.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",a[a.RequestTimeout=408]="RequestTimeout",a[a.Conflict=409]="Conflict",a[a.Gone=410]="Gone",a[a.LengthRequired=411]="LengthRequired",a[a.PreconditionFailed=412]="PreconditionFailed",a[a.PayloadTooLarge=413]="PayloadTooLarge",a[a.UriTooLong=414]="UriTooLong",a[a.UnsupportedMediaType=415]="UnsupportedMediaType",a[a.RangeNotSatisfiable=416]="RangeNotSatisfiable",a[a.ExpectationFailed=417]="ExpectationFailed",a[a.ImATeapot=418]="ImATeapot",a[a.MisdirectedRequest=421]="MisdirectedRequest",a[a.UnprocessableEntity=422]="UnprocessableEntity",a[a.Locked=423]="Locked",a[a.FailedDependency=424]="FailedDependency",a[a.TooEarly=425]="TooEarly",a[a.UpgradeRequired=426]="UpgradeRequired",a[a.PreconditionRequired=428]="PreconditionRequired",a[a.TooManyRequests=429]="TooManyRequests",a[a.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",a[a.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",a[a.InternalServerError=500]="InternalServerError",a[a.NotImplemented=501]="NotImplemented",a[a.BadGateway=502]="BadGateway",a[a.ServiceUnavailable=503]="ServiceUnavailable",a[a.GatewayTimeout=504]="GatewayTimeout",a[a.HttpVersionNotSupported=505]="HttpVersionNotSupported",a[a.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",a[a.InsufficientStorage=507]="InsufficientStorage",a[a.LoopDetected=508]="LoopDetected",a[a.NotExtended=510]="NotExtended",a[a.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",a}(Lv||{});function LS(a,r){return{body:r,headers:a.headers,context:a.context,observe:a.observe,params:a.params,reportProgress:a.reportProgress,responseType:a.responseType,withCredentials:a.withCredentials,transferCache:a.transferCache}}var Gi=(()=>{let r=class r{constructor(n){this.handler=n}request(n,s,d={}){let m;if(n instanceof Ef)m=n;else{let S;d.headers instanceof Cu?S=d.headers:S=new Cu(d.headers);let T;d.params&&(d.params instanceof Vl?T=d.params:T=new Vl({fromObject:d.params})),m=new Ef(n,s,d.body!==void 0?d.body:null,{headers:S,context:d.context,params:T,reportProgress:d.reportProgress,responseType:d.responseType||"json",withCredentials:d.withCredentials,transferCache:d.transferCache})}let _=Fe(m).pipe(fu(S=>this.handler.handle(S)));if(n instanceof Ef||d.observe==="events")return _;let w=_.pipe(wn(S=>S instanceof im));switch(d.observe||"body"){case"body":switch(m.responseType){case"arraybuffer":return w.pipe(Fi(S=>{if(S.body!==null&&!(S.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return S.body}));case"blob":return w.pipe(Fi(S=>{if(S.body!==null&&!(S.body instanceof Blob))throw new Error("Response is not a Blob.");return S.body}));case"text":return w.pipe(Fi(S=>{if(S.body!==null&&typeof S.body!="string")throw new Error("Response is not a string.");return S.body}));case"json":default:return w.pipe(Fi(S=>S.body))}case"response":return w;default:throw new Error(`Unreachable: unhandled observe type ${d.observe}}`)}}delete(n,s={}){return this.request("DELETE",n,s)}get(n,s={}){return this.request("GET",n,s)}head(n,s={}){return this.request("HEAD",n,s)}jsonp(n,s){return this.request("JSONP",n,{params:new Vl().append(s,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(n,s={}){return this.request("OPTIONS",n,s)}patch(n,s,d={}){return this.request("PATCH",n,LS(d,s))}post(n,s,d={}){return this.request("POST",n,LS(d,s))}put(n,s,d={}){return this.request("PUT",n,LS(d,s))}};r.\u0275fac=function(s){return new(s||r)(ht(Mf))},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})();function vL(a,r){return r(a)}function B$(a,r){return(l,n)=>r.intercept(l,{handle:s=>a(s,n)})}function V$(a,r,l){return(n,s)=>Cc(l,()=>r(n,d=>a(d,s)))}var VS=new we(""),jS=new we(""),j$=new we(""),U$=new we("");function H$(){let a=null;return(r,l)=>{a===null&&(a=(oe(VS,{optional:!0})??[]).reduceRight(B$,vL));let n=oe(Cf),s=n.add();return a(r,l).pipe(nl(()=>n.remove(s)))}}var fL=(()=>{let r=class r extends Mf{constructor(n,s){super(),this.backend=n,this.injector=s,this.chain=null,this.pendingTasks=oe(Cf);let d=oe(U$,{optional:!0});this.backend=d??n}handle(n){if(this.chain===null){let d=Array.from(new Set([...this.injector.get(jS),...this.injector.get(j$,[])]));this.chain=d.reduceRight((m,_)=>V$(m,_,this.injector),vL)}let s=this.pendingTasks.add();return this.chain(n,d=>this.backend.handle(d)).pipe(nl(()=>this.pendingTasks.remove(s)))}};r.\u0275fac=function(s){return new(s||r)(ht(Ov),ht(qh))},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})();var G$=/^\)\]\}',?\n/;function q$(a){return"responseURL"in a&&a.responseURL?a.responseURL:/^X-Request-URL:/m.test(a.getAllResponseHeaders())?a.getResponseHeader("X-Request-URL"):null}var gL=(()=>{let r=class r{constructor(n){this.xhrFactory=n}handle(n){if(n.method==="JSONP")throw new dr(-2800,!1);let s=this.xhrFactory;return(s.\u0275loadImpl?Ro(s.\u0275loadImpl()):Fe(null)).pipe(no(()=>new ga(m=>{let _=s.build();if(_.open(n.method,n.urlWithParams),n.withCredentials&&(_.withCredentials=!0),n.headers.forEach((at,ut)=>_.setRequestHeader(at,ut.join(","))),n.headers.has("Accept")||_.setRequestHeader("Accept","application/json, text/plain, */*"),!n.headers.has("Content-Type")){let at=n.detectContentTypeHeader();at!==null&&_.setRequestHeader("Content-Type",at)}if(n.responseType){let at=n.responseType.toLowerCase();_.responseType=at!=="json"?at:"text"}let w=n.serializeBody(),S=null,T=()=>{if(S!==null)return S;let at=_.statusText||"OK",ut=new Cu(_.getAllResponseHeaders()),Mt=q$(_)||n.url;return S=new BS({headers:ut,status:_.status,statusText:at,url:Mt}),S},L=()=>{let{headers:at,status:ut,statusText:Mt,url:Lt}=T(),Pt=null;ut!==Lv.NoContent&&(Pt=typeof _.response>"u"?_.responseText:_.response),ut===0&&(ut=Pt?Lv.Ok:0);let Nt=ut>=200&&ut<300;if(n.responseType==="json"&&typeof Pt=="string"){let ue=Pt;Pt=Pt.replace(G$,"");try{Pt=Pt!==""?JSON.parse(Pt):null}catch(Q){Pt=ue,Nt&&(Nt=!1,Pt={error:Q,text:Pt})}}Nt?(m.next(new im({body:Pt,headers:at,status:ut,statusText:Mt,url:Lt||void 0})),m.complete()):m.error(new Fv({error:Pt,headers:at,status:ut,statusText:Mt,url:Lt||void 0}))},H=at=>{let{url:ut}=T(),Mt=new Fv({error:at,status:_.status||0,statusText:_.statusText||"Unknown Error",url:ut||void 0});m.error(Mt)},q=!1,X=at=>{q||(m.next(T()),q=!0);let ut={type:em.DownloadProgress,loaded:at.loaded};at.lengthComputable&&(ut.total=at.total),n.responseType==="text"&&_.responseText&&(ut.partialText=_.responseText),m.next(ut)},it=at=>{let ut={type:em.UploadProgress,loaded:at.loaded};at.lengthComputable&&(ut.total=at.total),m.next(ut)};return _.addEventListener("load",L),_.addEventListener("error",H),_.addEventListener("timeout",H),_.addEventListener("abort",H),n.reportProgress&&(_.addEventListener("progress",X),w!==null&&_.upload&&_.upload.addEventListener("progress",it)),_.send(w),m.next({type:em.Sent}),()=>{_.removeEventListener("error",H),_.removeEventListener("abort",H),_.removeEventListener("load",L),_.removeEventListener("timeout",H),n.reportProgress&&(_.removeEventListener("progress",X),w!==null&&_.upload&&_.upload.removeEventListener("progress",it)),_.readyState!==_.DONE&&_.abort()}})))}};r.\u0275fac=function(s){return new(s||r)(ht(Tv))},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})(),yL=new we(""),W$="XSRF-TOKEN",$$=new we("",{providedIn:"root",factory:()=>W$}),Y$="X-XSRF-TOKEN",Z$=new we("",{providedIn:"root",factory:()=>Y$}),zv=class{},X$=(()=>{let r=class r{constructor(n,s,d){this.doc=n,this.platform=s,this.cookieName=d,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let n=this.doc.cookie||"";return n!==this.lastCookieString&&(this.parseCount++,this.lastToken=Dv(n,this.cookieName),this.lastCookieString=n),this.lastToken}};r.\u0275fac=function(s){return new(s||r)(ht(li),ht(wc),ht($$))},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})();function K$(a,r){let l=a.url.toLowerCase();if(!oe(yL)||a.method==="GET"||a.method==="HEAD"||l.startsWith("http://")||l.startsWith("https://"))return r(a);let n=oe(zv).getToken(),s=oe(Z$);return n!=null&&!a.headers.has(s)&&(a=a.clone({headers:a.headers.set(s,n)})),r(a)}var bL=function(a){return a[a.Interceptors=0]="Interceptors",a[a.LegacyInterceptors=1]="LegacyInterceptors",a[a.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",a[a.NoXsrfProtection=3]="NoXsrfProtection",a[a.JsonpSupport=4]="JsonpSupport",a[a.RequestsMadeViaParent=5]="RequestsMadeViaParent",a[a.Fetch=6]="Fetch",a}(bL||{});function Q$(a,r){return{\u0275kind:a,\u0275providers:r}}function xL(...a){let r=[Gi,gL,fL,{provide:Mf,useExisting:fL},{provide:Ov,useExisting:gL},{provide:jS,useValue:K$,multi:!0},{provide:yL,useValue:!0},{provide:zv,useClass:X$}];for(let l of a)r.push(...l.\u0275providers);return vu(r)}var _L=new we("");function wL(){return Q$(bL.LegacyInterceptors,[{provide:_L,useFactory:H$},{provide:jS,useExisting:_L,multi:!0}])}var GS=class extends iL{constructor(){super(...arguments),this.supportsDOMEvents=!0}},qS=class a extends GS{static makeCurrent(){eL(new a)}onAndCancel(r,l,n){return r.addEventListener(l,n),()=>{r.removeEventListener(l,n)}}dispatchEvent(r,l){r.dispatchEvent(l)}remove(r){r.parentNode&&r.parentNode.removeChild(r)}createElement(r,l){return l=l||this.getDefaultDocument(),l.createElement(r)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(r){return r.nodeType===Node.ELEMENT_NODE}isShadowRoot(r){return r instanceof DocumentFragment}getGlobalEventTarget(r,l){return l==="window"?window:l==="document"?r:l==="body"?r.body:null}getBaseHref(r){let l=t7();return l==null?null:e7(l)}resetBaseElement(){Tf=null}getUserAgent(){return window.navigator.userAgent}getCookie(r){return Dv(document.cookie,r)}},Tf=null;function t7(){return Tf=Tf||document.querySelector("base"),Tf?Tf.getAttribute("href"):null}function e7(a){return new URL(a,document.baseURI).pathname}var i7=(()=>{let r=class r{build(){return new XMLHttpRequest}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})(),WS=new we(""),EL=(()=>{let r=class r{constructor(n,s){this._zone=s,this._eventNameToPlugin=new Map,n.forEach(d=>{d.manager=this}),this._plugins=n.slice().reverse()}addEventListener(n,s,d){return this._findPluginFor(s).addEventListener(n,s,d)}getZone(){return this._zone}_findPluginFor(n){let s=this._eventNameToPlugin.get(n);if(s)return s;if(s=this._plugins.find(m=>m.supports(n)),!s)throw new dr(5101,!1);return this._eventNameToPlugin.set(n,s),s}};r.\u0275fac=function(s){return new(s||r)(ht(WS),ht(ze))},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})(),Nv=class{constructor(r){this._doc=r}},US="ng-app-id",ML=(()=>{let r=class r{constructor(n,s,d,m={}){this.doc=n,this.appId=s,this.nonce=d,this.platformId=m,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=FS(m),this.resetHostNodes()}addStyles(n){for(let s of n)this.changeUsageCount(s,1)===1&&this.onStyleAdded(s)}removeStyles(n){for(let s of n)this.changeUsageCount(s,-1)<=0&&this.onStyleRemoved(s)}ngOnDestroy(){let n=this.styleNodesInDOM;n&&(n.forEach(s=>s.remove()),n.clear());for(let s of this.getAllStyles())this.onStyleRemoved(s);this.resetHostNodes()}addHost(n){this.hostNodes.add(n);for(let s of this.getAllStyles())this.addStyleToHost(n,s)}removeHost(n){this.hostNodes.delete(n)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(n){for(let s of this.hostNodes)this.addStyleToHost(s,n)}onStyleRemoved(n){let s=this.styleRef;s.get(n)?.elements?.forEach(d=>d.remove()),s.delete(n)}collectServerRenderedStyles(){let n=this.doc.head?.querySelectorAll(`style[${US}="${this.appId}"]`);if(n?.length){let s=new Map;return n.forEach(d=>{d.textContent!=null&&s.set(d.textContent,d)}),s}return null}changeUsageCount(n,s){let d=this.styleRef;if(d.has(n)){let m=d.get(n);return m.usage+=s,m.usage}return d.set(n,{usage:s,elements:[]}),s}getStyleElement(n,s){let d=this.styleNodesInDOM,m=d?.get(s);if(m?.parentNode===n)return d.delete(s),m.removeAttribute(US),m;{let _=this.doc.createElement("style");return this.nonce&&_.setAttribute("nonce",this.nonce),_.textContent=s,this.platformIsServer&&_.setAttribute(US,this.appId),n.appendChild(_),_}}addStyleToHost(n,s){let d=this.getStyleElement(n,s),m=this.styleRef,_=m.get(s)?.elements;_?_.push(d):m.set(s,{elements:[d],usage:1})}resetHostNodes(){let n=this.hostNodes;n.clear(),n.add(this.doc.head)}};r.\u0275fac=function(s){return new(s||r)(ht(li),ht(yf),ht(bf,8),ht(wc))},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})(),HS={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},ZS=/%COMP%/g,DL="%COMP%",n7=`_nghost-${DL}`,r7=`_ngcontent-${DL}`,o7=!0,s7=new we("",{providedIn:"root",factory:()=>o7});function a7(a){return r7.replace(ZS,a)}function l7(a){return n7.replace(ZS,a)}function TL(a,r){return r.map(l=>l.replace(ZS,a))}var nm=(()=>{let r=class r{constructor(n,s,d,m,_,w,S,T=null){this.eventManager=n,this.sharedStylesHost=s,this.appId=d,this.removeStylesOnCompDestroy=m,this.doc=_,this.platformId=w,this.ngZone=S,this.nonce=T,this.rendererByCompId=new Map,this.platformIsServer=FS(w),this.defaultRenderer=new If(n,_,S,this.platformIsServer)}createRenderer(n,s){if(!n||!s)return this.defaultRenderer;this.platformIsServer&&s.encapsulation===_f.ShadowDom&&(s=Ri(Gt({},s),{encapsulation:_f.Emulated}));let d=this.getOrCreateRenderer(n,s);return d instanceof Bv?d.applyToHost(n):d instanceof Af&&d.applyStyles(),d}getOrCreateRenderer(n,s){let d=this.rendererByCompId,m=d.get(s.id);if(!m){let _=this.doc,w=this.ngZone,S=this.eventManager,T=this.sharedStylesHost,L=this.removeStylesOnCompDestroy,H=this.platformIsServer;switch(s.encapsulation){case _f.Emulated:m=new Bv(S,T,s,this.appId,L,_,w,H);break;case _f.ShadowDom:return new $S(S,T,n,s,_,w,this.nonce,H);default:m=new Af(S,T,s,L,_,w,H);break}d.set(s.id,m)}return m}ngOnDestroy(){this.rendererByCompId.clear()}};r.\u0275fac=function(s){return new(s||r)(ht(EL),ht(ML),ht(yf),ht(s7),ht(li),ht(wc),ht(ze),ht(bf))},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})(),If=class{constructor(r,l,n,s){this.eventManager=r,this.doc=l,this.ngZone=n,this.platformIsServer=s,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(r,l){return l?this.doc.createElementNS(HS[l]||l,r):this.doc.createElement(r)}createComment(r){return this.doc.createComment(r)}createText(r){return this.doc.createTextNode(r)}appendChild(r,l){(CL(r)?r.content:r).appendChild(l)}insertBefore(r,l,n){r&&(CL(r)?r.content:r).insertBefore(l,n)}removeChild(r,l){r&&r.removeChild(l)}selectRootElement(r,l){let n=typeof r=="string"?this.doc.querySelector(r):r;if(!n)throw new dr(-5104,!1);return l||(n.textContent=""),n}parentNode(r){return r.parentNode}nextSibling(r){return r.nextSibling}setAttribute(r,l,n,s){if(s){l=s+":"+l;let d=HS[s];d?r.setAttributeNS(d,l,n):r.setAttribute(l,n)}else r.setAttribute(l,n)}removeAttribute(r,l,n){if(n){let s=HS[n];s?r.removeAttributeNS(s,l):r.removeAttribute(`${n}:${l}`)}else r.removeAttribute(l)}addClass(r,l){r.classList.add(l)}removeClass(r,l){r.classList.remove(l)}setStyle(r,l,n,s){s&(xf.DashCase|xf.Important)?r.style.setProperty(l,n,s&xf.Important?"important":""):r.style[l]=n}removeStyle(r,l,n){n&xf.DashCase?r.style.removeProperty(l):r.style[l]=""}setProperty(r,l,n){r!=null&&(r[l]=n)}setValue(r,l){r.nodeValue=l}listen(r,l,n){if(typeof r=="string"&&(r=tm().getGlobalEventTarget(this.doc,r),!r))throw new Error(`Unsupported event target ${r} for event ${l}`);return this.eventManager.addEventListener(r,l,this.decoratePreventDefault(n))}decoratePreventDefault(r){return l=>{if(l==="__ngUnwrap__")return r;(this.platformIsServer?this.ngZone.runGuarded(()=>r(l)):r(l))===!1&&l.preventDefault()}}};function CL(a){return a.tagName==="TEMPLATE"&&a.content!==void 0}var $S=class extends If{constructor(r,l,n,s,d,m,_,w){super(r,d,m,w),this.sharedStylesHost=l,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let S=TL(s.id,s.styles);for(let T of S){let L=document.createElement("style");_&&L.setAttribute("nonce",_),L.textContent=T,this.shadowRoot.appendChild(L)}}nodeOrShadowRoot(r){return r===this.hostEl?this.shadowRoot:r}appendChild(r,l){return super.appendChild(this.nodeOrShadowRoot(r),l)}insertBefore(r,l,n){return super.insertBefore(this.nodeOrShadowRoot(r),l,n)}removeChild(r,l){return super.removeChild(this.nodeOrShadowRoot(r),l)}parentNode(r){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(r)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Af=class extends If{constructor(r,l,n,s,d,m,_,w){super(r,d,m,_),this.sharedStylesHost=l,this.removeStylesOnCompDestroy=s,this.styles=w?TL(w,n.styles):n.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},Bv=class extends Af{constructor(r,l,n,s,d,m,_,w){let S=s+"-"+n.id;super(r,l,n,d,m,_,w,S),this.contentAttr=a7(S),this.hostAttr=l7(S)}applyToHost(r){this.applyStyles(),this.setAttribute(r,this.hostAttr,"")}createElement(r,l){let n=super.createElement(r,l);return super.setAttribute(n,this.contentAttr,""),n}},c7=(()=>{let r=class r extends Nv{constructor(n){super(n)}supports(n){return!0}addEventListener(n,s,d){return n.addEventListener(s,d,!1),()=>this.removeEventListener(n,s,d)}removeEventListener(n,s,d){return n.removeEventListener(s,d)}};r.\u0275fac=function(s){return new(s||r)(ht(li))},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})(),SL=["alt","control","meta","shift"],d7={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},u7={alt:a=>a.altKey,control:a=>a.ctrlKey,meta:a=>a.metaKey,shift:a=>a.shiftKey},h7=(()=>{let r=class r extends Nv{constructor(n){super(n)}supports(n){return r.parseEventName(n)!=null}addEventListener(n,s,d){let m=r.parseEventName(s),_=r.eventCallback(m.fullKey,d,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>tm().onAndCancel(n,m.domEventName,_))}static parseEventName(n){let s=n.toLowerCase().split("."),d=s.shift();if(s.length===0||!(d==="keydown"||d==="keyup"))return null;let m=r._normalizeKey(s.pop()),_="",w=s.indexOf("code");if(w>-1&&(s.splice(w,1),_="code."),SL.forEach(T=>{let L=s.indexOf(T);L>-1&&(s.splice(L,1),_+=T+".")}),_+=m,s.length!=0||m.length===0)return null;let S={};return S.domEventName=d,S.fullKey=_,S}static matchEventFullKeyCode(n,s){let d=d7[n.key]||n.key,m="";return s.indexOf("code.")>-1&&(d=n.code,m="code."),d==null||!d?!1:(d=d.toLowerCase(),d===" "?d="space":d==="."&&(d="dot"),SL.forEach(_=>{if(_!==d){let w=u7[_];w(n)&&(m+=_+".")}}),m+=d,m===s)}static eventCallback(n,s,d){return m=>{r.matchEventFullKeyCode(m,n)&&d.runGuarded(()=>s(m))}}static _normalizeKey(n){return n==="esc"?"escape":n}};r.\u0275fac=function(s){return new(s||r)(ht(li))},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})();function IL(a,r){return tL(Gt({rootComponent:a},m7(r)))}function m7(a){return{appProviders:[...v7,...a?.providers??[]],platformProviders:_7}}function p7(){qS.makeCurrent()}function f7(){return new yu}function g7(){return LF(document),document}var _7=[{provide:wc,useValue:oL},{provide:NF,useValue:p7,multi:!0},{provide:li,useFactory:g7,deps:[]}];var v7=[{provide:BF,useValue:"root"},{provide:yu,useFactory:f7,deps:[]},{provide:WS,useClass:c7,multi:!0,deps:[li,ze,wc]},{provide:WS,useClass:h7,multi:!0,deps:[li]},nm,ML,EL,{provide:Yh,useExisting:nm},{provide:Tv,useClass:i7,deps:[]},[]];var AL=(()=>{let r=class r{constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}};r.\u0275fac=function(s){return new(s||r)(ht(li))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var XS=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:function(s){let d=null;return s?d=new(s||r):d=ht(y7),d},providedIn:"root"});let a=r;return a})(),y7=(()=>{let r=class r extends XS{constructor(n){super(),this._doc=n}sanitize(n,s){if(s==null)return null;switch(n){case Zs.NONE:return s;case Zs.HTML:return $h(s,"HTML")?Wh(s):WF(this._doc,String(s)).toString();case Zs.STYLE:return $h(s,"Style")?Wh(s):s;case Zs.SCRIPT:if($h(s,"Script"))return Wh(s);throw new dr(5200,!1);case Zs.URL:return $h(s,"URL")?Wh(s):qF(String(s));case Zs.RESOURCE_URL:if($h(s,"ResourceURL"))return Wh(s);throw new dr(5201,!1);default:throw new dr(5202,!1)}}bypassSecurityTrustHtml(n){return VF(n)}bypassSecurityTrustStyle(n){return jF(n)}bypassSecurityTrustScript(n){return UF(n)}bypassSecurityTrustUrl(n){return HF(n)}bypassSecurityTrustResourceUrl(n){return GF(n)}};r.\u0275fac=function(s){return new(s||r)(ht(li))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var sn="primary",Gf=Symbol("RouteTitle"),eE=class{constructor(r){this.params=r||{}}has(r){return Object.prototype.hasOwnProperty.call(this.params,r)}get(r){if(this.has(r)){let l=this.params[r];return Array.isArray(l)?l[0]:l}return null}getAll(r){if(this.has(r)){let l=this.params[r];return Array.isArray(l)?l:[l]}return[]}get keys(){return Object.keys(this.params)}};function lm(a){return new eE(a)}function b7(a,r,l){let n=l.path.split("/");if(n.length>a.length||l.pathMatch==="full"&&(r.hasChildren()||n.length<a.length))return null;let s={};for(let d=0;d<n.length;d++){let m=n[d],_=a[d];if(m.startsWith(":"))s[m.substring(1)]=_;else if(m!==_.path)return null}return{consumed:a.slice(0,n.length),posParams:s}}function x7(a,r){if(a.length!==r.length)return!1;for(let l=0;l<a.length;++l)if(!jl(a[l],r[l]))return!1;return!0}function jl(a,r){let l=a?iE(a):void 0,n=r?iE(r):void 0;if(!l||!n||l.length!=n.length)return!1;let s;for(let d=0;d<l.length;d++)if(s=l[d],!zL(a[s],r[s]))return!1;return!0}function iE(a){return[...Object.keys(a),...Object.getOwnPropertySymbols(a)]}function zL(a,r){if(Array.isArray(a)&&Array.isArray(r)){if(a.length!==r.length)return!1;let l=[...a].sort(),n=[...r].sort();return l.every((s,d)=>n[d]===s)}else return a===r}function NL(a){return a.length>0?a[a.length-1]:null}function gd(a){return Hh(a)?a:Mv(a)?Ro(Promise.resolve(a)):Fe(a)}var w7={exact:VL,subset:jL},BL={exact:C7,subset:S7,ignored:()=>!0};function RL(a,r,l){return w7[l.paths](a.root,r.root,l.matrixParams)&&BL[l.queryParams](a.queryParams,r.queryParams)&&!(l.fragment==="exact"&&a.fragment!==r.fragment)}function C7(a,r){return jl(a,r)}function VL(a,r,l){if(!Mu(a.segments,r.segments)||!Uv(a.segments,r.segments,l)||a.numberOfChildren!==r.numberOfChildren)return!1;for(let n in r.children)if(!a.children[n]||!VL(a.children[n],r.children[n],l))return!1;return!0}function S7(a,r){return Object.keys(r).length<=Object.keys(a).length&&Object.keys(r).every(l=>zL(a[l],r[l]))}function jL(a,r,l){return UL(a,r,r.segments,l)}function UL(a,r,l,n){if(a.segments.length>l.length){let s=a.segments.slice(0,l.length);return!(!Mu(s,l)||r.hasChildren()||!Uv(s,l,n))}else if(a.segments.length===l.length){if(!Mu(a.segments,l)||!Uv(a.segments,l,n))return!1;for(let s in r.children)if(!a.children[s]||!jL(a.children[s],r.children[s],n))return!1;return!0}else{let s=l.slice(0,a.segments.length),d=l.slice(a.segments.length);return!Mu(a.segments,s)||!Uv(a.segments,s,n)||!a.children[sn]?!1:UL(a.children[sn],r,d,n)}}function Uv(a,r,l){return r.every((n,s)=>BL[l](a[s].parameters,n.parameters))}var pd=class{constructor(r=new sr([],{}),l={},n=null){this.root=r,this.queryParams=l,this.fragment=n}get queryParamMap(){return this._queryParamMap??=lm(this.queryParams),this._queryParamMap}toString(){return D7.serialize(this)}},sr=class{constructor(r,l){this.segments=r,this.children=l,this.parent=null,Object.values(l).forEach(n=>n.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Hv(this)}},Eu=class{constructor(r,l){this.path=r,this.parameters=l}get parameterMap(){return this._parameterMap??=lm(this.parameters),this._parameterMap}toString(){return GL(this)}};function E7(a,r){return Mu(a,r)&&a.every((l,n)=>jl(l.parameters,r[n].parameters))}function Mu(a,r){return a.length!==r.length?!1:a.every((l,n)=>l.path===r[n].path)}function M7(a,r){let l=[];return Object.entries(a.children).forEach(([n,s])=>{n===sn&&(l=l.concat(r(s,n)))}),Object.entries(a.children).forEach(([n,s])=>{n!==sn&&(l=l.concat(r(s,n)))}),l}var TE=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:()=>new qv,providedIn:"root"});let a=r;return a})(),qv=class{parse(r){let l=new rE(r);return new pd(l.parseRootSegment(),l.parseQueryParams(),l.parseFragment())}serialize(r){let l=`/${kf(r.root,!0)}`,n=A7(r.queryParams),s=typeof r.fragment=="string"?`#${T7(r.fragment)}`:"";return`${l}${n}${s}`}},D7=new qv;function Hv(a){return a.segments.map(r=>GL(r)).join("/")}function kf(a,r){if(!a.hasChildren())return Hv(a);if(r){let l=a.children[sn]?kf(a.children[sn],!1):"",n=[];return Object.entries(a.children).forEach(([s,d])=>{s!==sn&&n.push(`${s}:${kf(d,!1)}`)}),n.length>0?`${l}(${n.join("//")})`:l}else{let l=M7(a,(n,s)=>s===sn?[kf(a.children[sn],!1)]:[`${s}:${kf(n,!1)}`]);return Object.keys(a.children).length===1&&a.children[sn]!=null?`${Hv(a)}/${l[0]}`:`${Hv(a)}/(${l.join("//")})`}}function HL(a){return encodeURIComponent(a).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Vv(a){return HL(a).replace(/%3B/gi,";")}function T7(a){return encodeURI(a)}function nE(a){return HL(a).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Gv(a){return decodeURIComponent(a)}function PL(a){return Gv(a.replace(/\+/g,"%20"))}function GL(a){return`${nE(a.path)}${I7(a.parameters)}`}function I7(a){return Object.entries(a).map(([r,l])=>`;${nE(r)}=${nE(l)}`).join("")}function A7(a){let r=Object.entries(a).map(([l,n])=>Array.isArray(n)?n.map(s=>`${Vv(l)}=${Vv(s)}`).join("&"):`${Vv(l)}=${Vv(n)}`).filter(l=>l);return r.length?`?${r.join("&")}`:""}var k7=/^[^\/()?;#]+/;function KS(a){let r=a.match(k7);return r?r[0]:""}var R7=/^[^\/()?;=#]+/;function P7(a){let r=a.match(R7);return r?r[0]:""}var O7=/^[^=?&#]+/;function F7(a){let r=a.match(O7);return r?r[0]:""}var L7=/^[^&#]+/;function z7(a){let r=a.match(L7);return r?r[0]:""}var rE=class{constructor(r){this.url=r,this.remaining=r}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new sr([],{}):new sr([],this.parseChildren())}parseQueryParams(){let r={};if(this.consumeOptional("?"))do this.parseQueryParam(r);while(this.consumeOptional("&"));return r}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let r=[];for(this.peekStartsWith("(")||r.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),r.push(this.parseSegment());let l={};this.peekStartsWith("/(")&&(this.capture("/"),l=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(r.length>0||Object.keys(l).length>0)&&(n[sn]=new sr(r,l)),n}parseSegment(){let r=KS(this.remaining);if(r===""&&this.peekStartsWith(";"))throw new dr(4009,!1);return this.capture(r),new Eu(Gv(r),this.parseMatrixParams())}parseMatrixParams(){let r={};for(;this.consumeOptional(";");)this.parseParam(r);return r}parseParam(r){let l=P7(this.remaining);if(!l)return;this.capture(l);let n="";if(this.consumeOptional("=")){let s=KS(this.remaining);s&&(n=s,this.capture(n))}r[Gv(l)]=Gv(n)}parseQueryParam(r){let l=F7(this.remaining);if(!l)return;this.capture(l);let n="";if(this.consumeOptional("=")){let m=z7(this.remaining);m&&(n=m,this.capture(n))}let s=PL(l),d=PL(n);if(r.hasOwnProperty(s)){let m=r[s];Array.isArray(m)||(m=[m],r[s]=m),m.push(d)}else r[s]=d}parseParens(r){let l={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let n=KS(this.remaining),s=this.remaining[n.length];if(s!=="/"&&s!==")"&&s!==";")throw new dr(4010,!1);let d;n.indexOf(":")>-1?(d=n.slice(0,n.indexOf(":")),this.capture(d),this.capture(":")):r&&(d=sn);let m=this.parseChildren();l[d]=Object.keys(m).length===1?m[sn]:new sr([],m),this.consumeOptional("//")}return l}peekStartsWith(r){return this.remaining.startsWith(r)}consumeOptional(r){return this.peekStartsWith(r)?(this.remaining=this.remaining.substring(r.length),!0):!1}capture(r){if(!this.consumeOptional(r))throw new dr(4011,!1)}};function qL(a){return a.segments.length>0?new sr([],{[sn]:a}):a}function WL(a){let r={};for(let[n,s]of Object.entries(a.children)){let d=WL(s);if(n===sn&&d.segments.length===0&&d.hasChildren())for(let[m,_]of Object.entries(d.children))r[m]=_;else(d.segments.length>0||d.hasChildren())&&(r[n]=d)}let l=new sr(a.segments,r);return N7(l)}function N7(a){if(a.numberOfChildren===1&&a.children[sn]){let r=a.children[sn];return new sr(a.segments.concat(r.segments),r.children)}return a}function cm(a){return a instanceof pd}function B7(a,r,l=null,n=null){let s=$L(a);return YL(s,r,l,n)}function $L(a){let r;function l(d){let m={};for(let w of d.children){let S=l(w);m[w.outlet]=S}let _=new sr(d.url,m);return d===a&&(r=_),_}let n=l(a.root),s=qL(n);return r??s}function YL(a,r,l,n){let s=a;for(;s.parent;)s=s.parent;if(r.length===0)return QS(s,s,s,l,n);let d=V7(r);if(d.toRoot())return QS(s,s,new sr([],{}),l,n);let m=j7(d,s,a),_=m.processChildren?Of(m.segmentGroup,m.index,d.commands):XL(m.segmentGroup,m.index,d.commands);return QS(s,m.segmentGroup,_,l,n)}function Wv(a){return typeof a=="object"&&a!=null&&!a.outlets&&!a.segmentPath}function zf(a){return typeof a=="object"&&a!=null&&a.outlets}function QS(a,r,l,n,s){let d={};n&&Object.entries(n).forEach(([w,S])=>{d[w]=Array.isArray(S)?S.map(T=>`${T}`):`${S}`});let m;a===r?m=l:m=ZL(a,r,l);let _=qL(WL(m));return new pd(_,d,s)}function ZL(a,r,l){let n={};return Object.entries(a.children).forEach(([s,d])=>{d===r?n[s]=l:n[s]=ZL(d,r,l)}),new sr(a.segments,n)}var $v=class{constructor(r,l,n){if(this.isAbsolute=r,this.numberOfDoubleDots=l,this.commands=n,r&&n.length>0&&Wv(n[0]))throw new dr(4003,!1);let s=n.find(zf);if(s&&s!==NL(n))throw new dr(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function V7(a){if(typeof a[0]=="string"&&a.length===1&&a[0]==="/")return new $v(!0,0,a);let r=0,l=!1,n=a.reduce((s,d,m)=>{if(typeof d=="object"&&d!=null){if(d.outlets){let _={};return Object.entries(d.outlets).forEach(([w,S])=>{_[w]=typeof S=="string"?S.split("/"):S}),[...s,{outlets:_}]}if(d.segmentPath)return[...s,d.segmentPath]}return typeof d!="string"?[...s,d]:m===0?(d.split("/").forEach((_,w)=>{w==0&&_==="."||(w==0&&_===""?l=!0:_===".."?r++:_!=""&&s.push(_))}),s):[...s,d]},[]);return new $v(l,r,n)}var sm=class{constructor(r,l,n){this.segmentGroup=r,this.processChildren=l,this.index=n}};function j7(a,r,l){if(a.isAbsolute)return new sm(r,!0,0);if(!l)return new sm(r,!1,NaN);if(l.parent===null)return new sm(l,!0,0);let n=Wv(a.commands[0])?0:1,s=l.segments.length-1+n;return U7(l,s,a.numberOfDoubleDots)}function U7(a,r,l){let n=a,s=r,d=l;for(;d>s;){if(d-=s,n=n.parent,!n)throw new dr(4005,!1);s=n.segments.length}return new sm(n,!1,s-d)}function H7(a){return zf(a[0])?a[0].outlets:{[sn]:a}}function XL(a,r,l){if(a??=new sr([],{}),a.segments.length===0&&a.hasChildren())return Of(a,r,l);let n=G7(a,r,l),s=l.slice(n.commandIndex);if(n.match&&n.pathIndex<a.segments.length){let d=new sr(a.segments.slice(0,n.pathIndex),{});return d.children[sn]=new sr(a.segments.slice(n.pathIndex),a.children),Of(d,0,s)}else return n.match&&s.length===0?new sr(a.segments,{}):n.match&&!a.hasChildren()?oE(a,r,l):n.match?Of(a,0,s):oE(a,r,l)}function Of(a,r,l){if(l.length===0)return new sr(a.segments,{});{let n=H7(l),s={};if(Object.keys(n).some(d=>d!==sn)&&a.children[sn]&&a.numberOfChildren===1&&a.children[sn].segments.length===0){let d=Of(a.children[sn],r,l);return new sr(a.segments,d.children)}return Object.entries(n).forEach(([d,m])=>{typeof m=="string"&&(m=[m]),m!==null&&(s[d]=XL(a.children[d],r,m))}),Object.entries(a.children).forEach(([d,m])=>{n[d]===void 0&&(s[d]=m)}),new sr(a.segments,s)}}function G7(a,r,l){let n=0,s=r,d={match:!1,pathIndex:0,commandIndex:0};for(;s<a.segments.length;){if(n>=l.length)return d;let m=a.segments[s],_=l[n];if(zf(_))break;let w=`${_}`,S=n<l.length-1?l[n+1]:null;if(s>0&&w===void 0)break;if(w&&S&&typeof S=="object"&&S.outlets===void 0){if(!FL(w,S,m))return d;n+=2}else{if(!FL(w,{},m))return d;n++}s++}return{match:!0,pathIndex:s,commandIndex:n}}function oE(a,r,l){let n=a.segments.slice(0,r),s=0;for(;s<l.length;){let d=l[s];if(zf(d)){let w=q7(d.outlets);return new sr(n,w)}if(s===0&&Wv(l[0])){let w=a.segments[r];n.push(new Eu(w.path,OL(l[0]))),s++;continue}let m=zf(d)?d.outlets[sn]:`${d}`,_=s<l.length-1?l[s+1]:null;m&&_&&Wv(_)?(n.push(new Eu(m,OL(_))),s+=2):(n.push(new Eu(m,{})),s++)}return new sr(n,{})}function q7(a){let r={};return Object.entries(a).forEach(([l,n])=>{typeof n=="string"&&(n=[n]),n!==null&&(r[l]=oE(new sr([],{}),0,n))}),r}function OL(a){let r={};return Object.entries(a).forEach(([l,n])=>r[l]=`${n}`),r}function FL(a,r,l){return a==l.path&&jl(r,l.parameters)}var Ff="imperative",Xo=function(a){return a[a.NavigationStart=0]="NavigationStart",a[a.NavigationEnd=1]="NavigationEnd",a[a.NavigationCancel=2]="NavigationCancel",a[a.NavigationError=3]="NavigationError",a[a.RoutesRecognized=4]="RoutesRecognized",a[a.ResolveStart=5]="ResolveStart",a[a.ResolveEnd=6]="ResolveEnd",a[a.GuardsCheckStart=7]="GuardsCheckStart",a[a.GuardsCheckEnd=8]="GuardsCheckEnd",a[a.RouteConfigLoadStart=9]="RouteConfigLoadStart",a[a.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",a[a.ChildActivationStart=11]="ChildActivationStart",a[a.ChildActivationEnd=12]="ChildActivationEnd",a[a.ActivationStart=13]="ActivationStart",a[a.ActivationEnd=14]="ActivationEnd",a[a.Scroll=15]="Scroll",a[a.NavigationSkipped=16]="NavigationSkipped",a}(Xo||{}),va=class{constructor(r,l){this.id=r,this.url=l}},Du=class extends va{constructor(r,l,n="imperative",s=null){super(r,l),this.type=Xo.NavigationStart,this.navigationTrigger=n,this.restoredState=s}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Ks=class extends va{constructor(r,l,n){super(r,l),this.urlAfterRedirects=n,this.type=Xo.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},_a=function(a){return a[a.Redirect=0]="Redirect",a[a.SupersededByNewNavigation=1]="SupersededByNewNavigation",a[a.NoDataFromResolver=2]="NoDataFromResolver",a[a.GuardRejected=3]="GuardRejected",a}(_a||{}),sE=function(a){return a[a.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",a[a.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",a}(sE||{}),fd=class extends va{constructor(r,l,n,s){super(r,l),this.reason=n,this.code=s,this.type=Xo.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Tu=class extends va{constructor(r,l,n,s){super(r,l),this.reason=n,this.code=s,this.type=Xo.NavigationSkipped}},Nf=class extends va{constructor(r,l,n,s){super(r,l),this.error=n,this.target=s,this.type=Xo.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Yv=class extends va{constructor(r,l,n,s){super(r,l),this.urlAfterRedirects=n,this.state=s,this.type=Xo.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},aE=class extends va{constructor(r,l,n,s){super(r,l),this.urlAfterRedirects=n,this.state=s,this.type=Xo.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},lE=class extends va{constructor(r,l,n,s,d){super(r,l),this.urlAfterRedirects=n,this.state=s,this.shouldActivate=d,this.type=Xo.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},cE=class extends va{constructor(r,l,n,s){super(r,l),this.urlAfterRedirects=n,this.state=s,this.type=Xo.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},dE=class extends va{constructor(r,l,n,s){super(r,l),this.urlAfterRedirects=n,this.state=s,this.type=Xo.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},uE=class{constructor(r){this.route=r,this.type=Xo.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},hE=class{constructor(r){this.route=r,this.type=Xo.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},mE=class{constructor(r){this.snapshot=r,this.type=Xo.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},pE=class{constructor(r){this.snapshot=r,this.type=Xo.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},fE=class{constructor(r){this.snapshot=r,this.type=Xo.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},gE=class{constructor(r){this.snapshot=r,this.type=Xo.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var Bf=class{},Vf=class{constructor(r){this.url=r}};var _E=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new ty,this.attachRef=null}},ty=(()=>{let r=class r{constructor(){this.contexts=new Map}onChildOutletCreated(n,s){let d=this.getOrCreateContext(n);d.outlet=s,this.contexts.set(n,d)}onChildOutletDestroyed(n){let s=this.getContext(n);s&&(s.outlet=null,s.attachRef=null)}onOutletDeactivated(){let n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let s=this.getContext(n);return s||(s=new _E,this.contexts.set(n,s)),s}getContext(n){return this.contexts.get(n)||null}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),Zv=class{constructor(r){this._root=r}get root(){return this._root.value}parent(r){let l=this.pathFromRoot(r);return l.length>1?l[l.length-2]:null}children(r){let l=vE(r,this._root);return l?l.children.map(n=>n.value):[]}firstChild(r){let l=vE(r,this._root);return l&&l.children.length>0?l.children[0].value:null}siblings(r){let l=yE(r,this._root);return l.length<2?[]:l[l.length-2].children.map(s=>s.value).filter(s=>s!==r)}pathFromRoot(r){return yE(r,this._root).map(l=>l.value)}};function vE(a,r){if(a===r.value)return r;for(let l of r.children){let n=vE(a,l);if(n)return n}return null}function yE(a,r){if(a===r.value)return[r];for(let l of r.children){let n=yE(a,l);if(n.length)return n.unshift(r),n}return[]}var Xs=class{constructor(r,l){this.value=r,this.children=l}toString(){return`TreeNode(${this.value})`}};function om(a){let r={};return a&&a.children.forEach(l=>r[l.value.outlet]=l),r}var Xv=class extends Zv{constructor(r,l){super(r),this.snapshot=l,AE(this,r)}toString(){return this.snapshot.toString()}};function KL(a){let r=W7(a),l=new Ze([new Eu("",{})]),n=new Ze({}),s=new Ze({}),d=new Ze({}),m=new Ze(""),_=new En(l,n,d,m,s,sn,a,r.root);return _.snapshot=r.root,new Xv(new Xs(_,[]),r)}function W7(a){let r={},l={},n={},s="",d=new jf([],r,n,s,l,sn,a,null,{});return new Kv("",new Xs(d,[]))}var En=class{constructor(r,l,n,s,d,m,_,w){this.urlSubject=r,this.paramsSubject=l,this.queryParamsSubject=n,this.fragmentSubject=s,this.dataSubject=d,this.outlet=m,this.component=_,this._futureSnapshot=w,this.title=this.dataSubject?.pipe(Fi(S=>S[Gf]))??Fe(void 0),this.url=r,this.params=l,this.queryParams=n,this.fragment=s,this.data=d}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Fi(r=>lm(r))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Fi(r=>lm(r))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function IE(a,r,l="emptyOnly"){let n,{routeConfig:s}=a;return r!==null&&(l==="always"||s?.path===""||!r.component&&!r.routeConfig?.loadComponent)?n={params:Gt(Gt({},r.params),a.params),data:Gt(Gt({},r.data),a.data),resolve:Gt(Gt(Gt(Gt({},a.data),r.data),s?.data),a._resolvedData)}:n={params:Gt({},a.params),data:Gt({},a.data),resolve:Gt(Gt({},a.data),a._resolvedData??{})},s&&JL(s)&&(n.resolve[Gf]=s.title),n}var jf=class{get title(){return this.data?.[Gf]}constructor(r,l,n,s,d,m,_,w,S){this.url=r,this.params=l,this.queryParams=n,this.fragment=s,this.data=d,this.outlet=m,this.component=_,this.routeConfig=w,this._resolve=S}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=lm(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=lm(this.queryParams),this._queryParamMap}toString(){let r=this.url.map(n=>n.toString()).join("/"),l=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${r}', path:'${l}')`}},Kv=class extends Zv{constructor(r,l){super(l),this.url=r,AE(this,l)}toString(){return QL(this._root)}};function AE(a,r){r.value._routerState=a,r.children.forEach(l=>AE(a,l))}function QL(a){let r=a.children.length>0?` { ${a.children.map(QL).join(", ")} } `:"";return`${a.value}${r}`}function JS(a){if(a.snapshot){let r=a.snapshot,l=a._futureSnapshot;a.snapshot=l,jl(r.queryParams,l.queryParams)||a.queryParamsSubject.next(l.queryParams),r.fragment!==l.fragment&&a.fragmentSubject.next(l.fragment),jl(r.params,l.params)||a.paramsSubject.next(l.params),x7(r.url,l.url)||a.urlSubject.next(l.url),jl(r.data,l.data)||a.dataSubject.next(l.data)}else a.snapshot=a._futureSnapshot,a.dataSubject.next(a._futureSnapshot.data)}function bE(a,r){let l=jl(a.params,r.params)&&E7(a.url,r.url),n=!a.parent!=!r.parent;return l&&!n&&(!a.parent||bE(a.parent,r.parent))}function JL(a){return typeof a.title=="string"||a.title===null}var cl=(()=>{let r=class r{constructor(){this.activated=null,this._activatedRoute=null,this.name=sn,this.activateEvents=new ye,this.deactivateEvents=new ye,this.attachEvents=new ye,this.detachEvents=new ye,this.parentContexts=oe(ty),this.location=oe(Mo),this.changeDetector=oe(Wi),this.environmentInjector=oe(qh),this.inputBinder=oe(kE,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(n){if(n.name){let{firstChange:s,previousValue:d}=n.name;if(s)return;this.isTrackedInParentContexts(d)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(d)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(n){return this.parentContexts.getContext(n)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let n=this.parentContexts.getContext(this.name);n?.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new dr(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new dr(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new dr(4012,!1);this.location.detach();let n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,s){this.activated=n,this._activatedRoute=s,this.location.insert(n.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){let n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,s){if(this.isActivated)throw new dr(4013,!1);this._activatedRoute=n;let d=this.location,_=n.snapshot.component,w=this.parentContexts.getOrCreateContext(this.name).children,S=new xE(n,w,d.injector);this.activated=d.createComponent(_,{index:d.length,injector:S,environmentInjector:s??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};r.\u0275fac=function(s){return new(s||r)},r.\u0275dir=re({type:r,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[qn]});let a=r;return a})(),xE=class{constructor(r,l,n){this.route=r,this.childContexts=l,this.parent=n}get(r,l){return r===En?this.route:r===ty?this.childContexts:this.parent.get(r,l)}},kE=new we("");function $7(a,r,l){let n=Uf(a,r._root,l?l._root:void 0);return new Xv(n,r)}function Uf(a,r,l){if(l&&a.shouldReuseRoute(r.value,l.value.snapshot)){let n=l.value;n._futureSnapshot=r.value;let s=Y7(a,r,l);return new Xs(n,s)}else{if(a.shouldAttach(r.value)){let d=a.retrieve(r.value);if(d!==null){let m=d.route;return m.value._futureSnapshot=r.value,m.children=r.children.map(_=>Uf(a,_)),m}}let n=Z7(r.value),s=r.children.map(d=>Uf(a,d));return new Xs(n,s)}}function Y7(a,r,l){return r.children.map(n=>{for(let s of l.children)if(a.shouldReuseRoute(n.value,s.value.snapshot))return Uf(a,n,s);return Uf(a,n)})}function Z7(a){return new En(new Ze(a.url),new Ze(a.params),new Ze(a.queryParams),new Ze(a.fragment),new Ze(a.data),a.outlet,a.component,a)}var t3="ngNavigationCancelingError";function e3(a,r){let{redirectTo:l,navigationBehaviorOptions:n}=cm(r)?{redirectTo:r,navigationBehaviorOptions:void 0}:r,s=i3(!1,_a.Redirect);return s.url=l,s.navigationBehaviorOptions=n,s}function i3(a,r){let l=new Error(`NavigationCancelingError: ${a||""}`);return l[t3]=!0,l.cancellationCode=r,l}function X7(a){return n3(a)&&cm(a.url)}function n3(a){return!!a&&a[t3]}var K7=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=Et({type:r,selectors:[["ng-component"]],standalone:!0,features:[At],decls:1,vars:0,template:function(s,d){s&1&&dt(0,"router-outlet")},dependencies:[cl],encapsulation:2});let a=r;return a})();function Q7(a,r){return a.providers&&!a._injector&&(a._injector=XF(a.providers,r,`Route: ${a.path}`)),a._injector??r}function RE(a){let r=a.children&&a.children.map(RE),l=r?Ri(Gt({},a),{children:r}):Gt({},a);return!l.component&&!l.loadComponent&&(r||l.loadChildren)&&l.outlet&&l.outlet!==sn&&(l.component=K7),l}function Ul(a){return a.outlet||sn}function J7(a,r){let l=a.filter(n=>Ul(n)===r);return l.push(...a.filter(n=>Ul(n)!==r)),l}function qf(a){if(!a)return null;if(a.routeConfig?._injector)return a.routeConfig._injector;for(let r=a.parent;r;r=r.parent){let l=r.routeConfig;if(l?._loadedInjector)return l._loadedInjector;if(l?._injector)return l._injector}return null}var t9=(a,r,l,n)=>Fi(s=>(new wE(r,s.targetRouterState,s.currentRouterState,l,n).activate(a),s)),wE=class{constructor(r,l,n,s,d){this.routeReuseStrategy=r,this.futureState=l,this.currState=n,this.forwardEvent=s,this.inputBindingEnabled=d}activate(r){let l=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(l,n,r),JS(this.futureState.root),this.activateChildRoutes(l,n,r)}deactivateChildRoutes(r,l,n){let s=om(l);r.children.forEach(d=>{let m=d.value.outlet;this.deactivateRoutes(d,s[m],n),delete s[m]}),Object.values(s).forEach(d=>{this.deactivateRouteAndItsChildren(d,n)})}deactivateRoutes(r,l,n){let s=r.value,d=l?l.value:null;if(s===d)if(s.component){let m=n.getContext(s.outlet);m&&this.deactivateChildRoutes(r,l,m.children)}else this.deactivateChildRoutes(r,l,n);else d&&this.deactivateRouteAndItsChildren(l,n)}deactivateRouteAndItsChildren(r,l){r.value.component&&this.routeReuseStrategy.shouldDetach(r.value.snapshot)?this.detachAndStoreRouteSubtree(r,l):this.deactivateRouteAndOutlet(r,l)}detachAndStoreRouteSubtree(r,l){let n=l.getContext(r.value.outlet),s=n&&r.value.component?n.children:l,d=om(r);for(let m of Object.values(d))this.deactivateRouteAndItsChildren(m,s);if(n&&n.outlet){let m=n.outlet.detach(),_=n.children.onOutletDeactivated();this.routeReuseStrategy.store(r.value.snapshot,{componentRef:m,route:r,contexts:_})}}deactivateRouteAndOutlet(r,l){let n=l.getContext(r.value.outlet),s=n&&r.value.component?n.children:l,d=om(r);for(let m of Object.values(d))this.deactivateRouteAndItsChildren(m,s);n&&(n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated()),n.attachRef=null,n.route=null)}activateChildRoutes(r,l,n){let s=om(l);r.children.forEach(d=>{this.activateRoutes(d,s[d.value.outlet],n),this.forwardEvent(new gE(d.value.snapshot))}),r.children.length&&this.forwardEvent(new pE(r.value.snapshot))}activateRoutes(r,l,n){let s=r.value,d=l?l.value:null;if(JS(s),s===d)if(s.component){let m=n.getOrCreateContext(s.outlet);this.activateChildRoutes(r,l,m.children)}else this.activateChildRoutes(r,l,n);else if(s.component){let m=n.getOrCreateContext(s.outlet);if(this.routeReuseStrategy.shouldAttach(s.snapshot)){let _=this.routeReuseStrategy.retrieve(s.snapshot);this.routeReuseStrategy.store(s.snapshot,null),m.children.onOutletReAttached(_.contexts),m.attachRef=_.componentRef,m.route=_.route.value,m.outlet&&m.outlet.attach(_.componentRef,_.route.value),JS(_.route.value),this.activateChildRoutes(r,null,m.children)}else{let _=qf(s.snapshot);m.attachRef=null,m.route=s,m.injector=_,m.outlet&&m.outlet.activateWith(s,m.injector),this.activateChildRoutes(r,null,m.children)}}else this.activateChildRoutes(r,null,n)}},Qv=class{constructor(r){this.path=r,this.route=this.path[this.path.length-1]}},am=class{constructor(r,l){this.component=r,this.route=l}};function e9(a,r,l){let n=a._root,s=r?r._root:null;return Rf(n,s,l,[n.value])}function i9(a){let r=a.routeConfig?a.routeConfig.canActivateChild:null;return!r||r.length===0?null:{node:a,guards:r}}function um(a,r){let l=Symbol(),n=r.get(a,l);return n===l?typeof a=="function"&&!zF(a)?a:r.get(a):n}function Rf(a,r,l,n,s={canDeactivateChecks:[],canActivateChecks:[]}){let d=om(r);return a.children.forEach(m=>{n9(m,d[m.value.outlet],l,n.concat([m.value]),s),delete d[m.value.outlet]}),Object.entries(d).forEach(([m,_])=>Lf(_,l.getContext(m),s)),s}function n9(a,r,l,n,s={canDeactivateChecks:[],canActivateChecks:[]}){let d=a.value,m=r?r.value:null,_=l?l.getContext(a.value.outlet):null;if(m&&d.routeConfig===m.routeConfig){let w=r9(m,d,d.routeConfig.runGuardsAndResolvers);w?s.canActivateChecks.push(new Qv(n)):(d.data=m.data,d._resolvedData=m._resolvedData),d.component?Rf(a,r,_?_.children:null,n,s):Rf(a,r,l,n,s),w&&_&&_.outlet&&_.outlet.isActivated&&s.canDeactivateChecks.push(new am(_.outlet.component,m))}else m&&Lf(r,_,s),s.canActivateChecks.push(new Qv(n)),d.component?Rf(a,null,_?_.children:null,n,s):Rf(a,null,l,n,s);return s}function r9(a,r,l){if(typeof l=="function")return l(a,r);switch(l){case"pathParamsChange":return!Mu(a.url,r.url);case"pathParamsOrQueryParamsChange":return!Mu(a.url,r.url)||!jl(a.queryParams,r.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!bE(a,r)||!jl(a.queryParams,r.queryParams);case"paramsChange":default:return!bE(a,r)}}function Lf(a,r,l){let n=om(a),s=a.value;Object.entries(n).forEach(([d,m])=>{s.component?r?Lf(m,r.children.getContext(d),l):Lf(m,null,l):Lf(m,r,l)}),s.component?r&&r.outlet&&r.outlet.isActivated?l.canDeactivateChecks.push(new am(r.outlet.component,s)):l.canDeactivateChecks.push(new am(null,s)):l.canDeactivateChecks.push(new am(null,s))}function Wf(a){return typeof a=="function"}function o9(a){return typeof a=="boolean"}function s9(a){return a&&Wf(a.canLoad)}function a9(a){return a&&Wf(a.canActivate)}function l9(a){return a&&Wf(a.canActivateChild)}function c9(a){return a&&Wf(a.canDeactivate)}function d9(a){return a&&Wf(a.canMatch)}function r3(a){return a instanceof TF||a?.name==="EmptyError"}var jv=Symbol("INITIAL_VALUE");function dm(){return no(a=>bc(a.map(r=>r.pipe(Ji(1),co(jv)))).pipe(Fi(r=>{for(let l of r)if(l!==!0){if(l===jv)return jv;if(l===!1||l instanceof pd)return l}return!0}),wn(r=>r!==jv),Ji(1)))}function u9(a,r){return Is(l=>{let{targetSnapshot:n,currentSnapshot:s,guards:{canActivateChecks:d,canDeactivateChecks:m}}=l;return m.length===0&&d.length===0?Fe(Ri(Gt({},l),{guardsResult:!0})):h9(m,n,s,a).pipe(Is(_=>_&&o9(_)?m9(n,d,a,r):Fe(_)),Fi(_=>Ri(Gt({},l),{guardsResult:_})))})}function h9(a,r,l,n){return Ro(a).pipe(Is(s=>v9(s.component,s.route,l,r,n)),Nl(s=>s!==!0,!0))}function m9(a,r,l,n){return Ro(r).pipe(fu(s=>fv(f9(s.route.parent,n),p9(s.route,n),_9(a,s.path,l),g9(a,s.route,l))),Nl(s=>s!==!0,!0))}function p9(a,r){return a!==null&&r&&r(new fE(a)),Fe(!0)}function f9(a,r){return a!==null&&r&&r(new mE(a)),Fe(!0)}function g9(a,r,l){let n=r.routeConfig?r.routeConfig.canActivate:null;if(!n||n.length===0)return Fe(!0);let s=n.map(d=>xc(()=>{let m=qf(r)??l,_=um(d,m),w=a9(_)?_.canActivate(r,a):Cc(m,()=>_(r,a));return gd(w).pipe(Nl())}));return Fe(s).pipe(dm())}function _9(a,r,l){let n=r[r.length-1],d=r.slice(0,r.length-1).reverse().map(m=>i9(m)).filter(m=>m!==null).map(m=>xc(()=>{let _=m.guards.map(w=>{let S=qf(m.node)??l,T=um(w,S),L=l9(T)?T.canActivateChild(n,a):Cc(S,()=>T(n,a));return gd(L).pipe(Nl())});return Fe(_).pipe(dm())}));return Fe(d).pipe(dm())}function v9(a,r,l,n,s){let d=r&&r.routeConfig?r.routeConfig.canDeactivate:null;if(!d||d.length===0)return Fe(!0);let m=d.map(_=>{let w=qf(r)??s,S=um(_,w),T=c9(S)?S.canDeactivate(a,r,l,n):Cc(w,()=>S(a,r,l,n));return gd(T).pipe(Nl())});return Fe(m).pipe(dm())}function y9(a,r,l,n){let s=r.canLoad;if(s===void 0||s.length===0)return Fe(!0);let d=s.map(m=>{let _=um(m,a),w=s9(_)?_.canLoad(r,l):Cc(a,()=>_(r,l));return gd(w)});return Fe(d).pipe(dm(),o3(n))}function o3(a){return DF($r(r=>{if(cm(r))throw e3(a,r)}),Fi(r=>r===!0))}function b9(a,r,l,n){let s=r.canMatch;if(!s||s.length===0)return Fe(!0);let d=s.map(m=>{let _=um(m,a),w=d9(_)?_.canMatch(r,l):Cc(a,()=>_(r,l));return gd(w)});return Fe(d).pipe(dm(),o3(n))}var Hf=class{constructor(r){this.segmentGroup=r||null}},Jv=class extends Error{constructor(r){super(),this.urlTree=r}};function rm(a){return Ll(new Hf(a))}function x9(a){return Ll(new dr(4e3,!1))}function w9(a){return Ll(i3(!1,_a.GuardRejected))}var CE=class{constructor(r,l){this.urlSerializer=r,this.urlTree=l}lineralizeSegments(r,l){let n=[],s=l.root;for(;;){if(n=n.concat(s.segments),s.numberOfChildren===0)return Fe(n);if(s.numberOfChildren>1||!s.children[sn])return x9(r.redirectTo);s=s.children[sn]}}applyRedirectCommands(r,l,n){let s=this.applyRedirectCreateUrlTree(l,this.urlSerializer.parse(l),r,n);if(l.startsWith("/"))throw new Jv(s);return s}applyRedirectCreateUrlTree(r,l,n,s){let d=this.createSegmentGroup(r,l.root,n,s);return new pd(d,this.createQueryParams(l.queryParams,this.urlTree.queryParams),l.fragment)}createQueryParams(r,l){let n={};return Object.entries(r).forEach(([s,d])=>{if(typeof d=="string"&&d.startsWith(":")){let _=d.substring(1);n[s]=l[_]}else n[s]=d}),n}createSegmentGroup(r,l,n,s){let d=this.createSegments(r,l.segments,n,s),m={};return Object.entries(l.children).forEach(([_,w])=>{m[_]=this.createSegmentGroup(r,w,n,s)}),new sr(d,m)}createSegments(r,l,n,s){return l.map(d=>d.path.startsWith(":")?this.findPosParam(r,d,s):this.findOrReturn(d,n))}findPosParam(r,l,n){let s=n[l.path.substring(1)];if(!s)throw new dr(4001,!1);return s}findOrReturn(r,l){let n=0;for(let s of l){if(s.path===r.path)return l.splice(n),s;n++}return r}},SE={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function C9(a,r,l,n,s){let d=PE(a,r,l);return d.matched?(n=Q7(r,n),b9(n,r,l,s).pipe(Fi(m=>m===!0?d:Gt({},SE)))):Fe(d)}function PE(a,r,l){if(r.path==="**")return S9(l);if(r.path==="")return r.pathMatch==="full"&&(a.hasChildren()||l.length>0)?Gt({},SE):{matched:!0,consumedSegments:[],remainingSegments:l,parameters:{},positionalParamSegments:{}};let s=(r.matcher||b7)(l,a,r);if(!s)return Gt({},SE);let d={};Object.entries(s.posParams??{}).forEach(([_,w])=>{d[_]=w.path});let m=s.consumed.length>0?Gt(Gt({},d),s.consumed[s.consumed.length-1].parameters):d;return{matched:!0,consumedSegments:s.consumed,remainingSegments:l.slice(s.consumed.length),parameters:m,positionalParamSegments:s.posParams??{}}}function S9(a){return{matched:!0,parameters:a.length>0?NL(a).parameters:{},consumedSegments:a,remainingSegments:[],positionalParamSegments:{}}}function LL(a,r,l,n){return l.length>0&&D9(a,l,n)?{segmentGroup:new sr(r,M9(n,new sr(l,a.children))),slicedSegments:[]}:l.length===0&&T9(a,l,n)?{segmentGroup:new sr(a.segments,E9(a,l,n,a.children)),slicedSegments:l}:{segmentGroup:new sr(a.segments,a.children),slicedSegments:l}}function E9(a,r,l,n){let s={};for(let d of l)if(ey(a,r,d)&&!n[Ul(d)]){let m=new sr([],{});s[Ul(d)]=m}return Gt(Gt({},n),s)}function M9(a,r){let l={};l[sn]=r;for(let n of a)if(n.path===""&&Ul(n)!==sn){let s=new sr([],{});l[Ul(n)]=s}return l}function D9(a,r,l){return l.some(n=>ey(a,r,n)&&Ul(n)!==sn)}function T9(a,r,l){return l.some(n=>ey(a,r,n))}function ey(a,r,l){return(a.hasChildren()||r.length>0)&&l.pathMatch==="full"?!1:l.path===""}function I9(a,r,l,n){return Ul(a)!==n&&(n===sn||!ey(r,l,a))?!1:PE(r,a,l).matched}function A9(a,r,l){return r.length===0&&!a.children[l]}var EE=class{};function k9(a,r,l,n,s,d,m="emptyOnly"){return new ME(a,r,l,n,s,m,d).recognize()}var R9=31,ME=class{constructor(r,l,n,s,d,m,_){this.injector=r,this.configLoader=l,this.rootComponentType=n,this.config=s,this.urlTree=d,this.paramsInheritanceStrategy=m,this.urlSerializer=_,this.applyRedirects=new CE(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(r){return new dr(4002,`'${r.segmentGroup}'`)}recognize(){let r=LL(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(r).pipe(Fi(l=>{let n=new jf([],Object.freeze({}),Object.freeze(Gt({},this.urlTree.queryParams)),this.urlTree.fragment,{},sn,this.rootComponentType,null,{}),s=new Xs(n,l),d=new Kv("",s),m=B7(n,[],this.urlTree.queryParams,this.urlTree.fragment);return m.queryParams=this.urlTree.queryParams,d.url=this.urlSerializer.serialize(m),this.inheritParamsAndData(d._root,null),{state:d,tree:m}}))}match(r){return this.processSegmentGroup(this.injector,this.config,r,sn).pipe(zl(n=>{if(n instanceof Jv)return this.urlTree=n.urlTree,this.match(n.urlTree.root);throw n instanceof Hf?this.noMatchError(n):n}))}inheritParamsAndData(r,l){let n=r.value,s=IE(n,l,this.paramsInheritanceStrategy);n.params=Object.freeze(s.params),n.data=Object.freeze(s.data),r.children.forEach(d=>this.inheritParamsAndData(d,n))}processSegmentGroup(r,l,n,s){return n.segments.length===0&&n.hasChildren()?this.processChildren(r,l,n):this.processSegment(r,l,n,n.segments,s,!0).pipe(Fi(d=>d instanceof Xs?[d]:[]))}processChildren(r,l,n){let s=[];for(let d of Object.keys(n.children))d==="primary"?s.unshift(d):s.push(d);return Ro(s).pipe(fu(d=>{let m=n.children[d],_=J7(l,d);return this.processSegmentGroup(r,_,m,d)}),PF((d,m)=>(d.push(...m),d)),DS(null),kF(),Is(d=>{if(d===null)return rm(n);let m=s3(d);return P9(m),Fe(m)}))}processSegment(r,l,n,s,d,m){return Ro(l).pipe(fu(_=>this.processSegmentAgainstRoute(_._injector??r,l,_,n,s,d,m).pipe(zl(w=>{if(w instanceof Hf)return Fe(null);throw w}))),Nl(_=>!!_),zl(_=>{if(r3(_))return A9(n,s,d)?Fe(new EE):rm(n);throw _}))}processSegmentAgainstRoute(r,l,n,s,d,m,_){return I9(n,s,d,m)?n.redirectTo===void 0?this.matchSegmentAgainstRoute(r,s,n,d,m):this.allowRedirects&&_?this.expandSegmentAgainstRouteUsingRedirect(r,s,l,n,d,m):rm(s):rm(s)}expandSegmentAgainstRouteUsingRedirect(r,l,n,s,d,m){let{matched:_,consumedSegments:w,positionalParamSegments:S,remainingSegments:T}=PE(l,s,d);if(!_)return rm(l);s.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>R9&&(this.allowRedirects=!1));let L=this.applyRedirects.applyRedirectCommands(w,s.redirectTo,S);return this.applyRedirects.lineralizeSegments(s,L).pipe(Is(H=>this.processSegment(r,n,l,H.concat(T),m,!1)))}matchSegmentAgainstRoute(r,l,n,s,d){let m=C9(l,n,s,r,this.urlSerializer);return n.path==="**"&&(l.children={}),m.pipe(no(_=>_.matched?(r=n._injector??r,this.getChildConfig(r,n,s).pipe(no(({routes:w})=>{let S=n._loadedInjector??r,{consumedSegments:T,remainingSegments:L,parameters:H}=_,q=new jf(T,H,Object.freeze(Gt({},this.urlTree.queryParams)),this.urlTree.fragment,F9(n),Ul(n),n.component??n._loadedComponent??null,n,L9(n)),{segmentGroup:X,slicedSegments:it}=LL(l,T,L,w);if(it.length===0&&X.hasChildren())return this.processChildren(S,w,X).pipe(Fi(ut=>ut===null?null:new Xs(q,ut)));if(w.length===0&&it.length===0)return Fe(new Xs(q,[]));let at=Ul(n)===d;return this.processSegment(S,w,X,it,at?sn:d,!0).pipe(Fi(ut=>new Xs(q,ut instanceof Xs?[ut]:[])))}))):rm(l)))}getChildConfig(r,l,n){return l.children?Fe({routes:l.children,injector:r}):l.loadChildren?l._loadedRoutes!==void 0?Fe({routes:l._loadedRoutes,injector:l._loadedInjector}):y9(r,l,n,this.urlSerializer).pipe(Is(s=>s?this.configLoader.loadChildren(r,l).pipe($r(d=>{l._loadedRoutes=d.routes,l._loadedInjector=d.injector})):w9(l))):Fe({routes:[],injector:r})}};function P9(a){a.sort((r,l)=>r.value.outlet===sn?-1:l.value.outlet===sn?1:r.value.outlet.localeCompare(l.value.outlet))}function O9(a){let r=a.value.routeConfig;return r&&r.path===""}function s3(a){let r=[],l=new Set;for(let n of a){if(!O9(n)){r.push(n);continue}let s=r.find(d=>n.value.routeConfig===d.value.routeConfig);s!==void 0?(s.children.push(...n.children),l.add(s)):r.push(n)}for(let n of l){let s=s3(n.children);r.push(new Xs(n.value,s))}return r.filter(n=>!l.has(n))}function F9(a){return a.data||{}}function L9(a){return a.resolve||{}}function z9(a,r,l,n,s,d){return Is(m=>k9(a,r,l,n,m.extractedUrl,s,d).pipe(Fi(({state:_,tree:w})=>Ri(Gt({},m),{targetSnapshot:_,urlAfterRedirects:w}))))}function N9(a,r){return Is(l=>{let{targetSnapshot:n,guards:{canActivateChecks:s}}=l;if(!s.length)return Fe(l);let d=new Set(s.map(w=>w.route)),m=new Set;for(let w of d)if(!m.has(w))for(let S of a3(w))m.add(S);let _=0;return Ro(m).pipe(fu(w=>d.has(w)?B9(w,n,a,r):(w.data=IE(w,w.parent,a).resolve,Fe(void 0))),$r(()=>_++),TS(1),Is(w=>_===m.size?Fe(l):yc))})}function a3(a){let r=a.children.map(l=>a3(l)).flat();return[a,...r]}function B9(a,r,l,n){let s=a.routeConfig,d=a._resolve;return s?.title!==void 0&&!JL(s)&&(d[Gf]=s.title),V9(d,a,r,n).pipe(Fi(m=>(a._resolvedData=m,a.data=IE(a,a.parent,l).resolve,null)))}function V9(a,r,l,n){let s=iE(a);if(s.length===0)return Fe({});let d={};return Ro(s).pipe(Is(m=>j9(a[m],r,l,n).pipe(Nl(),$r(_=>{d[m]=_}))),TS(1),AF(d),zl(m=>r3(m)?yc:Ll(m)))}function j9(a,r,l,n){let s=qf(r)??n,d=um(a,s),m=d.resolve?d.resolve(r,l):Cc(s,()=>d(r,l));return gd(m)}function tE(a){return no(r=>{let l=a(r);return l?Ro(l).pipe(Fi(()=>r)):Fe(r)})}var l3=(()=>{let r=class r{buildTitle(n){let s,d=n.root;for(;d!==void 0;)s=this.getResolvedTitleForRoute(d)??s,d=d.children.find(m=>m.outlet===sn);return s}getResolvedTitleForRoute(n){return n.data[Gf]}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:()=>oe(U9),providedIn:"root"});let a=r;return a})(),U9=(()=>{let r=class r extends l3{constructor(n){super(),this.title=n}updateTitle(n){let s=this.buildTitle(n);s!==void 0&&this.title.setTitle(s)}};r.\u0275fac=function(s){return new(s||r)(ht(AL))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),OE=new we("",{providedIn:"root",factory:()=>({})}),FE=new we(""),H9=(()=>{let r=class r{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=oe(PS)}loadComponent(n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return Fe(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);let s=gd(n.loadComponent()).pipe(Fi(c3),$r(m=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=m}),nl(()=>{this.componentLoaders.delete(n)})),d=new pf(s,()=>new pe).pipe(SS());return this.componentLoaders.set(n,d),d}loadChildren(n,s){if(this.childrenLoaders.get(s))return this.childrenLoaders.get(s);if(s._loadedRoutes)return Fe({routes:s._loadedRoutes,injector:s._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(s);let m=G9(s,this.compiler,n,this.onLoadEndListener).pipe(nl(()=>{this.childrenLoaders.delete(s)})),_=new pf(m,()=>new pe).pipe(SS());return this.childrenLoaders.set(s,_),_}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function G9(a,r,l,n){return gd(a.loadChildren()).pipe(Fi(c3),Is(s=>s instanceof ZF||Array.isArray(s)?Fe(s):Ro(r.compileModuleAsync(s))),Fi(s=>{n&&n(a);let d,m,_=!1;return Array.isArray(s)?(m=s,_=!0):(d=s.create(l).injector,m=d.get(FE,[],{optional:!0,self:!0}).flat()),{routes:m.map(RE),injector:d}}))}function q9(a){return a&&typeof a=="object"&&"default"in a}function c3(a){return q9(a)?a.default:a}var LE=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:()=>oe(W9),providedIn:"root"});let a=r;return a})(),W9=(()=>{let r=class r{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,s){return n}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),$9=new we("");var Y9=(()=>{let r=class r{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new pe,this.transitionAbortSubject=new pe,this.configLoader=oe(H9),this.environmentInjector=oe(qh),this.urlSerializer=oe(TE),this.rootContexts=oe(ty),this.location=oe(Bl),this.inputBindingEnabled=oe(kE,{optional:!0})!==null,this.titleStrategy=oe(l3),this.options=oe(OE,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=oe(LE),this.createViewTransition=oe($9,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Fe(void 0),this.rootComponentType=null;let n=d=>this.events.next(new uE(d)),s=d=>this.events.next(new hE(d));this.configLoader.onLoadEndListener=s,this.configLoader.onLoadStartListener=n}complete(){this.transitions?.complete()}handleNavigationRequest(n){let s=++this.navigationId;this.transitions?.next(Ri(Gt(Gt({},this.transitions.value),n),{id:s}))}setupNavigations(n,s,d){return this.transitions=new Ze({id:0,currentUrlTree:s,currentRawUrl:s,extractedUrl:this.urlHandlingStrategy.extract(s),urlAfterRedirects:this.urlHandlingStrategy.extract(s),rawUrl:s,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Ff,restoredState:null,currentSnapshot:d.snapshot,targetSnapshot:null,currentRouterState:d,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(wn(m=>m.id!==0),Fi(m=>Ri(Gt({},m),{extractedUrl:this.urlHandlingStrategy.extract(m.rawUrl)})),no(m=>{this.currentTransition=m;let _=!1,w=!1;return Fe(m).pipe($r(S=>{this.currentNavigation={id:S.id,initialUrl:S.rawUrl,extractedUrl:S.extractedUrl,trigger:S.source,extras:S.extras,previousNavigation:this.lastSuccessfulNavigation?Ri(Gt({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),no(S=>{let T=!n.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),L=S.extras.onSameUrlNavigation??n.onSameUrlNavigation;if(!T&&L!=="reload"){let H="";return this.events.next(new Tu(S.id,this.urlSerializer.serialize(S.rawUrl),H,sE.IgnoredSameUrlNavigation)),S.resolve(null),yc}if(this.urlHandlingStrategy.shouldProcessUrl(S.rawUrl))return Fe(S).pipe(no(H=>{let q=this.transitions?.getValue();return this.events.next(new Du(H.id,this.urlSerializer.serialize(H.extractedUrl),H.source,H.restoredState)),q!==this.transitions?.getValue()?yc:Promise.resolve(H)}),z9(this.environmentInjector,this.configLoader,this.rootComponentType,n.config,this.urlSerializer,this.paramsInheritanceStrategy),$r(H=>{m.targetSnapshot=H.targetSnapshot,m.urlAfterRedirects=H.urlAfterRedirects,this.currentNavigation=Ri(Gt({},this.currentNavigation),{finalUrl:H.urlAfterRedirects});let q=new Yv(H.id,this.urlSerializer.serialize(H.extractedUrl),this.urlSerializer.serialize(H.urlAfterRedirects),H.targetSnapshot);this.events.next(q)}));if(T&&this.urlHandlingStrategy.shouldProcessUrl(S.currentRawUrl)){let{id:H,extractedUrl:q,source:X,restoredState:it,extras:at}=S,ut=new Du(H,this.urlSerializer.serialize(q),X,it);this.events.next(ut);let Mt=KL(this.rootComponentType).snapshot;return this.currentTransition=m=Ri(Gt({},S),{targetSnapshot:Mt,urlAfterRedirects:q,extras:Ri(Gt({},at),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=q,Fe(m)}else{let H="";return this.events.next(new Tu(S.id,this.urlSerializer.serialize(S.extractedUrl),H,sE.IgnoredByUrlHandlingStrategy)),S.resolve(null),yc}}),$r(S=>{let T=new aE(S.id,this.urlSerializer.serialize(S.extractedUrl),this.urlSerializer.serialize(S.urlAfterRedirects),S.targetSnapshot);this.events.next(T)}),Fi(S=>(this.currentTransition=m=Ri(Gt({},S),{guards:e9(S.targetSnapshot,S.currentSnapshot,this.rootContexts)}),m)),u9(this.environmentInjector,S=>this.events.next(S)),$r(S=>{if(m.guardsResult=S.guardsResult,cm(S.guardsResult))throw e3(this.urlSerializer,S.guardsResult);let T=new lE(S.id,this.urlSerializer.serialize(S.extractedUrl),this.urlSerializer.serialize(S.urlAfterRedirects),S.targetSnapshot,!!S.guardsResult);this.events.next(T)}),wn(S=>S.guardsResult?!0:(this.cancelNavigationTransition(S,"",_a.GuardRejected),!1)),tE(S=>{if(S.guards.canActivateChecks.length)return Fe(S).pipe($r(T=>{let L=new cE(T.id,this.urlSerializer.serialize(T.extractedUrl),this.urlSerializer.serialize(T.urlAfterRedirects),T.targetSnapshot);this.events.next(L)}),no(T=>{let L=!1;return Fe(T).pipe(N9(this.paramsInheritanceStrategy,this.environmentInjector),$r({next:()=>L=!0,complete:()=>{L||this.cancelNavigationTransition(T,"",_a.NoDataFromResolver)}}))}),$r(T=>{let L=new dE(T.id,this.urlSerializer.serialize(T.extractedUrl),this.urlSerializer.serialize(T.urlAfterRedirects),T.targetSnapshot);this.events.next(L)}))}),tE(S=>{let T=L=>{let H=[];L.routeConfig?.loadComponent&&!L.routeConfig._loadedComponent&&H.push(this.configLoader.loadComponent(L.routeConfig).pipe($r(q=>{L.component=q}),Fi(()=>{})));for(let q of L.children)H.push(...T(q));return H};return bc(T(S.targetSnapshot.root)).pipe(DS(null),Ji(1))}),tE(()=>this.afterPreactivation()),no(()=>{let{currentSnapshot:S,targetSnapshot:T}=m,L=this.createViewTransition?.(this.environmentInjector,S.root,T.root);return L?Ro(L).pipe(Fi(()=>m)):Fe(m)}),Fi(S=>{let T=$7(n.routeReuseStrategy,S.targetSnapshot,S.currentRouterState);return this.currentTransition=m=Ri(Gt({},S),{targetRouterState:T}),this.currentNavigation.targetRouterState=T,m}),$r(()=>{this.events.next(new Bf)}),t9(this.rootContexts,n.routeReuseStrategy,S=>this.events.next(S),this.inputBindingEnabled),Ji(1),$r({next:S=>{_=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Ks(S.id,this.urlSerializer.serialize(S.extractedUrl),this.urlSerializer.serialize(S.urlAfterRedirects))),this.titleStrategy?.updateTitle(S.targetRouterState.snapshot),S.resolve(!0)},complete:()=>{_=!0}}),ri(this.transitionAbortSubject.pipe($r(S=>{throw S}))),nl(()=>{!_&&!w&&this.cancelNavigationTransition(m,"",_a.SupersededByNewNavigation),this.currentNavigation?.id===m.id&&(this.currentNavigation=null)}),zl(S=>{if(w=!0,n3(S))this.events.next(new fd(m.id,this.urlSerializer.serialize(m.extractedUrl),S.message,S.cancellationCode)),X7(S)?this.events.next(new Vf(S.url)):m.resolve(!1);else{this.events.next(new Nf(m.id,this.urlSerializer.serialize(m.extractedUrl),S,m.targetSnapshot??void 0));try{m.resolve(n.errorHandler(S))}catch(T){this.options.resolveNavigationPromiseOnError?m.resolve(!1):m.reject(T)}}return yc}))}))}cancelNavigationTransition(n,s,d){let m=new fd(n.id,this.urlSerializer.serialize(n.extractedUrl),s,d);this.events.next(m),n.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function Z9(a){return a!==Ff}var X9=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:()=>oe(K9),providedIn:"root"});let a=r;return a})(),DE=class{shouldDetach(r){return!1}store(r,l){}shouldAttach(r){return!1}retrieve(r){return null}shouldReuseRoute(r,l){return r.routeConfig===l.routeConfig}},K9=(()=>{let r=class r extends DE{};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=zr(r)))(d||r)}})(),r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),d3=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:()=>oe(Q9),providedIn:"root"});let a=r;return a})(),Q9=(()=>{let r=class r extends d3{constructor(){super(...arguments),this.location=oe(Bl),this.urlSerializer=oe(TE),this.options=oe(OE,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=oe(LE),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new pd,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=KL(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(n){return this.location.subscribe(s=>{s.type==="popstate"&&n(s.url,s.state)})}handleRouterEvent(n,s){if(n instanceof Du)this.stateMemento=this.createStateMemento();else if(n instanceof Tu)this.rawUrlTree=s.initialUrl;else if(n instanceof Yv){if(this.urlUpdateStrategy==="eager"&&!s.extras.skipLocationChange){let d=this.urlHandlingStrategy.merge(s.finalUrl,s.initialUrl);this.setBrowserUrl(d,s)}}else n instanceof Bf?(this.currentUrlTree=s.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(s.finalUrl,s.initialUrl),this.routerState=s.targetRouterState,this.urlUpdateStrategy==="deferred"&&(s.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,s))):n instanceof fd&&(n.code===_a.GuardRejected||n.code===_a.NoDataFromResolver)?this.restoreHistory(s):n instanceof Nf?this.restoreHistory(s,!0):n instanceof Ks&&(this.lastSuccessfulId=n.id,this.currentPageId=this.browserPageId)}setBrowserUrl(n,s){let d=this.urlSerializer.serialize(n);if(this.location.isCurrentPathEqualTo(d)||s.extras.replaceUrl){let m=this.browserPageId,_=Gt(Gt({},s.extras.state),this.generateNgRouterState(s.id,m));this.location.replaceState(d,"",_)}else{let m=Gt(Gt({},s.extras.state),this.generateNgRouterState(s.id,this.browserPageId+1));this.location.go(d,"",m)}}restoreHistory(n,s=!1){if(this.canceledNavigationResolution==="computed"){let d=this.browserPageId,m=this.currentPageId-d;m!==0?this.location.historyGo(m):this.currentUrlTree===n.finalUrl&&m===0&&(this.resetState(n),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(s&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(n,s){return this.canceledNavigationResolution==="computed"?{navigationId:n,\u0275routerPageId:s}:{navigationId:n}}};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=zr(r)))(d||r)}})(),r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),Pf=function(a){return a[a.COMPLETE=0]="COMPLETE",a[a.FAILED=1]="FAILED",a[a.REDIRECTING=2]="REDIRECTING",a}(Pf||{});function J9(a,r){a.events.pipe(wn(l=>l instanceof Ks||l instanceof fd||l instanceof Nf||l instanceof Tu),Fi(l=>l instanceof Ks||l instanceof Tu?Pf.COMPLETE:(l instanceof fd?l.code===_a.Redirect||l.code===_a.SupersededByNewNavigation:!1)?Pf.REDIRECTING:Pf.FAILED),wn(l=>l!==Pf.REDIRECTING),Ji(1)).subscribe(()=>{r()})}function tY(a){throw a}var eY={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},iY={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},tn=(()=>{let r=class r{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=oe(Ev),this.stateManager=oe(d3),this.options=oe(OE,{optional:!0})||{},this.pendingTasks=oe(Cf),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=oe(Y9),this.urlSerializer=oe(TE),this.location=oe(Bl),this.urlHandlingStrategy=oe(LE),this._events=new pe,this.errorHandler=this.options.errorHandler||tY,this.navigated=!1,this.routeReuseStrategy=oe(X9),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=oe(FE,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!oe(kE,{optional:!0}),this.eventsSubscription=new nr,this.isNgZoneEnabled=oe(ze)instanceof ze&&ze.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:n=>{this.console.warn(n)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let n=this.navigationTransitions.events.subscribe(s=>{try{let d=this.navigationTransitions.currentTransition,m=this.navigationTransitions.currentNavigation;if(d!==null&&m!==null){if(this.stateManager.handleRouterEvent(s,m),s instanceof fd&&s.code!==_a.Redirect&&s.code!==_a.SupersededByNewNavigation)this.navigated=!0;else if(s instanceof Ks)this.navigated=!0;else if(s instanceof Vf){let _=this.urlHandlingStrategy.merge(s.url,d.currentRawUrl),w={info:d.extras.info,skipLocationChange:d.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||Z9(d.source)};this.scheduleNavigation(_,Ff,null,w,{resolve:d.resolve,reject:d.reject,promise:d.promise})}}rY(s)&&this._events.next(s)}catch(d){this.navigationTransitions.transitionAbortSubject.next(d)}});this.eventsSubscription.add(n)}resetRootComponentType(n){this.routerState.root.component=n,this.navigationTransitions.rootComponentType=n}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Ff,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((n,s)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(n,"popstate",s)},0)})}navigateToSyncWithBrowser(n,s,d){let m={replaceUrl:!0},_=d?.navigationId?d:null;if(d){let S=Gt({},d);delete S.navigationId,delete S.\u0275routerPageId,Object.keys(S).length!==0&&(m.state=S)}let w=this.parseUrl(n);this.scheduleNavigation(w,s,_,m)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(n){this.config=n.map(RE),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(n,s={}){let{relativeTo:d,queryParams:m,fragment:_,queryParamsHandling:w,preserveFragment:S}=s,T=S?this.currentUrlTree.fragment:_,L=null;switch(w){case"merge":L=Gt(Gt({},this.currentUrlTree.queryParams),m);break;case"preserve":L=this.currentUrlTree.queryParams;break;default:L=m||null}L!==null&&(L=this.removeEmptyProps(L));let H;try{let q=d?d.snapshot:this.routerState.snapshot.root;H=$L(q)}catch{(typeof n[0]!="string"||!n[0].startsWith("/"))&&(n=[]),H=this.currentUrlTree.root}return YL(H,n,L,T??null)}navigateByUrl(n,s={skipLocationChange:!1}){let d=cm(n)?n:this.parseUrl(n),m=this.urlHandlingStrategy.merge(d,this.rawUrlTree);return this.scheduleNavigation(m,Ff,null,s)}navigate(n,s={skipLocationChange:!1}){return nY(n),this.navigateByUrl(this.createUrlTree(n,s),s)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){try{return this.urlSerializer.parse(n)}catch{return this.urlSerializer.parse("/")}}isActive(n,s){let d;if(s===!0?d=Gt({},eY):s===!1?d=Gt({},iY):d=s,cm(n))return RL(this.currentUrlTree,n,d);let m=this.parseUrl(n);return RL(this.currentUrlTree,m,d)}removeEmptyProps(n){return Object.entries(n).reduce((s,[d,m])=>(m!=null&&(s[d]=m),s),{})}scheduleNavigation(n,s,d,m,_){if(this.disposed)return Promise.resolve(!1);let w,S,T;_?(w=_.resolve,S=_.reject,T=_.promise):T=new Promise((H,q)=>{w=H,S=q});let L=this.pendingTasks.add();return J9(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(L))}),this.navigationTransitions.handleNavigationRequest({source:s,restoredState:d,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:n,extras:m,resolve:w,reject:S,promise:T,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),T.catch(H=>Promise.reject(H))}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function nY(a){for(let r=0;r<a.length;r++)if(a[r]==null)throw new dr(4008,!1)}function rY(a){return!(a instanceof Bf)&&!(a instanceof Vf)}var ar=(()=>{let r=class r{constructor(n,s,d,m,_,w){this.router=n,this.route=s,this.tabIndexAttribute=d,this.renderer=m,this.el=_,this.locationStrategy=w,this.href=null,this.commands=null,this.onChanges=new pe,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;let S=_.nativeElement.tagName?.toLowerCase();this.isAnchorElement=S==="a"||S==="area",this.isAnchorElement?this.subscription=n.events.subscribe(T=>{T instanceof Ks&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(n){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",n)}ngOnChanges(n){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(n){n!=null?(this.commands=Array.isArray(n)?n:[n],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(n,s,d,m,_){let w=this.urlTree;if(w===null||this.isAnchorElement&&(n!==0||s||d||m||_||typeof this.target=="string"&&this.target!="_self"))return!0;let S={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(w,S),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let n=this.urlTree;this.href=n!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(n)):null;let s=this.href===null?null:YF(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",s)}applyAttributeValue(n,s){let d=this.renderer,m=this.el.nativeElement;s!==null?d.setAttribute(m,n,s):d.removeAttribute(m,n)}get urlTree(){return this.commands===null?null:this.router.createUrlTree(this.commands,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}};r.\u0275fac=function(s){return new(s||r)(B(tn),B(En),rl("tabindex"),B(Oo),B(Se),B(OS))},r.\u0275dir=re({type:r,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(s,d){s&1&&ct("click",function(_){return d.onClick(_.button,_.ctrlKey,_.shiftKey,_.altKey,_.metaKey)}),s&2&&oi("target",d.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[Rt.HasDecoratorInputTransform,"preserveFragment","preserveFragment",Qe],skipLocationChange:[Rt.HasDecoratorInputTransform,"skipLocationChange","skipLocationChange",Qe],replaceUrl:[Rt.HasDecoratorInputTransform,"replaceUrl","replaceUrl",Qe],routerLink:"routerLink"},standalone:!0,features:[Tn,qn]});let a=r;return a})(),u3=(()=>{let r=class r{get isActive(){return this._isActive}constructor(n,s,d,m,_){this.router=n,this.element=s,this.renderer=d,this.cdr=m,this.link=_,this.classes=[],this._isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new ye,this.routerEventsSubscription=n.events.subscribe(w=>{w instanceof Ks&&this.update()})}ngAfterContentInit(){Fe(this.links.changes,Fe(null)).pipe(ES()).subscribe(n=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();let n=[...this.links.toArray(),this.link].filter(s=>!!s).map(s=>s.onChanges);this.linkInputChangesSubscription=Ro(n).pipe(ES()).subscribe(s=>{this._isActive!==this.isLinkActive(this.router)(s)&&this.update()})}set routerLinkActive(n){let s=Array.isArray(n)?n:n.split(" ");this.classes=s.filter(d=>!!d)}ngOnChanges(n){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{let n=this.hasActiveLinks();this._isActive!==n&&(this._isActive=n,this.cdr.markForCheck(),this.classes.forEach(s=>{n?this.renderer.addClass(this.element.nativeElement,s):this.renderer.removeClass(this.element.nativeElement,s)}),n&&this.ariaCurrentWhenActive!==void 0?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this.isActiveChange.emit(n))})}isLinkActive(n){let s=oY(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return d=>{let m=d.urlTree;return m?n.isActive(m,s):!1}}hasActiveLinks(){let n=this.isLinkActive(this.router);return this.link&&n(this.link)||this.links.some(n)}};r.\u0275fac=function(s){return new(s||r)(B(tn),B(Se),B(Oo),B(Wi),B(ar,8))},r.\u0275dir=re({type:r,selectors:[["","routerLinkActive",""]],contentQueries:function(s,d,m){if(s&1&&mn(m,ar,5),s&2){let _;ce(_=de())&&(d.links=_)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],standalone:!0,features:[qn]});let a=r;return a})();function oY(a){return!!a.paths}var sY=new we("");function h3(a,...r){return vu([{provide:FE,multi:!0,useValue:a},[],{provide:En,useFactory:aY,deps:[tn]},{provide:RS,multi:!0,useFactory:lY},r.map(l=>l.\u0275providers)])}function aY(a){return a.routerState.root}function lY(){let a=oe(uo);return r=>{let l=a.get(wu);if(r!==l.components[0])return;let n=a.get(tn),s=a.get(cY);a.get(dY)===1&&n.initialNavigation(),a.get(uY,null,AS.Optional)?.setUpPreloading(),a.get(sY,null,AS.Optional)?.init(),n.resetRootComponentType(l.componentTypes[0]),s.closed||(s.next(),s.complete(),s.unsubscribe())}}var cY=new we("",{factory:()=>new pe}),dY=new we("",{providedIn:"root",factory:()=>1});var uY=new we("");function ro(a){return a!=null&&`${a}`!="false"}function Hl(a,r=0){return zE(a)?Number(a):r}function zE(a){return!isNaN(parseFloat(a))&&!isNaN(Number(a))}function hm(a){return Array.isArray(a)?a:[a]}function Do(a){return a==null?"":typeof a=="string"?a:`${a}px`}function Os(a){return a instanceof Se?a.nativeElement:a}function m3(a,r=/\s+/){let l=[];if(a!=null){let n=Array.isArray(a)?a:`${a}`.split(r);for(let s of n){let d=`${s}`.trim();d&&l.push(d)}}return l}var BE;try{BE=typeof Intl<"u"&&Intl.v8BreakIterator}catch{BE=!1}var pn=(()=>{let r=class r{constructor(n){this._platformId=n,this.isBrowser=this._platformId?sL(this._platformId):typeof document=="object"&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!!(window.chrome||BE)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}};r.\u0275fac=function(s){return new(s||r)(ht(wc))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var mm,p3=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function VE(){if(mm)return mm;if(typeof document!="object"||!document)return mm=new Set(p3),mm;let a=document.createElement("input");return mm=new Set(p3.filter(r=>(a.setAttribute("type",r),a.type===r))),mm}var $f;function hY(){if($f==null&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>$f=!0}))}finally{$f=$f||!1}return $f}function es(a){return hY()?a:!!a.capture}var Iu;function f3(){if(Iu==null){if(typeof document!="object"||!document||typeof Element!="function"||!Element)return Iu=!1,Iu;if("scrollBehavior"in document.documentElement.style)Iu=!0;else{let a=Element.prototype.scrollTo;a?Iu=!/\{\s*\[native code\]\s*\}/.test(a.toString()):Iu=!1}}return Iu}var NE;function mY(){if(NE==null){let a=typeof document<"u"?document.head:null;NE=!!(a&&(a.createShadowRoot||a.attachShadow))}return NE}function g3(a){if(mY()){let r=a.getRootNode?a.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&r instanceof ShadowRoot)return r}return null}function _d(){let a=typeof document<"u"&&document?document.activeElement:null;for(;a&&a.shadowRoot;){let r=a.shadowRoot.activeElement;if(r===a)break;a=r}return a}function dl(a){return a.composedPath?a.composedPath()[0]:a.target}function iy(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}var pY=new we("cdk-dir-doc",{providedIn:"root",factory:fY});function fY(){return oe(li)}var gY=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function _Y(a){let r=a?.toLowerCase()||"";return r==="auto"&&typeof navigator<"u"&&navigator?.language?gY.test(navigator.language)?"rtl":"ltr":r==="rtl"?"rtl":"ltr"}var To=(()=>{let r=class r{constructor(n){if(this.value="ltr",this.change=new ye,n){let s=n.body?n.body.dir:null,d=n.documentElement?n.documentElement.dir:null;this.value=_Y(s||d||"ltr")}}ngOnDestroy(){this.change.complete()}};r.\u0275fac=function(s){return new(s||r)(ht(pY,8))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var Yf=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275mod=xi({type:r}),r.\u0275inj=wi({});let a=r;return a})();var ny=class{};function oy(a){return a&&typeof a.connect=="function"&&!(a instanceof pf)}var pm=function(a){return a[a.REPLACED=0]="REPLACED",a[a.INSERTED=1]="INSERTED",a[a.MOVED=2]="MOVED",a[a.REMOVED=3]="REMOVED",a}(pm||{}),Zf=new we("_ViewRepeater"),fm=class{applyChanges(r,l,n,s,d){r.forEachOperation((m,_,w)=>{let S,T;if(m.previousIndex==null){let L=n(m,_,w);S=l.createEmbeddedView(L.templateRef,L.context,L.index),T=pm.INSERTED}else w==null?(l.remove(_),T=pm.REMOVED):(S=l.get(_),l.move(S,w),T=pm.MOVED);d&&d({context:S?.context,operation:T,record:m})})}detach(){}};var ry=class{get selected(){return this._selected||(this._selected=Array.from(this._selection.values())),this._selected}constructor(r=!1,l,n=!0,s){this._multiple=r,this._emitChanges=n,this.compareWith=s,this._selection=new Set,this._deselectedToEmit=[],this._selectedToEmit=[],this.changed=new pe,l&&l.length&&(r?l.forEach(d=>this._markSelected(d)):this._markSelected(l[0]),this._selectedToEmit.length=0)}select(...r){this._verifyValueAssignment(r),r.forEach(n=>this._markSelected(n));let l=this._hasQueuedChanges();return this._emitChangeEvent(),l}deselect(...r){this._verifyValueAssignment(r),r.forEach(n=>this._unmarkSelected(n));let l=this._hasQueuedChanges();return this._emitChangeEvent(),l}setSelection(...r){this._verifyValueAssignment(r);let l=this.selected,n=new Set(r);r.forEach(d=>this._markSelected(d)),l.filter(d=>!n.has(this._getConcreteValue(d,n))).forEach(d=>this._unmarkSelected(d));let s=this._hasQueuedChanges();return this._emitChangeEvent(),s}toggle(r){return this.isSelected(r)?this.deselect(r):this.select(r)}clear(r=!0){this._unmarkAll();let l=this._hasQueuedChanges();return r&&this._emitChangeEvent(),l}isSelected(r){return this._selection.has(this._getConcreteValue(r))}isEmpty(){return this._selection.size===0}hasValue(){return!this.isEmpty()}sort(r){this._multiple&&this.selected&&this._selected.sort(r)}isMultipleSelection(){return this._multiple}_emitChangeEvent(){this._selected=null,(this._selectedToEmit.length||this._deselectedToEmit.length)&&(this.changed.next({source:this,added:this._selectedToEmit,removed:this._deselectedToEmit}),this._deselectedToEmit=[],this._selectedToEmit=[])}_markSelected(r){r=this._getConcreteValue(r),this.isSelected(r)||(this._multiple||this._unmarkAll(),this.isSelected(r)||this._selection.add(r),this._emitChanges&&this._selectedToEmit.push(r))}_unmarkSelected(r){r=this._getConcreteValue(r),this.isSelected(r)&&(this._selection.delete(r),this._emitChanges&&this._deselectedToEmit.push(r))}_unmarkAll(){this.isEmpty()||this._selection.forEach(r=>this._unmarkSelected(r))}_verifyValueAssignment(r){r.length>1&&this._multiple}_hasQueuedChanges(){return!!(this._deselectedToEmit.length||this._selectedToEmit.length)}_getConcreteValue(r,l){if(this.compareWith){l=l??this._selection;for(let n of l)if(this.compareWith(r,n))return n;return r}else return r}};var vY=20,Xf=(()=>{let r=class r{constructor(n,s,d){this._ngZone=n,this._platform=s,this._scrolled=new pe,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=d}register(n){this.scrollContainers.has(n)||this.scrollContainers.set(n,n.elementScrolled().subscribe(()=>this._scrolled.next(n)))}deregister(n){let s=this.scrollContainers.get(n);s&&(s.unsubscribe(),this.scrollContainers.delete(n))}scrolled(n=vY){return this._platform.isBrowser?new ga(s=>{this._globalSubscription||this._addGlobalListener();let d=n>0?this._scrolled.pipe(MS(n)).subscribe(s):this._scrolled.subscribe(s);return this._scrolledCount++,()=>{d.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):Fe()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((n,s)=>this.deregister(s)),this._scrolled.complete()}ancestorScrolled(n,s){let d=this.getAncestorScrollContainers(n);return this.scrolled(s).pipe(wn(m=>!m||d.indexOf(m)>-1))}getAncestorScrollContainers(n){let s=[];return this.scrollContainers.forEach((d,m)=>{this._scrollableContainsElement(m,n)&&s.push(m)}),s}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(n,s){let d=Os(s),m=n.getElementRef().nativeElement;do if(d==m)return!0;while(d=d.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>{let n=this._getWindow();return Po(n.document,"scroll").subscribe(()=>this._scrolled.next())})}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}};r.\u0275fac=function(s){return new(s||r)(ht(ze),ht(pn),ht(li,8))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var yY=20,vd=(()=>{let r=class r{constructor(n,s,d){this._platform=n,this._change=new pe,this._changeListener=m=>{this._change.next(m)},this._document=d,s.runOutsideAngular(()=>{if(n.isBrowser){let m=this._getWindow();m.addEventListener("resize",this._changeListener),m.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){let n=this._getWindow();n.removeEventListener("resize",this._changeListener),n.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();let n={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),n}getViewportRect(){let n=this.getViewportScrollPosition(),{width:s,height:d}=this.getViewportSize();return{top:n.top,left:n.left,bottom:n.top+d,right:n.left+s,height:d,width:s}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};let n=this._document,s=this._getWindow(),d=n.documentElement,m=d.getBoundingClientRect(),_=-m.top||n.body.scrollTop||s.scrollY||d.scrollTop||0,w=-m.left||n.body.scrollLeft||s.scrollX||d.scrollLeft||0;return{top:_,left:w}}change(n=yY){return n>0?this._change.pipe(MS(n)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){let n=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:n.innerWidth,height:n.innerHeight}:{width:0,height:0}}};r.\u0275fac=function(s){return new(s||r)(ht(pn),ht(ze),ht(li,8))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var _3=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275mod=xi({type:r}),r.\u0275inj=wi({});let a=r;return a})(),jE=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275mod=xi({type:r}),r.\u0275inj=wi({imports:[Yf,_3,Yf,_3]});let a=r;return a})();var Kf=class{attach(r){return this._attachedHost=r,r.attach(this)}detach(){let r=this._attachedHost;r!=null&&(this._attachedHost=null,r.detach())}get isAttached(){return this._attachedHost!=null}setAttachedHost(r){this._attachedHost=r}},is=class extends Kf{constructor(r,l,n,s,d){super(),this.component=r,this.viewContainerRef=l,this.injector=n,this.componentFactoryResolver=s,this.projectableNodes=d}},Fs=class extends Kf{constructor(r,l,n,s){super(),this.templateRef=r,this.viewContainerRef=l,this.context=n,this.injector=s}get origin(){return this.templateRef.elementRef}attach(r,l=this.context){return this.context=l,super.attach(r)}detach(){return this.context=void 0,super.detach()}},HE=class extends Kf{constructor(r){super(),this.element=r instanceof Se?r.nativeElement:r}},yd=class{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(r){if(r instanceof is)return this._attachedPortal=r,this.attachComponentPortal(r);if(r instanceof Fs)return this._attachedPortal=r,this.attachTemplatePortal(r);if(this.attachDomPortal&&r instanceof HE)return this._attachedPortal=r,this.attachDomPortal(r)}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(r){this._disposeFn=r}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}};var Qf=class extends yd{constructor(r,l,n,s,d){super(),this.outletElement=r,this._componentFactoryResolver=l,this._appRef=n,this._defaultInjector=s,this.attachDomPortal=m=>{this._document;let _=m.element;_.parentNode;let w=this._document.createComment("dom-portal");_.parentNode.insertBefore(w,_),this.outletElement.appendChild(_),this._attachedPortal=m,super.setDisposeFn(()=>{w.parentNode&&w.parentNode.replaceChild(_,w)})},this._document=d}attachComponentPortal(r){let n=(r.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(r.component),s;return r.viewContainerRef?(s=r.viewContainerRef.createComponent(n,r.viewContainerRef.length,r.injector||r.viewContainerRef.injector,r.projectableNodes||void 0),this.setDisposeFn(()=>s.destroy())):(s=n.create(r.injector||this._defaultInjector||uo.NULL),this._appRef.attachView(s.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(s.hostView),s.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(s)),this._attachedPortal=r,s}attachTemplatePortal(r){let l=r.viewContainerRef,n=l.createEmbeddedView(r.templateRef,r.context,{injector:r.injector});return n.rootNodes.forEach(s=>this.outletElement.appendChild(s)),n.detectChanges(),this.setDisposeFn(()=>{let s=l.indexOf(n);s!==-1&&l.remove(s)}),this._attachedPortal=r,n}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(r){return r.hostView.rootNodes[0]}};var ul=(()=>{let r=class r extends yd{constructor(n,s,d){super(),this._componentFactoryResolver=n,this._viewContainerRef=s,this._isInitialized=!1,this.attached=new ye,this.attachDomPortal=m=>{this._document;let _=m.element;_.parentNode;let w=this._document.createComment("dom-portal");m.setAttachedHost(this),_.parentNode.insertBefore(w,_),this._getRootNode().appendChild(_),this._attachedPortal=m,super.setDisposeFn(()=>{w.parentNode&&w.parentNode.replaceChild(_,w)})},this._document=d}get portal(){return this._attachedPortal}set portal(n){this.hasAttached()&&!n&&!this._isInitialized||(this.hasAttached()&&super.detach(),n&&super.attach(n),this._attachedPortal=n||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedRef=this._attachedPortal=null}attachComponentPortal(n){n.setAttachedHost(this);let s=n.viewContainerRef!=null?n.viewContainerRef:this._viewContainerRef,m=(n.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(n.component),_=s.createComponent(m,s.length,n.injector||s.injector,n.projectableNodes||void 0);return s!==this._viewContainerRef&&this._getRootNode().appendChild(_.hostView.rootNodes[0]),super.setDisposeFn(()=>_.destroy()),this._attachedPortal=n,this._attachedRef=_,this.attached.emit(_),_}attachTemplatePortal(n){n.setAttachedHost(this);let s=this._viewContainerRef.createEmbeddedView(n.templateRef,n.context,{injector:n.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=n,this._attachedRef=s,this.attached.emit(s),s}_getRootNode(){let n=this._viewContainerRef.element.nativeElement;return n.nodeType===n.ELEMENT_NODE?n:n.parentNode}};r.\u0275fac=function(s){return new(s||r)(B(wf),B(Mo),B(li))},r.\u0275dir=re({type:r,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:[Rt.None,"cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],standalone:!0,features:[Si]});let a=r;return a})();var gm=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275mod=xi({type:r}),r.\u0275inj=wi({});let a=r;return a})();function Zr(a,...r){return r.length?r.some(l=>a[l]):a.altKey||a.shiftKey||a.ctrlKey||a.metaKey}var v3=f3(),GE=class{constructor(r,l){this._viewportRuler=r,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=l}attach(){}enable(){if(this._canBeEnabled()){let r=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=r.style.left||"",this._previousHTMLStyles.top=r.style.top||"",r.style.left=Do(-this._previousScrollPosition.left),r.style.top=Do(-this._previousScrollPosition.top),r.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){let r=this._document.documentElement,l=this._document.body,n=r.style,s=l.style,d=n.scrollBehavior||"",m=s.scrollBehavior||"";this._isEnabled=!1,n.left=this._previousHTMLStyles.left,n.top=this._previousHTMLStyles.top,r.classList.remove("cdk-global-scrollblock"),v3&&(n.scrollBehavior=s.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),v3&&(n.scrollBehavior=d,s.scrollBehavior=m)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;let l=this._document.body,n=this._viewportRuler.getViewportSize();return l.scrollHeight>n.height||l.scrollWidth>n.width}};var qE=class{constructor(r,l,n,s){this._scrollDispatcher=r,this._ngZone=l,this._viewportRuler=n,this._config=s,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(r){this._overlayRef,this._overlayRef=r}enable(){if(this._scrollSubscription)return;let r=this._scrollDispatcher.scrolled(0).pipe(wn(l=>!l||!this._overlayRef.overlayElement.contains(l.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=r.subscribe(()=>{let l=this._viewportRuler.getViewportScrollPosition().top;Math.abs(l-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=r.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},sy=class{enable(){}disable(){}attach(){}};function WE(a,r){return r.some(l=>{let n=a.bottom<l.top,s=a.top>l.bottom,d=a.right<l.left,m=a.left>l.right;return n||s||d||m})}function y3(a,r){return r.some(l=>{let n=a.top<l.top,s=a.bottom>l.bottom,d=a.left<l.left,m=a.right>l.right;return n||s||d||m})}var $E=class{constructor(r,l,n,s){this._scrollDispatcher=r,this._viewportRuler=l,this._ngZone=n,this._config=s,this._scrollSubscription=null}attach(r){this._overlayRef,this._overlayRef=r}enable(){if(!this._scrollSubscription){let r=this._config?this._config.scrollThrottle:0;this._scrollSubscription=this._scrollDispatcher.scrolled(r).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){let l=this._overlayRef.overlayElement.getBoundingClientRect(),{width:n,height:s}=this._viewportRuler.getViewportSize();WE(l,[{width:n,height:s,bottom:s,right:n,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}})}}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},bY=(()=>{let r=class r{constructor(n,s,d,m){this._scrollDispatcher=n,this._viewportRuler=s,this._ngZone=d,this.noop=()=>new sy,this.close=_=>new qE(this._scrollDispatcher,this._ngZone,this._viewportRuler,_),this.block=()=>new GE(this._viewportRuler,this._document),this.reposition=_=>new $E(this._scrollDispatcher,this._viewportRuler,this._ngZone,_),this._document=m}};r.\u0275fac=function(s){return new(s||r)(ht(Xf),ht(vd),ht(ze),ht(li))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),ns=class{constructor(r){if(this.scrollStrategy=new sy,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,r){let l=Object.keys(r);for(let n of l)r[n]!==void 0&&(this[n]=r[n])}}};var YE=class{constructor(r,l){this.connectionPair=r,this.scrollableViewProperties=l}};var S3=(()=>{let r=class r{constructor(n){this._attachedOverlays=[],this._document=n}ngOnDestroy(){this.detach()}add(n){this.remove(n),this._attachedOverlays.push(n)}remove(n){let s=this._attachedOverlays.indexOf(n);s>-1&&this._attachedOverlays.splice(s,1),this._attachedOverlays.length===0&&this.detach()}};r.\u0275fac=function(s){return new(s||r)(ht(li))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),xY=(()=>{let r=class r extends S3{constructor(n,s){super(n),this._ngZone=s,this._keydownListener=d=>{let m=this._attachedOverlays;for(let _=m.length-1;_>-1;_--)if(m[_]._keydownEvents.observers.length>0){let w=m[_]._keydownEvents;this._ngZone?this._ngZone.run(()=>w.next(d)):w.next(d);break}}}add(n){super.add(n),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}};r.\u0275fac=function(s){return new(s||r)(ht(li),ht(ze,8))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),wY=(()=>{let r=class r extends S3{constructor(n,s,d){super(n),this._platform=s,this._ngZone=d,this._cursorStyleIsSet=!1,this._pointerDownListener=m=>{this._pointerDownEventTarget=dl(m)},this._clickListener=m=>{let _=dl(m),w=m.type==="click"&&this._pointerDownEventTarget?this._pointerDownEventTarget:_;this._pointerDownEventTarget=null;let S=this._attachedOverlays.slice();for(let T=S.length-1;T>-1;T--){let L=S[T];if(L._outsidePointerEvents.observers.length<1||!L.hasAttached())continue;if(L.overlayElement.contains(_)||L.overlayElement.contains(w))break;let H=L._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>H.next(m)):H.next(m)}}}add(n){if(super.add(n),!this._isAttached){let s=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(s)):this._addEventListeners(s),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=s.style.cursor,s.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){let n=this._document.body;n.removeEventListener("pointerdown",this._pointerDownListener,!0),n.removeEventListener("click",this._clickListener,!0),n.removeEventListener("auxclick",this._clickListener,!0),n.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(n.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(n){n.addEventListener("pointerdown",this._pointerDownListener,!0),n.addEventListener("click",this._clickListener,!0),n.addEventListener("auxclick",this._clickListener,!0),n.addEventListener("contextmenu",this._clickListener,!0)}};r.\u0275fac=function(s){return new(s||r)(ht(li),ht(pn),ht(ze,8))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),_m=(()=>{let r=class r{constructor(n,s){this._platform=s,this._document=n}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let n="cdk-overlay-container";if(this._platform.isBrowser||iy()){let d=this._document.querySelectorAll(`.${n}[platform="server"], .${n}[platform="test"]`);for(let m=0;m<d.length;m++)d[m].remove()}let s=this._document.createElement("div");s.classList.add(n),iy()?s.setAttribute("platform","test"):this._platform.isBrowser||s.setAttribute("platform","server"),this._document.body.appendChild(s),this._containerElement=s}};r.\u0275fac=function(s){return new(s||r)(ht(li),ht(pn))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),Ec=class{constructor(r,l,n,s,d,m,_,w,S,T=!1){this._portalOutlet=r,this._host=l,this._pane=n,this._config=s,this._ngZone=d,this._keyboardDispatcher=m,this._document=_,this._location=w,this._outsideClickDispatcher=S,this._animationsDisabled=T,this._backdropElement=null,this._backdropClick=new pe,this._attachments=new pe,this._detachments=new pe,this._locationChanges=nr.EMPTY,this._backdropClickHandler=L=>this._backdropClick.next(L),this._backdropTransitionendHandler=L=>{this._disposeBackdrop(L.target)},this._keydownEvents=new pe,this._outsidePointerEvents=new pe,s.scrollStrategy&&(this._scrollStrategy=s.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=s.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(r){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);let l=this._portalOutlet.attach(r);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(Ji(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),typeof l?.onDestroy=="function"&&l.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),l}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();let r=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),r}dispose(){let r=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,r&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(r){r!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=r,this.hasAttached()&&(r.attach(this),this.updatePosition()))}updateSize(r){this._config=Gt(Gt({},this._config),r),this._updateElementSize()}setDirection(r){this._config=Ri(Gt({},this._config),{direction:r}),this._updateElementDirection()}addPanelClass(r){this._pane&&this._toggleClasses(this._pane,r,!0)}removePanelClass(r){this._pane&&this._toggleClasses(this._pane,r,!1)}getDirection(){let r=this._config.direction;return r?typeof r=="string"?r:r.value:"ltr"}updateScrollStrategy(r){r!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=r,this.hasAttached()&&(r.attach(this),r.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;let r=this._pane.style;r.width=Do(this._config.width),r.height=Do(this._config.height),r.minWidth=Do(this._config.minWidth),r.minHeight=Do(this._config.minHeight),r.maxWidth=Do(this._config.maxWidth),r.maxHeight=Do(this._config.maxHeight)}_togglePointerEvents(r){this._pane.style.pointerEvents=r?"":"none"}_attachBackdrop(){let r="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(r)})}):this._backdropElement.classList.add(r)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){let r=this._backdropElement;if(r){if(this._animationsDisabled){this._disposeBackdrop(r);return}r.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{r.addEventListener("transitionend",this._backdropTransitionendHandler)}),r.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(r)},500))}}_toggleClasses(r,l,n){let s=hm(l||[]).filter(d=>!!d);s.length&&(n?r.classList.add(...s):r.classList.remove(...s))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{let r=this._ngZone.onStable.pipe(ri(io(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||this._pane.children.length===0)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),r.unsubscribe())})})}_disposeScrollStrategy(){let r=this._scrollStrategy;r&&(r.disable(),r.detach&&r.detach())}_disposeBackdrop(r){r&&(r.removeEventListener("click",this._backdropClickHandler),r.removeEventListener("transitionend",this._backdropTransitionendHandler),r.remove(),this._backdropElement===r&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}},b3="cdk-overlay-connected-position-bounding-box",CY=/([A-Za-z%]+)$/,Jf=class{get positions(){return this._preferredPositions}constructor(r,l,n,s,d){this._viewportRuler=l,this._document=n,this._platform=s,this._overlayContainer=d,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new pe,this._resizeSubscription=nr.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(r)}attach(r){this._overlayRef&&this._overlayRef,this._validatePositions(),r.hostElement.classList.add(b3),this._overlayRef=r,this._boundingBox=r.hostElement,this._pane=r.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition){this.reapplyLastPosition();return}this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let r=this._originRect,l=this._overlayRect,n=this._viewportRect,s=this._containerRect,d=[],m;for(let _ of this._preferredPositions){let w=this._getOriginPoint(r,s,_),S=this._getOverlayPoint(w,l,_),T=this._getOverlayFit(S,l,n,_);if(T.isCompletelyWithinViewport){this._isPushed=!1,this._applyPosition(_,w);return}if(this._canFitWithFlexibleDimensions(T,S,n)){d.push({position:_,origin:w,overlayRect:l,boundingBoxRect:this._calculateBoundingBoxRect(w,_)});continue}(!m||m.overlayFit.visibleArea<T.visibleArea)&&(m={overlayFit:T,overlayPoint:S,originPoint:w,position:_,overlayRect:l})}if(d.length){let _=null,w=-1;for(let S of d){let T=S.boundingBoxRect.width*S.boundingBoxRect.height*(S.position.weight||1);T>w&&(w=T,_=S)}this._isPushed=!1,this._applyPosition(_.position,_.origin);return}if(this._canPush){this._isPushed=!0,this._applyPosition(m.position,m.originPoint);return}this._applyPosition(m.position,m.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&ku(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(b3),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;let r=this._lastPosition;if(r){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let l=this._getOriginPoint(this._originRect,this._containerRect,r);this._applyPosition(r,l)}else this.apply()}withScrollableContainers(r){return this._scrollables=r,this}withPositions(r){return this._preferredPositions=r,r.indexOf(this._lastPosition)===-1&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(r){return this._viewportMargin=r,this}withFlexibleDimensions(r=!0){return this._hasFlexibleDimensions=r,this}withGrowAfterOpen(r=!0){return this._growAfterOpen=r,this}withPush(r=!0){return this._canPush=r,this}withLockedPosition(r=!0){return this._positionLocked=r,this}setOrigin(r){return this._origin=r,this}withDefaultOffsetX(r){return this._offsetX=r,this}withDefaultOffsetY(r){return this._offsetY=r,this}withTransformOriginOn(r){return this._transformOriginSelector=r,this}_getOriginPoint(r,l,n){let s;if(n.originX=="center")s=r.left+r.width/2;else{let m=this._isRtl()?r.right:r.left,_=this._isRtl()?r.left:r.right;s=n.originX=="start"?m:_}l.left<0&&(s-=l.left);let d;return n.originY=="center"?d=r.top+r.height/2:d=n.originY=="top"?r.top:r.bottom,l.top<0&&(d-=l.top),{x:s,y:d}}_getOverlayPoint(r,l,n){let s;n.overlayX=="center"?s=-l.width/2:n.overlayX==="start"?s=this._isRtl()?-l.width:0:s=this._isRtl()?0:-l.width;let d;return n.overlayY=="center"?d=-l.height/2:d=n.overlayY=="top"?0:-l.height,{x:r.x+s,y:r.y+d}}_getOverlayFit(r,l,n,s){let d=w3(l),{x:m,y:_}=r,w=this._getOffset(s,"x"),S=this._getOffset(s,"y");w&&(m+=w),S&&(_+=S);let T=0-m,L=m+d.width-n.width,H=0-_,q=_+d.height-n.height,X=this._subtractOverflows(d.width,T,L),it=this._subtractOverflows(d.height,H,q),at=X*it;return{visibleArea:at,isCompletelyWithinViewport:d.width*d.height===at,fitsInViewportVertically:it===d.height,fitsInViewportHorizontally:X==d.width}}_canFitWithFlexibleDimensions(r,l,n){if(this._hasFlexibleDimensions){let s=n.bottom-l.y,d=n.right-l.x,m=x3(this._overlayRef.getConfig().minHeight),_=x3(this._overlayRef.getConfig().minWidth),w=r.fitsInViewportVertically||m!=null&&m<=s,S=r.fitsInViewportHorizontally||_!=null&&_<=d;return w&&S}return!1}_pushOverlayOnScreen(r,l,n){if(this._previousPushAmount&&this._positionLocked)return{x:r.x+this._previousPushAmount.x,y:r.y+this._previousPushAmount.y};let s=w3(l),d=this._viewportRect,m=Math.max(r.x+s.width-d.width,0),_=Math.max(r.y+s.height-d.height,0),w=Math.max(d.top-n.top-r.y,0),S=Math.max(d.left-n.left-r.x,0),T=0,L=0;return s.width<=d.width?T=S||-m:T=r.x<this._viewportMargin?d.left-n.left-r.x:0,s.height<=d.height?L=w||-_:L=r.y<this._viewportMargin?d.top-n.top-r.y:0,this._previousPushAmount={x:T,y:L},{x:r.x+T,y:r.y+L}}_applyPosition(r,l){if(this._setTransformOrigin(r),this._setOverlayElementStyles(l,r),this._setBoundingBoxStyles(l,r),r.panelClass&&this._addPanelClasses(r.panelClass),this._lastPosition=r,this._positionChanges.observers.length){let n=this._getScrollVisibility(),s=new YE(r,n);this._positionChanges.next(s)}this._isInitialRender=!1}_setTransformOrigin(r){if(!this._transformOriginSelector)return;let l=this._boundingBox.querySelectorAll(this._transformOriginSelector),n,s=r.overlayY;r.overlayX==="center"?n="center":this._isRtl()?n=r.overlayX==="start"?"right":"left":n=r.overlayX==="start"?"left":"right";for(let d=0;d<l.length;d++)l[d].style.transformOrigin=`${n} ${s}`}_calculateBoundingBoxRect(r,l){let n=this._viewportRect,s=this._isRtl(),d,m,_;if(l.overlayY==="top")m=r.y,d=n.height-m+this._viewportMargin;else if(l.overlayY==="bottom")_=n.height-r.y+this._viewportMargin*2,d=n.height-_+this._viewportMargin;else{let q=Math.min(n.bottom-r.y+n.top,r.y),X=this._lastBoundingBoxSize.height;d=q*2,m=r.y-q,d>X&&!this._isInitialRender&&!this._growAfterOpen&&(m=r.y-X/2)}let w=l.overlayX==="start"&&!s||l.overlayX==="end"&&s,S=l.overlayX==="end"&&!s||l.overlayX==="start"&&s,T,L,H;if(S)H=n.width-r.x+this._viewportMargin,T=r.x-this._viewportMargin;else if(w)L=r.x,T=n.right-r.x;else{let q=Math.min(n.right-r.x+n.left,r.x),X=this._lastBoundingBoxSize.width;T=q*2,L=r.x-q,T>X&&!this._isInitialRender&&!this._growAfterOpen&&(L=r.x-X/2)}return{top:m,left:L,bottom:_,right:H,width:T,height:d}}_setBoundingBoxStyles(r,l){let n=this._calculateBoundingBoxRect(r,l);!this._isInitialRender&&!this._growAfterOpen&&(n.height=Math.min(n.height,this._lastBoundingBoxSize.height),n.width=Math.min(n.width,this._lastBoundingBoxSize.width));let s={};if(this._hasExactPosition())s.top=s.left="0",s.bottom=s.right=s.maxHeight=s.maxWidth="",s.width=s.height="100%";else{let d=this._overlayRef.getConfig().maxHeight,m=this._overlayRef.getConfig().maxWidth;s.height=Do(n.height),s.top=Do(n.top),s.bottom=Do(n.bottom),s.width=Do(n.width),s.left=Do(n.left),s.right=Do(n.right),l.overlayX==="center"?s.alignItems="center":s.alignItems=l.overlayX==="end"?"flex-end":"flex-start",l.overlayY==="center"?s.justifyContent="center":s.justifyContent=l.overlayY==="bottom"?"flex-end":"flex-start",d&&(s.maxHeight=Do(d)),m&&(s.maxWidth=Do(m))}this._lastBoundingBoxSize=n,ku(this._boundingBox.style,s)}_resetBoundingBoxStyles(){ku(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){ku(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(r,l){let n={},s=this._hasExactPosition(),d=this._hasFlexibleDimensions,m=this._overlayRef.getConfig();if(s){let T=this._viewportRuler.getViewportScrollPosition();ku(n,this._getExactOverlayY(l,r,T)),ku(n,this._getExactOverlayX(l,r,T))}else n.position="static";let _="",w=this._getOffset(l,"x"),S=this._getOffset(l,"y");w&&(_+=`translateX(${w}px) `),S&&(_+=`translateY(${S}px)`),n.transform=_.trim(),m.maxHeight&&(s?n.maxHeight=Do(m.maxHeight):d&&(n.maxHeight="")),m.maxWidth&&(s?n.maxWidth=Do(m.maxWidth):d&&(n.maxWidth="")),ku(this._pane.style,n)}_getExactOverlayY(r,l,n){let s={top:"",bottom:""},d=this._getOverlayPoint(l,this._overlayRect,r);if(this._isPushed&&(d=this._pushOverlayOnScreen(d,this._overlayRect,n)),r.overlayY==="bottom"){let m=this._document.documentElement.clientHeight;s.bottom=`${m-(d.y+this._overlayRect.height)}px`}else s.top=Do(d.y);return s}_getExactOverlayX(r,l,n){let s={left:"",right:""},d=this._getOverlayPoint(l,this._overlayRect,r);this._isPushed&&(d=this._pushOverlayOnScreen(d,this._overlayRect,n));let m;if(this._isRtl()?m=r.overlayX==="end"?"left":"right":m=r.overlayX==="end"?"right":"left",m==="right"){let _=this._document.documentElement.clientWidth;s.right=`${_-(d.x+this._overlayRect.width)}px`}else s.left=Do(d.x);return s}_getScrollVisibility(){let r=this._getOriginRect(),l=this._pane.getBoundingClientRect(),n=this._scrollables.map(s=>s.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:y3(r,n),isOriginOutsideView:WE(r,n),isOverlayClipped:y3(l,n),isOverlayOutsideView:WE(l,n)}}_subtractOverflows(r,...l){return l.reduce((n,s)=>n-Math.max(s,0),r)}_getNarrowedViewportRect(){let r=this._document.documentElement.clientWidth,l=this._document.documentElement.clientHeight,n=this._viewportRuler.getViewportScrollPosition();return{top:n.top+this._viewportMargin,left:n.left+this._viewportMargin,right:n.left+r-this._viewportMargin,bottom:n.top+l-this._viewportMargin,width:r-2*this._viewportMargin,height:l-2*this._viewportMargin}}_isRtl(){return this._overlayRef.getDirection()==="rtl"}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(r,l){return l==="x"?r.offsetX==null?this._offsetX:r.offsetX:r.offsetY==null?this._offsetY:r.offsetY}_validatePositions(){}_addPanelClasses(r){this._pane&&hm(r).forEach(l=>{l!==""&&this._appliedPanelClasses.indexOf(l)===-1&&(this._appliedPanelClasses.push(l),this._pane.classList.add(l))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(r=>{this._pane.classList.remove(r)}),this._appliedPanelClasses=[])}_getOriginRect(){let r=this._origin;if(r instanceof Se)return r.nativeElement.getBoundingClientRect();if(r instanceof Element)return r.getBoundingClientRect();let l=r.width||0,n=r.height||0;return{top:r.y,bottom:r.y+n,left:r.x,right:r.x+l,height:n,width:l}}};function ku(a,r){for(let l in r)r.hasOwnProperty(l)&&(a[l]=r[l]);return a}function x3(a){if(typeof a!="number"&&a!=null){let[r,l]=a.split(CY);return!l||l==="px"?parseFloat(r):null}return a||null}function w3(a){return{top:Math.floor(a.top),right:Math.floor(a.right),bottom:Math.floor(a.bottom),left:Math.floor(a.left),width:Math.floor(a.width),height:Math.floor(a.height)}}var C3="cdk-global-overlay-wrapper",ZE=class{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(r){let l=r.getConfig();this._overlayRef=r,this._width&&!l.width&&r.updateSize({width:this._width}),this._height&&!l.height&&r.updateSize({height:this._height}),r.hostElement.classList.add(C3),this._isDisposed=!1}top(r=""){return this._bottomOffset="",this._topOffset=r,this._alignItems="flex-start",this}left(r=""){return this._xOffset=r,this._xPosition="left",this}bottom(r=""){return this._topOffset="",this._bottomOffset=r,this._alignItems="flex-end",this}right(r=""){return this._xOffset=r,this._xPosition="right",this}start(r=""){return this._xOffset=r,this._xPosition="start",this}end(r=""){return this._xOffset=r,this._xPosition="end",this}width(r=""){return this._overlayRef?this._overlayRef.updateSize({width:r}):this._width=r,this}height(r=""){return this._overlayRef?this._overlayRef.updateSize({height:r}):this._height=r,this}centerHorizontally(r=""){return this.left(r),this._xPosition="center",this}centerVertically(r=""){return this.top(r),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;let r=this._overlayRef.overlayElement.style,l=this._overlayRef.hostElement.style,n=this._overlayRef.getConfig(),{width:s,height:d,maxWidth:m,maxHeight:_}=n,w=(s==="100%"||s==="100vw")&&(!m||m==="100%"||m==="100vw"),S=(d==="100%"||d==="100vh")&&(!_||_==="100%"||_==="100vh"),T=this._xPosition,L=this._xOffset,H=this._overlayRef.getConfig().direction==="rtl",q="",X="",it="";w?it="flex-start":T==="center"?(it="center",H?X=L:q=L):H?T==="left"||T==="end"?(it="flex-end",q=L):(T==="right"||T==="start")&&(it="flex-start",X=L):T==="left"||T==="start"?(it="flex-start",q=L):(T==="right"||T==="end")&&(it="flex-end",X=L),r.position=this._cssPosition,r.marginLeft=w?"0":q,r.marginTop=S?"0":this._topOffset,r.marginBottom=this._bottomOffset,r.marginRight=w?"0":X,l.justifyContent=it,l.alignItems=S?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;let r=this._overlayRef.overlayElement.style,l=this._overlayRef.hostElement,n=l.style;l.classList.remove(C3),n.justifyContent=n.alignItems=r.marginTop=r.marginBottom=r.marginLeft=r.marginRight=r.position="",this._overlayRef=null,this._isDisposed=!0}},tg=(()=>{let r=class r{constructor(n,s,d,m){this._viewportRuler=n,this._document=s,this._platform=d,this._overlayContainer=m}global(){return new ZE}flexibleConnectedTo(n){return new Jf(n,this._viewportRuler,this._document,this._platform,this._overlayContainer)}};r.\u0275fac=function(s){return new(s||r)(ht(vd),ht(li),ht(pn),ht(_m))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),SY=0,$n=(()=>{let r=class r{constructor(n,s,d,m,_,w,S,T,L,H,q,X){this.scrollStrategies=n,this._overlayContainer=s,this._componentFactoryResolver=d,this._positionBuilder=m,this._keyboardDispatcher=_,this._injector=w,this._ngZone=S,this._document=T,this._directionality=L,this._location=H,this._outsideClickDispatcher=q,this._animationsModuleType=X}create(n){let s=this._createHostElement(),d=this._createPaneElement(s),m=this._createPortalOutlet(d),_=new ns(n);return _.direction=_.direction||this._directionality.value,new Ec(m,s,d,_,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,this._animationsModuleType==="NoopAnimations")}position(){return this._positionBuilder}_createPaneElement(n){let s=this._document.createElement("div");return s.id=`cdk-overlay-${SY++}`,s.classList.add("cdk-overlay-pane"),n.appendChild(s),s}_createHostElement(){let n=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(n),n}_createPortalOutlet(n){return this._appRef||(this._appRef=this._injector.get(wu)),new Qf(n,this._componentFactoryResolver,this._appRef,this._injector,this._document)}};r.\u0275fac=function(s){return new(s||r)(ht(bY),ht(_m),ht(wf),ht(tg),ht(xY),ht(uo),ht(ze),ht(li),ht(To),ht(Bl),ht(wY),ht(So,8))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),EY=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],E3=new we("cdk-connected-overlay-scroll-strategy",{providedIn:"root",factory:()=>{let a=oe($n);return()=>a.scrollStrategies.reposition()}}),ay=(()=>{let r=class r{constructor(n){this.elementRef=n}};r.\u0275fac=function(s){return new(s||r)(B(Se))},r.\u0275dir=re({type:r,selectors:[["","cdk-overlay-origin",""],["","overlay-origin",""],["","cdkOverlayOrigin",""]],exportAs:["cdkOverlayOrigin"],standalone:!0});let a=r;return a})(),XE=(()=>{let r=class r{get offsetX(){return this._offsetX}set offsetX(n){this._offsetX=n,this._position&&this._updatePositionStrategy(this._position)}get offsetY(){return this._offsetY}set offsetY(n){this._offsetY=n,this._position&&this._updatePositionStrategy(this._position)}get disposeOnNavigation(){return this._disposeOnNavigation}set disposeOnNavigation(n){this._disposeOnNavigation=n}constructor(n,s,d,m,_){this._overlay=n,this._dir=_,this._backdropSubscription=nr.EMPTY,this._attachSubscription=nr.EMPTY,this._detachSubscription=nr.EMPTY,this._positionSubscription=nr.EMPTY,this._disposeOnNavigation=!1,this.viewportMargin=0,this.open=!1,this.disableClose=!1,this.hasBackdrop=!1,this.lockPosition=!1,this.flexibleDimensions=!1,this.growAfterOpen=!1,this.push=!1,this.backdropClick=new ye,this.positionChange=new ye,this.attach=new ye,this.detach=new ye,this.overlayKeydown=new ye,this.overlayOutsideClick=new ye,this._templatePortal=new Fs(s,d),this._scrollStrategyFactory=m,this.scrollStrategy=this._scrollStrategyFactory()}get overlayRef(){return this._overlayRef}get dir(){return this._dir?this._dir.value:"ltr"}ngOnDestroy(){this._attachSubscription.unsubscribe(),this._detachSubscription.unsubscribe(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._overlayRef&&this._overlayRef.dispose()}ngOnChanges(n){this._position&&(this._updatePositionStrategy(this._position),this._overlayRef.updateSize({width:this.width,minWidth:this.minWidth,height:this.height,minHeight:this.minHeight}),n.origin&&this.open&&this._position.apply()),n.open&&(this.open?this._attachOverlay():this._detachOverlay())}_createOverlay(){(!this.positions||!this.positions.length)&&(this.positions=EY);let n=this._overlayRef=this._overlay.create(this._buildConfig());this._attachSubscription=n.attachments().subscribe(()=>this.attach.emit()),this._detachSubscription=n.detachments().subscribe(()=>this.detach.emit()),n.keydownEvents().subscribe(s=>{this.overlayKeydown.next(s),s.keyCode===27&&!this.disableClose&&!Zr(s)&&(s.preventDefault(),this._detachOverlay())}),this._overlayRef.outsidePointerEvents().subscribe(s=>{this.overlayOutsideClick.next(s)})}_buildConfig(){let n=this._position=this.positionStrategy||this._createPositionStrategy(),s=new ns({direction:this._dir,positionStrategy:n,scrollStrategy:this.scrollStrategy,hasBackdrop:this.hasBackdrop,disposeOnNavigation:this.disposeOnNavigation});return(this.width||this.width===0)&&(s.width=this.width),(this.height||this.height===0)&&(s.height=this.height),(this.minWidth||this.minWidth===0)&&(s.minWidth=this.minWidth),(this.minHeight||this.minHeight===0)&&(s.minHeight=this.minHeight),this.backdropClass&&(s.backdropClass=this.backdropClass),this.panelClass&&(s.panelClass=this.panelClass),s}_updatePositionStrategy(n){let s=this.positions.map(d=>({originX:d.originX,originY:d.originY,overlayX:d.overlayX,overlayY:d.overlayY,offsetX:d.offsetX||this.offsetX,offsetY:d.offsetY||this.offsetY,panelClass:d.panelClass||void 0}));return n.setOrigin(this._getFlexibleConnectedPositionStrategyOrigin()).withPositions(s).withFlexibleDimensions(this.flexibleDimensions).withPush(this.push).withGrowAfterOpen(this.growAfterOpen).withViewportMargin(this.viewportMargin).withLockedPosition(this.lockPosition).withTransformOriginOn(this.transformOriginSelector)}_createPositionStrategy(){let n=this._overlay.position().flexibleConnectedTo(this._getFlexibleConnectedPositionStrategyOrigin());return this._updatePositionStrategy(n),n}_getFlexibleConnectedPositionStrategyOrigin(){return this.origin instanceof ay?this.origin.elementRef:this.origin}_attachOverlay(){this._overlayRef?this._overlayRef.getConfig().hasBackdrop=this.hasBackdrop:this._createOverlay(),this._overlayRef.hasAttached()||this._overlayRef.attach(this._templatePortal),this.hasBackdrop?this._backdropSubscription=this._overlayRef.backdropClick().subscribe(n=>{this.backdropClick.emit(n)}):this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this.positionChange.observers.length>0&&(this._positionSubscription=this._position.positionChanges.pipe(FF(()=>this.positionChange.observers.length>0)).subscribe(n=>{this.positionChange.emit(n),this.positionChange.observers.length===0&&this._positionSubscription.unsubscribe()}))}_detachOverlay(){this._overlayRef&&this._overlayRef.detach(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe()}};r.\u0275fac=function(s){return new(s||r)(B($n),B(Eo),B(Mo),B(E3),B(To,8))},r.\u0275dir=re({type:r,selectors:[["","cdk-connected-overlay",""],["","connected-overlay",""],["","cdkConnectedOverlay",""]],inputs:{origin:[Rt.None,"cdkConnectedOverlayOrigin","origin"],positions:[Rt.None,"cdkConnectedOverlayPositions","positions"],positionStrategy:[Rt.None,"cdkConnectedOverlayPositionStrategy","positionStrategy"],offsetX:[Rt.None,"cdkConnectedOverlayOffsetX","offsetX"],offsetY:[Rt.None,"cdkConnectedOverlayOffsetY","offsetY"],width:[Rt.None,"cdkConnectedOverlayWidth","width"],height:[Rt.None,"cdkConnectedOverlayHeight","height"],minWidth:[Rt.None,"cdkConnectedOverlayMinWidth","minWidth"],minHeight:[Rt.None,"cdkConnectedOverlayMinHeight","minHeight"],backdropClass:[Rt.None,"cdkConnectedOverlayBackdropClass","backdropClass"],panelClass:[Rt.None,"cdkConnectedOverlayPanelClass","panelClass"],viewportMargin:[Rt.None,"cdkConnectedOverlayViewportMargin","viewportMargin"],scrollStrategy:[Rt.None,"cdkConnectedOverlayScrollStrategy","scrollStrategy"],open:[Rt.None,"cdkConnectedOverlayOpen","open"],disableClose:[Rt.None,"cdkConnectedOverlayDisableClose","disableClose"],transformOriginSelector:[Rt.None,"cdkConnectedOverlayTransformOriginOn","transformOriginSelector"],hasBackdrop:[Rt.HasDecoratorInputTransform,"cdkConnectedOverlayHasBackdrop","hasBackdrop",Qe],lockPosition:[Rt.HasDecoratorInputTransform,"cdkConnectedOverlayLockPosition","lockPosition",Qe],flexibleDimensions:[Rt.HasDecoratorInputTransform,"cdkConnectedOverlayFlexibleDimensions","flexibleDimensions",Qe],growAfterOpen:[Rt.HasDecoratorInputTransform,"cdkConnectedOverlayGrowAfterOpen","growAfterOpen",Qe],push:[Rt.HasDecoratorInputTransform,"cdkConnectedOverlayPush","push",Qe],disposeOnNavigation:[Rt.HasDecoratorInputTransform,"cdkConnectedOverlayDisposeOnNavigation","disposeOnNavigation",Qe]},outputs:{backdropClick:"backdropClick",positionChange:"positionChange",attach:"attach",detach:"detach",overlayKeydown:"overlayKeydown",overlayOutsideClick:"overlayOutsideClick"},exportAs:["cdkConnectedOverlay"],standalone:!0,features:[Tn,qn]});let a=r;return a})();function MY(a){return()=>a.scrollStrategies.reposition()}var DY={provide:E3,deps:[$n],useFactory:MY},hl=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275mod=xi({type:r}),r.\u0275inj=wi({providers:[$n,DY],imports:[Yf,gm,jE,jE]});let a=r;return a})();var M3=new Set,Ru,TY=(()=>{let r=class r{constructor(n,s){this._platform=n,this._nonce=s,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):AY}matchMedia(n){return(this._platform.WEBKIT||this._platform.BLINK)&&IY(n,this._nonce),this._matchMedia(n)}};r.\u0275fac=function(s){return new(s||r)(ht(pn),ht(bf,8))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function IY(a,r){if(!M3.has(a))try{Ru||(Ru=document.createElement("style"),r&&(Ru.nonce=r),Ru.setAttribute("type","text/css"),document.head.appendChild(Ru)),Ru.sheet&&(Ru.sheet.insertRule(`@media ${a} {body{ }}`,0),M3.add(a))}catch(l){console.error(l)}}function AY(a){return{matches:a==="all"||a==="",media:a,addListener:()=>{},removeListener:()=>{}}}var ly=(()=>{let r=class r{constructor(n,s){this._mediaMatcher=n,this._zone=s,this._queries=new Map,this._destroySubject=new pe}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(n){return D3(hm(n)).some(d=>this._registerQuery(d).mql.matches)}observe(n){let d=D3(hm(n)).map(_=>this._registerQuery(_).observable),m=bc(d);return m=fv(m.pipe(Ji(1)),m.pipe(vv(1),_v(0))),m.pipe(Fi(_=>{let w={matches:!1,breakpoints:{}};return _.forEach(({matches:S,query:T})=>{w.matches=w.matches||S,w.breakpoints[T]=S}),w}))}_registerQuery(n){if(this._queries.has(n))return this._queries.get(n);let s=this._mediaMatcher.matchMedia(n),m={observable:new ga(_=>{let w=S=>this._zone.run(()=>_.next(S));return s.addListener(w),()=>{s.removeListener(w)}}).pipe(co(s),Fi(({matches:_})=>({query:n,matches:_})),ri(this._destroySubject)),mql:s};return this._queries.set(n,m),m}};r.\u0275fac=function(s){return new(s||r)(ht(TY),ht(ze))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function D3(a){return a.map(r=>r.split(",")).reduce((r,l)=>r.concat(l)).map(r=>r.trim())}var T3={XSmall:"(max-width: 599.98px)",Small:"(min-width: 600px) and (max-width: 959.98px)",Medium:"(min-width: 960px) and (max-width: 1279.98px)",Large:"(min-width: 1280px) and (max-width: 1919.98px)",XLarge:"(min-width: 1920px)",Handset:"(max-width: 599.98px) and (orientation: portrait), (max-width: 959.98px) and (orientation: landscape)",Tablet:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait), (min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",Web:"(min-width: 840px) and (orientation: portrait), (min-width: 1280px) and (orientation: landscape)",HandsetPortrait:"(max-width: 599.98px) and (orientation: portrait)",TabletPortrait:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait)",WebPortrait:"(min-width: 840px) and (orientation: portrait)",HandsetLandscape:"(max-width: 959.98px) and (orientation: landscape)",TabletLandscape:"(min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",WebLandscape:"(min-width: 1280px) and (orientation: landscape)"};var kY=["dropdownTemplate"],RY=["mdbDropdown",""];function PY(a,r){if(a&1){let l=Ce();A(0,"div"),ct("@fade.done",function(s){te(l);let d=vt();return ee(d.onAnimationEnd(s))}),Ti(1,2),k()}if(a&2){let l=vt();Z("@fade",l._animationState)("@.disabled",!l.animation)}}var OY=["*",[["",8,"dropdown-toggle"]],[["",8,"dropdown-menu"]]],FY=["*",".dropdown-toggle",".dropdown-menu"],eg=(()=>{class a{constructor(){}static \u0275fac=function(n){return new(n||a)};static \u0275dir=re({type:a,selectors:[["","mdbDropdownToggle",""]],exportAs:["mdbDropdownToggle"]})}return a})(),ig=(()=>{class a{elementRef;_renderer;constructor(l,n){this.elementRef=l,this._renderer=n}menuPositionClassChanged=new ye;get menuPositionClass(){return this._menuPositionClass}set menuPositionClass(l){let n=this.elementRef.nativeElement,s=n.classList.contains(l);this._menuPositionClass!==l&&!s&&(["dropdown-menu-start","dropdown-menu-sm-start","dropdown-menu-md-start","dropdown-menu-lg-start","dropdown-menu-xl-start","dropdown-menu-xxl-start","dropdown-menu-xxl-start","dropdown-menu-xxl-start","dropdown-menu-end","dropdown-menu-sm-end","dropdown-menu-md-end","dropdown-menu-lg-end","dropdown-menu-xl-end","dropdown-menu-xxl-end","dropdown-menu-xxl-end","dropdown-menu-xxl-end"].forEach(m=>{this._renderer.removeClass(n,m)}),this._renderer.addClass(n,l),this.menuPositionClassChanged.emit(this.menuPositionClass))}_menuPositionClass;static \u0275fac=function(n){return new(n||a)(B(Se),B(Oo))};static \u0275dir=re({type:a,selectors:[["","mdbDropdownMenu",""]],inputs:{menuPositionClass:"menuPositionClass"},outputs:{menuPositionClassChanged:"menuPositionClassChanged"},exportAs:["mdbDropdownMenu"]})}return a})(),cy=(()=>{class a{_overlay;_overlayPositionBuilder;_elementRef;_vcr;_breakpointObserver;_cdRef;_renderer;_template;_dropdownToggle;_dropdownMenu;animation=!0;closeOnEsc=!0;closeOnItemClick=!0;closeOnOutsideClick=!0;offset=0;get positionClass(){return this._positionClass}set positionClass(l){let n=this.host.classList.contains(l);this._positionClass!==l&&!n&&(["dropdown","dropup","dropstart","dropend"].forEach(d=>{this._renderer.removeClass(this.host,d)}),this._renderer.addClass(this.host,l)),this._updateOverlay()}_positionClass;withPush=!1;dropdownShow=new ye;dropdownShown=new ye;dropdownHide=new ye;dropdownHidden=new ye;_overlayRef;_portal;_open=!1;_isDropUp;_isDropStart;_isDropEnd;_isDropdownMenuEnd;_xPosition;_breakpoints;_destroy$=new pe;get host(){return this._elementRef.nativeElement}_breakpointSubscription;_animationState="hidden";constructor(l,n,s,d,m,_,w){this._overlay=l,this._overlayPositionBuilder=n,this._elementRef=s,this._vcr=d,this._breakpointObserver=m,this._cdRef=_,this._renderer=w,this._breakpoints={isSm:this._breakpointObserver.isMatched("(min-width: 576px)"),isMd:this._breakpointObserver.isMatched("(min-width: 768px)"),isLg:this._breakpointObserver.isMatched("(min-width: 992px)"),isXl:this._breakpointObserver.isMatched("(min-width: 1200px)"),isXxl:this._breakpointObserver.isMatched("(min-width: 1400px)")}}ngAfterContentInit(){this._bindDropdownToggleClick(),this._listenToMenuPositionClassChange()}ngOnDestroy(){this._overlayRef&&(this._overlayRef.detach(),this._overlayRef.dispose()),this._destroy$.next(),this._destroy$.complete()}_bindDropdownToggleClick(){Po(this._dropdownToggle.nativeElement,"click").pipe(ri(this._destroy$)).subscribe(()=>this.toggle())}_listenToMenuPositionClassChange(){this._dropdownMenu.menuPositionClassChanged.pipe(ri(this._destroy$)).subscribe(()=>this._updateOverlay())}_updateOverlay(){this._overlayRef?.updatePositionStrategy(this._createPositionStrategy())}_createOverlayConfig(){return new ns({hasBackdrop:!1,scrollStrategy:this._overlay.scrollStrategies.reposition(),positionStrategy:this._createPositionStrategy()})}_createOverlay(){this._overlayRef=this._overlay.create(this._createOverlayConfig())}_createPositionStrategy(){return this._overlayPositionBuilder.flexibleConnectedTo(this._dropdownToggle).withPositions(this._getPosition()).withFlexibleDimensions(!1).withPush(this.withPush)}_getPosition(){this._isDropUp=this.host.classList.contains("dropup"),this._isDropStart=this.host.classList.contains("dropstart"),this._isDropEnd=this.host.classList.contains("dropend"),this._isDropdownMenuEnd=this._dropdownMenu.elementRef.nativeElement.classList.contains("dropdown-menu-end"),this._xPosition=this._isDropdownMenuEnd?"end":"start";let l=new RegExp(/dropdown-menu-(sm|md|lg|xl|xxl)-(start|end)/,"g"),n=this._dropdownMenu.elementRef.nativeElement.className.match(l);if(n){this._subscribeBrakpoints();let S=new RegExp(/start|end/,"g"),T=new RegExp(/(sm|md|lg|xl|xxl)/,"g"),L=S.exec(n)[0],H=T.exec(n)[0];switch(!0){case(H==="xxl"&&this._breakpoints.isXxl):this._xPosition=L;break;case(H==="xl"&&this._breakpoints.isXl):this._xPosition=L;break;case(H==="lg"&&this._breakpoints.isLg):this._xPosition=L;break;case(H==="md"&&this._breakpoints.isMd):this._xPosition=L;break;case(H==="sm"&&this._breakpoints.isSm):this._xPosition=L;break;default:break}}let s,d={originX:this._xPosition,originY:"top",overlayX:this._xPosition,overlayY:"bottom",offsetY:-this.offset},m={originX:this._xPosition,originY:"bottom",overlayX:this._xPosition,overlayY:"top",offsetY:this.offset},_={originX:"start",originY:"top",overlayX:"end",overlayY:"top",offsetX:this.offset},w={originX:"end",originY:"top",overlayX:"start",overlayY:"top",offsetX:-this.offset};switch(!0){case this._isDropEnd:s=[w,_];break;case this._isDropStart:s=[_,w];break;case this._isDropUp:s=[d,m];break;default:s=[m,d];break}return s}_listenToEscKeyup(l){return Po(document,"keyup").pipe(wn(n=>n.key==="Escape"),ri(l.detachments()))}_listenToClick(l,n){return Po(document,"click").pipe(wn(s=>{let d=s.target,m=this._dropdownMenu.elementRef.nativeElement.contains(d),_=!this._dropdownToggle.nativeElement.contains(d),w=!m||d.classList&&d.classList.contains("dropdown-item");return d!==n&&_&&w}),ri(l.detachments()))}onAnimationEnd(l){l.fromState==="visible"&&l.toState==="hidden"&&(this._overlayRef.detach(),this._open=!1,this.dropdownHidden.emit(this)),l.fromState==="hidden"&&l.toState==="visible"&&this.dropdownShown.emit(this)}_subscribeBrakpoints(){let l=["(min-width: 576px)","(min-width: 768px)","(min-width: 992px)","(min-width: 1200px)","(min-width: 1400px)"];this._breakpointSubscription=this._breakpointObserver.observe(l).pipe(ri(this._destroy$)).subscribe(n=>{Object.keys(this._breakpoints).forEach((s,d)=>{let m=l[d],_=n.breakpoints[m];_!==this._breakpoints[s]&&(this._breakpoints[s]=_,this._open&&this._updateOverlay())})})}show(){this._cdRef.markForCheck(),!this._open&&(this._overlayRef||this._createOverlay(),this._portal=new Fs(this._template,this._vcr),this.dropdownShow.emit(this),this._open=!0,this._overlayRef.attach(this._portal),this._listenToEscKeyup(this._overlayRef).subscribe(l=>{l&&this.closeOnEsc&&this.hide()}),this._overlayRef.keydownEvents().pipe(ri(this._overlayRef.detachments())).subscribe(l=>{this._handleKeyboardNavigation(l)}),this._listenToClick(this._overlayRef,this._dropdownToggle.nativeElement).subscribe(l=>{let n=l.target,s=n.classList&&n.classList.contains("dropdown-item");if(this.closeOnItemClick&&s){this.hide();return}if(this.closeOnOutsideClick&&!s){this.hide();return}}),this._animationState="visible")}_handleKeyboardNavigation(l){let n=Array.from(this._dropdownMenu.elementRef.nativeElement.querySelectorAll(".dropdown-item")),s=l.key,d=this._dropdownMenu.elementRef.nativeElement.ownerDocument.activeElement;if(n.length===0)return;let m=n.indexOf(d);switch(s){case"ArrowDown":l.preventDefault(),m=Math.min(m+1,n.length-1);break;case"ArrowUp":if(l.preventDefault(),m===-1){m=n.length-1;break}m=Math.max(m-1,0);break}let _=n[m];_&&_.focus()}hide(){this._cdRef.markForCheck(),this._open&&(this.dropdownHide.emit(this),this._animationState="hidden")}toggle(){this._cdRef.markForCheck(),this._open?this.hide():this.show()}static \u0275fac=function(n){return new(n||a)(B($n),B(tg),B(Se),B(Mo),B(ly),B(Wi),B(Oo))};static \u0275cmp=Et({type:a,selectors:[["","mdbDropdown",""]],contentQueries:function(n,s,d){if(n&1&&(mn(d,eg,5,Se),mn(d,ig,5)),n&2){let m;ce(m=de())&&(s._dropdownToggle=m.first),ce(m=de())&&(s._dropdownMenu=m.first)}},viewQuery:function(n,s){if(n&1&&Ge(kY,5),n&2){let d;ce(d=de())&&(s._template=d.first)}},inputs:{animation:[Rt.HasDecoratorInputTransform,"animation","animation",Qe],closeOnEsc:[Rt.HasDecoratorInputTransform,"closeOnEsc","closeOnEsc",Qe],closeOnItemClick:[Rt.HasDecoratorInputTransform,"closeOnItemClick","closeOnItemClick",Qe],closeOnOutsideClick:[Rt.HasDecoratorInputTransform,"closeOnOutsideClick","closeOnOutsideClick",Qe],offset:[Rt.HasDecoratorInputTransform,"offset","offset",ll],positionClass:"positionClass",withPush:[Rt.HasDecoratorInputTransform,"withPush","withPush",Qe]},outputs:{dropdownShow:"dropdownShow",dropdownShown:"dropdownShown",dropdownHide:"dropdownHide",dropdownHidden:"dropdownHidden"},features:[Tn],attrs:RY,ngContentSelectors:FY,decls:4,vars:0,consts:[["dropdownTemplate",""]],template:function(n,s){n&1&&(Nn(OY),Ti(0),Ti(1,1),mt(2,PY,2,2,"ng-template",null,0,Sv))},encapsulation:2,data:{animation:[Yr("fade",[Wn("visible",Ei({opacity:1})),Wn("hidden",Ei({opacity:0})),Sn("visible => hidden",Bn("150ms linear")),Sn("hidden => visible",[Ei({opacity:0}),Bn("150ms linear")])])]},changeDetection:0})}return a})(),dy=(()=>{class a{static \u0275fac=function(n){return new(n||a)};static \u0275mod=xi({type:a});static \u0275inj=wi({imports:[Lo,hl]})}return a})();var k3=350,uy=(()=>{class a{_elementRef;_renderer;constructor(l,n){this._elementRef=l,this._renderer=n}collapseClass=!0;collapseShow=new ye;collapseShown=new ye;collapseHide=new ye;collapseHidden=new ye;set collapsed(l){l!==this._collapsed&&(l?this.hide():this.show(),this._collapsed=l)}get collapsed(){return this._collapsed}_collapsed=!0;get host(){return this._elementRef.nativeElement}_isTransitioning=!1;show(){if(this._isTransitioning||!this.collapsed)return;this.collapseShow.emit(this),this._renderer.removeClass(this.host,"collapse"),this._renderer.addClass(this.host,"collapsing"),this._renderer.setStyle(this.host,"height","0px"),this._isTransitioning=!0;let l=this.host.scrollHeight;Po(this.host,"transitionend").pipe(Ji(1)).subscribe(()=>{this._isTransitioning=!1,this.collapsed=!1,this._renderer.removeClass(this.host,"collapsing"),this._renderer.addClass(this.host,"collapse"),this._renderer.addClass(this.host,"show"),this._renderer.removeStyle(this.host,"height"),this.collapseShown.emit(this)}),this._emulateTransitionEnd(this.host,k3),this._renderer.setStyle(this.host,"height",`${l}px`)}hide(){if(this._isTransitioning||this.collapsed)return;this.collapseHide.emit(this);let l=this.host.getBoundingClientRect().height;this._renderer.setStyle(this.host,"height",`${l}px`),this._reflow(this.host),this._renderer.addClass(this.host,"collapsing"),this._renderer.removeClass(this.host,"collapse"),this._renderer.removeClass(this.host,"show"),this._isTransitioning=!0,Po(this.host,"transitionend").pipe(Ji(1)).subscribe(()=>{this._renderer.removeClass(this.host,"collapsing"),this._renderer.addClass(this.host,"collapse"),this._isTransitioning=!1,this.collapsed=!0,this.collapseHidden.emit(this)}),this._renderer.removeStyle(this.host,"height"),this._emulateTransitionEnd(this.host,k3)}toggle(){this._isTransitioning||(this.collapsed=!this.collapsed,this.collapsed?this.hide():this.show())}_reflow(l){return l.offsetHeight}_emulateTransitionEnd(l,n){let s=!1,m=n+5;Po(l,"transitionend").pipe(Ji(1)).subscribe(()=>{s=!0}),setTimeout(()=>{s||l.dispatchEvent(new Event("transitionend"))},m)}static \u0275fac=function(n){return new(n||a)(B(Se),B(Oo))};static \u0275dir=re({type:a,selectors:[["","mdbCollapse",""]],hostVars:2,hostBindings:function(n,s){n&2&&ei("collapse",s.collapseClass)},inputs:{collapsed:"collapsed"},outputs:{collapseShow:"collapseShow",collapseShown:"collapseShown",collapseHide:"collapseHide",collapseHidden:"collapseHidden"},exportAs:["mdbCollapse"]})}return a})(),Gl=(()=>{class a{static \u0275fac=function(n){return new(n||a)};static \u0275mod=xi({type:a});static \u0275inj=wi({})}return a})();var hy=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=Et({type:r,selectors:[["app-loading"]],standalone:!0,features:[At],decls:8,vars:0,consts:[[1,"d-flex","align-items-center","justify-content-center","loading-overlay"],[1,"p-3","rounded","w-25","h-25","d-flex","align-items-center","justify-content-center"],[1,"row"],[1,"col-auto"],["role","status",1,"spinner-border"],[1,"col"],[1,"ms-2","me-2","mb-1","fs-4"]],template:function(s,d){s&1&&(A(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),dt(4,"div",4),k(),A(5,"div",5)(6,"div",6),V(7,"Loading..."),k()()()()())},styles:[".loading-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#0000004d;display:flex;justify-content:center;align-items:center;z-index:9999;-webkit-backdrop-filter:blur(100px);backdrop-filter:blur(100px)}"]});let a=r;return a})();var U3=(()=>{let r=class r{constructor(n,s){this._renderer=n,this._elementRef=s,this.onChange=d=>{},this.onTouched=()=>{}}setProperty(n,s){this._renderer.setProperty(this._elementRef.nativeElement,n,s)}registerOnTouched(n){this.onTouched=n}registerOnChange(n){this.onChange=n}setDisabledState(n){this.setProperty("disabled",n)}};r.\u0275fac=function(s){return new(s||r)(B(Oo),B(Se))},r.\u0275dir=re({type:r});let a=r;return a})(),xm=(()=>{let r=class r extends U3{};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=zr(r)))(d||r)}})(),r.\u0275dir=re({type:r,features:[Si]});let a=r;return a})(),xa=new we(""),LY={provide:xa,useExisting:Vo(()=>ag),multi:!0},ag=(()=>{let r=class r extends xm{writeValue(n){this.setProperty("checked",n)}};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=zr(r)))(d||r)}})(),r.\u0275dir=re({type:r,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(s,d){s&1&&ct("change",function(_){return d.onChange(_.target.checked)})("blur",function(){return d.onTouched()})},features:[Ni([LY]),Si]});let a=r;return a})(),zY={provide:xa,useExisting:Vo(()=>en),multi:!0};function NY(){let a=tm()?tm().getUserAgent():"";return/android (\d+)/.test(a.toLowerCase())}var BY=new we(""),en=(()=>{let r=class r extends U3{constructor(n,s,d){super(n,s),this._compositionMode=d,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!NY())}writeValue(n){let s=n??"";this.setProperty("value",s)}_handleInput(n){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(n)}_compositionStart(){this._composing=!0}_compositionEnd(n){this._composing=!1,this._compositionMode&&this.onChange(n)}};r.\u0275fac=function(s){return new(s||r)(B(Oo),B(Se),B(BY,8))},r.\u0275dir=re({type:r,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(s,d){s&1&&ct("input",function(_){return d._handleInput(_.target.value)})("blur",function(){return d.onTouched()})("compositionstart",function(){return d._compositionStart()})("compositionend",function(_){return d._compositionEnd(_.target.value)})},features:[Ni([zY]),Si]});let a=r;return a})();function xd(a){return a==null||(typeof a=="string"||Array.isArray(a))&&a.length===0}function H3(a){return a!=null&&typeof a.length=="number"}var wd=new we(""),xy=new we(""),VY=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,Le=class{static min(r){return jY(r)}static max(r){return UY(r)}static required(r){return G3(r)}static requiredTrue(r){return q3(r)}static email(r){return HY(r)}static minLength(r){return GY(r)}static maxLength(r){return qY(r)}static pattern(r){return WY(r)}static nullValidator(r){return py(r)}static compose(r){return K3(r)}static composeAsync(r){return Q3(r)}};function jY(a){return r=>{if(xd(r.value)||xd(a))return null;let l=parseFloat(r.value);return!isNaN(l)&&l<a?{min:{min:a,actual:r.value}}:null}}function UY(a){return r=>{if(xd(r.value)||xd(a))return null;let l=parseFloat(r.value);return!isNaN(l)&&l>a?{max:{max:a,actual:r.value}}:null}}function G3(a){return xd(a.value)?{required:!0}:null}function q3(a){return a.value===!0?null:{required:!0}}function HY(a){return xd(a.value)||VY.test(a.value)?null:{email:!0}}function GY(a){return r=>xd(r.value)||!H3(r.value)?null:r.value.length<a?{minlength:{requiredLength:a,actualLength:r.value.length}}:null}function qY(a){return r=>H3(r.value)&&r.value.length>a?{maxlength:{requiredLength:a,actualLength:r.value.length}}:null}function WY(a){if(!a)return py;let r,l;return typeof a=="string"?(l="",a.charAt(0)!=="^"&&(l+="^"),l+=a,a.charAt(a.length-1)!=="$"&&(l+="$"),r=new RegExp(l)):(l=a.toString(),r=a),n=>{if(xd(n.value))return null;let s=n.value;return r.test(s)?null:{pattern:{requiredPattern:l,actualValue:s}}}}function py(a){return null}function W3(a){return a!=null}function $3(a){return Mv(a)?Ro(a):a}function Y3(a){let r={};return a.forEach(l=>{r=l!=null?Gt(Gt({},r),l):r}),Object.keys(r).length===0?null:r}function Z3(a,r){return r.map(l=>l(a))}function $Y(a){return!a.validate}function X3(a){return a.map(r=>$Y(r)?r:l=>r.validate(l))}function K3(a){if(!a)return null;let r=a.filter(W3);return r.length==0?null:function(l){return Y3(Z3(l,r))}}function tM(a){return a!=null?K3(X3(a)):null}function Q3(a){if(!a)return null;let r=a.filter(W3);return r.length==0?null:function(l){let n=Z3(l,r).map($3);return gv(n).pipe(Fi(Y3))}}function eM(a){return a!=null?Q3(X3(a)):null}function P3(a,r){return a===null?[r]:Array.isArray(a)?[...a,r]:[a,r]}function J3(a){return a._rawValidators}function tz(a){return a._rawAsyncValidators}function KE(a){return a?Array.isArray(a)?a:[a]:[]}function fy(a,r){return Array.isArray(a)?a.includes(r):a===r}function O3(a,r){let l=KE(r);return KE(a).forEach(s=>{fy(l,s)||l.push(s)}),l}function F3(a,r){return KE(r).filter(l=>!fy(a,l))}var gy=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(r){this._rawValidators=r||[],this._composedValidatorFn=tM(this._rawValidators)}_setAsyncValidators(r){this._rawAsyncValidators=r||[],this._composedAsyncValidatorFn=eM(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(r){this._onDestroyCallbacks.push(r)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(r=>r()),this._onDestroyCallbacks=[]}reset(r=void 0){this.control&&this.control.reset(r)}hasError(r,l){return this.control?this.control.hasError(r,l):!1}getError(r,l){return this.control?this.control.getError(r,l):null}},Mc=class extends gy{get formDirective(){return null}get path(){return null}},ms=class extends gy{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},_y=class{constructor(r){this._cd=r}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},YY={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},Hht=Ri(Gt({},YY),{"[class.ng-submitted]":"isSubmitted"}),ji=(()=>{let r=class r extends _y{constructor(n){super(n)}};r.\u0275fac=function(s){return new(s||r)(B(ms,2))},r.\u0275dir=re({type:r,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(s,d){s&2&&ei("ng-untouched",d.isUntouched)("ng-touched",d.isTouched)("ng-pristine",d.isPristine)("ng-dirty",d.isDirty)("ng-valid",d.isValid)("ng-invalid",d.isInvalid)("ng-pending",d.isPending)},features:[Si]});let a=r;return a})(),br=(()=>{let r=class r extends _y{constructor(n){super(n)}};r.\u0275fac=function(s){return new(s||r)(B(Mc,10))},r.\u0275dir=re({type:r,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(s,d){s&2&&ei("ng-untouched",d.isUntouched)("ng-touched",d.isTouched)("ng-pristine",d.isPristine)("ng-dirty",d.isDirty)("ng-valid",d.isValid)("ng-invalid",d.isInvalid)("ng-pending",d.isPending)("ng-submitted",d.isSubmitted)},features:[Si]});let a=r;return a})();var ng="VALID",my="INVALID",vm="PENDING",rg="DISABLED";function iM(a){return(wy(a)?a.validators:a)||null}function ZY(a){return Array.isArray(a)?tM(a):a||null}function nM(a,r){return(wy(r)?r.asyncValidators:a)||null}function XY(a){return Array.isArray(a)?eM(a):a||null}function wy(a){return a!=null&&!Array.isArray(a)&&typeof a=="object"}function ez(a,r,l){let n=a.controls;if(!(r?Object.keys(n):n).length)throw new dr(1e3,"");if(!n[l])throw new dr(1001,"")}function iz(a,r,l){a._forEachChild((n,s)=>{if(l[s]===void 0)throw new dr(1002,"")})}var ym=class{constructor(r,l){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(r),this._assignAsyncValidators(l)}get validator(){return this._composedValidatorFn}set validator(r){this._rawValidators=this._composedValidatorFn=r}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(r){this._rawAsyncValidators=this._composedAsyncValidatorFn=r}get parent(){return this._parent}get valid(){return this.status===ng}get invalid(){return this.status===my}get pending(){return this.status==vm}get disabled(){return this.status===rg}get enabled(){return this.status!==rg}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(r){this._assignValidators(r)}setAsyncValidators(r){this._assignAsyncValidators(r)}addValidators(r){this.setValidators(O3(r,this._rawValidators))}addAsyncValidators(r){this.setAsyncValidators(O3(r,this._rawAsyncValidators))}removeValidators(r){this.setValidators(F3(r,this._rawValidators))}removeAsyncValidators(r){this.setAsyncValidators(F3(r,this._rawAsyncValidators))}hasValidator(r){return fy(this._rawValidators,r)}hasAsyncValidator(r){return fy(this._rawAsyncValidators,r)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(r={}){this.touched=!0,this._parent&&!r.onlySelf&&this._parent.markAsTouched(r)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(r=>r.markAllAsTouched())}markAsUntouched(r={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(l=>{l.markAsUntouched({onlySelf:!0})}),this._parent&&!r.onlySelf&&this._parent._updateTouched(r)}markAsDirty(r={}){this.pristine=!1,this._parent&&!r.onlySelf&&this._parent.markAsDirty(r)}markAsPristine(r={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(l=>{l.markAsPristine({onlySelf:!0})}),this._parent&&!r.onlySelf&&this._parent._updatePristine(r)}markAsPending(r={}){this.status=vm,r.emitEvent!==!1&&this.statusChanges.emit(this.status),this._parent&&!r.onlySelf&&this._parent.markAsPending(r)}disable(r={}){let l=this._parentMarkedDirty(r.onlySelf);this.status=rg,this.errors=null,this._forEachChild(n=>{n.disable(Ri(Gt({},r),{onlySelf:!0}))}),this._updateValue(),r.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Ri(Gt({},r),{skipPristineCheck:l})),this._onDisabledChange.forEach(n=>n(!0))}enable(r={}){let l=this._parentMarkedDirty(r.onlySelf);this.status=ng,this._forEachChild(n=>{n.enable(Ri(Gt({},r),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:r.emitEvent}),this._updateAncestors(Ri(Gt({},r),{skipPristineCheck:l})),this._onDisabledChange.forEach(n=>n(!1))}_updateAncestors(r){this._parent&&!r.onlySelf&&(this._parent.updateValueAndValidity(r),r.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(r){this._parent=r}getRawValue(){return this.value}updateValueAndValidity(r={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===ng||this.status===vm)&&this._runAsyncValidator(r.emitEvent)),r.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!r.onlySelf&&this._parent.updateValueAndValidity(r)}_updateTreeValidity(r={emitEvent:!0}){this._forEachChild(l=>l._updateTreeValidity(r)),this.updateValueAndValidity({onlySelf:!0,emitEvent:r.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?rg:ng}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(r){if(this.asyncValidator){this.status=vm,this._hasOwnPendingAsyncValidator=!0;let l=$3(this.asyncValidator(this));this._asyncValidationSubscription=l.subscribe(n=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(n,{emitEvent:r})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(r,l={}){this.errors=r,this._updateControlsErrors(l.emitEvent!==!1)}get(r){let l=r;return l==null||(Array.isArray(l)||(l=l.split(".")),l.length===0)?null:l.reduce((n,s)=>n&&n._find(s),this)}getError(r,l){let n=l?this.get(l):this;return n&&n.errors?n.errors[r]:null}hasError(r,l){return!!this.getError(r,l)}get root(){let r=this;for(;r._parent;)r=r._parent;return r}_updateControlsErrors(r){this.status=this._calculateStatus(),r&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(r)}_initObservables(){this.valueChanges=new ye,this.statusChanges=new ye}_calculateStatus(){return this._allControlsDisabled()?rg:this.errors?my:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(vm)?vm:this._anyControlsHaveStatus(my)?my:ng}_anyControlsHaveStatus(r){return this._anyControls(l=>l.status===r)}_anyControlsDirty(){return this._anyControls(r=>r.dirty)}_anyControlsTouched(){return this._anyControls(r=>r.touched)}_updatePristine(r={}){this.pristine=!this._anyControlsDirty(),this._parent&&!r.onlySelf&&this._parent._updatePristine(r)}_updateTouched(r={}){this.touched=this._anyControlsTouched(),this._parent&&!r.onlySelf&&this._parent._updateTouched(r)}_registerOnCollectionChange(r){this._onCollectionChange=r}_setUpdateStrategy(r){wy(r)&&r.updateOn!=null&&(this._updateOn=r.updateOn)}_parentMarkedDirty(r){let l=this._parent&&this._parent.dirty;return!r&&!!l&&!this._parent._anyControlsDirty()}_find(r){return null}_assignValidators(r){this._rawValidators=Array.isArray(r)?r.slice():r,this._composedValidatorFn=ZY(this._rawValidators)}_assignAsyncValidators(r){this._rawAsyncValidators=Array.isArray(r)?r.slice():r,this._composedAsyncValidatorFn=XY(this._rawAsyncValidators)}},bm=class extends ym{constructor(r,l,n){super(iM(l),nM(n,l)),this.controls=r,this._initObservables(),this._setUpdateStrategy(l),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(r,l){return this.controls[r]?this.controls[r]:(this.controls[r]=l,l.setParent(this),l._registerOnCollectionChange(this._onCollectionChange),l)}addControl(r,l,n={}){this.registerControl(r,l),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}removeControl(r,l={}){this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),delete this.controls[r],this.updateValueAndValidity({emitEvent:l.emitEvent}),this._onCollectionChange()}setControl(r,l,n={}){this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),delete this.controls[r],l&&this.registerControl(r,l),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}contains(r){return this.controls.hasOwnProperty(r)&&this.controls[r].enabled}setValue(r,l={}){iz(this,!0,r),Object.keys(r).forEach(n=>{ez(this,!0,n),this.controls[n].setValue(r[n],{onlySelf:!0,emitEvent:l.emitEvent})}),this.updateValueAndValidity(l)}patchValue(r,l={}){r!=null&&(Object.keys(r).forEach(n=>{let s=this.controls[n];s&&s.patchValue(r[n],{onlySelf:!0,emitEvent:l.emitEvent})}),this.updateValueAndValidity(l))}reset(r={},l={}){this._forEachChild((n,s)=>{n.reset(r?r[s]:null,{onlySelf:!0,emitEvent:l.emitEvent})}),this._updatePristine(l),this._updateTouched(l),this.updateValueAndValidity(l)}getRawValue(){return this._reduceChildren({},(r,l,n)=>(r[n]=l.getRawValue(),r))}_syncPendingControls(){let r=this._reduceChildren(!1,(l,n)=>n._syncPendingControls()?!0:l);return r&&this.updateValueAndValidity({onlySelf:!0}),r}_forEachChild(r){Object.keys(this.controls).forEach(l=>{let n=this.controls[l];n&&r(n,l)})}_setUpControls(){this._forEachChild(r=>{r.setParent(this),r._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(r){for(let[l,n]of Object.entries(this.controls))if(this.contains(l)&&r(n))return!0;return!1}_reduceValue(){let r={};return this._reduceChildren(r,(l,n,s)=>((n.enabled||this.disabled)&&(l[s]=n.value),l))}_reduceChildren(r,l){let n=r;return this._forEachChild((s,d)=>{n=l(n,s,d)}),n}_allControlsDisabled(){for(let r of Object.keys(this.controls))if(this.controls[r].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(r){return this.controls.hasOwnProperty(r)?this.controls[r]:null}};var QE=class extends bm{};var wm=new we("CallSetDisabledState",{providedIn:"root",factory:()=>lg}),lg="always";function nz(a,r){return[...r.path,a]}function vy(a,r,l=lg){rM(a,r),r.valueAccessor.writeValue(a.value),(a.disabled||l==="always")&&r.valueAccessor.setDisabledState?.(a.disabled),QY(a,r),tZ(a,r),JY(a,r),KY(a,r)}function L3(a,r,l=!0){let n=()=>{};r.valueAccessor&&(r.valueAccessor.registerOnChange(n),r.valueAccessor.registerOnTouched(n)),by(a,r),a&&(r._invokeOnDestroyCallbacks(),a._registerOnCollectionChange(()=>{}))}function yy(a,r){a.forEach(l=>{l.registerOnValidatorChange&&l.registerOnValidatorChange(r)})}function KY(a,r){if(r.valueAccessor.setDisabledState){let l=n=>{r.valueAccessor.setDisabledState(n)};a.registerOnDisabledChange(l),r._registerOnDestroy(()=>{a._unregisterOnDisabledChange(l)})}}function rM(a,r){let l=J3(a);r.validator!==null?a.setValidators(P3(l,r.validator)):typeof l=="function"&&a.setValidators([l]);let n=tz(a);r.asyncValidator!==null?a.setAsyncValidators(P3(n,r.asyncValidator)):typeof n=="function"&&a.setAsyncValidators([n]);let s=()=>a.updateValueAndValidity();yy(r._rawValidators,s),yy(r._rawAsyncValidators,s)}function by(a,r){let l=!1;if(a!==null){if(r.validator!==null){let s=J3(a);if(Array.isArray(s)&&s.length>0){let d=s.filter(m=>m!==r.validator);d.length!==s.length&&(l=!0,a.setValidators(d))}}if(r.asyncValidator!==null){let s=tz(a);if(Array.isArray(s)&&s.length>0){let d=s.filter(m=>m!==r.asyncValidator);d.length!==s.length&&(l=!0,a.setAsyncValidators(d))}}}let n=()=>{};return yy(r._rawValidators,n),yy(r._rawAsyncValidators,n),l}function QY(a,r){r.valueAccessor.registerOnChange(l=>{a._pendingValue=l,a._pendingChange=!0,a._pendingDirty=!0,a.updateOn==="change"&&rz(a,r)})}function JY(a,r){r.valueAccessor.registerOnTouched(()=>{a._pendingTouched=!0,a.updateOn==="blur"&&a._pendingChange&&rz(a,r),a.updateOn!=="submit"&&a.markAsTouched()})}function rz(a,r){a._pendingDirty&&a.markAsDirty(),a.setValue(a._pendingValue,{emitModelToViewChange:!1}),r.viewToModelUpdate(a._pendingValue),a._pendingChange=!1}function tZ(a,r){let l=(n,s)=>{r.valueAccessor.writeValue(n),s&&r.viewToModelUpdate(n)};a.registerOnChange(l),r._registerOnDestroy(()=>{a._unregisterOnChange(l)})}function oz(a,r){a==null,rM(a,r)}function eZ(a,r){return by(a,r)}function sz(a,r){if(!a.hasOwnProperty("model"))return!1;let l=a.model;return l.isFirstChange()?!0:!Object.is(r,l.currentValue)}function iZ(a){return Object.getPrototypeOf(a.constructor)===xm}function az(a,r){a._syncPendingControls(),r.forEach(l=>{let n=l.control;n.updateOn==="submit"&&n._pendingChange&&(l.viewToModelUpdate(n._pendingValue),n._pendingChange=!1)})}function lz(a,r){if(!r)return null;Array.isArray(r);let l,n,s;return r.forEach(d=>{d.constructor===en?l=d:iZ(d)?n=d:s=d}),s||n||l||null}function nZ(a,r){let l=a.indexOf(r);l>-1&&a.splice(l,1)}var rZ={provide:Mc,useExisting:Vo(()=>cg)},og=Promise.resolve(),cg=(()=>{let r=class r extends Mc{constructor(n,s,d){super(),this.callSetDisabledState=d,this.submitted=!1,this._directives=new Set,this.ngSubmit=new ye,this.form=new bm({},tM(n),eM(s))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(n){og.then(()=>{let s=this._findContainer(n.path);n.control=s.registerControl(n.name,n.control),vy(n.control,n,this.callSetDisabledState),n.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(n)})}getControl(n){return this.form.get(n.path)}removeControl(n){og.then(()=>{let s=this._findContainer(n.path);s&&s.removeControl(n.name),this._directives.delete(n)})}addFormGroup(n){og.then(()=>{let s=this._findContainer(n.path),d=new bm({});oz(d,n),s.registerControl(n.name,d),d.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(n){og.then(()=>{let s=this._findContainer(n.path);s&&s.removeControl(n.name)})}getFormGroup(n){return this.form.get(n.path)}updateModel(n,s){og.then(()=>{this.form.get(n.path).setValue(s)})}setValue(n){this.control.setValue(n)}onSubmit(n){return this.submitted=!0,az(this.form,this._directives),this.ngSubmit.emit(n),n?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(n=void 0){this.form.reset(n),this.submitted=!1}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(n){return n.pop(),n.length?this.form.get(n):this.form}};r.\u0275fac=function(s){return new(s||r)(B(wd,10),B(xy,10),B(wm,8))},r.\u0275dir=re({type:r,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(s,d){s&1&&ct("submit",function(_){return d.onSubmit(_)})("reset",function(){return d.onReset()})},inputs:{options:[Rt.None,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Ni([rZ]),Si]});let a=r;return a})();function z3(a,r){let l=a.indexOf(r);l>-1&&a.splice(l,1)}function N3(a){return typeof a=="object"&&a!==null&&Object.keys(a).length===2&&"value"in a&&"disabled"in a}var sg=class extends ym{constructor(r=null,l,n){super(iM(l),nM(n,l)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(r),this._setUpdateStrategy(l),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),wy(l)&&(l.nonNullable||l.initialValueIsDefault)&&(N3(r)?this.defaultValue=r.value:this.defaultValue=r)}setValue(r,l={}){this.value=this._pendingValue=r,this._onChange.length&&l.emitModelToViewChange!==!1&&this._onChange.forEach(n=>n(this.value,l.emitViewToModelChange!==!1)),this.updateValueAndValidity(l)}patchValue(r,l={}){this.setValue(r,l)}reset(r=this.defaultValue,l={}){this._applyFormState(r),this.markAsPristine(l),this.markAsUntouched(l),this.setValue(this.value,l),this._pendingChange=!1}_updateValue(){}_anyControls(r){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(r){this._onChange.push(r)}_unregisterOnChange(r){z3(this._onChange,r)}registerOnDisabledChange(r){this._onDisabledChange.push(r)}_unregisterOnDisabledChange(r){z3(this._onDisabledChange,r)}_forEachChild(r){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(r){N3(r)?(this.value=this._pendingValue=r.value,r.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=r}};var oZ=a=>a instanceof sg;var sZ={provide:ms,useExisting:Vo(()=>jo)},B3=Promise.resolve(),jo=(()=>{let r=class r extends ms{constructor(n,s,d,m,_,w){super(),this._changeDetectorRef=_,this.callSetDisabledState=w,this.control=new sg,this._registered=!1,this.name="",this.update=new ye,this._parent=n,this._setValidators(s),this._setAsyncValidators(d),this.valueAccessor=lz(this,m)}ngOnChanges(n){if(this._checkForErrors(),!this._registered||"name"in n){if(this._registered&&(this._checkName(),this.formDirective)){let s=n.name.previousValue;this.formDirective.removeControl({name:s,path:this._getPath(s)})}this._setUpControl()}"isDisabled"in n&&this._updateDisabled(n),sz(n,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(n){this.viewModel=n,this.update.emit(n)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){vy(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(n){B3.then(()=>{this.control.setValue(n,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(n){let s=n.isDisabled.currentValue,d=s!==0&&Qe(s);B3.then(()=>{d&&!this.control.disabled?this.control.disable():!d&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(n){return this._parent?nz(n,this._parent):[n]}};r.\u0275fac=function(s){return new(s||r)(B(Mc,9),B(wd,10),B(xy,10),B(xa,10),B(Wi,8),B(wm,8))},r.\u0275dir=re({type:r,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[Rt.None,"disabled","isDisabled"],model:[Rt.None,"ngModel","model"],options:[Rt.None,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Ni([sZ]),Si,qn]});let a=r;return a})(),xr=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275dir=re({type:r,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]});let a=r;return a})(),aZ={provide:xa,useExisting:Vo(()=>oM),multi:!0},oM=(()=>{let r=class r extends xm{writeValue(n){let s=n??"";this.setProperty("value",s)}registerOnChange(n){this.onChange=s=>{n(s==""?null:parseFloat(s))}}};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=zr(r)))(d||r)}})(),r.\u0275dir=re({type:r,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(s,d){s&1&&ct("input",function(_){return d.onChange(_.target.value)})("blur",function(){return d.onTouched()})},features:[Ni([aZ]),Si]});let a=r;return a})(),lZ={provide:xa,useExisting:Vo(()=>Dc),multi:!0};var cZ=(()=>{let r=class r{constructor(){this._accessors=[]}add(n,s){this._accessors.push([n,s])}remove(n){for(let s=this._accessors.length-1;s>=0;--s)if(this._accessors[s][1]===n){this._accessors.splice(s,1);return}}select(n){this._accessors.forEach(s=>{this._isSameGroup(s,n)&&s[1]!==n&&s[1].fireUncheck(n.value)})}_isSameGroup(n,s){return n[0].control?n[0]._parent===s._control._parent&&n[1].name===s.name:!1}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),Dc=(()=>{let r=class r extends xm{constructor(n,s,d,m){super(n,s),this._registry=d,this._injector=m,this.setDisabledStateFired=!1,this.onChange=()=>{},this.callSetDisabledState=oe(wm,{optional:!0})??lg}ngOnInit(){this._control=this._injector.get(ms),this._checkName(),this._registry.add(this._control,this)}ngOnDestroy(){this._registry.remove(this)}writeValue(n){this._state=n===this.value,this.setProperty("checked",this._state)}registerOnChange(n){this._fn=n,this.onChange=()=>{n(this.value),this._registry.select(this)}}setDisabledState(n){(this.setDisabledStateFired||n||this.callSetDisabledState==="whenDisabledForLegacyCode")&&this.setProperty("disabled",n),this.setDisabledStateFired=!0}fireUncheck(n){this.writeValue(n)}_checkName(){this.name&&this.formControlName&&(this.name,this.formControlName),!this.name&&this.formControlName&&(this.name=this.formControlName)}};r.\u0275fac=function(s){return new(s||r)(B(Oo),B(Se),B(cZ),B(uo))},r.\u0275dir=re({type:r,selectors:[["input","type","radio","formControlName",""],["input","type","radio","formControl",""],["input","type","radio","ngModel",""]],hostBindings:function(s,d){s&1&&ct("change",function(){return d.onChange()})("blur",function(){return d.onTouched()})},inputs:{name:"name",formControlName:"formControlName",value:"value"},features:[Ni([lZ]),Si]});let a=r;return a})();var cz=new we("");var dZ={provide:Mc,useExisting:Vo(()=>Vn)},Vn=(()=>{let r=class r extends Mc{constructor(n,s,d){super(),this.callSetDisabledState=d,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new ye,this._setValidators(n),this._setAsyncValidators(s)}ngOnChanges(n){this._checkFormPresent(),n.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(by(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(n){let s=this.form.get(n.path);return vy(s,n,this.callSetDisabledState),s.updateValueAndValidity({emitEvent:!1}),this.directives.push(n),s}getControl(n){return this.form.get(n.path)}removeControl(n){L3(n.control||null,n,!1),nZ(this.directives,n)}addFormGroup(n){this._setUpFormContainer(n)}removeFormGroup(n){this._cleanUpFormContainer(n)}getFormGroup(n){return this.form.get(n.path)}addFormArray(n){this._setUpFormContainer(n)}removeFormArray(n){this._cleanUpFormContainer(n)}getFormArray(n){return this.form.get(n.path)}updateModel(n,s){this.form.get(n.path).setValue(s)}onSubmit(n){return this.submitted=!0,az(this.form,this.directives),this.ngSubmit.emit(n),n?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(n=void 0){this.form.reset(n),this.submitted=!1}_updateDomValue(){this.directives.forEach(n=>{let s=n.control,d=this.form.get(n.path);s!==d&&(L3(s||null,n),oZ(d)&&(vy(d,n,this.callSetDisabledState),n.control=d))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(n){let s=this.form.get(n.path);oz(s,n),s.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(n){if(this.form){let s=this.form.get(n.path);s&&eZ(s,n)&&s.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){rM(this.form,this),this._oldForm&&by(this._oldForm,this)}_checkFormPresent(){this.form}};r.\u0275fac=function(s){return new(s||r)(B(wd,10),B(xy,10),B(wm,8))},r.\u0275dir=re({type:r,selectors:[["","formGroup",""]],hostBindings:function(s,d){s&1&&ct("submit",function(_){return d.onSubmit(_)})("reset",function(){return d.onReset()})},inputs:{form:[Rt.None,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Ni([dZ]),Si,qn]});let a=r;return a})();var uZ={provide:ms,useExisting:Vo(()=>ur)},ur=(()=>{let r=class r extends ms{set isDisabled(n){}constructor(n,s,d,m,_){super(),this._ngModelWarningConfig=_,this._added=!1,this.name=null,this.update=new ye,this._ngModelWarningSent=!1,this._parent=n,this._setValidators(s),this._setAsyncValidators(d),this.valueAccessor=lz(this,m)}ngOnChanges(n){this._added||this._setUpControl(),sz(n,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(n){this.viewModel=n,this.update.emit(n)}get path(){return nz(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}};r._ngModelWarningSentOnce=!1,r.\u0275fac=function(s){return new(s||r)(B(Mc,13),B(wd,10),B(xy,10),B(xa,10),B(cz,8))},r.\u0275dir=re({type:r,selectors:[["","formControlName",""]],inputs:{name:[Rt.None,"formControlName","name"],isDisabled:[Rt.None,"disabled","isDisabled"],model:[Rt.None,"ngModel","model"]},outputs:{update:"ngModelChange"},features:[Ni([uZ]),Si,qn]});let a=r;return a})(),hZ={provide:xa,useExisting:Vo(()=>wa),multi:!0};function dz(a,r){return a==null?`${r}`:(r&&typeof r=="object"&&(r="Object"),`${a}: ${r}`.slice(0,50))}function mZ(a){return a.split(":")[0]}var wa=(()=>{let r=class r extends xm{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(n){this._compareWith=n}writeValue(n){this.value=n;let s=this._getOptionId(n),d=dz(s,n);this.setProperty("value",d)}registerOnChange(n){this.onChange=s=>{this.value=this._getOptionValue(s),n(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(n){for(let s of this._optionMap.keys())if(this._compareWith(this._optionMap.get(s),n))return s;return null}_getOptionValue(n){let s=mZ(n);return this._optionMap.has(s)?this._optionMap.get(s):n}};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=zr(r)))(d||r)}})(),r.\u0275dir=re({type:r,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(s,d){s&1&&ct("change",function(_){return d.onChange(_.target.value)})("blur",function(){return d.onTouched()})},inputs:{compareWith:"compareWith"},features:[Ni([hZ]),Si]});let a=r;return a})(),Ca=(()=>{let r=class r{constructor(n,s,d){this._element=n,this._renderer=s,this._select=d,this._select&&(this.id=this._select._registerOption())}set ngValue(n){this._select!=null&&(this._select._optionMap.set(this.id,n),this._setElementValue(dz(this.id,n)),this._select.writeValue(this._select.value))}set value(n){this._setElementValue(n),this._select&&this._select.writeValue(this._select.value)}_setElementValue(n){this._renderer.setProperty(this._element.nativeElement,"value",n)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}};r.\u0275fac=function(s){return new(s||r)(B(Se),B(Oo),B(wa,9))},r.\u0275dir=re({type:r,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}});let a=r;return a})(),pZ={provide:xa,useExisting:Vo(()=>uz),multi:!0};function V3(a,r){return a==null?`${r}`:(typeof r=="string"&&(r=`'${r}'`),r&&typeof r=="object"&&(r="Object"),`${a}: ${r}`.slice(0,50))}function fZ(a){return a.split(":")[0]}var uz=(()=>{let r=class r extends xm{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(n){this._compareWith=n}writeValue(n){this.value=n;let s;if(Array.isArray(n)){let d=n.map(m=>this._getOptionId(m));s=(m,_)=>{m._setSelected(d.indexOf(_.toString())>-1)}}else s=(d,m)=>{d._setSelected(!1)};this._optionMap.forEach(s)}registerOnChange(n){this.onChange=s=>{let d=[],m=s.selectedOptions;if(m!==void 0){let _=m;for(let w=0;w<_.length;w++){let S=_[w],T=this._getOptionValue(S.value);d.push(T)}}else{let _=s.options;for(let w=0;w<_.length;w++){let S=_[w];if(S.selected){let T=this._getOptionValue(S.value);d.push(T)}}}this.value=d,n(d)}}_registerOption(n){let s=(this._idCounter++).toString();return this._optionMap.set(s,n),s}_getOptionId(n){for(let s of this._optionMap.keys())if(this._compareWith(this._optionMap.get(s)._value,n))return s;return null}_getOptionValue(n){let s=fZ(n);return this._optionMap.has(s)?this._optionMap.get(s)._value:n}};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=zr(r)))(d||r)}})(),r.\u0275dir=re({type:r,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(s,d){s&1&&ct("change",function(_){return d.onChange(_.target)})("blur",function(){return d.onTouched()})},inputs:{compareWith:"compareWith"},features:[Ni([pZ]),Si]});let a=r;return a})(),Sa=(()=>{let r=class r{constructor(n,s,d){this._element=n,this._renderer=s,this._select=d,this._select&&(this.id=this._select._registerOption(this))}set ngValue(n){this._select!=null&&(this._value=n,this._setElementValue(V3(this.id,n)),this._select.writeValue(this._select.value))}set value(n){this._select?(this._value=n,this._setElementValue(V3(this.id,n)),this._select.writeValue(this._select.value)):this._setElementValue(n)}_setElementValue(n){this._renderer.setProperty(this._element.nativeElement,"value",n)}_setSelected(n){this._renderer.setProperty(this._element.nativeElement,"selected",n)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}};r.\u0275fac=function(s){return new(s||r)(B(Se),B(Oo),B(uz,9))},r.\u0275dir=re({type:r,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}});let a=r;return a})();var gZ=(()=>{let r=class r{constructor(){this._validator=py}ngOnChanges(n){if(this.inputName in n){let s=this.normalizeInput(n[this.inputName].currentValue);this._enabled=this.enabled(s),this._validator=this._enabled?this.createValidator(s):py,this._onChange&&this._onChange()}}validate(n){return this._validator(n)}registerOnValidatorChange(n){this._onChange=n}enabled(n){return n!=null}};r.\u0275fac=function(s){return new(s||r)},r.\u0275dir=re({type:r,features:[qn]});let a=r;return a})();var _Z={provide:wd,useExisting:Vo(()=>Xr),multi:!0},vZ={provide:wd,useExisting:Vo(()=>sM),multi:!0},Xr=(()=>{let r=class r extends gZ{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=Qe,this.createValidator=n=>G3}enabled(n){return n}};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=zr(r)))(d||r)}})(),r.\u0275dir=re({type:r,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(s,d){s&2&&oi("required",d._enabled?"":null)},inputs:{required:"required"},features:[Ni([_Z]),Si]});let a=r;return a})(),sM=(()=>{let r=class r extends Xr{constructor(){super(...arguments),this.createValidator=n=>q3}};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=zr(r)))(d||r)}})(),r.\u0275dir=re({type:r,selectors:[["input","type","checkbox","required","","formControlName",""],["input","type","checkbox","required","","formControl",""],["input","type","checkbox","required","","ngModel",""]],hostVars:1,hostBindings:function(s,d){s&2&&oi("required",d._enabled?"":null)},features:[Ni([vZ]),Si]});let a=r;return a})();var hz=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275mod=xi({type:r}),r.\u0275inj=wi({});let a=r;return a})(),JE=class extends ym{constructor(r,l,n){super(iM(l),nM(n,l)),this.controls=r,this._initObservables(),this._setUpdateStrategy(l),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(r){return this.controls[this._adjustIndex(r)]}push(r,l={}){this.controls.push(r),this._registerControl(r),this.updateValueAndValidity({emitEvent:l.emitEvent}),this._onCollectionChange()}insert(r,l,n={}){this.controls.splice(r,0,l),this._registerControl(l),this.updateValueAndValidity({emitEvent:n.emitEvent})}removeAt(r,l={}){let n=this._adjustIndex(r);n<0&&(n=0),this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),this.controls.splice(n,1),this.updateValueAndValidity({emitEvent:l.emitEvent})}setControl(r,l,n={}){let s=this._adjustIndex(r);s<0&&(s=0),this.controls[s]&&this.controls[s]._registerOnCollectionChange(()=>{}),this.controls.splice(s,1),l&&(this.controls.splice(s,0,l),this._registerControl(l)),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(r,l={}){iz(this,!1,r),r.forEach((n,s)=>{ez(this,!1,s),this.at(s).setValue(n,{onlySelf:!0,emitEvent:l.emitEvent})}),this.updateValueAndValidity(l)}patchValue(r,l={}){r!=null&&(r.forEach((n,s)=>{this.at(s)&&this.at(s).patchValue(n,{onlySelf:!0,emitEvent:l.emitEvent})}),this.updateValueAndValidity(l))}reset(r=[],l={}){this._forEachChild((n,s)=>{n.reset(r[s],{onlySelf:!0,emitEvent:l.emitEvent})}),this._updatePristine(l),this._updateTouched(l),this.updateValueAndValidity(l)}getRawValue(){return this.controls.map(r=>r.getRawValue())}clear(r={}){this.controls.length<1||(this._forEachChild(l=>l._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:r.emitEvent}))}_adjustIndex(r){return r<0?r+this.length:r}_syncPendingControls(){let r=this.controls.reduce((l,n)=>n._syncPendingControls()?!0:l,!1);return r&&this.updateValueAndValidity({onlySelf:!0}),r}_forEachChild(r){this.controls.forEach((l,n)=>{r(l,n)})}_updateValue(){this.value=this.controls.filter(r=>r.enabled||this.disabled).map(r=>r.value)}_anyControls(r){return this.controls.some(l=>l.enabled&&r(l))}_setUpControls(){this._forEachChild(r=>this._registerControl(r))}_allControlsDisabled(){for(let r of this.controls)if(r.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(r){r.setParent(this),r._registerOnCollectionChange(this._onCollectionChange)}_find(r){return this.at(r)??null}};function j3(a){return!!a&&(a.asyncValidators!==void 0||a.validators!==void 0||a.updateOn!==void 0)}var wr=(()=>{let r=class r{constructor(){this.useNonNullable=!1}get nonNullable(){let n=new r;return n.useNonNullable=!0,n}group(n,s=null){let d=this._reduceControls(n),m={};return j3(s)?m=s:s!==null&&(m.validators=s.validator,m.asyncValidators=s.asyncValidator),new bm(d,m)}record(n,s=null){let d=this._reduceControls(n);return new QE(d,s)}control(n,s,d){let m={};return this.useNonNullable?(j3(s)?m=s:(m.validators=s,m.asyncValidators=d),new sg(n,Ri(Gt({},m),{nonNullable:!0}))):new sg(n,s,d)}array(n,s,d){let m=n.map(_=>this._createControl(_));return new JE(m,s,d)}_reduceControls(n){let s={};return Object.keys(n).forEach(d=>{s[d]=this._createControl(n[d])}),s}_createControl(n){if(n instanceof sg)return n;if(n instanceof ym)return n;if(Array.isArray(n)){let s=n[0],d=n.length>1?n[1]:null,m=n.length>2?n[2]:null;return this.control(s,d,m)}else return this.control(n)}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var Yi=(()=>{let r=class r{static withConfig(n){return{ngModule:r,providers:[{provide:wm,useValue:n.callSetDisabledState??lg}]}}};r.\u0275fac=function(s){return new(s||r)},r.\u0275mod=xi({type:r}),r.\u0275inj=wi({imports:[hz]});let a=r;return a})(),Rn=(()=>{let r=class r{static withConfig(n){return{ngModule:r,providers:[{provide:cz,useValue:n.warnOnNgModelWithFormControl??"always"},{provide:wm,useValue:n.callSetDisabledState??lg}]}}};r.\u0275fac=function(s){return new(s||r)},r.\u0275mod=xi({type:r}),r.\u0275inj=wi({imports:[hz]});let a=r;return a})();function yZ(a,r){if(a&1){let l=Ce();A(0,"div",2),ct("@fade.done",function(s){te(l);let d=vt();return ee(d.onAnimationEnd(s))}),k()}if(a&2){let l=vt();Z("@fade",l.animationState)("@.disabled",!l.animation)("innerHTML",l.title,$F)}}function bZ(a,r){if(a&1){let l=Ce();A(0,"div",3),ct("@fade.done",function(s){te(l);let d=vt();return ee(d.onAnimationEnd(s))}),V(1),k()}if(a&2){let l=vt();Z("@fade",l.animationState)("@.disabled",!l.animation),N(),ae(" ",l.title,`
`)}}var xZ=(()=>{class a{_cdRef;title;html;animation;tooltip=!0;_hidden=new pe;animationState="hidden";constructor(l){this._cdRef=l}markForCheck(){this._cdRef.markForCheck()}onAnimationEnd(l){l.toState==="hidden"&&this._hidden.next()}static \u0275fac=function(n){return new(n||a)(B(Wi))};static \u0275cmp=Et({type:a,selectors:[["mdb-tooltip"]],hostVars:2,hostBindings:function(n,s){n&2&&ei("tooltip",s.tooltip)},inputs:{title:"title",html:"html",animation:"animation"},decls:2,vars:2,consts:[["class","tooltip-inner",3,"innerHTML",4,"ngIf"],["class","tooltip-inner",4,"ngIf"],[1,"tooltip-inner",3,"innerHTML"],[1,"tooltip-inner"]],template:function(n,s){n&1&&mt(0,yZ,1,3,"div",0)(1,bZ,2,3,"div",1),n&2&&(Z("ngIf",s.html),N(),Z("ngIf",!s.html))},dependencies:[qe],encapsulation:2,data:{animation:[Yr("fade",[Wn("visible",Ei({opacity:1})),Wn("hidden",Ei({opacity:0})),Sn("visible => hidden",Bn("150ms linear")),Sn(":enter",Bn("150ms linear"))])]},changeDetection:0})}return a})(),mz=(()=>{class a{_overlay;_overlayPositionBuilder;_elementRef;mdbTooltip="";tooltipDisabled=!1;placement="top";html=!1;animation=!0;trigger="hover focus";delayShow=0;delayHide=0;offset=0;tooltipShow=new ye;tooltipShown=new ye;tooltipHide=new ye;tooltipHidden=new ye;_overlayRef;_tooltipRef;_open=!1;_showTimeout=0;_hideTimeout=0;_destroy$=new pe;constructor(l,n,s){this._overlay=l,this._overlayPositionBuilder=n,this._elementRef=s}ngOnInit(){this.tooltipDisabled||this.mdbTooltip===""||this._bindTriggerEvents()}ngOnDestroy(){(this._open||this._showTimeout)&&this.hide(),this._destroy$.next(),this._destroy$.complete()}_bindTriggerEvents(){this.trigger.split(" ").forEach(n=>{if(n==="click")Po(this._elementRef.nativeElement,n).pipe(ri(this._destroy$)).subscribe(()=>this.toggle());else if(n!=="manual"){let s=n==="hover"?"mouseenter":"focusin",d=n==="hover"?"mouseleave":"focusout";Po(this._elementRef.nativeElement,s).pipe(ri(this._destroy$)).subscribe(()=>this.show()),Po(this._elementRef.nativeElement,d).pipe(ri(this._destroy$)).subscribe(()=>this.hide())}})}_createOverlayConfig(){let l=this._overlayPositionBuilder.flexibleConnectedTo(this._elementRef).withPositions(this._getPosition());return new ns({hasBackdrop:!1,scrollStrategy:this._overlay.scrollStrategies.reposition(),positionStrategy:l})}_createOverlay(){this._overlayRef=this._overlay.create(this._createOverlayConfig())}_getPosition(){let l,n={originX:"center",originY:"top",overlayX:"center",overlayY:"bottom",offsetY:-this.offset},s={originX:"center",originY:"bottom",overlayX:"center",overlayY:"top",offsetY:this.offset},d={originX:"end",originY:"center",overlayX:"start",overlayY:"center",offsetX:this.offset},m={originX:"start",originY:"center",overlayX:"end",overlayY:"center",offsetX:-this.offset};switch(this.placement){case"top":l=[n,s];break;case"bottom":l=[s,n];break;case"left":l=[m,d];break;case"right":l=[d,m];break;default:break}return l}show(){(this._hideTimeout||this._open)&&(this._overlayRef.detach(),clearTimeout(this._hideTimeout),this._hideTimeout=null),this._createOverlay(),this._showTimeout=setTimeout(()=>{if(!this._overlayRef.hasAttached()){let l=new is(xZ);this.tooltipShow.emit(this),this._open=!0,this._tooltipRef=this._overlayRef.attach(l),this._tooltipRef.instance.title=this.mdbTooltip,this._tooltipRef.instance.html=this.html,this._tooltipRef.instance.animation=this.animation,this._tooltipRef.instance.animationState="visible",this._tooltipRef.instance.markForCheck(),this.tooltipShown.emit(this)}},this.delayShow)}hide(){if(this._showTimeout)clearTimeout(this._showTimeout),this._showTimeout=null;else return;this._hideTimeout=setTimeout(()=>{this.tooltipHide.emit(this),this._tooltipRef?(this._tooltipRef.instance._hidden.pipe(Nl()).subscribe(()=>{this._overlayRef.detach(),this._open=!1,this.tooltipHidden.emit(this)}),this._tooltipRef.instance.animationState="hidden",this._tooltipRef.instance.markForCheck()):(this._overlayRef.detach(),this._open=!1,this.tooltipHidden.emit(this))},this.delayHide)}toggle(){this._open?this.hide():this.show()}static \u0275fac=function(n){return new(n||a)(B($n),B(tg),B(Se))};static \u0275dir=re({type:a,selectors:[["","mdbTooltip",""]],inputs:{mdbTooltip:"mdbTooltip",tooltipDisabled:"tooltipDisabled",placement:"placement",html:"html",animation:"animation",trigger:"trigger",delayShow:"delayShow",delayHide:"delayHide",offset:"offset"},outputs:{tooltipShow:"tooltipShow",tooltipShown:"tooltipShown",tooltipHide:"tooltipHide",tooltipHidden:"tooltipHidden"},exportAs:["mdbTooltip"]})}return a})(),pz=(()=>{class a{static \u0275fac=function(n){return new(n||a)};static \u0275mod=xi({type:a});static \u0275inj=wi({imports:[Lo,hl]})}return a})();var Cy=(()=>{let r=class r{constructor(){}parseJwt(n){let d=n.split(".")[1].replace("-","+").replace("_","/");return JSON.parse(window.atob(d))}isLoggedIn(){let n=this.getToken();if(n===null)return!1;let s=this.parseJwt(n),m=new Date().getTime()/1e3;return s.exp>m}getRole(){let n=this.getToken();return n===null?"":this.parseJwt(n).role}setToken(n,s){s?localStorage.setItem("token",n):sessionStorage.setItem("token",n)}removeToken(){localStorage.removeItem("token"),sessionStorage.removeItem("token")}getToken(){return localStorage.getItem("token")||sessionStorage.getItem("token")||null}getUsername(){return this.parseJwt(this.getToken()).sub}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var CZ=(()=>{let r=class r{create(n){return typeof MutationObserver>"u"?null:new MutationObserver(n)}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),gz=(()=>{let r=class r{constructor(n){this._mutationObserverFactory=n,this._observedElements=new Map}ngOnDestroy(){this._observedElements.forEach((n,s)=>this._cleanupObserver(s))}observe(n){let s=Os(n);return new ga(d=>{let _=this._observeElement(s).subscribe(d);return()=>{_.unsubscribe(),this._unobserveElement(s)}})}_observeElement(n){if(this._observedElements.has(n))this._observedElements.get(n).count++;else{let s=new pe,d=this._mutationObserverFactory.create(m=>s.next(m));d&&d.observe(n,{characterData:!0,childList:!0,subtree:!0}),this._observedElements.set(n,{observer:d,stream:s,count:1})}return this._observedElements.get(n).stream}_unobserveElement(n){this._observedElements.has(n)&&(this._observedElements.get(n).count--,this._observedElements.get(n).count||this._cleanupObserver(n))}_cleanupObserver(n){if(this._observedElements.has(n)){let{observer:s,stream:d}=this._observedElements.get(n);s&&s.disconnect(),d.complete(),this._observedElements.delete(n)}}};r.\u0275fac=function(s){return new(s||r)(ht(CZ))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var yz=" ";function uM(a,r,l){let n=Dy(a,r);l=l.trim(),!n.some(s=>s.trim()===l)&&(n.push(l),a.setAttribute(r,n.join(yz)))}function ky(a,r,l){let n=Dy(a,r);l=l.trim();let s=n.filter(d=>d!==l);s.length?a.setAttribute(r,s.join(yz)):a.removeAttribute(r)}function Dy(a,r){return a.getAttribute(r)?.match(/\S+/g)??[]}var bz="cdk-describedby-message",Sy="cdk-describedby-host",lM=0,Ry=(()=>{let r=class r{constructor(n,s){this._platform=s,this._messageRegistry=new Map,this._messagesContainer=null,this._id=`${lM++}`,this._document=n,this._id=oe(yf)+"-"+lM++}describe(n,s,d){if(!this._canBeDescribed(n,s))return;let m=aM(s,d);typeof s!="string"?(_z(s,this._id),this._messageRegistry.set(m,{messageElement:s,referenceCount:0})):this._messageRegistry.has(m)||this._createMessageElement(s,d),this._isElementDescribedByMessage(n,m)||this._addMessageReference(n,m)}removeDescription(n,s,d){if(!s||!this._isElementNode(n))return;let m=aM(s,d);if(this._isElementDescribedByMessage(n,m)&&this._removeMessageReference(n,m),typeof s=="string"){let _=this._messageRegistry.get(m);_&&_.referenceCount===0&&this._deleteMessageElement(m)}this._messagesContainer?.childNodes.length===0&&(this._messagesContainer.remove(),this._messagesContainer=null)}ngOnDestroy(){let n=this._document.querySelectorAll(`[${Sy}="${this._id}"]`);for(let s=0;s<n.length;s++)this._removeCdkDescribedByReferenceIds(n[s]),n[s].removeAttribute(Sy);this._messagesContainer?.remove(),this._messagesContainer=null,this._messageRegistry.clear()}_createMessageElement(n,s){let d=this._document.createElement("div");_z(d,this._id),d.textContent=n,s&&d.setAttribute("role",s),this._createMessagesContainer(),this._messagesContainer.appendChild(d),this._messageRegistry.set(aM(n,s),{messageElement:d,referenceCount:0})}_deleteMessageElement(n){this._messageRegistry.get(n)?.messageElement?.remove(),this._messageRegistry.delete(n)}_createMessagesContainer(){if(this._messagesContainer)return;let n="cdk-describedby-message-container",s=this._document.querySelectorAll(`.${n}[platform="server"]`);for(let m=0;m<s.length;m++)s[m].remove();let d=this._document.createElement("div");d.style.visibility="hidden",d.classList.add(n),d.classList.add("cdk-visually-hidden"),this._platform&&!this._platform.isBrowser&&d.setAttribute("platform","server"),this._document.body.appendChild(d),this._messagesContainer=d}_removeCdkDescribedByReferenceIds(n){let s=Dy(n,"aria-describedby").filter(d=>d.indexOf(bz)!=0);n.setAttribute("aria-describedby",s.join(" "))}_addMessageReference(n,s){let d=this._messageRegistry.get(s);uM(n,"aria-describedby",d.messageElement.id),n.setAttribute(Sy,this._id),d.referenceCount++}_removeMessageReference(n,s){let d=this._messageRegistry.get(s);d.referenceCount--,ky(n,"aria-describedby",d.messageElement.id),n.removeAttribute(Sy)}_isElementDescribedByMessage(n,s){let d=Dy(n,"aria-describedby"),m=this._messageRegistry.get(s),_=m&&m.messageElement.id;return!!_&&d.indexOf(_)!=-1}_canBeDescribed(n,s){if(!this._isElementNode(n))return!1;if(s&&typeof s=="object")return!0;let d=s==null?"":`${s}`.trim(),m=n.getAttribute("aria-label");return d?!m||m.trim()!==d:!1}_isElementNode(n){return n.nodeType===this._document.ELEMENT_NODE}};r.\u0275fac=function(s){return new(s||r)(ht(li),ht(pn))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function aM(a,r){return typeof a=="string"?`${r||""}/${a}`:a}function _z(a,r){a.id||(a.id=`${bz}-${r}-${lM++}`)}var Ty=class{constructor(r){this._items=r,this._activeItemIndex=-1,this._activeItem=null,this._wrap=!1,this._letterKeyStream=new pe,this._typeaheadSubscription=nr.EMPTY,this._vertical=!0,this._allowedModifierKeys=[],this._homeAndEnd=!1,this._pageUpAndDown={enabled:!1,delta:10},this._skipPredicateFn=l=>l.disabled,this._pressedLetters=[],this.tabOut=new pe,this.change=new pe,r instanceof vf&&(this._itemChangesSubscription=r.changes.subscribe(l=>{if(this._activeItem){let s=l.toArray().indexOf(this._activeItem);s>-1&&s!==this._activeItemIndex&&(this._activeItemIndex=s)}}))}skipPredicate(r){return this._skipPredicateFn=r,this}withWrap(r=!0){return this._wrap=r,this}withVerticalOrientation(r=!0){return this._vertical=r,this}withHorizontalOrientation(r){return this._horizontal=r,this}withAllowedModifierKeys(r){return this._allowedModifierKeys=r,this}withTypeAhead(r=200){return this._typeaheadSubscription.unsubscribe(),this._typeaheadSubscription=this._letterKeyStream.pipe($r(l=>this._pressedLetters.push(l)),_v(r),wn(()=>this._pressedLetters.length>0),Fi(()=>this._pressedLetters.join(""))).subscribe(l=>{let n=this._getItemsArray();for(let s=1;s<n.length+1;s++){let d=(this._activeItemIndex+s)%n.length,m=n[d];if(!this._skipPredicateFn(m)&&m.getLabel().toUpperCase().trim().indexOf(l)===0){this.setActiveItem(d);break}}this._pressedLetters=[]}),this}cancelTypeahead(){return this._pressedLetters=[],this}withHomeAndEnd(r=!0){return this._homeAndEnd=r,this}withPageUpDown(r=!0,l=10){return this._pageUpAndDown={enabled:r,delta:l},this}setActiveItem(r){let l=this._activeItem;this.updateActiveItem(r),this._activeItem!==l&&this.change.next(this._activeItemIndex)}onKeydown(r){let l=r.keyCode,s=["altKey","ctrlKey","metaKey","shiftKey"].every(d=>!r[d]||this._allowedModifierKeys.indexOf(d)>-1);switch(l){case 9:this.tabOut.next();return;case 40:if(this._vertical&&s){this.setNextItemActive();break}else return;case 38:if(this._vertical&&s){this.setPreviousItemActive();break}else return;case 39:if(this._horizontal&&s){this._horizontal==="rtl"?this.setPreviousItemActive():this.setNextItemActive();break}else return;case 37:if(this._horizontal&&s){this._horizontal==="rtl"?this.setNextItemActive():this.setPreviousItemActive();break}else return;case 36:if(this._homeAndEnd&&s){this.setFirstItemActive();break}else return;case 35:if(this._homeAndEnd&&s){this.setLastItemActive();break}else return;case 33:if(this._pageUpAndDown.enabled&&s){let d=this._activeItemIndex-this._pageUpAndDown.delta;this._setActiveItemByIndex(d>0?d:0,1);break}else return;case 34:if(this._pageUpAndDown.enabled&&s){let d=this._activeItemIndex+this._pageUpAndDown.delta,m=this._getItemsArray().length;this._setActiveItemByIndex(d<m?d:m-1,-1);break}else return;default:(s||Zr(r,"shiftKey"))&&(r.key&&r.key.length===1?this._letterKeyStream.next(r.key.toLocaleUpperCase()):(l>=65&&l<=90||l>=48&&l<=57)&&this._letterKeyStream.next(String.fromCharCode(l)));return}this._pressedLetters=[],r.preventDefault()}get activeItemIndex(){return this._activeItemIndex}get activeItem(){return this._activeItem}isTyping(){return this._pressedLetters.length>0}setFirstItemActive(){this._setActiveItemByIndex(0,1)}setLastItemActive(){this._setActiveItemByIndex(this._items.length-1,-1)}setNextItemActive(){this._activeItemIndex<0?this.setFirstItemActive():this._setActiveItemByDelta(1)}setPreviousItemActive(){this._activeItemIndex<0&&this._wrap?this.setLastItemActive():this._setActiveItemByDelta(-1)}updateActiveItem(r){let l=this._getItemsArray(),n=typeof r=="number"?r:l.indexOf(r),s=l[n];this._activeItem=s??null,this._activeItemIndex=n}destroy(){this._typeaheadSubscription.unsubscribe(),this._itemChangesSubscription?.unsubscribe(),this._letterKeyStream.complete(),this.tabOut.complete(),this.change.complete(),this._pressedLetters=[]}_setActiveItemByDelta(r){this._wrap?this._setActiveInWrapMode(r):this._setActiveInDefaultMode(r)}_setActiveInWrapMode(r){let l=this._getItemsArray();for(let n=1;n<=l.length;n++){let s=(this._activeItemIndex+r*n+l.length)%l.length,d=l[s];if(!this._skipPredicateFn(d)){this.setActiveItem(s);return}}}_setActiveInDefaultMode(r){this._setActiveItemByIndex(this._activeItemIndex+r,r)}_setActiveItemByIndex(r,l){let n=this._getItemsArray();if(n[r]){for(;this._skipPredicateFn(n[r]);)if(r+=l,!n[r])return;this.setActiveItem(r)}}_getItemsArray(){return this._items instanceof vf?this._items.toArray():this._items}},Iy=class extends Ty{setActiveItem(r){this.activeItem&&this.activeItem.setInactiveStyles(),super.setActiveItem(r),this.activeItem&&this.activeItem.setActiveStyles()}},Ay=class extends Ty{constructor(){super(...arguments),this._origin="program"}setFocusOrigin(r){return this._origin=r,this}setActiveItem(r){super.setActiveItem(r),this.activeItem&&this.activeItem.focus(this._origin)}};var hg=(()=>{let r=class r{constructor(n){this._platform=n}isDisabled(n){return n.hasAttribute("disabled")}isVisible(n){return FZ(n)&&getComputedStyle(n).visibility==="visible"}isTabbable(n){if(!this._platform.isBrowser)return!1;let s=OZ(HZ(n));if(s&&(vz(s)===-1||!this.isVisible(s)))return!1;let d=n.nodeName.toLowerCase(),m=vz(n);return n.hasAttribute("contenteditable")?m!==-1:d==="iframe"||d==="object"||this._platform.WEBKIT&&this._platform.IOS&&!jZ(n)?!1:d==="audio"?n.hasAttribute("controls")?m!==-1:!1:d==="video"?m===-1?!1:m!==null?!0:this._platform.FIREFOX||n.hasAttribute("controls"):n.tabIndex>=0}isFocusable(n,s){return UZ(n)&&!this.isDisabled(n)&&(s?.ignoreVisibility||this.isVisible(n))}};r.\u0275fac=function(s){return new(s||r)(ht(pn))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function OZ(a){try{return a.frameElement}catch{return null}}function FZ(a){return!!(a.offsetWidth||a.offsetHeight||typeof a.getClientRects=="function"&&a.getClientRects().length)}function LZ(a){let r=a.nodeName.toLowerCase();return r==="input"||r==="select"||r==="button"||r==="textarea"}function zZ(a){return BZ(a)&&a.type=="hidden"}function NZ(a){return VZ(a)&&a.hasAttribute("href")}function BZ(a){return a.nodeName.toLowerCase()=="input"}function VZ(a){return a.nodeName.toLowerCase()=="a"}function xz(a){if(!a.hasAttribute("tabindex")||a.tabIndex===void 0)return!1;let r=a.getAttribute("tabindex");return!!(r&&!isNaN(parseInt(r,10)))}function vz(a){if(!xz(a))return null;let r=parseInt(a.getAttribute("tabindex")||"",10);return isNaN(r)?-1:r}function jZ(a){let r=a.nodeName.toLowerCase(),l=r==="input"&&a.type;return l==="text"||l==="password"||r==="select"||r==="textarea"}function UZ(a){return zZ(a)?!1:LZ(a)||NZ(a)||a.hasAttribute("contenteditable")||xz(a)}function HZ(a){return a.ownerDocument&&a.ownerDocument.defaultView||window}var cM=class{get enabled(){return this._enabled}set enabled(r){this._enabled=r,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(r,this._startAnchor),this._toggleAnchorTabIndex(r,this._endAnchor))}constructor(r,l,n,s,d=!1){this._element=r,this._checker=l,this._ngZone=n,this._document=s,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,d||this.attachAnchors()}destroy(){let r=this._startAnchor,l=this._endAnchor;r&&(r.removeEventListener("focus",this.startAnchorListener),r.remove()),l&&(l.removeEventListener("focus",this.endAnchorListener),l.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return this._hasAttached?!0:(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(r){return new Promise(l=>{this._executeOnStable(()=>l(this.focusInitialElement(r)))})}focusFirstTabbableElementWhenReady(r){return new Promise(l=>{this._executeOnStable(()=>l(this.focusFirstTabbableElement(r)))})}focusLastTabbableElementWhenReady(r){return new Promise(l=>{this._executeOnStable(()=>l(this.focusLastTabbableElement(r)))})}_getRegionBoundary(r){let l=this._element.querySelectorAll(`[cdk-focus-region-${r}], [cdkFocusRegion${r}], [cdk-focus-${r}]`);return r=="start"?l.length?l[0]:this._getFirstTabbableElement(this._element):l.length?l[l.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(r){let l=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(l){if(!this._checker.isFocusable(l)){let n=this._getFirstTabbableElement(l);return n?.focus(r),!!n}return l.focus(r),!0}return this.focusFirstTabbableElement(r)}focusFirstTabbableElement(r){let l=this._getRegionBoundary("start");return l&&l.focus(r),!!l}focusLastTabbableElement(r){let l=this._getRegionBoundary("end");return l&&l.focus(r),!!l}hasAttached(){return this._hasAttached}_getFirstTabbableElement(r){if(this._checker.isFocusable(r)&&this._checker.isTabbable(r))return r;let l=r.children;for(let n=0;n<l.length;n++){let s=l[n].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(l[n]):null;if(s)return s}return null}_getLastTabbableElement(r){if(this._checker.isFocusable(r)&&this._checker.isTabbable(r))return r;let l=r.children;for(let n=l.length-1;n>=0;n--){let s=l[n].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(l[n]):null;if(s)return s}return null}_createAnchor(){let r=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,r),r.classList.add("cdk-visually-hidden"),r.classList.add("cdk-focus-trap-anchor"),r.setAttribute("aria-hidden","true"),r}_toggleAnchorTabIndex(r,l){r?l.setAttribute("tabindex","0"):l.removeAttribute("tabindex")}toggleAnchors(r){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(r,this._startAnchor),this._toggleAnchorTabIndex(r,this._endAnchor))}_executeOnStable(r){this._ngZone.isStable?r():this._ngZone.onStable.pipe(Ji(1)).subscribe(r)}},mg=(()=>{let r=class r{constructor(n,s,d){this._checker=n,this._ngZone=s,this._document=d}create(n,s=!1){return new cM(n,this._checker,this._ngZone,this._document,s)}};r.\u0275fac=function(s){return new(s||r)(ht(hg),ht(ze),ht(li))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),wz=(()=>{let r=class r{get enabled(){return this.focusTrap?.enabled||!1}set enabled(n){this.focusTrap&&(this.focusTrap.enabled=n)}constructor(n,s,d){this._elementRef=n,this._focusTrapFactory=s,this._previouslyFocusedElement=null,oe(pn).isBrowser&&(this.focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement,!0))}ngOnDestroy(){this.focusTrap?.destroy(),this._previouslyFocusedElement&&(this._previouslyFocusedElement.focus(),this._previouslyFocusedElement=null)}ngAfterContentInit(){this.focusTrap?.attachAnchors(),this.autoCapture&&this._captureFocus()}ngDoCheck(){this.focusTrap&&!this.focusTrap.hasAttached()&&this.focusTrap.attachAnchors()}ngOnChanges(n){let s=n.autoCapture;s&&!s.firstChange&&this.autoCapture&&this.focusTrap?.hasAttached()&&this._captureFocus()}_captureFocus(){this._previouslyFocusedElement=_d(),this.focusTrap?.focusInitialElementWhenReady()}};r.\u0275fac=function(s){return new(s||r)(B(Se),B(mg),B(li))},r.\u0275dir=re({type:r,selectors:[["","cdkTrapFocus",""]],inputs:{enabled:[Rt.HasDecoratorInputTransform,"cdkTrapFocus","enabled",Qe],autoCapture:[Rt.HasDecoratorInputTransform,"cdkTrapFocusAutoCapture","autoCapture",Qe]},exportAs:["cdkTrapFocus"],standalone:!0,features:[Tn,qn]});let a=r;return a})();function pg(a){return a.buttons===0||a.detail===0}function fg(a){let r=a.touches&&a.touches[0]||a.changedTouches&&a.changedTouches[0];return!!r&&r.identifier===-1&&(r.radiusX==null||r.radiusX===1)&&(r.radiusY==null||r.radiusY===1)}var GZ=new we("cdk-input-modality-detector-options"),qZ={ignoreKeys:[18,17,224,91,16]},Cz=650,Cm=es({passive:!0,capture:!0}),WZ=(()=>{let r=class r{get mostRecentModality(){return this._modality.value}constructor(n,s,d,m){this._platform=n,this._mostRecentTarget=null,this._modality=new Ze(null),this._lastTouchMs=0,this._onKeydown=_=>{this._options?.ignoreKeys?.some(w=>w===_.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=dl(_))},this._onMousedown=_=>{Date.now()-this._lastTouchMs<Cz||(this._modality.next(pg(_)?"keyboard":"mouse"),this._mostRecentTarget=dl(_))},this._onTouchstart=_=>{if(fg(_)){this._modality.next("keyboard");return}this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=dl(_)},this._options=Gt(Gt({},qZ),m),this.modalityDetected=this._modality.pipe(vv(1)),this.modalityChanged=this.modalityDetected.pipe(gf()),n.isBrowser&&s.runOutsideAngular(()=>{d.addEventListener("keydown",this._onKeydown,Cm),d.addEventListener("mousedown",this._onMousedown,Cm),d.addEventListener("touchstart",this._onTouchstart,Cm)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,Cm),document.removeEventListener("mousedown",this._onMousedown,Cm),document.removeEventListener("touchstart",this._onTouchstart,Cm))}};r.\u0275fac=function(s){return new(s||r)(ht(pn),ht(ze),ht(li),ht(GZ,8))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),$Z=new we("liveAnnouncerElement",{providedIn:"root",factory:YZ});function YZ(){return null}var ZZ=new we("LIVE_ANNOUNCER_DEFAULT_OPTIONS"),XZ=0,Py=(()=>{let r=class r{constructor(n,s,d,m){this._ngZone=s,this._defaultOptions=m,this._document=d,this._liveElement=n||this._createLiveElement()}announce(n,...s){let d=this._defaultOptions,m,_;return s.length===1&&typeof s[0]=="number"?_=s[0]:[m,_]=s,this.clear(),clearTimeout(this._previousTimeout),m||(m=d&&d.politeness?d.politeness:"polite"),_==null&&d&&(_=d.duration),this._liveElement.setAttribute("aria-live",m),this._liveElement.id&&this._exposeAnnouncerToModals(this._liveElement.id),this._ngZone.runOutsideAngular(()=>(this._currentPromise||(this._currentPromise=new Promise(w=>this._currentResolve=w)),clearTimeout(this._previousTimeout),this._previousTimeout=setTimeout(()=>{this._liveElement.textContent=n,typeof _=="number"&&(this._previousTimeout=setTimeout(()=>this.clear(),_)),this._currentResolve(),this._currentPromise=this._currentResolve=void 0},100),this._currentPromise))}clear(){this._liveElement&&(this._liveElement.textContent="")}ngOnDestroy(){clearTimeout(this._previousTimeout),this._liveElement?.remove(),this._liveElement=null,this._currentResolve?.(),this._currentPromise=this._currentResolve=void 0}_createLiveElement(){let n="cdk-live-announcer-element",s=this._document.getElementsByClassName(n),d=this._document.createElement("div");for(let m=0;m<s.length;m++)s[m].remove();return d.classList.add(n),d.classList.add("cdk-visually-hidden"),d.setAttribute("aria-atomic","true"),d.setAttribute("aria-live","polite"),d.id=`cdk-live-announcer-${XZ++}`,this._document.body.appendChild(d),d}_exposeAnnouncerToModals(n){let s=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let d=0;d<s.length;d++){let m=s[d],_=m.getAttribute("aria-owns");_?_.indexOf(n)===-1&&m.setAttribute("aria-owns",_+" "+n):m.setAttribute("aria-owns",n)}}};r.\u0275fac=function(s){return new(s||r)(ht($Z,8),ht(ze),ht(li),ht(ZZ,8))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var My=function(a){return a[a.IMMEDIATE=0]="IMMEDIATE",a[a.EVENTUAL=1]="EVENTUAL",a}(My||{}),KZ=new we("cdk-focus-monitor-default-options"),Ey=es({passive:!0,capture:!0}),Ls=(()=>{let r=class r{constructor(n,s,d,m,_){this._ngZone=n,this._platform=s,this._inputModalityDetector=d,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new pe,this._rootNodeFocusAndBlurListener=w=>{let S=dl(w);for(let T=S;T;T=T.parentElement)w.type==="focus"?this._onFocus(w,T):this._onBlur(w,T)},this._document=m,this._detectionMode=_?.detectionMode||My.IMMEDIATE}monitor(n,s=!1){let d=Os(n);if(!this._platform.isBrowser||d.nodeType!==1)return Fe();let m=g3(d)||this._getDocument(),_=this._elementInfo.get(d);if(_)return s&&(_.checkChildren=!0),_.subject;let w={checkChildren:s,subject:new pe,rootNode:m};return this._elementInfo.set(d,w),this._registerGlobalListeners(w),w.subject}stopMonitoring(n){let s=Os(n),d=this._elementInfo.get(s);d&&(d.subject.complete(),this._setClasses(s),this._elementInfo.delete(s),this._removeGlobalListeners(d))}focusVia(n,s,d){let m=Os(n),_=this._getDocument().activeElement;m===_?this._getClosestElementsInfo(m).forEach(([w,S])=>this._originChanged(w,s,S)):(this._setOrigin(s),typeof m.focus=="function"&&m.focus(d))}ngOnDestroy(){this._elementInfo.forEach((n,s)=>this.stopMonitoring(s))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(n){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(n)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:n&&this._isLastInteractionFromInputLabel(n)?"mouse":"program"}_shouldBeAttributedToTouch(n){return this._detectionMode===My.EVENTUAL||!!n?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(n,s){n.classList.toggle("cdk-focused",!!s),n.classList.toggle("cdk-touch-focused",s==="touch"),n.classList.toggle("cdk-keyboard-focused",s==="keyboard"),n.classList.toggle("cdk-mouse-focused",s==="mouse"),n.classList.toggle("cdk-program-focused",s==="program")}_setOrigin(n,s=!1){this._ngZone.runOutsideAngular(()=>{if(this._origin=n,this._originFromTouchInteraction=n==="touch"&&s,this._detectionMode===My.IMMEDIATE){clearTimeout(this._originTimeoutId);let d=this._originFromTouchInteraction?Cz:1;this._originTimeoutId=setTimeout(()=>this._origin=null,d)}})}_onFocus(n,s){let d=this._elementInfo.get(s),m=dl(n);!d||!d.checkChildren&&s!==m||this._originChanged(s,this._getFocusOrigin(m),d)}_onBlur(n,s){let d=this._elementInfo.get(s);!d||d.checkChildren&&n.relatedTarget instanceof Node&&s.contains(n.relatedTarget)||(this._setClasses(s),this._emitOrigin(d,null))}_emitOrigin(n,s){n.subject.observers.length&&this._ngZone.run(()=>n.subject.next(s))}_registerGlobalListeners(n){if(!this._platform.isBrowser)return;let s=n.rootNode,d=this._rootNodeFocusListenerCount.get(s)||0;d||this._ngZone.runOutsideAngular(()=>{s.addEventListener("focus",this._rootNodeFocusAndBlurListener,Ey),s.addEventListener("blur",this._rootNodeFocusAndBlurListener,Ey)}),this._rootNodeFocusListenerCount.set(s,d+1),++this._monitoredElementCount===1&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(ri(this._stopInputModalityDetector)).subscribe(m=>{this._setOrigin(m,!0)}))}_removeGlobalListeners(n){let s=n.rootNode;if(this._rootNodeFocusListenerCount.has(s)){let d=this._rootNodeFocusListenerCount.get(s);d>1?this._rootNodeFocusListenerCount.set(s,d-1):(s.removeEventListener("focus",this._rootNodeFocusAndBlurListener,Ey),s.removeEventListener("blur",this._rootNodeFocusAndBlurListener,Ey),this._rootNodeFocusListenerCount.delete(s))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(n,s,d){this._setClasses(n,s),this._emitOrigin(d,s),this._lastFocusOrigin=s}_getClosestElementsInfo(n){let s=[];return this._elementInfo.forEach((d,m)=>{(m===n||d.checkChildren&&m.contains(n))&&s.push([m,d])}),s}_isLastInteractionFromInputLabel(n){let{_mostRecentTarget:s,mostRecentModality:d}=this._inputModalityDetector;if(d!=="mouse"||!s||s===n||n.nodeName!=="INPUT"&&n.nodeName!=="TEXTAREA"||n.disabled)return!1;let m=n.labels;if(m){for(let _=0;_<m.length;_++)if(m[_].contains(s))return!0}return!1}};r.\u0275fac=function(s){return new(s||r)(ht(ze),ht(pn),ht(WZ),ht(li,8),ht(KZ,8))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),Sz=(()=>{let r=class r{constructor(n,s){this._elementRef=n,this._focusMonitor=s,this._focusOrigin=null,this.cdkFocusChange=new ye}get focusOrigin(){return this._focusOrigin}ngAfterViewInit(){let n=this._elementRef.nativeElement;this._monitorSubscription=this._focusMonitor.monitor(n,n.nodeType===1&&n.hasAttribute("cdkMonitorSubtreeFocus")).subscribe(s=>{this._focusOrigin=s,this.cdkFocusChange.emit(s)})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._monitorSubscription&&this._monitorSubscription.unsubscribe()}};r.\u0275fac=function(s){return new(s||r)(B(Se),B(Ls))},r.\u0275dir=re({type:r,selectors:[["","cdkMonitorElementFocus",""],["","cdkMonitorSubtreeFocus",""]],outputs:{cdkFocusChange:"cdkFocusChange"},exportAs:["cdkMonitorFocus"],standalone:!0});let a=r;return a})();var QZ=["text"];function JZ(a,r){if(a&1&&dt(0,"mat-pseudo-checkbox",6),a&2){let l=vt();Z("disabled",l.disabled)("state",l.selected?"checked":"unchecked")}}function tX(a,r){if(a&1&&dt(0,"mat-pseudo-checkbox",7),a&2){let l=vt();Z("disabled",l.disabled)}}function eX(a,r){if(a&1&&(A(0,"span",8),V(1),k()),a&2){let l=vt();N(),ae("(",l.group.label,")")}}var iX=[[["mat-icon"]],"*"],nX=["mat-icon","*"];var Oz=(()=>{let r=class r{};r.STANDARD_CURVE="cubic-bezier(0.4,0.0,0.2,1)",r.DECELERATION_CURVE="cubic-bezier(0.0,0.0,0.2,1)",r.ACCELERATION_CURVE="cubic-bezier(0.4,0.0,1,1)",r.SHARP_CURVE="cubic-bezier(0.4,0.0,0.6,1)";let a=r;return a})(),Fz=(()=>{let r=class r{};r.COMPLEX="375ms",r.ENTERING="225ms",r.EXITING="195ms";let a=r;return a})();var Ou=class{constructor(r,l,n,s,d){this._defaultMatcher=r,this.ngControl=l,this._parentFormGroup=n,this._parentForm=s,this._stateChanges=d,this.errorState=!1}updateErrorState(){let r=this.errorState,l=this._parentFormGroup||this._parentForm,n=this.matcher||this._defaultMatcher,s=this.ngControl?this.ngControl.control:null,d=n?.isErrorState(s,l)??!1;d!==r&&(this.errorState=d,this._stateChanges.next())}};function Fy(a){return class extends a{constructor(...r){super(...r),this._isInitialized=!1,this._pendingSubscribers=[],this.initialized=new ga(l=>{this._isInitialized?this._notifySubscriber(l):this._pendingSubscribers.push(l)})}_markInitialized(){this._isInitialized,this._isInitialized=!0,this._pendingSubscribers.forEach(this._notifySubscriber),this._pendingSubscribers=null}_notifySubscriber(r){r.next(),r.complete()}}}var Ez=new we("MAT_DATE_LOCALE",{providedIn:"root",factory:rX});function rX(){return oe(JF)}var Ko=class{constructor(){this._localeChanges=new pe,this.localeChanges=this._localeChanges}getValidDateOrNull(r){return this.isDateInstance(r)&&this.isValid(r)?r:null}deserialize(r){return r==null||this.isDateInstance(r)&&this.isValid(r)?r:this.invalid()}setLocale(r){this.locale=r,this._localeChanges.next()}compareDate(r,l){return this.getYear(r)-this.getYear(l)||this.getMonth(r)-this.getMonth(l)||this.getDate(r)-this.getDate(l)}sameDate(r,l){if(r&&l){let n=this.isValid(r),s=this.isValid(l);return n&&s?!this.compareDate(r,l):n==s}return r==l}clampDate(r,l,n){return l&&this.compareDate(r,l)<0?l:n&&this.compareDate(r,n)>0?n:r}},Cd=new we("mat-date-formats"),oX=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|(?:(?:\+|-)\d{2}:\d{2}))?)?$/;function hM(a,r){let l=Array(a);for(let n=0;n<a;n++)l[n]=r(n);return l}var sX=(()=>{let r=class r extends Ko{constructor(n){super(),this.useUtcForDisplay=!1,this._matDateLocale=oe(Ez,{optional:!0}),n!==void 0&&(this._matDateLocale=n),super.setLocale(this._matDateLocale)}getYear(n){return n.getFullYear()}getMonth(n){return n.getMonth()}getDate(n){return n.getDate()}getDayOfWeek(n){return n.getDay()}getMonthNames(n){let s=new Intl.DateTimeFormat(this.locale,{month:n,timeZone:"utc"});return hM(12,d=>this._format(s,new Date(2017,d,1)))}getDateNames(){let n=new Intl.DateTimeFormat(this.locale,{day:"numeric",timeZone:"utc"});return hM(31,s=>this._format(n,new Date(2017,0,s+1)))}getDayOfWeekNames(n){let s=new Intl.DateTimeFormat(this.locale,{weekday:n,timeZone:"utc"});return hM(7,d=>this._format(s,new Date(2017,0,d+1)))}getYearName(n){let s=new Intl.DateTimeFormat(this.locale,{year:"numeric",timeZone:"utc"});return this._format(s,n)}getFirstDayOfWeek(){return 0}getNumDaysInMonth(n){return this.getDate(this._createDateWithOverflow(this.getYear(n),this.getMonth(n)+1,0))}clone(n){return new Date(n.getTime())}createDate(n,s,d){let m=this._createDateWithOverflow(n,s,d);return m.getMonth()!=s,m}today(){return new Date}parse(n,s){return typeof n=="number"?new Date(n):n?new Date(Date.parse(n)):null}format(n,s){if(!this.isValid(n))throw Error("NativeDateAdapter: Cannot format invalid date.");let d=new Intl.DateTimeFormat(this.locale,Ri(Gt({},s),{timeZone:"utc"}));return this._format(d,n)}addCalendarYears(n,s){return this.addCalendarMonths(n,s*12)}addCalendarMonths(n,s){let d=this._createDateWithOverflow(this.getYear(n),this.getMonth(n)+s,this.getDate(n));return this.getMonth(d)!=((this.getMonth(n)+s)%12+12)%12&&(d=this._createDateWithOverflow(this.getYear(d),this.getMonth(d),0)),d}addCalendarDays(n,s){return this._createDateWithOverflow(this.getYear(n),this.getMonth(n),this.getDate(n)+s)}toIso8601(n){return[n.getUTCFullYear(),this._2digit(n.getUTCMonth()+1),this._2digit(n.getUTCDate())].join("-")}deserialize(n){if(typeof n=="string"){if(!n)return null;if(oX.test(n)){let s=new Date(n);if(this.isValid(s))return s}}return super.deserialize(n)}isDateInstance(n){return n instanceof Date}isValid(n){return!isNaN(n.getTime())}invalid(){return new Date(NaN)}_createDateWithOverflow(n,s,d){let m=new Date;return m.setFullYear(n,s,d),m.setHours(0,0,0,0),m}_2digit(n){return("00"+n).slice(-2)}_format(n,s){let d=new Date;return d.setUTCFullYear(s.getFullYear(),s.getMonth(),s.getDate()),d.setUTCHours(s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()),n.format(d)}};r.\u0275fac=function(s){return new(s||r)(ht(Ez,8))},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})(),aX={parse:{dateInput:null},display:{dateInput:{year:"numeric",month:"numeric",day:"numeric"},monthYearLabel:{year:"numeric",month:"short"},dateA11yLabel:{year:"numeric",month:"long",day:"numeric"},monthYearA11yLabel:{year:"numeric",month:"long"}}};function Ly(a=aX){return[{provide:Ko,useClass:sX},{provide:Cd,useValue:a}]}var _g=(()=>{let r=class r{isErrorState(n,s){return!!(n&&n.invalid&&(n.touched||s&&s.submitted))}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var Da=function(a){return a[a.FADING_IN=0]="FADING_IN",a[a.VISIBLE=1]="VISIBLE",a[a.FADING_OUT=2]="FADING_OUT",a[a.HIDDEN=3]="HIDDEN",a}(Da||{}),fM=class{constructor(r,l,n,s=!1){this._renderer=r,this.element=l,this.config=n,this._animationForciblyDisabledThroughCss=s,this.state=Da.HIDDEN}fadeOut(){this._renderer.fadeOutRipple(this)}},Mz=es({passive:!0,capture:!0}),gM=class{constructor(){this._events=new Map,this._delegateEventHandler=r=>{let l=dl(r);l&&this._events.get(r.type)?.forEach((n,s)=>{(s===l||s.contains(l))&&n.forEach(d=>d.handleEvent(r))})}}addHandler(r,l,n,s){let d=this._events.get(l);if(d){let m=d.get(n);m?m.add(s):d.set(n,new Set([s]))}else this._events.set(l,new Map([[n,new Set([s])]])),r.runOutsideAngular(()=>{document.addEventListener(l,this._delegateEventHandler,Mz)})}removeHandler(r,l,n){let s=this._events.get(r);if(!s)return;let d=s.get(l);d&&(d.delete(n),d.size===0&&s.delete(l),s.size===0&&(this._events.delete(r),document.removeEventListener(r,this._delegateEventHandler,Mz)))}},Dz={enterDuration:225,exitDuration:150},lX=800,Tz=es({passive:!0,capture:!0}),Iz=["mousedown","touchstart"],Az=["mouseup","mouseleave","touchend","touchcancel"],gg=class gg{constructor(r,l,n,s){this._target=r,this._ngZone=l,this._platform=s,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,s.isBrowser&&(this._containerElement=Os(n))}fadeInRipple(r,l,n={}){let s=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),d=Gt(Gt({},Dz),n.animation);n.centered&&(r=s.left+s.width/2,l=s.top+s.height/2);let m=n.radius||cX(r,l,s),_=r-s.left,w=l-s.top,S=d.enterDuration,T=document.createElement("div");T.classList.add("mat-ripple-element"),T.style.left=`${_-m}px`,T.style.top=`${w-m}px`,T.style.height=`${m*2}px`,T.style.width=`${m*2}px`,n.color!=null&&(T.style.backgroundColor=n.color),T.style.transitionDuration=`${S}ms`,this._containerElement.appendChild(T);let L=window.getComputedStyle(T),H=L.transitionProperty,q=L.transitionDuration,X=H==="none"||q==="0s"||q==="0s, 0s"||s.width===0&&s.height===0,it=new fM(this,T,n,X);T.style.transform="scale3d(1, 1, 1)",it.state=Da.FADING_IN,n.persistent||(this._mostRecentTransientRipple=it);let at=null;return!X&&(S||d.exitDuration)&&this._ngZone.runOutsideAngular(()=>{let ut=()=>this._finishRippleTransition(it),Mt=()=>this._destroyRipple(it);T.addEventListener("transitionend",ut),T.addEventListener("transitioncancel",Mt),at={onTransitionEnd:ut,onTransitionCancel:Mt}}),this._activeRipples.set(it,at),(X||!S)&&this._finishRippleTransition(it),it}fadeOutRipple(r){if(r.state===Da.FADING_OUT||r.state===Da.HIDDEN)return;let l=r.element,n=Gt(Gt({},Dz),r.config.animation);l.style.transitionDuration=`${n.exitDuration}ms`,l.style.opacity="0",r.state=Da.FADING_OUT,(r._animationForciblyDisabledThroughCss||!n.exitDuration)&&this._finishRippleTransition(r)}fadeOutAll(){this._getActiveRipples().forEach(r=>r.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(r=>{r.config.persistent||r.fadeOut()})}setupTriggerEvents(r){let l=Os(r);!this._platform.isBrowser||!l||l===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=l,Iz.forEach(n=>{gg._eventManager.addHandler(this._ngZone,n,l,this)}))}handleEvent(r){r.type==="mousedown"?this._onMousedown(r):r.type==="touchstart"?this._onTouchStart(r):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{Az.forEach(l=>{this._triggerElement.addEventListener(l,this,Tz)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(r){r.state===Da.FADING_IN?this._startFadeOutTransition(r):r.state===Da.FADING_OUT&&this._destroyRipple(r)}_startFadeOutTransition(r){let l=r===this._mostRecentTransientRipple,{persistent:n}=r.config;r.state=Da.VISIBLE,!n&&(!l||!this._isPointerDown)&&r.fadeOut()}_destroyRipple(r){let l=this._activeRipples.get(r)??null;this._activeRipples.delete(r),this._activeRipples.size||(this._containerRect=null),r===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),r.state=Da.HIDDEN,l!==null&&(r.element.removeEventListener("transitionend",l.onTransitionEnd),r.element.removeEventListener("transitioncancel",l.onTransitionCancel)),r.element.remove()}_onMousedown(r){let l=pg(r),n=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+lX;!this._target.rippleDisabled&&!l&&!n&&(this._isPointerDown=!0,this.fadeInRipple(r.clientX,r.clientY,this._target.rippleConfig))}_onTouchStart(r){if(!this._target.rippleDisabled&&!fg(r)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;let l=r.changedTouches;if(l)for(let n=0;n<l.length;n++)this.fadeInRipple(l[n].clientX,l[n].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(r=>{let l=r.state===Da.VISIBLE||r.config.terminateOnPointerUp&&r.state===Da.FADING_IN;!r.config.persistent&&l&&r.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){let r=this._triggerElement;r&&(Iz.forEach(l=>gg._eventManager.removeHandler(l,r,this)),this._pointerUpEventsRegistered&&Az.forEach(l=>r.removeEventListener(l,this,Tz)))}};gg._eventManager=new gM;var _M=gg;function cX(a,r,l){let n=Math.max(Math.abs(a-l.left),Math.abs(a-l.right)),s=Math.max(Math.abs(r-l.top),Math.abs(r-l.bottom));return Math.sqrt(n*n+s*s)}var Lz=new we("mat-ripple-global-options"),zy=(()=>{let r=class r{get disabled(){return this._disabled}set disabled(n){n&&this.fadeOutAllNonPersistent(),this._disabled=n,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(n){this._trigger=n,this._setupTriggerEventsIfEnabled()}constructor(n,s,d,m,_){this._elementRef=n,this._animationMode=_,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=m||{},this._rippleRenderer=new _M(this,s,n,d)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:Gt(Gt(Gt({},this._globalOptions.animation),this._animationMode==="NoopAnimations"?{enterDuration:0,exitDuration:0}:{}),this.animation),terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(n,s=0,d){return typeof n=="number"?this._rippleRenderer.fadeInRipple(n,s,Gt(Gt({},this.rippleConfig),d)):this._rippleRenderer.fadeInRipple(0,0,Gt(Gt({},this.rippleConfig),n))}};r.\u0275fac=function(s){return new(s||r)(B(Se),B(ze),B(pn),B(Lz,8),B(So,8))},r.\u0275dir=re({type:r,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(s,d){s&2&&ei("mat-ripple-unbounded",d.unbounded)},inputs:{color:[Rt.None,"matRippleColor","color"],unbounded:[Rt.None,"matRippleUnbounded","unbounded"],centered:[Rt.None,"matRippleCentered","centered"],radius:[Rt.None,"matRippleRadius","radius"],animation:[Rt.None,"matRippleAnimation","animation"],disabled:[Rt.None,"matRippleDisabled","disabled"],trigger:[Rt.None,"matRippleTrigger","trigger"]},exportAs:["matRipple"],standalone:!0});let a=r;return a})();var dX=(()=>{let r=class r{constructor(n){this._animationMode=n,this.state="unchecked",this.disabled=!1,this.appearance="full"}};r.\u0275fac=function(s){return new(s||r)(B(So,8))},r.\u0275cmp=Et({type:r,selectors:[["mat-pseudo-checkbox"]],hostAttrs:[1,"mat-pseudo-checkbox"],hostVars:12,hostBindings:function(s,d){s&2&&ei("mat-pseudo-checkbox-indeterminate",d.state==="indeterminate")("mat-pseudo-checkbox-checked",d.state==="checked")("mat-pseudo-checkbox-disabled",d.disabled)("mat-pseudo-checkbox-minimal",d.appearance==="minimal")("mat-pseudo-checkbox-full",d.appearance==="full")("_mat-animation-noopable",d._animationMode==="NoopAnimations")},inputs:{state:"state",disabled:"disabled",appearance:"appearance"},standalone:!0,features:[At],decls:0,vars:0,template:function(s,d){},styles:['.mat-pseudo-checkbox{border-radius:2px;cursor:pointer;display:inline-block;vertical-align:middle;box-sizing:border-box;position:relative;flex-shrink:0;transition:border-color 90ms cubic-bezier(0, 0, 0.2, 0.1),background-color 90ms cubic-bezier(0, 0, 0.2, 0.1)}.mat-pseudo-checkbox::after{position:absolute;opacity:0;content:"";border-bottom:2px solid currentColor;transition:opacity 90ms cubic-bezier(0, 0, 0.2, 0.1)}.mat-pseudo-checkbox._mat-animation-noopable{transition:none !important;animation:none !important}.mat-pseudo-checkbox._mat-animation-noopable::after{transition:none}.mat-pseudo-checkbox-disabled{cursor:default}.mat-pseudo-checkbox-indeterminate::after{left:1px;opacity:1;border-radius:2px}.mat-pseudo-checkbox-checked::after{left:1px;border-left:2px solid currentColor;transform:rotate(-45deg);opacity:1;box-sizing:content-box}.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-checked::after,.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-indeterminate::after{color:var(--mat-minimal-pseudo-checkbox-selected-checkmark-color)}.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-checked.mat-pseudo-checkbox-disabled::after,.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-indeterminate.mat-pseudo-checkbox-disabled::after{color:var(--mat-minimal-pseudo-checkbox-disabled-selected-checkmark-color)}.mat-pseudo-checkbox-full{border-color:var(--mat-full-pseudo-checkbox-unselected-icon-color);border-width:2px;border-style:solid}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-disabled{border-color:var(--mat-full-pseudo-checkbox-disabled-unselected-icon-color)}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-checked,.mat-pseudo-checkbox-full.mat-pseudo-checkbox-indeterminate{background-color:var(--mat-full-pseudo-checkbox-selected-icon-color);border-color:rgba(0,0,0,0)}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-checked::after,.mat-pseudo-checkbox-full.mat-pseudo-checkbox-indeterminate::after{color:var(--mat-full-pseudo-checkbox-selected-checkmark-color)}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-checked.mat-pseudo-checkbox-disabled,.mat-pseudo-checkbox-full.mat-pseudo-checkbox-indeterminate.mat-pseudo-checkbox-disabled{background-color:var(--mat-full-pseudo-checkbox-disabled-selected-icon-color)}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-checked.mat-pseudo-checkbox-disabled::after,.mat-pseudo-checkbox-full.mat-pseudo-checkbox-indeterminate.mat-pseudo-checkbox-disabled::after{color:var(--mat-full-pseudo-checkbox-disabled-selected-checkmark-color)}.mat-pseudo-checkbox{width:18px;height:18px}.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-checked::after{width:14px;height:6px;transform-origin:center;top:-4.2426406871px;left:0;bottom:0;right:0;margin:auto}.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-indeterminate::after{top:8px;width:16px}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-checked::after{width:10px;height:4px;transform-origin:center;top:-2.8284271247px;left:0;bottom:0;right:0;margin:auto}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-indeterminate::after{top:6px;width:12px}'],encapsulation:2,changeDetection:0});let a=r;return a})();var yM=new we("MAT_OPTION_PARENT_COMPONENT");var bM=new we("MatOptgroup");var uX=0,vM=class{constructor(r,l=!1){this.source=r,this.isUserInput=l}},Ny=(()=>{let r=class r{get multiple(){return this._parent&&this._parent.multiple}get selected(){return this._selected}get disabled(){return this.group&&this.group.disabled||this._disabled}set disabled(n){this._disabled=n}get disableRipple(){return!!(this._parent&&this._parent.disableRipple)}get hideSingleSelectionIndicator(){return!!(this._parent&&this._parent.hideSingleSelectionIndicator)}constructor(n,s,d,m){this._element=n,this._changeDetectorRef=s,this._parent=d,this.group=m,this._selected=!1,this._active=!1,this._disabled=!1,this._mostRecentViewValue="",this.id=`mat-option-${uX++}`,this.onSelectionChange=new ye,this._stateChanges=new pe}get active(){return this._active}get viewValue(){return(this._text?.nativeElement.textContent||"").trim()}select(n=!0){this._selected||(this._selected=!0,this._changeDetectorRef.markForCheck(),n&&this._emitSelectionChangeEvent())}deselect(n=!0){this._selected&&(this._selected=!1,this._changeDetectorRef.markForCheck(),n&&this._emitSelectionChangeEvent())}focus(n,s){let d=this._getHostElement();typeof d.focus=="function"&&d.focus(s)}setActiveStyles(){this._active||(this._active=!0,this._changeDetectorRef.markForCheck())}setInactiveStyles(){this._active&&(this._active=!1,this._changeDetectorRef.markForCheck())}getLabel(){return this.viewValue}_handleKeydown(n){(n.keyCode===13||n.keyCode===32)&&!Zr(n)&&(this._selectViaInteraction(),n.preventDefault())}_selectViaInteraction(){this.disabled||(this._selected=this.multiple?!this._selected:!0,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent(!0))}_getTabIndex(){return this.disabled?"-1":"0"}_getHostElement(){return this._element.nativeElement}ngAfterViewChecked(){if(this._selected){let n=this.viewValue;n!==this._mostRecentViewValue&&(this._mostRecentViewValue&&this._stateChanges.next(),this._mostRecentViewValue=n)}}ngOnDestroy(){this._stateChanges.complete()}_emitSelectionChangeEvent(n=!1){this.onSelectionChange.emit(new vM(this,n))}};r.\u0275fac=function(s){return new(s||r)(B(Se),B(Wi),B(yM,8),B(bM,8))},r.\u0275cmp=Et({type:r,selectors:[["mat-option"]],viewQuery:function(s,d){if(s&1&&Ge(QZ,7),s&2){let m;ce(m=de())&&(d._text=m.first)}},hostAttrs:["role","option",1,"mat-mdc-option","mdc-list-item"],hostVars:11,hostBindings:function(s,d){s&1&&ct("click",function(){return d._selectViaInteraction()})("keydown",function(_){return d._handleKeydown(_)}),s&2&&(Rs("id",d.id),oi("aria-selected",d.selected)("aria-disabled",d.disabled.toString()),ei("mdc-list-item--selected",d.selected)("mat-mdc-option-multiple",d.multiple)("mat-mdc-option-active",d.active)("mdc-list-item--disabled",d.disabled))},inputs:{value:"value",id:"id",disabled:[Rt.HasDecoratorInputTransform,"disabled","disabled",Qe]},outputs:{onSelectionChange:"onSelectionChange"},exportAs:["matOption"],standalone:!0,features:[Tn,At],ngContentSelectors:nX,decls:8,vars:5,consts:[["class","mat-mdc-option-pseudo-checkbox","aria-hidden","true",3,"disabled","state"],[1,"mdc-list-item__primary-text"],["text",""],["class","mat-mdc-option-pseudo-checkbox","state","checked","aria-hidden","true","appearance","minimal",3,"disabled"],["class","cdk-visually-hidden"],["aria-hidden","true","mat-ripple","",1,"mat-mdc-option-ripple","mat-mdc-focus-indicator",3,"matRippleTrigger","matRippleDisabled"],["aria-hidden","true",1,"mat-mdc-option-pseudo-checkbox",3,"disabled","state"],["state","checked","aria-hidden","true","appearance","minimal",1,"mat-mdc-option-pseudo-checkbox",3,"disabled"],[1,"cdk-visually-hidden"]],template:function(s,d){s&1&&(Nn(iX),mt(0,JZ,1,2,"mat-pseudo-checkbox",0),Ti(1),A(2,"span",1,2),Ti(4,1),k(),mt(5,tX,1,1,"mat-pseudo-checkbox",3)(6,eX,2,1,"span",4),dt(7,"div",5)),s&2&&($i(0,d.multiple?0:-1),N(5),$i(5,!d.multiple&&d.selected&&!d.hideSingleSelectionIndicator?5:-1),N(),$i(6,d.group&&d.group._inert?6:-1),N(),Z("matRippleTrigger",d._getHostElement())("matRippleDisabled",d.disabled||d.disableRipple))},dependencies:[dX,zy],styles:['.mat-mdc-option{display:flex;position:relative;align-items:center;justify-content:flex-start;overflow:hidden;padding:0;padding-left:16px;padding-right:16px;-webkit-user-select:none;user-select:none;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;cursor:pointer;-webkit-tap-highlight-color:rgba(0,0,0,0);color:var(--mat-option-label-text-color);font-family:var(--mat-option-label-text-font);line-height:var(--mat-option-label-text-line-height);font-size:var(--mat-option-label-text-size);letter-spacing:var(--mat-option-label-text-tracking);font-weight:var(--mat-option-label-text-weight);min-height:48px}.mat-mdc-option:focus{outline:none}[dir=rtl] .mat-mdc-option,.mat-mdc-option[dir=rtl]{padding-left:16px;padding-right:16px}.mat-mdc-option:hover:not(.mdc-list-item--disabled){background-color:var(--mat-option-hover-state-layer-color)}.mat-mdc-option:focus.mdc-list-item,.mat-mdc-option.mat-mdc-option-active.mdc-list-item{background-color:var(--mat-option-focus-state-layer-color)}.mat-mdc-option.mdc-list-item--selected:not(.mdc-list-item--disabled) .mdc-list-item__primary-text{color:var(--mat-option-selected-state-label-text-color)}.mat-mdc-option.mdc-list-item--selected:not(.mdc-list-item--disabled):not(.mat-mdc-option-multiple){background-color:var(--mat-option-selected-state-layer-color)}.mat-mdc-option.mdc-list-item{align-items:center;background:rgba(0,0,0,0)}.mat-mdc-option.mdc-list-item--disabled{cursor:default;pointer-events:none}.mat-mdc-option.mdc-list-item--disabled .mat-mdc-option-pseudo-checkbox,.mat-mdc-option.mdc-list-item--disabled .mdc-list-item__primary-text,.mat-mdc-option.mdc-list-item--disabled>mat-icon{opacity:.38}.mat-mdc-optgroup .mat-mdc-option:not(.mat-mdc-option-multiple){padding-left:32px}[dir=rtl] .mat-mdc-optgroup .mat-mdc-option:not(.mat-mdc-option-multiple){padding-left:16px;padding-right:32px}.mat-mdc-option .mat-icon,.mat-mdc-option .mat-pseudo-checkbox-full{margin-right:16px;flex-shrink:0}[dir=rtl] .mat-mdc-option .mat-icon,[dir=rtl] .mat-mdc-option .mat-pseudo-checkbox-full{margin-right:0;margin-left:16px}.mat-mdc-option .mat-pseudo-checkbox-minimal{margin-left:16px;flex-shrink:0}[dir=rtl] .mat-mdc-option .mat-pseudo-checkbox-minimal{margin-right:16px;margin-left:0}.mat-mdc-option .mat-mdc-option-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-mdc-option .mdc-list-item__primary-text{white-space:normal;font-size:inherit;font-weight:inherit;letter-spacing:inherit;line-height:inherit;font-family:inherit;text-decoration:inherit;text-transform:inherit;margin-right:auto}[dir=rtl] .mat-mdc-option .mdc-list-item__primary-text{margin-right:0;margin-left:auto}.cdk-high-contrast-active .mat-mdc-option.mdc-list-item--selected:not(.mat-mdc-option-multiple)::after{content:"";position:absolute;top:50%;right:16px;transform:translateY(-50%);width:10px;height:0;border-bottom:solid 10px;border-radius:10px}[dir=rtl] .cdk-high-contrast-active .mat-mdc-option.mdc-list-item--selected:not(.mat-mdc-option-multiple)::after{right:auto;left:16px}.mat-mdc-option-multiple{--mdc-list-list-item-selected-container-color:var(--mdc-list-list-item-container-color, transparent)}.mat-mdc-option-active .mat-mdc-focus-indicator::before{content:""}'],encapsulation:2,changeDetection:0});let a=r;return a})();function zz(a,r,l){if(l.length){let n=r.toArray(),s=l.toArray(),d=0;for(let m=0;m<a+1;m++)n[m].group&&n[m].group===s[d]&&d++;return d}return 0}function Nz(a,r,l,n){return a<l?a:a+r>l+n?Math.max(0,a-n+r):l}var kz={capture:!0},Rz=["focus","click","mouseenter","touchstart"],mM="mat-ripple-loader-uninitialized",pM="mat-ripple-loader-class-name",Pz="mat-ripple-loader-centered",Oy="mat-ripple-loader-disabled",Bz=(()=>{let r=class r{constructor(){this._document=oe(li,{optional:!0}),this._animationMode=oe(So,{optional:!0}),this._globalRippleOptions=oe(Lz,{optional:!0}),this._platform=oe(pn),this._ngZone=oe(ze),this._hosts=new Map,this._onInteraction=n=>{if(!(n.target instanceof HTMLElement))return;let d=n.target.closest(`[${mM}]`);d&&this._createRipple(d)},this._ngZone.runOutsideAngular(()=>{for(let n of Rz)this._document?.addEventListener(n,this._onInteraction,kz)})}ngOnDestroy(){let n=this._hosts.keys();for(let s of n)this.destroyRipple(s);for(let s of Rz)this._document?.removeEventListener(s,this._onInteraction,kz)}configureRipple(n,s){n.setAttribute(mM,""),(s.className||!n.hasAttribute(pM))&&n.setAttribute(pM,s.className||""),s.centered&&n.setAttribute(Pz,""),s.disabled&&n.setAttribute(Oy,"")}getRipple(n){return this._hosts.get(n)||this._createRipple(n)}setDisabled(n,s){let d=this._hosts.get(n);if(d){d.disabled=s;return}s?n.setAttribute(Oy,""):n.removeAttribute(Oy)}_createRipple(n){if(!this._document)return;let s=this._hosts.get(n);if(s)return s;n.querySelector(".mat-ripple")?.remove();let d=this._document.createElement("span");d.classList.add("mat-ripple",n.getAttribute(pM)),n.append(d);let m=new zy(new Se(d),this._ngZone,this._platform,this._globalRippleOptions?this._globalRippleOptions:void 0,this._animationMode?this._animationMode:void 0);return m._isInitialized=!0,m.trigger=n,m.centered=n.hasAttribute(Pz),m.disabled=n.hasAttribute(Oy),this.attachRipple(n,m),m}attachRipple(n,s){n.removeAttribute(mM),this._hosts.set(n,s)}destroyRipple(n){let s=this._hosts.get(n);s&&(s.ngOnDestroy(),this._hosts.delete(n))}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var mX=["mat-button",""],pX=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],fX=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"];var gX=".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}";var _X=["mat-icon-button",""],vX=["*"];var yX=new we("MAT_BUTTON_CONFIG");var bX=[{attribute:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{attribute:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{attribute:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{attribute:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{attribute:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab"]},{attribute:"mat-mini-fab",mdcClasses:["mdc-fab","mdc-fab--mini","mat-mdc-mini-fab"]},{attribute:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}],Vz=(()=>{let r=class r{get ripple(){return this._rippleLoader?.getRipple(this._elementRef.nativeElement)}set ripple(n){this._rippleLoader?.attachRipple(this._elementRef.nativeElement,n)}get disableRipple(){return this._disableRipple}set disableRipple(n){this._disableRipple=n,this._updateRippleDisabled()}get disabled(){return this._disabled}set disabled(n){this._disabled=n,this._updateRippleDisabled()}constructor(n,s,d,m){this._elementRef=n,this._platform=s,this._ngZone=d,this._animationMode=m,this._focusMonitor=oe(Ls),this._rippleLoader=oe(Bz),this._isFab=!1,this._disableRipple=!1,this._disabled=!1;let _=oe(yX,{optional:!0}),w=n.nativeElement,S=w.classList;this.disabledInteractive=_?.disabledInteractive??!1,this._rippleLoader?.configureRipple(w,{className:"mat-mdc-button-ripple"});for(let{attribute:T,mdcClasses:L}of bX)w.hasAttribute(T)&&S.add(...L)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._rippleLoader?.destroyRipple(this._elementRef.nativeElement)}focus(n="program",s){n?this._focusMonitor.focusVia(this._elementRef.nativeElement,n,s):this._elementRef.nativeElement.focus(s)}_getAriaDisabled(){return this.ariaDisabled!=null?this.ariaDisabled:this.disabled&&this.disabledInteractive?!0:null}_getDisabledAttribute(){return this.disabledInteractive||!this.disabled?null:!0}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}};r.\u0275fac=function(s){bu()},r.\u0275dir=re({type:r,inputs:{color:"color",disableRipple:[Rt.HasDecoratorInputTransform,"disableRipple","disableRipple",Qe],disabled:[Rt.HasDecoratorInputTransform,"disabled","disabled",Qe],ariaDisabled:[Rt.HasDecoratorInputTransform,"aria-disabled","ariaDisabled",Qe],disabledInteractive:[Rt.HasDecoratorInputTransform,"disabledInteractive","disabledInteractive",Qe]},features:[Tn]});let a=r;return a})();var Qs=(()=>{let r=class r extends Vz{constructor(n,s,d,m){super(n,s,d,m)}};r.\u0275fac=function(s){return new(s||r)(B(Se),B(pn),B(ze),B(So,8))},r.\u0275cmp=Et({type:r,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostVars:14,hostBindings:function(s,d){s&2&&(oi("disabled",d._getDisabledAttribute())("aria-disabled",d._getAriaDisabled()),sl(d.color?"mat-"+d.color:""),ei("mat-mdc-button-disabled",d.disabled)("mat-mdc-button-disabled-interactive",d.disabledInteractive)("_mat-animation-noopable",d._animationMode==="NoopAnimations")("mat-unthemed",!d.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],standalone:!0,features:[Si,At],attrs:mX,ngContentSelectors:fX,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(s,d){s&1&&(Nn(pX),dt(0,"span",0),Ti(1),A(2,"span",1),Ti(3,1),k(),Ti(4,2),dt(5,"span",2)(6,"span",3)),s&2&&ei("mdc-button__ripple",!d._isFab)("mdc-fab__ripple",d._isFab)},styles:['.mdc-touch-target-wrapper{display:inline}.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button{position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;user-select:none;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0)}.mdc-button .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top}[dir=rtl] .mdc-button .mdc-button__icon,.mdc-button .mdc-button__icon[dir=rtl]{margin-left:8px;margin-right:0}.mdc-button .mdc-button__progress-indicator{font-size:0;position:absolute;transform:translate(-50%, -50%);top:50%;left:50%;line-height:initial}.mdc-button .mdc-button__label{position:relative}.mdc-button .mdc-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px);display:none}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring{border-color:CanvasText}}.mdc-button .mdc-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring::after{border-color:CanvasText}}@media screen and (forced-colors: active){.mdc-button.mdc-ripple-upgraded--background-focused .mdc-button__focus-ring,.mdc-button:not(.mdc-ripple-upgraded):focus .mdc-button__focus-ring{display:block}}.mdc-button .mdc-button__touch{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mdc-button__label+.mdc-button__icon{margin-left:8px;margin-right:0}[dir=rtl] .mdc-button__label+.mdc-button__icon,.mdc-button__label+.mdc-button__icon[dir=rtl]{margin-left:0;margin-right:8px}svg.mdc-button__icon{fill:currentColor}.mdc-button--touch{margin-top:6px;margin-bottom:6px}.mdc-button{padding:0 8px 0 8px}.mdc-button--unelevated{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--unelevated.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--unelevated.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--raised{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--raised.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--raised.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--outlined{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button--outlined .mdc-button__ripple{border-style:solid;border-color:rgba(0,0,0,0)}.mat-mdc-button{font-family:var(--mdc-text-button-label-text-font);font-size:var(--mdc-text-button-label-text-size);letter-spacing:var(--mdc-text-button-label-text-tracking);font-weight:var(--mdc-text-button-label-text-weight);text-transform:var(--mdc-text-button-label-text-transform);height:var(--mdc-text-button-container-height);border-radius:var(--mdc-text-button-container-shape);padding:0 var(--mat-text-button-horizontal-padding, 8px)}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color)}.mat-mdc-button:disabled{color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape)}.mat-mdc-button:has(.material-icons,mat-icon,[matButtonIcon]){padding:0 var(--mat-text-button-with-icon-horizontal-padding, 8px)}.mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}[dir=rtl] .mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}.mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}.mat-mdc-button .mat-ripple-element{background-color:var(--mat-text-button-ripple-color)}.mat-mdc-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-state-layer-color)}.mat-mdc-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-disabled-state-layer-color)}.mat-mdc-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-hover-state-layer-opacity)}.mat-mdc-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-focus-state-layer-opacity)}.mat-mdc-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-pressed-state-layer-opacity)}.mat-mdc-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-text-button-touch-target-display)}.mat-mdc-button[disabled],.mat-mdc-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-unelevated-button{font-family:var(--mdc-filled-button-label-text-font);font-size:var(--mdc-filled-button-label-text-size);letter-spacing:var(--mdc-filled-button-label-text-tracking);font-weight:var(--mdc-filled-button-label-text-weight);text-transform:var(--mdc-filled-button-label-text-transform);height:var(--mdc-filled-button-container-height);border-radius:var(--mdc-filled-button-container-shape);padding:0 var(--mat-filled-button-horizontal-padding, 16px)}.mat-mdc-unelevated-button:not(:disabled){background-color:var(--mdc-filled-button-container-color)}.mat-mdc-unelevated-button:disabled{background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color)}.mat-mdc-unelevated-button:disabled{color:var(--mdc-filled-button-disabled-label-text-color)}.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape)}.mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}.mat-mdc-unelevated-button .mat-ripple-element{background-color:var(--mat-filled-button-ripple-color)}.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-state-layer-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-disabled-state-layer-color)}.mat-mdc-unelevated-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-hover-state-layer-opacity)}.mat-mdc-unelevated-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-focus-state-layer-opacity)}.mat-mdc-unelevated-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-pressed-state-layer-opacity)}.mat-mdc-unelevated-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-filled-button-touch-target-display)}.mat-mdc-unelevated-button[disabled],.mat-mdc-unelevated-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-filled-button-disabled-label-text-color);background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-raised-button{font-family:var(--mdc-protected-button-label-text-font);font-size:var(--mdc-protected-button-label-text-size);letter-spacing:var(--mdc-protected-button-label-text-tracking);font-weight:var(--mdc-protected-button-label-text-weight);text-transform:var(--mdc-protected-button-label-text-transform);height:var(--mdc-protected-button-container-height);border-radius:var(--mdc-protected-button-container-shape);padding:0 var(--mat-protected-button-horizontal-padding, 16px);box-shadow:var(--mdc-protected-button-container-elevation-shadow)}.mat-mdc-raised-button:not(:disabled){background-color:var(--mdc-protected-button-container-color)}.mat-mdc-raised-button:disabled{background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color)}.mat-mdc-raised-button:disabled{color:var(--mdc-protected-button-disabled-label-text-color)}.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape)}.mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}.mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}.mat-mdc-raised-button .mat-ripple-element{background-color:var(--mat-protected-button-ripple-color)}.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-state-layer-color)}.mat-mdc-raised-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-disabled-state-layer-color)}.mat-mdc-raised-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-hover-state-layer-opacity)}.mat-mdc-raised-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-focus-state-layer-opacity)}.mat-mdc-raised-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-pressed-state-layer-opacity)}.mat-mdc-raised-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-protected-button-touch-target-display)}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation-shadow)}.mat-mdc-raised-button:focus{box-shadow:var(--mdc-protected-button-focus-container-elevation-shadow)}.mat-mdc-raised-button:active,.mat-mdc-raised-button:focus:active{box-shadow:var(--mdc-protected-button-pressed-container-elevation-shadow)}.mat-mdc-raised-button[disabled],.mat-mdc-raised-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-protected-button-disabled-label-text-color);background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button[disabled].mat-mdc-button-disabled,.mat-mdc-raised-button.mat-mdc-button-disabled.mat-mdc-button-disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation-shadow)}.mat-mdc-raised-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button{font-family:var(--mdc-outlined-button-label-text-font);font-size:var(--mdc-outlined-button-label-text-size);letter-spacing:var(--mdc-outlined-button-label-text-tracking);font-weight:var(--mdc-outlined-button-label-text-weight);text-transform:var(--mdc-outlined-button-label-text-transform);height:var(--mdc-outlined-button-container-height);border-radius:var(--mdc-outlined-button-container-shape);padding:0 15px 0 15px;border-width:var(--mdc-outlined-button-outline-width);padding:0 var(--mat-outlined-button-horizontal-padding, 15px)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color)}.mat-mdc-outlined-button:disabled{color:var(--mdc-outlined-button-disabled-label-text-color)}.mat-mdc-outlined-button .mdc-button__ripple{border-radius:var(--mdc-outlined-button-container-shape)}.mat-mdc-outlined-button:not(:disabled){border-color:var(--mdc-outlined-button-outline-color)}.mat-mdc-outlined-button:disabled{border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mdc-button--icon-trailing{padding:0 11px 0 15px}.mat-mdc-outlined-button.mdc-button--icon-leading{padding:0 15px 0 11px}.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:var(--mdc-outlined-button-outline-width)}.mat-mdc-outlined-button .mdc-button__touch{left:calc(-1 * var(--mdc-outlined-button-outline-width));width:calc(100% + 2 * var(--mdc-outlined-button-outline-width))}.mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-outlined-button-ripple-color)}.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-state-layer-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-disabled-state-layer-color)}.mat-mdc-outlined-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-hover-state-layer-opacity)}.mat-mdc-outlined-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-focus-state-layer-opacity)}.mat-mdc-outlined-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-pressed-state-layer-opacity)}.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-outlined-button-touch-target-display)}.mat-mdc-outlined-button[disabled],.mat-mdc-outlined-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-outlined-button-disabled-label-text-color);border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-button-base{text-decoration:none}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-button .mdc-button__label,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-outlined-button .mdc-button__label{z-index:1}.mat-mdc-button .mat-mdc-focus-indicator,.mat-mdc-unelevated-button .mat-mdc-focus-indicator,.mat-mdc-raised-button .mat-mdc-focus-indicator,.mat-mdc-outlined-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-unelevated-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-raised-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-outlined-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:-1px}.mat-mdc-unelevated-button .mat-mdc-focus-indicator::before,.mat-mdc-raised-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-outlined-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 3px)*-1)}',".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0});let a=r;return a})();var Tc=(()=>{let r=class r extends Vz{constructor(n,s,d,m){super(n,s,d,m),this._rippleLoader.configureRipple(this._elementRef.nativeElement,{centered:!0})}};r.\u0275fac=function(s){return new(s||r)(B(Se),B(pn),B(ze),B(So,8))},r.\u0275cmp=Et({type:r,selectors:[["button","mat-icon-button",""]],hostVars:14,hostBindings:function(s,d){s&2&&(oi("disabled",d._getDisabledAttribute())("aria-disabled",d._getAriaDisabled()),sl(d.color?"mat-"+d.color:""),ei("mat-mdc-button-disabled",d.disabled)("mat-mdc-button-disabled-interactive",d.disabledInteractive)("_mat-animation-noopable",d._animationMode==="NoopAnimations")("mat-unthemed",!d.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],standalone:!0,features:[Si,At],attrs:_X,ngContentSelectors:vX,decls:4,vars:0,consts:[[1,"mat-mdc-button-persistent-ripple","mdc-icon-button__ripple"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(s,d){s&1&&(Nn(),dt(0,"span",0),Ti(1),dt(2,"span",1)(3,"span",2))},styles:['.mdc-icon-button{display:inline-block;position:relative;box-sizing:border-box;border:none;outline:none;background-color:rgba(0,0,0,0);fill:currentColor;color:inherit;text-decoration:none;cursor:pointer;user-select:none;z-index:0;overflow:visible}.mdc-icon-button .mdc-icon-button__touch{position:absolute;top:50%;height:48px;left:50%;width:48px;transform:translate(-50%, -50%)}@media screen and (forced-colors: active){.mdc-icon-button.mdc-ripple-upgraded--background-focused .mdc-icon-button__focus-ring,.mdc-icon-button:not(.mdc-ripple-upgraded):focus .mdc-icon-button__focus-ring{display:block}}.mdc-icon-button:disabled{cursor:default;pointer-events:none}.mdc-icon-button[hidden]{display:none}.mdc-icon-button--display-flex{align-items:center;display:inline-flex;justify-content:center}.mdc-icon-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:100%;width:100%;display:none}@media screen and (forced-colors: active){.mdc-icon-button__focus-ring{border-color:CanvasText}}.mdc-icon-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-icon-button__focus-ring::after{border-color:CanvasText}}.mdc-icon-button__icon{display:inline-block}.mdc-icon-button__icon.mdc-icon-button__icon--on{display:none}.mdc-icon-button--on .mdc-icon-button__icon{display:none}.mdc-icon-button--on .mdc-icon-button__icon.mdc-icon-button__icon--on{display:inline-block}.mdc-icon-button__link{height:100%;left:0;outline:none;position:absolute;top:0;width:100%}.mat-mdc-icon-button{color:var(--mdc-icon-button-icon-color)}.mat-mdc-icon-button .mdc-button__icon{font-size:var(--mdc-icon-button-icon-size)}.mat-mdc-icon-button svg,.mat-mdc-icon-button img{width:var(--mdc-icon-button-icon-size);height:var(--mdc-icon-button-icon-size)}.mat-mdc-icon-button:disabled{color:var(--mdc-icon-button-disabled-icon-color)}.mat-mdc-icon-button{border-radius:50%;flex-shrink:0;text-align:center;width:var(--mdc-icon-button-state-layer-size, 48px);height:var(--mdc-icon-button-state-layer-size, 48px);padding:calc(calc(var(--mdc-icon-button-state-layer-size, 48px) - var(--mdc-icon-button-icon-size, 24px)) / 2);font-size:var(--mdc-icon-button-icon-size);-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-icon-button svg{vertical-align:baseline}.mat-mdc-icon-button[disabled],.mat-mdc-icon-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-icon-button-disabled-icon-color)}.mat-mdc-icon-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-icon-button .mat-mdc-button-ripple,.mat-mdc-icon-button .mat-mdc-button-persistent-ripple,.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-icon-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-icon-button .mdc-button__label{z-index:1}.mat-mdc-icon-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-icon-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-icon-button .mat-ripple-element{background-color:var(--mat-icon-button-ripple-color)}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-icon-button-state-layer-color)}.mat-mdc-icon-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-icon-button-disabled-state-layer-color)}.mat-mdc-icon-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-hover-state-layer-opacity)}.mat-mdc-icon-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-icon-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-icon-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-focus-state-layer-opacity)}.mat-mdc-icon-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-pressed-state-layer-opacity)}.mat-mdc-icon-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:50%;width:48px;transform:translate(-50%, -50%);display:var(--mat-icon-button-touch-target-display)}.mat-mdc-icon-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple{border-radius:50%}.mat-mdc-icon-button.mat-unthemed:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-primary:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-accent:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-warn:not(.mdc-ripple-upgraded):focus::before{background:rgba(0,0,0,0);opacity:1}',gX],encapsulation:2,changeDetection:0});let a=r;return a})();function xX(a,r){if(a&1){let l=Ce();A(0,"div",1)(1,"button",2),ct("click",function(){te(l);let s=vt();return ee(s.action())}),V(2),k()()}if(a&2){let l=vt();N(2),ae(" ",l.data.action," ")}}var wX=["label"];function CX(a,r){}var SX=Math.pow(2,31)-1,yg=class{constructor(r,l){this._overlayRef=l,this._afterDismissed=new pe,this._afterOpened=new pe,this._onAction=new pe,this._dismissedByAction=!1,this.containerInstance=r,r._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}dismissWithAction(){this._onAction.closed||(this._dismissedByAction=!0,this._onAction.next(),this._onAction.complete(),this.dismiss()),clearTimeout(this._durationTimeoutId)}closeWithAction(){this.dismissWithAction()}_dismissAfter(r){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(r,SX))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._onAction.closed||this._onAction.complete(),this._afterDismissed.next({dismissedByAction:this._dismissedByAction}),this._afterDismissed.complete(),this._dismissedByAction=!1}afterDismissed(){return this._afterDismissed}afterOpened(){return this.containerInstance._onEnter}onAction(){return this._onAction}},Uz=new we("MatSnackBarData"),Mm=class{constructor(){this.politeness="assertive",this.announcementMessage="",this.duration=0,this.data=null,this.horizontalPosition="center",this.verticalPosition="bottom"}},EX=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275dir=re({type:r,selectors:[["","matSnackBarLabel",""]],hostAttrs:[1,"mat-mdc-snack-bar-label","mdc-snackbar__label"],standalone:!0});let a=r;return a})(),MX=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275dir=re({type:r,selectors:[["","matSnackBarActions",""]],hostAttrs:[1,"mat-mdc-snack-bar-actions","mdc-snackbar__actions"],standalone:!0});let a=r;return a})(),DX=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275dir=re({type:r,selectors:[["","matSnackBarAction",""]],hostAttrs:[1,"mat-mdc-snack-bar-action","mdc-snackbar__action"],standalone:!0});let a=r;return a})(),TX=(()=>{let r=class r{constructor(n,s){this.snackBarRef=n,this.data=s}action(){this.snackBarRef.dismissWithAction()}get hasAction(){return!!this.data.action}};r.\u0275fac=function(s){return new(s||r)(B(yg),B(Uz))},r.\u0275cmp=Et({type:r,selectors:[["simple-snack-bar"]],hostAttrs:[1,"mat-mdc-simple-snack-bar"],exportAs:["matSnackBar"],standalone:!0,features:[At],decls:3,vars:2,consts:[["matSnackBarLabel",""],["matSnackBarActions",""],["mat-button","","matSnackBarAction","",3,"click"]],template:function(s,d){s&1&&(A(0,"div",0),V(1),k(),mt(2,xX,3,1,"div",1)),s&2&&(N(),ae(" ",d.data.message,`
`),N(),$i(2,d.hasAction?2:-1))},dependencies:[Qs,EX,MX,DX],styles:[".mat-mdc-simple-snack-bar{display:flex}"],encapsulation:2,changeDetection:0});let a=r;return a})(),IX={snackBarState:Yr("state",[Wn("void, hidden",Ei({transform:"scale(0.8)",opacity:0})),Wn("visible",Ei({transform:"scale(1)",opacity:1})),Sn("* => visible",Bn("150ms cubic-bezier(0, 0, 0.2, 1)")),Sn("* => void, * => hidden",Bn("75ms cubic-bezier(0.4, 0.0, 1, 1)",Ei({opacity:0})))])},AX=0,kX=(()=>{let r=class r extends yd{constructor(n,s,d,m,_){super(),this._ngZone=n,this._elementRef=s,this._changeDetectorRef=d,this._platform=m,this.snackBarConfig=_,this._document=oe(li),this._trackedModals=new Set,this._announceDelay=150,this._destroyed=!1,this._onAnnounce=new pe,this._onExit=new pe,this._onEnter=new pe,this._animationState="void",this._liveElementId=`mat-snack-bar-container-live-${AX++}`,this.attachDomPortal=w=>{this._assertNotAttached();let S=this._portalOutlet.attachDomPortal(w);return this._afterPortalAttached(),S},_.politeness==="assertive"&&!_.announcementMessage?this._live="assertive":_.politeness==="off"?this._live="off":this._live="polite",this._platform.FIREFOX&&(this._live==="polite"&&(this._role="status"),this._live==="assertive"&&(this._role="alert"))}attachComponentPortal(n){this._assertNotAttached();let s=this._portalOutlet.attachComponentPortal(n);return this._afterPortalAttached(),s}attachTemplatePortal(n){this._assertNotAttached();let s=this._portalOutlet.attachTemplatePortal(n);return this._afterPortalAttached(),s}onAnimationEnd(n){let{fromState:s,toState:d}=n;if((d==="void"&&s!=="void"||d==="hidden")&&this._completeExit(),d==="visible"){let m=this._onEnter;this._ngZone.run(()=>{m.next(),m.complete()})}}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.markForCheck(),this._changeDetectorRef.detectChanges(),this._screenReaderAnnounce())}exit(){return this._ngZone.run(()=>{this._animationState="hidden",this._changeDetectorRef.markForCheck(),this._elementRef.nativeElement.setAttribute("mat-exit",""),clearTimeout(this._announceTimeoutId)}),this._onExit}ngOnDestroy(){this._destroyed=!0,this._clearFromModals(),this._completeExit()}_completeExit(){queueMicrotask(()=>{this._onExit.next(),this._onExit.complete()})}_afterPortalAttached(){let n=this._elementRef.nativeElement,s=this.snackBarConfig.panelClass;s&&(Array.isArray(s)?s.forEach(_=>n.classList.add(_)):n.classList.add(s)),this._exposeToModals();let d=this._label.nativeElement,m="mdc-snackbar__label";d.classList.toggle(m,!d.querySelector(`.${m}`))}_exposeToModals(){let n=this._liveElementId,s=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let d=0;d<s.length;d++){let m=s[d],_=m.getAttribute("aria-owns");this._trackedModals.add(m),_?_.indexOf(n)===-1&&m.setAttribute("aria-owns",_+" "+n):m.setAttribute("aria-owns",n)}}_clearFromModals(){this._trackedModals.forEach(n=>{let s=n.getAttribute("aria-owns");if(s){let d=s.replace(this._liveElementId,"").trim();d.length>0?n.setAttribute("aria-owns",d):n.removeAttribute("aria-owns")}}),this._trackedModals.clear()}_assertNotAttached(){this._portalOutlet.hasAttached()}_screenReaderAnnounce(){this._announceTimeoutId||this._ngZone.runOutsideAngular(()=>{this._announceTimeoutId=setTimeout(()=>{let n=this._elementRef.nativeElement.querySelector("[aria-hidden]"),s=this._elementRef.nativeElement.querySelector("[aria-live]");if(n&&s){let d=null;this._platform.isBrowser&&document.activeElement instanceof HTMLElement&&n.contains(document.activeElement)&&(d=document.activeElement),n.removeAttribute("aria-hidden"),s.appendChild(n),d?.focus(),this._onAnnounce.next(),this._onAnnounce.complete()}},this._announceDelay)})}};r.\u0275fac=function(s){return new(s||r)(B(ze),B(Se),B(Wi),B(pn),B(Mm))},r.\u0275cmp=Et({type:r,selectors:[["mat-snack-bar-container"]],viewQuery:function(s,d){if(s&1&&(Ge(ul,7),Ge(wX,7)),s&2){let m;ce(m=de())&&(d._portalOutlet=m.first),ce(m=de())&&(d._label=m.first)}},hostAttrs:[1,"mdc-snackbar","mat-mdc-snack-bar-container","mdc-snackbar--open"],hostVars:1,hostBindings:function(s,d){s&1&&Cv("@state.done",function(_){return d.onAnimationEnd(_)}),s&2&&wv("@state",d._animationState)},standalone:!0,features:[Si,At],decls:6,vars:3,consts:[[1,"mdc-snackbar__surface"],[1,"mat-mdc-snack-bar-label"],["label",""],["aria-hidden","true"],["cdkPortalOutlet",""]],template:function(s,d){s&1&&(A(0,"div",0)(1,"div",1,2)(3,"div",3),mt(4,CX,0,0,"ng-template",4),k(),dt(5,"div"),k()()),s&2&&(N(5),oi("aria-live",d._live)("role",d._role)("id",d._liveElementId))},dependencies:[ul],styles:['.mdc-snackbar{display:none;position:fixed;right:0;bottom:0;left:0;align-items:center;justify-content:center;box-sizing:border-box;pointer-events:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mdc-snackbar--opening,.mdc-snackbar--open,.mdc-snackbar--closing{display:flex}.mdc-snackbar--open .mdc-snackbar__label,.mdc-snackbar--open .mdc-snackbar__actions{visibility:visible}.mdc-snackbar__surface{padding-left:0;padding-right:8px;display:flex;align-items:center;justify-content:flex-start;box-sizing:border-box;transform:scale(0.8);opacity:0}.mdc-snackbar__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-snackbar__surface::before{border-color:CanvasText}}[dir=rtl] .mdc-snackbar__surface,.mdc-snackbar__surface[dir=rtl]{padding-left:8px;padding-right:0}.mdc-snackbar--open .mdc-snackbar__surface{transform:scale(1);opacity:1;pointer-events:auto}.mdc-snackbar--closing .mdc-snackbar__surface{transform:scale(1)}.mdc-snackbar__label{padding-left:16px;padding-right:8px;width:100%;flex-grow:1;box-sizing:border-box;margin:0;visibility:hidden;padding-top:14px;padding-bottom:14px}[dir=rtl] .mdc-snackbar__label,.mdc-snackbar__label[dir=rtl]{padding-left:8px;padding-right:16px}.mdc-snackbar__label::before{display:inline;content:attr(data-mdc-snackbar-label-text)}.mdc-snackbar__actions{display:flex;flex-shrink:0;align-items:center;box-sizing:border-box;visibility:hidden}.mdc-snackbar__action+.mdc-snackbar__dismiss{margin-left:8px;margin-right:0}[dir=rtl] .mdc-snackbar__action+.mdc-snackbar__dismiss,.mdc-snackbar__action+.mdc-snackbar__dismiss[dir=rtl]{margin-left:0;margin-right:8px}.mat-mdc-snack-bar-container{margin:8px;position:static}.mat-mdc-snack-bar-container .mdc-snackbar__surface{min-width:344px}@media(max-width: 480px),(max-width: 344px){.mat-mdc-snack-bar-container .mdc-snackbar__surface{min-width:100%}}@media(max-width: 480px),(max-width: 344px){.mat-mdc-snack-bar-container{width:100vw}}.mat-mdc-snack-bar-container .mdc-snackbar__surface{max-width:672px}.mat-mdc-snack-bar-container .mdc-snackbar__surface{box-shadow:0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 6px 10px 0px rgba(0, 0, 0, 0.14), 0px 1px 18px 0px rgba(0, 0, 0, 0.12)}.mat-mdc-snack-bar-container .mdc-snackbar__surface{background-color:var(--mdc-snackbar-container-color)}.mat-mdc-snack-bar-container .mdc-snackbar__surface{border-radius:var(--mdc-snackbar-container-shape)}.mat-mdc-snack-bar-container .mdc-snackbar__label{color:var(--mdc-snackbar-supporting-text-color)}.mat-mdc-snack-bar-container .mdc-snackbar__label{font-size:var(--mdc-snackbar-supporting-text-size);font-family:var(--mdc-snackbar-supporting-text-font);font-weight:var(--mdc-snackbar-supporting-text-weight);line-height:var(--mdc-snackbar-supporting-text-line-height)}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled){color:var(--mat-snack-bar-button-color);--mat-text-button-state-layer-color:currentColor;--mat-text-button-ripple-color:currentColor}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled) .mat-ripple-element{opacity:.1}.mat-mdc-snack-bar-container .mdc-snackbar__label::before{display:none}.mat-mdc-snack-bar-handset,.mat-mdc-snack-bar-container,.mat-mdc-snack-bar-label{flex:1 1 auto}.mat-mdc-snack-bar-handset .mdc-snackbar__surface{width:100%}'],encapsulation:2,data:{animation:[IX.snackBarState]}});let a=r;return a})();function RX(){return new Mm}var PX=new we("mat-snack-bar-default-options",{providedIn:"root",factory:RX}),Je=(()=>{let r=class r{get _openedSnackBarRef(){let n=this._parentSnackBar;return n?n._openedSnackBarRef:this._snackBarRefAtThisLevel}set _openedSnackBarRef(n){this._parentSnackBar?this._parentSnackBar._openedSnackBarRef=n:this._snackBarRefAtThisLevel=n}constructor(n,s,d,m,_,w){this._overlay=n,this._live=s,this._injector=d,this._breakpointObserver=m,this._parentSnackBar=_,this._defaultConfig=w,this._snackBarRefAtThisLevel=null,this.simpleSnackBarComponent=TX,this.snackBarContainerComponent=kX,this.handsetCssClass="mat-mdc-snack-bar-handset"}openFromComponent(n,s){return this._attach(n,s)}openFromTemplate(n,s){return this._attach(n,s)}open(n,s="",d){let m=Gt(Gt({},this._defaultConfig),d);return m.data={message:n,action:s},m.announcementMessage===n&&(m.announcementMessage=void 0),this.openFromComponent(this.simpleSnackBarComponent,m)}dismiss(){this._openedSnackBarRef&&this._openedSnackBarRef.dismiss()}ngOnDestroy(){this._snackBarRefAtThisLevel&&this._snackBarRefAtThisLevel.dismiss()}_attachSnackBarContainer(n,s){let d=s&&s.viewContainerRef&&s.viewContainerRef.injector,m=uo.create({parent:d||this._injector,providers:[{provide:Mm,useValue:s}]}),_=new is(this.snackBarContainerComponent,s.viewContainerRef,m),w=n.attach(_);return w.instance.snackBarConfig=s,w.instance}_attach(n,s){let d=Gt(Gt(Gt({},new Mm),this._defaultConfig),s),m=this._createOverlay(d),_=this._attachSnackBarContainer(m,d),w=new yg(_,m);if(n instanceof Eo){let S=new Fs(n,null,{$implicit:d.data,snackBarRef:w});w.instance=_.attachTemplatePortal(S)}else{let S=this._createInjector(d,w),T=new is(n,void 0,S),L=_.attachComponentPortal(T);w.instance=L.instance}return this._breakpointObserver.observe(T3.HandsetPortrait).pipe(ri(m.detachments())).subscribe(S=>{m.overlayElement.classList.toggle(this.handsetCssClass,S.matches)}),d.announcementMessage&&_._onAnnounce.subscribe(()=>{this._live.announce(d.announcementMessage,d.politeness)}),this._animateSnackBar(w,d),this._openedSnackBarRef=w,this._openedSnackBarRef}_animateSnackBar(n,s){n.afterDismissed().subscribe(()=>{this._openedSnackBarRef==n&&(this._openedSnackBarRef=null),s.announcementMessage&&this._live.clear()}),this._openedSnackBarRef?(this._openedSnackBarRef.afterDismissed().subscribe(()=>{n.containerInstance.enter()}),this._openedSnackBarRef.dismiss()):n.containerInstance.enter(),s.duration&&s.duration>0&&n.afterOpened().subscribe(()=>n._dismissAfter(s.duration))}_createOverlay(n){let s=new ns;s.direction=n.direction;let d=this._overlay.position().global(),m=n.direction==="rtl",_=n.horizontalPosition==="left"||n.horizontalPosition==="start"&&!m||n.horizontalPosition==="end"&&m,w=!_&&n.horizontalPosition!=="center";return _?d.left("0"):w?d.right("0"):d.centerHorizontally(),n.verticalPosition==="top"?d.top("0"):d.bottom("0"),s.positionStrategy=d,this._overlay.create(s)}_createInjector(n,s){let d=n&&n.viewContainerRef&&n.viewContainerRef.injector;return uo.create({parent:d||this._injector,providers:[{provide:yg,useValue:s},{provide:Uz,useValue:n.data}]})}};r.\u0275fac=function(s){return new(s||r)(ht($n),ht(Py),ht(uo),ht(ly),ht(r,12),ht(PX))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var hi=(()=>{let r=class r{constructor(n,s,d,m){this.http=n,this.jwtHandler=s,this.snackBar=d,this.location=m}login(n,s,d){this.http.post(Me+"/authenticate",{username:n,password:s}).subscribe({next:m=>{this.jwtHandler.setToken(m.token,d),this.location.back()},error:m=>{this.snackBar.open(m.error,"Dismiss",{duration:3e3})}})}logout(){this.http.post(Me+"/logout",null,{headers:{Authorization:"Bearer "+this.jwtHandler.getToken()}}).subscribe({next:()=>{this.jwtHandler.removeToken(),this.snackBar.open("Ai fost deconectat cu succes!","Close",{duration:3e3})},error:n=>{this.snackBar.open(n.error,"Close",{duration:3e3})}})}register(n,s,d,m,_){this.http.post(Me+"/register",{firstName:n,lastName:s,username:d,password:m,email:_}).subscribe({next:()=>(this.location.back(),this.snackBar.open("Contul a fost creat cu succes!","Close",{duration:3e3}),!0),error:w=>(this.snackBar.open(w.error,"Close",{duration:3e3}),!1)})}forgotPassword(n){this.http.post(Me+"/forgot-password?email="+n,null).subscribe({next:()=>{this.location.back(),this.snackBar.open("Un email a fost trimis!","Close",{duration:3e3})},error:s=>{this.snackBar.open(s.error,"Close",{duration:300})}})}resetPassword(n,s){this.http.post(Me+"/reset-password?token="+n+"&password="+s,null).subscribe({next:()=>{this.location.back(),this.snackBar.open("Parola a fost schimbata!","Close",{duration:3e3})},error:d=>{this.snackBar.open(d.error,"Close",{duration:3e3})}})}verifyAccount(n){return this.http.post(Me+"/verify-account?token="+n,null)}resendVerifyAccountEmail(n){return this.http.post(Me+"/resend-verify-account-email?email="+n,null)}isLoggedIn(){return this.jwtHandler.isLoggedIn()}isUser(){return this.jwtHandler.getRole()==="USER"}isAdmin(){return this.jwtHandler.getRole()==="ADMIN"}isValidator(){return this.jwtHandler.getRole()==="TICKET_VALIDATOR"}getUsername(){return this.jwtHandler.getUsername()}getToken(){return this.jwtHandler.getToken()}};r.\u0275fac=function(s){return new(s||r)(ht(Gi),ht(Cy),ht(Je),ht(Bl))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var Sd=(()=>{let r=class r{constructor(n,s,d){this.http=n,this.identityService=s,this.snackBar=d,this.locationsSubject=new Ze({}),this.shoppingCartSizeSubject=new Ze(0),this.searchResultsSubject=new Ze({})}setLocations(n){this.locationsSubject.next(n)}getLocations(){return this.locationsSubject.asObservable()}setShoppingCartSize(n){this.shoppingCartSizeSubject.next(n)}getShoppingCartSize(){return this.shoppingCartSizeSubject.asObservable()}setSearchResults(n){this.searchResultsSubject.next(n)}getSearchResults(){return this.searchResultsSubject.asObservable()}fetchHeaderData(){return It(this,null,function*(){if(this.identityService.getToken())try{let s=yield Ve(this.http.get(Me+"/header/data",{headers:{Authorization:"Bearer "+this.identityService.getToken()||""}}));this.setLocations(s.locations),this.setShoppingCartSize(s.shoppingCartSize)}catch{this.snackBar.open("Failed to fetch header data","Close",{duration:3e3})}else try{let s=yield Ve(this.http.get(Me+"/header/data"));this.setLocations(s.locations),this.setShoppingCartSize(s.shoppingCartSize)}catch{this.snackBar.open("Failed to fetch header data","Close",{duration:3e3})}})}search(n){return It(this,null,function*(){try{let s=yield Ve(this.http.get(Me+"/search",{params:{query:n}}));this.setSearchResults(s)}catch{this.snackBar.open("Failed to search","Close",{duration:3e3})}})}};r.\u0275fac=function(s){return new(s||r)(ht(Gi),ht(hi),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var Dm=(()=>{let r=class r{constructor(n,s,d,m){this.http=n,this.identityService=s,this.headerService=d,this.snackBar=m,this.shoppingCartSubject=new Ze({})}setShoppingCart(n){this.shoppingCartSubject.next(n)}getShoppingCart(){return this.shoppingCartSubject.asObservable()}fetchShoppingCart(){return It(this,null,function*(){try{let n=yield Ve(this.http.get(Me+"/shopping-cart",{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setShoppingCart(n)}catch{this.snackBar.open("Error fetching shopping cart","Dismiss",{duration:3e3})}})}updateQuantity(n){return It(this,null,function*(){try{let s=yield Ve(this.http.patch(Me+"/shopping-cart/"+n.id+"?quantity="+n.quantity,null,{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setShoppingCart(s),this.snackBar.open("Cantitate actualizata cu succes!","Dismiss",{duration:3e3})}catch{this.snackBar.open("Error updating quantity","Dismiss",{duration:3e3})}})}removeTicketFromShoppingCart(n){return It(this,null,function*(){try{let s=yield Ve(this.http.put(Me+"/shopping-cart/"+n.id,null,{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setShoppingCart(s),this.headerService.getShoppingCartSize().subscribe(m=>this.headerService.setShoppingCartSize(m-1)).unsubscribe(),this.snackBar.open("Biletul a fost sters din cosul de cumparaturi!","Dismiss",{duration:3e3})}catch{this.snackBar.open("Error removing ticket from shopping cart","Dismiss",{duration:3e3})}})}buyTickets(){return It(this,null,function*(){try{yield Ve(this.http.post(Me+"/orders",null,{headers:{Authorization:"Bearer "+this.identityService.getToken()}})),this.setShoppingCart({shoppingCartItemList:[]}),this.headerService.setShoppingCartSize(0),this.snackBar.open("Comanda a fost realizata cu succes!","Dismiss",{duration:3e3})}catch{this.snackBar.open("Error buying tickets","Dismiss",{duration:3e3})}})}};r.\u0275fac=function(s){return new(s||r)(ht(Gi),ht(hi),ht(Sd),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var Hz=(()=>{let r=class r{constructor(){this.showDropdownSubject=new Ze(!1),this.showDropdown$=this.showDropdownSubject.asObservable()}setShowDropdown(n){this.showDropdownSubject.next(n)}toggleDropdown(){this.showDropdownSubject.next(!this.showDropdownSubject.value)}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var FX=["searchInput"],LX=["searchDropdown"];function zX(a,r){if(a&1&&(A(0,"span",35),V(1),k()),a&2){let l=vt();N(),De(l.shoppingCartSize)}}function NX(a,r){a&1&&dt(0,"i",36)}function BX(a,r){if(a&1&&(A(0,"div"),V(1),k()),a&2){let l=vt();N(),ae(" Salut, ",l.getIdentityService().getUsername()," ")}}function VX(a,r){a&1&&(A(0,"li")(1,"a",37),V(2,"Login"),k()())}function jX(a,r){a&1&&(A(0,"li")(1,"a",38),V(2,"Contul meu"),k()())}function UX(a,r){a&1&&(A(0,"li")(1,"a",39),V(2,"Comenzile mele"),k()())}function HX(a,r){a&1&&(A(0,"li")(1,"a",40),V(2,"Urmareste evenimentele"),k()())}function GX(a,r){if(a&1){let l=Ce();A(0,"li")(1,"a",41),ct("click",function(){te(l);let s=vt();return ee(s.logout())}),V(2,"Logout"),k()()}}var qX=()=>["/events"],Gz=a=>({location:a});function WX(a,r){if(a&1){let l=Ce();A(0,"a",42),ct("click",function(){te(l),vt();let s=Ir(41);return ee(s.toggle())}),dt(1,"img",43),A(2,"div",44)(3,"h5",45),V(4),k()()()}if(a&2){let l=r.$implicit;Z("routerLink",Nr(4,qX))("queryParams",Xi(5,Gz,l.name)),N(),hs("src",l.imageUrl,Tr),N(3),De(l.name)}}function $X(a,r){a&1&&(A(0,"h4"),V(1,"Locatii"),k())}var qz=()=>["events"];function YX(a,r){if(a&1&&(A(0,"li",50)(1,"a"),V(2),k()()),a&2){let l=r.$implicit;Z("routerLink",Nr(3,qz))("queryParams",Xi(4,Gz,l.id)),N(2),De(l==null?null:l.name)}}function ZX(a,r){a&1&&(A(0,"h4",51),V(1,"Evenimente"),k())}var XX=a=>["event",a],KX=a=>({id:a});function QX(a,r){if(a&1&&(A(0,"li",50)(1,"a"),V(2),k()()),a&2){let l=r.$implicit;Z("routerLink",Xi(3,XX,l.title))("queryParams",Xi(5,KX,l.id)),N(2),De(l==null?null:l.title)}}function JX(a,r){a&1&&(A(0,"h4",51),V(1,"Artisti"),k())}var tK=a=>({artist:a});function eK(a,r){if(a&1&&(A(0,"li",50)(1,"a"),V(2),k()()),a&2){let l=r.$implicit;Z("routerLink",Nr(3,qz))("queryParams",Xi(4,tK,l.name)),N(2),De(l==null?null:l.name)}}function iK(a,r){if(a&1&&(A(0,"div",46,47)(2,"ul"),mt(3,$X,2,0,"h4",26)(4,YX,3,6,"li",48)(5,ZX,2,0,"h4",49)(6,QX,3,7,"li",48)(7,JX,2,0,"h4",49)(8,eK,3,6,"li",48),k()()),a&2){let l=vt();N(3),Z("ngIf",l.searchLocations.length>0),N(),Z("ngForOf",l.searchLocations),N(),Z("ngIf",l.searchEvents.length>0),N(),Z("ngForOf",l.searchEvents),N(),Z("ngIf",l.searchArtists.length>0),N(),Z("ngForOf",l.searchArtists)}}var Wz=(()=>{let r=class r{constructor(n,s,d,m,_,w){this.router=n,this.headerService=s,this.identityService=d,this.shoppingCartService=m,this.snackBar=_,this.dropdownService=w,this.locations=[],this.locationsToDisplay=[],this.startIndex=0,this.showDropdown=!1,this.searchText="",this.searchLocations=[],this.searchEvents=[],this.searchArtists=[]}ngOnInit(){return It(this,null,function*(){this.dropdownService.setShowDropdown(!1),this.router.events.subscribe(n=>{n instanceof Ks&&(this.searchText="",this.searchLocations=[],this.searchEvents=[],this.searchArtists=[],this.dropdownService.setShowDropdown(!1))}),this.dropDownSubscription=this.dropdownService.showDropdown$.subscribe(n=>{this.showDropdown=n}),yield this.headerService.fetchHeaderData(),this.headerService.getLocations().subscribe({next:n=>{this.locations=n,this.locationsToDisplay=n.slice(0,5)}}),this.shoppingCartSubscription=this.headerService.getShoppingCartSize().subscribe({next:n=>{this.shoppingCartSize=n}})})}ngOnDestroy(){this.shoppingCartSubscription?.unsubscribe(),this.locationsSubscription?.unsubscribe(),this.dropDownSubscription?.unsubscribe(),this.searchResultSubscription?.unsubscribe()}scrollToNext(){this.startIndex+=5,this.startIndex>=this.locations.length?(this.startIndex=0,this.locationsToDisplay=this.locations.slice(this.startIndex,this.startIndex+5)):this.locations.length-this.startIndex<5?this.locationsToDisplay=this.locations.slice(this.startIndex,this.locations.length):this.locationsToDisplay=this.locations.slice(this.startIndex,this.startIndex+5)}onShoppingCartClick(){this.identityService.isLoggedIn()?this.router.navigate(["/shopping-cart"]):this.snackBar.open("Trebuie sa fii autentificat pentru a vedea cosul de cumparaturi!","Close",{duration:3e3})}onDocumentClick(n){let s=this.searchDropdown&&this.searchDropdown.nativeElement&&this.searchDropdown.nativeElement.contains(n.target),d=this.searchInput&&this.searchInput.nativeElement&&this.searchInput.nativeElement.contains(n.target);!s&&!d?this.dropdownService.setShowDropdown(!1):d&&(this.searchLocations.length>0||this.searchEvents.length>0||this.searchArtists.length>0)&&this.dropdownService.setShowDropdown(!0)}onDocumentKeydown(n){n.key==="Enter"&&this.searchInput.nativeElement.contains(document.activeElement)&&this.search()}search(){return It(this,null,function*(){this.searchText!==""&&(yield this.headerService.search(this.searchText),this.searchResultSubscription=this.headerService.getSearchResults().subscribe({next:n=>{this.searchLocations=n.locationList,this.searchEvents=n.eventList,this.searchArtists=n.artistList}}),this.dropdownService.setShowDropdown(!0))})}logout(){this.identityService.logout()}getIdentityService(){return this.identityService}};r.\u0275fac=function(s){return new(s||r)(B(tn),B(Sd),B(hi),B(Dm),B(Je),B(Hz))},r.\u0275cmp=Et({type:r,selectors:[["app-header"]],viewQuery:function(s,d){if(s&1&&(Ge(FX,5),Ge(LX,5)),s&2){let m;ce(m=de())&&(d.searchInput=m.first),ce(m=de())&&(d.searchDropdown=m.first)}},hostBindings:function(s,d){s&1&&ct("click",function(_){return d.onDocumentClick(_)},!1,ol)("keydown",function(_){return d.onDocumentKeydown(_)},!1,ol)},standalone:!0,features:[At],decls:47,vars:11,consts:[[1,"navbar","navbar-expand-lg","navbar-light","bg-light"],[1,"container-fluid","fs-5"],[1,"d-flex"],["routerLink","/",1,"navbar-brand"],["type","button","aria-controls","navbarToggleExternalContent","aria-expanded","false","aria-label","Toggle navigation",1,"margin-top",3,"click"],["routerLink","/events",1,"margin-top","ms-3"],["routerLink","/artists",1,"margin-top","ms-3"],["routerLink","/genres",1,"margin-top","ms-3"],["type","button","aria-expanded","false","aria-label","Toggle navigation",1,"navbar-toggler",3,"click"],[1,"fas","fa-bars"],["id","navbarNavAltMarkup","mdbCollapse","",1,"collapse","navbar-collapse","justify-content-between","align-items-center","fs-5"],["noListNav","mdbCollapse"],[1,"input-group"],[1,"spacer"],["type","search","placeholder","Cauta","aria-label","Search",1,"form-control","rounded","form-control-lg","ms-3",3,"ngModel","ngModelChange"],["searchInput",""],["role","button","id","search-addon",1,"btn","btn-light","input-group-text","border-0","ms-1","me-4",3,"click"],[1,"fas","fa-search","fs-6"],[1,"right-buttons","d-flex"],["role","button",1,"btn","btn-light","me-4",3,"click"],["mdbTooltip","Cos de cumparaturi",1,"d-flex","justify-content-center","align-items-center","fs-5"],["id","shopping-cart-icon",1,"fas","fa-shopping-cart","me-1"],["id","badge","class","badge text-primary",4,"ngIf"],["mdbDropdown","",1,"nav-item","dropdown","d-flex","justify-content-center","align-items-center","me-2"],["id","navbarDropdownMenuLink","role","button","mdbDropdownToggle","","aria-expanded","false",1,"nav-link","dropdown-toggle"],["class","fa-solid fa-user me-4",4,"ngIf"],[4,"ngIf"],["mdbDropdownMenu","","aria-labelledby","navbarDropdownMenuLink",1,"dropdown-menu","dropdown-menu-end"],["id","navbarToggleExternalContent","mdbCollapse","",1,"collapse"],["externalContent","mdbCollapse"],[1,"locations-container","d-flex","flex-row","flex-wrap"],["role","button","class","card col-6 col-md-4 col-lg-2",3,"routerLink","queryParams","click",4,"ngFor","ngForOf"],[1,"btn","next-button",3,"click"],[1,"fas","fa-angle-right"],["class","search-dropdown",4,"ngIf"],["id","badge",1,"badge","text-primary"],[1,"fa-solid","fa-user","me-4"],["routerLink","/login",1,"dropdown-item"],["routerLink","/account",1,"dropdown-item"],["routerLink","/account/orders",1,"dropdown-item"],["routerLink","/track",1,"dropdown-item"],["role","button",1,"dropdown-item",3,"click"],["role","button",1,"card","col-6","col-md-4","col-lg-2",3,"routerLink","queryParams","click"],["alt","",1,"img-fluid",3,"src"],[1,"card-body"],[1,"card-title"],[1,"search-dropdown"],["searchDropdown",""],[3,"routerLink","queryParams",4,"ngFor","ngForOf"],["class","mt-2",4,"ngIf"],[3,"routerLink","queryParams"],[1,"mt-2"]],template:function(s,d){if(s&1){let m=Ce();A(0,"header")(1,"nav",0)(2,"div",1)(3,"div",2)(4,"a",3),V(5,"Bileteria"),k(),A(6,"a",4),ct("click",function(){te(m);let w=Ir(41);return ee(w.toggle())}),V(7," Locatii "),k(),A(8,"a",5),V(9,"Evenimente"),k(),A(10,"a",6),V(11,"Artisti"),k(),A(12,"a",7),V(13,"Genuri"),k()(),A(14,"button",8),ct("click",function(){te(m);let w=Ir(17);return ee(w.toggle())}),dt(15,"i",9),k(),A(16,"div",10,11)(18,"div",12),dt(19,"span",13),A(20,"input",14,15),kn("ngModelChange",function(w){return An(d.searchText,w)||(d.searchText=w),w}),k(),A(22,"span",16),ct("click",function(){return d.search()}),dt(23,"i",17),k(),dt(24,"span",13),k(),A(25,"div",18)(26,"div",19),ct("click",function(){return d.onShoppingCartClick()}),A(27,"div",20),dt(28,"i",21),mt(29,zX,2,1,"span",22),k()(),A(30,"div",23)(31,"a",24),mt(32,NX,1,0,"i",25)(33,BX,2,1,"div",26),k(),A(34,"ul",27),mt(35,VX,3,0,"li",26)(36,jX,3,0,"li",26)(37,UX,3,0,"li",26)(38,HX,3,0,"li",26)(39,GX,3,0,"li",26),k()()()()()(),A(40,"div",28,29)(42,"div",30),mt(43,WX,5,7,"a",31),A(44,"button",32),ct("click",function(){return d.scrollToNext()}),dt(45,"i",33),k()()()(),mt(46,iK,9,6,"div",34)}s&2&&(N(20),In("ngModel",d.searchText),N(9),Z("ngIf",d.getIdentityService().isLoggedIn()&&d.shoppingCartSize>0),N(3),Z("ngIf",!d.getIdentityService().isLoggedIn()),N(),Z("ngIf",d.getIdentityService().isLoggedIn()),N(2),Z("ngIf",!d.getIdentityService().isLoggedIn()),N(),Z("ngIf",d.getIdentityService().isLoggedIn()),N(),Z("ngIf",d.getIdentityService().isLoggedIn()),N(),Z("ngIf",d.getIdentityService().isLoggedIn()),N(),Z("ngIf",d.getIdentityService().isLoggedIn()),N(4),Z("ngForOf",d.locationsToDisplay),N(3),Z("ngIf",d.showDropdown))},dependencies:[dy,cy,eg,ig,qe,Gl,uy,Ii,ar,Yi,en,ji,jo,pz,mz],styles:["a[_ngcontent-%COMP%]{color:#000}.locations-container[_ngcontent-%COMP%]{padding:1rem;gap:1rem}.spacer[_ngcontent-%COMP%]{width:15%}.margin-top[_ngcontent-%COMP%]{margin-top:4.5px}.card[_ngcontent-%COMP%]{padding:1rem;flex:1 0 calc(19% - 1rem);max-width:calc(19% - 1rem)}.img-fluid[_ngcontent-%COMP%]{object-fit:cover;max-height:80px}.next-button[_ngcontent-%COMP%]{width:50px}.search-dropdown[_ngcontent-%COMP%]{position:absolute;top:58px;left:10%;width:80%;background-color:#fff;z-index:100;box-shadow:0 0 10px #ccc;border-radius:5px;padding:1rem}.search-dropdown[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0}.search-dropdown[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{width:100%;padding:.5rem;border-bottom:1px solid #ccc}.search-dropdown[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{background-color:#f5f5f5;cursor:pointer}.dropdown-toggle[_ngcontent-%COMP%]:after{display:none}@media (max-width: 1303px){.card[_ngcontent-%COMP%]{flex-basis:calc(50% - 1rem);max-width:calc(50% - 1rem)}}@media (max-width: 991px){.search-dropdown[_ngcontent-%COMP%]{top:100px}input[_ngcontent-%COMP%]{margin-bottom:10px}.right-buttons[_ngcontent-%COMP%]{justify-content:right}.spacer[_ngcontent-%COMP%]{display:none}}@media (max-width: 576px){.card[_ngcontent-%COMP%]{flex-basis:100%;max-width:100%}.next-button[_ngcontent-%COMP%]{width:100%}}"]});let a=r;return a})();var $z=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=Et({type:r,selectors:[["app-footer"]],standalone:!0,features:[At],decls:76,vars:0,consts:[[1,"text-center","text-lg-start","bg-light","text-muted"],[1,"d-flex","justify-content-center","justify-content-lg-between","p-4","border-bottom"],[1,"me-5","d-none","d-lg-block"],["href","",1,"me-4","text-reset"],[1,"fab","fa-facebook-f"],[1,"fab","fa-twitter"],[1,"fab","fa-google"],[1,"fab","fa-instagram"],[1,"fab","fa-linkedin"],[1,"fab","fa-github"],[1,""],[1,"container","text-center","text-md-start","mt-5"],[1,"row","mt-3"],[1,"col-md-3","col-lg-4","col-xl-3","mx-auto","mb-4"],[1,"text-uppercase","fw-bold","mb-4"],[1,"fas","fa-gem","me-3"],[1,"col-md-2","col-lg-2","col-xl-2","mx-auto","mb-4"],["href","#!",1,"text-reset"],[1,"col-md-3","col-lg-2","col-xl-2","mx-auto","mb-4"],[1,"col-md-4","col-lg-3","col-xl-3","mx-auto","mb-md-0","mb-4"],[1,"fas","fa-home","me-3"],[1,"fas","fa-envelope","me-3"],[1,"fas","fa-phone","me-3"],[1,"fas","fa-print","me-3"],[1,"text-center","p-4",2,"background-color","rgba(0, 0, 0, 0.05)"],["href","https://mdbootstrap.com/",1,"text-reset","fw-bold"]],template:function(s,d){s&1&&(A(0,"footer",0)(1,"section",1)(2,"div",2)(3,"span"),V(4,"Get connected with us on social networks:"),k()(),A(5,"div")(6,"a",3),dt(7,"i",4),k(),A(8,"a",3),dt(9,"i",5),k(),A(10,"a",3),dt(11,"i",6),k(),A(12,"a",3),dt(13,"i",7),k(),A(14,"a",3),dt(15,"i",8),k(),A(16,"a",3),dt(17,"i",9),k()()(),A(18,"section",10)(19,"div",11)(20,"div",12)(21,"div",13)(22,"h6",14),dt(23,"i",15),V(24,"Company name "),k(),A(25,"p"),V(26," Here you can use rows and columns to organize your footer content. Lorem ipsum dolor sit amet, consectetur adipisicing elit. "),k()(),A(27,"div",16)(28,"h6",14),V(29," Products "),k(),A(30,"p")(31,"a",17),V(32,"Angular"),k()(),A(33,"p")(34,"a",17),V(35,"React"),k()(),A(36,"p")(37,"a",17),V(38,"Vue"),k()(),A(39,"p")(40,"a",17),V(41,"Laravel"),k()()(),A(42,"div",18)(43,"h6",14),V(44," Useful links "),k(),A(45,"p")(46,"a",17),V(47,"Pricing"),k()(),A(48,"p")(49,"a",17),V(50,"Settings"),k()(),A(51,"p")(52,"a",17),V(53,"Orders"),k()(),A(54,"p")(55,"a",17),V(56,"Help"),k()()(),A(57,"div",19)(58,"h6",14),V(59," Contact "),k(),A(60,"p"),dt(61,"i",20),V(62," New York, NY 10012, US"),k(),A(63,"p"),dt(64,"i",21),V(65," info@example.com "),k(),A(66,"p"),dt(67,"i",22),V(68," + 01 234 567 88"),k(),A(69,"p"),dt(70,"i",23),V(71," + 01 234 567 89"),k()()()()(),A(72,"div",24),V(73," \xA9 2024 Copyright: "),A(74,"a",25),V(75,"Bileteria"),k()()())}});let a=r;return a})();var Yz=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=Et({type:r,selectors:[["app-root"]],standalone:!0,features:[At],decls:5,vars:0,consts:[[1,"d-flex","flex-column","min-vh-100"],[1,"flex-grow-1","mt-3","mb-3"]],template:function(s,d){s&1&&(A(0,"div",0),dt(1,"app-header"),A(2,"main",1),dt(3,"router-outlet"),k(),dt(4,"app-footer"),k())},dependencies:[Wz,$z,cl],styles:[".d-flex[_ngcontent-%COMP%]{display:flex}.flex-column[_ngcontent-%COMP%]{flex-direction:column}.min-vh-100[_ngcontent-%COMP%]{min-height:100vh}.flex-grow-1[_ngcontent-%COMP%]{flex-grow:1}"]});let a=r;return a})();var Zz=["*"];function nK(a,r){if(a&1){let l=Ce();A(0,"button",7),ct("click",function(){let d=te(l).index,m=vt(2);return ee(m.to(d))}),k()}if(a&2){let l=r.index,n=vt(2);ei("active",l===n.activeSlide),oi("aria-current",l===n.activeSlide)}}function rK(a,r){if(a&1&&(A(0,"div",5),mt(1,nK,1,3,"button",6),k()),a&2){let l=vt();N(),Z("ngForOf",l.items)}}function oK(a,r){if(a&1){let l=Ce();A(0,"button",8),ct("click",function(){te(l);let s=vt();return ee(s.prev())}),dt(1,"span",9),A(2,"span",10),V(3,"Previous"),k()()}}function sK(a,r){if(a&1){let l=Ce();A(0,"button",11),ct("click",function(){te(l);let s=vt();return ee(s.next())}),dt(1,"span",12),A(2,"span",10),V(3,"Next"),k()()}}var CM=(()=>{class a{_elementRef;interval=null;carouselItem=!0;active=!1;next=!1;prev=!1;start=!1;end=!1;get host(){return this._elementRef.nativeElement}constructor(l){this._elementRef=l}static \u0275fac=function(n){return new(n||a)(B(Se))};static \u0275cmp=Et({type:a,selectors:[["mdb-carousel-item"]],hostVars:12,hostBindings:function(n,s){n&2&&ei("carousel-item",s.carouselItem)("active",s.active)("carousel-item-next",s.next)("carousel-item-prev",s.prev)("carousel-item-start",s.start)("carousel-item-end",s.end)},inputs:{interval:"interval"},ngContentSelectors:Zz,decls:1,vars:0,template:function(n,s){n&1&&(Nn(),Ti(0))},encapsulation:2})}return a})(),fl=function(a){return a[a.UNKNOWN=0]="UNKNOWN",a[a.NEXT=1]="NEXT",a[a.PREV=2]="PREV",a}(fl||{}),Xz=(()=>{class a{_elementRef;_cdRef;_items;get items(){return this._items&&this._items.toArray()}animation="slide";get controls(){return this._controls}set controls(l){this._controls=ro(l)}_controls=!1;get dark(){return this._dark}set dark(l){this._dark=ro(l)}_dark=!1;get indicators(){return this._indicators}set indicators(l){this._indicators=ro(l)}_indicators=!1;get ride(){return this._ride}set ride(l){this._ride=ro(l)}_ride=!0;get interval(){return this._interval}set interval(l){this._interval=l,this.items&&this._restartInterval()}_interval=5e3;keyboard=!0;pause=!0;wrap=!0;slide=new ye;slideChange=new ye;get activeSlide(){return this._activeSlide}set activeSlide(l){this.items.length&&this._activeSlide!==l&&(this._activeSlide=l,this._restartInterval())}_activeSlide=0;_lastInterval;_isPlaying=!1;_isSliding=!1;_destroy$=new pe;onMouseEnter(){this.pause&&this._isPlaying&&this.stop()}onMouseLeave(){this.pause&&!this._isPlaying&&this.play()}display=!0;constructor(l,n){this._elementRef=l,this._cdRef=n}ngAfterViewInit(){Promise.resolve().then(()=>{this._setActiveSlide(this._activeSlide),this.interval>0&&this.ride&&this.play(),this._cdRef.markForCheck()}),this.keyboard&&Po(this._elementRef.nativeElement,"keydown").pipe(ri(this._destroy$)).subscribe(l=>{l.key==="ArrowRight"?this.next():l.key==="ArrowLeft"&&this.prev()})}ngOnDestroy(){this._destroy$.next(),this._destroy$.complete()}_setActiveSlide(l){let n=this.items[this._activeSlide];n.active=!1;let s=this.items[l];s.active=!0,this._activeSlide=l}_restartInterval(){this._resetInterval();let l=this.items[this.activeSlide],n=l.interval?l.interval:this.interval;!isNaN(n)&&n>0&&(this._lastInterval=setInterval(()=>{let s=+n;this._isPlaying&&!isNaN(s)&&s>0?(this.next(),this._cdRef.markForCheck()):this.stop()},n))}_resetInterval(){this._lastInterval&&(clearInterval(this._lastInterval),this._lastInterval=null)}play(){this._isPlaying||(this._isPlaying=!0,this._restartInterval())}stop(){this._isPlaying&&(this._isPlaying=!1,this._resetInterval())}to(l){if(l>this.items.length-1||l<0)return;if(this.activeSlide===l){this.stop(),this.play();return}let n=l>this.activeSlide?fl.NEXT:fl.PREV;this._animateSlides(n,this.activeSlide,l),this.activeSlide=l}next(){this._isSliding||this._slide(fl.NEXT)}prev(){this._isSliding||this._slide(fl.PREV)}_slide(l){let n=this._activeSlide===0,s=this._activeSlide===this.items.length-1;if(!this.wrap&&(l===fl.NEXT&&s||l===fl.PREV&&n))return;let d=this._getNewSlideIndex(l);this._animateSlides(l,this.activeSlide,d),this.activeSlide=d,this.slide.emit()}_animateSlides(l,n,s){let d=this.items[n],m=this.items[s],_=d.host,w=m.host;if(this._isSliding=!0,this._isPlaying&&this.stop(),l===fl.NEXT){m.next=!0,setTimeout(()=>{this._reflow(w),d.start=!0,m.start=!0,this._cdRef.markForCheck()},0);let S=600;Po(_,"transitionend").pipe(Ji(1)).subscribe(()=>{m.next=!1,m.start=!1,m.active=!0,d.active=!1,d.start=!1,d.next=!1,this.slideChange.emit(),this._isSliding=!1}),this._emulateTransitionEnd(_,S)}else if(l===fl.PREV){m.prev=!0,setTimeout(()=>{this._reflow(w),d.end=!0,m.end=!0,this._cdRef.markForCheck()},0);let S=600;Po(_,"transitionend").pipe(Ji(1)).subscribe(()=>{m.prev=!1,m.end=!1,m.active=!0,d.active=!1,d.end=!1,d.prev=!1,this.slideChange.emit(),this._isSliding=!1}),this._emulateTransitionEnd(_,S)}!this._isPlaying&&this.interval>0&&this.play()}_reflow(l){return l.offsetHeight}_emulateTransitionEnd(l,n){let s=!1,m=n+5;Po(l,"transitionend").pipe(Ji(1)).subscribe(()=>{s=!0}),setTimeout(()=>{s||l.dispatchEvent(new Event("transitionend"))},m)}_getNewSlideIndex(l){let n;return l===fl.NEXT&&(n=this._getNextSlideIndex()),l===fl.PREV&&(n=this._getPrevSlideIndex()),n}_getNextSlideIndex(){let l=this._activeSlide===this.items.length-1;return l?this.wrap&&l?0:this._activeSlide:this._activeSlide+1}_getPrevSlideIndex(){let l=this._activeSlide===0;return l?this.wrap&&l?this.items.length-1:this._activeSlide:this._activeSlide-1}static ngAcceptInputType_controls;static ngAcceptInputType_dark;static ngAcceptInputType_indicators;static ngAcceptInputType_ride;static \u0275fac=function(n){return new(n||a)(B(Se),B(Wi))};static \u0275cmp=Et({type:a,selectors:[["mdb-carousel"]],contentQueries:function(n,s,d){if(n&1&&mn(d,CM,4),n&2){let m;ce(m=de())&&(s._items=m)}},hostVars:2,hostBindings:function(n,s){n&1&&ct("mouseenter",function(){return s.onMouseEnter()})("mouseleave",function(){return s.onMouseLeave()}),n&2&&ei("d-block",s.display)},inputs:{animation:"animation",controls:"controls",dark:"dark",indicators:"indicators",ride:"ride",interval:"interval",keyboard:"keyboard",pause:"pause",wrap:"wrap"},outputs:{slide:"slide",slideChange:"slideChange"},ngContentSelectors:Zz,decls:6,vars:7,consts:[[1,"carousel","slide"],["class","carousel-indicators",4,"ngIf"],[1,"carousel-inner"],["class","carousel-control-prev","type","button",3,"click",4,"ngIf"],["class","carousel-control-next","type","button",3,"click",4,"ngIf"],[1,"carousel-indicators"],["type","button",3,"active","click",4,"ngFor","ngForOf"],["type","button",3,"click"],["type","button",1,"carousel-control-prev",3,"click"],["aria-hidden","true",1,"carousel-control-prev-icon"],[1,"visually-hidden"],["type","button",1,"carousel-control-next",3,"click"],["aria-hidden","true",1,"carousel-control-next-icon"]],template:function(n,s){n&1&&(Nn(),A(0,"div",0),mt(1,rK,2,1,"div",1),A(2,"div",2),Ti(3),k(),mt(4,oK,4,0,"button",3)(5,sK,4,0,"button",4),k()),n&2&&(ei("carousel-fade",s.animation==="fade")("carousel-dark",s.dark),N(),Z("ngIf",s.indicators),N(3),Z("ngIf",s.controls),N(),Z("ngIf",s.controls))},dependencies:[Ii,qe],encapsulation:2,changeDetection:0})}return a})(),Kz=(()=>{class a{static \u0275fac=function(n){return new(n||a)};static \u0275mod=xi({type:a});static \u0275inj=wi({imports:[Lo]})}return a})();var Qz=(()=>{let r=class r{constructor(n,s){this.http=n,this.identityService=s,this.homeEventsSubject=new Ze({recommendedEvents:[],selectedEvents:[]})}setHomeEvents(n){this.homeEventsSubject.next(n)}getHomeEvents(){return this.homeEventsSubject.asObservable()}fetchHomeEvents(){return It(this,null,function*(){if(this.identityService.getToken())try{let s=yield Ve(this.http.get(Me+"/events/home",{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setHomeEvents(s)}catch(s){console.error("Error fetching recommended events",s)}else try{let s=yield Ve(this.http.get(Me+"/events/home"));this.setHomeEvents(s)}catch(s){console.error("Error fetching recommended events",s)}})}};r.\u0275fac=function(s){return new(s||r)(ht(Gi),ht(hi))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var cK=()=>["events"],dK=a=>({location:a});function uK(a,r){if(a&1&&(A(0,"mdb-carousel-item"),dt(1,"img",8),A(2,"div",9)(3,"h5"),V(4),k(),A(5,"p"),V(6),k()()()),a&2){let l=r.$implicit;N(),hs("src",l.imageUrl,Tr),N(),Z("routerLink",Nr(5,cK))("queryParams",Xi(6,dK,l.name)),N(2),De(l.name),N(2),De(l.address)}}function hK(a,r){if(a&1&&(A(0,"mdb-carousel",6),mt(1,uK,7,8,"mdb-carousel-item",7),k()),a&2){let l=vt();Z("animation","slide")("controls",!0)("interval",5e3)("indicators",!0),N(),Z("ngForOf",l.locations)}}var Jz=a=>["event",a],tN=a=>({id:a});function mK(a,r){if(a&1&&(A(0,"div",11),dt(1,"img",12),A(2,"div",13)(3,"p",14),V(4),k(),A(5,"p",14),V(6),k()()()),a&2){let l=r.$implicit;Z("routerLink",Xi(5,Jz,l.title))("queryParams",Xi(7,tN,l.id)),N(),hs("src",l.imageUrl,Tr),N(3),De(l.title),N(2),De(l.broadGenre.name)}}function pK(a,r){if(a&1&&(A(0,"div",10)(1,"h1",3),V(2,"Evenimente recomandate"),k(),A(3,"div",4),mt(4,mK,7,9,"div",5),k()()),a&2){let l=vt();N(4),Z("ngForOf",l.recommendedEvents)}}function fK(a,r){if(a&1&&(A(0,"div",11),dt(1,"img",12),A(2,"div",13)(3,"p",14),V(4),k(),A(5,"p",14),V(6),k()()()),a&2){let l=r.$implicit;Z("routerLink",Xi(5,Jz,l.title))("queryParams",Xi(7,tN,l.id)),N(),hs("src",l.imageUrl,Tr),N(3),De(l.title),N(2),De(l.broadGenre)}}var eN=(()=>{let r=class r{constructor(n,s,d){this.homeService=n,this.identityService=s,this.headerService=d,this.selectedEvents=[],this.recommendedEvents=[],this.locations=[]}ngOnInit(){return It(this,null,function*(){yield this.homeService.fetchHomeEvents(),this.homeEventsSubscription=this.homeService.getHomeEvents().subscribe(n=>{this.selectedEvents=n.selectedEvents,this.recommendedEvents=n.recommendedEvents}),this.locationSubscription=this.headerService.getLocations().subscribe(n=>{this.locations=n})})}ngOnDestroy(){this.homeEventsSubscription?.unsubscribe(),this.locationSubscription?.unsubscribe()}isLoggedIn(){return this.identityService.isLoggedIn()}};r.\u0275fac=function(s){return new(s||r)(B(Qz),B(hi),B(Sd))},r.\u0275cmp=Et({type:r,selectors:[["app-home"]],standalone:!0,features:[At],decls:7,vars:3,consts:[[1,"container-fluid"],[3,"animation","controls","interval","indicators",4,"ngIf"],["class","recommended-events",4,"ngIf"],[1,"text-center"],[1,"cards-container"],["class","card",3,"routerLink","queryParams",4,"ngFor","ngForOf"],[3,"animation","controls","interval","indicators"],[4,"ngFor","ngForOf"],["alt","First slide",1,"d-block","w-100",3,"src"],["role","button",1,"carousel-caption","d-none","d-md-block",3,"routerLink","queryParams"],[1,"recommended-events"],[1,"card",3,"routerLink","queryParams"],["alt","",1,"card-img-top",3,"src"],[1,"card-body"],[1,"card-text"]],template:function(s,d){s&1&&(A(0,"div",0),mt(1,hK,2,5,"mdb-carousel",1)(2,pK,5,1,"div",2),A(3,"h1",3),V(4,"Evenimente selectate"),k(),A(5,"div",4),mt(6,fK,7,9,"div",5),k()()),s&2&&(N(),Z("ngIf",d.locations.length),N(),Z("ngIf",d.isLoggedIn()),N(4),Z("ngForOf",d.selectedEvents))},dependencies:[Ii,qe,Kz,Xz,CM,ar],styles:[".cards-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:center;align-items:center}.card[_ngcontent-%COMP%]{margin:10px;padding:10px;border:1px solid #ccc;border-radius:5px;box-shadow:0 2px 3px #ccc;width:300px;text-align:center;background-color:#f8f8f8;cursor:pointer;transition:all .3s ease-in-out}.carousel[_ngcontent-%COMP%]{width:90%}.carousel-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:600px;object-fit:cover}"]});let a=r;return a})();var iN=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=Et({type:r,selectors:[["app-location"]],standalone:!0,features:[At],decls:2,vars:0,template:function(s,d){s&1&&(A(0,"p"),V(1,"location component"),k())}});let a=r;return a})();var SM=class{constructor(r){this._box=r,this._destroyed=new pe,this._resizeSubject=new pe,this._elementObservables=new Map,typeof ResizeObserver<"u"&&(this._resizeObserver=new ResizeObserver(l=>this._resizeSubject.next(l)))}observe(r){return this._elementObservables.has(r)||this._elementObservables.set(r,new ga(l=>{let n=this._resizeSubject.subscribe(l);return this._resizeObserver?.observe(r,{box:this._box}),()=>{this._resizeObserver?.unobserve(r),n.unsubscribe(),this._elementObservables.delete(r)}}).pipe(wn(l=>l.some(n=>n.target===r)),IS({bufferSize:1,refCount:!0}),ri(this._destroyed))),this._elementObservables.get(r)}destroy(){this._destroyed.next(),this._destroyed.complete(),this._resizeSubject.complete(),this._elementObservables.clear()}},nN=(()=>{let r=class r{constructor(){this._observers=new Map,this._ngZone=oe(ze),typeof ResizeObserver<"u"}ngOnDestroy(){for(let[,n]of this._observers)n.destroy();this._observers.clear(),typeof ResizeObserver<"u"}observe(n,s){let d=s?.box||"content-box";return this._observers.has(d)||this._observers.set(d,new SM(d)),this._observers.get(d).observe(n)}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var gK=["notch"],_K=["matFormFieldNotchedOutline",""],vK=["*"],yK=["textField"],bK=["iconPrefixContainer"],xK=["textPrefixContainer"];function wK(a,r){a&1&&dt(0,"span",16)}function CK(a,r){if(a&1&&(A(0,"label",14),Ti(1,1),mt(2,wK,1,0,"span",15),k()),a&2){let l=vt(2);Z("floating",l._shouldLabelFloat())("monitorResize",l._hasOutline())("id",l._labelId),oi("for",l._control.id),N(2),$i(2,!l.hideRequiredMarker&&l._control.required?2:-1)}}function SK(a,r){if(a&1&&mt(0,CK,3,5,"label",14),a&2){let l=vt();$i(0,l._hasFloatingLabel()?0:-1)}}function EK(a,r){a&1&&dt(0,"div",17)}function MK(a,r){}function DK(a,r){if(a&1&&mt(0,MK,0,0,"ng-template",9),a&2){vt(2);let l=Ir(1);Z("ngTemplateOutlet",l)}}function TK(a,r){if(a&1&&(A(0,"div",5),mt(1,DK,1,1,null,9),k()),a&2){let l=vt();Z("matFormFieldNotchedOutlineOpen",l._shouldLabelFloat()),N(),$i(1,l._forceDisplayInfixLabel()?-1:1)}}function IK(a,r){a&1&&(A(0,"div",18,19),Ti(2,2),k())}function AK(a,r){a&1&&(A(0,"div",20,21),Ti(2,3),k())}function kK(a,r){}function RK(a,r){if(a&1&&mt(0,kK,0,0,"ng-template",9),a&2){vt();let l=Ir(1);Z("ngTemplateOutlet",l)}}function PK(a,r){a&1&&(A(0,"div",22),Ti(1,4),k())}function OK(a,r){a&1&&(A(0,"div",23),Ti(1,5),k())}function FK(a,r){a&1&&dt(0,"div",12)}function LK(a,r){if(a&1&&(A(0,"div",24),Ti(1,6),k()),a&2){let l=vt();Z("@transitionMessages",l._subscriptAnimationState)}}function zK(a,r){if(a&1&&(A(0,"mat-hint",26),V(1),k()),a&2){let l=vt(2);Z("id",l._hintLabelId),N(),De(l.hintLabel)}}function NK(a,r){if(a&1&&(A(0,"div",25),mt(1,zK,2,2,"mat-hint",26),Ti(2,7),dt(3,"div",27),Ti(4,8),k()),a&2){let l=vt();Z("@transitionMessages",l._subscriptAnimationState),N(),$i(1,l.hintLabel?1:-1)}}var BK=["*",[["mat-label"]],[["","matPrefix",""],["","matIconPrefix",""]],[["","matTextPrefix",""]],[["","matTextSuffix",""]],[["","matSuffix",""],["","matIconSuffix",""]],[["mat-error"],["","matError",""]],[["mat-hint",3,"align","end"]],[["mat-hint","align","end"]]],VK=["*","mat-label","[matPrefix], [matIconPrefix]","[matTextPrefix]","[matTextSuffix]","[matSuffix], [matIconSuffix]","mat-error, [matError]","mat-hint:not([align='end'])","mat-hint[align='end']"],jy=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275dir=re({type:r,selectors:[["mat-label"]],standalone:!0});let a=r;return a})();var jK=new we("MatError");var UK=0,rN=(()=>{let r=class r{constructor(){this.align="start",this.id=`mat-mdc-hint-${UK++}`}};r.\u0275fac=function(s){return new(s||r)},r.\u0275dir=re({type:r,selectors:[["mat-hint"]],hostAttrs:[1,"mat-mdc-form-field-hint","mat-mdc-form-field-bottom-align"],hostVars:4,hostBindings:function(s,d){s&2&&(Rs("id",d.id),oi("align",null),ei("mat-mdc-form-field-hint-end",d.align==="end"))},inputs:{align:"align",id:"id"},standalone:!0});let a=r;return a})(),HK=new we("MatPrefix");var hN=new we("MatSuffix"),mN=(()=>{let r=class r{constructor(){this._isText=!1}set _isTextSelector(n){this._isText=!0}};r.\u0275fac=function(s){return new(s||r)},r.\u0275dir=re({type:r,selectors:[["","matSuffix",""],["","matIconSuffix",""],["","matTextSuffix",""]],inputs:{_isTextSelector:[Rt.None,"matTextSuffix","_isTextSelector"]},standalone:!0,features:[Ni([{provide:hN,useExisting:r}])]});let a=r;return a})(),pN=new we("FloatingLabelParent"),oN=(()=>{let r=class r{get floating(){return this._floating}set floating(n){this._floating=n,this.monitorResize&&this._handleResize()}get monitorResize(){return this._monitorResize}set monitorResize(n){this._monitorResize=n,this._monitorResize?this._subscribeToResize():this._resizeSubscription.unsubscribe()}constructor(n){this._elementRef=n,this._floating=!1,this._monitorResize=!1,this._resizeObserver=oe(nN),this._ngZone=oe(ze),this._parent=oe(pN),this._resizeSubscription=new nr}ngOnDestroy(){this._resizeSubscription.unsubscribe()}getWidth(){return GK(this._elementRef.nativeElement)}get element(){return this._elementRef.nativeElement}_handleResize(){setTimeout(()=>this._parent._handleLabelResized())}_subscribeToResize(){this._resizeSubscription.unsubscribe(),this._ngZone.runOutsideAngular(()=>{this._resizeSubscription=this._resizeObserver.observe(this._elementRef.nativeElement,{box:"border-box"}).subscribe(()=>this._handleResize())})}};r.\u0275fac=function(s){return new(s||r)(B(Se))},r.\u0275dir=re({type:r,selectors:[["label","matFormFieldFloatingLabel",""]],hostAttrs:[1,"mdc-floating-label","mat-mdc-floating-label"],hostVars:2,hostBindings:function(s,d){s&2&&ei("mdc-floating-label--float-above",d.floating)},inputs:{floating:"floating",monitorResize:"monitorResize"},standalone:!0});let a=r;return a})();function GK(a){let r=a;if(r.offsetParent!==null)return r.scrollWidth;let l=r.cloneNode(!0);l.style.setProperty("position","absolute"),l.style.setProperty("transform","translate(-9999px, -9999px)"),document.documentElement.appendChild(l);let n=l.scrollWidth;return l.remove(),n}var sN="mdc-line-ripple--active",Vy="mdc-line-ripple--deactivating",aN=(()=>{let r=class r{constructor(n,s){this._elementRef=n,this._handleTransitionEnd=d=>{let m=this._elementRef.nativeElement.classList,_=m.contains(Vy);d.propertyName==="opacity"&&_&&m.remove(sN,Vy)},s.runOutsideAngular(()=>{n.nativeElement.addEventListener("transitionend",this._handleTransitionEnd)})}activate(){let n=this._elementRef.nativeElement.classList;n.remove(Vy),n.add(sN)}deactivate(){this._elementRef.nativeElement.classList.add(Vy)}ngOnDestroy(){this._elementRef.nativeElement.removeEventListener("transitionend",this._handleTransitionEnd)}};r.\u0275fac=function(s){return new(s||r)(B(Se),B(ze))},r.\u0275dir=re({type:r,selectors:[["div","matFormFieldLineRipple",""]],hostAttrs:[1,"mdc-line-ripple"],standalone:!0});let a=r;return a})(),lN=(()=>{let r=class r{constructor(n,s){this._elementRef=n,this._ngZone=s,this.open=!1}ngAfterViewInit(){let n=this._elementRef.nativeElement.querySelector(".mdc-floating-label");n?(this._elementRef.nativeElement.classList.add("mdc-notched-outline--upgraded"),typeof requestAnimationFrame=="function"&&(n.style.transitionDuration="0s",this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>n.style.transitionDuration="")}))):this._elementRef.nativeElement.classList.add("mdc-notched-outline--no-label")}_setNotchWidth(n){!this.open||!n?this._notch.nativeElement.style.width="":this._notch.nativeElement.style.width=`calc(${n}px * var(--mat-mdc-form-field-floating-label-scale, 0.75) + 9px)`}};r.\u0275fac=function(s){return new(s||r)(B(Se),B(ze))},r.\u0275cmp=Et({type:r,selectors:[["div","matFormFieldNotchedOutline",""]],viewQuery:function(s,d){if(s&1&&Ge(gK,5),s&2){let m;ce(m=de())&&(d._notch=m.first)}},hostAttrs:[1,"mdc-notched-outline"],hostVars:2,hostBindings:function(s,d){s&2&&ei("mdc-notched-outline--notched",d.open)},inputs:{open:[Rt.None,"matFormFieldNotchedOutlineOpen","open"]},standalone:!0,features:[At],attrs:_K,ngContentSelectors:vK,decls:5,vars:0,consts:[[1,"mdc-notched-outline__leading"],[1,"mdc-notched-outline__notch"],["notch",""],[1,"mdc-notched-outline__trailing"]],template:function(s,d){s&1&&(Nn(),dt(0,"div",0),A(1,"div",1,2),Ti(3),k(),dt(4,"div",3))},encapsulation:2,changeDetection:0});let a=r;return a})(),qK={transitionMessages:Yr("transitionMessages",[Wn("enter",Ei({opacity:1,transform:"translateY(0%)"})),Sn("void => enter",[Ei({opacity:0,transform:"translateY(-5px)"}),Bn("300ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])},Tm=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275dir=re({type:r});let a=r;return a})();var Fu=new we("MatFormField"),WK=new we("MAT_FORM_FIELD_DEFAULT_OPTIONS"),cN=0,dN="fill",$K="auto",uN="fixed",YK="translateY(-50%)",Uy=(()=>{let r=class r{get hideRequiredMarker(){return this._hideRequiredMarker}set hideRequiredMarker(n){this._hideRequiredMarker=ro(n)}get floatLabel(){return this._floatLabel||this._defaults?.floatLabel||$K}set floatLabel(n){n!==this._floatLabel&&(this._floatLabel=n,this._changeDetectorRef.markForCheck())}get appearance(){return this._appearance}set appearance(n){let s=this._appearance,d=n||this._defaults?.appearance||dN;this._appearance=d,this._appearance==="outline"&&this._appearance!==s&&(this._needsOutlineLabelOffsetUpdateOnStable=!0)}get subscriptSizing(){return this._subscriptSizing||this._defaults?.subscriptSizing||uN}set subscriptSizing(n){this._subscriptSizing=n||this._defaults?.subscriptSizing||uN}get hintLabel(){return this._hintLabel}set hintLabel(n){this._hintLabel=n,this._processHints()}get _control(){return this._explicitFormFieldControl||this._formFieldControl}set _control(n){this._explicitFormFieldControl=n}constructor(n,s,d,m,_,w,S,T){this._elementRef=n,this._changeDetectorRef=s,this._ngZone=d,this._dir=m,this._platform=_,this._defaults=w,this._animationMode=S,this._hideRequiredMarker=!1,this.color="primary",this._appearance=dN,this._subscriptSizing=null,this._hintLabel="",this._hasIconPrefix=!1,this._hasTextPrefix=!1,this._hasIconSuffix=!1,this._hasTextSuffix=!1,this._labelId=`mat-mdc-form-field-label-${cN++}`,this._hintLabelId=`mat-mdc-hint-${cN++}`,this._subscriptAnimationState="",this._destroyed=new pe,this._isFocused=null,this._needsOutlineLabelOffsetUpdateOnStable=!1,w&&(w.appearance&&(this.appearance=w.appearance),this._hideRequiredMarker=!!w?.hideRequiredMarker,w.color&&(this.color=w.color))}ngAfterViewInit(){this._updateFocusState(),this._subscriptAnimationState="enter",this._changeDetectorRef.detectChanges()}ngAfterContentInit(){this._assertFormFieldControl(),this._initializeControl(),this._initializeSubscript(),this._initializePrefixAndSuffix(),this._initializeOutlineLabelOffsetSubscriptions()}ngAfterContentChecked(){this._assertFormFieldControl()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}getLabelId(){return this._hasFloatingLabel()?this._labelId:null}getConnectedOverlayOrigin(){return this._textField||this._elementRef}_animateAndLockLabel(){this._hasFloatingLabel()&&(this.floatLabel="always")}_initializeControl(){let n=this._control;n.controlType&&this._elementRef.nativeElement.classList.add(`mat-mdc-form-field-type-${n.controlType}`),n.stateChanges.subscribe(()=>{this._updateFocusState(),this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),n.ngControl&&n.ngControl.valueChanges&&n.ngControl.valueChanges.pipe(ri(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck())}_checkPrefixAndSuffixTypes(){this._hasIconPrefix=!!this._prefixChildren.find(n=>!n._isText),this._hasTextPrefix=!!this._prefixChildren.find(n=>n._isText),this._hasIconSuffix=!!this._suffixChildren.find(n=>!n._isText),this._hasTextSuffix=!!this._suffixChildren.find(n=>n._isText)}_initializePrefixAndSuffix(){this._checkPrefixAndSuffixTypes(),io(this._prefixChildren.changes,this._suffixChildren.changes).subscribe(()=>{this._checkPrefixAndSuffixTypes(),this._changeDetectorRef.markForCheck()})}_initializeSubscript(){this._hintChildren.changes.subscribe(()=>{this._processHints(),this._changeDetectorRef.markForCheck()}),this._errorChildren.changes.subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),this._validateHints(),this._syncDescribedByIds()}_assertFormFieldControl(){this._control}_updateFocusState(){this._control.focused&&!this._isFocused?(this._isFocused=!0,this._lineRipple?.activate()):!this._control.focused&&(this._isFocused||this._isFocused===null)&&(this._isFocused=!1,this._lineRipple?.deactivate()),this._textField?.nativeElement.classList.toggle("mdc-text-field--focused",this._control.focused)}_initializeOutlineLabelOffsetSubscriptions(){this._prefixChildren.changes.subscribe(()=>this._needsOutlineLabelOffsetUpdateOnStable=!0),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(ri(this._destroyed)).subscribe(()=>{this._needsOutlineLabelOffsetUpdateOnStable&&(this._needsOutlineLabelOffsetUpdateOnStable=!1,this._updateOutlineLabelOffset())})}),this._dir.change.pipe(ri(this._destroyed)).subscribe(()=>this._needsOutlineLabelOffsetUpdateOnStable=!0)}_shouldAlwaysFloat(){return this.floatLabel==="always"}_hasOutline(){return this.appearance==="outline"}_forceDisplayInfixLabel(){return!this._platform.isBrowser&&this._prefixChildren.length&&!this._shouldLabelFloat()}_hasFloatingLabel(){return!!this._labelChildNonStatic||!!this._labelChildStatic}_shouldLabelFloat(){return this._control.shouldLabelFloat||this._shouldAlwaysFloat()}_shouldForward(n){let s=this._control?this._control.ngControl:null;return s&&s[n]}_getDisplayedMessages(){return this._errorChildren&&this._errorChildren.length>0&&this._control.errorState?"error":"hint"}_handleLabelResized(){this._refreshOutlineNotchWidth()}_refreshOutlineNotchWidth(){!this._hasOutline()||!this._floatingLabel||!this._shouldLabelFloat()?this._notchedOutline?._setNotchWidth(0):this._notchedOutline?._setNotchWidth(this._floatingLabel.getWidth())}_processHints(){this._validateHints(),this._syncDescribedByIds()}_validateHints(){this._hintChildren}_syncDescribedByIds(){if(this._control){let n=[];if(this._control.userAriaDescribedBy&&typeof this._control.userAriaDescribedBy=="string"&&n.push(...this._control.userAriaDescribedBy.split(" ")),this._getDisplayedMessages()==="hint"){let s=this._hintChildren?this._hintChildren.find(m=>m.align==="start"):null,d=this._hintChildren?this._hintChildren.find(m=>m.align==="end"):null;s?n.push(s.id):this._hintLabel&&n.push(this._hintLabelId),d&&n.push(d.id)}else this._errorChildren&&n.push(...this._errorChildren.map(s=>s.id));this._control.setDescribedByIds(n)}}_updateOutlineLabelOffset(){if(!this._platform.isBrowser||!this._hasOutline()||!this._floatingLabel)return;let n=this._floatingLabel.element;if(!(this._iconPrefixContainer||this._textPrefixContainer)){n.style.transform="";return}if(!this._isAttachedToDom()){this._needsOutlineLabelOffsetUpdateOnStable=!0;return}let s=this._iconPrefixContainer?.nativeElement,d=this._textPrefixContainer?.nativeElement,m=s?.getBoundingClientRect().width??0,_=d?.getBoundingClientRect().width??0,w=this._dir.value==="rtl"?"-1":"1",S=`${m+_}px`,L=`calc(${w} * (${S} + var(--mat-mdc-form-field-label-offset-x, 0px)))`;n.style.transform=`var(
        --mat-mdc-form-field-label-transform,
        ${YK} translateX(${L})
    )`}_isAttachedToDom(){let n=this._elementRef.nativeElement;if(n.getRootNode){let s=n.getRootNode();return s&&s!==n}return document.documentElement.contains(n)}};r.\u0275fac=function(s){return new(s||r)(B(Se),B(Wi),B(ze),B(To),B(pn),B(WK,8),B(So,8),B(li))},r.\u0275cmp=Et({type:r,selectors:[["mat-form-field"]],contentQueries:function(s,d,m){if(s&1&&(mn(m,jy,5),mn(m,jy,7),mn(m,Tm,5),mn(m,HK,5),mn(m,hN,5),mn(m,jK,5),mn(m,rN,5)),s&2){let _;ce(_=de())&&(d._labelChildNonStatic=_.first),ce(_=de())&&(d._labelChildStatic=_.first),ce(_=de())&&(d._formFieldControl=_.first),ce(_=de())&&(d._prefixChildren=_),ce(_=de())&&(d._suffixChildren=_),ce(_=de())&&(d._errorChildren=_),ce(_=de())&&(d._hintChildren=_)}},viewQuery:function(s,d){if(s&1&&(Ge(yK,5),Ge(bK,5),Ge(xK,5),Ge(oN,5),Ge(lN,5),Ge(aN,5)),s&2){let m;ce(m=de())&&(d._textField=m.first),ce(m=de())&&(d._iconPrefixContainer=m.first),ce(m=de())&&(d._textPrefixContainer=m.first),ce(m=de())&&(d._floatingLabel=m.first),ce(m=de())&&(d._notchedOutline=m.first),ce(m=de())&&(d._lineRipple=m.first)}},hostAttrs:[1,"mat-mdc-form-field"],hostVars:42,hostBindings:function(s,d){s&2&&ei("mat-mdc-form-field-label-always-float",d._shouldAlwaysFloat())("mat-mdc-form-field-has-icon-prefix",d._hasIconPrefix)("mat-mdc-form-field-has-icon-suffix",d._hasIconSuffix)("mat-form-field-invalid",d._control.errorState)("mat-form-field-disabled",d._control.disabled)("mat-form-field-autofilled",d._control.autofilled)("mat-form-field-no-animations",d._animationMode==="NoopAnimations")("mat-form-field-appearance-fill",d.appearance=="fill")("mat-form-field-appearance-outline",d.appearance=="outline")("mat-form-field-hide-placeholder",d._hasFloatingLabel()&&!d._shouldLabelFloat())("mat-focused",d._control.focused)("mat-primary",d.color!=="accent"&&d.color!=="warn")("mat-accent",d.color==="accent")("mat-warn",d.color==="warn")("ng-untouched",d._shouldForward("untouched"))("ng-touched",d._shouldForward("touched"))("ng-pristine",d._shouldForward("pristine"))("ng-dirty",d._shouldForward("dirty"))("ng-valid",d._shouldForward("valid"))("ng-invalid",d._shouldForward("invalid"))("ng-pending",d._shouldForward("pending"))},inputs:{hideRequiredMarker:"hideRequiredMarker",color:"color",floatLabel:"floatLabel",appearance:"appearance",subscriptSizing:"subscriptSizing",hintLabel:"hintLabel"},exportAs:["matFormField"],standalone:!0,features:[Ni([{provide:Fu,useExisting:r},{provide:pN,useExisting:r}]),At],ngContentSelectors:VK,decls:18,vars:21,consts:[["labelTemplate",""],[1,"mat-mdc-text-field-wrapper","mdc-text-field",3,"click"],["textField",""],["class","mat-mdc-form-field-focus-overlay"],[1,"mat-mdc-form-field-flex"],["matFormFieldNotchedOutline","",3,"matFormFieldNotchedOutlineOpen"],["class","mat-mdc-form-field-icon-prefix"],["class","mat-mdc-form-field-text-prefix"],[1,"mat-mdc-form-field-infix"],[3,"ngTemplateOutlet"],["class","mat-mdc-form-field-text-suffix"],["class","mat-mdc-form-field-icon-suffix"],["matFormFieldLineRipple",""],[1,"mat-mdc-form-field-subscript-wrapper","mat-mdc-form-field-bottom-align"],["matFormFieldFloatingLabel","",3,"floating","monitorResize","id"],["aria-hidden","true","class","mat-mdc-form-field-required-marker mdc-floating-label--required"],["aria-hidden","true",1,"mat-mdc-form-field-required-marker","mdc-floating-label--required"],[1,"mat-mdc-form-field-focus-overlay"],[1,"mat-mdc-form-field-icon-prefix"],["iconPrefixContainer",""],[1,"mat-mdc-form-field-text-prefix"],["textPrefixContainer",""],[1,"mat-mdc-form-field-text-suffix"],[1,"mat-mdc-form-field-icon-suffix"],[1,"mat-mdc-form-field-error-wrapper"],[1,"mat-mdc-form-field-hint-wrapper"],[3,"id"],[1,"mat-mdc-form-field-hint-spacer"]],template:function(s,d){if(s&1&&(Nn(BK),mt(0,SK,1,1,"ng-template",null,0,Sv),A(2,"div",1,2),ct("click",function(_){return d._control.onContainerClick(_)}),mt(4,EK,1,0,"div",3),A(5,"div",4),mt(6,TK,2,2,"div",5)(7,IK,3,0,"div",6)(8,AK,3,0,"div",7),A(9,"div",8),mt(10,RK,1,1,null,9),Ti(11),k(),mt(12,PK,2,0,"div",10)(13,OK,2,0,"div",11),k(),mt(14,FK,1,0,"div",12),k(),A(15,"div",13),mt(16,LK,2,1)(17,NK,5,2),k()),s&2){let m;N(2),ei("mdc-text-field--filled",!d._hasOutline())("mdc-text-field--outlined",d._hasOutline())("mdc-text-field--no-label",!d._hasFloatingLabel())("mdc-text-field--disabled",d._control.disabled)("mdc-text-field--invalid",d._control.errorState),N(2),$i(4,!d._hasOutline()&&!d._control.disabled?4:-1),N(2),$i(6,d._hasOutline()?6:-1),N(),$i(7,d._hasIconPrefix?7:-1),N(),$i(8,d._hasTextPrefix?8:-1),N(2),$i(10,!d._hasOutline()||d._forceDisplayInfixLabel()?10:-1),N(2),$i(12,d._hasTextSuffix?12:-1),N(),$i(13,d._hasIconSuffix?13:-1),N(),$i(14,d._hasOutline()?-1:14),N(),ei("mat-mdc-form-field-subscript-dynamic-size",d.subscriptSizing==="dynamic"),N(),$i(16,(m=d._getDisplayedMessages())==="error"?16:m==="hint"?17:-1)}},dependencies:[oN,lN,rL,aN,rN],styles:['.mdc-text-field{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:0;border-bottom-left-radius:0;display:inline-flex;align-items:baseline;padding:0 16px;position:relative;box-sizing:border-box;overflow:hidden;will-change:opacity,transform,color}.mdc-text-field .mdc-floating-label{top:50%;transform:translateY(-50%);pointer-events:none}.mdc-text-field__input{height:28px;width:100%;min-width:0;border:none;border-radius:0;background:none;appearance:none;padding:0}.mdc-text-field__input::-ms-clear{display:none}.mdc-text-field__input::-webkit-calendar-picker-indicator{display:none}.mdc-text-field__input:focus{outline:none}.mdc-text-field__input:invalid{box-shadow:none}@media all{.mdc-text-field__input::placeholder{opacity:0}}@media all{.mdc-text-field__input:-ms-input-placeholder{opacity:0}}@media all{.mdc-text-field--no-label .mdc-text-field__input::placeholder,.mdc-text-field--focused .mdc-text-field__input::placeholder{opacity:1}}@media all{.mdc-text-field--no-label .mdc-text-field__input:-ms-input-placeholder,.mdc-text-field--focused .mdc-text-field__input:-ms-input-placeholder{opacity:1}}.mdc-text-field__affix{height:28px;opacity:0;white-space:nowrap}.mdc-text-field--label-floating .mdc-text-field__affix,.mdc-text-field--no-label .mdc-text-field__affix{opacity:1}@supports(-webkit-hyphens: none){.mdc-text-field--outlined .mdc-text-field__affix{align-items:center;align-self:center;display:inline-flex;height:100%}}.mdc-text-field__affix--prefix{padding-left:0;padding-right:2px}[dir=rtl] .mdc-text-field__affix--prefix,.mdc-text-field__affix--prefix[dir=rtl]{padding-left:2px;padding-right:0}.mdc-text-field--end-aligned .mdc-text-field__affix--prefix{padding-left:0;padding-right:12px}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__affix--prefix,.mdc-text-field--end-aligned .mdc-text-field__affix--prefix[dir=rtl]{padding-left:12px;padding-right:0}.mdc-text-field__affix--suffix{padding-left:12px;padding-right:0}[dir=rtl] .mdc-text-field__affix--suffix,.mdc-text-field__affix--suffix[dir=rtl]{padding-left:0;padding-right:12px}.mdc-text-field--end-aligned .mdc-text-field__affix--suffix{padding-left:2px;padding-right:0}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__affix--suffix,.mdc-text-field--end-aligned .mdc-text-field__affix--suffix[dir=rtl]{padding-left:0;padding-right:2px}.mdc-text-field--filled{height:56px}.mdc-text-field--filled::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}.mdc-text-field--filled .mdc-floating-label{left:16px;right:initial}[dir=rtl] .mdc-text-field--filled .mdc-floating-label,.mdc-text-field--filled .mdc-floating-label[dir=rtl]{left:initial;right:16px}.mdc-text-field--filled .mdc-floating-label--float-above{transform:translateY(-106%) scale(0.75)}.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__input{height:100%}.mdc-text-field--filled.mdc-text-field--no-label .mdc-floating-label{display:none}.mdc-text-field--filled.mdc-text-field--no-label::before{display:none}@supports(-webkit-hyphens: none){.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__affix{align-items:center;align-self:center;display:inline-flex;height:100%}}.mdc-text-field--outlined{height:56px;overflow:visible}.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-37.25px) scale(1)}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-34.75px) scale(0.75)}.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--outlined .mdc-text-field__input{height:100%}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:4px;border-bottom-left-radius:var(--mdc-shape-small, 4px)}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading[dir=rtl]{border-top-left-radius:0;border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:4px;border-bottom-right-radius:var(--mdc-shape-small, 4px);border-bottom-left-radius:0}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{width:max(12px,var(--mdc-shape-small, 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__notch{max-width:calc(100% - max(12px,var(--mdc-shape-small, 4px))*2)}}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing{border-top-left-radius:0;border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:4px;border-bottom-right-radius:var(--mdc-shape-small, 4px);border-bottom-left-radius:0}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing[dir=rtl]{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:4px;border-bottom-left-radius:var(--mdc-shape-small, 4px)}@supports(top: max(0%)){.mdc-text-field--outlined{padding-left:max(16px,calc(var(--mdc-shape-small, 4px) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined{padding-right:max(16px,var(--mdc-shape-small, 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-left:max(16px,calc(var(--mdc-shape-small, 4px) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-right:max(16px,var(--mdc-shape-small, 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-left:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-right:max(16px,var(--mdc-shape-small, 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-right:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:max(16px,var(--mdc-shape-small, 4px))}}.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-right:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-left:max(16px,calc(var(--mdc-shape-small, 4px) + 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-right:max(16px,calc(var(--mdc-shape-small, 4px) + 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:1px}.mdc-text-field--outlined .mdc-floating-label{left:4px;right:initial}[dir=rtl] .mdc-text-field--outlined .mdc-floating-label,.mdc-text-field--outlined .mdc-floating-label[dir=rtl]{left:initial;right:4px}.mdc-text-field--outlined .mdc-text-field__input{display:flex;border:none !important;background-color:rgba(0,0,0,0)}.mdc-text-field--outlined .mdc-notched-outline{z-index:1}.mdc-text-field--textarea{flex-direction:column;align-items:center;width:auto;height:auto;padding:0}.mdc-text-field--textarea .mdc-floating-label{top:19px}.mdc-text-field--textarea .mdc-floating-label:not(.mdc-floating-label--float-above){transform:none}.mdc-text-field--textarea .mdc-text-field__input{flex-grow:1;height:auto;min-height:1.5rem;overflow-x:hidden;overflow-y:auto;box-sizing:border-box;resize:none;padding:0 16px}.mdc-text-field--textarea.mdc-text-field--filled::before{display:none}.mdc-text-field--textarea.mdc-text-field--filled .mdc-floating-label--float-above{transform:translateY(-10.25px) scale(0.75)}.mdc-text-field--textarea.mdc-text-field--filled .mdc-text-field__input{margin-top:23px;margin-bottom:9px}.mdc-text-field--textarea.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__input{margin-top:16px;margin-bottom:16px}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:0}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-27.25px) scale(1)}.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-24.75px) scale(0.75)}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-text-field__input{margin-top:16px;margin-bottom:16px}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label{top:18px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field__input{margin-bottom:2px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter{align-self:flex-end;padding:0 16px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter::after{display:inline-block;width:0;height:16px;content:"";vertical-align:-16px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter::before{display:none}.mdc-text-field__resizer{align-self:stretch;display:inline-flex;flex-direction:column;flex-grow:1;max-height:100%;max-width:100%;min-height:56px;min-width:fit-content;min-width:-moz-available;min-width:-webkit-fill-available;overflow:hidden;resize:both}.mdc-text-field--filled .mdc-text-field__resizer{transform:translateY(-1px)}.mdc-text-field--filled .mdc-text-field__resizer .mdc-text-field__input,.mdc-text-field--filled .mdc-text-field__resizer .mdc-text-field-character-counter{transform:translateY(1px)}.mdc-text-field--outlined .mdc-text-field__resizer{transform:translateX(-1px) translateY(-1px)}[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer,.mdc-text-field--outlined .mdc-text-field__resizer[dir=rtl]{transform:translateX(1px) translateY(-1px)}.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input,.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter{transform:translateX(1px) translateY(1px)}[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input,[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter,.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input[dir=rtl],.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter[dir=rtl]{transform:translateX(-1px) translateY(1px)}.mdc-text-field--with-leading-icon{padding-left:0;padding-right:16px}[dir=rtl] .mdc-text-field--with-leading-icon,.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:16px;padding-right:0}.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 48px);left:48px;right:initial}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label,.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label[dir=rtl]{left:initial;right:48px}.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100%/0.75 - 64px/0.75)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label{left:36px;right:initial}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label[dir=rtl]{left:initial;right:36px}.mdc-text-field--with-leading-icon.mdc-text-field--outlined :not(.mdc-notched-outline--notched) .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-37.25px) translateX(-32px) scale(1)}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above[dir=rtl]{transform:translateY(-37.25px) translateX(32px) scale(1)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-34.75px) translateX(-32px) scale(0.75)}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above[dir=rtl],.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above[dir=rtl]{transform:translateY(-34.75px) translateX(32px) scale(0.75)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--with-trailing-icon{padding-left:16px;padding-right:0}[dir=rtl] .mdc-text-field--with-trailing-icon,.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0;padding-right:16px}.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 64px)}.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100%/0.75 - 64px/0.75)}.mdc-text-field--with-trailing-icon.mdc-text-field--outlined :not(.mdc-notched-outline--notched) .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 96px)}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100%/0.75 - 96px/0.75)}.mdc-text-field-helper-line{display:flex;justify-content:space-between;box-sizing:border-box}.mdc-text-field+.mdc-text-field-helper-line{padding-right:16px;padding-left:16px}.mdc-form-field>.mdc-text-field+label{align-self:flex-start}.mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--focused .mdc-notched-outline__trailing{border-width:2px}.mdc-text-field--focused+.mdc-text-field-helper-line .mdc-text-field-helper-text:not(.mdc-text-field-helper-text--validation-msg){opacity:1}.mdc-text-field--focused.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:2px}.mdc-text-field--focused.mdc-text-field--outlined.mdc-text-field--textarea .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:0}.mdc-text-field--invalid+.mdc-text-field-helper-line .mdc-text-field-helper-text--validation-msg{opacity:1}.mdc-text-field--disabled{pointer-events:none}@media screen and (forced-colors: active){.mdc-text-field--disabled .mdc-text-field__input{background-color:Window}.mdc-text-field--disabled .mdc-floating-label{z-index:1}}.mdc-text-field--disabled .mdc-floating-label{cursor:default}.mdc-text-field--disabled.mdc-text-field--filled .mdc-text-field__ripple{display:none}.mdc-text-field--disabled .mdc-text-field__input{pointer-events:auto}.mdc-text-field--end-aligned .mdc-text-field__input{text-align:right}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__input,.mdc-text-field--end-aligned .mdc-text-field__input[dir=rtl]{text-align:left}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__input,[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__input,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix{direction:ltr}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--prefix{padding-left:0;padding-right:2px}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--suffix{padding-left:12px;padding-right:0}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__icon--leading,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__icon--leading{order:1}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--suffix{order:2}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__input,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__input{order:3}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--prefix{order:4}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__icon--trailing,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__icon--trailing{order:5}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__input,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__input{text-align:right}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__affix--prefix{padding-right:12px}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__affix--suffix{padding-left:2px}.mdc-floating-label{position:absolute;left:0;-webkit-transform-origin:left top;transform-origin:left top;line-height:1.15rem;text-align:left;text-overflow:ellipsis;white-space:nowrap;cursor:text;overflow:hidden;will-change:transform}[dir=rtl] .mdc-floating-label,.mdc-floating-label[dir=rtl]{right:0;left:auto;-webkit-transform-origin:right top;transform-origin:right top;text-align:right}.mdc-floating-label--float-above{cursor:auto}.mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after{margin-left:1px;margin-right:0px;content:"*"}[dir=rtl] .mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after,.mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)[dir=rtl]::after{margin-left:0;margin-right:1px}.mdc-notched-outline{display:flex;position:absolute;top:0;right:0;left:0;box-sizing:border-box;width:100%;max-width:100%;height:100%;text-align:left;pointer-events:none}[dir=rtl] .mdc-notched-outline,.mdc-notched-outline[dir=rtl]{text-align:right}.mdc-notched-outline__leading,.mdc-notched-outline__notch,.mdc-notched-outline__trailing{box-sizing:border-box;height:100%;pointer-events:none}.mdc-notched-outline__trailing{flex-grow:1}.mdc-notched-outline__notch{flex:0 0 auto;width:auto}.mdc-notched-outline .mdc-floating-label{display:inline-block;position:relative;max-width:100%}.mdc-notched-outline .mdc-floating-label--float-above{text-overflow:clip}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:133.3333333333%}.mdc-notched-outline--notched .mdc-notched-outline__notch{padding-left:0;padding-right:8px;border-top:none}[dir=rtl] .mdc-notched-outline--notched .mdc-notched-outline__notch,.mdc-notched-outline--notched .mdc-notched-outline__notch[dir=rtl]{padding-left:8px;padding-right:0}.mdc-notched-outline--no-label .mdc-notched-outline__notch{display:none}.mdc-line-ripple::before,.mdc-line-ripple::after{position:absolute;bottom:0;left:0;width:100%;border-bottom-style:solid;content:""}.mdc-line-ripple::before{z-index:1}.mdc-line-ripple::after{transform:scaleX(0);opacity:0;z-index:2}.mdc-line-ripple--active::after{transform:scaleX(1);opacity:1}.mdc-line-ripple--deactivating::after{opacity:0}.mdc-floating-label--float-above{transform:translateY(-106%) scale(0.75)}.mdc-notched-outline__leading,.mdc-notched-outline__notch,.mdc-notched-outline__trailing{border-top:1px solid;border-bottom:1px solid}.mdc-notched-outline__leading{border-left:1px solid;border-right:none;width:12px}[dir=rtl] .mdc-notched-outline__leading,.mdc-notched-outline__leading[dir=rtl]{border-left:none;border-right:1px solid}.mdc-notched-outline__trailing{border-left:none;border-right:1px solid}[dir=rtl] .mdc-notched-outline__trailing,.mdc-notched-outline__trailing[dir=rtl]{border-left:1px solid;border-right:none}.mdc-notched-outline__notch{max-width:calc(100% - 12px*2)}.mdc-line-ripple::before{border-bottom-width:1px}.mdc-line-ripple::after{border-bottom-width:2px}.mdc-text-field--filled{border-top-left-radius:var(--mdc-filled-text-field-container-shape);border-top-right-radius:var(--mdc-filled-text-field-container-shape);border-bottom-right-radius:0;border-bottom-left-radius:0}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-filled-text-field-caret-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-filled-text-field-error-caret-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-filled-text-field-input-text-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-filled-text-field-disabled-input-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-label-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-focus-label-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label,.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-hover-label-text-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--disabled .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-disabled-label-text-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-error-label-text-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-error-focus-label-text-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-error-hover-label-text-color)}.mdc-text-field--filled .mdc-floating-label{font-family:var(--mdc-filled-text-field-label-text-font);font-size:var(--mdc-filled-text-field-label-text-size);font-weight:var(--mdc-filled-text-field-label-text-weight);letter-spacing:var(--mdc-filled-text-field-label-text-tracking)}@media all{.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color)}}@media all{.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color)}}.mdc-text-field--filled:not(.mdc-text-field--disabled){background-color:var(--mdc-filled-text-field-container-color)}.mdc-text-field--filled.mdc-text-field--disabled{background-color:var(--mdc-filled-text-field-disabled-container-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-active-indicator-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-hover-active-indicator-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-focus-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-disabled-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-hover-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-error-focus-active-indicator-color)}.mdc-text-field--filled .mdc-line-ripple::before{border-bottom-width:var(--mdc-filled-text-field-active-indicator-height)}.mdc-text-field--filled .mdc-line-ripple::after{border-bottom-width:var(--mdc-filled-text-field-focus-active-indicator-height)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-outlined-text-field-caret-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-outlined-text-field-error-caret-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-outlined-text-field-input-text-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-outlined-text-field-disabled-input-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-label-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-focus-label-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label,.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-hover-label-text-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-disabled-label-text-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-error-label-text-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-error-focus-label-text-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-error-hover-label-text-color)}.mdc-text-field--outlined .mdc-floating-label{font-family:var(--mdc-outlined-text-field-label-text-font);font-size:var(--mdc-outlined-text-field-label-text-size);font-weight:var(--mdc-outlined-text-field-label-text-weight);letter-spacing:var(--mdc-outlined-text-field-label-text-tracking)}@media all{.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color)}}@media all{.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color)}}.mdc-text-field--outlined.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:calc(.75*var(--mdc-outlined-text-field-label-text-size))}.mdc-text-field--outlined.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:var(--mdc-outlined-text-field-label-text-size)}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{border-top-left-radius:var(--mdc-outlined-text-field-container-shape);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape)}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading[dir=rtl]{border-top-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-left-radius:0}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{width:max(12px,var(--mdc-outlined-text-field-container-shape))}}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__notch{max-width:calc(100% - max(12px,var(--mdc-outlined-text-field-container-shape))*2)}}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing{border-top-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-left-radius:0}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing[dir=rtl]{border-top-left-radius:var(--mdc-outlined-text-field-container-shape);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape)}@supports(top: max(0%)){.mdc-text-field--outlined{padding-left:max(16px,calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined{padding-right:max(16px,var(--mdc-outlined-text-field-container-shape))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-left:max(16px,calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-right:max(16px,var(--mdc-outlined-text-field-container-shape))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-left:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-right:max(16px,var(--mdc-outlined-text-field-container-shape))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-right:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:max(16px,var(--mdc-outlined-text-field-container-shape))}}.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-right:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-left:max(16px,calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-right:max(16px,calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-hover-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-focus-outline-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-disabled-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-hover-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-focus-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__trailing{border-width:var(--mdc-outlined-text-field-outline-width)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__trailing{border-width:var(--mdc-outlined-text-field-focus-outline-width)}.mat-mdc-form-field-textarea-control{vertical-align:middle;resize:vertical;box-sizing:border-box;height:auto;margin:0;padding:0;border:none;overflow:auto}.mat-mdc-form-field-input-control.mat-mdc-form-field-input-control{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:inherit;letter-spacing:inherit;text-decoration:inherit;text-transform:inherit;border:none}.mat-mdc-form-field .mat-mdc-floating-label.mdc-floating-label{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;line-height:normal;pointer-events:all}.mat-mdc-form-field:not(.mat-form-field-disabled) .mat-mdc-floating-label.mdc-floating-label{cursor:inherit}.mdc-text-field--no-label:not(.mdc-text-field--textarea) .mat-mdc-form-field-input-control.mdc-text-field__input,.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control{height:auto}.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control.mdc-text-field__input[type=color]{height:23px}.mat-mdc-text-field-wrapper{height:auto;flex:auto}.mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-left:0;--mat-mdc-form-field-label-offset-x: -16px}.mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-right:0}[dir=rtl] .mat-mdc-text-field-wrapper{padding-left:16px;padding-right:16px}[dir=rtl] .mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-left:0}[dir=rtl] .mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-right:0}.mat-form-field-disabled .mdc-text-field__input::placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input::-moz-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input::-webkit-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input:-ms-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-mdc-form-field-label-always-float .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms;opacity:1}.mat-mdc-text-field-wrapper .mat-mdc-form-field-infix .mat-mdc-floating-label{left:auto;right:auto}.mat-mdc-text-field-wrapper.mdc-text-field--outlined .mdc-text-field__input{display:inline-block}.mat-mdc-form-field .mat-mdc-text-field-wrapper.mdc-text-field .mdc-notched-outline__notch{padding-top:0}.mat-mdc-text-field-wrapper::before{content:none}.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field .mdc-notched-outline__notch{border-left:1px solid rgba(0,0,0,0)}[dir=rtl] .mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field .mdc-notched-outline__notch{border-left:none;border-right:1px solid rgba(0,0,0,0)}.mat-mdc-form-field-infix{min-height:var(--mat-form-field-container-height);padding-top:var(--mat-form-field-filled-with-label-container-padding-top);padding-bottom:var(--mat-form-field-filled-with-label-container-padding-bottom)}.mdc-text-field--outlined .mat-mdc-form-field-infix,.mdc-text-field--no-label .mat-mdc-form-field-infix{padding-top:var(--mat-form-field-container-vertical-padding);padding-bottom:var(--mat-form-field-container-vertical-padding)}.mat-mdc-text-field-wrapper .mat-mdc-form-field-flex .mat-mdc-floating-label{top:calc(var(--mat-form-field-container-height)/2)}.mdc-text-field--filled .mat-mdc-floating-label{display:var(--mat-form-field-filled-label-display, block)}.mat-mdc-text-field-wrapper.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{--mat-mdc-form-field-label-transform: translateY(calc(calc(6.75px + var(--mat-form-field-container-height) / 2) * -1)) scale(var(--mat-mdc-form-field-floating-label-scale, 0.75));transform:var(--mat-mdc-form-field-label-transform)}.mat-mdc-form-field-subscript-wrapper{box-sizing:border-box;width:100%;position:relative}.mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-error-wrapper{position:absolute;top:0;left:0;right:0;padding:0 16px}.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-error-wrapper{position:static}.mat-mdc-form-field-bottom-align::before{content:"";display:inline-block;height:16px}.mat-mdc-form-field-bottom-align.mat-mdc-form-field-subscript-dynamic-size::before{content:unset}.mat-mdc-form-field-hint-end{order:1}.mat-mdc-form-field-hint-wrapper{display:flex}.mat-mdc-form-field-hint-spacer{flex:1 0 1em}.mat-mdc-form-field-error{display:block;color:var(--mat-form-field-error-text-color)}.mat-mdc-form-field-subscript-wrapper,.mat-mdc-form-field-bottom-align::before{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-form-field-subscript-text-font);line-height:var(--mat-form-field-subscript-text-line-height);font-size:var(--mat-form-field-subscript-text-size);letter-spacing:var(--mat-form-field-subscript-text-tracking);font-weight:var(--mat-form-field-subscript-text-weight)}.mat-mdc-form-field-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;opacity:0;pointer-events:none;background-color:var(--mat-form-field-state-layer-color)}.mat-mdc-text-field-wrapper:hover .mat-mdc-form-field-focus-overlay{opacity:var(--mat-form-field-hover-state-layer-opacity)}.mat-mdc-form-field.mat-focused .mat-mdc-form-field-focus-overlay{opacity:var(--mat-form-field-focus-state-layer-opacity)}select.mat-mdc-form-field-input-control{-moz-appearance:none;-webkit-appearance:none;background-color:rgba(0,0,0,0);display:inline-flex;box-sizing:border-box}select.mat-mdc-form-field-input-control:not(:disabled){cursor:pointer}select.mat-mdc-form-field-input-control:not(.mat-mdc-native-select-inline) option{color:var(--mat-form-field-select-option-text-color)}select.mat-mdc-form-field-input-control:not(.mat-mdc-native-select-inline) option:disabled{color:var(--mat-form-field-select-disabled-option-text-color)}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{content:"";width:0;height:0;border-left:5px solid rgba(0,0,0,0);border-right:5px solid rgba(0,0,0,0);border-top:5px solid;position:absolute;right:0;top:50%;margin-top:-2.5px;pointer-events:none;color:var(--mat-form-field-enabled-select-arrow-color)}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{right:auto;left:0}.mat-mdc-form-field-type-mat-native-select.mat-focused .mat-mdc-form-field-infix::after{color:var(--mat-form-field-focus-select-arrow-color)}.mat-mdc-form-field-type-mat-native-select.mat-form-field-disabled .mat-mdc-form-field-infix::after{color:var(--mat-form-field-disabled-select-arrow-color)}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:15px}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:0;padding-left:15px}.cdk-high-contrast-active .mat-form-field-appearance-fill .mat-mdc-text-field-wrapper{outline:solid 1px}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-form-field-disabled .mat-mdc-text-field-wrapper{outline-color:GrayText}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-focused .mat-mdc-text-field-wrapper{outline:dashed 3px}.cdk-high-contrast-active .mat-mdc-form-field.mat-focused .mdc-notched-outline{border:dashed 3px}.mat-mdc-form-field-input-control[type=date],.mat-mdc-form-field-input-control[type=datetime],.mat-mdc-form-field-input-control[type=datetime-local],.mat-mdc-form-field-input-control[type=month],.mat-mdc-form-field-input-control[type=week],.mat-mdc-form-field-input-control[type=time]{line-height:1}.mat-mdc-form-field-input-control::-webkit-datetime-edit{line-height:1;padding:0;margin-bottom:-2px}.mat-mdc-form-field{--mat-mdc-form-field-floating-label-scale: 0.75;display:inline-flex;flex-direction:column;min-width:0;text-align:left;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-form-field-container-text-font);line-height:var(--mat-form-field-container-text-line-height);font-size:var(--mat-form-field-container-text-size);letter-spacing:var(--mat-form-field-container-text-tracking);font-weight:var(--mat-form-field-container-text-weight)}[dir=rtl] .mat-mdc-form-field{text-align:right}.mat-mdc-form-field .mdc-text-field--outlined .mdc-floating-label--float-above{font-size:calc(var(--mat-form-field-outlined-label-text-populated-size)*var(--mat-mdc-form-field-floating-label-scale))}.mat-mdc-form-field .mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:var(--mat-form-field-outlined-label-text-populated-size)}.mat-mdc-form-field-flex{display:inline-flex;align-items:baseline;box-sizing:border-box;width:100%}.mat-mdc-text-field-wrapper{width:100%}.mat-mdc-form-field-icon-prefix,.mat-mdc-form-field-icon-suffix{align-self:center;line-height:0;pointer-events:auto;position:relative;z-index:1}.mat-mdc-form-field-icon-prefix>.mat-icon,.mat-mdc-form-field-icon-suffix>.mat-icon{padding:0 12px;box-sizing:content-box}.mat-mdc-form-field-icon-prefix{color:var(--mat-form-field-leading-icon-color)}.mat-form-field-disabled .mat-mdc-form-field-icon-prefix{color:var(--mat-form-field-disabled-leading-icon-color)}.mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-trailing-icon-color)}.mat-form-field-disabled .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-disabled-trailing-icon-color)}.mat-form-field-invalid .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-trailing-icon-color)}.mat-form-field-invalid:not(.mat-focused):not(.mat-form-field-disabled) .mat-mdc-text-field-wrapper:hover .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-hover-trailing-icon-color)}.mat-form-field-invalid.mat-focused .mat-mdc-text-field-wrapper .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-focus-trailing-icon-color)}.mat-mdc-form-field-icon-prefix,[dir=rtl] .mat-mdc-form-field-icon-suffix{padding:0 4px 0 0}.mat-mdc-form-field-icon-suffix,[dir=rtl] .mat-mdc-form-field-icon-prefix{padding:0 0 0 4px}.mat-mdc-form-field-subscript-wrapper .mat-icon,.mat-mdc-form-field label .mat-icon{width:1em;height:1em;font-size:inherit}.mat-mdc-form-field-infix{flex:auto;min-width:0;width:180px;position:relative;box-sizing:border-box}.mat-mdc-form-field .mdc-notched-outline__notch{margin-left:-1px;-webkit-clip-path:inset(-9em -999em -9em 1px);clip-path:inset(-9em -999em -9em 1px)}[dir=rtl] .mat-mdc-form-field .mdc-notched-outline__notch{margin-left:0;margin-right:-1px;-webkit-clip-path:inset(-9em 1px -9em -999em);clip-path:inset(-9em 1px -9em -999em)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input{transition:opacity 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}@media all{.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder{transition:opacity 67ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}}@media all{.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder{transition:opacity 67ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}}@media all{.mdc-text-field--no-label .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder,.mdc-text-field--focused .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms}}@media all{.mdc-text-field--no-label .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder,.mdc-text-field--focused .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder{transition-delay:40ms;transition-duration:110ms}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__affix{transition:opacity 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--filled.mdc-ripple-upgraded--background-focused .mdc-text-field__ripple::before,.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--filled:not(.mdc-ripple-upgraded):focus .mdc-text-field__ripple::before{transition-duration:75ms}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea{transition:none}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea.mdc-text-field--filled .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-textarea-filled 250ms 1}@keyframes mdc-floating-label-shake-float-above-textarea-filled{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-textarea-outlined 250ms 1}@keyframes mdc-floating-label-shake-float-above-textarea-outlined{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined-leading-icon 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined-leading-icon{0%{transform:translateX(calc(0% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}}[dir=rtl] .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--shake,.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined[dir=rtl] .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined-leading-icon 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined-leading-icon-rtl{0%{transform:translateX(calc(0% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-floating-label{transition:transform 150ms cubic-bezier(0.4, 0, 0.2, 1),color 150ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-standard 250ms 1}@keyframes mdc-floating-label-shake-float-above-standard{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-line-ripple::after{transition:transform 180ms cubic-bezier(0.4, 0, 0.2, 1),opacity 180ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-notched-outline .mdc-floating-label{max-width:calc(100% + 1px)}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:calc(133.3333333333% + 1px)}'],encapsulation:2,data:{animation:[qK.transitionMessages]},changeDetection:0});let a=r;return a})();var fN=es({passive:!0}),Hy=(()=>{let r=class r{constructor(n,s){this._platform=n,this._ngZone=s,this._monitoredElements=new Map}monitor(n){if(!this._platform.isBrowser)return yc;let s=Os(n),d=this._monitoredElements.get(s);if(d)return d.subject;let m=new pe,_="cdk-text-field-autofilled",w=S=>{S.animationName==="cdk-text-field-autofill-start"&&!s.classList.contains(_)?(s.classList.add(_),this._ngZone.run(()=>m.next({target:S.target,isAutofilled:!0}))):S.animationName==="cdk-text-field-autofill-end"&&s.classList.contains(_)&&(s.classList.remove(_),this._ngZone.run(()=>m.next({target:S.target,isAutofilled:!1})))};return this._ngZone.runOutsideAngular(()=>{s.addEventListener("animationstart",w,fN),s.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(s,{subject:m,unlisten:()=>{s.removeEventListener("animationstart",w,fN)}}),m}stopMonitoring(n){let s=Os(n),d=this._monitoredElements.get(s);d&&(d.unlisten(),d.subject.complete(),s.classList.remove("cdk-text-field-autofill-monitored"),s.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(s))}ngOnDestroy(){this._monitoredElements.forEach((n,s)=>this.stopMonitoring(s))}};r.\u0275fac=function(s){return new(s||r)(ht(pn),ht(ze))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var EM=new we("MAT_INPUT_VALUE_ACCESSOR"),XK=["button","checkbox","file","hidden","image","radio","range","reset","submit"],KK=0,_N=(()=>{let r=class r{get disabled(){return this._disabled}set disabled(n){this._disabled=ro(n),this.focused&&(this.focused=!1,this.stateChanges.next())}get id(){return this._id}set id(n){this._id=n||this._uid}get required(){return this._required??this.ngControl?.control?.hasValidator(Le.required)??!1}set required(n){this._required=ro(n)}get type(){return this._type}set type(n){this._type=n||"text",this._validateType(),!this._isTextarea&&VE().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}get errorStateMatcher(){return this._errorStateTracker.matcher}set errorStateMatcher(n){this._errorStateTracker.matcher=n}get value(){return this._inputValueAccessor.value}set value(n){n!==this.value&&(this._inputValueAccessor.value=n,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(n){this._readonly=ro(n)}get errorState(){return this._errorStateTracker.errorState}set errorState(n){this._errorStateTracker.errorState=n}constructor(n,s,d,m,_,w,S,T,L,H){this._elementRef=n,this._platform=s,this.ngControl=d,this._autofillMonitor=T,this._formField=H,this._uid=`mat-input-${KK++}`,this.focused=!1,this.stateChanges=new pe,this.controlType="mat-input",this.autofilled=!1,this._disabled=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(it=>VE().has(it)),this._iOSKeyupListener=it=>{let at=it.target;!at.value&&at.selectionStart===0&&at.selectionEnd===0&&(at.setSelectionRange(1,1),at.setSelectionRange(0,0))};let q=this._elementRef.nativeElement,X=q.nodeName.toLowerCase();this._inputValueAccessor=S||q,this._previousNativeValue=this.value,this.id=this.id,s.IOS&&L.runOutsideAngular(()=>{n.nativeElement.addEventListener("keyup",this._iOSKeyupListener)}),this._errorStateTracker=new Ou(w,d,_,m,this.stateChanges),this._isServer=!this._platform.isBrowser,this._isNativeSelect=X==="select",this._isTextarea=X==="textarea",this._isInFormField=!!H,this._isNativeSelect&&(this.controlType=q.multiple?"mat-native-select-multiple":"mat-native-select")}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(n=>{this.autofilled=n.isAutofilled,this.stateChanges.next()})}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement),this._platform.IOS&&this._elementRef.nativeElement.removeEventListener("keyup",this._iOSKeyupListener)}ngDoCheck(){this.ngControl&&(this.updateErrorState(),this.ngControl.disabled!==null&&this.ngControl.disabled!==this.disabled&&(this.disabled=this.ngControl.disabled,this.stateChanges.next())),this._dirtyCheckNativeValue(),this._dirtyCheckPlaceholder()}focus(n){this._elementRef.nativeElement.focus(n)}updateErrorState(){this._errorStateTracker.updateErrorState()}_focusChanged(n){n!==this.focused&&(this.focused=n,this.stateChanges.next())}_onInput(){}_dirtyCheckNativeValue(){let n=this._elementRef.nativeElement.value;this._previousNativeValue!==n&&(this._previousNativeValue=n,this.stateChanges.next())}_dirtyCheckPlaceholder(){let n=this._getPlaceholder();if(n!==this._previousPlaceholder){let s=this._elementRef.nativeElement;this._previousPlaceholder=n,n?s.setAttribute("placeholder",n):s.removeAttribute("placeholder")}}_getPlaceholder(){return this.placeholder||null}_validateType(){XK.indexOf(this._type)>-1}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){let n=this._elementRef.nativeElement.validity;return n&&n.badInput}get empty(){return!this._isNeverEmpty()&&!this._elementRef.nativeElement.value&&!this._isBadInput()&&!this.autofilled}get shouldLabelFloat(){if(this._isNativeSelect){let n=this._elementRef.nativeElement,s=n.options[0];return this.focused||n.multiple||!this.empty||!!(n.selectedIndex>-1&&s&&s.label)}else return this.focused||!this.empty}setDescribedByIds(n){n.length?this._elementRef.nativeElement.setAttribute("aria-describedby",n.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}_isInlineSelect(){let n=this._elementRef.nativeElement;return this._isNativeSelect&&(n.multiple||n.size>1)}};r.\u0275fac=function(s){return new(s||r)(B(Se),B(pn),B(ms,10),B(cg,8),B(Vn,8),B(_g),B(EM,10),B(Hy),B(ze),B(Fu,8))},r.\u0275dir=re({type:r,selectors:[["input","matInput",""],["textarea","matInput",""],["select","matNativeControl",""],["input","matNativeControl",""],["textarea","matNativeControl",""]],hostAttrs:[1,"mat-mdc-input-element"],hostVars:18,hostBindings:function(s,d){s&1&&ct("focus",function(){return d._focusChanged(!0)})("blur",function(){return d._focusChanged(!1)})("input",function(){return d._onInput()}),s&2&&(Rs("id",d.id)("disabled",d.disabled)("required",d.required),oi("name",d.name||null)("readonly",d.readonly&&!d._isNativeSelect||null)("aria-invalid",d.empty&&d.required?null:d.errorState)("aria-required",d.required)("id",d.id),ei("mat-input-server",d._isServer)("mat-mdc-form-field-textarea-control",d._isInFormField&&d._isTextarea)("mat-mdc-form-field-input-control",d._isInFormField)("mdc-text-field__input",d._isInFormField)("mat-mdc-native-select-inline",d._isInlineSelect()))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:[Rt.None,"aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly"},exportAs:["matInput"],standalone:!0,features:[Ni([{provide:Tm,useExisting:r}]),qn]});let a=r;return a})();var QK=["*"],Gy;function JK(){if(Gy===void 0&&(Gy=null,typeof window<"u")){let a=window;a.trustedTypes!==void 0&&(Gy=a.trustedTypes.createPolicy("angular#components",{createHTML:r=>r}))}return Gy}function bg(a){return JK()?.createHTML(a)||a}function vN(a){return Error(`Unable to find icon with the name "${a}"`)}function tQ(){return Error("Could not find HttpClient provider for use with Angular Material icons. Please include the HttpClientModule from @angular/common/http in your app imports.")}function yN(a){return Error(`The URL provided to MatIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${a}".`)}function bN(a){return Error(`The literal provided to MatIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${a}".`)}var Ic=class{constructor(r,l,n){this.url=r,this.svgText=l,this.options=n}},eQ=(()=>{let r=class r{constructor(n,s,d,m){this._httpClient=n,this._sanitizer=s,this._errorHandler=m,this._svgIconConfigs=new Map,this._iconSetConfigs=new Map,this._cachedIconsByUrl=new Map,this._inProgressUrlFetches=new Map,this._fontCssClassesByAlias=new Map,this._resolvers=[],this._defaultFontSetClass=["material-icons","mat-ligature-font"],this._document=d}addSvgIcon(n,s,d){return this.addSvgIconInNamespace("",n,s,d)}addSvgIconLiteral(n,s,d){return this.addSvgIconLiteralInNamespace("",n,s,d)}addSvgIconInNamespace(n,s,d,m){return this._addSvgIconConfig(n,s,new Ic(d,null,m))}addSvgIconResolver(n){return this._resolvers.push(n),this}addSvgIconLiteralInNamespace(n,s,d,m){let _=this._sanitizer.sanitize(Zs.HTML,d);if(!_)throw bN(d);let w=bg(_);return this._addSvgIconConfig(n,s,new Ic("",w,m))}addSvgIconSet(n,s){return this.addSvgIconSetInNamespace("",n,s)}addSvgIconSetLiteral(n,s){return this.addSvgIconSetLiteralInNamespace("",n,s)}addSvgIconSetInNamespace(n,s,d){return this._addSvgIconSetConfig(n,new Ic(s,null,d))}addSvgIconSetLiteralInNamespace(n,s,d){let m=this._sanitizer.sanitize(Zs.HTML,s);if(!m)throw bN(s);let _=bg(m);return this._addSvgIconSetConfig(n,new Ic("",_,d))}registerFontClassAlias(n,s=n){return this._fontCssClassesByAlias.set(n,s),this}classNameForFontAlias(n){return this._fontCssClassesByAlias.get(n)||n}setDefaultFontSetClass(...n){return this._defaultFontSetClass=n,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(n){let s=this._sanitizer.sanitize(Zs.RESOURCE_URL,n);if(!s)throw yN(n);let d=this._cachedIconsByUrl.get(s);return d?Fe(qy(d)):this._loadSvgIconFromConfig(new Ic(n,null)).pipe($r(m=>this._cachedIconsByUrl.set(s,m)),Fi(m=>qy(m)))}getNamedSvgIcon(n,s=""){let d=xN(s,n),m=this._svgIconConfigs.get(d);if(m)return this._getSvgFromConfig(m);if(m=this._getIconConfigFromResolvers(s,n),m)return this._svgIconConfigs.set(d,m),this._getSvgFromConfig(m);let _=this._iconSetConfigs.get(s);return _?this._getSvgFromIconSetConfigs(n,_):Ll(vN(d))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(n){return n.svgText?Fe(qy(this._svgElementFromConfig(n))):this._loadSvgIconFromConfig(n).pipe(Fi(s=>qy(s)))}_getSvgFromIconSetConfigs(n,s){let d=this._extractIconWithNameFromAnySet(n,s);if(d)return Fe(d);let m=s.filter(_=>!_.svgText).map(_=>this._loadSvgIconSetFromConfig(_).pipe(zl(w=>{let T=`Loading icon set URL: ${this._sanitizer.sanitize(Zs.RESOURCE_URL,_.url)} failed: ${w.message}`;return this._errorHandler.handleError(new Error(T)),Fe(null)})));return gv(m).pipe(Fi(()=>{let _=this._extractIconWithNameFromAnySet(n,s);if(!_)throw vN(n);return _}))}_extractIconWithNameFromAnySet(n,s){for(let d=s.length-1;d>=0;d--){let m=s[d];if(m.svgText&&m.svgText.toString().indexOf(n)>-1){let _=this._svgElementFromConfig(m),w=this._extractSvgIconFromSet(_,n,m.options);if(w)return w}}return null}_loadSvgIconFromConfig(n){return this._fetchIcon(n).pipe($r(s=>n.svgText=s),Fi(()=>this._svgElementFromConfig(n)))}_loadSvgIconSetFromConfig(n){return n.svgText?Fe(null):this._fetchIcon(n).pipe($r(s=>n.svgText=s))}_extractSvgIconFromSet(n,s,d){let m=n.querySelector(`[id="${s}"]`);if(!m)return null;let _=m.cloneNode(!0);if(_.removeAttribute("id"),_.nodeName.toLowerCase()==="svg")return this._setSvgAttributes(_,d);if(_.nodeName.toLowerCase()==="symbol")return this._setSvgAttributes(this._toSvgElement(_),d);let w=this._svgElementFromString(bg("<svg></svg>"));return w.appendChild(_),this._setSvgAttributes(w,d)}_svgElementFromString(n){let s=this._document.createElement("DIV");s.innerHTML=n;let d=s.querySelector("svg");if(!d)throw Error("<svg> tag not found");return d}_toSvgElement(n){let s=this._svgElementFromString(bg("<svg></svg>")),d=n.attributes;for(let m=0;m<d.length;m++){let{name:_,value:w}=d[m];_!=="id"&&s.setAttribute(_,w)}for(let m=0;m<n.childNodes.length;m++)n.childNodes[m].nodeType===this._document.ELEMENT_NODE&&s.appendChild(n.childNodes[m].cloneNode(!0));return s}_setSvgAttributes(n,s){return n.setAttribute("fit",""),n.setAttribute("height","100%"),n.setAttribute("width","100%"),n.setAttribute("preserveAspectRatio","xMidYMid meet"),n.setAttribute("focusable","false"),s&&s.viewBox&&n.setAttribute("viewBox",s.viewBox),n}_fetchIcon(n){let{url:s,options:d}=n,m=d?.withCredentials??!1;if(!this._httpClient)throw tQ();if(s==null)throw Error(`Cannot fetch icon from URL "${s}".`);let _=this._sanitizer.sanitize(Zs.RESOURCE_URL,s);if(!_)throw yN(s);let w=this._inProgressUrlFetches.get(_);if(w)return w;let S=this._httpClient.get(_,{responseType:"text",withCredentials:m}).pipe(Fi(T=>bg(T)),nl(()=>this._inProgressUrlFetches.delete(_)),OF());return this._inProgressUrlFetches.set(_,S),S}_addSvgIconConfig(n,s,d){return this._svgIconConfigs.set(xN(n,s),d),this}_addSvgIconSetConfig(n,s){let d=this._iconSetConfigs.get(n);return d?d.push(s):this._iconSetConfigs.set(n,[s]),this}_svgElementFromConfig(n){if(!n.svgElement){let s=this._svgElementFromString(n.svgText);this._setSvgAttributes(s,n.options),n.svgElement=s}return n.svgElement}_getIconConfigFromResolvers(n,s){for(let d=0;d<this._resolvers.length;d++){let m=this._resolvers[d](s,n);if(m)return iQ(m)?new Ic(m.url,null,m.options):new Ic(m,null)}}};r.\u0275fac=function(s){return new(s||r)(ht(Gi,8),ht(XS),ht(li,8),ht(yu))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function qy(a){return a.cloneNode(!0)}function xN(a,r){return a+":"+r}function iQ(a){return!!(a.url&&a.options)}var nQ=new we("MAT_ICON_DEFAULT_OPTIONS"),rQ=new we("mat-icon-location",{providedIn:"root",factory:oQ});function oQ(){let a=oe(li),r=a?a.location:null;return{getPathname:()=>r?r.pathname+r.search:""}}var wN=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],sQ=wN.map(a=>`[${a}]`).join(", "),aQ=/^url\(['"]?#(.*?)['"]?\)$/,Wy=(()=>{let r=class r{get color(){return this._color||this._defaultColor}set color(n){this._color=n}get svgIcon(){return this._svgIcon}set svgIcon(n){n!==this._svgIcon&&(n?this._updateSvgIcon(n):this._svgIcon&&this._clearSvgElement(),this._svgIcon=n)}get fontSet(){return this._fontSet}set fontSet(n){let s=this._cleanupFontValue(n);s!==this._fontSet&&(this._fontSet=s,this._updateFontIconClasses())}get fontIcon(){return this._fontIcon}set fontIcon(n){let s=this._cleanupFontValue(n);s!==this._fontIcon&&(this._fontIcon=s,this._updateFontIconClasses())}constructor(n,s,d,m,_,w){this._elementRef=n,this._iconRegistry=s,this._location=m,this._errorHandler=_,this.inline=!1,this._previousFontSetClass=[],this._currentIconFetch=nr.EMPTY,w&&(w.color&&(this.color=this._defaultColor=w.color),w.fontSet&&(this.fontSet=w.fontSet)),d||n.nativeElement.setAttribute("aria-hidden","true")}_splitIconName(n){if(!n)return["",""];let s=n.split(":");switch(s.length){case 1:return["",s[0]];case 2:return s;default:throw Error(`Invalid icon name: "${n}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){let n=this._elementsWithExternalReferences;if(n&&n.size){let s=this._location.getPathname();s!==this._previousPath&&(this._previousPath=s,this._prependPathToReferences(s))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(n){this._clearSvgElement();let s=this._location.getPathname();this._previousPath=s,this._cacheChildrenWithExternalReferences(n),this._prependPathToReferences(s),this._elementRef.nativeElement.appendChild(n)}_clearSvgElement(){let n=this._elementRef.nativeElement,s=n.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();s--;){let d=n.childNodes[s];(d.nodeType!==1||d.nodeName.toLowerCase()==="svg")&&d.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;let n=this._elementRef.nativeElement,s=(this.fontSet?this._iconRegistry.classNameForFontAlias(this.fontSet).split(/ +/):this._iconRegistry.getDefaultFontSetClass()).filter(d=>d.length>0);this._previousFontSetClass.forEach(d=>n.classList.remove(d)),s.forEach(d=>n.classList.add(d)),this._previousFontSetClass=s,this.fontIcon!==this._previousFontIconClass&&!s.includes("mat-ligature-font")&&(this._previousFontIconClass&&n.classList.remove(this._previousFontIconClass),this.fontIcon&&n.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(n){return typeof n=="string"?n.trim().split(" ")[0]:n}_prependPathToReferences(n){let s=this._elementsWithExternalReferences;s&&s.forEach((d,m)=>{d.forEach(_=>{m.setAttribute(_.name,`url('${n}#${_.value}')`)})})}_cacheChildrenWithExternalReferences(n){let s=n.querySelectorAll(sQ),d=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let m=0;m<s.length;m++)wN.forEach(_=>{let w=s[m],S=w.getAttribute(_),T=S?S.match(aQ):null;if(T){let L=d.get(w);L||(L=[],d.set(w,L)),L.push({name:_,value:T[1]})}})}_updateSvgIcon(n){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),n){let[s,d]=this._splitIconName(n);s&&(this._svgNamespace=s),d&&(this._svgName=d),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(d,s).pipe(Ji(1)).subscribe(m=>this._setSvgElement(m),m=>{let _=`Error retrieving icon ${s}:${d}! ${m.message}`;this._errorHandler.handleError(new Error(_))})}}};r.\u0275fac=function(s){return new(s||r)(B(Se),B(eQ),rl("aria-hidden"),B(rQ),B(yu),B(nQ,8))},r.\u0275cmp=Et({type:r,selectors:[["mat-icon"]],hostAttrs:["role","img",1,"mat-icon","notranslate"],hostVars:10,hostBindings:function(s,d){s&2&&(oi("data-mat-icon-type",d._usingFontIcon()?"font":"svg")("data-mat-icon-name",d._svgName||d.fontIcon)("data-mat-icon-namespace",d._svgNamespace||d.fontSet)("fontIcon",d._usingFontIcon()?d.fontIcon:null),sl(d.color?"mat-"+d.color:""),ei("mat-icon-inline",d.inline)("mat-icon-no-color",d.color!=="primary"&&d.color!=="accent"&&d.color!=="warn"))},inputs:{color:"color",inline:[Rt.HasDecoratorInputTransform,"inline","inline",Qe],svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["matIcon"],standalone:!0,features:[Tn,At],ngContentSelectors:QK,decls:1,vars:0,template:function(s,d){s&1&&(Nn(),Ti(0))},styles:["mat-icon,mat-icon.mat-primary,mat-icon.mat-accent,mat-icon.mat-warn{color:var(--mat-icon-color)}.mat-icon{-webkit-user-select:none;user-select:none;background-repeat:no-repeat;display:inline-block;fill:currentColor;height:24px;width:24px;overflow:hidden}.mat-icon.mat-icon-inline{font-size:inherit;height:inherit;line-height:inherit;width:inherit}.mat-icon.mat-ligature-font[fontIcon]::before{content:attr(fontIcon)}[dir=rtl] .mat-icon-rtl-mirror{transform:scale(-1, 1)}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon{display:block}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button .mat-icon{margin:auto}"],encapsulation:2,changeDetection:0});let a=r;return a})();var $y=(()=>{let r=class r{constructor(n,s){this.http=n,this.snackBar=s,this.eventSubject=new Ze({}),this.eventListSubject=new Ze({})}setEvent(n){this.eventSubject.next(n)}getEvent(){return this.eventSubject.asObservable()}fetchEventById(n){return It(this,null,function*(){try{let s=yield Ve(this.http.get(Me+"/events/"+n));this.setEvent(s)}catch{this.snackBar.open("Failed to fetch event","Close",{duration:3e3})}})}setEventList(n){this.eventListSubject.next(n)}getEventList(){return this.eventListSubject.asObservable()}fetchEventList(n,s,d,m,_,w,S){return It(this,null,function*(){try{let T=new Vl;n!==void 0&&(T=T.append("location",n)),s!==void 0&&(T=T.append("artist",s)),d!==void 0&&(T=T.append("genre",d)),m!==void 0&&(T=T.append("startDate",m)),_!==void 0&&(T=T.append("endDate",_)),T=T.append("page",w.toString()),T=T.append("size",S.toString());let L=yield Ve(this.http.get(Me+"/events/list",{params:T}));if(w===0)this.setEventList(L);else{let H=this.eventListSubject.getValue(),q=Ri(Gt({},H),{content:[...H.content,...L.content]});this.setEventList(q)}return L.content.length}catch(T){console.error(T),this.snackBar.open("Error fetching events","Close",{duration:3e3})}})}};r.\u0275fac=function(s){return new(s||r)(ht(Gi),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var SN=(()=>{let r=class r{constructor(n,s,d,m,_){this.http=n,this.identityService=s,this.snackBar=d,this.shoppingCartService=m,this.headerService=_}buyTickets(n){if(!this.identityService.isLoggedIn()){this.snackBar.open("You must be logged in to buy tickets","Dismiss",{duration:3e3});return}if(n.length===0){this.snackBar.open("You must select at least one ticket","Dismiss",{duration:3e3});return}this.http.post(Me+"/shopping-cart",n,{headers:{Authorization:"Bearer "+this.identityService.getToken()}}).subscribe({next:s=>{this.shoppingCartService.setShoppingCart(s),this.headerService.setShoppingCartSize(s.shoppingCartItemList?.length),this.snackBar.open("Tickets added to shopping cart!","Dismiss",{duration:3e3})},error:s=>{this.snackBar.open(s.error,"Dismiss",{duration:3e3})}})}};r.\u0275fac=function(s){return new(s||r)(ht(Gi),ht(hi),ht(Je),ht(Dm),ht(Sd))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function cQ(a,r){if(a&1&&(A(0,"p",10),V(1),k()),a&2){let l=vt();N(),De(l.event.description)}}function dQ(a,r){if(a&1){let l=Ce();A(0,"div",14),dt(1,"hr"),A(2,"h3",15),V(3),k(),A(4,"p",16)(5,"strong"),V(6,"Pret:"),k(),V(7),k(),A(8,"div",17)(9,"button",18),ct("click",function(){let d=te(l).$implicit,m=vt(2);return ee(m.decrementQuantity(d))}),dt(10,"span",19),k(),A(11,"input",20),kn("ngModelChange",function(s){let m=te(l).$implicit;return An(m.reservedQuantity,s)||(m.reservedQuantity=s),ee(s)}),k(),A(12,"button",21),ct("click",function(){let d=te(l).$implicit,m=vt(2);return ee(m.incrementQuantity(d))}),dt(13,"span",22),k()(),A(14,"p",23)(15,"strong"),V(16),k()()()}if(a&2){let l=r.$implicit;N(3),De(l.name),N(4),ae(" ",l.price," RON"),N(4),In("ngModel",l.reservedQuantity),N(5),ae("Cantitate ramasa: ",l.remainingQuantity,"")}}function uQ(a,r){if(a&1){let l=Ce();A(0,"div")(1,"h2",11),V(2,"Bilete"),k(),mt(3,dQ,17,4,"div",12),A(4,"button",13),ct("click",function(){te(l);let s=vt();return ee(s.buyTickets())}),V(5,"Cumpara"),k()()}if(a&2){let l=vt();N(3),Z("ngForOf",l.event.ticketTypeList)}}function hQ(a,r){a&1&&(A(0,"div")(1,"h2",24),V(2,"Nu sunt bilete disponibile pentru acest eveniment"),k()())}var EN=(()=>{let r=class r{constructor(n,s,d,m){this.route=n,this.router=s,this.eventService=d,this.ticketService=m,this.event={},this.descriptionIsVisible=!1}ngOnInit(){this.route.queryParams.subscribe(n=>It(this,null,function*(){n.id||(yield this.router.navigate(["/page-not-found"])),yield this.eventService.fetchEventById(n.id),this.eventSubscription=this.eventService.getEvent().subscribe({next:s=>{this.event=s,this.event.ticketTypeList&&this.event.ticketTypeList.forEach(d=>{d.reservedQuantity=0})}})}))}ngOnDestroy(){this.eventSubscription?.unsubscribe()}toggleDescription(){this.descriptionIsVisible=!this.descriptionIsVisible}incrementQuantity(n){n.remainingQuantity>n.reservedQuantity&&n.reservedQuantity<10&&n.reservedQuantity++}decrementQuantity(n){n.reservedQuantity>0&&n.reservedQuantity--}buyTickets(){let n=[];this.event.ticketTypeList.forEach(s=>{s.reservedQuantity>0&&n.push({ticketTypeId:s.id,quantity:s.reservedQuantity}),s.reservedQuantity=0}),this.ticketService.buyTickets(n)}};r.\u0275fac=function(s){return new(s||r)(B(En),B(tn),B($y),B(SN))},r.\u0275cmp=Et({type:r,selectors:[["app-event"]],standalone:!0,features:[At],decls:22,vars:9,consts:[[1,"container-fluid"],[1,"event-container","mb-4"],["alt","",1,"img-fluid","rounded","mr-4",2,"max-width","200px",3,"src"],[1,"event-details"],[1,"h3","mb-4","text-gray-800"],[1,"mb-4"],["class","mt-5",4,"ngIf"],[1,"view-details","text-decoration-underline",3,"click"],[1,"tickets-container"],[4,"ngIf"],[1,"mt-5"],[1,"mb-4","text-gray-800"],["class","row ticket-details",4,"ngFor","ngForOf"],[1,"btn","btn-primary","buy-button",3,"click"],[1,"row","ticket-details"],[1,"h3","text-gray-800","ticket-name","col-sm-6"],[1,"col-sm-3","price"],[1,"ticket-number-selector-container","col-sm-3"],[1,"btn","btn-primary","ticket-number-button","left",3,"click"],[1,"fa","fa-minus"],["type","number","readonly","",1,"ticket-number",3,"ngModel","ngModelChange"],[1,"btn","btn-primary","ticket-number-button","right",3,"click"],[1,"fa","fa-plus"],[1,"remaining-quantity","mt-1"],[1,"h4","mt-3","mb-4","text-gray-800"]],template:function(s,d){s&1&&(A(0,"div",0)(1,"div",1),dt(2,"img",2),A(3,"div",3)(4,"h1",4),V(5),k(),A(6,"p")(7,"strong"),V(8,"Data:"),k(),V(9),k(),A(10,"p")(11,"strong"),V(12,"Locatie:"),k(),V(13),k(),A(14,"p",5),V(15),k(),mt(16,cQ,2,1,"p",6),A(17,"a",7),ct("click",function(){return d.toggleDescription()}),V(18,"Apasa pentru a vedea detalii"),k()()(),A(19,"div",8),mt(20,uQ,6,1,"div",9)(21,hQ,3,0,"div",9),k()()),s&2&&(N(2),hs("src",d.event.imageUrl,Tr),N(3),De(d.event.title),N(4),ae(" ",d.event.date,""),N(4),Fo(" ",d.event.location==null?null:d.event.location.name,", ",d.event.location==null?null:d.event.location.address,""),N(2),De(d.event.shortDescription),N(),Z("ngIf",d.descriptionIsVisible),N(4),Z("ngIf",(d.event.ticketTypeList==null?null:d.event.ticketTypeList.length)>0),N(),Z("ngIf",(d.event.ticketTypeList==null?null:d.event.ticketTypeList.length)==0))},dependencies:[qe,Ii,Yi,en,oM,ji,jo],styles:[".container-fluid[_ngcontent-%COMP%]{margin:0 auto;display:flex;flex-direction:column;justify-content:center;width:60%}.event-container[_ngcontent-%COMP%]{display:flex;align-items:start}.event-details[_ngcontent-%COMP%]{margin-left:1rem;width:100%}.img-fluid[_ngcontent-%COMP%]{max-width:100%;height:auto}.h3[_ngcontent-%COMP%]{font-size:1.5rem;margin-bottom:.5rem}.mb-1[_ngcontent-%COMP%]{margin-bottom:.25rem}.mb-2[_ngcontent-%COMP%]{margin-bottom:.5rem}.mr-2[_ngcontent-%COMP%]{margin-right:.5rem}.rounded[_ngcontent-%COMP%]{border-radius:.25rem}.view-details[_ngcontent-%COMP%]{color:#000;cursor:pointer;-webkit-user-select:none;user-select:none}.tickets-container[_ngcontent-%COMP%]{margin:0 auto;padding:1rem;background-color:#f5f5f5;border:1px solid #ccc;width:100%}.ticket-name[_ngcontent-%COMP%], .price[_ngcontent-%COMP%]{margin:0;align-content:center}.remaining-quantity[_ngcontent-%COMP%]{margin:0;text-align:end}.ticket-number-selector-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center}.ticket-number[_ngcontent-%COMP%]{width:35px}.ticket-number[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.ticket-number-button[_ngcontent-%COMP%]{width:30px;height:31.5px;padding:.25rem .5rem;font-size:.7rem}.left[_ngcontent-%COMP%]{border-radius:1rem 0 0 1rem}.right[_ngcontent-%COMP%]{border-radius:0 1rem 1rem 0}@media (max-width: 768px){.event-details[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:20px}.container-fluid[_ngcontent-%COMP%]{width:90%}.ticket-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.ticket-number-selector-container[_ngcontent-%COMP%]{justify-content:center}.ticket-name[_ngcontent-%COMP%], .price[_ngcontent-%COMP%], .remaining-quantity[_ngcontent-%COMP%]{text-align:center}.buy-button[_ngcontent-%COMP%]{margin-top:15px;width:100%}}@media (max-width: 576px){.event-container[_ngcontent-%COMP%]{flex-direction:column;align-items:center;gap:10px}}"]});let a=r;return a})();var MN=(()=>{class a{static \u0275fac=function(n){return new(n||a)};static \u0275mod=xi({type:a});static \u0275inj=wi({imports:[Lo]})}return a})();var mQ=["notchLeading"],pQ=["notchMiddle"],fQ=["*"],DN=(()=>{class a{stateChanges;input;labelActive;static \u0275fac=function(n){return new(n||a)};static \u0275dir=re({type:a})}return a})(),oo=(()=>{class a{constructor(){}static \u0275fac=function(n){return new(n||a)};static \u0275dir=re({type:a,selectors:[["","mdbLabel",""]],exportAs:["mdbLabel"]})}return a})(),mo=(()=>{class a{_renderer;_contentObserver;_elementRef;_ngZone;_notchLeading;_notchMiddle;_formControl;_label;outline=!0;display=!0;get input(){return this._formControl.input}constructor(l,n,s,d){this._renderer=l,this._contentObserver=n,this._elementRef=s,this._ngZone=d}_destroy$=new pe;_notchLeadingLength=9;_labelMarginLeft=0;_labelGapPadding=8;_labelScale=.8;_recalculateGapWhenVisible=!1;ngAfterContentInit(){this._label?setTimeout(()=>{this._updateBorderGap()},0):this._renderer.addClass(this.input,"placeholder-active"),this._updateLabelActiveState(),this._label&&this._contentObserver.observe(this._label.nativeElement).pipe(ri(this._destroy$)).subscribe(()=>{this._updateBorderGap()}),this._formControl.stateChanges.pipe(ri(this._destroy$)).subscribe(()=>{this._updateLabelActiveState(),this._label&&this._updateBorderGap()}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(ri(this._destroy$)).subscribe(()=>{this._label&&this._recalculateGapWhenVisible&&this._updateBorderGap()})})}ngOnDestroy(){this._destroy$.next(),this._destroy$.unsubscribe()}_getLabelWidth(){return this._label.nativeElement.clientWidth*this._labelScale+this._labelGapPadding}_updateBorderGap(){if(this._isHidden()){this._recalculateGapWhenVisible=!0;return}let l=`${this._labelMarginLeft+this._notchLeadingLength}px`,n=`${this._getLabelWidth()}px`;this._notchLeading.nativeElement.style.width=l,this._notchMiddle.nativeElement.style.width=n,this._label.nativeElement.style.marginLeft=`${this._labelMarginLeft}px`,this._recalculateGapWhenVisible=!1}_updateLabelActiveState(){this._isLabelActive()?this._renderer.addClass(this.input,"active"):this._renderer.removeClass(this.input,"active")}_isLabelActive(){return this._formControl&&this._formControl.labelActive}_isHidden(){let l=this._elementRef.nativeElement;return!l.offsetHeight&&!l.offsetWidth}static \u0275fac=function(n){return new(n||a)(B(Oo),B(gz),B(Se),B(ze))};static \u0275cmp=Et({type:a,selectors:[["mdb-form-control"]],contentQueries:function(n,s,d){if(n&1&&(mn(d,DN,7),mn(d,oo,7,Se)),n&2){let m;ce(m=de())&&(s._formControl=m.first),ce(m=de())&&(s._label=m.first)}},viewQuery:function(n,s){if(n&1&&(Ge(mQ,7),Ge(pQ,7)),n&2){let d;ce(d=de())&&(s._notchLeading=d.first),ce(d=de())&&(s._notchMiddle=d.first)}},hostVars:4,hostBindings:function(n,s){n&2&&ei("form-outline",s.outline)("d-block",s.display)},ngContentSelectors:fQ,decls:7,vars:0,consts:[[1,"form-notch"],[1,"form-notch-leading"],["notchLeading",""],[1,"form-notch-middle"],["notchMiddle",""],[1,"form-notch-trailing"]],template:function(n,s){n&1&&(Nn(),Ti(0),A(1,"div",0),dt(2,"div",1,2)(4,"div",3,4)(6,"div",5),k())},encapsulation:2,changeDetection:0})}return a})(),po=(()=>{class a{_elementRef;_renderer;_ngControl;_autofill;constructor(l,n,s,d){this._elementRef=l,this._renderer=n,this._ngControl=s,this._autofill=d}stateChanges=new pe;_focused=!1;_autofilled=!1;_color="";ngAfterViewInit(){typeof getComputedStyle=="function"&&(this._color=getComputedStyle(this._elementRef.nativeElement).color,this._hasTypeInterferingPlaceholder()&&this._updateTextColorForDateType()),this._autofill.monitor(this.input).subscribe(l=>{this._autofilled=l.isAutofilled,this.stateChanges.next()})}_currentNativeValue;get disabled(){return this._ngControl&&this._ngControl.disabled!==null?this._ngControl.disabled:this._disabled}set disabled(l){this._disabled=ro(l)}_disabled=!1;get readonly(){return this._readonly}set readonly(l){l?this._renderer.setAttribute(this._elementRef.nativeElement,"readonly",""):this._renderer.removeAttribute(this._elementRef.nativeElement,"readonly"),this._readonly=ro(l)}_readonly=!1;get value(){return this._elementRef.nativeElement.value}set value(l){l!==this.value&&(this._elementRef.nativeElement.value=l,this._value=l,this.stateChanges.next())}_value;_updateTextColorForDateType(){let l=getComputedStyle(this._elementRef.nativeElement).color;this._color=l!=="rgba(0, 0, 0, 0)"?l:this._color;let n=this.labelActive?this._color:"transparent";this._renderer.setStyle(this._elementRef.nativeElement,"color",n)}_onFocus(){this._focused=!0,this._hasTypeInterferingPlaceholder()&&this._updateTextColorForDateType(),this.stateChanges.next()}_onBlur(){this._focused=!1,this._hasTypeInterferingPlaceholder()&&this._updateTextColorForDateType(),this.stateChanges.next()}ngDoCheck(){let l=this._elementRef.nativeElement.value;this._currentNativeValue!==l&&(this._currentNativeValue=l,this.stateChanges.next())}get hasValue(){return this._elementRef.nativeElement.value!==""}get focused(){return this._focused}get autofilled(){return this._autofilled}get input(){return this._elementRef.nativeElement}get labelActive(){return this.focused||this.hasValue||this.autofilled}_hasTypeInterferingPlaceholder(){return["date","datetime-local","time","month","week"].includes(this._elementRef.nativeElement.type)}static ngAcceptInputType_disabled;static ngAcceptInputType_readonly;ngOnDestroy(){this._autofill.stopMonitoring(this.input)}static \u0275fac=function(n){return new(n||a)(B(Se),B(Oo),B(ms,10),B(Hy))};static \u0275dir=re({type:a,selectors:[["","mdbInput",""]],hostVars:1,hostBindings:function(n,s){n&1&&ct("focus",function(){return s._onFocus()})("blur",function(){return s._onBlur()}),n&2&&Rs("disabled",s.disabled)},inputs:{disabled:"disabled",readonly:"readonly",value:"value"},exportAs:["mdbInput"],features:[Ni([{provide:DN,useExisting:a}])]})}return a})(),Kr=(()=>{class a{static \u0275fac=function(n){return new(n||a)};static \u0275mod=xi({type:a});static \u0275inj=wi({imports:[Lo,Yi]})}return a})();function gQ(a,r){a&1&&(A(0,"div",25),V(1," Completeaza toate campurile "),k())}var TN=(()=>{let r=class r{constructor(n,s,d){this.router=n,this.identityService=s,this.fb=d,this.registrationForm=this.fb.group({username:["",Le.required],password:["",[Le.required]],rememberMe:[!1]})}ngOnInit(){}onLogin(){if(this.registrationForm.markAllAsTouched(),this.registrationForm.valid){let n=this.registrationForm.get("username")?.value,s=this.registrationForm.get("password")?.value,d=this.registrationForm.get("rememberMe")?.value;this.identityService.login(n,s,d)}}};r.\u0275fac=function(s){return new(s||r)(B(tn),B(hi),B(wr))},r.\u0275cmp=Et({type:r,selectors:[["app-login"]],standalone:!0,features:[At],decls:39,vars:2,consts:[[1,"container-fluid",3,"keydown.enter"],[3,"formGroup"],[1,"mb-4"],["mdbInput","","type","text","id","username","formControlName","username","required","",1,"form-control"],["username",""],["mdbLabel","","for","username",1,"form-label"],["mdbInput","","type","password","id","password","formControlName","password","required","",1,"form-control"],["password",""],["mdbLabel","","for","password",1,"form-label"],["class","text-danger mb-4",4,"ngIf"],[1,"row","mb-4"],[1,"col","d-flex","justify-content-center"],[1,"form-check"],["type","checkbox","value","","id","checkbox","formControlName","rememberMe",1,"form-check-input"],["for","checkbox",1,"form-check-label"],[1,"col"],["routerLink","/forgot-password"],["type","button",1,"btn","btn-primary","btn-block","mb-4",3,"click"],[1,"text-center"],["routerLink","/register"],["type","button",1,"btn","btn-link","btn-floating","mx-1"],[1,"fab","fa-facebook-f"],[1,"fab","fa-google"],[1,"fab","fa-twitter"],[1,"fab","fa-github"],[1,"text-danger","mb-4"]],template:function(s,d){if(s&1&&(A(0,"div",0),ct("keydown.enter",function(){return d.onLogin()}),A(1,"form",1)(2,"mdb-form-control",2),dt(3,"input",3,4),A(5,"label",5),V(6,"Username"),k()(),A(7,"mdb-form-control",2),dt(8,"input",6,7),A(10,"label",8),V(11,"Password"),k()(),mt(12,gQ,2,0,"div",9),A(13,"div",10)(14,"div",11)(15,"div",12),dt(16,"input",13),A(17,"label",14),V(18," Tine-ma minte "),k()()(),A(19,"div",15)(20,"a",16),V(21,"Ai uitat parola?"),k()()(),A(22,"button",17),ct("click",function(){return d.onLogin()}),V(23,"Sign in"),k(),A(24,"div",18)(25,"p"),V(26,"Nu ai cont? "),A(27,"a",19),V(28,"Inregistreaza-te"),k()(),A(29,"p"),V(30,"sau incearca cu:"),k(),A(31,"button",20),dt(32,"i",21),k(),A(33,"button",20),dt(34,"i",22),k(),A(35,"button",20),dt(36,"i",23),k(),A(37,"button",20),dt(38,"i",24),k()()()()),s&2){let m;N(),Z("formGroup",d.registrationForm),N(11),Z("ngIf",((m=d.registrationForm.get("username"))==null?null:m.invalid)&&((m=d.registrationForm.get("username"))==null?null:m.touched)&&((m=d.registrationForm.get("password"))==null?null:m.invalid)&&((m=d.registrationForm.get("password"))==null?null:m.touched))}},dependencies:[ar,Yi,xr,en,ag,ji,br,Xr,MN,Rn,Vn,ur,qe,Kr,mo,po,oo],styles:[".container-fluid[_ngcontent-%COMP%]{background:#f5f5f5;height:100vh;display:flex;justify-content:center;align-items:center;-webkit-user-select:none;user-select:none}form[_ngcontent-%COMP%]{padding:20px;box-shadow:0 0 10px #ccc;width:400px;height:400px}"]});let a=r;return a})();function Im(a){let r=a.get("password"),l=a.get("confirmPassword");return r&&l&&r.value!==l.value?{passwordMismatch:!0}:null}function _Q(a,r){a&1&&(A(0,"div",32),V(1," Prenumele este obligatoriu "),k())}function vQ(a,r){a&1&&(A(0,"div",32),V(1," Numele este obligatoriu "),k())}function yQ(a,r){a&1&&(A(0,"div",32),V(1," Username-ul este obligatoriu "),k())}function bQ(a,r){a&1&&(A(0,"div",32),V(1," Email-ul este obligatoriu "),k())}function xQ(a,r){a&1&&(A(0,"div",32),V(1," Email-ul are un format invalid "),k())}function wQ(a,r){a&1&&(A(0,"div",32),V(1," Parola este obligatorie "),k())}function CQ(a,r){a&1&&(A(0,"div",32),V(1," Parola trebuie sa aiba minim 6 caractere "),k())}function SQ(a,r){a&1&&(A(0,"div",32),V(1," Parolele nu coincid "),k())}var EQ=a=>({"border-color":a}),IN=(()=>{let r=class r{constructor(n,s,d,m){this.fb=n,this.identityService=s,this.router=d,this.snackBar=m,this.registrationForm=this.fb.group({firstName:["",Le.required],lastName:["",Le.required],username:["",Le.required],email:["",[Le.required,Le.email]],password:["",[Le.required,Le.minLength(6)]],confirmPassword:["",Le.required],terms:[!1,Le.requiredTrue]},{validators:[Im]})}onRegister(){if(this.registrationForm.markAllAsTouched(),this.registrationForm.valid){let n=this.registrationForm.get("firstName")?.value,s=this.registrationForm.get("lastName")?.value,d=this.registrationForm.get("username")?.value,m=this.registrationForm.get("email")?.value,_=this.registrationForm.get("password")?.value,w=this.registrationForm.get("confirmPassword")?.value;this.identityService.register(n,s,d,_,m)}}};r.\u0275fac=function(s){return new(s||r)(B(wr),B(hi),B(tn),B(Je))},r.\u0275cmp=Et({type:r,selectors:[["app-register"]],standalone:!0,features:[At],decls:55,vars:12,consts:[[1,"container-fluid"],[3,"formGroup"],[1,"mb-4"],["mdbInput","","type","text","id","firstName","formControlName","firstName","required","",1,"form-control"],["firstName",""],["mdbLabel","","for","firstName",1,"form-label"],["class","text-danger mb-4",4,"ngIf"],["mdbInput","","type","text","id","lastName","formControlName","lastName","required","",1,"form-control"],["lastName",""],["mdbLabel","","for","lastName",1,"form-label"],["mdbInput","","type","text","id","username","formControlName","username","required","",1,"form-control"],["username",""],["mdbLabel","","for","username",1,"form-label"],["mdbInput","","type","text","id","email","formControlName","email","required","",1,"form-control"],["email",""],["mdbLabel","","for","email",1,"form-label"],["mdbInput","","type","password","id","password","formControlName","password","required","",1,"form-control"],["password",""],["mdbLabel","","for","password",1,"form-label"],["mdbInput","","type","password","id","confirmPassword","formControlName","confirmPassword","required","",1,"form-control"],["confirmPassword",""],["mdbLabel","","for","confirmPassword",1,"form-label"],[1,"row","mb-4"],[1,"col"],[1,"form-check"],["mdbInput","","type","checkbox","id","terms","formControlName","terms","required","",1,"form-check-input",3,"ngStyle"],["terms",""],["for","terms",1,"form-check-label","font-12"],["href",""],[1,"col","font-12","ms-5"],["routerLink","/login"],["type","button",1,"btn","btn-primary","btn-block","mb-4",3,"click"],[1,"text-danger","mb-4"]],template:function(s,d){if(s&1&&(A(0,"div",0)(1,"form",1)(2,"mdb-form-control",2),dt(3,"input",3,4),A(5,"label",5),V(6,"Prenume"),k()(),mt(7,_Q,2,0,"div",6),A(8,"mdb-form-control",2),dt(9,"input",7,8),A(11,"label",9),V(12,"Nume"),k()(),mt(13,vQ,2,0,"div",6),A(14,"mdb-form-control",2),dt(15,"input",10,11),A(17,"label",12),V(18,"Username"),k()(),mt(19,yQ,2,0,"div",6),A(20,"mdb-form-control",2),dt(21,"input",13,14),A(23,"label",15),V(24,"Email"),k()(),mt(25,bQ,2,0,"div",6)(26,xQ,2,0,"div",6),A(27,"mdb-form-control",2),dt(28,"input",16,17),A(30,"label",18),V(31,"Password"),k()(),mt(32,wQ,2,0,"div",6)(33,CQ,2,0,"div",6),A(34,"mdb-form-control",2),dt(35,"input",19,20),A(37,"label",21),V(38,"Confirm password"),k()(),mt(39,SQ,2,0,"div",6),A(40,"div",22)(41,"div",23)(42,"div",24),dt(43,"input",25,26),A(45,"label",27),V(46,"Sunt de acord cu "),A(47,"a",28),V(48,"termenii si conditiile"),k()()()(),A(49,"div",29),V(50," Ai cont? "),A(51,"a",30),V(52,"Inapoi la login?"),k()()(),A(53,"button",31),ct("click",function(){return d.onRegister()}),V(54,"Sign in"),k()()()),s&2){let m,_,w,S,T,L,H,q,X;N(),Z("formGroup",d.registrationForm),N(6),Z("ngIf",((m=d.registrationForm.get("firstName"))==null?null:m.invalid)&&((m=d.registrationForm.get("firstName"))==null?null:m.touched)),N(6),Z("ngIf",((_=d.registrationForm.get("lastName"))==null?null:_.invalid)&&((_=d.registrationForm.get("lastName"))==null?null:_.touched)),N(6),Z("ngIf",((w=d.registrationForm.get("username"))==null?null:w.invalid)&&((w=d.registrationForm.get("username"))==null?null:w.touched)),N(6),Z("ngIf",((S=d.registrationForm.get("email"))==null||S.errors==null?null:S.errors.required)&&((S=d.registrationForm.get("email"))==null?null:S.touched)),N(),Z("ngIf",((T=d.registrationForm.get("email"))==null||T.errors==null?null:T.errors.email)&&((T=d.registrationForm.get("email"))==null?null:T.touched)),N(6),Z("ngIf",((L=d.registrationForm.get("password"))==null||L.errors==null?null:L.errors.required)&&((L=d.registrationForm.get("password"))==null?null:L.touched)),N(),Z("ngIf",((H=d.registrationForm.get("password"))==null||H.errors==null?null:H.errors.minlength)&&((H=d.registrationForm.get("password"))==null?null:H.touched)),N(6),Z("ngIf",((q=d.registrationForm.get("password"))==null?null:q.touched)&&((q=d.registrationForm.get("confirmPassword"))==null?null:q.touched)&&(d.registrationForm.errors==null?null:d.registrationForm.errors.passwordMismatch)&&!((q=d.registrationForm.get("password"))!=null&&q.errors)),N(4),Z("ngStyle",Xi(10,EQ,(X=d.registrationForm.get("terms"))!=null&&X.invalid&&((X=d.registrationForm.get("terms"))!=null&&X.touched)?"red":""))}},dependencies:[Yi,xr,en,ag,ji,br,Xr,sM,Kr,mo,po,oo,ar,Rn,Vn,ur,qe,nL],styles:[".container-fluid[_ngcontent-%COMP%]{background:#f5f5f5;height:100vh;display:flex;justify-content:center;align-items:center;-webkit-user-select:none;user-select:none}form[_ngcontent-%COMP%]{padding:20px;box-shadow:0 0 10px #ccc;width:450px;height:auto}.font-12[_ngcontent-%COMP%]{font-size:12px}.terms-conditions[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{padding-left:5px}"]});let a=r;return a})();function MQ(a,r){a&1&&(A(0,"div",15),V(1," Email-ul este obligatoriu "),k())}function DQ(a,r){a&1&&(A(0,"div",15),V(1," Email-ul are un format invalid "),k())}var AN=(()=>{let r=class r{constructor(n,s,d,m){this.router=n,this.identityService=s,this.fb=d,this.snackBar=m,this.registrationForm=this.fb.group({email:["",[Le.required,Le.email]]})}onResetPasswordClick(){this.registrationForm.markAllAsTouched(),this.registrationForm.valid&&this.identityService.forgotPassword(this.registrationForm.value.email)}};r.\u0275fac=function(s){return new(s||r)(B(tn),B(hi),B(wr),B(Je))},r.\u0275cmp=Et({type:r,selectors:[["app-forgot-password"]],standalone:!0,features:[At],decls:22,vars:3,consts:[[1,"container-fluid"],[1,"card","text-center",2,"width","300px"],[1,"card-header","h5","text-white","bg-primary"],[1,"card-body","px-5"],[1,"card-text","py-2"],[3,"formGroup"],[1,"mb-4"],["mdbInput","","type","text","id","email","formControlName","email","required","",1,"form-control"],["email",""],["mdbLabel","","for","email",1,"form-label"],["class","text-danger mb-4",4,"ngIf"],["href","#",1,"btn","btn-primary","w-100",3,"click"],[1,"d-flex","justify-content-between","mt-4"],["routerLink","/login",1,""],["routerLink","/register",1,""],[1,"text-danger","mb-4"]],template:function(s,d){if(s&1&&(A(0,"div",0)(1,"div",1)(2,"div",2),V(3,"Resetare parola"),k(),A(4,"div",3)(5,"p",4),V(6," Introduce adresa email si iti vom trimite un email cu instructiuni pentru resetarea parolei. "),k(),A(7,"form",5)(8,"mdb-form-control",6),dt(9,"input",7,8),A(11,"label",9),V(12,"Email"),k()(),mt(13,MQ,2,0,"div",10)(14,DQ,2,0,"div",10),k(),A(15,"button",11),ct("click",function(){return d.onResetPasswordClick()}),V(16,"Resetare parola"),k(),A(17,"div",12)(18,"a",13),V(19,"Login"),k(),A(20,"a",14),V(21,"Inregistrare"),k()()()()()),s&2){let m,_;N(7),Z("formGroup",d.registrationForm),N(6),Z("ngIf",((m=d.registrationForm.get("email"))==null||m.errors==null?null:m.errors.required)&&((m=d.registrationForm.get("email"))==null?null:m.touched)),N(),Z("ngIf",((_=d.registrationForm.get("email"))==null||_.errors==null?null:_.errors.email)&&((_=d.registrationForm.get("email"))==null?null:_.touched))}},dependencies:[ar,Rn,xr,en,ji,br,Xr,Vn,ur,Kr,mo,po,oo,qe],styles:[".container-fluid[_ngcontent-%COMP%]{background:#f5f5f5;height:100vh;display:flex;justify-content:center;align-items:center;-webkit-user-select:none;user-select:none}"]});let a=r;return a})();function TQ(a,r){a&1&&(A(0,"h4"),V(1,"Cosul de cumparaturi este gol"),k())}function IQ(a,r){if(a&1&&(A(0,"option"),V(1),k()),a&2){let l=r.$implicit;N(),De(l)}}function AQ(a,r){if(a&1){let l=Ce();A(0,"div",5)(1,"div",6)(2,"div",7)(3,"div",8)(4,"h4",9),V(5),k(),A(6,"h5",10),V(7),k(),A(8,"h6",10),V(9),k(),A(10,"p",11),V(11),k()(),A(12,"div",12)(13,"select",13),ct("change",function(s){let m=te(l).$implicit,_=vt(2);return ee(_.onQuantityChange(s,m))}),A(14,"option",14),V(15),k(),mt(16,IQ,2,1,"option",15),k(),A(17,"button",16),ct("click",function(){let d=te(l).$implicit,m=vt(2);return ee(m.removeFromCart(d))}),V(18,"Sterge"),k()()()()()}if(a&2){let l=r.$implicit,n=vt(2);N(5),De(l.ticketType.event.title),N(2),Fo("",l.ticketType.event.location.name," | ",l.ticketType.event.date,""),N(2),De(l.ticketType.name),N(2),QF("",l.ticketType.price," RON x ",l.quantity," = ",l.ticketType.price*l.quantity," RON"),N(3),Z("selected",l.quantity),N(),De(l.quantity),N(),Z("ngForOf",n.generateQuantityList(l.quantity))}}function kQ(a,r){if(a&1){let l=Ce();A(0,"div"),mt(1,AQ,19,10,"div",2),A(2,"h4",3),V(3),k(),A(4,"button",4),ct("click",function(){te(l);let s=vt();return ee(s.onBuyClick())}),V(5,"Cumpara"),k()()}if(a&2){let l=vt();N(),Z("ngForOf",l.shoppingCart.shoppingCartItemList),N(2),ae("Total: ",l.shoppingCart.price," RON")}}var kN=(()=>{let r=class r{constructor(n,s){this.shoppingCartService=n,this.snackBar=s,this.shoppingCart={}}ngOnInit(){return It(this,null,function*(){yield this.shoppingCartService.fetchShoppingCart(),this.shoppingCartSubscription=this.shoppingCartService.getShoppingCart().subscribe(n=>{this.shoppingCart=n})})}ngOnDestroy(){this.shoppingCartSubscription?.unsubscribe()}generateQuantityList(n){let s=[];for(let d=1;d<=10;d++)d!==n&&s.push(d);return s}onQuantityChange(n,s){return It(this,null,function*(){s.quantity=n.target.value,yield this.shoppingCartService.updateQuantity(s)})}removeFromCart(n){return It(this,null,function*(){yield this.shoppingCartService.removeTicketFromShoppingCart(n.ticketType)})}onBuyClick(){return It(this,null,function*(){yield this.shoppingCartService.buyTickets()})}};r.\u0275fac=function(s){return new(s||r)(B(Dm),B(Je))},r.\u0275cmp=Et({type:r,selectors:[["app-shopping-cart"]],standalone:!0,features:[At],decls:5,vars:2,consts:[[1,"container-fluid"],[4,"ngIf"],["class","card",4,"ngFor","ngForOf"],[1,"mt-3"],[1,"btn","btn-primary","mt-3",3,"click"],[1,"card"],[1,"card-body"],[1,"row"],[1,"col-md-9"],[1,"card-title"],[1,"card-subtitle","mb-2","text-muted"],[1,"card-text"],[1,"col-md-3"],[1,"custom-select","me-2",3,"change"],[3,"selected"],[4,"ngFor","ngForOf"],[1,"btn","btn-danger",3,"click"]],template:function(s,d){s&1&&(A(0,"div",0)(1,"h1"),V(2,"Cos"),k(),mt(3,TQ,2,0,"h4",1)(4,kQ,6,2,"div",1),k()),s&2&&(N(3),Z("ngIf",(d.shoppingCart==null||d.shoppingCart.shoppingCartItemList==null?null:d.shoppingCart.shoppingCartItemList.length)===0),N(),Z("ngIf",(d.shoppingCart==null||d.shoppingCart.shoppingCartItemList==null?null:d.shoppingCart.shoppingCartItemList.length)>0))},dependencies:[qe,Ii,Rn,Ca,Sa,Yi],styles:[".container-fluid[_ngcontent-%COMP%]{width:65%;margin:0 auto;border:2px solid #ccc;padding:20px;border-radius:8px}.custom-select[_ngcontent-%COMP%]{width:4rem;padding:.375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;border:1px solid #ced4da;border-radius:.25rem}"]});let a=r;return a})();var RQ=["submenu"];function PQ(a,r){if(a&1&&dt(0,"i"),a&2){let l=vt(2).$implicit;sl(l.icon)}}var MM=a=>({active:a});function OQ(a,r){if(a&1){let l=Ce();rr(0),A(1,"a",16),ct("click",function(){te(l);let s=vt().$implicit,d=vt();return ee(d.onMenuItemClick(s))}),mt(2,PQ,1,3,"i",17),A(3,"span"),V(4),k()(),or()}if(a&2){let l=vt().$implicit,n=vt();N(),Z("ngClass",Xi(3,MM,n.isCurrentPage(l.label))),N(),Z("ngIf",l.icon),N(2),De(l.label)}}function FQ(a,r){if(a&1&&dt(0,"i"),a&2){let l=vt(2).$implicit;sl(l.icon)}}function LQ(a,r){if(a&1&&dt(0,"i"),a&2){let l=vt().$implicit;sl(l.icon)}}function zQ(a,r){if(a&1){let l=Ce();A(0,"li",23),ct("click",function(){let d=te(l).$implicit,m=vt(3);return ee(m.onMenuItemClick(d))}),mt(1,LQ,1,3,"i",17),A(2,"span"),V(3),k()()}if(a&2){let l=r.$implicit,n=vt(3);Z("ngClass",Xi(3,MM,n.isCurrentPage(l.label))),N(),Z("ngIf",l.icon),N(2),De(l.label)}}function NQ(a,r){if(a&1){let l=Ce();rr(0),A(1,"a",18),ct("click",function(){te(l);let s=Ir(7);return ee(s.toggle())}),mt(2,FQ,1,3,"i",17),A(3,"span"),V(4),k(),dt(5,"i",19),k(),A(6,"ul",20,21),mt(8,zQ,4,5,"li",22),k(),or()}if(a&2){let l=Ir(7),n=vt().$implicit,s=vt();N(),Z("ngClass",Xi(7,MM,s.isCurrentPage(n.label))),oi("aria-expanded",!l.collapsed),N(),Z("ngIf",n.icon),N(2),De(n.label),N(),ei("rotate",n.expanded),N(3),Z("ngForOf",n.submenu)}}function BQ(a,r){if(a&1&&(rr(0),mt(1,OQ,5,5,"ng-container",15)(2,NQ,9,9,"ng-container",15),or()),a&2){let l=r.$implicit;N(),Z("ngIf",!l.submenu),N(),Z("ngIf",l.submenu)}}var Am=(()=>{let r=class r{constructor(n,s,d){this.router=n,this.route=s,this.identityService=d,this.menuItems=[],this.brand="",this.activePage="",this.page="",this.pageNameMap={"/admin-dashboard":"Acasa","/admin-dashboard/manage/users":"Gestioneaza Utilizatori","/admin-dashboard/manage/locations":"Gestioneaza Locatii","/admin-dashboard/manage/events":"Gestioneaza Evenimente","/admin-dashboard/manage/artists":"Gestioneaza Artisti","/admin-dashboard/manage/orders":"Gestioneaza Comenzi","/admin-dashboard/statistics":"Statistici","/admin-dashboard/settings":"Setari"}}ngOnInit(){this.page=this.router.url.split("/").join("/").split("?")[0],this.page.includes("manage")?this.activePage=this.pageNameMap[this.page].split(" ")[1]:this.activePage=this.pageNameMap[this.page],this.router.events.pipe(wn(n=>n instanceof Ks)).subscribe(()=>{let n=this.router.url;this.page=n.split("/").join("/").split("?")[0],this.page.includes("manage")?this.activePage=this.pageNameMap[this.page].split(" ")[1]:this.activePage=this.pageNameMap[this.page]})}isCurrentPage(n){return this.activePage===n}onMenuItemClick(n){n.route&&(n.route.includes("manage")?this.router.navigate([n.route],{queryParams:{page:0,size:5}}):this.router.navigate([n.route]))}onLogoutClick(){this.identityService.logout(),this.router.navigate([""])}};r.\u0275fac=function(s){return new(s||r)(B(tn),B(En),B(hi))},r.\u0275cmp=Et({type:r,selectors:[["app-sidebar"]],viewQuery:function(s,d){if(s&1&&Ge(RQ,5),s&2){let m;ce(m=de())&&(d.submenu=m.first)}},inputs:{menuItems:"menuItems",brand:"brand"},standalone:!0,features:[At],decls:20,vars:4,consts:[["id","sidebarMenu","mdbCollapse","",1,"collapse","d-lg-block","sidebar","collapse","bg-white"],["sidebarMenu","mdbCollapse"],[1,"position-sticky"],[1,"list-group","list-group-flush","mx-3","mt-4"],[4,"ngFor","ngForOf"],[1,"list-group-item","list-group-item-action","py-2","ripple",3,"click"],[1,"fas","fa-sign-out-alt","fa-fw","me-3"],["id","main-navbar",1,"navbar","navbar-expand-lg","navbar-light","bg-light","fixed-top"],[1,"container-fluid"],["type","button","aria-controls","sidebarMenu",1,"navbar-toggler",3,"click"],[1,"fas","fa-bars"],["routerLink","",1,"navbar-brand"],[1,"navbar-nav","me-auto","mb-2","mb-lg-0"],[1,"nav-item"],[1,"nav-link"],[4,"ngIf"],["aria-current","true",1,"list-group-item","list-group-item-action","py-2","ripple",3,"ngClass","click"],[3,"class",4,"ngIf"],["aria-controls","submenu",1,"list-group-item","list-group-item-action","py-2","ripple",3,"ngClass","click"],[1,"fa","fa-chevron-right","fa-fw"],["id","submenu","mdbCollapse",""],["submenu","mdbCollapse"],["class","list-group-item list-group-item-action py-2 ripple","role","button",3,"ngClass","click",4,"ngFor","ngForOf"],["role","button",1,"list-group-item","list-group-item-action","py-2","ripple",3,"ngClass","click"]],template:function(s,d){if(s&1){let m=Ce();A(0,"header")(1,"nav",0,1)(3,"div",2)(4,"div",3),mt(5,BQ,3,2,"ng-container",4),A(6,"a",5),ct("click",function(){return d.onLogoutClick()}),dt(7,"i",6),A(8,"span"),V(9,"Logout"),k()()()()(),A(10,"nav",7)(11,"div",8)(12,"button",9),ct("click",function(){te(m);let w=Ir(2);return ee(w.toggle())}),dt(13,"i",10),k(),A(14,"a",11),V(15),k(),A(16,"ul",12)(17,"li",13)(18,"a",14),V(19),k()()()()()()}if(s&2){let m=Ir(2);N(5),Z("ngForOf",d.menuItems),N(7),oi("aria-expanded",!m.collapsed),N(3),De(d.brand),N(4),De(d.pageNameMap[d.page])}},dependencies:[Gl,uy,Zo,Ii,qe,ar],styles:["@media (min-width: 991.98px){main[_ngcontent-%COMP%]{padding-left:240px}}.sidebar[_ngcontent-%COMP%]{position:fixed;top:0;bottom:0;left:0;padding:58px 0 0;box-shadow:0 2px 5px #0000000d,0 2px 10px #0000000d;width:240px;z-index:600}@media (max-width: 991.98px){.sidebar[_ngcontent-%COMP%]{width:100%}}.sidebar[_ngcontent-%COMP%]   .active[_ngcontent-%COMP%]{border-radius:5px;box-shadow:0 2px 5px #00000029,0 2px 10px #0000001f}.sidebar-sticky[_ngcontent-%COMP%]{position:relative;top:0;height:calc(100vh - 48px);padding-top:.5rem;overflow-x:hidden;overflow-y:auto}a[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none}.list-group-item[_ngcontent-%COMP%]{border-left:none;border-right:none}"]});let a=r;return a})();var RN=(()=>{let r=class r{constructor(){this.menuItems=[{label:"Contul meu",route:"account",icon:"fa-solid fa-user fa-fw me-3"},{label:"Comenzi",route:"account/orders",icon:"fa-solid fa-envelope fa-fw me-3"},{label:"Setari",route:"account/settings",icon:"fa-solid fa-gear fa-fw me-3"}]}};r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=Et({type:r,selectors:[["app-account"]],standalone:!0,features:[At],decls:3,vars:2,consts:[[3,"menuItems","brand"]],template:function(s,d){s&1&&(dt(0,"app-sidebar",0),A(1,"main"),dt(2,"router-outlet"),k()),s&2&&Z("menuItems",d.menuItems)("brand","Bileteria")},dependencies:[Gl,cl,Am],styles:["@media (min-width: 991.98px){main[_ngcontent-%COMP%]{padding-left:240px}}main[_ngcontent-%COMP%]{margin-top:70px;margin-left:15px}"]});let a=r;return a})();var PN=(()=>{let r=class r{constructor(){this.menuItems=[{label:"Acasa",route:"admin-dashboard",icon:"fa-solid fa-home fa-fw me-3"},{label:"Gestioneaza",icon:"fa-solid fa-cogs fa-fw me-3",submenu:[{label:"Utilizatori",route:"admin-dashboard/manage/users",icon:"fa-solid fa-user fa-fw me-3"},{label:"Locatii",route:"admin-dashboard/manage/locations",icon:"fa-solid fa-map-marker fa-fw me-3"},{label:"Evenimente",route:"admin-dashboard/manage/events",icon:"fa-solid fa-calendar fa-fw me-3"},{label:"Artisti",route:"admin-dashboard/manage/artists",icon:"fa-solid fa-microphone fa-fw me-3"},{label:"Comenzi",route:"admin-dashboard/manage/orders",icon:"fa-solid fa-envelope fa-fw me-3"}]},{label:"Statistici",route:"admin-dashboard/statistics",icon:"fa-solid fa-chart-bar fa-fw me-3"},{label:"Setari",route:"admin-dashboard/settings",icon:"fa-solid fa-gear fa-fw me-3"}]}};r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=Et({type:r,selectors:[["app-admin-dashboard"]],standalone:!0,features:[At],decls:3,vars:2,consts:[[3,"menuItems","brand"]],template:function(s,d){s&1&&(dt(0,"app-sidebar",0),A(1,"main"),dt(2,"router-outlet"),k()),s&2&&Z("menuItems",d.menuItems)("brand","Admin dashboard")},dependencies:[Gl,cl,Am],styles:["@media (min-width: 991.98px){main[_ngcontent-%COMP%]{padding-left:240px}}main[_ngcontent-%COMP%]{padding-top:70px;margin-left:15px}"]});let a=r;return a})();var ON=(()=>{let r=class r{constructor(n,s){this.identityService=n,this.router=s}canActivate(n,s){return this.identityService.isUser()||!this.identityService.isLoggedIn()?(this.router.navigate([""]),!1):this.identityService.isValidator()?(this.router.navigate(["validator-dashboard"]),!1):!0}};r.\u0275fac=function(s){return new(s||r)(ht(hi),ht(tn))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var FN=(()=>{let r=class r{constructor(n,s){this.identityService=n,this.router=s}canActivate(n,s){return this.identityService.isAdmin()?(this.router.navigate(["admin-dashboard"]),!1):this.identityService.isValidator()?(this.router.navigate(["validator-dashboard"]),!1):!0}};r.\u0275fac=function(s){return new(s||r)(ht(hi),ht(tn))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var Yy=(()=>{let r=class r{constructor(n,s,d){this.http=n,this.identityService=s,this.snackBar=d,this.selectedEventListSubject=new Ze([]),this.eventListForSelectionSubject=new Ze([])}setSelectedEventList(n){this.selectedEventListSubject.next(n)}getSelectedEventList(){return this.selectedEventListSubject.asObservable()}setEventListForSelection(n){this.eventListForSelectionSubject.next(n)}getEventListForSelection(){return this.eventListForSelectionSubject.asObservable()}fetchEventListForSelection(){return It(this,null,function*(){try{let n=yield Ve(this.http.get(Me+"/events/all-for-selection",{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setEventListForSelection(n)}catch{this.snackBar.open("Failed to fetch event list for selection","Close",{duration:3e3})}})}fetchSelectedEvents(){return It(this,null,function*(){try{let n=yield Ve(this.http.get(Me+"/events/selected"));this.setSelectedEventList(n)}catch{this.snackBar.open("Failed to fetch selected events","Close",{duration:3e3})}})}addSelectedEventList(n){return It(this,null,function*(){try{let s=yield Ve(this.http.post(Me+"/events/select",n,{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setSelectedEventList([...this.selectedEventListSubject.value,...s])}catch{this.snackBar.open("Failed to add selected events","Close",{duration:3e3})}})}deleteSelectedEvent(n){return It(this,null,function*(){try{let s=yield Ve(this.http.delete(Me+"/events/deselect/"+n,{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setSelectedEventList(this.selectedEventListSubject.value.filter(d=>d.id!==n))}catch{this.snackBar.open("Failed to delete selected event","Close",{duration:3e3})}})}};r.\u0275fac=function(s){return new(s||r)(ht(Gi),ht(hi),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function VQ(a,r){}var Lu=class{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0,this.closeOnOverlayDetachments=!0}};var TM=(()=>{let r=class r extends yd{constructor(n,s,d,m,_,w,S,T){super(),this._elementRef=n,this._focusTrapFactory=s,this._config=m,this._interactivityChecker=_,this._ngZone=w,this._overlayRef=S,this._focusMonitor=T,this._platform=oe(pn),this._focusTrap=null,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this._ariaLabelledByQueue=[],this._changeDetectorRef=oe(Wi),this.attachDomPortal=L=>{this._portalOutlet.hasAttached();let H=this._portalOutlet.attachDomPortal(L);return this._contentAttached(),H},this._document=d,this._config.ariaLabelledBy&&this._ariaLabelledByQueue.push(this._config.ariaLabelledBy)}_addAriaLabelledBy(n){this._ariaLabelledByQueue.push(n),this._changeDetectorRef.markForCheck()}_removeAriaLabelledBy(n){let s=this._ariaLabelledByQueue.indexOf(n);s>-1&&(this._ariaLabelledByQueue.splice(s,1),this._changeDetectorRef.markForCheck())}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(n){this._portalOutlet.hasAttached();let s=this._portalOutlet.attachComponentPortal(n);return this._contentAttached(),s}attachTemplatePortal(n){this._portalOutlet.hasAttached();let s=this._portalOutlet.attachTemplatePortal(n);return this._contentAttached(),s}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(n,s){this._interactivityChecker.isFocusable(n)||(n.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{let d=()=>{n.removeEventListener("blur",d),n.removeEventListener("mousedown",d),n.removeAttribute("tabindex")};n.addEventListener("blur",d),n.addEventListener("mousedown",d)})),n.focus(s)}_focusByCssSelector(n,s){let d=this._elementRef.nativeElement.querySelector(n);d&&this._forceFocus(d,s)}_trapFocus(){let n=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||n.focus();break;case!0:case"first-tabbable":this._focusTrap?.focusInitialElementWhenReady().then(s=>{s||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus);break}}_restoreFocus(){let n=this._config.restoreFocus,s=null;if(typeof n=="string"?s=this._document.querySelector(n):typeof n=="boolean"?s=n?this._elementFocusedBeforeDialogWasOpened:null:n&&(s=n),this._config.restoreFocus&&s&&typeof s.focus=="function"){let d=_d(),m=this._elementRef.nativeElement;(!d||d===this._document.body||d===m||m.contains(d))&&(this._focusMonitor?(this._focusMonitor.focusVia(s,this._closeInteractionType),this._closeInteractionType=null):s.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){let n=this._elementRef.nativeElement,s=_d();return n===s||n.contains(s)}_initializeFocusTrap(){this._platform.isBrowser&&(this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=_d()))}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}};r.\u0275fac=function(s){return new(s||r)(B(Se),B(mg),B(li,8),B(Lu),B(hg),B(ze),B(Ec),B(Ls))},r.\u0275cmp=Et({type:r,selectors:[["cdk-dialog-container"]],viewQuery:function(s,d){if(s&1&&Ge(ul,7),s&2){let m;ce(m=de())&&(d._portalOutlet=m.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(s,d){s&2&&oi("id",d._config.id||null)("role",d._config.role)("aria-modal",d._config.ariaModal)("aria-labelledby",d._config.ariaLabel?null:d._ariaLabelledByQueue[0])("aria-label",d._config.ariaLabel)("aria-describedby",d._config.ariaDescribedBy||null)},standalone:!0,features:[Si,At],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(s,d){s&1&&mt(0,VQ,0,0,"ng-template",0)},dependencies:[ul],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2});let a=r;return a})(),xg=class{constructor(r,l){this.overlayRef=r,this.config=l,this.closed=new pe,this.disableClose=l.disableClose,this.backdropClick=r.backdropClick(),this.keydownEvents=r.keydownEvents(),this.outsidePointerEvents=r.outsidePointerEvents(),this.id=l.id,this.keydownEvents.subscribe(n=>{n.keyCode===27&&!this.disableClose&&!Zr(n)&&(n.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})}),this._detachSubscription=r.detachments().subscribe(()=>{l.closeOnOverlayDetachments!==!1&&this.close()})}close(r,l){if(this.containerInstance){let n=this.closed;this.containerInstance._closeInteractionType=l?.focusOrigin||"program",this._detachSubscription.unsubscribe(),this.overlayRef.dispose(),n.next(r),n.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(r="",l=""){return this.overlayRef.updateSize({width:r,height:l}),this}addPanelClass(r){return this.overlayRef.addPanelClass(r),this}removePanelClass(r){return this.overlayRef.removePanelClass(r),this}},jQ=new we("DialogScrollStrategy",{providedIn:"root",factory:()=>{let a=oe($n);return()=>a.scrollStrategies.block()}}),UQ=new we("DialogData"),HQ=new we("DefaultDialogConfig");var GQ=0,zN=(()=>{let r=class r{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}constructor(n,s,d,m,_,w){this._overlay=n,this._injector=s,this._defaultOptions=d,this._parentDialog=m,this._overlayContainer=_,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new pe,this._afterOpenedAtThisLevel=new pe,this._ariaHiddenElements=new Map,this.afterAllClosed=xc(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(co(void 0))),this._scrollStrategy=w}open(n,s){let d=this._defaultOptions||new Lu;s=Gt(Gt({},d),s),s.id=s.id||`cdk-dialog-${GQ++}`,s.id&&this.getDialogById(s.id);let m=this._getOverlayConfig(s),_=this._overlay.create(m),w=new xg(_,s),S=this._attachContainer(_,w,s);return w.containerInstance=S,this._attachDialogContent(n,w,S,s),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(w),w.closed.subscribe(()=>this._removeOpenDialog(w,!0)),this.afterOpened.next(w),w}closeAll(){DM(this.openDialogs,n=>n.close())}getDialogById(n){return this.openDialogs.find(s=>s.id===n)}ngOnDestroy(){DM(this._openDialogsAtThisLevel,n=>{n.config.closeOnDestroy===!1&&this._removeOpenDialog(n,!1)}),DM(this._openDialogsAtThisLevel,n=>n.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(n){let s=new ns({positionStrategy:n.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:n.scrollStrategy||this._scrollStrategy(),panelClass:n.panelClass,hasBackdrop:n.hasBackdrop,direction:n.direction,minWidth:n.minWidth,minHeight:n.minHeight,maxWidth:n.maxWidth,maxHeight:n.maxHeight,width:n.width,height:n.height,disposeOnNavigation:n.closeOnNavigation});return n.backdropClass&&(s.backdropClass=n.backdropClass),s}_attachContainer(n,s,d){let m=d.injector||d.viewContainerRef?.injector,_=[{provide:Lu,useValue:d},{provide:xg,useValue:s},{provide:Ec,useValue:n}],w;d.container?typeof d.container=="function"?w=d.container:(w=d.container.type,_.push(...d.container.providers(d))):w=TM;let S=new is(w,d.viewContainerRef,uo.create({parent:m||this._injector,providers:_}),d.componentFactoryResolver);return n.attach(S).instance}_attachDialogContent(n,s,d,m){if(n instanceof Eo){let _=this._createInjector(m,s,d,void 0),w={$implicit:m.data,dialogRef:s};m.templateContext&&(w=Gt(Gt({},w),typeof m.templateContext=="function"?m.templateContext():m.templateContext)),d.attachTemplatePortal(new Fs(n,null,w,_))}else{let _=this._createInjector(m,s,d,this._injector),w=d.attachComponentPortal(new is(n,m.viewContainerRef,_,m.componentFactoryResolver));s.componentRef=w,s.componentInstance=w.instance}}_createInjector(n,s,d,m){let _=n.injector||n.viewContainerRef?.injector,w=[{provide:UQ,useValue:n.data},{provide:xg,useValue:s}];return n.providers&&(typeof n.providers=="function"?w.push(...n.providers(s,n,d)):w.push(...n.providers)),n.direction&&(!_||!_.get(To,null,{optional:!0}))&&w.push({provide:To,useValue:{value:n.direction,change:Fe()}}),uo.create({parent:_||m,providers:w})}_removeOpenDialog(n,s){let d=this.openDialogs.indexOf(n);d>-1&&(this.openDialogs.splice(d,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((m,_)=>{m?_.setAttribute("aria-hidden",m):_.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),s&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){let n=this._overlayContainer.getContainerElement();if(n.parentElement){let s=n.parentElement.children;for(let d=s.length-1;d>-1;d--){let m=s[d];m!==n&&m.nodeName!=="SCRIPT"&&m.nodeName!=="STYLE"&&!m.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(m,m.getAttribute("aria-hidden")),m.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){let n=this._parentDialog;return n?n._getAfterAllClosed():this._afterAllClosedAtThisLevel}};r.\u0275fac=function(s){return new(s||r)(ht($n),ht(uo),ht(HQ,8),ht(r,12),ht(_m),ht(jQ))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function DM(a,r){let l=a.length;for(;l--;)r(a[l])}function qQ(a,r){}var wg=class{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.delayFocusTrap=!0,this.closeOnNavigation=!0}},IM="mdc-dialog--open",NN="mdc-dialog--opening",BN="mdc-dialog--closing",WQ=150,$Q=75,YQ=(()=>{let r=class r extends TM{constructor(n,s,d,m,_,w,S,T,L){super(n,s,d,m,_,w,S,L),this._animationMode=T,this._animationStateChanged=new ye,this._animationsEnabled=this._animationMode!=="NoopAnimations",this._actionSectionCount=0,this._hostElement=this._elementRef.nativeElement,this._enterAnimationDuration=this._animationsEnabled?jN(this._config.enterAnimationDuration)??WQ:0,this._exitAnimationDuration=this._animationsEnabled?jN(this._config.exitAnimationDuration)??$Q:0,this._animationTimer=null,this._finishDialogOpen=()=>{this._clearAnimationClasses(),this._openAnimationDone(this._enterAnimationDuration)},this._finishDialogClose=()=>{this._clearAnimationClasses(),this._animationStateChanged.emit({state:"closed",totalTime:this._exitAnimationDuration})}}_contentAttached(){super._contentAttached(),this._startOpenAnimation()}_startOpenAnimation(){this._animationStateChanged.emit({state:"opening",totalTime:this._enterAnimationDuration}),this._animationsEnabled?(this._hostElement.style.setProperty(VN,`${this._enterAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(NN,IM)),this._waitForAnimationToComplete(this._enterAnimationDuration,this._finishDialogOpen)):(this._hostElement.classList.add(IM),Promise.resolve().then(()=>this._finishDialogOpen()))}_startExitAnimation(){this._animationStateChanged.emit({state:"closing",totalTime:this._exitAnimationDuration}),this._hostElement.classList.remove(IM),this._animationsEnabled?(this._hostElement.style.setProperty(VN,`${this._exitAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(BN)),this._waitForAnimationToComplete(this._exitAnimationDuration,this._finishDialogClose)):Promise.resolve().then(()=>this._finishDialogClose())}_updateActionSectionCount(n){this._actionSectionCount+=n,this._changeDetectorRef.markForCheck()}_clearAnimationClasses(){this._hostElement.classList.remove(NN,BN)}_waitForAnimationToComplete(n,s){this._animationTimer!==null&&clearTimeout(this._animationTimer),this._animationTimer=setTimeout(s,n)}_requestAnimationFrame(n){this._ngZone.runOutsideAngular(()=>{typeof requestAnimationFrame=="function"?requestAnimationFrame(n):n()})}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_openAnimationDone(n){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:n})}ngOnDestroy(){super.ngOnDestroy(),this._animationTimer!==null&&clearTimeout(this._animationTimer)}attachComponentPortal(n){let s=super.attachComponentPortal(n);return s.location.nativeElement.classList.add("mat-mdc-dialog-component-host"),s}};r.\u0275fac=function(s){return new(s||r)(B(Se),B(mg),B(li,8),B(wg),B(hg),B(ze),B(Ec),B(So,8),B(Ls))},r.\u0275cmp=Et({type:r,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1",1,"mat-mdc-dialog-container","mdc-dialog"],hostVars:10,hostBindings:function(s,d){s&2&&(Rs("id",d._config.id),oi("aria-modal",d._config.ariaModal)("role",d._config.role)("aria-labelledby",d._config.ariaLabel?null:d._ariaLabelledByQueue[0])("aria-label",d._config.ariaLabel)("aria-describedby",d._config.ariaDescribedBy||null),ei("_mat-animation-noopable",!d._animationsEnabled)("mat-mdc-dialog-container-with-actions",d._actionSectionCount>0))},standalone:!0,features:[Si,At],decls:3,vars:0,consts:[[1,"mdc-dialog__container"],[1,"mat-mdc-dialog-surface","mdc-dialog__surface"],["cdkPortalOutlet",""]],template:function(s,d){s&1&&(A(0,"div",0)(1,"div",1),mt(2,qQ,0,0,"ng-template",2),k()())},dependencies:[ul],styles:['.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-dialog,.mdc-dialog__scrim{position:fixed;top:0;left:0;align-items:center;justify-content:center;box-sizing:border-box;width:100%;height:100%}.mdc-dialog{display:none;z-index:var(--mdc-dialog-z-index, 7)}.mdc-dialog .mdc-dialog__content{padding:20px 24px 20px 24px}.mdc-dialog .mdc-dialog__surface{min-width:280px}@media(max-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:calc(100vw - 32px)}}@media(min-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:560px}}.mdc-dialog .mdc-dialog__surface{max-height:calc(100% - 32px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-width:none}@media(max-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px;width:560px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 112px)}}@media(max-width: 720px)and (min-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:560px}}@media(max-width: 720px)and (max-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:calc(100vh - 160px)}}@media(max-width: 720px)and (min-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px}}@media(max-width: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-height: 400px),(max-width: 600px),(min-width: 720px)and (max-height: 400px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{height:100%;max-height:100vh;max-width:100vw;width:100vw;border-radius:0}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{order:-1;left:-12px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__header{padding:0 16px 9px;justify-content:flex-start}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__title{margin-left:calc(16px - 2 * 12px)}}@media(min-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 400px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}.mdc-dialog.mdc-dialog__scrim--hidden .mdc-dialog__scrim{opacity:0}.mdc-dialog__scrim{opacity:0;z-index:-1}.mdc-dialog__container{display:flex;flex-direction:row;align-items:center;justify-content:space-around;box-sizing:border-box;height:100%;opacity:0;pointer-events:none}.mdc-dialog__surface{position:relative;display:flex;flex-direction:column;flex-grow:0;flex-shrink:0;box-sizing:border-box;max-width:100%;max-height:100%;pointer-events:auto;overflow-y:auto;outline:0;transform:scale(0.8)}.mdc-dialog__surface .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}[dir=rtl] .mdc-dialog__surface,.mdc-dialog__surface[dir=rtl]{text-align:right}@media screen and (forced-colors: active),(-ms-high-contrast: active){.mdc-dialog__surface{outline:2px solid windowText}}.mdc-dialog__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:2px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-dialog__surface::before{border-color:CanvasText}}@media screen and (-ms-high-contrast: active),screen and (-ms-high-contrast: none){.mdc-dialog__surface::before{content:none}}.mdc-dialog__title{display:block;margin-top:0;position:relative;flex-shrink:0;box-sizing:border-box;margin:0 0 1px;padding:0 24px 9px}.mdc-dialog__title::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}[dir=rtl] .mdc-dialog__title,.mdc-dialog__title[dir=rtl]{text-align:right}.mdc-dialog--scrollable .mdc-dialog__title{margin-bottom:1px;padding-bottom:15px}.mdc-dialog--fullscreen .mdc-dialog__header{align-items:baseline;border-bottom:1px solid rgba(0,0,0,0);display:inline-flex;justify-content:space-between;padding:0 24px 9px;z-index:1}@media screen and (forced-colors: active){.mdc-dialog--fullscreen .mdc-dialog__header{border-bottom-color:CanvasText}}.mdc-dialog--fullscreen .mdc-dialog__header .mdc-dialog__close{right:-12px}.mdc-dialog--fullscreen .mdc-dialog__title{margin-bottom:0;padding:0;border-bottom:0}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__title{border-bottom:0;margin-bottom:0}.mdc-dialog--fullscreen .mdc-dialog__close{top:5px}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--fullscreen--titleless .mdc-dialog__close{margin-top:4px}.mdc-dialog--fullscreen--titleless.mdc-dialog--scrollable .mdc-dialog__close{margin-top:0}.mdc-dialog__content{flex-grow:1;box-sizing:border-box;margin:0;overflow:auto}.mdc-dialog__content>:first-child{margin-top:0}.mdc-dialog__content>:last-child{margin-bottom:0}.mdc-dialog__title+.mdc-dialog__content,.mdc-dialog__header+.mdc-dialog__content{padding-top:0}.mdc-dialog--scrollable .mdc-dialog__title+.mdc-dialog__content{padding-top:8px;padding-bottom:8px}.mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:6px 0 0}.mdc-dialog--scrollable .mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:0}.mdc-dialog__actions{display:flex;position:relative;flex-shrink:0;flex-wrap:wrap;align-items:center;justify-content:flex-end;box-sizing:border-box;min-height:52px;margin:0;padding:8px;border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--stacked .mdc-dialog__actions{flex-direction:column;align-items:flex-end}.mdc-dialog__button{margin-left:8px;margin-right:0;max-width:100%;text-align:right}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{margin-left:0;margin-right:8px}.mdc-dialog__button:first-child{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button:first-child,.mdc-dialog__button:first-child[dir=rtl]{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{text-align:left}.mdc-dialog--stacked .mdc-dialog__button:not(:first-child){margin-top:12px}.mdc-dialog--open,.mdc-dialog--opening,.mdc-dialog--closing{display:flex}.mdc-dialog--opening .mdc-dialog__scrim{transition:opacity 150ms linear}.mdc-dialog--opening .mdc-dialog__container{transition:opacity 75ms linear,transform 150ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-dialog--closing .mdc-dialog__scrim,.mdc-dialog--closing .mdc-dialog__container{transition:opacity 75ms linear}.mdc-dialog--closing .mdc-dialog__container{transform:none}.mdc-dialog--closing .mdc-dialog__surface{transform:none}.mdc-dialog--open .mdc-dialog__scrim{opacity:1}.mdc-dialog--open .mdc-dialog__container{opacity:1}.mdc-dialog--open .mdc-dialog__surface{transform:none}.mdc-dialog--open.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim{opacity:1}.mdc-dialog--open.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{transition:opacity 75ms linear}.mdc-dialog--open.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim{transition:opacity 150ms linear}.mdc-dialog__surface-scrim{display:none;opacity:0;position:absolute;width:100%;height:100%;z-index:1}.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{display:block}.mdc-dialog-scroll-lock{overflow:hidden}.mdc-dialog--no-content-padding .mdc-dialog__content{padding:0}.mdc-dialog--sheet .mdc-dialog__container .mdc-dialog__close{right:12px;top:9px;position:absolute;z-index:1}.mdc-dialog__scrim--removed{pointer-events:none}.mdc-dialog__scrim--removed .mdc-dialog__scrim,.mdc-dialog__scrim--removed .mdc-dialog__surface-scrim{display:none}.mat-mdc-dialog-content{max-height:65vh}.mat-mdc-dialog-container{position:static;display:block}.mat-mdc-dialog-container,.mat-mdc-dialog-container .mdc-dialog__container,.mat-mdc-dialog-container .mdc-dialog__surface{max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit}.mat-mdc-dialog-container .mdc-dialog__surface{width:100%;height:100%}.mat-mdc-dialog-component-host{display:contents}.mat-mdc-dialog-container{--mdc-dialog-container-elevation: var(--mdc-dialog-container-elevation-shadow);outline:0}.mat-mdc-dialog-container .mdc-dialog__surface{background-color:var(--mdc-dialog-container-color, white)}.mat-mdc-dialog-container .mdc-dialog__surface{box-shadow:var(--mdc-dialog-container-elevation, 0px 11px 15px -7px rgba(0, 0, 0, 0.2), 0px 24px 38px 3px rgba(0, 0, 0, 0.14), 0px 9px 46px 8px rgba(0, 0, 0, 0.12))}.mat-mdc-dialog-container .mdc-dialog__surface{border-radius:var(--mdc-dialog-container-shape, 4px)}.mat-mdc-dialog-container .mdc-dialog__title{font-family:var(--mdc-dialog-subhead-font, Roboto, sans-serif);line-height:var(--mdc-dialog-subhead-line-height, 1.5rem);font-size:var(--mdc-dialog-subhead-size, 1rem);font-weight:var(--mdc-dialog-subhead-weight, 400);letter-spacing:var(--mdc-dialog-subhead-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__title{color:var(--mdc-dialog-subhead-color, rgba(0, 0, 0, 0.87))}.mat-mdc-dialog-container .mdc-dialog__content{font-family:var(--mdc-dialog-supporting-text-font, Roboto, sans-serif);line-height:var(--mdc-dialog-supporting-text-line-height, 1.5rem);font-size:var(--mdc-dialog-supporting-text-size, 1rem);font-weight:var(--mdc-dialog-supporting-text-weight, 400);letter-spacing:var(--mdc-dialog-supporting-text-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__content{color:var(--mdc-dialog-supporting-text-color, rgba(0, 0, 0, 0.6))}.mat-mdc-dialog-container .mdc-dialog__container{transition:opacity linear var(--mat-dialog-transition-duration, 0ms)}.mat-mdc-dialog-container .mdc-dialog__surface{transition:transform var(--mat-dialog-transition-duration, 0ms) 0ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-dialog-container._mat-animation-noopable .mdc-dialog__container,.mat-mdc-dialog-container._mat-animation-noopable .mdc-dialog__surface{transition:none}.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-max-width, 80vw);min-width:var(--mat-dialog-container-min-width, 0)}@media(max-width: 599px){.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-small-max-width, 80vw)}}.mat-mdc-dialog-title{padding:var(--mat-dialog-headline-padding, 0 24px 9px)}.mat-mdc-dialog-content{display:block}.mat-mdc-dialog-container .mat-mdc-dialog-content{padding:var(--mat-dialog-content-padding, 20px 24px)}.mat-mdc-dialog-container-with-actions .mat-mdc-dialog-content{padding:var(--mat-dialog-with-actions-content-padding, 20px 24px)}.mat-mdc-dialog-container .mat-mdc-dialog-title+.mat-mdc-dialog-content{padding-top:0}.mat-mdc-dialog-actions{padding:var(--mat-dialog-actions-padding, 8px);justify-content:var(--mat-dialog-actions-alignment, start)}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-start,.mat-mdc-dialog-actions[align=start]{justify-content:start}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-center,.mat-mdc-dialog-actions[align=center]{justify-content:center}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-end,.mat-mdc-dialog-actions[align=end]{justify-content:flex-end}.mat-mdc-dialog-actions .mat-button-base+.mat-button-base,.mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-mdc-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}'],encapsulation:2});let a=r;return a})(),VN="--mat-dialog-transition-duration";function jN(a){return a==null?null:typeof a=="number"?a:a.endsWith("ms")?Hl(a.substring(0,a.length-2)):a.endsWith("s")?Hl(a.substring(0,a.length-1))*1e3:a==="0"?0:null}var Zy=function(a){return a[a.OPEN=0]="OPEN",a[a.CLOSING=1]="CLOSING",a[a.CLOSED=2]="CLOSED",a}(Zy||{}),Qn=class{constructor(r,l,n){this._ref=r,this._containerInstance=n,this._afterOpened=new pe,this._beforeClosed=new pe,this._state=Zy.OPEN,this.disableClose=l.disableClose,this.id=r.id,r.addPanelClass("mat-mdc-dialog-panel"),n._animationStateChanged.pipe(wn(s=>s.state==="opened"),Ji(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),n._animationStateChanged.pipe(wn(s=>s.state==="closed"),Ji(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),r.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),io(this.backdropClick(),this.keydownEvents().pipe(wn(s=>s.keyCode===27&&!this.disableClose&&!Zr(s)))).subscribe(s=>{this.disableClose||(s.preventDefault(),ZQ(this,s.type==="keydown"?"keyboard":"mouse"))})}close(r){this._result=r,this._containerInstance._animationStateChanged.pipe(wn(l=>l.state==="closing"),Ji(1)).subscribe(l=>{this._beforeClosed.next(r),this._beforeClosed.complete(),this._ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),l.totalTime+100)}),this._state=Zy.CLOSING,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}updatePosition(r){let l=this._ref.config.positionStrategy;return r&&(r.left||r.right)?r.left?l.left(r.left):l.right(r.right):l.centerHorizontally(),r&&(r.top||r.bottom)?r.top?l.top(r.top):l.bottom(r.bottom):l.centerVertically(),this._ref.updatePosition(),this}updateSize(r="",l=""){return this._ref.updateSize(r,l),this}addPanelClass(r){return this._ref.addPanelClass(r),this}removePanelClass(r){return this._ref.removePanelClass(r),this}getState(){return this._state}_finishDialogClose(){this._state=Zy.CLOSED,this._ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}};function ZQ(a,r,l){return a._closeInteractionType=r,a.close(l)}var jr=new we("MatMdcDialogData"),XQ=new we("mat-mdc-dialog-default-options"),KQ=new we("mat-mdc-dialog-scroll-strategy",{providedIn:"root",factory:()=>{let a=oe($n);return()=>a.scrollStrategies.block()}});var QQ=0,fo=(()=>{let r=class r{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){let n=this._parentDialog;return n?n._getAfterAllClosed():this._afterAllClosedAtThisLevel}constructor(n,s,d,m,_,w,S,T){this._overlay=n,this._defaultOptions=m,this._scrollStrategy=_,this._parentDialog=w,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new pe,this._afterOpenedAtThisLevel=new pe,this.dialogConfigClass=wg,this.afterAllClosed=xc(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(co(void 0))),this._dialog=s.get(zN),this._dialogRefConstructor=Qn,this._dialogContainerType=YQ,this._dialogDataToken=jr}open(n,s){let d;s=Gt(Gt({},this._defaultOptions||new wg),s),s.id=s.id||`mat-mdc-dialog-${QQ++}`,s.scrollStrategy=s.scrollStrategy||this._scrollStrategy();let m=this._dialog.open(n,Ri(Gt({},s),{positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,closeOnOverlayDetachments:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:this.dialogConfigClass,useValue:s},{provide:Lu,useValue:s}]},templateContext:()=>({dialogRef:d}),providers:(_,w,S)=>(d=new this._dialogRefConstructor(_,s,S),d.updatePosition(s?.position),[{provide:this._dialogContainerType,useValue:S},{provide:this._dialogDataToken,useValue:w.data},{provide:this._dialogRefConstructor,useValue:d}])}));return d.componentRef=m.componentRef,d.componentInstance=m.componentInstance,this.openDialogs.push(d),this.afterOpened.next(d),d.afterClosed().subscribe(()=>{let _=this.openDialogs.indexOf(d);_>-1&&(this.openDialogs.splice(_,1),this.openDialogs.length||this._getAfterAllClosed().next())}),d}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(n){return this.openDialogs.find(s=>s.id===n)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(n){let s=n.length;for(;s--;)n[s].close()}};r.\u0275fac=function(s){return new(s||r)(ht($n),ht(uo),ht(Bl,8),ht(XQ,8),ht(KQ),ht(r,12),ht(_m),ht(So,8))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function JQ(a,r){a&1&&(A(0,"div",17),dt(1,"i",18),k())}var tJ=(a,r)=>({selected:a,disabled:r});function eJ(a,r){if(a&1){let l=Ce();A(0,"div",11),ct("click",function(){let d=te(l).$implicit,m=vt();return ee(m.onCardClick(d))}),dt(1,"img",12),A(2,"div",13)(3,"h5",14),V(4),k(),A(5,"p",15),V(6),k()(),mt(7,JQ,2,0,"div",16),k()}if(a&2){let l=r.$implicit;Z("ngClass",Jh(6,tJ,l.toBeSelected,l.selected)),N(),Z("src",l.imageUrl,Tr),N(3),De(l.title),N(2),Fo("",l.location.name," | ",l.date,""),N(),Z("ngIf",l.toBeSelected||l.selected)}}var UN=(()=>{let r=class r{constructor(n,s){this.homeAdminService=n,this.dialogRef=s,this.eventList=[],this.filteredEventList=[],this.searchText=""}ngOnInit(){return It(this,null,function*(){yield this.homeAdminService.fetchEventListForSelection(),this.eventListSubscription=this.homeAdminService.getEventListForSelection().subscribe(n=>{this.eventList=n,this.filteredEventList=n})})}ngOnDestroy(){this.eventListSubscription?.unsubscribe()}searchEvent(){this.filteredEventList=this.eventList.filter(n=>n.title.toLowerCase().includes(this.searchText.toLowerCase()))}onConfirmClick(){let n=this.eventList.filter(s=>s.toBeSelected).map(s=>s.id);this.dialogRef.close(n)}onCardClick(n){(n.selected===null||n.selected===!1)&&(n.toBeSelected=!n.toBeSelected)}onCloseClick(){this.dialogRef.close()}};r.\u0275fac=function(s){return new(s||r)(B(Yy),B(Qn))},r.\u0275cmp=Et({type:r,selectors:[["app-add-top-event"]],standalone:!0,features:[At],decls:14,vars:2,consts:[[1,"container-fluid"],[1,"input-group","rounded","pt-2"],["type","search","placeholder","Cauta","aria-label","Search","aria-describedby","search-addon",1,"form-control","rounded",3,"ngModel","ngModelChange"],["id","search-addon",1,"input-group-text","border-0"],[1,"fas","fa-search"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"text-center","mb-2","mt-2"],[1,"cards-container"],["class","card",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"btn","btn-danger","mt-2","mb-4","me-3",3,"click"],[1,"btn","btn-primary","mt-2","mb-4",3,"click"],[1,"card",3,"ngClass","click"],["alt","...",1,"card-img-top",3,"src"],[1,"card-body"],[1,"card-title"],[1,"card-text"],["class","icon-container",4,"ngIf"],[1,"icon-container"],[1,"fa-solid","fa-check","fa-lg"]],template:function(s,d){s&1&&(A(0,"div",0)(1,"div",1)(2,"input",2),kn("ngModelChange",function(_){return An(d.searchText,_)||(d.searchText=_),_}),ct("ngModelChange",function(){return d.searchEvent()}),k(),A(3,"span",3),dt(4,"i",4),k(),A(5,"button",5),ct("click",function(){return d.onCloseClick()}),k()(),A(6,"h1",6),V(7,"Evenimente"),k(),A(8,"div",7),mt(9,eJ,8,9,"div",8),k(),A(10,"button",9),ct("click",function(){return d.onCloseClick()}),V(11,"Anuleaza"),k(),A(12,"button",10),ct("click",function(){return d.onConfirmClick()}),V(13,"Adauga"),k()()),s&2&&(N(2),In("ngModel",d.searchText),N(7),Z("ngForOf",d.filteredEventList))},dependencies:[Yi,en,ji,jo,Ii,Zo,qe],styles:[".cards-container[_ngcontent-%COMP%]{max-height:500px;overflow-y:auto}.card[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 2fr 1fr;border:1px solid #ccc;margin:10px;cursor:pointer}.card[_ngcontent-%COMP%]:hover{background-color:#f4f4f4;box-shadow:0 0 10px #0000001a}.card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:100%;object-fit:contain}.selected[_ngcontent-%COMP%]{opacity:70%}.icon-container[_ngcontent-%COMP%]{display:flex;justify-content:right;align-items:flex-end}i[_ngcontent-%COMP%]{margin:15px}.disabled[_ngcontent-%COMP%]{cursor:not-allowed}"]});let a=r;return a})();function iJ(a,r){if(a&1){let l=Ce();A(0,"div",4)(1,"button",5),ct("click",function(){let d=te(l).$implicit,m=vt();return ee(m.deleteTopEvent(d))}),dt(2,"i",6),k(),dt(3,"img",7),A(4,"div",8)(5,"h5",9),V(6),k(),A(7,"p",10),V(8),k()()()}if(a&2){let l=r.$implicit;N(3),hs("src",l.imageUrl,Tr),N(3),De(l.title),N(2),Fo("",l.location.name," | ",l.date,"")}}var HN=(()=>{let r=class r{constructor(n,s,d){this.homeAdminService=n,this.snackBar=s,this.dialog=d,this.selectedEventList=[]}ngOnInit(){return It(this,null,function*(){yield this.homeAdminService.fetchSelectedEvents(),this.selectedEventListSubscription=this.homeAdminService.getSelectedEventList().subscribe(n=>{this.selectedEventList=n})})}ngOnDestroy(){this.selectedEventListSubscription?.unsubscribe()}addTopEvent(){this.dialog.open(UN,{width:"60%"}).afterClosed().subscribe(s=>It(this,null,function*(){s.length>0&&(yield this.homeAdminService.addSelectedEventList(s))}))}deleteTopEvent(n){return It(this,null,function*(){yield this.homeAdminService.deleteSelectedEvent(n.id)})}};r.\u0275fac=function(s){return new(s||r)(B(Yy),B(Je),B(fo))},r.\u0275cmp=Et({type:r,selectors:[["app-home-admin"]],standalone:!0,features:[At],decls:7,vars:1,consts:[[1,"container-fluid"],["id","btnAddEvent",1,"btn","btn-primary",3,"click"],[1,"cards-container"],["class","card",4,"ngFor","ngForOf"],[1,"card"],[1,"btn","btn-danger","btn-delete",3,"click"],[1,"fa","fa-x"],["alt","",1,"card-img-top",3,"src"],[1,"card-body"],[1,"card-title"],[1,"card-text"]],template:function(s,d){s&1&&(A(0,"div",0)(1,"h1"),V(2,"Recommended events"),k(),A(3,"button",1),ct("click",function(){return d.addTopEvent()}),V(4,"Add event"),k(),A(5,"div",2),mt(6,iJ,9,4,"div",3),k()()),s&2&&(N(6),Z("ngForOf",d.selectedEventList))},dependencies:[Ii],styles:[".cards-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;flex-wrap:wrap;margin-top:50px}.card[_ngcontent-%COMP%]{margin:20px;padding:20px;border-radius:10px;box-shadow:0 4px 8px #0003;transition:.3s;background-color:#f5f5f5;color:#000;text-align:center;font-size:20px;font-weight:700;width:300px}.btn-delete[_ngcontent-%COMP%]{width:30px;height:28px;padding:0;position:absolute;top:0;right:0;opacity:0;transition:opacity .5s ease}.card[_ngcontent-%COMP%]:hover   .btn-delete[_ngcontent-%COMP%]{opacity:1}"]});let a=r;return a})();function Wl(){}var rB=function(){let a=0;return function(){return a++}}();function Pn(a){return a===null||typeof a>"u"}function kr(a){if(Array.isArray&&Array.isArray(a))return!0;let r=Object.prototype.toString.call(a);return r.slice(0,7)==="[object"&&r.slice(-6)==="Array]"}function bn(a){return a!==null&&Object.prototype.toString.call(a)==="[object Object]"}var go=a=>(typeof a=="number"||a instanceof Number)&&isFinite(+a);function ta(a,r){return go(a)?a:r}function nn(a,r){return typeof a>"u"?r:a}var oB=(a,r)=>typeof a=="string"&&a.endsWith("%")?parseFloat(a)/100:a/r,zM=(a,r)=>typeof a=="string"&&a.endsWith("%")?parseFloat(a)/100*r:+a;function Rr(a,r,l){if(a&&typeof a.call=="function")return a.apply(l,r)}function lr(a,r,l,n){let s,d,m;if(kr(a))if(d=a.length,n)for(s=d-1;s>=0;s--)r.call(l,a[s],s);else for(s=0;s<d;s++)r.call(l,a[s],s);else if(bn(a))for(m=Object.keys(a),d=m.length,s=0;s<d;s++)r.call(l,a[m[s]],m[s])}function Dg(a,r){let l,n,s,d;if(!a||!r||a.length!==r.length)return!1;for(l=0,n=a.length;l<n;++l)if(s=a[l],d=r[l],s.datasetIndex!==d.datasetIndex||s.index!==d.index)return!1;return!0}function eb(a){if(kr(a))return a.map(eb);if(bn(a)){let r=Object.create(null),l=Object.keys(a),n=l.length,s=0;for(;s<n;++s)r[l[s]]=eb(a[l[s]]);return r}return a}function sB(a){return["__proto__","prototype","constructor"].indexOf(a)===-1}function nJ(a,r,l,n){if(!sB(a))return;let s=r[a],d=l[a];bn(s)&&bn(d)?Pm(s,d,n):r[a]=eb(d)}function Pm(a,r,l){let n=kr(r)?r:[r],s=n.length;if(!bn(a))return a;l=l||{};let d=l.merger||nJ;for(let m=0;m<s;++m){if(r=n[m],!bn(r))continue;let _=Object.keys(r);for(let w=0,S=_.length;w<S;++w)d(_[w],a,r,l)}return a}function Lm(a,r){return Pm(a,r,{merger:rJ})}function rJ(a,r,l){if(!sB(a))return;let n=r[a],s=l[a];bn(n)&&bn(s)?Lm(n,s):Object.prototype.hasOwnProperty.call(r,a)||(r[a]=eb(s))}var GN={"":a=>a,x:a=>a.x,y:a=>a.y};function Rc(a,r){return(GN[r]||(GN[r]=oJ(r)))(a)}function oJ(a){let r=sJ(a);return l=>{for(let n of r){if(n==="")break;l=l&&l[n]}return l}}function sJ(a){let r=a.split("."),l=[],n="";for(let s of r)n+=s,n.endsWith("\\")?n=n.slice(0,-1)+".":(l.push(n),n="");return l}function ob(a){return a.charAt(0).toUpperCase()+a.slice(1)}var Js=a=>typeof a<"u",kc=a=>typeof a=="function",NM=(a,r)=>{if(a.size!==r.size)return!1;for(let l of a)if(!r.has(l))return!1;return!0};function aB(a){return a.type==="mouseup"||a.type==="click"||a.type==="contextmenu"}var Ur=Math.PI,mr=2*Ur,aJ=mr+Ur,ib=Number.POSITIVE_INFINITY,lJ=Ur/180,ao=Ur/2,Cg=Ur/4,qN=Ur*2/3,ea=Math.log10,_l=Math.sign;function BM(a){let r=Math.round(a);a=zm(a,r,a/1e3)?r:a;let l=Math.pow(10,Math.floor(ea(a))),n=a/l;return(n<=1?1:n<=2?2:n<=5?5:10)*l}function lB(a){let r=[],l=Math.sqrt(a),n;for(n=1;n<l;n++)a%n===0&&(r.push(n),r.push(a/n));return l===(l|0)&&r.push(l),r.sort((s,d)=>s-d).pop(),r}function Bu(a){return!isNaN(parseFloat(a))&&isFinite(a)}function zm(a,r,l){return Math.abs(a-r)<l}function cB(a,r){let l=Math.round(a);return l-r<=a&&l+r>=a}function VM(a,r,l){let n,s,d;for(n=0,s=a.length;n<s;n++)d=a[n][l],isNaN(d)||(r.min=Math.min(r.min,d),r.max=Math.max(r.max,d))}function Ia(a){return a*(Ur/180)}function sb(a){return a*(180/Ur)}function jM(a){if(!go(a))return;let r=1,l=0;for(;Math.round(a*r)/r!==a;)r*=10,l++;return l}function UM(a,r){let l=r.x-a.x,n=r.y-a.y,s=Math.sqrt(l*l+n*n),d=Math.atan2(n,l);return d<-.5*Ur&&(d+=mr),{angle:d,distance:s}}function nb(a,r){return Math.sqrt(Math.pow(r.x-a.x,2)+Math.pow(r.y-a.y,2))}function cJ(a,r){return(a-r+aJ)%mr-Ur}function Bs(a){return(a%mr+mr)%mr}function Nm(a,r,l,n){let s=Bs(a),d=Bs(r),m=Bs(l),_=Bs(d-s),w=Bs(m-s),S=Bs(s-d),T=Bs(s-m);return s===d||s===m||n&&d===m||_>w&&S<T}function Uo(a,r,l){return Math.max(r,Math.min(l,a))}function dB(a){return Uo(a,-32768,32767)}function $l(a,r,l,n=1e-6){return a>=Math.min(r,l)-n&&a<=Math.max(r,l)+n}function ab(a,r,l){l=l||(m=>a[m]<r);let n=a.length-1,s=0,d;for(;n-s>1;)d=s+n>>1,l(d)?s=d:n=d;return{lo:s,hi:n}}var ql=(a,r,l,n)=>ab(a,l,n?s=>a[s][r]<=l:s=>a[s][r]<l),uB=(a,r,l)=>ab(a,l,n=>a[n][r]>=l);function hB(a,r,l){let n=0,s=a.length;for(;n<s&&a[n]<r;)n++;for(;s>n&&a[s-1]>l;)s--;return n>0||s<a.length?a.slice(n,s):a}var mB=["push","pop","shift","splice","unshift"];function pB(a,r){if(a._chartjs){a._chartjs.listeners.push(r);return}Object.defineProperty(a,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[r]}}),mB.forEach(l=>{let n="_onData"+ob(l),s=a[l];Object.defineProperty(a,l,{configurable:!0,enumerable:!1,value(...d){let m=s.apply(this,d);return a._chartjs.listeners.forEach(_=>{typeof _[n]=="function"&&_[n](...d)}),m}})})}function HM(a,r){let l=a._chartjs;if(!l)return;let n=l.listeners,s=n.indexOf(r);s!==-1&&n.splice(s,1),!(n.length>0)&&(mB.forEach(d=>{delete a[d]}),delete a._chartjs)}function GM(a){let r=new Set,l,n;for(l=0,n=a.length;l<n;++l)r.add(a[l]);return r.size===n?a:Array.from(r)}var qM=function(){return typeof window>"u"?function(a){return a()}:window.requestAnimationFrame}();function WM(a,r,l){let n=l||(m=>Array.prototype.slice.call(m)),s=!1,d=[];return function(...m){d=n(m),s||(s=!0,qM.call(window,()=>{s=!1,a.apply(r,d)}))}}function fB(a,r){let l;return function(...n){return r?(clearTimeout(l),l=setTimeout(a,r,n)):a.apply(this,n),r}}var lb=a=>a==="start"?"left":a==="end"?"right":"center",Qo=(a,r,l)=>a==="start"?r:a==="end"?l:(r+l)/2,gB=(a,r,l,n)=>a===(n?"left":"right")?l:a==="center"?(r+l)/2:r;function $M(a,r,l){let n=r.length,s=0,d=n;if(a._sorted){let{iScale:m,_parsed:_}=a,w=m.axis,{min:S,max:T,minDefined:L,maxDefined:H}=m.getUserBounds();L&&(s=Uo(Math.min(ql(_,m.axis,S).lo,l?n:ql(r,w,m.getPixelForValue(S)).lo),0,n-1)),H?d=Uo(Math.max(ql(_,m.axis,T,!0).hi+1,l?0:ql(r,w,m.getPixelForValue(T),!0).hi+1),s,n)-s:d=n-s}return{start:s,count:d}}function YM(a){let{xScale:r,yScale:l,_scaleRanges:n}=a,s={xmin:r.min,xmax:r.max,ymin:l.min,ymax:l.max};if(!n)return a._scaleRanges=s,!0;let d=n.xmin!==r.min||n.xmax!==r.max||n.ymin!==l.min||n.ymax!==l.max;return Object.assign(n,s),d}var Xy=a=>a===0||a===1,WN=(a,r,l)=>-(Math.pow(2,10*(a-=1))*Math.sin((a-r)*mr/l)),$N=(a,r,l)=>Math.pow(2,-10*a)*Math.sin((a-r)*mr/l)+1,Rm={linear:a=>a,easeInQuad:a=>a*a,easeOutQuad:a=>-a*(a-2),easeInOutQuad:a=>(a/=.5)<1?.5*a*a:-.5*(--a*(a-2)-1),easeInCubic:a=>a*a*a,easeOutCubic:a=>(a-=1)*a*a+1,easeInOutCubic:a=>(a/=.5)<1?.5*a*a*a:.5*((a-=2)*a*a+2),easeInQuart:a=>a*a*a*a,easeOutQuart:a=>-((a-=1)*a*a*a-1),easeInOutQuart:a=>(a/=.5)<1?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2),easeInQuint:a=>a*a*a*a*a,easeOutQuint:a=>(a-=1)*a*a*a*a+1,easeInOutQuint:a=>(a/=.5)<1?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2),easeInSine:a=>-Math.cos(a*ao)+1,easeOutSine:a=>Math.sin(a*ao),easeInOutSine:a=>-.5*(Math.cos(Ur*a)-1),easeInExpo:a=>a===0?0:Math.pow(2,10*(a-1)),easeOutExpo:a=>a===1?1:-Math.pow(2,-10*a)+1,easeInOutExpo:a=>Xy(a)?a:a<.5?.5*Math.pow(2,10*(a*2-1)):.5*(-Math.pow(2,-10*(a*2-1))+2),easeInCirc:a=>a>=1?a:-(Math.sqrt(1-a*a)-1),easeOutCirc:a=>Math.sqrt(1-(a-=1)*a),easeInOutCirc:a=>(a/=.5)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1),easeInElastic:a=>Xy(a)?a:WN(a,.075,.3),easeOutElastic:a=>Xy(a)?a:$N(a,.075,.3),easeInOutElastic(a){return Xy(a)?a:a<.5?.5*WN(a*2,.1125,.45):.5+.5*$N(a*2-1,.1125,.45)},easeInBack(a){return a*a*((1.70158+1)*a-1.70158)},easeOutBack(a){return(a-=1)*a*((1.70158+1)*a+1.70158)+1},easeInOutBack(a){let r=1.70158;return(a/=.5)<1?.5*(a*a*(((r*=1.525)+1)*a-r)):.5*((a-=2)*a*(((r*=1.525)+1)*a+r)+2)},easeInBounce:a=>1-Rm.easeOutBounce(1-a),easeOutBounce(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},easeInOutBounce:a=>a<.5?Rm.easeInBounce(a*2)*.5:Rm.easeOutBounce(a*2-1)*.5+.5};function Tg(a){return a+.5|0}var Md=(a,r,l)=>Math.max(Math.min(a,l),r);function Sg(a){return Md(Tg(a*2.55),0,255)}function Dd(a){return Md(Tg(a*255),0,255)}function Ac(a){return Md(Tg(a/2.55)/100,0,1)}function YN(a){return Md(Tg(a*100),0,100)}var Ta={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},OM=[..."0123456789ABCDEF"],dJ=a=>OM[a&15],uJ=a=>OM[(a&240)>>4]+OM[a&15],Ky=a=>(a&240)>>4===(a&15),hJ=a=>Ky(a.r)&&Ky(a.g)&&Ky(a.b)&&Ky(a.a);function mJ(a){var r=a.length,l;return a[0]==="#"&&(r===4||r===5?l={r:255&Ta[a[1]]*17,g:255&Ta[a[2]]*17,b:255&Ta[a[3]]*17,a:r===5?Ta[a[4]]*17:255}:(r===7||r===9)&&(l={r:Ta[a[1]]<<4|Ta[a[2]],g:Ta[a[3]]<<4|Ta[a[4]],b:Ta[a[5]]<<4|Ta[a[6]],a:r===9?Ta[a[7]]<<4|Ta[a[8]]:255})),l}var pJ=(a,r)=>a<255?r(a):"";function fJ(a){var r=hJ(a)?dJ:uJ;return a?"#"+r(a.r)+r(a.g)+r(a.b)+pJ(a.a,r):void 0}var gJ=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function _B(a,r,l){let n=r*Math.min(l,1-l),s=(d,m=(d+a/30)%12)=>l-n*Math.max(Math.min(m-3,9-m,1),-1);return[s(0),s(8),s(4)]}function _J(a,r,l){let n=(s,d=(s+a/60)%6)=>l-l*r*Math.max(Math.min(d,4-d,1),0);return[n(5),n(3),n(1)]}function vJ(a,r,l){let n=_B(a,1,.5),s;for(r+l>1&&(s=1/(r+l),r*=s,l*=s),s=0;s<3;s++)n[s]*=1-r-l,n[s]+=r;return n}function yJ(a,r,l,n,s){return a===s?(r-l)/n+(r<l?6:0):r===s?(l-a)/n+2:(a-r)/n+4}function ZM(a){let l=a.r/255,n=a.g/255,s=a.b/255,d=Math.max(l,n,s),m=Math.min(l,n,s),_=(d+m)/2,w,S,T;return d!==m&&(T=d-m,S=_>.5?T/(2-d-m):T/(d+m),w=yJ(l,n,s,T,d),w=w*60+.5),[w|0,S||0,_]}function XM(a,r,l,n){return(Array.isArray(r)?a(r[0],r[1],r[2]):a(r,l,n)).map(Dd)}function KM(a,r,l){return XM(_B,a,r,l)}function bJ(a,r,l){return XM(vJ,a,r,l)}function xJ(a,r,l){return XM(_J,a,r,l)}function vB(a){return(a%360+360)%360}function wJ(a){let r=gJ.exec(a),l=255,n;if(!r)return;r[5]!==n&&(l=r[6]?Sg(+r[5]):Dd(+r[5]));let s=vB(+r[2]),d=+r[3]/100,m=+r[4]/100;return r[1]==="hwb"?n=bJ(s,d,m):r[1]==="hsv"?n=xJ(s,d,m):n=KM(s,d,m),{r:n[0],g:n[1],b:n[2],a:l}}function CJ(a,r){var l=ZM(a);l[0]=vB(l[0]+r),l=KM(l),a.r=l[0],a.g=l[1],a.b=l[2]}function SJ(a){if(!a)return;let r=ZM(a),l=r[0],n=YN(r[1]),s=YN(r[2]);return a.a<255?`hsla(${l}, ${n}%, ${s}%, ${Ac(a.a)})`:`hsl(${l}, ${n}%, ${s}%)`}var ZN={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},XN={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function EJ(){let a={},r=Object.keys(XN),l=Object.keys(ZN),n,s,d,m,_;for(n=0;n<r.length;n++){for(m=_=r[n],s=0;s<l.length;s++)d=l[s],_=_.replace(d,ZN[d]);d=parseInt(XN[m],16),a[_]=[d>>16&255,d>>8&255,d&255]}return a}var Qy;function MJ(a){Qy||(Qy=EJ(),Qy.transparent=[0,0,0,0]);let r=Qy[a.toLowerCase()];return r&&{r:r[0],g:r[1],b:r[2],a:r.length===4?r[3]:255}}var DJ=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function TJ(a){let r=DJ.exec(a),l=255,n,s,d;if(r){if(r[7]!==n){let m=+r[7];l=r[8]?Sg(m):Md(m*255,0,255)}return n=+r[1],s=+r[3],d=+r[5],n=255&(r[2]?Sg(n):Md(n,0,255)),s=255&(r[4]?Sg(s):Md(s,0,255)),d=255&(r[6]?Sg(d):Md(d,0,255)),{r:n,g:s,b:d,a:l}}}function IJ(a){return a&&(a.a<255?`rgba(${a.r}, ${a.g}, ${a.b}, ${Ac(a.a)})`:`rgb(${a.r}, ${a.g}, ${a.b})`)}var AM=a=>a<=.0031308?a*12.92:Math.pow(a,1/2.4)*1.055-.055,km=a=>a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4);function AJ(a,r,l){let n=km(Ac(a.r)),s=km(Ac(a.g)),d=km(Ac(a.b));return{r:Dd(AM(n+l*(km(Ac(r.r))-n))),g:Dd(AM(s+l*(km(Ac(r.g))-s))),b:Dd(AM(d+l*(km(Ac(r.b))-d))),a:a.a+l*(r.a-a.a)}}function Jy(a,r,l){if(a){let n=ZM(a);n[r]=Math.max(0,Math.min(n[r]+n[r]*l,r===0?360:1)),n=KM(n),a.r=n[0],a.g=n[1],a.b=n[2]}}function yB(a,r){return a&&Object.assign(r||{},a)}function KN(a){var r={r:0,g:0,b:0,a:255};return Array.isArray(a)?a.length>=3&&(r={r:a[0],g:a[1],b:a[2],a:255},a.length>3&&(r.a=Dd(a[3]))):(r=yB(a,{r:0,g:0,b:0,a:1}),r.a=Dd(r.a)),r}function kJ(a){return a.charAt(0)==="r"?TJ(a):wJ(a)}var FM=class a{constructor(r){if(r instanceof a)return r;let l=typeof r,n;l==="object"?n=KN(r):l==="string"&&(n=mJ(r)||MJ(r)||kJ(r)),this._rgb=n,this._valid=!!n}get valid(){return this._valid}get rgb(){var r=yB(this._rgb);return r&&(r.a=Ac(r.a)),r}set rgb(r){this._rgb=KN(r)}rgbString(){return this._valid?IJ(this._rgb):void 0}hexString(){return this._valid?fJ(this._rgb):void 0}hslString(){return this._valid?SJ(this._rgb):void 0}mix(r,l){if(r){let n=this.rgb,s=r.rgb,d,m=l===d?.5:l,_=2*m-1,w=n.a-s.a,S=((_*w===-1?_:(_+w)/(1+_*w))+1)/2;d=1-S,n.r=255&S*n.r+d*s.r+.5,n.g=255&S*n.g+d*s.g+.5,n.b=255&S*n.b+d*s.b+.5,n.a=m*n.a+(1-m)*s.a,this.rgb=n}return this}interpolate(r,l){return r&&(this._rgb=AJ(this._rgb,r._rgb,l)),this}clone(){return new a(this.rgb)}alpha(r){return this._rgb.a=Dd(r),this}clearer(r){let l=this._rgb;return l.a*=1-r,this}greyscale(){let r=this._rgb,l=Tg(r.r*.3+r.g*.59+r.b*.11);return r.r=r.g=r.b=l,this}opaquer(r){let l=this._rgb;return l.a*=1+r,this}negate(){let r=this._rgb;return r.r=255-r.r,r.g=255-r.g,r.b=255-r.b,this}lighten(r){return Jy(this._rgb,2,r),this}darken(r){return Jy(this._rgb,2,-r),this}saturate(r){return Jy(this._rgb,1,r),this}desaturate(r){return Jy(this._rgb,1,-r),this}rotate(r){return CJ(this._rgb,r),this}};function bB(a){return new FM(a)}function xB(a){if(a&&typeof a=="object"){let r=a.toString();return r==="[object CanvasPattern]"||r==="[object CanvasGradient]"}return!1}function QM(a){return xB(a)?a:bB(a)}function kM(a){return xB(a)?a:bB(a).saturate(.5).darken(.1).hexString()}var Td=Object.create(null),cb=Object.create(null);function Eg(a,r){if(!r)return a;let l=r.split(".");for(let n=0,s=l.length;n<s;++n){let d=l[n];a=a[d]||(a[d]=Object.create(null))}return a}function RM(a,r,l){return typeof r=="string"?Pm(Eg(a,r),l):Pm(Eg(a,""),r)}var LM=class{constructor(r){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=l=>l.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(l,n)=>kM(n.backgroundColor),this.hoverBorderColor=(l,n)=>kM(n.borderColor),this.hoverColor=(l,n)=>kM(n.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(r)}set(r,l){return RM(this,r,l)}get(r){return Eg(this,r)}describe(r,l){return RM(cb,r,l)}override(r,l){return RM(Td,r,l)}route(r,l,n,s){let d=Eg(this,r),m=Eg(this,n),_="_"+l;Object.defineProperties(d,{[_]:{value:d[l],writable:!0},[l]:{enumerable:!0,get(){let w=this[_],S=m[s];return bn(w)?Object.assign({},S,w):nn(w,S)},set(w){this[_]=w}}})}},xn=new LM({_scriptable:a=>!a.startsWith("on"),_indexable:a=>a!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}});function RJ(a){return!a||Pn(a.size)||Pn(a.family)?null:(a.style?a.style+" ":"")+(a.weight?a.weight+" ":"")+a.size+"px "+a.family}function Mg(a,r,l,n,s){let d=r[s];return d||(d=r[s]=a.measureText(s).width,l.push(s)),d>n&&(n=d),n}function wB(a,r,l,n){n=n||{};let s=n.data=n.data||{},d=n.garbageCollect=n.garbageCollect||[];n.font!==r&&(s=n.data={},d=n.garbageCollect=[],n.font=r),a.save(),a.font=r;let m=0,_=l.length,w,S,T,L,H;for(w=0;w<_;w++)if(L=l[w],L!=null&&kr(L)!==!0)m=Mg(a,s,d,m,L);else if(kr(L))for(S=0,T=L.length;S<T;S++)H=L[S],H!=null&&!kr(H)&&(m=Mg(a,s,d,m,H));a.restore();let q=d.length/2;if(q>l.length){for(w=0;w<q;w++)delete s[d[w]];d.splice(0,q)}return m}function Id(a,r,l){let n=a.currentDevicePixelRatio,s=l!==0?Math.max(l/2,.5):0;return Math.round((r-s)*n)/n+s}function JM(a,r){r=r||a.getContext("2d"),r.save(),r.resetTransform(),r.clearRect(0,0,a.width,a.height),r.restore()}function db(a,r,l,n){tD(a,r,l,n,null)}function tD(a,r,l,n,s){let d,m,_,w,S,T,L=r.pointStyle,H=r.rotation,q=r.radius,X=(H||0)*lJ;if(L&&typeof L=="object"&&(d=L.toString(),d==="[object HTMLImageElement]"||d==="[object HTMLCanvasElement]")){a.save(),a.translate(l,n),a.rotate(X),a.drawImage(L,-L.width/2,-L.height/2,L.width,L.height),a.restore();return}if(!(isNaN(q)||q<=0)){switch(a.beginPath(),L){default:s?a.ellipse(l,n,s/2,q,0,0,mr):a.arc(l,n,q,0,mr),a.closePath();break;case"triangle":a.moveTo(l+Math.sin(X)*q,n-Math.cos(X)*q),X+=qN,a.lineTo(l+Math.sin(X)*q,n-Math.cos(X)*q),X+=qN,a.lineTo(l+Math.sin(X)*q,n-Math.cos(X)*q),a.closePath();break;case"rectRounded":S=q*.516,w=q-S,m=Math.cos(X+Cg)*w,_=Math.sin(X+Cg)*w,a.arc(l-m,n-_,S,X-Ur,X-ao),a.arc(l+_,n-m,S,X-ao,X),a.arc(l+m,n+_,S,X,X+ao),a.arc(l-_,n+m,S,X+ao,X+Ur),a.closePath();break;case"rect":if(!H){w=Math.SQRT1_2*q,T=s?s/2:w,a.rect(l-T,n-w,2*T,2*w);break}X+=Cg;case"rectRot":m=Math.cos(X)*q,_=Math.sin(X)*q,a.moveTo(l-m,n-_),a.lineTo(l+_,n-m),a.lineTo(l+m,n+_),a.lineTo(l-_,n+m),a.closePath();break;case"crossRot":X+=Cg;case"cross":m=Math.cos(X)*q,_=Math.sin(X)*q,a.moveTo(l-m,n-_),a.lineTo(l+m,n+_),a.moveTo(l+_,n-m),a.lineTo(l-_,n+m);break;case"star":m=Math.cos(X)*q,_=Math.sin(X)*q,a.moveTo(l-m,n-_),a.lineTo(l+m,n+_),a.moveTo(l+_,n-m),a.lineTo(l-_,n+m),X+=Cg,m=Math.cos(X)*q,_=Math.sin(X)*q,a.moveTo(l-m,n-_),a.lineTo(l+m,n+_),a.moveTo(l+_,n-m),a.lineTo(l-_,n+m);break;case"line":m=s?s/2:Math.cos(X)*q,_=Math.sin(X)*q,a.moveTo(l-m,n-_),a.lineTo(l+m,n+_);break;case"dash":a.moveTo(l,n),a.lineTo(l+Math.cos(X)*q,n+Math.sin(X)*q);break}a.fill(),r.borderWidth>0&&a.stroke()}}function Om(a,r,l){return l=l||.5,!r||a&&a.x>r.left-l&&a.x<r.right+l&&a.y>r.top-l&&a.y<r.bottom+l}function Ig(a,r){a.save(),a.beginPath(),a.rect(r.left,r.top,r.right-r.left,r.bottom-r.top),a.clip()}function Ag(a){a.restore()}function CB(a,r,l,n,s){if(!r)return a.lineTo(l.x,l.y);if(s==="middle"){let d=(r.x+l.x)/2;a.lineTo(d,r.y),a.lineTo(d,l.y)}else s==="after"!=!!n?a.lineTo(r.x,l.y):a.lineTo(l.x,r.y);a.lineTo(l.x,l.y)}function SB(a,r,l,n){if(!r)return a.lineTo(l.x,l.y);a.bezierCurveTo(n?r.cp1x:r.cp2x,n?r.cp1y:r.cp2y,n?l.cp2x:l.cp1x,n?l.cp2y:l.cp1y,l.x,l.y)}function Ad(a,r,l,n,s,d={}){let m=kr(r)?r:[r],_=d.strokeWidth>0&&d.strokeColor!=="",w,S;for(a.save(),a.font=s.string,PJ(a,d),w=0;w<m.length;++w)S=m[w],_&&(d.strokeColor&&(a.strokeStyle=d.strokeColor),Pn(d.strokeWidth)||(a.lineWidth=d.strokeWidth),a.strokeText(S,l,n,d.maxWidth)),a.fillText(S,l,n,d.maxWidth),OJ(a,l,n,S,d),n+=s.lineHeight;a.restore()}function PJ(a,r){r.translation&&a.translate(r.translation[0],r.translation[1]),Pn(r.rotation)||a.rotate(r.rotation),r.color&&(a.fillStyle=r.color),r.textAlign&&(a.textAlign=r.textAlign),r.textBaseline&&(a.textBaseline=r.textBaseline)}function OJ(a,r,l,n,s){if(s.strikethrough||s.underline){let d=a.measureText(n),m=r-d.actualBoundingBoxLeft,_=r+d.actualBoundingBoxRight,w=l-d.actualBoundingBoxAscent,S=l+d.actualBoundingBoxDescent,T=s.strikethrough?(w+S)/2:S;a.strokeStyle=a.fillStyle,a.beginPath(),a.lineWidth=s.decorationWidth||2,a.moveTo(m,T),a.lineTo(_,T),a.stroke()}}function Bm(a,r){let{x:l,y:n,w:s,h:d,radius:m}=r;a.arc(l+m.topLeft,n+m.topLeft,m.topLeft,-ao,Ur,!0),a.lineTo(l,n+d-m.bottomLeft),a.arc(l+m.bottomLeft,n+d-m.bottomLeft,m.bottomLeft,Ur,ao,!0),a.lineTo(l+s-m.bottomRight,n+d),a.arc(l+s-m.bottomRight,n+d-m.bottomRight,m.bottomRight,ao,0,!0),a.lineTo(l+s,n+m.topRight),a.arc(l+s-m.topRight,n+m.topRight,m.topRight,0,-ao,!0),a.lineTo(l+m.topLeft,n)}var FJ=new RegExp(/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/),LJ=new RegExp(/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/);function zJ(a,r){let l=(""+a).match(FJ);if(!l||l[1]==="normal")return r*1.2;switch(a=+l[2],l[3]){case"px":return a;case"%":a/=100;break}return r*a}var NJ=a=>+a||0;function ub(a,r){let l={},n=bn(r),s=n?Object.keys(r):r,d=bn(a)?n?m=>nn(a[m],a[r[m]]):m=>a[m]:()=>a;for(let m of s)l[m]=NJ(d(m));return l}function eD(a){return ub(a,{top:"y",right:"x",bottom:"y",left:"x"})}function kd(a){return ub(a,["topLeft","topRight","bottomLeft","bottomRight"])}function Jo(a){let r=eD(a);return r.width=r.left+r.right,r.height=r.top+r.bottom,r}function zo(a,r){a=a||{},r=r||xn.font;let l=nn(a.size,r.size);typeof l=="string"&&(l=parseInt(l,10));let n=nn(a.style,r.style);n&&!(""+n).match(LJ)&&(console.warn('Invalid font style specified: "'+n+'"'),n="");let s={family:nn(a.family,r.family),lineHeight:zJ(nn(a.lineHeight,r.lineHeight),l),size:l,style:n,weight:nn(a.weight,r.weight),string:""};return s.string=RJ(s),s}function Vm(a,r,l,n){let s=!0,d,m,_;for(d=0,m=a.length;d<m;++d)if(_=a[d],_!==void 0&&(r!==void 0&&typeof _=="function"&&(_=_(r),s=!1),l!==void 0&&kr(_)&&(_=_[l%_.length],s=!1),_!==void 0))return n&&!s&&(n.cacheable=!1),_}function EB(a,r,l){let{min:n,max:s}=a,d=zM(r,(s-n)/2),m=(_,w)=>l&&_===0?0:_+w;return{min:m(n,-Math.abs(d)),max:m(s,d)}}function Pc(a,r){return Object.assign(Object.create(a),r)}function hb(a,r=[""],l=a,n,s=()=>a[0]){Js(n)||(n=TB("_fallback",a));let d={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:a,_rootScopes:l,_fallback:n,_getTarget:s,override:m=>hb([m,...a],r,l,n)};return new Proxy(d,{deleteProperty(m,_){return delete m[_],delete m._keys,delete a[0][_],!0},get(m,_){return MB(m,_,()=>WJ(_,r,a,m))},getOwnPropertyDescriptor(m,_){return Reflect.getOwnPropertyDescriptor(m._scopes[0],_)},getPrototypeOf(){return Reflect.getPrototypeOf(a[0])},has(m,_){return JN(m).includes(_)},ownKeys(m){return JN(m)},set(m,_,w){let S=m._storage||(m._storage=s());return m[_]=S[_]=w,delete m._keys,!0}})}function Nu(a,r,l,n){let s={_cacheable:!1,_proxy:a,_context:r,_subProxy:l,_stack:new Set,_descriptors:iD(a,n),setContext:d=>Nu(a,d,l,n),override:d=>Nu(a.override(d),r,l,n)};return new Proxy(s,{deleteProperty(d,m){return delete d[m],delete a[m],!0},get(d,m,_){return MB(d,m,()=>VJ(d,m,_))},getOwnPropertyDescriptor(d,m){return d._descriptors.allKeys?Reflect.has(a,m)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(a,m)},getPrototypeOf(){return Reflect.getPrototypeOf(a)},has(d,m){return Reflect.has(a,m)},ownKeys(){return Reflect.ownKeys(a)},set(d,m,_){return a[m]=_,delete d[m],!0}})}function iD(a,r={scriptable:!0,indexable:!0}){let{_scriptable:l=r.scriptable,_indexable:n=r.indexable,_allKeys:s=r.allKeys}=a;return{allKeys:s,scriptable:l,indexable:n,isScriptable:kc(l)?l:()=>l,isIndexable:kc(n)?n:()=>n}}var BJ=(a,r)=>a?a+ob(r):r,nD=(a,r)=>bn(r)&&a!=="adapters"&&(Object.getPrototypeOf(r)===null||r.constructor===Object);function MB(a,r,l){if(Object.prototype.hasOwnProperty.call(a,r))return a[r];let n=l();return a[r]=n,n}function VJ(a,r,l){let{_proxy:n,_context:s,_subProxy:d,_descriptors:m}=a,_=n[r];return kc(_)&&m.isScriptable(r)&&(_=jJ(r,_,a,l)),kr(_)&&_.length&&(_=UJ(r,_,a,m.isIndexable)),nD(r,_)&&(_=Nu(_,s,d&&d[r],m)),_}function jJ(a,r,l,n){let{_proxy:s,_context:d,_subProxy:m,_stack:_}=l;if(_.has(a))throw new Error("Recursion detected: "+Array.from(_).join("->")+"->"+a);return _.add(a),r=r(d,m||n),_.delete(a),nD(a,r)&&(r=rD(s._scopes,s,a,r)),r}function UJ(a,r,l,n){let{_proxy:s,_context:d,_subProxy:m,_descriptors:_}=l;if(Js(d.index)&&n(a))r=r[d.index%r.length];else if(bn(r[0])){let w=r,S=s._scopes.filter(T=>T!==w);r=[];for(let T of w){let L=rD(S,s,a,T);r.push(Nu(L,d,m&&m[a],_))}}return r}function DB(a,r,l){return kc(a)?a(r,l):a}var HJ=(a,r)=>a===!0?r:typeof a=="string"?Rc(r,a):void 0;function GJ(a,r,l,n,s){for(let d of r){let m=HJ(l,d);if(m){a.add(m);let _=DB(m._fallback,l,s);if(Js(_)&&_!==l&&_!==n)return _}else if(m===!1&&Js(n)&&l!==n)return null}return!1}function rD(a,r,l,n){let s=r._rootScopes,d=DB(r._fallback,l,n),m=[...a,...s],_=new Set;_.add(n);let w=QN(_,m,l,d||l,n);return w===null||Js(d)&&d!==l&&(w=QN(_,m,d,w,n),w===null)?!1:hb(Array.from(_),[""],s,d,()=>qJ(r,l,n))}function QN(a,r,l,n,s){for(;l;)l=GJ(a,r,l,n,s);return l}function qJ(a,r,l){let n=a._getTarget();r in n||(n[r]={});let s=n[r];return kr(s)&&bn(l)?l:s}function WJ(a,r,l,n){let s;for(let d of r)if(s=TB(BJ(d,a),l),Js(s))return nD(a,s)?rD(l,n,a,s):s}function TB(a,r){for(let l of r){if(!l)continue;let n=l[a];if(Js(n))return n}}function JN(a){let r=a._keys;return r||(r=a._keys=$J(a._scopes)),r}function $J(a){let r=new Set;for(let l of a)for(let n of Object.keys(l).filter(s=>!s.startsWith("_")))r.add(n);return Array.from(r)}function oD(a,r,l,n){let{iScale:s}=a,{key:d="r"}=this._parsing,m=new Array(n),_,w,S,T;for(_=0,w=n;_<w;++_)S=_+l,T=r[S],m[_]={r:s.parse(Rc(T,d),S)};return m}var YJ=Number.EPSILON||1e-14,Fm=(a,r)=>r<a.length&&!a[r].skip&&a[r],IB=a=>a==="x"?"y":"x";function ZJ(a,r,l,n){let s=a.skip?r:a,d=r,m=l.skip?r:l,_=nb(d,s),w=nb(m,d),S=_/(_+w),T=w/(_+w);S=isNaN(S)?0:S,T=isNaN(T)?0:T;let L=n*S,H=n*T;return{previous:{x:d.x-L*(m.x-s.x),y:d.y-L*(m.y-s.y)},next:{x:d.x+H*(m.x-s.x),y:d.y+H*(m.y-s.y)}}}function XJ(a,r,l){let n=a.length,s,d,m,_,w,S=Fm(a,0);for(let T=0;T<n-1;++T)if(w=S,S=Fm(a,T+1),!(!w||!S)){if(zm(r[T],0,YJ)){l[T]=l[T+1]=0;continue}s=l[T]/r[T],d=l[T+1]/r[T],_=Math.pow(s,2)+Math.pow(d,2),!(_<=9)&&(m=3/Math.sqrt(_),l[T]=s*m*r[T],l[T+1]=d*m*r[T])}}function KJ(a,r,l="x"){let n=IB(l),s=a.length,d,m,_,w=Fm(a,0);for(let S=0;S<s;++S){if(m=_,_=w,w=Fm(a,S+1),!_)continue;let T=_[l],L=_[n];m&&(d=(T-m[l])/3,_[`cp1${l}`]=T-d,_[`cp1${n}`]=L-d*r[S]),w&&(d=(w[l]-T)/3,_[`cp2${l}`]=T+d,_[`cp2${n}`]=L+d*r[S])}}function QJ(a,r="x"){let l=IB(r),n=a.length,s=Array(n).fill(0),d=Array(n),m,_,w,S=Fm(a,0);for(m=0;m<n;++m)if(_=w,w=S,S=Fm(a,m+1),!!w){if(S){let T=S[r]-w[r];s[m]=T!==0?(S[l]-w[l])/T:0}d[m]=_?S?_l(s[m-1])!==_l(s[m])?0:(s[m-1]+s[m])/2:s[m-1]:s[m]}XJ(a,s,d),KJ(a,d,r)}function tb(a,r,l){return Math.max(Math.min(a,l),r)}function JJ(a,r){let l,n,s,d,m,_=Om(a[0],r);for(l=0,n=a.length;l<n;++l)m=d,d=_,_=l<n-1&&Om(a[l+1],r),d&&(s=a[l],m&&(s.cp1x=tb(s.cp1x,r.left,r.right),s.cp1y=tb(s.cp1y,r.top,r.bottom)),_&&(s.cp2x=tb(s.cp2x,r.left,r.right),s.cp2y=tb(s.cp2y,r.top,r.bottom)))}function AB(a,r,l,n,s){let d,m,_,w;if(r.spanGaps&&(a=a.filter(S=>!S.skip)),r.cubicInterpolationMode==="monotone")QJ(a,s);else{let S=n?a[a.length-1]:a[0];for(d=0,m=a.length;d<m;++d)_=a[d],w=ZJ(S,_,a[Math.min(d+1,m-(n?0:1))%m],r.tension),_.cp1x=w.previous.x,_.cp1y=w.previous.y,_.cp2x=w.next.x,_.cp2y=w.next.y,S=_}r.capBezierPoints&&JJ(a,l)}function sD(){return typeof window<"u"&&typeof document<"u"}function mb(a){let r=a.parentNode;return r&&r.toString()==="[object ShadowRoot]"&&(r=r.host),r}function rb(a,r,l){let n;return typeof a=="string"?(n=parseInt(a,10),a.indexOf("%")!==-1&&(n=n/100*r.parentNode[l])):n=a,n}var pb=a=>window.getComputedStyle(a,null);function ttt(a,r){return pb(a).getPropertyValue(r)}var ett=["top","right","bottom","left"];function zu(a,r,l){let n={};l=l?"-"+l:"";for(let s=0;s<4;s++){let d=ett[s];n[d]=parseFloat(a[r+"-"+d+l])||0}return n.width=n.left+n.right,n.height=n.top+n.bottom,n}var itt=(a,r,l)=>(a>0||r>0)&&(!l||!l.shadowRoot);function ntt(a,r){let l=a.touches,n=l&&l.length?l[0]:a,{offsetX:s,offsetY:d}=n,m=!1,_,w;if(itt(s,d,a.target))_=s,w=d;else{let S=r.getBoundingClientRect();_=n.clientX-S.left,w=n.clientY-S.top,m=!0}return{x:_,y:w,box:m}}function Rd(a,r){if("native"in a)return a;let{canvas:l,currentDevicePixelRatio:n}=r,s=pb(l),d=s.boxSizing==="border-box",m=zu(s,"padding"),_=zu(s,"border","width"),{x:w,y:S,box:T}=ntt(a,l),L=m.left+(T&&_.left),H=m.top+(T&&_.top),{width:q,height:X}=r;return d&&(q-=m.width+_.width,X-=m.height+_.height),{x:Math.round((w-L)/q*l.width/n),y:Math.round((S-H)/X*l.height/n)}}function rtt(a,r,l){let n,s;if(r===void 0||l===void 0){let d=mb(a);if(!d)r=a.clientWidth,l=a.clientHeight;else{let m=d.getBoundingClientRect(),_=pb(d),w=zu(_,"border","width"),S=zu(_,"padding");r=m.width-S.width-w.width,l=m.height-S.height-w.height,n=rb(_.maxWidth,d,"clientWidth"),s=rb(_.maxHeight,d,"clientHeight")}}return{width:r,height:l,maxWidth:n||ib,maxHeight:s||ib}}var PM=a=>Math.round(a*10)/10;function kB(a,r,l,n){let s=pb(a),d=zu(s,"margin"),m=rb(s.maxWidth,a,"clientWidth")||ib,_=rb(s.maxHeight,a,"clientHeight")||ib,w=rtt(a,r,l),{width:S,height:T}=w;if(s.boxSizing==="content-box"){let L=zu(s,"border","width"),H=zu(s,"padding");S-=H.width+L.width,T-=H.height+L.height}return S=Math.max(0,S-d.width),T=Math.max(0,n?Math.floor(S/n):T-d.height),S=PM(Math.min(S,m,w.maxWidth)),T=PM(Math.min(T,_,w.maxHeight)),S&&!T&&(T=PM(S/2)),{width:S,height:T}}function aD(a,r,l){let n=r||1,s=Math.floor(a.height*n),d=Math.floor(a.width*n);a.height=s/n,a.width=d/n;let m=a.canvas;return m.style&&(l||!m.style.height&&!m.style.width)&&(m.style.height=`${a.height}px`,m.style.width=`${a.width}px`),a.currentDevicePixelRatio!==n||m.height!==s||m.width!==d?(a.currentDevicePixelRatio=n,m.height=s,m.width=d,a.ctx.setTransform(n,0,0,n,0,0),!0):!1}var RB=function(){let a=!1;try{let r={get passive(){return a=!0,!1}};window.addEventListener("test",null,r),window.removeEventListener("test",null,r)}catch{}return a}();function lD(a,r){let l=ttt(a,r),n=l&&l.match(/^(\d+)(\.\d+)?px$/);return n?+n[1]:void 0}function Ed(a,r,l,n){return{x:a.x+l*(r.x-a.x),y:a.y+l*(r.y-a.y)}}function PB(a,r,l,n){return{x:a.x+l*(r.x-a.x),y:n==="middle"?l<.5?a.y:r.y:n==="after"?l<1?a.y:r.y:l>0?r.y:a.y}}function OB(a,r,l,n){let s={x:a.cp2x,y:a.cp2y},d={x:r.cp1x,y:r.cp1y},m=Ed(a,s,l),_=Ed(s,d,l),w=Ed(d,r,l),S=Ed(m,_,l),T=Ed(_,w,l);return Ed(S,T,l)}var tB=new Map;function ott(a,r){r=r||{};let l=a+JSON.stringify(r),n=tB.get(l);return n||(n=new Intl.NumberFormat(a,r),tB.set(l,n)),n}function jm(a,r,l){return ott(r,l).format(a)}var stt=function(a,r){return{x(l){return a+a+r-l},setWidth(l){r=l},textAlign(l){return l==="center"?l:l==="right"?"left":"right"},xPlus(l,n){return l-n},leftForLtr(l,n){return l-n}}},att=function(){return{x(a){return a},setWidth(a){},textAlign(a){return a},xPlus(a,r){return a+r},leftForLtr(a,r){return a}}};function Vu(a,r,l){return a?stt(r,l):att()}function cD(a,r){let l,n;(r==="ltr"||r==="rtl")&&(l=a.canvas.style,n=[l.getPropertyValue("direction"),l.getPropertyPriority("direction")],l.setProperty("direction",r,"important"),a.prevTextDirection=n)}function dD(a,r){r!==void 0&&(delete a.prevTextDirection,a.canvas.style.setProperty("direction",r[0],r[1]))}function FB(a){return a==="angle"?{between:Nm,compare:cJ,normalize:Bs}:{between:$l,compare:(r,l)=>r-l,normalize:r=>r}}function eB({start:a,end:r,count:l,loop:n,style:s}){return{start:a%l,end:r%l,loop:n&&(r-a+1)%l===0,style:s}}function ltt(a,r,l){let{property:n,start:s,end:d}=l,{between:m,normalize:_}=FB(n),w=r.length,{start:S,end:T,loop:L}=a,H,q;if(L){for(S+=w,T+=w,H=0,q=w;H<q&&m(_(r[S%w][n]),s,d);++H)S--,T--;S%=w,T%=w}return T<S&&(T+=w),{start:S,end:T,loop:L,style:a.style}}function uD(a,r,l){if(!l)return[a];let{property:n,start:s,end:d}=l,m=r.length,{compare:_,between:w,normalize:S}=FB(n),{start:T,end:L,loop:H,style:q}=ltt(a,r,l),X=[],it=!1,at=null,ut,Mt,Lt,Pt=()=>w(s,Lt,ut)&&_(s,Lt)!==0,Nt=()=>_(d,ut)===0||w(d,Lt,ut),ue=()=>it||Pt(),Q=()=>!it||Nt();for(let $t=T,Be=T;$t<=L;++$t)Mt=r[$t%m],!Mt.skip&&(ut=S(Mt[n]),ut!==Lt&&(it=w(ut,s,d),at===null&&ue()&&(at=_(ut,s)===0?$t:Be),at!==null&&Q()&&(X.push(eB({start:at,end:$t,loop:H,count:m,style:q})),at=null),Be=$t,Lt=ut));return at!==null&&X.push(eB({start:at,end:L,loop:H,count:m,style:q})),X}function hD(a,r){let l=[],n=a.segments;for(let s=0;s<n.length;s++){let d=uD(n[s],a.points,r);d.length&&l.push(...d)}return l}function ctt(a,r,l,n){let s=0,d=r-1;if(l&&!n)for(;s<r&&!a[s].skip;)s++;for(;s<r&&a[s].skip;)s++;for(s%=r,l&&(d+=s);d>s&&a[d%r].skip;)d--;return d%=r,{start:s,end:d}}function dtt(a,r,l,n){let s=a.length,d=[],m=r,_=a[r],w;for(w=r+1;w<=l;++w){let S=a[w%s];S.skip||S.stop?_.skip||(n=!1,d.push({start:r%s,end:(w-1)%s,loop:n}),r=m=S.stop?w:null):(m=w,_.skip&&(r=w)),_=S}return m!==null&&d.push({start:r%s,end:m%s,loop:n}),d}function LB(a,r){let l=a.points,n=a.options.spanGaps,s=l.length;if(!s)return[];let d=!!a._loop,{start:m,end:_}=ctt(l,s,d,n);if(n===!0)return iB(a,[{start:m,end:_,loop:d}],l,r);let w=_<m?_+s:_,S=!!a._fullLoop&&m===0&&_===s-1;return iB(a,dtt(l,m,w,S),l,r)}function iB(a,r,l,n){return!n||!n.setContext||!l?r:utt(a,r,l,n)}function utt(a,r,l,n){let s=a._chart.getContext(),d=nB(a.options),{_datasetIndex:m,options:{spanGaps:_}}=a,w=l.length,S=[],T=d,L=r[0].start,H=L;function q(X,it,at,ut){let Mt=_?-1:1;if(X!==it){for(X+=w;l[X%w].skip;)X-=Mt;for(;l[it%w].skip;)it+=Mt;X%w!==it%w&&(S.push({start:X%w,end:it%w,loop:at,style:ut}),T=ut,L=it%w)}}for(let X of r){L=_?L:X.start;let it=l[L%w],at;for(H=L+1;H<=X.end;H++){let ut=l[H%w];at=nB(n.setContext(Pc(s,{type:"segment",p0:it,p1:ut,p0DataIndex:(H-1)%w,p1DataIndex:H%w,datasetIndex:m}))),htt(at,T)&&q(L,H-1,X.loop,T),it=ut,T=at}L<H-1&&q(L,H-1,X.loop,T)}return S}function nB(a){return{backgroundColor:a.backgroundColor,borderCapStyle:a.borderCapStyle,borderDash:a.borderDash,borderDashOffset:a.borderDashOffset,borderJoinStyle:a.borderJoinStyle,borderWidth:a.borderWidth,borderColor:a.borderColor}}function htt(a,r){return r&&JSON.stringify(a)!==JSON.stringify(r)}var wD=class{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(r,l,n,s){let d=l.listeners[s],m=l.duration;d.forEach(_=>_({chart:r,initial:l.initial,numSteps:m,currentStep:Math.min(n-l.start,m)}))}_refresh(){this._request||(this._running=!0,this._request=qM.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(r=Date.now()){let l=0;this._charts.forEach((n,s)=>{if(!n.running||!n.items.length)return;let d=n.items,m=d.length-1,_=!1,w;for(;m>=0;--m)w=d[m],w._active?(w._total>n.duration&&(n.duration=w._total),w.tick(r),_=!0):(d[m]=d[d.length-1],d.pop());_&&(s.draw(),this._notify(s,n,r,"progress")),d.length||(n.running=!1,this._notify(s,n,r,"complete"),n.initial=!1),l+=d.length}),this._lastDate=r,l===0&&(this._running=!1)}_getAnims(r){let l=this._charts,n=l.get(r);return n||(n={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},l.set(r,n)),n}listen(r,l,n){this._getAnims(r).listeners[l].push(n)}add(r,l){!l||!l.length||this._getAnims(r).items.push(...l)}has(r){return this._getAnims(r).items.length>0}start(r){let l=this._charts.get(r);l&&(l.running=!0,l.start=Date.now(),l.duration=l.items.reduce((n,s)=>Math.max(n,s._duration),0),this._refresh())}running(r){if(!this._running)return!1;let l=this._charts.get(r);return!(!l||!l.running||!l.items.length)}stop(r){let l=this._charts.get(r);if(!l||!l.items.length)return;let n=l.items,s=n.length-1;for(;s>=0;--s)n[s].cancel();l.items=[],this._notify(r,l,Date.now(),"complete")}remove(r){return this._charts.delete(r)}},Oc=new wD,zB="transparent",mtt={boolean(a,r,l){return l>.5?r:a},color(a,r,l){let n=QM(a||zB),s=n.valid&&QM(r||zB);return s&&s.valid?s.mix(n,l).hexString():r},number(a,r,l){return a+(r-a)*l}},CD=class{constructor(r,l,n,s){let d=l[n];s=Vm([r.to,s,d,r.from]);let m=Vm([r.from,d,s]);this._active=!0,this._fn=r.fn||mtt[r.type||typeof m],this._easing=Rm[r.easing]||Rm.linear,this._start=Math.floor(Date.now()+(r.delay||0)),this._duration=this._total=Math.floor(r.duration),this._loop=!!r.loop,this._target=l,this._prop=n,this._from=m,this._to=s,this._promises=void 0}active(){return this._active}update(r,l,n){if(this._active){this._notify(!1);let s=this._target[this._prop],d=n-this._start,m=this._duration-d;this._start=n,this._duration=Math.floor(Math.max(m,r.duration)),this._total+=d,this._loop=!!r.loop,this._to=Vm([r.to,l,s,r.from]),this._from=Vm([r.from,s,l])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(r){let l=r-this._start,n=this._duration,s=this._prop,d=this._from,m=this._loop,_=this._to,w;if(this._active=d!==_&&(m||l<n),!this._active){this._target[s]=_,this._notify(!0);return}if(l<0){this._target[s]=d;return}w=l/n%2,w=m&&w>1?2-w:w,w=this._easing(Math.min(1,Math.max(0,w))),this._target[s]=this._fn(d,_,w)}wait(){let r=this._promises||(this._promises=[]);return new Promise((l,n)=>{r.push({res:l,rej:n})})}_notify(r){let l=r?"res":"rej",n=this._promises||[];for(let s=0;s<n.length;s++)n[s][l]()}},ptt=["x","y","borderWidth","radius","tension"],ftt=["color","borderColor","backgroundColor"];xn.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0});var gtt=Object.keys(xn.animation);xn.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:a=>a!=="onProgress"&&a!=="onComplete"&&a!=="fn"});xn.set("animations",{colors:{type:"color",properties:ftt},numbers:{type:"number",properties:ptt}});xn.describe("animations",{_fallback:"animation"});xn.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:a=>a|0}}}});var wb=class{constructor(r,l){this._chart=r,this._properties=new Map,this.configure(l)}configure(r){if(!bn(r))return;let l=this._properties;Object.getOwnPropertyNames(r).forEach(n=>{let s=r[n];if(!bn(s))return;let d={};for(let m of gtt)d[m]=s[m];(kr(s.properties)&&s.properties||[n]).forEach(m=>{(m===n||!l.has(m))&&l.set(m,d)})})}_animateOptions(r,l){let n=l.options,s=vtt(r,n);if(!s)return[];let d=this._createAnimations(s,n);return n.$shared&&_tt(r.options.$animations,n).then(()=>{r.options=n},()=>{}),d}_createAnimations(r,l){let n=this._properties,s=[],d=r.$animations||(r.$animations={}),m=Object.keys(l),_=Date.now(),w;for(w=m.length-1;w>=0;--w){let S=m[w];if(S.charAt(0)==="$")continue;if(S==="options"){s.push(...this._animateOptions(r,l));continue}let T=l[S],L=d[S],H=n.get(S);if(L)if(H&&L.active()){L.update(H,T,_);continue}else L.cancel();if(!H||!H.duration){r[S]=T;continue}d[S]=L=new CD(H,r,S,T),s.push(L)}return s}update(r,l){if(this._properties.size===0){Object.assign(r,l);return}let n=this._createAnimations(r,l);if(n.length)return Oc.add(this._chart,n),!0}};function _tt(a,r){let l=[],n=Object.keys(r);for(let s=0;s<n.length;s++){let d=a[n[s]];d&&d.active()&&l.push(d.wait())}return Promise.all(l)}function vtt(a,r){if(!r)return;let l=a.options;if(!l){a.options=r;return}return l.$shared&&(a.options=l=Object.assign({},l,{$shared:!1,$animations:{}})),l}function NB(a,r){let l=a&&a.options||{},n=l.reverse,s=l.min===void 0?r:0,d=l.max===void 0?r:0;return{start:n?d:s,end:n?s:d}}function ytt(a,r,l){if(l===!1)return!1;let n=NB(a,l),s=NB(r,l);return{top:s.end,right:n.end,bottom:s.start,left:n.start}}function btt(a){let r,l,n,s;return bn(a)?(r=a.top,l=a.right,n=a.bottom,s=a.left):r=l=n=s=a,{top:r,right:l,bottom:n,left:s,disabled:a===!1}}function I4(a,r){let l=[],n=a._getSortedDatasetMetas(r),s,d;for(s=0,d=n.length;s<d;++s)l.push(n[s].index);return l}function BB(a,r,l,n={}){let s=a.keys,d=n.mode==="single",m,_,w,S;if(r!==null){for(m=0,_=s.length;m<_;++m){if(w=+s[m],w===l){if(n.all)continue;break}S=a.values[w],go(S)&&(d||r===0||_l(r)===_l(S))&&(r+=S)}return r}}function xtt(a){let r=Object.keys(a),l=new Array(r.length),n,s,d;for(n=0,s=r.length;n<s;++n)d=r[n],l[n]={x:d,y:a[d]};return l}function VB(a,r){let l=a&&a.options.stacked;return l||l===void 0&&r.stack!==void 0}function wtt(a,r,l){return`${a.id}.${r.id}.${l.stack||l.type}`}function Ctt(a){let{min:r,max:l,minDefined:n,maxDefined:s}=a.getUserBounds();return{min:n?r:Number.NEGATIVE_INFINITY,max:s?l:Number.POSITIVE_INFINITY}}function Stt(a,r,l){let n=a[r]||(a[r]={});return n[l]||(n[l]={})}function jB(a,r,l,n){for(let s of r.getMatchingVisibleMetas(n).reverse()){let d=a[s.index];if(l&&d>0||!l&&d<0)return s.index}return null}function UB(a,r){let{chart:l,_cachedMeta:n}=a,s=l._stacks||(l._stacks={}),{iScale:d,vScale:m,index:_}=n,w=d.axis,S=m.axis,T=wtt(d,m,n),L=r.length,H;for(let q=0;q<L;++q){let X=r[q],{[w]:it,[S]:at}=X,ut=X._stacks||(X._stacks={});H=ut[S]=Stt(s,T,it),H[_]=at,H._top=jB(H,m,!0,n.type),H._bottom=jB(H,m,!1,n.type)}}function mD(a,r){let l=a.scales;return Object.keys(l).filter(n=>l[n].axis===r).shift()}function Ett(a,r){return Pc(a,{active:!1,dataset:void 0,datasetIndex:r,index:r,mode:"default",type:"dataset"})}function Mtt(a,r,l){return Pc(a,{active:!1,dataIndex:r,parsed:void 0,raw:void 0,element:l,index:r,mode:"default",type:"data"})}function kg(a,r){let l=a.controller.index,n=a.vScale&&a.vScale.axis;if(n){r=r||a._parsed;for(let s of r){let d=s._stacks;if(!d||d[n]===void 0||d[n][l]===void 0)return;delete d[n][l]}}}var pD=a=>a==="reset"||a==="none",HB=(a,r)=>r?a:Object.assign({},a),Dtt=(a,r,l)=>a&&!r.hidden&&r._stacked&&{keys:I4(l,!0),values:null},Kl=(()=>{class a{constructor(l,n){this.chart=l,this._ctx=l.ctx,this.index=n,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.initialize()}initialize(){let l=this._cachedMeta;this.configure(),this.linkScales(),l._stacked=VB(l.vScale,l),this.addElements()}updateIndex(l){this.index!==l&&kg(this._cachedMeta),this.index=l}linkScales(){let l=this.chart,n=this._cachedMeta,s=this.getDataset(),d=(H,q,X,it)=>H==="x"?q:H==="r"?it:X,m=n.xAxisID=nn(s.xAxisID,mD(l,"x")),_=n.yAxisID=nn(s.yAxisID,mD(l,"y")),w=n.rAxisID=nn(s.rAxisID,mD(l,"r")),S=n.indexAxis,T=n.iAxisID=d(S,m,_,w),L=n.vAxisID=d(S,_,m,w);n.xScale=this.getScaleForId(m),n.yScale=this.getScaleForId(_),n.rScale=this.getScaleForId(w),n.iScale=this.getScaleForId(T),n.vScale=this.getScaleForId(L)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(l){return this.chart.scales[l]}_getOtherScale(l){let n=this._cachedMeta;return l===n.iScale?n.vScale:n.iScale}reset(){this._update("reset")}_destroy(){let l=this._cachedMeta;this._data&&HM(this._data,this),l._stacked&&kg(l)}_dataCheck(){let l=this.getDataset(),n=l.data||(l.data=[]),s=this._data;if(bn(n))this._data=xtt(n);else if(s!==n){if(s){HM(s,this);let d=this._cachedMeta;kg(d),d._parsed=[]}n&&Object.isExtensible(n)&&pB(n,this),this._syncList=[],this._data=n}}addElements(){let l=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(l.dataset=new this.datasetElementType)}buildOrUpdateElements(l){let n=this._cachedMeta,s=this.getDataset(),d=!1;this._dataCheck();let m=n._stacked;n._stacked=VB(n.vScale,n),n.stack!==s.stack&&(d=!0,kg(n),n.stack=s.stack),this._resyncElements(l),(d||m!==n._stacked)&&UB(this,n._parsed)}configure(){let l=this.chart.config,n=l.datasetScopeKeys(this._type),s=l.getOptionScopes(this.getDataset(),n,!0);this.options=l.createResolver(s,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(l,n){let{_cachedMeta:s,_data:d}=this,{iScale:m,_stacked:_}=s,w=m.axis,S=l===0&&n===d.length?!0:s._sorted,T=l>0&&s._parsed[l-1],L,H,q;if(this._parsing===!1)s._parsed=d,s._sorted=!0,q=d;else{kr(d[l])?q=this.parseArrayData(s,d,l,n):bn(d[l])?q=this.parseObjectData(s,d,l,n):q=this.parsePrimitiveData(s,d,l,n);let X=()=>H[w]===null||T&&H[w]<T[w];for(L=0;L<n;++L)s._parsed[L+l]=H=q[L],S&&(X()&&(S=!1),T=H);s._sorted=S}_&&UB(this,q)}parsePrimitiveData(l,n,s,d){let{iScale:m,vScale:_}=l,w=m.axis,S=_.axis,T=m.getLabels(),L=m===_,H=new Array(d),q,X,it;for(q=0,X=d;q<X;++q)it=q+s,H[q]={[w]:L||m.parse(T[it],it),[S]:_.parse(n[it],it)};return H}parseArrayData(l,n,s,d){let{xScale:m,yScale:_}=l,w=new Array(d),S,T,L,H;for(S=0,T=d;S<T;++S)L=S+s,H=n[L],w[S]={x:m.parse(H[0],L),y:_.parse(H[1],L)};return w}parseObjectData(l,n,s,d){let{xScale:m,yScale:_}=l,{xAxisKey:w="x",yAxisKey:S="y"}=this._parsing,T=new Array(d),L,H,q,X;for(L=0,H=d;L<H;++L)q=L+s,X=n[q],T[L]={x:m.parse(Rc(X,w),q),y:_.parse(Rc(X,S),q)};return T}getParsed(l){return this._cachedMeta._parsed[l]}getDataElement(l){return this._cachedMeta.data[l]}applyStack(l,n,s){let d=this.chart,m=this._cachedMeta,_=n[l.axis],w={keys:I4(d,!0),values:n._stacks[l.axis]};return BB(w,_,m.index,{mode:s})}updateRangeFromParsed(l,n,s,d){let m=s[n.axis],_=m===null?NaN:m,w=d&&s._stacks[n.axis];d&&w&&(d.values=w,_=BB(d,m,this._cachedMeta.index)),l.min=Math.min(l.min,_),l.max=Math.max(l.max,_)}getMinMax(l,n){let s=this._cachedMeta,d=s._parsed,m=s._sorted&&l===s.iScale,_=d.length,w=this._getOtherScale(l),S=Dtt(n,s,this.chart),T={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:L,max:H}=Ctt(w),q,X;function it(){X=d[q];let at=X[w.axis];return!go(X[l.axis])||L>at||H<at}for(q=0;q<_&&!(!it()&&(this.updateRangeFromParsed(T,l,X,S),m));++q);if(m){for(q=_-1;q>=0;--q)if(!it()){this.updateRangeFromParsed(T,l,X,S);break}}return T}getAllParsedValues(l){let n=this._cachedMeta._parsed,s=[],d,m,_;for(d=0,m=n.length;d<m;++d)_=n[d][l.axis],go(_)&&s.push(_);return s}getMaxOverflow(){return!1}getLabelAndValue(l){let n=this._cachedMeta,s=n.iScale,d=n.vScale,m=this.getParsed(l);return{label:s?""+s.getLabelForValue(m[s.axis]):"",value:d?""+d.getLabelForValue(m[d.axis]):""}}_update(l){let n=this._cachedMeta;this.update(l||"default"),n._clip=btt(nn(this.options.clip,ytt(n.xScale,n.yScale,this.getMaxOverflow())))}update(l){}draw(){let l=this._ctx,n=this.chart,s=this._cachedMeta,d=s.data||[],m=n.chartArea,_=[],w=this._drawStart||0,S=this._drawCount||d.length-w,T=this.options.drawActiveElementsOnTop,L;for(s.dataset&&s.dataset.draw(l,m,w,S),L=w;L<w+S;++L){let H=d[L];H.hidden||(H.active&&T?_.push(H):H.draw(l,m))}for(L=0;L<_.length;++L)_[L].draw(l,m)}getStyle(l,n){let s=n?"active":"default";return l===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(s):this.resolveDataElementOptions(l||0,s)}getContext(l,n,s){let d=this.getDataset(),m;if(l>=0&&l<this._cachedMeta.data.length){let _=this._cachedMeta.data[l];m=_.$context||(_.$context=Mtt(this.getContext(),l,_)),m.parsed=this.getParsed(l),m.raw=d.data[l],m.index=m.dataIndex=l}else m=this.$context||(this.$context=Ett(this.chart.getContext(),this.index)),m.dataset=d,m.index=m.datasetIndex=this.index;return m.active=!!n,m.mode=s,m}resolveDatasetElementOptions(l){return this._resolveElementOptions(this.datasetElementType.id,l)}resolveDataElementOptions(l,n){return this._resolveElementOptions(this.dataElementType.id,n,l)}_resolveElementOptions(l,n="default",s){let d=n==="active",m=this._cachedDataOpts,_=l+"-"+n,w=m[_],S=this.enableOptionSharing&&Js(s);if(w)return HB(w,S);let T=this.chart.config,L=T.datasetElementScopeKeys(this._type,l),H=d?[`${l}Hover`,"hover",l,""]:[l,""],q=T.getOptionScopes(this.getDataset(),L),X=Object.keys(xn.elements[l]),it=()=>this.getContext(s,d),at=T.resolveNamedOptions(q,X,it,H);return at.$shared&&(at.$shared=S,m[_]=Object.freeze(HB(at,S))),at}_resolveAnimations(l,n,s){let d=this.chart,m=this._cachedDataOpts,_=`animation-${n}`,w=m[_];if(w)return w;let S;if(d.options.animation!==!1){let L=this.chart.config,H=L.datasetAnimationScopeKeys(this._type,n),q=L.getOptionScopes(this.getDataset(),H);S=L.createResolver(q,this.getContext(l,s,n))}let T=new wb(d,S&&S.animations);return S&&S._cacheable&&(m[_]=Object.freeze(T)),T}getSharedOptions(l){if(l.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},l))}includeOptions(l,n){return!n||pD(l)||this.chart._animationsDisabled}_getSharedOptions(l,n){let s=this.resolveDataElementOptions(l,n),d=this._sharedOptions,m=this.getSharedOptions(s),_=this.includeOptions(n,m)||m!==d;return this.updateSharedOptions(m,n,s),{sharedOptions:m,includeOptions:_}}updateElement(l,n,s,d){pD(d)?Object.assign(l,s):this._resolveAnimations(n,d).update(l,s)}updateSharedOptions(l,n,s){l&&!pD(n)&&this._resolveAnimations(void 0,n).update(l,s)}_setStyle(l,n,s,d){l.active=d;let m=this.getStyle(n,d);this._resolveAnimations(n,s,d).update(l,{options:!d&&this.getSharedOptions(m)||m})}removeHoverStyle(l,n,s){this._setStyle(l,s,"active",!1)}setHoverStyle(l,n,s){this._setStyle(l,s,"active",!0)}_removeDatasetHoverStyle(){let l=this._cachedMeta.dataset;l&&this._setStyle(l,void 0,"active",!1)}_setDatasetHoverStyle(){let l=this._cachedMeta.dataset;l&&this._setStyle(l,void 0,"active",!0)}_resyncElements(l){let n=this._data,s=this._cachedMeta.data;for(let[w,S,T]of this._syncList)this[w](S,T);this._syncList=[];let d=s.length,m=n.length,_=Math.min(m,d);_&&this.parse(0,_),m>d?this._insertElements(d,m-d,l):m<d&&this._removeElements(m,d-m)}_insertElements(l,n,s=!0){let d=this._cachedMeta,m=d.data,_=l+n,w,S=T=>{for(T.length+=n,w=T.length-1;w>=_;w--)T[w]=T[w-n]};for(S(m),w=l;w<_;++w)m[w]=new this.dataElementType;this._parsing&&S(d._parsed),this.parse(l,n),s&&this.updateElements(m,l,n,"reset")}updateElements(l,n,s,d){}_removeElements(l,n){let s=this._cachedMeta;if(this._parsing){let d=s._parsed.splice(l,n);s._stacked&&kg(s,d)}s.data.splice(l,n)}_sync(l){if(this._parsing)this._syncList.push(l);else{let[n,s,d]=l;this[n](s,d)}this.chart._dataChanges.push([this.index,...l])}_onDataPush(){let l=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-l,l])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(l,n){n&&this._sync(["_removeElements",l,n]);let s=arguments.length-2;s&&this._sync(["_insertElements",l,s])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}return a.defaults={},a})();Kl.prototype.datasetElementType=null;Kl.prototype.dataElementType=null;function Ttt(a,r){if(!a._cache.$bar){let l=a.getMatchingVisibleMetas(r),n=[];for(let s=0,d=l.length;s<d;s++)n=n.concat(l[s].controller.getAllParsedValues(a));a._cache.$bar=GM(n.sort((s,d)=>s-d))}return a._cache.$bar}function Itt(a){let r=a.iScale,l=Ttt(r,a.type),n=r._length,s,d,m,_,w=()=>{m===32767||m===-32768||(Js(_)&&(n=Math.min(n,Math.abs(m-_)||n)),_=m)};for(s=0,d=l.length;s<d;++s)m=r.getPixelForValue(l[s]),w();for(_=void 0,s=0,d=r.ticks.length;s<d;++s)m=r.getPixelForTick(s),w();return n}function Att(a,r,l,n){let s=l.barThickness,d,m;return Pn(s)?(d=r.min*l.categoryPercentage,m=l.barPercentage):(d=s*n,m=1),{chunk:d/n,ratio:m,start:r.pixels[a]-d/2}}function ktt(a,r,l,n){let s=r.pixels,d=s[a],m=a>0?s[a-1]:null,_=a<s.length-1?s[a+1]:null,w=l.categoryPercentage;m===null&&(m=d-(_===null?r.end-r.start:_-d)),_===null&&(_=d+d-m);let S=d-(d-Math.min(m,_))/2*w;return{chunk:Math.abs(_-m)/2*w/n,ratio:l.barPercentage,start:S}}function Rtt(a,r,l,n){let s=l.parse(a[0],n),d=l.parse(a[1],n),m=Math.min(s,d),_=Math.max(s,d),w=m,S=_;Math.abs(m)>Math.abs(_)&&(w=_,S=m),r[l.axis]=S,r._custom={barStart:w,barEnd:S,start:s,end:d,min:m,max:_}}function A4(a,r,l,n){return kr(a)?Rtt(a,r,l,n):r[l.axis]=l.parse(a,n),r}function GB(a,r,l,n){let s=a.iScale,d=a.vScale,m=s.getLabels(),_=s===d,w=[],S,T,L,H;for(S=l,T=l+n;S<T;++S)H=r[S],L={},L[s.axis]=_||s.parse(m[S],S),w.push(A4(H,L,d,S));return w}function fD(a){return a&&a.barStart!==void 0&&a.barEnd!==void 0}function Ptt(a,r,l){return a!==0?_l(a):(r.isHorizontal()?1:-1)*(r.min>=l?1:-1)}function Ott(a){let r,l,n,s,d;return a.horizontal?(r=a.base>a.x,l="left",n="right"):(r=a.base<a.y,l="bottom",n="top"),r?(s="end",d="start"):(s="start",d="end"),{start:l,end:n,reverse:r,top:s,bottom:d}}function Ftt(a,r,l,n){let s=r.borderSkipped,d={};if(!s){a.borderSkipped=d;return}if(s===!0){a.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}let{start:m,end:_,reverse:w,top:S,bottom:T}=Ott(a);s==="middle"&&l&&(a.enableBorderRadius=!0,(l._top||0)===n?s=S:(l._bottom||0)===n?s=T:(d[qB(T,m,_,w)]=!0,s=S)),d[qB(s,m,_,w)]=!0,a.borderSkipped=d}function qB(a,r,l,n){return n?(a=Ltt(a,r,l),a=WB(a,l,r)):a=WB(a,r,l),a}function Ltt(a,r,l){return a===r?l:a===l?r:a}function WB(a,r,l){return a==="start"?r:a==="end"?l:a}function ztt(a,{inflateAmount:r},l){a.inflateAmount=r==="auto"?l===1?.33:0:r}var Ntt=(()=>{class a extends Kl{parsePrimitiveData(l,n,s,d){return GB(l,n,s,d)}parseArrayData(l,n,s,d){return GB(l,n,s,d)}parseObjectData(l,n,s,d){let{iScale:m,vScale:_}=l,{xAxisKey:w="x",yAxisKey:S="y"}=this._parsing,T=m.axis==="x"?w:S,L=_.axis==="x"?w:S,H=[],q,X,it,at;for(q=s,X=s+d;q<X;++q)at=n[q],it={},it[m.axis]=m.parse(Rc(at,T),q),H.push(A4(Rc(at,L),it,_,q));return H}updateRangeFromParsed(l,n,s,d){super.updateRangeFromParsed(l,n,s,d);let m=s._custom;m&&n===this._cachedMeta.vScale&&(l.min=Math.min(l.min,m.min),l.max=Math.max(l.max,m.max))}getMaxOverflow(){return 0}getLabelAndValue(l){let n=this._cachedMeta,{iScale:s,vScale:d}=n,m=this.getParsed(l),_=m._custom,w=fD(_)?"["+_.start+", "+_.end+"]":""+d.getLabelForValue(m[d.axis]);return{label:""+s.getLabelForValue(m[s.axis]),value:w}}initialize(){this.enableOptionSharing=!0,super.initialize();let l=this._cachedMeta;l.stack=this.getDataset().stack}update(l){let n=this._cachedMeta;this.updateElements(n.data,0,n.data.length,l)}updateElements(l,n,s,d){let m=d==="reset",{index:_,_cachedMeta:{vScale:w}}=this,S=w.getBasePixel(),T=w.isHorizontal(),L=this._getRuler(),{sharedOptions:H,includeOptions:q}=this._getSharedOptions(n,d);for(let X=n;X<n+s;X++){let it=this.getParsed(X),at=m||Pn(it[w.axis])?{base:S,head:S}:this._calculateBarValuePixels(X),ut=this._calculateBarIndexPixels(X,L),Mt=(it._stacks||{})[w.axis],Lt={horizontal:T,base:at.base,enableBorderRadius:!Mt||fD(it._custom)||_===Mt._top||_===Mt._bottom,x:T?at.head:ut.center,y:T?ut.center:at.head,height:T?ut.size:Math.abs(at.size),width:T?Math.abs(at.size):ut.size};q&&(Lt.options=H||this.resolveDataElementOptions(X,l[X].active?"active":d));let Pt=Lt.options||l[X].options;Ftt(Lt,Pt,Mt,_),ztt(Lt,Pt,L.ratio),this.updateElement(l[X],X,Lt,d)}}_getStacks(l,n){let{iScale:s}=this._cachedMeta,d=s.getMatchingVisibleMetas(this._type).filter(S=>S.controller.options.grouped),m=s.options.stacked,_=[],w=S=>{let T=S.controller.getParsed(n),L=T&&T[S.vScale.axis];if(Pn(L)||isNaN(L))return!0};for(let S of d)if(!(n!==void 0&&w(S))&&((m===!1||_.indexOf(S.stack)===-1||m===void 0&&S.stack===void 0)&&_.push(S.stack),S.index===l))break;return _.length||_.push(void 0),_}_getStackCount(l){return this._getStacks(void 0,l).length}_getStackIndex(l,n,s){let d=this._getStacks(l,s),m=n!==void 0?d.indexOf(n):-1;return m===-1?d.length-1:m}_getRuler(){let l=this.options,n=this._cachedMeta,s=n.iScale,d=[],m,_;for(m=0,_=n.data.length;m<_;++m)d.push(s.getPixelForValue(this.getParsed(m)[s.axis],m));let w=l.barThickness;return{min:w||Itt(n),pixels:d,start:s._startPixel,end:s._endPixel,stackCount:this._getStackCount(),scale:s,grouped:l.grouped,ratio:w?1:l.categoryPercentage*l.barPercentage}}_calculateBarValuePixels(l){let{_cachedMeta:{vScale:n,_stacked:s},options:{base:d,minBarLength:m}}=this,_=d||0,w=this.getParsed(l),S=w._custom,T=fD(S),L=w[n.axis],H=0,q=s?this.applyStack(n,w,s):L,X,it;q!==L&&(H=q-L,q=L),T&&(L=S.barStart,q=S.barEnd-S.barStart,L!==0&&_l(L)!==_l(S.barEnd)&&(H=0),H+=L);let at=!Pn(d)&&!T?d:H,ut=n.getPixelForValue(at);if(this.chart.getDataVisibility(l)?X=n.getPixelForValue(H+q):X=ut,it=X-ut,Math.abs(it)<m){it=Ptt(it,n,_)*m,L===_&&(ut-=it/2);let Mt=n.getPixelForDecimal(0),Lt=n.getPixelForDecimal(1),Pt=Math.min(Mt,Lt),Nt=Math.max(Mt,Lt);ut=Math.max(Math.min(ut,Nt),Pt),X=ut+it}if(ut===n.getPixelForValue(_)){let Mt=_l(it)*n.getLineWidthForValue(_)/2;ut+=Mt,it-=Mt}return{size:it,base:ut,head:X,center:X+it/2}}_calculateBarIndexPixels(l,n){let s=n.scale,d=this.options,m=d.skipNull,_=nn(d.maxBarThickness,1/0),w,S;if(n.grouped){let T=m?this._getStackCount(l):n.stackCount,L=d.barThickness==="flex"?ktt(l,n,d,T):Att(l,n,d,T),H=this._getStackIndex(this.index,this._cachedMeta.stack,m?l:void 0);w=L.start+L.chunk*H+L.chunk/2,S=Math.min(_,L.chunk*L.ratio)}else w=s.getPixelForValue(this.getParsed(l)[s.axis],l),S=Math.min(_,n.min*n.ratio);return{base:w-S/2,head:w+S/2,center:w,size:S}}draw(){let l=this._cachedMeta,n=l.vScale,s=l.data,d=s.length,m=0;for(;m<d;++m)this.getParsed(m)[n.axis]!==null&&s[m].draw(this._ctx)}}return a.id="bar",a.defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}},a.overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}},a})(),Btt=(()=>{class a extends Kl{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(l,n,s,d){let m=super.parsePrimitiveData(l,n,s,d);for(let _=0;_<m.length;_++)m[_]._custom=this.resolveDataElementOptions(_+s).radius;return m}parseArrayData(l,n,s,d){let m=super.parseArrayData(l,n,s,d);for(let _=0;_<m.length;_++){let w=n[s+_];m[_]._custom=nn(w[2],this.resolveDataElementOptions(_+s).radius)}return m}parseObjectData(l,n,s,d){let m=super.parseObjectData(l,n,s,d);for(let _=0;_<m.length;_++){let w=n[s+_];m[_]._custom=nn(w&&w.r&&+w.r,this.resolveDataElementOptions(_+s).radius)}return m}getMaxOverflow(){let l=this._cachedMeta.data,n=0;for(let s=l.length-1;s>=0;--s)n=Math.max(n,l[s].size(this.resolveDataElementOptions(s))/2);return n>0&&n}getLabelAndValue(l){let n=this._cachedMeta,{xScale:s,yScale:d}=n,m=this.getParsed(l),_=s.getLabelForValue(m.x),w=d.getLabelForValue(m.y),S=m._custom;return{label:n.label,value:"("+_+", "+w+(S?", "+S:"")+")"}}update(l){let n=this._cachedMeta.data;this.updateElements(n,0,n.length,l)}updateElements(l,n,s,d){let m=d==="reset",{iScale:_,vScale:w}=this._cachedMeta,{sharedOptions:S,includeOptions:T}=this._getSharedOptions(n,d),L=_.axis,H=w.axis;for(let q=n;q<n+s;q++){let X=l[q],it=!m&&this.getParsed(q),at={},ut=at[L]=m?_.getPixelForDecimal(.5):_.getPixelForValue(it[L]),Mt=at[H]=m?w.getBasePixel():w.getPixelForValue(it[H]);at.skip=isNaN(ut)||isNaN(Mt),T&&(at.options=S||this.resolveDataElementOptions(q,X.active?"active":d),m&&(at.options.radius=0)),this.updateElement(X,q,at,d)}}resolveDataElementOptions(l,n){let s=this.getParsed(l),d=super.resolveDataElementOptions(l,n);d.$shared&&(d=Object.assign({},d,{$shared:!1}));let m=d.radius;return n!=="active"&&(d.radius=0),d.radius+=nn(s&&s._custom,m),d}}return a.id="bubble",a.defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}},a.overrides={scales:{x:{type:"linear"},y:{type:"linear"}},plugins:{tooltip:{callbacks:{title(){return""}}}}},a})();function Vtt(a,r,l){let n=1,s=1,d=0,m=0;if(r<mr){let _=a,w=_+r,S=Math.cos(_),T=Math.sin(_),L=Math.cos(w),H=Math.sin(w),q=(Lt,Pt,Nt)=>Nm(Lt,_,w,!0)?1:Math.max(Pt,Pt*l,Nt,Nt*l),X=(Lt,Pt,Nt)=>Nm(Lt,_,w,!0)?-1:Math.min(Pt,Pt*l,Nt,Nt*l),it=q(0,S,L),at=q(ao,T,H),ut=X(Ur,S,L),Mt=X(Ur+ao,T,H);n=(it-ut)/2,s=(at-Mt)/2,d=-(it+ut)/2,m=-(at+Mt)/2}return{ratioX:n,ratioY:s,offsetX:d,offsetY:m}}var k4=(()=>{class a extends Kl{constructor(l,n){super(l,n),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(l,n){let s=this.getDataset().data,d=this._cachedMeta;if(this._parsing===!1)d._parsed=s;else{let m=S=>+s[S];if(bn(s[l])){let{key:S="value"}=this._parsing;m=T=>+Rc(s[T],S)}let _,w;for(_=l,w=l+n;_<w;++_)d._parsed[_]=m(_)}}_getRotation(){return Ia(this.options.rotation-90)}_getCircumference(){return Ia(this.options.circumference)}_getRotationExtents(){let l=mr,n=-mr;for(let s=0;s<this.chart.data.datasets.length;++s)if(this.chart.isDatasetVisible(s)){let d=this.chart.getDatasetMeta(s).controller,m=d._getRotation(),_=d._getCircumference();l=Math.min(l,m),n=Math.max(n,m+_)}return{rotation:l,circumference:n-l}}update(l){let n=this.chart,{chartArea:s}=n,d=this._cachedMeta,m=d.data,_=this.getMaxBorderWidth()+this.getMaxOffset(m)+this.options.spacing,w=Math.max((Math.min(s.width,s.height)-_)/2,0),S=Math.min(oB(this.options.cutout,w),1),T=this._getRingWeight(this.index),{circumference:L,rotation:H}=this._getRotationExtents(),{ratioX:q,ratioY:X,offsetX:it,offsetY:at}=Vtt(H,L,S),ut=(s.width-_)/q,Mt=(s.height-_)/X,Lt=Math.max(Math.min(ut,Mt)/2,0),Pt=zM(this.options.radius,Lt),Nt=Math.max(Pt*S,0),ue=(Pt-Nt)/this._getVisibleDatasetWeightTotal();this.offsetX=it*Pt,this.offsetY=at*Pt,d.total=this.calculateTotal(),this.outerRadius=Pt-ue*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-ue*T,0),this.updateElements(m,0,m.length,l)}_circumference(l,n){let s=this.options,d=this._cachedMeta,m=this._getCircumference();return n&&s.animation.animateRotate||!this.chart.getDataVisibility(l)||d._parsed[l]===null||d.data[l].hidden?0:this.calculateCircumference(d._parsed[l]*m/mr)}updateElements(l,n,s,d){let m=d==="reset",_=this.chart,w=_.chartArea,T=_.options.animation,L=(w.left+w.right)/2,H=(w.top+w.bottom)/2,q=m&&T.animateScale,X=q?0:this.innerRadius,it=q?0:this.outerRadius,{sharedOptions:at,includeOptions:ut}=this._getSharedOptions(n,d),Mt=this._getRotation(),Lt;for(Lt=0;Lt<n;++Lt)Mt+=this._circumference(Lt,m);for(Lt=n;Lt<n+s;++Lt){let Pt=this._circumference(Lt,m),Nt=l[Lt],ue={x:L+this.offsetX,y:H+this.offsetY,startAngle:Mt,endAngle:Mt+Pt,circumference:Pt,outerRadius:it,innerRadius:X};ut&&(ue.options=at||this.resolveDataElementOptions(Lt,Nt.active?"active":d)),Mt+=Pt,this.updateElement(Nt,Lt,ue,d)}}calculateTotal(){let l=this._cachedMeta,n=l.data,s=0,d;for(d=0;d<n.length;d++){let m=l._parsed[d];m!==null&&!isNaN(m)&&this.chart.getDataVisibility(d)&&!n[d].hidden&&(s+=Math.abs(m))}return s}calculateCircumference(l){let n=this._cachedMeta.total;return n>0&&!isNaN(l)?mr*(Math.abs(l)/n):0}getLabelAndValue(l){let n=this._cachedMeta,s=this.chart,d=s.data.labels||[],m=jm(n._parsed[l],s.options.locale);return{label:d[l]||"",value:m}}getMaxBorderWidth(l){let n=0,s=this.chart,d,m,_,w,S;if(!l){for(d=0,m=s.data.datasets.length;d<m;++d)if(s.isDatasetVisible(d)){_=s.getDatasetMeta(d),l=_.data,w=_.controller;break}}if(!l)return 0;for(d=0,m=l.length;d<m;++d)S=w.resolveDataElementOptions(d),S.borderAlign!=="inner"&&(n=Math.max(n,S.borderWidth||0,S.hoverBorderWidth||0));return n}getMaxOffset(l){let n=0;for(let s=0,d=l.length;s<d;++s){let m=this.resolveDataElementOptions(s);n=Math.max(n,m.offset||0,m.hoverOffset||0)}return n}_getRingWeightOffset(l){let n=0;for(let s=0;s<l;++s)this.chart.isDatasetVisible(s)&&(n+=this._getRingWeight(s));return n}_getRingWeight(l){return Math.max(nn(this.chart.data.datasets[l].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}return a.id="doughnut",a.defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"},a.descriptors={_scriptable:r=>r!=="spacing",_indexable:r=>r!=="spacing"},a.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(r){let l=r.data;if(l.labels.length&&l.datasets.length){let{labels:{pointStyle:n}}=r.legend.options;return l.labels.map((s,d)=>{let _=r.getDatasetMeta(0).controller.getStyle(d);return{text:s,fillStyle:_.backgroundColor,strokeStyle:_.borderColor,lineWidth:_.borderWidth,pointStyle:n,hidden:!r.getDataVisibility(d),index:d}})}return[]}},onClick(r,l,n){n.chart.toggleDataVisibility(l.index),n.chart.update()}},tooltip:{callbacks:{title(){return""},label(r){let l=r.label,n=": "+r.formattedValue;return kr(l)?(l=l.slice(),l[0]+=n):l+=n,l}}}}},a})(),jtt=(()=>{class a extends Kl{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(l){let n=this._cachedMeta,{dataset:s,data:d=[],_dataset:m}=n,_=this.chart._animationsDisabled,{start:w,count:S}=$M(n,d,_);this._drawStart=w,this._drawCount=S,YM(n)&&(w=0,S=d.length),s._chart=this.chart,s._datasetIndex=this.index,s._decimated=!!m._decimated,s.points=d;let T=this.resolveDatasetElementOptions(l);this.options.showLine||(T.borderWidth=0),T.segment=this.options.segment,this.updateElement(s,void 0,{animated:!_,options:T},l),this.updateElements(d,w,S,l)}updateElements(l,n,s,d){let m=d==="reset",{iScale:_,vScale:w,_stacked:S,_dataset:T}=this._cachedMeta,{sharedOptions:L,includeOptions:H}=this._getSharedOptions(n,d),q=_.axis,X=w.axis,{spanGaps:it,segment:at}=this.options,ut=Bu(it)?it:Number.POSITIVE_INFINITY,Mt=this.chart._animationsDisabled||m||d==="none",Lt=n>0&&this.getParsed(n-1);for(let Pt=n;Pt<n+s;++Pt){let Nt=l[Pt],ue=this.getParsed(Pt),Q=Mt?Nt:{},$t=Pn(ue[X]),Be=Q[q]=_.getPixelForValue(ue[q],Pt),Ai=Q[X]=m||$t?w.getBasePixel():w.getPixelForValue(S?this.applyStack(w,ue,S):ue[X],Pt);Q.skip=isNaN(Be)||isNaN(Ai)||$t,Q.stop=Pt>0&&Math.abs(ue[q]-Lt[q])>ut,at&&(Q.parsed=ue,Q.raw=T.data[Pt]),H&&(Q.options=L||this.resolveDataElementOptions(Pt,Nt.active?"active":d)),Mt||this.updateElement(Nt,Pt,Q,d),Lt=ue}}getMaxOverflow(){let l=this._cachedMeta,n=l.dataset,s=n.options&&n.options.borderWidth||0,d=l.data||[];if(!d.length)return s;let m=d[0].size(this.resolveDataElementOptions(0)),_=d[d.length-1].size(this.resolveDataElementOptions(d.length-1));return Math.max(s,m,_)/2}draw(){let l=this._cachedMeta;l.dataset.updateControlPoints(this.chart.chartArea,l.iScale.axis),super.draw()}}return a.id="line",a.defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1},a.overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}},a})(),Utt=(()=>{class a extends Kl{constructor(l,n){super(l,n),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(l){let n=this._cachedMeta,s=this.chart,d=s.data.labels||[],m=jm(n._parsed[l].r,s.options.locale);return{label:d[l]||"",value:m}}parseObjectData(l,n,s,d){return oD.bind(this)(l,n,s,d)}update(l){let n=this._cachedMeta.data;this._updateRadius(),this.updateElements(n,0,n.length,l)}getMinMax(){let l=this._cachedMeta,n={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return l.data.forEach((s,d)=>{let m=this.getParsed(d).r;!isNaN(m)&&this.chart.getDataVisibility(d)&&(m<n.min&&(n.min=m),m>n.max&&(n.max=m))}),n}_updateRadius(){let l=this.chart,n=l.chartArea,s=l.options,d=Math.min(n.right-n.left,n.bottom-n.top),m=Math.max(d/2,0),_=Math.max(s.cutoutPercentage?m/100*s.cutoutPercentage:1,0),w=(m-_)/l.getVisibleDatasetCount();this.outerRadius=m-w*this.index,this.innerRadius=this.outerRadius-w}updateElements(l,n,s,d){let m=d==="reset",_=this.chart,S=_.options.animation,T=this._cachedMeta.rScale,L=T.xCenter,H=T.yCenter,q=T.getIndexAngle(0)-.5*Ur,X=q,it,at=360/this.countVisibleElements();for(it=0;it<n;++it)X+=this._computeAngle(it,d,at);for(it=n;it<n+s;it++){let ut=l[it],Mt=X,Lt=X+this._computeAngle(it,d,at),Pt=_.getDataVisibility(it)?T.getDistanceFromCenterForValue(this.getParsed(it).r):0;X=Lt,m&&(S.animateScale&&(Pt=0),S.animateRotate&&(Mt=Lt=q));let Nt={x:L,y:H,innerRadius:0,outerRadius:Pt,startAngle:Mt,endAngle:Lt,options:this.resolveDataElementOptions(it,ut.active?"active":d)};this.updateElement(ut,it,Nt,d)}}countVisibleElements(){let l=this._cachedMeta,n=0;return l.data.forEach((s,d)=>{!isNaN(this.getParsed(d).r)&&this.chart.getDataVisibility(d)&&n++}),n}_computeAngle(l,n,s){return this.chart.getDataVisibility(l)?Ia(this.resolveDataElementOptions(l,n).angle||s):0}}return a.id="polarArea",a.defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0},a.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(r){let l=r.data;if(l.labels.length&&l.datasets.length){let{labels:{pointStyle:n}}=r.legend.options;return l.labels.map((s,d)=>{let _=r.getDatasetMeta(0).controller.getStyle(d);return{text:s,fillStyle:_.backgroundColor,strokeStyle:_.borderColor,lineWidth:_.borderWidth,pointStyle:n,hidden:!r.getDataVisibility(d),index:d}})}return[]}},onClick(r,l,n){n.chart.toggleDataVisibility(l.index),n.chart.update()}},tooltip:{callbacks:{title(){return""},label(r){return r.chart.data.labels[r.dataIndex]+": "+r.formattedValue}}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}},a})(),Htt=(()=>{class a extends k4{}return a.id="pie",a.defaults={cutout:0,rotation:0,circumference:360,radius:"100%"},a})(),Gtt=(()=>{class a extends Kl{getLabelAndValue(l){let n=this._cachedMeta.vScale,s=this.getParsed(l);return{label:n.getLabels()[l],value:""+n.getLabelForValue(s[n.axis])}}parseObjectData(l,n,s,d){return oD.bind(this)(l,n,s,d)}update(l){let n=this._cachedMeta,s=n.dataset,d=n.data||[],m=n.iScale.getLabels();if(s.points=d,l!=="resize"){let _=this.resolveDatasetElementOptions(l);this.options.showLine||(_.borderWidth=0);let w={_loop:!0,_fullLoop:m.length===d.length,options:_};this.updateElement(s,void 0,w,l)}this.updateElements(d,0,d.length,l)}updateElements(l,n,s,d){let m=this._cachedMeta.rScale,_=d==="reset";for(let w=n;w<n+s;w++){let S=l[w],T=this.resolveDataElementOptions(w,S.active?"active":d),L=m.getPointPositionForValue(w,this.getParsed(w).r),H=_?m.xCenter:L.x,q=_?m.yCenter:L.y,X={x:H,y:q,angle:L.angle,skip:isNaN(H)||isNaN(q),options:T};this.updateElement(S,w,X,d)}}}return a.id="radar",a.defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}},a.overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}},a})(),ia=class{constructor(){this.x=void 0,this.y=void 0,this.active=!1,this.options=void 0,this.$animations=void 0}tooltipPosition(r){let{x:l,y:n}=this.getProps(["x","y"],r);return{x:l,y:n}}hasValue(){return Bu(this.x)&&Bu(this.y)}getProps(r,l){let n=this.$animations;if(!l||!n)return this;let s={};return r.forEach(d=>{s[d]=n[d]&&n[d].active()?n[d]._to:this[d]}),s}};ia.defaults={};ia.defaultRoutes=void 0;var R4={values(a){return kr(a)?a:""+a},numeric(a,r,l){if(a===0)return"0";let n=this.chart.options.locale,s,d=a;if(l.length>1){let S=Math.max(Math.abs(l[0].value),Math.abs(l[l.length-1].value));(S<1e-4||S>1e15)&&(s="scientific"),d=qtt(a,l)}let m=ea(Math.abs(d)),_=Math.max(Math.min(-1*Math.floor(m),20),0),w={notation:s,minimumFractionDigits:_,maximumFractionDigits:_};return Object.assign(w,this.options.ticks.format),jm(a,n,w)},logarithmic(a,r,l){if(a===0)return"0";let n=a/Math.pow(10,Math.floor(ea(a)));return n===1||n===2||n===5?R4.numeric.call(this,a,r,l):""}};function qtt(a,r){let l=r.length>3?r[2].value-r[1].value:r[1].value-r[0].value;return Math.abs(l)>=1&&a!==Math.floor(a)&&(l=a-Math.floor(a)),l}var Tb={formatters:R4};xn.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",grace:0,grid:{display:!0,lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(a,r)=>r.lineWidth,tickColor:(a,r)=>r.color,offset:!1,borderDash:[],borderDashOffset:0,borderWidth:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Tb.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}});xn.route("scale.ticks","color","","color");xn.route("scale.grid","color","","borderColor");xn.route("scale.grid","borderColor","","borderColor");xn.route("scale.title","color","","color");xn.describe("scale",{_fallback:!1,_scriptable:a=>!a.startsWith("before")&&!a.startsWith("after")&&a!=="callback"&&a!=="parser",_indexable:a=>a!=="borderDash"&&a!=="tickBorderDash"});xn.describe("scales",{_fallback:"scale"});xn.describe("scale.ticks",{_scriptable:a=>a!=="backdropPadding"&&a!=="callback",_indexable:a=>a!=="backdropPadding"});function Wtt(a,r){let l=a.options.ticks,n=l.maxTicksLimit||$tt(a),s=l.major.enabled?Ztt(r):[],d=s.length,m=s[0],_=s[d-1],w=[];if(d>n)return Xtt(r,w,s,d/n),w;let S=Ytt(s,r,n);if(d>0){let T,L,H=d>1?Math.round((_-m)/(d-1)):null;for(fb(r,w,S,Pn(H)?0:m-H,m),T=0,L=d-1;T<L;T++)fb(r,w,S,s[T],s[T+1]);return fb(r,w,S,_,Pn(H)?r.length:_+H),w}return fb(r,w,S),w}function $tt(a){let r=a.options.offset,l=a._tickSize(),n=a._length/l+(r?0:1),s=a._maxLength/l;return Math.floor(Math.min(n,s))}function Ytt(a,r,l){let n=Ktt(a),s=r.length/l;if(!n)return Math.max(s,1);let d=lB(n);for(let m=0,_=d.length-1;m<_;m++){let w=d[m];if(w>s)return w}return Math.max(s,1)}function Ztt(a){let r=[],l,n;for(l=0,n=a.length;l<n;l++)a[l].major&&r.push(l);return r}function Xtt(a,r,l,n){let s=0,d=l[0],m;for(n=Math.ceil(n),m=0;m<a.length;m++)m===d&&(r.push(a[m]),s++,d=l[s*n])}function fb(a,r,l,n,s){let d=nn(n,0),m=Math.min(nn(s,a.length),a.length),_=0,w,S,T;for(l=Math.ceil(l),s&&(w=s-n,l=w/Math.floor(w/l)),T=d;T<0;)_++,T=Math.round(d+_*l);for(S=Math.max(d,0);S<m;S++)S===T&&(r.push(a[S]),_++,T=Math.round(d+_*l))}function Ktt(a){let r=a.length,l,n;if(r<2)return!1;for(n=a[0],l=1;l<r;++l)if(a[l]-a[l-1]!==n)return!1;return n}var Qtt=a=>a==="left"?"right":a==="right"?"left":a,$B=(a,r,l)=>r==="top"||r==="left"?a[r]+l:a[r]-l;function YB(a,r){let l=[],n=a.length/r,s=a.length,d=0;for(;d<s;d+=n)l.push(a[Math.floor(d)]);return l}function Jtt(a,r,l){let n=a.ticks.length,s=Math.min(r,n-1),d=a._startPixel,m=a._endPixel,_=1e-6,w=a.getPixelForTick(s),S;if(!(l&&(n===1?S=Math.max(w-d,m-w):r===0?S=(a.getPixelForTick(1)-w)/2:S=(w-a.getPixelForTick(s-1))/2,w+=s<r?S:-S,w<d-_||w>m+_)))return w}function tet(a,r){lr(a,l=>{let n=l.gc,s=n.length/2,d;if(s>r){for(d=0;d<s;++d)delete l.data[n[d]];n.splice(0,s)}})}function Rg(a){return a.drawTicks?a.tickLength:0}function ZB(a,r){if(!a.display)return 0;let l=zo(a.font,r),n=Jo(a.padding);return(kr(a.text)?a.text.length:1)*l.lineHeight+n.height}function eet(a,r){return Pc(a,{scale:r,type:"scale"})}function iet(a,r,l){return Pc(a,{tick:l,index:r,type:"tick"})}function net(a,r,l){let n=lb(a);return(l&&r!=="right"||!l&&r==="right")&&(n=Qtt(n)),n}function ret(a,r,l,n){let{top:s,left:d,bottom:m,right:_,chart:w}=a,{chartArea:S,scales:T}=w,L=0,H,q,X,it=m-s,at=_-d;if(a.isHorizontal()){if(q=Qo(n,d,_),bn(l)){let ut=Object.keys(l)[0],Mt=l[ut];X=T[ut].getPixelForValue(Mt)+it-r}else l==="center"?X=(S.bottom+S.top)/2+it-r:X=$B(a,l,r);H=_-d}else{if(bn(l)){let ut=Object.keys(l)[0],Mt=l[ut];q=T[ut].getPixelForValue(Mt)-at+r}else l==="center"?q=(S.left+S.right)/2-at+r:q=$B(a,l,r);X=Qo(n,m,s),L=l==="left"?-ao:ao}return{titleX:q,titleY:X,maxWidth:H,rotation:L}}var Uu=class a extends ia{constructor(r){super(),this.id=r.id,this.type=r.type,this.options=void 0,this.ctx=r.ctx,this.chart=r.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(r){this.options=r.setContext(this.getContext()),this.axis=r.axis,this._userMin=this.parse(r.min),this._userMax=this.parse(r.max),this._suggestedMin=this.parse(r.suggestedMin),this._suggestedMax=this.parse(r.suggestedMax)}parse(r,l){return r}getUserBounds(){let{_userMin:r,_userMax:l,_suggestedMin:n,_suggestedMax:s}=this;return r=ta(r,Number.POSITIVE_INFINITY),l=ta(l,Number.NEGATIVE_INFINITY),n=ta(n,Number.POSITIVE_INFINITY),s=ta(s,Number.NEGATIVE_INFINITY),{min:ta(r,n),max:ta(l,s),minDefined:go(r),maxDefined:go(l)}}getMinMax(r){let{min:l,max:n,minDefined:s,maxDefined:d}=this.getUserBounds(),m;if(s&&d)return{min:l,max:n};let _=this.getMatchingVisibleMetas();for(let w=0,S=_.length;w<S;++w)m=_[w].controller.getMinMax(this,r),s||(l=Math.min(l,m.min)),d||(n=Math.max(n,m.max));return l=d&&l>n?n:l,n=s&&l>n?l:n,{min:ta(l,ta(n,l)),max:ta(n,ta(l,n))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){let r=this.chart.data;return this.options.labels||(this.isHorizontal()?r.xLabels:r.yLabels)||r.labels||[]}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Rr(this.options.beforeUpdate,[this])}update(r,l,n){let{beginAtZero:s,grace:d,ticks:m}=this.options,_=m.sampleSize;this.beforeUpdate(),this.maxWidth=r,this.maxHeight=l,this._margins=n=Object.assign({left:0,right:0,top:0,bottom:0},n),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+n.left+n.right:this.height+n.top+n.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=EB(this,d,s),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();let w=_<this.ticks.length;this._convertTicksToLabels(w?YB(this.ticks,_):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),m.display&&(m.autoSkip||m.source==="auto")&&(this.ticks=Wtt(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),w&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let r=this.options.reverse,l,n;this.isHorizontal()?(l=this.left,n=this.right):(l=this.top,n=this.bottom,r=!r),this._startPixel=l,this._endPixel=n,this._reversePixels=r,this._length=n-l,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Rr(this.options.afterUpdate,[this])}beforeSetDimensions(){Rr(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Rr(this.options.afterSetDimensions,[this])}_callHooks(r){this.chart.notifyPlugins(r,this.getContext()),Rr(this.options[r],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Rr(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(r){let l=this.options.ticks,n,s,d;for(n=0,s=r.length;n<s;n++)d=r[n],d.label=Rr(l.callback,[d.value,n,r],this)}afterTickToLabelConversion(){Rr(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Rr(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){let r=this.options,l=r.ticks,n=this.ticks.length,s=l.minRotation||0,d=l.maxRotation,m=s,_,w,S;if(!this._isVisible()||!l.display||s>=d||n<=1||!this.isHorizontal()){this.labelRotation=s;return}let T=this._getLabelSizes(),L=T.widest.width,H=T.highest.height,q=Uo(this.chart.width-L,0,this.maxWidth);_=r.offset?this.maxWidth/n:q/(n-1),L+6>_&&(_=q/(n-(r.offset?.5:1)),w=this.maxHeight-Rg(r.grid)-l.padding-ZB(r.title,this.chart.options.font),S=Math.sqrt(L*L+H*H),m=sb(Math.min(Math.asin(Uo((T.highest.height+6)/_,-1,1)),Math.asin(Uo(w/S,-1,1))-Math.asin(Uo(H/S,-1,1)))),m=Math.max(s,Math.min(d,m))),this.labelRotation=m}afterCalculateLabelRotation(){Rr(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Rr(this.options.beforeFit,[this])}fit(){let r={width:0,height:0},{chart:l,options:{ticks:n,title:s,grid:d}}=this,m=this._isVisible(),_=this.isHorizontal();if(m){let w=ZB(s,l.options.font);if(_?(r.width=this.maxWidth,r.height=Rg(d)+w):(r.height=this.maxHeight,r.width=Rg(d)+w),n.display&&this.ticks.length){let{first:S,last:T,widest:L,highest:H}=this._getLabelSizes(),q=n.padding*2,X=Ia(this.labelRotation),it=Math.cos(X),at=Math.sin(X);if(_){let ut=n.mirror?0:at*L.width+it*H.height;r.height=Math.min(this.maxHeight,r.height+ut+q)}else{let ut=n.mirror?0:it*L.width+at*H.height;r.width=Math.min(this.maxWidth,r.width+ut+q)}this._calculatePadding(S,T,at,it)}}this._handleMargins(),_?(this.width=this._length=l.width-this._margins.left-this._margins.right,this.height=r.height):(this.width=r.width,this.height=this._length=l.height-this._margins.top-this._margins.bottom)}_calculatePadding(r,l,n,s){let{ticks:{align:d,padding:m},position:_}=this.options,w=this.labelRotation!==0,S=_!=="top"&&this.axis==="x";if(this.isHorizontal()){let T=this.getPixelForTick(0)-this.left,L=this.right-this.getPixelForTick(this.ticks.length-1),H=0,q=0;w?S?(H=s*r.width,q=n*l.height):(H=n*r.height,q=s*l.width):d==="start"?q=l.width:d==="end"?H=r.width:d!=="inner"&&(H=r.width/2,q=l.width/2),this.paddingLeft=Math.max((H-T+m)*this.width/(this.width-T),0),this.paddingRight=Math.max((q-L+m)*this.width/(this.width-L),0)}else{let T=l.height/2,L=r.height/2;d==="start"?(T=0,L=r.height):d==="end"&&(T=l.height,L=0),this.paddingTop=T+m,this.paddingBottom=L+m}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Rr(this.options.afterFit,[this])}isHorizontal(){let{axis:r,position:l}=this.options;return l==="top"||l==="bottom"||r==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(r){this.beforeTickToLabelConversion(),this.generateTickLabels(r);let l,n;for(l=0,n=r.length;l<n;l++)Pn(r[l].label)&&(r.splice(l,1),n--,l--);this.afterTickToLabelConversion()}_getLabelSizes(){let r=this._labelSizes;if(!r){let l=this.options.ticks.sampleSize,n=this.ticks;l<n.length&&(n=YB(n,l)),this._labelSizes=r=this._computeLabelSizes(n,n.length)}return r}_computeLabelSizes(r,l){let{ctx:n,_longestTextCache:s}=this,d=[],m=[],_=0,w=0,S,T,L,H,q,X,it,at,ut,Mt,Lt;for(S=0;S<l;++S){if(H=r[S].label,q=this._resolveTickFontOptions(S),n.font=X=q.string,it=s[X]=s[X]||{data:{},gc:[]},at=q.lineHeight,ut=Mt=0,!Pn(H)&&!kr(H))ut=Mg(n,it.data,it.gc,ut,H),Mt=at;else if(kr(H))for(T=0,L=H.length;T<L;++T)Lt=H[T],!Pn(Lt)&&!kr(Lt)&&(ut=Mg(n,it.data,it.gc,ut,Lt),Mt+=at);d.push(ut),m.push(Mt),_=Math.max(ut,_),w=Math.max(Mt,w)}tet(s,l);let Pt=d.indexOf(_),Nt=m.indexOf(w),ue=Q=>({width:d[Q]||0,height:m[Q]||0});return{first:ue(0),last:ue(l-1),widest:ue(Pt),highest:ue(Nt),widths:d,heights:m}}getLabelForValue(r){return r}getPixelForValue(r,l){return NaN}getValueForPixel(r){}getPixelForTick(r){let l=this.ticks;return r<0||r>l.length-1?null:this.getPixelForValue(l[r].value)}getPixelForDecimal(r){this._reversePixels&&(r=1-r);let l=this._startPixel+r*this._length;return dB(this._alignToPixels?Id(this.chart,l,0):l)}getDecimalForPixel(r){let l=(r-this._startPixel)/this._length;return this._reversePixels?1-l:l}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){let{min:r,max:l}=this;return r<0&&l<0?l:r>0&&l>0?r:0}getContext(r){let l=this.ticks||[];if(r>=0&&r<l.length){let n=l[r];return n.$context||(n.$context=iet(this.getContext(),r,n))}return this.$context||(this.$context=eet(this.chart.getContext(),this))}_tickSize(){let r=this.options.ticks,l=Ia(this.labelRotation),n=Math.abs(Math.cos(l)),s=Math.abs(Math.sin(l)),d=this._getLabelSizes(),m=r.autoSkipPadding||0,_=d?d.widest.width+m:0,w=d?d.highest.height+m:0;return this.isHorizontal()?w*n>_*s?_/n:w/s:w*s<_*n?w/n:_/s}_isVisible(){let r=this.options.display;return r!=="auto"?!!r:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(r){let l=this.axis,n=this.chart,s=this.options,{grid:d,position:m}=s,_=d.offset,w=this.isHorizontal(),T=this.ticks.length+(_?1:0),L=Rg(d),H=[],q=d.setContext(this.getContext()),X=q.drawBorder?q.borderWidth:0,it=X/2,at=function(ki){return Id(n,ki,X)},ut,Mt,Lt,Pt,Nt,ue,Q,$t,Be,Ai,fe,ii;if(m==="top")ut=at(this.bottom),ue=this.bottom-L,$t=ut-it,Ai=at(r.top)+it,ii=r.bottom;else if(m==="bottom")ut=at(this.top),Ai=r.top,ii=at(r.bottom)-it,ue=ut+it,$t=this.top+L;else if(m==="left")ut=at(this.right),Nt=this.right-L,Q=ut-it,Be=at(r.left)+it,fe=r.right;else if(m==="right")ut=at(this.left),Be=r.left,fe=at(r.right)-it,Nt=ut+it,Q=this.left+L;else if(l==="x"){if(m==="center")ut=at((r.top+r.bottom)/2+.5);else if(bn(m)){let ki=Object.keys(m)[0],jn=m[ki];ut=at(this.chart.scales[ki].getPixelForValue(jn))}Ai=r.top,ii=r.bottom,ue=ut+it,$t=ue+L}else if(l==="y"){if(m==="center")ut=at((r.left+r.right)/2);else if(bn(m)){let ki=Object.keys(m)[0],jn=m[ki];ut=at(this.chart.scales[ki].getPixelForValue(jn))}Nt=ut-it,Q=Nt-L,Be=r.left,fe=r.right}let Pi=nn(s.ticks.maxTicksLimit,T),Cr=Math.max(1,Math.ceil(T/Pi));for(Mt=0;Mt<T;Mt+=Cr){let ki=d.setContext(this.getContext(Mt)),jn=ki.lineWidth,fn=ki.color,fr=ki.borderDash||[],ve=ki.borderDashOffset,Go=ki.tickWidth,os=ki.tickColor,fs=ki.tickBorderDash||[],Us=ki.tickBorderDashOffset;Lt=Jtt(this,Mt,_),Lt!==void 0&&(Pt=Id(n,Lt,jn),w?Nt=Q=Be=fe=Pt:ue=$t=Ai=ii=Pt,H.push({tx1:Nt,ty1:ue,tx2:Q,ty2:$t,x1:Be,y1:Ai,x2:fe,y2:ii,width:jn,color:fn,borderDash:fr,borderDashOffset:ve,tickWidth:Go,tickColor:os,tickBorderDash:fs,tickBorderDashOffset:Us}))}return this._ticksLength=T,this._borderValue=ut,H}_computeLabelItems(r){let l=this.axis,n=this.options,{position:s,ticks:d}=n,m=this.isHorizontal(),_=this.ticks,{align:w,crossAlign:S,padding:T,mirror:L}=d,H=Rg(n.grid),q=H+T,X=L?-T:q,it=-Ia(this.labelRotation),at=[],ut,Mt,Lt,Pt,Nt,ue,Q,$t,Be,Ai,fe,ii,Pi="middle";if(s==="top")ue=this.bottom-X,Q=this._getXAxisLabelAlignment();else if(s==="bottom")ue=this.top+X,Q=this._getXAxisLabelAlignment();else if(s==="left"){let ki=this._getYAxisLabelAlignment(H);Q=ki.textAlign,Nt=ki.x}else if(s==="right"){let ki=this._getYAxisLabelAlignment(H);Q=ki.textAlign,Nt=ki.x}else if(l==="x"){if(s==="center")ue=(r.top+r.bottom)/2+q;else if(bn(s)){let ki=Object.keys(s)[0],jn=s[ki];ue=this.chart.scales[ki].getPixelForValue(jn)+q}Q=this._getXAxisLabelAlignment()}else if(l==="y"){if(s==="center")Nt=(r.left+r.right)/2-q;else if(bn(s)){let ki=Object.keys(s)[0],jn=s[ki];Nt=this.chart.scales[ki].getPixelForValue(jn)}Q=this._getYAxisLabelAlignment(H).textAlign}l==="y"&&(w==="start"?Pi="top":w==="end"&&(Pi="bottom"));let Cr=this._getLabelSizes();for(ut=0,Mt=_.length;ut<Mt;++ut){Lt=_[ut],Pt=Lt.label;let ki=d.setContext(this.getContext(ut));$t=this.getPixelForTick(ut)+d.labelOffset,Be=this._resolveTickFontOptions(ut),Ai=Be.lineHeight,fe=kr(Pt)?Pt.length:1;let jn=fe/2,fn=ki.color,fr=ki.textStrokeColor,ve=ki.textStrokeWidth,Go=Q;m?(Nt=$t,Q==="inner"&&(ut===Mt-1?Go=this.options.reverse?"left":"right":ut===0?Go=this.options.reverse?"right":"left":Go="center"),s==="top"?S==="near"||it!==0?ii=-fe*Ai+Ai/2:S==="center"?ii=-Cr.highest.height/2-jn*Ai+Ai:ii=-Cr.highest.height+Ai/2:S==="near"||it!==0?ii=Ai/2:S==="center"?ii=Cr.highest.height/2-jn*Ai:ii=Cr.highest.height-fe*Ai,L&&(ii*=-1)):(ue=$t,ii=(1-fe)*Ai/2);let os;if(ki.showLabelBackdrop){let fs=Jo(ki.backdropPadding),Us=Cr.heights[ut],ge=Cr.widths[ut],Ho=ue+ii-fs.top,Ud=Nt-fs.left;switch(Pi){case"middle":Ho-=Us/2;break;case"bottom":Ho-=Us;break}switch(Q){case"center":Ud-=ge/2;break;case"right":Ud-=ge;break}os={left:Ud,top:Ho,width:ge+fs.width,height:Us+fs.height,color:ki.backdropColor}}at.push({rotation:it,label:Pt,font:Be,color:fn,strokeColor:fr,strokeWidth:ve,textOffset:ii,textAlign:Go,textBaseline:Pi,translation:[Nt,ue],backdrop:os})}return at}_getXAxisLabelAlignment(){let{position:r,ticks:l}=this.options;if(-Ia(this.labelRotation))return r==="top"?"left":"right";let s="center";return l.align==="start"?s="left":l.align==="end"?s="right":l.align==="inner"&&(s="inner"),s}_getYAxisLabelAlignment(r){let{position:l,ticks:{crossAlign:n,mirror:s,padding:d}}=this.options,m=this._getLabelSizes(),_=r+d,w=m.widest.width,S,T;return l==="left"?s?(T=this.right+d,n==="near"?S="left":n==="center"?(S="center",T+=w/2):(S="right",T+=w)):(T=this.right-_,n==="near"?S="right":n==="center"?(S="center",T-=w/2):(S="left",T=this.left)):l==="right"?s?(T=this.left+d,n==="near"?S="right":n==="center"?(S="center",T-=w/2):(S="left",T-=w)):(T=this.left+_,n==="near"?S="left":n==="center"?(S="center",T+=w/2):(S="right",T=this.right)):S="right",{textAlign:S,x:T}}_computeLabelArea(){if(this.options.ticks.mirror)return;let r=this.chart,l=this.options.position;if(l==="left"||l==="right")return{top:0,left:this.left,bottom:r.height,right:this.right};if(l==="top"||l==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:r.width}}drawBackground(){let{ctx:r,options:{backgroundColor:l},left:n,top:s,width:d,height:m}=this;l&&(r.save(),r.fillStyle=l,r.fillRect(n,s,d,m),r.restore())}getLineWidthForValue(r){let l=this.options.grid;if(!this._isVisible()||!l.display)return 0;let s=this.ticks.findIndex(d=>d.value===r);return s>=0?l.setContext(this.getContext(s)).lineWidth:0}drawGrid(r){let l=this.options.grid,n=this.ctx,s=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(r)),d,m,_=(w,S,T)=>{!T.width||!T.color||(n.save(),n.lineWidth=T.width,n.strokeStyle=T.color,n.setLineDash(T.borderDash||[]),n.lineDashOffset=T.borderDashOffset,n.beginPath(),n.moveTo(w.x,w.y),n.lineTo(S.x,S.y),n.stroke(),n.restore())};if(l.display)for(d=0,m=s.length;d<m;++d){let w=s[d];l.drawOnChartArea&&_({x:w.x1,y:w.y1},{x:w.x2,y:w.y2},w),l.drawTicks&&_({x:w.tx1,y:w.ty1},{x:w.tx2,y:w.ty2},{color:w.tickColor,width:w.tickWidth,borderDash:w.tickBorderDash,borderDashOffset:w.tickBorderDashOffset})}}drawBorder(){let{chart:r,ctx:l,options:{grid:n}}=this,s=n.setContext(this.getContext()),d=n.drawBorder?s.borderWidth:0;if(!d)return;let m=n.setContext(this.getContext(0)).lineWidth,_=this._borderValue,w,S,T,L;this.isHorizontal()?(w=Id(r,this.left,d)-d/2,S=Id(r,this.right,m)+m/2,T=L=_):(T=Id(r,this.top,d)-d/2,L=Id(r,this.bottom,m)+m/2,w=S=_),l.save(),l.lineWidth=s.borderWidth,l.strokeStyle=s.borderColor,l.beginPath(),l.moveTo(w,T),l.lineTo(S,L),l.stroke(),l.restore()}drawLabels(r){if(!this.options.ticks.display)return;let n=this.ctx,s=this._computeLabelArea();s&&Ig(n,s);let d=this._labelItems||(this._labelItems=this._computeLabelItems(r)),m,_;for(m=0,_=d.length;m<_;++m){let w=d[m],S=w.font,T=w.label;w.backdrop&&(n.fillStyle=w.backdrop.color,n.fillRect(w.backdrop.left,w.backdrop.top,w.backdrop.width,w.backdrop.height));let L=w.textOffset;Ad(n,T,0,L,S,w)}s&&Ag(n)}drawTitle(){let{ctx:r,options:{position:l,title:n,reverse:s}}=this;if(!n.display)return;let d=zo(n.font),m=Jo(n.padding),_=n.align,w=d.lineHeight/2;l==="bottom"||l==="center"||bn(l)?(w+=m.bottom,kr(n.text)&&(w+=d.lineHeight*(n.text.length-1))):w+=m.top;let{titleX:S,titleY:T,maxWidth:L,rotation:H}=ret(this,w,l,_);Ad(r,n.text,0,0,d,{color:n.color,maxWidth:L,rotation:H,textAlign:net(_,l,s),textBaseline:"middle",translation:[S,T]})}draw(r){this._isVisible()&&(this.drawBackground(),this.drawGrid(r),this.drawBorder(),this.drawTitle(),this.drawLabels(r))}_layers(){let r=this.options,l=r.ticks&&r.ticks.z||0,n=nn(r.grid&&r.grid.z,-1);return!this._isVisible()||this.draw!==a.prototype.draw?[{z:l,draw:s=>{this.draw(s)}}]:[{z:n,draw:s=>{this.drawBackground(),this.drawGrid(s),this.drawTitle()}},{z:n+1,draw:()=>{this.drawBorder()}},{z:l,draw:s=>{this.drawLabels(s)}}]}getMatchingVisibleMetas(r){let l=this.chart.getSortedVisibleDatasetMetas(),n=this.axis+"AxisID",s=[],d,m;for(d=0,m=l.length;d<m;++d){let _=l[d];_[n]===this.id&&(!r||_.type===r)&&s.push(_)}return s}_resolveTickFontOptions(r){let l=this.options.ticks.setContext(this.getContext(r));return zo(l.font)}_maxDigits(){let r=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/r}},Hm=class{constructor(r,l,n){this.type=r,this.scope=l,this.override=n,this.items=Object.create(null)}isForType(r){return Object.prototype.isPrototypeOf.call(this.type.prototype,r.prototype)}register(r){let l=Object.getPrototypeOf(r),n;aet(l)&&(n=this.register(l));let s=this.items,d=r.id,m=this.scope+"."+d;if(!d)throw new Error("class does not have id: "+r);return d in s||(s[d]=r,oet(r,m,n),this.override&&xn.override(r.id,r.overrides)),m}get(r){return this.items[r]}unregister(r){let l=this.items,n=r.id,s=this.scope;n in l&&delete l[n],s&&n in xn[s]&&(delete xn[s][n],this.override&&delete Td[n])}};function oet(a,r,l){let n=Pm(Object.create(null),[l?xn.get(l):{},xn.get(r),a.defaults]);xn.set(r,n),a.defaultRoutes&&set(r,a.defaultRoutes),a.descriptors&&xn.describe(r,a.descriptors)}function set(a,r){Object.keys(r).forEach(l=>{let n=l.split("."),s=n.pop(),d=[a].concat(n).join("."),m=r[l].split("."),_=m.pop(),w=m.join(".");xn.route(d,s,w,_)})}function aet(a){return"id"in a&&"defaults"in a}var SD=class{constructor(){this.controllers=new Hm(Kl,"datasets",!0),this.elements=new Hm(ia,"elements"),this.plugins=new Hm(Object,"plugins"),this.scales=new Hm(Uu,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...r){this._each("register",r)}remove(...r){this._each("unregister",r)}addControllers(...r){this._each("register",r,this.controllers)}addElements(...r){this._each("register",r,this.elements)}addPlugins(...r){this._each("register",r,this.plugins)}addScales(...r){this._each("register",r,this.scales)}getController(r){return this._get(r,this.controllers,"controller")}getElement(r){return this._get(r,this.elements,"element")}getPlugin(r){return this._get(r,this.plugins,"plugin")}getScale(r){return this._get(r,this.scales,"scale")}removeControllers(...r){this._each("unregister",r,this.controllers)}removeElements(...r){this._each("unregister",r,this.elements)}removePlugins(...r){this._each("unregister",r,this.plugins)}removeScales(...r){this._each("unregister",r,this.scales)}_each(r,l,n){[...l].forEach(s=>{let d=n||this._getRegistryForType(s);n||d.isForType(s)||d===this.plugins&&s.id?this._exec(r,d,s):lr(s,m=>{let _=n||this._getRegistryForType(m);this._exec(r,_,m)})})}_exec(r,l,n){let s=ob(r);Rr(n["before"+s],[],n),l[r](n),Rr(n["after"+s],[],n)}_getRegistryForType(r){for(let l=0;l<this._typedRegistries.length;l++){let n=this._typedRegistries[l];if(n.isForType(r))return n}return this.plugins}_get(r,l,n){let s=l.get(r);if(s===void 0)throw new Error('"'+r+'" is not a registered '+n+".");return s}},Zl=new SD,cet=(()=>{class a extends Kl{update(l){let n=this._cachedMeta,{data:s=[]}=n,d=this.chart._animationsDisabled,{start:m,count:_}=$M(n,s,d);if(this._drawStart=m,this._drawCount=_,YM(n)&&(m=0,_=s.length),this.options.showLine){let{dataset:w,_dataset:S}=n;w._chart=this.chart,w._datasetIndex=this.index,w._decimated=!!S._decimated,w.points=s;let T=this.resolveDatasetElementOptions(l);T.segment=this.options.segment,this.updateElement(w,void 0,{animated:!d,options:T},l)}this.updateElements(s,m,_,l)}addElements(){let{showLine:l}=this.options;!this.datasetElementType&&l&&(this.datasetElementType=Zl.getElement("line")),super.addElements()}updateElements(l,n,s,d){let m=d==="reset",{iScale:_,vScale:w,_stacked:S,_dataset:T}=this._cachedMeta,L=this.resolveDataElementOptions(n,d),H=this.getSharedOptions(L),q=this.includeOptions(d,H),X=_.axis,it=w.axis,{spanGaps:at,segment:ut}=this.options,Mt=Bu(at)?at:Number.POSITIVE_INFINITY,Lt=this.chart._animationsDisabled||m||d==="none",Pt=n>0&&this.getParsed(n-1);for(let Nt=n;Nt<n+s;++Nt){let ue=l[Nt],Q=this.getParsed(Nt),$t=Lt?ue:{},Be=Pn(Q[it]),Ai=$t[X]=_.getPixelForValue(Q[X],Nt),fe=$t[it]=m||Be?w.getBasePixel():w.getPixelForValue(S?this.applyStack(w,Q,S):Q[it],Nt);$t.skip=isNaN(Ai)||isNaN(fe)||Be,$t.stop=Nt>0&&Math.abs(Q[X]-Pt[X])>Mt,ut&&($t.parsed=Q,$t.raw=T.data[Nt]),q&&($t.options=H||this.resolveDataElementOptions(Nt,ue.active?"active":d)),Lt||this.updateElement(ue,Nt,$t,d),Pt=Q}this.updateSharedOptions(H,d,L)}getMaxOverflow(){let l=this._cachedMeta,n=l.data||[];if(!this.options.showLine){let w=0;for(let S=n.length-1;S>=0;--S)w=Math.max(w,n[S].size(this.resolveDataElementOptions(S))/2);return w>0&&w}let s=l.dataset,d=s.options&&s.options.borderWidth||0;if(!n.length)return d;let m=n[0].size(this.resolveDataElementOptions(0)),_=n[n.length-1].size(this.resolveDataElementOptions(n.length-1));return Math.max(d,m,_)/2}}return a.id="scatter",a.defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1},a.overrides={interaction:{mode:"point"},plugins:{tooltip:{callbacks:{title(){return""},label(r){return"("+r.label+", "+r.formattedValue+")"}}}},scales:{x:{type:"linear"},y:{type:"linear"}}},a})(),det=Object.freeze({__proto__:null,BarController:Ntt,BubbleController:Btt,DoughnutController:k4,LineController:jtt,PolarAreaController:Utt,PieController:Htt,RadarController:Gtt,ScatterController:cet});function ju(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}var uet=(()=>{class a{constructor(l){this.options=l||{}}init(l){}formats(){return ju()}parse(l,n){return ju()}format(l,n){return ju()}add(l,n,s){return ju()}diff(l,n,s){return ju()}startOf(l,n,s){return ju()}endOf(l,n){return ju()}}return a.override=function(r){Object.assign(a.prototype,r)},a})(),het={_date:uet};function met(a,r,l,n){let{controller:s,data:d,_sorted:m}=a,_=s._cachedMeta.iScale;if(_&&r===_.axis&&r!=="r"&&m&&d.length){let w=_._reversePixels?uB:ql;if(n){if(s._sharedOptions){let S=d[0],T=typeof S.getRange=="function"&&S.getRange(r);if(T){let L=w(d,r,l-T),H=w(d,r,l+T);return{lo:L.lo,hi:H.hi}}}}else return w(d,r,l)}return{lo:0,hi:d.length-1}}function Hg(a,r,l,n,s){let d=a.getSortedVisibleDatasetMetas(),m=l[r];for(let _=0,w=d.length;_<w;++_){let{index:S,data:T}=d[_],{lo:L,hi:H}=met(d[_],r,m,s);for(let q=L;q<=H;++q){let X=T[q];X.skip||n(X,S,q)}}}function pet(a){let r=a.indexOf("x")!==-1,l=a.indexOf("y")!==-1;return function(n,s){let d=r?Math.abs(n.x-s.x):0,m=l?Math.abs(n.y-s.y):0;return Math.sqrt(Math.pow(d,2)+Math.pow(m,2))}}function gD(a,r,l,n,s){let d=[];return!s&&!a.isPointInArea(r)||Hg(a,l,r,function(_,w,S){!s&&!Om(_,a.chartArea,0)||_.inRange(r.x,r.y,n)&&d.push({element:_,datasetIndex:w,index:S})},!0),d}function fet(a,r,l,n){let s=[];function d(m,_,w){let{startAngle:S,endAngle:T}=m.getProps(["startAngle","endAngle"],n),{angle:L}=UM(m,{x:r.x,y:r.y});Nm(L,S,T)&&s.push({element:m,datasetIndex:_,index:w})}return Hg(a,l,r,d),s}function get(a,r,l,n,s,d){let m=[],_=pet(l),w=Number.POSITIVE_INFINITY;function S(T,L,H){let q=T.inRange(r.x,r.y,s);if(n&&!q)return;let X=T.getCenterPoint(s);if(!(!!d||a.isPointInArea(X))&&!q)return;let at=_(r,X);at<w?(m=[{element:T,datasetIndex:L,index:H}],w=at):at===w&&m.push({element:T,datasetIndex:L,index:H})}return Hg(a,l,r,S),m}function _D(a,r,l,n,s,d){return!d&&!a.isPointInArea(r)?[]:l==="r"&&!n?fet(a,r,l,s):get(a,r,l,n,s,d)}function XB(a,r,l,n,s){let d=[],m=l==="x"?"inXRange":"inYRange",_=!1;return Hg(a,l,r,(w,S,T)=>{w[m](r[l],s)&&(d.push({element:w,datasetIndex:S,index:T}),_=_||w.inRange(r.x,r.y,s))}),n&&!_?[]:d}var _et={evaluateInteractionItems:Hg,modes:{index(a,r,l,n){let s=Rd(r,a),d=l.axis||"x",m=l.includeInvisible||!1,_=l.intersect?gD(a,s,d,n,m):_D(a,s,d,!1,n,m),w=[];return _.length?(a.getSortedVisibleDatasetMetas().forEach(S=>{let T=_[0].index,L=S.data[T];L&&!L.skip&&w.push({element:L,datasetIndex:S.index,index:T})}),w):[]},dataset(a,r,l,n){let s=Rd(r,a),d=l.axis||"xy",m=l.includeInvisible||!1,_=l.intersect?gD(a,s,d,n,m):_D(a,s,d,!1,n,m);if(_.length>0){let w=_[0].datasetIndex,S=a.getDatasetMeta(w).data;_=[];for(let T=0;T<S.length;++T)_.push({element:S[T],datasetIndex:w,index:T})}return _},point(a,r,l,n){let s=Rd(r,a),d=l.axis||"xy",m=l.includeInvisible||!1;return gD(a,s,d,n,m)},nearest(a,r,l,n){let s=Rd(r,a),d=l.axis||"xy",m=l.includeInvisible||!1;return _D(a,s,d,l.intersect,n,m)},x(a,r,l,n){let s=Rd(r,a);return XB(a,s,"x",l.intersect,n)},y(a,r,l,n){let s=Rd(r,a);return XB(a,s,"y",l.intersect,n)}}},P4=["left","top","right","bottom"];function Pg(a,r){return a.filter(l=>l.pos===r)}function KB(a,r){return a.filter(l=>P4.indexOf(l.pos)===-1&&l.box.axis===r)}function Og(a,r){return a.sort((l,n)=>{let s=r?n:l,d=r?l:n;return s.weight===d.weight?s.index-d.index:s.weight-d.weight})}function vet(a){let r=[],l,n,s,d,m,_;for(l=0,n=(a||[]).length;l<n;++l)s=a[l],{position:d,options:{stack:m,stackWeight:_=1}}=s,r.push({index:l,box:s,pos:d,horizontal:s.isHorizontal(),weight:s.weight,stack:m&&d+m,stackWeight:_});return r}function yet(a){let r={};for(let l of a){let{stack:n,pos:s,stackWeight:d}=l;if(!n||!P4.includes(s))continue;let m=r[n]||(r[n]={count:0,placed:0,weight:0,size:0});m.count++,m.weight+=d}return r}function bet(a,r){let l=yet(a),{vBoxMaxWidth:n,hBoxMaxHeight:s}=r,d,m,_;for(d=0,m=a.length;d<m;++d){_=a[d];let{fullSize:w}=_.box,S=l[_.stack],T=S&&_.stackWeight/S.weight;_.horizontal?(_.width=T?T*n:w&&r.availableWidth,_.height=s):(_.width=n,_.height=T?T*s:w&&r.availableHeight)}return l}function xet(a){let r=vet(a),l=Og(r.filter(S=>S.box.fullSize),!0),n=Og(Pg(r,"left"),!0),s=Og(Pg(r,"right")),d=Og(Pg(r,"top"),!0),m=Og(Pg(r,"bottom")),_=KB(r,"x"),w=KB(r,"y");return{fullSize:l,leftAndTop:n.concat(d),rightAndBottom:s.concat(w).concat(m).concat(_),chartArea:Pg(r,"chartArea"),vertical:n.concat(s).concat(w),horizontal:d.concat(m).concat(_)}}function QB(a,r,l,n){return Math.max(a[l],r[l])+Math.max(a[n],r[n])}function O4(a,r){a.top=Math.max(a.top,r.top),a.left=Math.max(a.left,r.left),a.bottom=Math.max(a.bottom,r.bottom),a.right=Math.max(a.right,r.right)}function wet(a,r,l,n){let{pos:s,box:d}=l,m=a.maxPadding;if(!bn(s)){l.size&&(a[s]-=l.size);let L=n[l.stack]||{size:0,count:1};L.size=Math.max(L.size,l.horizontal?d.height:d.width),l.size=L.size/L.count,a[s]+=l.size}d.getPadding&&O4(m,d.getPadding());let _=Math.max(0,r.outerWidth-QB(m,a,"left","right")),w=Math.max(0,r.outerHeight-QB(m,a,"top","bottom")),S=_!==a.w,T=w!==a.h;return a.w=_,a.h=w,l.horizontal?{same:S,other:T}:{same:T,other:S}}function Cet(a){let r=a.maxPadding;function l(n){let s=Math.max(r[n]-a[n],0);return a[n]+=s,s}a.y+=l("top"),a.x+=l("left"),l("right"),l("bottom")}function Eet(a,r){let l=r.maxPadding;function n(s){let d={left:0,top:0,right:0,bottom:0};return s.forEach(m=>{d[m]=Math.max(r[m],l[m])}),d}return n(a?["left","right"]:["top","bottom"])}function Lg(a,r,l,n){let s=[],d,m,_,w,S,T;for(d=0,m=a.length,S=0;d<m;++d){_=a[d],w=_.box,w.update(_.width||r.w,_.height||r.h,Eet(_.horizontal,r));let{same:L,other:H}=wet(r,l,_,n);S|=L&&s.length,T=T||H,w.fullSize||s.push(_)}return S&&Lg(s,r,l,n)||T}function gb(a,r,l,n,s){a.top=l,a.left=r,a.right=r+n,a.bottom=l+s,a.width=n,a.height=s}function JB(a,r,l,n){let s=l.padding,{x:d,y:m}=r;for(let _ of a){let w=_.box,S=n[_.stack]||{count:1,placed:0,weight:1},T=_.stackWeight/S.weight||1;if(_.horizontal){let L=r.w*T,H=S.size||w.height;Js(S.start)&&(m=S.start),w.fullSize?gb(w,s.left,m,l.outerWidth-s.right-s.left,H):gb(w,r.left+S.placed,m,L,H),S.start=m,S.placed+=L,m=w.bottom}else{let L=r.h*T,H=S.size||w.width;Js(S.start)&&(d=S.start),w.fullSize?gb(w,d,s.top,H,l.outerHeight-s.bottom-s.top):gb(w,d,r.top+S.placed,H,L),S.start=d,S.placed+=L,d=w.right}}r.x=d,r.y=m}xn.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}});var rs={addBox(a,r){a.boxes||(a.boxes=[]),r.fullSize=r.fullSize||!1,r.position=r.position||"top",r.weight=r.weight||0,r._layers=r._layers||function(){return[{z:0,draw(l){r.draw(l)}}]},a.boxes.push(r)},removeBox(a,r){let l=a.boxes?a.boxes.indexOf(r):-1;l!==-1&&a.boxes.splice(l,1)},configure(a,r,l){r.fullSize=l.fullSize,r.position=l.position,r.weight=l.weight},update(a,r,l,n){if(!a)return;let s=Jo(a.options.layout.padding),d=Math.max(r-s.width,0),m=Math.max(l-s.height,0),_=xet(a.boxes),w=_.vertical,S=_.horizontal;lr(a.boxes,it=>{typeof it.beforeLayout=="function"&&it.beforeLayout()});let T=w.reduce((it,at)=>at.box.options&&at.box.options.display===!1?it:it+1,0)||1,L=Object.freeze({outerWidth:r,outerHeight:l,padding:s,availableWidth:d,availableHeight:m,vBoxMaxWidth:d/2/T,hBoxMaxHeight:m/2}),H=Object.assign({},s);O4(H,Jo(n));let q=Object.assign({maxPadding:H,w:d,h:m,x:s.left,y:s.top},s),X=bet(w.concat(S),L);Lg(_.fullSize,q,L,X),Lg(w,q,L,X),Lg(S,q,L,X)&&Lg(w,q,L,X),Cet(q),JB(_.leftAndTop,q,L,X),q.x+=q.w,q.y+=q.h,JB(_.rightAndBottom,q,L,X),a.chartArea={left:q.left,top:q.top,right:q.left+q.w,bottom:q.top+q.h,height:q.h,width:q.w},lr(_.chartArea,it=>{let at=it.box;Object.assign(at,a.chartArea),at.update(q.w,q.h,{left:0,top:0,right:0,bottom:0})})}},Cb=class{acquireContext(r,l){}releaseContext(r){return!1}addEventListener(r,l,n){}removeEventListener(r,l,n){}getDevicePixelRatio(){return 1}getMaximumSize(r,l,n,s){return l=Math.max(0,l||r.width),n=n||r.height,{width:l,height:Math.max(0,s?Math.floor(l/s):n)}}isAttached(r){return!0}updateConfig(r){}},ED=class extends Cb{acquireContext(r){return r&&r.getContext&&r.getContext("2d")||null}updateConfig(r){r.options.animation=!1}},xb="$chartjs",Met={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},t4=a=>a===null||a==="";function Det(a,r){let l=a.style,n=a.getAttribute("height"),s=a.getAttribute("width");if(a[xb]={initial:{height:n,width:s,style:{display:l.display,height:l.height,width:l.width}}},l.display=l.display||"block",l.boxSizing=l.boxSizing||"border-box",t4(s)){let d=lD(a,"width");d!==void 0&&(a.width=d)}if(t4(n))if(a.style.height==="")a.height=a.width/(r||2);else{let d=lD(a,"height");d!==void 0&&(a.height=d)}return a}var F4=RB?{passive:!0}:!1;function Tet(a,r,l){a.addEventListener(r,l,F4)}function Iet(a,r,l){a.canvas.removeEventListener(r,l,F4)}function Aet(a,r){let l=Met[a.type]||a.type,{x:n,y:s}=Rd(a,r);return{type:l,chart:r,native:a,x:n!==void 0?n:null,y:s!==void 0?s:null}}function Sb(a,r){for(let l of a)if(l===r||l.contains(r))return!0}function ket(a,r,l){let n=a.canvas,s=new MutationObserver(d=>{let m=!1;for(let _ of d)m=m||Sb(_.addedNodes,n),m=m&&!Sb(_.removedNodes,n);m&&l()});return s.observe(document,{childList:!0,subtree:!0}),s}function Ret(a,r,l){let n=a.canvas,s=new MutationObserver(d=>{let m=!1;for(let _ of d)m=m||Sb(_.removedNodes,n),m=m&&!Sb(_.addedNodes,n);m&&l()});return s.observe(document,{childList:!0,subtree:!0}),s}var Ng=new Map,e4=0;function L4(){let a=window.devicePixelRatio;a!==e4&&(e4=a,Ng.forEach((r,l)=>{l.currentDevicePixelRatio!==a&&r()}))}function Pet(a,r){Ng.size||window.addEventListener("resize",L4),Ng.set(a,r)}function Oet(a){Ng.delete(a),Ng.size||window.removeEventListener("resize",L4)}function Fet(a,r,l){let n=a.canvas,s=n&&mb(n);if(!s)return;let d=WM((_,w)=>{let S=s.clientWidth;l(_,w),S<s.clientWidth&&l()},window),m=new ResizeObserver(_=>{let w=_[0],S=w.contentRect.width,T=w.contentRect.height;S===0&&T===0||d(S,T)});return m.observe(s),Pet(a,d),m}function vD(a,r,l){l&&l.disconnect(),r==="resize"&&Oet(a)}function Let(a,r,l){let n=a.canvas,s=WM(d=>{a.ctx!==null&&l(Aet(d,a))},a,d=>{let m=d[0];return[m,m.offsetX,m.offsetY]});return Tet(n,r,s),s}var MD=class extends Cb{acquireContext(r,l){let n=r&&r.getContext&&r.getContext("2d");return n&&n.canvas===r?(Det(r,l),n):null}releaseContext(r){let l=r.canvas;if(!l[xb])return!1;let n=l[xb].initial;["height","width"].forEach(d=>{let m=n[d];Pn(m)?l.removeAttribute(d):l.setAttribute(d,m)});let s=n.style||{};return Object.keys(s).forEach(d=>{l.style[d]=s[d]}),l.width=l.width,delete l[xb],!0}addEventListener(r,l,n){this.removeEventListener(r,l);let s=r.$proxies||(r.$proxies={}),m={attach:ket,detach:Ret,resize:Fet}[l]||Let;s[l]=m(r,l,n)}removeEventListener(r,l){let n=r.$proxies||(r.$proxies={}),s=n[l];if(!s)return;({attach:vD,detach:vD,resize:vD}[l]||Iet)(r,l,s),n[l]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(r,l,n,s){return kB(r,l,n,s)}isAttached(r){let l=mb(r);return!!(l&&l.isConnected)}};function zet(a){return!sD()||typeof OffscreenCanvas<"u"&&a instanceof OffscreenCanvas?ED:MD}var DD=class{constructor(){this._init=[]}notify(r,l,n,s){l==="beforeInit"&&(this._init=this._createDescriptors(r,!0),this._notify(this._init,r,"install"));let d=s?this._descriptors(r).filter(s):this._descriptors(r),m=this._notify(d,r,l,n);return l==="afterDestroy"&&(this._notify(d,r,"stop"),this._notify(this._init,r,"uninstall")),m}_notify(r,l,n,s){s=s||{};for(let d of r){let m=d.plugin,_=m[n],w=[l,s,d.options];if(Rr(_,w,m)===!1&&s.cancelable)return!1}return!0}invalidate(){Pn(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(r){if(this._cache)return this._cache;let l=this._cache=this._createDescriptors(r);return this._notifyStateChanges(r),l}_createDescriptors(r,l){let n=r&&r.config,s=nn(n.options&&n.options.plugins,{}),d=Net(n);return s===!1&&!l?[]:Vet(r,d,s,l)}_notifyStateChanges(r){let l=this._oldCache||[],n=this._cache,s=(d,m)=>d.filter(_=>!m.some(w=>_.plugin.id===w.plugin.id));this._notify(s(l,n),r,"stop"),this._notify(s(n,l),r,"start")}};function Net(a){let r={},l=[],n=Object.keys(Zl.plugins.items);for(let d=0;d<n.length;d++)l.push(Zl.getPlugin(n[d]));let s=a.plugins||[];for(let d=0;d<s.length;d++){let m=s[d];l.indexOf(m)===-1&&(l.push(m),r[m.id]=!0)}return{plugins:l,localIds:r}}function Bet(a,r){return!r&&a===!1?null:a===!0?{}:a}function Vet(a,{plugins:r,localIds:l},n,s){let d=[],m=a.getContext();for(let _ of r){let w=_.id,S=Bet(n[w],s);S!==null&&d.push({plugin:_,options:jet(a.config,{plugin:_,local:l[w]},S,m)})}return d}function jet(a,{plugin:r,local:l},n,s){let d=a.pluginScopeKeys(r),m=a.getOptionScopes(n,d);return l&&r.defaults&&m.push(r.defaults),a.createResolver(m,s,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function TD(a,r){let l=xn.datasets[a]||{};return((r.datasets||{})[a]||{}).indexAxis||r.indexAxis||l.indexAxis||"x"}function Uet(a,r){let l=a;return a==="_index_"?l=r:a==="_value_"&&(l=r==="x"?"y":"x"),l}function Het(a,r){return a===r?"_index_":"_value_"}function Get(a){if(a==="top"||a==="bottom")return"x";if(a==="left"||a==="right")return"y"}function ID(a,r){return a==="x"||a==="y"?a:r.axis||Get(r.position)||a.charAt(0).toLowerCase()}function qet(a,r){let l=Td[a.type]||{scales:{}},n=r.scales||{},s=TD(a.type,r),d=Object.create(null),m=Object.create(null);return Object.keys(n).forEach(_=>{let w=n[_];if(!bn(w))return console.error(`Invalid scale configuration for scale: ${_}`);if(w._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${_}`);let S=ID(_,w),T=Het(S,s),L=l.scales||{};d[S]=d[S]||_,m[_]=Lm(Object.create(null),[{axis:S},w,L[S],L[T]])}),a.data.datasets.forEach(_=>{let w=_.type||a.type,S=_.indexAxis||TD(w,r),L=(Td[w]||{}).scales||{};Object.keys(L).forEach(H=>{let q=Uet(H,S),X=_[q+"AxisID"]||d[q]||q;m[X]=m[X]||Object.create(null),Lm(m[X],[{axis:q},n[X],L[H]])})}),Object.keys(m).forEach(_=>{let w=m[_];Lm(w,[xn.scales[w.type],xn.scale])}),m}function z4(a){let r=a.options||(a.options={});r.plugins=nn(r.plugins,{}),r.scales=qet(a,r)}function N4(a){return a=a||{},a.datasets=a.datasets||[],a.labels=a.labels||[],a}function Wet(a){return a=a||{},a.data=N4(a.data),z4(a),a}var i4=new Map,B4=new Set;function _b(a,r){let l=i4.get(a);return l||(l=r(),i4.set(a,l),B4.add(l)),l}var Fg=(a,r,l)=>{let n=Rc(r,l);n!==void 0&&a.add(n)},AD=class{constructor(r){this._config=Wet(r),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(r){this._config.type=r}get data(){return this._config.data}set data(r){this._config.data=N4(r)}get options(){return this._config.options}set options(r){this._config.options=r}get plugins(){return this._config.plugins}update(){let r=this._config;this.clearCache(),z4(r)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(r){return _b(r,()=>[[`datasets.${r}`,""]])}datasetAnimationScopeKeys(r,l){return _b(`${r}.transition.${l}`,()=>[[`datasets.${r}.transitions.${l}`,`transitions.${l}`],[`datasets.${r}`,""]])}datasetElementScopeKeys(r,l){return _b(`${r}-${l}`,()=>[[`datasets.${r}.elements.${l}`,`datasets.${r}`,`elements.${l}`,""]])}pluginScopeKeys(r){let l=r.id,n=this.type;return _b(`${n}-plugin-${l}`,()=>[[`plugins.${l}`,...r.additionalOptionScopes||[]]])}_cachedScopes(r,l){let n=this._scopeCache,s=n.get(r);return(!s||l)&&(s=new Map,n.set(r,s)),s}getOptionScopes(r,l,n){let{options:s,type:d}=this,m=this._cachedScopes(r,n),_=m.get(l);if(_)return _;let w=new Set;l.forEach(T=>{r&&(w.add(r),T.forEach(L=>Fg(w,r,L))),T.forEach(L=>Fg(w,s,L)),T.forEach(L=>Fg(w,Td[d]||{},L)),T.forEach(L=>Fg(w,xn,L)),T.forEach(L=>Fg(w,cb,L))});let S=Array.from(w);return S.length===0&&S.push(Object.create(null)),B4.has(l)&&m.set(l,S),S}chartOptionScopes(){let{options:r,type:l}=this;return[r,Td[l]||{},xn.datasets[l]||{},{type:l},xn,cb]}resolveNamedOptions(r,l,n,s=[""]){let d={$shared:!0},{resolver:m,subPrefixes:_}=n4(this._resolverCache,r,s),w=m;if(Yet(m,l)){d.$shared=!1,n=kc(n)?n():n;let S=this.createResolver(r,n,_);w=Nu(m,n,S)}for(let S of l)d[S]=w[S];return d}createResolver(r,l,n=[""],s){let{resolver:d}=n4(this._resolverCache,r,n);return bn(l)?Nu(d,l,void 0,s):d}};function n4(a,r,l){let n=a.get(r);n||(n=new Map,a.set(r,n));let s=l.join(),d=n.get(s);return d||(d={resolver:hb(r,l),subPrefixes:l.filter(_=>!_.toLowerCase().includes("hover"))},n.set(s,d)),d}var $et=a=>bn(a)&&Object.getOwnPropertyNames(a).reduce((r,l)=>r||kc(a[l]),!1);function Yet(a,r){let{isScriptable:l,isIndexable:n}=iD(a);for(let s of r){let d=l(s),m=n(s),_=(m||d)&&a[s];if(d&&(kc(_)||$et(_))||m&&kr(_))return!0}return!1}var Zet="3.9.1",Xet=["top","bottom","left","right","chartArea"];function r4(a,r){return a==="top"||a==="bottom"||Xet.indexOf(a)===-1&&r==="x"}function o4(a,r){return function(l,n){return l[a]===n[a]?l[r]-n[r]:l[a]-n[a]}}function s4(a){let r=a.chart,l=r.options.animation;r.notifyPlugins("afterRender"),Rr(l&&l.onComplete,[a],r)}function Ket(a){let r=a.chart,l=r.options.animation;Rr(l&&l.onProgress,[a],r)}function V4(a){return sD()&&typeof a=="string"?a=document.getElementById(a):a&&a.length&&(a=a[0]),a&&a.canvas&&(a=a.canvas),a}var Eb={},j4=a=>{let r=V4(a);return Object.values(Eb).filter(l=>l.canvas===r).pop()};function Qet(a,r,l){let n=Object.keys(a);for(let s of n){let d=+s;if(d>=r){let m=a[s];delete a[s],(l>0||d>r)&&(a[d+l]=m)}}}function Jet(a,r,l,n){return!l||a.type==="mouseout"?null:n?r:a}var Xl=class{constructor(r,l){let n=this.config=new AD(l),s=V4(r),d=j4(s);if(d)throw new Error("Canvas is already in use. Chart with ID '"+d.id+"' must be destroyed before the canvas with ID '"+d.canvas.id+"' can be reused.");let m=n.createResolver(n.chartOptionScopes(),this.getContext());this.platform=new(n.platform||zet(s)),this.platform.updateConfig(n);let _=this.platform.acquireContext(s,m.aspectRatio),w=_&&_.canvas,S=w&&w.height,T=w&&w.width;if(this.id=rB(),this.ctx=_,this.canvas=w,this.width=T,this.height=S,this._options=m,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new DD,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=fB(L=>this.update(L),m.resizeDelay||0),this._dataChanges=[],Eb[this.id]=this,!_||!w){console.error("Failed to create chart: can't acquire context from the given item");return}Oc.listen(this,"complete",s4),Oc.listen(this,"progress",Ket),this._initialize(),this.attached&&this.update()}get aspectRatio(){let{options:{aspectRatio:r,maintainAspectRatio:l},width:n,height:s,_aspectRatio:d}=this;return Pn(r)?l&&d?d:s?n/s:null:r}get data(){return this.config.data}set data(r){this.config.data=r}get options(){return this._options}set options(r){this.config.options=r}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():aD(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return JM(this.canvas,this.ctx),this}stop(){return Oc.stop(this),this}resize(r,l){Oc.running(this)?this._resizeBeforeDraw={width:r,height:l}:this._resize(r,l)}_resize(r,l){let n=this.options,s=this.canvas,d=n.maintainAspectRatio&&this.aspectRatio,m=this.platform.getMaximumSize(s,r,l,d),_=n.devicePixelRatio||this.platform.getDevicePixelRatio(),w=this.width?"resize":"attach";this.width=m.width,this.height=m.height,this._aspectRatio=this.aspectRatio,aD(this,_,!0)&&(this.notifyPlugins("resize",{size:m}),Rr(n.onResize,[this,m],this),this.attached&&this._doResize(w)&&this.render())}ensureScalesHaveIDs(){let l=this.options.scales||{};lr(l,(n,s)=>{n.id=s})}buildOrUpdateScales(){let r=this.options,l=r.scales,n=this.scales,s=Object.keys(n).reduce((m,_)=>(m[_]=!1,m),{}),d=[];l&&(d=d.concat(Object.keys(l).map(m=>{let _=l[m],w=ID(m,_),S=w==="r",T=w==="x";return{options:_,dposition:S?"chartArea":T?"bottom":"left",dtype:S?"radialLinear":T?"category":"linear"}}))),lr(d,m=>{let _=m.options,w=_.id,S=ID(w,_),T=nn(_.type,m.dtype);(_.position===void 0||r4(_.position,S)!==r4(m.dposition))&&(_.position=m.dposition),s[w]=!0;let L=null;if(w in n&&n[w].type===T)L=n[w];else{let H=Zl.getScale(T);L=new H({id:w,type:T,ctx:this.ctx,chart:this}),n[L.id]=L}L.init(_,r)}),lr(s,(m,_)=>{m||delete n[_]}),lr(n,m=>{rs.configure(this,m,m.options),rs.addBox(this,m)})}_updateMetasets(){let r=this._metasets,l=this.data.datasets.length,n=r.length;if(r.sort((s,d)=>s.index-d.index),n>l){for(let s=l;s<n;++s)this._destroyDatasetMeta(s);r.splice(l,n-l)}this._sortedMetasets=r.slice(0).sort(o4("order","index"))}_removeUnreferencedMetasets(){let{_metasets:r,data:{datasets:l}}=this;r.length>l.length&&delete this._stacks,r.forEach((n,s)=>{l.filter(d=>d===n._dataset).length===0&&this._destroyDatasetMeta(s)})}buildOrUpdateControllers(){let r=[],l=this.data.datasets,n,s;for(this._removeUnreferencedMetasets(),n=0,s=l.length;n<s;n++){let d=l[n],m=this.getDatasetMeta(n),_=d.type||this.config.type;if(m.type&&m.type!==_&&(this._destroyDatasetMeta(n),m=this.getDatasetMeta(n)),m.type=_,m.indexAxis=d.indexAxis||TD(_,this.options),m.order=d.order||0,m.index=n,m.label=""+d.label,m.visible=this.isDatasetVisible(n),m.controller)m.controller.updateIndex(n),m.controller.linkScales();else{let w=Zl.getController(_),{datasetElementType:S,dataElementType:T}=xn.datasets[_];Object.assign(w.prototype,{dataElementType:Zl.getElement(T),datasetElementType:S&&Zl.getElement(S)}),m.controller=new w(this,n),r.push(m.controller)}}return this._updateMetasets(),r}_resetElements(){lr(this.data.datasets,(r,l)=>{this.getDatasetMeta(l).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(r){let l=this.config;l.update();let n=this._options=l.createResolver(l.chartOptionScopes(),this.getContext()),s=this._animationsDisabled=!n.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:r,cancelable:!0})===!1)return;let d=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let m=0;for(let S=0,T=this.data.datasets.length;S<T;S++){let{controller:L}=this.getDatasetMeta(S),H=!s&&d.indexOf(L)===-1;L.buildOrUpdateElements(H),m=Math.max(+L.getMaxOverflow(),m)}m=this._minPadding=n.layout.autoPadding?m:0,this._updateLayout(m),s||lr(d,S=>{S.reset()}),this._updateDatasets(r),this.notifyPlugins("afterUpdate",{mode:r}),this._layers.sort(o4("z","_idx"));let{_active:_,_lastEvent:w}=this;w?this._eventHandler(w,!0):_.length&&this._updateHoverStyles(_,_,!0),this.render()}_updateScales(){lr(this.scales,r=>{rs.removeBox(this,r)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){let r=this.options,l=new Set(Object.keys(this._listeners)),n=new Set(r.events);(!NM(l,n)||!!this._responsiveListeners!==r.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){let{_hiddenIndices:r}=this,l=this._getUniformDataChanges()||[];for(let{method:n,start:s,count:d}of l){let m=n==="_removeElements"?-d:d;Qet(r,s,m)}}_getUniformDataChanges(){let r=this._dataChanges;if(!r||!r.length)return;this._dataChanges=[];let l=this.data.datasets.length,n=d=>new Set(r.filter(m=>m[0]===d).map((m,_)=>_+","+m.splice(1).join(","))),s=n(0);for(let d=1;d<l;d++)if(!NM(s,n(d)))return;return Array.from(s).map(d=>d.split(",")).map(d=>({method:d[1],start:+d[2],count:+d[3]}))}_updateLayout(r){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;rs.update(this,this.width,this.height,r);let l=this.chartArea,n=l.width<=0||l.height<=0;this._layers=[],lr(this.boxes,s=>{n&&s.position==="chartArea"||(s.configure&&s.configure(),this._layers.push(...s._layers()))},this),this._layers.forEach((s,d)=>{s._idx=d}),this.notifyPlugins("afterLayout")}_updateDatasets(r){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:r,cancelable:!0})!==!1){for(let l=0,n=this.data.datasets.length;l<n;++l)this.getDatasetMeta(l).controller.configure();for(let l=0,n=this.data.datasets.length;l<n;++l)this._updateDataset(l,kc(r)?r({datasetIndex:l}):r);this.notifyPlugins("afterDatasetsUpdate",{mode:r})}}_updateDataset(r,l){let n=this.getDatasetMeta(r),s={meta:n,index:r,mode:l,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",s)!==!1&&(n.controller._update(l),s.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",s))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Oc.has(this)?this.attached&&!Oc.running(this)&&Oc.start(this):(this.draw(),s4({chart:this})))}draw(){let r;if(this._resizeBeforeDraw){let{width:n,height:s}=this._resizeBeforeDraw;this._resize(n,s),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;let l=this._layers;for(r=0;r<l.length&&l[r].z<=0;++r)l[r].draw(this.chartArea);for(this._drawDatasets();r<l.length;++r)l[r].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(r){let l=this._sortedMetasets,n=[],s,d;for(s=0,d=l.length;s<d;++s){let m=l[s];(!r||m.visible)&&n.push(m)}return n}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;let r=this.getSortedVisibleDatasetMetas();for(let l=r.length-1;l>=0;--l)this._drawDataset(r[l]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(r){let l=this.ctx,n=r._clip,s=!n.disabled,d=this.chartArea,m={meta:r,index:r.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",m)!==!1&&(s&&Ig(l,{left:n.left===!1?0:d.left-n.left,right:n.right===!1?this.width:d.right+n.right,top:n.top===!1?0:d.top-n.top,bottom:n.bottom===!1?this.height:d.bottom+n.bottom}),r.controller.draw(),s&&Ag(l),m.cancelable=!1,this.notifyPlugins("afterDatasetDraw",m))}isPointInArea(r){return Om(r,this.chartArea,this._minPadding)}getElementsAtEventForMode(r,l,n,s){let d=_et.modes[l];return typeof d=="function"?d(this,r,n,s):[]}getDatasetMeta(r){let l=this.data.datasets[r],n=this._metasets,s=n.filter(d=>d&&d._dataset===l).pop();return s||(s={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:l&&l.order||0,index:r,_dataset:l,_parsed:[],_sorted:!1},n.push(s)),s}getContext(){return this.$context||(this.$context=Pc(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(r){let l=this.data.datasets[r];if(!l)return!1;let n=this.getDatasetMeta(r);return typeof n.hidden=="boolean"?!n.hidden:!l.hidden}setDatasetVisibility(r,l){let n=this.getDatasetMeta(r);n.hidden=!l}toggleDataVisibility(r){this._hiddenIndices[r]=!this._hiddenIndices[r]}getDataVisibility(r){return!this._hiddenIndices[r]}_updateVisibility(r,l,n){let s=n?"show":"hide",d=this.getDatasetMeta(r),m=d.controller._resolveAnimations(void 0,s);Js(l)?(d.data[l].hidden=!n,this.update()):(this.setDatasetVisibility(r,n),m.update(d,{visible:n}),this.update(_=>_.datasetIndex===r?s:void 0))}hide(r,l){this._updateVisibility(r,l,!1)}show(r,l){this._updateVisibility(r,l,!0)}_destroyDatasetMeta(r){let l=this._metasets[r];l&&l.controller&&l.controller._destroy(),delete this._metasets[r]}_stop(){let r,l;for(this.stop(),Oc.remove(this),r=0,l=this.data.datasets.length;r<l;++r)this._destroyDatasetMeta(r)}destroy(){this.notifyPlugins("beforeDestroy");let{canvas:r,ctx:l}=this;this._stop(),this.config.clearCache(),r&&(this.unbindEvents(),JM(r,l),this.platform.releaseContext(l),this.canvas=null,this.ctx=null),this.notifyPlugins("destroy"),delete Eb[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...r){return this.canvas.toDataURL(...r)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){let r=this._listeners,l=this.platform,n=(d,m)=>{l.addEventListener(this,d,m),r[d]=m},s=(d,m,_)=>{d.offsetX=m,d.offsetY=_,this._eventHandler(d)};lr(this.options.events,d=>n(d,s))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});let r=this._responsiveListeners,l=this.platform,n=(w,S)=>{l.addEventListener(this,w,S),r[w]=S},s=(w,S)=>{r[w]&&(l.removeEventListener(this,w,S),delete r[w])},d=(w,S)=>{this.canvas&&this.resize(w,S)},m,_=()=>{s("attach",_),this.attached=!0,this.resize(),n("resize",d),n("detach",m)};m=()=>{this.attached=!1,s("resize",d),this._stop(),this._resize(0,0),n("attach",_)},l.isAttached(this.canvas)?_():m()}unbindEvents(){lr(this._listeners,(r,l)=>{this.platform.removeEventListener(this,l,r)}),this._listeners={},lr(this._responsiveListeners,(r,l)=>{this.platform.removeEventListener(this,l,r)}),this._responsiveListeners=void 0}updateHoverStyle(r,l,n){let s=n?"set":"remove",d,m,_,w;for(l==="dataset"&&(d=this.getDatasetMeta(r[0].datasetIndex),d.controller["_"+s+"DatasetHoverStyle"]()),_=0,w=r.length;_<w;++_){m=r[_];let S=m&&this.getDatasetMeta(m.datasetIndex).controller;S&&S[s+"HoverStyle"](m.element,m.datasetIndex,m.index)}}getActiveElements(){return this._active||[]}setActiveElements(r){let l=this._active||[],n=r.map(({datasetIndex:d,index:m})=>{let _=this.getDatasetMeta(d);if(!_)throw new Error("No dataset found at index "+d);return{datasetIndex:d,element:_.data[m],index:m}});!Dg(n,l)&&(this._active=n,this._lastEvent=null,this._updateHoverStyles(n,l))}notifyPlugins(r,l,n){return this._plugins.notify(this,r,l,n)}_updateHoverStyles(r,l,n){let s=this.options.hover,d=(w,S)=>w.filter(T=>!S.some(L=>T.datasetIndex===L.datasetIndex&&T.index===L.index)),m=d(l,r),_=n?r:d(r,l);m.length&&this.updateHoverStyle(m,s.mode,!1),_.length&&s.mode&&this.updateHoverStyle(_,s.mode,!0)}_eventHandler(r,l){let n={event:r,replay:l,cancelable:!0,inChartArea:this.isPointInArea(r)},s=m=>(m.options.events||this.options.events).includes(r.native.type);if(this.notifyPlugins("beforeEvent",n,s)===!1)return;let d=this._handleEvent(r,l,n.inChartArea);return n.cancelable=!1,this.notifyPlugins("afterEvent",n,s),(d||n.changed)&&this.render(),this}_handleEvent(r,l,n){let{_active:s=[],options:d}=this,m=l,_=this._getActiveElements(r,s,n,m),w=aB(r),S=Jet(r,this._lastEvent,n,w);n&&(this._lastEvent=null,Rr(d.onHover,[r,_,this],this),w&&Rr(d.onClick,[r,_,this],this));let T=!Dg(_,s);return(T||l)&&(this._active=_,this._updateHoverStyles(_,s,l)),this._lastEvent=S,T}_getActiveElements(r,l,n,s){if(r.type==="mouseout")return[];if(!n)return l;let d=this.options.hover;return this.getElementsAtEventForMode(r,d.mode,d,s)}},a4=()=>lr(Xl.instances,a=>a._plugins.invalidate()),Pd=!0;Object.defineProperties(Xl,{defaults:{enumerable:Pd,value:xn},instances:{enumerable:Pd,value:Eb},overrides:{enumerable:Pd,value:Td},registry:{enumerable:Pd,value:Zl},version:{enumerable:Pd,value:Zet},getChart:{enumerable:Pd,value:j4},register:{enumerable:Pd,value:(...a)=>{Zl.add(...a),a4()}},unregister:{enumerable:Pd,value:(...a)=>{Zl.remove(...a),a4()}}});function U4(a,r,l){let{startAngle:n,pixelMargin:s,x:d,y:m,outerRadius:_,innerRadius:w}=r,S=s/_;a.beginPath(),a.arc(d,m,_,n-S,l+S),w>s?(S=s/w,a.arc(d,m,w,l+S,n-S,!0)):a.arc(d,m,s,l+ao,n-ao),a.closePath(),a.clip()}function tit(a){return ub(a,["outerStart","outerEnd","innerStart","innerEnd"])}function eit(a,r,l,n){let s=tit(a.options.borderRadius),d=(l-r)/2,m=Math.min(d,n*r/2),_=w=>{let S=(l-Math.min(d,w))*n/2;return Uo(w,0,Math.min(d,S))};return{outerStart:_(s.outerStart),outerEnd:_(s.outerEnd),innerStart:Uo(s.innerStart,0,m),innerEnd:Uo(s.innerEnd,0,m)}}function Um(a,r,l,n){return{x:l+a*Math.cos(r),y:n+a*Math.sin(r)}}function kD(a,r,l,n,s,d){let{x:m,y:_,startAngle:w,pixelMargin:S,innerRadius:T}=r,L=Math.max(r.outerRadius+n+l-S,0),H=T>0?T+n+l+S:0,q=0,X=s-w;if(n){let ki=T>0?T-n:0,jn=L>0?L-n:0,fn=(ki+jn)/2,fr=fn!==0?X*fn/(fn+n):X;q=(X-fr)/2}let it=Math.max(.001,X*L-l/Ur)/L,at=(X-it)/2,ut=w+at+q,Mt=s-at-q,{outerStart:Lt,outerEnd:Pt,innerStart:Nt,innerEnd:ue}=eit(r,H,L,Mt-ut),Q=L-Lt,$t=L-Pt,Be=ut+Lt/Q,Ai=Mt-Pt/$t,fe=H+Nt,ii=H+ue,Pi=ut+Nt/fe,Cr=Mt-ue/ii;if(a.beginPath(),d){if(a.arc(m,_,L,Be,Ai),Pt>0){let fn=Um($t,Ai,m,_);a.arc(fn.x,fn.y,Pt,Ai,Mt+ao)}let ki=Um(ii,Mt,m,_);if(a.lineTo(ki.x,ki.y),ue>0){let fn=Um(ii,Cr,m,_);a.arc(fn.x,fn.y,ue,Mt+ao,Cr+Math.PI)}if(a.arc(m,_,H,Mt-ue/H,ut+Nt/H,!0),Nt>0){let fn=Um(fe,Pi,m,_);a.arc(fn.x,fn.y,Nt,Pi+Math.PI,ut-ao)}let jn=Um(Q,ut,m,_);if(a.lineTo(jn.x,jn.y),Lt>0){let fn=Um(Q,Be,m,_);a.arc(fn.x,fn.y,Lt,ut-ao,Be)}}else{a.moveTo(m,_);let ki=Math.cos(Be)*L+m,jn=Math.sin(Be)*L+_;a.lineTo(ki,jn);let fn=Math.cos(Ai)*L+m,fr=Math.sin(Ai)*L+_;a.lineTo(fn,fr)}a.closePath()}function iit(a,r,l,n,s){let{fullCircles:d,startAngle:m,circumference:_}=r,w=r.endAngle;if(d){kD(a,r,l,n,m+mr,s);for(let S=0;S<d;++S)a.fill();isNaN(_)||(w=m+_%mr,_%mr===0&&(w+=mr))}return kD(a,r,l,n,w,s),a.fill(),w}function nit(a,r,l){let{x:n,y:s,startAngle:d,pixelMargin:m,fullCircles:_}=r,w=Math.max(r.outerRadius-m,0),S=r.innerRadius+m,T;for(l&&U4(a,r,d+mr),a.beginPath(),a.arc(n,s,S,d+mr,d,!0),T=0;T<_;++T)a.stroke();for(a.beginPath(),a.arc(n,s,w,d,d+mr),T=0;T<_;++T)a.stroke()}function rit(a,r,l,n,s,d){let{options:m}=r,{borderWidth:_,borderJoinStyle:w}=m,S=m.borderAlign==="inner";_&&(S?(a.lineWidth=_*2,a.lineJoin=w||"round"):(a.lineWidth=_,a.lineJoin=w||"bevel"),r.fullCircles&&nit(a,r,S),S&&U4(a,r,s),kD(a,r,l,n,s,d),a.stroke())}var Gm=class extends ia{constructor(r){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,r&&Object.assign(this,r)}inRange(r,l,n){let s=this.getProps(["x","y"],n),{angle:d,distance:m}=UM(s,{x:r,y:l}),{startAngle:_,endAngle:w,innerRadius:S,outerRadius:T,circumference:L}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],n),H=this.options.spacing/2,X=nn(L,w-_)>=mr||Nm(d,_,w),it=$l(m,S+H,T+H);return X&&it}getCenterPoint(r){let{x:l,y:n,startAngle:s,endAngle:d,innerRadius:m,outerRadius:_}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius","circumference"],r),{offset:w,spacing:S}=this.options,T=(s+d)/2,L=(m+_+S+w)/2;return{x:l+Math.cos(T)*L,y:n+Math.sin(T)*L}}tooltipPosition(r){return this.getCenterPoint(r)}draw(r){let{options:l,circumference:n}=this,s=(l.offset||0)/2,d=(l.spacing||0)/2,m=l.circular;if(this.pixelMargin=l.borderAlign==="inner"?.33:0,this.fullCircles=n>mr?Math.floor(n/mr):0,n===0||this.innerRadius<0||this.outerRadius<0)return;r.save();let _=0;if(s){_=s/2;let S=(this.startAngle+this.endAngle)/2;r.translate(Math.cos(S)*_,Math.sin(S)*_),this.circumference>=Ur&&(_=s)}r.fillStyle=l.backgroundColor,r.strokeStyle=l.borderColor;let w=iit(r,this,_,d,m);rit(r,this,_,d,w,m),r.restore()}};Gm.id="arc";Gm.defaults={borderAlign:"center",borderColor:"#fff",borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0};Gm.defaultRoutes={backgroundColor:"backgroundColor"};function H4(a,r,l=r){a.lineCap=nn(l.borderCapStyle,r.borderCapStyle),a.setLineDash(nn(l.borderDash,r.borderDash)),a.lineDashOffset=nn(l.borderDashOffset,r.borderDashOffset),a.lineJoin=nn(l.borderJoinStyle,r.borderJoinStyle),a.lineWidth=nn(l.borderWidth,r.borderWidth),a.strokeStyle=nn(l.borderColor,r.borderColor)}function oit(a,r,l){a.lineTo(l.x,l.y)}function sit(a){return a.stepped?CB:a.tension||a.cubicInterpolationMode==="monotone"?SB:oit}function G4(a,r,l={}){let n=a.length,{start:s=0,end:d=n-1}=l,{start:m,end:_}=r,w=Math.max(s,m),S=Math.min(d,_),T=s<m&&d<m||s>_&&d>_;return{count:n,start:w,loop:r.loop,ilen:S<w&&!T?n+S-w:S-w}}function ait(a,r,l,n){let{points:s,options:d}=r,{count:m,start:_,loop:w,ilen:S}=G4(s,l,n),T=sit(d),{move:L=!0,reverse:H}=n||{},q,X,it;for(q=0;q<=S;++q)X=s[(_+(H?S-q:q))%m],!X.skip&&(L?(a.moveTo(X.x,X.y),L=!1):T(a,it,X,H,d.stepped),it=X);return w&&(X=s[(_+(H?S:0))%m],T(a,it,X,H,d.stepped)),!!w}function lit(a,r,l,n){let s=r.points,{count:d,start:m,ilen:_}=G4(s,l,n),{move:w=!0,reverse:S}=n||{},T=0,L=0,H,q,X,it,at,ut,Mt=Pt=>(m+(S?_-Pt:Pt))%d,Lt=()=>{it!==at&&(a.lineTo(T,at),a.lineTo(T,it),a.lineTo(T,ut))};for(w&&(q=s[Mt(0)],a.moveTo(q.x,q.y)),H=0;H<=_;++H){if(q=s[Mt(H)],q.skip)continue;let Pt=q.x,Nt=q.y,ue=Pt|0;ue===X?(Nt<it?it=Nt:Nt>at&&(at=Nt),T=(L*T+Pt)/++L):(Lt(),a.lineTo(Pt,Nt),X=ue,L=0,it=at=Nt),ut=Nt}Lt()}function RD(a){let r=a.options,l=r.borderDash&&r.borderDash.length;return!a._decimated&&!a._loop&&!r.tension&&r.cubicInterpolationMode!=="monotone"&&!r.stepped&&!l?lit:ait}function cit(a){return a.stepped?PB:a.tension||a.cubicInterpolationMode==="monotone"?OB:Ed}function dit(a,r,l,n){let s=r._path;s||(s=r._path=new Path2D,r.path(s,l,n)&&s.closePath()),H4(a,r.options),a.stroke(s)}function uit(a,r,l,n){let{segments:s,options:d}=r,m=RD(r);for(let _ of s)H4(a,d,_.style),a.beginPath(),m(a,r,_,{start:l,end:l+n-1})&&a.closePath(),a.stroke()}var hit=typeof Path2D=="function";function mit(a,r,l,n){hit&&!r.options.segment?dit(a,r,l,n):uit(a,r,l,n)}var Ib=(()=>{class a extends ia{constructor(l){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,l&&Object.assign(this,l)}updateControlPoints(l,n){let s=this.options;if((s.tension||s.cubicInterpolationMode==="monotone")&&!s.stepped&&!this._pointsUpdated){let d=s.spanGaps?this._loop:this._fullLoop;AB(this._points,s,l,d,n),this._pointsUpdated=!0}}set points(l){this._points=l,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=LB(this,this.options.segment))}first(){let l=this.segments,n=this.points;return l.length&&n[l[0].start]}last(){let l=this.segments,n=this.points,s=l.length;return s&&n[l[s-1].end]}interpolate(l,n){let s=this.options,d=l[n],m=this.points,_=hD(this,{property:n,start:d,end:d});if(!_.length)return;let w=[],S=cit(s),T,L;for(T=0,L=_.length;T<L;++T){let{start:H,end:q}=_[T],X=m[H],it=m[q];if(X===it){w.push(X);continue}let at=Math.abs((d-X[n])/(it[n]-X[n])),ut=S(X,it,at,s.stepped);ut[n]=l[n],w.push(ut)}return w.length===1?w[0]:w}pathSegment(l,n,s){return RD(this)(l,this,n,s)}path(l,n,s){let d=this.segments,m=RD(this),_=this._loop;n=n||0,s=s||this.points.length-n;for(let w of d)_&=m(l,this,w,{start:n,end:n+s-1});return!!_}draw(l,n,s,d){let m=this.options||{};(this.points||[]).length&&m.borderWidth&&(l.save(),mit(l,this,s,d),l.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}return a.id="line",a.defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0},a.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"},a.descriptors={_scriptable:!0,_indexable:r=>r!=="borderDash"&&r!=="fill"},a})();function l4(a,r,l,n){let s=a.options,{[l]:d}=a.getProps([l],n);return Math.abs(r-d)<s.radius+s.hitRadius}var pit=(()=>{class a extends ia{constructor(l){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,l&&Object.assign(this,l)}inRange(l,n,s){let d=this.options,{x:m,y:_}=this.getProps(["x","y"],s);return Math.pow(l-m,2)+Math.pow(n-_,2)<Math.pow(d.hitRadius+d.radius,2)}inXRange(l,n){return l4(this,l,"x",n)}inYRange(l,n){return l4(this,l,"y",n)}getCenterPoint(l){let{x:n,y:s}=this.getProps(["x","y"],l);return{x:n,y:s}}size(l){l=l||this.options||{};let n=l.radius||0;n=Math.max(n,n&&l.hoverRadius||0);let s=n&&l.borderWidth||0;return(n+s)*2}draw(l,n){let s=this.options;this.skip||s.radius<.1||!Om(this,n,this.size(s)/2)||(l.strokeStyle=s.borderColor,l.lineWidth=s.borderWidth,l.fillStyle=s.backgroundColor,db(l,s,this.x,this.y))}getRange(){let l=this.options||{};return l.radius+l.hitRadius}}return a.id="point",a.defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0},a.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"},a})();function q4(a,r){let{x:l,y:n,base:s,width:d,height:m}=a.getProps(["x","y","base","width","height"],r),_,w,S,T,L;return a.horizontal?(L=m/2,_=Math.min(l,s),w=Math.max(l,s),S=n-L,T=n+L):(L=d/2,_=l-L,w=l+L,S=Math.min(n,s),T=Math.max(n,s)),{left:_,top:S,right:w,bottom:T}}function Od(a,r,l,n){return a?0:Uo(r,l,n)}function fit(a,r,l){let n=a.options.borderWidth,s=a.borderSkipped,d=eD(n);return{t:Od(s.top,d.top,0,l),r:Od(s.right,d.right,0,r),b:Od(s.bottom,d.bottom,0,l),l:Od(s.left,d.left,0,r)}}function git(a,r,l){let{enableBorderRadius:n}=a.getProps(["enableBorderRadius"]),s=a.options.borderRadius,d=kd(s),m=Math.min(r,l),_=a.borderSkipped,w=n||bn(s);return{topLeft:Od(!w||_.top||_.left,d.topLeft,0,m),topRight:Od(!w||_.top||_.right,d.topRight,0,m),bottomLeft:Od(!w||_.bottom||_.left,d.bottomLeft,0,m),bottomRight:Od(!w||_.bottom||_.right,d.bottomRight,0,m)}}function _it(a){let r=q4(a),l=r.right-r.left,n=r.bottom-r.top,s=fit(a,l/2,n/2),d=git(a,l/2,n/2);return{outer:{x:r.left,y:r.top,w:l,h:n,radius:d},inner:{x:r.left+s.l,y:r.top+s.t,w:l-s.l-s.r,h:n-s.t-s.b,radius:{topLeft:Math.max(0,d.topLeft-Math.max(s.t,s.l)),topRight:Math.max(0,d.topRight-Math.max(s.t,s.r)),bottomLeft:Math.max(0,d.bottomLeft-Math.max(s.b,s.l)),bottomRight:Math.max(0,d.bottomRight-Math.max(s.b,s.r))}}}}function yD(a,r,l,n){let s=r===null,d=l===null,_=a&&!(s&&d)&&q4(a,n);return _&&(s||$l(r,_.left,_.right))&&(d||$l(l,_.top,_.bottom))}function vit(a){return a.topLeft||a.topRight||a.bottomLeft||a.bottomRight}function yit(a,r){a.rect(r.x,r.y,r.w,r.h)}function bD(a,r,l={}){let n=a.x!==l.x?-r:0,s=a.y!==l.y?-r:0,d=(a.x+a.w!==l.x+l.w?r:0)-n,m=(a.y+a.h!==l.y+l.h?r:0)-s;return{x:a.x+n,y:a.y+s,w:a.w+d,h:a.h+m,radius:a.radius}}var qm=class extends ia{constructor(r){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,r&&Object.assign(this,r)}draw(r){let{inflateAmount:l,options:{borderColor:n,backgroundColor:s}}=this,{inner:d,outer:m}=_it(this),_=vit(m.radius)?Bm:yit;r.save(),(m.w!==d.w||m.h!==d.h)&&(r.beginPath(),_(r,bD(m,l,d)),r.clip(),_(r,bD(d,-l,m)),r.fillStyle=n,r.fill("evenodd")),r.beginPath(),_(r,bD(d,l)),r.fillStyle=s,r.fill(),r.restore()}inRange(r,l,n){return yD(this,r,l,n)}inXRange(r,l){return yD(this,r,null,l)}inYRange(r,l){return yD(this,null,r,l)}getCenterPoint(r){let{x:l,y:n,base:s,horizontal:d}=this.getProps(["x","y","base","horizontal"],r);return{x:d?(l+s)/2:l,y:d?n:(n+s)/2}}getRange(r){return r==="x"?this.width/2:this.height/2}};qm.id="bar";qm.defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};qm.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};var bit=Object.freeze({__proto__:null,ArcElement:Gm,LineElement:Ib,PointElement:pit,BarElement:qm});function xit(a,r,l,n,s){let d=s.samples||n;if(d>=l)return a.slice(r,r+l);let m=[],_=(l-2)/(d-2),w=0,S=r+l-1,T=r,L,H,q,X,it;for(m[w++]=a[T],L=0;L<d-2;L++){let at=0,ut=0,Mt,Lt=Math.floor((L+1)*_)+1+r,Pt=Math.min(Math.floor((L+2)*_)+1,l)+r,Nt=Pt-Lt;for(Mt=Lt;Mt<Pt;Mt++)at+=a[Mt].x,ut+=a[Mt].y;at/=Nt,ut/=Nt;let ue=Math.floor(L*_)+1+r,Q=Math.min(Math.floor((L+1)*_)+1,l)+r,{x:$t,y:Be}=a[T];for(q=X=-1,Mt=ue;Mt<Q;Mt++)X=.5*Math.abs(($t-at)*(a[Mt].y-Be)-($t-a[Mt].x)*(ut-Be)),X>q&&(q=X,H=a[Mt],it=Mt);m[w++]=H,T=it}return m[w++]=a[S],m}function wit(a,r,l,n){let s=0,d=0,m,_,w,S,T,L,H,q,X,it,at=[],ut=r+l-1,Mt=a[r].x,Pt=a[ut].x-Mt;for(m=r;m<r+l;++m){_=a[m],w=(_.x-Mt)/Pt*n,S=_.y;let Nt=w|0;if(Nt===T)S<X?(X=S,L=m):S>it&&(it=S,H=m),s=(d*s+_.x)/++d;else{let ue=m-1;if(!Pn(L)&&!Pn(H)){let Q=Math.min(L,H),$t=Math.max(L,H);Q!==q&&Q!==ue&&at.push(Ri(Gt({},a[Q]),{x:s})),$t!==q&&$t!==ue&&at.push(Ri(Gt({},a[$t]),{x:s}))}m>0&&ue!==q&&at.push(a[ue]),at.push(_),T=Nt,d=0,X=it=S,L=H=q=m}}return at}function W4(a){if(a._decimated){let r=a._data;delete a._decimated,delete a._data,Object.defineProperty(a,"data",{value:r})}}function c4(a){a.data.datasets.forEach(r=>{W4(r)})}function Cit(a,r){let l=r.length,n=0,s,{iScale:d}=a,{min:m,max:_,minDefined:w,maxDefined:S}=d.getUserBounds();return w&&(n=Uo(ql(r,d.axis,m).lo,0,l-1)),S?s=Uo(ql(r,d.axis,_).hi+1,n,l)-n:s=l-n,{start:n,count:s}}var Sit={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(a,r,l)=>{if(!l.enabled){c4(a);return}let n=a.width;a.data.datasets.forEach((s,d)=>{let{_data:m,indexAxis:_}=s,w=a.getDatasetMeta(d),S=m||s.data;if(Vm([_,a.options.indexAxis])==="y"||!w.controller.supportsDecimation)return;let T=a.scales[w.xAxisID];if(T.type!=="linear"&&T.type!=="time"||a.options.parsing)return;let{start:L,count:H}=Cit(w,S),q=l.threshold||4*n;if(H<=q){W4(s);return}Pn(m)&&(s._data=S,delete s.data,Object.defineProperty(s,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(it){this._data=it}}));let X;switch(l.algorithm){case"lttb":X=xit(S,L,H,n,l);break;case"min-max":X=wit(S,L,H,n);break;default:throw new Error(`Unsupported decimation algorithm '${l.algorithm}'`)}s._decimated=X})},destroy(a){c4(a)}};function Eit(a,r,l){let n=a.segments,s=a.points,d=r.points,m=[];for(let _ of n){let{start:w,end:S}=_;S=FD(w,S,s);let T=PD(l,s[w],s[S],_.loop);if(!r.segments){m.push({source:_,target:T,start:s[w],end:s[S]});continue}let L=hD(r,T);for(let H of L){let q=PD(l,d[H.start],d[H.end],H.loop),X=uD(_,s,q);for(let it of X)m.push({source:it,target:H,start:{[l]:d4(T,q,"start",Math.max)},end:{[l]:d4(T,q,"end",Math.min)}})}}return m}function PD(a,r,l,n){if(n)return;let s=r[a],d=l[a];return a==="angle"&&(s=Bs(s),d=Bs(d)),{property:a,start:s,end:d}}function Mit(a,r){let{x:l=null,y:n=null}=a||{},s=r.points,d=[];return r.segments.forEach(({start:m,end:_})=>{_=FD(m,_,s);let w=s[m],S=s[_];n!==null?(d.push({x:w.x,y:n}),d.push({x:S.x,y:n})):l!==null&&(d.push({x:l,y:w.y}),d.push({x:l,y:S.y}))}),d}function FD(a,r,l){for(;r>a;r--){let n=l[r];if(!isNaN(n.x)&&!isNaN(n.y))break}return r}function d4(a,r,l,n){return a&&r?n(a[l],r[l]):a?a[l]:r?r[l]:0}function $4(a,r){let l=[],n=!1;return kr(a)?(n=!0,l=a):l=Mit(a,r),l.length?new Ib({points:l,options:{tension:0},_loop:n,_fullLoop:n}):null}function u4(a){return a&&a.fill!==!1}function Dit(a,r,l){let s=a[r].fill,d=[r],m;if(!l)return s;for(;s!==!1&&d.indexOf(s)===-1;){if(!go(s))return s;if(m=a[s],!m)return!1;if(m.visible)return s;d.push(s),s=m.fill}return!1}function Tit(a,r,l){let n=Rit(a);if(bn(n))return isNaN(n.value)?!1:n;let s=parseFloat(n);return go(s)&&Math.floor(s)===s?Iit(n[0],r,s,l):["origin","start","end","stack","shape"].indexOf(n)>=0&&n}function Iit(a,r,l,n){return(a==="-"||a==="+")&&(l=r+l),l===r||l<0||l>=n?!1:l}function Ait(a,r){let l=null;return a==="start"?l=r.bottom:a==="end"?l=r.top:bn(a)?l=r.getPixelForValue(a.value):r.getBasePixel&&(l=r.getBasePixel()),l}function kit(a,r,l){let n;return a==="start"?n=l:a==="end"?n=r.options.reverse?r.min:r.max:bn(a)?n=a.value:n=r.getBaseValue(),n}function Rit(a){let r=a.options,l=r.fill,n=nn(l&&l.target,l);return n===void 0&&(n=!!r.backgroundColor),n===!1||n===null?!1:n===!0?"origin":n}function Pit(a){let{scale:r,index:l,line:n}=a,s=[],d=n.segments,m=n.points,_=Oit(r,l);_.push($4({x:null,y:r.bottom},n));for(let w=0;w<d.length;w++){let S=d[w];for(let T=S.start;T<=S.end;T++)Fit(s,m[T],_)}return new Ib({points:s,options:{}})}function Oit(a,r){let l=[],n=a.getMatchingVisibleMetas("line");for(let s=0;s<n.length;s++){let d=n[s];if(d.index===r)break;d.hidden||l.unshift(d.dataset)}return l}function Fit(a,r,l){let n=[];for(let s=0;s<l.length;s++){let d=l[s],{first:m,last:_,point:w}=Lit(d,r,"x");if(!(!w||m&&_)){if(m)n.unshift(w);else if(a.push(w),!_)break}}a.push(...n)}function Lit(a,r,l){let n=a.interpolate(r,l);if(!n)return{};let s=n[l],d=a.segments,m=a.points,_=!1,w=!1;for(let S=0;S<d.length;S++){let T=d[S],L=m[T.start][l],H=m[T.end][l];if($l(s,L,H)){_=s===L,w=s===H;break}}return{first:_,last:w,point:n}}var Mb=class{constructor(r){this.x=r.x,this.y=r.y,this.radius=r.radius}pathSegment(r,l,n){let{x:s,y:d,radius:m}=this;return l=l||{start:0,end:mr},r.arc(s,d,m,l.end,l.start,!0),!n.bounds}interpolate(r){let{x:l,y:n,radius:s}=this,d=r.angle;return{x:l+Math.cos(d)*s,y:n+Math.sin(d)*s,angle:d}}};function zit(a){let{chart:r,fill:l,line:n}=a;if(go(l))return Nit(r,l);if(l==="stack")return Pit(a);if(l==="shape")return!0;let s=Bit(a);return s instanceof Mb?s:$4(s,n)}function Nit(a,r){let l=a.getDatasetMeta(r);return l&&a.isDatasetVisible(r)?l.dataset:null}function Bit(a){return(a.scale||{}).getPointPositionForValue?jit(a):Vit(a)}function Vit(a){let{scale:r={},fill:l}=a,n=Ait(l,r);if(go(n)){let s=r.isHorizontal();return{x:s?n:null,y:s?null:n}}return null}function jit(a){let{scale:r,fill:l}=a,n=r.options,s=r.getLabels().length,d=n.reverse?r.max:r.min,m=kit(l,r,d),_=[];if(n.grid.circular){let w=r.getPointPositionForValue(0,d);return new Mb({x:w.x,y:w.y,radius:r.getDistanceFromCenterForValue(m)})}for(let w=0;w<s;++w)_.push(r.getPointPositionForValue(w,m));return _}function xD(a,r,l){let n=zit(r),{line:s,scale:d,axis:m}=r,_=s.options,w=_.fill,S=_.backgroundColor,{above:T=S,below:L=S}=w||{};n&&s.points.length&&(Ig(a,l),Uit(a,{line:s,target:n,above:T,below:L,area:l,scale:d,axis:m}),Ag(a))}function Uit(a,r){let{line:l,target:n,above:s,below:d,area:m,scale:_}=r,w=l._loop?"angle":r.axis;a.save(),w==="x"&&d!==s&&(h4(a,n,m.top),m4(a,{line:l,target:n,color:s,scale:_,property:w}),a.restore(),a.save(),h4(a,n,m.bottom)),m4(a,{line:l,target:n,color:d,scale:_,property:w}),a.restore()}function h4(a,r,l){let{segments:n,points:s}=r,d=!0,m=!1;a.beginPath();for(let _ of n){let{start:w,end:S}=_,T=s[w],L=s[FD(w,S,s)];d?(a.moveTo(T.x,T.y),d=!1):(a.lineTo(T.x,l),a.lineTo(T.x,T.y)),m=!!r.pathSegment(a,_,{move:m}),m?a.closePath():a.lineTo(L.x,l)}a.lineTo(r.first().x,l),a.closePath(),a.clip()}function m4(a,r){let{line:l,target:n,property:s,color:d,scale:m}=r,_=Eit(l,n,s);for(let{source:w,target:S,start:T,end:L}of _){let{style:{backgroundColor:H=d}={}}=w,q=n!==!0;a.save(),a.fillStyle=H,Hit(a,m,q&&PD(s,T,L)),a.beginPath();let X=!!l.pathSegment(a,w),it;if(q){X?a.closePath():p4(a,n,L,s);let at=!!n.pathSegment(a,S,{move:X,reverse:!0});it=X&&at,it||p4(a,n,T,s)}a.closePath(),a.fill(it?"evenodd":"nonzero"),a.restore()}}function Hit(a,r,l){let{top:n,bottom:s}=r.chart.chartArea,{property:d,start:m,end:_}=l||{};d==="x"&&(a.beginPath(),a.rect(m,n,_-m,s-n),a.clip())}function p4(a,r,l,n){let s=r.interpolate(l,n);s&&a.lineTo(s.x,s.y)}var Git={id:"filler",afterDatasetsUpdate(a,r,l){let n=(a.data.datasets||[]).length,s=[],d,m,_,w;for(m=0;m<n;++m)d=a.getDatasetMeta(m),_=d.dataset,w=null,_&&_.options&&_ instanceof Ib&&(w={visible:a.isDatasetVisible(m),index:m,fill:Tit(_,m,n),chart:a,axis:d.controller.options.indexAxis,scale:d.vScale,line:_}),d.$filler=w,s.push(w);for(m=0;m<n;++m)w=s[m],!(!w||w.fill===!1)&&(w.fill=Dit(s,m,l.propagate))},beforeDraw(a,r,l){let n=l.drawTime==="beforeDraw",s=a.getSortedVisibleDatasetMetas(),d=a.chartArea;for(let m=s.length-1;m>=0;--m){let _=s[m].$filler;_&&(_.line.updateControlPoints(d,_.axis),n&&_.fill&&xD(a.ctx,_,d))}},beforeDatasetsDraw(a,r,l){if(l.drawTime!=="beforeDatasetsDraw")return;let n=a.getSortedVisibleDatasetMetas();for(let s=n.length-1;s>=0;--s){let d=n[s].$filler;u4(d)&&xD(a.ctx,d,a.chartArea)}},beforeDatasetDraw(a,r,l){let n=r.meta.$filler;!u4(n)||l.drawTime!=="beforeDatasetDraw"||xD(a.ctx,n,a.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}},f4=(a,r)=>{let{boxHeight:l=r,boxWidth:n=r}=a;return a.usePointStyle&&(l=Math.min(l,r),n=a.pointStyleWidth||Math.min(n,r)),{boxWidth:n,boxHeight:l,itemHeight:Math.max(r,l)}},qit=(a,r)=>a!==null&&r!==null&&a.datasetIndex===r.datasetIndex&&a.index===r.index,Db=class extends ia{constructor(r){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=r.chart,this.options=r.options,this.ctx=r.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(r,l,n){this.maxWidth=r,this.maxHeight=l,this._margins=n,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){let r=this.options.labels||{},l=Rr(r.generateLabels,[this.chart],this)||[];r.filter&&(l=l.filter(n=>r.filter(n,this.chart.data))),r.sort&&(l=l.sort((n,s)=>r.sort(n,s,this.chart.data))),this.options.reverse&&l.reverse(),this.legendItems=l}fit(){let{options:r,ctx:l}=this;if(!r.display){this.width=this.height=0;return}let n=r.labels,s=zo(n.font),d=s.size,m=this._computeTitleHeight(),{boxWidth:_,itemHeight:w}=f4(n,d),S,T;l.font=s.string,this.isHorizontal()?(S=this.maxWidth,T=this._fitRows(m,d,_,w)+10):(T=this.maxHeight,S=this._fitCols(m,d,_,w)+10),this.width=Math.min(S,r.maxWidth||this.maxWidth),this.height=Math.min(T,r.maxHeight||this.maxHeight)}_fitRows(r,l,n,s){let{ctx:d,maxWidth:m,options:{labels:{padding:_}}}=this,w=this.legendHitBoxes=[],S=this.lineWidths=[0],T=s+_,L=r;d.textAlign="left",d.textBaseline="middle";let H=-1,q=-T;return this.legendItems.forEach((X,it)=>{let at=n+l/2+d.measureText(X.text).width;(it===0||S[S.length-1]+at+2*_>m)&&(L+=T,S[S.length-(it>0?0:1)]=0,q+=T,H++),w[it]={left:0,top:q,row:H,width:at,height:s},S[S.length-1]+=at+_}),L}_fitCols(r,l,n,s){let{ctx:d,maxHeight:m,options:{labels:{padding:_}}}=this,w=this.legendHitBoxes=[],S=this.columnSizes=[],T=m-r,L=_,H=0,q=0,X=0,it=0;return this.legendItems.forEach((at,ut)=>{let Mt=n+l/2+d.measureText(at.text).width;ut>0&&q+s+2*_>T&&(L+=H+_,S.push({width:H,height:q}),X+=H+_,it++,H=q=0),w[ut]={left:X,top:q,col:it,width:Mt,height:s},H=Math.max(H,Mt),q+=s+_}),L+=H,S.push({width:H,height:q}),L}adjustHitBoxes(){if(!this.options.display)return;let r=this._computeTitleHeight(),{legendHitBoxes:l,options:{align:n,labels:{padding:s},rtl:d}}=this,m=Vu(d,this.left,this.width);if(this.isHorizontal()){let _=0,w=Qo(n,this.left+s,this.right-this.lineWidths[_]);for(let S of l)_!==S.row&&(_=S.row,w=Qo(n,this.left+s,this.right-this.lineWidths[_])),S.top+=this.top+r+s,S.left=m.leftForLtr(m.x(w),S.width),w+=S.width+s}else{let _=0,w=Qo(n,this.top+r+s,this.bottom-this.columnSizes[_].height);for(let S of l)S.col!==_&&(_=S.col,w=Qo(n,this.top+r+s,this.bottom-this.columnSizes[_].height)),S.top=w,S.left+=this.left+s,S.left=m.leftForLtr(m.x(S.left),S.width),w+=S.height+s}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){let r=this.ctx;Ig(r,this),this._draw(),Ag(r)}}_draw(){let{options:r,columnSizes:l,lineWidths:n,ctx:s}=this,{align:d,labels:m}=r,_=xn.color,w=Vu(r.rtl,this.left,this.width),S=zo(m.font),{color:T,padding:L}=m,H=S.size,q=H/2,X;this.drawTitle(),s.textAlign=w.textAlign("left"),s.textBaseline="middle",s.lineWidth=.5,s.font=S.string;let{boxWidth:it,boxHeight:at,itemHeight:ut}=f4(m,H),Mt=function(Q,$t,Be){if(isNaN(it)||it<=0||isNaN(at)||at<0)return;s.save();let Ai=nn(Be.lineWidth,1);if(s.fillStyle=nn(Be.fillStyle,_),s.lineCap=nn(Be.lineCap,"butt"),s.lineDashOffset=nn(Be.lineDashOffset,0),s.lineJoin=nn(Be.lineJoin,"miter"),s.lineWidth=Ai,s.strokeStyle=nn(Be.strokeStyle,_),s.setLineDash(nn(Be.lineDash,[])),m.usePointStyle){let fe={radius:at*Math.SQRT2/2,pointStyle:Be.pointStyle,rotation:Be.rotation,borderWidth:Ai},ii=w.xPlus(Q,it/2),Pi=$t+q;tD(s,fe,ii,Pi,m.pointStyleWidth&&it)}else{let fe=$t+Math.max((H-at)/2,0),ii=w.leftForLtr(Q,it),Pi=kd(Be.borderRadius);s.beginPath(),Object.values(Pi).some(Cr=>Cr!==0)?Bm(s,{x:ii,y:fe,w:it,h:at,radius:Pi}):s.rect(ii,fe,it,at),s.fill(),Ai!==0&&s.stroke()}s.restore()},Lt=function(Q,$t,Be){Ad(s,Be.text,Q,$t+ut/2,S,{strikethrough:Be.hidden,textAlign:w.textAlign(Be.textAlign)})},Pt=this.isHorizontal(),Nt=this._computeTitleHeight();Pt?X={x:Qo(d,this.left+L,this.right-n[0]),y:this.top+L+Nt,line:0}:X={x:this.left+L,y:Qo(d,this.top+Nt+L,this.bottom-l[0].height),line:0},cD(this.ctx,r.textDirection);let ue=ut+L;this.legendItems.forEach((Q,$t)=>{s.strokeStyle=Q.fontColor||T,s.fillStyle=Q.fontColor||T;let Be=s.measureText(Q.text).width,Ai=w.textAlign(Q.textAlign||(Q.textAlign=m.textAlign)),fe=it+q+Be,ii=X.x,Pi=X.y;w.setWidth(this.width),Pt?$t>0&&ii+fe+L>this.right&&(Pi=X.y+=ue,X.line++,ii=X.x=Qo(d,this.left+L,this.right-n[X.line])):$t>0&&Pi+ue>this.bottom&&(ii=X.x=ii+l[X.line].width+L,X.line++,Pi=X.y=Qo(d,this.top+Nt+L,this.bottom-l[X.line].height));let Cr=w.x(ii);Mt(Cr,Pi,Q),ii=gB(Ai,ii+it+q,Pt?ii+fe:this.right,r.rtl),Lt(w.x(ii),Pi,Q),Pt?X.x+=fe+L:X.y+=ue}),dD(this.ctx,r.textDirection)}drawTitle(){let r=this.options,l=r.title,n=zo(l.font),s=Jo(l.padding);if(!l.display)return;let d=Vu(r.rtl,this.left,this.width),m=this.ctx,_=l.position,w=n.size/2,S=s.top+w,T,L=this.left,H=this.width;if(this.isHorizontal())H=Math.max(...this.lineWidths),T=this.top+S,L=Qo(r.align,L,this.right-H);else{let X=this.columnSizes.reduce((it,at)=>Math.max(it,at.height),0);T=S+Qo(r.align,this.top,this.bottom-X-r.labels.padding-this._computeTitleHeight())}let q=Qo(_,L,L+H);m.textAlign=d.textAlign(lb(_)),m.textBaseline="middle",m.strokeStyle=l.color,m.fillStyle=l.color,m.font=n.string,Ad(m,l.text,q,T,n)}_computeTitleHeight(){let r=this.options.title,l=zo(r.font),n=Jo(r.padding);return r.display?l.lineHeight+n.height:0}_getLegendItemAt(r,l){let n,s,d;if($l(r,this.left,this.right)&&$l(l,this.top,this.bottom)){for(d=this.legendHitBoxes,n=0;n<d.length;++n)if(s=d[n],$l(r,s.left,s.left+s.width)&&$l(l,s.top,s.top+s.height))return this.legendItems[n]}return null}handleEvent(r){let l=this.options;if(!Wit(r.type,l))return;let n=this._getLegendItemAt(r.x,r.y);if(r.type==="mousemove"||r.type==="mouseout"){let s=this._hoveredItem,d=qit(s,n);s&&!d&&Rr(l.onLeave,[r,s,this],this),this._hoveredItem=n,n&&!d&&Rr(l.onHover,[r,n,this],this)}else n&&Rr(l.onClick,[r,n,this],this)}};function Wit(a,r){return!!((a==="mousemove"||a==="mouseout")&&(r.onHover||r.onLeave)||r.onClick&&(a==="click"||a==="mouseup"))}var $it={id:"legend",_element:Db,start(a,r,l){let n=a.legend=new Db({ctx:a.ctx,options:l,chart:a});rs.configure(a,n,l),rs.addBox(a,n)},stop(a){rs.removeBox(a,a.legend),delete a.legend},beforeUpdate(a,r,l){let n=a.legend;rs.configure(a,n,l),n.options=l},afterUpdate(a){let r=a.legend;r.buildLabels(),r.adjustHitBoxes()},afterEvent(a,r){r.replay||a.legend.handleEvent(r.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(a,r,l){let n=r.datasetIndex,s=l.chart;s.isDatasetVisible(n)?(s.hide(n),r.hidden=!0):(s.show(n),r.hidden=!1)},onHover:null,onLeave:null,labels:{color:a=>a.chart.options.color,boxWidth:40,padding:10,generateLabels(a){let r=a.data.datasets,{labels:{usePointStyle:l,pointStyle:n,textAlign:s,color:d}}=a.legend.options;return a._getSortedDatasetMetas().map(m=>{let _=m.controller.getStyle(l?0:void 0),w=Jo(_.borderWidth);return{text:r[m.index].label,fillStyle:_.backgroundColor,fontColor:d,hidden:!m.visible,lineCap:_.borderCapStyle,lineDash:_.borderDash,lineDashOffset:_.borderDashOffset,lineJoin:_.borderJoinStyle,lineWidth:(w.width+w.height)/4,strokeStyle:_.borderColor,pointStyle:n||_.pointStyle,rotation:_.rotation,textAlign:s||_.textAlign,borderRadius:0,datasetIndex:m.index}},this)}},title:{color:a=>a.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:a=>!a.startsWith("on"),labels:{_scriptable:a=>!["generateLabels","filter","sort"].includes(a)}}},Bg=class extends ia{constructor(r){super(),this.chart=r.chart,this.options=r.options,this.ctx=r.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(r,l){let n=this.options;if(this.left=0,this.top=0,!n.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=r,this.height=this.bottom=l;let s=kr(n.text)?n.text.length:1;this._padding=Jo(n.padding);let d=s*zo(n.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=d:this.width=d}isHorizontal(){let r=this.options.position;return r==="top"||r==="bottom"}_drawArgs(r){let{top:l,left:n,bottom:s,right:d,options:m}=this,_=m.align,w=0,S,T,L;return this.isHorizontal()?(T=Qo(_,n,d),L=l+r,S=d-n):(m.position==="left"?(T=n+r,L=Qo(_,s,l),w=Ur*-.5):(T=d-r,L=Qo(_,l,s),w=Ur*.5),S=s-l),{titleX:T,titleY:L,maxWidth:S,rotation:w}}draw(){let r=this.ctx,l=this.options;if(!l.display)return;let n=zo(l.font),d=n.lineHeight/2+this._padding.top,{titleX:m,titleY:_,maxWidth:w,rotation:S}=this._drawArgs(d);Ad(r,l.text,0,0,n,{color:l.color,maxWidth:w,rotation:S,textAlign:lb(l.align),textBaseline:"middle",translation:[m,_]})}};function Yit(a,r){let l=new Bg({ctx:a.ctx,options:r,chart:a});rs.configure(a,l,r),rs.addBox(a,l),a.titleBlock=l}var Zit={id:"title",_element:Bg,start(a,r,l){Yit(a,l)},stop(a){let r=a.titleBlock;rs.removeBox(a,r),delete a.titleBlock},beforeUpdate(a,r,l){let n=a.titleBlock;rs.configure(a,n,l),n.options=l},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}},vb=new WeakMap,Xit={id:"subtitle",start(a,r,l){let n=new Bg({ctx:a.ctx,options:l,chart:a});rs.configure(a,n,l),rs.addBox(a,n),vb.set(a,n)},stop(a){rs.removeBox(a,vb.get(a)),vb.delete(a)},beforeUpdate(a,r,l){let n=vb.get(a);rs.configure(a,n,l),n.options=l},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}},zg={average(a){if(!a.length)return!1;let r,l,n=0,s=0,d=0;for(r=0,l=a.length;r<l;++r){let m=a[r].element;if(m&&m.hasValue()){let _=m.tooltipPosition();n+=_.x,s+=_.y,++d}}return{x:n/d,y:s/d}},nearest(a,r){if(!a.length)return!1;let l=r.x,n=r.y,s=Number.POSITIVE_INFINITY,d,m,_;for(d=0,m=a.length;d<m;++d){let w=a[d].element;if(w&&w.hasValue()){let S=w.getCenterPoint(),T=nb(r,S);T<s&&(s=T,_=w)}}if(_){let w=_.tooltipPosition();l=w.x,n=w.y}return{x:l,y:n}}};function Yl(a,r){return r&&(kr(r)?Array.prototype.push.apply(a,r):a.push(r)),a}function Fc(a){return(typeof a=="string"||a instanceof String)&&a.indexOf(`
`)>-1?a.split(`
`):a}function Kit(a,r){let{element:l,datasetIndex:n,index:s}=r,d=a.getDatasetMeta(n).controller,{label:m,value:_}=d.getLabelAndValue(s);return{chart:a,label:m,parsed:d.getParsed(s),raw:a.data.datasets[n].data[s],formattedValue:_,dataset:d.getDataset(),dataIndex:s,datasetIndex:n,element:l}}function g4(a,r){let l=a.chart.ctx,{body:n,footer:s,title:d}=a,{boxWidth:m,boxHeight:_}=r,w=zo(r.bodyFont),S=zo(r.titleFont),T=zo(r.footerFont),L=d.length,H=s.length,q=n.length,X=Jo(r.padding),it=X.height,at=0,ut=n.reduce((Pt,Nt)=>Pt+Nt.before.length+Nt.lines.length+Nt.after.length,0);if(ut+=a.beforeBody.length+a.afterBody.length,L&&(it+=L*S.lineHeight+(L-1)*r.titleSpacing+r.titleMarginBottom),ut){let Pt=r.displayColors?Math.max(_,w.lineHeight):w.lineHeight;it+=q*Pt+(ut-q)*w.lineHeight+(ut-1)*r.bodySpacing}H&&(it+=r.footerMarginTop+H*T.lineHeight+(H-1)*r.footerSpacing);let Mt=0,Lt=function(Pt){at=Math.max(at,l.measureText(Pt).width+Mt)};return l.save(),l.font=S.string,lr(a.title,Lt),l.font=w.string,lr(a.beforeBody.concat(a.afterBody),Lt),Mt=r.displayColors?m+2+r.boxPadding:0,lr(n,Pt=>{lr(Pt.before,Lt),lr(Pt.lines,Lt),lr(Pt.after,Lt)}),Mt=0,l.font=T.string,lr(a.footer,Lt),l.restore(),at+=X.width,{width:at,height:it}}function Qit(a,r){let{y:l,height:n}=r;return l<n/2?"top":l>a.height-n/2?"bottom":"center"}function Jit(a,r,l,n){let{x:s,width:d}=n,m=l.caretSize+l.caretPadding;if(a==="left"&&s+d+m>r.width||a==="right"&&s-d-m<0)return!0}function tnt(a,r,l,n){let{x:s,width:d}=l,{width:m,chartArea:{left:_,right:w}}=a,S="center";return n==="center"?S=s<=(_+w)/2?"left":"right":s<=d/2?S="left":s>=m-d/2&&(S="right"),Jit(S,a,r,l)&&(S="center"),S}function _4(a,r,l){let n=l.yAlign||r.yAlign||Qit(a,l);return{xAlign:l.xAlign||r.xAlign||tnt(a,r,l,n),yAlign:n}}function ent(a,r){let{x:l,width:n}=a;return r==="right"?l-=n:r==="center"&&(l-=n/2),l}function int(a,r,l){let{y:n,height:s}=a;return r==="top"?n+=l:r==="bottom"?n-=s+l:n-=s/2,n}function v4(a,r,l,n){let{caretSize:s,caretPadding:d,cornerRadius:m}=a,{xAlign:_,yAlign:w}=l,S=s+d,{topLeft:T,topRight:L,bottomLeft:H,bottomRight:q}=kd(m),X=ent(r,_),it=int(r,w,S);return w==="center"?_==="left"?X+=S:_==="right"&&(X-=S):_==="left"?X-=Math.max(T,H)+s:_==="right"&&(X+=Math.max(L,q)+s),{x:Uo(X,0,n.width-r.width),y:Uo(it,0,n.height-r.height)}}function yb(a,r,l){let n=Jo(l.padding);return r==="center"?a.x+a.width/2:r==="right"?a.x+a.width-n.right:a.x+n.left}function y4(a){return Yl([],Fc(a))}function nnt(a,r,l){return Pc(a,{tooltip:r,tooltipItems:l,type:"tooltip"})}function b4(a,r){let l=r&&r.dataset&&r.dataset.tooltip&&r.dataset.tooltip.callbacks;return l?a.override(l):a}var x4=(()=>{class a extends ia{constructor(l){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=l.chart||l._chart,this._chart=this.chart,this.options=l.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(l){this.options=l,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){let l=this._cachedAnimations;if(l)return l;let n=this.chart,s=this.options.setContext(this.getContext()),d=s.enabled&&n.options.animation&&s.animations,m=new wb(this.chart,d);return d._cacheable&&(this._cachedAnimations=Object.freeze(m)),m}getContext(){return this.$context||(this.$context=nnt(this.chart.getContext(),this,this._tooltipItems))}getTitle(l,n){let{callbacks:s}=n,d=s.beforeTitle.apply(this,[l]),m=s.title.apply(this,[l]),_=s.afterTitle.apply(this,[l]),w=[];return w=Yl(w,Fc(d)),w=Yl(w,Fc(m)),w=Yl(w,Fc(_)),w}getBeforeBody(l,n){return y4(n.callbacks.beforeBody.apply(this,[l]))}getBody(l,n){let{callbacks:s}=n,d=[];return lr(l,m=>{let _={before:[],lines:[],after:[]},w=b4(s,m);Yl(_.before,Fc(w.beforeLabel.call(this,m))),Yl(_.lines,w.label.call(this,m)),Yl(_.after,Fc(w.afterLabel.call(this,m))),d.push(_)}),d}getAfterBody(l,n){return y4(n.callbacks.afterBody.apply(this,[l]))}getFooter(l,n){let{callbacks:s}=n,d=s.beforeFooter.apply(this,[l]),m=s.footer.apply(this,[l]),_=s.afterFooter.apply(this,[l]),w=[];return w=Yl(w,Fc(d)),w=Yl(w,Fc(m)),w=Yl(w,Fc(_)),w}_createItems(l){let n=this._active,s=this.chart.data,d=[],m=[],_=[],w=[],S,T;for(S=0,T=n.length;S<T;++S)w.push(Kit(this.chart,n[S]));return l.filter&&(w=w.filter((L,H,q)=>l.filter(L,H,q,s))),l.itemSort&&(w=w.sort((L,H)=>l.itemSort(L,H,s))),lr(w,L=>{let H=b4(l.callbacks,L);d.push(H.labelColor.call(this,L)),m.push(H.labelPointStyle.call(this,L)),_.push(H.labelTextColor.call(this,L))}),this.labelColors=d,this.labelPointStyles=m,this.labelTextColors=_,this.dataPoints=w,w}update(l,n){let s=this.options.setContext(this.getContext()),d=this._active,m,_=[];if(!d.length)this.opacity!==0&&(m={opacity:0});else{let w=zg[s.position].call(this,d,this._eventPosition);_=this._createItems(s),this.title=this.getTitle(_,s),this.beforeBody=this.getBeforeBody(_,s),this.body=this.getBody(_,s),this.afterBody=this.getAfterBody(_,s),this.footer=this.getFooter(_,s);let S=this._size=g4(this,s),T=Object.assign({},w,S),L=_4(this.chart,s,T),H=v4(s,T,L,this.chart);this.xAlign=L.xAlign,this.yAlign=L.yAlign,m={opacity:1,x:H.x,y:H.y,width:S.width,height:S.height,caretX:w.x,caretY:w.y}}this._tooltipItems=_,this.$context=void 0,m&&this._resolveAnimations().update(this,m),l&&s.external&&s.external.call(this,{chart:this.chart,tooltip:this,replay:n})}drawCaret(l,n,s,d){let m=this.getCaretPosition(l,s,d);n.lineTo(m.x1,m.y1),n.lineTo(m.x2,m.y2),n.lineTo(m.x3,m.y3)}getCaretPosition(l,n,s){let{xAlign:d,yAlign:m}=this,{caretSize:_,cornerRadius:w}=s,{topLeft:S,topRight:T,bottomLeft:L,bottomRight:H}=kd(w),{x:q,y:X}=l,{width:it,height:at}=n,ut,Mt,Lt,Pt,Nt,ue;return m==="center"?(Nt=X+at/2,d==="left"?(ut=q,Mt=ut-_,Pt=Nt+_,ue=Nt-_):(ut=q+it,Mt=ut+_,Pt=Nt-_,ue=Nt+_),Lt=ut):(d==="left"?Mt=q+Math.max(S,L)+_:d==="right"?Mt=q+it-Math.max(T,H)-_:Mt=this.caretX,m==="top"?(Pt=X,Nt=Pt-_,ut=Mt-_,Lt=Mt+_):(Pt=X+at,Nt=Pt+_,ut=Mt+_,Lt=Mt-_),ue=Pt),{x1:ut,x2:Mt,x3:Lt,y1:Pt,y2:Nt,y3:ue}}drawTitle(l,n,s){let d=this.title,m=d.length,_,w,S;if(m){let T=Vu(s.rtl,this.x,this.width);for(l.x=yb(this,s.titleAlign,s),n.textAlign=T.textAlign(s.titleAlign),n.textBaseline="middle",_=zo(s.titleFont),w=s.titleSpacing,n.fillStyle=s.titleColor,n.font=_.string,S=0;S<m;++S)n.fillText(d[S],T.x(l.x),l.y+_.lineHeight/2),l.y+=_.lineHeight+w,S+1===m&&(l.y+=s.titleMarginBottom-w)}}_drawColorBox(l,n,s,d,m){let _=this.labelColors[s],w=this.labelPointStyles[s],{boxHeight:S,boxWidth:T,boxPadding:L}=m,H=zo(m.bodyFont),q=yb(this,"left",m),X=d.x(q),it=S<H.lineHeight?(H.lineHeight-S)/2:0,at=n.y+it;if(m.usePointStyle){let ut={radius:Math.min(T,S)/2,pointStyle:w.pointStyle,rotation:w.rotation,borderWidth:1},Mt=d.leftForLtr(X,T)+T/2,Lt=at+S/2;l.strokeStyle=m.multiKeyBackground,l.fillStyle=m.multiKeyBackground,db(l,ut,Mt,Lt),l.strokeStyle=_.borderColor,l.fillStyle=_.backgroundColor,db(l,ut,Mt,Lt)}else{l.lineWidth=bn(_.borderWidth)?Math.max(...Object.values(_.borderWidth)):_.borderWidth||1,l.strokeStyle=_.borderColor,l.setLineDash(_.borderDash||[]),l.lineDashOffset=_.borderDashOffset||0;let ut=d.leftForLtr(X,T-L),Mt=d.leftForLtr(d.xPlus(X,1),T-L-2),Lt=kd(_.borderRadius);Object.values(Lt).some(Pt=>Pt!==0)?(l.beginPath(),l.fillStyle=m.multiKeyBackground,Bm(l,{x:ut,y:at,w:T,h:S,radius:Lt}),l.fill(),l.stroke(),l.fillStyle=_.backgroundColor,l.beginPath(),Bm(l,{x:Mt,y:at+1,w:T-2,h:S-2,radius:Lt}),l.fill()):(l.fillStyle=m.multiKeyBackground,l.fillRect(ut,at,T,S),l.strokeRect(ut,at,T,S),l.fillStyle=_.backgroundColor,l.fillRect(Mt,at+1,T-2,S-2))}l.fillStyle=this.labelTextColors[s]}drawBody(l,n,s){let{body:d}=this,{bodySpacing:m,bodyAlign:_,displayColors:w,boxHeight:S,boxWidth:T,boxPadding:L}=s,H=zo(s.bodyFont),q=H.lineHeight,X=0,it=Vu(s.rtl,this.x,this.width),at=function(Be){n.fillText(Be,it.x(l.x+X),l.y+q/2),l.y+=q+m},ut=it.textAlign(_),Mt,Lt,Pt,Nt,ue,Q,$t;for(n.textAlign=_,n.textBaseline="middle",n.font=H.string,l.x=yb(this,ut,s),n.fillStyle=s.bodyColor,lr(this.beforeBody,at),X=w&&ut!=="right"?_==="center"?T/2+L:T+2+L:0,Nt=0,Q=d.length;Nt<Q;++Nt){for(Mt=d[Nt],Lt=this.labelTextColors[Nt],n.fillStyle=Lt,lr(Mt.before,at),Pt=Mt.lines,w&&Pt.length&&(this._drawColorBox(n,l,Nt,it,s),q=Math.max(H.lineHeight,S)),ue=0,$t=Pt.length;ue<$t;++ue)at(Pt[ue]),q=H.lineHeight;lr(Mt.after,at)}X=0,q=H.lineHeight,lr(this.afterBody,at),l.y-=m}drawFooter(l,n,s){let d=this.footer,m=d.length,_,w;if(m){let S=Vu(s.rtl,this.x,this.width);for(l.x=yb(this,s.footerAlign,s),l.y+=s.footerMarginTop,n.textAlign=S.textAlign(s.footerAlign),n.textBaseline="middle",_=zo(s.footerFont),n.fillStyle=s.footerColor,n.font=_.string,w=0;w<m;++w)n.fillText(d[w],S.x(l.x),l.y+_.lineHeight/2),l.y+=_.lineHeight+s.footerSpacing}}drawBackground(l,n,s,d){let{xAlign:m,yAlign:_}=this,{x:w,y:S}=l,{width:T,height:L}=s,{topLeft:H,topRight:q,bottomLeft:X,bottomRight:it}=kd(d.cornerRadius);n.fillStyle=d.backgroundColor,n.strokeStyle=d.borderColor,n.lineWidth=d.borderWidth,n.beginPath(),n.moveTo(w+H,S),_==="top"&&this.drawCaret(l,n,s,d),n.lineTo(w+T-q,S),n.quadraticCurveTo(w+T,S,w+T,S+q),_==="center"&&m==="right"&&this.drawCaret(l,n,s,d),n.lineTo(w+T,S+L-it),n.quadraticCurveTo(w+T,S+L,w+T-it,S+L),_==="bottom"&&this.drawCaret(l,n,s,d),n.lineTo(w+X,S+L),n.quadraticCurveTo(w,S+L,w,S+L-X),_==="center"&&m==="left"&&this.drawCaret(l,n,s,d),n.lineTo(w,S+H),n.quadraticCurveTo(w,S,w+H,S),n.closePath(),n.fill(),d.borderWidth>0&&n.stroke()}_updateAnimationTarget(l){let n=this.chart,s=this.$animations,d=s&&s.x,m=s&&s.y;if(d||m){let _=zg[l.position].call(this,this._active,this._eventPosition);if(!_)return;let w=this._size=g4(this,l),S=Object.assign({},_,this._size),T=_4(n,l,S),L=v4(l,S,T,n);(d._to!==L.x||m._to!==L.y)&&(this.xAlign=T.xAlign,this.yAlign=T.yAlign,this.width=w.width,this.height=w.height,this.caretX=_.x,this.caretY=_.y,this._resolveAnimations().update(this,L))}}_willRender(){return!!this.opacity}draw(l){let n=this.options.setContext(this.getContext()),s=this.opacity;if(!s)return;this._updateAnimationTarget(n);let d={width:this.width,height:this.height},m={x:this.x,y:this.y};s=Math.abs(s)<.001?0:s;let _=Jo(n.padding),w=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;n.enabled&&w&&(l.save(),l.globalAlpha=s,this.drawBackground(m,l,d,n),cD(l,n.textDirection),m.y+=_.top,this.drawTitle(m,l,n),this.drawBody(m,l,n),this.drawFooter(m,l,n),dD(l,n.textDirection),l.restore())}getActiveElements(){return this._active||[]}setActiveElements(l,n){let s=this._active,d=l.map(({datasetIndex:w,index:S})=>{let T=this.chart.getDatasetMeta(w);if(!T)throw new Error("Cannot find a dataset at index "+w);return{datasetIndex:w,element:T.data[S],index:S}}),m=!Dg(s,d),_=this._positionChanged(d,n);(m||_)&&(this._active=d,this._eventPosition=n,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(l,n,s=!0){if(n&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;let d=this.options,m=this._active||[],_=this._getActiveElements(l,m,n,s),w=this._positionChanged(_,l),S=n||!Dg(_,m)||w;return S&&(this._active=_,(d.enabled||d.external)&&(this._eventPosition={x:l.x,y:l.y},this.update(!0,n))),S}_getActiveElements(l,n,s,d){let m=this.options;if(l.type==="mouseout")return[];if(!d)return n;let _=this.chart.getElementsAtEventForMode(l,m.mode,m,s);return m.reverse&&_.reverse(),_}_positionChanged(l,n){let{caretX:s,caretY:d,options:m}=this,_=zg[m.position].call(this,l,n);return _!==!1&&(s!==_.x||d!==_.y)}}return a.positioners=zg,a})(),rnt={id:"tooltip",_element:x4,positioners:zg,afterInit(a,r,l){l&&(a.tooltip=new x4({chart:a,options:l}))},beforeUpdate(a,r,l){a.tooltip&&a.tooltip.initialize(l)},reset(a,r,l){a.tooltip&&a.tooltip.initialize(l)},afterDraw(a){let r=a.tooltip;if(r&&r._willRender()){let l={tooltip:r};if(a.notifyPlugins("beforeTooltipDraw",l)===!1)return;r.draw(a.ctx),a.notifyPlugins("afterTooltipDraw",l)}},afterEvent(a,r){if(a.tooltip){let l=r.replay;a.tooltip.handleEvent(r.event,l,r.inChartArea)&&(r.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(a,r)=>r.bodyFont.size,boxWidth:(a,r)=>r.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:{beforeTitle:Wl,title(a){if(a.length>0){let r=a[0],l=r.chart.data.labels,n=l?l.length:0;if(this&&this.options&&this.options.mode==="dataset")return r.dataset.label||"";if(r.label)return r.label;if(n>0&&r.dataIndex<n)return l[r.dataIndex]}return""},afterTitle:Wl,beforeBody:Wl,beforeLabel:Wl,label(a){if(this&&this.options&&this.options.mode==="dataset")return a.label+": "+a.formattedValue||a.formattedValue;let r=a.dataset.label||"";r&&(r+=": ");let l=a.formattedValue;return Pn(l)||(r+=l),r},labelColor(a){let l=a.chart.getDatasetMeta(a.datasetIndex).controller.getStyle(a.dataIndex);return{borderColor:l.borderColor,backgroundColor:l.backgroundColor,borderWidth:l.borderWidth,borderDash:l.borderDash,borderDashOffset:l.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(a){let l=a.chart.getDatasetMeta(a.datasetIndex).controller.getStyle(a.dataIndex);return{pointStyle:l.pointStyle,rotation:l.rotation}},afterLabel:Wl,afterBody:Wl,beforeFooter:Wl,footer:Wl,afterFooter:Wl}},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:a=>a!=="filter"&&a!=="itemSort"&&a!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},ont=Object.freeze({__proto__:null,Decimation:Sit,Filler:Git,Legend:$it,SubTitle:Xit,Title:Zit,Tooltip:rnt}),snt=(a,r,l,n)=>(typeof r=="string"?(l=a.push(r)-1,n.unshift({index:l,label:r})):isNaN(r)&&(l=null),l);function ant(a,r,l,n){let s=a.indexOf(r);if(s===-1)return snt(a,r,l,n);let d=a.lastIndexOf(r);return s!==d?l:s}var lnt=(a,r)=>a===null?null:Uo(Math.round(a),0,r),Wm=class extends Uu{constructor(r){super(r),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(r){let l=this._addedLabels;if(l.length){let n=this.getLabels();for(let{index:s,label:d}of l)n[s]===d&&n.splice(s,1);this._addedLabels=[]}super.init(r)}parse(r,l){if(Pn(r))return null;let n=this.getLabels();return l=isFinite(l)&&n[l]===r?l:ant(n,r,nn(l,r),this._addedLabels),lnt(l,n.length-1)}determineDataLimits(){let{minDefined:r,maxDefined:l}=this.getUserBounds(),{min:n,max:s}=this.getMinMax(!0);this.options.bounds==="ticks"&&(r||(n=0),l||(s=this.getLabels().length-1)),this.min=n,this.max=s}buildTicks(){let r=this.min,l=this.max,n=this.options.offset,s=[],d=this.getLabels();d=r===0&&l===d.length-1?d:d.slice(r,l+1),this._valueRange=Math.max(d.length-(n?0:1),1),this._startValue=this.min-(n?.5:0);for(let m=r;m<=l;m++)s.push({value:m});return s}getLabelForValue(r){let l=this.getLabels();return r>=0&&r<l.length?l[r]:r}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(r){return typeof r!="number"&&(r=this.parse(r)),r===null?NaN:this.getPixelForDecimal((r-this._startValue)/this._valueRange)}getPixelForTick(r){let l=this.ticks;return r<0||r>l.length-1?null:this.getPixelForValue(l[r].value)}getValueForPixel(r){return Math.round(this._startValue+this.getDecimalForPixel(r)*this._valueRange)}getBasePixel(){return this.bottom}};Wm.id="category";Wm.defaults={ticks:{callback:Wm.prototype.getLabelForValue}};function cnt(a,r){let l=[],{bounds:s,step:d,min:m,max:_,precision:w,count:S,maxTicks:T,maxDigits:L,includeBounds:H}=a,q=d||1,X=T-1,{min:it,max:at}=r,ut=!Pn(m),Mt=!Pn(_),Lt=!Pn(S),Pt=(at-it)/(L+1),Nt=BM((at-it)/X/q)*q,ue,Q,$t,Be;if(Nt<1e-14&&!ut&&!Mt)return[{value:it},{value:at}];Be=Math.ceil(at/Nt)-Math.floor(it/Nt),Be>X&&(Nt=BM(Be*Nt/X/q)*q),Pn(w)||(ue=Math.pow(10,w),Nt=Math.ceil(Nt*ue)/ue),s==="ticks"?(Q=Math.floor(it/Nt)*Nt,$t=Math.ceil(at/Nt)*Nt):(Q=it,$t=at),ut&&Mt&&d&&cB((_-m)/d,Nt/1e3)?(Be=Math.round(Math.min((_-m)/Nt,T)),Nt=(_-m)/Be,Q=m,$t=_):Lt?(Q=ut?m:Q,$t=Mt?_:$t,Be=S-1,Nt=($t-Q)/Be):(Be=($t-Q)/Nt,zm(Be,Math.round(Be),Nt/1e3)?Be=Math.round(Be):Be=Math.ceil(Be));let Ai=Math.max(jM(Nt),jM(Q));ue=Math.pow(10,Pn(w)?Ai:w),Q=Math.round(Q*ue)/ue,$t=Math.round($t*ue)/ue;let fe=0;for(ut&&(H&&Q!==m?(l.push({value:m}),Q<m&&fe++,zm(Math.round((Q+fe*Nt)*ue)/ue,m,w4(m,Pt,a))&&fe++):Q<m&&fe++);fe<Be;++fe)l.push({value:Math.round((Q+fe*Nt)*ue)/ue});return Mt&&H&&$t!==_?l.length&&zm(l[l.length-1].value,_,w4(_,Pt,a))?l[l.length-1].value=_:l.push({value:_}):(!Mt||$t===_)&&l.push({value:$t}),l}function w4(a,r,{horizontal:l,minRotation:n}){let s=Ia(n),d=(l?Math.sin(s):Math.cos(s))||.001,m=.75*r*(""+a).length;return Math.min(r/d,m)}var $m=class extends Uu{constructor(r){super(r),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(r,l){return Pn(r)||(typeof r=="number"||r instanceof Number)&&!isFinite(+r)?null:+r}handleTickRangeOptions(){let{beginAtZero:r}=this.options,{minDefined:l,maxDefined:n}=this.getUserBounds(),{min:s,max:d}=this,m=w=>s=l?s:w,_=w=>d=n?d:w;if(r){let w=_l(s),S=_l(d);w<0&&S<0?_(0):w>0&&S>0&&m(0)}if(s===d){let w=1;(d>=Number.MAX_SAFE_INTEGER||s<=Number.MIN_SAFE_INTEGER)&&(w=Math.abs(d*.05)),_(d+w),r||m(s-w)}this.min=s,this.max=d}getTickLimit(){let r=this.options.ticks,{maxTicksLimit:l,stepSize:n}=r,s;return n?(s=Math.ceil(this.max/n)-Math.floor(this.min/n)+1,s>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${n} would result generating up to ${s} ticks. Limiting to 1000.`),s=1e3)):(s=this.computeTickLimit(),l=l||11),l&&(s=Math.min(l,s)),s}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){let r=this.options,l=r.ticks,n=this.getTickLimit();n=Math.max(2,n);let s={maxTicks:n,bounds:r.bounds,min:r.min,max:r.max,precision:l.precision,step:l.stepSize,count:l.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:l.minRotation||0,includeBounds:l.includeBounds!==!1},d=this._range||this,m=cnt(s,d);return r.bounds==="ticks"&&VM(m,this,"value"),r.reverse?(m.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),m}configure(){let r=this.ticks,l=this.min,n=this.max;if(super.configure(),this.options.offset&&r.length){let s=(n-l)/Math.max(r.length-1,1)/2;l-=s,n+=s}this._startValue=l,this._endValue=n,this._valueRange=n-l}getLabelForValue(r){return jm(r,this.chart.options.locale,this.options.ticks.format)}},Vg=class extends $m{determineDataLimits(){let{min:r,max:l}=this.getMinMax(!0);this.min=go(r)?r:0,this.max=go(l)?l:1,this.handleTickRangeOptions()}computeTickLimit(){let r=this.isHorizontal(),l=r?this.width:this.height,n=Ia(this.options.ticks.minRotation),s=(r?Math.sin(n):Math.cos(n))||.001,d=this._resolveTickFontOptions(0);return Math.ceil(l/Math.min(40,d.lineHeight/s))}getPixelForValue(r){return r===null?NaN:this.getPixelForDecimal((r-this._startValue)/this._valueRange)}getValueForPixel(r){return this._startValue+this.getDecimalForPixel(r)*this._valueRange}};Vg.id="linear";Vg.defaults={ticks:{callback:Tb.formatters.numeric}};function C4(a){return a/Math.pow(10,Math.floor(ea(a)))===1}function dnt(a,r){let l=Math.floor(ea(r.max)),n=Math.ceil(r.max/Math.pow(10,l)),s=[],d=ta(a.min,Math.pow(10,Math.floor(ea(r.min)))),m=Math.floor(ea(d)),_=Math.floor(d/Math.pow(10,m)),w=m<0?Math.pow(10,Math.abs(m)):1;do s.push({value:d,major:C4(d)}),++_,_===10&&(_=1,++m,w=m>=0?1:w),d=Math.round(_*Math.pow(10,m)*w)/w;while(m<l||m===l&&_<n);let S=ta(a.max,d);return s.push({value:S,major:C4(d)}),s}var jg=class extends Uu{constructor(r){super(r),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(r,l){let n=$m.prototype.parse.apply(this,[r,l]);if(n===0){this._zero=!0;return}return go(n)&&n>0?n:null}determineDataLimits(){let{min:r,max:l}=this.getMinMax(!0);this.min=go(r)?Math.max(0,r):null,this.max=go(l)?Math.max(0,l):null,this.options.beginAtZero&&(this._zero=!0),this.handleTickRangeOptions()}handleTickRangeOptions(){let{minDefined:r,maxDefined:l}=this.getUserBounds(),n=this.min,s=this.max,d=w=>n=r?n:w,m=w=>s=l?s:w,_=(w,S)=>Math.pow(10,Math.floor(ea(w))+S);n===s&&(n<=0?(d(1),m(10)):(d(_(n,-1)),m(_(s,1)))),n<=0&&d(_(s,-1)),s<=0&&m(_(n,1)),this._zero&&this.min!==this._suggestedMin&&n===_(this.min,0)&&d(_(n,-1)),this.min=n,this.max=s}buildTicks(){let r=this.options,l={min:this._userMin,max:this._userMax},n=dnt(l,this);return r.bounds==="ticks"&&VM(n,this,"value"),r.reverse?(n.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),n}getLabelForValue(r){return r===void 0?"0":jm(r,this.chart.options.locale,this.options.ticks.format)}configure(){let r=this.min;super.configure(),this._startValue=ea(r),this._valueRange=ea(this.max)-ea(r)}getPixelForValue(r){return(r===void 0||r===0)&&(r=this.min),r===null||isNaN(r)?NaN:this.getPixelForDecimal(r===this.min?0:(ea(r)-this._startValue)/this._valueRange)}getValueForPixel(r){let l=this.getDecimalForPixel(r);return Math.pow(10,this._startValue+l*this._valueRange)}};jg.id="logarithmic";jg.defaults={ticks:{callback:Tb.formatters.logarithmic,major:{enabled:!0}}};function OD(a){let r=a.ticks;if(r.display&&a.display){let l=Jo(r.backdropPadding);return nn(r.font&&r.font.size,xn.font.size)+l.height}return 0}function unt(a,r,l){return l=kr(l)?l:[l],{w:wB(a,r.string,l),h:l.length*r.lineHeight}}function S4(a,r,l,n,s){return a===n||a===s?{start:r-l/2,end:r+l/2}:a<n||a>s?{start:r-l,end:r}:{start:r,end:r+l}}function hnt(a){let r={l:a.left+a._padding.left,r:a.right-a._padding.right,t:a.top+a._padding.top,b:a.bottom-a._padding.bottom},l=Object.assign({},r),n=[],s=[],d=a._pointLabels.length,m=a.options.pointLabels,_=m.centerPointLabels?Ur/d:0;for(let w=0;w<d;w++){let S=m.setContext(a.getPointLabelContext(w));s[w]=S.padding;let T=a.getPointPosition(w,a.drawingArea+s[w],_),L=zo(S.font),H=unt(a.ctx,L,a._pointLabels[w]);n[w]=H;let q=Bs(a.getIndexAngle(w)+_),X=Math.round(sb(q)),it=S4(X,T.x,H.w,0,180),at=S4(X,T.y,H.h,90,270);mnt(l,r,q,it,at)}a.setCenterPoint(r.l-l.l,l.r-r.r,r.t-l.t,l.b-r.b),a._pointLabelItems=pnt(a,n,s)}function mnt(a,r,l,n,s){let d=Math.abs(Math.sin(l)),m=Math.abs(Math.cos(l)),_=0,w=0;n.start<r.l?(_=(r.l-n.start)/d,a.l=Math.min(a.l,r.l-_)):n.end>r.r&&(_=(n.end-r.r)/d,a.r=Math.max(a.r,r.r+_)),s.start<r.t?(w=(r.t-s.start)/m,a.t=Math.min(a.t,r.t-w)):s.end>r.b&&(w=(s.end-r.b)/m,a.b=Math.max(a.b,r.b+w))}function pnt(a,r,l){let n=[],s=a._pointLabels.length,d=a.options,m=OD(d)/2,_=a.drawingArea,w=d.pointLabels.centerPointLabels?Ur/s:0;for(let S=0;S<s;S++){let T=a.getPointPosition(S,_+m+l[S],w),L=Math.round(sb(Bs(T.angle+ao))),H=r[S],q=_nt(T.y,H.h,L),X=fnt(L),it=gnt(T.x,H.w,X);n.push({x:T.x,y:q,textAlign:X,left:it,top:q,right:it+H.w,bottom:q+H.h})}return n}function fnt(a){return a===0||a===180?"center":a<180?"left":"right"}function gnt(a,r,l){return l==="right"?a-=r:l==="center"&&(a-=r/2),a}function _nt(a,r,l){return l===90||l===270?a-=r/2:(l>270||l<90)&&(a-=r),a}function vnt(a,r){let{ctx:l,options:{pointLabels:n}}=a;for(let s=r-1;s>=0;s--){let d=n.setContext(a.getPointLabelContext(s)),m=zo(d.font),{x:_,y:w,textAlign:S,left:T,top:L,right:H,bottom:q}=a._pointLabelItems[s],{backdropColor:X}=d;if(!Pn(X)){let it=kd(d.borderRadius),at=Jo(d.backdropPadding);l.fillStyle=X;let ut=T-at.left,Mt=L-at.top,Lt=H-T+at.width,Pt=q-L+at.height;Object.values(it).some(Nt=>Nt!==0)?(l.beginPath(),Bm(l,{x:ut,y:Mt,w:Lt,h:Pt,radius:it}),l.fill()):l.fillRect(ut,Mt,Lt,Pt)}Ad(l,a._pointLabels[s],_,w+m.lineHeight/2,m,{color:d.color,textAlign:S,textBaseline:"middle"})}}function Y4(a,r,l,n){let{ctx:s}=a;if(l)s.arc(a.xCenter,a.yCenter,r,0,mr);else{let d=a.getPointPosition(0,r);s.moveTo(d.x,d.y);for(let m=1;m<n;m++)d=a.getPointPosition(m,r),s.lineTo(d.x,d.y)}}function ynt(a,r,l,n){let s=a.ctx,d=r.circular,{color:m,lineWidth:_}=r;!d&&!n||!m||!_||l<0||(s.save(),s.strokeStyle=m,s.lineWidth=_,s.setLineDash(r.borderDash),s.lineDashOffset=r.borderDashOffset,s.beginPath(),Y4(a,l,d,n),s.closePath(),s.stroke(),s.restore())}function bnt(a,r,l){return Pc(a,{label:l,index:r,type:"pointLabel"})}var Hu=class extends $m{constructor(r){super(r),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){let r=this._padding=Jo(OD(this.options)/2),l=this.width=this.maxWidth-r.width,n=this.height=this.maxHeight-r.height;this.xCenter=Math.floor(this.left+l/2+r.left),this.yCenter=Math.floor(this.top+n/2+r.top),this.drawingArea=Math.floor(Math.min(l,n)/2)}determineDataLimits(){let{min:r,max:l}=this.getMinMax(!1);this.min=go(r)&&!isNaN(r)?r:0,this.max=go(l)&&!isNaN(l)?l:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/OD(this.options))}generateTickLabels(r){$m.prototype.generateTickLabels.call(this,r),this._pointLabels=this.getLabels().map((l,n)=>{let s=Rr(this.options.pointLabels.callback,[l,n],this);return s||s===0?s:""}).filter((l,n)=>this.chart.getDataVisibility(n))}fit(){let r=this.options;r.display&&r.pointLabels.display?hnt(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(r,l,n,s){this.xCenter+=Math.floor((r-l)/2),this.yCenter+=Math.floor((n-s)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(r,l,n,s))}getIndexAngle(r){let l=mr/(this._pointLabels.length||1),n=this.options.startAngle||0;return Bs(r*l+Ia(n))}getDistanceFromCenterForValue(r){if(Pn(r))return NaN;let l=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-r)*l:(r-this.min)*l}getValueForDistanceFromCenter(r){if(Pn(r))return NaN;let l=r/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-l:this.min+l}getPointLabelContext(r){let l=this._pointLabels||[];if(r>=0&&r<l.length){let n=l[r];return bnt(this.getContext(),r,n)}}getPointPosition(r,l,n=0){let s=this.getIndexAngle(r)-ao+n;return{x:Math.cos(s)*l+this.xCenter,y:Math.sin(s)*l+this.yCenter,angle:s}}getPointPositionForValue(r,l){return this.getPointPosition(r,this.getDistanceFromCenterForValue(l))}getBasePosition(r){return this.getPointPositionForValue(r||0,this.getBaseValue())}getPointLabelPosition(r){let{left:l,top:n,right:s,bottom:d}=this._pointLabelItems[r];return{left:l,top:n,right:s,bottom:d}}drawBackground(){let{backgroundColor:r,grid:{circular:l}}=this.options;if(r){let n=this.ctx;n.save(),n.beginPath(),Y4(this,this.getDistanceFromCenterForValue(this._endValue),l,this._pointLabels.length),n.closePath(),n.fillStyle=r,n.fill(),n.restore()}}drawGrid(){let r=this.ctx,l=this.options,{angleLines:n,grid:s}=l,d=this._pointLabels.length,m,_,w;if(l.pointLabels.display&&vnt(this,d),s.display&&this.ticks.forEach((S,T)=>{if(T!==0){_=this.getDistanceFromCenterForValue(S.value);let L=s.setContext(this.getContext(T-1));ynt(this,L,_,d)}}),n.display){for(r.save(),m=d-1;m>=0;m--){let S=n.setContext(this.getPointLabelContext(m)),{color:T,lineWidth:L}=S;!L||!T||(r.lineWidth=L,r.strokeStyle=T,r.setLineDash(S.borderDash),r.lineDashOffset=S.borderDashOffset,_=this.getDistanceFromCenterForValue(l.ticks.reverse?this.min:this.max),w=this.getPointPosition(m,_),r.beginPath(),r.moveTo(this.xCenter,this.yCenter),r.lineTo(w.x,w.y),r.stroke())}r.restore()}}drawBorder(){}drawLabels(){let r=this.ctx,l=this.options,n=l.ticks;if(!n.display)return;let s=this.getIndexAngle(0),d,m;r.save(),r.translate(this.xCenter,this.yCenter),r.rotate(s),r.textAlign="center",r.textBaseline="middle",this.ticks.forEach((_,w)=>{if(w===0&&!l.reverse)return;let S=n.setContext(this.getContext(w)),T=zo(S.font);if(d=this.getDistanceFromCenterForValue(this.ticks[w].value),S.showLabelBackdrop){r.font=T.string,m=r.measureText(_.label).width,r.fillStyle=S.backdropColor;let L=Jo(S.backdropPadding);r.fillRect(-m/2-L.left,-d-T.size/2-L.top,m+L.width,T.size+L.height)}Ad(r,_.label,0,-d,T,{color:S.color})}),r.restore()}drawTitle(){}};Hu.id="radialLinear";Hu.defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Tb.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(a){return a},padding:5,centerPointLabels:!1}};Hu.defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};Hu.descriptors={angleLines:{_fallback:"grid"}};var Ab={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Vs=Object.keys(Ab);function xnt(a,r){return a-r}function E4(a,r){if(Pn(r))return null;let l=a._adapter,{parser:n,round:s,isoWeekday:d}=a._parseOpts,m=r;return typeof n=="function"&&(m=n(m)),go(m)||(m=typeof n=="string"?l.parse(m,n):l.parse(m)),m===null?null:(s&&(m=s==="week"&&(Bu(d)||d===!0)?l.startOf(m,"isoWeek",d):l.startOf(m,s)),+m)}function M4(a,r,l,n){let s=Vs.length;for(let d=Vs.indexOf(a);d<s-1;++d){let m=Ab[Vs[d]],_=m.steps?m.steps:Number.MAX_SAFE_INTEGER;if(m.common&&Math.ceil((l-r)/(_*m.size))<=n)return Vs[d]}return Vs[s-1]}function wnt(a,r,l,n,s){for(let d=Vs.length-1;d>=Vs.indexOf(l);d--){let m=Vs[d];if(Ab[m].common&&a._adapter.diff(s,n,m)>=r-1)return m}return Vs[l?Vs.indexOf(l):0]}function Cnt(a){for(let r=Vs.indexOf(a)+1,l=Vs.length;r<l;++r)if(Ab[Vs[r]].common)return Vs[r]}function D4(a,r,l){if(!l)a[r]=!0;else if(l.length){let{lo:n,hi:s}=ab(l,r),d=l[n]>=r?l[n]:l[s];a[d]=!0}}function Snt(a,r,l,n){let s=a._adapter,d=+s.startOf(r[0].value,n),m=r[r.length-1].value,_,w;for(_=d;_<=m;_=+s.add(_,1,n))w=l[_],w>=0&&(r[w].major=!0);return r}function T4(a,r,l){let n=[],s={},d=r.length,m,_;for(m=0;m<d;++m)_=r[m],s[_]=m,n.push({value:_,major:!1});return d===0||!l?n:Snt(a,n,s,l)}var LD=(()=>{class a extends Uu{constructor(l){super(l),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(l,n){let s=l.time||(l.time={}),d=this._adapter=new het._date(l.adapters.date);d.init(n),Lm(s.displayFormats,d.formats()),this._parseOpts={parser:s.parser,round:s.round,isoWeekday:s.isoWeekday},super.init(l),this._normalized=n.normalized}parse(l,n){return l===void 0?null:E4(this,l)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){let l=this.options,n=this._adapter,s=l.time.unit||"day",{min:d,max:m,minDefined:_,maxDefined:w}=this.getUserBounds();function S(T){!_&&!isNaN(T.min)&&(d=Math.min(d,T.min)),!w&&!isNaN(T.max)&&(m=Math.max(m,T.max))}(!_||!w)&&(S(this._getLabelBounds()),(l.bounds!=="ticks"||l.ticks.source!=="labels")&&S(this.getMinMax(!1))),d=go(d)&&!isNaN(d)?d:+n.startOf(Date.now(),s),m=go(m)&&!isNaN(m)?m:+n.endOf(Date.now(),s)+1,this.min=Math.min(d,m-1),this.max=Math.max(d+1,m)}_getLabelBounds(){let l=this.getLabelTimestamps(),n=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;return l.length&&(n=l[0],s=l[l.length-1]),{min:n,max:s}}buildTicks(){let l=this.options,n=l.time,s=l.ticks,d=s.source==="labels"?this.getLabelTimestamps():this._generate();l.bounds==="ticks"&&d.length&&(this.min=this._userMin||d[0],this.max=this._userMax||d[d.length-1]);let m=this.min,_=this.max,w=hB(d,m,_);return this._unit=n.unit||(s.autoSkip?M4(n.minUnit,this.min,this.max,this._getLabelCapacity(m)):wnt(this,w.length,n.minUnit,this.min,this.max)),this._majorUnit=!s.major.enabled||this._unit==="year"?void 0:Cnt(this._unit),this.initOffsets(d),l.reverse&&w.reverse(),T4(this,w,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(l=>+l.value))}initOffsets(l){let n=0,s=0,d,m;this.options.offset&&l.length&&(d=this.getDecimalForValue(l[0]),l.length===1?n=1-d:n=(this.getDecimalForValue(l[1])-d)/2,m=this.getDecimalForValue(l[l.length-1]),l.length===1?s=m:s=(m-this.getDecimalForValue(l[l.length-2]))/2);let _=l.length<3?.5:.25;n=Uo(n,0,_),s=Uo(s,0,_),this._offsets={start:n,end:s,factor:1/(n+1+s)}}_generate(){let l=this._adapter,n=this.min,s=this.max,d=this.options,m=d.time,_=m.unit||M4(m.minUnit,n,s,this._getLabelCapacity(n)),w=nn(m.stepSize,1),S=_==="week"?m.isoWeekday:!1,T=Bu(S)||S===!0,L={},H=n,q,X;if(T&&(H=+l.startOf(H,"isoWeek",S)),H=+l.startOf(H,T?"day":_),l.diff(s,n,_)>1e5*w)throw new Error(n+" and "+s+" are too far apart with stepSize of "+w+" "+_);let it=d.ticks.source==="data"&&this.getDataTimestamps();for(q=H,X=0;q<s;q=+l.add(q,w,_),X++)D4(L,q,it);return(q===s||d.bounds==="ticks"||X===1)&&D4(L,q,it),Object.keys(L).sort((at,ut)=>at-ut).map(at=>+at)}getLabelForValue(l){let n=this._adapter,s=this.options.time;return s.tooltipFormat?n.format(l,s.tooltipFormat):n.format(l,s.displayFormats.datetime)}_tickFormatFunction(l,n,s,d){let m=this.options,_=m.time.displayFormats,w=this._unit,S=this._majorUnit,T=w&&_[w],L=S&&_[S],H=s[n],q=S&&L&&H&&H.major,X=this._adapter.format(l,d||(q?L:T)),it=m.ticks.callback;return it?Rr(it,[X,n,s],this):X}generateTickLabels(l){let n,s,d;for(n=0,s=l.length;n<s;++n)d=l[n],d.label=this._tickFormatFunction(d.value,n,l)}getDecimalForValue(l){return l===null?NaN:(l-this.min)/(this.max-this.min)}getPixelForValue(l){let n=this._offsets,s=this.getDecimalForValue(l);return this.getPixelForDecimal((n.start+s)*n.factor)}getValueForPixel(l){let n=this._offsets,s=this.getDecimalForPixel(l)/n.factor-n.end;return this.min+s*(this.max-this.min)}_getLabelSize(l){let n=this.options.ticks,s=this.ctx.measureText(l).width,d=Ia(this.isHorizontal()?n.maxRotation:n.minRotation),m=Math.cos(d),_=Math.sin(d),w=this._resolveTickFontOptions(0).size;return{w:s*m+w*_,h:s*_+w*m}}_getLabelCapacity(l){let n=this.options.time,s=n.displayFormats,d=s[n.unit]||s.millisecond,m=this._tickFormatFunction(l,0,T4(this,[l],this._majorUnit),d),_=this._getLabelSize(m),w=Math.floor(this.isHorizontal()?this.width/_.w:this.height/_.h)-1;return w>0?w:1}getDataTimestamps(){let l=this._cache.data||[],n,s;if(l.length)return l;let d=this.getMatchingVisibleMetas();if(this._normalized&&d.length)return this._cache.data=d[0].controller.getAllParsedValues(this);for(n=0,s=d.length;n<s;++n)l=l.concat(d[n].controller.getAllParsedValues(this));return this._cache.data=this.normalize(l)}getLabelTimestamps(){let l=this._cache.labels||[],n,s;if(l.length)return l;let d=this.getLabels();for(n=0,s=d.length;n<s;++n)l.push(E4(this,d[n]));return this._cache.labels=this._normalized?l:this.normalize(l)}normalize(l){return GM(l.sort(xnt))}}return a.id="time",a.defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",major:{enabled:!1}}},a})();function bb(a,r,l){let n=0,s=a.length-1,d,m,_,w;l?(r>=a[n].pos&&r<=a[s].pos&&({lo:n,hi:s}=ql(a,"pos",r)),{pos:d,time:_}=a[n],{pos:m,time:w}=a[s]):(r>=a[n].time&&r<=a[s].time&&({lo:n,hi:s}=ql(a,"time",r)),{time:d,pos:_}=a[n],{time:m,pos:w}=a[s]);let S=m-d;return S?_+(w-_)*(r-d)/S:_}var Ug=class extends LD{constructor(r){super(r),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){let r=this._getTimestampsForTable(),l=this._table=this.buildLookupTable(r);this._minPos=bb(l,this.min),this._tableRange=bb(l,this.max)-this._minPos,super.initOffsets(r)}buildLookupTable(r){let{min:l,max:n}=this,s=[],d=[],m,_,w,S,T;for(m=0,_=r.length;m<_;++m)S=r[m],S>=l&&S<=n&&s.push(S);if(s.length<2)return[{time:l,pos:0},{time:n,pos:1}];for(m=0,_=s.length;m<_;++m)T=s[m+1],w=s[m-1],S=s[m],Math.round((T+w)/2)!==S&&d.push({time:S,pos:m/(_-1)});return d}_getTimestampsForTable(){let r=this._cache.all||[];if(r.length)return r;let l=this.getDataTimestamps(),n=this.getLabelTimestamps();return l.length&&n.length?r=this.normalize(l.concat(n)):r=l.length?l:n,r=this._cache.all=r,r}getDecimalForValue(r){return(bb(this._table,r)-this._minPos)/this._tableRange}getValueForPixel(r){let l=this._offsets,n=this.getDecimalForPixel(r)/l.factor-l.end;return bb(this._table,n*this._tableRange+this._minPos,!0)}};Ug.id="timeseries";Ug.defaults=LD.defaults;var Ent=Object.freeze({__proto__:null,CategoryScale:Wm,LinearScale:Vg,LogarithmicScale:jg,RadialLinearScale:Hu,TimeScale:LD,TimeSeriesScale:Ug}),Z4=[det,bit,ont,Ent];var X4=(()=>{let r=class r{constructor(n,s){this.http=n,this.jwtHandler=s}fetchStatistics(n){return this.http.get(Me+"/statistics/"+n,{headers:{Authorization:"Bearer "+this.jwtHandler.getToken()}})}};r.\u0275fac=function(s){return new(s||r)(ht(Gi),ht(Cy))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function Dnt(a,r){if(a&1&&(A(0,"div",22)(1,"div",23)(2,"div",24)(3,"strong"),V(4),k()(),A(5,"div",25)(6,"strong"),V(7),k()()()()),a&2){let l=r.$implicit;N(4),De(l.title),N(3),De(l.value)}}Xl.register(...Z4);var K4=(()=>{let r=class r{constructor(n){this.statisticsService=n,this.filter="all",this.statistics={},this.predefinedColors=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf","#aec7e8","#ffbb78","#98df8a","#ff9896","#c5b0d5","#c49c94","#f7b6d2","#c7c7c7","#dbdb8d","#9edae5"],this.locationsColors=[],this.cardStatistics=[]}ngOnInit(){this.statisticsService.fetchStatistics(this.filter).subscribe(n=>{this.statistics=n,this.locationsColors=this.statistics.locationsWithAllEventsCount.map(s=>({[s.location.name]:this.predefinedColors.pop()})),this.setCardStatistics(),this.locationWithAllEventsChart=this.drawLocationsChart(this.statistics.locationsWithAllEventsCount,"location-with-all-events-chart"),this.locationWithAvailableEventsChart=this.drawLocationsChart(this.statistics.locationsWithAvailableEventsCount,"location-with-available-events-chart"),this.eventsWithTicketsSoldChart=this.drawEventsChart(this.statistics.eventsWithTicketsSoldCount,"events-with-most-tickets-sold-chart")})}setCardStatistics(){this.cardStatistics=[{title:"Numarul total de utilizatori adaugati",value:this.statistics.totalNumberOfUsers},{title:"Numarul total de comenzi confirmate efectuate",value:this.statistics.totalNumberOfConfirmedOrders},{title:"Numarul total de bilete vandute",value:this.statistics.totalNumberOfConfirmedTicketsSold},{title:"Incasari",value:this.statistics.totalRevenue+" RON"},{title:"Numarul total de locatii adaugate",value:this.statistics.totalNumberOfLocations},{title:"Numarul total de evenimente adaugate",value:this.statistics.totalNumberOfEvents},{title:"Numarul total de evenimente adaugate disponibile",value:this.statistics.totalNumberOfAvailableEvents}]}drawLocationsChart(n,s){return new Xl(s,{type:"bar",data:{labels:n.map(d=>d.location.name),datasets:[{data:n.map(d=>d.eventsCount),borderWidth:1,backgroundColor:n.map(d=>{let m=this.locationsColors.find(_=>_.hasOwnProperty(d.location.name));return m?m[d.location.name]:""})}]},options:{scales:{y:{beginAtZero:!0}},plugins:{legend:{display:!1}}}})}drawEventsChart(n,s){return new Xl(s,{type:"bar",data:{labels:n.map(d=>d.event.title),datasets:[{data:n.map(d=>d.ticketsSoldCount),borderWidth:1,backgroundColor:this.predefinedColors}]},options:{scales:{y:{beginAtZero:!0}},plugins:{legend:{display:!1}}}})}refreshStatistics(){this.statisticsService.fetchStatistics(this.filter).subscribe(n=>{this.statistics=n,console.log(this.statistics),this.setCardStatistics(),this.updateLocationsChart(this.locationWithAllEventsChart,this.statistics.locationsWithAllEventsCount),this.updateLocationsChart(this.locationWithAvailableEventsChart,this.statistics.locationsWithAvailableEventsCount),this.updateEventsChart(this.eventsWithTicketsSoldChart,this.statistics.eventsWithTicketsSoldCount)})}updateLocationsChart(n,s){n.data.labels=s.map(d=>d.location.name),n.data.datasets[0].data=s.map(d=>d.eventsCount),n.update()}updateEventsChart(n,s){n.data.labels=s.map(d=>d.event.title),n.data.datasets[0].data=s.map(d=>d.ticketsSoldCount),n.update()}};r.\u0275fac=function(s){return new(s||r)(B(X4))},r.\u0275cmp=Et({type:r,selectors:[["app-statistics"]],standalone:!0,features:[At],decls:38,vars:2,consts:[[1,"container-fluid"],[1,"text-center","pt-2","pb-4"],[1,"mb-3"],["for","filter",1,"form-label"],["id","filter","name","filter",1,"form-select",3,"ngModel","ngModelChange","change"],["value","all"],["value","last-day"],["value","last-week"],["value","last-month"],["value","last-3months"],["value","last-year"],[1,"d-flex","justify-content-center","align-items-center"],[1,"row","row-cols-1","row-cols-sm-2","row-cols-md-3","row-cols-lg-4"],["class","col-lg-4",4,"ngFor","ngForOf"],[1,"pt-3","pb-3"],[1,"charts-container"],[1,"row"],[1,"col-md-6","stat"],[1,"text-center"],["id","location-with-all-events-chart","width","400","height","250"],["id","location-with-available-events-chart","width","400","height","250"],["id","events-with-most-tickets-sold-chart","width","400","height","250"],[1,"col-lg-4"],[1,"card","mb-4","stat"],[1,"card-header","d-flex","text-center","justify-content-center","align-items-center"],[1,"card-text","d-flex","justify-content-center","align-items-center"]],template:function(s,d){s&1&&(A(0,"div",0)(1,"h1",1),V(2,"Statistici"),k(),A(3,"div",2)(4,"label",3),V(5,"Filter"),k(),A(6,"select",4),kn("ngModelChange",function(_){return An(d.filter,_)||(d.filter=_),_}),ct("change",function(){return d.refreshStatistics()}),A(7,"option",5),V(8,"Toate"),k(),A(9,"option",6),V(10,"Ultima zi"),k(),A(11,"option",7),V(12,"Ultima saptamana"),k(),A(13,"option",8),V(14,"Ultima luna"),k(),A(15,"option",9),V(16,"Ultimele 3 luni"),k(),A(17,"option",10),V(18,"Ultimul an"),k()()(),A(19,"div",11)(20,"div",12),mt(21,Dnt,8,2,"div",13),k()(),dt(22,"hr",14),A(23,"div",15)(24,"div",16)(25,"div",17)(26,"h3",18),V(27,"Locatii si numarul total de evenimente adaugate"),k(),dt(28,"canvas",19),k(),A(29,"div",17)(30,"h3",18),V(31,"Locatii si numarul de evenimente adaugate disponibile"),k(),dt(32,"canvas",20),k()(),A(33,"div",16)(34,"div",17)(35,"h3",18),V(36,"Evenimente cu cele mai multe bilete vandute"),k(),dt(37,"canvas",21),k()()()()),s&2&&(N(6),In("ngModel",d.filter),N(15),Z("ngForOf",d.cardStatistics))},dependencies:[Ii,Rn,Ca,Sa,wa,ji,Yi,jo],styles:[".container-fluid[_ngcontent-%COMP%]{padding-bottom:20px;padding-right:20px}.card[_ngcontent-%COMP%]{max-width:500px;height:150px}.card-header[_ngcontent-%COMP%]{position:relative;font-size:20px}.card-text[_ngcontent-%COMP%]{height:200px;position:relative}.stat[_ngcontent-%COMP%]{padding:5px}.stat[_ngcontent-%COMP%]:hover{box-shadow:0 0 10px #0003;transition:.3s}select[_ngcontent-%COMP%]{width:200px}"]});let a=r;return a})();var Q4=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=Et({type:r,selectors:[["app-settings"]],standalone:!0,features:[At],decls:2,vars:0,template:function(s,d){s&1&&(A(0,"p"),V(1,"settings works!"),k())}});let a=r;return a})();function Int(a,r){a&1&&Ti(0,2)}function Ant(a,r){a&1&&(A(0,"thead",0),ks(1,1),k(),A(2,"tbody",0),ks(3,2)(4,3),k(),A(5,"tfoot",0),ks(6,4),k())}function knt(a,r){a&1&&ks(0,1)(1,2)(2,3)(3,4)}var Rnt=[[["caption"]],[["colgroup"],["col"]],"*"],Pnt=["caption","colgroup, col","*"];function jD(a){return class extends a{get sticky(){return this._sticky}set sticky(r){let l=this._sticky;this._sticky=ro(r),this._hasStickyChanged=l!==this._sticky}hasStickyChanged(){let r=this._hasStickyChanged;return this._hasStickyChanged=!1,r}resetStickyChanged(){this._hasStickyChanged=!1}constructor(...r){super(...r),this._sticky=!1,this._hasStickyChanged=!1}}}var vl=new we("CDK_TABLE");var Lb=(()=>{let r=class r{constructor(n){this.template=n}};r.\u0275fac=function(s){return new(s||r)(B(Eo))},r.\u0275dir=re({type:r,selectors:[["","cdkCellDef",""]],standalone:!0});let a=r;return a})(),zb=(()=>{let r=class r{constructor(n){this.template=n}};r.\u0275fac=function(s){return new(s||r)(B(Eo))},r.\u0275dir=re({type:r,selectors:[["","cdkHeaderCellDef",""]],standalone:!0});let a=r;return a})(),e5=(()=>{let r=class r{constructor(n){this.template=n}};r.\u0275fac=function(s){return new(s||r)(B(Eo))},r.\u0275dir=re({type:r,selectors:[["","cdkFooterCellDef",""]],standalone:!0});let a=r;return a})(),zD=class{},Ont=jD(zD),Ym=(()=>{let r=class r extends Ont{get name(){return this._name}set name(n){this._setNameInput(n)}get stickyEnd(){return this._stickyEnd}set stickyEnd(n){n!==this._stickyEnd&&(this._stickyEnd=n,this._hasStickyChanged=!0)}constructor(n){super(),this._table=n,this._stickyEnd=!1}_updateColumnCssClassName(){this._columnCssClassName=[`cdk-column-${this.cssClassFriendlyName}`]}_setNameInput(n){n&&(this._name=n,this.cssClassFriendlyName=n.replace(/[^a-z0-9_-]/gi,"-"),this._updateColumnCssClassName())}};r.\u0275fac=function(s){return new(s||r)(B(vl,8))},r.\u0275dir=re({type:r,selectors:[["","cdkColumnDef",""]],contentQueries:function(s,d,m){if(s&1&&(mn(m,Lb,5),mn(m,zb,5),mn(m,e5,5)),s&2){let _;ce(_=de())&&(d.cell=_.first),ce(_=de())&&(d.headerCell=_.first),ce(_=de())&&(d.footerCell=_.first)}},inputs:{sticky:"sticky",name:[Rt.None,"cdkColumnDef","name"],stickyEnd:[Rt.HasDecoratorInputTransform,"stickyEnd","stickyEnd",Qe]},standalone:!0,features:[Ni([{provide:"MAT_SORT_HEADER_COLUMN_DEF",useExisting:r}]),Tn,Si]});let a=r;return a})(),Rb=class{constructor(r,l){l.nativeElement.classList.add(...r._columnCssClassName)}},i5=(()=>{let r=class r extends Rb{constructor(n,s){super(n,s)}};r.\u0275fac=function(s){return new(s||r)(B(Ym),B(Se))},r.\u0275dir=re({type:r,selectors:[["cdk-header-cell"],["th","cdk-header-cell",""]],hostAttrs:["role","columnheader",1,"cdk-header-cell"],standalone:!0,features:[Si]});let a=r;return a})();var n5=(()=>{let r=class r extends Rb{constructor(n,s){super(n,s);let d=n._table?._getCellRole();d&&s.nativeElement.setAttribute("role",d)}};r.\u0275fac=function(s){return new(s||r)(B(Ym),B(Se))},r.\u0275dir=re({type:r,selectors:[["cdk-cell"],["td","cdk-cell",""]],hostAttrs:[1,"cdk-cell"],standalone:!0,features:[Si]});let a=r;return a})(),Pb=class{constructor(){this.tasks=[],this.endTasks=[]}},Ob=new we("_COALESCED_STYLE_SCHEDULER"),UD=(()=>{let r=class r{constructor(n){this._ngZone=n,this._currentSchedule=null,this._destroyed=new pe}schedule(n){this._createScheduleIfNeeded(),this._currentSchedule.tasks.push(n)}scheduleEnd(n){this._createScheduleIfNeeded(),this._currentSchedule.endTasks.push(n)}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}_createScheduleIfNeeded(){this._currentSchedule||(this._currentSchedule=new Pb,this._getScheduleObservable().pipe(ri(this._destroyed)).subscribe(()=>{for(;this._currentSchedule.tasks.length||this._currentSchedule.endTasks.length;){let n=this._currentSchedule;this._currentSchedule=new Pb;for(let s of n.tasks)s();for(let s of n.endTasks)s()}this._currentSchedule=null}))}_getScheduleObservable(){return this._ngZone.isStable?Ro(Promise.resolve(void 0)):this._ngZone.onStable.pipe(Ji(1))}};r.\u0275fac=function(s){return new(s||r)(ht(ze))},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})();var HD=(()=>{let r=class r{constructor(n,s){this.template=n,this._differs=s}ngOnChanges(n){if(!this._columnsDiffer){let s=n.columns&&n.columns.currentValue||[];this._columnsDiffer=this._differs.find(s).create(),this._columnsDiffer.diff(s)}}getColumnsDiff(){return this._columnsDiffer.diff(this.columns)}extractCellTemplate(n){return this instanceof Gg?n.headerCell.template:this instanceof GD?n.footerCell.template:n.cell.template}};r.\u0275fac=function(s){return new(s||r)(B(Eo),B(xu))},r.\u0275dir=re({type:r,features:[qn]});let a=r;return a})(),ND=class extends HD{},Fnt=jD(ND),Gg=(()=>{let r=class r extends Fnt{constructor(n,s,d){super(n,s),this._table=d}ngOnChanges(n){super.ngOnChanges(n)}};r.\u0275fac=function(s){return new(s||r)(B(Eo),B(xu),B(vl,8))},r.\u0275dir=re({type:r,selectors:[["","cdkHeaderRowDef",""]],inputs:{columns:[Rt.None,"cdkHeaderRowDef","columns"],sticky:[Rt.None,"cdkHeaderRowDefSticky","sticky"]},standalone:!0,features:[Si,qn]});let a=r;return a})(),BD=class extends HD{},Lnt=jD(BD),GD=(()=>{let r=class r extends Lnt{constructor(n,s,d){super(n,s),this._table=d}ngOnChanges(n){super.ngOnChanges(n)}};r.\u0275fac=function(s){return new(s||r)(B(Eo),B(xu),B(vl,8))},r.\u0275dir=re({type:r,selectors:[["","cdkFooterRowDef",""]],inputs:{columns:[Rt.None,"cdkFooterRowDef","columns"],sticky:[Rt.None,"cdkFooterRowDefSticky","sticky"]},standalone:!0,features:[Si,qn]});let a=r;return a})(),Nb=(()=>{let r=class r extends HD{constructor(n,s,d){super(n,s),this._table=d}};r.\u0275fac=function(s){return new(s||r)(B(Eo),B(xu),B(vl,8))},r.\u0275dir=re({type:r,selectors:[["","cdkRowDef",""]],inputs:{columns:[Rt.None,"cdkRowDefColumns","columns"],when:[Rt.None,"cdkRowDefWhen","when"]},standalone:!0,features:[Si]});let a=r;return a})(),Gu=(()=>{let r=class r{constructor(n){this._viewContainer=n,r.mostRecentCellOutlet=this}ngOnDestroy(){r.mostRecentCellOutlet===this&&(r.mostRecentCellOutlet=null)}};r.mostRecentCellOutlet=null,r.\u0275fac=function(s){return new(s||r)(B(Mo))},r.\u0275dir=re({type:r,selectors:[["","cdkCellOutlet",""]],standalone:!0});let a=r;return a})(),qD=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=Et({type:r,selectors:[["cdk-header-row"],["tr","cdk-header-row",""]],hostAttrs:["role","row",1,"cdk-header-row"],standalone:!0,features:[At],decls:1,vars:0,consts:[["cdkCellOutlet",""]],template:function(s,d){s&1&&ks(0,0)},dependencies:[Gu],encapsulation:2});let a=r;return a})();var WD=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=Et({type:r,selectors:[["cdk-row"],["tr","cdk-row",""]],hostAttrs:["role","row",1,"cdk-row"],standalone:!0,features:[At],decls:1,vars:0,consts:[["cdkCellOutlet",""]],template:function(s,d){s&1&&ks(0,0)},dependencies:[Gu],encapsulation:2});let a=r;return a})(),r5=(()=>{let r=class r{constructor(n){this.templateRef=n,this._contentClassName="cdk-no-data-row"}};r.\u0275fac=function(s){return new(s||r)(B(Eo))},r.\u0275dir=re({type:r,selectors:[["ng-template","cdkNoDataRow",""]],standalone:!0});let a=r;return a})(),J4=["top","bottom","left","right"],VD=class{constructor(r,l,n,s,d=!0,m=!0,_){this._isNativeHtmlTable=r,this._stickCellCss=l,this.direction=n,this._coalescedStyleScheduler=s,this._isBrowser=d,this._needsPositionStickyOnElement=m,this._positionListener=_,this._cachedCellWidths=[],this._borderCellCss={top:`${l}-border-elem-top`,bottom:`${l}-border-elem-bottom`,left:`${l}-border-elem-left`,right:`${l}-border-elem-right`}}clearStickyPositioning(r,l){let n=[];for(let s of r)if(s.nodeType===s.ELEMENT_NODE){n.push(s);for(let d=0;d<s.children.length;d++)n.push(s.children[d])}this._coalescedStyleScheduler.schedule(()=>{for(let s of n)this._removeStickyStyle(s,l)})}updateStickyColumns(r,l,n,s=!0){if(!r.length||!this._isBrowser||!(l.some(d=>d)||n.some(d=>d))){this._positionListener&&(this._positionListener.stickyColumnsUpdated({sizes:[]}),this._positionListener.stickyEndColumnsUpdated({sizes:[]}));return}this._coalescedStyleScheduler.schedule(()=>{let d=r[0],m=d.children.length,_=this._getCellWidths(d,s),w=this._getStickyStartColumnPositions(_,l),S=this._getStickyEndColumnPositions(_,n),T=l.lastIndexOf(!0),L=n.indexOf(!0),H=this.direction==="rtl",q=H?"right":"left",X=H?"left":"right";for(let it of r)for(let at=0;at<m;at++){let ut=it.children[at];l[at]&&this._addStickyStyle(ut,q,w[at],at===T),n[at]&&this._addStickyStyle(ut,X,S[at],at===L)}this._positionListener&&(this._positionListener.stickyColumnsUpdated({sizes:T===-1?[]:_.slice(0,T+1).map((it,at)=>l[at]?it:null)}),this._positionListener.stickyEndColumnsUpdated({sizes:L===-1?[]:_.slice(L).map((it,at)=>n[at+L]?it:null).reverse()}))})}stickRows(r,l,n){this._isBrowser&&this._coalescedStyleScheduler.schedule(()=>{let s=n==="bottom"?r.slice().reverse():r,d=n==="bottom"?l.slice().reverse():l,m=[],_=[],w=[];for(let T=0,L=0;T<s.length;T++){if(!d[T])continue;m[T]=L;let H=s[T];w[T]=this._isNativeHtmlTable?Array.from(H.children):[H];let q=H.getBoundingClientRect().height;L+=q,_[T]=q}let S=d.lastIndexOf(!0);for(let T=0;T<s.length;T++){if(!d[T])continue;let L=m[T],H=T===S;for(let q of w[T])this._addStickyStyle(q,n,L,H)}n==="top"?this._positionListener?.stickyHeaderRowsUpdated({sizes:_,offsets:m,elements:w}):this._positionListener?.stickyFooterRowsUpdated({sizes:_,offsets:m,elements:w})})}updateStickyFooterContainer(r,l){this._isNativeHtmlTable&&this._coalescedStyleScheduler.schedule(()=>{let n=r.querySelector("tfoot");n&&(l.some(s=>!s)?this._removeStickyStyle(n,["bottom"]):this._addStickyStyle(n,"bottom",0,!1))})}_removeStickyStyle(r,l){for(let s of l)r.style[s]="",r.classList.remove(this._borderCellCss[s]);J4.some(s=>l.indexOf(s)===-1&&r.style[s])?r.style.zIndex=this._getCalculatedZIndex(r):(r.style.zIndex="",this._needsPositionStickyOnElement&&(r.style.position=""),r.classList.remove(this._stickCellCss))}_addStickyStyle(r,l,n,s){r.classList.add(this._stickCellCss),s&&r.classList.add(this._borderCellCss[l]),r.style[l]=`${n}px`,r.style.zIndex=this._getCalculatedZIndex(r),this._needsPositionStickyOnElement&&(r.style.cssText+="position: -webkit-sticky; position: sticky; ")}_getCalculatedZIndex(r){let l={top:100,bottom:10,left:1,right:1},n=0;for(let s of J4)r.style[s]&&(n+=l[s]);return n?`${n}`:""}_getCellWidths(r,l=!0){if(!l&&this._cachedCellWidths.length)return this._cachedCellWidths;let n=[],s=r.children;for(let d=0;d<s.length;d++){let m=s[d];n.push(m.getBoundingClientRect().width)}return this._cachedCellWidths=n,n}_getStickyStartColumnPositions(r,l){let n=[],s=0;for(let d=0;d<r.length;d++)l[d]&&(n[d]=s,s+=r[d]);return n}_getStickyEndColumnPositions(r,l){let n=[],s=0;for(let d=r.length;d>0;d--)l[d]&&(n[d]=s,s+=r[d]);return n}};var Fb=new we("CDK_SPL");var $D=(()=>{let r=class r{constructor(n,s){this.viewContainer=n,this.elementRef=s;let d=oe(vl);d._rowOutlet=this,d._outletAssigned()}};r.\u0275fac=function(s){return new(s||r)(B(Mo),B(Se))},r.\u0275dir=re({type:r,selectors:[["","rowOutlet",""]],standalone:!0});let a=r;return a})(),YD=(()=>{let r=class r{constructor(n,s){this.viewContainer=n,this.elementRef=s;let d=oe(vl);d._headerRowOutlet=this,d._outletAssigned()}};r.\u0275fac=function(s){return new(s||r)(B(Mo),B(Se))},r.\u0275dir=re({type:r,selectors:[["","headerRowOutlet",""]],standalone:!0});let a=r;return a})(),ZD=(()=>{let r=class r{constructor(n,s){this.viewContainer=n,this.elementRef=s;let d=oe(vl);d._footerRowOutlet=this,d._outletAssigned()}};r.\u0275fac=function(s){return new(s||r)(B(Mo),B(Se))},r.\u0275dir=re({type:r,selectors:[["","footerRowOutlet",""]],standalone:!0});let a=r;return a})(),XD=(()=>{let r=class r{constructor(n,s){this.viewContainer=n,this.elementRef=s;let d=oe(vl);d._noDataRowOutlet=this,d._outletAssigned()}};r.\u0275fac=function(s){return new(s||r)(B(Mo),B(Se))},r.\u0275dir=re({type:r,selectors:[["","noDataRowOutlet",""]],standalone:!0});let a=r;return a})();var KD=(()=>{let r=class r{_getCellRole(){if(this._cellRoleInternal===void 0){let n=this._elementRef.nativeElement.getAttribute("role"),s=n==="grid"||n==="treegrid"?"gridcell":"cell";this._cellRoleInternal=this._isNativeHtmlTable&&s==="cell"?null:s}return this._cellRoleInternal}get trackBy(){return this._trackByFn}set trackBy(n){this._trackByFn=n}get dataSource(){return this._dataSource}set dataSource(n){this._dataSource!==n&&this._switchDataSource(n)}get multiTemplateDataRows(){return this._multiTemplateDataRows}set multiTemplateDataRows(n){this._multiTemplateDataRows=n,this._rowOutlet&&this._rowOutlet.viewContainer.length&&(this._forceRenderDataRows(),this.updateStickyColumnStyles())}get fixedLayout(){return this._fixedLayout}set fixedLayout(n){this._fixedLayout=n,this._forceRecalculateCellWidths=!0,this._stickyColumnStylesNeedReset=!0}constructor(n,s,d,m,_,w,S,T,L,H,q,X){this._differs=n,this._changeDetectorRef=s,this._elementRef=d,this._dir=_,this._platform=S,this._viewRepeater=T,this._coalescedStyleScheduler=L,this._viewportRuler=H,this._stickyPositioningListener=q,this._ngZone=X,this._onDestroy=new pe,this._columnDefsByName=new Map,this._customColumnDefs=new Set,this._customRowDefs=new Set,this._customHeaderRowDefs=new Set,this._customFooterRowDefs=new Set,this._headerRowDefChanged=!0,this._footerRowDefChanged=!0,this._stickyColumnStylesNeedReset=!0,this._forceRecalculateCellWidths=!0,this._cachedRenderRowsMap=new Map,this.stickyCssClass="cdk-table-sticky",this.needsPositionStickyOnElement=!0,this._isShowingNoDataRow=!1,this._hasAllOutlets=!1,this._hasInitialized=!1,this._cellRoleInternal=void 0,this._multiTemplateDataRows=!1,this._fixedLayout=!1,this.contentChanged=new ye,this.viewChange=new Ze({start:0,end:Number.MAX_VALUE}),m||d.nativeElement.setAttribute("role","table"),this._document=w,this._isServer=!S.isBrowser,this._isNativeHtmlTable=d.nativeElement.nodeName==="TABLE"}ngOnInit(){this._setupStickyStyler(),this._dataDiffer=this._differs.find([]).create((n,s)=>this.trackBy?this.trackBy(s.dataIndex,s.data):s),this._viewportRuler.change().pipe(ri(this._onDestroy)).subscribe(()=>{this._forceRecalculateCellWidths=!0})}ngAfterContentInit(){this._hasInitialized=!0}ngAfterContentChecked(){this._canRender()&&this._render()}ngOnDestroy(){[this._rowOutlet?.viewContainer,this._headerRowOutlet?.viewContainer,this._footerRowOutlet?.viewContainer,this._cachedRenderRowsMap,this._customColumnDefs,this._customRowDefs,this._customHeaderRowDefs,this._customFooterRowDefs,this._columnDefsByName].forEach(n=>{n?.clear()}),this._headerRowDefs=[],this._footerRowDefs=[],this._defaultRowDef=null,this._onDestroy.next(),this._onDestroy.complete(),oy(this.dataSource)&&this.dataSource.disconnect(this)}renderRows(){this._renderRows=this._getAllRenderRows();let n=this._dataDiffer.diff(this._renderRows);if(!n){this._updateNoDataRow(),this.contentChanged.next();return}let s=this._rowOutlet.viewContainer;this._viewRepeater.applyChanges(n,s,(d,m,_)=>this._getEmbeddedViewArgs(d.item,_),d=>d.item.data,d=>{d.operation===pm.INSERTED&&d.context&&this._renderCellTemplateForItem(d.record.item.rowDef,d.context)}),this._updateRowIndexContext(),n.forEachIdentityChange(d=>{let m=s.get(d.currentIndex);m.context.$implicit=d.item.data}),this._updateNoDataRow(),this._ngZone&&ze.isInAngularZone()?this._ngZone.onStable.pipe(Ji(1),ri(this._onDestroy)).subscribe(()=>{this.updateStickyColumnStyles()}):this.updateStickyColumnStyles(),this.contentChanged.next()}addColumnDef(n){this._customColumnDefs.add(n)}removeColumnDef(n){this._customColumnDefs.delete(n)}addRowDef(n){this._customRowDefs.add(n)}removeRowDef(n){this._customRowDefs.delete(n)}addHeaderRowDef(n){this._customHeaderRowDefs.add(n),this._headerRowDefChanged=!0}removeHeaderRowDef(n){this._customHeaderRowDefs.delete(n),this._headerRowDefChanged=!0}addFooterRowDef(n){this._customFooterRowDefs.add(n),this._footerRowDefChanged=!0}removeFooterRowDef(n){this._customFooterRowDefs.delete(n),this._footerRowDefChanged=!0}setNoDataRow(n){this._customNoDataRow=n}updateStickyHeaderRowStyles(){let n=this._getRenderedRows(this._headerRowOutlet);if(this._isNativeHtmlTable){let d=t5(this._headerRowOutlet,"thead");d&&(d.style.display=n.length?"":"none")}let s=this._headerRowDefs.map(d=>d.sticky);this._stickyStyler.clearStickyPositioning(n,["top"]),this._stickyStyler.stickRows(n,s,"top"),this._headerRowDefs.forEach(d=>d.resetStickyChanged())}updateStickyFooterRowStyles(){let n=this._getRenderedRows(this._footerRowOutlet);if(this._isNativeHtmlTable){let d=t5(this._footerRowOutlet,"tfoot");d&&(d.style.display=n.length?"":"none")}let s=this._footerRowDefs.map(d=>d.sticky);this._stickyStyler.clearStickyPositioning(n,["bottom"]),this._stickyStyler.stickRows(n,s,"bottom"),this._stickyStyler.updateStickyFooterContainer(this._elementRef.nativeElement,s),this._footerRowDefs.forEach(d=>d.resetStickyChanged())}updateStickyColumnStyles(){let n=this._getRenderedRows(this._headerRowOutlet),s=this._getRenderedRows(this._rowOutlet),d=this._getRenderedRows(this._footerRowOutlet);(this._isNativeHtmlTable&&!this._fixedLayout||this._stickyColumnStylesNeedReset)&&(this._stickyStyler.clearStickyPositioning([...n,...s,...d],["left","right"]),this._stickyColumnStylesNeedReset=!1),n.forEach((m,_)=>{this._addStickyColumnStyles([m],this._headerRowDefs[_])}),this._rowDefs.forEach(m=>{let _=[];for(let w=0;w<s.length;w++)this._renderRows[w].rowDef===m&&_.push(s[w]);this._addStickyColumnStyles(_,m)}),d.forEach((m,_)=>{this._addStickyColumnStyles([m],this._footerRowDefs[_])}),Array.from(this._columnDefsByName.values()).forEach(m=>m.resetStickyChanged())}_outletAssigned(){!this._hasAllOutlets&&this._rowOutlet&&this._headerRowOutlet&&this._footerRowOutlet&&this._noDataRowOutlet&&(this._hasAllOutlets=!0,this._canRender()&&this._render())}_canRender(){return this._hasAllOutlets&&this._hasInitialized}_render(){this._cacheRowDefs(),this._cacheColumnDefs(),!this._headerRowDefs.length&&!this._footerRowDefs.length&&this._rowDefs.length;let s=this._renderUpdatedColumns()||this._headerRowDefChanged||this._footerRowDefChanged;this._stickyColumnStylesNeedReset=this._stickyColumnStylesNeedReset||s,this._forceRecalculateCellWidths=s,this._headerRowDefChanged&&(this._forceRenderHeaderRows(),this._headerRowDefChanged=!1),this._footerRowDefChanged&&(this._forceRenderFooterRows(),this._footerRowDefChanged=!1),this.dataSource&&this._rowDefs.length>0&&!this._renderChangeSubscription?this._observeRenderChanges():this._stickyColumnStylesNeedReset&&this.updateStickyColumnStyles(),this._checkStickyStates()}_getAllRenderRows(){let n=[],s=this._cachedRenderRowsMap;this._cachedRenderRowsMap=new Map;for(let d=0;d<this._data.length;d++){let m=this._data[d],_=this._getRenderRowsForData(m,d,s.get(m));this._cachedRenderRowsMap.has(m)||this._cachedRenderRowsMap.set(m,new WeakMap);for(let w=0;w<_.length;w++){let S=_[w],T=this._cachedRenderRowsMap.get(S.data);T.has(S.rowDef)?T.get(S.rowDef).push(S):T.set(S.rowDef,[S]),n.push(S)}}return n}_getRenderRowsForData(n,s,d){return this._getRowDefs(n,s).map(_=>{let w=d&&d.has(_)?d.get(_):[];if(w.length){let S=w.shift();return S.dataIndex=s,S}else return{data:n,rowDef:_,dataIndex:s}})}_cacheColumnDefs(){this._columnDefsByName.clear(),kb(this._getOwnDefs(this._contentColumnDefs),this._customColumnDefs).forEach(s=>{this._columnDefsByName.has(s.name),this._columnDefsByName.set(s.name,s)})}_cacheRowDefs(){this._headerRowDefs=kb(this._getOwnDefs(this._contentHeaderRowDefs),this._customHeaderRowDefs),this._footerRowDefs=kb(this._getOwnDefs(this._contentFooterRowDefs),this._customFooterRowDefs),this._rowDefs=kb(this._getOwnDefs(this._contentRowDefs),this._customRowDefs);let n=this._rowDefs.filter(s=>!s.when);!this.multiTemplateDataRows&&n.length>1,this._defaultRowDef=n[0]}_renderUpdatedColumns(){let n=(_,w)=>_||!!w.getColumnsDiff(),s=this._rowDefs.reduce(n,!1);s&&this._forceRenderDataRows();let d=this._headerRowDefs.reduce(n,!1);d&&this._forceRenderHeaderRows();let m=this._footerRowDefs.reduce(n,!1);return m&&this._forceRenderFooterRows(),s||d||m}_switchDataSource(n){this._data=[],oy(this.dataSource)&&this.dataSource.disconnect(this),this._renderChangeSubscription&&(this._renderChangeSubscription.unsubscribe(),this._renderChangeSubscription=null),n||(this._dataDiffer&&this._dataDiffer.diff([]),this._rowOutlet&&this._rowOutlet.viewContainer.clear()),this._dataSource=n}_observeRenderChanges(){if(!this.dataSource)return;let n;oy(this.dataSource)?n=this.dataSource.connect(this):Hh(this.dataSource)?n=this.dataSource:Array.isArray(this.dataSource)&&(n=Fe(this.dataSource)),this._renderChangeSubscription=n.pipe(ri(this._onDestroy)).subscribe(s=>{this._data=s||[],this.renderRows()})}_forceRenderHeaderRows(){this._headerRowOutlet.viewContainer.length>0&&this._headerRowOutlet.viewContainer.clear(),this._headerRowDefs.forEach((n,s)=>this._renderRow(this._headerRowOutlet,n,s)),this.updateStickyHeaderRowStyles()}_forceRenderFooterRows(){this._footerRowOutlet.viewContainer.length>0&&this._footerRowOutlet.viewContainer.clear(),this._footerRowDefs.forEach((n,s)=>this._renderRow(this._footerRowOutlet,n,s)),this.updateStickyFooterRowStyles()}_addStickyColumnStyles(n,s){let d=Array.from(s.columns||[]).map(w=>{let S=this._columnDefsByName.get(w);return S}),m=d.map(w=>w.sticky),_=d.map(w=>w.stickyEnd);this._stickyStyler.updateStickyColumns(n,m,_,!this._fixedLayout||this._forceRecalculateCellWidths)}_getRenderedRows(n){let s=[];for(let d=0;d<n.viewContainer.length;d++){let m=n.viewContainer.get(d);s.push(m.rootNodes[0])}return s}_getRowDefs(n,s){if(this._rowDefs.length==1)return[this._rowDefs[0]];let d=[];if(this.multiTemplateDataRows)d=this._rowDefs.filter(m=>!m.when||m.when(s,n));else{let m=this._rowDefs.find(_=>_.when&&_.when(s,n))||this._defaultRowDef;m&&d.push(m)}return d.length,d}_getEmbeddedViewArgs(n,s){let d=n.rowDef,m={$implicit:n.data};return{templateRef:d.template,context:m,index:s}}_renderRow(n,s,d,m={}){let _=n.viewContainer.createEmbeddedView(s.template,m,d);return this._renderCellTemplateForItem(s,m),_}_renderCellTemplateForItem(n,s){for(let d of this._getCellTemplates(n))Gu.mostRecentCellOutlet&&Gu.mostRecentCellOutlet._viewContainer.createEmbeddedView(d,s);this._changeDetectorRef.markForCheck()}_updateRowIndexContext(){let n=this._rowOutlet.viewContainer;for(let s=0,d=n.length;s<d;s++){let _=n.get(s).context;_.count=d,_.first=s===0,_.last=s===d-1,_.even=s%2===0,_.odd=!_.even,this.multiTemplateDataRows?(_.dataIndex=this._renderRows[s].dataIndex,_.renderIndex=s):_.index=this._renderRows[s].dataIndex}}_getCellTemplates(n){return!n||!n.columns?[]:Array.from(n.columns,s=>{let d=this._columnDefsByName.get(s);return n.extractCellTemplate(d)})}_forceRenderDataRows(){this._dataDiffer.diff([]),this._rowOutlet.viewContainer.clear(),this.renderRows()}_checkStickyStates(){let n=(s,d)=>s||d.hasStickyChanged();this._headerRowDefs.reduce(n,!1)&&this.updateStickyHeaderRowStyles(),this._footerRowDefs.reduce(n,!1)&&this.updateStickyFooterRowStyles(),Array.from(this._columnDefsByName.values()).reduce(n,!1)&&(this._stickyColumnStylesNeedReset=!0,this.updateStickyColumnStyles())}_setupStickyStyler(){let n=this._dir?this._dir.value:"ltr";this._stickyStyler=new VD(this._isNativeHtmlTable,this.stickyCssClass,n,this._coalescedStyleScheduler,this._platform.isBrowser,this.needsPositionStickyOnElement,this._stickyPositioningListener),(this._dir?this._dir.change:Fe()).pipe(ri(this._onDestroy)).subscribe(s=>{this._stickyStyler.direction=s,this.updateStickyColumnStyles()})}_getOwnDefs(n){return n.filter(s=>!s._table||s._table===this)}_updateNoDataRow(){let n=this._customNoDataRow||this._noDataRow;if(!n)return;let s=this._rowOutlet.viewContainer.length===0;if(s===this._isShowingNoDataRow)return;let d=this._noDataRowOutlet.viewContainer;if(s){let m=d.createEmbeddedView(n.templateRef),_=m.rootNodes[0];m.rootNodes.length===1&&_?.nodeType===this._document.ELEMENT_NODE&&(_.setAttribute("role","row"),_.classList.add(n._contentClassName))}else d.clear();this._isShowingNoDataRow=s,this._changeDetectorRef.markForCheck()}};r.\u0275fac=function(s){return new(s||r)(B(xu),B(Wi),B(Se),rl("role"),B(To,8),B(li),B(pn),B(Zf),B(Ob),B(vd),B(Fb,12),B(ze,8))},r.\u0275cmp=Et({type:r,selectors:[["cdk-table"],["table","cdk-table",""]],contentQueries:function(s,d,m){if(s&1&&(mn(m,r5,5),mn(m,Ym,5),mn(m,Nb,5),mn(m,Gg,5),mn(m,GD,5)),s&2){let _;ce(_=de())&&(d._noDataRow=_.first),ce(_=de())&&(d._contentColumnDefs=_),ce(_=de())&&(d._contentRowDefs=_),ce(_=de())&&(d._contentHeaderRowDefs=_),ce(_=de())&&(d._contentFooterRowDefs=_)}},hostAttrs:[1,"cdk-table"],hostVars:2,hostBindings:function(s,d){s&2&&ei("cdk-table-fixed-layout",d.fixedLayout)},inputs:{trackBy:"trackBy",dataSource:"dataSource",multiTemplateDataRows:[Rt.HasDecoratorInputTransform,"multiTemplateDataRows","multiTemplateDataRows",Qe],fixedLayout:[Rt.HasDecoratorInputTransform,"fixedLayout","fixedLayout",Qe]},outputs:{contentChanged:"contentChanged"},exportAs:["cdkTable"],standalone:!0,features:[Ni([{provide:vl,useExisting:r},{provide:Zf,useClass:fm},{provide:Ob,useClass:UD},{provide:Fb,useValue:null}]),Tn,At],ngContentSelectors:Pnt,decls:5,vars:2,consts:[["role","rowgroup"],["headerRowOutlet",""],["rowOutlet",""],["noDataRowOutlet",""],["footerRowOutlet",""]],template:function(s,d){s&1&&(Nn(Rnt),Ti(0),Ti(1,1),mt(2,Int,1,0)(3,Ant,7,0)(4,knt,4,0)),s&2&&(N(2),$i(2,d._isServer?2:-1),N(),$i(3,d._isNativeHtmlTable?3:4))},dependencies:[YD,$D,XD,ZD],styles:[".cdk-table-fixed-layout{table-layout:fixed}"],encapsulation:2});let a=r;return a})();function kb(a,r){return a.concat(Array.from(r))}function t5(a,r){let l=r.toUpperCase(),n=a.viewContainer.element.nativeElement;for(;n;){let s=n.nodeType===1?n.nodeName:null;if(s===l)return n;if(s==="TABLE")break;n=n.parentNode}return null}function znt(a,r){a&1&&Ti(0,2)}function Nnt(a,r){a&1&&(A(0,"thead",0),ks(1,1),k(),A(2,"tbody",2),ks(3,3)(4,4),k(),A(5,"tfoot",0),ks(6,5),k())}function Bnt(a,r){a&1&&ks(0,1)(1,3)(2,4)(3,5)}var Vnt=[[["caption"]],[["colgroup"],["col"]],"*"],jnt=["caption","colgroup, col","*"];var Aa=(()=>{let r=class r extends KD{constructor(){super(...arguments),this.stickyCssClass="mat-mdc-table-sticky",this.needsPositionStickyOnElement=!1}};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=zr(r)))(d||r)}})(),r.\u0275cmp=Et({type:r,selectors:[["mat-table"],["table","mat-table",""]],hostAttrs:[1,"mat-mdc-table","mdc-data-table__table"],hostVars:2,hostBindings:function(s,d){s&2&&ei("mdc-table-fixed-layout",d.fixedLayout)},exportAs:["matTable"],standalone:!0,features:[Ni([{provide:KD,useExisting:r},{provide:vl,useExisting:r},{provide:Ob,useClass:UD},{provide:Zf,useClass:fm},{provide:Fb,useValue:null}]),Si,At],ngContentSelectors:jnt,decls:5,vars:2,consts:[["role","rowgroup"],["headerRowOutlet",""],["role","rowgroup",1,"mdc-data-table__content"],["rowOutlet",""],["noDataRowOutlet",""],["footerRowOutlet",""]],template:function(s,d){s&1&&(Nn(Vnt),Ti(0),Ti(1,1),mt(2,znt,1,0)(3,Nnt,7,0)(4,Bnt,4,0)),s&2&&(N(2),$i(2,d._isServer?2:-1),N(),$i(3,d._isNativeHtmlTable?3:4))},dependencies:[YD,$D,XD,ZD],styles:[".mat-mdc-table-sticky{position:sticky !important}.mdc-data-table{-webkit-overflow-scrolling:touch;display:inline-flex;flex-direction:column;box-sizing:border-box;position:relative}.mdc-data-table__table-container{-webkit-overflow-scrolling:touch;overflow-x:auto;width:100%}.mdc-data-table__table{min-width:100%;border:0;white-space:nowrap;border-spacing:0;table-layout:fixed}.mdc-data-table__cell{box-sizing:border-box;overflow:hidden;text-align:left;text-overflow:ellipsis}[dir=rtl] .mdc-data-table__cell,.mdc-data-table__cell[dir=rtl]{text-align:right}.mdc-data-table__cell--numeric{text-align:right}[dir=rtl] .mdc-data-table__cell--numeric,.mdc-data-table__cell--numeric[dir=rtl]{text-align:left}.mdc-data-table__header-cell{box-sizing:border-box;text-overflow:ellipsis;overflow:hidden;outline:none;text-align:left}[dir=rtl] .mdc-data-table__header-cell,.mdc-data-table__header-cell[dir=rtl]{text-align:right}.mdc-data-table__header-cell--numeric{text-align:right}[dir=rtl] .mdc-data-table__header-cell--numeric,.mdc-data-table__header-cell--numeric[dir=rtl]{text-align:left}.mdc-data-table__header-cell-wrapper{align-items:center;display:inline-flex;vertical-align:middle}.mdc-data-table__cell,.mdc-data-table__header-cell{padding:0 16px 0 16px}.mdc-data-table__header-cell--checkbox,.mdc-data-table__cell--checkbox{padding-left:4px;padding-right:0}[dir=rtl] .mdc-data-table__header-cell--checkbox,[dir=rtl] .mdc-data-table__cell--checkbox,.mdc-data-table__header-cell--checkbox[dir=rtl],.mdc-data-table__cell--checkbox[dir=rtl]{padding-left:0;padding-right:4px}mat-table{display:block}mat-header-row{min-height:56px}mat-row,mat-footer-row{min-height:48px}mat-row,mat-header-row,mat-footer-row{display:flex;border-width:0;border-bottom-width:1px;border-style:solid;align-items:center;box-sizing:border-box}mat-cell:first-of-type,mat-header-cell:first-of-type,mat-footer-cell:first-of-type{padding-left:24px}[dir=rtl] mat-cell:first-of-type:not(:only-of-type),[dir=rtl] mat-header-cell:first-of-type:not(:only-of-type),[dir=rtl] mat-footer-cell:first-of-type:not(:only-of-type){padding-left:0;padding-right:24px}mat-cell:last-of-type,mat-header-cell:last-of-type,mat-footer-cell:last-of-type{padding-right:24px}[dir=rtl] mat-cell:last-of-type:not(:only-of-type),[dir=rtl] mat-header-cell:last-of-type:not(:only-of-type),[dir=rtl] mat-footer-cell:last-of-type:not(:only-of-type){padding-right:0;padding-left:24px}mat-cell,mat-header-cell,mat-footer-cell{flex:1;display:flex;align-items:center;overflow:hidden;word-wrap:break-word;min-height:inherit}.mat-mdc-table{table-layout:auto;white-space:normal;background-color:var(--mat-table-background-color)}.mat-mdc-header-row{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;height:var(--mat-table-header-container-height, 56px);color:var(--mat-table-header-headline-color, rgba(0, 0, 0, 0.87));font-family:var(--mat-table-header-headline-font, Roboto, sans-serif);line-height:var(--mat-table-header-headline-line-height);font-size:var(--mat-table-header-headline-size, 14px);font-weight:var(--mat-table-header-headline-weight, 500)}.mat-mdc-row{height:var(--mat-table-row-item-container-height, 52px);color:var(--mat-table-row-item-label-text-color, rgba(0, 0, 0, 0.87))}.mat-mdc-row,.mdc-data-table__content{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-table-row-item-label-text-font, Roboto, sans-serif);line-height:var(--mat-table-row-item-label-text-line-height);font-size:var(--mat-table-row-item-label-text-size, 14px);font-weight:var(--mat-table-row-item-label-text-weight)}.mat-mdc-footer-row{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;height:var(--mat-table-footer-container-height, 52px);color:var(--mat-table-row-item-label-text-color, rgba(0, 0, 0, 0.87));font-family:var(--mat-table-footer-supporting-text-font, Roboto, sans-serif);line-height:var(--mat-table-footer-supporting-text-line-height);font-size:var(--mat-table-footer-supporting-text-size, 14px);font-weight:var(--mat-table-footer-supporting-text-weight);letter-spacing:var(--mat-table-footer-supporting-text-tracking)}.mat-mdc-header-cell{border-bottom-color:var(--mat-table-row-item-outline-color, rgba(0, 0, 0, 0.12));border-bottom-width:var(--mat-table-row-item-outline-width, 1px);border-bottom-style:solid;letter-spacing:var(--mat-table-header-headline-tracking);font-weight:inherit;line-height:inherit}.mat-mdc-cell{border-bottom-color:var(--mat-table-row-item-outline-color, rgba(0, 0, 0, 0.12));border-bottom-width:var(--mat-table-row-item-outline-width, 1px);border-bottom-style:solid;letter-spacing:var(--mat-table-row-item-label-text-tracking);line-height:inherit}.mdc-data-table__row:last-child .mat-mdc-cell{border-bottom:none}.mat-mdc-footer-cell{letter-spacing:var(--mat-table-row-item-label-text-tracking)}mat-row.mat-mdc-row,mat-header-row.mat-mdc-header-row,mat-footer-row.mat-mdc-footer-row{border-bottom:none}.mat-mdc-table tbody,.mat-mdc-table tfoot,.mat-mdc-table thead,.mat-mdc-cell,.mat-mdc-footer-cell,.mat-mdc-header-row,.mat-mdc-row,.mat-mdc-footer-row,.mat-mdc-table .mat-mdc-header-cell{background:inherit}.mat-mdc-table mat-header-row.mat-mdc-header-row,.mat-mdc-table mat-row.mat-mdc-row,.mat-mdc-table mat-footer-row.mat-mdc-footer-cell{height:unset}mat-header-cell.mat-mdc-header-cell,mat-cell.mat-mdc-cell,mat-footer-cell.mat-mdc-footer-cell{align-self:stretch}"],encapsulation:2});let a=r;return a})(),ka=(()=>{let r=class r extends Lb{};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=zr(r)))(d||r)}})(),r.\u0275dir=re({type:r,selectors:[["","matCellDef",""]],standalone:!0,features:[Ni([{provide:Lb,useExisting:r}]),Si]});let a=r;return a})(),Ra=(()=>{let r=class r extends zb{};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=zr(r)))(d||r)}})(),r.\u0275dir=re({type:r,selectors:[["","matHeaderCellDef",""]],standalone:!0,features:[Ni([{provide:zb,useExisting:r}]),Si]});let a=r;return a})();var Pa=(()=>{let r=class r extends Ym{get name(){return this._name}set name(n){this._setNameInput(n)}_updateColumnCssClassName(){super._updateColumnCssClassName(),this._columnCssClassName.push(`mat-column-${this.cssClassFriendlyName}`)}};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=zr(r)))(d||r)}})(),r.\u0275dir=re({type:r,selectors:[["","matColumnDef",""]],inputs:{sticky:"sticky",name:[Rt.None,"matColumnDef","name"]},standalone:!0,features:[Ni([{provide:Ym,useExisting:r},{provide:"MAT_SORT_HEADER_COLUMN_DEF",useExisting:r}]),Si]});let a=r;return a})(),Oa=(()=>{let r=class r extends i5{};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=zr(r)))(d||r)}})(),r.\u0275dir=re({type:r,selectors:[["mat-header-cell"],["th","mat-header-cell",""]],hostAttrs:["role","columnheader",1,"mat-mdc-header-cell","mdc-data-table__header-cell"],standalone:!0,features:[Si]});let a=r;return a})();var Fa=(()=>{let r=class r extends n5{};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=zr(r)))(d||r)}})(),r.\u0275dir=re({type:r,selectors:[["mat-cell"],["td","mat-cell",""]],hostAttrs:[1,"mat-mdc-cell","mdc-data-table__cell"],standalone:!0,features:[Si]});let a=r;return a})();var La=(()=>{let r=class r extends Gg{};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=zr(r)))(d||r)}})(),r.\u0275dir=re({type:r,selectors:[["","matHeaderRowDef",""]],inputs:{columns:[Rt.None,"matHeaderRowDef","columns"],sticky:[Rt.None,"matHeaderRowDefSticky","sticky"]},standalone:!0,features:[Ni([{provide:Gg,useExisting:r}]),Si]});let a=r;return a})();var za=(()=>{let r=class r extends Nb{};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=zr(r)))(d||r)}})(),r.\u0275dir=re({type:r,selectors:[["","matRowDef",""]],inputs:{columns:[Rt.None,"matRowDefColumns","columns"],when:[Rt.None,"matRowDefWhen","when"]},standalone:!0,features:[Ni([{provide:Nb,useExisting:r}]),Si]});let a=r;return a})(),Na=(()=>{let r=class r extends qD{};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=zr(r)))(d||r)}})(),r.\u0275cmp=Et({type:r,selectors:[["mat-header-row"],["tr","mat-header-row",""]],hostAttrs:["role","row",1,"mat-mdc-header-row","mdc-data-table__header-row"],exportAs:["matHeaderRow"],standalone:!0,features:[Ni([{provide:qD,useExisting:r}]),Si,At],decls:1,vars:0,consts:[["cdkCellOutlet",""]],template:function(s,d){s&1&&ks(0,0)},dependencies:[Gu],encapsulation:2});let a=r;return a})();var Ba=(()=>{let r=class r extends WD{};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=zr(r)))(d||r)}})(),r.\u0275cmp=Et({type:r,selectors:[["mat-row"],["tr","mat-row",""]],hostAttrs:["role","row",1,"mat-mdc-row","mdc-data-table__row"],exportAs:["matRow"],standalone:!0,features:[Ni([{provide:WD,useExisting:r}]),Si,At],decls:1,vars:0,consts:[["cdkCellOutlet",""]],template:function(s,d){s&1&&ks(0,0)},dependencies:[Gu],encapsulation:2});let a=r;return a})();var Unt=9007199254740991,ps=class extends ny{get data(){return this._data.value}set data(r){r=Array.isArray(r)?r:[],this._data.next(r),this._renderChangesSubscription||this._filterData(r)}get filter(){return this._filter.value}set filter(r){this._filter.next(r),this._renderChangesSubscription||this._filterData(this.data)}get sort(){return this._sort}set sort(r){this._sort=r,this._updateChangeSubscription()}get paginator(){return this._paginator}set paginator(r){this._paginator=r,this._updateChangeSubscription()}constructor(r=[]){super(),this._renderData=new Ze([]),this._filter=new Ze(""),this._internalPageChanges=new pe,this._renderChangesSubscription=null,this.sortingDataAccessor=(l,n)=>{let s=l[n];if(zE(s)){let d=Number(s);return d<Unt?d:s}return s},this.sortData=(l,n)=>{let s=n.active,d=n.direction;return!s||d==""?l:l.sort((m,_)=>{let w=this.sortingDataAccessor(m,s),S=this.sortingDataAccessor(_,s),T=typeof w,L=typeof S;T!==L&&(T==="number"&&(w+=""),L==="number"&&(S+=""));let H=0;return w!=null&&S!=null?w>S?H=1:w<S&&(H=-1):w!=null?H=1:S!=null&&(H=-1),H*(d=="asc"?1:-1)})},this.filterPredicate=(l,n)=>{let s=Object.keys(l).reduce((m,_)=>m+l[_]+"\u25EC","").toLowerCase(),d=n.trim().toLowerCase();return s.indexOf(d)!=-1},this._data=new Ze(r),this._updateChangeSubscription()}_updateChangeSubscription(){let r=this._sort?io(this._sort.sortChange,this._sort.initialized):Fe(null),l=this._paginator?io(this._paginator.page,this._internalPageChanges,this._paginator.initialized):Fe(null),n=this._data,s=bc([n,this._filter]).pipe(Fi(([_])=>this._filterData(_))),d=bc([s,r]).pipe(Fi(([_])=>this._orderData(_))),m=bc([d,l]).pipe(Fi(([_])=>this._pageData(_)));this._renderChangesSubscription?.unsubscribe(),this._renderChangesSubscription=m.subscribe(_=>this._renderData.next(_))}_filterData(r){return this.filteredData=this.filter==null||this.filter===""?r:r.filter(l=>this.filterPredicate(l,this.filter)),this.paginator&&this._updatePaginator(this.filteredData.length),this.filteredData}_orderData(r){return this.sort?this.sortData(r.slice(),this.sort):r}_pageData(r){if(!this.paginator)return r;let l=this.paginator.pageIndex*this.paginator.pageSize;return r.slice(l,l+this.paginator.pageSize)}_updatePaginator(r){Promise.resolve().then(()=>{let l=this.paginator;if(l&&(l.length=r,l.pageIndex>0)){let n=Math.ceil(l.length/l.pageSize)-1||0,s=Math.min(l.pageIndex,n);s!==l.pageIndex&&(l.pageIndex=s,this._internalPageChanges.next())}})}connect(){return this._renderChangesSubscription||this._updateChangeSubscription(),this._renderData}disconnect(){this._renderChangesSubscription?.unsubscribe(),this._renderChangesSubscription=null}};var Hnt=["mat-menu-item",""];function Gnt(a,r){a&1&&(As(),A(0,"svg",3),dt(1,"polygon",4),k())}var qnt=[[["mat-icon"],["","matMenuItemIcon",""]],"*"],Wnt=["mat-icon, [matMenuItemIcon]","*"];function $nt(a,r){if(a&1){let l=Ce();A(0,"div",0),ct("keydown",function(s){te(l);let d=vt();return ee(d._handleKeydown(s))})("click",function(){te(l);let s=vt();return ee(s.closed.emit("click"))})("@transformMenu.start",function(s){te(l);let d=vt();return ee(d._onAnimationStart(s))})("@transformMenu.done",function(s){te(l);let d=vt();return ee(d._onAnimationDone(s))}),A(1,"div",1),Ti(2),k()()}if(a&2){let l=vt();Z("id",l.panelId)("ngClass",l._classList)("@transformMenu",l._panelAnimationState),oi("aria-label",l.ariaLabel||null)("aria-labelledby",l.ariaLabelledby||null)("aria-describedby",l.ariaDescribedby||null)}}var Ynt=["*"],QD=new we("MAT_MENU_PANEL"),yl=(()=>{let r=class r{constructor(n,s,d,m,_){this._elementRef=n,this._document=s,this._focusMonitor=d,this._parentMenu=m,this._changeDetectorRef=_,this.role="menuitem",this.disabled=!1,this.disableRipple=!1,this._hovered=new pe,this._focused=new pe,this._highlighted=!1,this._triggersSubmenu=!1,m?.addItem?.(this)}focus(n,s){this._focusMonitor&&n?this._focusMonitor.focusVia(this._getHostElement(),n,s):this._getHostElement().focus(s),this._focused.next(this)}ngAfterViewInit(){this._focusMonitor&&this._focusMonitor.monitor(this._elementRef,!1)}ngOnDestroy(){this._focusMonitor&&this._focusMonitor.stopMonitoring(this._elementRef),this._parentMenu&&this._parentMenu.removeItem&&this._parentMenu.removeItem(this),this._hovered.complete(),this._focused.complete()}_getTabIndex(){return this.disabled?"-1":"0"}_getHostElement(){return this._elementRef.nativeElement}_checkDisabled(n){this.disabled&&(n.preventDefault(),n.stopPropagation())}_handleMouseEnter(){this._hovered.next(this)}getLabel(){let n=this._elementRef.nativeElement.cloneNode(!0),s=n.querySelectorAll("mat-icon, .material-icons");for(let d=0;d<s.length;d++)s[d].remove();return n.textContent?.trim()||""}_setHighlighted(n){this._highlighted=n,this._changeDetectorRef?.markForCheck()}_setTriggersSubmenu(n){this._triggersSubmenu=n,this._changeDetectorRef?.markForCheck()}_hasFocus(){return this._document&&this._document.activeElement===this._getHostElement()}};r.\u0275fac=function(s){return new(s||r)(B(Se),B(li),B(Ls),B(QD,8),B(Wi))},r.\u0275cmp=Et({type:r,selectors:[["","mat-menu-item",""]],hostAttrs:[1,"mat-mdc-menu-item","mat-mdc-focus-indicator"],hostVars:8,hostBindings:function(s,d){s&1&&ct("click",function(_){return d._checkDisabled(_)})("mouseenter",function(){return d._handleMouseEnter()}),s&2&&(oi("role",d.role)("tabindex",d._getTabIndex())("aria-disabled",d.disabled)("disabled",d.disabled||null),ei("mat-mdc-menu-item-highlighted",d._highlighted)("mat-mdc-menu-item-submenu-trigger",d._triggersSubmenu))},inputs:{role:"role",disabled:[Rt.HasDecoratorInputTransform,"disabled","disabled",Qe],disableRipple:[Rt.HasDecoratorInputTransform,"disableRipple","disableRipple",Qe]},exportAs:["matMenuItem"],standalone:!0,features:[Tn,At],attrs:Hnt,ngContentSelectors:Wnt,decls:5,vars:3,consts:[[1,"mat-mdc-menu-item-text"],["matRipple","",1,"mat-mdc-menu-ripple",3,"matRippleDisabled","matRippleTrigger"],["class","mat-mdc-menu-submenu-icon","viewBox","0 0 5 10","focusable","false","aria-hidden","true"],["viewBox","0 0 5 10","focusable","false","aria-hidden","true",1,"mat-mdc-menu-submenu-icon"],["points","0,0 5,5 0,10"]],template:function(s,d){s&1&&(Nn(qnt),Ti(0),A(1,"span",0),Ti(2,1),k(),dt(3,"div",1),mt(4,Gnt,2,0,":svg:svg",2)),s&2&&(N(3),Z("matRippleDisabled",d.disableRipple||d.disabled)("matRippleTrigger",d._getHostElement()),N(),$i(4,d._triggersSubmenu?4:-1))},dependencies:[zy],encapsulation:2,changeDetection:0});let a=r;return a})();var Znt=new we("MatMenuContent");var Bb={transformMenu:Yr("transformMenu",[Wn("void",Ei({opacity:0,transform:"scale(0.8)"})),Sn("void => enter",Bn("120ms cubic-bezier(0, 0, 0.2, 1)",Ei({opacity:1,transform:"scale(1)"}))),Sn("* => void",Bn("100ms 25ms linear",Ei({opacity:0})))]),fadeInItems:Yr("fadeInItems",[Wn("showing",Ei({opacity:1})),Sn("void => *",[Ei({opacity:0}),Bn("400ms 100ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])},Kvt=Bb.fadeInItems,Qvt=Bb.transformMenu,Xnt=0,Knt=new we("mat-menu-default-options",{providedIn:"root",factory:Qnt});function Qnt(){return{overlapTrigger:!1,xPosition:"after",yPosition:"below",backdropClass:"cdk-overlay-transparent-backdrop"}}var Va=(()=>{let r=class r{get xPosition(){return this._xPosition}set xPosition(n){this._xPosition=n,this.setPositionClasses()}get yPosition(){return this._yPosition}set yPosition(n){this._yPosition=n,this.setPositionClasses()}set panelClass(n){let s=this._previousPanelClass;s&&s.length&&s.split(" ").forEach(d=>{this._classList[d]=!1}),this._previousPanelClass=n,n&&n.length&&(n.split(" ").forEach(d=>{this._classList[d]=!0}),this._elementRef.nativeElement.className="")}get classList(){return this.panelClass}set classList(n){this.panelClass=n}constructor(n,s,d,m){this._elementRef=n,this._ngZone=s,this._changeDetectorRef=m,this._elevationPrefix="mat-elevation-z",this._baseElevation=8,this._directDescendantItems=new vf,this._classList={},this._panelAnimationState="void",this._animationDone=new pe,this.closed=new ye,this.close=this.closed,this.panelId=`mat-menu-panel-${Xnt++}`,this.overlayPanelClass=d.overlayPanelClass||"",this._xPosition=d.xPosition,this._yPosition=d.yPosition,this.backdropClass=d.backdropClass,this.overlapTrigger=d.overlapTrigger,this.hasBackdrop=d.hasBackdrop}ngOnInit(){this.setPositionClasses()}ngAfterContentInit(){this._updateDirectDescendants(),this._keyManager=new Ay(this._directDescendantItems).withWrap().withTypeAhead().withHomeAndEnd(),this._keyManager.tabOut.subscribe(()=>this.closed.emit("tab")),this._directDescendantItems.changes.pipe(co(this._directDescendantItems),no(n=>io(...n.map(s=>s._focused)))).subscribe(n=>this._keyManager.updateActiveItem(n)),this._directDescendantItems.changes.subscribe(n=>{let s=this._keyManager;if(this._panelAnimationState==="enter"&&s.activeItem?._hasFocus()){let d=n.toArray(),m=Math.max(0,Math.min(d.length-1,s.activeItemIndex||0));d[m]&&!d[m].disabled?s.setActiveItem(m):s.setNextItemActive()}})}ngOnDestroy(){this._keyManager?.destroy(),this._directDescendantItems.destroy(),this.closed.complete(),this._firstItemFocusSubscription?.unsubscribe()}_hovered(){return this._directDescendantItems.changes.pipe(co(this._directDescendantItems),no(s=>io(...s.map(d=>d._hovered))))}addItem(n){}removeItem(n){}_handleKeydown(n){let s=n.keyCode,d=this._keyManager;switch(s){case 27:Zr(n)||(n.preventDefault(),this.closed.emit("keydown"));break;case 37:this.parentMenu&&this.direction==="ltr"&&this.closed.emit("keydown");break;case 39:this.parentMenu&&this.direction==="rtl"&&this.closed.emit("keydown");break;default:(s===38||s===40)&&d.setFocusOrigin("keyboard"),d.onKeydown(n);return}n.stopPropagation()}focusFirstItem(n="program"){this._firstItemFocusSubscription?.unsubscribe(),this._firstItemFocusSubscription=this._ngZone.onStable.pipe(Ji(1)).subscribe(()=>{let s=null;if(this._directDescendantItems.length&&(s=this._directDescendantItems.first._getHostElement().closest('[role="menu"]')),!s||!s.contains(document.activeElement)){let d=this._keyManager;d.setFocusOrigin(n).setFirstItemActive(),!d.activeItem&&s&&s.focus()}})}resetActiveItem(){this._keyManager.setActiveItem(-1)}setElevation(n){let s=Math.min(this._baseElevation+n,24),d=`${this._elevationPrefix}${s}`,m=Object.keys(this._classList).find(_=>_.startsWith(this._elevationPrefix));(!m||m===this._previousElevation)&&(this._previousElevation&&(this._classList[this._previousElevation]=!1),this._classList[d]=!0,this._previousElevation=d)}setPositionClasses(n=this.xPosition,s=this.yPosition){let d=this._classList;d["mat-menu-before"]=n==="before",d["mat-menu-after"]=n==="after",d["mat-menu-above"]=s==="above",d["mat-menu-below"]=s==="below",this._changeDetectorRef?.markForCheck()}_startAnimation(){this._panelAnimationState="enter"}_resetAnimation(){this._panelAnimationState="void"}_onAnimationDone(n){this._animationDone.next(n),this._isAnimating=!1}_onAnimationStart(n){this._isAnimating=!0,n.toState==="enter"&&this._keyManager.activeItemIndex===0&&(n.element.scrollTop=0)}_updateDirectDescendants(){this._allItems.changes.pipe(co(this._allItems)).subscribe(n=>{this._directDescendantItems.reset(n.filter(s=>s._parentMenu===this)),this._directDescendantItems.notifyOnChanges()})}};r.\u0275fac=function(s){return new(s||r)(B(Se),B(ze),B(Knt),B(Wi))},r.\u0275cmp=Et({type:r,selectors:[["mat-menu"]],contentQueries:function(s,d,m){if(s&1&&(mn(m,Znt,5),mn(m,yl,5),mn(m,yl,4)),s&2){let _;ce(_=de())&&(d.lazyContent=_.first),ce(_=de())&&(d._allItems=_),ce(_=de())&&(d.items=_)}},viewQuery:function(s,d){if(s&1&&Ge(Eo,5),s&2){let m;ce(m=de())&&(d.templateRef=m.first)}},hostVars:3,hostBindings:function(s,d){s&2&&oi("aria-label",null)("aria-labelledby",null)("aria-describedby",null)},inputs:{backdropClass:"backdropClass",ariaLabel:[Rt.None,"aria-label","ariaLabel"],ariaLabelledby:[Rt.None,"aria-labelledby","ariaLabelledby"],ariaDescribedby:[Rt.None,"aria-describedby","ariaDescribedby"],xPosition:"xPosition",yPosition:"yPosition",overlapTrigger:[Rt.HasDecoratorInputTransform,"overlapTrigger","overlapTrigger",Qe],hasBackdrop:[Rt.HasDecoratorInputTransform,"hasBackdrop","hasBackdrop",n=>n==null?null:Qe(n)],panelClass:[Rt.None,"class","panelClass"],classList:"classList"},outputs:{closed:"closed",close:"close"},exportAs:["matMenu"],standalone:!0,features:[Ni([{provide:QD,useExisting:r}]),Tn,At],ngContentSelectors:Ynt,decls:1,vars:0,consts:[["tabindex","-1","role","menu",1,"mat-mdc-menu-panel","mat-mdc-elevation-specific",3,"id","ngClass","keydown","click"],[1,"mat-mdc-menu-content"]],template:function(s,d){s&1&&(Nn(),mt(0,$nt,3,6,"ng-template"))},dependencies:[Zo],styles:['mat-menu{display:none}.mat-mdc-menu-content{margin:0;padding:8px 0;list-style-type:none}.mat-mdc-menu-content:focus{outline:none}.mat-mdc-menu-content,.mat-mdc-menu-content .mat-mdc-menu-item .mat-mdc-menu-item-text{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;flex:1;white-space:normal;font-family:var(--mat-menu-item-label-text-font);line-height:var(--mat-menu-item-label-text-line-height);font-size:var(--mat-menu-item-label-text-size);letter-spacing:var(--mat-menu-item-label-text-tracking);font-weight:var(--mat-menu-item-label-text-weight)}.mat-mdc-menu-panel{min-width:112px;max-width:280px;overflow:auto;-webkit-overflow-scrolling:touch;box-sizing:border-box;outline:0;border-radius:var(--mat-menu-container-shape);background-color:var(--mat-menu-container-color);will-change:transform,opacity}.mat-mdc-menu-panel.ng-animating{pointer-events:none}.cdk-high-contrast-active .mat-mdc-menu-panel{outline:solid 1px}.mat-divider{color:var(--mat-menu-divider-color);margin-bottom:var(--mat-menu-divider-bottom-spacing);margin-top:var(--mat-menu-divider-top-spacing)}.mat-mdc-menu-item{display:flex;position:relative;align-items:center;justify-content:flex-start;overflow:hidden;padding:0;padding-left:var(--mat-menu-item-leading-spacing);padding-right:var(--mat-menu-item-trailing-spacing);-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0);cursor:pointer;width:100%;text-align:left;box-sizing:border-box;color:inherit;font-size:inherit;background:none;text-decoration:none;margin:0;align-items:center;min-height:48px}.mat-mdc-menu-item:focus{outline:none}[dir=rtl] .mat-mdc-menu-item,.mat-mdc-menu-item[dir=rtl]{padding-left:var(--mat-menu-item-trailing-spacing);padding-right:var(--mat-menu-item-leading-spacing)}.mat-mdc-menu-item:has(.material-icons,mat-icon,[matButtonIcon]){padding-left:var(--mat-menu-item-with-icon-leading-spacing);padding-right:var(--mat-menu-item-with-icon-trailing-spacing)}[dir=rtl] .mat-mdc-menu-item:has(.material-icons,mat-icon,[matButtonIcon]),.mat-mdc-menu-item:has(.material-icons,mat-icon,[matButtonIcon])[dir=rtl]{padding-left:var(--mat-menu-item-with-icon-trailing-spacing);padding-right:var(--mat-menu-item-with-icon-leading-spacing)}.mat-mdc-menu-item::-moz-focus-inner{border:0}.mat-mdc-menu-item,.mat-mdc-menu-item:visited,.mat-mdc-menu-item:link{color:var(--mat-menu-item-label-text-color)}.mat-mdc-menu-item .mat-icon-no-color,.mat-mdc-menu-item .mat-mdc-menu-submenu-icon{color:var(--mat-menu-item-icon-color)}.mat-mdc-menu-item[disabled]{cursor:default;opacity:.38}.mat-mdc-menu-item[disabled]::after{display:block;position:absolute;content:"";top:0;left:0;bottom:0;right:0}.mat-mdc-menu-item .mat-icon{flex-shrink:0;margin-right:var(--mat-menu-item-spacing);height:var(--mat-menu-item-icon-size);width:var(--mat-menu-item-icon-size)}[dir=rtl] .mat-mdc-menu-item{text-align:right}[dir=rtl] .mat-mdc-menu-item .mat-icon{margin-right:0;margin-left:var(--mat-menu-item-spacing)}.mat-mdc-menu-item:not([disabled]):hover{background-color:var(--mat-menu-item-hover-state-layer-color)}.mat-mdc-menu-item:not([disabled]).cdk-program-focused,.mat-mdc-menu-item:not([disabled]).cdk-keyboard-focused,.mat-mdc-menu-item:not([disabled]).mat-mdc-menu-item-highlighted{background-color:var(--mat-menu-item-focus-state-layer-color)}.cdk-high-contrast-active .mat-mdc-menu-item{margin-top:1px}.mat-mdc-menu-submenu-icon{width:var(--mat-menu-item-icon-size);height:10px;fill:currentColor;padding-left:var(--mat-menu-item-spacing)}[dir=rtl] .mat-mdc-menu-submenu-icon{right:auto;padding-right:var(--mat-menu-item-spacing);padding-left:0}.cdk-high-contrast-active .mat-mdc-menu-submenu-icon{fill:CanvasText}.mat-mdc-menu-item .mat-mdc-menu-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}'],encapsulation:2,data:{animation:[Bb.transformMenu,Bb.fadeInItems]},changeDetection:0});let a=r;return a})(),Jnt=new we("mat-menu-scroll-strategy",{providedIn:"root",factory:()=>{let a=oe($n);return()=>a.scrollStrategies.reposition()}});var o5=es({passive:!0});var Fd=(()=>{let r=class r{get _deprecatedMatMenuTriggerFor(){return this.menu}set _deprecatedMatMenuTriggerFor(n){this.menu=n}get menu(){return this._menu}set menu(n){n!==this._menu&&(this._menu=n,this._menuCloseSubscription.unsubscribe(),n&&(this._parentMaterialMenu,this._menuCloseSubscription=n.close.subscribe(s=>{this._destroyMenu(s),(s==="click"||s==="tab")&&this._parentMaterialMenu&&this._parentMaterialMenu.closed.emit(s)})),this._menuItemInstance?._setTriggersSubmenu(this.triggersSubmenu()))}constructor(n,s,d,m,_,w,S,T,L){this._overlay=n,this._element=s,this._viewContainerRef=d,this._menuItemInstance=w,this._dir=S,this._focusMonitor=T,this._ngZone=L,this._overlayRef=null,this._menuOpen=!1,this._closingActionsSubscription=nr.EMPTY,this._hoverSubscription=nr.EMPTY,this._menuCloseSubscription=nr.EMPTY,this._changeDetectorRef=oe(Wi),this._handleTouchStart=H=>{fg(H)||(this._openedBy="touch")},this._openedBy=void 0,this.restoreFocus=!0,this.menuOpened=new ye,this.onMenuOpen=this.menuOpened,this.menuClosed=new ye,this.onMenuClose=this.menuClosed,this._scrollStrategy=m,this._parentMaterialMenu=_ instanceof Va?_:void 0,s.nativeElement.addEventListener("touchstart",this._handleTouchStart,o5)}ngAfterContentInit(){this._handleHover()}ngOnDestroy(){this._overlayRef&&(this._overlayRef.dispose(),this._overlayRef=null),this._element.nativeElement.removeEventListener("touchstart",this._handleTouchStart,o5),this._menuCloseSubscription.unsubscribe(),this._closingActionsSubscription.unsubscribe(),this._hoverSubscription.unsubscribe()}get menuOpen(){return this._menuOpen}get dir(){return this._dir&&this._dir.value==="rtl"?"rtl":"ltr"}triggersSubmenu(){return!!(this._menuItemInstance&&this._parentMaterialMenu&&this.menu)}toggleMenu(){return this._menuOpen?this.closeMenu():this.openMenu()}openMenu(){let n=this.menu;if(this._menuOpen||!n)return;let s=this._createOverlay(n),d=s.getConfig(),m=d.positionStrategy;this._setPosition(n,m),d.hasBackdrop=n.hasBackdrop==null?!this.triggersSubmenu():n.hasBackdrop,s.attach(this._getPortal(n)),n.lazyContent&&n.lazyContent.attach(this.menuData),this._closingActionsSubscription=this._menuClosingActions().subscribe(()=>this.closeMenu()),this._initMenu(n),n instanceof Va&&(n._startAnimation(),n._directDescendantItems.changes.pipe(ri(n.close)).subscribe(()=>{m.withLockedPosition(!1).reapplyLastPosition(),m.withLockedPosition(!0)}))}closeMenu(){this.menu?.close.emit()}focus(n,s){this._focusMonitor&&n?this._focusMonitor.focusVia(this._element,n,s):this._element.nativeElement.focus(s)}updatePosition(){this._overlayRef?.updatePosition()}_destroyMenu(n){if(!this._overlayRef||!this.menuOpen)return;let s=this.menu;this._closingActionsSubscription.unsubscribe(),this._overlayRef.detach(),this.restoreFocus&&(n==="keydown"||!this._openedBy||!this.triggersSubmenu())&&this.focus(this._openedBy),this._openedBy=void 0,s instanceof Va?(s._resetAnimation(),s.lazyContent?s._animationDone.pipe(wn(d=>d.toState==="void"),Ji(1),ri(s.lazyContent._attached)).subscribe({next:()=>s.lazyContent.detach(),complete:()=>this._setIsMenuOpen(!1)}):this._setIsMenuOpen(!1)):(this._setIsMenuOpen(!1),s?.lazyContent?.detach())}_initMenu(n){n.parentMenu=this.triggersSubmenu()?this._parentMaterialMenu:void 0,n.direction=this.dir,this._setMenuElevation(n),n.focusFirstItem(this._openedBy||"program"),this._setIsMenuOpen(!0)}_setMenuElevation(n){if(n.setElevation){let s=0,d=n.parentMenu;for(;d;)s++,d=d.parentMenu;n.setElevation(s)}}_setIsMenuOpen(n){n!==this._menuOpen&&(this._menuOpen=n,this._menuOpen?this.menuOpened.emit():this.menuClosed.emit(),this.triggersSubmenu()&&this._menuItemInstance._setHighlighted(n),this._changeDetectorRef.markForCheck())}_createOverlay(n){if(!this._overlayRef){let s=this._getOverlayConfig(n);this._subscribeToPositions(n,s.positionStrategy),this._overlayRef=this._overlay.create(s),this._overlayRef.keydownEvents().subscribe()}return this._overlayRef}_getOverlayConfig(n){return new ns({positionStrategy:this._overlay.position().flexibleConnectedTo(this._element).withLockedPosition().withGrowAfterOpen().withTransformOriginOn(".mat-menu-panel, .mat-mdc-menu-panel"),backdropClass:n.backdropClass||"cdk-overlay-transparent-backdrop",panelClass:n.overlayPanelClass,scrollStrategy:this._scrollStrategy(),direction:this._dir})}_subscribeToPositions(n,s){n.setPositionClasses&&s.positionChanges.subscribe(d=>{let m=d.connectionPair.overlayX==="start"?"after":"before",_=d.connectionPair.overlayY==="top"?"below":"above";this._ngZone?this._ngZone.run(()=>n.setPositionClasses(m,_)):n.setPositionClasses(m,_)})}_setPosition(n,s){let[d,m]=n.xPosition==="before"?["end","start"]:["start","end"],[_,w]=n.yPosition==="above"?["bottom","top"]:["top","bottom"],[S,T]=[_,w],[L,H]=[d,m],q=0;if(this.triggersSubmenu()){if(H=d=n.xPosition==="before"?"start":"end",m=L=d==="end"?"start":"end",this._parentMaterialMenu){if(this._parentInnerPadding==null){let X=this._parentMaterialMenu.items.first;this._parentInnerPadding=X?X._getHostElement().offsetTop:0}q=_==="bottom"?this._parentInnerPadding:-this._parentInnerPadding}}else n.overlapTrigger||(S=_==="top"?"bottom":"top",T=w==="top"?"bottom":"top");s.withPositions([{originX:d,originY:S,overlayX:L,overlayY:_,offsetY:q},{originX:m,originY:S,overlayX:H,overlayY:_,offsetY:q},{originX:d,originY:T,overlayX:L,overlayY:w,offsetY:-q},{originX:m,originY:T,overlayX:H,overlayY:w,offsetY:-q}])}_menuClosingActions(){let n=this._overlayRef.backdropClick(),s=this._overlayRef.detachments(),d=this._parentMaterialMenu?this._parentMaterialMenu.closed:Fe(),m=this._parentMaterialMenu?this._parentMaterialMenu._hovered().pipe(wn(_=>_!==this._menuItemInstance),wn(()=>this._menuOpen)):Fe();return io(n,d,m,s)}_handleMousedown(n){pg(n)||(this._openedBy=n.button===0?"mouse":void 0,this.triggersSubmenu()&&n.preventDefault())}_handleKeydown(n){let s=n.keyCode;(s===13||s===32)&&(this._openedBy="keyboard"),this.triggersSubmenu()&&(s===39&&this.dir==="ltr"||s===37&&this.dir==="rtl")&&(this._openedBy="keyboard",this.openMenu())}_handleClick(n){this.triggersSubmenu()?(n.stopPropagation(),this.openMenu()):this.toggleMenu()}_handleHover(){!this.triggersSubmenu()||!this._parentMaterialMenu||(this._hoverSubscription=this._parentMaterialMenu._hovered().pipe(wn(n=>n===this._menuItemInstance&&!n.disabled),ff(0,pv)).subscribe(()=>{this._openedBy="mouse",this.menu instanceof Va&&this.menu._isAnimating?this.menu._animationDone.pipe(Ji(1),ff(0,pv),ri(this._parentMaterialMenu._hovered())).subscribe(()=>this.openMenu()):this.openMenu()}))}_getPortal(n){return(!this._portal||this._portal.templateRef!==n.templateRef)&&(this._portal=new Fs(n.templateRef,this._viewContainerRef)),this._portal}};r.\u0275fac=function(s){return new(s||r)(B($n),B(Se),B(Mo),B(Jnt),B(QD,8),B(yl,10),B(To,8),B(Ls),B(ze))},r.\u0275dir=re({type:r,selectors:[["","mat-menu-trigger-for",""],["","matMenuTriggerFor",""]],hostAttrs:[1,"mat-mdc-menu-trigger"],hostVars:3,hostBindings:function(s,d){s&1&&ct("click",function(_){return d._handleClick(_)})("mousedown",function(_){return d._handleMousedown(_)})("keydown",function(_){return d._handleKeydown(_)}),s&2&&oi("aria-haspopup",d.menu?"menu":null)("aria-expanded",d.menuOpen)("aria-controls",d.menuOpen?d.menu.panelId:null)},inputs:{_deprecatedMatMenuTriggerFor:[Rt.None,"mat-menu-trigger-for","_deprecatedMatMenuTriggerFor"],menu:[Rt.None,"matMenuTriggerFor","menu"],menuData:[Rt.None,"matMenuTriggerData","menuData"],restoreFocus:[Rt.None,"matMenuTriggerRestoreFocus","restoreFocus"]},outputs:{menuOpened:"menuOpened",onMenuOpen:"onMenuOpen",menuClosed:"menuClosed",onMenuClose:"onMenuClose"},exportAs:["matMenuTrigger"],standalone:!0});let a=r;return a})();var trt=["trigger"],ert=["panel"];function irt(a,r){if(a&1&&(A(0,"span",9),V(1),k()),a&2){let l=vt();N(),De(l.placeholder)}}function nrt(a,r){a&1&&Ti(0)}function rrt(a,r){if(a&1&&(A(0,"span",11),V(1),k()),a&2){let l=vt(2);N(),De(l.triggerValue)}}function ort(a,r){if(a&1&&(A(0,"span",10),mt(1,nrt,1,0)(2,rrt,2,1),k()),a&2){let l=vt();N(),$i(1,l.customTrigger?1:2)}}function srt(a,r){if(a&1){let l=Ce();As(),gu(),A(0,"div",12,13),ct("@transformPanel.done",function(s){te(l);let d=vt();return ee(d._panelDoneAnimatingStream.next(s.toState))})("keydown",function(s){te(l);let d=vt();return ee(d._handleKeydown(s))}),Ti(2,1),k()}if(a&2){let l=vt();KF("mat-mdc-select-panel mdc-menu-surface mdc-menu-surface--open ",l._getPanelTheme(),""),Z("ngClass",l.panelClass)("@transformPanel","showing"),oi("id",l.id+"-panel")("aria-multiselectable",l.multiple)("aria-label",l.ariaLabel||null)("aria-labelledby",l._getPanelAriaLabelledby())}}var art=[[["mat-select-trigger"]],"*"],lrt=["mat-select-trigger","*"],crt={transformPanelWrap:Yr("transformPanelWrap",[Sn("* => void",Av("@transformPanel",[Iv()],{optional:!0}))]),transformPanel:Yr("transformPanel",[Wn("void",Ei({opacity:0,transform:"scale(1, 0.8)"})),Sn("void => showing",Bn("120ms cubic-bezier(0, 0, 0.2, 1)",Ei({opacity:1,transform:"scale(1, 1)"}))),Sn("* => void",Bn("100ms linear",Ei({opacity:0})))])};var s5=0,drt=new we("mat-select-scroll-strategy",{providedIn:"root",factory:()=>{let a=oe($n);return()=>a.scrollStrategies.reposition()}});var urt=new we("MAT_SELECT_CONFIG");var hrt=new we("MatSelectTrigger"),JD=class{constructor(r,l){this.source=r,this.value=l}},a5=(()=>{let r=class r{_scrollOptionIntoView(n){let s=this.options.toArray()[n];if(s){let d=this.panel.nativeElement,m=zz(n,this.options,this.optionGroups),_=s._getHostElement();n===0&&m===1?d.scrollTop=0:d.scrollTop=Nz(_.offsetTop,_.offsetHeight,d.scrollTop,d.offsetHeight)}}_positioningSettled(){this._scrollOptionIntoView(this._keyManager.activeItemIndex||0)}_getChangeEvent(n){return new JD(this,n)}get focused(){return this._focused||this._panelOpen}get hideSingleSelectionIndicator(){return this._hideSingleSelectionIndicator}set hideSingleSelectionIndicator(n){this._hideSingleSelectionIndicator=n,this._syncParentProperties()}get placeholder(){return this._placeholder}set placeholder(n){this._placeholder=n,this.stateChanges.next()}get required(){return this._required??this.ngControl?.control?.hasValidator(Le.required)??!1}set required(n){this._required=n,this.stateChanges.next()}get multiple(){return this._multiple}set multiple(n){this._selectionModel,this._multiple=n}get compareWith(){return this._compareWith}set compareWith(n){this._compareWith=n,this._selectionModel&&this._initializeSelection()}get value(){return this._value}set value(n){this._assignValue(n)&&this._onChange(n)}get errorStateMatcher(){return this._errorStateTracker.matcher}set errorStateMatcher(n){this._errorStateTracker.matcher=n}get id(){return this._id}set id(n){this._id=n||this._uid,this.stateChanges.next()}get errorState(){return this._errorStateTracker.errorState}set errorState(n){this._errorStateTracker.errorState=n}constructor(n,s,d,m,_,w,S,T,L,H,q,X,it,at){this._viewportRuler=n,this._changeDetectorRef=s,this._ngZone=d,this._elementRef=_,this._dir=w,this._parentFormField=L,this.ngControl=H,this._liveAnnouncer=it,this._defaultOptions=at,this._positions=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:"mat-mdc-select-panel-above"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:"mat-mdc-select-panel-above"}],this._panelOpen=!1,this._compareWith=(ut,Mt)=>ut===Mt,this._uid=`mat-select-${s5++}`,this._triggerAriaLabelledBy=null,this._destroy=new pe,this.stateChanges=new pe,this._onChange=()=>{},this._onTouched=()=>{},this._valueId=`mat-select-value-${s5++}`,this._panelDoneAnimatingStream=new pe,this._overlayPanelClass=this._defaultOptions?.overlayPanelClass||"",this._focused=!1,this.controlType="mat-select",this.disabled=!1,this.disableRipple=!1,this.tabIndex=0,this._hideSingleSelectionIndicator=this._defaultOptions?.hideSingleSelectionIndicator??!1,this._multiple=!1,this.disableOptionCentering=this._defaultOptions?.disableOptionCentering??!1,this.ariaLabel="",this.panelWidth=this._defaultOptions&&typeof this._defaultOptions.panelWidth<"u"?this._defaultOptions.panelWidth:"auto",this.optionSelectionChanges=xc(()=>{let ut=this.options;return ut?ut.changes.pipe(co(ut),no(()=>io(...ut.map(Mt=>Mt.onSelectionChange)))):this._ngZone.onStable.pipe(Ji(1),no(()=>this.optionSelectionChanges))}),this.openedChange=new ye,this._openedStream=this.openedChange.pipe(wn(ut=>ut),Fi(()=>{})),this._closedStream=this.openedChange.pipe(wn(ut=>!ut),Fi(()=>{})),this.selectionChange=new ye,this.valueChange=new ye,this._trackedModal=null,this._skipPredicate=ut=>this.panelOpen?!1:ut.disabled,this.ngControl&&(this.ngControl.valueAccessor=this),at?.typeaheadDebounceInterval!=null&&(this.typeaheadDebounceInterval=at.typeaheadDebounceInterval),this._errorStateTracker=new Ou(m,H,T,S,this.stateChanges),this._scrollStrategyFactory=X,this._scrollStrategy=this._scrollStrategyFactory(),this.tabIndex=parseInt(q)||0,this.id=this.id}ngOnInit(){this._selectionModel=new ry(this.multiple),this.stateChanges.next(),this._panelDoneAnimatingStream.pipe(gf(),ri(this._destroy)).subscribe(()=>this._panelDoneAnimating(this.panelOpen)),this._viewportRuler.change().pipe(ri(this._destroy)).subscribe(()=>{this.panelOpen&&(this._overlayWidth=this._getOverlayWidth(this._preferredOverlayOrigin),this._changeDetectorRef.detectChanges())})}ngAfterContentInit(){this._initKeyManager(),this._selectionModel.changed.pipe(ri(this._destroy)).subscribe(n=>{n.added.forEach(s=>s.select()),n.removed.forEach(s=>s.deselect())}),this.options.changes.pipe(co(null),ri(this._destroy)).subscribe(()=>{this._resetOptions(),this._initializeSelection()})}ngDoCheck(){let n=this._getTriggerAriaLabelledby(),s=this.ngControl;if(n!==this._triggerAriaLabelledBy){let d=this._elementRef.nativeElement;this._triggerAriaLabelledBy=n,n?d.setAttribute("aria-labelledby",n):d.removeAttribute("aria-labelledby")}s&&(this._previousControl!==s.control&&(this._previousControl!==void 0&&s.disabled!==null&&s.disabled!==this.disabled&&(this.disabled=s.disabled),this._previousControl=s.control),this.updateErrorState())}ngOnChanges(n){(n.disabled||n.userAriaDescribedBy)&&this.stateChanges.next(),n.typeaheadDebounceInterval&&this._keyManager&&this._keyManager.withTypeAhead(this.typeaheadDebounceInterval)}ngOnDestroy(){this._keyManager?.destroy(),this._destroy.next(),this._destroy.complete(),this.stateChanges.complete(),this._clearFromModal()}toggle(){this.panelOpen?this.close():this.open()}open(){this._canOpen()&&(this._parentFormField&&(this._preferredOverlayOrigin=this._parentFormField.getConnectedOverlayOrigin()),this._overlayWidth=this._getOverlayWidth(this._preferredOverlayOrigin),this._applyModalPanelOwnership(),this._panelOpen=!0,this._keyManager.withHorizontalOrientation(null),this._highlightCorrectOption(),this._changeDetectorRef.markForCheck(),this.stateChanges.next())}_applyModalPanelOwnership(){let n=this._elementRef.nativeElement.closest('body > .cdk-overlay-container [aria-modal="true"]');if(!n)return;let s=`${this.id}-panel`;this._trackedModal&&ky(this._trackedModal,"aria-owns",s),uM(n,"aria-owns",s),this._trackedModal=n}_clearFromModal(){if(!this._trackedModal)return;let n=`${this.id}-panel`;ky(this._trackedModal,"aria-owns",n),this._trackedModal=null}close(){this._panelOpen&&(this._panelOpen=!1,this._keyManager.withHorizontalOrientation(this._isRtl()?"rtl":"ltr"),this._changeDetectorRef.markForCheck(),this._onTouched(),this.stateChanges.next())}writeValue(n){this._assignValue(n)}registerOnChange(n){this._onChange=n}registerOnTouched(n){this._onTouched=n}setDisabledState(n){this.disabled=n,this._changeDetectorRef.markForCheck(),this.stateChanges.next()}get panelOpen(){return this._panelOpen}get selected(){return this.multiple?this._selectionModel?.selected||[]:this._selectionModel?.selected[0]}get triggerValue(){if(this.empty)return"";if(this._multiple){let n=this._selectionModel.selected.map(s=>s.viewValue);return this._isRtl()&&n.reverse(),n.join(", ")}return this._selectionModel.selected[0].viewValue}updateErrorState(){this._errorStateTracker.updateErrorState()}_isRtl(){return this._dir?this._dir.value==="rtl":!1}_handleKeydown(n){this.disabled||(this.panelOpen?this._handleOpenKeydown(n):this._handleClosedKeydown(n))}_handleClosedKeydown(n){let s=n.keyCode,d=s===40||s===38||s===37||s===39,m=s===13||s===32,_=this._keyManager;if(!_.isTyping()&&m&&!Zr(n)||(this.multiple||n.altKey)&&d)n.preventDefault(),this.open();else if(!this.multiple){let w=this.selected;_.onKeydown(n);let S=this.selected;S&&w!==S&&this._liveAnnouncer.announce(S.viewValue,1e4)}}_handleOpenKeydown(n){let s=this._keyManager,d=n.keyCode,m=d===40||d===38,_=s.isTyping();if(m&&n.altKey)n.preventDefault(),this.close();else if(!_&&(d===13||d===32)&&s.activeItem&&!Zr(n))n.preventDefault(),s.activeItem._selectViaInteraction();else if(!_&&this._multiple&&d===65&&n.ctrlKey){n.preventDefault();let w=this.options.some(S=>!S.disabled&&!S.selected);this.options.forEach(S=>{S.disabled||(w?S.select():S.deselect())})}else{let w=s.activeItemIndex;s.onKeydown(n),this._multiple&&m&&n.shiftKey&&s.activeItem&&s.activeItemIndex!==w&&s.activeItem._selectViaInteraction()}}_onFocus(){this.disabled||(this._focused=!0,this.stateChanges.next())}_onBlur(){this._focused=!1,this._keyManager?.cancelTypeahead(),!this.disabled&&!this.panelOpen&&(this._onTouched(),this._changeDetectorRef.markForCheck(),this.stateChanges.next())}_onAttached(){this._overlayDir.positionChange.pipe(Ji(1)).subscribe(()=>{this._changeDetectorRef.detectChanges(),this._positioningSettled()})}_getPanelTheme(){return this._parentFormField?`mat-${this._parentFormField.color}`:""}get empty(){return!this._selectionModel||this._selectionModel.isEmpty()}_initializeSelection(){Promise.resolve().then(()=>{this.ngControl&&(this._value=this.ngControl.value),this._setSelectionByValue(this._value),this.stateChanges.next()})}_setSelectionByValue(n){if(this.options.forEach(s=>s.setInactiveStyles()),this._selectionModel.clear(),this.multiple&&n)Array.isArray(n),n.forEach(s=>this._selectOptionByValue(s)),this._sortValues();else{let s=this._selectOptionByValue(n);s?this._keyManager.updateActiveItem(s):this.panelOpen||this._keyManager.updateActiveItem(-1)}this._changeDetectorRef.markForCheck()}_selectOptionByValue(n){let s=this.options.find(d=>{if(this._selectionModel.isSelected(d))return!1;try{return d.value!=null&&this._compareWith(d.value,n)}catch{return!1}});return s&&this._selectionModel.select(s),s}_assignValue(n){return n!==this._value||this._multiple&&Array.isArray(n)?(this.options&&this._setSelectionByValue(n),this._value=n,!0):!1}_getOverlayWidth(n){return this.panelWidth==="auto"?(n instanceof ay?n.elementRef:n||this._elementRef).nativeElement.getBoundingClientRect().width:this.panelWidth===null?"":this.panelWidth}_syncParentProperties(){if(this.options)for(let n of this.options)n._changeDetectorRef.markForCheck()}_initKeyManager(){this._keyManager=new Iy(this.options).withTypeAhead(this.typeaheadDebounceInterval).withVerticalOrientation().withHorizontalOrientation(this._isRtl()?"rtl":"ltr").withHomeAndEnd().withPageUpDown().withAllowedModifierKeys(["shiftKey"]).skipPredicate(this._skipPredicate),this._keyManager.tabOut.subscribe(()=>{this.panelOpen&&(!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction(),this.focus(),this.close())}),this._keyManager.change.subscribe(()=>{this._panelOpen&&this.panel?this._scrollOptionIntoView(this._keyManager.activeItemIndex||0):!this._panelOpen&&!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction()})}_resetOptions(){let n=io(this.options.changes,this._destroy);this.optionSelectionChanges.pipe(ri(n)).subscribe(s=>{this._onSelect(s.source,s.isUserInput),s.isUserInput&&!this.multiple&&this._panelOpen&&(this.close(),this.focus())}),io(...this.options.map(s=>s._stateChanges)).pipe(ri(n)).subscribe(()=>{this._changeDetectorRef.detectChanges(),this.stateChanges.next()})}_onSelect(n,s){let d=this._selectionModel.isSelected(n);n.value==null&&!this._multiple?(n.deselect(),this._selectionModel.clear(),this.value!=null&&this._propagateChanges(n.value)):(d!==n.selected&&(n.selected?this._selectionModel.select(n):this._selectionModel.deselect(n)),s&&this._keyManager.setActiveItem(n),this.multiple&&(this._sortValues(),s&&this.focus())),d!==this._selectionModel.isSelected(n)&&this._propagateChanges(),this.stateChanges.next()}_sortValues(){if(this.multiple){let n=this.options.toArray();this._selectionModel.sort((s,d)=>this.sortComparator?this.sortComparator(s,d,n):n.indexOf(s)-n.indexOf(d)),this.stateChanges.next()}}_propagateChanges(n){let s;this.multiple?s=this.selected.map(d=>d.value):s=this.selected?this.selected.value:n,this._value=s,this.valueChange.emit(s),this._onChange(s),this.selectionChange.emit(this._getChangeEvent(s)),this._changeDetectorRef.markForCheck()}_highlightCorrectOption(){if(this._keyManager)if(this.empty){let n=-1;for(let s=0;s<this.options.length;s++)if(!this.options.get(s).disabled){n=s;break}this._keyManager.setActiveItem(n)}else this._keyManager.setActiveItem(this._selectionModel.selected[0])}_canOpen(){return!this._panelOpen&&!this.disabled&&this.options?.length>0}focus(n){this._elementRef.nativeElement.focus(n)}_getPanelAriaLabelledby(){if(this.ariaLabel)return null;let n=this._parentFormField?.getLabelId(),s=n?n+" ":"";return this.ariaLabelledby?s+this.ariaLabelledby:n}_getAriaActiveDescendant(){return this.panelOpen&&this._keyManager&&this._keyManager.activeItem?this._keyManager.activeItem.id:null}_getTriggerAriaLabelledby(){if(this.ariaLabel)return null;let n=this._parentFormField?.getLabelId(),s=(n?n+" ":"")+this._valueId;return this.ariaLabelledby&&(s+=" "+this.ariaLabelledby),s}_panelDoneAnimating(n){this.openedChange.emit(n)}setDescribedByIds(n){n.length?this._elementRef.nativeElement.setAttribute("aria-describedby",n.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focus(),this.open()}get shouldLabelFloat(){return this.panelOpen||!this.empty||this.focused&&!!this.placeholder}};r.\u0275fac=function(s){return new(s||r)(B(vd),B(Wi),B(ze),B(_g),B(Se),B(To,8),B(cg,8),B(Vn,8),B(Fu,8),B(ms,10),rl("tabindex"),B(drt),B(Py),B(urt,8))},r.\u0275cmp=Et({type:r,selectors:[["mat-select"]],contentQueries:function(s,d,m){if(s&1&&(mn(m,hrt,5),mn(m,Ny,5),mn(m,bM,5)),s&2){let _;ce(_=de())&&(d.customTrigger=_.first),ce(_=de())&&(d.options=_),ce(_=de())&&(d.optionGroups=_)}},viewQuery:function(s,d){if(s&1&&(Ge(trt,5),Ge(ert,5),Ge(XE,5)),s&2){let m;ce(m=de())&&(d.trigger=m.first),ce(m=de())&&(d.panel=m.first),ce(m=de())&&(d._overlayDir=m.first)}},hostAttrs:["role","combobox","aria-autocomplete","none","aria-haspopup","listbox",1,"mat-mdc-select"],hostVars:19,hostBindings:function(s,d){s&1&&ct("keydown",function(_){return d._handleKeydown(_)})("focus",function(){return d._onFocus()})("blur",function(){return d._onBlur()}),s&2&&(oi("id",d.id)("tabindex",d.disabled?-1:d.tabIndex)("aria-controls",d.panelOpen?d.id+"-panel":null)("aria-expanded",d.panelOpen)("aria-label",d.ariaLabel||null)("aria-required",d.required.toString())("aria-disabled",d.disabled.toString())("aria-invalid",d.errorState)("aria-activedescendant",d._getAriaActiveDescendant()),ei("mat-mdc-select-disabled",d.disabled)("mat-mdc-select-invalid",d.errorState)("mat-mdc-select-required",d.required)("mat-mdc-select-empty",d.empty)("mat-mdc-select-multiple",d.multiple))},inputs:{userAriaDescribedBy:[Rt.None,"aria-describedby","userAriaDescribedBy"],panelClass:"panelClass",disabled:[Rt.HasDecoratorInputTransform,"disabled","disabled",Qe],disableRipple:[Rt.HasDecoratorInputTransform,"disableRipple","disableRipple",Qe],tabIndex:[Rt.HasDecoratorInputTransform,"tabIndex","tabIndex",n=>n==null?0:ll(n)],hideSingleSelectionIndicator:[Rt.HasDecoratorInputTransform,"hideSingleSelectionIndicator","hideSingleSelectionIndicator",Qe],placeholder:"placeholder",required:[Rt.HasDecoratorInputTransform,"required","required",Qe],multiple:[Rt.HasDecoratorInputTransform,"multiple","multiple",Qe],disableOptionCentering:[Rt.HasDecoratorInputTransform,"disableOptionCentering","disableOptionCentering",Qe],compareWith:"compareWith",value:"value",ariaLabel:[Rt.None,"aria-label","ariaLabel"],ariaLabelledby:[Rt.None,"aria-labelledby","ariaLabelledby"],errorStateMatcher:"errorStateMatcher",typeaheadDebounceInterval:[Rt.HasDecoratorInputTransform,"typeaheadDebounceInterval","typeaheadDebounceInterval",ll],sortComparator:"sortComparator",id:"id",panelWidth:"panelWidth"},outputs:{openedChange:"openedChange",_openedStream:"opened",_closedStream:"closed",selectionChange:"selectionChange",valueChange:"valueChange"},exportAs:["matSelect"],standalone:!0,features:[Ni([{provide:Tm,useExisting:r},{provide:yM,useExisting:r}]),Tn,qn,At],ngContentSelectors:lrt,decls:11,vars:8,consts:[["cdk-overlay-origin","",1,"mat-mdc-select-trigger",3,"click"],["fallbackOverlayOrigin","cdkOverlayOrigin","trigger",""],[1,"mat-mdc-select-value"],["class","mat-mdc-select-placeholder mat-mdc-select-min-line"],[1,"mat-mdc-select-arrow-wrapper"],[1,"mat-mdc-select-arrow"],["viewBox","0 0 24 24","width","24px","height","24px","focusable","false","aria-hidden","true"],["d","M7 10l5 5 5-5z"],["cdk-connected-overlay","","cdkConnectedOverlayLockPosition","","cdkConnectedOverlayHasBackdrop","","cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop",3,"cdkConnectedOverlayPanelClass","cdkConnectedOverlayScrollStrategy","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayPositions","cdkConnectedOverlayWidth","backdropClick","attach","detach"],[1,"mat-mdc-select-placeholder","mat-mdc-select-min-line"],[1,"mat-mdc-select-value-text"],[1,"mat-mdc-select-min-line"],["role","listbox","tabindex","-1",3,"ngClass","keydown"],["panel",""]],template:function(s,d){if(s&1&&(Nn(art),A(0,"div",0,1),ct("click",function(){return d.open()}),A(3,"div",2),mt(4,irt,2,1,"span",3)(5,ort,3,1),k(),A(6,"div",4)(7,"div",5),As(),A(8,"svg",6),dt(9,"path",7),k()()()(),mt(10,srt,3,9,"ng-template",8),ct("backdropClick",function(){return d.close()})("attach",function(){return d._onAttached()})("detach",function(){return d.close()})),s&2){let m=Ir(1);N(3),oi("id",d._valueId),N(),$i(4,d.empty?4:5),N(6),Z("cdkConnectedOverlayPanelClass",d._overlayPanelClass)("cdkConnectedOverlayScrollStrategy",d._scrollStrategy)("cdkConnectedOverlayOrigin",d._preferredOverlayOrigin||m)("cdkConnectedOverlayOpen",d.panelOpen)("cdkConnectedOverlayPositions",d._positions)("cdkConnectedOverlayWidth",d._overlayWidth)}},dependencies:[ay,XE,Zo],styles:['.mat-mdc-select{display:inline-block;width:100%;outline:none;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;color:var(--mat-select-enabled-trigger-text-color);font-family:var(--mat-select-trigger-text-font);line-height:var(--mat-select-trigger-text-line-height);font-size:var(--mat-select-trigger-text-size);font-weight:var(--mat-select-trigger-text-weight);letter-spacing:var(--mat-select-trigger-text-tracking)}div.mat-mdc-select-panel{box-shadow:var(--mat-select-container-elevation-shadow)}.mat-mdc-select-disabled{color:var(--mat-select-disabled-trigger-text-color)}.mat-mdc-select-trigger{display:inline-flex;align-items:center;cursor:pointer;position:relative;box-sizing:border-box;width:100%}.mat-mdc-select-disabled .mat-mdc-select-trigger{-webkit-user-select:none;user-select:none;cursor:default}.mat-mdc-select-value{width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.mat-mdc-select-value-text{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.mat-mdc-select-arrow-wrapper{height:24px;flex-shrink:0;display:inline-flex;align-items:center}.mat-form-field-appearance-fill .mdc-text-field--no-label .mat-mdc-select-arrow-wrapper{transform:none}.mat-mdc-form-field .mat-mdc-select.mat-mdc-select-invalid .mat-mdc-select-arrow,.mat-form-field-invalid:not(.mat-form-field-disabled) .mat-mdc-form-field-infix::after{color:var(--mat-select-invalid-arrow-color)}.mat-mdc-select-arrow{width:10px;height:5px;position:relative;color:var(--mat-select-enabled-arrow-color)}.mat-mdc-form-field.mat-focused .mat-mdc-select-arrow{color:var(--mat-select-focused-arrow-color)}.mat-mdc-form-field .mat-mdc-select.mat-mdc-select-disabled .mat-mdc-select-arrow{color:var(--mat-select-disabled-arrow-color)}.mat-mdc-select-arrow svg{fill:currentColor;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%)}.cdk-high-contrast-active .mat-mdc-select-arrow svg{fill:CanvasText}.mat-mdc-select-disabled .cdk-high-contrast-active .mat-mdc-select-arrow svg{fill:GrayText}div.mat-mdc-select-panel{width:100%;max-height:275px;outline:0;overflow:auto;padding:8px 0;border-radius:4px;box-sizing:border-box;position:static;background-color:var(--mat-select-panel-background-color)}.cdk-high-contrast-active div.mat-mdc-select-panel{outline:solid 1px}.cdk-overlay-pane:not(.mat-mdc-select-panel-above) div.mat-mdc-select-panel{border-top-left-radius:0;border-top-right-radius:0;transform-origin:top center}.mat-mdc-select-panel-above div.mat-mdc-select-panel{border-bottom-left-radius:0;border-bottom-right-radius:0;transform-origin:bottom center}div.mat-mdc-select-panel .mat-mdc-option{--mdc-list-list-item-container-color: var(--mat-select-panel-background-color)}.mat-mdc-select-placeholder{transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1);color:var(--mat-select-placeholder-text-color)}._mat-animation-noopable .mat-mdc-select-placeholder{transition:none}.mat-form-field-hide-placeholder .mat-mdc-select-placeholder{color:rgba(0,0,0,0);-webkit-text-fill-color:rgba(0,0,0,0);transition:none;display:block}.mat-mdc-form-field-type-mat-select:not(.mat-form-field-disabled) .mat-mdc-text-field-wrapper{cursor:pointer}.mat-mdc-form-field-type-mat-select.mat-form-field-appearance-fill .mat-mdc-floating-label{max-width:calc(100% - 18px)}.mat-mdc-form-field-type-mat-select.mat-form-field-appearance-fill .mdc-floating-label--float-above{max-width:calc(100%/0.75 - 24px)}.mat-mdc-form-field-type-mat-select.mat-form-field-appearance-outline .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mat-mdc-form-field-type-mat-select.mat-form-field-appearance-outline .mdc-text-field--label-floating .mdc-notched-outline__notch{max-width:calc(100% - 24px)}.mat-mdc-select-min-line:empty::before{content:" ";white-space:pre;width:1px;display:inline-block;visibility:hidden}.mat-form-field-appearance-fill .mat-mdc-select-arrow-wrapper{transform:var(--mat-select-arrow-transform)}'],encapsulation:2,data:{animation:[crt.transformPanel]},changeDetection:0});let a=r;return a})();var mrt=["tooltip"],prt=20;var frt=new we("mat-tooltip-scroll-strategy",{providedIn:"root",factory:()=>{let a=oe($n);return()=>a.scrollStrategies.reposition({scrollThrottle:prt})}});function grt(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500}}var _rt=new we("mat-tooltip-default-options",{providedIn:"root",factory:grt});var l5="tooltip-panel",c5=es({passive:!0}),vrt=500,yrt=8,brt=8,xrt=24,wrt=200,d5=(()=>{let r=class r{get position(){return this._position}set position(n){n!==this._position&&(this._position=n,this._overlayRef&&(this._updatePosition(this._overlayRef),this._tooltipInstance?.show(0),this._overlayRef.updatePosition()))}get positionAtOrigin(){return this._positionAtOrigin}set positionAtOrigin(n){this._positionAtOrigin=ro(n),this._detach(),this._overlayRef=null}get disabled(){return this._disabled}set disabled(n){this._disabled=ro(n),this._disabled?this.hide(0):this._setupPointerEnterEventsIfNeeded()}get showDelay(){return this._showDelay}set showDelay(n){this._showDelay=Hl(n)}get hideDelay(){return this._hideDelay}set hideDelay(n){this._hideDelay=Hl(n),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}get message(){return this._message}set message(n){this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._message,"tooltip"),this._message=n!=null?String(n).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage(),this._ngZone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._ariaDescriber.describe(this._elementRef.nativeElement,this.message,"tooltip")})}))}get tooltipClass(){return this._tooltipClass}set tooltipClass(n){this._tooltipClass=n,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}constructor(n,s,d,m,_,w,S,T,L,H,q,X){this._overlay=n,this._elementRef=s,this._scrollDispatcher=d,this._viewContainerRef=m,this._ngZone=_,this._platform=w,this._ariaDescriber=S,this._focusMonitor=T,this._dir=H,this._defaultOptions=q,this._position="below",this._positionAtOrigin=!1,this._disabled=!1,this._viewInitialized=!1,this._pointerExitEventsInitialized=!1,this._tooltipComponent=Crt,this._viewportMargin=8,this._cssClassPrefix="mat-mdc",this.touchGestures="auto",this._message="",this._passiveListeners=[],this._destroyed=new pe,this._scrollStrategy=L,this._document=X,q&&(this._showDelay=q.showDelay,this._hideDelay=q.hideDelay,q.position&&(this.position=q.position),q.positionAtOrigin&&(this.positionAtOrigin=q.positionAtOrigin),q.touchGestures&&(this.touchGestures=q.touchGestures)),H.change.pipe(ri(this._destroyed)).subscribe(()=>{this._overlayRef&&this._updatePosition(this._overlayRef)}),this._viewportMargin=yrt}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(ri(this._destroyed)).subscribe(n=>{n?n==="keyboard"&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){let n=this._elementRef.nativeElement;clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([s,d])=>{n.removeEventListener(s,d,c5)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),this._ariaDescriber.removeDescription(n,this.message,"tooltip"),this._focusMonitor.stopMonitoring(n)}show(n=this.showDelay,s){if(this.disabled||!this.message||this._isTooltipVisible()){this._tooltipInstance?._cancelPendingAnimations();return}let d=this._createOverlay(s);this._detach(),this._portal=this._portal||new is(this._tooltipComponent,this._viewContainerRef);let m=this._tooltipInstance=d.attach(this._portal).instance;m._triggerElement=this._elementRef.nativeElement,m._mouseLeaveHideDelay=this._hideDelay,m.afterHidden().pipe(ri(this._destroyed)).subscribe(()=>this._detach()),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),m.show(n)}hide(n=this.hideDelay){let s=this._tooltipInstance;s&&(s.isVisible()?s.hide(n):(s._cancelPendingAnimations(),this._detach()))}toggle(n){this._isTooltipVisible()?this.hide():this.show(void 0,n)}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(n){if(this._overlayRef){let m=this._overlayRef.getConfig().positionStrategy;if((!this.positionAtOrigin||!n)&&m._origin instanceof Se)return this._overlayRef;this._detach()}let s=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),d=this._overlay.position().flexibleConnectedTo(this.positionAtOrigin?n||this._elementRef:this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(s);return d.positionChanges.pipe(ri(this._destroyed)).subscribe(m=>{this._updateCurrentPositionClass(m.connectionPair),this._tooltipInstance&&m.scrollableViewProperties.isOverlayClipped&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({direction:this._dir,positionStrategy:d,panelClass:`${this._cssClassPrefix}-${l5}`,scrollStrategy:this._scrollStrategy()}),this._updatePosition(this._overlayRef),this._overlayRef.detachments().pipe(ri(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.outsidePointerEvents().pipe(ri(this._destroyed)).subscribe(()=>this._tooltipInstance?._handleBodyInteraction()),this._overlayRef.keydownEvents().pipe(ri(this._destroyed)).subscribe(m=>{this._isTooltipVisible()&&m.keyCode===27&&!Zr(m)&&(m.preventDefault(),m.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._defaultOptions?.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&this._overlayRef.detach(),this._tooltipInstance=null}_updatePosition(n){let s=n.getConfig().positionStrategy,d=this._getOrigin(),m=this._getOverlayPosition();s.withPositions([this._addOffset(Gt(Gt({},d.main),m.main)),this._addOffset(Gt(Gt({},d.fallback),m.fallback))])}_addOffset(n){let s=brt,d=!this._dir||this._dir.value=="ltr";return n.originY==="top"?n.offsetY=-s:n.originY==="bottom"?n.offsetY=s:n.originX==="start"?n.offsetX=d?-s:s:n.originX==="end"&&(n.offsetX=d?s:-s),n}_getOrigin(){let n=!this._dir||this._dir.value=="ltr",s=this.position,d;s=="above"||s=="below"?d={originX:"center",originY:s=="above"?"top":"bottom"}:s=="before"||s=="left"&&n||s=="right"&&!n?d={originX:"start",originY:"center"}:(s=="after"||s=="right"&&n||s=="left"&&!n)&&(d={originX:"end",originY:"center"});let{x:m,y:_}=this._invertPosition(d.originX,d.originY);return{main:d,fallback:{originX:m,originY:_}}}_getOverlayPosition(){let n=!this._dir||this._dir.value=="ltr",s=this.position,d;s=="above"?d={overlayX:"center",overlayY:"bottom"}:s=="below"?d={overlayX:"center",overlayY:"top"}:s=="before"||s=="left"&&n||s=="right"&&!n?d={overlayX:"end",overlayY:"center"}:(s=="after"||s=="right"&&n||s=="left"&&!n)&&(d={overlayX:"start",overlayY:"center"});let{x:m,y:_}=this._invertPosition(d.overlayX,d.overlayY);return{main:d,fallback:{overlayX:m,overlayY:_}}}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),this._ngZone.onMicrotaskEmpty.pipe(Ji(1),ri(this._destroyed)).subscribe(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()}))}_setTooltipClass(n){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=n,this._tooltipInstance._markForCheck())}_invertPosition(n,s){return this.position==="above"||this.position==="below"?s==="top"?s="bottom":s==="bottom"&&(s="top"):n==="end"?n="start":n==="start"&&(n="end"),{x:n,y:s}}_updateCurrentPositionClass(n){let{overlayY:s,originX:d,originY:m}=n,_;if(s==="center"?this._dir&&this._dir.value==="rtl"?_=d==="end"?"left":"right":_=d==="start"?"left":"right":_=s==="bottom"&&m==="top"?"above":"below",_!==this._currentPosition){let w=this._overlayRef;if(w){let S=`${this._cssClassPrefix}-${l5}-`;w.removePanelClass(S+this._currentPosition),w.addPanelClass(S+_)}this._currentPosition=_}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||(this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",n=>{this._setupPointerExitEventsIfNeeded();let s;n.x!==void 0&&n.y!==void 0&&(s=n),this.show(void 0,s)}]):this.touchGestures!=="off"&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",n=>{let s=n.targetTouches?.[0],d=s?{x:s.clientX,y:s.clientY}:void 0;this._setupPointerExitEventsIfNeeded(),clearTimeout(this._touchstartTimeout),this._touchstartTimeout=setTimeout(()=>this.show(void 0,d),vrt)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;let n=[];if(this._platformSupportsMouseEvents())n.push(["mouseleave",s=>{let d=s.relatedTarget;(!d||!this._overlayRef?.overlayElement.contains(d))&&this.hide()}],["wheel",s=>this._wheelListener(s)]);else if(this.touchGestures!=="off"){this._disableNativeGesturesIfNecessary();let s=()=>{clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions.touchendHideDelay)};n.push(["touchend",s],["touchcancel",s])}this._addListeners(n),this._passiveListeners.push(...n)}_addListeners(n){n.forEach(([s,d])=>{this._elementRef.nativeElement.addEventListener(s,d,c5)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(n){if(this._isTooltipVisible()){let s=this._document.elementFromPoint(n.clientX,n.clientY),d=this._elementRef.nativeElement;s!==d&&!d.contains(s)&&this.hide()}}_disableNativeGesturesIfNecessary(){let n=this.touchGestures;if(n!=="off"){let s=this._elementRef.nativeElement,d=s.style;(n==="on"||s.nodeName!=="INPUT"&&s.nodeName!=="TEXTAREA")&&(d.userSelect=d.msUserSelect=d.webkitUserSelect=d.MozUserSelect="none"),(n==="on"||!s.draggable)&&(d.webkitUserDrag="none"),d.touchAction="none",d.webkitTapHighlightColor="transparent"}}};r.\u0275fac=function(s){return new(s||r)(B($n),B(Se),B(Xf),B(Mo),B(ze),B(pn),B(Ry),B(Ls),B(frt),B(To),B(_rt,8),B(li))},r.\u0275dir=re({type:r,selectors:[["","matTooltip",""]],hostAttrs:[1,"mat-mdc-tooltip-trigger"],hostVars:2,hostBindings:function(s,d){s&2&&ei("mat-mdc-tooltip-disabled",d.disabled)},inputs:{position:[Rt.None,"matTooltipPosition","position"],positionAtOrigin:[Rt.None,"matTooltipPositionAtOrigin","positionAtOrigin"],disabled:[Rt.None,"matTooltipDisabled","disabled"],showDelay:[Rt.None,"matTooltipShowDelay","showDelay"],hideDelay:[Rt.None,"matTooltipHideDelay","hideDelay"],touchGestures:[Rt.None,"matTooltipTouchGestures","touchGestures"],message:[Rt.None,"matTooltip","message"],tooltipClass:[Rt.None,"matTooltipClass","tooltipClass"]},exportAs:["matTooltip"],standalone:!0});let a=r;return a})(),Crt=(()=>{let r=class r{constructor(n,s,d){this._changeDetectorRef=n,this._elementRef=s,this._isMultiline=!1,this._closeOnInteraction=!1,this._isVisible=!1,this._onHide=new pe,this._showAnimation="mat-mdc-tooltip-show",this._hideAnimation="mat-mdc-tooltip-hide",this._animationsDisabled=d==="NoopAnimations"}show(n){this._hideTimeoutId!=null&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=setTimeout(()=>{this._toggleVisibility(!0),this._showTimeoutId=void 0},n)}hide(n){this._showTimeoutId!=null&&clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0},n)}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){this._cancelPendingAnimations(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:n}){(!n||!this._triggerElement.contains(n))&&(this.isVisible()?this.hide(this._mouseLeaveHideDelay):this._finalizeAnimation(!1))}_onShow(){this._isMultiline=this._isTooltipMultiline(),this._markForCheck()}_isTooltipMultiline(){let n=this._elementRef.nativeElement.getBoundingClientRect();return n.height>xrt&&n.width>=wrt}_handleAnimationEnd({animationName:n}){(n===this._showAnimation||n===this._hideAnimation)&&this._finalizeAnimation(n===this._showAnimation)}_cancelPendingAnimations(){this._showTimeoutId!=null&&clearTimeout(this._showTimeoutId),this._hideTimeoutId!=null&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=this._hideTimeoutId=void 0}_finalizeAnimation(n){n?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next()}_toggleVisibility(n){let s=this._tooltip.nativeElement,d=this._showAnimation,m=this._hideAnimation;if(s.classList.remove(n?m:d),s.classList.add(n?d:m),this._isVisible=n,n&&!this._animationsDisabled&&typeof getComputedStyle=="function"){let _=getComputedStyle(s);(_.getPropertyValue("animation-duration")==="0s"||_.getPropertyValue("animation-name")==="none")&&(this._animationsDisabled=!0)}n&&this._onShow(),this._animationsDisabled&&(s.classList.add("_mat-animation-noopable"),this._finalizeAnimation(n))}};r.\u0275fac=function(s){return new(s||r)(B(Wi),B(Se),B(So,8))},r.\u0275cmp=Et({type:r,selectors:[["mat-tooltip-component"]],viewQuery:function(s,d){if(s&1&&Ge(mrt,7),s&2){let m;ce(m=de())&&(d._tooltip=m.first)}},hostAttrs:["aria-hidden","true"],hostVars:2,hostBindings:function(s,d){s&1&&ct("mouseleave",function(_){return d._handleMouseLeave(_)}),s&2&&Sc("zoom",d.isVisible()?1:null)},standalone:!0,features:[At],decls:4,vars:4,consts:[[1,"mdc-tooltip","mdc-tooltip--shown","mat-mdc-tooltip",3,"ngClass","animationend"],["tooltip",""],[1,"mdc-tooltip__surface","mdc-tooltip__surface-animation"]],template:function(s,d){s&1&&(A(0,"div",0,1),ct("animationend",function(_){return d._handleAnimationEnd(_)}),A(2,"div",2),V(3),k()()),s&2&&(ei("mdc-tooltip--multiline",d._isMultiline),Z("ngClass",d.tooltipClass),N(3),De(d.message))},dependencies:[Zo],styles:['.mdc-tooltip__surface{word-break:break-all;word-break:var(--mdc-tooltip-word-break, normal);overflow-wrap:anywhere}.mdc-tooltip--showing-transition .mdc-tooltip__surface-animation{transition:opacity 150ms 0ms cubic-bezier(0, 0, 0.2, 1),transform 150ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-tooltip--hide-transition .mdc-tooltip__surface-animation{transition:opacity 75ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-tooltip{position:fixed;display:none;z-index:9}.mdc-tooltip-wrapper--rich{position:relative}.mdc-tooltip--shown,.mdc-tooltip--showing,.mdc-tooltip--hide{display:inline-flex}.mdc-tooltip--shown.mdc-tooltip--rich,.mdc-tooltip--showing.mdc-tooltip--rich,.mdc-tooltip--hide.mdc-tooltip--rich{display:inline-block;left:-320px;position:absolute}.mdc-tooltip__surface{line-height:16px;padding:4px 8px;min-width:40px;max-width:200px;min-height:24px;max-height:40vh;box-sizing:border-box;overflow:hidden;text-align:center}.mdc-tooltip__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-tooltip__surface::before{border-color:CanvasText}}.mdc-tooltip--rich .mdc-tooltip__surface{align-items:flex-start;display:flex;flex-direction:column;min-height:24px;min-width:40px;max-width:320px;position:relative}.mdc-tooltip--multiline .mdc-tooltip__surface{text-align:left}[dir=rtl] .mdc-tooltip--multiline .mdc-tooltip__surface,.mdc-tooltip--multiline .mdc-tooltip__surface[dir=rtl]{text-align:right}.mdc-tooltip__surface .mdc-tooltip__title{margin:0 8px}.mdc-tooltip__surface .mdc-tooltip__content{max-width:calc(200px - 2*8px);margin:8px;text-align:left}[dir=rtl] .mdc-tooltip__surface .mdc-tooltip__content,.mdc-tooltip__surface .mdc-tooltip__content[dir=rtl]{text-align:right}.mdc-tooltip--rich .mdc-tooltip__surface .mdc-tooltip__content{max-width:calc(320px - 2*8px);align-self:stretch}.mdc-tooltip__surface .mdc-tooltip__content-link{text-decoration:none}.mdc-tooltip--rich-actions,.mdc-tooltip__content,.mdc-tooltip__title{z-index:1}.mdc-tooltip__surface-animation{opacity:0;transform:scale(0.8);will-change:transform,opacity}.mdc-tooltip--shown .mdc-tooltip__surface-animation{transform:scale(1);opacity:1}.mdc-tooltip--hide .mdc-tooltip__surface-animation{transform:scale(1)}.mdc-tooltip__caret-surface-top,.mdc-tooltip__caret-surface-bottom{position:absolute;height:24px;width:24px;transform:rotate(35deg) skewY(20deg) scaleX(0.9396926208)}.mdc-tooltip__caret-surface-top .mdc-elevation-overlay,.mdc-tooltip__caret-surface-bottom .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-tooltip__caret-surface-bottom{box-shadow:0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12);outline:1px solid rgba(0,0,0,0);z-index:-1}@media screen and (forced-colors: active){.mdc-tooltip__caret-surface-bottom{outline-color:CanvasText}}.mat-mdc-tooltip .mdc-tooltip__surface{background-color:var(--mdc-plain-tooltip-container-color)}.mat-mdc-tooltip .mdc-tooltip__surface{border-radius:var(--mdc-plain-tooltip-container-shape)}.mat-mdc-tooltip .mdc-tooltip__caret-surface-top,.mat-mdc-tooltip .mdc-tooltip__caret-surface-bottom{border-radius:var(--mdc-plain-tooltip-container-shape)}.mat-mdc-tooltip .mdc-tooltip__surface{color:var(--mdc-plain-tooltip-supporting-text-color)}.mat-mdc-tooltip .mdc-tooltip__surface{font-family:var(--mdc-plain-tooltip-supporting-text-font);line-height:var(--mdc-plain-tooltip-supporting-text-line-height);font-size:var(--mdc-plain-tooltip-supporting-text-size);font-weight:var(--mdc-plain-tooltip-supporting-text-weight);letter-spacing:var(--mdc-plain-tooltip-supporting-text-tracking)}.mat-mdc-tooltip{position:relative;transform:scale(0)}.mat-mdc-tooltip::before{content:"";top:0;right:0;bottom:0;left:0;z-index:-1;position:absolute}.mat-mdc-tooltip-panel-below .mat-mdc-tooltip::before{top:-8px}.mat-mdc-tooltip-panel-above .mat-mdc-tooltip::before{bottom:-8px}.mat-mdc-tooltip-panel-right .mat-mdc-tooltip::before{left:-8px}.mat-mdc-tooltip-panel-left .mat-mdc-tooltip::before{right:-8px}.mat-mdc-tooltip._mat-animation-noopable{animation:none;transform:scale(1)}.mat-mdc-tooltip-panel.mat-mdc-tooltip-panel-non-interactive{pointer-events:none}@keyframes mat-mdc-tooltip-show{0%{opacity:0;transform:scale(0.8)}100%{opacity:1;transform:scale(1)}}@keyframes mat-mdc-tooltip-hide{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(0.8)}}.mat-mdc-tooltip-show{animation:mat-mdc-tooltip-show 150ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-mdc-tooltip-hide{animation:mat-mdc-tooltip-hide 75ms cubic-bezier(0.4, 0, 1, 1) forwards}'],encapsulation:2,changeDetection:0});let a=r;return a})();function Srt(a,r){if(a&1&&(A(0,"mat-option",18),V(1),k()),a&2){let l=r.$implicit;Z("value",l),N(),ae(" ",l," ")}}function Ert(a,r){if(a&1){let l=Ce();A(0,"mat-form-field",16)(1,"mat-select",17),ct("selectionChange",function(s){te(l);let d=vt(2);return ee(d._changePageSize(s.value))}),Xh(2,Srt,2,2,"mat-option",18,Zh),k()()}if(a&2){let l=vt(2);Z("appearance",l._formFieldAppearance)("color",l.color),N(),Z("value",l.pageSize)("disabled",l.disabled)("aria-labelledby",l._pageSizeLabelId)("panelClass",l.selectConfig.panelClass||"")("disableOptionCentering",l.selectConfig.disableOptionCentering),N(),Kh(l._displayedPageSizeOptions)}}function Mrt(a,r){if(a&1&&(A(0,"div",19),V(1),k()),a&2){let l=vt(2);N(),De(l.pageSize)}}function Drt(a,r){if(a&1&&(A(0,"div",12)(1,"div",13),V(2),k(),mt(3,Ert,4,7,"mat-form-field",14)(4,Mrt,2,1,"div",15),k()),a&2){let l=vt();N(),oi("id",l._pageSizeLabelId),N(),ae(" ",l._intl.itemsPerPageLabel," "),N(),$i(3,l._displayedPageSizeOptions.length>1?3:-1),N(),$i(4,l._displayedPageSizeOptions.length<=1?4:-1)}}function Trt(a,r){if(a&1){let l=Ce();A(0,"button",20),ct("click",function(){te(l);let s=vt();return ee(s.firstPage())}),As(),A(1,"svg",7),dt(2,"path",21),k()()}if(a&2){let l=vt();Z("matTooltip",l._intl.firstPageLabel)("matTooltipDisabled",l._previousButtonsDisabled())("matTooltipPosition","above")("disabled",l._previousButtonsDisabled()),oi("aria-label",l._intl.firstPageLabel)}}function Irt(a,r){if(a&1){let l=Ce();As(),gu(),A(0,"button",22),ct("click",function(){te(l);let s=vt();return ee(s.lastPage())}),As(),A(1,"svg",7),dt(2,"path",23),k()()}if(a&2){let l=vt();Z("matTooltip",l._intl.lastPageLabel)("matTooltipDisabled",l._nextButtonsDisabled())("matTooltipPosition","above")("disabled",l._nextButtonsDisabled()),oi("aria-label",l._intl.lastPageLabel)}}var Art=(()=>{let r=class r{constructor(){this.changes=new pe,this.itemsPerPageLabel="Items per page:",this.nextPageLabel="Next page",this.previousPageLabel="Previous page",this.firstPageLabel="First page",this.lastPageLabel="Last page",this.getRangeLabel=(n,s,d)=>{if(d==0||s==0)return`0 of ${d}`;d=Math.max(d,0);let m=n*s,_=m<d?Math.min(m+s,d):m+s;return`${m+1} \u2013 ${_} of ${d}`}}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var krt=50;var Rrt=new we("MAT_PAGINATOR_DEFAULT_OPTIONS"),Prt=Fy(class{}),Ort=0,ja=(()=>{let r=class r extends Prt{get pageIndex(){return this._pageIndex}set pageIndex(n){this._pageIndex=Math.max(n||0,0),this._changeDetectorRef.markForCheck()}get length(){return this._length}set length(n){this._length=n||0,this._changeDetectorRef.markForCheck()}get pageSize(){return this._pageSize}set pageSize(n){this._pageSize=Math.max(n||0,0),this._updateDisplayedPageSizeOptions()}get pageSizeOptions(){return this._pageSizeOptions}set pageSizeOptions(n){this._pageSizeOptions=(n||[]).map(s=>ll(s,0)),this._updateDisplayedPageSizeOptions()}constructor(n,s,d){if(super(),this._intl=n,this._changeDetectorRef=s,this._pageSizeLabelId=`mat-paginator-page-size-label-${Ort++}`,this._pageIndex=0,this._length=0,this._pageSizeOptions=[],this.hidePageSize=!1,this.showFirstLastButtons=!1,this.selectConfig={},this.disabled=!1,this.page=new ye,this._intlChanges=n.changes.subscribe(()=>this._changeDetectorRef.markForCheck()),d){let{pageSize:m,pageSizeOptions:_,hidePageSize:w,showFirstLastButtons:S}=d;m!=null&&(this._pageSize=m),_!=null&&(this._pageSizeOptions=_),w!=null&&(this.hidePageSize=w),S!=null&&(this.showFirstLastButtons=S)}this._formFieldAppearance=d?.formFieldAppearance||"outline"}ngOnInit(){this._initialized=!0,this._updateDisplayedPageSizeOptions(),this._markInitialized()}ngOnDestroy(){this._intlChanges.unsubscribe()}nextPage(){if(!this.hasNextPage())return;let n=this.pageIndex;this.pageIndex=this.pageIndex+1,this._emitPageEvent(n)}previousPage(){if(!this.hasPreviousPage())return;let n=this.pageIndex;this.pageIndex=this.pageIndex-1,this._emitPageEvent(n)}firstPage(){if(!this.hasPreviousPage())return;let n=this.pageIndex;this.pageIndex=0,this._emitPageEvent(n)}lastPage(){if(!this.hasNextPage())return;let n=this.pageIndex;this.pageIndex=this.getNumberOfPages()-1,this._emitPageEvent(n)}hasPreviousPage(){return this.pageIndex>=1&&this.pageSize!=0}hasNextPage(){let n=this.getNumberOfPages()-1;return this.pageIndex<n&&this.pageSize!=0}getNumberOfPages(){return this.pageSize?Math.ceil(this.length/this.pageSize):0}_changePageSize(n){let s=this.pageIndex*this.pageSize,d=this.pageIndex;this.pageIndex=Math.floor(s/n)||0,this.pageSize=n,this._emitPageEvent(d)}_nextButtonsDisabled(){return this.disabled||!this.hasNextPage()}_previousButtonsDisabled(){return this.disabled||!this.hasPreviousPage()}_updateDisplayedPageSizeOptions(){this._initialized&&(this.pageSize||(this._pageSize=this.pageSizeOptions.length!=0?this.pageSizeOptions[0]:krt),this._displayedPageSizeOptions=this.pageSizeOptions.slice(),this._displayedPageSizeOptions.indexOf(this.pageSize)===-1&&this._displayedPageSizeOptions.push(this.pageSize),this._displayedPageSizeOptions.sort((n,s)=>n-s),this._changeDetectorRef.markForCheck())}_emitPageEvent(n){this.page.emit({previousPageIndex:n,pageIndex:this.pageIndex,pageSize:this.pageSize,length:this.length})}};r.\u0275fac=function(s){return new(s||r)(B(Art),B(Wi),B(Rrt,8))},r.\u0275cmp=Et({type:r,selectors:[["mat-paginator"]],hostAttrs:["role","group",1,"mat-mdc-paginator"],inputs:{color:"color",pageIndex:[Rt.HasDecoratorInputTransform,"pageIndex","pageIndex",ll],length:[Rt.HasDecoratorInputTransform,"length","length",ll],pageSize:[Rt.HasDecoratorInputTransform,"pageSize","pageSize",ll],pageSizeOptions:"pageSizeOptions",hidePageSize:[Rt.HasDecoratorInputTransform,"hidePageSize","hidePageSize",Qe],showFirstLastButtons:[Rt.HasDecoratorInputTransform,"showFirstLastButtons","showFirstLastButtons",Qe],selectConfig:"selectConfig",disabled:[Rt.HasDecoratorInputTransform,"disabled","disabled",Qe]},outputs:{page:"page"},exportAs:["matPaginator"],standalone:!0,features:[Tn,Si,At],decls:14,vars:14,consts:[[1,"mat-mdc-paginator-outer-container"],[1,"mat-mdc-paginator-container"],["class","mat-mdc-paginator-page-size"],[1,"mat-mdc-paginator-range-actions"],["aria-live","polite",1,"mat-mdc-paginator-range-label"],["mat-icon-button","","type","button","class","mat-mdc-paginator-navigation-first",3,"matTooltip","matTooltipDisabled","matTooltipPosition","disabled"],["mat-icon-button","","type","button",1,"mat-mdc-paginator-navigation-previous",3,"matTooltip","matTooltipDisabled","matTooltipPosition","disabled","click"],["viewBox","0 0 24 24","focusable","false","aria-hidden","true",1,"mat-mdc-paginator-icon"],["d","M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"],["mat-icon-button","","type","button",1,"mat-mdc-paginator-navigation-next",3,"matTooltip","matTooltipDisabled","matTooltipPosition","disabled","click"],["d","M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"],["mat-icon-button","","type","button","class","mat-mdc-paginator-navigation-last",3,"matTooltip","matTooltipDisabled","matTooltipPosition","disabled"],[1,"mat-mdc-paginator-page-size"],[1,"mat-mdc-paginator-page-size-label"],["class","mat-mdc-paginator-page-size-select",3,"appearance","color"],["class","mat-mdc-paginator-page-size-value"],[1,"mat-mdc-paginator-page-size-select",3,"appearance","color"],["hideSingleSelectionIndicator","",3,"value","disabled","aria-labelledby","panelClass","disableOptionCentering","selectionChange"],[3,"value"],[1,"mat-mdc-paginator-page-size-value"],["mat-icon-button","","type","button",1,"mat-mdc-paginator-navigation-first",3,"matTooltip","matTooltipDisabled","matTooltipPosition","disabled","click"],["d","M18.41 16.59L13.82 12l4.59-4.59L17 6l-6 6 6 6zM6 6h2v12H6z"],["mat-icon-button","","type","button",1,"mat-mdc-paginator-navigation-last",3,"matTooltip","matTooltipDisabled","matTooltipPosition","disabled","click"],["d","M5.59 7.41L10.18 12l-4.59 4.59L7 18l6-6-6-6zM16 6h2v12h-2z"]],template:function(s,d){s&1&&(A(0,"div",0)(1,"div",1),mt(2,Drt,5,4,"div",2),A(3,"div",3)(4,"div",4),V(5),k(),mt(6,Trt,3,5,"button",5),A(7,"button",6),ct("click",function(){return d.previousPage()}),As(),A(8,"svg",7),dt(9,"path",8),k()(),gu(),A(10,"button",9),ct("click",function(){return d.nextPage()}),As(),A(11,"svg",7),dt(12,"path",10),k()(),mt(13,Irt,3,5,"button",11),k()()()),s&2&&(N(2),$i(2,d.hidePageSize?-1:2),N(3),ae(" ",d._intl.getRangeLabel(d.pageIndex,d.pageSize,d.length)," "),N(),$i(6,d.showFirstLastButtons?6:-1),N(),Z("matTooltip",d._intl.previousPageLabel)("matTooltipDisabled",d._previousButtonsDisabled())("matTooltipPosition","above")("disabled",d._previousButtonsDisabled()),oi("aria-label",d._intl.previousPageLabel),N(3),Z("matTooltip",d._intl.nextPageLabel)("matTooltipDisabled",d._nextButtonsDisabled())("matTooltipPosition","above")("disabled",d._nextButtonsDisabled()),oi("aria-label",d._intl.nextPageLabel),N(3),$i(13,d.showFirstLastButtons?13:-1))},dependencies:[Uy,a5,Ny,Tc,d5],styles:[".mat-mdc-paginator{display:block;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;color:var(--mat-paginator-container-text-color);background-color:var(--mat-paginator-container-background-color);font-family:var(--mat-paginator-container-text-font);line-height:var(--mat-paginator-container-text-line-height);font-size:var(--mat-paginator-container-text-size);font-weight:var(--mat-paginator-container-text-weight);letter-spacing:var(--mat-paginator-container-text-tracking);--mat-form-field-container-height:var(--mat-paginator-form-field-container-height);--mat-form-field-container-vertical-padding:var(--mat-paginator-form-field-container-vertical-padding)}.mat-mdc-paginator .mat-mdc-select-value{font-size:var(--mat-paginator-select-trigger-text-size)}.mat-mdc-paginator .mat-mdc-form-field-subscript-wrapper{display:none}.mat-mdc-paginator .mat-mdc-select{line-height:1.5}.mat-mdc-paginator-outer-container{display:flex}.mat-mdc-paginator-container{display:flex;align-items:center;justify-content:flex-end;padding:0 8px;flex-wrap:wrap;width:100%;min-height:var(--mat-paginator-container-size)}.mat-mdc-paginator-page-size{display:flex;align-items:baseline;margin-right:8px}[dir=rtl] .mat-mdc-paginator-page-size{margin-right:0;margin-left:8px}.mat-mdc-paginator-page-size-label{margin:0 4px}.mat-mdc-paginator-page-size-select{margin:0 4px;width:84px}.mat-mdc-paginator-range-label{margin:0 32px 0 24px}.mat-mdc-paginator-range-actions{display:flex;align-items:center}.mat-mdc-paginator-icon{display:inline-block;width:28px;fill:var(--mat-paginator-enabled-icon-color)}.mat-mdc-icon-button[disabled] .mat-mdc-paginator-icon{fill:var(--mat-paginator-disabled-icon-color)}[dir=rtl] .mat-mdc-paginator-icon{transform:rotate(180deg)}.cdk-high-contrast-active .mat-mdc-icon-button[disabled] .mat-mdc-paginator-icon,.cdk-high-contrast-active .mat-mdc-paginator-icon{fill:currentColor;fill:CanvasText}.cdk-high-contrast-active .mat-mdc-paginator-range-actions .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0});let a=r;return a})();var Frt=["mat-sort-header",""];function Lrt(a,r){if(a&1){let l=Ce();A(0,"div",3),ct("@arrowPosition.start",function(){te(l);let s=vt();return ee(s._disableViewStateAnimation=!0)})("@arrowPosition.done",function(){te(l);let s=vt();return ee(s._disableViewStateAnimation=!1)}),dt(1,"div",4),A(2,"div",5),dt(3,"div",6)(4,"div",7)(5,"div",8),k()()}if(a&2){let l=vt();Z("@arrowOpacity",l._getArrowViewState())("@arrowPosition",l._getArrowViewState())("@allowChildren",l._getArrowDirectionState()),N(2),Z("@indicator",l._getArrowDirectionState()),N(),Z("@leftPointer",l._getArrowDirectionState()),N(),Z("@rightPointer",l._getArrowDirectionState())}}var zrt=["*"];var u5=new we("MAT_SORT_DEFAULT_OPTIONS"),Nrt=Fy(class{}),na=(()=>{let r=class r extends Nrt{get direction(){return this._direction}set direction(n){this._direction=n}constructor(n){super(),this._defaultOptions=n,this.sortables=new Map,this._stateChanges=new pe,this.start="asc",this._direction="",this.disabled=!1,this.sortChange=new ye}register(n){this.sortables.set(n.id,n)}deregister(n){this.sortables.delete(n.id)}sort(n){this.active!=n.id?(this.active=n.id,this.direction=n.start?n.start:this.start):this.direction=this.getNextSortDirection(n),this.sortChange.emit({active:this.active,direction:this.direction})}getNextSortDirection(n){if(!n)return"";let s=n?.disableClear??this.disableClear??!!this._defaultOptions?.disableClear,d=Brt(n.start||this.start,s),m=d.indexOf(this.direction)+1;return m>=d.length&&(m=0),d[m]}ngOnInit(){this._markInitialized()}ngOnChanges(){this._stateChanges.next()}ngOnDestroy(){this._stateChanges.complete()}};r.\u0275fac=function(s){return new(s||r)(B(u5,8))},r.\u0275dir=re({type:r,selectors:[["","matSort",""]],hostAttrs:[1,"mat-sort"],inputs:{active:[Rt.None,"matSortActive","active"],start:[Rt.None,"matSortStart","start"],direction:[Rt.None,"matSortDirection","direction"],disableClear:[Rt.HasDecoratorInputTransform,"matSortDisableClear","disableClear",Qe],disabled:[Rt.HasDecoratorInputTransform,"matSortDisabled","disabled",Qe]},outputs:{sortChange:"matSortChange"},exportAs:["matSort"],standalone:!0,features:[Tn,Si,qn]});let a=r;return a})();function Brt(a,r){let l=["asc","desc"];return a=="desc"&&l.reverse(),r||l.push(""),l}var Ld=Fz.ENTERING+" "+Oz.STANDARD_CURVE,Zm={indicator:Yr("indicator",[Wn("active-asc, asc",Ei({transform:"translateY(0px)"})),Wn("active-desc, desc",Ei({transform:"translateY(10px)"})),Sn("active-asc <=> active-desc",Bn(Ld))]),leftPointer:Yr("leftPointer",[Wn("active-asc, asc",Ei({transform:"rotate(-45deg)"})),Wn("active-desc, desc",Ei({transform:"rotate(45deg)"})),Sn("active-asc <=> active-desc",Bn(Ld))]),rightPointer:Yr("rightPointer",[Wn("active-asc, asc",Ei({transform:"rotate(45deg)"})),Wn("active-desc, desc",Ei({transform:"rotate(-45deg)"})),Sn("active-asc <=> active-desc",Bn(Ld))]),arrowOpacity:Yr("arrowOpacity",[Wn("desc-to-active, asc-to-active, active",Ei({opacity:1})),Wn("desc-to-hint, asc-to-hint, hint",Ei({opacity:.54})),Wn("hint-to-desc, active-to-desc, desc, hint-to-asc, active-to-asc, asc, void",Ei({opacity:0})),Sn("* => asc, * => desc, * => active, * => hint, * => void",Bn("0ms")),Sn("* <=> *",Bn(Ld))]),arrowPosition:Yr("arrowPosition",[Sn("* => desc-to-hint, * => desc-to-active",Bn(Ld,md([Ei({transform:"translateY(-25%)"}),Ei({transform:"translateY(0)"})]))),Sn("* => hint-to-desc, * => active-to-desc",Bn(Ld,md([Ei({transform:"translateY(0)"}),Ei({transform:"translateY(25%)"})]))),Sn("* => asc-to-hint, * => asc-to-active",Bn(Ld,md([Ei({transform:"translateY(25%)"}),Ei({transform:"translateY(0)"})]))),Sn("* => hint-to-asc, * => active-to-asc",Bn(Ld,md([Ei({transform:"translateY(0)"}),Ei({transform:"translateY(-25%)"})]))),Wn("desc-to-hint, asc-to-hint, hint, desc-to-active, asc-to-active, active",Ei({transform:"translateY(0)"})),Wn("hint-to-desc, active-to-desc, desc",Ei({transform:"translateY(-25%)"})),Wn("hint-to-asc, active-to-asc, asc",Ei({transform:"translateY(25%)"}))]),allowChildren:Yr("allowChildren",[Sn("* <=> *",[Av("@*",Iv(),{optional:!0})])])},Vrt=(()=>{let r=class r{constructor(){this.changes=new pe}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var zd=(()=>{let r=class r{get sortActionDescription(){return this._sortActionDescription}set sortActionDescription(n){this._updateSortActionDescription(n)}constructor(n,s,d,m,_,w,S,T){this._intl=n,this._changeDetectorRef=s,this._sort=d,this._columnDef=m,this._focusMonitor=_,this._elementRef=w,this._ariaDescriber=S,this._showIndicatorHint=!1,this._viewState={},this._arrowDirection="",this._disableViewStateAnimation=!1,this.arrowPosition="after",this.disabled=!1,this._sortActionDescription="Sort",T?.arrowPosition&&(this.arrowPosition=T?.arrowPosition),this._handleStateChanges()}ngOnInit(){!this.id&&this._columnDef&&(this.id=this._columnDef.name),this._updateArrowDirection(),this._setAnimationTransitionState({toState:this._isSorted()?"active":this._arrowDirection}),this._sort.register(this),this._sortButton=this._elementRef.nativeElement.querySelector(".mat-sort-header-container"),this._updateSortActionDescription(this._sortActionDescription)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(n=>{let s=!!n;s!==this._showIndicatorHint&&(this._setIndicatorHintVisible(s),this._changeDetectorRef.markForCheck())})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._sort.deregister(this),this._rerenderSubscription.unsubscribe()}_setIndicatorHintVisible(n){this._isDisabled()&&n||(this._showIndicatorHint=n,this._isSorted()||(this._updateArrowDirection(),this._showIndicatorHint?this._setAnimationTransitionState({fromState:this._arrowDirection,toState:"hint"}):this._setAnimationTransitionState({fromState:"hint",toState:this._arrowDirection})))}_setAnimationTransitionState(n){this._viewState=n||{},this._disableViewStateAnimation&&(this._viewState={toState:n.toState})}_toggleOnInteraction(){this._sort.sort(this),(this._viewState.toState==="hint"||this._viewState.toState==="active")&&(this._disableViewStateAnimation=!0)}_handleClick(){this._isDisabled()||this._sort.sort(this)}_handleKeydown(n){!this._isDisabled()&&(n.keyCode===32||n.keyCode===13)&&(n.preventDefault(),this._toggleOnInteraction())}_isSorted(){return this._sort.active==this.id&&(this._sort.direction==="asc"||this._sort.direction==="desc")}_getArrowDirectionState(){return`${this._isSorted()?"active-":""}${this._arrowDirection}`}_getArrowViewState(){let n=this._viewState.fromState;return(n?`${n}-to-`:"")+this._viewState.toState}_updateArrowDirection(){this._arrowDirection=this._isSorted()?this._sort.direction:this.start||this._sort.start}_isDisabled(){return this._sort.disabled||this.disabled}_getAriaSortAttribute(){return this._isSorted()?this._sort.direction=="asc"?"ascending":"descending":"none"}_renderArrow(){return!this._isDisabled()||this._isSorted()}_updateSortActionDescription(n){this._sortButton&&(this._ariaDescriber?.removeDescription(this._sortButton,this._sortActionDescription),this._ariaDescriber?.describe(this._sortButton,n)),this._sortActionDescription=n}_handleStateChanges(){this._rerenderSubscription=io(this._sort.sortChange,this._sort._stateChanges,this._intl.changes).subscribe(()=>{this._isSorted()&&(this._updateArrowDirection(),(this._viewState.toState==="hint"||this._viewState.toState==="active")&&(this._disableViewStateAnimation=!0),this._setAnimationTransitionState({fromState:this._arrowDirection,toState:"active"}),this._showIndicatorHint=!1),!this._isSorted()&&this._viewState&&this._viewState.toState==="active"&&(this._disableViewStateAnimation=!1,this._setAnimationTransitionState({fromState:"active",toState:this._arrowDirection})),this._changeDetectorRef.markForCheck()})}};r.\u0275fac=function(s){return new(s||r)(B(Vrt),B(Wi),B(na,8),B("MAT_SORT_HEADER_COLUMN_DEF",8),B(Ls),B(Se),B(Ry,8),B(u5,8))},r.\u0275cmp=Et({type:r,selectors:[["","mat-sort-header",""]],hostAttrs:[1,"mat-sort-header"],hostVars:3,hostBindings:function(s,d){s&1&&ct("click",function(){return d._handleClick()})("keydown",function(_){return d._handleKeydown(_)})("mouseenter",function(){return d._setIndicatorHintVisible(!0)})("mouseleave",function(){return d._setIndicatorHintVisible(!1)}),s&2&&(oi("aria-sort",d._getAriaSortAttribute()),ei("mat-sort-header-disabled",d._isDisabled()))},inputs:{id:[Rt.None,"mat-sort-header","id"],arrowPosition:"arrowPosition",start:"start",disabled:[Rt.HasDecoratorInputTransform,"disabled","disabled",Qe],sortActionDescription:"sortActionDescription",disableClear:[Rt.HasDecoratorInputTransform,"disableClear","disableClear",Qe]},exportAs:["matSortHeader"],standalone:!0,features:[Tn,At],attrs:Frt,ngContentSelectors:zrt,decls:4,vars:7,consts:[[1,"mat-sort-header-container","mat-focus-indicator"],[1,"mat-sort-header-content"],["class","mat-sort-header-arrow"],[1,"mat-sort-header-arrow"],[1,"mat-sort-header-stem"],[1,"mat-sort-header-indicator"],[1,"mat-sort-header-pointer-left"],[1,"mat-sort-header-pointer-right"],[1,"mat-sort-header-pointer-middle"]],template:function(s,d){s&1&&(Nn(),A(0,"div",0)(1,"div",1),Ti(2),k(),mt(3,Lrt,6,6,"div",2),k()),s&2&&(ei("mat-sort-header-sorted",d._isSorted())("mat-sort-header-position-before",d.arrowPosition==="before"),oi("tabindex",d._isDisabled()?null:0)("role",d._isDisabled()?null:"button"),N(3),$i(3,d._renderArrow()?3:-1))},styles:[".mat-sort-header-container{display:flex;cursor:pointer;align-items:center;letter-spacing:normal;outline:0}[mat-sort-header].cdk-keyboard-focused .mat-sort-header-container,[mat-sort-header].cdk-program-focused .mat-sort-header-container{border-bottom:solid 1px currentColor}.mat-sort-header-disabled .mat-sort-header-container{cursor:default}.mat-sort-header-container::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-sort-header-content{text-align:center;display:flex;align-items:center}.mat-sort-header-position-before{flex-direction:row-reverse}.mat-sort-header-arrow{height:12px;width:12px;min-width:12px;position:relative;display:flex;color:var(--mat-sort-arrow-color);opacity:0}.mat-sort-header-arrow,[dir=rtl] .mat-sort-header-position-before .mat-sort-header-arrow{margin:0 0 0 6px}.mat-sort-header-position-before .mat-sort-header-arrow,[dir=rtl] .mat-sort-header-arrow{margin:0 6px 0 0}.mat-sort-header-stem{background:currentColor;height:10px;width:2px;margin:auto;display:flex;align-items:center}.cdk-high-contrast-active .mat-sort-header-stem{width:0;border-left:solid 2px}.mat-sort-header-indicator{width:100%;height:2px;display:flex;align-items:center;position:absolute;top:0;left:0}.mat-sort-header-pointer-middle{margin:auto;height:2px;width:2px;background:currentColor;transform:rotate(45deg)}.cdk-high-contrast-active .mat-sort-header-pointer-middle{width:0;height:0;border-top:solid 2px;border-left:solid 2px}.mat-sort-header-pointer-left,.mat-sort-header-pointer-right{background:currentColor;width:6px;height:2px;position:absolute;top:0}.cdk-high-contrast-active .mat-sort-header-pointer-left,.cdk-high-contrast-active .mat-sort-header-pointer-right{width:0;height:0;border-left:solid 6px;border-top:solid 2px}.mat-sort-header-pointer-left{transform-origin:right;left:0}.mat-sort-header-pointer-right{transform-origin:left;right:0}"],encapsulation:2,data:{animation:[Zm.indicator,Zm.leftPointer,Zm.rightPointer,Zm.arrowOpacity,Zm.arrowPosition,Zm.allowChildren]},changeDetection:0});let a=r;return a})();var h5=(()=>{let r=class r{transform(n){return typeof n=="object"&&n!==null&&"name"in n?n.name:n}};r.\u0275fac=function(s){return new(s||r)},r.\u0275pipe=yv({name:"locationName",type:r,pure:!0,standalone:!0});let a=r;return a})();function jrt(a,r){a&1&&(A(0,"div",30),V(1," First name is required "),k())}function Urt(a,r){a&1&&(A(0,"div",30),V(1," Last name is required "),k())}function Hrt(a,r){a&1&&(A(0,"div",30),V(1," Username is required "),k())}function Grt(a,r){a&1&&(A(0,"div",30),V(1," Email is required "),k())}function qrt(a,r){a&1&&(A(0,"div",30),V(1," Invalid email format "),k())}function Wrt(a,r){a&1&&(A(0,"div",30),V(1," Password is required "),k())}function $rt(a,r){a&1&&(A(0,"div",30),V(1," Password must be at least 6 characters long "),k())}function Yrt(a,r){if(a&1&&(A(0,"div")(1,"mdb-form-control",11),dt(2,"input",31,32),A(4,"label",33),V(5,"Password"),k()(),mt(6,Wrt,2,0,"div",10)(7,$rt,2,0,"div",10),k()),a&2){let l=vt(),n,s;N(6),Z("ngIf",((n=l.registrationForm.get("password"))==null||n.errors==null?null:n.errors.required)&&((n=l.registrationForm.get("password"))==null?null:n.touched)),N(),Z("ngIf",((s=l.registrationForm.get("password"))==null||s.errors==null?null:s.errors.minlength)&&((s=l.registrationForm.get("password"))==null?null:s.touched))}}function Zrt(a,r){a&1&&(A(0,"div",30),V(1," Role is required "),k())}var tT=(()=>{let r=class r{constructor(n,s,d){this.dialogRef=n,this.data=s,this.fb=d,s.title=="Adauga user"?this.registrationForm=this.fb.group({firstName:[this.data.user.firstName,Le.required],lastName:[this.data.user.lastName,Le.required],username:[this.data.user.username,Le.required],email:[this.data.user.email,[Le.required,Le.email]],password:["",[Le.required,Le.minLength(6)]],role:[this.data.user.role,Le.required]}):this.registrationForm=this.fb.group({firstName:[this.data.user.firstName,Le.required],lastName:[this.data.user.lastName,Le.required],username:[this.data.user.username,Le.required],email:[this.data.user.email,[Le.required,Le.email]],role:[this.data.user.role,Le.required]})}onCloseClick(){this.dialogRef.close()}onConfirmClick(){if(this.registrationForm.markAllAsTouched(),this.registrationForm.valid){let n=Ri(Gt({},this.registrationForm.value),{id:this.data.user.id});this.dialogRef.close(n)}}};r.\u0275fac=function(s){return new(s||r)(B(Qn),B(jr),B(wr))},r.\u0275cmp=Et({type:r,selectors:[["app-edit-user"]],standalone:!0,features:[At],decls:49,vars:9,consts:[[1,"modal-content"],[1,"modal-header","mb-5"],["id","exampleModalLabel",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body","mb-3"],[3,"formGroup"],[1,"mb-3"],["mdbInput","","type","text","id","firstName","formControlName","firstName",1,"form-control"],["firstName",""],["mdbLabel","","for","firstName",1,"form-label"],["class","text-danger mb-4",4,"ngIf"],[1,"mb-4"],["mdbInput","","type","text","id","lastName","formControlName","lastName","required","",1,"form-control"],["lastName",""],["mdbLabel","","for","lastName",1,"form-label"],["mdbInput","","type","text","id","username","formControlName","username","required","",1,"form-control"],["username",""],["mdbLabel","","for","username",1,"form-label"],["mdbInput","","type","text","id","email","formControlName","email","required","",1,"form-control"],["email",""],["mdbLabel","","for","email",1,"form-label"],[4,"ngIf"],["for","role",1,"form-label"],["id","role","name","role","formControlName","role","required","",1,"form-select"],["value","ADMIN"],["value","USER"],["value","TICKET_VALIDATOR"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary","me-1",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"text-danger","mb-4"],["mdbInput","","type","password","id","password","formControlName","password","required","",1,"form-control"],["password",""],["mdbLabel","","for","password",1,"form-label"]],template:function(s,d){if(s&1&&(A(0,"div",0)(1,"div",1)(2,"h5",2),V(3),k(),A(4,"button",3),ct("click",function(){return d.onCloseClick()}),k()(),A(5,"div",4)(6,"form",5)(7,"mdb-form-control",6),dt(8,"input",7,8),A(10,"label",9),V(11,"First name"),k()(),mt(12,jrt,2,0,"div",10),A(13,"mdb-form-control",11),dt(14,"input",12,13),A(16,"label",14),V(17,"Last name"),k()(),mt(18,Urt,2,0,"div",10),A(19,"mdb-form-control",11),dt(20,"input",15,16),A(22,"label",17),V(23,"Username"),k()(),mt(24,Hrt,2,0,"div",10),A(25,"mdb-form-control",11),dt(26,"input",18,19),A(28,"label",20),V(29,"Email address"),k()(),mt(30,Grt,2,0,"div",10)(31,qrt,2,0,"div",10)(32,Yrt,8,2,"div",21),A(33,"div",6)(34,"label",22),V(35,"Role"),k(),A(36,"select",23)(37,"option",24),V(38,"ADMIN"),k(),A(39,"option",25),V(40,"USER"),k(),A(41,"option",26),V(42,"TICKET VALIDATOR"),k()()(),mt(43,Zrt,2,0,"div",10),k()(),A(44,"div",27)(45,"button",28),ct("click",function(){return d.onCloseClick()}),V(46," Cancel "),k(),A(47,"button",29),ct("click",function(){return d.onConfirmClick()}),V(48,"Save changes"),k()()()),s&2){let m,_,w,S,T,L;N(3),De(d.data.title),N(3),Z("formGroup",d.registrationForm),N(6),Z("ngIf",((m=d.registrationForm.get("firstName"))==null?null:m.invalid)&&((m=d.registrationForm.get("firstName"))==null?null:m.touched)),N(6),Z("ngIf",((_=d.registrationForm.get("lastName"))==null?null:_.invalid)&&((_=d.registrationForm.get("lastName"))==null?null:_.touched)),N(6),Z("ngIf",((w=d.registrationForm.get("username"))==null?null:w.invalid)&&((w=d.registrationForm.get("username"))==null?null:w.touched)),N(6),Z("ngIf",((S=d.registrationForm.get("email"))==null||S.errors==null?null:S.errors.required)&&((S=d.registrationForm.get("email"))==null?null:S.touched)),N(),Z("ngIf",((T=d.registrationForm.get("email"))==null||T.errors==null?null:T.errors.email)&&((T=d.registrationForm.get("email"))==null?null:T.touched)),N(),Z("ngIf",d.data.title==="Adauga user"),N(11),Z("ngIf",((L=d.registrationForm.get("role"))==null||L.errors==null?null:L.errors.required)&&((L=d.registrationForm.get("role"))==null?null:L.touched))}},dependencies:[Yi,xr,Ca,Sa,en,wa,ji,br,Xr,Rn,Vn,ur,qe,Kr,mo,po,oo],styles:[".modal-content[_ngcontent-%COMP%]{padding:20px}"]});let a=r;return a})();var Nd=(()=>{let r=class r{constructor(n){this.dialogRef=n}onCloseClick(){this.dialogRef.close(!1)}onConfirmClick(){this.dialogRef.close(!0)}};r.\u0275fac=function(s){return new(s||r)(B(Qn))},r.\u0275cmp=Et({type:r,selectors:[["app-delete"]],standalone:!0,features:[At],decls:13,vars:0,consts:[[1,"modal-content"],[1,"modal-header","mb-5"],["id","exampleModalLabel",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body","mb-3"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(s,d){s&1&&(A(0,"div",0)(1,"div",1)(2,"h5",2),V(3,"Delete"),k(),A(4,"button",3),ct("click",function(){return d.onCloseClick()}),k()(),A(5,"div",4)(6,"p"),V(7,"Are you sure you want to delete this item?"),k()(),A(8,"div",5)(9,"button",6),ct("click",function(){return d.onCloseClick()}),V(10," Cancel "),k(),A(11,"button",7),ct("click",function(){return d.onConfirmClick()}),V(12,"Confirm"),k()()())},styles:[".modal-content[_ngcontent-%COMP%]{padding:20px}"]});let a=r;return a})();var Xrt=(()=>{class a{get name(){return this._name}set name(l){this._name=l}_name;get checked(){return this._checked}set checked(l){this._checked=ro(l)}_checked=!1;get value(){return this._value}set value(l){this._value=l}_value=null;get disabled(){return this._disabled}set disabled(l){this._disabled=ro(l)}_disabled=!1;get isDisabled(){return this._disabled}get isChecked(){return this._checked}get nameAttr(){return this.name}constructor(){}_updateName(l){this._name=l}_updateChecked(l){this._checked=l}_updateDisabledState(l){this._disabled=l}static ngAcceptInputType_checked;static ngAcceptInputType_disabled;static \u0275fac=function(n){return new(n||a)};static \u0275dir=re({type:a,selectors:[["","mdbRadio",""]],hostVars:3,hostBindings:function(n,s){n&2&&(Rs("disabled",s.isDisabled)("checked",s.isChecked),oi("name",s.nameAttr))},inputs:{name:"name",checked:"checked",value:"value",disabled:"disabled"}})}return a})(),Krt={provide:xa,useExisting:Vo(()=>Qrt),multi:!0},Qrt=(()=>{class a{radios;get value(){return this._value}set value(l){this._value=l,this.radios&&this._updateChecked()}_value;get name(){return this._name}set name(l){this._name=l,this.radios&&this._updateNames()}_name;get disabled(){return this._disabled}set disabled(l){this._disabled=l,this.radios&&this._updateDisabled()}_disabled=!1;_destroy$=new pe;onChange=l=>{};onTouched=()=>{};ngAfterContentInit(){this._updateNames(),this._updateDisabled(),this.radios.changes.pipe(co(this.radios),no(l=>Ro(Promise.resolve(l))),ri(this._destroy$)).subscribe(()=>this._updateRadiosState())}ngOnDestroy(){this._destroy$.next(),this._destroy$.complete()}_updateRadiosState(){this._updateNames(),this._updateChecked(),this._updateDisabled()}_updateNames(){this.radios.forEach(l=>l._updateName(this.name))}_updateChecked(){this.radios.forEach(l=>{let n=l.value===this._value;l._updateChecked(n)})}_updateDisabled(){this.radios.forEach(l=>l._updateDisabledState(this._disabled))}registerOnChange(l){this.onChange=l}registerOnTouched(l){this.onTouched=l}setDisabledState(l){this._disabled=l,this._updateDisabled()}writeValue(l){this.value=l}static \u0275fac=function(n){return new(n||a)};static \u0275dir=re({type:a,selectors:[["","mdbRadioGroup",""]],contentQueries:function(n,s,d){if(n&1&&mn(d,Xrt,5),n&2){let m;ce(m=de())&&(s.radios=m)}},inputs:{value:"value",name:"name",disabled:"disabled"},features:[Ni([Krt])]})}return a})(),m5=(()=>{class a{static \u0275fac=function(n){return new(n||a)};static \u0275mod=xi({type:a});static \u0275inj=wi({imports:[Lo,Yi]})}return a})();function Ua(a){let r=new FormData;for(let l in a)Array.isArray(a[l])?r.append(l,JSON.stringify(a[l])):r.append(l,a[l]);return r}var p5=(()=>{let r=class r{constructor(n,s,d){this.http=n,this.identityService=s,this.snackBar=d,this.userListSubject=new Ze({})}setUsersListSubject(n){this.userListSubject.next(n)}getUsersListSubject(){return this.userListSubject}fetchPaginatedUsers(n,s){return It(this,null,function*(){try{let d=yield Ve(this.http.get(Me+"/users",{params:{page:n.toString(),size:s.toString()},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setUsersListSubject(d)}catch{this.snackBar.open("Failed to fetch users","Close",{duration:3e3})}})}fetchPaginatedUsersFiltered(n,s,d,m){return It(this,null,function*(){try{let _=yield Ve(this.http.get(Me+"/users/filtered",{params:{page:n.toString(),size:s.toString(),filter:d,search:m},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setUsersListSubject(_)}catch{this.snackBar.open("Failed to fetch users","Close",{duration:3e3})}})}addUser(n,s,d){return It(this,null,function*(){try{let m=yield Ve(this.http.post(Me+"/users",Ua(n),{params:{page:s.toString(),size:d.toString()},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setUsersListSubject(m)}catch{this.snackBar.open("Failed to add user","Close",{duration:3e3})}})}updateUser(n){return It(this,null,function*(){try{let s=yield Ve(this.http.patch(Me+"/users",Ua(n),{headers:{Authorization:"Bearer "+this.identityService.getToken()}})),d=this.userListSubject.getValue();d.userPage.content.map(m=>m.id===n.id?n:m),this.setUsersListSubject(d)}catch{this.snackBar.open("Failed to update user","Close",{duration:3e3})}})}deleteUser(n,s,d){return It(this,null,function*(){try{let m=yield Ve(this.http.delete(Me+`/users/${n}`,{params:{page:s.toString(),size:d.toString()},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setUsersListSubject(m)}catch{this.snackBar.open("Failed to delete user","Close",{duration:3e3})}})}};r.\u0275fac=function(s){return new(s||r)(ht(Gi),ht(hi),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function tot(a,r){if(a&1){let l=Ce();A(0,"div",26)(1,"button",27),ct("click",function(){te(l);let s=vt();return ee(s.removeFilter())}),V(2,"Sterge filtrul"),k()()}}function eot(a,r){if(a&1&&(A(0,"th",30),V(1),k()),a&2){let l=vt().$implicit,n=vt();N(),ae(" ",n.columnMap[l]," ")}}function iot(a,r){if(a&1&&(A(0,"td",31),V(1),k()),a&2){let l=r.$implicit,n=vt().$implicit;N(),ae(" ",l[n]," ")}}function not(a,r){if(a&1&&(rr(0,28),mt(1,eot,2,1,"th",29)(2,iot,2,1,"td",20),or()),a&2){let l=r.$implicit;Z("matColumnDef",l)}}function rot(a,r){a&1&&(A(0,"th",32),V(1," Actiuni "),k())}function oot(a,r){if(a&1){let l=Ce();A(0,"td",31)(1,"button",33),ct("click",function(){let d=te(l).$implicit,m=vt();return ee(m.rowData=d)}),dt(2,"i",34),k()()}if(a&2){vt();let l=Ir(33);N(),Z("matMenuTriggerFor",l)}}function sot(a,r){a&1&&dt(0,"tr",35)}function aot(a,r){a&1&&dt(0,"tr",36)}var lot=()=>[5,10,20,50],f5=(()=>{let r=class r{constructor(n,s,d,m,_){this.dialog=n,this.snackBar=s,this.manageUsersService=d,this.route=m,this.router=_,this.dataSource=new ps,this.itemsCount=0,this.displayedColumns=["firstName","lastName","username","email","role"],this.searchValue="",this.selectedFilterOption="firstName",this.shouldDisplayRemoveFilterButton=!1,this.pageIndex=0,this.pageSize=5,this.columnMap={firstName:"Prenume",lastName:"Nume",username:"Username",email:"Email",role:"Rol"}}ngOnInit(){this.route.queryParams.subscribe(n=>It(this,null,function*(){this.pageIndex=n.page||0,this.pageSize=n.size||5,this.searchValue=n.search||"",this.selectedFilterOption=n.filter||"firstName",this.shouldDisplayRemoveFilterButton=!!(n.filter&&n.search),this.searchValue===""&&this.selectedFilterOption==="firstName"?yield this.fetchUsers():yield this.fetchFilteredUsers(),this.userListSubscription=this.manageUsersService.getUsersListSubject().subscribe({next:s=>{this.dataSource.data=s.userPage.content,this.itemsCount=s.count}})}))}fetchUsers(){return It(this,null,function*(){yield this.manageUsersService.fetchPaginatedUsers(this.pageIndex,this.pageSize)})}fetchFilteredUsers(){return It(this,null,function*(){yield this.manageUsersService.fetchPaginatedUsersFiltered(this.pageIndex,this.pageSize,this.selectedFilterOption,this.searchValue)})}ngOnDestroy(){this.userListSubscription?.unsubscribe()}ngAfterViewInit(){this.paginator.length=this.itemsCount,this.paginator.pageIndex=this.pageIndex,this.paginator.pageSize=this.pageSize,this.dataSource.sort=this.sort}onPageChange(n){this.router.navigate([],{relativeTo:this.route,queryParams:{page:n.pageIndex,size:n.pageSize},queryParamsHandling:"merge"})}filterData(){this.searchValue!==""&&this.router.navigate([],{relativeTo:this.route,queryParams:{search:this.searchValue,filter:this.selectedFilterOption,page:0,size:this.pageSize},queryParamsHandling:"merge"})}handleDeleteKeyboardEvent(n){n.key==="Enter"&&this.filterData()}removeFilter(){this.router.navigate([],{relativeTo:this.route,queryParams:{filter:null,search:null,page:0,size:this.pageSize},queryParamsHandling:"merge"})}onAddClick(){this.dialog.open(tT,{width:"60%",data:{user:{id:"",firstName:"",lastName:"",username:"",email:"",role:""},title:"Adauga user"}}).afterClosed().subscribe(s=>It(this,null,function*(){s&&(yield this.manageUsersService.addUser(s,this.pageIndex,this.pageSize))}))}onEditClick(){this.dialog.open(tT,{width:"60%",data:{user:this.rowData,title:"Modifica user"}}).afterClosed().subscribe(s=>It(this,null,function*(){s&&(yield this.manageUsersService.updateUser(s))}))}onDeleteClick(){this.dialog.open(Nd,{width:"30%"}).afterClosed().subscribe(s=>It(this,null,function*(){s&&(yield this.manageUsersService.deleteUser(this.rowData.id,this.pageIndex,this.pageSize),this.dataSource.data.length===0&&this.pageIndex>0&&(this.searchValue===""&&this.selectedFilterOption==="firstName"?yield this.router.navigate([],{relativeTo:this.route,queryParams:{page:this.pageIndex-1,size:this.pageSize,search:null,filter:null},queryParamsHandling:"merge"}):yield this.router.navigate([],{relativeTo:this.route,queryParams:{page:this.pageIndex-1,size:this.pageSize,search:this.searchValue,filter:this.selectedFilterOption},queryParamsHandling:"merge"})))}))}};r.\u0275fac=function(s){return new(s||r)(B(fo),B(Je),B(p5),B(En),B(tn))},r.\u0275cmp=Et({type:r,selectors:[["app-manage-users"]],viewQuery:function(s,d){if(s&1&&(Ge(ja,5),Ge(na,5)),s&2){let m;ce(m=de())&&(d.paginator=m.first),ce(m=de())&&(d.sort=m.first)}},hostBindings:function(s,d){s&1&&ct("keydown",function(_){return d.handleDeleteKeyboardEvent(_)},!1,ol)},standalone:!0,features:[At],decls:38,vars:15,consts:[[1,"input-group","rounded","pt-2"],["type","search","placeholder","Cauta","aria-label","Search","aria-describedby","search-addon",1,"form-control","rounded",3,"ngModel","ngModelChange"],["id","search-addon",1,"input-group-text","border-0"],["role","button",1,"bg-primary","text-white","fas","fa-search","search-button",3,"click"],[1,"btn","btn-primary","ms-5","me-2",3,"click"],[1,"radio-group","mt-2"],[1,"form-check","form-check-inline"],["type","radio","name","radioGroup","id","firstNameRadio","value","firstName",1,"form-check-input",3,"ngModel","ngModelChange"],["for","firstNameRadio",1,"form-check-label"],["type","radio","name","radioGroup","id","lastNameRadio","value","lastName",1,"form-check-input",3,"ngModel","ngModelChange"],["for","lastNameRadio",1,"form-check-label"],["type","radio","name","radioGroup","id","usernameRadio","value","username",1,"form-check-input",3,"ngModel","ngModelChange"],["for","usernameRadio",1,"form-check-label"],["type","radio","name","radioGroup","id","emailRadio","value","email",1,"form-check-input",3,"ngModel","ngModelChange"],["for","emailRadio",1,"form-check-label"],["class","form-check-inline",4,"ngIf"],["mat-table","","matSort","",3,"dataSource"],[3,"matColumnDef",4,"ngFor","ngForOf"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","","aria-label","Select page",3,"length","pageSize","pageIndex","pageSizeOptions","page"],["contextMenu","matMenu"],["mat-menu-item","",3,"click"],[1,"form-check-inline"],[1,"btn",3,"click"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-button","",3,"matMenuTriggerFor","click"],[1,"fa-solid","fa-pen-to-square"],["mat-header-row",""],["mat-row",""]],template:function(s,d){s&1&&(A(0,"div",0)(1,"input",1),kn("ngModelChange",function(_){return An(d.searchValue,_)||(d.searchValue=_),_}),k(),A(2,"span",2)(3,"i",3),ct("click",function(){return d.filterData()}),k(),A(4,"button",4),ct("click",function(){return d.onAddClick()}),V(5," Adauga "),k()()(),A(6,"div",5)(7,"div",6)(8,"input",7),kn("ngModelChange",function(_){return An(d.selectedFilterOption,_)||(d.selectedFilterOption=_),_}),k(),A(9,"label",8),V(10,"Prenume"),k()(),A(11,"div",6)(12,"input",9),kn("ngModelChange",function(_){return An(d.selectedFilterOption,_)||(d.selectedFilterOption=_),_}),k(),A(13,"label",10),V(14,"Nume"),k()(),A(15,"div",6)(16,"input",11),kn("ngModelChange",function(_){return An(d.selectedFilterOption,_)||(d.selectedFilterOption=_),_}),k(),A(17,"label",12),V(18,"Username"),k()(),A(19,"div",6)(20,"input",13),kn("ngModelChange",function(_){return An(d.selectedFilterOption,_)||(d.selectedFilterOption=_),_}),k(),A(21,"label",14),V(22,"Email"),k()(),mt(23,tot,3,0,"div",15),k(),A(24,"table",16),mt(25,not,3,1,"ng-container",17),rr(26,18),mt(27,rot,2,0,"th",19)(28,oot,3,1,"td",20),or(),mt(29,sot,1,0,"tr",21)(30,aot,1,0,"tr",22),k(),A(31,"mat-paginator",23),ct("page",function(_){return d.onPageChange(_)}),k(),A(32,"mat-menu",null,24)(34,"button",25),ct("click",function(){return d.onEditClick()}),V(35," Modifica "),k(),A(36,"button",25),ct("click",function(){return d.onDeleteClick()}),V(37," Sterge "),k()()),s&2&&(N(),In("ngModel",d.searchValue),N(7),In("ngModel",d.selectedFilterOption),N(4),In("ngModel",d.selectedFilterOption),N(4),In("ngModel",d.selectedFilterOption),N(4),In("ngModel",d.selectedFilterOption),N(3),Z("ngIf",d.shouldDisplayRemoveFilterButton),N(),Z("dataSource",d.dataSource),N(),Z("ngForOf",d.displayedColumns),N(4),Z("matHeaderRowDef",d.displayedColumns.concat("actions")),N(),Z("matRowDefColumns",d.displayedColumns.concat("actions")),N(),Z("length",d.itemsCount)("pageSize",d.pageSize)("pageIndex",d.pageIndex)("pageSizeOptions",Nr(14,lot)))},dependencies:[Aa,Oa,Fa,Ra,Pa,ka,Fd,ja,qe,Ii,na,zd,Na,La,Ba,za,Va,yl,Qs,m5,Yi,en,Dc,ji,jo],styles:["th[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.search-button[_ngcontent-%COMP%]{margin-left:5px;padding:.5rem 1rem;border-radius:.3rem}.search-button[_ngcontent-%COMP%]:hover{cursor:pointer;box-shadow:2px 4px 5px #0006}.input-group-text[_ngcontent-%COMP%]{padding-left:0}"]});let a=r;return a})();var cot=["fileInput"];function dot(a,r){a&1&&(A(0,"div",21),V(1," Name is required "),k())}function uot(a,r){a&1&&(A(0,"div",21),V(1," Address is required "),k())}function hot(a,r){if(a&1){let l=Ce();A(0,"div",22),dt(1,"img",23),A(2,"button",24),ct("click",function(){te(l);let s=vt();return ee(s.removeImage())}),dt(3,"i",25),k()()}if(a&2){let l=vt();N(),Z("src",l.imageSrc,Tr)}}function mot(a,r){a&1&&(A(0,"div",21),V(1," Image is required "),k())}var eT=(()=>{let r=class r{constructor(n,s,d){this.dialogRef=n,this.data=s,this.fb=d,this.imageSrc=null,this.imageFile=null,this.isImageNull=!1,this.registrationForm=this.fb.group({name:[this.data.location.name,Le.required],address:[this.data.location.address,Le.required]})}ngOnInit(){this.imageSrc=this.data.location.imageUrl,this.isImageNull=this.imageSrc===null}onCloseClick(){this.dialogRef.close()}onConfirmClick(){if(this.registrationForm.markAllAsTouched(),this.registrationForm.valid){let n=Ri(Gt({},this.registrationForm.value),{id:this.data.location.id,imageUrl:this.imageSrc});this.imageFile===null&&this.imageSrc!==""?this.dialogRef.close(n):this.imageFile!==null?(n=Ri(Gt({},n),{image:this.imageFile}),this.dialogRef.close(n)):(this.isImageNull=!0,setTimeout(()=>{this.isImageNull=!1},2e3))}}onFileSelected(n){if(this.imageFile=n.target.files[0],this.imageFile){let s=new FileReader;s.onload=()=>{this.imageSrc=s.result},s.readAsDataURL(this.imageFile)}}removeImage(){this.imageSrc="",this.imageFile=null,this.fileInput.nativeElement.value=""}};r.\u0275fac=function(s){return new(s||r)(B(Qn),B(jr),B(wr))},r.\u0275cmp=Et({type:r,selectors:[["app-add-edit-location"]],viewQuery:function(s,d){if(s&1&&Ge(cot,5),s&2){let m;ce(m=de())&&(d.fileInput=m.first)}},standalone:!0,features:[At],decls:28,vars:6,consts:[[1,"modal-content"],[1,"modal-header","mb-5"],["id","exampleModalLabel",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body","mb-3"],[3,"formGroup"],[1,"mb-3"],["mdbInput","","type","text","id","name","formControlName","name",1,"form-control"],["name",""],["mdbLabel","","for","name",1,"form-label"],["class","text-danger mb-4",4,"ngIf"],[1,"mb-4"],["mdbInput","","type","text","id","address","formControlName","address","required","",1,"form-control"],["address",""],["mdbLabel","","for","address",1,"form-label"],["type","file","id","image","accept",".jpg, .jpeg, .png, .bmp",1,"form-control",3,"change"],["fileInput",""],["class","mt-2 ms-1",4,"ngIf"],[1,"modal-footer","mt-2"],["type","button",1,"btn","btn-secondary","me-1",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"text-danger","mb-4"],[1,"mt-2","ms-1"],["alt","image",1,"img-fluid",2,"max-height","200px","max-width","200px",3,"src"],[1,"btn","btn-tertiary","ms-2",3,"click"],[1,"fa-solid","fa-x"]],template:function(s,d){if(s&1&&(A(0,"div",0)(1,"div",1)(2,"h5",2),V(3),k(),A(4,"button",3),ct("click",function(){return d.onCloseClick()}),k()(),A(5,"div",4)(6,"form",5)(7,"mdb-form-control",6),dt(8,"input",7,8),A(10,"label",9),V(11,"Nume"),k()(),mt(12,dot,2,0,"div",10),A(13,"mdb-form-control",11),dt(14,"input",12,13),A(16,"label",14),V(17,"Adresa"),k()(),mt(18,uot,2,0,"div",10),k()(),A(19,"input",15,16),ct("change",function(_){return d.onFileSelected(_)}),k(),mt(21,hot,4,1,"div",17)(22,mot,2,0,"div",10),A(23,"div",18)(24,"button",19),ct("click",function(){return d.onCloseClick()}),V(25," Cancel "),k(),A(26,"button",20),ct("click",function(){return d.onConfirmClick()}),V(27,"Save changes"),k()()()),s&2){let m,_;N(3),De(d.data.title),N(3),Z("formGroup",d.registrationForm),N(6),Z("ngIf",((m=d.registrationForm.get("name"))==null?null:m.invalid)&&((m=d.registrationForm.get("name"))==null?null:m.touched)),N(6),Z("ngIf",((_=d.registrationForm.get("address"))==null?null:_.invalid)&&((_=d.registrationForm.get("address"))==null?null:_.touched)),N(3),Z("ngIf",d.imageSrc!==""),N(),Z("ngIf",d.isImageNull)}},dependencies:[Kr,mo,po,oo,qe,Rn,xr,en,ji,br,Xr,Vn,ur],styles:[".modal-content[_ngcontent-%COMP%]{padding:20px}"]});let a=r;return a})();var Xm=(()=>{let r=class r{constructor(n,s,d){this.http=n,this.identityService=s,this.snackBar=d,this.locationListSubject=new Ze({})}setLocationsListSubject(n){this.locationListSubject.next(n)}getLocationsListSubject(){return this.locationListSubject.asObservable()}fetchPaginatedLocations(n,s){return It(this,null,function*(){try{let d=yield Ve(this.http.get(Me+"/locations",{params:{page:n.toString(),size:s.toString()},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setLocationsListSubject(d)}catch{this.snackBar.open("Error fetching locations","Close",{duration:3e3})}})}fetchPaginatedLocationsFiltered(n,s,d,m){return It(this,null,function*(){try{let _=yield Ve(this.http.get(Me+"/locations/filtered",{params:{page:n.toString(),size:s.toString(),filter:d,search:m},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setLocationsListSubject(_)}catch{this.snackBar.open("Error fetching locations","Close",{duration:3e3})}})}addLocation(n,s,d){return It(this,null,function*(){try{let m=yield Ve(this.http.post(Me+"/locations",Ua(n),{params:{page:s.toString(),size:d.toString()},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setLocationsListSubject(m)}catch{this.snackBar.open("Error adding location","Close",{duration:3e3})}})}editLocation(n){return It(this,null,function*(){try{let s=yield Ve(this.http.patch(Me+"/locations",Ua(n),{headers:{Authorization:"Bearer "+this.identityService.getToken()}})),d=this.locationListSubject.getValue();d.locationPage.content=d.locationPage.content.map(m=>m.id===n.id?n:m),this.setLocationsListSubject(d)}catch{this.snackBar.open("Error editing location","Close",{duration:3e3})}})}deleteLocation(n,s,d){return It(this,null,function*(){try{let m=yield Ve(this.http.delete(Me+`/locations/${n}`,{params:{page:s.toString(),size:d.toString()},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setLocationsListSubject(m)}catch{this.snackBar.open("Error deleting location","Close",{duration:3e3})}})}fetchAllLocations(){return It(this,null,function*(){return yield Ve(this.http.get(Me+"/locations/all",{headers:{Authorization:"Bearer "+this.identityService.getToken()}}))})}};r.\u0275fac=function(s){return new(s||r)(ht(Gi),ht(hi),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function pot(a,r){if(a&1){let l=Ce();A(0,"div",22)(1,"button",23),ct("click",function(){te(l);let s=vt();return ee(s.removeFilter())}),V(2,"Sterge filtrul"),k()()}}function fot(a,r){if(a&1&&(A(0,"th",26),V(1),k()),a&2){let l=vt().$implicit,n=vt();N(),ae(" ",n.columnMap[l]," ")}}function got(a,r){if(a&1&&(A(0,"td",27),V(1),k()),a&2){let l=r.$implicit,n=vt().$implicit;N(),ae(" ",l[n]," ")}}function _ot(a,r){if(a&1&&(rr(0,24),mt(1,fot,2,1,"th",25)(2,got,2,1,"td",16),or()),a&2){let l=r.$implicit;Z("matColumnDef",l)}}function vot(a,r){a&1&&(A(0,"th",28),V(1," Actiuni "),k())}function yot(a,r){if(a&1){let l=Ce();A(0,"td",27)(1,"button",29),ct("click",function(){let d=te(l).$implicit,m=vt();return ee(m.rowData=d)}),dt(2,"i",30),k()()}if(a&2){vt();let l=Ir(25);N(),Z("matMenuTriggerFor",l)}}function bot(a,r){a&1&&dt(0,"tr",31)}function xot(a,r){a&1&&dt(0,"tr",32)}var wot=()=>[5,10,20,50],g5=(()=>{let r=class r{constructor(n,s,d,m,_){this.dialog=n,this.snackBar=s,this.manageLocationsService=d,this.route=m,this.router=_,this.dataSource=new ps,this.itemsCount=0,this.displayedColumns=["name","address"],this.searchValue="",this.selectedFilterOption="name",this.shouldDisplayRemoveFilterButton=!1,this.pageIndex=0,this.pageSize=5,this.columnMap={name:"Nume",address:"Adresa"}}ngOnInit(){this.route.queryParams.subscribe(n=>It(this,null,function*(){this.pageIndex=n.page||0,this.pageSize=n.size||5,this.searchValue=n.search||"",this.selectedFilterOption=n.filter||"name",this.shouldDisplayRemoveFilterButton=!!(n.filter&&n.search),this.searchValue===""&&this.selectedFilterOption==="name"?yield this.fetchLocations():yield this.fetchFilteredLocations(),this.locationListSubscription=this.manageLocationsService.getLocationsListSubject().subscribe(s=>{s&&(this.dataSource.data=s.locationPage.content,this.itemsCount=s.count)})}))}fetchLocations(){return It(this,null,function*(){yield this.manageLocationsService.fetchPaginatedLocations(this.pageIndex,this.pageSize)})}fetchFilteredLocations(){return It(this,null,function*(){yield this.manageLocationsService.fetchPaginatedLocationsFiltered(this.pageIndex,this.pageSize,this.selectedFilterOption,this.searchValue)})}ngOnDestroy(){this.locationListSubscription?.unsubscribe()}ngAfterViewInit(){this.paginator.length=this.itemsCount,this.paginator.pageIndex=this.pageIndex,this.paginator.pageSize=this.pageSize,this.dataSource.sort=this.sort}onPageChange(n){this.router.navigate([],{relativeTo:this.route,queryParams:{page:n.pageIndex,size:n.pageSize},queryParamsHandling:"merge"})}filterData(){this.searchValue!==""&&this.router.navigate([],{relativeTo:this.route,queryParams:{search:this.searchValue,filter:this.selectedFilterOption,page:0,size:this.pageSize},queryParamsHandling:"merge"})}handleDeleteKeyboardEvent(n){n.key==="Enter"&&this.filterData()}removeFilter(){this.router.navigate([],{relativeTo:this.route,queryParams:{filter:null,search:null,page:0,size:this.pageSize},queryParamsHandling:"merge"})}onAddClick(){this.dialog.open(eT,{width:"60%",data:{location:{name:"",address:"",imageUrl:""},title:"Adauga locatie"}}).afterClosed().subscribe(s=>It(this,null,function*(){s&&(yield this.manageLocationsService.addLocation(s,this.pageIndex,this.pageSize))}))}onEditClick(){this.dialog.open(eT,{width:"60%",data:{location:this.rowData,title:"Modifica locatia"}}).afterClosed().subscribe(s=>It(this,null,function*(){s&&(yield this.manageLocationsService.editLocation(s))}))}onDeleteClick(){this.dialog.open(Nd,{width:"30%"}).afterClosed().subscribe(s=>It(this,null,function*(){s&&(yield this.manageLocationsService.deleteLocation(this.rowData.id,this.pageIndex,this.pageSize),this.dataSource.data.length===0&&this.pageIndex>0&&(this.searchValue===""&&this.selectedFilterOption==="name"?yield this.router.navigate([],{relativeTo:this.route,queryParams:{page:this.pageIndex-1,size:this.pageSize,search:null,filter:null},queryParamsHandling:"merge"}):yield this.router.navigate([],{relativeTo:this.route,queryParams:{page:this.pageIndex-1,size:this.pageSize,search:this.searchValue,filter:this.selectedFilterOption},queryParamsHandling:"merge"})))}))}};r.\u0275fac=function(s){return new(s||r)(B(fo),B(Je),B(Xm),B(En),B(tn))},r.\u0275cmp=Et({type:r,selectors:[["app-manage-locations"]],viewQuery:function(s,d){if(s&1&&(Ge(ja,5),Ge(na,5)),s&2){let m;ce(m=de())&&(d.paginator=m.first),ce(m=de())&&(d.sort=m.first)}},hostBindings:function(s,d){s&1&&ct("keydown",function(_){return d.handleDeleteKeyboardEvent(_)},!1,ol)},standalone:!0,features:[At],decls:30,vars:13,consts:[[1,"input-group","rounded","pt-2"],["type","search","placeholder","Cauta","aria-label","Search","aria-describedby","search-addon",1,"form-control","rounded",3,"ngModel","ngModelChange"],["id","search-addon",1,"input-group-text","border-0"],["role","button",1,"bg-primary","text-white","fas","fa-search","search-button",3,"click"],[1,"btn","btn-primary","ms-5","me-2",3,"click"],[1,"radio-group","mt-2"],[1,"form-check","form-check-inline"],["type","radio","name","radioGroup","id","name","value","name",1,"form-check-input",3,"ngModel","ngModelChange"],["for","name",1,"form-check-label"],["type","radio","name","radioGroup","id","address","value","address",1,"form-check-input",3,"ngModel","ngModelChange"],["for","address",1,"form-check-label"],["class","form-check-inline",4,"ngIf"],["mat-table","","matSort","",3,"dataSource"],[3,"matColumnDef",4,"ngFor","ngForOf"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","","aria-label","Select page",3,"length","pageSize","pageIndex","pageSizeOptions","page"],["contextMenu","matMenu"],["mat-menu-item","",3,"click"],[1,"form-check-inline"],[1,"btn",3,"click"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-button","",3,"matMenuTriggerFor","click"],[1,"fa-solid","fa-pen-to-square"],["mat-header-row",""],["mat-row",""]],template:function(s,d){s&1&&(A(0,"div",0)(1,"input",1),kn("ngModelChange",function(_){return An(d.searchValue,_)||(d.searchValue=_),_}),k(),A(2,"span",2)(3,"i",3),ct("click",function(){return d.filterData()}),k(),A(4,"button",4),ct("click",function(){return d.onAddClick()}),V(5," Adauga "),k()()(),A(6,"div",5)(7,"div",6)(8,"input",7),kn("ngModelChange",function(_){return An(d.selectedFilterOption,_)||(d.selectedFilterOption=_),_}),k(),A(9,"label",8),V(10,"Nume"),k()(),A(11,"div",6)(12,"input",9),kn("ngModelChange",function(_){return An(d.selectedFilterOption,_)||(d.selectedFilterOption=_),_}),k(),A(13,"label",10),V(14,"Adresa"),k()(),mt(15,pot,3,0,"div",11),k(),A(16,"table",12),mt(17,_ot,3,1,"ng-container",13),rr(18,14),mt(19,vot,2,0,"th",15)(20,yot,3,1,"td",16),or(),mt(21,bot,1,0,"tr",17)(22,xot,1,0,"tr",18),k(),A(23,"mat-paginator",19),ct("page",function(_){return d.onPageChange(_)}),k(),A(24,"mat-menu",null,20)(26,"button",21),ct("click",function(){return d.onEditClick()}),V(27," Modifica "),k(),A(28,"button",21),ct("click",function(){return d.onDeleteClick()}),V(29," Sterge "),k()()),s&2&&(N(),In("ngModel",d.searchValue),N(7),In("ngModel",d.selectedFilterOption),N(4),In("ngModel",d.selectedFilterOption),N(3),Z("ngIf",d.shouldDisplayRemoveFilterButton),N(),Z("dataSource",d.dataSource),N(),Z("ngForOf",d.displayedColumns),N(4),Z("matHeaderRowDef",d.displayedColumns.concat("actions")),N(),Z("matRowDefColumns",d.displayedColumns.concat("actions")),N(),Z("length",d.itemsCount)("pageSize",d.pageSize)("pageIndex",d.pageIndex)("pageSizeOptions",Nr(12,wot)))},dependencies:[Qs,Fa,ka,Pa,Oa,Na,La,Va,yl,ja,Ba,za,na,zd,Aa,Ii,Rn,en,Dc,ji,Yi,jo,Ra,Fd,qe],styles:["th[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.search-button[_ngcontent-%COMP%]{margin-left:5px;padding:.5rem 1rem;border-radius:.3rem}.search-button[_ngcontent-%COMP%]:hover{cursor:pointer;box-shadow:2px 4px 5px #0006}.input-group-text[_ngcontent-%COMP%]{padding-left:0}"]});let a=r;return a})();function Cot(a,r){a&1&&(A(0,"div",20),V(1," Title is required "),k())}function Sot(a,r){a&1&&(A(0,"div",20),V(1," Price is invalid "),k())}function Eot(a,r){a&1&&(A(0,"div",20),V(1," Quantity is invalid "),k())}var _5=(()=>{let r=class r{constructor(n,s,d){this.dialogRef=n,this.data=s,this.fb=d,this.registrationForm=this.fb.group({name:["",Le.required],price:["",[Le.required,Le.pattern("^[0-9]*$")]],remainingQuantity:["",[Le.required,Le.pattern("^[0-9]*$")]]})}onCloseClick(){this.dialogRef.close()}onConfirmClick(){this.registrationForm.markAllAsTouched(),this.registrationForm.valid&&this.dialogRef.close(this.registrationForm.value)}};r.\u0275fac=function(s){return new(s||r)(B(Qn),B(jr),B(wr))},r.\u0275cmp=Et({type:r,selectors:[["app-add-ticket-type"]],standalone:!0,features:[At],decls:30,vars:4,consts:[[1,"modal-content"],[1,"modal-header","mb-5"],["id","exampleModalLabel",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body","mb-3"],[3,"formGroup"],[1,"mb-3"],["mdbInput","","type","text","id","name","formControlName","name",1,"form-control"],["name",""],["mdbLabel","","for","name",1,"form-label"],["class","text-danger mb-4",4,"ngIf"],["mdbInput","","type","text","id","price","formControlName","price",1,"form-control"],["price",""],["mdbLabel","","for","price",1,"form-label"],["mdbInput","","type","text","id","quantity","formControlName","remainingQuantity",1,"form-control"],["quantity",""],["mdbLabel","","for","quantity",1,"form-label"],[1,"modal-footer","mt-2"],["type","button",1,"btn","btn-secondary","me-1",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"text-danger","mb-4"]],template:function(s,d){if(s&1&&(A(0,"div",0)(1,"div",1)(2,"h5",2),V(3,"Add ticket"),k(),A(4,"button",3),ct("click",function(){return d.onCloseClick()}),k()(),A(5,"div",4)(6,"form",5)(7,"mdb-form-control",6),dt(8,"input",7,8),A(10,"label",9),V(11,"Name"),k()(),mt(12,Cot,2,0,"div",10),A(13,"mdb-form-control",6),dt(14,"input",11,12),A(16,"label",13),V(17,"Price"),k()(),mt(18,Sot,2,0,"div",10),A(19,"mdb-form-control",6),dt(20,"input",14,15),A(22,"label",16),V(23,"Quantity"),k()(),mt(24,Eot,2,0,"div",10),k(),A(25,"div",17)(26,"button",18),ct("click",function(){return d.onCloseClick()}),V(27,"Cancel"),k(),A(28,"button",19),ct("click",function(){return d.onConfirmClick()}),V(29,"Save changes"),k()()()()),s&2){let m,_,w;N(6),Z("formGroup",d.registrationForm),N(6),Z("ngIf",((m=d.registrationForm.get("name"))==null?null:m.invalid)&&((m=d.registrationForm.get("name"))==null?null:m.touched)),N(6),Z("ngIf",((_=d.registrationForm.get("price"))==null?null:_.invalid)&&((_=d.registrationForm.get("price"))==null?null:_.touched)),N(6),Z("ngIf",((w=d.registrationForm.get("quantity"))==null?null:w.invalid)&&((w=d.registrationForm.get("quantity"))==null?null:w.touched))}},dependencies:[Rn,xr,en,ji,br,Vn,ur,Kr,mo,po,oo,qe],styles:[".modal-content[_ngcontent-%COMP%]{padding:20px}"]});let a=r;return a})();var Vb=(()=>{let r=class r{constructor(n,s,d){this.http=n,this.identityService=s,this.snackBar=d,this.artistListSubject=new Ze({})}setArtistListSubject(n){this.artistListSubject.next(n)}getArtistListSubject(){return this.artistListSubject}fetchPaginatedArtists(n,s){return It(this,null,function*(){try{let d=yield Ve(this.http.get(Me+"/artists",{params:{page:n.toString(),size:s.toString()},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setArtistListSubject(d)}catch{this.snackBar.open("Failed to fetch artists","Close",{duration:3e3})}})}fetchPaginatedArtistsFiltered(n,s,d,m){return It(this,null,function*(){try{let _=yield Ve(this.http.get(Me+"/artists/filtered",{params:{page:n.toString(),size:s.toString(),search:d,filter:m},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setArtistListSubject(_)}catch{this.snackBar.open("Failed to fetch artists","Close",{duration:3e3})}})}fetchArtistsWithoutEventGenre(){return It(this,null,function*(){try{let n=this.http.get(Me+"/artists/without-event-genre");this.setArtistListSubject(n)}catch{this.snackBar.open("Failed to fetch artists","Close",{duration:3e3})}})}addArtist(n,s,d){return It(this,null,function*(){try{let m=yield Ve(this.http.post(Me+"/artists",Ua(n),{params:{page:s.toString(),size:d.toString()},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setArtistListSubject(m)}catch{this.snackBar.open("Failed to add artist","Close",{duration:3e3})}})}updateArtist(n){return It(this,null,function*(){try{let s=yield Ve(this.http.put(Me+"/artists",Ua(n),{headers:{Authorization:"Bearer "+this.identityService.getToken()}})),d=this.artistListSubject.value;d.artistPage.content=d.artistPage.content.map(m=>m.id===n.id?n:m),this.setArtistListSubject(d)}catch{this.snackBar.open("Failed to update artist","Close",{duration:3e3})}})}deleteArtist(n,s,d){return It(this,null,function*(){try{let m=yield Ve(this.http.delete(Me+"/artists/"+n,{params:{page:s.toString(),size:d.toString()},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setArtistListSubject(m)}catch{this.snackBar.open("Failed to delete artist","Close",{duration:3e3})}})}};r.\u0275fac=function(s){return new(s||r)(ht(Gi),ht(hi),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function Mot(a,r){if(a&1&&(A(0,"option",14),V(1),k()),a&2){let l=r.$implicit;Z("ngValue",l),N(),De(l.name)}}function Dot(a,r){a&1&&(A(0,"div",15),V(1," Name is required "),k())}var y5=(()=>{let r=class r{constructor(n,s,d,m){this.dialogRef=n,this.data=s,this.fb=d,this.manageArtistsService=m,this.artistList=[],this.registrationForm=this.fb.group({name:["",Le.required]})}ngOnInit(){return It(this,null,function*(){yield this.manageArtistsService.fetchArtistsWithoutEventGenre()})}onCloseClick(){this.dialogRef.close()}onConfirmClick(){this.registrationForm.markAllAsTouched(),this.registrationForm.valid&&this.dialogRef.close(this.registrationForm.value.name)}};r.\u0275fac=function(s){return new(s||r)(B(Qn),B(jr),B(wr),B(Vb))},r.\u0275cmp=Et({type:r,selectors:[["app-add-artist"]],standalone:!0,features:[At],decls:18,vars:3,consts:[[1,"modal-content"],[1,"modal-header","mb-5"],["id","exampleModalLabel",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body","mb-3"],[3,"formGroup"],[1,"mb-3"],["for","name",1,"form-label"],["id","name","name","name","formControlName","name","required","",1,"form-select"],[3,"ngValue",4,"ngFor","ngForOf"],["class","text-danger mb-4",4,"ngIf"],[1,"modal-footer","mt-2"],["type","button",1,"btn","btn-secondary","me-1",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[3,"ngValue"],[1,"text-danger","mb-4"]],template:function(s,d){if(s&1&&(A(0,"div",0)(1,"div",1)(2,"h5",2),V(3,"Add artist"),k(),A(4,"button",3),ct("click",function(){return d.onCloseClick()}),k()(),A(5,"div",4)(6,"form",5)(7,"div",6)(8,"label",7),V(9,"Artist"),k(),A(10,"select",8),mt(11,Mot,2,2,"option",9),k()(),mt(12,Dot,2,0,"div",10),k(),A(13,"div",11)(14,"button",12),ct("click",function(){return d.onCloseClick()}),V(15,"Cancel"),k(),A(16,"button",13),ct("click",function(){return d.onConfirmClick()}),V(17,"Save changes"),k()()()()),s&2){let m;N(6),Z("formGroup",d.registrationForm),N(5),Z("ngForOf",d.artistList),N(),Z("ngIf",((m=d.registrationForm.get("name"))==null||m.errors==null?null:m.errors.required)&&((m=d.registrationForm.get("name"))==null?null:m.touched))}},dependencies:[Yi,xr,Ca,Sa,wa,ji,br,Xr,Ii,qe,Rn,Vn,ur],styles:[".modal-content[_ngcontent-%COMP%]{padding:20px}"]});let a=r;return a})();var jb=(()=>{let r=class r{constructor(n,s,d){this.http=n,this.identityService=s,this.snackBar=d,this.eventListSubject=new Ze({})}setEventsListSubject(n){this.eventListSubject.next(n)}getEventsListSubject(){return this.eventListSubject}fetchPaginatedEvents(n,s){return It(this,null,function*(){try{let d=yield Ve(this.http.get(Me+"/events",{params:{page:n.toString(),size:s.toString()},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setEventsListSubject(d)}catch{this.snackBar.open("Failed to fetch events","Close",{duration:3e3})}})}fetchPaginatedEventsFiltered(n,s,d,m){return It(this,null,function*(){try{let _=yield Ve(this.http.get(Me+"/events/filtered",{params:{page:n.toString(),size:s.toString(),filter:d,search:m},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setEventsListSubject(_)}catch{this.snackBar.open("Failed to fetch events","Close",{duration:3e3})}})}addEvent(n,s,d){return It(this,null,function*(){try{let m=yield Ve(this.http.post(Me+"/events",Ua(n),{params:{page:s.toString(),size:d.toString()},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setEventsListSubject(m)}catch{this.snackBar.open("Failed to add event","Close",{duration:3e3})}})}updateEvent(n){return It(this,null,function*(){try{let s=yield Ve(this.http.put(Me+"/events",Ua(n),{headers:{Authorization:"Bearer "+this.identityService.getToken()}})),d=this.eventListSubject.getValue();d.eventPage.content=d.eventPage.content.map(m=>m.id===n.id?n:m),this.setEventsListSubject(d)}catch{this.snackBar.open("Failed to update event","Close",{duration:3e3})}})}deleteEvent(n,s,d){return It(this,null,function*(){try{let m=yield Ve(this.http.delete(Me+`/events/${n}`,{params:{page:s.toString(),size:d.toString()},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setEventsListSubject(m)}catch{this.snackBar.open("Failed to delete event","Close",{duration:3e3})}})}fetchEventById(n){return It(this,null,function*(){return yield Ve(this.http.get(Me+"/events/"+n,{headers:{Authorization:"Bearer "+this.identityService.getToken()}}))})}fetchAllBroadGenres(){return It(this,null,function*(){return yield Ve(this.http.get(Me+"/broad-genres",{headers:{Authorization:"Bearer "+this.identityService.getToken()}}))})}};r.\u0275fac=function(s){return new(s||r)(ht(Gi),ht(hi),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var Tot=["fileInput"];function Iot(a,r){a&1&&(A(0,"div",43),V(1," Title is required "),k())}function Aot(a,r){a&1&&(A(0,"div",43),V(1," Date is required "),k())}function kot(a,r){if(a&1&&(A(0,"option",44),V(1),k()),a&2){let l=r.$implicit,n=vt();Z("ngValue",l.name)("selected",l.name===(n.event==null?null:n.event.location.name)),N(),ae(" ",l.name," ")}}function Rot(a,r){a&1&&(A(0,"div",43),V(1," Location is required "),k())}function Pot(a,r){if(a&1&&(A(0,"option",44),V(1),k()),a&2){let l=r.$implicit,n=vt();Z("ngValue",l.name)("selected",l.name===(n.event==null?null:n.event.broadGenre.name)),N(),ae(" ",l.name," ")}}function Oot(a,r){a&1&&(A(0,"div",43),V(1," Genre is required "),k())}function Fot(a,r){a&1&&(A(0,"div",43),V(1," Short description is required "),k())}function Lot(a,r){a&1&&(A(0,"div",43),V(1," Description is required "),k())}function zot(a,r){if(a&1){let l=Ce();A(0,"div",45),dt(1,"img",46),A(2,"button",47),ct("click",function(){te(l);let s=vt();return ee(s.removeImage())}),dt(3,"i",48),k()()}if(a&2){let l=vt();N(),Z("src",l.imageSrc,Tr)}}function Not(a,r){a&1&&(A(0,"div",43),V(1," Image is required "),k())}function Bot(a,r){a&1&&(A(0,"th",49),V(1," Name "),k())}function Vot(a,r){if(a&1&&(A(0,"td",50),V(1),k()),a&2){let l=r.$implicit;N(),ae(" ",l.name," ")}}function jot(a,r){a&1&&(A(0,"th",49),V(1," Price "),k())}function Uot(a,r){if(a&1&&(A(0,"td",50),V(1),k()),a&2){let l=r.$implicit;N(),ae(" ",l.price," ")}}function Hot(a,r){a&1&&(A(0,"th",49),V(1," Quantity "),k())}function Got(a,r){if(a&1&&(A(0,"td",50),V(1),k()),a&2){let l=r.$implicit;N(),ae(" ",l.remainingQuantity," ")}}function qot(a,r){a&1&&(A(0,"th",49),V(1," Action "),k())}function Wot(a,r){if(a&1){let l=Ce();A(0,"td",50)(1,"button",51),ct("click",function(){let d=te(l).$implicit,m=vt();return ee(m.onDeleteTicketTypeClick(d))}),A(2,"mat-icon"),V(3,"delete"),k()()()}}function $ot(a,r){a&1&&dt(0,"tr",52)}function Yot(a,r){a&1&&dt(0,"tr",53)}function Zot(a,r){a&1&&(A(0,"th",49),V(1," Name "),k())}function Xot(a,r){if(a&1&&(A(0,"td",50),V(1),k()),a&2){let l=r.$implicit;N(),ae(" ",l.name," ")}}function Kot(a,r){a&1&&(A(0,"th",49),V(1," Action "),k())}function Qot(a,r){if(a&1){let l=Ce();A(0,"td",50)(1,"button",51),ct("click",function(){let d=te(l).$implicit,m=vt();return ee(m.onDeleteArtistClick(d))}),A(2,"mat-icon"),V(3,"delete"),k()()()}}function Jot(a,r){a&1&&dt(0,"tr",52)}function tst(a,r){a&1&&dt(0,"tr",53)}var x5=()=>["name","price","remainingQuantity","action"],w5=()=>["name","action"],nT=(()=>{let r=class r{constructor(n,s,d,m,_,w){this.dialogRef=n,this.data=s,this.fb=d,this.manageLocationsService=m,this.manageEventsService=_,this.dialog=w,this.imageSrc=null,this.imageFile=null,this.isImageNull=!1,this.ticketsDataSource=new ps,this.artistsDataSource=new ps}ngOnInit(){return It(this,null,function*(){this.registrationForm=this.fb.group({title:["",Le.required],date:["",Le.required],location:["",Le.required],broadGenre:["",Le.required],shortDescription:["",Le.required],description:["",Le.required]}),this.today=new Date().toISOString().split("T")[0],this.locations=yield this.manageLocationsService.fetchAllLocations(),this.broadGenres=yield this.manageEventsService.fetchAllBroadGenres(),this.data.eventId!==void 0&&(this.event=yield this.manageEventsService.fetchEventById(this.data.eventId),this.ticketsDataSource.data=this.event.ticketTypeList,this.artistsDataSource.data=this.event.artistList,this.imageSrc=this.event.imageUrl,this.isImageNull=this.imageSrc===null,this.registrationForm.patchValue({title:this.event.title,date:this.event.date,location:this.event.location.name,broadGenre:this.event.broadGenre,shortDescription:this.event.shortDescription,description:this.event.description}))})}onCloseClick(){this.dialogRef.close()}onConfirmClick(){if(this.registrationForm.markAllAsTouched(),this.registrationForm.valid){let n=Ri(Gt({},this.registrationForm.value),{id:this.data.eventId,imageUrl:this.imageSrc,ticketTypesList:this.ticketsDataSource.data.map(s=>({id:s.id,name:s.name,price:s.price,quantity:s.remainingQuantity})),artistIdList:this.artistsDataSource.data.map(s=>s.id)});n.locationId=this.locations.find(s=>s.name===n.location).id,n.broadGenreId=this.broadGenres.find(s=>s.name===n.broadGenre).id,this.imageFile===null&&this.imageSrc!=""?this.dialogRef.close(n):this.imageFile!==null?(n=Ri(Gt({},n),{image:this.imageFile}),this.dialogRef.close(n)):(this.isImageNull=!0,setTimeout(()=>{this.isImageNull=!1},2e3))}}onFileSelected(n){if(this.imageFile=n.target.files[0],this.imageFile){let s=new FileReader;s.onload=()=>{this.imageSrc=s.result},s.readAsDataURL(this.imageFile)}}removeImage(){this.imageSrc="",this.imageFile=null,this.fileInput.nativeElement.value=""}onAddTicketTypeClick(){this.dialog.open(_5,{width:"40%",disableClose:!0}).afterClosed().subscribe(s=>{s&&(this.ticketsDataSource.data=[...this.ticketsDataSource.data,s])})}onDeleteTicketTypeClick(n){this.ticketsDataSource.data=this.ticketsDataSource.data.filter(s=>s!==n)}onAddArtistClick(){this.dialog.open(y5).afterClosed().subscribe(s=>{s&&(this.artistsDataSource.data=[...this.artistsDataSource.data,s])})}onDeleteArtistClick(n){this.artistsDataSource.data=this.artistsDataSource.data.filter(s=>s!==n)}};r.\u0275fac=function(s){return new(s||r)(B(Qn),B(jr),B(wr),B(Xm),B(jb),B(fo))},r.\u0275cmp=Et({type:r,selectors:[["app-add-edit-event"]],viewQuery:function(s,d){if(s&1&&Ge(Tot,5),s&2){let m;ce(m=de())&&(d.fileInput=m.first)}},standalone:!0,features:[At],decls:86,vars:23,consts:[[1,"modal-content"],[1,"modal-header","mb-5"],["id","exampleModalLabel",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body","mb-3"],[3,"formGroup"],[1,"mb-3"],["mdbInput","","type","text","id","title","formControlName","title",1,"form-control"],["title",""],["mdbLabel","","for","title",1,"form-label"],["class","text-danger mb-4",4,"ngIf"],[1,"mb-4"],["mdbInput","","type","date","id","date","formControlName","date","required","",1,"form-control",3,"min"],["date",""],["mdbLabel","","for","date",1,"form-label"],["for","location",1,"form-label"],["id","location","name","location","formControlName","location","required","",1,"form-select"],[3,"ngValue","selected",4,"ngFor","ngForOf"],["for","broadGenre",1,"form-label"],["id","broadGenre","name","broadGenre","formControlName","broadGenre","required","",1,"form-select"],["mdbInput","","type","text","id","shortDescription","formControlName","shortDescription",1,"form-control"],["shortDescription",""],["mdbLabel","","for","shortDescription",1,"form-label"],["mdbInput","","type","text","id","description","formControlName","description",1,"form-control"],["description",""],["mdbLabel","","for","description",1,"form-label"],["type","file","id","image","accept",".jpg, .jpeg, .png, .bmp",1,"form-control",3,"change"],["fileInput",""],["class","mt-2 ms-1",4,"ngIf"],[1,"mt-4"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","price"],["matColumnDef","remainingQuantity"],["matColumnDef","action"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"btn","btn-primary",3,"click"],[1,"modal-footer","mt-2"],["type","button",1,"btn","btn-secondary","me-1",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"text-danger","mb-4"],[3,"ngValue","selected"],[1,"mt-2","ms-1"],["alt","image",1,"img-fluid",2,"max-height","200px","max-width","200px",3,"src"],[1,"btn","btn-tertiary","ms-2",3,"click"],[1,"fa-solid","fa-x"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(s,d){if(s&1&&(A(0,"div",0)(1,"div",1)(2,"h5",2),V(3),k(),A(4,"button",3),ct("click",function(){return d.onCloseClick()}),k()(),A(5,"div",4)(6,"form",5)(7,"mdb-form-control",6),dt(8,"input",7,8),A(10,"label",9),V(11,"Title"),k()(),mt(12,Iot,2,0,"div",10),A(13,"mdb-form-control",11),dt(14,"input",12,13),A(16,"label",14),V(17,"Date"),k()(),mt(18,Aot,2,0,"div",10),A(19,"div",6)(20,"label",15),V(21,"Location"),k(),A(22,"select",16),mt(23,kot,2,3,"option",17),k()(),mt(24,Rot,2,0,"div",10),A(25,"div",11)(26,"label",18),V(27,"Genre"),k(),A(28,"select",19),mt(29,Pot,2,3,"option",17),k()(),mt(30,Oot,2,0,"div",10),A(31,"mdb-form-control",6),dt(32,"textarea",20,21),A(34,"label",22),V(35,"Short description"),k()(),mt(36,Fot,2,0,"div",10),A(37,"mdb-form-control",6),dt(38,"textarea",23,24),A(40,"label",25),V(41,"Description"),k()(),mt(42,Lot,2,0,"div",10),k()(),A(43,"input",26,27),ct("change",function(_){return d.onFileSelected(_)}),k(),mt(45,zot,4,1,"div",28)(46,Not,2,0,"div",10),A(47,"div",29)(48,"h6"),V(49,"Tickets"),k(),A(50,"table",30),rr(51,31),mt(52,Bot,2,0,"th",32)(53,Vot,2,1,"td",33),or(),rr(54,34),mt(55,jot,2,0,"th",32)(56,Uot,2,1,"td",33),or(),rr(57,35),mt(58,Hot,2,0,"th",32)(59,Got,2,1,"td",33),or(),rr(60,36),mt(61,qot,2,0,"th",32)(62,Wot,4,0,"td",33),or(),mt(63,$ot,1,0,"tr",37)(64,Yot,1,0,"tr",38),k(),A(65,"button",39),ct("click",function(){return d.onAddTicketTypeClick()}),V(66," Add Ticket "),k()(),A(67,"div",29)(68,"h6"),V(69,"Artisti"),k(),A(70,"table",30),rr(71,31),mt(72,Zot,2,0,"th",32)(73,Xot,2,1,"td",33),or(),rr(74,36),mt(75,Kot,2,0,"th",32)(76,Qot,4,0,"td",33),or(),mt(77,Jot,1,0,"tr",37)(78,tst,1,0,"tr",38),k(),A(79,"button",39),ct("click",function(){return d.onAddArtistClick()}),V(80," Adauga Artist "),k()(),A(81,"div",40)(82,"button",41),ct("click",function(){return d.onCloseClick()}),V(83," Cancel "),k(),A(84,"button",42),ct("click",function(){return d.onConfirmClick()}),V(85,"Save changes"),k()()()),s&2){let m,_,w,S,T,L;N(3),De(d.data.title),N(3),Z("formGroup",d.registrationForm),N(6),Z("ngIf",((m=d.registrationForm.get("title"))==null?null:m.invalid)&&((m=d.registrationForm.get("title"))==null?null:m.touched)),N(2),Z("min",d.today),N(4),Z("ngIf",((_=d.registrationForm.get("date"))==null?null:_.invalid)&&((_=d.registrationForm.get("date"))==null?null:_.touched)),N(5),Z("ngForOf",d.locations),N(),Z("ngIf",((w=d.registrationForm.get("location"))==null||w.errors==null?null:w.errors.required)&&((w=d.registrationForm.get("location"))==null?null:w.touched)),N(5),Z("ngForOf",d.broadGenres),N(),Z("ngIf",((S=d.registrationForm.get("broadGenre"))==null||S.errors==null?null:S.errors.required)&&((S=d.registrationForm.get("broadGenre"))==null?null:S.touched)),N(6),Z("ngIf",((T=d.registrationForm.get("shortDescription"))==null?null:T.invalid)&&((T=d.registrationForm.get("shortDescription"))==null?null:T.touched)),N(6),Z("ngIf",((L=d.registrationForm.get("description"))==null?null:L.invalid)&&((L=d.registrationForm.get("description"))==null?null:L.touched)),N(3),Z("ngIf",d.imageSrc!==null),N(),Z("ngIf",d.isImageNull),N(4),Z("dataSource",d.ticketsDataSource),N(13),Z("matHeaderRowDef",Nr(19,x5)),N(),Z("matRowDefColumns",Nr(20,x5)),N(6),Z("dataSource",d.artistsDataSource),N(7),Z("matHeaderRowDef",Nr(21,w5)),N(),Z("matRowDefColumns",Nr(22,w5))}},dependencies:[Yi,xr,Ca,Sa,en,wa,ji,br,Xr,Kr,mo,po,oo,qe,Rn,Vn,ur,Ii,Aa,Pa,Ra,Oa,Fa,ka,Tc,Wy,La,Na,Ba,za],styles:[".modal-content[_ngcontent-%COMP%]{padding:20px}"]});let a=r;return a})();function Pr(a){let r=Object.prototype.toString.call(a);return a instanceof Date||typeof a=="object"&&r==="[object Date]"?new a.constructor(+a):typeof a=="number"||r==="[object Number]"||typeof a=="string"||r==="[object String]"?new Date(a):new Date(NaN)}function On(a,r){return a instanceof Date?new a.constructor(r):new Date(r)}function Ub(a,r){let l=Pr(a);return isNaN(r)?On(a,NaN):(r&&l.setDate(l.getDate()+r),l)}var est=Math.pow(10,8)*24*60*60*1e3,C1t=-est,Hb=6048e5;var C5=6e4,S5=36e5,E5=1e3;var ist=3600;var M5=ist*24,S1t=M5*7,nst=M5*365.2425,rst=nst/12,E1t=rst*3;var ost={};function Ql(){return ost}function js(a,r){let l=Ql(),n=r?.weekStartsOn??r?.locale?.options?.weekStartsOn??l.weekStartsOn??l.locale?.options?.weekStartsOn??0,s=Pr(a),d=s.getDay(),m=(d<n?7:0)+d-n;return s.setDate(s.getDate()-m),s.setHours(0,0,0,0),s}function bl(a){return js(a,{weekStartsOn:1})}function D5(a){let r=Pr(a),l=r.getFullYear(),n=On(a,0);n.setFullYear(l+1,0,4),n.setHours(0,0,0,0);let s=bl(n),d=On(a,0);d.setFullYear(l,0,4),d.setHours(0,0,0,0);let m=bl(d);return r.getTime()>=s.getTime()?l+1:r.getTime()>=m.getTime()?l:l-1}function Gb(a){let r=Pr(a),l=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return l.setUTCFullYear(r.getFullYear()),+a-+l}function T5(a){let r=D5(a),l=On(a,0);return l.setFullYear(r,0,4),l.setHours(0,0,0,0),bl(l)}var sst={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},I5=(a,r,l)=>{let n,s=sst[a];return typeof s=="string"?n=s:r===1?n=s.one:n=s.other.replace("{{count}}",r.toString()),l?.addSuffix?l.comparison&&l.comparison>0?"in "+n:n+" ago":n};function qb(a){return(r={})=>{let l=r.width?String(r.width):a.defaultWidth;return a.formats[l]||a.formats[a.defaultWidth]}}var ast={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},lst={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},cst={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},A5={date:qb({formats:ast,defaultWidth:"full"}),time:qb({formats:lst,defaultWidth:"full"}),dateTime:qb({formats:cst,defaultWidth:"full"})};var dst={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},k5=(a,r,l,n)=>dst[a];function Km(a){return(r,l)=>{let n=l?.context?String(l.context):"standalone",s;if(n==="formatting"&&a.formattingValues){let m=a.defaultFormattingWidth||a.defaultWidth,_=l?.width?String(l.width):m;s=a.formattingValues[_]||a.formattingValues[m]}else{let m=a.defaultWidth,_=l?.width?String(l.width):a.defaultWidth;s=a.values[_]||a.values[m]}let d=a.argumentCallback?a.argumentCallback(r):r;return s[d]}}var ust={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},hst={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},mst={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},pst={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},fst={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},gst={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},_st=(a,r)=>{let l=Number(a),n=l%100;if(n>20||n<10)switch(n%10){case 1:return l+"st";case 2:return l+"nd";case 3:return l+"rd"}return l+"th"},R5={ordinalNumber:_st,era:Km({values:ust,defaultWidth:"wide"}),quarter:Km({values:hst,defaultWidth:"wide",argumentCallback:a=>a-1}),month:Km({values:mst,defaultWidth:"wide"}),day:Km({values:pst,defaultWidth:"wide"}),dayPeriod:Km({values:fst,defaultWidth:"wide",formattingValues:gst,defaultFormattingWidth:"wide"})};function Qm(a){return(r,l={})=>{let n=l.width,s=n&&a.matchPatterns[n]||a.matchPatterns[a.defaultMatchWidth],d=r.match(s);if(!d)return null;let m=d[0],_=n&&a.parsePatterns[n]||a.parsePatterns[a.defaultParseWidth],w=Array.isArray(_)?yst(_,L=>L.test(m)):vst(_,L=>L.test(m)),S;S=a.valueCallback?a.valueCallback(w):w,S=l.valueCallback?l.valueCallback(S):S;let T=r.slice(m.length);return{value:S,rest:T}}}function vst(a,r){for(let l in a)if(Object.prototype.hasOwnProperty.call(a,l)&&r(a[l]))return l}function yst(a,r){for(let l=0;l<a.length;l++)if(r(a[l]))return l}function P5(a){return(r,l={})=>{let n=r.match(a.matchPattern);if(!n)return null;let s=n[0],d=r.match(a.parsePattern);if(!d)return null;let m=a.valueCallback?a.valueCallback(d[0]):d[0];m=l.valueCallback?l.valueCallback(m):m;let _=r.slice(s.length);return{value:m,rest:_}}}var bst=/^(\d+)(th|st|nd|rd)?/i,xst=/\d+/i,wst={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Cst={any:[/^b/i,/^(a|c)/i]},Sst={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Est={any:[/1/i,/2/i,/3/i,/4/i]},Mst={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Dst={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Tst={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Ist={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Ast={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},kst={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},O5={ordinalNumber:P5({matchPattern:bst,parsePattern:xst,valueCallback:a=>parseInt(a,10)}),era:Qm({matchPatterns:wst,defaultMatchWidth:"wide",parsePatterns:Cst,defaultParseWidth:"any"}),quarter:Qm({matchPatterns:Sst,defaultMatchWidth:"wide",parsePatterns:Est,defaultParseWidth:"any",valueCallback:a=>a+1}),month:Qm({matchPatterns:Mst,defaultMatchWidth:"wide",parsePatterns:Dst,defaultParseWidth:"any"}),day:Qm({matchPatterns:Tst,defaultMatchWidth:"wide",parsePatterns:Ist,defaultParseWidth:"any"}),dayPeriod:Qm({matchPatterns:Ast,defaultMatchWidth:"any",parsePatterns:kst,defaultParseWidth:"any"})};var rT={code:"en-US",formatDistance:I5,formatLong:A5,formatRelative:k5,localize:R5,match:O5,options:{weekStartsOn:0,firstWeekContainsDate:1}};function F5(a){let r=Pr(a),l=+bl(r)-+T5(r);return Math.round(l/Hb)+1}function Wb(a,r){let l=Pr(a),n=l.getFullYear(),s=Ql(),d=r?.firstWeekContainsDate??r?.locale?.options?.firstWeekContainsDate??s.firstWeekContainsDate??s.locale?.options?.firstWeekContainsDate??1,m=On(a,0);m.setFullYear(n+1,0,d),m.setHours(0,0,0,0);let _=js(m,r),w=On(a,0);w.setFullYear(n,0,d),w.setHours(0,0,0,0);let S=js(w,r);return l.getTime()>=_.getTime()?n+1:l.getTime()>=S.getTime()?n:n-1}function L5(a,r){let l=Ql(),n=r?.firstWeekContainsDate??r?.locale?.options?.firstWeekContainsDate??l.firstWeekContainsDate??l.locale?.options?.firstWeekContainsDate??1,s=Wb(a,r),d=On(a,0);return d.setFullYear(s,0,n),d.setHours(0,0,0,0),js(d,r)}function z5(a,r){let l=Pr(a),n=+js(l,r)-+L5(l,r);return Math.round(n/Hb)+1}var N5=(a,r)=>{switch(a){case"P":return r.date({width:"short"});case"PP":return r.date({width:"medium"});case"PPP":return r.date({width:"long"});case"PPPP":default:return r.date({width:"full"})}},B5=(a,r)=>{switch(a){case"p":return r.time({width:"short"});case"pp":return r.time({width:"medium"});case"ppp":return r.time({width:"long"});case"pppp":default:return r.time({width:"full"})}},Rst=(a,r)=>{let l=a.match(/(P+)(p+)?/)||[],n=l[1],s=l[2];if(!s)return N5(a,r);let d;switch(n){case"P":d=r.dateTime({width:"short"});break;case"PP":d=r.dateTime({width:"medium"});break;case"PPP":d=r.dateTime({width:"long"});break;case"PPPP":default:d=r.dateTime({width:"full"});break}return d.replace("{{date}}",N5(n,r)).replace("{{time}}",B5(s,r))},oT={p:B5,P:Rst};var Pst=/^D+$/,Ost=/^Y+$/,Fst=["D","DD","YY","YYYY"];function V5(a){return Pst.test(a)}function j5(a){return Ost.test(a)}function sT(a,r,l){let n=Lst(a,r,l);if(console.warn(n),Fst.includes(a))throw new RangeError(n)}function Lst(a,r,l){let n=a[0]==="Y"?"years":"days of the month";return`Use \`${a.toLowerCase()}\` instead of \`${a}\` (in \`${r}\`) for formatting ${n} to the input \`${l}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}function U5(){return Object.assign({},Ql())}function H5(a){let l=Pr(a).getDay();return l===0&&(l=7),l}function G5(a,r){let l=r instanceof Date?On(r,0):new r(0);return l.setFullYear(a.getFullYear(),a.getMonth(),a.getDate()),l.setHours(a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()),l}var zst=10,$b=class{subPriority=0;validate(r,l){return!0}},Yb=class extends $b{constructor(r,l,n,s,d){super(),this.value=r,this.validateValue=l,this.setValue=n,this.priority=s,d&&(this.subPriority=d)}validate(r,l){return this.validateValue(r,this.value,l)}set(r,l,n){return this.setValue(r,l,this.value,n)}},Zb=class extends $b{priority=zst;subPriority=-1;set(r,l){return l.timestampIsSet?r:On(r,G5(r,Date))}};var ti=class{run(r,l,n,s){let d=this.parse(r,l,n,s);return d?{setter:new Yb(d.value,this.validate,this.set,this.priority,this.subPriority),rest:d.rest}:null}validate(r,l,n){return!0}};var Xb=class extends ti{priority=140;parse(r,l,n){switch(l){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"})||n.era(r,{width:"narrow"});case"GGGGG":return n.era(r,{width:"narrow"});case"GGGG":default:return n.era(r,{width:"wide"})||n.era(r,{width:"abbreviated"})||n.era(r,{width:"narrow"})}}set(r,l,n){return l.era=n,r.setFullYear(n,0,1),r.setHours(0,0,0,0),r}incompatibleTokens=["R","u","t","T"]};var Fn={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},Ha={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function pr(a,r){return a&&{value:r(a.value),rest:a.rest}}function Mn(a,r){let l=r.match(a);return l?{value:parseInt(l[0],10),rest:r.slice(l[0].length)}:null}function Ga(a,r){let l=r.match(a);if(!l)return null;if(l[0]==="Z")return{value:0,rest:r.slice(1)};let n=l[1]==="+"?1:-1,s=l[2]?parseInt(l[2],10):0,d=l[3]?parseInt(l[3],10):0,m=l[5]?parseInt(l[5],10):0;return{value:n*(s*S5+d*C5+m*E5),rest:r.slice(l[0].length)}}function Kb(a){return Mn(Fn.anyDigitsSigned,a)}function rn(a,r){switch(a){case 1:return Mn(Fn.singleDigit,r);case 2:return Mn(Fn.twoDigits,r);case 3:return Mn(Fn.threeDigits,r);case 4:return Mn(Fn.fourDigits,r);default:return Mn(new RegExp("^\\d{1,"+a+"}"),r)}}function Jm(a,r){switch(a){case 1:return Mn(Fn.singleDigitSigned,r);case 2:return Mn(Fn.twoDigitsSigned,r);case 3:return Mn(Fn.threeDigitsSigned,r);case 4:return Mn(Fn.fourDigitsSigned,r);default:return Mn(new RegExp("^-?\\d{1,"+a+"}"),r)}}function tp(a){switch(a){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function Qb(a,r){let l=r>0,n=l?r:1-r,s;if(n<=50)s=a||100;else{let d=n+50,m=Math.trunc(d/100)*100,_=a>=d%100;s=a+m-(_?100:0)}return l?s:1-s}function Jb(a){return a%400===0||a%4===0&&a%100!==0}var tx=class extends ti{priority=130;incompatibleTokens=["Y","R","u","w","I","i","e","c","t","T"];parse(r,l,n){let s=d=>({year:d,isTwoDigitYear:l==="yy"});switch(l){case"y":return pr(rn(4,r),s);case"yo":return pr(n.ordinalNumber(r,{unit:"year"}),s);default:return pr(rn(l.length,r),s)}}validate(r,l){return l.isTwoDigitYear||l.year>0}set(r,l,n){let s=r.getFullYear();if(n.isTwoDigitYear){let m=Qb(n.year,s);return r.setFullYear(m,0,1),r.setHours(0,0,0,0),r}let d=!("era"in l)||l.era===1?n.year:1-n.year;return r.setFullYear(d,0,1),r.setHours(0,0,0,0),r}};var ex=class extends ti{priority=130;parse(r,l,n){let s=d=>({year:d,isTwoDigitYear:l==="YY"});switch(l){case"Y":return pr(rn(4,r),s);case"Yo":return pr(n.ordinalNumber(r,{unit:"year"}),s);default:return pr(rn(l.length,r),s)}}validate(r,l){return l.isTwoDigitYear||l.year>0}set(r,l,n,s){let d=Wb(r,s);if(n.isTwoDigitYear){let _=Qb(n.year,d);return r.setFullYear(_,0,s.firstWeekContainsDate),r.setHours(0,0,0,0),js(r,s)}let m=!("era"in l)||l.era===1?n.year:1-n.year;return r.setFullYear(m,0,s.firstWeekContainsDate),r.setHours(0,0,0,0),js(r,s)}incompatibleTokens=["y","R","u","Q","q","M","L","I","d","D","i","t","T"]};var ix=class extends ti{priority=130;parse(r,l){return l==="R"?Jm(4,r):Jm(l.length,r)}set(r,l,n){let s=On(r,0);return s.setFullYear(n,0,4),s.setHours(0,0,0,0),bl(s)}incompatibleTokens=["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"]};var nx=class extends ti{priority=130;parse(r,l){return l==="u"?Jm(4,r):Jm(l.length,r)}set(r,l,n){return r.setFullYear(n,0,1),r.setHours(0,0,0,0),r}incompatibleTokens=["G","y","Y","R","w","I","i","e","c","t","T"]};var rx=class extends ti{priority=120;parse(r,l,n){switch(l){case"Q":case"QQ":return rn(l.length,r);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"})||n.quarter(r,{width:"narrow",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(r,{width:"wide",context:"formatting"})||n.quarter(r,{width:"abbreviated",context:"formatting"})||n.quarter(r,{width:"narrow",context:"formatting"})}}validate(r,l){return l>=1&&l<=4}set(r,l,n){return r.setMonth((n-1)*3,1),r.setHours(0,0,0,0),r}incompatibleTokens=["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"]};var ox=class extends ti{priority=120;parse(r,l,n){switch(l){case"q":case"qq":return rn(l.length,r);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"})||n.quarter(r,{width:"narrow",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(r,{width:"wide",context:"standalone"})||n.quarter(r,{width:"abbreviated",context:"standalone"})||n.quarter(r,{width:"narrow",context:"standalone"})}}validate(r,l){return l>=1&&l<=4}set(r,l,n){return r.setMonth((n-1)*3,1),r.setHours(0,0,0,0),r}incompatibleTokens=["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"]};var sx=class extends ti{incompatibleTokens=["Y","R","q","Q","L","w","I","D","i","e","c","t","T"];priority=110;parse(r,l,n){let s=d=>d-1;switch(l){case"M":return pr(Mn(Fn.month,r),s);case"MM":return pr(rn(2,r),s);case"Mo":return pr(n.ordinalNumber(r,{unit:"month"}),s);case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"})||n.month(r,{width:"narrow",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(r,{width:"wide",context:"formatting"})||n.month(r,{width:"abbreviated",context:"formatting"})||n.month(r,{width:"narrow",context:"formatting"})}}validate(r,l){return l>=0&&l<=11}set(r,l,n){return r.setMonth(n,1),r.setHours(0,0,0,0),r}};var ax=class extends ti{priority=110;parse(r,l,n){let s=d=>d-1;switch(l){case"L":return pr(Mn(Fn.month,r),s);case"LL":return pr(rn(2,r),s);case"Lo":return pr(n.ordinalNumber(r,{unit:"month"}),s);case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"})||n.month(r,{width:"narrow",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(r,{width:"wide",context:"standalone"})||n.month(r,{width:"abbreviated",context:"standalone"})||n.month(r,{width:"narrow",context:"standalone"})}}validate(r,l){return l>=0&&l<=11}set(r,l,n){return r.setMonth(n,1),r.setHours(0,0,0,0),r}incompatibleTokens=["Y","R","q","Q","M","w","I","D","i","e","c","t","T"]};function q5(a,r,l){let n=Pr(a),s=z5(n,l)-r;return n.setDate(n.getDate()-s*7),n}var lx=class extends ti{priority=100;parse(r,l,n){switch(l){case"w":return Mn(Fn.week,r);case"wo":return n.ordinalNumber(r,{unit:"week"});default:return rn(l.length,r)}}validate(r,l){return l>=1&&l<=53}set(r,l,n,s){return js(q5(r,n,s),s)}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","i","t","T"]};function W5(a,r){let l=Pr(a),n=F5(l)-r;return l.setDate(l.getDate()-n*7),l}var cx=class extends ti{priority=100;parse(r,l,n){switch(l){case"I":return Mn(Fn.week,r);case"Io":return n.ordinalNumber(r,{unit:"week"});default:return rn(l.length,r)}}validate(r,l){return l>=1&&l<=53}set(r,l,n){return bl(W5(r,n))}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"]};var Nst=[31,28,31,30,31,30,31,31,30,31,30,31],Bst=[31,29,31,30,31,30,31,31,30,31,30,31],dx=class extends ti{priority=90;subPriority=1;parse(r,l,n){switch(l){case"d":return Mn(Fn.date,r);case"do":return n.ordinalNumber(r,{unit:"date"});default:return rn(l.length,r)}}validate(r,l){let n=r.getFullYear(),s=Jb(n),d=r.getMonth();return s?l>=1&&l<=Bst[d]:l>=1&&l<=Nst[d]}set(r,l,n){return r.setDate(n),r.setHours(0,0,0,0),r}incompatibleTokens=["Y","R","q","Q","w","I","D","i","e","c","t","T"]};var ux=class extends ti{priority=90;subpriority=1;parse(r,l,n){switch(l){case"D":case"DD":return Mn(Fn.dayOfYear,r);case"Do":return n.ordinalNumber(r,{unit:"date"});default:return rn(l.length,r)}}validate(r,l){let n=r.getFullYear();return Jb(n)?l>=1&&l<=366:l>=1&&l<=365}set(r,l,n){return r.setMonth(0,n),r.setHours(0,0,0,0),r}incompatibleTokens=["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"]};function ep(a,r,l){let n=Ql(),s=l?.weekStartsOn??l?.locale?.options?.weekStartsOn??n.weekStartsOn??n.locale?.options?.weekStartsOn??0,d=Pr(a),m=d.getDay(),w=(r%7+7)%7,S=7-s,T=r<0||r>6?r-(m+S)%7:(w+S)%7-(m+S)%7;return Ub(d,T)}var hx=class extends ti{priority=90;parse(r,l,n){switch(l){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"})||n.day(r,{width:"short",context:"formatting"})||n.day(r,{width:"narrow",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"})||n.day(r,{width:"narrow",context:"formatting"});case"EEEE":default:return n.day(r,{width:"wide",context:"formatting"})||n.day(r,{width:"abbreviated",context:"formatting"})||n.day(r,{width:"short",context:"formatting"})||n.day(r,{width:"narrow",context:"formatting"})}}validate(r,l){return l>=0&&l<=6}set(r,l,n,s){return r=ep(r,n,s),r.setHours(0,0,0,0),r}incompatibleTokens=["D","i","e","c","t","T"]};var mx=class extends ti{priority=90;parse(r,l,n,s){let d=m=>{let _=Math.floor((m-1)/7)*7;return(m+s.weekStartsOn+6)%7+_};switch(l){case"e":case"ee":return pr(rn(l.length,r),d);case"eo":return pr(n.ordinalNumber(r,{unit:"day"}),d);case"eee":return n.day(r,{width:"abbreviated",context:"formatting"})||n.day(r,{width:"short",context:"formatting"})||n.day(r,{width:"narrow",context:"formatting"});case"eeeee":return n.day(r,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(r,{width:"short",context:"formatting"})||n.day(r,{width:"narrow",context:"formatting"});case"eeee":default:return n.day(r,{width:"wide",context:"formatting"})||n.day(r,{width:"abbreviated",context:"formatting"})||n.day(r,{width:"short",context:"formatting"})||n.day(r,{width:"narrow",context:"formatting"})}}validate(r,l){return l>=0&&l<=6}set(r,l,n,s){return r=ep(r,n,s),r.setHours(0,0,0,0),r}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"]};var px=class extends ti{priority=90;parse(r,l,n,s){let d=m=>{let _=Math.floor((m-1)/7)*7;return(m+s.weekStartsOn+6)%7+_};switch(l){case"c":case"cc":return pr(rn(l.length,r),d);case"co":return pr(n.ordinalNumber(r,{unit:"day"}),d);case"ccc":return n.day(r,{width:"abbreviated",context:"standalone"})||n.day(r,{width:"short",context:"standalone"})||n.day(r,{width:"narrow",context:"standalone"});case"ccccc":return n.day(r,{width:"narrow",context:"standalone"});case"cccccc":return n.day(r,{width:"short",context:"standalone"})||n.day(r,{width:"narrow",context:"standalone"});case"cccc":default:return n.day(r,{width:"wide",context:"standalone"})||n.day(r,{width:"abbreviated",context:"standalone"})||n.day(r,{width:"short",context:"standalone"})||n.day(r,{width:"narrow",context:"standalone"})}}validate(r,l){return l>=0&&l<=6}set(r,l,n,s){return r=ep(r,n,s),r.setHours(0,0,0,0),r}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"]};function $5(a,r){let l=Pr(a),n=H5(l),s=r-n;return Ub(l,s)}var fx=class extends ti{priority=90;parse(r,l,n){let s=d=>d===0?7:d;switch(l){case"i":case"ii":return rn(l.length,r);case"io":return n.ordinalNumber(r,{unit:"day"});case"iii":return pr(n.day(r,{width:"abbreviated",context:"formatting"})||n.day(r,{width:"short",context:"formatting"})||n.day(r,{width:"narrow",context:"formatting"}),s);case"iiiii":return pr(n.day(r,{width:"narrow",context:"formatting"}),s);case"iiiiii":return pr(n.day(r,{width:"short",context:"formatting"})||n.day(r,{width:"narrow",context:"formatting"}),s);case"iiii":default:return pr(n.day(r,{width:"wide",context:"formatting"})||n.day(r,{width:"abbreviated",context:"formatting"})||n.day(r,{width:"short",context:"formatting"})||n.day(r,{width:"narrow",context:"formatting"}),s)}}validate(r,l){return l>=1&&l<=7}set(r,l,n){return r=$5(r,n),r.setHours(0,0,0,0),r}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"]};var gx=class extends ti{priority=80;parse(r,l,n){switch(l){case"a":case"aa":case"aaa":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"})||n.dayPeriod(r,{width:"narrow",context:"formatting"});case"aaaaa":return n.dayPeriod(r,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(r,{width:"wide",context:"formatting"})||n.dayPeriod(r,{width:"abbreviated",context:"formatting"})||n.dayPeriod(r,{width:"narrow",context:"formatting"})}}set(r,l,n){return r.setHours(tp(n),0,0,0),r}incompatibleTokens=["b","B","H","k","t","T"]};var _x=class extends ti{priority=80;parse(r,l,n){switch(l){case"b":case"bb":case"bbb":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"})||n.dayPeriod(r,{width:"narrow",context:"formatting"});case"bbbbb":return n.dayPeriod(r,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(r,{width:"wide",context:"formatting"})||n.dayPeriod(r,{width:"abbreviated",context:"formatting"})||n.dayPeriod(r,{width:"narrow",context:"formatting"})}}set(r,l,n){return r.setHours(tp(n),0,0,0),r}incompatibleTokens=["a","B","H","k","t","T"]};var vx=class extends ti{priority=80;parse(r,l,n){switch(l){case"B":case"BB":case"BBB":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"})||n.dayPeriod(r,{width:"narrow",context:"formatting"});case"BBBBB":return n.dayPeriod(r,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(r,{width:"wide",context:"formatting"})||n.dayPeriod(r,{width:"abbreviated",context:"formatting"})||n.dayPeriod(r,{width:"narrow",context:"formatting"})}}set(r,l,n){return r.setHours(tp(n),0,0,0),r}incompatibleTokens=["a","b","t","T"]};var yx=class extends ti{priority=70;parse(r,l,n){switch(l){case"h":return Mn(Fn.hour12h,r);case"ho":return n.ordinalNumber(r,{unit:"hour"});default:return rn(l.length,r)}}validate(r,l){return l>=1&&l<=12}set(r,l,n){let s=r.getHours()>=12;return s&&n<12?r.setHours(n+12,0,0,0):!s&&n===12?r.setHours(0,0,0,0):r.setHours(n,0,0,0),r}incompatibleTokens=["H","K","k","t","T"]};var bx=class extends ti{priority=70;parse(r,l,n){switch(l){case"H":return Mn(Fn.hour23h,r);case"Ho":return n.ordinalNumber(r,{unit:"hour"});default:return rn(l.length,r)}}validate(r,l){return l>=0&&l<=23}set(r,l,n){return r.setHours(n,0,0,0),r}incompatibleTokens=["a","b","h","K","k","t","T"]};var xx=class extends ti{priority=70;parse(r,l,n){switch(l){case"K":return Mn(Fn.hour11h,r);case"Ko":return n.ordinalNumber(r,{unit:"hour"});default:return rn(l.length,r)}}validate(r,l){return l>=0&&l<=11}set(r,l,n){return r.getHours()>=12&&n<12?r.setHours(n+12,0,0,0):r.setHours(n,0,0,0),r}incompatibleTokens=["h","H","k","t","T"]};var wx=class extends ti{priority=70;parse(r,l,n){switch(l){case"k":return Mn(Fn.hour24h,r);case"ko":return n.ordinalNumber(r,{unit:"hour"});default:return rn(l.length,r)}}validate(r,l){return l>=1&&l<=24}set(r,l,n){let s=n<=24?n%24:n;return r.setHours(s,0,0,0),r}incompatibleTokens=["a","b","h","H","K","t","T"]};var Cx=class extends ti{priority=60;parse(r,l,n){switch(l){case"m":return Mn(Fn.minute,r);case"mo":return n.ordinalNumber(r,{unit:"minute"});default:return rn(l.length,r)}}validate(r,l){return l>=0&&l<=59}set(r,l,n){return r.setMinutes(n,0,0),r}incompatibleTokens=["t","T"]};var Sx=class extends ti{priority=50;parse(r,l,n){switch(l){case"s":return Mn(Fn.second,r);case"so":return n.ordinalNumber(r,{unit:"second"});default:return rn(l.length,r)}}validate(r,l){return l>=0&&l<=59}set(r,l,n){return r.setSeconds(n,0),r}incompatibleTokens=["t","T"]};var Ex=class extends ti{priority=30;parse(r,l){let n=s=>Math.trunc(s*Math.pow(10,-l.length+3));return pr(rn(l.length,r),n)}set(r,l,n){return r.setMilliseconds(n),r}incompatibleTokens=["t","T"]};var Mx=class extends ti{priority=10;parse(r,l){switch(l){case"X":return Ga(Ha.basicOptionalMinutes,r);case"XX":return Ga(Ha.basic,r);case"XXXX":return Ga(Ha.basicOptionalSeconds,r);case"XXXXX":return Ga(Ha.extendedOptionalSeconds,r);case"XXX":default:return Ga(Ha.extended,r)}}set(r,l,n){return l.timestampIsSet?r:On(r,r.getTime()-Gb(r)-n)}incompatibleTokens=["t","T","x"]};var Dx=class extends ti{priority=10;parse(r,l){switch(l){case"x":return Ga(Ha.basicOptionalMinutes,r);case"xx":return Ga(Ha.basic,r);case"xxxx":return Ga(Ha.basicOptionalSeconds,r);case"xxxxx":return Ga(Ha.extendedOptionalSeconds,r);case"xxx":default:return Ga(Ha.extended,r)}}set(r,l,n){return l.timestampIsSet?r:On(r,r.getTime()-Gb(r)-n)}incompatibleTokens=["t","T","X"]};var Tx=class extends ti{priority=40;parse(r){return Kb(r)}set(r,l,n){return[On(r,n*1e3),{timestampIsSet:!0}]}incompatibleTokens="*"};var Ix=class extends ti{priority=20;parse(r){return Kb(r)}set(r,l,n){return[On(r,n),{timestampIsSet:!0}]}incompatibleTokens="*"};var Y5={G:new Xb,y:new tx,Y:new ex,R:new ix,u:new nx,Q:new rx,q:new ox,M:new sx,L:new ax,w:new lx,I:new cx,d:new dx,D:new ux,E:new hx,e:new mx,c:new px,i:new fx,a:new gx,b:new _x,B:new vx,h:new yx,H:new bx,K:new xx,k:new wx,m:new Cx,s:new Sx,S:new Ex,X:new Mx,x:new Dx,t:new Tx,T:new Ix};var Vst=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,jst=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Ust=/^'([^]*?)'?$/,Hst=/''/g,Gst=/\S/,qst=/[a-zA-Z]/;function Z5(a,r,l,n){let s=U5(),d=n?.locale??s.locale??rT,m=n?.firstWeekContainsDate??n?.locale?.options?.firstWeekContainsDate??s.firstWeekContainsDate??s.locale?.options?.firstWeekContainsDate??1,_=n?.weekStartsOn??n?.locale?.options?.weekStartsOn??s.weekStartsOn??s.locale?.options?.weekStartsOn??0;if(r==="")return a===""?Pr(l):On(l,NaN);let w={firstWeekContainsDate:m,weekStartsOn:_,locale:d},S=[new Zb],T=r.match(jst).map(it=>{let at=it[0];if(at in oT){let ut=oT[at];return ut(it,d.formatLong)}return it}).join("").match(Vst),L=[];for(let it of T){!n?.useAdditionalWeekYearTokens&&j5(it)&&sT(it,r,a),!n?.useAdditionalDayOfYearTokens&&V5(it)&&sT(it,r,a);let at=it[0],ut=Y5[at];if(ut){let{incompatibleTokens:Mt}=ut;if(Array.isArray(Mt)){let Pt=L.find(Nt=>Mt.includes(Nt.token)||Nt.token===at);if(Pt)throw new RangeError(`The format string mustn't contain \`${Pt.fullToken}\` and \`${it}\` at the same time`)}else if(ut.incompatibleTokens==="*"&&L.length>0)throw new RangeError(`The format string mustn't contain \`${it}\` and any other token at the same time`);L.push({token:at,fullToken:it});let Lt=ut.run(a,it,d.match,w);if(!Lt)return On(l,NaN);S.push(Lt.setter),a=Lt.rest}else{if(at.match(qst))throw new RangeError("Format string contains an unescaped latin alphabet character `"+at+"`");if(it==="''"?it="'":at==="'"&&(it=Wst(it)),a.indexOf(it)===0)a=a.slice(it.length);else return On(l,NaN)}}if(a.length>0&&Gst.test(a))return On(l,NaN);let H=S.map(it=>it.priority).sort((it,at)=>at-it).filter((it,at,ut)=>ut.indexOf(it)===at).map(it=>S.filter(at=>at.priority===it).sort((at,ut)=>ut.subPriority-at.subPriority)).map(it=>it[0]),q=Pr(l);if(isNaN(q.getTime()))return On(l,NaN);let X={};for(let it of H){if(!it.validate(q,w))return On(l,NaN);let at=it.set(q,X,w);Array.isArray(at)?(q=at[0],Object.assign(X,at[1])):q=at}return On(l,q)}function Wst(a){return a.match(Ust)[1].replace(Hst,"'")}function $st(a,r){if(a&1){let l=Ce();A(0,"div",24)(1,"button",25),ct("click",function(){te(l);let s=vt();return ee(s.removeFilter())}),V(2,"Sterge filtrul"),k()()}}function Yst(a,r){if(a&1&&(A(0,"th",28),V(1),k()),a&2){let l=vt().$implicit,n=vt();N(),ae(" ",n.columnMap[l]," ")}}function Zst(a,r){if(a&1&&(A(0,"td",29),V(1),Ps(2,"locationName"),k()),a&2){let l=r.$implicit,n=vt().$implicit;N(),ae(" ",al(2,1,l[n])," ")}}function Xst(a,r){if(a&1&&(rr(0,26),mt(1,Yst,2,1,"th",27)(2,Zst,3,3,"td",18),or()),a&2){let l=r.$implicit;Z("matColumnDef",l)}}function Kst(a,r){a&1&&(A(0,"th",30),V(1," Actiuni "),k())}function Qst(a,r){if(a&1){let l=Ce();A(0,"td",29)(1,"button",31),ct("click",function(){let d=te(l).$implicit,m=vt();return ee(m.rowData=d)}),dt(2,"i",32),k()()}if(a&2){vt();let l=Ir(29);N(),Z("matMenuTriggerFor",l)}}function Jst(a,r){a&1&&dt(0,"tr",33)}function tat(a,r){a&1&&dt(0,"tr",34)}var eat=()=>[5,10,20,50],X5=(()=>{let r=class r{constructor(n,s,d,m){this.dialog=n,this.manageEventsService=s,this.route=d,this.router=m,this.dataSource=new ps,this.itemsCount=0,this.displayedColumns=["title","date","location","broadGenre"],this.searchValue="",this.selectedFilterOption="title",this.shouldDisplayRemoveFilterButton=!1,this.pageIndex=0,this.pageSize=5,this.columnMap={title:"Titlu",date:"Data",location:"Locatie",broadGenre:"Gen"}}ngOnInit(){this.route.queryParams.subscribe(n=>It(this,null,function*(){this.pageIndex=n.page||0,this.pageSize=n.size||5,this.searchValue=n.search||"",this.selectedFilterOption=n.filter||"title",this.shouldDisplayRemoveFilterButton=!!(n.filter&&n.search),this.searchValue===""&&this.selectedFilterOption==="title"?yield this.fetchEvents():yield this.fetchFilteredEvents(),this.eventListSubscription=this.manageEventsService.getEventsListSubject().subscribe(s=>{this.dataSource.data=s.eventPage.content,this.itemsCount=s.count})}))}fetchEvents(){return It(this,null,function*(){yield this.manageEventsService.fetchPaginatedEvents(this.pageIndex,this.pageSize)})}fetchFilteredEvents(){return It(this,null,function*(){yield this.manageEventsService.fetchPaginatedEventsFiltered(this.pageIndex,this.pageSize,this.selectedFilterOption,this.searchValue)})}ngOnDestroy(){this.eventListSubscription?.unsubscribe()}ngAfterViewInit(){this.paginator.length=this.itemsCount,this.paginator.pageIndex=this.pageIndex,this.paginator.pageSize=this.pageSize,this.dataSource.sort=this.sort}onPageChange(n){this.router.navigate([],{relativeTo:this.route,queryParams:{page:n.pageIndex,size:n.pageSize},queryParamsHandling:"merge"})}filterData(){if(this.searchValue!==""){if(this.selectedFilterOption==="date"){let n=["yyyy-MM-dd","dd/MM/yyyy","dd.MM.yyyy","yyyy.MM.dd"];for(let s of n){let d=Z5(this.searchValue,s,new Date)}}this.router.navigate([],{relativeTo:this.route,queryParams:{search:this.searchValue,filter:this.selectedFilterOption,page:0,size:this.pageSize},queryParamsHandling:"merge"})}}handleDeleteKeyboardEvent(n){n.key==="Enter"&&this.filterData()}removeFilter(){this.router.navigate([],{relativeTo:this.route,queryParams:{filter:null,search:null,page:0,size:this.pageSize},queryParamsHandling:"merge"})}onAddClick(){this.dialog.open(nT,{height:"80%",width:"60%",data:{title:"Adauga eveniment"},disableClose:!0}).afterClosed().subscribe(s=>It(this,null,function*(){s&&(s.ticketTypesList=JSON.stringify(s.ticketTypesList),yield this.manageEventsService.addEvent(s,this.pageIndex,this.pageSize))}))}onEditClick(){this.dialog.open(nT,{height:"80%",width:"60%",data:{eventId:this.rowData.id,title:"Modifica eveniment"},disableClose:!0}).afterClosed().subscribe(s=>It(this,null,function*(){s&&(yield this.manageEventsService.updateEvent(s))}))}onDeleteClick(){this.dialog.open(Nd,{width:"30%"}).afterClosed().subscribe(s=>It(this,null,function*(){s&&(yield this.manageEventsService.deleteEvent(this.rowData.id,this.pageIndex,this.pageSize),this.dataSource.data.length===0&&this.pageIndex>0&&(this.searchValue===""&&this.selectedFilterOption==="title"?yield this.router.navigate([],{relativeTo:this.route,queryParams:{page:this.pageIndex-1,size:this.pageSize,search:null,filter:null},queryParamsHandling:"merge"}):yield this.router.navigate([],{relativeTo:this.route,queryParams:{page:this.pageIndex-1,size:this.pageSize,search:this.searchValue,filter:this.selectedFilterOption},queryParamsHandling:"merge"})))}))}};r.\u0275fac=function(s){return new(s||r)(B(fo),B(jb),B(En),B(tn))},r.\u0275cmp=Et({type:r,selectors:[["app-manage-events"]],viewQuery:function(s,d){if(s&1&&(Ge(ja,5),Ge(na,5)),s&2){let m;ce(m=de())&&(d.paginator=m.first),ce(m=de())&&(d.sort=m.first)}},hostBindings:function(s,d){s&1&&ct("keydown",function(_){return d.handleDeleteKeyboardEvent(_)},!1,ol)},standalone:!0,features:[At],decls:34,vars:14,consts:[[1,"input-group","rounded","pt-2"],["type","search","placeholder","Cauta","aria-label","Search","aria-describedby","search-addon",1,"form-control","rounded",3,"ngModel","ngModelChange"],["id","search-addon",1,"input-group-text","border-0"],["role","button",1,"bg-primary","text-white","fas","fa-search","search-button",3,"click"],[1,"btn","btn-primary","ms-5","me-2",3,"click"],[1,"radio-group","mt-2"],[1,"form-check","form-check-inline"],["type","radio","name","radioGroup","id","title","value","title",1,"form-check-input",3,"ngModel","ngModelChange"],["for","title",1,"form-check-label"],["type","radio","name","radioGroup","id","date","value","date",1,"form-check-input",3,"ngModel","ngModelChange"],["for","date",1,"form-check-label"],["type","radio","name","radioGroup","id","location","value","location",1,"form-check-input",3,"ngModel","ngModelChange"],["for","location",1,"form-check-label"],["class","form-check-inline",4,"ngIf"],["mat-table","","matSort","",3,"dataSource"],[3,"matColumnDef",4,"ngFor","ngForOf"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","","aria-label","Select page",3,"length","pageSize","pageIndex","pageSizeOptions","page"],["contextMenu","matMenu"],["mat-menu-item","",3,"click"],[1,"form-check-inline"],[1,"btn",3,"click"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-button","",3,"matMenuTriggerFor","click"],[1,"fa-solid","fa-pen-to-square"],["mat-header-row",""],["mat-row",""]],template:function(s,d){s&1&&(A(0,"div",0)(1,"input",1),kn("ngModelChange",function(_){return An(d.searchValue,_)||(d.searchValue=_),_}),k(),A(2,"span",2)(3,"i",3),ct("click",function(){return d.filterData()}),k(),A(4,"button",4),ct("click",function(){return d.onAddClick()}),V(5," Adauga "),k()()(),A(6,"div",5)(7,"div",6)(8,"input",7),kn("ngModelChange",function(_){return An(d.selectedFilterOption,_)||(d.selectedFilterOption=_),_}),k(),A(9,"label",8),V(10,"Titlu"),k()(),A(11,"div",6)(12,"input",9),kn("ngModelChange",function(_){return An(d.selectedFilterOption,_)||(d.selectedFilterOption=_),_}),k(),A(13,"label",10),V(14,"Data"),k()(),A(15,"div",6)(16,"input",11),kn("ngModelChange",function(_){return An(d.selectedFilterOption,_)||(d.selectedFilterOption=_),_}),k(),A(17,"label",12),V(18,"Locatie"),k()(),mt(19,$st,3,0,"div",13),k(),A(20,"table",14),mt(21,Xst,3,1,"ng-container",15),rr(22,16),mt(23,Kst,2,0,"th",17)(24,Qst,3,1,"td",18),or(),mt(25,Jst,1,0,"tr",19)(26,tat,1,0,"tr",20),k(),A(27,"mat-paginator",21),ct("page",function(_){return d.onPageChange(_)}),k(),A(28,"mat-menu",null,22)(30,"button",23),ct("click",function(){return d.onEditClick()}),V(31," Modifica "),k(),A(32,"button",23),ct("click",function(){return d.onDeleteClick()}),V(33," Sterge "),k()()),s&2&&(N(),In("ngModel",d.searchValue),N(7),In("ngModel",d.selectedFilterOption),N(4),In("ngModel",d.selectedFilterOption),N(4),In("ngModel",d.selectedFilterOption),N(3),Z("ngIf",d.shouldDisplayRemoveFilterButton),N(),Z("dataSource",d.dataSource),N(),Z("ngForOf",d.displayedColumns),N(4),Z("matHeaderRowDef",d.displayedColumns.concat("actions")),N(),Z("matRowDefColumns",d.displayedColumns.concat("actions")),N(),Z("length",d.itemsCount)("pageSize",d.pageSize)("pageIndex",d.pageIndex)("pageSizeOptions",Nr(13,eat)))},dependencies:[Yi,en,Dc,ji,jo,Qs,Fa,ka,Pa,Oa,Na,La,Va,yl,ja,Ba,za,na,zd,Aa,Ii,Ra,Fd,h5,qe],styles:["th[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.search-button[_ngcontent-%COMP%]{margin-left:5px;padding:.5rem 1rem;border-radius:.3rem}.search-button[_ngcontent-%COMP%]:hover{cursor:pointer;box-shadow:2px 4px 5px #0006}.input-group-text[_ngcontent-%COMP%]{padding-left:0}"]});let a=r;return a})();var K5=(()=>{let r=class r{constructor(n,s,d){this.http=n,this.identityService=s,this.snackBar=d,this.orderSubject=new Ze({})}setOrderSubject(n){this.orderSubject.next(n)}getOrderSubject(){return this.orderSubject.asObservable()}fetchOrders(){return It(this,null,function*(){try{let n=yield Ve(this.http.get(Me+"/orders",{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setOrderSubject(n)}catch{this.snackBar.open("Error fetching orders","Close",{duration:3e3})}})}fetchOrderByNumber(n){return It(this,null,function*(){try{return yield Ve(this.http.get(Me+"/orders/"+n,{headers:{Authorization:"Bearer "+this.identityService.getToken()}}))}catch{this.snackBar.open("Error fetching order","Close",{duration:3e3});return}})}fetchOrdersByUserId(n){return It(this,null,function*(){try{return yield Ve(this.http.get(Me+"/orders/user/"+n,{headers:{Authorization:"Bearer "+this.identityService.getToken()}}))}catch{this.snackBar.open("Error fetching orders","Close",{duration:3e3});return}})}cancelOrder(n){return It(this,null,function*(){try{return yield Ve(this.http.put(Me+"/orders/"+n.orderNumber+"/admin/cancel",null,{headers:{Authorization:"Bearer "+this.identityService.getToken()}})),n.status="CANCELED",n.ticketList.forEach(s=>{s.status="CANCELED"}),n}catch{this.snackBar.open("Error canceling order","Close",{duration:3e3})}})}cancelTicket(n){return It(this,null,function*(){try{return yield Ve(this.http.put(Me+"/tickets/"+n.id+"/admin/cancel",null,{headers:{Authorization:"Bearer "+this.identityService.getToken()}})),n.status="CANCELED",n}catch{this.snackBar.open("Error canceling ticket","Close",{duration:3e3})}})}};r.\u0275fac=function(s){return new(s||r)(ht(Gi),ht(hi),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function nat(a,r){if(a&1){let l=Ce();A(0,"button",18),ct("click",function(){te(l);let s=vt().$implicit,d=vt(2);return ee(d.cancelTicket(s))}),V(1,"Anuleaza"),k()}}function rat(a,r){if(a&1&&(A(0,"div",17)(1,"div",11)(2,"h5",12),V(3),k(),A(4,"p",14),V(5),k(),A(6,"p",14),V(7),k(),A(8,"p",14),V(9),k(),A(10,"p",14),V(11),k(),mt(12,nat,2,0,"button",16),k()()),a&2){let l=r.$implicit;N(3),ae("Eveniment: ",l.ticketType.event.title,""),N(2),ae("Data: ",l.ticketType.event.date,""),N(2),ae("Categoria: ",l.ticketType.name,""),N(2),ae("Pret: ",l.ticketType.price,""),N(2),ae("Status: ",l.status,""),N(),Z("ngIf",l.status==="CONFIRMED")}}function oat(a,r){if(a&1){let l=Ce();A(0,"button",18),ct("click",function(){te(l);let s=vt().$implicit,d=vt();return ee(d.cancelOrder(s))}),V(1,"Anuleaza comanda"),k()}}function sat(a,r){if(a&1&&(A(0,"div",10)(1,"div",11)(2,"h5",12),V(3),k()(),A(4,"div",13)(5,"p",14),V(6),k(),A(7,"p",14),V(8),k(),A(9,"p",14),V(10),k(),A(11,"p",14),V(12),k(),A(13,"div")(14,"h3"),V(15,"Tickets"),k(),mt(16,rat,13,6,"div",15),k()(),mt(17,oat,2,0,"button",16),k()),a&2){let l=r.$implicit;N(3),ae("Comanda numarul ",l.orderNumber,""),N(3),ae("Id-ul utilizatorului: ",l.user.id,""),N(2),ae("Data comenzii: ",l.createdAt,""),N(2),ae("Status: ",l.status,""),N(2),ae("Total: ",l.price,""),N(4),Z("ngForOf",l.ticketList),N(),Z("ngIf",l.status==="CONFIRMED")}}var Q5=(()=>{let r=class r{constructor(n){this.manageOrdersService=n,this.orderNumber="",this.userId=""}ngOnInit(){this.orders=[]}ngOnDestroy(){}handleNullEvent(n){if(n.ticketList!=null)return n.ticketList.forEach(s=>{s.ticketType.event==null&&(s.ticketType.event={title:"Evenimentul a fost sters"})}),n}fetchOrderByNumber(){return It(this,null,function*(){this.orderNumber!==""&&(this.orders=[],this.orders.push(this.handleNullEvent(yield this.manageOrdersService.fetchOrderByNumber(this.orderNumber))))})}fetchOrderByUserId(){return It(this,null,function*(){if(this.userId==="")return;this.orders=[];let n=yield this.manageOrdersService.fetchOrdersByUserId(this.userId);n&&(this.orders=n.map(s=>this.handleNullEvent(s)))})}cancelOrder(n){return It(this,null,function*(){n=yield this.manageOrdersService.cancelOrder(n)})}cancelTicket(n){return It(this,null,function*(){n=yield this.manageOrdersService.cancelTicket(n)})}};r.\u0275fac=function(s){return new(s||r)(B(K5))},r.\u0275cmp=Et({type:r,selectors:[["app-manage-orders"]],standalone:!0,features:[At],decls:13,vars:3,consts:[[1,"container-fluid"],[1,"input-group","rounded","pt-2"],["type","search","placeholder","Cauta numarul comenzii","aria-label","Search","aria-describedby","search-addon",1,"form-control","rounded",3,"ngModel","ngModelChange"],["id","search-order",1,"input-group-text","border-0","spacer"],["type","button","data-mdb-ripple-init","",1,"btn","btn-primary","btn-search",3,"click"],[1,"fas","fa-search"],[1,"input-group","rounded","pt-2","mt-4"],["type","search","placeholder","Cauta id-ul utilizatorului","aria-label","Search","aria-describedby","search-addon",1,"form-control","rounded",3,"ngModel","ngModelChange"],["id","search-user",1,"input-group-text","border-0","spacer"],["class","card mt-3",4,"ngFor","ngForOf"],[1,"card","mt-3"],[1,"card-header"],[1,"card-title"],[1,"card-body"],[1,"card-text"],["class","card ticket-card mt-1 mb-3",4,"ngFor","ngForOf"],["class","btn btn-danger",3,"click",4,"ngIf"],[1,"card","ticket-card","mt-1","mb-3"],[1,"btn","btn-danger",3,"click"]],template:function(s,d){s&1&&(A(0,"div",0)(1,"div",1)(2,"input",2),kn("ngModelChange",function(_){return An(d.orderNumber,_)||(d.orderNumber=_),_}),k(),A(3,"span",3)(4,"button",4),ct("click",function(){return d.fetchOrderByNumber()}),dt(5,"i",5),k()()(),A(6,"div",6)(7,"input",7),kn("ngModelChange",function(_){return An(d.userId,_)||(d.userId=_),_}),k(),A(8,"span",8)(9,"button",4),ct("click",function(){return d.fetchOrderByUserId()}),dt(10,"i",5),k()()(),A(11,"div"),mt(12,sat,18,7,"div",9),k()()),s&2&&(N(2),In("ngModel",d.orderNumber),N(5),In("ngModel",d.userId),N(5),Z("ngForOf",d.orders))},dependencies:[Yi,en,ji,jo,Ii,qe],styles:[".spacer[_ngcontent-%COMP%]{padding-left:0}.btn-search[_ngcontent-%COMP%]{height:36px;border-radius:0 10px 10px 0}"]});let a=r;return a})();var J5=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=Et({type:r,selectors:[["app-page-not-found"]],standalone:!0,features:[At],decls:5,vars:0,template:function(s,d){s&1&&(A(0,"div")(1,"h1"),V(2,"Error 404"),k(),A(3,"p"),V(4,"Page not found"),k()())}});let a=r;return a})();var qg=(()=>{let r=class r{constructor(n,s){this.router=n,this.identityService=s}canActivate(n,s){if(this.identityService.isLoggedIn()){if(this.identityService.isAdmin())return this.router.navigate(["admin-dashboard"]),!1;if(this.identityService.isValidator())return this.router.navigate(["validator-dashboard"]),!1}else return this.router.navigate([""]),!1;return!0}};r.\u0275fac=function(s){return new(s||r)(ht(tn),ht(hi))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var Ax=(()=>{let r=class r{constructor(n,s,d){this.http=n,this.identityService=s,this.snackBar=d,this.orderListSubject=new Ze([]),this.orderSubject=new Ze({})}setOrderList(n){this.orderListSubject.next(n)}getOrderList(){return this.orderListSubject.asObservable()}setOrder(n){this.orderSubject.next(n)}getOrder(){return this.orderSubject.asObservable()}fetchOrders(){return It(this,null,function*(){try{let n=yield Ve(this.http.get(Me+"/orders",{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setOrderList(n)}catch{this.snackBar.open("Nu s-au putut incarca comenzile","Close",{duration:3e3})}})}fetchOrderByOrderNumber(n){return It(this,null,function*(){try{let s=yield Ve(this.http.get(Me+"/orders/"+n,{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));s.ticketList.forEach(d=>{d.ticketType.event===null&&(d.ticketType.event={title:"Evenimentul a fost sters",date:"",location:{name:""}})}),this.setOrder(s)}catch{this.snackBar.open("Comanda nu a fost gasita","Close",{duration:3e3})}})}cancelTicket(n){return It(this,null,function*(){this.http.put(Me+"/tickets/"+n.id+"/cancel",null,{headers:{Authorization:"Bearer "+this.identityService.getToken()}}).subscribe({next:()=>{n.status="CANCELED",this.snackBar.open("Biletul a fost anulat cu succes!","Close",{duration:3e3})},error:s=>{this.snackBar.open(s.error,"Close",{duration:3e3})}})})}cancelOrder(n){return It(this,null,function*(){this.http.put(Me+"/orders/"+Number(n.orderNumber)+"/cancel",null,{headers:{Authorization:"Bearer "+this.identityService.getToken()}}).subscribe({next:()=>{n.status="CANCELED",this.snackBar.open("Comanda a fost anulata cu succes","Close",{duration:3e3})},error:s=>{this.snackBar.open(s.error,"Close",{duration:3e3})}})})}};r.\u0275fac=function(s){return new(s||r)(ht(Gi),ht(hi),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function aat(a,r){if(a&1){let l=Ce();A(0,"button",10),ct("click",function(){let d=te(l).$implicit,m=vt();return m.selectedFilter=d.value,ee(m.onFilterChange())}),V(1),k()}if(a&2){let l=r.$implicit;N(),De(l.label)}}var lat=a=>["/account/orders",a];function cat(a,r){if(a&1&&(A(0,"div",11)(1,"div",12)(2,"div")(3,"h2"),V(4),k(),A(5,"p"),V(6),Ps(7,"date"),A(8,"span"),dt(9,"i",13),k(),V(10),k()(),A(11,"div",14)(12,"a",15),V(13,"Vezi comanda"),k()()()()),a&2){let l=r.$implicit;N(4),ae("Comanda numarul ",l.orderNumber,""),N(2),ae("",al(7,4,l.date)," "),N(4),ae(" ",l.price," RON"),N(2),Z("routerLink",Xi(6,lat,l.orderNumber))}}function dat(a,r){if(a&1){let l=Ce();A(0,"button",16),ct("click",function(){te(l);let s=vt();return ee(s.prevPage())}),V(1,"Previous"),k()}}function uat(a,r){if(a&1){let l=Ce();rr(0),A(1,"button",17),ct("click",function(){let d=te(l).$implicit,m=vt();return ee(m.goToPage(d))}),V(2),k(),or()}if(a&2){let l=r.$implicit,n=vt();N(),ei("active",l===n.currentPage),N(),De(l)}}function hat(a,r){if(a&1){let l=Ce();A(0,"button",18),ct("click",function(){te(l);let s=vt();return ee(s.nextPage())}),V(1,"Next"),k()}}var eV=(()=>{let r=class r{constructor(n,s){this.accountOrderService=n,this.snackBar=s,this.orders=[],this.filteredOrders=[],this.currentPage=1,this.itemsPerPage=5,this.selectedFilter="last3Months",this.filterOptions=[{value:"last3Months",label:"Ultimele 3 luni"},{value:"last6Months",label:"Ultimele 6 luni"},{value:"lastYear",label:"Ultimul an"},{value:"all",label:"Toate"}]}ngOnInit(){return It(this,null,function*(){yield this.accountOrderService.fetchOrders(),this.orderListSubscription=this.orderListSubscription=this.accountOrderService.getOrderList().subscribe(n=>{this.orders=n})})}ngOnDestroy(){this.orderListSubscription?.unsubscribe()}get totalPages(){return Math.ceil(this.filteredOrders.length/this.itemsPerPage)}get pageNumbers(){let n=Math.min(3,this.totalPages),s=Math.max(1,this.currentPage-1),d=Math.min(this.totalPages,s+n-1);return Array.from({length:d-s+1},(m,_)=>s+_)}get paginatedOrders(){let n=(this.currentPage-1)*this.itemsPerPage;return this.filteredOrders.slice(n,n+this.itemsPerPage)}nextPage(){this.currentPage<this.totalPages&&this.currentPage++}prevPage(){this.currentPage>1&&this.currentPage--}goToPage(n){n>=1&&n<=this.totalPages&&(this.currentPage=n)}onFilterChange(){this.currentPage=1}getSelectedFilterLabel(){let n=this.filterOptions.find(s=>s.value===this.selectedFilter);return n?n.label:"All Time"}};r.\u0275fac=function(s){return new(s||r)(B(Ax),B(Je))},r.\u0275cmp=Et({type:r,selectors:[["app-account-orders"]],standalone:!0,features:[At],decls:16,vars:6,consts:[[1,"container-fluid"],["mdbDropdown","",1,"btn-group","dropend"],["type","button","mdbDropdownToggle","","aria-expanded","false",1,"btn","btn-primary","dropdown-toggle"],["mdbDropdownMenu","",1,"dropdown-menu"],["class","dropdown-item",3,"click",4,"ngFor","ngForOf"],["class","card mt-4",4,"ngFor","ngForOf"],[1,"page-navigation","mt-4"],["class","btn btn-secondary prev-next-buttons",3,"click",4,"ngIf"],[4,"ngFor","ngForOf"],["class","btn btn-secondary prev-next-nav",3,"click",4,"ngIf"],[1,"dropdown-item",3,"click"],[1,"card","mt-4"],[1,"card-header","d-flex","flex-row"],[1,"fa-solid","fa-ticket","fa-fw","ms-1","me-1"],[1,"view-details-container"],[1,"ps-4",3,"routerLink"],[1,"btn","btn-secondary","prev-next-buttons",3,"click"],[1,"btn","btn-secondary","page-nav-buttons",3,"click"],[1,"btn","btn-secondary","prev-next-nav",3,"click"]],template:function(s,d){s&1&&(A(0,"div",0)(1,"h1"),V(2,"Comenzi"),k(),dt(3,"hr"),A(4,"div",1)(5,"button",2),V(6),k(),A(7,"ul",3)(8,"li"),mt(9,aat,2,1,"button",4),k()()(),A(10,"div"),mt(11,cat,14,8,"div",5),k(),A(12,"div",6),mt(13,dat,2,0,"button",7)(14,uat,3,3,"ng-container",8)(15,hat,2,0,"button",9),k()()),s&2&&(N(6),ae(" ",d.getSelectedFilterLabel()," "),N(3),Z("ngForOf",d.filterOptions),N(2),Z("ngForOf",d.orders),N(2),Z("ngIf",d.currentPage>1),N(),Z("ngForOf",d.pageNumbers),N(),Z("ngIf",d.currentPage<d.totalPages))},dependencies:[Ii,hd,ar,qe,Gl,dy,cy,eg,ig],styles:[".container-fluid[_ngcontent-%COMP%]{padding:20px;display:flex;flex-direction:column;justify-content:center;align-items:center}.btn-filter[_ngcontent-%COMP%]{width:150px;height:20px;padding:0}.card[_ngcontent-%COMP%]{width:600px}.view-details-container[_ngcontent-%COMP%]{display:flex;justify-content:right}.page-nav-buttons[_ngcontent-%COMP%]{padding:0;margin:1px;width:30px;height:30px;align-items:center}.prev-next-buttons[_ngcontent-%COMP%]{padding:0;margin:1px;width:70px;height:30px}"]});let a=r;return a})();var iV=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=Et({type:r,selectors:[["app-account-settings"]],standalone:!0,features:[At],decls:2,vars:0,template:function(s,d){s&1&&(A(0,"p"),V(1,"account-settings works!"),k())}});let a=r;return a})();function mat(a,r){a&1&&(A(0,"div",14),V(1," Parola este obligatorie "),k())}function pat(a,r){a&1&&(A(0,"div",14),V(1," Parola trebuie sa aiba minim 6 caractere "),k())}function fat(a,r){a&1&&(A(0,"div",14),V(1," Parolele nu coincid "),k())}var nV=(()=>{let r=class r{constructor(n,s,d,m,_){this.router=n,this.identityService=s,this.fb=d,this.snackBar=m,this.route=_,this.form=this.fb.group({password:["",[Le.required,Le.minLength(6)]],confirmPassword:["",Le.required]},{validators:[Im]})}onClickConfirm(){if(this.form.markAllAsTouched(),this.form.valid){let n=this.route.snapshot.url[this.route.snapshot.url.length-1].path;this.identityService.resetPassword(n,this.form.value.password)}}};r.\u0275fac=function(s){return new(s||r)(B(tn),B(hi),B(wr),B(Je),B(En))},r.\u0275cmp=Et({type:r,selectors:[["app-reset-password"]],standalone:!0,features:[At],decls:21,vars:4,consts:[[1,"container-fluid"],[1,"card","text-center",2,"width","300px"],[1,"card-header","h5","text-white","bg-primary"],[1,"card-body","px-5"],[3,"formGroup"],[1,"mb-4"],["mdbInput","","type","password","id","password","formControlName","password","required","",1,"form-control"],["password",""],["mdbLabel","","for","password",1,"form-label"],["class","text-danger mb-4",4,"ngIf"],["mdbInput","","type","password","id","confirmPassword","formControlName","confirmPassword","required","",1,"form-control"],["confirmPassword",""],["mdbLabel","","for","confirmPassword",1,"form-label"],[1,"btn","btn-primary",3,"click"],[1,"text-danger","mb-4"]],template:function(s,d){if(s&1&&(A(0,"div",0)(1,"div",1)(2,"div",2),V(3,"Resetare parola"),k(),A(4,"div",3)(5,"form",4)(6,"mdb-form-control",5),dt(7,"input",6,7),A(9,"label",8),V(10,"Password"),k()(),mt(11,mat,2,0,"div",9)(12,pat,2,0,"div",9),A(13,"mdb-form-control",5),dt(14,"input",10,11),A(16,"label",12),V(17,"Confirm password"),k()(),mt(18,fat,2,0,"div",9),A(19,"button",13),ct("click",function(){return d.onClickConfirm()}),V(20,"Reseteaza parola"),k()()()()()),s&2){let m,_,w;N(5),Z("formGroup",d.form),N(6),Z("ngIf",((m=d.form.get("password"))==null||m.errors==null?null:m.errors.required)&&((m=d.form.get("password"))==null?null:m.touched)),N(),Z("ngIf",((_=d.form.get("password"))==null||_.errors==null?null:_.errors.minlength)&&((_=d.form.get("password"))==null?null:_.touched)),N(6),Z("ngIf",((w=d.form.get("password"))==null?null:w.touched)&&((w=d.form.get("confirmPassword"))==null?null:w.touched)&&(d.form.errors==null?null:d.form.errors.passwordMismatch)&&!((w=d.form.get("password"))!=null&&w.errors))}},dependencies:[Rn,xr,en,ji,br,Xr,Vn,ur,Kr,mo,po,oo,qe],styles:[".container-fluid[_ngcontent-%COMP%]{background:#f5f5f5;height:100vh;display:flex;justify-content:center;align-items:center;-webkit-user-select:none;user-select:none}"]});let a=r;return a})();var oV=a=>({disabled:a});function gat(a,r){if(a&1){let l=Ce();A(0,"button",10),ct("click",function(){te(l);let s=vt().$implicit,d=vt();return ee(d.cancelTicket(s))}),V(1),k()}if(a&2){let l=vt().$implicit;Z("ngClass",Xi(2,oV,l.status=="CANCELED")),N(),ae(" ",l.status=="CANCELED"?"Anulat":"Anuleaza","")}}var _at=(a,r)=>[a,r],rV=a=>({id:a}),vat=a=>["/event-details",a];function yat(a,r){if(a&1&&(A(0,"div",3)(1,"div",4)(2,"h5",5)(3,"a",6),V(4),k()(),A(5,"a",6),V(6,"Vezi biletele"),k()(),A(7,"div",7)(8,"p",8),V(9),Ps(10,"date"),k(),A(11,"p",8),V(12),k(),A(13,"p",8),V(14),k(),A(15,"p",8),V(16),k(),A(17,"p",8),V(18),k(),mt(19,gat,2,4,"button",9),k()()),a&2){let l=r.$implicit,n=vt();N(3),Z("routerLink",Jh(13,_at,"/"+l.ticketType.event.location.name,l.ticketType.event.title))("queryParams",Xi(16,rV,l.ticketType.event.id)),N(),ae(" ",l.ticketType.event.title," "),N(),Z("routerLink",Xi(18,vat,l.ticketType.event.title))("queryParams",Xi(20,rV,l.ticketType.event.id)),N(4),ae("Data: ",al(10,11,l.ticketType.event.date),""),N(3),ae("Locatie: ",l.ticketType.event.location.name,""),N(2),ae("Categoria: ",l.ticketType.name,""),N(2),ae("Pret: ",l.ticketType.price," RON"),N(2),ae("Status: ",l.status,""),N(),Z("ngIf",n.order.ticketList.length>1)}}var sV=(()=>{let r=class r{constructor(n,s,d){this.accountOrderService=n,this.snackBar=s,this.route=d,this.order={}}ngOnInit(){return It(this,null,function*(){let n=Number(this.route.snapshot.url[this.route.snapshot.url.length-1].path);yield this.accountOrderService.fetchOrderByOrderNumber(n),this.orderSubscription=this.accountOrderService.getOrder().subscribe(s=>{this.order=s})})}ngOnDestroy(){this.orderSubscription?.unsubscribe()}cancelTicket(n){return It(this,null,function*(){yield this.accountOrderService.cancelTicket(n)})}cancelOrder(){return It(this,null,function*(){yield this.accountOrderService.cancelOrder(this.order)})}};r.\u0275fac=function(s){return new(s||r)(B(Ax),B(Je),B(En))},r.\u0275cmp=Et({type:r,selectors:[["app-account-order-details"]],standalone:!0,features:[At],decls:18,vars:11,consts:[[1,"container-fluid"],["class","card",4,"ngFor","ngForOf"],[1,"btn","btn-danger","mb-5","mt-1",3,"ngClass","click"],[1,"card"],[1,"card-header"],[1,"card-title"],[3,"routerLink","queryParams"],[1,"card-body"],[1,"card-text"],["class","btn btn-danger",3,"ngClass","click",4,"ngIf"],[1,"btn","btn-danger",3,"ngClass","click"]],template:function(s,d){s&1&&(A(0,"div",0)(1,"h1"),V(2),k(),A(3,"h4"),V(4),Ps(5,"date"),k(),A(6,"h4"),V(7),k(),dt(8,"hr"),A(9,"h3"),V(10,"Bilete"),k(),A(11,"div"),mt(12,yat,20,22,"div",1),k(),dt(13,"hr"),A(14,"h4"),V(15),k(),A(16,"button",2),ct("click",function(){return d.cancelOrder()}),V(17),k()()),s&2&&(N(2),ae("Comanda numarul ",d.order.orderNumber,""),N(2),ae("Data: ",al(5,7,d.order.createdAt),""),N(3),ae("Status: ",d.order.status,""),N(5),Z("ngForOf",d.order.ticketList),N(3),ae("Total: ",d.order.price," RON"),N(),Z("ngClass",Xi(9,oV,d.order.status=="CANCELED")),N(),De(d.order.status=="CANCELED"?"Anulata":"Anuleaza comanda"))},dependencies:[hd,Ii,qe,Zo,ar]});let a=r;return a})();function bat(a,r){a&1&&(A(0,"div",20),V(1," Prenumele este obligatoriu "),k())}function xat(a,r){a&1&&(A(0,"div",20),V(1," Numele este obligatoriu "),k())}function wat(a,r){a&1&&(A(0,"div",20),V(1," Email-ul este obligatoriu "),k())}function Cat(a,r){a&1&&(A(0,"div",20),V(1," Email-ul are un format invalid "),k())}var aV=(()=>{let r=class r{constructor(n,s,d){this.dialogRef=n,this.data=s,this.fb=d,this.user={},this.form=this.fb.group({firstName:[s.firstName,Le.required],lastName:[s.lastName,Le.required],email:[s.email,[Le.required,Le.email]]})}onCloseClick(){this.dialogRef.close()}onConfirmClick(){if(this.form.markAllAsTouched(),this.form.valid){let n=Ri(Gt({},this.form.value),{id:this.data.id,username:this.data.username,role:this.data.role});this.dialogRef.close(n)}}};r.\u0275fac=function(s){return new(s||r)(B(Qn),B(jr),B(wr))},r.\u0275cmp=Et({type:r,selectors:[["app-edit-account-details"]],standalone:!0,features:[At],decls:31,vars:5,consts:[[1,"modal-content"],[1,"modal-header","mb-5"],["id","exampleModalLabel",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body","mb-3"],[3,"formGroup"],[1,"mb-4"],["mdbInput","","type","text","id","firstName","formControlName","firstName","required","",1,"form-control"],["firstName",""],["mdbLabel","","for","firstName",1,"form-label"],["class","text-danger mb-4",4,"ngIf"],["mdbInput","","type","text","id","lastName","formControlName","lastName","required","",1,"form-control"],["lastName",""],["mdbLabel","","for","lastName",1,"form-label"],["mdbInput","","type","text","id","email","formControlName","email","required","",1,"form-control"],["email",""],["mdbLabel","","for","email",1,"form-label"],[1,"modal-footer","mt-2"],["type","button",1,"btn","btn-secondary","me-1",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"text-danger","mb-4"]],template:function(s,d){if(s&1&&(A(0,"div",0)(1,"div",1)(2,"h5",2),V(3,"Modifica datele"),k(),A(4,"button",3),ct("click",function(){return d.onCloseClick()}),k()(),A(5,"div",4)(6,"form",5)(7,"mdb-form-control",6),dt(8,"input",7,8),A(10,"label",9),V(11,"Prenume"),k()(),mt(12,bat,2,0,"div",10),A(13,"mdb-form-control",6),dt(14,"input",11,12),A(16,"label",13),V(17,"Nume"),k()(),mt(18,xat,2,0,"div",10),A(19,"mdb-form-control",6),dt(20,"input",14,15),A(22,"label",16),V(23,"Email"),k()(),mt(24,wat,2,0,"div",10)(25,Cat,2,0,"div",10),k()(),A(26,"div",17)(27,"button",18),ct("click",function(){return d.onCloseClick()}),V(28," Anuleaza "),k(),A(29,"button",19),ct("click",function(){return d.onConfirmClick()}),V(30,"Salveaza"),k()()()),s&2){let m,_,w,S;N(6),Z("formGroup",d.form),N(6),Z("ngIf",((m=d.form.get("firstName"))==null?null:m.invalid)&&((m=d.form.get("firstName"))==null?null:m.touched)),N(6),Z("ngIf",((_=d.form.get("lastName"))==null?null:_.invalid)&&((_=d.form.get("lastName"))==null?null:_.touched)),N(6),Z("ngIf",((w=d.form.get("email"))==null||w.errors==null?null:w.errors.required)&&((w=d.form.get("email"))==null?null:w.touched)),N(),Z("ngIf",((S=d.form.get("email"))==null||S.errors==null?null:S.errors.email)&&((S=d.form.get("email"))==null?null:S.touched))}},dependencies:[Yi,xr,en,ji,br,Xr,Kr,mo,po,oo,qe,Rn,Vn,ur],styles:[".modal-content[_ngcontent-%COMP%]{padding:20px}"]});let a=r;return a})();function Sat(a,r){a&1&&(A(0,"div",20),V(1," Parola veche este obligatorie "),k())}function Eat(a,r){a&1&&(A(0,"div",20),V(1," Parola noua este obligatorie "),k())}function Mat(a,r){a&1&&(A(0,"div",20),V(1," Parola noua trebuie sa aiba minim 6 caractere "),k())}function Dat(a,r){a&1&&(A(0,"div",20),V(1," Parolele nu coincid "),k())}var lV=(()=>{let r=class r{constructor(n,s,d){this.dialogRef=n,this.fb=d,this.form=this.fb.group({oldPassword:["",Le.required],password:["",Le.required],confirmPassword:["",Le.required]},{validators:Im})}onCloseClick(){this.dialogRef.close()}onConfirmClick(){if(this.form.markAllAsTouched(),this.form.valid){let n={oldPassword:this.form.value.oldPassword,newPassword:this.form.value.password,confirmPassword:this.form.value.confirmPassword};this.dialogRef.close(n)}}};r.\u0275fac=function(s){return new(s||r)(B(Qn),B(jr),B(wr))},r.\u0275cmp=Et({type:r,selectors:[["app-change-password-account-details"]],standalone:!0,features:[At],decls:31,vars:5,consts:[[1,"modal-content"],[1,"modal-header","mb-5"],["id","exampleModalLabel",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body","mb-3"],[3,"formGroup"],[1,"mb-4"],["mdbInput","","type","password","id","oldPassword","formControlName","oldPassword","required","",1,"form-control"],["oldPassword",""],["mdbLabel","","for","oldPassword",1,"form-label"],["class","text-danger mb-4",4,"ngIf"],["mdbInput","","type","password","id","password","formControlName","password","required","",1,"form-control"],["password",""],["mdbLabel","","for","password",1,"form-label"],["mdbInput","","type","password","id","confirmPassword","formControlName","confirmPassword","required","",1,"form-control"],["confirmPassword",""],["mdbLabel","","for","confirmPassword",1,"form-label"],[1,"modal-footer","mt-2"],["type","button",1,"btn","btn-secondary","me-1",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"text-danger","mb-4"]],template:function(s,d){if(s&1&&(A(0,"div",0)(1,"div",1)(2,"h5",2),V(3,"Schimba parola"),k(),A(4,"button",3),ct("click",function(){return d.onCloseClick()}),k()(),A(5,"div",4)(6,"form",5)(7,"mdb-form-control",6),dt(8,"input",7,8),A(10,"label",9),V(11,"Parola veche"),k()(),mt(12,Sat,2,0,"div",10),A(13,"mdb-form-control",6),dt(14,"input",11,12),A(16,"label",13),V(17,"Parola noua"),k()(),mt(18,Eat,2,0,"div",10)(19,Mat,2,0,"div",10),A(20,"mdb-form-control",6),dt(21,"input",14,15),A(23,"label",16),V(24,"Confirm password"),k()(),mt(25,Dat,2,0,"div",10),k()(),A(26,"div",17)(27,"button",18),ct("click",function(){return d.onCloseClick()}),V(28," Anuleaza "),k(),A(29,"button",19),ct("click",function(){return d.onConfirmClick()}),V(30,"Salveaza"),k()()()),s&2){let m,_,w,S;N(6),Z("formGroup",d.form),N(6),Z("ngIf",((m=d.form.get("password"))==null||m.errors==null?null:m.errors.required)&&((m=d.form.get("password"))==null?null:m.touched)),N(6),Z("ngIf",((_=d.form.get("password"))==null||_.errors==null?null:_.errors.required)&&((_=d.form.get("password"))==null?null:_.touched)),N(),Z("ngIf",((w=d.form.get("password"))==null||w.errors==null?null:w.errors.minlength)&&((w=d.form.get("password"))==null?null:w.touched)),N(6),Z("ngIf",((S=d.form.get("password"))==null?null:S.touched)&&((S=d.form.get("confirmPassword"))==null?null:S.touched)&&(d.form.errors==null?null:d.form.errors.passwordMismatch)&&!((S=d.form.get("password"))!=null&&S.errors))}},dependencies:[Yi,xr,en,ji,br,Xr,Kr,mo,po,oo,qe,Rn,Vn,ur],styles:[".modal-content[_ngcontent-%COMP%]{padding:20px}"]});let a=r;return a})();var cV=(()=>{let r=class r{constructor(n,s,d){this.http=n,this.identityService=s,this.snackBar=d,this.userSubject=new Ze({})}setUser(n){this.userSubject.next(n)}getUser(){return this.userSubject.asObservable()}fetchUser(){return It(this,null,function*(){try{let n=yield Ve(this.http.get(Me+"/users/me",{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setUser(n)}catch{this.snackBar.open("Error fetching user data","Close",{duration:3e3})}})}editUser(n){return It(this,null,function*(){try{let s=yield Ve(this.http.patch(Me+"/users/me",n,{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setUser(s)}catch{this.snackBar.open("Error editing user data","Close",{duration:3e3})}})}changePassword(n){return It(this,null,function*(){this.http.patch(Me+"/users/me/change-password",{oldPassword:n.oldPassword,newPassword:n.newPassword,confirmPassword:n.confirmPassword},{headers:{Authorization:"Bearer "+this.identityService.getToken()}}).subscribe({next:()=>{this.snackBar.open("Password changed","Close",{duration:3e3})},error:s=>{this.snackBar.open(s.error,"Close",{duration:3e3})}})})}};r.\u0275fac=function(s){return new(s||r)(ht(Gi),ht(hi),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var Iat=a=>["orders",a];function Aat(a,r){if(a&1&&(A(0,"div",4)(1,"div",5)(2,"h5",16)(3,"a",17),V(4),k()(),A(5,"h6",7),V(6),Ps(7,"date"),k(),A(8,"p",18),V(9),k(),A(10,"p",18),V(11),k()()()),a&2){let l=r.$implicit;N(3),Z("routerLink",Xi(7,Iat,l.orderNumber)),N(),ae("Comanda #",l.orderNumber,""),N(2),ae("Data: ",al(7,5,l.createdAt),""),N(3),ae("Status: ",l.status,""),N(2),ae("Total: ",l.price," RON")}}var dV=(()=>{let r=class r{constructor(n,s,d){this.accountDetailsService=n,this.snackBar=s,this.dialog=d,this.user={},this.orderList=[]}ngOnInit(){return It(this,null,function*(){yield this.accountDetailsService.fetchUser(),this.userSubscription=this.accountDetailsService.getUser().subscribe(n=>{this.user=n,this.orderList=this.user.orderList.sort((s,d)=>new Date(d.createdAt).getTime()-new Date(s.createdAt).getTime()).slice(0,5),this.createPieChart()})})}ngOnDestroy(){this.userSubscription?.unsubscribe()}onEditClick(){this.dialog.open(aV,{width:"60%",data:this.user}).afterClosed().subscribe(s=>It(this,null,function*(){s&&(yield this.accountDetailsService.editUser(s))}))}onChangePasswordClick(){this.dialog.open(lV,{width:"60%"}).afterClosed().subscribe(s=>It(this,null,function*(){s&&(yield this.accountDetailsService.changePassword(s))}))}createPieChart(){let s={type:"pie",data:{labels:this.user.genrePreferences.map(_=>_.broadGenre),datasets:[{data:this.user.genrePreferences.map(_=>_.percentage.toFixed(2)),backgroundColor:["rgba(255, 99, 132, 0.6)","rgba(54, 162, 235, 0.6)","rgba(255, 206, 86, 0.6)","rgba(75, 192, 192, 0.6)","rgba(153, 102, 255, 0.6)","rgba(255, 159, 64, 0.6)","rgba(201, 203, 207, 0.6)","rgba(34, 43, 243, 0.6)","rgba(120, 221, 45, 0.6)","rgba(255, 140, 0, 0.6)","rgba(0, 128, 128, 0.6)","rgba(128, 0, 128, 0.6)","rgba(255, 215, 0, 0.6)","rgba(255, 192, 203, 0.6)","rgba(0, 0, 255, 0.6)","rgba(128, 128, 0, 0.6)","rgba(0, 128, 0, 0.6)","rgba(255, 0, 0, 0.6)","rgba(0, 255, 0, 0.6)","rgba(0, 0, 128, 0.6)"],borderColor:["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)","rgba(201, 203, 207, 1)","rgba(34, 43, 243, 1)","rgba(120, 221, 45, 1)","rgba(255, 140, 0, 1)","rgba(0, 128, 128, 1)","rgba(128, 0, 128, 1)","rgba(255, 215, 0, 1)","rgba(255, 192, 203, 1)","rgba(0, 0, 255, 1)","rgba(128, 128, 0, 1)","rgba(0, 128, 0, 1)","rgba(255, 0, 0, 1)","rgba(0, 255, 0, 1)","rgba(0, 0, 128, 1)"],borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right"}}}},d=document.getElementById("genrePieChart"),m=new Xl(d,s)}};r.\u0275fac=function(s){return new(s||r)(B(cV),B(Je),B(fo))},r.\u0275cmp=Et({type:r,selectors:[["app-account-details"]],standalone:!0,features:[At],decls:25,vars:4,consts:[[1,"container-fluid"],[1,"personal-info-genres"],[1,"personal-info"],[1,"text-center"],[1,"card"],[1,"card-body"],[1,"card-title"],[1,"card-subtitle","mb-2","text-muted"],[1,"card-footer"],[1,"btn","btn-primary","me-2",3,"click"],[1,"btn","btn-primary",3,"click"],[1,"genre-preferences","d-flex","justify-content-center","align-items-center","flex-column","flex-grow-1"],[1,"chart-container"],["id","genrePieChart"],[1,"recent-orders"],["class","card",4,"ngFor","ngForOf"],["role","tab",1,"card-title","mb-3"],[3,"routerLink"],[1,"card-text"]],template:function(s,d){s&1&&(A(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),V(4,"Informatii personale"),k(),A(5,"div",4)(6,"div",5)(7,"h5",6),V(8),k(),A(9,"h6",7),V(10),k()(),A(11,"div",8)(12,"button",9),ct("click",function(){return d.onEditClick()}),V(13,"Modifica datele"),k(),A(14,"button",10),ct("click",function(){return d.onChangePasswordClick()}),V(15,"Schimba parola"),k()()()(),A(16,"div",11)(17,"h1",3),V(18,"Preferinte genuri"),k(),A(19,"div",12),dt(20,"canvas",13),k()()(),A(21,"div",14)(22,"h1"),V(23,"Comenzile recente"),k(),mt(24,Aat,12,9,"div",15),k()()),s&2&&(N(8),Fo("Nume: ",d.user.firstName," ",d.user.lastName,""),N(2),ae("Email: ",d.user.email,""),N(14),Z("ngForOf",d.orderList))},dependencies:[Ii,hd,ar],styles:[".chart-container[_ngcontent-%COMP%]{position:relative;width:500px;height:500px;overflow:hidden}.personal-info-genres[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-top:20px}@media screen and (max-width: 1150px){.chart-container[_ngcontent-%COMP%]{width:400px;height:400px}}@media screen and (max-width: 768px){.personal-info-genres[_ngcontent-%COMP%]{flex-direction:column;align-items:center;gap:30px}}"]});let a=r;return a})();var Bd=MF(cT());var kx=(()=>{let r=class r{constructor(n,s,d){this.http=n,this.identityService=s,this.snackBar=d,this.bookedEventsSubject=new Ze([]),this.ticketsSubject=new Ze([])}setBookedEvents(n){this.bookedEventsSubject.next(n)}getBookedEvents(){return this.bookedEventsSubject.asObservable()}setTickets(n){this.ticketsSubject.next(n)}getTickets(){return this.ticketsSubject.asObservable()}fetchBookedEvents(){return It(this,null,function*(){try{let n=yield Ve(this.http.get(Me+"/events/me",{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setBookedEvents(n)}catch{this.snackBar.open("Error fetching booked events","Close",{duration:3e3})}})}fetchTicketsByEventId(n){return It(this,null,function*(){try{let s=yield Ve(this.http.get(Me+"/tickets/"+n,{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setTickets(s)}catch{this.snackBar.open("Error fetching tickets","Close",{duration:3e3})}})}};r.\u0275fac=function(s){return new(s||r)(ht(Gi),ht(hi),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var mV=(()=>{let r=class r{constructor(n,s){this.trackEventService=n,this.router=s,this.style="mapbox://styles/mapbox/streets-v11",this.lat=0,this.lng=0,this.events=[]}ngOnInit(){return It(this,null,function*(){yield this.fetchBookedEvents(),this.initMap()})}fetchBookedEvents(){return It(this,null,function*(){yield this.trackEventService.fetchBookedEvents(),this.trackEventService.getBookedEvents().subscribe({next:n=>{this.events=n}})})}initMap(){Bd.default.accessToken=Rx,navigator.geolocation.getCurrentPosition(n=>{this.lat=n.coords.latitude,this.lng=n.coords.longitude,this.map=new Bd.default.Map({container:"map",style:this.style,zoom:9,hash:!0,center:[this.lng,this.lat]}),this.map.addControl(new Bd.default.NavigationControl),this.map.addControl(new Bd.default.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0})),this.events.forEach(s=>{this.addMarker(s)})},n=>{console.error(n)})}addMarker(n){if(this.map instanceof Bd.default.Map){let s=[n.location.longitude,n.location.latitude],d=new Bd.default.Marker().setLngLat(s).setPopup(new Bd.default.Popup().setHTML(`<div class="popup-content">
            <h5 style="user-select: none; cursor: pointer;">${n.title}</h5>
            <p style="user-select: none; cursor: pointer;">${n.location.name} | ${n.date}</p>
            <button class="btn btn-primary view-details">View details</button>
          </div>`)).addTo(this.map);d.getPopup().on("open",()=>{let m=d.getPopup().getElement(),_=m?.querySelector(".view-details"),w=m?.querySelector("h5"),S=m?.querySelector("p");w&&w.addEventListener("click",T=>this.handleButtonClick([n.location.name,n.title,n.id])),S&&S.addEventListener("click",T=>this.handleButtonClick([n.location.name,n.location.id])),_&&_.addEventListener("click",T=>this.handleButtonClick(["track",n.title,n.id]))}),d.getPopup().on("close",()=>{let m=d.getPopup().getElement(),_=m?.querySelector(".view-details"),w=m?.querySelector("h5"),S=m?.querySelector("p");w&&w.removeEventListener("click",T=>this.handleButtonClick(n)),S&&S.removeEventListener("click",T=>this.handleButtonClick(n)),_&&_.removeEventListener("click",T=>this.handleButtonClick(n))})}}handleButtonClick(n){let s={id:n[n.length-1]},d=n.slice(0,-1);d=d.map(m=>m==="track"?"event-details":m),this.router.navigate(["/",...d],{queryParams:s})}};r.\u0275fac=function(s){return new(s||r)(B(kx),B(tn))},r.\u0275cmp=Et({type:r,selectors:[["app-track-event"]],standalone:!0,features:[At],decls:2,vars:0,consts:[["id","map",1,"match-parent"]],template:function(s,d){s&1&&(A(0,"div"),dt(1,"div",0),k())},styles:[".match-parent[_ngcontent-%COMP%]{width:100%;height:700px}"]});let a=r;return a})();var Vd=MF(cT());var pV=(()=>{let r=class r{constructor(n,s){this.dialogRef=n,this.data=s,this.style="mapbox://styles/mapbox/streets-v11",this.destination=[0,0],this.userLocation=[0,0]}ngOnInit(){Vd.default.accessToken=Rx,this.destination=this.data.destination,this.map=new Vd.default.Map({container:"map",style:this.style,zoom:11,center:[this.destination[0],this.destination[1]]}),this.map.addControl(new Vd.default.NavigationControl),navigator.geolocation.getCurrentPosition(n=>{this.userLocation=[n.coords.longitude,n.coords.latitude],this.addMarker([n.coords.longitude,n.coords.latitude]),this.calculateRoute()}),this.addMarker([this.destination[0],this.destination[1]])}addMarker(n){if(this.map instanceof Vd.default.Map){let s=new Vd.default.Marker().setLngLat(n).setPopup(new Vd.default.Popup().setHTML(`<div class="popup-content">

          </div>`)).addTo(this.map)}}calculateRoute(){let n=`https://api.mapbox.com/directions/v5/mapbox/driving/${this.userLocation[0]},${this.userLocation[1]};
    ${this.destination[0]},${this.destination[1]}?steps=true&geometries=geojson&access_token=${Vd.default.accessToken}`;fetch(n).then(s=>s.json()).then(s=>{let d=s.routes[0].geometry;this.map?.addLayer({id:"route",type:"line",source:{type:"geojson",data:{type:"Feature",properties:{},geometry:d}},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#888","line-width":8}})})}};r.\u0275fac=function(s){return new(s||r)(B(Qn),B(jr))},r.\u0275cmp=Et({type:r,selectors:[["app-map"]],standalone:!0,features:[At],decls:1,vars:0,consts:[["id","map",2,"width","100%","height","100%"]],template:function(s,d){s&1&&dt(0,"div",0)}});let a=r;return a})();function kat(a,r){if(a&1&&(A(0,"div")(1,"p"),V(2),k(),dt(3,"br"),A(4,"div",5),dt(5,"img",6),k(),dt(6,"hr"),k()),a&2){let l=r.$implicit;N(2),Fo("",l.ticketType.name," | ",l.ticketType.price," RON"),N(3),Qh("src","data:image/png;base64, ",l.image,"",Tr)}}var Rat=a=>["/","event",a],Pat=a=>({id:a}),fV=(()=>{let r=class r{constructor(n,s,d){this.route=n,this.trackEventService=s,this.mapDialog=d,this.tickets=[],this.event={}}ngOnInit(){return It(this,null,function*(){yield this.trackEventService.fetchTicketsByEventId(this.route.snapshot.queryParams.id),this.trackEventService.getTickets().subscribe({next:n=>{this.tickets=n,this.event=n[0].ticketType.event}})})}showMap(){let n=[this.event.location.longitude,this.event.location.latitude];this.mapDialog.open(pV,{width:"80%",height:"80%",data:{destination:n}}).afterClosed()}};r.\u0275fac=function(s){return new(s||r)(B(En),B(kx),B(fo))},r.\u0275cmp=Et({type:r,selectors:[["app-track-event-details"]],standalone:!0,features:[At],decls:12,vars:10,consts:[[1,"container-fluid"],["role","button",3,"routerLink","queryParams"],[1,"btn","btn-primary","map-button",3,"click"],[1,"tickets"],[4,"ngFor","ngForOf"],[1,"image"],["alt","",3,"src"]],template:function(s,d){s&1&&(A(0,"div",0)(1,"h1",1),V(2),k(),A(3,"p"),V(4),k(),A(5,"button",2),ct("click",function(){return d.showMap()}),V(6,"Show map"),k(),dt(7,"hr"),A(8,"div",3)(9,"h2"),V(10,"Tickets"),k(),mt(11,kat,7,3,"div",4),k()()),s&2&&(N(),Z("routerLink",Xi(6,Rat,d.event.title))("queryParams",Xi(8,Pat,d.event.id)),N(),De(d.event.title),N(2),Fo("",d.event.location==null?null:d.event.location.name," | ",d.event.date,""),N(7),Z("ngForOf",d.tickets))},dependencies:[Ii,ar],styles:[".container-fluid[_ngcontent-%COMP%]{width:65%;margin:0 auto;border:2px solid #ccc;padding:20px;border-radius:8px}.image[_ngcontent-%COMP%]{display:flex;justify-content:center}"]});let a=r;return a})();var gV=(()=>{let r=class r{constructor(){this.menuItems=[{label:"Acasa",route:"validator-dashboard",icon:"fa-solid fa-home fa-fw me-3"},{label:"Validare",route:"validator-dashboard/scanner",icon:"fa-solid fa-qrcode fa-fw me-3"}]}};r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=Et({type:r,selectors:[["app-validator-dashboard"]],standalone:!0,features:[At],decls:3,vars:2,consts:[[3,"menuItems","brand"]],template:function(s,d){s&1&&(dt(0,"app-sidebar",0),A(1,"main"),dt(2,"router-outlet"),k()),s&2&&Z("menuItems",d.menuItems)("brand","Validator dashboard")},dependencies:[Am,cl],styles:["@media (min-width: 991.98px){main[_ngcontent-%COMP%]{padding-left:240px}}main[_ngcontent-%COMP%]{margin-top:70px;margin-left:15px}"]});let a=r;return a})();var _V=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=Et({type:r,selectors:[["app-home-validator"]],standalone:!0,features:[At],decls:2,vars:0,template:function(s,d){s&1&&(A(0,"p"),V(1,"home-validator works!"),k())}});let a=r;return a})();var vV=(()=>{let r=class r{constructor(n,s){this.identityService=n,this.router=s}canActivate(n){return this.identityService.isUser()||!this.identityService.isLoggedIn()?(this.router.navigate([""]),!1):this.identityService.isAdmin()?(this.router.navigate(["admin-dashboard"]),!1):!0}};r.\u0275fac=function(s){return new(s||r)(ht(hi),ht(tn))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var Oat=["video"],Fat=["canvas"],Lat=["resultsPanel"],Wg="assets/wasm/index.js",$g="https://cdn.jsdelivr.net/npm/ngx-scanner-qrcode@1.6.9/wasm/index.js",zat="https://cdn.jsdelivr.net/npm/ngx-scanner-qrcode@latest/wasm/index.js",Nat="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",wV={audio:!1,video:!0},hT={lineWidth:1,strokeStyle:"green",fillStyle:"#55f02880"},mT={font:"15px serif",strokeStyle:"#fff0",fillStyle:"#ff0000"},Lc={src:"",fps:30,vibrate:300,decode:"utf-8",isBeep:!0,constraints:wV,canvasStyles:[hT,mT]},Px=()=>"zbarWasm"in window,Bat=(a,r,l)=>{if(r&&Object.keys(r[a]).length){for(let n in l){let s=JSON.parse(JSON.stringify(Ri(Gt({},r[a]),{[n]:l[n]})));r[a]=r[a].hasOwnProperty(n)?r[a]:s}return r[a]}else return l},Zn=(a,r,l)=>{l?a.error(l):a.next(r),a.complete()},uT=(a=!1)=>{if(a===!1)return;let r=new Audio(Nat);r.oncanplaythrough=()=>{let l=r.play();l&&l.catch(n=>{n.name==="NotAllowedError"||n.name})}},yV=(a,r,l,n)=>{let s,d,m=r.width,_=r.height,w=m/_,S=parseInt(getComputedStyle(r).width),T=parseInt(getComputedStyle(r).height),L=S/T;l.innerHTML="",w>L?(s=S/m,d=S/w/_):(d=T/_,s=T*w/m);for(let H=0;H<a.length;H++){let q=a[H],X=document.createElement("canvas"),it=X.getContext("2d",{willReadFrequently:!0}),at={},ut=[],Mt=[],Lt=0,Pt=0,Nt=n.length===2&&n[1]?.font?.replace(/[^0-9]/g,"");Nt&&/[0-9]/g.test(Nt)&&(Lt=parseFloat(Nt),Pt=(s||1)*Lt,Number.isNaN(Pt)&&(Pt=Lt));let ue=q.points;for(let Pi=0;Pi<ue.length;Pi++){let Cr=ue?.[Pi]?.x??0,ki=ue?.[Pi]?.y??0;at[`x${Pi+1}`]=Cr,at[`y${Pi+1}`]=ki,ut.push(Cr),Mt.push(ki)}let Q=Math.max(...ut),$t=Math.min(...ut),Be=Math.max(...Mt),Ai=Math.min(...Mt);X.setAttribute("class","qrcode-polygon"),w>L?(X.style.top=Ai*d+(T-S/w)*.5+"px",X.style.left=$t*s+"px",X.width=(Q-$t)*s,X.height=(Be-Ai)*s):(X.style.top=Ai*d+"px",X.style.left=$t*s+(S-T*w)*.5+"px",X.width=(Q-$t)*d,X.height=(Be-Ai)*d);for(let Pi in n[0])it[Pi]=n[0][Pi];let fe=[];for(let Pi=0;Pi<ut.length;Pi++)fe.push((at[`x${Pi+1}`]-$t)*d),fe.push((at[`y${Pi+1}`]-Ai)*s);let ii=fe.slice(0);for(it.beginPath(),it.moveTo(ii.shift(),ii.shift());ii.length;)it.lineTo(ii.shift(),ii.shift());if(it.closePath(),it.fill(),it.stroke(),Lt){let Pi=document.createElement("div");Pi.setAttribute("class","qrcode-tooltip-temp"),Pi.innerText=q.value,Pi.style.maxWidth=(m>window.innerWidth?window.innerWidth*.9:m)+"px",Pi.style.borderRadius=`clamp(1px, ${s*Lt-10}px, 3px)`,Pi.style.paddingBlock=`clamp(1px, ${s*Lt-10}px, 3px)`,Pi.style.paddingInline=`clamp(2.5px, ${s*Lt-6}px, 10px)`;let Cr=`<svg xmlns="http://www.w3.org/2000/svg" width="${Pt}" height="${Pt}" viewBox="0 0 512 512"><rect x="128" y="128" width="336" height="336" rx="57" ry="57"></rect><path d="M383.5,128l.5-24a56.16,56.16,0,0,0-56-56H112a64.19,64.19,0,0,0-64,64V328a56.16,56.16,0,0,0,56,56h24"></path></svg>`,ki=new DOMParser().parseFromString(Cr,"application/xml"),jn=Pi.ownerDocument.importNode(ki.documentElement,!0);jn.style.marginLeft=`clamp(1px, ${s*Lt-10}px, 3px)`,Pi.appendChild(jn),jn.addEventListener("click",()=>window.navigator.clipboard.writeText(q.value)),Pi.addEventListener("click",()=>window.navigator.clipboard.writeText(q.value));let fn=document.createElement("div");fn.setAttribute("class","qrcode-tooltip"),fn.appendChild(Pi),d=T/_,s=T*w/m,fn.style.fontSize=s*Lt+"px",fn.style.top=Ai*d+"px",fn.style.left=$t*s+(S-T*w)*.5+"px",fn.style.width=(Q-$t)*d+"px",fn.style.height=(Be-Ai)*d+"px";let fr=document.createElement("span");fr.innerText=q.value,fr.style.top=Ai*d+-20*d+"px",fr.style.left=$t*s+(S-T*w)*.5+"px";let ve=n[1]?.font?.split(" ")?.[1];fr.style.fontFamily=ve,fr.style.fontSize=s*Lt+"px",fr.style.color=n?.[1]?.fillStyle,l?.appendChild(fn),l?.appendChild(fr)}l?.appendChild(X)}},Vat=(a,r,l)=>{let n=r.getContext("2d",{willReadFrequently:!0});for(let s=0;s<a.length;s++){let d=a[s],m={},_=[],w=[],S=0,L=l[1]?.font?.split(" ")?.[0]?.replace(/[^0-9]/g,"");L&&/[0-9]/g.test(L)&&(S=parseFloat(L));let H=d.points;for(let Mt=0;Mt<H.length;Mt++){let Lt=H?.[Mt]?.x??0,Pt=H?.[Mt]?.y??0;m[`x${Mt+1}`]=Lt,m[`y${Mt+1}`]=Pt,_.push(Lt),w.push(Pt)}let q=Math.min(..._),X=Math.min(...w),it=()=>{for(let Pt in l[0])n[Pt]=l[0][Pt];let Mt=[];for(let Pt=0;Pt<_.length;Pt++)Mt.push(m[`x${Pt+1}`]),Mt.push(m[`y${Pt+1}`]);let Lt=Mt.slice(0);for(n.beginPath(),n.moveTo(Lt.shift(),Lt.shift());Lt.length;)n.lineTo(Lt.shift(),Lt.shift());n.closePath(),n.fill(),n.stroke()},at=document.createElement("canvas"),ut=()=>{let Mt=l[1]?.font?.split(" ")?.[1];at.height=r.height,at.width=r.width;let Lt=at.getContext("2d",{willReadFrequently:!0});Lt.font=S+"px "+Mt;for(let Pt in l[1])Lt[Pt]=l[1][Pt];Hat(Lt,d.value,q,X-5)};it(),ut(),n.drawImage(at,0,0)}},jat=(a,r)=>{let l=r?.decode??Lc.decode,n=r?.canvasStyles?.length===2?r?.canvasStyles:[hT,mT],s=r?.isBeep??Lc.isBeep;return new Promise((d,m)=>{let _=new FileReader;_.onload=()=>{let w={name:a.name,file:a,url:URL.createObjectURL(a)},S=new Image;S.setAttribute("crossOrigin","anonymous"),S.onload=()=>It(void 0,null,function*(){let T=document.createElement("canvas");T.width=S.naturalWidth||S.width,T.height=S.naturalHeight||S.height;let L=T.getContext("2d");L.drawImage(S,0,0,T.width,T.height);let H=L.getImageData(0,0,T.width,T.height);if(Px()){let q=yield zbarWasm.scanImageData(H);if(q?.length){q.forEach(ut=>ut.value=ut.decode(l?.toLocaleLowerCase())),Vat(q,T,n);let X=yield CV(T),it=URL.createObjectURL(X);d(Object.assign({},w,{data:q,url:it,canvas:T,file:((ut,Mt)=>new File([ut],Mt,{lastModified:new Date().getTime(),type:ut.type}))(X,w.name)})),uT(s)}else d(Object.assign({},w,{data:q,canvas:T}))}}),S.src=w.url},_.onerror=w=>m(w),_.readAsDataURL(a)})},CV=(a,r)=>new Promise((l,n)=>a.toBlob(s=>l(s),r)),Uat=(a,r)=>new File([a],r,{lastModified:new Date().getTime(),type:a.type}),SV=(a=[],r,l,n,s=new Ys)=>(EV(a,l,n).then(d=>{Promise.all(Object.assign([],d).map(m=>jat(m,r))).then(m=>{Zn(s,m)}).catch(m=>Zn(s,null,m))}),s),Hat=(a,r,l,n)=>{let s=a.measureText("M").width*1.2,d=r.split(`
`);for(var m=0;m<d.length;++m)a.fillText(d[m],l,n),a.strokeText(d[m],l,n),n+=s},EV=(a=[],r=100,l=100)=>{if(a.length&&(r<100||l<100)){let n=[];return new Promise((s,d)=>{for(let m of a){let _=new Image,w=new FileReader;w.onload=function(S){_.onload=function(){let T=document.createElement("canvas"),L=T.getContext("2d"),H=Math.round(_.width*(r/100)),q=Math.round(_.height*(r/100));T.width=H,T.height=q,L.drawImage(_,0,0,H,q),T.toBlob(X=>{let it=new File([X],m.name,{type:m.type});n.push(it),a.length===n.length&&s(n)},m.type,l/100)},_.src=S.target.result},w.onerror=S=>d(S),w.readAsDataURL(m)}})}else return Promise.resolve(a)},bV=a=>{Object.assign([],a.childNodes).forEach(r=>a.removeChild(r))},Gat=a=>{a.getContext("2d",{willReadFrequently:!0}).clearRect(0,0,a.width,a.height)},dT=(a,r)=>{a.style.width=r.offsetWidth+"px",a.style.height=r.offsetHeight+"px"},xV=(a=300)=>{a&&qat()&&window?.navigator?.vibrate(a)},qat=()=>{let a=navigator.userAgent||navigator.vendor||window.opera,r=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i,l=/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i,n=/^((?!chrome|android).)*safari/i;return!!(r.test(a)||l.test(a.substr(0,4)))&&!n.test(a)},Wat=(()=>{let r=class r{loadFiles(n=[],s,d){let m=new Ys;return EV(n,s,d).then(_=>{Promise.all(Object.assign([],_).map(w=>this.readAsDataURL(w))).then(w=>Zn(m,w)).catch(w=>Zn(m,null,w))}),m}loadFilesToScan(n=[],s,d,m){return SV(n,s,d,m)}readAsDataURL(n){return new Promise((s,d)=>{let m=new FileReader;m.onload=()=>{let _={name:n.name,file:n,url:URL.createObjectURL(n)};s(_)},m.onerror=_=>d(_),m.readAsDataURL(n)})}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),$at=(a=new Ys,r)=>{let l=0,n=(s=!1)=>{let d=()=>{let w;try{let S=()=>{clearTimeout(w),Px()?setTimeout(()=>Zn(a,!0)):w=setTimeout(()=>S())};setTimeout(()=>S()),setTimeout(()=>clearTimeout(w),3e3)}catch{clearTimeout(w)}},m=document.querySelectorAll(`script[src="${$g}"]`),_=document.querySelectorAll(`script[src="${zat}"]`);if(m.length||_.length)d();else{let w=document.querySelectorAll(`script[src="${Wg}"]`);if(w.length===1)d();else if(w.forEach(S=>S.remove()),r){let S=r.createElement("script");r.setAttribute(S,"src",s?$g:Wg),r.setAttribute(S,"type","text/javascript"),r.setAttribute(S,"async",""),r.appendChild(document.head,S),S.onload=()=>d(),S.onerror=()=>{l<2?(document.head.removeChild(S),n(!0)):Zn(a,!1,"Could not load script "+s?$g:Wg)},l+=1}else{let S=document.createElement("script");S.setAttribute("src",s?$g:Wg),S.setAttribute("type","text/javascript"),S.setAttribute("async",""),document.head.appendChild(S),S.onload=()=>d(),S.onerror=()=>{l<2?(document.head.removeChild(S),n(!0)):Zn(a,!1,"Could not load script "+s?$g:Wg)},l+=1}}};return n(),a},MV=(()=>{let r=class r{constructor(n,s){this.renderer=n,this.elementRef=s,this.event=new ye,this.src=Lc.src,this.fps=Lc.fps,this.vibrate=Lc.vibrate,this.decode=Lc.decode,this.isBeep=Lc.isBeep,this.config=Lc,this.constraints=Lc.constraints,this.canvasStyles=[hT,mT],this.isStart=!1,this.isPause=!1,this.isLoading=!1,this.isTorch=!1,this.data=new Ze([]),this.devices=new Ze([]),this.deviceIndexActive=0,this.dataForResize=[],this.ready=new Ys,this.STATUS={startON:()=>this.isStart=!0,pauseON:()=>this.isPause=!0,loadingON:()=>this.isLoading=!0,startOFF:()=>this.isStart=!1,pauseOFF:()=>this.isPause=!1,loadingOFF:()=>this.isLoading=!1,torchOFF:()=>this.isTorch=!1}}ngOnInit(){this.overrideConfig(),$at(this.ready,this.renderer).subscribe(()=>{this.src&&this.loadImage(this.src),this.resize()})}start(n){let s=new Ys;return this.isStart?Zn(s,!1):this.safariWebRTC(s,n),s}stop(){this.STATUS.pauseOFF(),this.STATUS.startOFF(),this.STATUS.torchOFF(),this.STATUS.loadingOFF();let n=new Ys;try{clearTimeout(this.rAF_ID),this.video.nativeElement.srcObject.getTracks().forEach(s=>{s.stop(),Zn(n,!0)}),this.dataForResize=[],Gat(this.canvas.nativeElement),bV(this.resultsPanel.nativeElement)}catch(s){Zn(n,!1,s)}return n}play(){let n=new Ys;return this.isPause?(this.video.nativeElement.play(),this.STATUS.pauseOFF(),this.requestAnimationFrame(),Zn(n,!0)):Zn(n,!1),n}pause(){let n=new Ys;return this.isStart?(clearTimeout(this.rAF_ID),this.video.nativeElement.pause(),this.STATUS.pauseON(),Zn(n,!0)):Zn(n,!1),n}playDevice(n,s=new Ys){let d=this.getConstraints(),m=this.isStart&&d?d.deviceId!==n:!0;switch(!0){case(n==="null"||n==="undefined"||!n):stop(),this.stop(),Zn(s,!1);break;case(n&&m):stop(),this.stop(),this.STATUS.loadingON(),this.deviceIndexActive=this.devices.value.findIndex(w=>w.deviceId===n);let _=Ri(Gt({},this.constraints),{audio:!1,video:Gt({deviceId:n},this.constraints.video)});navigator.mediaDevices.getUserMedia(_).then(w=>{this.video.nativeElement.srcObject=w,this.video.nativeElement.onloadedmetadata=()=>{this.video.nativeElement.play(),this.requestAnimationFrame(),Zn(s,!0),this.STATUS.startON(),this.STATUS.loadingOFF()}}).catch(w=>{this.eventEmit(!1),Zn(s,!1,w),this.STATUS.startOFF(),this.STATUS.loadingOFF()});break;default:Zn(s,!1),this.STATUS.loadingOFF();break}return s}loadImage(n){let s=new Ys;this.STATUS.startOFF(),this.STATUS.loadingON();let d=new Image;return d.setAttribute("crossOrigin","anonymous"),d.onload=()=>{Px()&&this.drawImage(d,m=>{Zn(s,m),this.STATUS.startOFF(),this.STATUS.loadingOFF()})},d.src=n,s}torcher(){let n=this.applyConstraints({advanced:[{torch:this.isTorch}]});return n.subscribe(()=>!1,()=>this.isTorch=!this.isTorch),n}applyConstraints(n,s=0){let d=new Ys;if(this.isStart){let m=this.video.nativeElement.srcObject;if(s!==null||s!==void 0||!Number.isNaN(s)){let _=m.getVideoTracks()[s];new window.ImageCapture(_).getPhotoCapabilities().then(()=>It(this,null,function*(){yield _.applyConstraints(n),dT(this.video.nativeElement,this.canvas.nativeElement),Zn(d,!0)})).catch(S=>{switch(S?.name){case"NotFoundError":case"DevicesNotFoundError":Zn(d,!1,"Required track is missing");break;case"NotReadableError":case"TrackStartError":Zn(d,!1,"Webcam or mic are already in use");break;case"OverconstrainedError":case"ConstraintNotSatisfiedError":Zn(d,!1,"Constraints can not be satisfied by avb. devices");break;case"NotAllowedError":case"PermissionDeniedError":Zn(d,!1,"Permission denied in browser");break;case"TypeError":Zn(d,!1,"Empty constraints object");break;default:Zn(d,!1,S);break}})}else Zn(d,!1,"Please check again deviceIndex")}else Zn(d,!1,"Please start the scanner");return d}getConstraints(n=0){return this.video.nativeElement.srcObject?.getVideoTracks()[n]?.getConstraints()}download(n=`ngx_scanner_qrcode_${Date.now()}.png`,s,d){let m=new Ys;return It(this,null,function*(){let _=yield CV(this.canvas.nativeElement),w=Uat(_,n);SV([w],this.config,s,d,m).subscribe(S=>{S.forEach(T=>{if(T?.data?.length){let L=document.createElement("a");L.href=T.url,L.download=T.name,L.click(),L.remove()}})})}),m}resize(){window.addEventListener("resize",()=>{yV(this.dataForResize,this.canvas.nativeElement,this.resultsPanel.nativeElement,this.canvasStyles),dT(this.video.nativeElement,this.canvas.nativeElement)})}overrideConfig(){"src"in this.config&&(this.src=this.config.src),"fps"in this.config&&(this.fps=this.config.fps),"vibrate"in this.config&&(this.vibrate=this.config.vibrate),"decode"in this.config&&(this.decode=this.config.decode),"isBeep"in this.config&&(this.isBeep=this.config.isBeep),"constraints"in this.config&&(this.constraints=Bat("constraints",this.config,wV)),"canvasStyles"in this.config&&this.config?.canvasStyles?.length===2&&(this.canvasStyles=this.config.canvasStyles)}safariWebRTC(n,s){this.STATUS.startOFF(),this.STATUS.loadingON(),navigator.mediaDevices.getUserMedia(this.constraints).then(d=>{d.getTracks().forEach(m=>m.stop()),this.loadAllDevices(n,s)}).catch(d=>{Zn(n,!1,d),this.STATUS.startOFF(),this.STATUS.loadingOFF()})}loadAllDevices(n,s){navigator.mediaDevices.enumerateDevices().then(d=>{let m=d.filter(_=>_.kind=="videoinput");this.devices.next(m),m?.length>0?(Zn(n,m),s?s(m):this.playDevice(m[0].deviceId)):(Zn(n,!1,"No camera detected."),this.STATUS.startOFF(),this.STATUS.loadingOFF())}).catch(d=>{Zn(n,!1,d),this.STATUS.startOFF(),this.STATUS.loadingOFF()})}drawImage(n,s=()=>{}){return It(this,null,function*(){let d=this.canvas.nativeElement,m=d.getContext("2d",{willReadFrequently:!0});n instanceof HTMLImageElement&&(d.width=n.naturalWidth,d.height=n.naturalHeight,n.style.visibility="",this.video.nativeElement.style.visibility="hidden",this.renderer.setStyle(this.elementRef.nativeElement,"width",d.width+"px"),this.renderer.setStyle(this.elementRef.nativeElement,"maxWidth","100%"),this.renderer.setStyle(this.elementRef.nativeElement,"display","inline-block")),n instanceof HTMLVideoElement&&(d.width=n.videoWidth,d.height=n.videoHeight,n.style.visibility="",this.canvas.nativeElement.style.visibility="hidden"),dT(this.video.nativeElement,d),m.clearRect(0,0,d.width,d.height),m.drawImage(n,0,0,d.width,d.height);let _=m.getImageData(0,0,d.width,d.height),w=yield zbarWasm.scanImageData(_);if(w?.length){w.forEach(T=>T.value=T.decode(this.decode?.toLocaleLowerCase())),yV(w,Object.freeze(this.canvas.nativeElement),this.resultsPanel.nativeElement,this.canvasStyles);let S=()=>{this.eventEmit(w),this.dataForResize=w};n instanceof HTMLImageElement&&(s(!0),S(),xV(this.vibrate),uT(this.isBeep)),n instanceof HTMLVideoElement&&(S(),xV(this.vibrate),uT(this.isBeep))}else s(!1),bV(this.resultsPanel.nativeElement),this.dataForResize=[]})}eventEmit(n=!1){n!==!1&&this.data.next(n||[]),n!==!1&&this.event.emit(n||[])}requestAnimationFrame(n=100){try{clearTimeout(this.rAF_ID),this.rAF_ID=setTimeout(()=>{this.video.nativeElement.readyState===this.video.nativeElement.HAVE_ENOUGH_DATA&&(n=0,Px()&&this.drawImage(this.video.nativeElement),this.isStart&&!this.isPause&&this.requestAnimationFrame(n))},n||this.fps)}catch{clearTimeout(this.rAF_ID)}}get isReady(){return this.ready}ngOnDestroy(){this.pause()}};r.\u0275fac=function(s){return new(s||r)(B(Oo),B(Se))},r.\u0275cmp=Et({type:r,selectors:[["ngx-scanner-qrcode"]],viewQuery:function(s,d){if(s&1&&(Ge(Oat,5),Ge(Fat,5),Ge(Lat,5)),s&2){let m;ce(m=de())&&(d.video=m.first),ce(m=de())&&(d.canvas=m.first),ce(m=de())&&(d.resultsPanel=m.first)}},hostAttrs:[1,"ngx-scanner-qrcode"],inputs:{src:"src",fps:"fps",vibrate:"vibrate",decode:"decode",isBeep:"isBeep",config:"config",constraints:"constraints",canvasStyles:"canvasStyles"},outputs:{event:"event"},exportAs:["scanner"],decls:6,vars:0,consts:[[1,"origin-overlay"],["resultsPanel",""],[1,"origin-canvas"],["canvas",""],["playsinline","",1,"origin-video"],["video",""]],template:function(s,d){s&1&&dt(0,"div",0,1)(2,"canvas",2,3)(4,"video",4,5)},styles:[`.ngx-scanner-qrcode{display:block;position:relative}.origin-overlay{width:100%;position:absolute}.origin-overlay span{z-index:2;text-align:left;position:absolute}.origin-overlay .qrcode-polygon{z-index:1;position:absolute}.origin-canvas{width:100%;position:absolute}.origin-video{width:100%;background-color:#262626}.qrcode-tooltip{z-index:3;position:absolute}.qrcode-tooltip:hover .qrcode-tooltip-temp{display:block;position:absolute;cursor:copy}.qrcode-tooltip:hover .qrcode-tooltip-temp:active{color:#afafaf}.qrcode-tooltip .qrcode-tooltip-temp{bottom:0;left:50%;color:#fff;text-align:left;display:none;width:max-content;word-wrap:break-word;transform:translate(-50%);transform-style:preserve-3d;background-color:#000000d0;box-shadow:1px 1px 20px #000000e0}.qrcode-tooltip .qrcode-tooltip-temp svg{cursor:pointer}.qrcode-tooltip .qrcode-tooltip-temp svg rect{fill:none;stroke:#fff;stroke-linejoin:round;stroke-width:32px}.qrcode-tooltip .qrcode-tooltip-temp svg path{fill:none;stroke:#fff;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px}.qrcode-tooltip .qrcode-tooltip-temp svg:active rect{stroke:#afafaf}.qrcode-tooltip .qrcode-tooltip-temp svg:active path{stroke:#afafaf}
`],encapsulation:2});let a=r;return a})();var DV=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275mod=xi({type:r}),r.\u0275inj=wi({providers:[Wat]});let a=r;return a})();var TV=(()=>{let r=class r{constructor(n,s,d){this.http=n,this.identityService=s,this.snackBar=d,this.ticketSubject=new Ze({})}setTicket(n){this.ticketSubject.next(n)}getTicket(){return this.ticketSubject.asObservable()}validateTicket(n){return It(this,null,function*(){try{let s=yield Ve(this.http.get(Me+"/tickets/validate/"+n,{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setTicket(s)}catch{this.snackBar.open("Ticket not found","Close",{duration:3e3})}})}};r.\u0275fac=function(s){return new(s||r)(ht(Gi),ht(hi),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function Xat(a,r){if(a&1&&(A(0,"div",9)(1,"p"),V(2,"Biletul a fost scanat cu succes!"),k(),A(3,"p"),V(4),Ps(5,"date"),k()()),a&2){let l=vt();N(4),ae("Data scanarii: ",kS(5,1,l.ticket.scannedAt,"dd/MM/yyyy HH:mm"),"")}}function Kat(a,r){if(a&1&&(A(0,"div",10)(1,"p"),V(2,"Biletul a fost deja scanat!"),k(),A(3,"p"),V(4),Ps(5,"date"),k()()),a&2){let l=vt();N(4),ae("Data scanarii: ",kS(5,1,l.ticket.scannedAt,"dd/MM/yyyy HH:mm"),"")}}function Qat(a,r){a&1&&(A(0,"p",10),V(1,"Biletul a fost anulat!"),k())}var IV=(()=>{let r=class r{constructor(n,s,d,m){this.validateService=n,this.dialogRef=s,this.data=d,this.snackBar=m,this.ticket={}}ngOnInit(){return It(this,null,function*(){yield this.validateService.validateTicket(this.data),this.ticketSubscription=this.validateService.getTicket().subscribe(n=>{this.ticket=n})})}ngOnDestroy(){this.ticketSubscription?.unsubscribe()}onCloseClick(){this.dialogRef.close()}};r.\u0275fac=function(s){return new(s||r)(B(TV),B(Qn),B(jr),B(Je))},r.\u0275cmp=Et({type:r,selectors:[["app-validate"]],standalone:!0,features:[At],decls:24,vars:9,consts:[[1,"modal-content"],[1,"modal-header","mb-4"],["id","exampleModalLabel",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],["class","text-success",4,"ngIf"],["class","text-danger",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"text-success"],[1,"text-danger"]],template:function(s,d){s&1&&(A(0,"div",0)(1,"div",1)(2,"h4",2),V(3,"Detalii bilet"),k(),A(4,"button",3),ct("click",function(){return d.onCloseClick()}),k()(),A(5,"div",4)(6,"h6"),V(7),k(),A(8,"p"),V(9),k(),mt(10,Xat,6,4,"div",5)(11,Kat,6,4,"div",6)(12,Qat,2,0,"p",6),A(13,"h6"),V(14,"Detalii cumparator"),k(),A(15,"p"),V(16),k(),A(17,"p"),V(18),k(),A(19,"p"),V(20),k()(),A(21,"div",7)(22,"button",8),ct("click",function(){return d.onCloseClick()}),V(23,"Inchide"),k()()()),s&2&&(N(7),De(d.ticket.ticketType==null?null:d.ticket.ticketType.event.title),N(2),ae("Categorie bilet: ",d.ticket.ticketType==null?null:d.ticket.ticketType.name,""),N(),Z("ngIf",d.ticket.alreadyScanned==!1&&d.ticket.status=="CONFIRMED"),N(),Z("ngIf",d.ticket.alreadyScanned==!0&&d.ticket.status=="CONFIRMED"),N(),Z("ngIf",d.ticket.status=="CANCELED"),N(4),Fo("Nume: ",d.ticket.userFirstName," ",d.ticket.userLastName,""),N(2),ae("Username: ",d.ticket.username,""),N(2),ae("Email: ",d.ticket.userEmail,""))},dependencies:[qe,hd],styles:[".modal-content[_ngcontent-%COMP%]{padding:20px}"]});let a=r;return a})();var Jat=["action"];function tlt(a,r){a&1&&dt(0,"app-loading")}var elt=()=>({isBeep:!1}),AV=(()=>{let r=class r{constructor(n,s){this.router=n,this.dialog=s,this.dialogRef=null}ngAfterViewInit(){this.action.data.subscribe(n=>{let s=n[0];if(s?.value){this.action.stop();let d=s.value;this.dialogRef=this.dialog.open(IV,{data:d}),this.dialogRef.afterClosed().subscribe(()=>{this.dialogRef=null,this.action.start()})}})}ngOnDestroy(){this.action.data.unsubscribe(),this.dialogRef&&this.dialogRef.close(),this.action.isStart&&this.action.stop()}onStartClick(){this.action.isStart?this.action.stop():this.action.start()}};r.\u0275fac=function(s){return new(s||r)(B(tn),B(fo))},r.\u0275cmp=Et({type:r,selectors:[["app-validate"]],viewQuery:function(s,d){if(s&1&&Ge(Jat,5),s&2){let m;ce(m=de())&&(d.action=m.first)}},standalone:!0,features:[At],decls:5,vars:4,consts:[[3,"config"],["action","scanner"],[4,"ngIf"],[1,"btn","btn-primary",3,"click"]],template:function(s,d){if(s&1&&(dt(0,"ngx-scanner-qrcode",0,1),mt(2,tlt,1,0,"app-loading",2),A(3,"button",3),ct("click",function(){return d.onStartClick()}),V(4),k()),s&2){let m=Ir(1);Z("config",Nr(3,elt)),N(2),Z("ngIf",m.isLoading),N(2),De(m.isStart?"Stop":"Start")}},dependencies:[qe,hy,DV,MV]});let a=r;return a})();var kV=(()=>{let r=class r{constructor(n,s,d){this.route=n,this.identityService=s,this.snackBar=d,this.verified=!1}ngOnInit(){let n=this.route.snapshot.params.token;this.identityService.verifyAccount(n).subscribe({next:()=>{this.verified=!0},error:s=>{this.verified=!1,this.snackBar.open(s.error.message,"Close",{duration:5e3})}})}};r.\u0275fac=function(s){return new(s||r)(B(En),B(hi),B(Je))},r.\u0275cmp=Et({type:r,selectors:[["app-verify-account"]],standalone:!0,features:[At],decls:3,vars:0,consts:[[1,"container-fluid"]],template:function(s,d){s&1&&(A(0,"div",0)(1,"h1"),V(2,"Contul a fost verificat!"),k()())}});let a=r;return a})();var RV=(()=>{let r=class r{constructor(n,s,d){this.route=n,this.identityService=s,this.snackBar=d}ngOnInit(){let n=this.route.snapshot.params.email;this.identityService.resendVerifyAccountEmail(n).subscribe({next:()=>{},error:s=>{this.snackBar.open("Error sending email: "+s.error,"Close",{duration:5e3})}})}};r.\u0275fac=function(s){return new(s||r)(B(En),B(hi),B(Je))},r.\u0275cmp=Et({type:r,selectors:[["app-resend-verify-account-email"]],standalone:!0,features:[At],decls:3,vars:0,consts:[[1,"container-fluid"]],template:function(s,d){s&1&&(A(0,"div",0)(1,"h1"),V(2,"A fost retrimis emailul de verificare."),k()())}});let a=r;return a})();var qu=(()=>{let r=class r{constructor(n,s){this.router=n,this.identityService=s}canActivate(n,s){return this.identityService.isLoggedIn()?(this.router.navigate(["/"]),!1):!0}};r.\u0275fac=function(s){return new(s||r)(ht(tn),ht(hi))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var Ox=(()=>{let r=class r{constructor(n,s){this.http=n,this.snackBar=s,this.artistListSubject=new Ze([]),this.artistSubject=new Ze({})}setArtistList(n){this.artistListSubject.next(n)}getArtistList(){return this.artistListSubject.asObservable()}setArtist(n){this.artistSubject.next(n)}getArtist(){return this.artistSubject.asObservable()}fetchArtists(n){return It(this,null,function*(){try{let s=yield Ve(this.http.get(Me+"/artists/first-letter/"+n));this.setArtistList(s)}catch{this.snackBar.open("Failed to fetch artists","Close",{duration:3e3})}})}fetchArtistById(n){return It(this,null,function*(){try{let s=yield Ve(this.http.get(Me+"/artists/"+n));this.setArtist(s)}catch{this.snackBar.open("Failed to fetch artist","Close",{duration:3e3})}})}};r.\u0275fac=function(s){return new(s||r)(ht(Gi),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var ilt=a=>["/artists",a];function nlt(a,r){if(a&1&&(A(0,"a",6),V(1),k()),a&2){let l=r.$implicit;Z("routerLink",Xi(2,ilt,l)),N(),De(l)}}function rlt(a,r){if(a&1&&(A(0,"span",14),V(1),k()),a&2){let l=r.$implicit;N(),De(l.name)}}var olt=()=>["/events"],slt=a=>({artist:a});function alt(a,r){if(a&1&&(A(0,"div",7),dt(1,"img",8),A(2,"div",9)(3,"h5",10),V(4),k()(),A(5,"div",11)(6,"p",12),mt(7,rlt,2,1,"span",13),k()()()),a&2){let l=r.$implicit;Z("routerLink",Nr(6,olt))("queryParams",Xi(7,slt,l.name)),N(),Qh("alt","",l.name," image"),Z("src",l.imageUrl,Tr),N(3),De(l.name),N(3),Z("ngForOf",l.genreList)}}var OV=(()=>{let r=class r{constructor(n,s){this.route=n,this.artistsService=s,this.letters=[],this.artists=[]}ngOnInit(){for(let n=65;n<=90;n++)this.letters.push(String.fromCharCode(n));this.route.params.subscribe(n=>It(this,null,function*(){yield this.artistsService.fetchArtists(n.letter),this.artistSubscription=this.artistsService.getArtistList().subscribe(s=>{this.artists=s})}))}ngOnDestroy(){this.artistSubscription?.unsubscribe()}};r.\u0275fac=function(s){return new(s||r)(B(En),B(Ox))},r.\u0275cmp=Et({type:r,selectors:[["app-artists-list"]],standalone:!0,features:[At],decls:8,vars:2,consts:[[1,"container-fluid"],[1,"h3","mb-4","text-gray-800"],[1,"links-container"],["routerLinkActive","active","class","letter-link",3,"routerLink",4,"ngFor","ngForOf"],[1,"artist-list-container"],["class","artist-list-item card",3,"routerLink","queryParams",4,"ngFor","ngForOf"],["routerLinkActive","active",1,"letter-link",3,"routerLink"],[1,"artist-list-item","card",3,"routerLink","queryParams"],[1,"card-img-top",3,"src","alt"],[1,"card-header"],[1,"card-title"],[1,"card-body"],[1,"card-text"],["class","badge badge-primary",4,"ngFor","ngForOf"],[1,"badge","badge-primary"]],template:function(s,d){s&1&&(A(0,"div",0)(1,"h1",1),V(2,"Artisti"),k(),A(3,"div",2),mt(4,nlt,2,4,"a",3),k(),dt(5,"hr"),A(6,"div",4),mt(7,alt,8,9,"div",5),k()()),s&2&&(N(4),Z("ngForOf",d.letters),N(3),Z("ngForOf",d.artists))},dependencies:[Ii,ar,u3],styles:[".links-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;flex-direction:row;gap:10px}h1[_ngcontent-%COMP%]{text-align:center;margin:20px 0}.letter-link[_ngcontent-%COMP%]{font-size:1.2rem;transition:all .3s}.artist-list-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;flex-direction:row;flex-wrap:wrap;gap:20px}.card[_ngcontent-%COMP%]{width:350px;height:500px;margin-bottom:20px;box-shadow:0 4px 8px #0003;transition:.3s;border-radius:5px;background-color:#f8f9fa;color:#000;text-align:center;cursor:pointer}img[_ngcontent-%COMP%]{width:100%;height:300px;object-fit:cover;border-radius:5px}.active[_ngcontent-%COMP%]{font-weight:700}"]});let a=r;return a})();var llt=(a,r)=>["/",a,r],clt=a=>({id:a});function dlt(a,r){if(a&1&&(A(0,"div",6)(1,"div",7),dt(2,"img",8),k(),A(3,"div",9)(4,"h5",10),V(5),k(),A(6,"p",11),V(7),k(),A(8,"p",12),V(9),k()()()),a&2){let l=r.$implicit;Z("routerLink",Jh(6,llt,l.location.name,l.title))("queryParams",Xi(9,clt,l.id)),N(2),hs("src",l.imageUrl,Tr),N(3),De(l.title),N(2),De(l.date),N(2),ae("",l.shortDescription.substring(0,600)," ...")}}function ult(a,r){if(a&1&&(A(0,"div",1)(1,"h1"),V(2),k(),dt(3,"img",2),A(4,"div",3)(5,"div",4),mt(6,dlt,10,11,"div",5),k()()()),a&2){let l=vt();N(2),De(l.artist.name),N(),hs("src",l.artist.imageUrl,Tr),N(3),Z("ngForOf",l.artist.eventList)}}var FV=(()=>{let r=class r{constructor(n,s){this.route=n,this.artistsService=s}ngOnInit(){this.route.queryParams.subscribe(n=>It(this,null,function*(){yield this.artistsService.fetchArtistById(n.id),this.artistSubscription=this.artistsService.getArtist().subscribe({next:s=>{this.artist=s}})}))}ngOnDestroy(){this.artistSubscription?.unsubscribe()}};r.\u0275fac=function(s){return new(s||r)(B(En),B(Ox))},r.\u0275cmp=Et({type:r,selectors:[["app-artist"]],standalone:!0,features:[At],decls:1,vars:1,consts:[["class","container-fluid",4,"ngIf"],[1,"container-fluid"],["alt","",1,"img-fluid","artist-image","d-none","d-sm-block",3,"src"],[1,"row"],[1,"col-12"],["role","button","class","card event-card rounded mb-3 mt-3",3,"routerLink","queryParams",4,"ngFor","ngForOf"],["role","button",1,"card","event-card","rounded","mb-3","mt-3",3,"routerLink","queryParams"],[1,"d-flex","justify-content-center","align-items-center"],["alt","",1,"img-fluid","event-image",3,"src"],[1,"card-body"],[1,"card-title"],[1,"card-text","card-date"],[1,"card-text"]],template:function(s,d){s&1&&mt(0,ult,7,3,"div",0),s&2&&Z("ngIf",d.artist)},dependencies:[qe,Ii,ar],styles:[".container-fluid[_ngcontent-%COMP%]{width:90%}.event-card[_ngcontent-%COMP%]{display:flex;flex-direction:row;width:calc(100% - 20px);max-width:100%}.event-card[_ngcontent-%COMP%]:hover{box-shadow:0 0 10px #0003;opacity:.8}.event-image[_ngcontent-%COMP%]{max-height:300px;max-width:200px;height:auto;width:auto}.card-body[_ngcontent-%COMP%]{overflow:hidden}.artist-image[_ngcontent-%COMP%]{max-height:300px;width:100%;object-fit:cover}.card-text[_ngcontent-%COMP%]{font-size:16px}@media (max-width: 768px){.card-title[_ngcontent-%COMP%], .card-text[_ngcontent-%COMP%]{font-size:13px}}@media (max-width: 576px){.event-card[_ngcontent-%COMP%]{flex-direction:column;padding-top:10px}.card-title[_ngcontent-%COMP%], .card-text[_ngcontent-%COMP%]{font-size:12px}.image-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.card-title[_ngcontent-%COMP%], .card-date[_ngcontent-%COMP%]{text-align:end}}"]});let a=r;return a})();var LV=(()=>{let r=class r{constructor(n,s,d){this.http=n,this.identityService=s,this.snackBar=d,this.genreListSubject=new Ze({})}setGenreList(n){this.genreListSubject.next(n)}getGenreList(){return this.genreListSubject.asObservable()}fetchGenres(){return It(this,null,function*(){try{let n=yield Ve(this.http.get(Me+"/genres",{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setGenreList(n)}catch{this.snackBar.open("Failed to fetch genres","Dismiss",{duration:3e3})}})}};r.\u0275fac=function(s){return new(s||r)(ht(Gi),ht(hi),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function mlt(a,r){if(a&1&&(A(0,"option",14),V(1),k()),a&2){let l=r.$implicit;Z("ngValue",l),N(),De(l.name)}}function plt(a,r){a&1&&(A(0,"div",15),V(1," Name is required "),k())}var zV=(()=>{let r=class r{constructor(n,s,d,m){this.dialogRef=n,this.data=s,this.fb=d,this.manageGenresService=m,this.genreList=[],this.registrationForm=this.fb.group({name:["",Le.required]})}ngOnInit(){return It(this,null,function*(){yield this.manageGenresService.fetchGenres(),this.genreListSubscription=this.manageGenresService.getGenreList().subscribe(n=>{this.genreList=n})})}ngOnDestroy(){this.genreListSubscription?.unsubscribe()}onCloseClick(){this.dialogRef.close()}onConfirmClick(){this.registrationForm.markAllAsTouched(),this.registrationForm.valid&&this.dialogRef.close(this.registrationForm.value.name)}};r.\u0275fac=function(s){return new(s||r)(B(Qn),B(jr),B(wr),B(LV))},r.\u0275cmp=Et({type:r,selectors:[["app-add-genre"]],standalone:!0,features:[At],decls:18,vars:3,consts:[[1,"modal-content"],[1,"modal-header","mb-5"],["id","exampleModalLabel",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body","mb-3"],[3,"formGroup"],[1,"mb-3"],["for","name",1,"form-label"],["id","name","name","name","formControlName","name","required","",1,"form-select"],[3,"ngValue",4,"ngFor","ngForOf"],["class","text-danger mb-4",4,"ngIf"],[1,"modal-footer","mt-2"],["type","button",1,"btn","btn-secondary","me-1",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[3,"ngValue"],[1,"text-danger","mb-4"]],template:function(s,d){if(s&1&&(A(0,"div",0)(1,"div",1)(2,"h5",2),V(3,"Add genre"),k(),A(4,"button",3),ct("click",function(){return d.onCloseClick()}),k()(),A(5,"div",4)(6,"form",5)(7,"div",6)(8,"label",7),V(9,"Genre"),k(),A(10,"select",8),mt(11,mlt,2,2,"option",9),k()(),mt(12,plt,2,0,"div",10),k(),A(13,"div",11)(14,"button",12),ct("click",function(){return d.onCloseClick()}),V(15,"Cancel"),k(),A(16,"button",13),ct("click",function(){return d.onConfirmClick()}),V(17,"Save changes"),k()()()()),s&2){let m;N(6),Z("formGroup",d.registrationForm),N(5),Z("ngForOf",d.genreList),N(),Z("ngIf",((m=d.registrationForm.get("name"))==null||m.errors==null?null:m.errors.required)&&((m=d.registrationForm.get("name"))==null?null:m.touched))}},dependencies:[Yi,xr,Ca,Sa,wa,ji,br,Xr,Kr,qe,Rn,Vn,ur,Ii],styles:[".modal-content[_ngcontent-%COMP%]{padding:20px}"]});let a=r;return a})();var flt=["fileInput"];function glt(a,r){a&1&&(A(0,"div",26),V(1," Name is required "),k())}function _lt(a,r){if(a&1){let l=Ce();A(0,"div",27),dt(1,"img",28),A(2,"button",29),ct("click",function(){te(l);let s=vt();return ee(s.removeImage())}),dt(3,"i",30),k()()}if(a&2){let l=vt();N(),Z("src",l.imageSrc,Tr)}}function vlt(a,r){a&1&&(A(0,"div",26),V(1," Image is required "),k())}function ylt(a,r){a&1&&(A(0,"th",31),V(1," Name "),k())}function blt(a,r){if(a&1&&(A(0,"td",32),V(1),k()),a&2){let l=r.$implicit;N(),ae(" ",l.name," ")}}function xlt(a,r){a&1&&(A(0,"th",31),V(1," Action "),k())}function wlt(a,r){if(a&1){let l=Ce();A(0,"td",32)(1,"button",33),ct("click",function(){let d=te(l).$implicit,m=vt();return ee(m.onDeleteGenre(d))}),A(2,"mat-icon"),V(3,"delete"),k()()()}}function Clt(a,r){a&1&&dt(0,"tr",34)}function Slt(a,r){a&1&&dt(0,"tr",35)}var NV=()=>["name","action"],pT=(()=>{let r=class r{constructor(n,s,d,m,_,w){this.dialogRef=n,this.data=s,this.fb=d,this.manageLocationsService=m,this.snackBar=_,this.dialog=w,this.imageSrc=null,this.imageFile=null,this.isImageNull=!1,this.dataSource=new ps,this.registrationForm=this.fb.group({name:[this.data.artist.name,[Le.required,Le.maxLength(50)]]})}ngOnInit(){this.dataSource.data=this.data.artist.genreList,this.imageSrc=this.data.artist.imageUrl,this.isImageNull=this.imageSrc===null}onCloseClick(){this.dialogRef.close()}onConfirmClick(){if(this.registrationForm.markAllAsTouched(),this.registrationForm.valid){let n=Ri(Gt({},this.registrationForm.value),{id:this.data.artist.id,imageUrl:this.imageSrc,genreList:this.dataSource.data});this.imageFile===null&&this.imageSrc!=""?this.dialogRef.close(n):this.imageFile!==null?(n=Ri(Gt({},n),{image:this.imageFile}),this.dialogRef.close(n)):(this.isImageNull=!0,setTimeout(()=>{this.isImageNull=!1},2e3))}}onFileSelected(n){if(this.imageFile=n.target.files[0],this.imageFile){let s=new FileReader;s.onload=()=>{this.imageSrc=s.result},s.readAsDataURL(this.imageFile)}}removeImage(){this.imageSrc="",this.imageFile=null,this.fileInput.nativeElement.value=""}onAddGenre(){this.dialog.open(zV).afterClosed().subscribe(s=>{s&&(this.dataSource.data=[...this.dataSource.data,s])})}onDeleteGenre(n){this.dataSource.data=this.dataSource.data.filter(s=>s!==n)}};r.\u0275fac=function(s){return new(s||r)(B(Qn),B(jr),B(wr),B(Xm),B(Je),B(fo))},r.\u0275cmp=Et({type:r,selectors:[["app-add-edit-artist"]],viewQuery:function(s,d){if(s&1&&Ge(flt,5),s&2){let m;ce(m=de())&&(d.fileInput=m.first)}},standalone:!0,features:[At],decls:36,vars:10,consts:[[1,"modal-content"],[1,"modal-header","mb-5"],["id","exampleModalLabel",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body","mb-3"],[3,"formGroup"],[1,"mb-3"],["mdbInput","","type","text","id","name","formControlName","name",1,"form-control"],["title",""],["mdbLabel","","for","name",1,"form-label"],["class","text-danger mb-4",4,"ngIf"],["type","file","id","image","accept",".jpg, .jpeg, .png, .bmp",1,"form-control",3,"change"],["fileInput",""],["class","mt-2 ms-1",4,"ngIf"],[1,"mt-4"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","action"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"btn","btn-primary",3,"click"],[1,"modal-footer","mt-2"],["type","button",1,"btn","btn-secondary","me-1",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"text-danger","mb-4"],[1,"mt-2","ms-1"],["alt","image",1,"img-fluid",2,"max-height","200px","max-width","200px",3,"src"],[1,"btn","btn-tertiary","ms-2",3,"click"],[1,"fa-solid","fa-x"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(s,d){if(s&1&&(A(0,"div",0)(1,"div",1)(2,"h5",2),V(3),k(),A(4,"button",3),ct("click",function(){return d.onCloseClick()}),k()(),A(5,"div",4)(6,"form",5)(7,"mdb-form-control",6),dt(8,"input",7,8),A(10,"label",9),V(11,"Nume"),k()(),mt(12,glt,2,0,"div",10),k()(),A(13,"input",11,12),ct("change",function(_){return d.onFileSelected(_)}),k(),mt(15,_lt,4,1,"div",13)(16,vlt,2,0,"div",10),A(17,"div",14)(18,"h6"),V(19,"Genuri"),k(),A(20,"table",15),rr(21,16),mt(22,ylt,2,0,"th",17)(23,blt,2,1,"td",18),or(),rr(24,19),mt(25,xlt,2,0,"th",17)(26,wlt,4,0,"td",18),or(),mt(27,Clt,1,0,"tr",20)(28,Slt,1,0,"tr",21),k(),A(29,"button",22),ct("click",function(){return d.onAddGenre()}),V(30," Adauga Gen "),k()(),A(31,"div",23)(32,"button",24),ct("click",function(){return d.onCloseClick()}),V(33," Cancel "),k(),A(34,"button",25),ct("click",function(){return d.onConfirmClick()}),V(35,"Save changes"),k()()()),s&2){let m;N(3),De(d.data.title),N(3),Z("formGroup",d.registrationForm),N(6),Z("ngIf",((m=d.registrationForm.get("name"))==null?null:m.invalid)&&((m=d.registrationForm.get("name"))==null?null:m.touched)),N(3),Z("ngIf",d.imageSrc!==""),N(),Z("ngIf",d.isImageNull),N(4),Z("dataSource",d.dataSource),N(7),Z("matHeaderRowDef",Nr(8,NV)),N(),Z("matRowDefColumns",Nr(9,NV))}},dependencies:[Yi,xr,en,ji,br,Fa,ka,Pa,Oa,Na,La,Wy,Tc,Ba,za,Aa,Kr,mo,po,oo,qe,Rn,Vn,ur,Ra],styles:[".modal-content[_ngcontent-%COMP%]{padding:20px}"]});let a=r;return a})();var BV=(()=>{let r=class r{transform(n,...s){return Array.isArray(n)?n.map(d=>d.name).join(", "):n}};r.\u0275fac=function(s){return new(s||r)},r.\u0275pipe=yv({name:"genreListNames",type:r,pure:!0,standalone:!0});let a=r;return a})();function Elt(a,r){if(a&1){let l=Ce();A(0,"div",22)(1,"button",23),ct("click",function(){te(l);let s=vt();return ee(s.removeFilter())}),V(2,"Sterge filtrul"),k()()}}function Mlt(a,r){if(a&1&&(A(0,"th",26),V(1),k()),a&2){let l=vt().$implicit,n=vt();N(),ae(" ",n.columnMap[l]," ")}}function Dlt(a,r){if(a&1&&(A(0,"td",27),V(1),Ps(2,"genreListNames"),k()),a&2){let l=r.$implicit,n=vt().$implicit;N(),ae(" ",al(2,1,l[n])," ")}}function Tlt(a,r){if(a&1&&(rr(0,24),mt(1,Mlt,2,1,"th",25)(2,Dlt,3,3,"td",16),or()),a&2){let l=r.$implicit;Z("matColumnDef",l)}}function Ilt(a,r){a&1&&(A(0,"th",28),V(1," Actiuni "),k())}function Alt(a,r){if(a&1){let l=Ce();A(0,"td",27)(1,"button",29),ct("click",function(){let d=te(l).$implicit,m=vt();return ee(m.rowData=d)}),dt(2,"i",30),k()()}if(a&2){vt();let l=Ir(25);N(),Z("matMenuTriggerFor",l)}}function klt(a,r){a&1&&dt(0,"tr",31)}function Rlt(a,r){a&1&&dt(0,"tr",32)}var Plt=()=>[5,10,20,50],VV=(()=>{let r=class r{constructor(n,s,d,m){this.dialog=n,this.manageArtistsService=s,this.route=d,this.router=m,this.dataSource=new ps,this.itemsCount=0,this.displayedColumns=["name","genreList"],this.searchValue="",this.selectedFilterOption="name",this.shouldDisplayRemoveFilterButton=!1,this.pageIndex=0,this.pageSize=5,this.columnMap={name:"Nume",genreList:"Gen"}}ngOnInit(){this.route.queryParams.subscribe(n=>It(this,null,function*(){this.pageIndex=n.page||0,this.pageSize=n.size||5,this.searchValue=n.search||"",this.selectedFilterOption=n.filter||"name",this.shouldDisplayRemoveFilterButton=!!(n.filter&&n.search),this.searchValue===""&&this.selectedFilterOption==="name"?yield this.fetchArtists():yield this.fetchFilteredArtists(),this.artistSubscription=this.manageArtistsService.getArtistListSubject().subscribe({next:s=>{this.dataSource.data=s.artistPage.content,this.itemsCount=s.count}})}))}fetchArtists(){return It(this,null,function*(){yield this.manageArtistsService.fetchPaginatedArtists(this.pageIndex,this.pageSize)})}fetchFilteredArtists(){return It(this,null,function*(){yield this.manageArtistsService.fetchPaginatedArtistsFiltered(this.pageIndex,this.pageSize,this.searchValue,this.selectedFilterOption)})}ngOnDestroy(){this.artistSubscription?.unsubscribe()}ngAfterViewInit(){this.paginator.length=this.itemsCount,this.paginator.pageIndex=this.pageIndex,this.paginator.pageSize=this.pageSize,this.dataSource.sort=this.sort}onPageChange(n){this.router.navigate([],{relativeTo:this.route,queryParams:{page:n.pageIndex,size:n.pageSize},queryParamsHandling:"merge"})}filterData(){this.searchValue!==""&&this.router.navigate([],{relativeTo:this.route,queryParams:{search:this.searchValue,filter:this.selectedFilterOption,page:0,size:this.pageSize},queryParamsHandling:"merge"})}handleDeleteKeyboardEvent(n){n.key==="Enter"&&this.filterData()}removeFilter(){this.router.navigate([],{relativeTo:this.route,queryParams:{filter:null,search:null,page:0,size:this.pageSize},queryParamsHandling:"merge"})}onAddClick(){this.dialog.open(pT,{width:"60%",data:{artist:{name:"",imageUrl:"",genreList:[]},title:"Adauga artist"},disableClose:!0}).afterClosed().subscribe(s=>It(this,null,function*(){s&&(s.genreList=JSON.stringify(s.genreList),yield this.manageArtistsService.addArtist(s,this.pageIndex,this.pageSize))}))}onEditClick(){this.dialog.open(pT,{width:"60%",data:{artist:this.rowData,title:"Modifica artist"},disableClose:!0}).afterClosed().subscribe(s=>It(this,null,function*(){s&&(yield this.manageArtistsService.updateArtist(s))}))}onDeleteClick(){this.dialog.open(Nd,{width:"30%"}).afterClosed().subscribe(s=>It(this,null,function*(){s&&(yield this.manageArtistsService.deleteArtist(this.rowData.id,this.pageIndex,this.pageSize),this.dataSource.data.length===0&&this.pageIndex>0&&(this.searchValue===""&&this.selectedFilterOption==="name"?yield this.router.navigate([],{relativeTo:this.route,queryParams:{page:this.pageIndex-1,size:this.pageSize,search:null,filter:null},queryParamsHandling:"merge"}):yield this.router.navigate([],{relativeTo:this.route,queryParams:{page:this.pageIndex-1,size:this.pageSize,search:this.searchValue,filter:this.selectedFilterOption},queryParamsHandling:"merge"})))}))}};r.\u0275fac=function(s){return new(s||r)(B(fo),B(Vb),B(En),B(tn))},r.\u0275cmp=Et({type:r,selectors:[["app-manage-artists"]],viewQuery:function(s,d){if(s&1&&(Ge(ja,5),Ge(na,5)),s&2){let m;ce(m=de())&&(d.paginator=m.first),ce(m=de())&&(d.sort=m.first)}},hostBindings:function(s,d){s&1&&ct("keydown",function(_){return d.handleDeleteKeyboardEvent(_)},!1,ol)},standalone:!0,features:[At],decls:30,vars:13,consts:[[1,"input-group","rounded","pt-2"],["type","search","placeholder","Cauta","aria-label","Search","aria-describedby","search-addon",1,"form-control","rounded",3,"ngModel","ngModelChange"],["id","search-addon",1,"input-group-text","border-0"],["role","button",1,"bg-primary","text-white","fas","fa-search","search-button",3,"click"],[1,"btn","btn-primary","ms-5","me-2",3,"click"],[1,"radio-group","mt-2"],[1,"form-check","form-check-inline"],["type","radio","name","radioGroup","id","name","value","name",1,"form-check-input",3,"ngModel","ngModelChange"],["for","name",1,"form-check-label"],["type","radio","name","radioGroup","id","genre","value","genre",1,"form-check-input",3,"ngModel","ngModelChange"],["for","genre",1,"form-check-label"],["class","form-check-inline",4,"ngIf"],["mat-table","","matSort","",3,"dataSource"],[3,"matColumnDef",4,"ngFor","ngForOf"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","","aria-label","Select page",3,"length","pageSize","pageIndex","pageSizeOptions","page"],["contextMenu","matMenu"],["mat-menu-item","",3,"click"],[1,"form-check-inline"],[1,"btn",3,"click"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-button","",3,"matMenuTriggerFor","click"],[1,"fa-solid","fa-pen-to-square"],["mat-header-row",""],["mat-row",""]],template:function(s,d){s&1&&(A(0,"div",0)(1,"input",1),kn("ngModelChange",function(_){return An(d.searchValue,_)||(d.searchValue=_),_}),k(),A(2,"span",2)(3,"i",3),ct("click",function(){return d.filterData()}),k(),A(4,"button",4),ct("click",function(){return d.onAddClick()}),V(5," Adauga "),k()()(),A(6,"div",5)(7,"div",6)(8,"input",7),kn("ngModelChange",function(_){return An(d.selectedFilterOption,_)||(d.selectedFilterOption=_),_}),k(),A(9,"label",8),V(10,"Nume"),k()(),A(11,"div",6)(12,"input",9),kn("ngModelChange",function(_){return An(d.selectedFilterOption,_)||(d.selectedFilterOption=_),_}),k(),A(13,"label",10),V(14,"Gen"),k()(),mt(15,Elt,3,0,"div",11),k(),A(16,"table",12),mt(17,Tlt,3,1,"ng-container",13),rr(18,14),mt(19,Ilt,2,0,"th",15)(20,Alt,3,1,"td",16),or(),mt(21,klt,1,0,"tr",17)(22,Rlt,1,0,"tr",18),k(),A(23,"mat-paginator",19),ct("page",function(_){return d.onPageChange(_)}),k(),A(24,"mat-menu",null,20)(26,"button",21),ct("click",function(){return d.onEditClick()}),V(27," Modifica "),k(),A(28,"button",21),ct("click",function(){return d.onDeleteClick()}),V(29," Sterge "),k()()),s&2&&(N(),In("ngModel",d.searchValue),N(7),In("ngModel",d.selectedFilterOption),N(4),In("ngModel",d.selectedFilterOption),N(3),Z("ngIf",d.shouldDisplayRemoveFilterButton),N(),Z("dataSource",d.dataSource),N(),Z("ngForOf",d.displayedColumns),N(4),Z("matHeaderRowDef",d.displayedColumns.concat("actions")),N(),Z("matRowDefColumns",d.displayedColumns.concat("actions")),N(),Z("length",d.itemsCount)("pageSize",d.pageSize)("pageIndex",d.pageIndex)("pageSizeOptions",Nr(12,Plt)))},dependencies:[Yi,en,Dc,ji,jo,Qs,Fa,ka,Pa,Oa,Na,La,Va,yl,ja,Ba,za,na,zd,Aa,Ii,qe,Fd,Ra,BV],styles:["th[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.search-button[_ngcontent-%COMP%]{margin-left:5px;padding:.5rem 1rem;border-radius:.3rem}.search-button[_ngcontent-%COMP%]:hover{cursor:pointer;box-shadow:2px 4px 5px #0006}.input-group-text[_ngcontent-%COMP%]{padding-left:0}"]});let a=r;return a})();var Olt=["mat-calendar-body",""];function Flt(a,r){if(a&1&&(A(0,"tr",0)(1,"td",2),V(2),k()()),a&2){let l=vt();N(),Sc("padding-top",l._cellPadding)("padding-bottom",l._cellPadding),oi("colspan",l.numCols),N(),ae(" ",l.label," ")}}function Llt(a,r){if(a&1&&(A(0,"td",2),V(1),k()),a&2){let l=vt(2);Sc("padding-top",l._cellPadding)("padding-bottom",l._cellPadding),oi("colspan",l._firstRowOffset),N(),ae(" ",l._firstRowOffset>=l.labelMinRequiredCells?l.label:""," ")}}function zlt(a,r){if(a&1){let l=Ce();A(0,"td",5)(1,"button",6),ct("click",function(s){let m=te(l).$implicit,_=vt(2);return ee(_._cellClicked(m,s))})("focus",function(s){let m=te(l).$implicit,_=vt(2);return ee(_._emitActiveDateChange(m,s))}),A(2,"span",7),V(3),k(),dt(4,"span",8),k()()}if(a&2){let l=r.$implicit,n=r.$index,s=vt().$index,d=vt();Sc("width",d._cellWidth)("padding-top",d._cellPadding)("padding-bottom",d._cellPadding),oi("data-mat-row",s)("data-mat-col",n),N(),ei("mat-calendar-body-disabled",!l.enabled)("mat-calendar-body-active",d._isActiveCell(s,n))("mat-calendar-body-range-start",d._isRangeStart(l.compareValue))("mat-calendar-body-range-end",d._isRangeEnd(l.compareValue))("mat-calendar-body-in-range",d._isInRange(l.compareValue))("mat-calendar-body-comparison-bridge-start",d._isComparisonBridgeStart(l.compareValue,s,n))("mat-calendar-body-comparison-bridge-end",d._isComparisonBridgeEnd(l.compareValue,s,n))("mat-calendar-body-comparison-start",d._isComparisonStart(l.compareValue))("mat-calendar-body-comparison-end",d._isComparisonEnd(l.compareValue))("mat-calendar-body-in-comparison-range",d._isInComparisonRange(l.compareValue))("mat-calendar-body-preview-start",d._isPreviewStart(l.compareValue))("mat-calendar-body-preview-end",d._isPreviewEnd(l.compareValue))("mat-calendar-body-in-preview",d._isInPreview(l.compareValue)),Z("ngClass",l.cssClasses)("tabindex",d._isActiveCell(s,n)?0:-1),oi("aria-label",l.ariaLabel)("aria-disabled",!l.enabled||null)("aria-pressed",d._isSelected(l.compareValue))("aria-current",d.todayValue===l.compareValue?"date":null)("aria-describedby",d._getDescribedby(l.compareValue)),N(),ei("mat-calendar-body-selected",d._isSelected(l.compareValue))("mat-calendar-body-comparison-identical",d._isComparisonIdentical(l.compareValue))("mat-calendar-body-today",d.todayValue===l.compareValue),N(),ae(" ",l.displayValue," ")}}function Nlt(a,r){if(a&1&&(A(0,"tr",3),mt(1,Llt,2,6,"td",4),Xh(2,zlt,5,48,"td",9,Zh),k()),a&2){let l=r.$implicit,n=r.$index,s=vt();N(),$i(1,n===0&&s._firstRowOffset?1:-1),N(),Kh(l)}}function Blt(a,r){if(a&1&&(A(0,"th",4)(1,"span",5),V(2),k(),A(3,"span",6),V(4),k()()),a&2){let l=r.$implicit;N(2),De(l.long),N(2),De(l.narrow)}}var Vlt=["*"];function jlt(a,r){}function Ult(a,r){if(a&1){let l=Ce();A(0,"mat-month-view",2),kn("activeDateChange",function(s){te(l);let d=vt();return An(d.activeDate,s)||(d.activeDate=s),ee(s)}),ct("_userSelection",function(s){te(l);let d=vt();return ee(d._dateSelected(s))})("dragStarted",function(s){te(l);let d=vt();return ee(d._dragStarted(s))})("dragEnded",function(s){te(l);let d=vt();return ee(d._dragEnded(s))}),k()}if(a&2){let l=vt();In("activeDate",l.activeDate),Z("selected",l.selected)("dateFilter",l.dateFilter)("maxDate",l.maxDate)("minDate",l.minDate)("dateClass",l.dateClass)("comparisonStart",l.comparisonStart)("comparisonEnd",l.comparisonEnd)("startDateAccessibleName",l.startDateAccessibleName)("endDateAccessibleName",l.endDateAccessibleName)("activeDrag",l._activeDrag)}}function Hlt(a,r){if(a&1){let l=Ce();A(0,"mat-year-view",3),kn("activeDateChange",function(s){te(l);let d=vt();return An(d.activeDate,s)||(d.activeDate=s),ee(s)}),ct("monthSelected",function(s){te(l);let d=vt();return ee(d._monthSelectedInYearView(s))})("selectedChange",function(s){te(l);let d=vt();return ee(d._goToDateInView(s,"month"))}),k()}if(a&2){let l=vt();In("activeDate",l.activeDate),Z("selected",l.selected)("dateFilter",l.dateFilter)("maxDate",l.maxDate)("minDate",l.minDate)("dateClass",l.dateClass)}}function Glt(a,r){if(a&1){let l=Ce();A(0,"mat-multi-year-view",4),kn("activeDateChange",function(s){te(l);let d=vt();return An(d.activeDate,s)||(d.activeDate=s),ee(s)}),ct("yearSelected",function(s){te(l);let d=vt();return ee(d._yearSelectedInMultiYearView(s))})("selectedChange",function(s){te(l);let d=vt();return ee(d._goToDateInView(s,"year"))}),k()}if(a&2){let l=vt();In("activeDate",l.activeDate),Z("selected",l.selected)("dateFilter",l.dateFilter)("maxDate",l.maxDate)("minDate",l.minDate)("dateClass",l.dateClass)}}function qlt(a,r){}var Wlt=["button"];function $lt(a,r){a&1&&(As(),A(0,"svg",3),dt(1,"path",4),k())}var Ylt=[[["","matDatepickerToggleIcon",""]]],Zlt=["[matDatepickerToggleIcon]"];var Lx=(()=>{let r=class r{constructor(){this.changes=new pe,this.calendarLabel="Calendar",this.openCalendarLabel="Open calendar",this.closeCalendarLabel="Close calendar",this.prevMonthLabel="Previous month",this.nextMonthLabel="Next month",this.prevYearLabel="Previous year",this.nextYearLabel="Next year",this.prevMultiYearLabel="Previous 24 years",this.nextMultiYearLabel="Next 24 years",this.switchToMonthViewLabel="Choose date",this.switchToMultiYearViewLabel="Choose month and year",this.startDateLabel="Start date",this.endDateLabel="End date"}formatYearRange(n,s){return`${n} \u2013 ${s}`}formatYearRangeLabel(n,s){return`${n} to ${s}`}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),Zg=class{constructor(r,l,n,s,d={},m=r,_){this.value=r,this.displayValue=l,this.ariaLabel=n,this.enabled=s,this.cssClasses=d,this.compareValue=m,this.rawValue=_}},Xlt=1,jV=es({passive:!1,capture:!0}),jd=es({passive:!0,capture:!0}),Fx=es({passive:!0}),np=(()=>{let r=class r{ngAfterViewChecked(){this._focusActiveCellAfterViewChecked&&(this._focusActiveCell(),this._focusActiveCellAfterViewChecked=!1)}constructor(n,s){this._elementRef=n,this._ngZone=s,this._platform=oe(pn),this._focusActiveCellAfterViewChecked=!1,this.numCols=7,this.activeCell=0,this.isRange=!1,this.cellAspectRatio=1,this.previewStart=null,this.previewEnd=null,this.selectedValueChange=new ye,this.previewChange=new ye,this.activeDateChange=new ye,this.dragStarted=new ye,this.dragEnded=new ye,this._didDragSinceMouseDown=!1,this._enterHandler=d=>{if(this._skipNextFocus&&d.type==="focus"){this._skipNextFocus=!1;return}if(d.target&&this.isRange){let m=this._getCellFromElement(d.target);m&&this._ngZone.run(()=>this.previewChange.emit({value:m.enabled?m:null,event:d}))}},this._touchmoveHandler=d=>{if(!this.isRange)return;let m=UV(d),_=m?this._getCellFromElement(m):null;m!==d.target&&(this._didDragSinceMouseDown=!0),gT(d.target)&&d.preventDefault(),this._ngZone.run(()=>this.previewChange.emit({value:_?.enabled?_:null,event:d}))},this._leaveHandler=d=>{this.previewEnd!==null&&this.isRange&&(d.type!=="blur"&&(this._didDragSinceMouseDown=!0),d.target&&this._getCellFromElement(d.target)&&!(d.relatedTarget&&this._getCellFromElement(d.relatedTarget))&&this._ngZone.run(()=>this.previewChange.emit({value:null,event:d})))},this._mousedownHandler=d=>{if(!this.isRange)return;this._didDragSinceMouseDown=!1;let m=d.target&&this._getCellFromElement(d.target);!m||!this._isInRange(m.compareValue)||this._ngZone.run(()=>{this.dragStarted.emit({value:m.rawValue,event:d})})},this._mouseupHandler=d=>{if(!this.isRange)return;let m=gT(d.target);if(!m){this._ngZone.run(()=>{this.dragEnded.emit({value:null,event:d})});return}m.closest(".mat-calendar-body")===this._elementRef.nativeElement&&this._ngZone.run(()=>{let _=this._getCellFromElement(m);this.dragEnded.emit({value:_?.rawValue??null,event:d})})},this._touchendHandler=d=>{let m=UV(d);m&&this._mouseupHandler({target:m})},this._id=`mat-calendar-body-${Xlt++}`,this._startDateLabelId=`${this._id}-start-date`,this._endDateLabelId=`${this._id}-end-date`,s.runOutsideAngular(()=>{let d=n.nativeElement;d.addEventListener("touchmove",this._touchmoveHandler,jV),d.addEventListener("mouseenter",this._enterHandler,jd),d.addEventListener("focus",this._enterHandler,jd),d.addEventListener("mouseleave",this._leaveHandler,jd),d.addEventListener("blur",this._leaveHandler,jd),d.addEventListener("mousedown",this._mousedownHandler,Fx),d.addEventListener("touchstart",this._mousedownHandler,Fx),this._platform.isBrowser&&(window.addEventListener("mouseup",this._mouseupHandler),window.addEventListener("touchend",this._touchendHandler))})}_cellClicked(n,s){this._didDragSinceMouseDown||n.enabled&&this.selectedValueChange.emit({value:n.value,event:s})}_emitActiveDateChange(n,s){n.enabled&&this.activeDateChange.emit({value:n.value,event:s})}_isSelected(n){return this.startValue===n||this.endValue===n}ngOnChanges(n){let s=n.numCols,{rows:d,numCols:m}=this;(n.rows||s)&&(this._firstRowOffset=d&&d.length&&d[0].length?m-d[0].length:0),(n.cellAspectRatio||s||!this._cellPadding)&&(this._cellPadding=`${50*this.cellAspectRatio/m}%`),(s||!this._cellWidth)&&(this._cellWidth=`${100/m}%`)}ngOnDestroy(){let n=this._elementRef.nativeElement;n.removeEventListener("touchmove",this._touchmoveHandler,jV),n.removeEventListener("mouseenter",this._enterHandler,jd),n.removeEventListener("focus",this._enterHandler,jd),n.removeEventListener("mouseleave",this._leaveHandler,jd),n.removeEventListener("blur",this._leaveHandler,jd),n.removeEventListener("mousedown",this._mousedownHandler,Fx),n.removeEventListener("touchstart",this._mousedownHandler,Fx),this._platform.isBrowser&&(window.removeEventListener("mouseup",this._mouseupHandler),window.removeEventListener("touchend",this._touchendHandler))}_isActiveCell(n,s){let d=n*this.numCols+s;return n&&(d-=this._firstRowOffset),d==this.activeCell}_focusActiveCell(n=!0){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(Ji(1)).subscribe(()=>{setTimeout(()=>{let s=this._elementRef.nativeElement.querySelector(".mat-calendar-body-active");s&&(n||(this._skipNextFocus=!0),s.focus())})})})}_scheduleFocusActiveCellAfterViewChecked(){this._focusActiveCellAfterViewChecked=!0}_isRangeStart(n){return _T(n,this.startValue,this.endValue)}_isRangeEnd(n){return vT(n,this.startValue,this.endValue)}_isInRange(n){return yT(n,this.startValue,this.endValue,this.isRange)}_isComparisonStart(n){return _T(n,this.comparisonStart,this.comparisonEnd)}_isComparisonBridgeStart(n,s,d){if(!this._isComparisonStart(n)||this._isRangeStart(n)||!this._isInRange(n))return!1;let m=this.rows[s][d-1];if(!m){let _=this.rows[s-1];m=_&&_[_.length-1]}return m&&!this._isRangeEnd(m.compareValue)}_isComparisonBridgeEnd(n,s,d){if(!this._isComparisonEnd(n)||this._isRangeEnd(n)||!this._isInRange(n))return!1;let m=this.rows[s][d+1];if(!m){let _=this.rows[s+1];m=_&&_[0]}return m&&!this._isRangeStart(m.compareValue)}_isComparisonEnd(n){return vT(n,this.comparisonStart,this.comparisonEnd)}_isInComparisonRange(n){return yT(n,this.comparisonStart,this.comparisonEnd,this.isRange)}_isComparisonIdentical(n){return this.comparisonStart===this.comparisonEnd&&n===this.comparisonStart}_isPreviewStart(n){return _T(n,this.previewStart,this.previewEnd)}_isPreviewEnd(n){return vT(n,this.previewStart,this.previewEnd)}_isInPreview(n){return yT(n,this.previewStart,this.previewEnd,this.isRange)}_getDescribedby(n){return this.isRange?this.startValue===n&&this.endValue===n?`${this._startDateLabelId} ${this._endDateLabelId}`:this.startValue===n?this._startDateLabelId:this.endValue===n?this._endDateLabelId:null:null}_getCellFromElement(n){let s=gT(n);if(s){let d=s.getAttribute("data-mat-row"),m=s.getAttribute("data-mat-col");if(d&&m)return this.rows[parseInt(d)][parseInt(m)]}return null}};r.\u0275fac=function(s){return new(s||r)(B(Se),B(ze))},r.\u0275cmp=Et({type:r,selectors:[["","mat-calendar-body",""]],hostAttrs:[1,"mat-calendar-body"],inputs:{label:"label",rows:"rows",todayValue:"todayValue",startValue:"startValue",endValue:"endValue",labelMinRequiredCells:"labelMinRequiredCells",numCols:"numCols",activeCell:"activeCell",isRange:"isRange",cellAspectRatio:"cellAspectRatio",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",previewStart:"previewStart",previewEnd:"previewEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName"},outputs:{selectedValueChange:"selectedValueChange",previewChange:"previewChange",activeDateChange:"activeDateChange",dragStarted:"dragStarted",dragEnded:"dragEnded"},exportAs:["matCalendarBody"],standalone:!0,features:[qn,At],attrs:Olt,decls:7,vars:5,consts:[["aria-hidden","true"],[1,"mat-calendar-body-hidden-label",3,"id"],[1,"mat-calendar-body-label"],["role","row"],["class","mat-calendar-body-label",3,"paddingTop","paddingBottom"],["role","gridcell",1,"mat-calendar-body-cell-container"],["type","button",1,"mat-calendar-body-cell",3,"ngClass","tabindex","click","focus"],[1,"mat-calendar-body-cell-content","mat-focus-indicator"],["aria-hidden","true",1,"mat-calendar-body-cell-preview"],["role","gridcell","class","mat-calendar-body-cell-container",3,"width","paddingTop","paddingBottom"]],template:function(s,d){s&1&&(mt(0,Flt,3,6,"tr",0),Xh(1,Nlt,4,1,"tr",3,Zh),A(3,"label",1),V(4),k(),A(5,"label",1),V(6),k()),s&2&&($i(0,d._firstRowOffset<d.labelMinRequiredCells?0:-1),N(),Kh(d.rows),N(2),Z("id",d._startDateLabelId),N(),ae(" ",d.startDateAccessibleName,`
`),N(),Z("id",d._endDateLabelId),N(),ae(" ",d.endDateAccessibleName,`
`))},dependencies:[Zo],styles:['.mat-calendar-body{min-width:224px}.mat-calendar-body-today:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){border-color:var(--mat-datepicker-calendar-date-today-outline-color)}.mat-calendar-body-label{height:0;line-height:0;text-align:start;padding-left:4.7142857143%;padding-right:4.7142857143%;font-size:var(--mat-datepicker-calendar-body-label-text-size);font-weight:var(--mat-datepicker-calendar-body-label-text-weight);color:var(--mat-datepicker-calendar-body-label-text-color)}.mat-calendar-body-hidden-label{display:none}.mat-calendar-body-cell-container{position:relative;height:0;line-height:0}.mat-calendar-body-cell{-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0);position:absolute;top:0;left:0;width:100%;height:100%;background:none;text-align:center;outline:none;font-family:inherit;margin:0}.mat-calendar-body-cell::-moz-focus-inner{border:0}.mat-calendar-body-cell::before,.mat-calendar-body-cell::after,.mat-calendar-body-cell-preview{content:"";position:absolute;top:5%;left:0;z-index:0;box-sizing:border-box;display:block;height:90%;width:100%}.mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-start::after,.mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,.mat-calendar-body-comparison-start::after,.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:5%;width:95%;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,[dir=rtl] .mat-calendar-body-comparison-start::after,[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:0;border-radius:0;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,.mat-calendar-body-comparison-end::after,.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}[dir=rtl] .mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,[dir=rtl] .mat-calendar-body-comparison-end::after,[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{left:5%;border-radius:0;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-comparison-bridge-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-bridge-end.mat-calendar-body-range-start::after{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end.mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-end.mat-calendar-body-range-start::after{width:90%}.mat-calendar-body-in-preview{color:var(--mat-datepicker-calendar-date-preview-state-outline-color)}.mat-calendar-body-in-preview .mat-calendar-body-cell-preview{border-top:dashed 1px;border-bottom:dashed 1px}.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:dashed 1px}[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:0;border-right:dashed 1px}.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:dashed 1px}[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:0;border-left:dashed 1px}.mat-calendar-body-disabled{cursor:default}.mat-calendar-body-disabled>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){color:var(--mat-datepicker-calendar-date-disabled-state-text-color)}.mat-calendar-body-disabled>.mat-calendar-body-today:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){border-color:var(--mat-datepicker-calendar-date-today-disabled-state-outline-color)}.cdk-high-contrast-active .mat-calendar-body-disabled{opacity:.5}.mat-calendar-body-cell-content{top:5%;left:5%;z-index:1;display:flex;align-items:center;justify-content:center;box-sizing:border-box;width:90%;height:90%;line-height:1;border-width:1px;border-style:solid;border-radius:999px;color:var(--mat-datepicker-calendar-date-text-color);border-color:var(--mat-datepicker-calendar-date-outline-color)}.mat-calendar-body-cell-content.mat-focus-indicator{position:absolute}.cdk-high-contrast-active .mat-calendar-body-cell-content{border:none}.cdk-keyboard-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical),.cdk-program-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){background-color:var(--mat-datepicker-calendar-date-focus-state-background-color)}@media(hover: hover){.mat-calendar-body-cell:not(.mat-calendar-body-disabled):hover>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){background-color:var(--mat-datepicker-calendar-date-hover-state-background-color)}}.mat-calendar-body-selected{background-color:var(--mat-datepicker-calendar-date-selected-state-background-color);color:var(--mat-datepicker-calendar-date-selected-state-text-color)}.mat-calendar-body-disabled>.mat-calendar-body-selected{background-color:var(--mat-datepicker-calendar-date-selected-disabled-state-background-color)}.mat-calendar-body-selected.mat-calendar-body-today{box-shadow:inset 0 0 0 1px var(--mat-datepicker-calendar-date-today-selected-state-outline-color)}.mat-calendar-body-in-range::before{background:var(--mat-datepicker-calendar-date-in-range-state-background-color)}.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range::before{background:var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color)}.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range::before{background:var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color)}.mat-calendar-body-comparison-bridge-start::before,[dir=rtl] .mat-calendar-body-comparison-bridge-end::before{background:linear-gradient(to right, var(--mat-datepicker-calendar-date-in-range-state-background-color) 50%, var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color) 50%)}.mat-calendar-body-comparison-bridge-end::before,[dir=rtl] .mat-calendar-body-comparison-bridge-start::before{background:linear-gradient(to left, var(--mat-datepicker-calendar-date-in-range-state-background-color) 50%, var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color) 50%)}.mat-calendar-body-in-range>.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range.mat-calendar-body-in-range::after{background:var(--mat-datepicker-calendar-date-in-overlap-range-state-background-color)}.mat-calendar-body-comparison-identical.mat-calendar-body-selected,.mat-calendar-body-in-comparison-range>.mat-calendar-body-selected{background:var(--mat-datepicker-calendar-date-in-overlap-range-selected-state-background-color)}.cdk-high-contrast-active .mat-datepicker-popup:not(:empty),.cdk-high-contrast-active .mat-calendar-body-cell:not(.mat-calendar-body-in-range) .mat-calendar-body-selected{outline:solid 1px}.cdk-high-contrast-active .mat-calendar-body-today{outline:dotted 1px}.cdk-high-contrast-active .mat-calendar-body-cell::before,.cdk-high-contrast-active .mat-calendar-body-cell::after,.cdk-high-contrast-active .mat-calendar-body-selected{background:none}.cdk-high-contrast-active .mat-calendar-body-in-range::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-start::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-end::before{border-top:solid 1px;border-bottom:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:0;border-right:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:0;border-left:solid 1px}.cdk-high-contrast-active .mat-calendar-body-in-comparison-range::before{border-top:dashed 1px;border-bottom:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:0;border-right:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:0;border-left:dashed 1px}'],encapsulation:2,changeDetection:0});let a=r;return a})();function fT(a){return a?.nodeName==="TD"}function gT(a){let r;return fT(a)?r=a:fT(a.parentNode)?r=a.parentNode:fT(a.parentNode?.parentNode)&&(r=a.parentNode.parentNode),r?.getAttribute("data-mat-row")!=null?r:null}function _T(a,r,l){return l!==null&&r!==l&&a<l&&a===r}function vT(a,r,l){return r!==null&&r!==l&&a>=r&&a===l}function yT(a,r,l,n){return n&&r!==null&&l!==null&&r!==l&&a>=r&&a<=l}function UV(a){let r=a.changedTouches[0];return document.elementFromPoint(r.clientX,r.clientY)}var qa=class{constructor(r,l){this.start=r,this.end=l}},Xg=(()=>{let r=class r{constructor(n,s){this.selection=n,this._adapter=s,this._selectionChanged=new pe,this.selectionChanged=this._selectionChanged,this.selection=n}updateSelection(n,s){let d=this.selection;this.selection=n,this._selectionChanged.next({selection:n,source:s,oldValue:d})}ngOnDestroy(){this._selectionChanged.complete()}_isValidDateInstance(n){return this._adapter.isDateInstance(n)&&this._adapter.isValid(n)}};r.\u0275fac=function(s){bu()},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})(),Klt=(()=>{let r=class r extends Xg{constructor(n){super(null,n)}add(n){super.updateSelection(n,this)}isValid(){return this.selection!=null&&this._isValidDateInstance(this.selection)}isComplete(){return this.selection!=null}clone(){let n=new r(this._adapter);return n.updateSelection(this.selection,this),n}};r.\u0275fac=function(s){return new(s||r)(ht(Ko))},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})();function Qlt(a,r){return a||new Klt(r)}var YV={provide:Xg,deps:[[new _u,new Gh,Xg],Ko],useFactory:Qlt};var ZV=new we("MAT_DATE_RANGE_SELECTION_STRATEGY");var bT=7,HV=(()=>{let r=class r{get activeDate(){return this._activeDate}set activeDate(n){let s=this._activeDate,d=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(d,this.minDate,this.maxDate),this._hasSameMonthAndYear(s,this._activeDate)||this._init()}get selected(){return this._selected}set selected(n){n instanceof qa?this._selected=n:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n)),this._setRanges(this._selected)}get minDate(){return this._minDate}set minDate(n){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get maxDate(){return this._maxDate}set maxDate(n){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}constructor(n,s,d,m,_){this._changeDetectorRef=n,this._dateFormats=s,this._dateAdapter=d,this._dir=m,this._rangeStrategy=_,this._rerenderSubscription=nr.EMPTY,this.activeDrag=null,this.selectedChange=new ye,this._userSelection=new ye,this.dragStarted=new ye,this.dragEnded=new ye,this.activeDateChange=new ye,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(co(null)).subscribe(()=>this._init())}ngOnChanges(n){let s=n.comparisonStart||n.comparisonEnd;s&&!s.firstChange&&this._setRanges(this.selected),n.activeDrag&&!this.activeDrag&&this._clearPreview()}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_dateSelected(n){let s=n.value,d=this._getDateFromDayOfMonth(s),m,_;this._selected instanceof qa?(m=this._getDateInCurrentMonth(this._selected.start),_=this._getDateInCurrentMonth(this._selected.end)):m=_=this._getDateInCurrentMonth(this._selected),(m!==s||_!==s)&&this.selectedChange.emit(d),this._userSelection.emit({value:d,event:n.event}),this._clearPreview(),this._changeDetectorRef.markForCheck()}_updateActiveDate(n){let s=n.value,d=this._activeDate;this.activeDate=this._getDateFromDayOfMonth(s),this._dateAdapter.compareDate(d,this.activeDate)&&this.activeDateChange.emit(this._activeDate)}_handleCalendarBodyKeydown(n){let s=this._activeDate,d=this._isRtl();switch(n.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,d?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,d?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-7);break;case 40:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,7);break;case 36:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1-this._dateAdapter.getDate(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,this._dateAdapter.getNumDaysInMonth(this._activeDate)-this._dateAdapter.getDate(this._activeDate));break;case 33:this.activeDate=n.altKey?this._dateAdapter.addCalendarYears(this._activeDate,-1):this._dateAdapter.addCalendarMonths(this._activeDate,-1);break;case 34:this.activeDate=n.altKey?this._dateAdapter.addCalendarYears(this._activeDate,1):this._dateAdapter.addCalendarMonths(this._activeDate,1);break;case 13:case 32:this._selectionKeyPressed=!0,this._canSelect(this._activeDate)&&n.preventDefault();return;case 27:this._previewEnd!=null&&!Zr(n)&&(this._clearPreview(),this.activeDrag?this.dragEnded.emit({value:null,event:n}):(this.selectedChange.emit(null),this._userSelection.emit({value:null,event:n})),n.preventDefault(),n.stopPropagation());return;default:return}this._dateAdapter.compareDate(s,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),n.preventDefault()}_handleCalendarBodyKeyup(n){(n.keyCode===32||n.keyCode===13)&&(this._selectionKeyPressed&&this._canSelect(this._activeDate)&&this._dateSelected({value:this._dateAdapter.getDate(this._activeDate),event:n}),this._selectionKeyPressed=!1)}_init(){this._setRanges(this.selected),this._todayDate=this._getCellCompareValue(this._dateAdapter.today()),this._monthLabel=this._dateFormats.display.monthLabel?this._dateAdapter.format(this.activeDate,this._dateFormats.display.monthLabel):this._dateAdapter.getMonthNames("short")[this._dateAdapter.getMonth(this.activeDate)].toLocaleUpperCase();let n=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),1);this._firstWeekOffset=(bT+this._dateAdapter.getDayOfWeek(n)-this._dateAdapter.getFirstDayOfWeek())%bT,this._initWeekdays(),this._createWeekCells(),this._changeDetectorRef.markForCheck()}_focusActiveCell(n){this._matCalendarBody._focusActiveCell(n)}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_previewChanged({event:n,value:s}){if(this._rangeStrategy){let d=s?s.rawValue:null,m=this._rangeStrategy.createPreview(d,this.selected,n);if(this._previewStart=this._getCellCompareValue(m.start),this._previewEnd=this._getCellCompareValue(m.end),this.activeDrag&&d){let _=this._rangeStrategy.createDrag?.(this.activeDrag.value,this.selected,d,n);_&&(this._previewStart=this._getCellCompareValue(_.start),this._previewEnd=this._getCellCompareValue(_.end))}this._changeDetectorRef.detectChanges()}}_dragEnded(n){if(this.activeDrag)if(n.value){let s=this._rangeStrategy?.createDrag?.(this.activeDrag.value,this.selected,n.value,n.event);this.dragEnded.emit({value:s??null,event:n.event})}else this.dragEnded.emit({value:null,event:n.event})}_getDateFromDayOfMonth(n){return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),n)}_initWeekdays(){let n=this._dateAdapter.getFirstDayOfWeek(),s=this._dateAdapter.getDayOfWeekNames("narrow"),m=this._dateAdapter.getDayOfWeekNames("long").map((_,w)=>({long:_,narrow:s[w]}));this._weekdays=m.slice(n).concat(m.slice(0,n))}_createWeekCells(){let n=this._dateAdapter.getNumDaysInMonth(this.activeDate),s=this._dateAdapter.getDateNames();this._weeks=[[]];for(let d=0,m=this._firstWeekOffset;d<n;d++,m++){m==bT&&(this._weeks.push([]),m=0);let _=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),d+1),w=this._shouldEnableDate(_),S=this._dateAdapter.format(_,this._dateFormats.display.dateA11yLabel),T=this.dateClass?this.dateClass(_,"month"):void 0;this._weeks[this._weeks.length-1].push(new Zg(d+1,s[d],S,w,T,this._getCellCompareValue(_),_))}}_shouldEnableDate(n){return!!n&&(!this.minDate||this._dateAdapter.compareDate(n,this.minDate)>=0)&&(!this.maxDate||this._dateAdapter.compareDate(n,this.maxDate)<=0)&&(!this.dateFilter||this.dateFilter(n))}_getDateInCurrentMonth(n){return n&&this._hasSameMonthAndYear(n,this.activeDate)?this._dateAdapter.getDate(n):null}_hasSameMonthAndYear(n,s){return!!(n&&s&&this._dateAdapter.getMonth(n)==this._dateAdapter.getMonth(s)&&this._dateAdapter.getYear(n)==this._dateAdapter.getYear(s))}_getCellCompareValue(n){if(n){let s=this._dateAdapter.getYear(n),d=this._dateAdapter.getMonth(n),m=this._dateAdapter.getDate(n);return new Date(s,d,m).getTime()}return null}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setRanges(n){n instanceof qa?(this._rangeStart=this._getCellCompareValue(n.start),this._rangeEnd=this._getCellCompareValue(n.end),this._isRange=!0):(this._rangeStart=this._rangeEnd=this._getCellCompareValue(n),this._isRange=!1),this._comparisonRangeStart=this._getCellCompareValue(this.comparisonStart),this._comparisonRangeEnd=this._getCellCompareValue(this.comparisonEnd)}_canSelect(n){return!this.dateFilter||this.dateFilter(n)}_clearPreview(){this._previewStart=this._previewEnd=null}};r.\u0275fac=function(s){return new(s||r)(B(Wi),B(Cd,8),B(Ko,8),B(To,8),B(ZV,8))},r.\u0275cmp=Et({type:r,selectors:[["mat-month-view"]],viewQuery:function(s,d){if(s&1&&Ge(np,5),s&2){let m;ce(m=de())&&(d._matCalendarBody=m.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName",activeDrag:"activeDrag"},outputs:{selectedChange:"selectedChange",_userSelection:"_userSelection",dragStarted:"dragStarted",dragEnded:"dragEnded",activeDateChange:"activeDateChange"},exportAs:["matMonthView"],standalone:!0,features:[qn,At],decls:8,vars:14,consts:[["role","grid",1,"mat-calendar-table"],[1,"mat-calendar-table-header"],["aria-hidden","true","colspan","7",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"label","rows","todayValue","startValue","endValue","comparisonStart","comparisonEnd","previewStart","previewEnd","isRange","labelMinRequiredCells","activeCell","startDateAccessibleName","endDateAccessibleName","selectedValueChange","activeDateChange","previewChange","dragStarted","dragEnded","keyup","keydown"],["scope","col"],[1,"cdk-visually-hidden"],["aria-hidden","true"]],template:function(s,d){s&1&&(A(0,"table",0)(1,"thead",1)(2,"tr"),Xh(3,Blt,5,2,"th",4,Zh),k(),A(5,"tr"),dt(6,"th",2),k()(),A(7,"tbody",3),ct("selectedValueChange",function(_){return d._dateSelected(_)})("activeDateChange",function(_){return d._updateActiveDate(_)})("previewChange",function(_){return d._previewChanged(_)})("dragStarted",function(_){return d.dragStarted.emit(_)})("dragEnded",function(_){return d._dragEnded(_)})("keyup",function(_){return d._handleCalendarBodyKeyup(_)})("keydown",function(_){return d._handleCalendarBodyKeydown(_)}),k()()),s&2&&(N(3),Kh(d._weekdays),N(4),Z("label",d._monthLabel)("rows",d._weeks)("todayValue",d._todayDate)("startValue",d._rangeStart)("endValue",d._rangeEnd)("comparisonStart",d._comparisonRangeStart)("comparisonEnd",d._comparisonRangeEnd)("previewStart",d._previewStart)("previewEnd",d._previewEnd)("isRange",d._isRange)("labelMinRequiredCells",3)("activeCell",d._dateAdapter.getDate(d.activeDate)-1)("startDateAccessibleName",d.startDateAccessibleName)("endDateAccessibleName",d.endDateAccessibleName))},dependencies:[np],encapsulation:2,changeDetection:0});let a=r;return a})(),ra=24,xT=4,GV=(()=>{let r=class r{get activeDate(){return this._activeDate}set activeDate(n){let s=this._activeDate,d=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(d,this.minDate,this.maxDate),XV(this._dateAdapter,s,this._activeDate,this.minDate,this.maxDate)||this._init()}get selected(){return this._selected}set selected(n){n instanceof qa?this._selected=n:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n)),this._setSelectedYear(n)}get minDate(){return this._minDate}set minDate(n){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get maxDate(){return this._maxDate}set maxDate(n){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}constructor(n,s,d){this._changeDetectorRef=n,this._dateAdapter=s,this._dir=d,this._rerenderSubscription=nr.EMPTY,this.selectedChange=new ye,this.yearSelected=new ye,this.activeDateChange=new ye,this._dateAdapter,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(co(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_init(){this._todayYear=this._dateAdapter.getYear(this._dateAdapter.today());let s=this._dateAdapter.getYear(this._activeDate)-Yg(this._dateAdapter,this.activeDate,this.minDate,this.maxDate);this._years=[];for(let d=0,m=[];d<ra;d++)m.push(s+d),m.length==xT&&(this._years.push(m.map(_=>this._createCellForYear(_))),m=[]);this._changeDetectorRef.markForCheck()}_yearSelected(n){let s=n.value,d=this._dateAdapter.createDate(s,0,1),m=this._getDateFromYear(s);this.yearSelected.emit(d),this.selectedChange.emit(m)}_updateActiveDate(n){let s=n.value,d=this._activeDate;this.activeDate=this._getDateFromYear(s),this._dateAdapter.compareDate(d,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(n){let s=this._activeDate,d=this._isRtl();switch(n.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,d?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,d?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-xT);break;case 40:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,xT);break;case 36:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-Yg(this._dateAdapter,this.activeDate,this.minDate,this.maxDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,ra-Yg(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)-1);break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,n.altKey?-ra*10:-ra);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,n.altKey?ra*10:ra);break;case 13:case 32:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(s,this.activeDate)&&this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked(),n.preventDefault()}_handleCalendarBodyKeyup(n){(n.keyCode===32||n.keyCode===13)&&(this._selectionKeyPressed&&this._yearSelected({value:this._dateAdapter.getYear(this._activeDate),event:n}),this._selectionKeyPressed=!1)}_getActiveCell(){return Yg(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getDateFromYear(n){let s=this._dateAdapter.getMonth(this.activeDate),d=this._dateAdapter.getNumDaysInMonth(this._dateAdapter.createDate(n,s,1));return this._dateAdapter.createDate(n,s,Math.min(this._dateAdapter.getDate(this.activeDate),d))}_createCellForYear(n){let s=this._dateAdapter.createDate(n,0,1),d=this._dateAdapter.getYearName(s),m=this.dateClass?this.dateClass(s,"multi-year"):void 0;return new Zg(n,d,d,this._shouldEnableYear(n),m)}_shouldEnableYear(n){if(n==null||this.maxDate&&n>this._dateAdapter.getYear(this.maxDate)||this.minDate&&n<this._dateAdapter.getYear(this.minDate))return!1;if(!this.dateFilter)return!0;let s=this._dateAdapter.createDate(n,0,1);for(let d=s;this._dateAdapter.getYear(d)==n;d=this._dateAdapter.addCalendarDays(d,1))if(this.dateFilter(d))return!0;return!1}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setSelectedYear(n){if(this._selectedYear=null,n instanceof qa){let s=n.start||n.end;s&&(this._selectedYear=this._dateAdapter.getYear(s))}else n&&(this._selectedYear=this._dateAdapter.getYear(n))}};r.\u0275fac=function(s){return new(s||r)(B(Wi),B(Ko,8),B(To,8))},r.\u0275cmp=Et({type:r,selectors:[["mat-multi-year-view"]],viewQuery:function(s,d){if(s&1&&Ge(np,5),s&2){let m;ce(m=de())&&(d._matCalendarBody=m.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",activeDateChange:"activeDateChange"},exportAs:["matMultiYearView"],standalone:!0,features:[At],decls:5,vars:7,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"rows","todayValue","startValue","endValue","numCols","cellAspectRatio","activeCell","selectedValueChange","activeDateChange","keyup","keydown"]],template:function(s,d){s&1&&(A(0,"table",0)(1,"thead",1)(2,"tr"),dt(3,"th",2),k()(),A(4,"tbody",3),ct("selectedValueChange",function(_){return d._yearSelected(_)})("activeDateChange",function(_){return d._updateActiveDate(_)})("keyup",function(_){return d._handleCalendarBodyKeyup(_)})("keydown",function(_){return d._handleCalendarBodyKeydown(_)}),k()()),s&2&&(N(4),Z("rows",d._years)("todayValue",d._todayYear)("startValue",d._selectedYear)("endValue",d._selectedYear)("numCols",4)("cellAspectRatio",4/7)("activeCell",d._getActiveCell()))},dependencies:[np],encapsulation:2,changeDetection:0});let a=r;return a})();function XV(a,r,l,n,s){let d=a.getYear(r),m=a.getYear(l),_=KV(a,n,s);return Math.floor((d-_)/ra)===Math.floor((m-_)/ra)}function Yg(a,r,l,n){let s=a.getYear(r);return Jlt(s-KV(a,l,n),ra)}function KV(a,r,l){let n=0;return l?n=a.getYear(l)-ra+1:r&&(n=a.getYear(r)),n}function Jlt(a,r){return(a%r+r)%r}var qV=(()=>{let r=class r{get activeDate(){return this._activeDate}set activeDate(n){let s=this._activeDate,d=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(d,this.minDate,this.maxDate),this._dateAdapter.getYear(s)!==this._dateAdapter.getYear(this._activeDate)&&this._init()}get selected(){return this._selected}set selected(n){n instanceof qa?this._selected=n:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n)),this._setSelectedMonth(n)}get minDate(){return this._minDate}set minDate(n){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get maxDate(){return this._maxDate}set maxDate(n){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}constructor(n,s,d,m){this._changeDetectorRef=n,this._dateFormats=s,this._dateAdapter=d,this._dir=m,this._rerenderSubscription=nr.EMPTY,this.selectedChange=new ye,this.monthSelected=new ye,this.activeDateChange=new ye,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(co(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_monthSelected(n){let s=n.value,d=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),s,1);this.monthSelected.emit(d);let m=this._getDateFromMonth(s);this.selectedChange.emit(m)}_updateActiveDate(n){let s=n.value,d=this._activeDate;this.activeDate=this._getDateFromMonth(s),this._dateAdapter.compareDate(d,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(n){let s=this._activeDate,d=this._isRtl();switch(n.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,d?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,d?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-4);break;case 40:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,4);break;case 36:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-this._dateAdapter.getMonth(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,11-this._dateAdapter.getMonth(this._activeDate));break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,n.altKey?-10:-1);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,n.altKey?10:1);break;case 13:case 32:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(s,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),n.preventDefault()}_handleCalendarBodyKeyup(n){(n.keyCode===32||n.keyCode===13)&&(this._selectionKeyPressed&&this._monthSelected({value:this._dateAdapter.getMonth(this._activeDate),event:n}),this._selectionKeyPressed=!1)}_init(){this._setSelectedMonth(this.selected),this._todayMonth=this._getMonthInCurrentYear(this._dateAdapter.today()),this._yearLabel=this._dateAdapter.getYearName(this.activeDate);let n=this._dateAdapter.getMonthNames("short");this._months=[[0,1,2,3],[4,5,6,7],[8,9,10,11]].map(s=>s.map(d=>this._createCellForMonth(d,n[d]))),this._changeDetectorRef.markForCheck()}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getMonthInCurrentYear(n){return n&&this._dateAdapter.getYear(n)==this._dateAdapter.getYear(this.activeDate)?this._dateAdapter.getMonth(n):null}_getDateFromMonth(n){let s=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),n,1),d=this._dateAdapter.getNumDaysInMonth(s);return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),n,Math.min(this._dateAdapter.getDate(this.activeDate),d))}_createCellForMonth(n,s){let d=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),n,1),m=this._dateAdapter.format(d,this._dateFormats.display.monthYearA11yLabel),_=this.dateClass?this.dateClass(d,"year"):void 0;return new Zg(n,s.toLocaleUpperCase(),m,this._shouldEnableMonth(n),_)}_shouldEnableMonth(n){let s=this._dateAdapter.getYear(this.activeDate);if(n==null||this._isYearAndMonthAfterMaxDate(s,n)||this._isYearAndMonthBeforeMinDate(s,n))return!1;if(!this.dateFilter)return!0;let d=this._dateAdapter.createDate(s,n,1);for(let m=d;this._dateAdapter.getMonth(m)==n;m=this._dateAdapter.addCalendarDays(m,1))if(this.dateFilter(m))return!0;return!1}_isYearAndMonthAfterMaxDate(n,s){if(this.maxDate){let d=this._dateAdapter.getYear(this.maxDate),m=this._dateAdapter.getMonth(this.maxDate);return n>d||n===d&&s>m}return!1}_isYearAndMonthBeforeMinDate(n,s){if(this.minDate){let d=this._dateAdapter.getYear(this.minDate),m=this._dateAdapter.getMonth(this.minDate);return n<d||n===d&&s<m}return!1}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setSelectedMonth(n){n instanceof qa?this._selectedMonth=this._getMonthInCurrentYear(n.start)||this._getMonthInCurrentYear(n.end):this._selectedMonth=this._getMonthInCurrentYear(n)}};r.\u0275fac=function(s){return new(s||r)(B(Wi),B(Cd,8),B(Ko,8),B(To,8))},r.\u0275cmp=Et({type:r,selectors:[["mat-year-view"]],viewQuery:function(s,d){if(s&1&&Ge(np,5),s&2){let m;ce(m=de())&&(d._matCalendarBody=m.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",monthSelected:"monthSelected",activeDateChange:"activeDateChange"},exportAs:["matYearView"],standalone:!0,features:[At],decls:5,vars:9,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"label","rows","todayValue","startValue","endValue","labelMinRequiredCells","numCols","cellAspectRatio","activeCell","selectedValueChange","activeDateChange","keyup","keydown"]],template:function(s,d){s&1&&(A(0,"table",0)(1,"thead",1)(2,"tr"),dt(3,"th",2),k()(),A(4,"tbody",3),ct("selectedValueChange",function(_){return d._monthSelected(_)})("activeDateChange",function(_){return d._updateActiveDate(_)})("keyup",function(_){return d._handleCalendarBodyKeyup(_)})("keydown",function(_){return d._handleCalendarBodyKeydown(_)}),k()()),s&2&&(N(4),Z("label",d._yearLabel)("rows",d._months)("todayValue",d._todayMonth)("startValue",d._selectedMonth)("endValue",d._selectedMonth)("labelMinRequiredCells",2)("numCols",4)("cellAspectRatio",4/7)("activeCell",d._dateAdapter.getMonth(d.activeDate)))},dependencies:[np],encapsulation:2,changeDetection:0});let a=r;return a})(),tct=1,ect=(()=>{let r=class r{constructor(n,s,d,m,_){this._intl=n,this.calendar=s,this._dateAdapter=d,this._dateFormats=m,this._id=`mat-calendar-header-${tct++}`,this._periodButtonLabelId=`${this._id}-period-label`,this.calendar.stateChanges.subscribe(()=>_.markForCheck())}get periodButtonText(){return this.calendar.currentView=="month"?this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase():this.calendar.currentView=="year"?this._dateAdapter.getYearName(this.calendar.activeDate):this._intl.formatYearRange(...this._formatMinAndMaxYearLabels())}get periodButtonDescription(){return this.calendar.currentView=="month"?this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase():this.calendar.currentView=="year"?this._dateAdapter.getYearName(this.calendar.activeDate):this._intl.formatYearRangeLabel(...this._formatMinAndMaxYearLabels())}get periodButtonLabel(){return this.calendar.currentView=="month"?this._intl.switchToMultiYearViewLabel:this._intl.switchToMonthViewLabel}get prevButtonLabel(){return{month:this._intl.prevMonthLabel,year:this._intl.prevYearLabel,"multi-year":this._intl.prevMultiYearLabel}[this.calendar.currentView]}get nextButtonLabel(){return{month:this._intl.nextMonthLabel,year:this._intl.nextYearLabel,"multi-year":this._intl.nextMultiYearLabel}[this.calendar.currentView]}currentPeriodClicked(){this.calendar.currentView=this.calendar.currentView=="month"?"multi-year":"month"}previousClicked(){this.calendar.activeDate=this.calendar.currentView=="month"?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,-1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,this.calendar.currentView=="year"?-1:-ra)}nextClicked(){this.calendar.activeDate=this.calendar.currentView=="month"?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,this.calendar.currentView=="year"?1:ra)}previousEnabled(){return this.calendar.minDate?!this.calendar.minDate||!this._isSameView(this.calendar.activeDate,this.calendar.minDate):!0}nextEnabled(){return!this.calendar.maxDate||!this._isSameView(this.calendar.activeDate,this.calendar.maxDate)}_isSameView(n,s){return this.calendar.currentView=="month"?this._dateAdapter.getYear(n)==this._dateAdapter.getYear(s)&&this._dateAdapter.getMonth(n)==this._dateAdapter.getMonth(s):this.calendar.currentView=="year"?this._dateAdapter.getYear(n)==this._dateAdapter.getYear(s):XV(this._dateAdapter,n,s,this.calendar.minDate,this.calendar.maxDate)}_formatMinAndMaxYearLabels(){let s=this._dateAdapter.getYear(this.calendar.activeDate)-Yg(this._dateAdapter,this.calendar.activeDate,this.calendar.minDate,this.calendar.maxDate),d=s+ra-1,m=this._dateAdapter.getYearName(this._dateAdapter.createDate(s,0,1)),_=this._dateAdapter.getYearName(this._dateAdapter.createDate(d,0,1));return[m,_]}};r.\u0275fac=function(s){return new(s||r)(B(Lx),B(Vo(()=>wT)),B(Ko,8),B(Cd,8),B(Wi))},r.\u0275cmp=Et({type:r,selectors:[["mat-calendar-header"]],exportAs:["matCalendarHeader"],standalone:!0,features:[At],ngContentSelectors:Vlt,decls:13,vars:11,consts:[[1,"mat-calendar-header"],[1,"mat-calendar-controls"],["mat-button","","type","button","aria-live","polite",1,"mat-calendar-period-button",3,"click"],["aria-hidden","true"],["viewBox","0 0 10 5","focusable","false","aria-hidden","true",1,"mat-calendar-arrow"],["points","0,0 5,5 10,0"],[1,"mat-calendar-spacer"],["mat-icon-button","","type","button",1,"mat-calendar-previous-button",3,"disabled","click"],["mat-icon-button","","type","button",1,"mat-calendar-next-button",3,"disabled","click"],[1,"mat-calendar-hidden-label",3,"id"]],template:function(s,d){s&1&&(Nn(),A(0,"div",0)(1,"div",1)(2,"button",2),ct("click",function(){return d.currentPeriodClicked()}),A(3,"span",3),V(4),k(),As(),A(5,"svg",4),dt(6,"polygon",5),k()(),gu(),dt(7,"div",6),Ti(8),A(9,"button",7),ct("click",function(){return d.previousClicked()}),k(),A(10,"button",8),ct("click",function(){return d.nextClicked()}),k()()(),A(11,"label",9),V(12),k()),s&2&&(N(2),oi("aria-label",d.periodButtonLabel)("aria-describedby",d._periodButtonLabelId),N(2),De(d.periodButtonText),N(),ei("mat-calendar-invert",d.calendar.currentView!=="month"),N(4),Z("disabled",!d.previousEnabled()),oi("aria-label",d.prevButtonLabel),N(),Z("disabled",!d.nextEnabled()),oi("aria-label",d.nextButtonLabel),N(),Z("id",d._periodButtonLabelId),N(),De(d.periodButtonDescription))},dependencies:[Qs,Tc],encapsulation:2,changeDetection:0});let a=r;return a})(),wT=(()=>{let r=class r{get startAt(){return this._startAt}set startAt(n){this._startAt=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get selected(){return this._selected}set selected(n){n instanceof qa?this._selected=n:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get minDate(){return this._minDate}set minDate(n){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get maxDate(){return this._maxDate}set maxDate(n){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get activeDate(){return this._clampedActiveDate}set activeDate(n){this._clampedActiveDate=this._dateAdapter.clampDate(n,this.minDate,this.maxDate),this.stateChanges.next(),this._changeDetectorRef.markForCheck()}get currentView(){return this._currentView}set currentView(n){let s=this._currentView!==n?n:null;this._currentView=n,this._moveFocusOnNextTick=!0,this._changeDetectorRef.markForCheck(),s&&this.viewChanged.emit(s)}constructor(n,s,d,m){this._dateAdapter=s,this._dateFormats=d,this._changeDetectorRef=m,this._moveFocusOnNextTick=!1,this.startView="month",this.selectedChange=new ye,this.yearSelected=new ye,this.monthSelected=new ye,this.viewChanged=new ye(!0),this._userSelection=new ye,this._userDragDrop=new ye,this._activeDrag=null,this.stateChanges=new pe,this._intlChanges=n.changes.subscribe(()=>{m.markForCheck(),this.stateChanges.next()})}ngAfterContentInit(){this._calendarHeaderPortal=new is(this.headerComponent||ect),this.activeDate=this.startAt||this._dateAdapter.today(),this._currentView=this.startView}ngAfterViewChecked(){this._moveFocusOnNextTick&&(this._moveFocusOnNextTick=!1,this.focusActiveCell())}ngOnDestroy(){this._intlChanges.unsubscribe(),this.stateChanges.complete()}ngOnChanges(n){let s=n.minDate&&!this._dateAdapter.sameDate(n.minDate.previousValue,n.minDate.currentValue)?n.minDate:void 0,d=n.maxDate&&!this._dateAdapter.sameDate(n.maxDate.previousValue,n.maxDate.currentValue)?n.maxDate:void 0,m=s||d||n.dateFilter;if(m&&!m.firstChange){let _=this._getCurrentViewComponent();_&&(this._changeDetectorRef.detectChanges(),_._init())}this.stateChanges.next()}focusActiveCell(){this._getCurrentViewComponent()._focusActiveCell(!1)}updateTodaysDate(){this._getCurrentViewComponent()._init()}_dateSelected(n){let s=n.value;(this.selected instanceof qa||s&&!this._dateAdapter.sameDate(s,this.selected))&&this.selectedChange.emit(s),this._userSelection.emit(n)}_yearSelectedInMultiYearView(n){this.yearSelected.emit(n)}_monthSelectedInYearView(n){this.monthSelected.emit(n)}_goToDateInView(n,s){this.activeDate=n,this.currentView=s}_dragStarted(n){this._activeDrag=n}_dragEnded(n){this._activeDrag&&(n.value&&this._userDragDrop.emit(n),this._activeDrag=null)}_getCurrentViewComponent(){return this.monthView||this.yearView||this.multiYearView}};r.\u0275fac=function(s){return new(s||r)(B(Lx),B(Ko,8),B(Cd,8),B(Wi))},r.\u0275cmp=Et({type:r,selectors:[["mat-calendar"]],viewQuery:function(s,d){if(s&1&&(Ge(HV,5),Ge(qV,5),Ge(GV,5)),s&2){let m;ce(m=de())&&(d.monthView=m.first),ce(m=de())&&(d.yearView=m.first),ce(m=de())&&(d.multiYearView=m.first)}},hostAttrs:[1,"mat-calendar"],inputs:{headerComponent:"headerComponent",startAt:"startAt",startView:"startView",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",monthSelected:"monthSelected",viewChanged:"viewChanged",_userSelection:"_userSelection",_userDragDrop:"_userDragDrop"},exportAs:["matCalendar"],standalone:!0,features:[Ni([YV]),qn,At],decls:5,vars:2,consts:[[3,"cdkPortalOutlet"],["cdkMonitorSubtreeFocus","","tabindex","-1",1,"mat-calendar-content"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName","activeDrag","activeDateChange","_userSelection","dragStarted","dragEnded"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","activeDateChange","monthSelected","selectedChange"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","activeDateChange","yearSelected","selectedChange"]],template:function(s,d){if(s&1&&(mt(0,jlt,0,0,"ng-template",0),A(1,"div",1),mt(2,Ult,1,11)(3,Hlt,1,6)(4,Glt,1,6),k()),s&2){let m;Z("cdkPortalOutlet",d._calendarHeaderPortal),N(2),$i(2,(m=d.currentView)==="month"?2:m==="year"?3:m==="multi-year"?4:-1)}},dependencies:[ul,Sz,HV,qV,GV],styles:['.mat-calendar{display:block;font-family:var(--mat-datepicker-calendar-text-font);font-size:var(--mat-datepicker-calendar-text-size)}.mat-calendar-header{padding:8px 8px 0 8px}.mat-calendar-content{padding:0 8px 8px 8px;outline:none}.mat-calendar-controls{display:flex;align-items:center;margin:5% calc(4.7142857143% - 16px)}.mat-calendar-spacer{flex:1 1 auto}.mat-calendar-period-button{min-width:0;margin:0 8px;font-size:var(--mat-datepicker-calendar-period-button-text-size);font-weight:var(--mat-datepicker-calendar-period-button-text-weight);--mdc-text-button-label-text-color:var(--mat-datepicker-calendar-period-button-text-color)}.mat-calendar-arrow{display:inline-block;width:10px;height:5px;margin:0 0 0 5px;vertical-align:middle;fill:var(--mat-datepicker-calendar-period-button-icon-color)}.mat-calendar-arrow.mat-calendar-invert{transform:rotate(180deg)}[dir=rtl] .mat-calendar-arrow{margin:0 5px 0 0}.cdk-high-contrast-active .mat-calendar-arrow{fill:CanvasText}.mat-calendar-previous-button,.mat-calendar-next-button{position:relative}.mat-datepicker-content .mat-calendar-previous-button:not(.mat-mdc-button-disabled),.mat-datepicker-content .mat-calendar-next-button:not(.mat-mdc-button-disabled){color:var(--mat-datepicker-calendar-navigation-button-icon-color)}.mat-calendar-previous-button::after,.mat-calendar-next-button::after{top:0;left:0;right:0;bottom:0;position:absolute;content:"";margin:15.5px;border:0 solid currentColor;border-top-width:2px}[dir=rtl] .mat-calendar-previous-button,[dir=rtl] .mat-calendar-next-button{transform:rotate(180deg)}.mat-calendar-previous-button::after{border-left-width:2px;transform:translateX(2px) rotate(-45deg)}.mat-calendar-next-button::after{border-right-width:2px;transform:translateX(-2px) rotate(45deg)}.mat-calendar-table{border-spacing:0;border-collapse:collapse;width:100%}.mat-calendar-table-header th{text-align:center;padding:0 0 8px 0;color:var(--mat-datepicker-calendar-header-text-color);font-size:var(--mat-datepicker-calendar-header-text-size);font-weight:var(--mat-datepicker-calendar-header-text-weight)}.mat-calendar-table-header-divider{position:relative;height:1px}.mat-calendar-table-header-divider::after{content:"";position:absolute;top:0;left:-8px;right:-8px;height:1px;background:var(--mat-datepicker-calendar-header-divider-color)}.mat-calendar-body-cell-content::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 3px)*-1)}.mat-calendar-body-cell:focus .mat-focus-indicator::before{content:""}.mat-calendar-hidden-label{display:none}'],encapsulation:2,changeDetection:0});let a=r;return a})(),WV={transformPanel:Yr("transformPanel",[Sn("void => enter-dropdown",Bn("120ms cubic-bezier(0, 0, 0.2, 1)",md([Ei({opacity:0,transform:"scale(1, 0.8)"}),Ei({opacity:1,transform:"scale(1, 1)"})]))),Sn("void => enter-dialog",Bn("150ms cubic-bezier(0, 0, 0.2, 1)",md([Ei({opacity:0,transform:"scale(0.7)"}),Ei({transform:"none",opacity:1})]))),Sn("* => void",Bn("100ms linear",Ei({opacity:0})))]),fadeInCalendar:Yr("fadeInCalendar",[Wn("void",Ei({opacity:0})),Wn("enter",Ei({opacity:1})),Sn("void => *",Bn("120ms 100ms cubic-bezier(0.55, 0, 0.55, 0.2)"))])},ict=0,nct=new we("mat-datepicker-scroll-strategy",{providedIn:"root",factory:()=>{let a=oe($n);return()=>a.scrollStrategies.reposition()}});var rct=(()=>{let r=class r{constructor(n,s,d,m,_,w){this._elementRef=n,this._changeDetectorRef=s,this._globalModel=d,this._dateAdapter=m,this._rangeSelectionStrategy=_,this._subscriptions=new nr,this._animationDone=new pe,this._isAnimating=!1,this._actionsPortal=null,this._closeButtonText=w.closeCalendarLabel}ngOnInit(){this._animationState=this.datepicker.touchUi?"enter-dialog":"enter-dropdown"}ngAfterViewInit(){this._subscriptions.add(this.datepicker.stateChanges.subscribe(()=>{this._changeDetectorRef.markForCheck()})),this._calendar.focusActiveCell()}ngOnDestroy(){this._subscriptions.unsubscribe(),this._animationDone.complete()}_handleUserSelection(n){let s=this._model.selection,d=n.value,m=s instanceof qa;if(m&&this._rangeSelectionStrategy){let _=this._rangeSelectionStrategy.selectionFinished(d,s,n.event);this._model.updateSelection(_,this)}else d&&(m||!this._dateAdapter.sameDate(d,s))&&this._model.add(d);(!this._model||this._model.isComplete())&&!this._actionsPortal&&this.datepicker.close()}_handleUserDragDrop(n){this._model.updateSelection(n.value,this)}_startExitAnimation(){this._animationState="void",this._changeDetectorRef.markForCheck()}_handleAnimationEvent(n){this._isAnimating=n.phaseName==="start",this._isAnimating||this._animationDone.next()}_getSelected(){return this._model.selection}_applyPendingSelection(){this._model!==this._globalModel&&this._globalModel.updateSelection(this._model.selection,this)}_assignActions(n,s){this._model=n?this._globalModel.clone():this._globalModel,this._actionsPortal=n,s&&this._changeDetectorRef.detectChanges()}};r.\u0275fac=function(s){return new(s||r)(B(Se),B(Wi),B(Xg),B(Ko),B(ZV,8),B(Lx))},r.\u0275cmp=Et({type:r,selectors:[["mat-datepicker-content"]],viewQuery:function(s,d){if(s&1&&Ge(wT,5),s&2){let m;ce(m=de())&&(d._calendar=m.first)}},hostAttrs:[1,"mat-datepicker-content"],hostVars:5,hostBindings:function(s,d){s&1&&Cv("@transformPanel.start",function(_){return d._handleAnimationEvent(_)})("@transformPanel.done",function(_){return d._handleAnimationEvent(_)}),s&2&&(wv("@transformPanel",d._animationState),sl(d.color?"mat-"+d.color:""),ei("mat-datepicker-content-touch",d.datepicker.touchUi))},inputs:{color:"color"},exportAs:["matDatepickerContent"],standalone:!0,features:[At],decls:5,vars:26,consts:[["cdkTrapFocus","","role","dialog",1,"mat-datepicker-content-container"],[3,"id","ngClass","startAt","startView","minDate","maxDate","dateFilter","headerComponent","selected","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName","yearSelected","monthSelected","viewChanged","_userSelection","_userDragDrop"],[3,"cdkPortalOutlet"],["type","button","mat-raised-button","",1,"mat-datepicker-close-button",3,"color","focus","blur","click"]],template:function(s,d){if(s&1&&(A(0,"div",0)(1,"mat-calendar",1),ct("yearSelected",function(_){return d.datepicker._selectYear(_)})("monthSelected",function(_){return d.datepicker._selectMonth(_)})("viewChanged",function(_){return d.datepicker._viewChanged(_)})("_userSelection",function(_){return d._handleUserSelection(_)})("_userDragDrop",function(_){return d._handleUserDragDrop(_)}),k(),mt(2,qlt,0,0,"ng-template",2),A(3,"button",3),ct("focus",function(){return d._closeButtonFocused=!0})("blur",function(){return d._closeButtonFocused=!1})("click",function(){return d.datepicker.close()}),V(4),k()()),s&2){let m;ei("mat-datepicker-content-container-with-custom-header",d.datepicker.calendarHeaderComponent)("mat-datepicker-content-container-with-actions",d._actionsPortal),oi("aria-modal",!0)("aria-labelledby",(m=d._dialogLabelId)!==null&&m!==void 0?m:void 0),N(),Z("id",d.datepicker.id)("ngClass",d.datepicker.panelClass)("startAt",d.datepicker.startAt)("startView",d.datepicker.startView)("minDate",d.datepicker._getMinDate())("maxDate",d.datepicker._getMaxDate())("dateFilter",d.datepicker._getDateFilter())("headerComponent",d.datepicker.calendarHeaderComponent)("selected",d._getSelected())("dateClass",d.datepicker.dateClass)("comparisonStart",d.comparisonStart)("comparisonEnd",d.comparisonEnd)("@fadeInCalendar","enter")("startDateAccessibleName",d.startDateAccessibleName)("endDateAccessibleName",d.endDateAccessibleName),N(),Z("cdkPortalOutlet",d._actionsPortal),N(),ei("cdk-visually-hidden",!d._closeButtonFocused),Z("color",d.color||"primary"),N(),De(d._closeButtonText)}},dependencies:[wz,wT,Zo,ul,Qs],styles:[".mat-datepicker-content{display:block;border-radius:4px;background-color:var(--mat-datepicker-calendar-container-background-color);color:var(--mat-datepicker-calendar-container-text-color);box-shadow:var(--mat-datepicker-calendar-container-elevation-shadow);border-radius:var(--mat-datepicker-calendar-container-shape)}.mat-datepicker-content .mat-calendar{width:296px;height:354px}.mat-datepicker-content .mat-datepicker-content-container-with-custom-header .mat-calendar{height:auto}.mat-datepicker-content .mat-datepicker-close-button{position:absolute;top:100%;left:0;margin-top:8px}.ng-animating .mat-datepicker-content .mat-datepicker-close-button{display:none}.mat-datepicker-content-container{display:flex;flex-direction:column;justify-content:space-between}.mat-datepicker-content-touch{display:block;max-height:80vh;box-shadow:var(--mat-datepicker-calendar-container-touch-elevation-shadow);border-radius:var(--mat-datepicker-calendar-container-touch-shape);position:relative;overflow:visible}.mat-datepicker-content-touch .mat-datepicker-content-container{min-height:312px;max-height:788px;min-width:250px;max-width:750px}.mat-datepicker-content-touch .mat-calendar{width:100%;height:auto}@media all and (orientation: landscape){.mat-datepicker-content-touch .mat-datepicker-content-container{width:64vh;height:80vh}}@media all and (orientation: portrait){.mat-datepicker-content-touch .mat-datepicker-content-container{width:80vw;height:100vw}.mat-datepicker-content-touch .mat-datepicker-content-container-with-actions{height:115vw}}"],encapsulation:2,data:{animation:[WV.transformPanel,WV.fadeInCalendar]},changeDetection:0});let a=r;return a})(),$V=(()=>{let r=class r{get startAt(){return this._startAt||(this.datepickerInput?this.datepickerInput.getStartValue():null)}set startAt(n){this._startAt=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get color(){return this._color||(this.datepickerInput?this.datepickerInput.getThemePalette():void 0)}set color(n){this._color=n}get disabled(){return this._disabled===void 0&&this.datepickerInput?this.datepickerInput.disabled:!!this._disabled}set disabled(n){n!==this._disabled&&(this._disabled=n,this.stateChanges.next(void 0))}get panelClass(){return this._panelClass}set panelClass(n){this._panelClass=m3(n)}get opened(){return this._opened}set opened(n){n?this.open():this.close()}_getMinDate(){return this.datepickerInput&&this.datepickerInput.min}_getMaxDate(){return this.datepickerInput&&this.datepickerInput.max}_getDateFilter(){return this.datepickerInput&&this.datepickerInput.dateFilter}constructor(n,s,d,m,_,w,S){this._overlay=n,this._ngZone=s,this._viewContainerRef=d,this._dateAdapter=_,this._dir=w,this._model=S,this._inputStateChanges=nr.EMPTY,this._document=oe(li),this.startView="month",this.touchUi=!1,this.xPosition="start",this.yPosition="below",this.restoreFocus=!0,this.yearSelected=new ye,this.monthSelected=new ye,this.viewChanged=new ye(!0),this.openedStream=new ye,this.closedStream=new ye,this._opened=!1,this.id=`mat-datepicker-${ict++}`,this._focusedElementBeforeOpen=null,this._backdropHarnessClass=`${this.id}-backdrop`,this.stateChanges=new pe,this._dateAdapter,this._scrollStrategy=m}ngOnChanges(n){let s=n.xPosition||n.yPosition;if(s&&!s.firstChange&&this._overlayRef){let d=this._overlayRef.getConfig().positionStrategy;d instanceof Jf&&(this._setConnectedPositions(d),this.opened&&this._overlayRef.updatePosition())}this.stateChanges.next(void 0)}ngOnDestroy(){this._destroyOverlay(),this.close(),this._inputStateChanges.unsubscribe(),this.stateChanges.complete()}select(n){this._model.add(n)}_selectYear(n){this.yearSelected.emit(n)}_selectMonth(n){this.monthSelected.emit(n)}_viewChanged(n){this.viewChanged.emit(n)}registerInput(n){return this.datepickerInput,this._inputStateChanges.unsubscribe(),this.datepickerInput=n,this._inputStateChanges=n.stateChanges.subscribe(()=>this.stateChanges.next(void 0)),this._model}registerActions(n){this._actionsPortal,this._actionsPortal=n,this._componentRef?.instance._assignActions(n,!0)}removeActions(n){n===this._actionsPortal&&(this._actionsPortal=null,this._componentRef?.instance._assignActions(null,!0))}open(){this._opened||this.disabled||this._componentRef?.instance._isAnimating||(this.datepickerInput,this._focusedElementBeforeOpen=_d(),this._openOverlay(),this._opened=!0,this.openedStream.emit())}close(){if(!this._opened||this._componentRef?.instance._isAnimating)return;let n=this.restoreFocus&&this._focusedElementBeforeOpen&&typeof this._focusedElementBeforeOpen.focus=="function",s=()=>{this._opened&&(this._opened=!1,this.closedStream.emit())};if(this._componentRef){let{instance:d,location:m}=this._componentRef;d._startExitAnimation(),d._animationDone.pipe(Ji(1)).subscribe(()=>{let _=this._document.activeElement;n&&(!_||_===this._document.activeElement||m.nativeElement.contains(_))&&this._focusedElementBeforeOpen.focus(),this._focusedElementBeforeOpen=null,this._destroyOverlay()})}n?setTimeout(s):s()}_applyPendingSelection(){this._componentRef?.instance?._applyPendingSelection()}_forwardContentValues(n){n.datepicker=this,n.color=this.color,n._dialogLabelId=this.datepickerInput.getOverlayLabelId(),n._assignActions(this._actionsPortal,!1)}_openOverlay(){this._destroyOverlay();let n=this.touchUi,s=new is(rct,this._viewContainerRef),d=this._overlayRef=this._overlay.create(new ns({positionStrategy:n?this._getDialogStrategy():this._getDropdownStrategy(),hasBackdrop:!0,backdropClass:[n?"cdk-overlay-dark-backdrop":"mat-overlay-transparent-backdrop",this._backdropHarnessClass],direction:this._dir,scrollStrategy:n?this._overlay.scrollStrategies.block():this._scrollStrategy(),panelClass:`mat-datepicker-${n?"dialog":"popup"}`}));this._getCloseStream(d).subscribe(m=>{m&&m.preventDefault(),this.close()}),d.keydownEvents().subscribe(m=>{let _=m.keyCode;(_===38||_===40||_===37||_===39||_===33||_===34)&&m.preventDefault()}),this._componentRef=d.attach(s),this._forwardContentValues(this._componentRef.instance),n||this._ngZone.onStable.pipe(Ji(1)).subscribe(()=>d.updatePosition())}_destroyOverlay(){this._overlayRef&&(this._overlayRef.dispose(),this._overlayRef=this._componentRef=null)}_getDialogStrategy(){return this._overlay.position().global().centerHorizontally().centerVertically()}_getDropdownStrategy(){let n=this._overlay.position().flexibleConnectedTo(this.datepickerInput.getConnectedOverlayOrigin()).withTransformOriginOn(".mat-datepicker-content").withFlexibleDimensions(!1).withViewportMargin(8).withLockedPosition();return this._setConnectedPositions(n)}_setConnectedPositions(n){let s=this.xPosition==="end"?"end":"start",d=s==="start"?"end":"start",m=this.yPosition==="above"?"bottom":"top",_=m==="top"?"bottom":"top";return n.withPositions([{originX:s,originY:_,overlayX:s,overlayY:m},{originX:s,originY:m,overlayX:s,overlayY:_},{originX:d,originY:_,overlayX:d,overlayY:m},{originX:d,originY:m,overlayX:d,overlayY:_}])}_getCloseStream(n){let s=["ctrlKey","shiftKey","metaKey"];return io(n.backdropClick(),n.detachments(),n.keydownEvents().pipe(wn(d=>d.keyCode===27&&!Zr(d)||this.datepickerInput&&Zr(d,"altKey")&&d.keyCode===38&&s.every(m=>!Zr(d,m)))))}};r.\u0275fac=function(s){return new(s||r)(B($n),B(ze),B(Mo),B(nct),B(Ko,8),B(To,8),B(Xg))},r.\u0275dir=re({type:r,inputs:{calendarHeaderComponent:"calendarHeaderComponent",startAt:"startAt",startView:"startView",color:"color",touchUi:[Rt.HasDecoratorInputTransform,"touchUi","touchUi",Qe],disabled:[Rt.HasDecoratorInputTransform,"disabled","disabled",Qe],xPosition:"xPosition",yPosition:"yPosition",restoreFocus:[Rt.HasDecoratorInputTransform,"restoreFocus","restoreFocus",Qe],dateClass:"dateClass",panelClass:"panelClass",opened:[Rt.HasDecoratorInputTransform,"opened","opened",Qe]},outputs:{yearSelected:"yearSelected",monthSelected:"monthSelected",viewChanged:"viewChanged",openedStream:"opened",closedStream:"closed"},features:[Tn,qn]});let a=r;return a})(),QV=(()=>{let r=class r extends $V{};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=zr(r)))(d||r)}})(),r.\u0275cmp=Et({type:r,selectors:[["mat-datepicker"]],exportAs:["matDatepicker"],standalone:!0,features:[Ni([YV,{provide:$V,useExisting:r}]),Si,At],decls:0,vars:0,template:function(s,d){},encapsulation:2,changeDetection:0});let a=r;return a})(),ip=class{constructor(r,l){this.target=r,this.targetElement=l,this.value=this.target.value}},oct=(()=>{let r=class r{get value(){return this._model?this._getValueFromModel(this._model.selection):this._pendingValue}set value(n){this._assignValueProgrammatically(n)}get disabled(){return!!this._disabled||this._parentDisabled()}set disabled(n){let s=n,d=this._elementRef.nativeElement;this._disabled!==s&&(this._disabled=s,this.stateChanges.next(void 0)),s&&this._isInitialized&&d.blur&&d.blur()}_getValidators(){return[this._parseValidator,this._minValidator,this._maxValidator,this._filterValidator]}_registerModel(n){this._model=n,this._valueChangesSubscription.unsubscribe(),this._pendingValue&&this._assignValue(this._pendingValue),this._valueChangesSubscription=this._model.selectionChanged.subscribe(s=>{if(this._shouldHandleChangeEvent(s)){let d=this._getValueFromModel(s.selection);this._lastValueValid=this._isValidValue(d),this._cvaOnChange(d),this._onTouched(),this._formatValue(d),this.dateInput.emit(new ip(this,this._elementRef.nativeElement)),this.dateChange.emit(new ip(this,this._elementRef.nativeElement))}})}constructor(n,s,d){this._elementRef=n,this._dateAdapter=s,this._dateFormats=d,this.dateChange=new ye,this.dateInput=new ye,this.stateChanges=new pe,this._onTouched=()=>{},this._validatorOnChange=()=>{},this._cvaOnChange=()=>{},this._valueChangesSubscription=nr.EMPTY,this._localeSubscription=nr.EMPTY,this._parseValidator=()=>this._lastValueValid?null:{matDatepickerParse:{text:this._elementRef.nativeElement.value}},this._filterValidator=m=>{let _=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(m.value));return!_||this._matchesFilter(_)?null:{matDatepickerFilter:!0}},this._minValidator=m=>{let _=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(m.value)),w=this._getMinDate();return!w||!_||this._dateAdapter.compareDate(w,_)<=0?null:{matDatepickerMin:{min:w,actual:_}}},this._maxValidator=m=>{let _=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(m.value)),w=this._getMaxDate();return!w||!_||this._dateAdapter.compareDate(w,_)>=0?null:{matDatepickerMax:{max:w,actual:_}}},this._lastValueValid=!1,this._localeSubscription=s.localeChanges.subscribe(()=>{this._assignValueProgrammatically(this.value)})}ngAfterViewInit(){this._isInitialized=!0}ngOnChanges(n){sct(n,this._dateAdapter)&&this.stateChanges.next(void 0)}ngOnDestroy(){this._valueChangesSubscription.unsubscribe(),this._localeSubscription.unsubscribe(),this.stateChanges.complete()}registerOnValidatorChange(n){this._validatorOnChange=n}validate(n){return this._validator?this._validator(n):null}writeValue(n){this._assignValueProgrammatically(n)}registerOnChange(n){this._cvaOnChange=n}registerOnTouched(n){this._onTouched=n}setDisabledState(n){this.disabled=n}_onKeydown(n){let s=["ctrlKey","shiftKey","metaKey"];Zr(n,"altKey")&&n.keyCode===40&&s.every(m=>!Zr(n,m))&&!this._elementRef.nativeElement.readOnly&&(this._openPopup(),n.preventDefault())}_onInput(n){let s=this._lastValueValid,d=this._dateAdapter.parse(n,this._dateFormats.parse.dateInput);this._lastValueValid=this._isValidValue(d),d=this._dateAdapter.getValidDateOrNull(d);let m=!this._dateAdapter.sameDate(d,this.value);!d||m?this._cvaOnChange(d):(n&&!this.value&&this._cvaOnChange(d),s!==this._lastValueValid&&this._validatorOnChange()),m&&(this._assignValue(d),this.dateInput.emit(new ip(this,this._elementRef.nativeElement)))}_onChange(){this.dateChange.emit(new ip(this,this._elementRef.nativeElement))}_onBlur(){this.value&&this._formatValue(this.value),this._onTouched()}_formatValue(n){this._elementRef.nativeElement.value=n!=null?this._dateAdapter.format(n,this._dateFormats.display.dateInput):""}_assignValue(n){this._model?(this._assignValueToModel(n),this._pendingValue=null):this._pendingValue=n}_isValidValue(n){return!n||this._dateAdapter.isValid(n)}_parentDisabled(){return!1}_assignValueProgrammatically(n){n=this._dateAdapter.deserialize(n),this._lastValueValid=this._isValidValue(n),n=this._dateAdapter.getValidDateOrNull(n),this._assignValue(n),this._formatValue(n)}_matchesFilter(n){let s=this._getDateFilter();return!s||s(n)}};r.\u0275fac=function(s){return new(s||r)(B(Se),B(Ko,8),B(Cd,8))},r.\u0275dir=re({type:r,inputs:{value:"value",disabled:[Rt.HasDecoratorInputTransform,"disabled","disabled",Qe]},outputs:{dateChange:"dateChange",dateInput:"dateInput"},standalone:!0,features:[Tn,qn]});let a=r;return a})();function sct(a,r){let l=Object.keys(a);for(let n of l){let{previousValue:s,currentValue:d}=a[n];if(r.isDateInstance(s)&&r.isDateInstance(d)){if(!r.sameDate(s,d))return!0}else return!0}return!1}var act={provide:xa,useExisting:Vo(()=>zx),multi:!0},lct={provide:wd,useExisting:Vo(()=>zx),multi:!0},zx=(()=>{let r=class r extends oct{set matDatepicker(n){n&&(this._datepicker=n,this._closedSubscription=n.closedStream.subscribe(()=>this._onTouched()),this._registerModel(n.registerInput(this)))}get min(){return this._min}set min(n){let s=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n));this._dateAdapter.sameDate(s,this._min)||(this._min=s,this._validatorOnChange())}get max(){return this._max}set max(n){let s=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n));this._dateAdapter.sameDate(s,this._max)||(this._max=s,this._validatorOnChange())}get dateFilter(){return this._dateFilter}set dateFilter(n){let s=this._matchesFilter(this.value);this._dateFilter=n,this._matchesFilter(this.value)!==s&&this._validatorOnChange()}constructor(n,s,d,m){super(n,s,d),this._formField=m,this._closedSubscription=nr.EMPTY,this._validator=Le.compose(super._getValidators())}getConnectedOverlayOrigin(){return this._formField?this._formField.getConnectedOverlayOrigin():this._elementRef}getOverlayLabelId(){return this._formField?this._formField.getLabelId():this._elementRef.nativeElement.getAttribute("aria-labelledby")}getThemePalette(){return this._formField?this._formField.color:void 0}getStartValue(){return this.value}ngOnDestroy(){super.ngOnDestroy(),this._closedSubscription.unsubscribe()}_openPopup(){this._datepicker&&this._datepicker.open()}_getValueFromModel(n){return n}_assignValueToModel(n){this._model&&this._model.updateSelection(n,this)}_getMinDate(){return this._min}_getMaxDate(){return this._max}_getDateFilter(){return this._dateFilter}_shouldHandleChangeEvent(n){return n.source!==this}};r.\u0275fac=function(s){return new(s||r)(B(Se),B(Ko,8),B(Cd,8),B(Fu,8))},r.\u0275dir=re({type:r,selectors:[["input","matDatepicker",""]],hostAttrs:[1,"mat-datepicker-input"],hostVars:6,hostBindings:function(s,d){s&1&&ct("input",function(_){return d._onInput(_.target.value)})("change",function(){return d._onChange()})("blur",function(){return d._onBlur()})("keydown",function(_){return d._onKeydown(_)}),s&2&&(Rs("disabled",d.disabled),oi("aria-haspopup",d._datepicker?"dialog":null)("aria-owns",(d._datepicker==null?null:d._datepicker.opened)&&d._datepicker.id||null)("min",d.min?d._dateAdapter.toIso8601(d.min):null)("max",d.max?d._dateAdapter.toIso8601(d.max):null)("data-mat-calendar",d._datepicker?d._datepicker.id:null))},inputs:{matDatepicker:"matDatepicker",min:"min",max:"max",dateFilter:[Rt.None,"matDatepickerFilter","dateFilter"]},exportAs:["matDatepickerInput"],standalone:!0,features:[Ni([act,lct,{provide:EM,useExisting:r}]),Si]});let a=r;return a})(),cct=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275dir=re({type:r,selectors:[["","matDatepickerToggleIcon",""]],standalone:!0});let a=r;return a})(),JV=(()=>{let r=class r{get disabled(){return this._disabled===void 0&&this.datepicker?this.datepicker.disabled:!!this._disabled}set disabled(n){this._disabled=n}constructor(n,s,d){this._intl=n,this._changeDetectorRef=s,this._stateChanges=nr.EMPTY;let m=Number(d);this.tabIndex=m||m===0?m:null}ngOnChanges(n){n.datepicker&&this._watchStateChanges()}ngOnDestroy(){this._stateChanges.unsubscribe()}ngAfterContentInit(){this._watchStateChanges()}_open(n){this.datepicker&&!this.disabled&&(this.datepicker.open(),n.stopPropagation())}_watchStateChanges(){let n=this.datepicker?this.datepicker.stateChanges:Fe(),s=this.datepicker&&this.datepicker.datepickerInput?this.datepicker.datepickerInput.stateChanges:Fe(),d=this.datepicker?io(this.datepicker.openedStream,this.datepicker.closedStream):Fe();this._stateChanges.unsubscribe(),this._stateChanges=io(this._intl.changes,n,s,d).subscribe(()=>this._changeDetectorRef.markForCheck())}};r.\u0275fac=function(s){return new(s||r)(B(Lx),B(Wi),rl("tabindex"))},r.\u0275cmp=Et({type:r,selectors:[["mat-datepicker-toggle"]],contentQueries:function(s,d,m){if(s&1&&mn(m,cct,5),s&2){let _;ce(_=de())&&(d._customIcon=_.first)}},viewQuery:function(s,d){if(s&1&&Ge(Wlt,5),s&2){let m;ce(m=de())&&(d._button=m.first)}},hostAttrs:[1,"mat-datepicker-toggle"],hostVars:8,hostBindings:function(s,d){s&1&&ct("click",function(_){return d._open(_)}),s&2&&(oi("tabindex",null)("data-mat-calendar",d.datepicker?d.datepicker.id:null),ei("mat-datepicker-toggle-active",d.datepicker&&d.datepicker.opened)("mat-accent",d.datepicker&&d.datepicker.color==="accent")("mat-warn",d.datepicker&&d.datepicker.color==="warn"))},inputs:{datepicker:[Rt.None,"for","datepicker"],tabIndex:"tabIndex",ariaLabel:[Rt.None,"aria-label","ariaLabel"],disabled:[Rt.HasDecoratorInputTransform,"disabled","disabled",Qe],disableRipple:"disableRipple"},exportAs:["matDatepickerToggle"],standalone:!0,features:[Tn,qn,At],ngContentSelectors:Zlt,decls:4,vars:6,consts:[["mat-icon-button","","type","button",3,"disabled","disableRipple"],["button",""],["class","mat-datepicker-toggle-default-icon","viewBox","0 0 24 24","width","24px","height","24px","fill","currentColor","focusable","false","aria-hidden","true"],["viewBox","0 0 24 24","width","24px","height","24px","fill","currentColor","focusable","false","aria-hidden","true",1,"mat-datepicker-toggle-default-icon"],["d","M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"]],template:function(s,d){s&1&&(Nn(Ylt),A(0,"button",0,1),mt(2,$lt,2,0,":svg:svg",2),Ti(3),k()),s&2&&(Z("disabled",d.disabled)("disableRipple",d.disableRipple),oi("aria-haspopup",d.datepicker?"dialog":null)("aria-label",d.ariaLabel||d._intl.openCalendarLabel)("tabindex",d.disabled?-1:d.tabIndex),N(2),$i(2,d._customIcon?-1:2))},dependencies:[Tc],styles:[".mat-datepicker-toggle{pointer-events:auto;color:var(--mat-datepicker-toggle-icon-color)}.mat-datepicker-toggle-active{color:var(--mat-datepicker-toggle-active-state-icon-color)}.cdk-high-contrast-active .mat-datepicker-toggle-default-icon{color:CanvasText}"],encapsulation:2,changeDetection:0});let a=r;return a})();var tj=(()=>{let r=class r{constructor(n){this.http=n}getLocations(){return this.http.get(Me+"/locations/names")}getArtists(){return this.http.get(Me+"/artists/names")}getGenres(){return this.http.get(Me+"/broad-genres/names")}};r.\u0275fac=function(s){return new(s||r)(ht(Gi))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var uct=a=>({selected:a});function hct(a,r){if(a&1){let l=Ce();A(0,"div",14),ct("click",function(){let d=te(l).$implicit,m=vt();return ee(m.selectedItem=d)}),A(1,"b"),V(2),k()()}if(a&2){let l=r.$implicit,n=vt();Z("ngClass",Xi(2,uct,n.selectedItem===l)),N(2),De(l)}}function mct(a,r){if(a&1){let l=Ce();A(0,"div",17)(1,"div",18)(2,"input",19),ct("change",function(){let d=te(l).$implicit,m=vt(2);return ee(m.toggleSelection("location",d))}),k(),A(3,"label",20),V(4),k()()()}if(a&2){let l=r.$implicit,n=vt(2);N(2),Z("id","location_"+l)("checked",n.selectedLocations.includes(l)),N(),Z("for","location_"+l),N(),ae(" ",l," ")}}function pct(a,r){if(a&1&&(A(0,"div")(1,"h3"),V(2,"Locatii"),k(),A(3,"div",15),mt(4,mct,5,4,"div",16),k()()),a&2){let l=vt();N(4),Z("ngForOf",l.locations)}}function fct(a,r){if(a&1){let l=Ce();A(0,"div",22)(1,"div",18)(2,"input",19),ct("change",function(){let d=te(l).$implicit,m=vt(2);return ee(m.toggleSelection("artist",d))}),k(),A(3,"label",20),V(4),k()()()}if(a&2){let l=r.$implicit,n=vt(2);N(2),Z("id","artist_"+l)("checked",n.selectedArtists.includes(l)),N(),Z("for","artist_"+l),N(),ae(" ",l," ")}}function gct(a,r){if(a&1&&(A(0,"div")(1,"h3"),V(2,"Artisti"),k(),A(3,"div",15),mt(4,fct,5,4,"div",21),k()()),a&2){let l=vt();N(4),Z("ngForOf",l.artists)}}function _ct(a,r){if(a&1){let l=Ce();A(0,"div",22)(1,"div",18)(2,"input",19),ct("change",function(){let d=te(l).$implicit,m=vt(2);return ee(m.toggleSelection("genre",d))}),k(),A(3,"label",20),V(4),k()()()}if(a&2){let l=r.$implicit,n=vt(2);N(2),Z("id","genre_"+l)("checked",n.selectedGenres.includes(l)),N(),Z("for","genre_"+l),N(),ae(" ",l," ")}}function vct(a,r){if(a&1&&(A(0,"div")(1,"h3"),V(2,"Genuri"),k(),A(3,"div",15),mt(4,_ct,5,4,"div",21),k()()),a&2){let l=vt();N(4),Z("ngForOf",l.genres)}}function yct(a,r){if(a&1){let l=Ce();A(0,"div")(1,"h3"),V(2,"Data"),k(),A(3,"form",23)(4,"mat-form-field")(5,"mat-label"),V(6,"Data de inceput"),k(),A(7,"input",24),ct("dateChange",function(){te(l);let s=vt();return ee(s.onStartDateChange())}),k(),dt(8,"mat-datepicker-toggle",25)(9,"mat-datepicker",null,26),k(),dt(11,"br"),A(12,"mat-form-field")(13,"mat-label"),V(14,"Data de sfarsit"),k(),A(15,"input",27),ct("dateChange",function(){te(l);let s=vt();return ee(s.onEndDateChange())}),k(),dt(16,"mat-datepicker-toggle",25)(17,"mat-datepicker",null,28),k()()()}if(a&2){let l=Ir(10),n=Ir(18),s=vt();N(3),Z("formGroup",s.range),N(4),Z("matDatepicker",l)("min",s.today),N(),Z("for",l),N(7),Z("matDatepicker",n)("min",s.today),N(),Z("for",n)}}function bct(a,r){if(a&1){let l=Ce();A(0,"div",31),V(1),A(2,"button",32),ct("click",function(){let d=te(l).$implicit,m=vt(2);return ee(m.removeFilter("location",d))}),dt(3,"i",33),k()()}if(a&2){let l=r.$implicit;N(),ae(" ",l," ")}}function xct(a,r){if(a&1&&(A(0,"div"),V(1," Locatii: "),A(2,"div",29),mt(3,bct,4,1,"div",30),k()()),a&2){let l=vt();N(3),Z("ngForOf",l.selectedLocations)}}function wct(a,r){if(a&1){let l=Ce();A(0,"div",31),V(1),A(2,"button",32),ct("click",function(){let d=te(l).$implicit,m=vt(2);return ee(m.removeFilter("artist",d))}),dt(3,"i",33),k()()}if(a&2){let l=r.$implicit;N(),ae(" ",l," ")}}function Cct(a,r){if(a&1&&(A(0,"div"),V(1," Artisti: "),A(2,"div",29),mt(3,wct,4,1,"div",30),k()()),a&2){let l=vt();N(3),Z("ngForOf",l.selectedArtists)}}function Sct(a,r){if(a&1){let l=Ce();A(0,"div",31),V(1),A(2,"button",32),ct("click",function(){let d=te(l).$implicit,m=vt(2);return ee(m.removeFilter("genre",d))}),dt(3,"i",33),k()()}if(a&2){let l=r.$implicit;N(),ae(" ",l," ")}}function Ect(a,r){if(a&1&&(A(0,"div"),V(1," Genuri: "),A(2,"div",29),mt(3,Sct,4,1,"div",30),k()()),a&2){let l=vt();N(3),Z("ngForOf",l.selectedGenres)}}function Mct(a,r){if(a&1){let l=Ce();A(0,"div"),V(1,"Data: "),A(2,"div",29)(3,"div",31),V(4),A(5,"button",32),ct("click",function(){te(l);let s=vt();return ee(s.removeFilter("date",""))}),dt(6,"i",33),k()()()()}if(a&2){let l=vt();N(4),Fo(" ",l.selectedStartDate," - ",l.selectedEndDate," ")}}var ej=(()=>{let r=class r{constructor(n,s,d,m){this.dialogRef=n,this.data=s,this.eventListFilterService=d,this.formBuilder=m,this.navigationItems=["Locatie","Artist","Gen","Data"],this.locations=[],this.artists=[],this.genres=[],this.selectedLocations=[],this.selectedArtists=[],this.selectedGenres=[],this.selectedStartDate="",this.selectedEndDate="",this.selectedItem="Locatie",this.today=new Date}ngOnInit(){this.eventListFilterService.getLocations().subscribe(n=>{this.locations=n}),this.eventListFilterService.getArtists().subscribe(n=>{this.artists=n}),this.eventListFilterService.getGenres().subscribe(n=>{this.genres=n}),this.data.location!==void 0&&(this.selectedLocations=this.data.location.split(",")),this.data.artist!==void 0&&(this.selectedArtists=this.data.artist.split(",")),this.data.genre!==void 0&&(this.selectedGenres=this.data.genre.split(",")),this.data.startDate!==void 0&&(this.selectedStartDate=this.data.startDate),this.data.endDate!==void 0&&(this.selectedEndDate=this.data.endDate),this.range=this.formBuilder.group({start:[""],end:[""]})}close(){this.dialogRef.close()}onStartDateChange(){let n=this.range.get("start"),s=this.range.get("end");if(n&&s){let d=n.value,m=s.value;d>m&&s.setValue(d)}this.selectedStartDate=this.getFormattedDate(n?.value),this.selectedEndDate=this.getFormattedDate(s?.value)}onEndDateChange(){let n=this.range.get("start"),s=this.range.get("end");if(n&&s){let d=s.value,m=n.value;d<m&&n.setValue(d)}this.selectedStartDate=this.getFormattedDate(n?.value),this.selectedEndDate=this.getFormattedDate(s?.value)}getFormattedDate(n){let s=new Date(n);return s.setDate(s.getDate()+1),s.toISOString().split("T")[0]}toggleSelection(n,s){let d;switch(n){case"location":d=this.selectedLocations;break;case"artist":d=this.selectedArtists;break;case"genre":d=this.selectedGenres;break;default:return}let m=d.indexOf(s);m===-1?d.push(s):d.splice(m,1)}removeFilter(n,s){switch(n){case"location":let d=this.selectedLocations.indexOf(s);d!==-1&&this.selectedLocations.splice(d,1);break;case"artist":let m=this.selectedArtists.indexOf(s);m!==-1&&this.selectedArtists.splice(m,1);break;case"genre":let _=this.selectedGenres.indexOf(s);_!==-1&&this.selectedGenres.splice(_,1);break;case"date":this.selectedStartDate="",this.selectedEndDate="",this.range.reset();break;default:break}}save(){let n={selectedLocations:this.selectedLocations,selectedArtists:this.selectedArtists,selectedGenres:this.selectedGenres,selectedStartDate:this.selectedStartDate,selectedEndDate:this.selectedEndDate};this.dialogRef.close(n)}};r.\u0275fac=function(s){return new(s||r)(B(Qn),B(jr),B(tj),B(wr))},r.\u0275cmp=Et({type:r,selectors:[["app-event-list-filter"]],standalone:!0,features:[Ni([Ly()]),At],decls:27,vars:9,consts:[[1,"container-fluid"],[1,"row"],[1,"col-sm-3"],[1,"navigation"],[1,"text-center"],["class","navigation-item",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"col-sm-1"],[1,"vertical-line"],[1,"col-sm-8"],[4,"ngIf"],[1,"row","footer"],[1,"selected-filters-section"],[1,"bottom-buttons"],[1,"btn",3,"click"],[1,"navigation-item",3,"ngClass","click"],[1,"options"],["class","locatios",4,"ngFor","ngForOf"],[1,"locatios"],[1,"form-check"],["type","checkbox",1,"form-check-input",3,"id","checked","change"],[1,"form-check-label",3,"for"],["class","genre",4,"ngFor","ngForOf"],[1,"genre"],[3,"formGroup"],["matInput","","formControlName","start",3,"matDatepicker","min","dateChange"],["matSuffix","",3,"for"],["picker1",""],["matInput","","formControlName","end",3,"matDatepicker","min","dateChange"],["picker2",""],[1,"selected-filters"],["class","filter",4,"ngFor","ngForOf"],[1,"filter"],[1,"btn","btn-sm",3,"click"],[1,"fa","fa-times"]],template:function(s,d){s&1&&(A(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h4",4),V(5,"Filtru"),k(),dt(6,"hr"),mt(7,hct,3,4,"div",5),k()(),A(8,"div",6),dt(9,"div",7),k(),A(10,"div",8),mt(11,pct,5,1,"div",9)(12,gct,5,1,"div",9)(13,vct,5,1,"div",9)(14,yct,19,7,"div",9),k()(),dt(15,"hr"),A(16,"div",10)(17,"div",11),mt(18,xct,4,1,"div",9)(19,Cct,4,1,"div",9)(20,Ect,4,1,"div",9)(21,Mct,7,2,"div",9),k(),A(22,"div",12)(23,"button",13),ct("click",function(){return d.close()}),V(24,"Close"),k(),A(25,"button",13),ct("click",function(){return d.save()}),V(26,"Save"),k()()()()),s&2&&(N(7),Z("ngForOf",d.navigationItems),N(4),Z("ngIf",d.selectedItem==="Locatie"),N(),Z("ngIf",d.selectedItem==="Artist"),N(),Z("ngIf",d.selectedItem==="Gen"),N(),Z("ngIf",d.selectedItem==="Data"),N(4),Z("ngIf",d.selectedLocations.length>0),N(),Z("ngIf",d.selectedArtists.length>0),N(),Z("ngIf",d.selectedGenres.length>0),N(),Z("ngIf",d.selectedStartDate!=""&&d.selectedEndDate!=""))},dependencies:[Ii,Zo,qe,jy,JV,mN,Uy,_N,zx,QV,Yi,xr,en,ji,br,Rn,Vn,ur],styles:[".container-fluid[_ngcontent-%COMP%]{padding:20px;overflow-x:hidden;display:flex;flex-direction:column;height:100%}.navigation-item[_ngcontent-%COMP%]{padding:10px;cursor:pointer;text-align:center}.navigation-item[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.selected[_ngcontent-%COMP%]{background-color:#e0e0e0}.vertical-line[_ngcontent-%COMP%]{border-left:1px solid #ccc;height:100%}.options[_ngcontent-%COMP%]{padding:10px;display:flex;flex-wrap:wrap;gap:20px}.bottom-buttons[_ngcontent-%COMP%]{margin-top:auto;display:flex;justify-content:flex-end;padding:10px}.selected-filters[_ngcontent-%COMP%]{padding:10px;display:flex;flex-wrap:wrap;gap:10px}.filter[_ngcontent-%COMP%]{padding:5px;background-color:#4169e1;color:#fff;border-radius:5px}"]});let a=r;return a})();var rp=(()=>{let r=class r{constructor(){this.loadingSubject=new Ze(!1),this.loading$=this.loadingSubject.asObservable()}show(){this.loadingSubject.next(!0)}hide(){this.loadingSubject.next(!1)}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function Dct(a,r){if(a&1){let l=Ce();A(0,"div",10),V(1),A(2,"button",11),ct("click",function(){let d=te(l).$implicit,m=vt();return ee(m.removeFilter("location",d))}),dt(3,"i",12),k()()}if(a&2){let l=r.$implicit;N(),ae(" ",l," ")}}function Tct(a,r){if(a&1){let l=Ce();A(0,"div",10),V(1),A(2,"button",11),ct("click",function(){let d=te(l).$implicit,m=vt();return ee(m.removeFilter("artist",d))}),dt(3,"i",12),k()()}if(a&2){let l=r.$implicit;N(),ae(" ",l," ")}}function Ict(a,r){if(a&1){let l=Ce();A(0,"div",10),V(1),A(2,"button",11),ct("click",function(){let d=te(l).$implicit,m=vt();return ee(m.removeFilter("genre",d))}),dt(3,"i",12),k()()}if(a&2){let l=r.$implicit;N(),ae(" ",l," ")}}function Act(a,r){if(a&1){let l=Ce();A(0,"div")(1,"div",10),V(2),A(3,"button",11),ct("click",function(){te(l);let s=vt();return ee(s.removeFilter("date",""))}),dt(4,"i",12),k()()()}if(a&2){let l=vt();N(2),Fo(" ",l.filter.startDate," - ",l.filter.endDate," ")}}function kct(a,r){a&1&&(A(0,"div")(1,"h2"),V(2,"Nu a fost gasit niciun eveniment"),k()())}var Rct=a=>["/event",a],Pct=a=>({id:a});function Oct(a,r){if(a&1&&(A(0,"div",15)(1,"div",16),dt(2,"img",17),k(),A(3,"div",18)(4,"h5",19),V(5),k(),A(6,"p",20),V(7),k(),A(8,"p",21),V(9),k()()()),a&2){let l=r.$implicit;Z("routerLink",Xi(8,Rct,l.title))("queryParams",Xi(10,Pct,l.id)),N(2),hs("src",l.imageUrl,Tr),Qh("alt","",l.tile," image"),N(3),De(l.title),N(2),Fo("",l.date," | ",l.location.name,""),N(2),ae("",l.shortDescription.substring(0,600)," ...")}}function Fct(a,r){if(a&1&&(A(0,"div",13),mt(1,Oct,10,12,"div",14),k()),a&2){let l=vt();N(),Z("ngForOf",l.events)}}var ij=(()=>{let r=class r{constructor(n,s,d,m,_){this.route=n,this.router=s,this.eventService=d,this.loadingService=m,this.dialog=_,this.events=[],this.page=0,this.size=10,this.loading=!1,this.reachedEnd=!1}ngOnInit(){this.loadingSubscription=this.loadingService.loading$.subscribe(n=>{setTimeout(()=>{this.loading=n},0)}),this.router.events.subscribe(n=>{n instanceof Du&&(this.reachedEnd=!1,this.page=0)}),this.route.queryParams.subscribe(n=>It(this,null,function*(){this.locationNameList=n.location,this.artistNameList=n.artist,this.genreNameList=n.genre,this.startDate=n.startDate,this.endDate=n.endDate,this.filter={location:this.locationNameList?.split(","),artist:this.artistNameList?.split(","),genre:this.genreNameList?.split(","),startDate:this.startDate,endDate:this.endDate},yield this.eventService.fetchEventList(this.locationNameList,this.artistNameList,this.genreNameList,this.startDate,this.endDate,this.page,this.size),this.eventListSubscription=this.eventService.getEventList().subscribe(s=>{this.events=s.content,this.page++,this.events?.length<this.size&&(this.reachedEnd=!0)})}))}ngOnDestroy(){this.loadingSubscription?.unsubscribe(),this.eventListSubscription?.unsubscribe()}onWindowScroll(){return It(this,null,function*(){let s=window.innerHeight,d=document.documentElement.scrollHeight,m=window.scrollY;!this.reachedEnd&&!this.loading&&m+s>=d-20&&(yield this.loadMoreEvents())})}loadMoreEvents(){return It(this,null,function*(){(yield this.eventService.fetchEventList(this.locationNameList,this.artistNameList,this.genreNameList,this.startDate,this.endDate,this.page,this.size))<this.size&&(this.reachedEnd=!0),this.page++})}openFilterMenu(){this.dialog.open(ej,{width:"60%",height:"70%",data:{location:this.locationNameList,artist:this.artistNameList,genre:this.genreNameList,startDate:this.startDate,endDate:this.endDate}}).afterClosed().subscribe(s=>{if(s===void 0)return;let d={location:s.selectedLocations.join(",")||null,artist:s.selectedArtists.join(",")||null,genre:s.selectedGenres.join(",")||null,startDate:s.selectedStartDate||null,endDate:s.selectedEndDate||null};this.router.navigate(["/events"],{queryParams:d})})}removeFilter(n,s){let d={location:n==="location"?this.locationNameList?.split(",").filter(m=>m!==s).join(",")||null:this.locationNameList,artist:n==="artist"?this.artistNameList?.split(",").filter(m=>m!==s).join(",")||null:this.artistNameList,genre:n==="genre"?this.genreNameList?.split(",").filter(m=>m!==s).join(",")||null:this.genreNameList,startDate:n==="date"?null:this.startDate,endDate:n==="date"?null:this.endDate};this.router.navigate(["/events"],{queryParams:d})}};r.\u0275fac=function(s){return new(s||r)(B(En),B(tn),B($y),B(rp),B(fo))},r.\u0275cmp=Et({type:r,selectors:[["app-event-list"]],hostBindings:function(s,d){s&1&&ct("scroll",function(_){return d.onWindowScroll(_)},!1,bv)},standalone:!0,features:[At],decls:17,vars:6,consts:[[1,"container-fluid"],[1,"title-and-filter","d-flex"],[1,"flex-grow-1"],[1,"btn","btn-light",3,"click"],[1,"fas","fa-filter"],[1,"filter-options","justify-content-end"],["class","option bg-primary",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"row"],["class","col-12",4,"ngIf"],[1,"option","bg-primary"],[1,"btn","btn-light","btn-sm","remove-filter-btn",3,"click"],[1,"fas","fa-times"],[1,"col-12"],["role","button","class","card event-card rounded mb-3 mt-3",3,"routerLink","queryParams",4,"ngFor","ngForOf"],["role","button",1,"card","event-card","rounded","mb-3","mt-3",3,"routerLink","queryParams"],[1,"d-flex","justify-content-center","align-items-center"],[1,"img-fluid","event-image",3,"src","alt"],[1,"card-body"],[1,"card-title"],[1,"card-text","card-date"],[1,"card-text"]],template:function(s,d){s&1&&(A(0,"div",0)(1,"div",1)(2,"h1",2),V(3," Evenimente "),k(),A(4,"button",3),ct("click",function(){return d.openFilterMenu()}),dt(5,"i",4),k()(),A(6,"div",5)(7,"div"),mt(8,Dct,4,1,"div",6),k(),A(9,"div"),mt(10,Tct,4,1,"div",6),k(),A(11,"div"),mt(12,Ict,4,1,"div",6),k(),mt(13,Act,5,2,"div",7),k(),A(14,"div",8),mt(15,kct,3,0,"div",7)(16,Fct,2,1,"div",9),k()()),s&2&&(N(8),Z("ngForOf",d.filter.location),N(2),Z("ngForOf",d.filter.artist),N(2),Z("ngForOf",d.filter.genre),N(),Z("ngIf",d.filter.startDate&&d.filter.endDate),N(2),Z("ngIf",d.events.length==0),N(),Z("ngIf",d.events.length>0))},dependencies:[Ii,ar,qe],styles:[".container-fluid[_ngcontent-%COMP%]{width:90%}.event-card[_ngcontent-%COMP%]{display:flex;flex-direction:row;width:calc(100% - 20px);max-width:100%}.event-card[_ngcontent-%COMP%]:hover{box-shadow:0 0 10px #0003;opacity:.8}.event-image[_ngcontent-%COMP%]{max-height:300px;max-width:200px;height:auto;width:auto}.card-body[_ngcontent-%COMP%]{overflow:hidden}.location-image[_ngcontent-%COMP%]{width:100%}.card-text[_ngcontent-%COMP%]{font-size:16px}@media (max-width: 768px){.card-title[_ngcontent-%COMP%], .card-text[_ngcontent-%COMP%]{font-size:13px}}@media (max-width: 576px){.event-card[_ngcontent-%COMP%]{flex-direction:column;padding-top:10px}.card-title[_ngcontent-%COMP%], .card-text[_ngcontent-%COMP%]{font-size:12px}.image-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.card-title[_ngcontent-%COMP%], .card-date[_ngcontent-%COMP%]{text-align:end}}.filter-options[_ngcontent-%COMP%]{padding:10px;display:flex;flex-wrap:wrap;gap:10px}.option[_ngcontent-%COMP%]{padding:10px;color:#fff;border-radius:5px;cursor:pointer}.remove-filter-btn[_ngcontent-%COMP%]{padding:5px;border-radius:5px;cursor:pointer}"]});let a=r;return a})();var nj=(()=>{let r=class r{constructor(n){this.http=n}getGenres(){return this.http.get(Me+"/broad-genres")}};r.\u0275fac=function(s){return new(s||r)(ht(Gi))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var zct=a=>({genre:a});function Nct(a,r){if(a&1&&(A(0,"div")(1,"div",4)(2,"div",5)(3,"h5",6),V(4),k()()()()),a&2){let l=r.$implicit;N(),Z("routerLink","/events")("queryParams",Xi(3,zct,l.name)),N(3),De(l.name)}}var rj=(()=>{let r=class r{constructor(n){this.genreService=n,this.genres=[]}ngOnInit(){this.genreService.getGenres().subscribe({next:n=>{this.genres=n}})}};r.\u0275fac=function(s){return new(s||r)(B(nj))},r.\u0275cmp=Et({type:r,selectors:[["app-genre-list"]],standalone:!0,features:[At],decls:6,vars:1,consts:[[1,"container-fluid"],[1,"row"],[1,"col-md-12","genre-container"],[4,"ngFor","ngForOf"],[1,"card",3,"routerLink","queryParams"],[1,"card-body"],[1,"card-title","text-center"]],template:function(s,d){s&1&&(A(0,"div",0)(1,"h1"),V(2,"Genuri"),k(),A(3,"div",1)(4,"div",2),mt(5,Nct,5,5,"div",3),k()()()),s&2&&(N(5),Z("ngForOf",d.genres))},dependencies:[Ii,ar],styles:[".genre-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:center;margin-top:20px}.card[_ngcontent-%COMP%]{width:200px;margin:10px;cursor:pointer}"]});let a=r;return a})();var oj=[{path:"home",redirectTo:"",pathMatch:"full"},{path:"login",canActivate:[qu],component:TN},{path:"register",canActivate:[qu],component:IN},{path:"forgot-password",canActivate:[qu],component:AN},{path:"reset-password/:token",canActivate:[qu],component:nV},{path:"account",canActivate:[qg],component:RN,children:[{path:"",pathMatch:"full",component:dV},{path:"orders",component:eV},{path:"orders/:orderNumber",component:sV},{path:"settings",component:iV}]},{path:"admin-dashboard",canActivate:[ON],component:PN,children:[{path:"",pathMatch:"full",component:HN},{path:"home",redirectTo:""},{path:"manage/users",component:f5},{path:"manage/locations",component:g5},{path:"manage/events",component:X5},{path:"manage/artists",component:VV},{path:"manage/orders",component:Q5},{path:"statistics",component:K4},{path:"settings",component:Q4}]},{path:"validator-dashboard",canActivate:[vV],component:gV,children:[{path:"",pathMatch:"full",component:_V},{path:"scanner",component:AV}]},{path:"",canActivate:[FN],component:Yz,children:[{path:"",pathMatch:"full",component:eN},{path:"track",canActivate:[qg],component:mV},{path:"page-not-found",component:J5},{path:"event-details/:event",canActivate:[qg],component:fV},{path:"shopping-cart",canActivate:[qg],component:kN},{path:"verify-account/:token",canActivate:[qu],component:kV},{path:"resend-verify-account-email/:email",canActivate:[qu],component:RV},{path:"events",component:ij},{path:"genres",component:rj},{path:"artists",redirectTo:"artists/A",pathMatch:"full"},{path:"artists/:letter",component:OV},{path:"artist/:artist",component:FV},{path:"location/:location",pathMatch:"full",component:iN},{path:"event/:event",pathMatch:"full",component:EN}]}];var Bct=(()=>{let r=class r extends Rv{constructor(n,s,d){super(n,s,d,oe(xv,{optional:!0}))}ngOnDestroy(){this.flush()}};r.\u0275fac=function(s){return new(s||r)(ht(li),ht(Sf),ht(kv))},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})();function Vct(){return new lL}function jct(a,r,l){return new dL(a,r,l)}var sj=[{provide:kv,useFactory:Vct},{provide:Rv,useClass:Bct},{provide:Yh,useFactory:jct,deps:[nm,Rv,ze]}],Uct=[{provide:Sf,useFactory:()=>new cL},{provide:So,useValue:"BrowserAnimations"},...sj],ekt=[{provide:Sf,useClass:aL},{provide:So,useValue:"NoopAnimations"},...sj];function aj(){return[...Uct]}var Hct="@",Gct=(()=>{let r=class r{constructor(n,s,d,m,_){this.doc=n,this.delegate=s,this.zone=d,this.animationType=m,this.moduleImpl=_,this._rendererFactoryPromise=null,this.scheduler=oe(xv,{optional:!0})}ngOnDestroy(){this._engine?.flush()}loadImpl(){return(this.moduleImpl??import("./chunk-NU56UIBM.js")).catch(s=>{throw new dr(5300,!1)}).then(({\u0275createEngine:s,\u0275AnimationRendererFactory:d})=>{this._engine=s(this.animationType,this.doc,this.scheduler);let m=new d(this.delegate,this._engine,this.zone);return this.delegate=m,m})}createRenderer(n,s){let d=this.delegate.createRenderer(n,s);if(d.\u0275type===0)return d;typeof d.throwOnSyntheticProps=="boolean"&&(d.throwOnSyntheticProps=!1);let m=new ST(d);return s?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(_=>{let w=_.createRenderer(n,s);m.use(w)}).catch(_=>{m.use(d)}),m}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}};r.\u0275fac=function(s){bu()},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})(),ST=class{constructor(r){this.delegate=r,this.replay=[],this.\u0275type=1}use(r){if(this.delegate=r,this.replay!==null){for(let l of this.replay)l(r);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(r,l){return this.delegate.createElement(r,l)}createComment(r){return this.delegate.createComment(r)}createText(r){return this.delegate.createText(r)}get destroyNode(){return this.delegate.destroyNode}appendChild(r,l){this.delegate.appendChild(r,l)}insertBefore(r,l,n,s){this.delegate.insertBefore(r,l,n,s)}removeChild(r,l,n){this.delegate.removeChild(r,l,n)}selectRootElement(r,l){return this.delegate.selectRootElement(r,l)}parentNode(r){return this.delegate.parentNode(r)}nextSibling(r){return this.delegate.nextSibling(r)}setAttribute(r,l,n,s){this.delegate.setAttribute(r,l,n,s)}removeAttribute(r,l,n){this.delegate.removeAttribute(r,l,n)}addClass(r,l){this.delegate.addClass(r,l)}removeClass(r,l){this.delegate.removeClass(r,l)}setStyle(r,l,n,s){this.delegate.setStyle(r,l,n,s)}removeStyle(r,l,n){this.delegate.removeStyle(r,l,n)}setProperty(r,l,n){this.shouldReplay(l)&&this.replay.push(s=>s.setProperty(r,l,n)),this.delegate.setProperty(r,l,n)}setValue(r,l){this.delegate.setValue(r,l)}listen(r,l,n){return this.shouldReplay(l)&&this.replay.push(s=>s.listen(r,l,n)),this.delegate.listen(r,l,n)}shouldReplay(r){return this.replay!==null&&r.startsWith(Hct)}};function lj(a="animations"){return vu([{provide:Yh,useFactory:(r,l,n)=>new Gct(r,l,n,a),deps:[li,nm,ze]},{provide:So,useValue:a==="noop"?"NoopAnimations":"BrowserAnimations"}])}var cj=(()=>{let r=class r{constructor(n){this.loadingService=n}intercept(n,s){return this.loadingService.show(),s.handle(n).pipe(no(d=>d instanceof im?Fe(d).pipe(ff(100)):Fe(d)),RF(d=>d.pipe(Is((m,_)=>_<3&&this.isConnectionError(m)?IF(1e3):Ll(m)))),zl(d=>Ll(d)),nl(()=>{this.loadingService.hide()}))}isConnectionError(n){return n.status==="(failed)net::ERR_CONNECTION_REFUSED"||n.status===0}};r.\u0275fac=function(s){return new(s||r)(ht(rp))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var Me="https://server-backend-xmyv.onrender.com/api",Rx="pk.eyJ1IjoibWF0ZHVtIiwiYSI6ImNsc29uNHdldTBoZ2cycmx6dGU1em0xNngifQ.CNxZncBUud9hmoevWrxSyg",dj={providers:[h3(oj),aj(),xL(wL()),lj(),{provide:VS,useClass:cj,multi:!0},Ly()]};function qct(a,r){a&1&&dt(0,"app-loading")}function Wct(a,r){if(a&1){let l=Ce();A(0,"button",2),ct("click",function(){te(l);let s=vt();return ee(s.scrollToTop())}),dt(1,"i",3),k()}}var uj=(()=>{let r=class r{constructor(n){this.loadingService=n,this.title="Bileteria",this.showScrollButton=!1}ngOnInit(){this.loadingService.loading$.subscribe(n=>{setTimeout(()=>{this.loading=n},0)})}onWindowScroll(n){this.showScrollButton=window.scrollY>600}scrollToTop(){window.scrollTo({top:0,behavior:"smooth"})}};r.\u0275fac=function(s){return new(s||r)(B(rp))},r.\u0275cmp=Et({type:r,selectors:[["app-root"]],hostBindings:function(s,d){s&1&&ct("scroll",function(_){return d.onWindowScroll(_)},!1,bv)},standalone:!0,features:[At],decls:3,vars:2,consts:[[4,"ngIf"],["class","btn scroll-top-button",3,"click",4,"ngIf"],[1,"btn","scroll-top-button",3,"click"],[1,"fa","fa-arrow-up"]],template:function(s,d){s&1&&(mt(0,qct,1,0,"app-loading",0),dt(1,"router-outlet"),mt(2,Wct,2,0,"button",1)),s&2&&(Z("ngIf",d.loading),N(2),Z("ngIf",d.showScrollButton))},dependencies:[Lo,qe,cl,hy],styles:["[_nghost-%COMP%]{position:relative;width:100%;height:100%}.scroll-top-button[_ngcontent-%COMP%]{position:fixed;bottom:40px;right:20px}"]});let a=r;return a})();IL(uj,dj).catch(a=>console.error(a));
