import{$ as ni,$a as XF,$b as Te,A as pv,Aa as bf,Ab as JF,Ac as rL,B as wc,Ba as jo,Bb as Xi,Bc as ci,C as fv,Ca as ht,Cb as Zh,Cc as PS,D as Fo,Da as le,Db as Xh,Dc as Bl,E as kF,Ea as vu,Eb as Kh,Ec as Mv,F as no,Fa as Gh,Fb as T,Fc as Uo,G as pn,Ga as yu,Gb as k,Gc as pi,H as ES,Ha as jF,Hb as dt,Hc as Ve,I as zl,Ia as qh,Ib as br,Ic as oL,J as gu,Ja as Sc,Jb as xr,Jc as sL,K as gv,Ka as Yn,Kb as Ps,Kc as pd,L as MS,La as Nr,Lb as we,Lc as Dv,M as tn,Ma as ol,Mb as Os,Mc as zo,N as RF,Na as mo,Nb as xv,Nc as aL,O as ff,Oa as bu,Ob as ct,Oc as lL,P as gf,Pa as Wh,Pb as wv,Pc as OS,Q as rl,Qa as $h,Qb as gt,Qc as Tv,R as Nl,Ra as UF,Rb as Un,Rc as wr,S as DS,Sa as HF,Sb as Ai,Sc as Sn,T as PF,Ta as GF,Tb as Js,Tc as hi,U as OF,Ua as qF,Ub as Qh,Uc as En,V as FF,Va as WF,Vb as fn,Vc as fd,W as LF,Wa as $F,Wb as ze,Wc as ln,X as TS,Xa as YF,Xb as se,Xc as Iv,Y as _v,Ya as Qs,Yb as ae,Yc as Av,Z as ho,Za as ZF,Zb as oo,_ as ro,_a as Vr,_b as B,a as qt,aa as zF,ab as yv,ac as ie,b as Pi,ba as $r,bb as sl,bc as po,c as wS,ca as dr,cb as xf,cc as tL,cd as cL,d as O$,da as ye,db as z,dc as xn,dd as Sf,e as TF,ea as IS,eb as V,ec as wn,ed as kv,f as Tt,fa as _f,fb as xu,fc as Cn,g as sr,ga as Rt,gb as Mo,gc as ji,h as IF,ha as St,hb as bv,hc as At,i as ya,ia as Si,ib as wf,ic as Ln,j as CS,ja as oe,jb as Yh,jc as xi,jd as dL,k as pf,ka as vv,kb as Lo,kc as Jh,kd as Rv,l as pe,la as Kt,lb as wu,lc as qo,m as We,ma as Qt,mb as Zi,mc as ms,md as uL,n as Ks,na as Rs,nb as Be,nc as AS,o as mv,oa as _u,ob as Do,oc as Cv,p as bc,pa as Ee,pb as Di,pc as Sv,q as Oo,qa as vf,qb as Fn,qc as Ev,r as Fe,ra as NF,rb as KF,rc as kS,rd as hL,s as Ll,sa as kt,sb as QF,sc as Cu,t as Hh,ta as Ei,tb as Cf,tc as RS,u as AF,ua as BF,ub as ut,uc as eL,v as Ne,va as Se,vb as ri,vc as iL,w as Li,wa as yf,wb as W,wc as Qe,x as xc,xa as VF,xb as Ec,xc as ll,y as ks,ya as Cc,yb as li,yc as tm,z as SS,za as Eo,zb as al,zc as nL}from"./chunk-VFVCGMP5.js";var uT=O$((cT,dT)=>{"use strict";(function(a,r){typeof cT=="object"&&typeof dT<"u"?dT.exports=r():typeof define=="function"&&define.amd?define(r):(a=typeof globalThis<"u"?globalThis:a||self,a.mapboxgl=r())})(cT,function(){"use strict";var a,r,l;function n(d,m){if(!a)a=m;else if(!r)r=m;else{var _="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+a+")(sharedChunk); ("+r+")(sharedChunk); self.onerror = null;",w={};a(w),l=m(w),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(l.workerUrl=window.URL.createObjectURL(new Blob([_],{type:"text/javascript"})))}}n(["exports"],function(d){"use strict";var m=typeof self<"u"?self:{},_="3.1.2";let w,S={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(w==null){let e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{w=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):e}catch{w=e}}return w},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!S.API_URL)return null;try{let e=new URL(S.API_URL);return e.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":e.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},I={supported:!1,testSupport:function(e){!q&&H&&(X?it(e):L=e)}},L,H,q=!1,X=!1;function it(e){let t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,H),e.isContextLost())return;I.supported=!0}catch{}e.deleteTexture(t),q=!0}m.document&&(H=m.document.createElement("img"),H.onload=function(){L&&it(L),L=null,X=!0},H.onerror=function(){q=!0,L=null},H.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let at="01";function mt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Mt=Lt;function Lt(e,t,i,o){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(o-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=i,this.p2y=o}Lt.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(t===void 0&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var i=e,o=0;o<8;o++){var c=this.sampleCurveX(i)-e;if(Math.abs(c)<t)return i;var u=this.sampleCurveDerivativeX(i);if(Math.abs(u)<1e-6)break;i-=c/u}var h=0,p=1;for(i=e,o=0;o<20&&(c=this.sampleCurveX(i),!(Math.abs(c-e)<t));o++)e>c?h=i:p=i,i=.5*(p-h)+h;return i},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var Pt=mt(Mt),Nt=ue;function ue(e,t){this.x=e,this.y=t}ue.prototype={clone:function(){return new ue(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,i=e.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),i=Math.sin(e),o=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=o,this},_rotateAround:function(e,t){var i=Math.cos(e),o=Math.sin(e),c=t.y+o*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-o*(this.y-t.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ue.convert=function(e){return e instanceof ue?e:Array.isArray(e)?new ue(e[0],e[1]):e};var Q=mt(Nt);function $t(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!$t(e[i],t[i]))return!1;return!0}if(typeof e=="object"&&e!==null&&t!==null){if(typeof t!="object"||Object.keys(e).length!==Object.keys(t).length)return!1;for(let i in e)if(!$t(e[i],t[i]))return!1;return!0}return e===t}let Ue=Math.PI/180,ki=180/Math.PI;function fe(e){return e*Ue}function ei(e){return e*ki}let Oi=[[0,0],[1,0],[1,1],[0,1]];function Dr(e){if(e<=0)return 0;if(e>=1)return 1;let t=e*e,i=t*e;return 4*(e<.5?i:3*(e-t)+i-.75)}function Ri(e){let t=1/0,i=1/0,o=-1/0,c=-1/0;for(let u of e)t=Math.min(t,u.x),i=Math.min(i,u.y),o=Math.max(o,u.x),c=Math.max(c,u.y);return{min:new Q(t,i),max:new Q(o,c)}}function Gn(e,t,i=0,o=!0){let c=new Q(i,i),u=e.sub(c),h=t.add(c),p=[u,new Q(h.x,u.y),h,new Q(u.x,h.y)];return o&&p.push(u.clone()),p}function _n(e,t,i,o){let c=new Pt(e,t,i,o);return function(u){return c.solve(u)}}let fr=_n(.25,.1,.25,1);function ve(e,t,i){return Math.min(i,Math.max(t,e))}function Wo(e,t,i){return(i=ve((i-e)/(t-e),0,1))*i*(3-2*i)}function ss(e,t,i){let o=i-t,c=((e-t)%o+o)%o+t;return c===t?i:c}function _s(e,t,i){if(!e.length)return i(null,[]);let o=e.length,c=new Array(e.length),u=null;e.forEach((h,p)=>{t(h,(f,g)=>{f&&(u=f),c[p]=g,--o==0&&i(u,c)})})}function qs(e){let t=[];for(let i in e)t.push(e[i]);return t}function ge(e,...t){for(let i of t)for(let o in i)e[o]=i[o];return e}function Go(e,t){let i={};for(let o=0;o<t.length;o++){let c=t[o];c in e&&(i[c]=e[c])}return i}let Hd=1;function Wu(){return Hd++}function Xg(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function Kg(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Qg(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function vo(e,t){e.forEach(i=>{t[i]&&(t[i]=t[i].bind(t))})}function $u(e,t){return e.indexOf(t,e.length-t.length)!==-1}function Yu(e,t,i){let o={};for(let c in e)o[c]=t.call(i||this,e[c],c,e);return o}function Yt(e,t,i){let o={};for(let c in e)t.call(i||this,e[c],c,e)&&(o[c]=e[c]);return o}function K(e){return Array.isArray(e)?e.map(K):typeof e=="object"&&e?Yu(e,K):e}let et={};function lt(e){et[e]||(typeof console<"u"&&console.warn(e),et[e]=!0)}function zt(e,t,i){return(i.y-e.y)*(t.x-e.x)>(t.y-e.y)*(i.x-e.x)}function Vt(e){let t=0;for(let i,o,c=0,u=e.length,h=u-1;c<u;h=c++)i=e[c],o=e[h],t+=(o.x-i.x)*(i.y+o.y);return t}function _e([e,t,i]){let o=fe(t+90),c=fe(i);return{x:e*Math.cos(o)*Math.sin(c),y:e*Math.sin(o)*Math.sin(c),z:e*Math.cos(c),azimuthal:t,polar:i}}function Ae(e,t,i){let o=Math.sqrt(e*e+t*t+i*i),c=o>0?Math.acos(i/o)*ki:0,u=e!==0||t!==0?Math.atan2(-t,-e)*ki+90:0;return u<0&&(u+=360),[o,u,c]}function jt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Pe(e){let t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,o,c,u)=>{let h=c||u;return t[o]=!h||h.toLowerCase(),""}),t["max-age"]){let i=parseInt(t["max-age"],10);isNaN(i)?delete t["max-age"]:t["max-age"]=i}return t}let $e=null;function Ke(){return!!m.document.fullscreenElement||!!m.document.webkitFullscreenElement}function On(e){try{let t=m[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function gr(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function ko(e,t,i){e[4*t+0]=i[0],e[4*t+1]=i[1],e[4*t+2]=i[2],e[4*t+3]=i[3]}function _r(e,t){return[Math.pow(e[0],2.2)*t,Math.pow(e[1],2.2)*t,Math.pow(e[2],2.2)*t]}function Fr(e){return[Math.pow(e[0],1/2.2),Math.pow(e[1],1/2.2),Math.pow(e[2],1/2.2)]}let qn="mapbox-tiles",$o=500,as=50,ls,$a;function Zu(){try{return m.caches}catch{}}function vs(){Zu()&&!ls&&(ls=m.caches.open(qn))}function tc(e){let t=e.indexOf("?");if(t<0)return e;let i=function(c){let u=c.indexOf("?");return u>0?c.slice(u+1).split("&"):[]}(e),o=i.filter(c=>{let u=c.split("=");return u[0]==="language"||u[0]==="worldview"});return o.length?`${e.slice(0,t)}?${o.join("&")}`:e.slice(0,t)}let Bc=1/0;function Xu(e){Bc++,Bc>as&&(e.getActor().send("enforceCacheSizeLimit",$o),Bc=0)}let Dt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Dt);class Ot extends Error{constructor(t,i,o){i===401&&vr(o)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=i,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let Gt=jt()?()=>self.worker&&self.worker.referrer:()=>(m.location.protocol==="blob:"?m.parent:m).location.href,Zt=function(e,t){if(!(/^file:/.test(i=e.url)||/^file:/.test(Gt())&&!/^\w+:/.test(i))){if(m.fetch&&m.Request&&m.AbortController&&m.Request.prototype.hasOwnProperty("signal"))return function(o,c){let u=new m.AbortController,h=new m.Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:Gt(),referrerPolicy:o.referrerPolicy,signal:u.signal}),p=!1,f=!1,g=(v=h.url).indexOf("sku=")>0&&vr(v);var v;o.type==="json"&&h.headers.set("Accept","application/json");let y=(x,C,E)=>{if(f)return;if(x&&x.message!=="SecurityError"&&lt(x.toString()),C&&E)return b(C);let M=Date.now();m.fetch(h).then(D=>{if(D.ok){let A=g?D.clone():null;return b(D,A,M)}return c(new Ot(D.statusText,D.status,o.url))}).catch(D=>{D.name!=="AbortError"&&c(new Error(`${D.message} ${o.url}`))})},b=(x,C,E)=>{(o.type==="arrayBuffer"?x.arrayBuffer():o.type==="json"?x.json():x.text()).then(M=>{f||(C&&E&&function(D,A,P){if(vs(),!ls)return;let O={status:A.status,statusText:A.statusText,headers:new m.Headers};A.headers.forEach((N,j)=>O.headers.set(j,N));let R=Pe(A.headers.get("Cache-Control")||"");if(R["no-store"])return;R["max-age"]&&O.headers.set("Expires",new Date(P+1e3*R["max-age"]).toUTCString());let F=O.headers.get("Expires");F&&(new Date(F).getTime()-P<42e4||function(N,j){if($a===void 0)try{new Response(new ReadableStream),$a=!0}catch{$a=!1}$a?j(N.body):N.blob().then(j)}(A,N=>{let j=new m.Response(N,O);vs(),ls&&ls.then(U=>U.put(tc(D.url),j)).catch(U=>lt(U.message))}))}(h,C,E),p=!0,c(null,M,x.headers.get("Cache-Control"),x.headers.get("Expires")))}).catch(M=>{f||c(new Error(M.message))})};return g?function(x,C){if(vs(),!ls)return C(null);let E=tc(x.url);ls.then(M=>{M.match(E).then(D=>{let A=function(P){if(!P)return!1;let O=new Date(P.headers.get("Expires")||0),R=Pe(P.headers.get("Cache-Control")||"");return O>Date.now()&&!R["no-cache"]}(D);M.delete(E),A&&M.put(E,D.clone()),C(null,D,A)}).catch(C)}).catch(C)}(h,y):y(null,null),{cancel:()=>{f=!0,p||u.abort()}}}(e,t);if(jt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var i;return function(o,c){let u=new m.XMLHttpRequest;u.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(let h in o.headers)u.setRequestHeader(h,o.headers[h]);return o.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=o.credentials==="include",u.onerror=()=>{c(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let h=u.response;if(o.type==="json")try{h=JSON.parse(u.response)}catch(p){return c(p)}c(null,h,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else c(new Ot(u.statusText,u.status,o.url))},u.send(o.body),{cancel:()=>u.abort()}}(e,t)},Xt=function(e,t){return Zt(ge(e,{type:"json"}),t)},ne=function(e,t){return Zt(ge(e,{type:"arrayBuffer"}),t)};function ce(e){let t=m.document.createElement("a");return t.href=e,t.protocol===m.document.location.protocol&&t.host===m.document.location.host}let Jt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Me,re;Me=[],re=0;let fi=function(e,t){if(I.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),re>=S.MAX_PARALLEL_IMAGE_REQUESTS){let u={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Me.push(u),u}re++;let i=!1,o=()=>{if(!i)for(i=!0,re--;Me.length&&re<S.MAX_PARALLEL_IMAGE_REQUESTS;){let u=Me.shift(),{requestParameters:h,callback:p,cancelled:f}=u;f||(u.cancel=fi(h,p).cancel)}},c=ne(e,(u,h,p,f)=>{o(),u?t(u):h&&(m.createImageBitmap?function(g,v){let y=new m.Blob([new Uint8Array(g)],{type:"image/png"});m.createImageBitmap(y).then(b=>{v(null,b)}).catch(b=>{v(new Error(`Could not load image because of ${b.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(h,(g,v)=>t(g,v,p,f)):function(g,v){let y=new m.Image,b=m.URL;y.onload=()=>{v(null,y),b.revokeObjectURL(y.src),y.onload=null,m.requestAnimationFrame(()=>{y.src=Jt})},y.onerror=()=>v(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let x=new m.Blob([new Uint8Array(g)],{type:"image/png"});y.src=g.byteLength?b.createObjectURL(x):Jt}(h,(g,v)=>t(g,v,p,f)))});return{cancel:()=>{c.cancel(),o()}}},vn="NO_ACCESS_TOKEN";class Oe{constructor(t,i,o){this._transformRequestFn=t,this._customAccessToken=i,this._silenceAuthErrors=!!o,this._createSkuToken()}_createSkuToken(){let t=function(){let i="";for(let o=0;o<10;o++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",at,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,i){return this._transformRequestFn&&this._transformRequestFn(t,i)||{url:t}}normalizeStyleURL(t,i){if(!cn(t))return t;let o=yo(t);return o.params.push(`sdk=js-${_}`),o.path=`/styles/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||i)}normalizeGlyphsURL(t,i){if(!cn(t))return t;let o=yo(t);return o.path=`/fonts/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||i)}normalizeModelURL(t,i){if(!cn(t))return t;let o=yo(t);return o.path=`/models/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||i)}normalizeSourceURL(t,i,o,c){if(!cn(t))return t;let u=yo(t);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),o&&u.params.push(`language=${o}`),c&&u.params.push(`worldview=${c}`),this._makeAPIURL(u,this._customAccessToken||i)}normalizeSpriteURL(t,i,o,c){let u=yo(t);return cn(t)?(u.path=`/styles/v1${u.path}/sprite${i}${o}`,this._makeAPIURL(u,this._customAccessToken||c)):(u.path+=`${i}${o}`,cs(u))}normalizeTileURL(t,i,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!cn(t))return t;let c=yo(t);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||o&&c.authority!=="raster"&&o===512?"@2x":""}${I.supported?".webp":"$1"}`),c.authority==="raster"?c.path=`/${S.RASTER_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${S.TILE_URL_VERSION}${c.path}`);let u=this._customAccessToken||function(h){for(let p of h){let f=p.match(/^access_token=(.*)$/);if(f)return f[1]}return null}(c.params)||S.ACCESS_TOKEN;return S.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,u)}canonicalizeTileURL(t,i){let o=yo(t);if(!o.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!o.path.match(/\.[\w]+$/))return t;let c="mapbox://";o.path.match(/^\/raster\/v1\//)?c+=`raster/${o.path.replace(`/${S.RASTER_URL_PREFIX}/`,"")}`:c+=`tiles/${o.path.replace(`/${S.TILE_URL_VERSION}/`,"")}`;let u=o.params;return i&&(u=u.filter(h=>!h.match(/^access_token=/))),u.length&&(c+=`?${u.join("&")}`),c}canonicalizeTileset(t,i){let o=!!i&&cn(i),c=[];for(let u of t.tiles||[])vr(u)?c.push(this.canonicalizeTileURL(u,o)):c.push(u);return c}_makeAPIURL(t,i){let o="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",c=yo(S.API_URL);if(t.protocol=c.protocol,t.authority=c.authority,t.protocol==="http"){let u=t.params.indexOf("secure");u>=0&&t.params.splice(u,1)}if(c.path!=="/"&&(t.path=`${c.path}${t.path}`),!S.REQUIRE_ACCESS_TOKEN)return cs(t);if(i=i||S.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${o}`);if(i[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${o}`)}return t.params=t.params.filter(u=>u.indexOf("access_token")===-1),t.params.push(`access_token=${i||""}`),cs(t)}}function cn(e){return e.indexOf("mapbox:")===0}function vr(e){return S.API_URL_REGEX.test(e)}function Lr(e){return S.API_CDN_URL_REGEX.test(e)}function Jr(e){return S.API_STYLE_REGEX.test(e)&&!Yo(e)}function Yo(e){return S.API_SPRITE_REGEX.test(e)}let la=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function yo(e){let t=e.match(la);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function cs(e){let t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}let Zo="mapbox.eventData";function Ku(e){if(!e)return null;let t=e.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(m.atob(t[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Vc{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){let i=Ku(S.ACCESS_TOKEN),o="";return o=i&&i.u?m.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(c,u)=>String.fromCharCode(+("0x"+u)))):S.ACCESS_TOKEN||"",t?`${Zo}.${t}:${o}`:`${Zo}:${o}`}fetchEventData(){let t=On("localStorage"),i=this.getStorageKey(),o=this.getStorageKey("uuid");if(t)try{let c=m.localStorage.getItem(i);c&&(this.eventData=JSON.parse(c));let u=m.localStorage.getItem(o);u&&(this.anonId=u)}catch{lt("Unable to read from LocalStorage")}}saveEventData(){let t=On("localStorage"),i=this.getStorageKey(),o=this.getStorageKey("uuid");if(t)try{m.localStorage.setItem(o,this.anonId),Object.keys(this.eventData).length>=1&&m.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{lt("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,i,o,c){if(!S.EVENTS_URL)return;let u=yo(S.EVENTS_URL);u.params.push(`access_token=${c||S.ACCESS_TOKEN||""}`);let h={event:this.type,created:new Date(t).toISOString()},p=i?ge(h,i):h,f={url:cs(u),headers:{"Content-Type":"text/plain"},body:JSON.stringify([p])};this.pendingRequest=function(g,v){return Zt(ge(g,{method:"POST"}),v)}(f,g=>{this.pendingRequest=null,o(g),this.saveEventData(),this.processRequests(c)})}queueRequest(t,i){this.queue.push(t),this.processRequests(i)}}let Qu=new class extends Vc{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){S.EVENTS_URL&&S.ACCESS_TOKEN&&Array.isArray(e)&&e.some(i=>cn(i)||vr(i))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let t=Ku(S.ACCESS_TOKEN),i=t?t.u:S.ACCESS_TOKEN,o=i!==this.eventData.tokenU;Qg(this.anonId)||(this.anonId=Xg(),o=!0);let c=this.queue.shift();if(this.eventData.lastSuccess){let u=new Date(this.eventData.lastSuccess),h=new Date(c),p=(c-this.eventData.lastSuccess)/864e5;o=o||p>=1||p<-1||u.getDate()!==h.getDate()}else o=!0;o?this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:_,skuId:at,"enabled.telemetry":!1,userId:this.anonId},u=>{u||(this.eventData.lastSuccess=c,this.eventData.tokenU=i)},e):this.processRequests()}},zx=Qu.postTurnstileEvent.bind(Qu),DT=new class extends Vc{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,i,o){this.skuToken=t,this.errorCb=o,S.EVENTS_URL&&(i||S.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(vn)))}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;let{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),Qg(this.anonId)||(this.anonId=Xg()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:_,skuId:at,skuToken:this.skuToken,userId:this.anonId},o=>{o?this.errorCb(o):t&&(this.success[t]=!0)},e))}},gj=DT.postMapLoadEvent.bind(DT),TT=new class extends Vc{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){S.EVENTS_URL&&(e||S.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:t,performanceData:i}=this.queue.shift(),o=function(c){let u=m.performance.getEntriesByType("resource"),h=m.performance.getEntriesByType("mark"),p=function(b){let x={};if(b){for(let C in b)if(C!=="other")for(let E of b[C]){let M=`${C}ResolveRangeMin`,D=`${C}ResolveRangeMax`,A=`${C}RequestCount`,P=`${C}RequestCachedCount`;x[M]=Math.min(x[M]||1/0,E.startTime),x[D]=Math.max(x[D]||-1/0,E.responseEnd);let O=R=>{x[R]===void 0&&(x[R]=0),++x[R]};E.transferSize!==void 0&&E.transferSize===0&&O(P),O(A)}}return x}(function(b,x){let C={};if(b)for(let E of b){let M=x(E);C[M]===void 0&&(C[M]=[]),C[M].push(E)}return C}(u,yj)),f=m.devicePixelRatio,g=m.navigator.connection||m.navigator.mozConnection||m.navigator.webkitConnection,v={counters:[],metadata:[],attributes:[]},y=(b,x,C)=>{C!=null&&b.push({name:x,value:C.toString()})};for(let b in p)y(v.counters,b,p[b]);if(c.interactionRange[0]!==1/0&&c.interactionRange[1]!==-1/0&&(y(v.counters,"interactionRangeMin",c.interactionRange[0]),y(v.counters,"interactionRangeMax",c.interactionRange[1])),h)for(let b of Object.keys(t_)){let x=t_[b],C=h.find(E=>E.name===x);C&&y(v.counters,x,C.startTime)}return y(v.counters,"visibilityHidden",c.visibilityHidden),y(v.attributes,"style",function(b){if(b)for(let x of b){let C=x.name.split("?")[0];if(Jr(C)){let E=C.split("/").slice(-2);if(E.length===2)return`mapbox://styles/${E[0]}/${E[1]}`}}}(u)),y(v.attributes,"terrainEnabled",c.terrainEnabled?"true":"false"),y(v.attributes,"fogEnabled",c.fogEnabled?"true":"false"),y(v.attributes,"projection",c.projection),y(v.attributes,"zoom",c.zoom),y(v.metadata,"devicePixelRatio",f),y(v.metadata,"connectionEffectiveType",g?g.effectiveType:void 0),y(v.metadata,"navigatorUserAgent",m.navigator.userAgent),y(v.metadata,"screenWidth",m.screen.width),y(v.metadata,"screenHeight",m.screen.height),y(v.metadata,"windowWidth",m.innerWidth),y(v.metadata,"windowHeight",m.innerHeight),y(v.metadata,"mapWidth",c.width/f),y(v.metadata,"mapHeight",c.height/f),y(v.metadata,"webglRenderer",c.renderer),y(v.metadata,"webglVendor",c.vendor),y(v.metadata,"sdkVersion",_),y(v.metadata,"sdkIdentifier","mapbox-gl-js"),v}(i);for(let c of o.metadata);for(let c of o.counters);for(let c of o.attributes);this.postEvent(t,o,()=>{},e)}},_j=TT.postPerformanceEvent.bind(TT),IT=new class extends Vc{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,i,o){if(!S.API_URL||!S.SESSION_PATH)return;let c=yo(S.API_URL+S.SESSION_PATH);c.params.push(`sku=${t||""}`),c.params.push(`access_token=${o||S.ACCESS_TOKEN||""}`);let u={url:cs(c),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(h,p){return Zt(ge(h,{method:"GET"}),p)}(u,h=>{this.pendingRequest=null,i(h),this.saveEventData(),this.processRequests(o)})}getSessionAPI(e,t,i,o){this.skuToken=t,this.errorCb=o,S.SESSION_PATH&&S.API_URL&&(i||S.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(vn)))}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;let{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||this.getSession(i,this.skuToken,o=>{o?this.errorCb(o):t&&(this.success[t]=!0)},e)}},vj=IT.getSessionAPI.bind(IT),Jg=new Set;function AT(e,t){t?Jg.add(e):Jg.delete(e)}let t_={create:"create",load:"load",fullLoad:"fullLoad"},kT={mark(e){m.performance.mark(e)},measure(e,t,i){m.performance.measure(e,t,i)}};function yj(e){let t=e.name.split("?")[0];return Lr(t)&&t.includes("mapbox-gl.js")?"javascript":Lr(t)&&t.includes("mapbox-gl.css")?"css":function(i){return S.API_FONTS_REGEX.test(i)}(t)?"fontRange":Yo(t)?"sprite":Jr(t)?"style":function(i){return S.API_TILEJSON_REGEX.test(i)}(t)?"tilejson":"other"}let bj=m.performance;function RT(e){let t=e?e.url.toString():void 0;return bj.getEntriesByName(t)}var PT=Nx;function Nx(e){return!function(t){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var o,c,u=new Blob([""],{type:"text/javascript"}),h=URL.createObjectURL(u);try{c=new Worker(h),o=!0}catch{o=!1}return c&&c.terminate(),URL.revokeObjectURL(h),o}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var o=document.createElement("canvas");o.width=o.height=1;var c=o.getContext("2d");if(!c)return!1;var u=c.getImageData(0,0,1,1);return u&&u.width===o.width}()?(Bx[i=t&&t.failIfMajorPerformanceCaveat]===void 0&&(Bx[i]=function(o){var c,u=function(h){var p=document.createElement("canvas"),f=Object.create(Nx.webGLContextAttributes);return f.failIfMajorPerformanceCaveat=h,p.getContext("webgl",f)||p.getContext("experimental-webgl",f)}(o);if(!u)return!1;try{c=u.createShader(u.VERTEX_SHADER)}catch{return!1}return!(!c||u.isContextLost())&&(u.shaderSource(c,"void main() {}"),u.compileShader(c),u.getShaderParameter(c,u.COMPILE_STATUS)===!0)}(i)),Bx[i]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var i}(e)}var Bx={};let Vx,e_,jx,i_,Gd;function OT(){return Vx==null&&(Vx=m.OffscreenCanvas&&new m.OffscreenCanvas(1,1).getContext("2d")&&typeof m.createImageBitmap=="function"),Vx}Nx.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let ii={now:()=>i_!==void 0?i_:m.performance.now(),setNow(e){i_=e},restoreNow(){i_=void 0},frame(e){let t=m.requestAnimationFrame(e);return{cancel:()=>m.cancelAnimationFrame(t)}},getImageData(e,t=0){let{width:i,height:o}=e;Gd||(Gd=m.document.createElement("canvas"));let c=Gd.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(i>Gd.width||o>Gd.height)&&(Gd.width=i,Gd.height=o),c.clearRect(-t,-t,i+2*t,o+2*t),c.drawImage(e,0,0,i,o),c.getImageData(-t,-t,i+2*t,o+2*t)},resolveURL:e=>(e_||(e_=m.document.createElement("a")),e_.href=e,e_.href),get devicePixelRatio(){return m.devicePixelRatio},get prefersReducedMotion(){return!!m.matchMedia&&(jx==null&&(jx=m.matchMedia("(prefers-reduced-motion: reduce)")),jx.matches)},hasCanvasFingerprintNoise(){if(!OT())return!1;let e=new m.OffscreenCanvas(85,1),t=e.getContext("2d",{willReadFrequently:!0}),i=0;for(let c=0;c<e.width;++c)t.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,t.fillRect(c,0,1,1);let o=t.getImageData(0,0,e.width,e.height);i=0;for(let c=0;c<o.data.length;++c)if(c%4!=3&&i++!==o.data[c])return!0;return!1}};function Rn(e,t,i){let o=m.document.createElement(e);return t!==void 0&&(o.className=t),i&&i.appendChild(o),o}function ec(e,t,i){let o=m.document.createElementNS("http://www.w3.org/2000/svg",e);for(let c of Object.keys(t))o.setAttributeNS(null,c,t[c]);return i&&i.appendChild(o),o}let qd=m.document&&m.document.documentElement.style,op=qd&&qd.userSelect!==void 0?"userSelect":"WebkitUserSelect",FT;function LT(){qd&&op&&(FT=qd[op],qd[op]="none")}function zT(){qd&&op&&(qd[op]=FT)}function Ux(e){e.preventDefault(),e.stopPropagation(),m.removeEventListener("click",Ux,!0)}function Hx(){m.addEventListener("click",Ux,!0),m.setTimeout(()=>{m.removeEventListener("click",Ux,!0)},0)}function sp(e,t){let i=e.getBoundingClientRect();return BT(e,i,t)}function n_(e,t){let i=e.getBoundingClientRect(),o=[];for(let c=0;c<t.length;c++)o.push(BT(e,i,t[c]));return o}function NT(e){return m.InstallTrigger!==void 0&&e.button===2&&e.ctrlKey&&m.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button}function BT(e,t,i){let o=e.offsetWidth===t.width?1:e.offsetWidth/t.width;return new Q((i.clientX-t.left)*o,(i.clientY-t.top)*o)}function VT(e,t,i){i[e]&&i[e].indexOf(t)!==-1||(i[e]=i[e]||[],i[e].push(t))}function Gx(e,t,i){if(i&&i[e]){let o=i[e].indexOf(t);o!==-1&&i[e].splice(o,1)}}class Wt{constructor(t,i={}){ge(this,i),this.type=t}}class Xe extends Wt{constructor(t,i={}){super("error",ge({error:t},i))}}class Hr{on(t,i){return this._listeners=this._listeners||{},VT(t,i,this._listeners),this}off(t,i){return Gx(t,i,this._listeners),Gx(t,i,this._oneTimeListeners),this}once(t,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},VT(t,i,this._oneTimeListeners),this):new Promise(o=>this.once(t,o))}fire(t,i){typeof t=="string"&&(t=new Wt(t,i||{}));let o=t.type;if(this.listens(o)){t.target=this;let c=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(let p of c)p.call(this,t);let u=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(let p of u)Gx(o,p,this._oneTimeListeners),p.call(this,t);let h=this._eventedParent;h&&(ge(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),h.fire(t))}else t instanceof Xe&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,i){return this._eventedParent=t,this._eventedParentData=i,this}}var _t=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class xe{constructor(t,i,o,c){this.message=(t?`${t}: `:"")+o,c&&(this.identifier=c),i!=null&&i.__line__&&(this.line=i.__line__)}}class Wd extends xe{}function ic(e,...t){for(let i of t)for(let o in i)e[o]=i[o];return e}function to(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function nc(e){if(Array.isArray(e))return e.map(nc);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){let t={};for(let i in e)t[i]=nc(e[i]);return t}return to(e)}class xj extends Error{constructor(t,i){super(i),this.message=i,this.key=t}}var xl=xj;class qx{constructor(t,i=[]){this.parent=t,this.bindings={};for(let[o,c]of i)this.bindings[o]=c}concat(t){return new qx(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var wj=qx;let Ju={kind:"null"},he={kind:"number"},Wi={kind:"string"},Qi={kind:"boolean"},ca={kind:"color"},th={kind:"object"},Yi={kind:"value"},r_={kind:"collator"},ap={kind:"formatted"},lp={kind:"resolvedImage"};function ys(e,t){return{kind:"array",itemType:e,N:t}}function Gr(e){if(e.kind==="array"){let t=Gr(e.itemType);return typeof e.N=="number"?`array<${t}, ${e.N}>`:e.itemType.kind==="value"?"array":`array<${t}>`}return e.kind}let Cj=[Ju,he,Wi,Qi,ca,ap,th,ys(Yi),lp];function cp(e,t){if(t.kind==="error")return null;if(e.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!cp(e.itemType,t.itemType))&&(typeof e.N!="number"||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind==="value"){for(let i of Cj)if(!cp(i,t))return null}}return`Expected ${Gr(e)} but found ${Gr(t)} instead.`}function Wx(e,t){return t.some(i=>i.kind===e.kind)}function dp(e,t){return t.some(i=>i==="null"?e===null:i==="array"?Array.isArray(e):i==="object"?e&&!Array.isArray(e)&&typeof e=="object":i===typeof e)}var $x,jT={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function o_(e){return(e=Math.round(e))<0?0:e>255?255:e}function Yx(e){return o_(e[e.length-1]==="%"?parseFloat(e)/100*255:parseInt(e))}function s_(e){return(t=e[e.length-1]==="%"?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function Zx(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{$x={}.parseCSSColor=function(e){var t,i=e.replace(/ /g,"").toLowerCase();if(i in jT)return jT[i].slice();if(i[0]==="#")return i.length===4?(t=parseInt(i.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:i.length===7&&(t=parseInt(i.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var o=i.indexOf("("),c=i.indexOf(")");if(o!==-1&&c+1===i.length){var u=i.substr(0,o),h=i.substr(o+1,c-(o+1)).split(","),p=1;switch(u){case"rgba":if(h.length!==4)return null;p=s_(h.pop());case"rgb":return h.length!==3?null:[Yx(h[0]),Yx(h[1]),Yx(h[2]),p];case"hsla":if(h.length!==4)return null;p=s_(h.pop());case"hsl":if(h.length!==3)return null;var f=(parseFloat(h[0])%360+360)%360/360,g=s_(h[1]),v=s_(h[2]),y=v<=.5?v*(g+1):v+g-v*g,b=2*v-y;return[o_(255*Zx(b,y,f+1/3)),o_(255*Zx(b,y,f)),o_(255*Zx(b,y,f-1/3)),p];default:return null}}return null}}catch{}class bs{constructor(t,i,o,c=1){this.r=t,this.g=i,this.b=o,this.a=c}static parse(t){if(!t)return;if(t instanceof bs)return t;if(typeof t!="string")return;let i=$x(t);return i?new bs(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){let[t,i,o,c]=this.toArray();return`rgba(${Math.round(t)},${Math.round(i)},${Math.round(o)},${c})`}toArray(){let{r:t,g:i,b:o,a:c}=this;return c===0?[0,0,0,0]:[255*t/c,255*i/c,255*o/c,c]}toArray01(){let{r:t,g:i,b:o,a:c}=this;return c===0?[0,0,0,0]:[t/c,i/c,o/c,c]}toArray01Scaled(t){let{r:i,g:o,b:c,a:u}=this;return u===0?[0,0,0]:[i/u*t,o/u*t,c/u*t]}toArray01PremultipliedAlpha(){let{r:t,g:i,b:o,a:c}=this;return[t,i,o,c]}toArray01Linear(){let{r:t,g:i,b:o,a:c}=this;return c===0?[0,0,0,0]:[Math.pow(t/c,2.2),Math.pow(i/c,2.2),Math.pow(o/c,2.2),c]}}bs.black=new bs(0,0,0,1),bs.white=new bs(1,1,1,1),bs.transparent=new bs(0,0,0,0),bs.red=new bs(1,0,0,1),bs.blue=new bs(0,0,1,1);var _i=bs;class Xx{constructor(t,i,o){this.sensitivity=t?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,i){return this.collator.compare(t,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Kx{constructor(t,i,o,c,u){this.text=t.normalize?t.normalize():t,this.image=i,this.scale=o,this.fontStack=c,this.textColor=u}}class xs{constructor(t){this.sections=t}static fromString(t){return new xs([new Kx(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.namePrimary.length!==0)}static factory(t){return t instanceof xs?t:xs.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){let t=["format"];for(let i of this.sections){if(i.image){t.push(["image",i.image.namePrimary]);continue}t.push(i.text);let o={};i.fontStack&&(o["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(o["font-scale"]=i.scale),i.textColor&&(o["text-color"]=["rgba"].concat(i.textColor.toArray())),t.push(o)}return t}}class da{constructor(t){this.namePrimary=t.namePrimary,t.nameSecondary&&(this.nameSecondary=t.nameSecondary),this.available=t.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(t,i){return t?new da({namePrimary:t,nameSecondary:i,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function UT(e,t,i,o){return typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[e,t,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[e,t,i,o]:[e,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function eh(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof _i||e instanceof Xx||e instanceof xs||e instanceof da)return!0;if(Array.isArray(e)){for(let t of e)if(!eh(t))return!1;return!0}if(typeof e=="object"){for(let t in e)if(!eh(e[t]))return!1;return!0}return!1}function bo(e){if(e===null)return Ju;if(typeof e=="string")return Wi;if(typeof e=="boolean")return Qi;if(typeof e=="number")return he;if(e instanceof _i)return ca;if(e instanceof Xx)return r_;if(e instanceof xs)return ap;if(e instanceof da)return lp;if(Array.isArray(e)){let t=e.length,i;for(let o of e){let c=bo(o);if(i){if(i===c)continue;i=Yi;break}i=c}return ys(i||Yi,t)}return th}function up(e){let t=typeof e;return e===null?"":t==="string"||t==="number"||t==="boolean"?String(e):e instanceof _i||e instanceof xs||e instanceof da?e.toString():JSON.stringify(e)}class Qx{constructor(t,i){this.type=t,this.value=i}static parse(t,i){if(t.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!eh(t[1]))return i.error("invalid value");let o=t[1],c=bo(o),u=i.expectedType;return c.kind!=="array"||c.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(c=u),new Qx(c,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof _i?["rgba"].concat(this.value.toArray()):this.value instanceof xs?this.value.serialize():this.value}}var hp=Qx,Ro=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};let Jx={string:Wi,number:he,boolean:Qi,object:th};class t1{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let o,c=1,u=t[0];if(u==="array"){let p,f;if(t.length>2){let g=t[1];if(typeof g!="string"||!(g in Jx)||g==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);p=Jx[g],c++}else p=Yi;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return i.error('The length argument to "array" must be a positive integer literal',2);f=t[2],c++}o=ys(p,f)}else o=Jx[u];let h=[];for(;c<t.length;c++){let p=i.parse(t[c],c,Yi);if(!p)return null;h.push(p)}return new t1(o,h)}evaluate(t){for(let i=0;i<this.args.length;i++){let o=this.args[i].evaluate(t);if(!cp(this.type,bo(o)))return o;if(i===this.args.length-1)throw new Ro(`Expected value to be of type ${Gr(this.type)}, but found ${Gr(bo(o))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){let t=this.type,i=[t.kind];if(t.kind==="array"){let o=t.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){i.push(o.kind);let c=t.N;(typeof c=="number"||this.args.length>1)&&i.push(c)}}return i.concat(this.args.map(o=>o.serialize()))}}var rc=t1;class mp{constructor(t){this.type=ap,this.sections=t}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let o=t[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");let c=[],u=!1;for(let h=1;h<=t.length-1;++h){let p=t[h];if(u&&typeof p=="object"&&!Array.isArray(p)){u=!1;let f=null;if(p["font-scale"]&&(f=i.parse(p["font-scale"],1,he),!f))return null;let g=null;if(p["text-font"]&&(g=i.parse(p["text-font"],1,ys(Wi)),!g))return null;let v=null;if(p["text-color"]&&(v=i.parse(p["text-color"],1,ca),!v))return null;let y=c[c.length-1];y.scale=f,y.font=g,y.textColor=v}else{let f=i.parse(t[h],1,Yi);if(!f)return null;let g=f.type.kind;if(g!=="string"&&g!=="value"&&g!=="null"&&g!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,c.push({content:f,scale:null,font:null,textColor:null})}}return new mp(c)}evaluate(t){return new xs(this.sections.map(i=>{let o=i.content.evaluate(t);return bo(o)===lp?new Kx("",o,null,null,null):new Kx(up(o),null,i.scale?i.scale.evaluate(t):null,i.font?i.font.evaluate(t).join(","):null,i.textColor?i.textColor.evaluate(t):null)}))}eachChild(t){for(let i of this.sections)t(i.content),i.scale&&t(i.scale),i.font&&t(i.font),i.textColor&&t(i.textColor)}outputDefined(){return!1}serialize(){let t=["format"];for(let i of this.sections){t.push(i.content.serialize());let o={};i.scale&&(o["font-scale"]=i.scale.serialize()),i.font&&(o["text-font"]=i.font.serialize()),i.textColor&&(o["text-color"]=i.textColor.serialize()),t.push(o)}return t}}class pp{constructor(t,i){this.type=lp,this.inputPrimary=t,this.inputSecondary=i}static parse(t,i){if(t.length<2)return i.error("Expected two or more arguments.");let o=i.parse(t[1],1,Wi);if(!o)return i.error("No image name provided.");if(t.length===2)return new pp(o);let c=i.parse(t[2],1,Wi);return c?new pp(o,c):i.error("Secondary image variant is not a string.")}evaluate(t){let i=da.fromString(this.inputPrimary.evaluate(t),this.inputSecondary?this.inputSecondary.evaluate(t):void 0);return i&&t.availableImages&&(i.available=t.availableImages.indexOf(i.namePrimary)>-1,i.nameSecondary&&i.available&&t.availableImages&&(i.available=t.availableImages.indexOf(i.nameSecondary)>-1)),i}eachChild(t){t(this.inputPrimary),this.inputSecondary&&t(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function dn(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}let Sj={"to-boolean":Qi,"to-color":ca,"to-number":he,"to-string":Wi};class e1{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let o=t[0],c=[],u=Ju;if(o==="to-array"){if(!Array.isArray(t[1]))return null;let h=t[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);u=ys(i.expectedType.itemType,h)}else{if(!(h>0&&eh(t[1][0])))return null;u=ys(bo(t[1][0]),h)}for(let p=0;p<h;p++){let f=t[1][p],g;if(dn(f)==="array")g=i.parse(f,void 0,u.itemType);else{let v=dn(f);if(v!==u.itemType.kind)return i.error(`Expected ${u.itemType.kind} but found ${v}.`);g=i.registry.literal.parse(["literal",f===void 0?null:f],i)}if(!g)return null;c.push(g)}}else{if((o==="to-boolean"||o==="to-string")&&t.length!==2)return i.error("Expected one argument.");u=Sj[o];for(let h=1;h<t.length;h++){let p=i.parse(t[h],h,Yi);if(!p)return null;c.push(p)}}return new e1(u,c)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let i,o;for(let c of this.args){if(i=c.evaluate(t),o=null,i instanceof _i)return i;if(typeof i=="string"){let u=t.parseColor(i);if(u)return u}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:UT(i[0],i[1],i[2],i[3]),!o))return new _i(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Ro(o||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(let o of this.args){if(i=o.evaluate(t),i===null)return 0;let c=Number(i);if(!isNaN(c))return c}throw new Ro(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?xs.fromString(up(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?da.fromString(up(this.args[0].evaluate(t))):this.type.kind==="array"?this.args.map(i=>i.evaluate(t)):up(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new mp([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new pp(this.args[0]).serialize();let t=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{t.push(i.serialize())}),t}}var $d=e1;let Ej=["Unknown","Point","LineString","Polygon"];var HT=class{constructor(e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.options=e}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ej[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:i,y:o}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*t-e[0])+this.featureDistanceData.bearing[1]*(o*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=_i.parse(e)),t}getConfig(e){return this.options?this.options.get(e):null}};class Yd{constructor(t,i,o,c,u){this.name=t,this.type=i,this._evaluate=o,this.args=c,this._overloadIndex=u}evaluate(t){if(!this._evaluate){let i=Yd.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,i){let o=t[0],c=Yd.definitions[o];if(!c)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);let u=Array.isArray(c)?c[0]:c.type,h=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,p=[],f=null,g=-1;for(let[v,y]of h){if(Array.isArray(v)&&v.length!==t.length-1)continue;p.push(v),g++,f=new sI(i.registry,i.path,null,i.scope,void 0,i.options);let b=[],x=!1;for(let C=1;C<t.length;C++){let E=t[C],M=Array.isArray(v)?v[C-1]:v.type,D=f.parse(E,1+b.length,M);if(!D){x=!0;break}b.push(D)}if(!x)if(Array.isArray(v)&&v.length!==b.length)f.error(`Expected ${v.length} arguments, but found ${b.length} instead.`);else{for(let C=0;C<b.length;C++){let E=Array.isArray(v)?v[C]:v.type,M=b[C];f.concat(C+1).checkSubtype(E,M.type)}if(f.errors.length===0)return new Yd(o,u,y,b,g)}}if(p.length===1)i.errors.push(...f.errors);else{let v=(p.length?p:h.map(([b])=>b)).map(Mj).join(" | "),y=[];for(let b=1;b<t.length;b++){let x=i.parse(t[b],1+y.length);if(!x)return null;y.push(Gr(x.type))}i.error(`Expected arguments of type ${v}, but found (${y.join(", ")}) instead.`)}return null}static register(t,i){Yd.definitions=i;for(let o in i)t[o]=Yd}}function Mj(e){return Array.isArray(e)?`(${e.map(Gr).join(", ")})`:`(${Gr(e.type)}...)`}var wl=Yd;class a_{constructor(t,i,o){this.type=r_,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=i}static parse(t,i){if(t.length!==2)return i.error("Expected one argument.");let o=t[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");let c=i.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Qi);if(!c)return null;let u=i.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Qi);if(!u)return null;let h=null;return o.locale&&(h=i.parse(o.locale,1,Wi),!h)?null:new a_(c,u,h)}evaluate(t){return new Xx(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){let t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}var GT={exports:{}};GT.exports=function(){function e(o,c,u,h,p){for(;h>u;){if(h-u>600){var f=h-u+1,g=c-u+1,v=Math.log(f),y=.5*Math.exp(2*v/3),b=.5*Math.sqrt(v*y*(f-y)/f)*(g-f/2<0?-1:1);e(o,c,Math.max(u,Math.floor(c-g*y/f+b)),Math.min(h,Math.floor(c+(f-g)*y/f+b)),p)}var x=o[c],C=u,E=h;for(t(o,u,c),p(o[h],x)>0&&t(o,u,h);C<E;){for(t(o,C,E),C++,E--;p(o[C],x)<0;)C++;for(;p(o[E],x)>0;)E--}p(o[u],x)===0?t(o,u,E):t(o,++E,h),E<=c&&(u=E+1),c<=E&&(h=E-1)}}function t(o,c,u){var h=o[c];o[c]=o[u],o[u]=h}function i(o,c){return o<c?-1:o>c?1:0}return function(o,c,u,h,p){e(o,c,u||0,h||o.length-1,p||i)}}();var Dj=mt(GT.exports);function Tj(e){let t=0;for(let i,o,c=0,u=e.length,h=u-1;c<u;h=c++)i=e[c],o=e[h],t+=(o.x-i.x)*(i.y+o.y);return t}function fp(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function gp(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Ij(e,t,i){let o=e[0]-t[0],c=e[1]-t[1],u=e[0]-i[0],h=e[1]-i[1];return o*h-u*c==0&&o*u<=0&&c*h<=0}function ih(e,t,i=!1){let o=!1;for(let p=0,f=t.length;p<f;p++){let g=t[p];for(let v=0,y=g.length,b=y-1;v<y;b=v++){let x=g[b],C=g[v];if(Ij(e,x,C))return i;(u=x)[1]>(c=e)[1]!=(h=C)[1]>c[1]&&c[0]<(h[0]-u[0])*(c[1]-u[1])/(h[1]-u[1])+u[0]&&(o=!o)}}var c,u,h;return o}function qT(e,t,i,o){let c=o[0]-i[0],u=o[1]-i[1],h=(e[0]-i[0])*u-c*(e[1]-i[1]),p=(t[0]-i[0])*u-c*(t[1]-i[1]);return h>0&&p<0||h<0&&p>0}function l_(e,t,i,o){return(c=[o[0]-i[0],o[1]-i[1]])[0]*(u=[t[0]-e[0],t[1]-e[1]])[1]-c[1]*u[0]!=0&&!(!qT(e,t,i,o)||!qT(i,o,e,t));var c,u}let jc=8192;function Aj(e,t){let i=(180+e[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,c=Math.pow(2,t.z);return[Math.round(i*c*jc),Math.round(o*c*jc)]}function kj(e,t){for(let i=0;i<t.length;i++)if(ih(e,t[i]))return!0;return!1}function Rj(e,t,i){for(let o of i)for(let c=0,u=o.length,h=u-1;c<u;h=c++)if(l_(e,t,o[h],o[c]))return!0;return!1}function WT(e,t){for(let i=0;i<e.length;++i)if(!ih(e[i],t))return!1;for(let i=0;i<e.length-1;++i)if(Rj(e[i],e[i+1],t))return!1;return!0}function Pj(e,t){for(let i=0;i<t.length;i++)if(WT(e,t[i]))return!0;return!1}function i1(e,t,i){let o=[];for(let c=0;c<e.length;c++){let u=[];for(let h=0;h<e[c].length;h++){let p=Aj(e[c][h],i);fp(t,p),u.push(p)}o.push(u)}return o}function $T(e,t,i){let o=[];for(let c=0;c<e.length;c++){let u=i1(e[c],t,i);o.push(u)}return o}function YT(e,t,i,o){if(e[0]<i[0]||e[0]>i[2]){let c=.5*o,u=e[0]-i[0]>c?-o:i[0]-e[0]>c?o:0;u===0&&(u=e[0]-i[2]>c?-o:i[2]-e[0]>c?o:0),e[0]+=u}fp(t,e)}function ZT(e,t,i,o){let c=Math.pow(2,o.z)*jc,u=[o.x*jc,o.y*jc],h=[];if(!e)return h;for(let p of e)for(let f of p){let g=[f.x+u[0],f.y+u[1]];YT(g,t,i,c),h.push(g)}return h}function XT(e,t,i,o){let c=Math.pow(2,o.z)*jc,u=[o.x*jc,o.y*jc],h=[];if(!e)return h;for(let f of e){let g=[];for(let v of f){let y=[v.x+u[0],v.y+u[1]];fp(t,y),g.push(y)}h.push(g)}if(t[2]-t[0]<=c/2){(p=t)[0]=p[1]=1/0,p[2]=p[3]=-1/0;for(let f of h)for(let g of f)YT(g,t,i,c)}var p;return h}class _p{constructor(t,i){this.type=Qi,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(eh(t[1])){let o=t[1];if(o.type==="FeatureCollection")for(let c=0;c<o.features.length;++c){let u=o.features[c].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new _p(o,o.features[c].geometry)}else if(o.type==="Feature"){let c=o.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new _p(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new _p(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(i,o){let c=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],h=i.canonicalID();if(!h)return!1;if(o.type==="Polygon"){let p=i1(o.coordinates,u,h),f=ZT(i.geometry(),c,u,h);if(!gp(c,u))return!1;for(let g of f)if(!ih(g,p))return!1}if(o.type==="MultiPolygon"){let p=$T(o.coordinates,u,h),f=ZT(i.geometry(),c,u,h);if(!gp(c,u))return!1;for(let g of f)if(!kj(g,p))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(i,o){let c=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],h=i.canonicalID();if(!h)return!1;if(o.type==="Polygon"){let p=i1(o.coordinates,u,h),f=XT(i.geometry(),c,u,h);if(!gp(c,u))return!1;for(let g of f)if(!WT(g,p))return!1}if(o.type==="MultiPolygon"){let p=$T(o.coordinates,u,h),f=XT(i.geometry(),c,u,h);if(!gp(c,u))return!1;for(let g of f)if(!Pj(g,p))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var n1=_p,KT={exports:{}};KT.exports=function(){var e={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},t=1/298.257223563,i=t*(2-t),o=Math.PI/180,c=function(g,v){if(g===void 0)throw new Error("No latitude given.");if(v&&!e[v])throw new Error("Unknown unit "+v+". Use one of: "+Object.keys(e).join(", "));var y=6378.137*o*(v?e[v]:1),b=Math.cos(g*o),x=1/(1-i*(1-b*b)),C=Math.sqrt(x);this.kx=y*C*b,this.ky=y*C*x*(1-i)},u={units:{configurable:!0}};function h(g,v){return g[0]===v[0]&&g[1]===v[1]}function p(g,v,y){var b=f(v[0]-g[0]);return[g[0]+b*y,g[1]+(v[1]-g[1])*y]}function f(g){for(;g<-180;)g+=360;for(;g>180;)g-=360;return g}return c.fromTile=function(g,v,y){var b=Math.PI*(1-2*(g+.5)/Math.pow(2,v)),x=Math.atan(.5*(Math.exp(b)-Math.exp(-b)))/o;return new c(x,y)},u.units.get=function(){return e},c.prototype.distance=function(g,v){var y=f(g[0]-v[0])*this.kx,b=(g[1]-v[1])*this.ky;return Math.sqrt(y*y+b*b)},c.prototype.bearing=function(g,v){var y=f(v[0]-g[0])*this.kx;return Math.atan2(y,(v[1]-g[1])*this.ky)/o},c.prototype.destination=function(g,v,y){var b=y*o;return this.offset(g,Math.sin(b)*v,Math.cos(b)*v)},c.prototype.offset=function(g,v,y){return[g[0]+v/this.kx,g[1]+y/this.ky]},c.prototype.lineDistance=function(g){for(var v=0,y=0;y<g.length-1;y++)v+=this.distance(g[y],g[y+1]);return v},c.prototype.area=function(g){for(var v=0,y=0;y<g.length;y++)for(var b=g[y],x=0,C=b.length,E=C-1;x<C;E=x++)v+=f(b[x][0]-b[E][0])*(b[x][1]+b[E][1])*(y?-1:1);return Math.abs(v)/2*this.kx*this.ky},c.prototype.along=function(g,v){var y=0;if(v<=0)return g[0];for(var b=0;b<g.length-1;b++){var x=g[b],C=g[b+1],E=this.distance(x,C);if((y+=E)>v)return p(x,C,(v-(y-E))/E)}return g[g.length-1]},c.prototype.pointToSegmentDistance=function(g,v,y){var b=v[0],x=v[1],C=f(y[0]-b)*this.kx,E=(y[1]-x)*this.ky,M=0;return C===0&&E===0||((M=(f(g[0]-b)*this.kx*C+(g[1]-x)*this.ky*E)/(C*C+E*E))>1?(b=y[0],x=y[1]):M>0&&(b+=C/this.kx*M,x+=E/this.ky*M)),C=f(g[0]-b)*this.kx,E=(g[1]-x)*this.ky,Math.sqrt(C*C+E*E)},c.prototype.pointOnLine=function(g,v){for(var y,b,x,C,E=1/0,M=0;M<g.length-1;M++){var D=g[M][0],A=g[M][1],P=f(g[M+1][0]-D)*this.kx,O=(g[M+1][1]-A)*this.ky,R=0;P===0&&O===0||((R=(f(v[0]-D)*this.kx*P+(v[1]-A)*this.ky*O)/(P*P+O*O))>1?(D=g[M+1][0],A=g[M+1][1]):R>0&&(D+=P/this.kx*R,A+=O/this.ky*R));var F=(P=f(v[0]-D)*this.kx)*P+(O=(v[1]-A)*this.ky)*O;F<E&&(E=F,y=D,b=A,x=M,C=R)}return{point:[y,b],index:x,t:Math.max(0,Math.min(1,C))}},c.prototype.lineSlice=function(g,v,y){var b=this.pointOnLine(y,g),x=this.pointOnLine(y,v);if(b.index>x.index||b.index===x.index&&b.t>x.t){var C=b;b=x,x=C}var E=[b.point],M=b.index+1,D=x.index;!h(y[M],E[0])&&M<=D&&E.push(y[M]);for(var A=M+1;A<=D;A++)E.push(y[A]);return h(y[D],x.point)||E.push(x.point),E},c.prototype.lineSliceAlong=function(g,v,y){for(var b=0,x=[],C=0;C<y.length-1;C++){var E=y[C],M=y[C+1],D=this.distance(E,M);if((b+=D)>g&&x.length===0&&x.push(p(E,M,(g-(b-D))/D)),b>=v)return x.push(p(E,M,(v-(b-D))/D)),x;b>g&&x.push(M)}return x},c.prototype.bufferPoint=function(g,v){var y=v/this.ky,b=v/this.kx;return[g[0]-b,g[1]-y,g[0]+b,g[1]+y]},c.prototype.bufferBBox=function(g,v){var y=v/this.ky,b=v/this.kx;return[g[0]-b,g[1]-y,g[2]+b,g[3]+y]},c.prototype.insideBBox=function(g,v){return f(g[0]-v[0])>=0&&f(g[0]-v[2])<=0&&g[1]>=v[1]&&g[1]<=v[3]},Object.defineProperties(c,u),c}();var r1=mt(KT.exports),QT={exports:{}};QT.exports=function(){var e=function(i,o){if(i===void 0&&(i=[]),o===void 0&&(o=t),this.data=i,this.length=this.data.length,this.compare=o,this.length>0)for(var c=(this.length>>1)-1;c>=0;c--)this._down(c)};function t(i,o){return i<o?-1:i>o?1:0}return e.prototype.push=function(i){this.data.push(i),this.length++,this._up(this.length-1)},e.prototype.pop=function(){if(this.length!==0){var i=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),i}},e.prototype.peek=function(){return this.data[0]},e.prototype._up=function(i){for(var o=this.data,c=this.compare,u=o[i];i>0;){var h=i-1>>1,p=o[h];if(c(u,p)>=0)break;o[i]=p,i=h}o[i]=u},e.prototype._down=function(i){for(var o=this.data,c=this.compare,u=this.length>>1,h=o[i];i<u;){var p=1+(i<<1),f=o[p],g=p+1;if(g<this.length&&c(o[g],f)<0&&(p=g,f=o[g]),c(f,h)>=0)break;o[i]=f,i=p}o[i]=h},e}();var o1=mt(QT.exports),wt=8192;function JT(e,t){return t.dist-e.dist}let s1=100,a1=50;function tI(e){let t=[1/0,1/0,-1/0,-1/0];if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function c_(e){return e[1]-e[0]+1}function oc(e,t){let i=e[1]>=e[0]&&e[1]<t;return i||console.warn("Distance Expression: Index is out of range"),i}function l1(e,t){if(e[0]>e[1])return[null,null];let i=c_(e);if(t){if(i===2)return[e,null];let o=Math.floor(i/2);return[[e[0],e[0]+o],[e[0]+o,e[1]]]}{if(i===1)return[e,null];let o=Math.floor(i/2)-1;return[[e[0],e[0]+o],[e[0]+o+1,e[1]]]}}function Zd(e,t){let i=[1/0,1/0,-1/0,-1/0];if(!oc(t,e.length))return i;for(let o=t[0];o<=t[1];++o)fp(i,e[o]);return i}function d_(e){let t=[1/0,1/0,-1/0,-1/0];for(let i=0;i<e.length;++i)for(let o=0;o<e[i].length;++o)fp(t,e[i][o]);return t}function nh(e,t,i){if(tI(e)||tI(t))return NaN;let o=0,c=0;return e[2]<t[0]&&(o=t[0]-e[2]),e[0]>t[2]&&(o=e[0]-t[2]),e[1]>t[3]&&(c=e[1]-t[3]),e[3]<t[1]&&(c=t[1]-e[3]),i.distance([0,0],[o,c])}function c1(e,t){let i=Math.pow(2,t.z);return[(c=(e.x/wt+t.x)/i,360*c-180),(o=(e.y/wt+t.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,c}function Oj(e,t){let i=[];for(let o=0;o<e.length;++o)i.push(c1(e[o],t));return i}function eI(e,t,i){let o=i.pointOnLine(t,e).point;return i.distance(e,o)}function iI(e,t,i,o,c){let u=i.slice(o[0],o[1]+1),h=1/0;for(let p=t[0];p<=t[1];++p)if((h=Math.min(h,eI(e[p],u,c)))===0)return 0;return h}function d1(e,t,i,o,c){let u=Math.min(c.pointToSegmentDistance(e,i,o),c.pointToSegmentDistance(t,i,o)),h=Math.min(c.pointToSegmentDistance(i,e,t),c.pointToSegmentDistance(o,e,t));return Math.min(u,h)}function Fj(e,t,i,o,c){if(!oc(t,e.length)||!oc(o,i.length))return NaN;let u=1/0;for(let h=t[0];h<t[1];++h)for(let p=o[0];p<o[1];++p){if(l_(e[h],e[h+1],i[p],i[p+1]))return 0;u=Math.min(u,d1(e[h],e[h+1],i[p],i[p+1],c))}return u}function Lj(e,t,i,o,c){if(!oc(t,e.length)||!oc(o,i.length))return NaN;let u=1/0;for(let h=t[0];h<=t[1];++h)for(let p=o[0];p<=o[1];++p)if((u=Math.min(u,c.distance(e[h],i[p])))===0)return u;return u}function zj(e,t,i){if(ih(e,t,!0))return 0;let o=1/0;for(let c of t){let u=c.length;if(u<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(c[0]!==c[u-1]&&(o=Math.min(o,i.pointToSegmentDistance(e,c[u-1],c[0])))===0||(o=Math.min(o,eI(e,c,i)))===0)return o}return o}function Nj(e,t,i,o){if(!oc(t,e.length))return NaN;for(let u=t[0];u<=t[1];++u)if(ih(e[u],i,!0))return 0;let c=1/0;for(let u=t[0];u<t[1];++u)for(let h of i)for(let p=0,f=h.length,g=f-1;p<f;g=p++){if(l_(e[u],e[u+1],h[g],h[p]))return 0;c=Math.min(c,d1(e[u],e[u+1],h[g],h[p],o))}return c}function nI(e,t){for(let i of e)for(let o=0;o<=i.length-1;++o)if(ih(i[o],t,!0))return!0;return!1}function Bj(e,t,i,o=1/0){let c=d_(e),u=d_(t);if(o!==1/0&&nh(c,u,i)>=o)return o;if(gp(c,u)){if(nI(e,t))return 0}else if(nI(t,e))return 0;let h=o;for(let p of e)for(let f=0,g=p.length,v=g-1;f<g;v=f++)for(let y of t)for(let b=0,x=y.length,C=x-1;b<x;C=b++){if(l_(p[v],p[f],y[C],y[b]))return 0;h=Math.min(h,d1(p[v],p[f],y[C],y[b],i))}return h}function u_(e,t,i,o,c,u,h){if(u===null||h===null)return;let p=nh(Zd(o,u),Zd(c,h),i);p<t&&e.push({dist:p,range1:u,range2:h})}function Vj(e,t,i,o,c=1/0){let u=Math.min(o.distance(e[0],i[0][0]),c);if(u===0)return u;let h=new o1([{dist:0,range1:[0,e.length-1],range2:[0,0]}],JT),p=t?a1:s1,f=d_(i);for(;h.length;){let g=h.pop();if(g.dist>=u)continue;let v=g.range1;if(c_(v)<=p){if(!oc(v,e.length))return NaN;if(t){let y=Nj(e,v,i,o);if((u=Math.min(u,y))===0)return u}else for(let y=v[0];y<=v[1];++y){let b=zj(e[y],i,o);if((u=Math.min(u,b))===0)return u}}else{let y=l1(v,t);if(y[0]!==null){let b=nh(Zd(e,y[0]),f,o);b<u&&h.push({dist:b,range1:y[0],range2:[0,0]})}if(y[1]!==null){let b=nh(Zd(e,y[1]),f,o);b<u&&h.push({dist:b,range1:y[1],range2:[0,0]})}}}return u}function rI(e,t,i,o,c,u=1/0){let h=Math.min(u,c.distance(e[0],i[0]));if(h===0)return h;let p=new o1([{dist:0,range1:[0,e.length-1],range2:[0,i.length-1]}],JT),f=t?a1:s1,g=o?a1:s1;for(;p.length;){let v=p.pop();if(v.dist>=h)continue;let y=v.range1,b=v.range2;if(c_(y)<=f&&c_(b)<=g){if(!oc(y,e.length)||!oc(b,i.length))return NaN;if(t&&o?h=Math.min(h,Fj(e,y,i,b,c)):t||o?t&&!o?h=Math.min(h,iI(i,b,e,y,c)):!t&&o&&(h=Math.min(h,iI(e,y,i,b,c))):h=Math.min(h,Lj(e,y,i,b,c)),h===0)return h}else{let x=l1(y,t),C=l1(b,o);u_(p,h,c,e,i,x[0],C[0]),u_(p,h,c,e,i,x[0],C[1]),u_(p,h,c,e,i,x[1],C[0]),u_(p,h,c,e,i,x[1],C[1])}}return h}function u1(e,t,i,o,c=1/0){let u=c,h=Zd(e,[0,e.length-1]);for(let p of i)if(!(u!==1/0&&nh(h,Zd(p,[0,p.length-1]),o)>=u)&&(u=Math.min(u,rI(e,t,p,!0,o,u)),u===0))return u;return u}function h_(e,t,i,o,c=1/0){let u=c,h=Zd(e,[0,e.length-1]);for(let p of i){if(u!==1/0&&nh(h,d_(p),o)>=u)continue;let f=Vj(e,t,p,o,u);if(isNaN(f))return f;if((u=Math.min(u,f))===0)return u}return u}function h1(e){return e==="Point"||e==="MultiPoint"||e==="LineString"||e==="MultiLineString"||e==="Polygon"||e==="MultiPolygon"}class vp{constructor(t,i){this.type=he,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(eh(t[1])){let o=t[1];if(o.type==="FeatureCollection"){for(let c=0;c<o.features.length;++c)if(h1(o.features[c].geometry.type))return new vp(o,o.features[c].geometry)}else if(o.type==="Feature"){if(h1(o.geometry.type))return new vp(o,o.geometry)}else if(h1(o.type))return new vp(o,o)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){let i=t.geometry(),o=t.canonicalID();if(i!=null&&o!=null){if(t.geometryType()==="Point")return function(c,u,h){let p=[];for(let g of c)for(let v of g)p.push(c1(v,u));let f=new r1(p[0][1],"meters");return h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString"?rI(p,!1,h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",f):h.type==="MultiLineString"?u1(p,!1,h.coordinates,f):h.type==="Polygon"||h.type==="MultiPolygon"?h_(p,!1,h.type==="Polygon"?[h.coordinates]:h.coordinates,f):null}(i,o,this.geometries);if(t.geometryType()==="LineString")return function(c,u,h){let p=[];for(let g of c){let v=[];for(let y of g)v.push(c1(y,u));p.push(v)}let f=new r1(p[0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return u1(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",p,f);if(h.type==="MultiLineString"){let g=1/0;for(let v=0;v<h.coordinates.length;v++){let y=u1(h.coordinates[v],!0,p,f,g);if(isNaN(y))return y;if((g=Math.min(g,y))===0)return g}return g}if(h.type==="Polygon"||h.type==="MultiPolygon"){let g=1/0;for(let v=0;v<p.length;v++){let y=h_(p[v],!0,h.type==="Polygon"?[h.coordinates]:h.coordinates,f,g);if(isNaN(y))return y;if((g=Math.min(g,y))===0)return g}return g}return null}(i,o,this.geometries);if(t.geometryType()==="Polygon")return function(c,u,h){let p=[];for(let g of function(v,y){let b=v.length;if(b<=1)return[v];let x=[],C,E;for(let M=0;M<b;M++){let D=Tj(v[M]);D!==0&&(v[M].area=Math.abs(D),E===void 0&&(E=D<0),E===D<0?(C&&x.push(C),C=[v[M]]):C.push(v[M]))}return C&&x.push(C),x}(c)){let v=[];for(let y=0;y<g.length;++y)v.push(Oj(g[y],u));p.push(v)}let f=new r1(p[0][0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return h_(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",p,f);if(h.type==="MultiLineString"){let g=1/0;for(let v=0;v<h.coordinates.length;v++){let y=h_(h.coordinates[v],!0,p,f,g);if(isNaN(y))return y;if((g=Math.min(g,y))===0)return g}return g}return h.type==="Polygon"||h.type==="MultiPolygon"?function(g,v,y){let b=1/0;for(let x of g)for(let C of v){let E=Bj(x,C,y,b);if(isNaN(E))return E;if((b=Math.min(b,E))===0)return b}return b}(h.type==="Polygon"?[h.coordinates]:h.coordinates,p,f):null}(i,o,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var m1=vp;function rh(e){if(e instanceof wl&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof n1||e instanceof m1)return!1;let t=!0;return e.eachChild(i=>{t&&!rh(i)&&(t=!1)}),t}function yp(e){if(e instanceof wl&&e.name==="feature-state")return!1;let t=!0;return e.eachChild(i=>{t&&!yp(i)&&(t=!1)}),t}function p1(e){if(e instanceof wl&&e.name==="config")return!1;let t=!0;return e.eachChild(i=>{t&&!p1(i)&&(t=!1)}),t}function oh(e,t){if(e instanceof wl&&t.indexOf(e.name)>=0)return!1;let i=!0;return e.eachChild(o=>{i&&!oh(o,t)&&(i=!1)}),i}class f1{constructor(t,i){this.type=i.type,this.name=t,this.boundExpression=i}static parse(t,i){if(t.length!==2||typeof t[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");let o=t[1];return i.scope.has(o)?new f1(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var oI=f1;class g1{constructor(t,i=[],o,c=new wj,u=[],h){this.registry=t,this.path=i,this.key=i.map(p=>`[${p}]`).join(""),this.scope=c,this.errors=u,this.expectedType=o,this.options=h}parse(t,i,o,c,u={}){return i||o?this.concat(i,o,c)._parse(t,u):this._parse(t,u)}_parse(t,i){function o(c,u,h){return h==="assert"?new rc(u,[c]):h==="coerce"?new $d(u,[c]):c}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let c=typeof t[0]=="string"?this.registry[t[0]]:void 0;if(c){let u=c.parse(t,this);if(!u)return null;if(this.expectedType){let h=this.expectedType,p=u.type;if(h.kind!=="string"&&h.kind!=="number"&&h.kind!=="boolean"&&h.kind!=="object"&&h.kind!=="array"||p.kind!=="value")if(h.kind!=="color"&&h.kind!=="formatted"&&h.kind!=="resolvedImage"||p.kind!=="value"&&p.kind!=="string"){if(this.checkSubtype(h,p))return null}else u=o(u,h,i.typeAnnotation||"coerce");else u=o(u,h,i.typeAnnotation||"assert")}if(!(u instanceof hp)&&u.type.kind!=="resolvedImage"&&_1(u)){let h=new HT(this.options);try{u=new hp(u.type,u.evaluate(h))}catch(p){return this.error(p.message),null}}return u}return $d.parse(["to-array",t],this)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,i,o){let c=typeof t=="number"?this.path.concat(t):this.path,u=o?this.scope.concat(o):this.scope;return new g1(this.registry,c,i||null,u,this.errors,this.options)}error(t,...i){let o=`${this.key}${i.map(c=>`[${c}]`).join("")}`;this.errors.push(new xl(o,t))}checkSubtype(t,i){let o=cp(t,i);return o&&this.error(o),o}}var sI=g1;function _1(e){if(e instanceof oI)return _1(e.boundExpression);if(e instanceof wl&&e.name==="error"||e instanceof wl&&e.name==="config"||e instanceof a_||e instanceof n1||e instanceof m1)return!1;let t=e instanceof $d||e instanceof rc,i=!0;return e.eachChild(o=>{i=t?i&&_1(o):i&&o instanceof hp}),!!i&&rh(e)&&oh(e,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function m_(e,t){let i=e.length-1,o,c,u=0,h=i,p=0;for(;u<=h;)if(p=Math.floor((u+h)/2),o=e[p],c=e[p+1],o<=t){if(p===i||t<c)return p;u=p+1}else{if(!(o>t))throw new Ro("Input is not a number.");h=p-1}return 0}class v1{constructor(t,i,o){this.type=t,this.input=i,this.labels=[],this.outputs=[];for(let[c,u]of o)this.labels.push(c),this.outputs.push(u)}static parse(t,i){if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");let o=i.parse(t[1],1,he);if(!o)return null;let c=[],u=null;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);for(let h=1;h<t.length;h+=2){let p=h===1?-1/0:t[h],f=t[h+1],g=h,v=h+1;if(typeof p!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',g);if(c.length&&c[c.length-1][0]>=p)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',g);let y=i.parse(f,v,u);if(!y)return null;u=u||y.type,c.push([p,y])}return new v1(u,o,c)}evaluate(t){let i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(t);let c=this.input.evaluate(t);if(c<=i[0])return o[0].evaluate(t);let u=i.length;return c>=i[u-1]?o[u-1].evaluate(t):o[m_(i,c)].evaluate(t)}eachChild(t){t(this.input);for(let i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&t.push(this.labels[i]),t.push(this.outputs[i].serialize());return t}}var y1=v1;function Ye(e,t,i){return e*(1-i)+t*i}function aI(e,t,i){return e.map((o,c)=>Ye(o,t[c],i))}var p_=Object.freeze({__proto__:null,array:aI,color:function(e,t,i){return new _i(Ye(e.r,t.r,i),Ye(e.g,t.g,i),Ye(e.b,t.b,i),Ye(e.a,t.a,i))},number:Ye});let lI=.95047,cI=1.08883,dI=4/29,sh=6/29,uI=3*sh*sh,jj=sh*sh*sh,Uj=Math.PI/180,Hj=180/Math.PI;function b1(e){return e>jj?Math.pow(e,1/3):e/uI+dI}function x1(e){return e>sh?e*e*e:uI*(e-dI)}function w1(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function C1(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function hI(e){let t=C1(e.r),i=C1(e.g),o=C1(e.b),c=b1((.4124564*t+.3575761*i+.1804375*o)/lI),u=b1((.2126729*t+.7151522*i+.072175*o)/1);return{l:116*u-16,a:500*(c-u),b:200*(u-b1((.0193339*t+.119192*i+.9503041*o)/cI)),alpha:e.a}}function mI(e){let t=(e.l+16)/116,i=isNaN(e.a)?t:t+e.a/500,o=isNaN(e.b)?t:t-e.b/200;return t=1*x1(t),i=lI*x1(i),o=cI*x1(o),new _i(w1(3.2404542*i-1.5371385*t-.4985314*o),w1(-.969266*i+1.8760108*t+.041556*o),w1(.0556434*i-.2040259*t+1.0572252*o),e.alpha)}function Gj(e,t,i){let o=t-e;return e+i*(o>180||o<-180?o-360*Math.round(o/360):o)}let bp={forward:hI,reverse:mI,interpolate:function(e,t,i){return{l:Ye(e.l,t.l,i),a:Ye(e.a,t.a,i),b:Ye(e.b,t.b,i),alpha:Ye(e.alpha,t.alpha,i)}}},xp={forward:function(e){let{l:t,a:i,b:o}=hI(e),c=Math.atan2(o,i)*Hj;return{h:c<0?c+360:c,c:Math.sqrt(i*i+o*o),l:t,alpha:e.a}},reverse:function(e){let t=e.h*Uj,i=e.c;return mI({l:e.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:e.alpha})},interpolate:function(e,t,i){return{h:Gj(e.h,t.h,i),c:Ye(e.c,t.c,i),l:Ye(e.l,t.l,i),alpha:Ye(e.alpha,t.alpha,i)}}};var pI=Object.freeze({__proto__:null,hcl:xp,lab:bp});class f_{constructor(t,i,o,c,u){this.type=t,this.operator=i,this.interpolation=o,this.input=c,this.labels=[],this.outputs=[];for(let[h,p]of u)this.labels.push(h),this.outputs.push(p)}static interpolationFactor(t,i,o,c){let u=0;if(t.name==="exponential")u=S1(i,t.base,o,c);else if(t.name==="linear")u=S1(i,1,o,c);else if(t.name==="cubic-bezier"){let h=t.controlPoints;u=new Pt(h[0],h[1],h[2],h[3]).solve(S1(i,1,o,c))}return u}static parse(t,i){let[o,c,u,...h]=t;if(!Array.isArray(c)||c.length===0)return i.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){let g=c[1];if(typeof g!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:g}}else{if(c[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(c[0])}`,1,0);{let g=c.slice(1);if(g.length!==4||g.some(v=>typeof v!="number"||v<0||v>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:g}}}if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(u=i.parse(u,2,he),!u)return null;let p=[],f=null;o==="interpolate-hcl"||o==="interpolate-lab"?f=ca:i.expectedType&&i.expectedType.kind!=="value"&&(f=i.expectedType);for(let g=0;g<h.length;g+=2){let v=h[g],y=h[g+1],b=g+3,x=g+4;if(typeof v!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',b);if(p.length&&p[p.length-1][0]>=v)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',b);let C=i.parse(y,x,f);if(!C)return null;f=f||C.type,p.push([v,C])}return f.kind==="number"||f.kind==="color"||f.kind==="array"&&f.itemType.kind==="number"&&typeof f.N=="number"?new f_(f,o,c,u,p):i.error(`Type ${Gr(f)} is not interpolatable.`)}evaluate(t){let i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(t);let c=this.input.evaluate(t);if(c<=i[0])return o[0].evaluate(t);let u=i.length;if(c>=i[u-1])return o[u-1].evaluate(t);let h=m_(i,c),p=f_.interpolationFactor(this.interpolation,c,i[h],i[h+1]),f=o[h].evaluate(t),g=o[h+1].evaluate(t);return this.operator==="interpolate"?p_[this.type.kind.toLowerCase()](f,g,p):this.operator==="interpolate-hcl"?xp.reverse(xp.interpolate(xp.forward(f),xp.forward(g),p)):bp.reverse(bp.interpolate(bp.forward(f),bp.forward(g),p))}eachChild(t){t(this.input);for(let i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let i=[this.operator,t,this.input.serialize()];for(let o=0;o<this.labels.length;o++)i.push(this.labels[o],this.outputs[o].serialize());return i}}function S1(e,t,i,o){let c=o-i,u=e-i;return c===0?0:t===1?u/c:(Math.pow(t,u)-1)/(Math.pow(t,c)-1)}var Cl=f_;class E1{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expectected at least one argument.");let o=null,c=i.expectedType;c&&c.kind!=="value"&&(o=c);let u=[];for(let p of t.slice(1)){let f=i.parse(p,1+u.length,o,void 0,{typeAnnotation:"omit"});if(!f)return null;o=o||f.type,u.push(f)}let h=c&&u.some(p=>cp(c,p.type));return new E1(h?Yi:o,u)}evaluate(t){let i,o=null,c=0;for(let u of this.args){if(c++,o=u.evaluate(t),o&&o instanceof da&&!o.available&&(i||(i=o),o=null,c===this.args.length))return i;if(o!==null)break}return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){let t=["coalesce"];return this.eachChild(i=>{t.push(i.serialize())}),t}}var fI=E1;class M1{constructor(t,i){this.type=i.type,this.bindings=[].concat(t),this.result=i}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(let i of this.bindings)t(i[1]);t(this.result)}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);let o=[];for(let u=1;u<t.length-1;u+=2){let h=t[u];if(typeof h!="string")return i.error(`Expected string, but found ${typeof h} instead.`,u);if(/[^a-zA-Z0-9_]/.test(h))return i.error("Variable names must contain only alphanumeric characters or '_'.",u);let p=i.parse(t[u+1],u+1);if(!p)return null;o.push([h,p])}let c=i.parse(t[t.length-1],t.length-1,i.expectedType,o);return c?new M1(o,c):null}outputDefined(){return this.result.outputDefined()}serialize(){let t=["let"];for(let[i,o]of this.bindings)t.push(i,o.serialize());return t.push(this.result.serialize()),t}}var gI=M1;class D1{constructor(t,i,o){this.type=t,this.index=i,this.input=o}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let o=i.parse(t[1],1,he),c=i.parse(t[2],2,ys(i.expectedType||Yi));return o&&c?new D1(c.type.itemType,o,c):null}evaluate(t){let i=this.index.evaluate(t),o=this.input.evaluate(t);if(i<0)throw new Ro(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new Ro(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new Ro(`Array index must be an integer, but found ${i} instead.`);return o[i]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var qj=D1;class T1{constructor(t,i){this.type=Qi,this.needle=t,this.haystack=i}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let o=i.parse(t[1],1,Yi),c=i.parse(t[2],2,Yi);return o&&c?Wx(o.type,[Qi,Wi,he,Ju,Yi])?new T1(o,c):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Gr(o.type)} instead`):null}evaluate(t){let i=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(o==null)return!1;if(!dp(i,["boolean","string","number","null"]))throw new Ro(`Expected first argument to be of type boolean, string, number or null, but found ${Gr(bo(i))} instead.`);if(!dp(o,["string","array"]))throw new Ro(`Expected second argument to be of type array or string, but found ${Gr(bo(o))} instead.`);return o.indexOf(i)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Wj=T1;class g_{constructor(t,i,o){this.type=he,this.needle=t,this.haystack=i,this.fromIndex=o}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let o=i.parse(t[1],1,Yi),c=i.parse(t[2],2,Yi);if(!o||!c)return null;if(!Wx(o.type,[Qi,Wi,he,Ju,Yi]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Gr(o.type)} instead`);if(t.length===4){let u=i.parse(t[3],3,he);return u?new g_(o,c,u):null}return new g_(o,c)}evaluate(t){let i=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!dp(i,["boolean","string","number","null"]))throw new Ro(`Expected first argument to be of type boolean, string, number or null, but found ${Gr(bo(i))} instead.`);if(!dp(o,["string","array"]))throw new Ro(`Expected second argument to be of type array or string, but found ${Gr(bo(o))} instead.`);if(this.fromIndex){let c=this.fromIndex.evaluate(t);return o.indexOf(i,c)}return o.indexOf(i)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var $j=g_;class I1{constructor(t,i,o,c,u,h){this.inputType=t,this.type=i,this.input=o,this.cases=c,this.outputs=u,this.otherwise=h}static parse(t,i){if(t.length<5)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return i.error("Expected an even number of arguments.");let o,c;i.expectedType&&i.expectedType.kind!=="value"&&(c=i.expectedType);let u={},h=[];for(let g=2;g<t.length-1;g+=2){let v=t[g],y=t[g+1];Array.isArray(v)||(v=[v]);let b=i.concat(g);if(v.length===0)return b.error("Expected at least one branch label.");for(let C of v){if(typeof C!="number"&&typeof C!="string")return b.error("Branch labels must be numbers or strings.");if(typeof C=="number"&&Math.abs(C)>Number.MAX_SAFE_INTEGER)return b.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof C=="number"&&Math.floor(C)!==C)return b.error("Numeric branch labels must be integer values.");if(o){if(b.checkSubtype(o,bo(C)))return null}else o=bo(C);if(u[String(C)]!==void 0)return b.error("Branch labels must be unique.");u[String(C)]=h.length}let x=i.parse(y,g,c);if(!x)return null;c=c||x.type,h.push(x)}let p=i.parse(t[1],1,Yi);if(!p)return null;let f=i.parse(t[t.length-1],t.length-1,c);return f?p.type.kind!=="value"&&i.concat(1).checkSubtype(o,p.type)?null:new I1(o,c,p,u,h,f):null}evaluate(t){let i=this.input.evaluate(t);return(bo(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){let t=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),o=[],c={};for(let h of i){let p=c[this.cases[h]];p===void 0?(c[this.cases[h]]=o.length,o.push([this.cases[h],[h]])):o[p][1].push(h)}let u=h=>this.inputType.kind==="number"?Number(h):h;for(let[h,p]of o)t.push(p.length===1?u(p[0]):p.map(u)),t.push(this.outputs[h].serialize());return t.push(this.otherwise.serialize()),t}}var Yj=I1;class A1{constructor(t,i,o){this.type=t,this.branches=i,this.otherwise=o}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);let c=[];for(let h=1;h<t.length-1;h+=2){let p=i.parse(t[h],h,Qi);if(!p)return null;let f=i.parse(t[h+1],h+1,o);if(!f)return null;c.push([p,f]),o=o||f.type}let u=i.parse(t[t.length-1],t.length-1,o);return u?new A1(o,c,u):null}evaluate(t){for(let[i,o]of this.branches)if(i.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(let[i,o]of this.branches)t(i),t(o);t(this.otherwise)}outputDefined(){return this.branches.every(([t,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){let t=["case"];return this.eachChild(i=>{t.push(i.serialize())}),t}}var Zj=A1;class __{constructor(t,i,o,c){this.type=t,this.input=i,this.beginIndex=o,this.endIndex=c}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let o=i.parse(t[1],1,Yi),c=i.parse(t[2],2,he);if(!o||!c)return null;if(!Wx(o.type,[ys(Yi),Wi,Yi]))return i.error(`Expected first argument to be of type array or string, but found ${Gr(o.type)} instead`);if(t.length===4){let u=i.parse(t[3],3,he);return u?new __(o.type,o,c,u):null}return new __(o.type,o,c)}evaluate(t){let i=this.input.evaluate(t),o=this.beginIndex.evaluate(t);if(!dp(i,["string","array"]))throw new Ro(`Expected first argument to be of type array or string, but found ${Gr(bo(i))} instead.`);if(this.endIndex){let c=this.endIndex.evaluate(t);return i.slice(o,c)}return i.slice(o)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Xj=__;function _I(e,t){return e==="=="||e==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function vI(e,t,i,o){return o.compare(t,i)===0}function ah(e,t,i){let o=e!=="=="&&e!=="!=";return class fV{constructor(u,h,p){this.type=Qi,this.lhs=u,this.rhs=h,this.collator=p,this.hasUntypedArgument=u.type.kind==="value"||h.type.kind==="value"}static parse(u,h){if(u.length!==3&&u.length!==4)return h.error("Expected two or three arguments.");let p=u[0],f=h.parse(u[1],1,Yi);if(!f)return null;if(!_I(p,f.type))return h.concat(1).error(`"${p}" comparisons are not supported for type '${Gr(f.type)}'.`);let g=h.parse(u[2],2,Yi);if(!g)return null;if(!_I(p,g.type))return h.concat(2).error(`"${p}" comparisons are not supported for type '${Gr(g.type)}'.`);if(f.type.kind!==g.type.kind&&f.type.kind!=="value"&&g.type.kind!=="value")return h.error(`Cannot compare types '${Gr(f.type)}' and '${Gr(g.type)}'.`);o&&(f.type.kind==="value"&&g.type.kind!=="value"?f=new rc(g.type,[f]):f.type.kind!=="value"&&g.type.kind==="value"&&(g=new rc(f.type,[g])));let v=null;if(u.length===4){if(f.type.kind!=="string"&&g.type.kind!=="string"&&f.type.kind!=="value"&&g.type.kind!=="value")return h.error("Cannot use collator to compare non-string types.");if(v=h.parse(u[3],3,r_),!v)return null}return new fV(f,g,v)}evaluate(u){let h=this.lhs.evaluate(u),p=this.rhs.evaluate(u);if(o&&this.hasUntypedArgument){let f=bo(h),g=bo(p);if(f.kind!==g.kind||f.kind!=="string"&&f.kind!=="number")throw new Ro(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${f.kind}, ${g.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){let f=bo(h),g=bo(p);if(f.kind!=="string"||g.kind!=="string")return t(u,h,p)}return this.collator?i(u,h,p,this.collator.evaluate(u)):t(u,h,p)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){let u=[e];return this.eachChild(h=>{u.push(h.serialize())}),u}}}let Kj=ah("==",function(e,t,i){return t===i},vI),Qj=ah("!=",function(e,t,i){return t!==i},function(e,t,i,o){return!vI(0,t,i,o)}),Jj=ah("<",function(e,t,i){return t<i},function(e,t,i,o){return o.compare(t,i)<0}),t6=ah(">",function(e,t,i){return t>i},function(e,t,i,o){return o.compare(t,i)>0}),e6=ah("<=",function(e,t,i){return t<=i},function(e,t,i,o){return o.compare(t,i)<=0}),i6=ah(">=",function(e,t,i){return t>=i},function(e,t,i,o){return o.compare(t,i)>=0});class k1{constructor(t,i,o,c,u,h){this.type=Wi,this.number=t,this.locale=i,this.currency=o,this.unit=c,this.minFractionDigits=u,this.maxFractionDigits=h}static parse(t,i){if(t.length!==3)return i.error("Expected two arguments.");let o=i.parse(t[1],1,he);if(!o)return null;let c=t[2];if(typeof c!="object"||Array.isArray(c))return i.error("NumberFormat options argument must be an object.");let u=null;if(c.locale&&(u=i.parse(c.locale,1,Wi),!u))return null;let h=null;if(c.currency&&(h=i.parse(c.currency,1,Wi),!h))return null;let p=null;if(c.unit&&(p=i.parse(c.unit,1,Wi),!p))return null;let f=null;if(c["min-fraction-digits"]&&(f=i.parse(c["min-fraction-digits"],1,he),!f))return null;let g=null;return c["max-fraction-digits"]&&(g=i.parse(c["max-fraction-digits"],1,he),!g)?null:new k1(o,u,h,p,f,g)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class R1{constructor(t){this.type=he,this.input=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);let o=i.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Gr(o.type)} instead.`):new R1(o):null}evaluate(t){let i=this.input.evaluate(t);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Ro(`Expected value to be of type string or array, but found ${Gr(bo(i))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){let t=["length"];return this.eachChild(i=>{t.push(i.serialize())}),t}}function P1(e){return function(){e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}let yI={"==":Kj,"!=":Qj,">":t6,"<":Jj,">=":i6,"<=":e6,array:rc,at:qj,boolean:rc,case:Zj,coalesce:fI,collator:a_,format:mp,image:pp,in:Wj,"index-of":$j,interpolate:Cl,"interpolate-hcl":Cl,"interpolate-lab":Cl,length:R1,let:gI,literal:hp,match:Yj,number:rc,"number-format":k1,object:rc,slice:Xj,step:y1,string:rc,"to-boolean":$d,"to-color":$d,"to-number":$d,"to-string":$d,var:oI,within:n1,distance:m1};function bI(e,[t,i,o,c]){t=t.evaluate(e),i=i.evaluate(e),o=o.evaluate(e);let u=c?c.evaluate(e):1,h=UT(t,i,o,u);if(h)throw new Ro(h);return new _i(t/255*u,i/255*u,o/255*u,u)}function xI(e,[t,i,o,c]){t=t.evaluate(e),i=i.evaluate(e),o=o.evaluate(e);let u=c?c.evaluate(e):1,h=function(g,v,y,b){return typeof g=="number"&&g>=0&&g<=360?typeof v=="number"&&v>=0&&v<=100&&typeof y=="number"&&y>=0&&y<=100?b===void 0||typeof b=="number"&&b>=0&&b<=1?null:`Invalid hsla value [${[g,v,y,b].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof b=="number"?[g,v,y,b]:[g,v,y]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof b=="number"?[g,v,y,b]:[g,v,y]).join(", ")}]: 'h' must be between 0 and 360.`}(t,i,o,u);if(h)throw new Ro(h);let p=`hsla(${t}, ${i}%, ${o}%, ${u})`,f=_i.parse(p);if(!f)throw new Ro(`Failed to parse HSLA color: ${p}`);return f}function wI(e,t){return e in t}function O1(e,t){let i=t[e];return i===void 0?null:i}function CI(e,t){switch(e){case"string":return String(t);case"number":return+t;case"boolean":return!!t;case"color":return _i.parse(t)}return t}function SI(e,t,i,o){return o!==void 0&&(e=o*Math.round(e/o)),t!==void 0&&e<t&&(e=t),i!==void 0&&e>i&&(e=i),e}function EI(e,t,i){i.length&&(t+=`${i}`);let o=e.getConfig(t);if(!o)return null;let{type:c,value:u,values:h,minValue:p,maxValue:f,stepValue:g}=o,v=o.default.evaluate(e),y=u?u.evaluate(e):v;return c&&(y=CI(c,y)),u!==void 0&&y!==void 0&&h&&!h.includes(y)&&(y=v,c&&(y=CI(c,y))),y===void 0||p===void 0&&f===void 0&&g===void 0||(typeof y=="number"?y=SI(y,p,f,g):Array.isArray(y)&&(y=y.map(b=>typeof b=="number"?SI(b,p,f,g):b))),y}function Xd(e){return{type:e}}wl.register(yI,{error:[{kind:"error"},[Wi],(e,[t])=>{throw new Ro(t.evaluate(e))}],typeof:[Wi,[Yi],(e,[t])=>Gr(bo(t.evaluate(e)))],"to-rgba":[ys(he,4),[ca],(e,[t])=>t.evaluate(e).toArray()],rgb:[ca,[he,he,he],bI],rgba:[ca,[he,he,he,he],bI],hsl:[ca,[he,he,he],xI],hsla:[ca,[he,he,he,he],xI],has:{type:Qi,overloads:[[[Wi],(e,[t])=>wI(t.evaluate(e),e.properties())],[[Wi,th],(e,[t,i])=>wI(t.evaluate(e),i.evaluate(e))]]},get:{type:Yi,overloads:[[[Wi],(e,[t])=>O1(t.evaluate(e),e.properties())],[[Wi,th],(e,[t,i])=>O1(t.evaluate(e),i.evaluate(e))]]},config:{type:Yi,overloads:[[[Wi],(e,[t])=>EI(e,t.evaluate(e),"")],[[Wi,Wi],(e,[t,i])=>EI(e,t.evaluate(e),i.evaluate(e))]]},"feature-state":[Yi,[Wi],(e,[t])=>O1(t.evaluate(e),e.featureState||{})],properties:[th,[],e=>e.properties()],"geometry-type":[Wi,[],e=>e.geometryType()],id:[Yi,[],e=>e.id()],zoom:[he,[],e=>e.globals.zoom],pitch:[he,[],e=>e.globals.pitch||0],"distance-from-center":[he,[],e=>e.distanceFromCenter()],"measure-light":[he,[Wi],(e,[t])=>e.measureLight(t.evaluate(e))],"heatmap-density":[he,[],e=>e.globals.heatmapDensity||0],"line-progress":[he,[],e=>e.globals.lineProgress||0],"raster-value":[he,[],e=>e.globals.rasterValue||0],"sky-radial-progress":[he,[],e=>e.globals.skyRadialProgress||0],accumulated:[Yi,[],e=>e.globals.accumulated===void 0?null:e.globals.accumulated],"+":[he,Xd(he),(e,t)=>{let i=0;for(let o of t)i+=o.evaluate(e);return i}],"*":[he,Xd(he),(e,t)=>{let i=1;for(let o of t)i*=o.evaluate(e);return i}],"-":{type:he,overloads:[[[he,he],(e,[t,i])=>t.evaluate(e)-i.evaluate(e)],[[he],(e,[t])=>-t.evaluate(e)]]},"/":[he,[he,he],(e,[t,i])=>t.evaluate(e)/i.evaluate(e)],"%":[he,[he,he],(e,[t,i])=>t.evaluate(e)%i.evaluate(e)],ln2:[he,[],()=>Math.LN2],pi:[he,[],()=>Math.PI],e:[he,[],()=>Math.E],"^":[he,[he,he],(e,[t,i])=>Math.pow(t.evaluate(e),i.evaluate(e))],sqrt:[he,[he],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[he,[he],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[he,[he],(e,[t])=>Math.log(t.evaluate(e))],log2:[he,[he],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[he,[he],(e,[t])=>Math.sin(t.evaluate(e))],cos:[he,[he],(e,[t])=>Math.cos(t.evaluate(e))],tan:[he,[he],(e,[t])=>Math.tan(t.evaluate(e))],asin:[he,[he],(e,[t])=>Math.asin(t.evaluate(e))],acos:[he,[he],(e,[t])=>Math.acos(t.evaluate(e))],atan:[he,[he],(e,[t])=>Math.atan(t.evaluate(e))],min:[he,Xd(he),(e,t)=>Math.min(...t.map(i=>i.evaluate(e)))],max:[he,Xd(he),(e,t)=>Math.max(...t.map(i=>i.evaluate(e)))],abs:[he,[he],(e,[t])=>Math.abs(t.evaluate(e))],round:[he,[he],(e,[t])=>{let i=t.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[he,[he],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[he,[he],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[Qi,[Wi,Yi],(e,[t,i])=>e.properties()[t.value]===i.value],"filter-id-==":[Qi,[Yi],(e,[t])=>e.id()===t.value],"filter-type-==":[Qi,[Wi],(e,[t])=>e.geometryType()===t.value],"filter-<":[Qi,[Wi,Yi],(e,[t,i])=>{let o=e.properties()[t.value],c=i.value;return typeof o==typeof c&&o<c}],"filter-id-<":[Qi,[Yi],(e,[t])=>{let i=e.id(),o=t.value;return typeof i==typeof o&&i<o}],"filter->":[Qi,[Wi,Yi],(e,[t,i])=>{let o=e.properties()[t.value],c=i.value;return typeof o==typeof c&&o>c}],"filter-id->":[Qi,[Yi],(e,[t])=>{let i=e.id(),o=t.value;return typeof i==typeof o&&i>o}],"filter-<=":[Qi,[Wi,Yi],(e,[t,i])=>{let o=e.properties()[t.value],c=i.value;return typeof o==typeof c&&o<=c}],"filter-id-<=":[Qi,[Yi],(e,[t])=>{let i=e.id(),o=t.value;return typeof i==typeof o&&i<=o}],"filter->=":[Qi,[Wi,Yi],(e,[t,i])=>{let o=e.properties()[t.value],c=i.value;return typeof o==typeof c&&o>=c}],"filter-id->=":[Qi,[Yi],(e,[t])=>{let i=e.id(),o=t.value;return typeof i==typeof o&&i>=o}],"filter-has":[Qi,[Yi],(e,[t])=>t.value in e.properties()],"filter-has-id":[Qi,[],e=>e.id()!==null&&e.id()!==void 0],"filter-type-in":[Qi,[ys(Wi)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[Qi,[ys(Yi)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[Qi,[Wi,ys(Yi)],(e,[t,i])=>i.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[Qi,[Wi,ys(Yi)],(e,[t,i])=>function(o,c,u,h){for(;u<=h;){let p=u+h>>1;if(c[p]===o)return!0;c[p]>o?h=p-1:u=p+1}return!1}(e.properties()[t.value],i.value,0,i.value.length-1)],all:{type:Qi,overloads:[[[Qi,Qi],(e,[t,i])=>t.evaluate(e)&&i.evaluate(e)],[Xd(Qi),(e,t)=>{for(let i of t)if(!i.evaluate(e))return!1;return!0}]]},any:{type:Qi,overloads:[[[Qi,Qi],(e,[t,i])=>t.evaluate(e)||i.evaluate(e)],[Xd(Qi),(e,t)=>{for(let i of t)if(i.evaluate(e))return!0;return!1}]]},"!":[Qi,[Qi],(e,[t])=>!t.evaluate(e)],"is-supported-script":[Qi,[Wi],(e,[t])=>{let i=e.globals&&e.globals.isSupportedScript;return!i||i(t.evaluate(e))}],upcase:[Wi,[Wi],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[Wi,[Wi],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[Wi,Xd(Yi),(e,t)=>t.map(i=>up(i.evaluate(e))).join("")],"resolved-locale":[Wi,[r_],(e,[t])=>t.evaluate(e).resolvedLocale()],random:[he,[he,he,Yi],(e,t)=>{let[i,o,c]=t.map(h=>h.evaluate(e));if(i>o||i===o)return i;let u;if(typeof c=="string")u=function(h){let p=0;if(h.length===0)return p;for(let f=0;f<h.length;f++)p=(p<<5)-p+h.charCodeAt(f),p&=p;return p}(c);else{if(typeof c!="number")throw new Ro(`Invalid seed input: ${c}`);u=c}return i+P1(u)()*(o-i)}]});var wp=yI;function MI(e){return{result:"success",value:e}}function Kd(e){return{result:"error",value:e}}function DI(e,t){return!!e&&!!e.parameters&&e.parameters.indexOf(t)>-1}function Qd(e){return e["property-type"]==="data-driven"}function TI(e){return DI(e.expression,"measure-light")}function F1(e){return DI(e.expression,"zoom")}function L1(e){return!!e.expression&&e.expression.interpolated}function v_(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function n6(e){return e}function II(e,t){let i=t.type==="color",o=e.stops&&typeof e.stops[0][0]=="object",c=o||!(o||e.property!==void 0),u=e.type||(L1(t)?"exponential":"interval");if(i&&((e=ic({},e)).stops&&(e.stops=e.stops.map(g=>[g[0],_i.parse(g[1])])),e.default=_i.parse(e.default?e.default:t.default)),e.colorSpace&&e.colorSpace!=="rgb"&&!pI[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let h,p,f;if(u==="exponential")h=AI;else if(u==="interval")h=o6;else if(u==="categorical"){h=r6,p=Object.create(null);for(let g of e.stops)p[g[0]]=g[1];f=typeof e.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);h=s6}if(o){let g={},v=[];for(let x=0;x<e.stops.length;x++){let C=e.stops[x],E=C[0].zoom;g[E]===void 0&&(g[E]={zoom:E,type:e.type,property:e.property,default:e.default,stops:[]},v.push(E)),g[E].stops.push([C[0].value,C[1]])}let y=[];for(let x of v)y.push([g[x].zoom,II(g[x],t)]);let b={name:"linear"};return{kind:"composite",interpolationType:b,interpolationFactor:Cl.interpolationFactor.bind(void 0,b),zoomStops:y.map(x=>x[0]),evaluate:({zoom:x},C)=>AI({stops:y,base:e.base},t,x).evaluate(x,C)}}if(c){let g=u==="exponential"?{name:"exponential",base:e.base!==void 0?e.base:1}:null;return{kind:"camera",interpolationType:g,interpolationFactor:Cl.interpolationFactor.bind(void 0,g),zoomStops:e.stops.map(v=>v[0]),evaluate:({zoom:v})=>h(e,t,v,p,f)}}return{kind:"source",evaluate(g,v){let y=v&&v.properties?v.properties[e.property]:void 0;return y===void 0?Cp(e.default,t.default):h(e,t,y,p,f)}}}function Cp(e,t,i){return e!==void 0?e:t!==void 0?t:i!==void 0?i:void 0}function r6(e,t,i,o,c){return Cp(typeof i===c?o[i]:void 0,e.default,t.default)}function o6(e,t,i){if(dn(i)!=="number")return Cp(e.default,t.default);let o=e.stops.length;if(o===1||i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[o-1][0])return e.stops[o-1][1];let c=m_(e.stops.map(u=>u[0]),i);return e.stops[c][1]}function AI(e,t,i){let o=e.base!==void 0?e.base:1;if(dn(i)!=="number")return Cp(e.default,t.default);let c=e.stops.length;if(c===1||i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[c-1][0])return e.stops[c-1][1];let u=m_(e.stops.map(v=>v[0]),i),h=function(v,y,b,x){let C=x-b,E=v-b;return C===0?0:y===1?E/C:(Math.pow(y,E)-1)/(Math.pow(y,C)-1)}(i,o,e.stops[u][0],e.stops[u+1][0]),p=e.stops[u][1],f=e.stops[u+1][1],g=p_[t.type]||n6;if(e.colorSpace&&e.colorSpace!=="rgb"){let v=pI[e.colorSpace];g=(y,b)=>v.reverse(v.interpolate(v.forward(y),v.forward(b),h))}return typeof p.evaluate=="function"?{evaluate(...v){let y=p.evaluate.apply(void 0,v),b=f.evaluate.apply(void 0,v);if(y!==void 0&&b!==void 0)return g(y,b,h)}}:g(p,f,h)}function s6(e,t,i){return t.type==="color"?i=_i.parse(i):t.type==="formatted"?i=xs.fromString(i.toString()):t.type==="resolvedImage"?i=da.fromString(i.toString()):dn(i)===t.type||t.type==="enum"&&t.values[i]||(i=void 0),Cp(i,e.default,t.default)}class z1{constructor(t,i,o){this.expression=t,this._warningHistory={},this._evaluator=new HT(o),this._defaultValue=i?function(c){return c.type==="color"&&(v_(c.default)||Array.isArray(c.default))?new _i(0,0,0,0):c.type==="color"?_i.parse(c.default)||null:c.default===void 0?null:c.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(t,i,o,c,u,h,p,f){return this._evaluator.globals=t,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=c||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=h,this._evaluator.featureTileCoord=p||null,this._evaluator.featureDistanceData=f||null,this.expression.evaluate(this._evaluator)}evaluate(t,i,o,c,u,h,p,f){this._evaluator.globals=t,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=h||null,this._evaluator.featureTileCoord=p||null,this._evaluator.featureDistanceData=f||null;try{let g=this.expression.evaluate(this._evaluator);if(g==null||typeof g=="number"&&g!=g)return this._defaultValue;if(this._enumValues&&!(g in this._enumValues))throw new Ro(`Expected value to be one of ${Object.keys(this._enumValues).map(v=>JSON.stringify(v)).join(", ")}, but found ${JSON.stringify(g)} instead.`);return g}catch(g){return this._warningHistory[g.message]||(this._warningHistory[g.message]=!0,typeof console<"u"&&console.warn(g.message)),this._defaultValue}}}function y_(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in wp}function Uc(e,t,i){let o=new sI(wp,[],t?function(u){let h={color:ca,string:Wi,number:he,enum:Wi,boolean:Qi,formatted:ap,resolvedImage:lp};return u.type==="array"?ys(h[u.value]||Yi,u.length):h[u.type]}(t):void 0,void 0,void 0,i),c=o.parse(e,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?MI(new z1(c,t,i)):Kd(o.errors)}class N1{constructor(t,i,o){this.kind=t,this._styleExpression=i,this.isLightConstant=o,this.isStateDependent=t!=="constant"&&!yp(i.expression),this.isConfigDependent=!p1(i.expression)}evaluateWithoutErrorHandling(t,i,o,c,u,h){return this._styleExpression.evaluateWithoutErrorHandling(t,i,o,c,u,h)}evaluate(t,i,o,c,u,h){return this._styleExpression.evaluate(t,i,o,c,u,h)}}class Hc{constructor(t,i,o,c,u){this.kind=t,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=t!=="camera"&&!yp(i.expression),this.isLightConstant=u,this.isConfigDependent=!p1(i.expression),this.interpolationType=c}evaluateWithoutErrorHandling(t,i,o,c,u,h){return this._styleExpression.evaluateWithoutErrorHandling(t,i,o,c,u,h)}evaluate(t,i,o,c,u,h){return this._styleExpression.evaluate(t,i,o,c,u,h)}interpolationFactor(t,i,o){return this.interpolationType?Cl.interpolationFactor(this.interpolationType,t,i,o):0}}function B1(e,t,i){if((e=Uc(e,t,i)).result==="error")return e;let o=e.value.expression,c=rh(o);if(!c&&!Qd(t))return Kd([new xl("","data expressions not supported")]);let u=oh(o,["zoom","pitch","distance-from-center"]);if(!u&&!F1(t))return Kd([new xl("","zoom expressions not supported")]);let h=oh(o,["measure-light"]);if(!h&&!TI(t))return Kd([new xl("","measure-light expression not supported")]);let p=t.expression&&t.expression.relaxZoomRestriction,f=x_(o);return f||u||p?f instanceof xl?Kd([f]):f instanceof Cl&&!L1(t)?Kd([new xl("",'"interpolate" expressions cannot be used with this property')]):MI(f?new Hc(c?"camera":"composite",e.value,f.labels,f instanceof Cl?f.interpolation:void 0,h):new N1(c?"constant":"source",e.value,h)):Kd([new xl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class b_{constructor(t,i){this._parameters=t,this._specification=i,ic(this,II(this._parameters,this._specification))}static deserialize(t){return new b_(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function x_(e){let t=null;if(e instanceof gI)t=x_(e.result);else if(e instanceof fI){for(let i of e.args)if(t=x_(i),t)break}else(e instanceof y1||e instanceof Cl)&&e.input instanceof wl&&e.input.name==="zoom"&&(t=e);return t instanceof xl||e.eachChild(i=>{let o=x_(i);o instanceof xl?t=o:t&&o&&t!==o&&(t=new xl("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function ua(e){let t=e.key,i=e.value,o=e.valueSpec||{},c=e.objectElementValidators||{},u=e.style,h=e.styleSpec,p=[],f=dn(i);if(f!=="object")return[new xe(t,i,`object expected, ${f} found`)];for(let g in i){let v=g.split(".")[0],y;c[v]?y=c[v]:o[v]?y=Bo:c["*"]?y=c["*"]:o["*"]&&(y=Bo),y?p=p.concat(y({key:(t&&`${t}.`)+g,value:i[g],valueSpec:o[v]||o["*"],style:u,styleSpec:h,object:i,objectKey:g},i)):p.push(new Wd(t,i[g],`unknown property "${g}"`))}for(let g in o)c[g]||o[g].required&&o[g].default===void 0&&i[g]===void 0&&p.push(new xe(t,i,`missing required property "${g}"`));return p}function kI(e){let t=e.value,i=e.valueSpec,o=e.style,c=e.styleSpec,u=e.key,h=e.arrayElementValidator||Bo;if(dn(t)!=="array")return[new xe(u,t,`array expected, ${dn(t)} found`)];if(i.length&&t.length!==i.length)return[new xe(u,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new xe(u,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let p={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};c.$version<7&&(p.function=i.function),dn(i.value)==="object"&&(p=i.value);let f=[];for(let g=0;g<t.length;g++)f=f.concat(h({array:t,arrayIndex:g,value:t[g],valueSpec:p,style:o,styleSpec:c,key:`${u}[${g}]`},!0));return f}function RI(e){let t=e.key,i=e.value,o=e.valueSpec,c=dn(i);if(c==="number"&&i!=i&&(c="NaN"),c!=="number")return[new xe(t,i,`number expected, ${c} found`)];if("minimum"in o){let u=o.minimum;if(dn(o.minimum)==="array"&&(u=o.minimum[e.arrayIndex]),i<u)return[new xe(t,i,`${i} is less than the minimum value ${u}`)]}if("maximum"in o){let u=o.maximum;if(dn(o.maximum)==="array"&&(u=o.maximum[e.arrayIndex]),i>u)return[new xe(t,i,`${i} is greater than the maximum value ${u}`)]}return[]}function PI(e){let t=e.valueSpec,i=to(e.value.type),o,c,u,h={},p=i!=="categorical"&&e.value.property===void 0,f=!p,g=dn(e.value.stops)==="array"&&dn(e.value.stops[0])==="array"&&dn(e.value.stops[0][0])==="object",v=ua({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(x){if(i==="identity")return[new xe(x.key,x.value,'identity function may not have a "stops" property')];let C=[],E=x.value;return C=C.concat(kI({key:x.key,value:E,valueSpec:x.valueSpec,style:x.style,styleSpec:x.styleSpec,arrayElementValidator:y})),dn(E)==="array"&&E.length===0&&C.push(new xe(x.key,E,"array must have at least one stop")),C},default:function(x){return Bo({key:x.key,value:x.value,valueSpec:t,style:x.style,styleSpec:x.styleSpec})}}});return i==="identity"&&p&&v.push(new xe(e.key,e.value,'missing required property "property"')),i==="identity"||e.value.stops||v.push(new xe(e.key,e.value,'missing required property "stops"')),i==="exponential"&&e.valueSpec.expression&&!L1(e.valueSpec)&&v.push(new xe(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(f&&!Qd(e.valueSpec)?v.push(new xe(e.key,e.value,"property functions not supported")):p&&!F1(e.valueSpec)&&v.push(new xe(e.key,e.value,"zoom functions not supported"))),i!=="categorical"&&!g||e.value.property!==void 0||v.push(new xe(e.key,e.value,'"property" property is required')),v;function y(x){let C=[],E=x.value,M=x.key;if(dn(E)!=="array")return[new xe(M,E,`array expected, ${dn(E)} found`)];if(E.length!==2)return[new xe(M,E,`array length 2 expected, length ${E.length} found`)];if(g){if(dn(E[0])!=="object")return[new xe(M,E,`object expected, ${dn(E[0])} found`)];if(E[0].zoom===void 0)return[new xe(M,E,"object stop key must have zoom")];if(E[0].value===void 0)return[new xe(M,E,"object stop key must have value")];let D=to(E[0].zoom);if(typeof D!="number")return[new xe(M,E[0].zoom,"stop zoom values must be numbers")];if(u&&u>D)return[new xe(M,E[0].zoom,"stop zoom values must appear in ascending order")];D!==u&&(u=D,c=void 0,h={}),C=C.concat(ua({key:`${M}[0]`,value:E[0],valueSpec:{zoom:{}},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{zoom:RI,value:b}}))}else C=C.concat(b({key:`${M}[0]`,value:E[0],valueSpec:{},style:x.style,styleSpec:x.styleSpec},E));return y_(nc(E[1]))?C.concat([new xe(`${M}[1]`,E[1],"expressions are not allowed in function stops.")]):C.concat(Bo({key:`${M}[1]`,value:E[1],valueSpec:t,style:x.style,styleSpec:x.styleSpec}))}function b(x,C){let E=dn(x.value),M=to(x.value),D=x.value!==null?x.value:C;if(o){if(E!==o)return[new xe(x.key,D,`${E} stop domain type must match previous stop domain type ${o}`)]}else o=E;if(E!=="number"&&E!=="string"&&E!=="boolean"&&typeof M!="number"&&typeof M!="string"&&typeof M!="boolean")return[new xe(x.key,D,"stop domain value must be a number, string, or boolean")];if(E!=="number"&&i!=="categorical"){let A=`number expected, ${E} found`;return Qd(t)&&i===void 0&&(A+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new xe(x.key,D,A)]}return i!=="categorical"||E!=="number"||typeof M=="number"&&isFinite(M)&&Math.floor(M)===M?i!=="categorical"&&E==="number"&&typeof M=="number"&&typeof c=="number"&&c!==void 0&&M<c?[new xe(x.key,D,"stop domain values must appear in ascending order")]:(c=M,i==="categorical"&&M in h?[new xe(x.key,D,"stop domain values must be unique")]:(h[M]=!0,[])):[new xe(x.key,D,`integer expected, found ${String(M)}`)]}}function Jd(e){let t=(e.expressionContext==="property"?B1:Uc)(nc(e.value),e.valueSpec);if(t.result==="error")return t.value.map(o=>new xe(`${e.key}${o.key}`,e.value,o.message));let i=t.value.expression||t.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!i.outputDefined())return[new xe(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!yp(i))return[new xe(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter")return OI(i,e);if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!oh(i,["zoom","feature-state"]))return[new xe(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!rh(i))return[new xe(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function OI(e,t){let i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(let c of t.valueSpec.expression.parameters)i.delete(c);if(i.size===0)return[];let o=[];return e instanceof wl&&i.has(e.name)?[new xe(t.key,t.value,`["${e.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(e.eachChild(c=>{o.push(...OI(c,t))}),o)}function w_(e){let t=e.key,i=e.value,o=e.valueSpec,c=[];return Array.isArray(o.values)?o.values.indexOf(to(i))===-1&&c.push(new xe(t,i,`expected one of [${o.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(o.values).indexOf(to(i))===-1&&c.push(new xe(t,i,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(i)} found`)),c}function V1(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(let t of e.slice(1))if(!V1(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function C_(e,t="fill"){if(e==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};V1(e)||(e=S_(e));let i=e,o=!0;try{o=function(g){if(!lh(g))return g;let v=nc(g);return LI(v),v=FI(v),v}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}let c=_t[`filter_${t}`],u=Uc(o,c),h=null;if(u.result==="error")throw new Error(u.value.map(g=>`${g.key}: ${g.message}`).join(", "));h=(g,v,y)=>u.value.evaluate(g,v,{},y);let p=null,f=null;if(o!==i){let g=Uc(i,c);if(g.result==="error")throw new Error(g.value.map(v=>`${v.key}: ${v.message}`).join(", "));p=(v,y,b,x,C)=>g.value.evaluate(v,y,{},b,void 0,void 0,x,C),f=!rh(g.value.expression)}return{filter:h,dynamicFilter:p||void 0,needGeometry:zI(o),needFeature:!!f}}function FI(e){if(!Array.isArray(e))return e;let t=function(i){if(a6.has(i[0])){for(let o=1;o<i.length;o++)if(lh(i[o]))return!0}return i}(e);return t===!0?t:t.map(i=>FI(i))}function LI(e){let t=!1,i=[];if(e[0]==="case"){for(let o=1;o<e.length-1;o+=2)t=t||lh(e[o]),i.push(e[o+1]);i.push(e[e.length-1])}else if(e[0]==="match"){t=t||lh(e[1]);for(let o=2;o<e.length-1;o+=2)i.push(e[o+1]);i.push(e[e.length-1])}else if(e[0]==="step"){t=t||lh(e[1]);for(let o=1;o<e.length-1;o+=2)i.push(e[o+1])}t&&(e.length=0,e.push("any",...i));for(let o=1;o<e.length;o++)LI(e[o])}function lh(e){if(!Array.isArray(e))return!1;if((t=e[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let i=1;i<e.length;i++)if(lh(e[i]))return!0;return!1}let a6=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function l6(e,t){return e<t?-1:e>t?1:0}function zI(e){if(!Array.isArray(e))return!1;if(e[0]==="within"||e[0]==="distance")return!0;for(let t=1;t<e.length;t++)if(zI(e[t]))return!0;return!1}function S_(e){if(!e)return!0;let t=e[0];return e.length<=1?t!=="any":t==="=="?j1(e[1],e[2],"=="):t==="!="?E_(j1(e[1],e[2],"==")):t==="<"||t===">"||t==="<="||t===">="?j1(e[1],e[2],t):t==="any"?(i=e.slice(1),["any"].concat(i.map(S_))):t==="all"?["all"].concat(e.slice(1).map(S_)):t==="none"?["all"].concat(e.slice(1).map(S_).map(E_)):t==="in"?NI(e[1],e.slice(2)):t==="!in"?E_(NI(e[1],e.slice(2))):t==="has"?BI(e[1]):t!=="!has"||E_(BI(e[1]));var i}function j1(e,t,i){switch(e){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,e,t]}}function NI(e,t){if(t.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(i=>typeof i!=typeof t[0])?["filter-in-large",e,["literal",t.sort(l6)]]:["filter-in-small",e,["literal",t]]}}function BI(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function E_(e){return["!",e]}function U1(e){return V1(nc(e.value))?Jd(ic({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${e.layerType||"fill"}`]})):VI(e)}function VI(e){let t=e.value,i=e.key;if(dn(t)!=="array")return[new xe(i,t,`array expected, ${dn(t)} found`)];let o=e.styleSpec,c,u=[];if(t.length<1)return[new xe(i,t,"filter array must have at least 1 element")];switch(u=u.concat(w_({key:`${i}[0]`,value:t[0],valueSpec:o.filter_operator,style:e.style,styleSpec:e.styleSpec})),to(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&to(t[1])==="$type"&&u.push(new xe(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&u.push(new xe(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(c=dn(t[1]),c!=="string"&&u.push(new xe(`${i}[1]`,t[1],`string expected, ${c} found`)));for(let h=2;h<t.length;h++)c=dn(t[h]),to(t[1])==="$type"?u=u.concat(w_({key:`${i}[${h}]`,value:t[h],valueSpec:o.geometry_type,style:e.style,styleSpec:e.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&u.push(new xe(`${i}[${h}]`,t[h],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let h=1;h<t.length;h++)u=u.concat(VI({key:`${i}[${h}]`,value:t[h],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":c=dn(t[1]),t.length!==2?u.push(new xe(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):c!=="string"&&u.push(new xe(`${i}[1]`,t[1],`string expected, ${c} found`))}return u}function jI(e,t){let i=e.key,o=e.style,c=e.layer,u=e.styleSpec,h=e.value,p=e.objectKey,f=u[`${t}_${e.layerType}`];if(!f)return[];let g=p.match(/^(.*)-transition$/);if(t==="paint"&&g&&f[g[1]]&&f[g[1]].transition)return Bo({key:i,value:h,valueSpec:u.transition,style:o,styleSpec:u});let v=e.valueSpec||f[p];if(!v)return[new Wd(i,h,`unknown property "${p}"`)];let y;if(dn(h)==="string"&&Qd(v)&&!v.tokens&&(y=/^{([^}]+)}$/.exec(h))){let x=`\`{ "type": "identity", "property": ${y?JSON.stringify(y[1]):'"_"'} }\``;return[new xe(i,h,`"${p}" does not support interpolation syntax
Use an identity property function instead: ${x}.`)]}let b=[];if(e.layerType==="symbol")p!=="text-field"||!o||o.glyphs||o.imports||b.push(new xe(i,h,'use of "text-field" requires a style "glyphs" property')),p==="text-font"&&v_(nc(h))&&to(h.type)==="identity"&&b.push(new xe(i,h,'"text-font" does not support identity functions'));else if(e.layerType==="model"&&t==="paint"&&c&&c.layout&&c.layout.hasOwnProperty("model-id")&&Qd(v)&&(TI(v)||F1(v))){let x=B1(nc(h),v),C=x.value.expression||x.value._styleExpression.expression;C&&!oh(C,["measure-light"])&&(p==="model-emissive-strength"&&rh(C)&&yp(C)||b.push(new xe(i,h,`${p} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return b.concat(Bo({key:e.key,value:h,valueSpec:v,style:o,styleSpec:u,expressionContext:"property",propertyType:t,propertyKey:p}))}function UI(e){return jI(e,"paint")}function HI(e){return jI(e,"layout")}function GI(e){let t=[],i=e.value,o=e.key,c=e.style,u=e.styleSpec;i.type||i.ref||t.push(new xe(o,i,'either "type" or "ref" is required'));let h=to(i.type),p=to(i.ref);if(i.id){let f=to(i.id);for(let g=0;g<e.arrayIndex;g++){let v=c.layers[g];to(v.id)===f&&t.push(new xe(o,i.id,`duplicate layer id "${i.id}", previously used at line ${v.id.__line__}`))}}if("ref"in i){let f;["type","source","source-layer","filter","layout"].forEach(g=>{g in i&&t.push(new xe(o,i[g],`"${g}" is prohibited for ref layers`))}),c.layers.forEach(g=>{to(g.id)===p&&(f=g)}),f?f.ref?t.push(new xe(o,i.ref,"ref cannot reference another ref layer")):h=to(f.type):typeof p=="string"&&t.push(new xe(o,i.ref,`ref layer "${p}" not found`))}else if(h!=="background"&&h!=="sky"&&h!=="slot")if(i.source){let f=c.sources&&c.sources[i.source],g=f&&to(f.type);f?g==="vector"&&h==="raster"?t.push(new xe(o,i.source,`layer "${i.id}" requires a raster source`)):g==="raster"&&h!=="raster"?t.push(new xe(o,i.source,`layer "${i.id}" requires a vector source`)):g!=="vector"||i["source-layer"]?g==="raster-dem"&&h!=="hillshade"?t.push(new xe(o,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):h!=="line"||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||g==="geojson"&&f.lineMetrics||t.push(new xe(o,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new xe(o,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new xe(o,i.source,`source "${i.source}" not found`))}else t.push(new xe(o,i,'missing required property "source"'));return t=t.concat(ua({key:o,value:i,valueSpec:u.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Bo({key:`${o}.type`,value:i.type,valueSpec:u.layer.type,style:e.style,styleSpec:e.styleSpec,object:i,objectKey:"type"}),filter:f=>U1(ic({layerType:h},f)),layout:f=>ua({layer:i,key:f.key,value:f.value,valueSpec:{},style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":g=>HI(ic({layerType:h},g))}}),paint:f=>ua({layer:i,key:f.key,value:f.value,valueSpec:{},style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":g=>UI(ic({layerType:h,layer:i},g))}})}})),t}function ch(e){let t=e.value,i=e.key,o=dn(t);return o!=="string"?[new xe(i,t,`string expected, ${o} found`)]:[]}let qI={promoteId:function({key:e,value:t}){if(dn(t)==="string")return ch({key:e,value:t});{let i=[];for(let o in t)i.push(...ch({key:`${e}.${o}`,value:t[o]}));return i}}};function WI(e){let t=e.value,i=e.key,o=e.styleSpec,c=e.style;if(!t.type)return[new xe(i,t,'"type" is required')];let u=to(t.type),h=[];switch(["vector","raster","raster-dem"].includes(u)&&(t.url||t.tiles||h.push(new xe(i,t,'Either "url" or "tiles" is required.'))),u){case"vector":case"raster":case"raster-dem":return h=h.concat(ua({key:i,value:t,valueSpec:o[`source_${u.replace("-","_")}`],style:e.style,styleSpec:o,objectElementValidators:qI})),h;case"geojson":if(h=ua({key:i,value:t,valueSpec:o.source_geojson,style:c,styleSpec:o,objectElementValidators:qI}),t.cluster)for(let p in t.clusterProperties){let[f,g]=t.clusterProperties[p],v=typeof f=="string"?[f,["accumulated"],["get",p]]:f;h.push(...Jd({key:`${i}.${p}.map`,value:g,expressionContext:"cluster-map"})),h.push(...Jd({key:`${i}.${p}.reduce`,value:v,expressionContext:"cluster-reduce"}))}return h;case"video":return ua({key:i,value:t,valueSpec:o.source_video,style:c,styleSpec:o});case"image":return ua({key:i,value:t,valueSpec:o.source_image,style:c,styleSpec:o});case"canvas":return[new xe(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return w_({key:`${i}.type`,value:t.type,valueSpec:{values:c6(o)},style:c,styleSpec:o})}}function c6(e){return e.source.reduce((t,i)=>{let o=e[i];return o.type.type==="enum"&&(t=t.concat(Object.keys(o.type.values))),t},[])}function $I(e){let t=e.value,i=[];if(!t)return i;let o=dn(t);return o!=="string"?(i=i.concat([new xe(e.key,t,`string expected, "${o}" found`)]),i):(function(c){let u=c.indexOf("://")===-1;try{return new URL(c,u?"http://example.com":void 0),!0}catch{return!1}}(t)||(i=i.concat([new xe(e.key,t,`invalid url "${t}"`)])),i)}function YI(e){let t=e.value,i=e.styleSpec,o=i.light,c=e.style,u=[],h=dn(t);if(t===void 0)return u;if(h!=="object")return u=u.concat([new xe("light",t,`object expected, ${h} found`)]),u;for(let p in t){let f=p.match(/^(.*)-transition$/);u=u.concat(f&&o[f[1]]&&o[f[1]].transition?Bo({key:p,value:t[p],valueSpec:i.transition,style:c,styleSpec:i}):o[p]?Bo({key:p,value:t[p],valueSpec:o[p],style:c,styleSpec:i}):[new xe(p,t[p],`unknown property "${p}"`)])}return u}function ZI(e){let t=e.value,i=[];if(!t)return i;let o=dn(t);if(o!=="object")return i=i.concat([new xe("light-3d",t,`object expected, ${o} found`)]),i;let c=e.styleSpec,u=c["light-3d"],h=e.key,p=e.style,f=e.style.lights;for(let y of["type","id"])if(!(y in t))return i=i.concat([new xe("light-3d",t,`missing property ${y} on light`)]),i;if(t.type&&f)for(let y=0;y<e.arrayIndex;y++){let b=to(t.type),x=f[y];to(x.type)===b&&i.push(new xe(h,t.id,`duplicate light type "${t.type}", previously defined at line ${x.id.__line__}`))}let g=`properties_light_${t.type}`;if(!(g in c))return i=i.concat([new xe("light-3d",t,`Invalid light type ${t.type}`)]),i;let v=c[g];for(let y in t)if(y==="properties"){let b=t[y],x=dn(b);if(x!=="object")return i=i.concat([new xe("properties",b,`object expected, ${x} found`)]),i;for(let C in b)i=i.concat(v[C]?Bo({key:C,value:b[C],valueSpec:v[C],style:p,styleSpec:c}):[new Wd(e.key,b[C],`unknown property "${C}"`)])}else{let b=y.match(/^(.*)-transition$/);i=i.concat(b&&u[b[1]]&&u[b[1]].transition?Bo({key:y,value:t[y],valueSpec:c.transition,style:p,styleSpec:c}):u[y]?Bo({key:y,value:t[y],valueSpec:u[y],style:p,styleSpec:c}):[new Wd(y,t[y],`unknown property "${y}"`)])}return i}function XI(e){let t=e.value,i=e.key,o=e.style,c=e.styleSpec,u=c.terrain,h=[],p=dn(t);if(t===void 0||p==="null")return h;if(p!=="object")return h=h.concat([new xe("terrain",t,`object expected, ${p} found`)]),h;for(let f in t){let g=f.match(/^(.*)-transition$/);h=h.concat(g&&u[g[1]]&&u[g[1]].transition?Bo({key:f,value:t[f],valueSpec:c.transition,style:o,styleSpec:c}):u[f]?Bo({key:f,value:t[f],valueSpec:u[f],style:o,styleSpec:c}):[new Wd(f,t[f],`unknown property "${f}"`)])}if(t.source){let f=o.sources&&o.sources[t.source],g=f&&to(f.type);f?g!=="raster-dem"&&h.push(new xe(i,t.source,`terrain cannot be used with a source of type ${String(g)}, it only be used with a "raster-dem" source type`)):h.push(new xe(i,t.source,`source "${t.source}" not found`))}else h.push(new xe(i,t,'terrain is missing required property "source"'));return h}function KI(e){let t=e.value,i=e.style,o=e.styleSpec,c=o.fog,u=[],h=dn(t);if(t===void 0)return u;if(h!=="object")return u=u.concat([new xe("fog",t,`object expected, ${h} found`)]),u;for(let p in t){let f=p.match(/^(.*)-transition$/);u=u.concat(f&&c[f[1]]&&c[f[1]].transition?Bo({key:p,value:t[p],valueSpec:o.transition,style:i,styleSpec:o}):c[p]?Bo({key:p,value:t[p],valueSpec:c[p],style:i,styleSpec:o}):[new Wd(p,t[p],`unknown property "${p}"`)])}return u}let QI={"*":()=>[],array:kI,boolean:function(e){let t=e.value,i=e.key,o=dn(t);return o!=="boolean"?[new xe(i,t,`boolean expected, ${o} found`)]:[]},number:RI,color:function(e){let t=e.key,i=e.value,o=dn(i);return o!=="string"?[new xe(t,i,`color expected, ${o} found`)]:$x(i)===null?[new xe(t,i,`color expected, "${i}" found`)]:[]},enum:w_,filter:U1,function:PI,layer:GI,object:ua,source:WI,model:$I,light:YI,"light-3d":ZI,terrain:XI,fog:KI,string:ch,formatted:function(e){return ch(e).length===0?[]:Jd(e)},resolvedImage:function(e){return ch(e).length===0?[]:Jd(e)},projection:function(e){let t=e.value,i=e.styleSpec,o=i.projection,c=e.style,u=[],h=dn(t);if(h==="object")for(let p in t)u=u.concat(Bo({key:p,value:t[p],valueSpec:o[p],style:c,styleSpec:i}));else h!=="string"&&(u=u.concat([new xe("projection",t,`object or string expected, ${h} found`)]));return u},import:function(e){let{value:t,styleSpec:i}=e,h=t,{data:o}=h,c=wS(h,["data"]);Object.defineProperty(c,"__line__",{value:t.__line__,enumerable:!1});let u=ua(ic({},e,{value:c,valueSpec:i.import}));return to(c.id)===""&&u.push(new xe(`${e.key}.id`,c,"import id can't be an empty string")),o&&(u=u.concat(JI(o,i,{key:`${e.key}.data`}))),u}};function Bo(e,t=!1){let i=e.value,o=e.valueSpec,c=e.styleSpec;if(o.expression&&v_(to(i)))return PI(e);if(o.expression&&y_(nc(i)))return Jd(e);if(o.type&&QI[o.type]){let u=QI[o.type](e);return t===!0&&u.length>0&&dn(e.value)==="array"?Jd(e):u}return ua(ic({},e,{valueSpec:o.type?c[o.type]:o}))}function d6(e){let t=e.value,i=e.key,o=ch(e);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new xe(i,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new xe(i,t,'"glyphs" url must include a "{range}" token'))),o}function JI(e,t=_t,i={}){return Bo({key:i.key||"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:d6,"*":()=>[]}})}function dh(e,t=_t){return Ya(JI(e,t))}let u6=e=>Ya(WI(e)),h6=e=>Ya(YI(e)),m6=e=>Ya(ZI(e)),p6=e=>Ya(XI(e)),f6=e=>Ya(KI(e)),g6=e=>Ya(GI(e)),H1=e=>Ya(U1(e)),_6=e=>Ya(UI(e)),v6=e=>Ya(HI(e)),y6=e=>Ya($I(e));function Ya(e){return e.slice().sort((t,i)=>t.line&&i.line?t.line-i.line:0)}function M_(e,t){let i=!1;if(t&&t.length)for(let o of t)o instanceof Wd?lt(o.message):(e.fire(new Xe(new Error(o.message))),i=!0);return i}var b6=Sl,Gc=3;function Sl(e,t,i){var o=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var c=new Int32Array(this.arrayBuffer);e=c[0],this.d=(t=c[1])+2*(i=c[2]);for(var u=0;u<this.d*this.d;u++){var h=c[Gc+u],p=c[Gc+u+1];o.push(h===p?null:c.subarray(h,p))}var f=c[Gc+o.length+1];this.keys=c.subarray(c[Gc+o.length],f),this.bboxes=c.subarray(f),this.insert=this._insertReadonly}else{this.d=t+2*i;for(var g=0;g<this.d*this.d;g++)o.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=i,this.scale=t/e,this.uid=0;var v=i/t*e;this.min=-v,this.max=e+v}Sl.prototype.insert=function(e,t,i,o,c){this._forEachCell(t,i,o,c,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(c)},Sl.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Sl.prototype._insertCell=function(e,t,i,o,c,u){this.cells[c].push(u)},Sl.prototype.query=function(e,t,i,o,c){var u=this.min,h=this.max;if(e<=u&&t<=u&&h<=i&&h<=o&&!c)return Array.prototype.slice.call(this.keys);var p=[];return this._forEachCell(e,t,i,o,this._queryCell,p,{},c),p},Sl.prototype._queryCell=function(e,t,i,o,c,u,h,p){var f=this.cells[c];if(f!==null)for(var g=this.keys,v=this.bboxes,y=0;y<f.length;y++){var b=f[y];if(h[b]===void 0){var x=4*b;(p?p(v[x+0],v[x+1],v[x+2],v[x+3]):e<=v[x+2]&&t<=v[x+3]&&i>=v[x+0]&&o>=v[x+1])?(h[b]=!0,u.push(g[b])):h[b]=!1}}},Sl.prototype._forEachCell=function(e,t,i,o,c,u,h,p){for(var f=this._convertToCellCoord(e),g=this._convertToCellCoord(t),v=this._convertToCellCoord(i),y=this._convertToCellCoord(o),b=f;b<=v;b++)for(var x=g;x<=y;x++){var C=this.d*x+b;if((!p||p(this._convertFromCellCoord(b),this._convertFromCellCoord(x),this._convertFromCellCoord(b+1),this._convertFromCellCoord(x+1)))&&c.call(this,e,t,i,o,C,u,h,p))return}},Sl.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},Sl.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},Sl.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=Gc+this.cells.length+1+1,i=0,o=0;o<this.cells.length;o++)i+=this.cells[o].length;var c=new Int32Array(t+i+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var u=t,h=0;h<e.length;h++){var p=e[h];c[Gc+h]=u,c.set(p,u),u+=p.length}return c[Gc+e.length]=u,c.set(this.keys,u),c[Gc+e.length+1]=u+=this.keys.length,c.set(this.bboxes,u),u+=this.bboxes.length,c.buffer};var uh=mt(b6);let D_={};function Ce(e,t,i={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),D_[t]={klass:e,omit:i.omit||[]}}Ce(Object,"Object"),uh.serialize=function(e,t){let i=e.toArrayBuffer();return t&&t.add(i),{buffer:i}},uh.deserialize=function(e){return new uh(e.buffer)},Object.defineProperty(uh,"name",{value:"Grid"}),Ce(uh,"Grid"),Ce(_i,"Color"),Ce(Error,"Error"),Ce(Ot,"AJAXError"),Ce(da,"ResolvedImage"),Ce(b_,"StylePropertyFunction"),Ce(z1,"StyleExpression",{omit:["_evaluator"]}),Ce(Hc,"ZoomDependentExpression"),Ce(N1,"ZoomConstantExpression"),Ce(wl,"CompoundExpression",{omit:["_evaluate"]});for(let e in wp)D_[wp[e]._classRegistryKey]||Ce(wp[e],`Expression${e}`);function t2(e){return e&&typeof ArrayBuffer<"u"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function e2(e){return m.ImageBitmap&&e instanceof m.ImageBitmap}function hh(e,t){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(t2(e)||e2(e))return t&&t.add(e),e;if(ArrayBuffer.isView(e)){let i=e;return t&&t.add(i.buffer),i}if(e instanceof m.ImageData)return t&&t.add(e.data.buffer),e;if(Array.isArray(e)){let i=[];for(let o of e)i.push(hh(o,t));return i}if(e instanceof Map){let i={$name:"Map"};for(let[o,c]of e.entries())i[o]=hh(c);return i}if(typeof e=="object"){let i=e.constructor,o=i._classRegistryKey;if(!o)throw new Error(`can't serialize object of unregistered class ${o}`);let c=i.serialize?i.serialize(e,t):{};if(!i.serialize){for(let u in e)e.hasOwnProperty(u)&&(D_[o].omit.indexOf(u)>=0||(c[u]=hh(e[u],t)));e instanceof Error&&(c.message=e.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(c.$name=o),c}throw new Error("can't serialize object of type "+typeof e)}function mh(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||t2(e)||e2(e)||ArrayBuffer.isView(e)||e instanceof m.ImageData)return e;if(Array.isArray(e))return e.map(mh);if(typeof e=="object"){let t=e.$name||"Object";if(t==="Map"){let c=new Map;for(let u of Object.keys(e))u!=="$name"&&c.set(u,mh(e[u]));return c}let{klass:i}=D_[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(e);let o=Object.create(i.prototype);for(let c of Object.keys(e))c!=="$name"&&(o[c]=mh(e[c]));return o}throw new Error("can't deserialize object of type "+typeof e)}let De={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519,"CJK Unified Ideographs Extension B":e=>e>=131072&&e<=173791};function G1(e){for(let t of e)if(q1(t.charCodeAt(0)))return!0;return!1}function x6(e){for(let t of e)if(!w6(t.charCodeAt(0)))return!1;return!0}function w6(e){return!(De.Arabic(e)||De["Arabic Supplement"](e)||De["Arabic Extended-A"](e)||De["Arabic Presentation Forms-A"](e)||De["Arabic Presentation Forms-B"](e))}function q1(e){return!(e!==746&&e!==747&&(e<4352||!(De["Bopomofo Extended"](e)||De.Bopomofo(e)||De["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||De["CJK Compatibility Ideographs"](e)||De["CJK Compatibility"](e)||De["CJK Radicals Supplement"](e)||De["CJK Strokes"](e)||!(!De["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||De["CJK Unified Ideographs Extension A"](e)||De["CJK Unified Ideographs"](e)||De["Enclosed CJK Letters and Months"](e)||De["Hangul Compatibility Jamo"](e)||De["Hangul Jamo Extended-A"](e)||De["Hangul Jamo Extended-B"](e)||De["Hangul Jamo"](e)||De["Hangul Syllables"](e)||De.Hiragana(e)||De["Ideographic Description Characters"](e)||De.Kanbun(e)||De["Kangxi Radicals"](e)||De["Katakana Phonetic Extensions"](e)||De.Katakana(e)&&e!==12540||!(!De["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!De["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||De["Unified Canadian Aboriginal Syllabics"](e)||De["Unified Canadian Aboriginal Syllabics Extended"](e)||De["Vertical Forms"](e)||De["Yijing Hexagram Symbols"](e)||De["Yi Syllables"](e)||De["Yi Radicals"](e))))}function i2(e){return!(q1(e)||function(t){return!!(De["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||De["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||De["Letterlike Symbols"](t)||De["Number Forms"](t)||De["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||De["Control Pictures"](t)&&t!==9251||De["Optical Character Recognition"](t)||De["Enclosed Alphanumerics"](t)||De["Geometric Shapes"](t)||De["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||De["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||De["CJK Symbols and Punctuation"](t)||De.Katakana(t)||De["Private Use Area"](t)||De["CJK Compatibility Forms"](t)||De["Small Form Variants"](t)||De["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(e))}function n2(e){return e>=1424&&e<=2303||De["Arabic Presentation Forms-A"](e)||De["Arabic Presentation Forms-B"](e)}function C6(e,t){return!(!t&&n2(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||De.Khmer(e))}function S6(e){for(let t of e)if(n2(t.charCodeAt(0)))return!0;return!1}let W1="deferred",$1="loading",Y1="loaded",Z1=null,ws="unavailable",qc=null,r2=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(ws="error"),Z1&&Z1(e)};function X1(){K1.fire(new Wt("pluginStateChange",{pluginStatus:ws,pluginURL:qc}))}let K1=new Hr,Q1=function(){return ws},o2=function(){if(ws!==W1||!qc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ws=$1,X1(),qc&&ne({url:qc},e=>{e?r2(e):(ws=Y1,X1())})},ha={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ws===Y1||ha.applyArabicShaping!=null,isLoading:()=>ws===$1,setState(e){ws=e.pluginStatus,qc=e.pluginURL},isParsed:()=>ha.applyArabicShaping!=null&&ha.processBidirectionalText!=null&&ha.processStyledBidirectionalText!=null,getPluginURL:()=>qc};class ir{constructor(t,i){this.zoom=t,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(i,o){for(let c of i)if(!C6(c.charCodeAt(0),o))return!1;return!0}(t,ha.isLoaded())}}class T_{constructor(t,i,o){this.property=t,this.value=i,this.expression=function(c,u,h){if(v_(c))return new b_(c,u);if(y_(c)||Array.isArray(c)&&c.length>0){let p=B1(c,u,h);if(p.result==="error")throw new Error(p.value.map(f=>`${f.key}: ${f.message}`).join(", "));return p.value}{let p=c;return typeof c=="string"&&u.type==="color"&&(p=_i.parse(c)),{kind:"constant",isConfigDependent:!1,evaluate:()=>p}}}(i===void 0?t.specification.default:i,t.specification,o)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,i,o){return this.property.possiblyEvaluate(this,t,i,o)}}class J1{constructor(t,i){this.property=t,this.value=new T_(t,void 0,i)}transitioned(t,i){return new s2(this.property,this.value,i,ge({},t.transition,this.transition),t.now)}untransitioned(){return new s2(this.property,this.value,null,{},0)}}class Sp{constructor(t,i){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._options=i,this.isConfigDependent=!1}getValue(t){return K(this._values[t].value.value)}setValue(t,i){this._values.hasOwnProperty(t)||(this._values[t]=new J1(this._values[t].property,this._options)),this._values[t].value=new T_(this._values[t].property,i===null?void 0:K(i),this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].value.expression.isConfigDependent}setTransitionOrValue(t,i){i&&(this._options=i);let o=this._properties.properties;if(t)for(let c in t){let u=t[c];if($u(c,"-transition")){let h=c.slice(0,-11);o[h]&&this.setTransition(h,u)}else o[c]&&this.setValue(c,u)}}getTransition(t){return K(this._values[t].transition)}setTransition(t,i){this._values.hasOwnProperty(t)||(this._values[t]=new J1(this._values[t].property)),this._values[t].transition=K(i)||void 0}serialize(){let t={};for(let i of Object.keys(this._values)){let o=this.getValue(i);o!==void 0&&(t[i]=o);let c=this.getTransition(i);c!==void 0&&(t[`${i}-transition`]=c)}return t}transitioned(t,i){let o=new a2(this._properties);for(let c of Object.keys(this._values))o._values[c]=this._values[c].transitioned(t,i._values[c]);return o}untransitioned(){let t=new a2(this._properties);for(let i of Object.keys(this._values))t._values[i]=this._values[i].untransitioned();return t}}class s2{constructor(t,i,o,c,u){let h=c.delay||0,p=c.duration||0;u=u||0,this.property=t,this.value=i,this.begin=u+h,this.end=this.begin+p,t.specification.transition&&(c.delay||c.duration)&&(this.prior=o)}possiblyEvaluate(t,i,o){let c=t.now||0,u=this.value.possiblyEvaluate(t,i,o),h=this.prior;if(h){if(c>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(c<this.begin)return h.possiblyEvaluate(t,i,o);{let p=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(h.possiblyEvaluate(t,i,o),u,Dr(p))}}return u}}class a2{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,i,o){let c=new Ep(this._properties);for(let u of Object.keys(this._values))c._values[u]=this._values[u].possiblyEvaluate(t,i,o);return c}hasTransition(){for(let t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class E6{constructor(t,i){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._options=i,this.isConfigDependent=!1}getValue(t){return K(this._values[t].value)}setValue(t,i){this._values[t]=new T_(this._values[t].property,i===null?void 0:K(i),this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].expression.isConfigDependent}serialize(){let t={};for(let i of Object.keys(this._values)){let o=this.getValue(i);o!==void 0&&(t[i]=o)}return t}possiblyEvaluate(t,i,o){let c=new Ep(this._properties);for(let u of Object.keys(this._values))c._values[u]=this._values[u].possiblyEvaluate(t,i,o);return c}}class ph{constructor(t,i,o){this.property=t,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,i,o,c){return this.property.evaluate(this.value,this.parameters,t,i,o,c)}}class Ep{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Ut{constructor(t){this.specification=t}possiblyEvaluate(t,i){return t.expression.evaluate(i)}interpolate(t,i,o){let c=p_[this.specification.type];return c?c(t,i,o):t}}class Re{constructor(t,i){this.specification=t,this.overrides=i}possiblyEvaluate(t,i,o,c){return new ph(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(i,null,{},o,c)}:t.expression,i)}interpolate(t,i,o){if(t.value.kind!=="constant"||i.value.kind!=="constant")return t;if(t.value.value===void 0||i.value.value===void 0)return new ph(this,{kind:"constant",value:void 0},t.parameters);let c=p_[this.specification.type];return c?new ph(this,{kind:"constant",value:c(t.value.value,i.value.value,o)},t.parameters):t}evaluate(t,i,o,c,u,h){return t.kind==="constant"?t.value:t.evaluate(i,o,c,u,h)}}class Mp{constructor(t){this.specification=t}possiblyEvaluate(t,i,o,c){return!!t.expression.evaluate(i,null,{},o,c)}interpolate(){return!1}}class yr{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let i=new ir(0,{});for(let o in t){let c=t[o];c.specification.overridable&&this.overridableProperties.push(o);let u=this.defaultPropertyValues[o]=new T_(c,void 0),h=this.defaultTransitionablePropertyValues[o]=new J1(c);this.defaultTransitioningPropertyValues[o]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=u.possiblyEvaluate(i)}}}Ce(Re,"DataDrivenProperty"),Ce(Ut,"DataConstantProperty"),Ce(Mp,"ColorRampProperty");let I_="";function l2(e){return e.indexOf(I_)>=0}function Xo(e,t){return t?`${e}${I_}${t}`:e}function A_(e){let t=e.indexOf(I_);return t>=0?e.slice(0,t):e}let c2="-transition";class Ws extends Hr{constructor(t,i,o){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&t.type!=="sky"&&t.type!=="slot"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),this.options=o,t.slot&&(this.slot=t.slot),i.layout&&(this._unevaluatedLayout=new E6(i.layout,o),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),i.paint)){this._transitionablePaint=new Sp(i.paint,o);for(let c in t.paint)this.setPaintProperty(c,t.paint[c],{validate:!1});for(let c in t.layout)this.setLayoutProperty(c,t.layout[c],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ep(i.paint)}}setScope(t){this.scope=t,this.fqid=Xo(this.id,t)}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,i,o={}){if(i!=null&&this._validate(v6,`layers.${this.id}.layout.${t}`,t,i,o))return;if(this.type==="custom"&&t==="visibility")return void(this.visibility=i);let c=this._unevaluatedLayout;c._properties.properties[t]&&(c.setValue(t,i),this.isConfigDependent=this.isConfigDependent||c.isConfigDependent,t==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(t){return $u(t,c2)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,i,o={}){if(i!=null&&this._validate(_6,`layers.${this.id}.paint.${t}`,t,i,o))return!1;let c=this._transitionablePaint,u=c._properties.properties;if($u(t,c2)){let b=t.slice(0,-11);return u[b]&&c.setTransition(b,i||void 0),!1}if(!u[t])return!1;let h=c._values[t],p=h.value.isDataDriven(),f=h.value;c.setValue(t,i),this.isConfigDependent=this.isConfigDependent||c.isConfigDependent,this._handleSpecialPaintPropertyUpdate(t);let g=c._values[t].value,v=g.isDataDriven(),y=$u(t,"pattern")||t==="line-dasharray";return v||p||y||this._handleOverridablePaintPropertyUpdate(t,f,g)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,i){return null}_handleOverridablePaintPropertyUpdate(t,i,o){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,i)}serialize(){return Yt({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(t,i)=>!(t===void 0||i==="layout"&&!Object.keys(t).length||i==="paint"&&!Object.keys(t).length))}_validate(t,i,o,c,u={}){return(!u||u.validate!==!1)&&M_(this,t.call(dh,{key:i,layerType:this.type,objectKey:o,value:c,styleSpec:_t,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(let t in this.paint._values){let i=this.paint.get(t);if(i instanceof ph&&Qd(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=C_(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(){this._stats&&(this._stats.numRenderedVerticesInShadowPass=0,this._stats.numRenderedVerticesInTransparentPass=0)}}class M6{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,i){this._updatedSourceCaches[t]=i,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){let i=t.scope;this._updatedLayers[i]=this._updatedLayers[i]||new Set,this._updatedLayers[i].add(t.id),this.setDirty()}removeLayer(t){let i=t.scope;this._removedLayers[i]=this._removedLayers[i]||{},this._updatedLayers[i]=this._updatedLayers[i]||new Set,this._removedLayers[i][t.id]=t,this._updatedLayers[i].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){let t={};for(let i in this._updatedLayers)t[i]=t[i]||{},t[i].updatedIds=Array.from(this._updatedLayers[i].values());for(let i in this._removedLayers)t[i]=t[i]||{},t[i].removedIds=Object.keys(this._removedLayers[i]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(t),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}let D6={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class k_{constructor(t,i){this._structArray=t,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class nr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,i){return t._trim(),i&&(t.isTransferred=!0,i.add(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){let i=Object.create(this.prototype);return i.arrayBuffer=t.arrayBuffer,i.length=t.length,i.capacity=t.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ji(e,t=1){let i=0,o=0;return{members:e.map(c=>{let u=D6[c.type].BYTES_PER_ELEMENT,h=i=d2(i,Math.max(t,u)),p=c.components||1;return o=Math.max(o,u),i+=u*p,{name:c.name,type:c.type,components:p,offset:h}}),size:d2(i,Math.max(o,t)),alignment:t}}function d2(e,t){return Math.ceil(e/t)*t}class Cs extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i){let o=this.length;return this.resize(o+1),this.emplace(o,t,i)}emplace(t,i,o){let c=2*t;return this.int16[c+0]=i,this.int16[c+1]=o,t}}Cs.prototype.bytesPerElement=4,Ce(Cs,"StructArrayLayout2i4");class R_ extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o){let c=this.length;return this.resize(c+1),this.emplace(c,t,i,o)}emplace(t,i,o,c){let u=3*t;return this.int16[u+0]=i,this.int16[u+1]=o,this.int16[u+2]=c,t}}R_.prototype.bytesPerElement=6,Ce(R_,"StructArrayLayout3i6");class tu extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o,c){let u=this.length;return this.resize(u+1),this.emplace(u,t,i,o,c)}emplace(t,i,o,c,u){let h=4*t;return this.int16[h+0]=i,this.int16[h+1]=o,this.int16[h+2]=c,this.int16[h+3]=u,t}}tu.prototype.bytesPerElement=8,Ce(tu,"StructArrayLayout4i8");class tw extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u){let h=this.length;return this.resize(h+1),this.emplace(h,t,i,o,c,u)}emplace(t,i,o,c,u,h){let p=5*t;return this.int16[p+0]=i,this.int16[p+1]=o,this.int16[p+2]=c,this.int16[p+3]=u,this.int16[p+4]=h,t}}tw.prototype.bytesPerElement=10,Ce(tw,"StructArrayLayout5i10");class ew extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u,h,p){let f=this.length;return this.resize(f+1),this.emplace(f,t,i,o,c,u,h,p)}emplace(t,i,o,c,u,h,p,f){let g=6*t,v=12*t,y=3*t;return this.int16[g+0]=i,this.int16[g+1]=o,this.uint8[v+4]=c,this.uint8[v+5]=u,this.uint8[v+6]=h,this.uint8[v+7]=p,this.float32[y+2]=f,t}}ew.prototype.bytesPerElement=12,Ce(ew,"StructArrayLayout2i4ub1f12");class sc extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o,c){let u=this.length;return this.resize(u+1),this.emplace(u,t,i,o,c)}emplace(t,i,o,c,u){let h=4*t;return this.float32[h+0]=i,this.float32[h+1]=o,this.float32[h+2]=c,this.float32[h+3]=u,t}}sc.prototype.bytesPerElement=16,Ce(sc,"StructArrayLayout4f16");class Wc extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u){let h=this.length;return this.resize(h+1),this.emplace(h,t,i,o,c,u)}emplace(t,i,o,c,u,h){let p=6*t,f=3*t;return this.uint16[p+0]=i,this.uint16[p+1]=o,this.uint16[p+2]=c,this.uint16[p+3]=u,this.float32[f+2]=h,t}}Wc.prototype.bytesPerElement=12,Ce(Wc,"StructArrayLayout4ui1f12");class P_ extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,o,c){let u=this.length;return this.resize(u+1),this.emplace(u,t,i,o,c)}emplace(t,i,o,c,u){let h=4*t;return this.uint16[h+0]=i,this.uint16[h+1]=o,this.uint16[h+2]=c,this.uint16[h+3]=u,t}}P_.prototype.bytesPerElement=8,Ce(P_,"StructArrayLayout4ui8");class O_ extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u,h){let p=this.length;return this.resize(p+1),this.emplace(p,t,i,o,c,u,h)}emplace(t,i,o,c,u,h,p){let f=6*t;return this.int16[f+0]=i,this.int16[f+1]=o,this.int16[f+2]=c,this.int16[f+3]=u,this.int16[f+4]=h,this.int16[f+5]=p,t}}O_.prototype.bytesPerElement=12,Ce(O_,"StructArrayLayout6i12");class iw extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u,h,p,f,g,v,y,b){let x=this.length;return this.resize(x+1),this.emplace(x,t,i,o,c,u,h,p,f,g,v,y,b)}emplace(t,i,o,c,u,h,p,f,g,v,y,b,x){let C=12*t;return this.int16[C+0]=i,this.int16[C+1]=o,this.int16[C+2]=c,this.int16[C+3]=u,this.uint16[C+4]=h,this.uint16[C+5]=p,this.uint16[C+6]=f,this.uint16[C+7]=g,this.int16[C+8]=v,this.int16[C+9]=y,this.int16[C+10]=b,this.int16[C+11]=x,t}}iw.prototype.bytesPerElement=24,Ce(iw,"StructArrayLayout4i4ui4i24");class nw extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u,h){let p=this.length;return this.resize(p+1),this.emplace(p,t,i,o,c,u,h)}emplace(t,i,o,c,u,h,p){let f=10*t,g=5*t;return this.int16[f+0]=i,this.int16[f+1]=o,this.int16[f+2]=c,this.float32[g+2]=u,this.float32[g+3]=h,this.float32[g+4]=p,t}}nw.prototype.bytesPerElement=20,Ce(nw,"StructArrayLayout3i3f20");class rw extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){let i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint32[1*t+0]=i,t}}rw.prototype.bytesPerElement=4,Ce(rw,"StructArrayLayout1ul4");class $c extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i){let o=this.length;return this.resize(o+1),this.emplace(o,t,i)}emplace(t,i,o){let c=2*t;return this.uint16[c+0]=i,this.uint16[c+1]=o,t}}$c.prototype.bytesPerElement=4,Ce($c,"StructArrayLayout2ui4");class ow extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u,h,p,f,g,v,y,b,x){let C=this.length;return this.resize(C+1),this.emplace(C,t,i,o,c,u,h,p,f,g,v,y,b,x)}emplace(t,i,o,c,u,h,p,f,g,v,y,b,x,C){let E=20*t,M=10*t;return this.int16[E+0]=i,this.int16[E+1]=o,this.int16[E+2]=c,this.int16[E+3]=u,this.int16[E+4]=h,this.float32[M+3]=p,this.float32[M+4]=f,this.float32[M+5]=g,this.float32[M+6]=v,this.int16[E+14]=y,this.uint32[M+8]=b,this.uint16[E+18]=x,this.uint16[E+19]=C,t}}ow.prototype.bytesPerElement=40,Ce(ow,"StructArrayLayout5i4f1i1ul2ui40");class F_ extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u,h,p){let f=this.length;return this.resize(f+1),this.emplace(f,t,i,o,c,u,h,p)}emplace(t,i,o,c,u,h,p,f){let g=8*t;return this.int16[g+0]=i,this.int16[g+1]=o,this.int16[g+2]=c,this.int16[g+4]=u,this.int16[g+5]=h,this.int16[g+6]=p,this.int16[g+7]=f,t}}F_.prototype.bytesPerElement=16,Ce(F_,"StructArrayLayout3i2i2i16");class sw extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u){let h=this.length;return this.resize(h+1),this.emplace(h,t,i,o,c,u)}emplace(t,i,o,c,u,h){let p=4*t,f=8*t;return this.float32[p+0]=i,this.float32[p+1]=o,this.float32[p+2]=c,this.int16[f+6]=u,this.int16[f+7]=h,t}}sw.prototype.bytesPerElement=16,Ce(sw,"StructArrayLayout2f1f2i16");class aw extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o,c){let u=this.length;return this.resize(u+1),this.emplace(u,t,i,o,c)}emplace(t,i,o,c,u){let h=12*t,p=3*t;return this.uint8[h+0]=i,this.uint8[h+1]=o,this.float32[p+1]=c,this.float32[p+2]=u,t}}aw.prototype.bytesPerElement=12,Ce(aw,"StructArrayLayout2ub2f12");class qr extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,o){let c=this.length;return this.resize(c+1),this.emplace(c,t,i,o)}emplace(t,i,o,c){let u=3*t;return this.uint16[u+0]=i,this.uint16[u+1]=o,this.uint16[u+2]=c,t}}qr.prototype.bytesPerElement=6,Ce(qr,"StructArrayLayout3ui6");class lw extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M,D,A,P,O,R){let F=this.length;return this.resize(F+1),this.emplace(F,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M,D,A,P,O,R)}emplace(t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M,D,A,P,O,R,F){let N=30*t,j=15*t,U=60*t;return this.int16[N+0]=i,this.int16[N+1]=o,this.int16[N+2]=c,this.float32[j+2]=u,this.float32[j+3]=h,this.uint16[N+8]=p,this.uint16[N+9]=f,this.uint32[j+5]=g,this.uint32[j+6]=v,this.uint32[j+7]=y,this.uint16[N+16]=b,this.uint16[N+17]=x,this.uint16[N+18]=C,this.float32[j+10]=E,this.float32[j+11]=M,this.uint8[U+48]=D,this.uint8[U+49]=A,this.uint8[U+50]=P,this.uint32[j+13]=O,this.int16[N+28]=R,this.uint8[U+58]=F,t}}lw.prototype.bytesPerElement=60,Ce(lw,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class cw extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M,D,A,P,O,R,F,N,j,U,G,Y,Z,tt,$,rt,st){let pt=this.length;return this.resize(pt+1),this.emplace(pt,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M,D,A,P,O,R,F,N,j,U,G,Y,Z,tt,$,rt,st)}emplace(t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M,D,A,P,O,R,F,N,j,U,G,Y,Z,tt,$,rt,st,pt){let nt=20*t,ot=40*t,vt=80*t;return this.float32[nt+0]=i,this.float32[nt+1]=o,this.int16[ot+4]=c,this.int16[ot+5]=u,this.int16[ot+6]=h,this.int16[ot+7]=p,this.int16[ot+8]=f,this.int16[ot+9]=g,this.int16[ot+10]=v,this.int16[ot+11]=y,this.int16[ot+12]=b,this.uint16[ot+13]=x,this.uint16[ot+14]=C,this.uint16[ot+15]=E,this.uint16[ot+16]=M,this.uint16[ot+17]=D,this.uint16[ot+18]=A,this.uint16[ot+19]=P,this.uint16[ot+20]=O,this.uint16[ot+21]=R,this.uint16[ot+22]=F,this.uint16[ot+23]=N,this.uint16[ot+24]=j,this.uint16[ot+25]=U,this.uint16[ot+26]=G,this.uint16[ot+27]=Y,this.uint32[nt+14]=Z,this.float32[nt+15]=tt,this.float32[nt+16]=$,this.float32[nt+17]=rt,this.float32[nt+18]=st,this.uint8[vt+76]=pt,t}}cw.prototype.bytesPerElement=80,Ce(cw,"StructArrayLayout2f9i15ui1ul4f1ub80");class Dp extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){let i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.float32[1*t+0]=i,t}}Dp.prototype.bytesPerElement=4,Ce(Dp,"StructArrayLayout1f4");class eu extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u){let h=this.length;return this.resize(h+1),this.emplace(h,t,i,o,c,u)}emplace(t,i,o,c,u,h){let p=5*t;return this.float32[p+0]=i,this.float32[p+1]=o,this.float32[p+2]=c,this.float32[p+3]=u,this.float32[p+4]=h,t}}eu.prototype.bytesPerElement=20,Ce(eu,"StructArrayLayout5f20");class dw extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u,h,p){let f=this.length;return this.resize(f+1),this.emplace(f,t,i,o,c,u,h,p)}emplace(t,i,o,c,u,h,p,f){let g=7*t;return this.float32[g+0]=i,this.float32[g+1]=o,this.float32[g+2]=c,this.float32[g+3]=u,this.float32[g+4]=h,this.float32[g+5]=p,this.float32[g+6]=f,t}}dw.prototype.bytesPerElement=28,Ce(dw,"StructArrayLayout7f28");class uw extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,o,c){let u=this.length;return this.resize(u+1),this.emplace(u,t,i,o,c)}emplace(t,i,o,c,u){let h=6*t;return this.uint32[3*t+0]=i,this.uint16[h+2]=o,this.uint16[h+3]=c,this.uint16[h+4]=u,t}}uw.prototype.bytesPerElement=12,Ce(uw,"StructArrayLayout1ul3ui12");class Tp extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){let i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint16[1*t+0]=i,t}}Tp.prototype.bytesPerElement=2,Ce(Tp,"StructArrayLayout1ui2");class iu extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o){let c=this.length;return this.resize(c+1),this.emplace(c,t,i,o)}emplace(t,i,o,c){let u=3*t;return this.float32[u+0]=i,this.float32[u+1]=o,this.float32[u+2]=c,t}}iu.prototype.bytesPerElement=12,Ce(iu,"StructArrayLayout3f12");class Ip extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i){let o=this.length;return this.resize(o+1),this.emplace(o,t,i)}emplace(t,i,o){let c=2*t;return this.float32[c+0]=i,this.float32[c+1]=o,t}}Ip.prototype.bytesPerElement=8,Ce(Ip,"StructArrayLayout2f8");class hw extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M){let D=this.length;return this.resize(D+1),this.emplace(D,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M)}emplace(t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M,D){let A=16*t;return this.float32[A+0]=i,this.float32[A+1]=o,this.float32[A+2]=c,this.float32[A+3]=u,this.float32[A+4]=h,this.float32[A+5]=p,this.float32[A+6]=f,this.float32[A+7]=g,this.float32[A+8]=v,this.float32[A+9]=y,this.float32[A+10]=b,this.float32[A+11]=x,this.float32[A+12]=C,this.float32[A+13]=E,this.float32[A+14]=M,this.float32[A+15]=D,t}}hw.prototype.bytesPerElement=64,Ce(hw,"StructArrayLayout16f64");class L_ extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o,c,u,h,p){let f=this.length;return this.resize(f+1),this.emplace(f,t,i,o,c,u,h,p)}emplace(t,i,o,c,u,h,p,f){let g=10*t,v=5*t;return this.uint16[g+0]=i,this.uint16[g+1]=o,this.uint16[g+2]=c,this.uint16[g+3]=u,this.float32[v+2]=h,this.float32[v+3]=p,this.float32[v+4]=f,t}}L_.prototype.bytesPerElement=20,Ce(L_,"StructArrayLayout4ui3f20");class mw extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){let i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint8[1*t+0]=i,t}}mw.prototype.bytesPerElement=1,Ce(mw,"StructArrayLayout1ub1");class u2 extends k_{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}u2.prototype.size=40;class pw extends ow{get(t){return new u2(this,t)}}Ce(pw,"CollisionBoxArray");class h2 extends k_{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}h2.prototype.size=60;class m2 extends lw{get(t){return new h2(this,t)}}Ce(m2,"PlacedSymbolArray");class p2 extends k_{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}p2.prototype.size=80;class f2 extends cw{get(t){return new p2(this,t)}}Ce(f2,"SymbolInstanceArray");class g2 extends Dp{getoffsetX(t){return this.float32[1*t+0]}}Ce(g2,"GlyphOffsetArray");class _2 extends Cs{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}Ce(_2,"SymbolLineVertexArray");class v2 extends k_{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}v2.prototype.size=12;class y2 extends uw{get(t){return new v2(this,t)}}Ce(y2,"FeatureIndexArray");class b2 extends $c{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}Ce(b2,"FillExtrusionCentroidArray");let T6=Ji([{name:"a_pos",components:2,type:"Int16"}],4),I6=Ji([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class un{constructor(t=[]){this.segments=t}_prepareSegment(t,i,o,c){let u=this.segments[this.segments.length-1];return t>un.MAX_VERTEX_ARRAY_LENGTH&&lt(`Max vertices per segment is ${un.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!u||u.vertexLength+t>un.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==c)&&(u={vertexOffset:i,primitiveOffset:o,vertexLength:0,primitiveLength:0},c!==void 0&&(u.sortKey=c),this.segments.push(u)),u}prepareSegment(t,i,o,c){return this._prepareSegment(t,i.length,o.length,c)}get(){return this.segments}destroy(){for(let t of this.segments)for(let i in t.vaos)t.vaos[i].destroy()}static simpleSegment(t,i,o,c){return new un([{vertexOffset:t,primitiveOffset:i,vertexLength:o,primitiveLength:c,vaos:{},sortKey:0}])}}function x2(e,t){return 256*(e=ve(Math.floor(e),0,255))+ve(Math.floor(t),0,255)}un.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ce(un,"SegmentVector");let A6=Ji([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),k6=Ji([{name:"a_dash",components:4,type:"Uint16"}]);var z_={exports:{}},w2={exports:{}};(function(e){e.exports=function(t,i){var o,c,u,h,p,f,g,v;for(c=t.length-(o=3&t.length),u=i,p=3432918353,f=461845907,v=0;v<c;)g=255&t.charCodeAt(v)|(255&t.charCodeAt(++v))<<8|(255&t.charCodeAt(++v))<<16|(255&t.charCodeAt(++v))<<24,++v,u=27492+(65535&(h=5*(65535&(u=(u^=g=(65535&(g=(g=(65535&g)*p+(((g>>>16)*p&65535)<<16)&4294967295)<<15|g>>>17))*f+(((g>>>16)*f&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(h>>>16)&65535)<<16);switch(g=0,o){case 3:g^=(255&t.charCodeAt(v+2))<<16;case 2:g^=(255&t.charCodeAt(v+1))<<8;case 1:u^=g=(65535&(g=(g=(65535&(g^=255&t.charCodeAt(v)))*p+(((g>>>16)*p&65535)<<16)&4294967295)<<15|g>>>17))*f+(((g>>>16)*f&65535)<<16)&4294967295}return u^=t.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0}})(w2);var R6=w2.exports,C2={exports:{}};(function(e){e.exports=function(t,i){for(var o,c=t.length,u=i^c,h=0;c>=4;)o=1540483477*(65535&(o=255&t.charCodeAt(h)|(255&t.charCodeAt(++h))<<8|(255&t.charCodeAt(++h))<<16|(255&t.charCodeAt(++h))<<24))+((1540483477*(o>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),c-=4,++h;switch(c){case 3:u^=(255&t.charCodeAt(h+2))<<16;case 2:u^=(255&t.charCodeAt(h+1))<<8;case 1:u=1540483477*(65535&(u^=255&t.charCodeAt(h)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0}})(C2);var S2=R6,P6=C2.exports;z_.exports=S2,z_.exports.murmur3=S2,z_.exports.murmur2=P6;var fw=mt(z_.exports);class Ap{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,i,o,c){this.ids.push(E2(t)),this.positions.push(i,o,c)}eachPosition(t,i){let o=E2(t),c=0,u=this.ids.length-1;for(;c<u;){let h=c+u>>1;this.ids[h]>=o?u=h:c=h+1}for(;this.ids[c]===o;)i(this.positions[3*c],this.positions[3*c+1],this.positions[3*c+2]),c++}static serialize(t,i){let o=new Float64Array(t.ids),c=new Uint32Array(t.positions);return gw(o,c,0,o.length-1),i&&(i.add(o.buffer),i.add(c.buffer)),{ids:o,positions:c}}static deserialize(t){let i=new Ap,o;i.ids=t.ids,i.positions=t.positions;for(let c of i.ids)c!==o&&i.uniqueIds.push(c),o=c;return i.indexed=!0,i}}function E2(e){let t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:fw(String(e))}function gw(e,t,i,o){for(;i<o;){let c=e[i+o>>1],u=i-1,h=o+1;for(;;){do u++;while(e[u]<c);do h--;while(e[h]>c);if(u>=h)break;N_(e,u,h),N_(t,3*u,3*h),N_(t,3*u+1,3*h+1),N_(t,3*u+2,3*h+2)}h-i<o-h?(gw(e,t,i,h),i=h+1):(gw(e,t,h+1,o),o=h)}}function N_(e,t,i){let o=e[t];e[t]=e[i],e[i]=o}Ce(Ap,"FeaturePositionMap");class ac{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,i),this.initialized=!0),!!this.location}}class wi extends ac{constructor(t){super(t),this.current=0}set(t,i,o){this.fetchUniformLocation(t,i)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}}class Bt extends ac{constructor(t){super(t),this.current=0}set(t,i,o){this.fetchUniformLocation(t,i)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class Ci extends ac{constructor(t){super(t),this.current=[0,0]}set(t,i,o){this.fetchUniformLocation(t,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}}class di extends ac{constructor(t){super(t),this.current=[0,0,0]}set(t,i,o){this.fetchUniformLocation(t,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}}class Ss extends ac{constructor(t){super(t),this.current=[0,0,0,0]}set(t,i,o){this.fetchUniformLocation(t,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class fh extends ac{constructor(t){super(t),this.current=_i.transparent}set(t,i,o){this.fetchUniformLocation(t,i)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}let O6=new Float32Array(16);class si extends ac{constructor(t){super(t),this.current=O6}set(t,i,o){if(this.fetchUniformLocation(t,i)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let c=1;c<16;c++)if(o[c]!==this.current[c]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}}let F6=new Float32Array(9);class _w extends ac{constructor(t){super(t),this.current=F6}set(t,i,o){if(this.fetchUniformLocation(t,i)){for(let c=0;c<9;c++)if(o[c]!==this.current[c]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}}}let L6=new Float32Array(4);class vw extends ac{constructor(t){super(t),this.current=L6}set(t,i,o){if(this.fetchUniformLocation(t,i)){for(let c=0;c<4;c++)if(o[c]!==this.current[c]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}}function yw(e){return[x2(255*e.r,255*e.g),x2(255*e.b,255*e.a)]}class kp{constructor(t,i,o){this.value=t,this.uniformNames=i.map(c=>`u_${c}`),this.type=o}setUniform(t,i,o,c,u){i.set(t,u,c.constantOr(this.value))}getBinding(t,i){return this.type==="color"?new fh(t):new Bt(t)}}class gh{constructor(t,i){this.uniformNames=i.map(o=>`u_${o}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,i,o,c,u){let h=u==="u_pattern"||u==="u_dash"?this.pattern:u==="u_pixel_ratio"?this.pixelRatio:null;h&&i.set(t,u,h)}getBinding(t,i){return i==="u_pattern"||i==="u_dash"?new Ss(t):new Bt(t)}}class lc{constructor(t,i,o,c){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map(u=>({name:`a_${u}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(t,i,o,c,u,h,p){let f=this.paintVertexArray.length,g=this.expression.evaluate(new ir(0,{brightness:h}),i,{},u,c,p);this.paintVertexArray.resize(t),this._setPaintValue(f,t,g)}updatePaintArray(t,i,o,c,u,h,p){let f=this.expression.evaluate({zoom:0,brightness:p},o,c,void 0,u);this._setPaintValue(t,i,f)}_setPaintValue(t,i,o){if(this.type==="color"){let c=yw(o);for(let u=t;u<i;u++)this.paintVertexArray.emplace(u,c[0],c[1])}else{for(let c=t;c<i;c++)this.paintVertexArray.emplace(c,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Za{constructor(t,i,o,c,u,h){this.expression=t,this.uniformNames=i.map(p=>`u_${p}_t`),this.type=o,this.useIntegerZoom=c,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=i.map(p=>({name:`a_${p}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,i,o,c,u,h,p){let f=this.expression.evaluate(new ir(this.zoom,{brightness:h}),i,{},u,c,p),g=this.expression.evaluate(new ir(this.zoom+1,{brightness:h}),i,{},u,c,p),v=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(v,t,f,g)}updatePaintArray(t,i,o,c,u,h,p){let f=this.expression.evaluate({zoom:this.zoom,brightness:p},o,c,void 0,u),g=this.expression.evaluate({zoom:this.zoom+1,brightness:p},o,c,void 0,u);this._setPaintValue(t,i,f,g)}_setPaintValue(t,i,o,c){if(this.type==="color"){let u=yw(o),h=yw(c);for(let p=t;p<i;p++)this.paintVertexArray.emplace(p,u[0],u[1],h[0],h[1])}else{for(let u=t;u<i;u++)this.paintVertexArray.emplace(u,o,c);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,i,o,c,u){let h=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,p=ve(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);i.set(t,u,p)}getBinding(t,i){return new Bt(t)}}class Yc{constructor(t,i,o,c,u){this.expression=t,this.layerId=u,this.paintVertexAttributes=(o==="array"?k6:A6).members;for(let h=0;h<i.length;++h);this.paintVertexArray=new c}populatePaintArray(t,i,o){let c=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(c,t,i.patterns&&i.patterns[this.layerId],o)}updatePaintArray(t,i,o,c,u,h,p){this._setPaintValues(t,i,o.patterns&&o.patterns[this.layerId],h)}_setPaintValues(t,i,o,c){if(!c||!o)return;let u=c[o];if(!u)return;let{tl:h,br:p,pixelRatio:f}=u;for(let g=t;g<i;g++)this.paintVertexArray.emplace(g,h[0],h[1],p[0],p[1],f)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class nu{constructor(t,i,o=()=>!0){this.binders={},this._buffers=[];let c=[];for(let u in t.paint._values){let h=t.paint.get(u);if(!o(u)||!(h instanceof ph&&Qd(h.property.specification)))continue;let p=N6(u,t.type),f=h.value,g=h.property.specification.type,v=!!h.property.useIntegerZoom,y=u==="line-dasharray"||u.endsWith("pattern"),b=u==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant";if(f.kind!=="constant"||b)if(f.kind==="source"||b||y){let x=M2(u,g,"source");this.binders[u]=y?new Yc(f,p,g,x,t.id):new lc(f,p,g,x),c.push(`/a_${u}`)}else{let x=M2(u,g,"composite");this.binders[u]=new Za(f,p,g,v,i,x),c.push(`/z_${u}`)}else this.binders[u]=y?new gh(f.value,p):new kp(f.value,p,g),c.push(`/u_${u}`)}this.cacheKey=c.sort().join("")}getMaxValue(t){let i=this.binders[t];return i instanceof lc||i instanceof Za?i.maxValue:0}populatePaintArrays(t,i,o,c,u,h,p){for(let f in this.binders){let g=this.binders[f];(g instanceof lc||g instanceof Za||g instanceof Yc)&&g.populatePaintArray(t,i,o,c,u,h,p)}}setConstantPatternPositions(t){for(let i in this.binders){let o=this.binders[i];o instanceof gh&&o.setConstantPatternPositions(t)}}updatePaintArrays(t,i,o,c,u,h,p,f){let g=!1,v=Object.keys(t),y=v.length!==0,b=y?v:i.uniqueIds;for(let x in this.binders){let C=this.binders[x];if((C instanceof lc||C instanceof Za||C instanceof Yc)&&(C.expression.isStateDependent===!0||C.expression.isLightConstant===!1)){let E=u.paint.get(x);C.expression=E.value;for(let M of b){let D=t[M.toString()];i.eachPosition(M,(A,P,O)=>{let R=c.feature(A);C.updatePaintArray(P,O,R,D,h,p,f)})}if(!y)for(let M of o.uniqueIds){let D=t[M.toString()];o.eachPosition(M,(A,P,O)=>{let R=c.feature(A);C.updatePaintArray(P,O,R,D,h,p,f)})}g=!0}}return g}defines(){let t=[];for(let i in this.binders){let o=this.binders[i];(o instanceof kp||o instanceof gh)&&t.push(...o.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return t}getBinderAttributes(){let t=[];for(let i in this.binders){let o=this.binders[i];if(o instanceof lc||o instanceof Za||o instanceof Yc)for(let c=0;c<o.paintVertexAttributes.length;c++)t.push(o.paintVertexAttributes[c].name)}return t}getBinderUniforms(){let t=[];for(let i in this.binders){let o=this.binders[i];if(o instanceof kp||o instanceof gh||o instanceof Za)for(let c of o.uniformNames)t.push(c)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){let i=[];for(let o in this.binders){let c=this.binders[o];if(c instanceof kp||c instanceof gh||c instanceof Za)for(let u of c.uniformNames)i.push({name:u,property:o,binding:c.getBinding(t,u)})}return i}setUniforms(t,i,o,c,u){for(let{name:h,property:p,binding:f}of o)this.binders[p].setUniform(t,f,u,c.get(p),h)}updatePaintBuffers(){this._buffers=[];for(let t in this.binders){let i=this.binders[t];(i instanceof lc||i instanceof Za||i instanceof Yc)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(t){for(let i in this.binders){let o=this.binders[i];(o instanceof lc||o instanceof Za||o instanceof Yc)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(let t in this.binders){let i=this.binders[t];(i instanceof lc||i instanceof Za||i instanceof Yc)&&i.destroy()}}}class Zc{constructor(t,i,o=()=>!0){this.programConfigurations={};for(let c of t)this.programConfigurations[c.id]=new nu(c,i,o);this.needsUpload=!1,this._featureMap=new Ap,this._featureMapWithoutIds=new Ap,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,i,o,c,u,h,p,f){for(let g in this.programConfigurations)this.programConfigurations[g].populatePaintArrays(t,i,c,u,h,p,f);i.id!==void 0?this._featureMap.add(i.id,o,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,o,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,i,o,c,u,h){for(let p of o)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,i,p,c,u,h||0)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(let i in this.programConfigurations)this.programConfigurations[i].upload(t);this.needsUpload=!1}}destroy(){for(let t in this.programConfigurations)this.programConfigurations[t].destroy()}}let z6={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function N6(e,t){return z6[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}let B6={"line-pattern":{source:Wc,composite:Wc},"fill-pattern":{source:Wc,composite:Wc},"fill-extrusion-pattern":{source:Wc,composite:Wc},"line-dasharray":{source:P_,composite:P_}},V6={color:{source:Ip,composite:sc},number:{source:Dp,composite:Ip}};function M2(e,t,i){let o=B6[e];return o&&o[i]||V6[t][i]}Ce(kp,"ConstantBinder"),Ce(gh,"PatternConstantBinder"),Ce(lc,"SourceExpressionBinder"),Ce(Yc,"PatternCompositeBinder"),Ce(Za,"CompositeExpressionBinder"),Ce(nu,"ProgramConfiguration",{omit:["_buffers"]}),Ce(Zc,"ProgramConfigurationSet");class Es{constructor(t,i){t&&(i?this.setSouthWest(t).setNorthEast(i):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof Ze?new Ze(t.lng,t.lat):Ze.convert(t),this}setSouthWest(t){return this._sw=t instanceof Ze?new Ze(t.lng,t.lat):Ze.convert(t),this}extend(t){let i=this._sw,o=this._ne,c,u;if(t instanceof Ze)c=t,u=t;else{if(!(t instanceof Es))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Es.convert(t)):this.extend(Ze.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(Ze.convert(t)):this;if(c=t._sw,u=t._ne,!c||!u)return this}return i||o?(i.lng=Math.min(c.lng,i.lng),i.lat=Math.min(c.lat,i.lat),o.lng=Math.max(u.lng,o.lng),o.lat=Math.max(u.lat,o.lat)):(this._sw=new Ze(c.lng,c.lat),this._ne=new Ze(u.lng,u.lat)),this}getCenter(){return new Ze((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ze(this.getWest(),this.getNorth())}getSouthEast(){return new Ze(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){let{lng:i,lat:o}=Ze.convert(t),c=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&c}static convert(t){return!t||t instanceof Es?t:new Es(t)}}var xo={},wo={};Object.defineProperty(wo,"__esModule",{value:!0}),wo.setMatrixArrayType=function(e){wo.ARRAY_TYPE=T2=e},wo.toRadian=function(e){return e*U6},wo.equals=function(e,t){return Math.abs(e-t)<=D2*Math.max(1,Math.abs(e),Math.abs(t))},wo.RANDOM=wo.ARRAY_TYPE=wo.EPSILON=void 0;var D2=1e-6;wo.EPSILON=D2;var T2=typeof Float32Array<"u"?Float32Array:Array;wo.ARRAY_TYPE=T2;var j6=Math.random;wo.RANDOM=j6;var U6=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var rr={};function bw(e){return bw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bw(e)}Object.defineProperty(rr,"__esModule",{value:!0}),rr.create=function(){var e=new Xc.ARRAY_TYPE(4);return Xc.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},rr.clone=function(e){var t=new Xc.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},rr.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},rr.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},rr.fromValues=function(e,t,i,o){var c=new Xc.ARRAY_TYPE(4);return c[0]=e,c[1]=t,c[2]=i,c[3]=o,c},rr.set=function(e,t,i,o,c){return e[0]=t,e[1]=i,e[2]=o,e[3]=c,e},rr.transpose=function(e,t){if(e===t){var i=t[1];e[1]=t[2],e[2]=i}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},rr.invert=function(e,t){var i=t[0],o=t[1],c=t[2],u=t[3],h=i*u-c*o;return h?(e[0]=u*(h=1/h),e[1]=-o*h,e[2]=-c*h,e[3]=i*h,e):null},rr.adjoint=function(e,t){var i=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=i,e},rr.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},rr.multiply=A2,rr.rotate=function(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3],p=Math.sin(i),f=Math.cos(i);return e[0]=o*f+u*p,e[1]=c*f+h*p,e[2]=o*-p+u*f,e[3]=c*-p+h*f,e},rr.scale=function(e,t,i){var o=t[1],c=t[2],u=t[3],h=i[0],p=i[1];return e[0]=t[0]*h,e[1]=o*h,e[2]=c*p,e[3]=u*p,e},rr.fromRotation=function(e,t){var i=Math.sin(t),o=Math.cos(t);return e[0]=o,e[1]=i,e[2]=-i,e[3]=o,e},rr.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},rr.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},rr.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},rr.LDU=function(e,t,i,o){return e[2]=o[2]/o[0],i[0]=o[0],i[1]=o[1],i[3]=o[3]-e[2]*i[1],[e,t,i]},rr.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e},rr.subtract=k2,rr.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},rr.equals=function(e,t){var i=e[0],o=e[1],c=e[2],u=e[3],h=t[0],p=t[1],f=t[2],g=t[3];return Math.abs(i-h)<=Xc.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-p)<=Xc.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(c-f)<=Xc.EPSILON*Math.max(1,Math.abs(c),Math.abs(f))&&Math.abs(u-g)<=Xc.EPSILON*Math.max(1,Math.abs(u),Math.abs(g))},rr.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},rr.multiplyScalarAndAdd=function(e,t,i,o){return e[0]=t[0]+i[0]*o,e[1]=t[1]+i[1]*o,e[2]=t[2]+i[2]*o,e[3]=t[3]+i[3]*o,e},rr.sub=rr.mul=void 0;var Xc=function(e,t){if(e&&e.__esModule)return e;if(e===null||bw(e)!=="object"&&typeof e!="function")return{default:e};var i=I2(void 0);if(i&&i.has(e))return i.get(e);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(u!=="default"&&Object.prototype.hasOwnProperty.call(e,u)){var h=c?Object.getOwnPropertyDescriptor(e,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=e[u]}return o.default=e,i&&i.set(e,o),o}(wo);function I2(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(I2=function(o){return o?i:t})(e)}function A2(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3],p=i[0],f=i[1],g=i[2],v=i[3];return e[0]=o*p+u*f,e[1]=c*p+h*f,e[2]=o*g+u*v,e[3]=c*g+h*v,e}function k2(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}rr.mul=A2,rr.sub=k2;var cr={};function xw(e){return xw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xw(e)}Object.defineProperty(cr,"__esModule",{value:!0}),cr.create=function(){var e=new El.ARRAY_TYPE(6);return El.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},cr.clone=function(e){var t=new El.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},cr.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},cr.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},cr.fromValues=function(e,t,i,o,c,u){var h=new El.ARRAY_TYPE(6);return h[0]=e,h[1]=t,h[2]=i,h[3]=o,h[4]=c,h[5]=u,h},cr.set=function(e,t,i,o,c,u,h){return e[0]=t,e[1]=i,e[2]=o,e[3]=c,e[4]=u,e[5]=h,e},cr.invert=function(e,t){var i=t[0],o=t[1],c=t[2],u=t[3],h=t[4],p=t[5],f=i*u-o*c;return f?(e[0]=u*(f=1/f),e[1]=-o*f,e[2]=-c*f,e[3]=i*f,e[4]=(c*p-u*h)*f,e[5]=(o*h-i*p)*f,e):null},cr.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},cr.multiply=P2,cr.rotate=function(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3],p=t[4],f=t[5],g=Math.sin(i),v=Math.cos(i);return e[0]=o*v+u*g,e[1]=c*v+h*g,e[2]=o*-g+u*v,e[3]=c*-g+h*v,e[4]=p,e[5]=f,e},cr.scale=function(e,t,i){var o=t[1],c=t[2],u=t[3],h=t[4],p=t[5],f=i[0],g=i[1];return e[0]=t[0]*f,e[1]=o*f,e[2]=c*g,e[3]=u*g,e[4]=h,e[5]=p,e},cr.translate=function(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3],p=t[4],f=t[5],g=i[0],v=i[1];return e[0]=o,e[1]=c,e[2]=u,e[3]=h,e[4]=o*g+u*v+p,e[5]=c*g+h*v+f,e},cr.fromRotation=function(e,t){var i=Math.sin(t),o=Math.cos(t);return e[0]=o,e[1]=i,e[2]=-i,e[3]=o,e[4]=0,e[5]=0,e},cr.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},cr.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},cr.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},cr.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},cr.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e},cr.subtract=O2,cr.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e},cr.multiplyScalarAndAdd=function(e,t,i,o){return e[0]=t[0]+i[0]*o,e[1]=t[1]+i[1]*o,e[2]=t[2]+i[2]*o,e[3]=t[3]+i[3]*o,e[4]=t[4]+i[4]*o,e[5]=t[5]+i[5]*o,e},cr.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},cr.equals=function(e,t){var i=e[0],o=e[1],c=e[2],u=e[3],h=e[4],p=e[5],f=t[0],g=t[1],v=t[2],y=t[3],b=t[4],x=t[5];return Math.abs(i-f)<=El.EPSILON*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(o-g)<=El.EPSILON*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(c-v)<=El.EPSILON*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(u-y)<=El.EPSILON*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(h-b)<=El.EPSILON*Math.max(1,Math.abs(h),Math.abs(b))&&Math.abs(p-x)<=El.EPSILON*Math.max(1,Math.abs(p),Math.abs(x))},cr.sub=cr.mul=void 0;var El=function(e,t){if(e&&e.__esModule)return e;if(e===null||xw(e)!=="object"&&typeof e!="function")return{default:e};var i=R2(void 0);if(i&&i.has(e))return i.get(e);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(u!=="default"&&Object.prototype.hasOwnProperty.call(e,u)){var h=c?Object.getOwnPropertyDescriptor(e,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=e[u]}return o.default=e,i&&i.set(e,o),o}(wo);function R2(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(R2=function(o){return o?i:t})(e)}function P2(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3],p=t[4],f=t[5],g=i[0],v=i[1],y=i[2],b=i[3],x=i[4],C=i[5];return e[0]=o*g+u*v,e[1]=c*g+h*v,e[2]=o*y+u*b,e[3]=c*y+h*b,e[4]=o*x+u*C+p,e[5]=c*x+h*C+f,e}function O2(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e}cr.mul=P2,cr.sub=O2;var Dn={};function ww(e){return ww=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ww(e)}Object.defineProperty(Dn,"__esModule",{value:!0}),Dn.create=function(){var e=new $s.ARRAY_TYPE(9);return $s.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},Dn.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},Dn.clone=function(e){var t=new $s.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Dn.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},Dn.fromValues=function(e,t,i,o,c,u,h,p,f){var g=new $s.ARRAY_TYPE(9);return g[0]=e,g[1]=t,g[2]=i,g[3]=o,g[4]=c,g[5]=u,g[6]=h,g[7]=p,g[8]=f,g},Dn.set=function(e,t,i,o,c,u,h,p,f,g){return e[0]=t,e[1]=i,e[2]=o,e[3]=c,e[4]=u,e[5]=h,e[6]=p,e[7]=f,e[8]=g,e},Dn.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},Dn.transpose=function(e,t){if(e===t){var i=t[1],o=t[2],c=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=o,e[7]=c}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},Dn.invert=function(e,t){var i=t[0],o=t[1],c=t[2],u=t[3],h=t[4],p=t[5],f=t[6],g=t[7],v=t[8],y=v*h-p*g,b=-v*u+p*f,x=g*u-h*f,C=i*y+o*b+c*x;return C?(e[0]=y*(C=1/C),e[1]=(-v*o+c*g)*C,e[2]=(p*o-c*h)*C,e[3]=b*C,e[4]=(v*i-c*f)*C,e[5]=(-p*i+c*u)*C,e[6]=x*C,e[7]=(-g*i+o*f)*C,e[8]=(h*i-o*u)*C,e):null},Dn.adjoint=function(e,t){var i=t[0],o=t[1],c=t[2],u=t[3],h=t[4],p=t[5],f=t[6],g=t[7],v=t[8];return e[0]=h*v-p*g,e[1]=c*g-o*v,e[2]=o*p-c*h,e[3]=p*f-u*v,e[4]=i*v-c*f,e[5]=c*u-i*p,e[6]=u*g-h*f,e[7]=o*f-i*g,e[8]=i*h-o*u,e},Dn.determinant=function(e){var t=e[3],i=e[4],o=e[5],c=e[6],u=e[7],h=e[8];return e[0]*(h*i-o*u)+e[1]*(-h*t+o*c)+e[2]*(u*t-i*c)},Dn.multiply=L2,Dn.translate=function(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3],p=t[4],f=t[5],g=t[6],v=t[7],y=t[8],b=i[0],x=i[1];return e[0]=o,e[1]=c,e[2]=u,e[3]=h,e[4]=p,e[5]=f,e[6]=b*o+x*h+g,e[7]=b*c+x*p+v,e[8]=b*u+x*f+y,e},Dn.rotate=function(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3],p=t[4],f=t[5],g=t[6],v=t[7],y=t[8],b=Math.sin(i),x=Math.cos(i);return e[0]=x*o+b*h,e[1]=x*c+b*p,e[2]=x*u+b*f,e[3]=x*h-b*o,e[4]=x*p-b*c,e[5]=x*f-b*u,e[6]=g,e[7]=v,e[8]=y,e},Dn.scale=function(e,t,i){var o=i[0],c=i[1];return e[0]=o*t[0],e[1]=o*t[1],e[2]=o*t[2],e[3]=c*t[3],e[4]=c*t[4],e[5]=c*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},Dn.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},Dn.fromRotation=function(e,t){var i=Math.sin(t),o=Math.cos(t);return e[0]=o,e[1]=i,e[2]=0,e[3]=-i,e[4]=o,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},Dn.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},Dn.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},Dn.fromQuat=function(e,t){var i=t[0],o=t[1],c=t[2],u=t[3],h=i+i,p=o+o,f=c+c,g=i*h,v=o*h,y=o*p,b=c*h,x=c*p,C=c*f,E=u*h,M=u*p,D=u*f;return e[0]=1-y-C,e[3]=v-D,e[6]=b+M,e[1]=v+D,e[4]=1-g-C,e[7]=x-E,e[2]=b-M,e[5]=x+E,e[8]=1-g-y,e},Dn.normalFromMat4=function(e,t){var i=t[0],o=t[1],c=t[2],u=t[3],h=t[4],p=t[5],f=t[6],g=t[7],v=t[8],y=t[9],b=t[10],x=t[11],C=t[12],E=t[13],M=t[14],D=t[15],A=i*p-o*h,P=i*f-c*h,O=i*g-u*h,R=o*f-c*p,F=o*g-u*p,N=c*g-u*f,j=v*E-y*C,U=v*M-b*C,G=v*D-x*C,Y=y*M-b*E,Z=y*D-x*E,tt=b*D-x*M,$=A*tt-P*Z+O*Y+R*G-F*U+N*j;return $?(e[0]=(p*tt-f*Z+g*Y)*($=1/$),e[1]=(f*G-h*tt-g*U)*$,e[2]=(h*Z-p*G+g*j)*$,e[3]=(c*Z-o*tt-u*Y)*$,e[4]=(i*tt-c*G+u*U)*$,e[5]=(o*G-i*Z-u*j)*$,e[6]=(E*N-M*F+D*R)*$,e[7]=(M*O-C*N-D*P)*$,e[8]=(C*F-E*O+D*A)*$,e):null},Dn.projection=function(e,t,i){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/i,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},Dn.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},Dn.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},Dn.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e},Dn.subtract=z2,Dn.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e},Dn.multiplyScalarAndAdd=function(e,t,i,o){return e[0]=t[0]+i[0]*o,e[1]=t[1]+i[1]*o,e[2]=t[2]+i[2]*o,e[3]=t[3]+i[3]*o,e[4]=t[4]+i[4]*o,e[5]=t[5]+i[5]*o,e[6]=t[6]+i[6]*o,e[7]=t[7]+i[7]*o,e[8]=t[8]+i[8]*o,e},Dn.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},Dn.equals=function(e,t){var i=e[0],o=e[1],c=e[2],u=e[3],h=e[4],p=e[5],f=e[6],g=e[7],v=e[8],y=t[0],b=t[1],x=t[2],C=t[3],E=t[4],M=t[5],D=t[6],A=t[7],P=t[8];return Math.abs(i-y)<=$s.EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(o-b)<=$s.EPSILON*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(c-x)<=$s.EPSILON*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(u-C)<=$s.EPSILON*Math.max(1,Math.abs(u),Math.abs(C))&&Math.abs(h-E)<=$s.EPSILON*Math.max(1,Math.abs(h),Math.abs(E))&&Math.abs(p-M)<=$s.EPSILON*Math.max(1,Math.abs(p),Math.abs(M))&&Math.abs(f-D)<=$s.EPSILON*Math.max(1,Math.abs(f),Math.abs(D))&&Math.abs(g-A)<=$s.EPSILON*Math.max(1,Math.abs(g),Math.abs(A))&&Math.abs(v-P)<=$s.EPSILON*Math.max(1,Math.abs(v),Math.abs(P))},Dn.sub=Dn.mul=void 0;var $s=function(e,t){if(e&&e.__esModule)return e;if(e===null||ww(e)!=="object"&&typeof e!="function")return{default:e};var i=F2(void 0);if(i&&i.has(e))return i.get(e);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(u!=="default"&&Object.prototype.hasOwnProperty.call(e,u)){var h=c?Object.getOwnPropertyDescriptor(e,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=e[u]}return o.default=e,i&&i.set(e,o),o}(wo);function F2(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(F2=function(o){return o?i:t})(e)}function L2(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3],p=t[4],f=t[5],g=t[6],v=t[7],y=t[8],b=i[0],x=i[1],C=i[2],E=i[3],M=i[4],D=i[5],A=i[6],P=i[7],O=i[8];return e[0]=b*o+x*h+C*g,e[1]=b*c+x*p+C*v,e[2]=b*u+x*f+C*y,e[3]=E*o+M*h+D*g,e[4]=E*c+M*p+D*v,e[5]=E*u+M*f+D*y,e[6]=A*o+P*h+O*g,e[7]=A*c+P*p+O*v,e[8]=A*u+P*f+O*y,e}function z2(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e}Dn.mul=L2,Dn.sub=z2;var mi={};function Cw(e){return Cw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cw(e)}Object.defineProperty(mi,"__esModule",{value:!0}),mi.create=function(){var e=new Tr.ARRAY_TYPE(16);return Tr.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},mi.clone=function(e){var t=new Tr.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},mi.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},mi.fromValues=function(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E){var M=new Tr.ARRAY_TYPE(16);return M[0]=e,M[1]=t,M[2]=i,M[3]=o,M[4]=c,M[5]=u,M[6]=h,M[7]=p,M[8]=f,M[9]=g,M[10]=v,M[11]=y,M[12]=b,M[13]=x,M[14]=C,M[15]=E,M},mi.set=function(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M){return e[0]=t,e[1]=i,e[2]=o,e[3]=c,e[4]=u,e[5]=h,e[6]=p,e[7]=f,e[8]=g,e[9]=v,e[10]=y,e[11]=b,e[12]=x,e[13]=C,e[14]=E,e[15]=M,e},mi.identity=B2,mi.transpose=function(e,t){if(e===t){var i=t[1],o=t[2],c=t[3],u=t[6],h=t[7],p=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=o,e[9]=u,e[11]=t[14],e[12]=c,e[13]=h,e[14]=p}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},mi.invert=function(e,t){var i=t[0],o=t[1],c=t[2],u=t[3],h=t[4],p=t[5],f=t[6],g=t[7],v=t[8],y=t[9],b=t[10],x=t[11],C=t[12],E=t[13],M=t[14],D=t[15],A=i*p-o*h,P=i*f-c*h,O=i*g-u*h,R=o*f-c*p,F=o*g-u*p,N=c*g-u*f,j=v*E-y*C,U=v*M-b*C,G=v*D-x*C,Y=y*M-b*E,Z=y*D-x*E,tt=b*D-x*M,$=A*tt-P*Z+O*Y+R*G-F*U+N*j;return $?(e[0]=(p*tt-f*Z+g*Y)*($=1/$),e[1]=(c*Z-o*tt-u*Y)*$,e[2]=(E*N-M*F+D*R)*$,e[3]=(b*F-y*N-x*R)*$,e[4]=(f*G-h*tt-g*U)*$,e[5]=(i*tt-c*G+u*U)*$,e[6]=(M*O-C*N-D*P)*$,e[7]=(v*N-b*O+x*P)*$,e[8]=(h*Z-p*G+g*j)*$,e[9]=(o*G-i*Z-u*j)*$,e[10]=(C*F-E*O+D*A)*$,e[11]=(y*O-v*F-x*A)*$,e[12]=(p*U-h*Y-f*j)*$,e[13]=(i*Y-o*U+c*j)*$,e[14]=(E*P-C*R-M*A)*$,e[15]=(v*R-y*P+b*A)*$,e):null},mi.adjoint=function(e,t){var i=t[0],o=t[1],c=t[2],u=t[3],h=t[4],p=t[5],f=t[6],g=t[7],v=t[8],y=t[9],b=t[10],x=t[11],C=t[12],E=t[13],M=t[14],D=t[15];return e[0]=p*(b*D-x*M)-y*(f*D-g*M)+E*(f*x-g*b),e[1]=-(o*(b*D-x*M)-y*(c*D-u*M)+E*(c*x-u*b)),e[2]=o*(f*D-g*M)-p*(c*D-u*M)+E*(c*g-u*f),e[3]=-(o*(f*x-g*b)-p*(c*x-u*b)+y*(c*g-u*f)),e[4]=-(h*(b*D-x*M)-v*(f*D-g*M)+C*(f*x-g*b)),e[5]=i*(b*D-x*M)-v*(c*D-u*M)+C*(c*x-u*b),e[6]=-(i*(f*D-g*M)-h*(c*D-u*M)+C*(c*g-u*f)),e[7]=i*(f*x-g*b)-h*(c*x-u*b)+v*(c*g-u*f),e[8]=h*(y*D-x*E)-v*(p*D-g*E)+C*(p*x-g*y),e[9]=-(i*(y*D-x*E)-v*(o*D-u*E)+C*(o*x-u*y)),e[10]=i*(p*D-g*E)-h*(o*D-u*E)+C*(o*g-u*p),e[11]=-(i*(p*x-g*y)-h*(o*x-u*y)+v*(o*g-u*p)),e[12]=-(h*(y*M-b*E)-v*(p*M-f*E)+C*(p*b-f*y)),e[13]=i*(y*M-b*E)-v*(o*M-c*E)+C*(o*b-c*y),e[14]=-(i*(p*M-f*E)-h*(o*M-c*E)+C*(o*f-c*p)),e[15]=i*(p*b-f*y)-h*(o*b-c*y)+v*(o*f-c*p),e},mi.determinant=function(e){var t=e[0],i=e[1],o=e[2],c=e[3],u=e[4],h=e[5],p=e[6],f=e[7],g=e[8],v=e[9],y=e[10],b=e[11],x=e[12],C=e[13],E=e[14],M=e[15];return(t*h-i*u)*(y*M-b*E)-(t*p-o*u)*(v*M-b*C)+(t*f-c*u)*(v*E-y*C)+(i*p-o*h)*(g*M-b*x)-(i*f-c*h)*(g*E-y*x)+(o*f-c*p)*(g*C-v*x)},mi.multiply=V2,mi.translate=function(e,t,i){var o,c,u,h,p,f,g,v,y,b,x,C,E=i[0],M=i[1],D=i[2];return t===e?(e[12]=t[0]*E+t[4]*M+t[8]*D+t[12],e[13]=t[1]*E+t[5]*M+t[9]*D+t[13],e[14]=t[2]*E+t[6]*M+t[10]*D+t[14],e[15]=t[3]*E+t[7]*M+t[11]*D+t[15]):(c=t[1],u=t[2],h=t[3],p=t[4],f=t[5],g=t[6],v=t[7],y=t[8],b=t[9],x=t[10],C=t[11],e[0]=o=t[0],e[1]=c,e[2]=u,e[3]=h,e[4]=p,e[5]=f,e[6]=g,e[7]=v,e[8]=y,e[9]=b,e[10]=x,e[11]=C,e[12]=o*E+p*M+y*D+t[12],e[13]=c*E+f*M+b*D+t[13],e[14]=u*E+g*M+x*D+t[14],e[15]=h*E+v*M+C*D+t[15]),e},mi.scale=function(e,t,i){var o=i[0],c=i[1],u=i[2];return e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o,e[4]=t[4]*c,e[5]=t[5]*c,e[6]=t[6]*c,e[7]=t[7]*c,e[8]=t[8]*u,e[9]=t[9]*u,e[10]=t[10]*u,e[11]=t[11]*u,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},mi.rotate=function(e,t,i,o){var c,u,h,p,f,g,v,y,b,x,C,E,M,D,A,P,O,R,F,N,j,U,G,Y,Z=o[0],tt=o[1],$=o[2],rt=Math.hypot(Z,tt,$);return rt<Tr.EPSILON?null:(Z*=rt=1/rt,tt*=rt,$*=rt,c=Math.sin(i),u=Math.cos(i),f=t[1],g=t[2],v=t[3],b=t[5],x=t[6],C=t[7],M=t[9],D=t[10],A=t[11],F=Z*tt*(h=1-u)-$*c,N=tt*tt*h+u,j=$*tt*h+Z*c,U=Z*$*h+tt*c,G=tt*$*h-Z*c,Y=$*$*h+u,e[0]=(p=t[0])*(P=Z*Z*h+u)+(y=t[4])*(O=tt*Z*h+$*c)+(E=t[8])*(R=$*Z*h-tt*c),e[1]=f*P+b*O+M*R,e[2]=g*P+x*O+D*R,e[3]=v*P+C*O+A*R,e[4]=p*F+y*N+E*j,e[5]=f*F+b*N+M*j,e[6]=g*F+x*N+D*j,e[7]=v*F+C*N+A*j,e[8]=p*U+y*G+E*Y,e[9]=f*U+b*G+M*Y,e[10]=g*U+x*G+D*Y,e[11]=v*U+C*G+A*Y,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},mi.rotateX=function(e,t,i){var o=Math.sin(i),c=Math.cos(i),u=t[4],h=t[5],p=t[6],f=t[7],g=t[8],v=t[9],y=t[10],b=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=u*c+g*o,e[5]=h*c+v*o,e[6]=p*c+y*o,e[7]=f*c+b*o,e[8]=g*c-u*o,e[9]=v*c-h*o,e[10]=y*c-p*o,e[11]=b*c-f*o,e},mi.rotateY=function(e,t,i){var o=Math.sin(i),c=Math.cos(i),u=t[0],h=t[1],p=t[2],f=t[3],g=t[8],v=t[9],y=t[10],b=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=u*c-g*o,e[1]=h*c-v*o,e[2]=p*c-y*o,e[3]=f*c-b*o,e[8]=u*o+g*c,e[9]=h*o+v*c,e[10]=p*o+y*c,e[11]=f*o+b*c,e},mi.rotateZ=function(e,t,i){var o=Math.sin(i),c=Math.cos(i),u=t[0],h=t[1],p=t[2],f=t[3],g=t[4],v=t[5],y=t[6],b=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=u*c+g*o,e[1]=h*c+v*o,e[2]=p*c+y*o,e[3]=f*c+b*o,e[4]=g*c-u*o,e[5]=v*c-h*o,e[6]=y*c-p*o,e[7]=b*c-f*o,e},mi.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},mi.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mi.fromRotation=function(e,t,i){var o,c,u,h=i[0],p=i[1],f=i[2],g=Math.hypot(h,p,f);return g<Tr.EPSILON?null:(h*=g=1/g,p*=g,f*=g,o=Math.sin(t),c=Math.cos(t),e[0]=h*h*(u=1-c)+c,e[1]=p*h*u+f*o,e[2]=f*h*u-p*o,e[3]=0,e[4]=h*p*u-f*o,e[5]=p*p*u+c,e[6]=f*p*u+h*o,e[7]=0,e[8]=h*f*u+p*o,e[9]=p*f*u-h*o,e[10]=f*f*u+c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},mi.fromXRotation=function(e,t){var i=Math.sin(t),o=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=i,e[7]=0,e[8]=0,e[9]=-i,e[10]=o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mi.fromYRotation=function(e,t){var i=Math.sin(t),o=Math.cos(t);return e[0]=o,e[1]=0,e[2]=-i,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=i,e[9]=0,e[10]=o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mi.fromZRotation=function(e,t){var i=Math.sin(t),o=Math.cos(t);return e[0]=o,e[1]=i,e[2]=0,e[3]=0,e[4]=-i,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mi.fromRotationTranslation=j2,mi.fromQuat2=function(e,t){var i=new Tr.ARRAY_TYPE(3),o=-t[0],c=-t[1],u=-t[2],h=t[3],p=t[4],f=t[5],g=t[6],v=t[7],y=o*o+c*c+u*u+h*h;return y>0?(i[0]=2*(p*h+v*o+f*u-g*c)/y,i[1]=2*(f*h+v*c+g*o-p*u)/y,i[2]=2*(g*h+v*u+p*c-f*o)/y):(i[0]=2*(p*h+v*o+f*u-g*c),i[1]=2*(f*h+v*c+g*o-p*u),i[2]=2*(g*h+v*u+p*c-f*o)),j2(e,t,i),e},mi.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},mi.getScaling=U2,mi.getRotation=function(e,t){var i=new Tr.ARRAY_TYPE(3);U2(i,t);var o=1/i[0],c=1/i[1],u=1/i[2],h=t[0]*o,p=t[1]*c,f=t[2]*u,g=t[4]*o,v=t[5]*c,y=t[6]*u,b=t[8]*o,x=t[9]*c,C=t[10]*u,E=h+v+C,M=0;return E>0?(M=2*Math.sqrt(E+1),e[3]=.25*M,e[0]=(y-x)/M,e[1]=(b-f)/M,e[2]=(p-g)/M):h>v&&h>C?(M=2*Math.sqrt(1+h-v-C),e[3]=(y-x)/M,e[0]=.25*M,e[1]=(p+g)/M,e[2]=(b+f)/M):v>C?(M=2*Math.sqrt(1+v-h-C),e[3]=(b-f)/M,e[0]=(p+g)/M,e[1]=.25*M,e[2]=(y+x)/M):(M=2*Math.sqrt(1+C-h-v),e[3]=(p-g)/M,e[0]=(b+f)/M,e[1]=(y+x)/M,e[2]=.25*M),e},mi.fromRotationTranslationScale=function(e,t,i,o){var c=t[0],u=t[1],h=t[2],p=t[3],f=c+c,g=u+u,v=h+h,y=c*f,b=c*g,x=c*v,C=u*g,E=u*v,M=h*v,D=p*f,A=p*g,P=p*v,O=o[0],R=o[1],F=o[2];return e[0]=(1-(C+M))*O,e[1]=(b+P)*O,e[2]=(x-A)*O,e[3]=0,e[4]=(b-P)*R,e[5]=(1-(y+M))*R,e[6]=(E+D)*R,e[7]=0,e[8]=(x+A)*F,e[9]=(E-D)*F,e[10]=(1-(y+C))*F,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e},mi.fromRotationTranslationScaleOrigin=function(e,t,i,o,c){var u=t[0],h=t[1],p=t[2],f=t[3],g=u+u,v=h+h,y=p+p,b=u*g,x=u*v,C=u*y,E=h*v,M=h*y,D=p*y,A=f*g,P=f*v,O=f*y,R=o[0],F=o[1],N=o[2],j=c[0],U=c[1],G=c[2],Y=(1-(E+D))*R,Z=(x+O)*R,tt=(C-P)*R,$=(x-O)*F,rt=(1-(b+D))*F,st=(M+A)*F,pt=(C+P)*N,nt=(M-A)*N,ot=(1-(b+E))*N;return e[0]=Y,e[1]=Z,e[2]=tt,e[3]=0,e[4]=$,e[5]=rt,e[6]=st,e[7]=0,e[8]=pt,e[9]=nt,e[10]=ot,e[11]=0,e[12]=i[0]+j-(Y*j+$*U+pt*G),e[13]=i[1]+U-(Z*j+rt*U+nt*G),e[14]=i[2]+G-(tt*j+st*U+ot*G),e[15]=1,e},mi.fromQuat=function(e,t){var i=t[0],o=t[1],c=t[2],u=t[3],h=i+i,p=o+o,f=c+c,g=i*h,v=o*h,y=o*p,b=c*h,x=c*p,C=c*f,E=u*h,M=u*p,D=u*f;return e[0]=1-y-C,e[1]=v+D,e[2]=b-M,e[3]=0,e[4]=v-D,e[5]=1-g-C,e[6]=x+E,e[7]=0,e[8]=b+M,e[9]=x-E,e[10]=1-g-y,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mi.frustum=function(e,t,i,o,c,u,h){var p=1/(i-t),f=1/(c-o),g=1/(u-h);return e[0]=2*u*p,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*u*f,e[6]=0,e[7]=0,e[8]=(i+t)*p,e[9]=(c+o)*f,e[10]=(h+u)*g,e[11]=-1,e[12]=0,e[13]=0,e[14]=h*u*2*g,e[15]=0,e},mi.perspectiveNO=H2,mi.perspectiveZO=function(e,t,i,o,c){var u,h=1/Math.tan(t/2);return e[0]=h/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=h,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,c!=null&&c!==1/0?(e[10]=c*(u=1/(o-c)),e[14]=c*o*u):(e[10]=-1,e[14]=-o),e},mi.perspectiveFromFieldOfView=function(e,t,i,o){var c=Math.tan(t.upDegrees*Math.PI/180),u=Math.tan(t.downDegrees*Math.PI/180),h=Math.tan(t.leftDegrees*Math.PI/180),p=Math.tan(t.rightDegrees*Math.PI/180),f=2/(h+p),g=2/(c+u);return e[0]=f,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=g,e[6]=0,e[7]=0,e[8]=-(h-p)*f*.5,e[9]=(c-u)*g*.5,e[10]=o/(i-o),e[11]=-1,e[12]=0,e[13]=0,e[14]=o*i/(i-o),e[15]=0,e},mi.orthoNO=G2,mi.orthoZO=function(e,t,i,o,c,u,h){var p=1/(t-i),f=1/(o-c),g=1/(u-h);return e[0]=-2*p,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*f,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=g,e[11]=0,e[12]=(t+i)*p,e[13]=(c+o)*f,e[14]=u*g,e[15]=1,e},mi.lookAt=function(e,t,i,o){var c,u,h,p,f,g,v,y,b,x,C=t[0],E=t[1],M=t[2],D=o[0],A=o[1],P=o[2],O=i[0],R=i[1],F=i[2];return Math.abs(C-O)<Tr.EPSILON&&Math.abs(E-R)<Tr.EPSILON&&Math.abs(M-F)<Tr.EPSILON?B2(e):(v=C-O,y=E-R,b=M-F,c=A*(b*=x=1/Math.hypot(v,y,b))-P*(y*=x),u=P*(v*=x)-D*b,h=D*y-A*v,(x=Math.hypot(c,u,h))?(c*=x=1/x,u*=x,h*=x):(c=0,u=0,h=0),p=y*h-b*u,f=b*c-v*h,g=v*u-y*c,(x=Math.hypot(p,f,g))?(p*=x=1/x,f*=x,g*=x):(p=0,f=0,g=0),e[0]=c,e[1]=p,e[2]=v,e[3]=0,e[4]=u,e[5]=f,e[6]=y,e[7]=0,e[8]=h,e[9]=g,e[10]=b,e[11]=0,e[12]=-(c*C+u*E+h*M),e[13]=-(p*C+f*E+g*M),e[14]=-(v*C+y*E+b*M),e[15]=1,e)},mi.targetTo=function(e,t,i,o){var c=t[0],u=t[1],h=t[2],p=o[0],f=o[1],g=o[2],v=c-i[0],y=u-i[1],b=h-i[2],x=v*v+y*y+b*b;x>0&&(v*=x=1/Math.sqrt(x),y*=x,b*=x);var C=f*b-g*y,E=g*v-p*b,M=p*y-f*v;return(x=C*C+E*E+M*M)>0&&(C*=x=1/Math.sqrt(x),E*=x,M*=x),e[0]=C,e[1]=E,e[2]=M,e[3]=0,e[4]=y*M-b*E,e[5]=b*C-v*M,e[6]=v*E-y*C,e[7]=0,e[8]=v,e[9]=y,e[10]=b,e[11]=0,e[12]=c,e[13]=u,e[14]=h,e[15]=1,e},mi.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},mi.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},mi.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e[9]=t[9]+i[9],e[10]=t[10]+i[10],e[11]=t[11]+i[11],e[12]=t[12]+i[12],e[13]=t[13]+i[13],e[14]=t[14]+i[14],e[15]=t[15]+i[15],e},mi.subtract=q2,mi.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12]*i,e[13]=t[13]*i,e[14]=t[14]*i,e[15]=t[15]*i,e},mi.multiplyScalarAndAdd=function(e,t,i,o){return e[0]=t[0]+i[0]*o,e[1]=t[1]+i[1]*o,e[2]=t[2]+i[2]*o,e[3]=t[3]+i[3]*o,e[4]=t[4]+i[4]*o,e[5]=t[5]+i[5]*o,e[6]=t[6]+i[6]*o,e[7]=t[7]+i[7]*o,e[8]=t[8]+i[8]*o,e[9]=t[9]+i[9]*o,e[10]=t[10]+i[10]*o,e[11]=t[11]+i[11]*o,e[12]=t[12]+i[12]*o,e[13]=t[13]+i[13]*o,e[14]=t[14]+i[14]*o,e[15]=t[15]+i[15]*o,e},mi.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},mi.equals=function(e,t){var i=e[0],o=e[1],c=e[2],u=e[3],h=e[4],p=e[5],f=e[6],g=e[7],v=e[8],y=e[9],b=e[10],x=e[11],C=e[12],E=e[13],M=e[14],D=e[15],A=t[0],P=t[1],O=t[2],R=t[3],F=t[4],N=t[5],j=t[6],U=t[7],G=t[8],Y=t[9],Z=t[10],tt=t[11],$=t[12],rt=t[13],st=t[14],pt=t[15];return Math.abs(i-A)<=Tr.EPSILON*Math.max(1,Math.abs(i),Math.abs(A))&&Math.abs(o-P)<=Tr.EPSILON*Math.max(1,Math.abs(o),Math.abs(P))&&Math.abs(c-O)<=Tr.EPSILON*Math.max(1,Math.abs(c),Math.abs(O))&&Math.abs(u-R)<=Tr.EPSILON*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(h-F)<=Tr.EPSILON*Math.max(1,Math.abs(h),Math.abs(F))&&Math.abs(p-N)<=Tr.EPSILON*Math.max(1,Math.abs(p),Math.abs(N))&&Math.abs(f-j)<=Tr.EPSILON*Math.max(1,Math.abs(f),Math.abs(j))&&Math.abs(g-U)<=Tr.EPSILON*Math.max(1,Math.abs(g),Math.abs(U))&&Math.abs(v-G)<=Tr.EPSILON*Math.max(1,Math.abs(v),Math.abs(G))&&Math.abs(y-Y)<=Tr.EPSILON*Math.max(1,Math.abs(y),Math.abs(Y))&&Math.abs(b-Z)<=Tr.EPSILON*Math.max(1,Math.abs(b),Math.abs(Z))&&Math.abs(x-tt)<=Tr.EPSILON*Math.max(1,Math.abs(x),Math.abs(tt))&&Math.abs(C-$)<=Tr.EPSILON*Math.max(1,Math.abs(C),Math.abs($))&&Math.abs(E-rt)<=Tr.EPSILON*Math.max(1,Math.abs(E),Math.abs(rt))&&Math.abs(M-st)<=Tr.EPSILON*Math.max(1,Math.abs(M),Math.abs(st))&&Math.abs(D-pt)<=Tr.EPSILON*Math.max(1,Math.abs(D),Math.abs(pt))},mi.sub=mi.mul=mi.ortho=mi.perspective=void 0;var Tr=function(e,t){if(e&&e.__esModule)return e;if(e===null||Cw(e)!=="object"&&typeof e!="function")return{default:e};var i=N2(void 0);if(i&&i.has(e))return i.get(e);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(u!=="default"&&Object.prototype.hasOwnProperty.call(e,u)){var h=c?Object.getOwnPropertyDescriptor(e,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=e[u]}return o.default=e,i&&i.set(e,o),o}(wo);function N2(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(N2=function(o){return o?i:t})(e)}function B2(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function V2(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3],p=t[4],f=t[5],g=t[6],v=t[7],y=t[8],b=t[9],x=t[10],C=t[11],E=t[12],M=t[13],D=t[14],A=t[15],P=i[0],O=i[1],R=i[2],F=i[3];return e[0]=P*o+O*p+R*y+F*E,e[1]=P*c+O*f+R*b+F*M,e[2]=P*u+O*g+R*x+F*D,e[3]=P*h+O*v+R*C+F*A,e[4]=(P=i[4])*o+(O=i[5])*p+(R=i[6])*y+(F=i[7])*E,e[5]=P*c+O*f+R*b+F*M,e[6]=P*u+O*g+R*x+F*D,e[7]=P*h+O*v+R*C+F*A,e[8]=(P=i[8])*o+(O=i[9])*p+(R=i[10])*y+(F=i[11])*E,e[9]=P*c+O*f+R*b+F*M,e[10]=P*u+O*g+R*x+F*D,e[11]=P*h+O*v+R*C+F*A,e[12]=(P=i[12])*o+(O=i[13])*p+(R=i[14])*y+(F=i[15])*E,e[13]=P*c+O*f+R*b+F*M,e[14]=P*u+O*g+R*x+F*D,e[15]=P*h+O*v+R*C+F*A,e}function j2(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3],p=o+o,f=c+c,g=u+u,v=o*p,y=o*f,b=o*g,x=c*f,C=c*g,E=u*g,M=h*p,D=h*f,A=h*g;return e[0]=1-(x+E),e[1]=y+A,e[2]=b-D,e[3]=0,e[4]=y-A,e[5]=1-(v+E),e[6]=C+M,e[7]=0,e[8]=b+D,e[9]=C-M,e[10]=1-(v+x),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function U2(e,t){var i=t[4],o=t[5],c=t[6],u=t[8],h=t[9],p=t[10];return e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(i,o,c),e[2]=Math.hypot(u,h,p),e}function H2(e,t,i,o,c){var u,h=1/Math.tan(t/2);return e[0]=h/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=h,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,c!=null&&c!==1/0?(e[10]=(c+o)*(u=1/(o-c)),e[14]=2*c*o*u):(e[10]=-1,e[14]=-2*o),e}function G2(e,t,i,o,c,u,h){var p=1/(t-i),f=1/(o-c),g=1/(u-h);return e[0]=-2*p,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*f,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*g,e[11]=0,e[12]=(t+i)*p,e[13]=(c+o)*f,e[14]=(h+u)*g,e[15]=1,e}function q2(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e[9]=t[9]-i[9],e[10]=t[10]-i[10],e[11]=t[11]-i[11],e[12]=t[12]-i[12],e[13]=t[13]-i[13],e[14]=t[14]-i[14],e[15]=t[15]-i[15],e}mi.perspective=H2,mi.ortho=G2,mi.mul=V2,mi.sub=q2;var ai={},ui={};function Sw(e){return Sw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sw(e)}Object.defineProperty(ui,"__esModule",{value:!0}),ui.create=$2,ui.clone=function(e){var t=new cc.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},ui.length=Y2,ui.fromValues=function(e,t,i){var o=new cc.ARRAY_TYPE(3);return o[0]=e,o[1]=t,o[2]=i,o},ui.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},ui.set=function(e,t,i,o){return e[0]=t,e[1]=i,e[2]=o,e},ui.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e},ui.subtract=Z2,ui.multiply=X2,ui.divide=K2,ui.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},ui.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},ui.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e},ui.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e},ui.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},ui.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e},ui.scaleAndAdd=function(e,t,i,o){return e[0]=t[0]+i[0]*o,e[1]=t[1]+i[1]*o,e[2]=t[2]+i[2]*o,e},ui.distance=Q2,ui.squaredDistance=J2,ui.squaredLength=tA,ui.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},ui.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},ui.normalize=function(e,t){var i=t[0],o=t[1],c=t[2],u=i*i+o*o+c*c;return u>0&&(u=1/Math.sqrt(u)),e[0]=t[0]*u,e[1]=t[1]*u,e[2]=t[2]*u,e},ui.dot=eA,ui.cross=function(e,t,i){var o=t[0],c=t[1],u=t[2],h=i[0],p=i[1],f=i[2];return e[0]=c*f-u*p,e[1]=u*h-o*f,e[2]=o*p-c*h,e},ui.lerp=function(e,t,i,o){var c=t[0],u=t[1],h=t[2];return e[0]=c+o*(i[0]-c),e[1]=u+o*(i[1]-u),e[2]=h+o*(i[2]-h),e},ui.hermite=function(e,t,i,o,c,u){var h=u*u,p=h*(2*u-3)+1,f=h*(u-2)+u,g=h*(u-1),v=h*(3-2*u);return e[0]=t[0]*p+i[0]*f+o[0]*g+c[0]*v,e[1]=t[1]*p+i[1]*f+o[1]*g+c[1]*v,e[2]=t[2]*p+i[2]*f+o[2]*g+c[2]*v,e},ui.bezier=function(e,t,i,o,c,u){var h=1-u,p=h*h,f=u*u,g=p*h,v=3*u*p,y=3*f*h,b=f*u;return e[0]=t[0]*g+i[0]*v+o[0]*y+c[0]*b,e[1]=t[1]*g+i[1]*v+o[1]*y+c[1]*b,e[2]=t[2]*g+i[2]*v+o[2]*y+c[2]*b,e},ui.random=function(e,t){t=t||1;var i=2*cc.RANDOM()*Math.PI,o=2*cc.RANDOM()-1,c=Math.sqrt(1-o*o)*t;return e[0]=Math.cos(i)*c,e[1]=Math.sin(i)*c,e[2]=o*t,e},ui.transformMat4=function(e,t,i){var o=t[0],c=t[1],u=t[2],h=i[3]*o+i[7]*c+i[11]*u+i[15];return e[0]=(i[0]*o+i[4]*c+i[8]*u+i[12])/(h=h||1),e[1]=(i[1]*o+i[5]*c+i[9]*u+i[13])/h,e[2]=(i[2]*o+i[6]*c+i[10]*u+i[14])/h,e},ui.transformMat3=function(e,t,i){var o=t[0],c=t[1],u=t[2];return e[0]=o*i[0]+c*i[3]+u*i[6],e[1]=o*i[1]+c*i[4]+u*i[7],e[2]=o*i[2]+c*i[5]+u*i[8],e},ui.transformQuat=function(e,t,i){var o=i[0],c=i[1],u=i[2],h=t[0],p=t[1],f=t[2],g=c*f-u*p,v=u*h-o*f,y=o*p-c*h,b=c*y-u*v,x=u*g-o*y,C=o*v-c*g,E=2*i[3];return v*=E,y*=E,x*=2,C*=2,e[0]=h+(g*=E)+(b*=2),e[1]=p+v+x,e[2]=f+y+C,e},ui.rotateX=function(e,t,i,o){var c=[],u=[];return c[0]=t[0]-i[0],c[1]=t[1]-i[1],c[2]=t[2]-i[2],u[0]=c[0],u[1]=c[1]*Math.cos(o)-c[2]*Math.sin(o),u[2]=c[1]*Math.sin(o)+c[2]*Math.cos(o),e[0]=u[0]+i[0],e[1]=u[1]+i[1],e[2]=u[2]+i[2],e},ui.rotateY=function(e,t,i,o){var c=[],u=[];return c[0]=t[0]-i[0],c[1]=t[1]-i[1],c[2]=t[2]-i[2],u[0]=c[2]*Math.sin(o)+c[0]*Math.cos(o),u[1]=c[1],u[2]=c[2]*Math.cos(o)-c[0]*Math.sin(o),e[0]=u[0]+i[0],e[1]=u[1]+i[1],e[2]=u[2]+i[2],e},ui.rotateZ=function(e,t,i,o){var c=[],u=[];return c[0]=t[0]-i[0],c[1]=t[1]-i[1],c[2]=t[2]-i[2],u[0]=c[0]*Math.cos(o)-c[1]*Math.sin(o),u[1]=c[0]*Math.sin(o)+c[1]*Math.cos(o),u[2]=c[2],e[0]=u[0]+i[0],e[1]=u[1]+i[1],e[2]=u[2]+i[2],e},ui.angle=function(e,t){var i=e[0],o=e[1],c=e[2],u=t[0],h=t[1],p=t[2],f=Math.sqrt(i*i+o*o+c*c)*Math.sqrt(u*u+h*h+p*p),g=f&&eA(e,t)/f;return Math.acos(Math.min(Math.max(g,-1),1))},ui.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e},ui.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},ui.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},ui.equals=function(e,t){var i=e[0],o=e[1],c=e[2],u=t[0],h=t[1],p=t[2];return Math.abs(i-u)<=cc.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-h)<=cc.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(c-p)<=cc.EPSILON*Math.max(1,Math.abs(c),Math.abs(p))},ui.forEach=ui.sqrLen=ui.len=ui.sqrDist=ui.dist=ui.div=ui.mul=ui.sub=void 0;var cc=function(e,t){if(e&&e.__esModule)return e;if(e===null||Sw(e)!=="object"&&typeof e!="function")return{default:e};var i=W2(void 0);if(i&&i.has(e))return i.get(e);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(u!=="default"&&Object.prototype.hasOwnProperty.call(e,u)){var h=c?Object.getOwnPropertyDescriptor(e,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=e[u]}return o.default=e,i&&i.set(e,o),o}(wo);function W2(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(W2=function(o){return o?i:t})(e)}function $2(){var e=new cc.ARRAY_TYPE(3);return cc.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Y2(e){return Math.hypot(e[0],e[1],e[2])}function Z2(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function X2(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function K2(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e}function Q2(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])}function J2(e,t){var i=t[0]-e[0],o=t[1]-e[1],c=t[2]-e[2];return i*i+o*o+c*c}function tA(e){var t=e[0],i=e[1],o=e[2];return t*t+i*i+o*o}function eA(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}ui.sub=Z2,ui.mul=X2,ui.div=K2,ui.dist=Q2,ui.sqrDist=J2,ui.len=Y2,ui.sqrLen=tA;var dc,H6=(dc=$2(),function(e,t,i,o,c,u){var h,p;for(t||(t=3),i||(i=0),p=o?Math.min(o*t+i,e.length):e.length,h=i;h<p;h+=t)dc[0]=e[h],dc[1]=e[h+1],dc[2]=e[h+2],c(dc,dc,u),e[h]=dc[0],e[h+1]=dc[1],e[h+2]=dc[2];return e});ui.forEach=H6;var Ti={};function Ew(e){return Ew=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ew(e)}Object.defineProperty(Ti,"__esModule",{value:!0}),Ti.create=nA,Ti.clone=function(e){var t=new ma.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Ti.fromValues=function(e,t,i,o){var c=new ma.ARRAY_TYPE(4);return c[0]=e,c[1]=t,c[2]=i,c[3]=o,c},Ti.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Ti.set=function(e,t,i,o,c){return e[0]=t,e[1]=i,e[2]=o,e[3]=c,e},Ti.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e},Ti.subtract=rA,Ti.multiply=oA,Ti.divide=sA,Ti.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},Ti.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},Ti.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e[3]=Math.min(t[3],i[3]),e},Ti.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e[3]=Math.max(t[3],i[3]),e},Ti.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},Ti.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},Ti.scaleAndAdd=function(e,t,i,o){return e[0]=t[0]+i[0]*o,e[1]=t[1]+i[1]*o,e[2]=t[2]+i[2]*o,e[3]=t[3]+i[3]*o,e},Ti.distance=aA,Ti.squaredDistance=lA,Ti.length=cA,Ti.squaredLength=dA,Ti.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},Ti.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},Ti.normalize=function(e,t){var i=t[0],o=t[1],c=t[2],u=t[3],h=i*i+o*o+c*c+u*u;return h>0&&(h=1/Math.sqrt(h)),e[0]=i*h,e[1]=o*h,e[2]=c*h,e[3]=u*h,e},Ti.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},Ti.cross=function(e,t,i,o){var c=i[0]*o[1]-i[1]*o[0],u=i[0]*o[2]-i[2]*o[0],h=i[0]*o[3]-i[3]*o[0],p=i[1]*o[2]-i[2]*o[1],f=i[1]*o[3]-i[3]*o[1],g=i[2]*o[3]-i[3]*o[2],v=t[0],y=t[1],b=t[2],x=t[3];return e[0]=y*g-b*f+x*p,e[1]=-v*g+b*h-x*u,e[2]=v*f-y*h+x*c,e[3]=-v*p+y*u-b*c,e},Ti.lerp=function(e,t,i,o){var c=t[0],u=t[1],h=t[2],p=t[3];return e[0]=c+o*(i[0]-c),e[1]=u+o*(i[1]-u),e[2]=h+o*(i[2]-h),e[3]=p+o*(i[3]-p),e},Ti.random=function(e,t){var i,o,c,u,h,p;t=t||1;do h=(i=2*ma.RANDOM()-1)*i+(o=2*ma.RANDOM()-1)*o;while(h>=1);do p=(c=2*ma.RANDOM()-1)*c+(u=2*ma.RANDOM()-1)*u;while(p>=1);var f=Math.sqrt((1-h)/p);return e[0]=t*i,e[1]=t*o,e[2]=t*c*f,e[3]=t*u*f,e},Ti.transformMat4=function(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3];return e[0]=i[0]*o+i[4]*c+i[8]*u+i[12]*h,e[1]=i[1]*o+i[5]*c+i[9]*u+i[13]*h,e[2]=i[2]*o+i[6]*c+i[10]*u+i[14]*h,e[3]=i[3]*o+i[7]*c+i[11]*u+i[15]*h,e},Ti.transformQuat=function(e,t,i){var o=t[0],c=t[1],u=t[2],h=i[0],p=i[1],f=i[2],g=i[3],v=g*o+p*u-f*c,y=g*c+f*o-h*u,b=g*u+h*c-p*o,x=-h*o-p*c-f*u;return e[0]=v*g+x*-h+y*-f-b*-p,e[1]=y*g+x*-p+b*-h-v*-f,e[2]=b*g+x*-f+v*-p-y*-h,e[3]=t[3],e},Ti.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},Ti.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},Ti.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},Ti.equals=function(e,t){var i=e[0],o=e[1],c=e[2],u=e[3],h=t[0],p=t[1],f=t[2],g=t[3];return Math.abs(i-h)<=ma.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-p)<=ma.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(c-f)<=ma.EPSILON*Math.max(1,Math.abs(c),Math.abs(f))&&Math.abs(u-g)<=ma.EPSILON*Math.max(1,Math.abs(u),Math.abs(g))},Ti.forEach=Ti.sqrLen=Ti.len=Ti.sqrDist=Ti.dist=Ti.div=Ti.mul=Ti.sub=void 0;var ma=function(e,t){if(e&&e.__esModule)return e;if(e===null||Ew(e)!=="object"&&typeof e!="function")return{default:e};var i=iA(void 0);if(i&&i.has(e))return i.get(e);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(u!=="default"&&Object.prototype.hasOwnProperty.call(e,u)){var h=c?Object.getOwnPropertyDescriptor(e,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=e[u]}return o.default=e,i&&i.set(e,o),o}(wo);function iA(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(iA=function(o){return o?i:t})(e)}function nA(){var e=new ma.ARRAY_TYPE(4);return ma.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function rA(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function oA(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}function sA(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e[3]=t[3]/i[3],e}function aA(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3])}function lA(e,t){var i=t[0]-e[0],o=t[1]-e[1],c=t[2]-e[2],u=t[3]-e[3];return i*i+o*o+c*c+u*u}function cA(e){return Math.hypot(e[0],e[1],e[2],e[3])}function dA(e){var t=e[0],i=e[1],o=e[2],c=e[3];return t*t+i*i+o*o+c*c}Ti.sub=rA,Ti.mul=oA,Ti.div=sA,Ti.dist=aA,Ti.sqrDist=lA,Ti.len=cA,Ti.sqrLen=dA;var G6=function(){var e=nA();return function(t,i,o,c,u,h){var p,f;for(i||(i=4),o||(o=0),f=c?Math.min(c*i+o,t.length):t.length,p=o;p<f;p+=i)e[0]=t[p],e[1]=t[p+1],e[2]=t[p+2],e[3]=t[p+3],u(e,e,h),t[p]=e[0],t[p+1]=e[1],t[p+2]=e[2],t[p+3]=e[3];return t}}();function Mw(e){return Mw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mw(e)}Ti.forEach=G6,Object.defineProperty(ai,"__esModule",{value:!0}),ai.create=Dw,ai.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},ai.setAxisAngle=hA,ai.getAxisAngle=function(e,t){var i=2*Math.acos(t[3]),o=Math.sin(i/2);return o>ru.EPSILON?(e[0]=t[0]/o,e[1]=t[1]/o,e[2]=t[2]/o):(e[0]=1,e[1]=0,e[2]=0),i},ai.getAngle=function(e,t){var i=vA(e,t);return Math.acos(2*i*i-1)},ai.multiply=mA,ai.rotateX=function(e,t,i){i*=.5;var o=t[0],c=t[1],u=t[2],h=t[3],p=Math.sin(i),f=Math.cos(i);return e[0]=o*f+h*p,e[1]=c*f+u*p,e[2]=u*f-c*p,e[3]=h*f-o*p,e},ai.rotateY=function(e,t,i){i*=.5;var o=t[0],c=t[1],u=t[2],h=t[3],p=Math.sin(i),f=Math.cos(i);return e[0]=o*f-u*p,e[1]=c*f+h*p,e[2]=u*f+o*p,e[3]=h*f-c*p,e},ai.rotateZ=function(e,t,i){i*=.5;var o=t[0],c=t[1],u=t[2],h=t[3],p=Math.sin(i),f=Math.cos(i);return e[0]=o*f+c*p,e[1]=c*f-o*p,e[2]=u*f+h*p,e[3]=h*f-u*p,e},ai.calculateW=function(e,t){var i=t[0],o=t[1],c=t[2];return e[0]=i,e[1]=o,e[2]=c,e[3]=Math.sqrt(Math.abs(1-i*i-o*o-c*c)),e},ai.exp=pA,ai.ln=fA,ai.pow=function(e,t,i){return fA(e,t),_A(e,e,i),pA(e,e),e},ai.slerp=V_,ai.random=function(e){var t=ru.RANDOM(),i=ru.RANDOM(),o=ru.RANDOM(),c=Math.sqrt(1-t),u=Math.sqrt(t);return e[0]=c*Math.sin(2*Math.PI*i),e[1]=c*Math.cos(2*Math.PI*i),e[2]=u*Math.sin(2*Math.PI*o),e[3]=u*Math.cos(2*Math.PI*o),e},ai.invert=function(e,t){var i=t[0],o=t[1],c=t[2],u=t[3],h=i*i+o*o+c*c+u*u,p=h?1/h:0;return e[0]=-i*p,e[1]=-o*p,e[2]=-c*p,e[3]=u*p,e},ai.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},ai.fromMat3=gA,ai.fromEuler=function(e,t,i,o){var c=.5*Math.PI/180;t*=c,i*=c,o*=c;var u=Math.sin(t),h=Math.cos(t),p=Math.sin(i),f=Math.cos(i),g=Math.sin(o),v=Math.cos(o);return e[0]=u*f*v-h*p*g,e[1]=h*p*v+u*f*g,e[2]=h*f*g-u*p*v,e[3]=h*f*v+u*p*g,e},ai.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},ai.setAxes=ai.sqlerp=ai.rotationTo=ai.equals=ai.exactEquals=ai.normalize=ai.sqrLen=ai.squaredLength=ai.len=ai.length=ai.lerp=ai.dot=ai.scale=ai.mul=ai.add=ai.set=ai.copy=ai.fromValues=ai.clone=void 0;var ru=B_(wo),q6=B_(Dn),uc=B_(ui),Ys=B_(Ti);function uA(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(uA=function(o){return o?i:t})(e)}function B_(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||Mw(e)!=="object"&&typeof e!="function")return{default:e};var i=uA(t);if(i&&i.has(e))return i.get(e);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(u!=="default"&&Object.prototype.hasOwnProperty.call(e,u)){var h=c?Object.getOwnPropertyDescriptor(e,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=e[u]}return o.default=e,i&&i.set(e,o),o}function Dw(){var e=new ru.ARRAY_TYPE(4);return ru.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function hA(e,t,i){i*=.5;var o=Math.sin(i);return e[0]=o*t[0],e[1]=o*t[1],e[2]=o*t[2],e[3]=Math.cos(i),e}function mA(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3],p=i[0],f=i[1],g=i[2],v=i[3];return e[0]=o*v+h*p+c*g-u*f,e[1]=c*v+h*f+u*p-o*g,e[2]=u*v+h*g+o*f-c*p,e[3]=h*v-o*p-c*f-u*g,e}function pA(e,t){var i=t[0],o=t[1],c=t[2],u=t[3],h=Math.sqrt(i*i+o*o+c*c),p=Math.exp(u),f=h>0?p*Math.sin(h)/h:0;return e[0]=i*f,e[1]=o*f,e[2]=c*f,e[3]=p*Math.cos(h),e}function fA(e,t){var i=t[0],o=t[1],c=t[2],u=t[3],h=Math.sqrt(i*i+o*o+c*c),p=h>0?Math.atan2(h,u)/h:0;return e[0]=i*p,e[1]=o*p,e[2]=c*p,e[3]=.5*Math.log(i*i+o*o+c*c+u*u),e}function V_(e,t,i,o){var c,u,h,p,f,g=t[0],v=t[1],y=t[2],b=t[3],x=i[0],C=i[1],E=i[2],M=i[3];return(u=g*x+v*C+y*E+b*M)<0&&(u=-u,x=-x,C=-C,E=-E,M=-M),1-u>ru.EPSILON?(c=Math.acos(u),h=Math.sin(c),p=Math.sin((1-o)*c)/h,f=Math.sin(o*c)/h):(p=1-o,f=o),e[0]=p*g+f*x,e[1]=p*v+f*C,e[2]=p*y+f*E,e[3]=p*b+f*M,e}function gA(e,t){var i,o=t[0]+t[4]+t[8];if(o>0)i=Math.sqrt(o+1),e[3]=.5*i,e[0]=(t[5]-t[7])*(i=.5/i),e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{var c=0;t[4]>t[0]&&(c=1),t[8]>t[3*c+c]&&(c=2);var u=(c+1)%3,h=(c+2)%3;i=Math.sqrt(t[3*c+c]-t[3*u+u]-t[3*h+h]+1),e[c]=.5*i,e[3]=(t[3*u+h]-t[3*h+u])*(i=.5/i),e[u]=(t[3*u+c]+t[3*c+u])*i,e[h]=(t[3*h+c]+t[3*c+h])*i}return e}ai.clone=Ys.clone,ai.fromValues=Ys.fromValues,ai.copy=Ys.copy,ai.set=Ys.set,ai.add=Ys.add,ai.mul=mA;var _A=Ys.scale;ai.scale=_A;var vA=Ys.dot;ai.dot=vA,ai.lerp=Ys.lerp;var yA=Ys.length;ai.length=yA,ai.len=yA;var bA=Ys.squaredLength;ai.squaredLength=bA,ai.sqrLen=bA;var Tw=Ys.normalize;ai.normalize=Tw,ai.exactEquals=Ys.exactEquals,ai.equals=Ys.equals;var Xa,xA,wA,W6=(Xa=uc.create(),xA=uc.fromValues(1,0,0),wA=uc.fromValues(0,1,0),function(e,t,i){var o=uc.dot(t,i);return o<-.999999?(uc.cross(Xa,xA,t),uc.len(Xa)<1e-6&&uc.cross(Xa,wA,t),uc.normalize(Xa,Xa),hA(e,Xa,Math.PI),e):o>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(uc.cross(Xa,t,i),e[0]=Xa[0],e[1]=Xa[1],e[2]=Xa[2],e[3]=1+o,Tw(e,e))});ai.rotationTo=W6;var Iw,Aw,$6=(Iw=Dw(),Aw=Dw(),function(e,t,i,o,c,u){return V_(Iw,t,c,u),V_(Aw,i,o,u),V_(e,Iw,Aw,2*u*(1-u)),e});ai.sqlerp=$6;var Ka,Y6=(Ka=q6.create(),function(e,t,i,o){return Ka[0]=i[0],Ka[3]=i[1],Ka[6]=i[2],Ka[1]=o[0],Ka[4]=o[1],Ka[7]=o[2],Ka[2]=-t[0],Ka[5]=-t[1],Ka[8]=-t[2],Tw(e,gA(e,Ka))});ai.setAxes=Y6;var Bi={};function kw(e){return kw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kw(e)}Object.defineProperty(Bi,"__esModule",{value:!0}),Bi.create=function(){var e=new ds.ARRAY_TYPE(8);return ds.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},Bi.clone=function(e){var t=new ds.ARRAY_TYPE(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},Bi.fromValues=function(e,t,i,o,c,u,h,p){var f=new ds.ARRAY_TYPE(8);return f[0]=e,f[1]=t,f[2]=i,f[3]=o,f[4]=c,f[5]=u,f[6]=h,f[7]=p,f},Bi.fromRotationTranslationValues=function(e,t,i,o,c,u,h){var p=new ds.ARRAY_TYPE(8);p[0]=e,p[1]=t,p[2]=i,p[3]=o;var f=.5*c,g=.5*u,v=.5*h;return p[4]=f*o+g*i-v*t,p[5]=g*o+v*e-f*i,p[6]=v*o+f*t-g*e,p[7]=-f*e-g*t-v*i,p},Bi.fromRotationTranslation=EA,Bi.fromTranslation=function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},Bi.fromRotation=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},Bi.fromMat4=function(e,t){var i=hc.create();CA.getRotation(i,t);var o=new ds.ARRAY_TYPE(3);return CA.getTranslation(o,t),EA(e,i,o),e},Bi.copy=MA,Bi.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},Bi.set=function(e,t,i,o,c,u,h,p,f){return e[0]=t,e[1]=i,e[2]=o,e[3]=c,e[4]=u,e[5]=h,e[6]=p,e[7]=f,e},Bi.getDual=function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},Bi.setDual=function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},Bi.getTranslation=function(e,t){var i=t[4],o=t[5],c=t[6],u=t[7],h=-t[0],p=-t[1],f=-t[2],g=t[3];return e[0]=2*(i*g+u*h+o*f-c*p),e[1]=2*(o*g+u*p+c*h-i*f),e[2]=2*(c*g+u*f+i*p-o*h),e},Bi.translate=function(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3],p=.5*i[0],f=.5*i[1],g=.5*i[2],v=t[4],y=t[5],b=t[6],x=t[7];return e[0]=o,e[1]=c,e[2]=u,e[3]=h,e[4]=h*p+c*g-u*f+v,e[5]=h*f+u*p-o*g+y,e[6]=h*g+o*f-c*p+b,e[7]=-o*p-c*f-u*g+x,e},Bi.rotateX=function(e,t,i){var o=-t[0],c=-t[1],u=-t[2],h=t[3],p=t[4],f=t[5],g=t[6],v=t[7],y=p*h+v*o+f*u-g*c,b=f*h+v*c+g*o-p*u,x=g*h+v*u+p*c-f*o,C=v*h-p*o-f*c-g*u;return hc.rotateX(e,t,i),e[4]=y*(h=e[3])+C*(o=e[0])+b*(u=e[2])-x*(c=e[1]),e[5]=b*h+C*c+x*o-y*u,e[6]=x*h+C*u+y*c-b*o,e[7]=C*h-y*o-b*c-x*u,e},Bi.rotateY=function(e,t,i){var o=-t[0],c=-t[1],u=-t[2],h=t[3],p=t[4],f=t[5],g=t[6],v=t[7],y=p*h+v*o+f*u-g*c,b=f*h+v*c+g*o-p*u,x=g*h+v*u+p*c-f*o,C=v*h-p*o-f*c-g*u;return hc.rotateY(e,t,i),e[4]=y*(h=e[3])+C*(o=e[0])+b*(u=e[2])-x*(c=e[1]),e[5]=b*h+C*c+x*o-y*u,e[6]=x*h+C*u+y*c-b*o,e[7]=C*h-y*o-b*c-x*u,e},Bi.rotateZ=function(e,t,i){var o=-t[0],c=-t[1],u=-t[2],h=t[3],p=t[4],f=t[5],g=t[6],v=t[7],y=p*h+v*o+f*u-g*c,b=f*h+v*c+g*o-p*u,x=g*h+v*u+p*c-f*o,C=v*h-p*o-f*c-g*u;return hc.rotateZ(e,t,i),e[4]=y*(h=e[3])+C*(o=e[0])+b*(u=e[2])-x*(c=e[1]),e[5]=b*h+C*c+x*o-y*u,e[6]=x*h+C*u+y*c-b*o,e[7]=C*h-y*o-b*c-x*u,e},Bi.rotateByQuatAppend=function(e,t,i){var o=i[0],c=i[1],u=i[2],h=i[3],p=t[0],f=t[1],g=t[2],v=t[3];return e[0]=p*h+v*o+f*u-g*c,e[1]=f*h+v*c+g*o-p*u,e[2]=g*h+v*u+p*c-f*o,e[3]=v*h-p*o-f*c-g*u,e[4]=(p=t[4])*h+(v=t[7])*o+(f=t[5])*u-(g=t[6])*c,e[5]=f*h+v*c+g*o-p*u,e[6]=g*h+v*u+p*c-f*o,e[7]=v*h-p*o-f*c-g*u,e},Bi.rotateByQuatPrepend=function(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3],p=i[0],f=i[1],g=i[2],v=i[3];return e[0]=o*v+h*p+c*g-u*f,e[1]=c*v+h*f+u*p-o*g,e[2]=u*v+h*g+o*f-c*p,e[3]=h*v-o*p-c*f-u*g,e[4]=o*(v=i[7])+h*(p=i[4])+c*(g=i[6])-u*(f=i[5]),e[5]=c*v+h*f+u*p-o*g,e[6]=u*v+h*g+o*f-c*p,e[7]=h*v-o*p-c*f-u*g,e},Bi.rotateAroundAxis=function(e,t,i,o){if(Math.abs(o)<ds.EPSILON)return MA(e,t);var c=Math.hypot(i[0],i[1],i[2]);o*=.5;var u=Math.sin(o),h=u*i[0]/c,p=u*i[1]/c,f=u*i[2]/c,g=Math.cos(o),v=t[0],y=t[1],b=t[2],x=t[3];e[0]=v*g+x*h+y*f-b*p,e[1]=y*g+x*p+b*h-v*f,e[2]=b*g+x*f+v*p-y*h,e[3]=x*g-v*h-y*p-b*f;var C=t[4],E=t[5],M=t[6],D=t[7];return e[4]=C*g+D*h+E*f-M*p,e[5]=E*g+D*p+M*h-C*f,e[6]=M*g+D*f+C*p-E*h,e[7]=D*g-C*h-E*p-M*f,e},Bi.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e},Bi.multiply=DA,Bi.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e},Bi.lerp=function(e,t,i,o){var c=1-o;return TA(t,i)<0&&(o=-o),e[0]=t[0]*c+i[0]*o,e[1]=t[1]*c+i[1]*o,e[2]=t[2]*c+i[2]*o,e[3]=t[3]*c+i[3]*o,e[4]=t[4]*c+i[4]*o,e[5]=t[5]*c+i[5]*o,e[6]=t[6]*c+i[6]*o,e[7]=t[7]*c+i[7]*o,e},Bi.invert=function(e,t){var i=j_(t);return e[0]=-t[0]/i,e[1]=-t[1]/i,e[2]=-t[2]/i,e[3]=t[3]/i,e[4]=-t[4]/i,e[5]=-t[5]/i,e[6]=-t[6]/i,e[7]=t[7]/i,e},Bi.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},Bi.normalize=function(e,t){var i=j_(t);if(i>0){i=Math.sqrt(i);var o=t[0]/i,c=t[1]/i,u=t[2]/i,h=t[3]/i,p=t[4],f=t[5],g=t[6],v=t[7],y=o*p+c*f+u*g+h*v;e[0]=o,e[1]=c,e[2]=u,e[3]=h,e[4]=(p-o*y)/i,e[5]=(f-c*y)/i,e[6]=(g-u*y)/i,e[7]=(v-h*y)/i}return e},Bi.str=function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},Bi.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},Bi.equals=function(e,t){var i=e[0],o=e[1],c=e[2],u=e[3],h=e[4],p=e[5],f=e[6],g=e[7],v=t[0],y=t[1],b=t[2],x=t[3],C=t[4],E=t[5],M=t[6],D=t[7];return Math.abs(i-v)<=ds.EPSILON*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(o-y)<=ds.EPSILON*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(c-b)<=ds.EPSILON*Math.max(1,Math.abs(c),Math.abs(b))&&Math.abs(u-x)<=ds.EPSILON*Math.max(1,Math.abs(u),Math.abs(x))&&Math.abs(h-C)<=ds.EPSILON*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(p-E)<=ds.EPSILON*Math.max(1,Math.abs(p),Math.abs(E))&&Math.abs(f-M)<=ds.EPSILON*Math.max(1,Math.abs(f),Math.abs(M))&&Math.abs(g-D)<=ds.EPSILON*Math.max(1,Math.abs(g),Math.abs(D))},Bi.sqrLen=Bi.squaredLength=Bi.len=Bi.length=Bi.dot=Bi.mul=Bi.setReal=Bi.getReal=void 0;var ds=Rw(wo),hc=Rw(ai),CA=Rw(mi);function SA(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(SA=function(o){return o?i:t})(e)}function Rw(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||kw(e)!=="object"&&typeof e!="function")return{default:e};var i=SA(t);if(i&&i.has(e))return i.get(e);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(u!=="default"&&Object.prototype.hasOwnProperty.call(e,u)){var h=c?Object.getOwnPropertyDescriptor(e,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=e[u]}return o.default=e,i&&i.set(e,o),o}function EA(e,t,i){var o=.5*i[0],c=.5*i[1],u=.5*i[2],h=t[0],p=t[1],f=t[2],g=t[3];return e[0]=h,e[1]=p,e[2]=f,e[3]=g,e[4]=o*g+c*f-u*p,e[5]=c*g+u*h-o*f,e[6]=u*g+o*p-c*h,e[7]=-o*h-c*p-u*f,e}function MA(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function DA(e,t,i){var o=t[0],c=t[1],u=t[2],h=t[3],p=i[4],f=i[5],g=i[6],v=i[7],y=t[4],b=t[5],x=t[6],C=t[7],E=i[0],M=i[1],D=i[2],A=i[3];return e[0]=o*A+h*E+c*D-u*M,e[1]=c*A+h*M+u*E-o*D,e[2]=u*A+h*D+o*M-c*E,e[3]=h*A-o*E-c*M-u*D,e[4]=o*v+h*p+c*g-u*f+y*A+C*E+b*D-x*M,e[5]=c*v+h*f+u*p-o*g+b*A+C*M+x*E-y*D,e[6]=u*v+h*g+o*f-c*p+x*A+C*D+y*M-b*E,e[7]=h*v-o*p-c*f-u*g+C*A-y*E-b*M-x*D,e}Bi.getReal=hc.copy,Bi.setReal=hc.copy,Bi.mul=DA;var TA=hc.dot;Bi.dot=TA;var IA=hc.length;Bi.length=IA,Bi.len=IA;var j_=hc.squaredLength;Bi.squaredLength=j_,Bi.sqrLen=j_;var yi={};function Pw(e){return Pw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pw(e)}Object.defineProperty(yi,"__esModule",{value:!0}),yi.create=kA,yi.clone=function(e){var t=new ou.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},yi.fromValues=function(e,t){var i=new ou.ARRAY_TYPE(2);return i[0]=e,i[1]=t,i},yi.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},yi.set=function(e,t,i){return e[0]=t,e[1]=i,e},yi.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e},yi.subtract=RA,yi.multiply=PA,yi.divide=OA,yi.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},yi.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},yi.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e},yi.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e},yi.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},yi.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e},yi.scaleAndAdd=function(e,t,i,o){return e[0]=t[0]+i[0]*o,e[1]=t[1]+i[1]*o,e},yi.distance=FA,yi.squaredDistance=LA,yi.length=zA,yi.squaredLength=NA,yi.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},yi.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},yi.normalize=function(e,t){var i=t[0],o=t[1],c=i*i+o*o;return c>0&&(c=1/Math.sqrt(c)),e[0]=t[0]*c,e[1]=t[1]*c,e},yi.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},yi.cross=function(e,t,i){var o=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=o,e},yi.lerp=function(e,t,i,o){var c=t[0],u=t[1];return e[0]=c+o*(i[0]-c),e[1]=u+o*(i[1]-u),e},yi.random=function(e,t){t=t||1;var i=2*ou.RANDOM()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e},yi.transformMat2=function(e,t,i){var o=t[0],c=t[1];return e[0]=i[0]*o+i[2]*c,e[1]=i[1]*o+i[3]*c,e},yi.transformMat2d=function(e,t,i){var o=t[0],c=t[1];return e[0]=i[0]*o+i[2]*c+i[4],e[1]=i[1]*o+i[3]*c+i[5],e},yi.transformMat3=function(e,t,i){var o=t[0],c=t[1];return e[0]=i[0]*o+i[3]*c+i[6],e[1]=i[1]*o+i[4]*c+i[7],e},yi.transformMat4=function(e,t,i){var o=t[0],c=t[1];return e[0]=i[0]*o+i[4]*c+i[12],e[1]=i[1]*o+i[5]*c+i[13],e},yi.rotate=function(e,t,i,o){var c=t[0]-i[0],u=t[1]-i[1],h=Math.sin(o),p=Math.cos(o);return e[0]=c*p-u*h+i[0],e[1]=c*h+u*p+i[1],e},yi.angle=function(e,t){var i=e[0],o=e[1],c=t[0],u=t[1],h=Math.sqrt(i*i+o*o)*Math.sqrt(c*c+u*u);return Math.acos(Math.min(Math.max(h&&(i*c+o*u)/h,-1),1))},yi.zero=function(e){return e[0]=0,e[1]=0,e},yi.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},yi.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},yi.equals=function(e,t){var i=e[0],o=e[1],c=t[0],u=t[1];return Math.abs(i-c)<=ou.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(o-u)<=ou.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))},yi.forEach=yi.sqrLen=yi.sqrDist=yi.dist=yi.div=yi.mul=yi.sub=yi.len=void 0;var ou=function(e,t){if(e&&e.__esModule)return e;if(e===null||Pw(e)!=="object"&&typeof e!="function")return{default:e};var i=AA(void 0);if(i&&i.has(e))return i.get(e);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(u!=="default"&&Object.prototype.hasOwnProperty.call(e,u)){var h=c?Object.getOwnPropertyDescriptor(e,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=e[u]}return o.default=e,i&&i.set(e,o),o}(wo);function AA(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(AA=function(o){return o?i:t})(e)}function kA(){var e=new ou.ARRAY_TYPE(2);return ou.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function RA(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function PA(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e}function OA(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e}function FA(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1])}function LA(e,t){var i=t[0]-e[0],o=t[1]-e[1];return i*i+o*o}function zA(e){return Math.hypot(e[0],e[1])}function NA(e){var t=e[0],i=e[1];return t*t+i*i}yi.len=zA,yi.sub=RA,yi.mul=PA,yi.div=OA,yi.dist=FA,yi.sqrDist=LA,yi.sqrLen=NA;var Z6=function(){var e=kA();return function(t,i,o,c,u,h){var p,f;for(i||(i=2),o||(o=0),f=c?Math.min(c*i+o,t.length):t.length,p=o;p<f;p+=i)e[0]=t[p],e[1]=t[p+1],u(e,e,h),t[p]=e[0],t[p+1]=e[1];return t}}();function Ow(e){return Ow=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ow(e)}yi.forEach=Z6,Object.defineProperty(xo,"__esModule",{value:!0});var hn=xo.vec4=J=xo.vec3=xo.vec2=xo.quat2=Vo=xo.quat=ft=xo.mat4=us=xo.mat3=xo.mat2d=_h=xo.mat2=xo.glMatrix=void 0,X6=Ml(wo);xo.glMatrix=X6;var K6=Ml(rr),_h=xo.mat2=K6,Q6=Ml(cr);xo.mat2d=Q6;var J6=Ml(Dn),us=xo.mat3=J6,tU=Ml(mi),ft=xo.mat4=tU,eU=Ml(ai),Vo=xo.quat=eU,iU=Ml(Bi);xo.quat2=iU;var nU=Ml(yi);xo.vec2=nU;var rU=Ml(ui),J=xo.vec3=rU,oU=Ml(Ti);function BA(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(BA=function(o){return o?i:t})(e)}function Ml(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||Ow(e)!=="object"&&typeof e!="function")return{default:e};var i=BA(t);if(i&&i.has(e))return i.get(e);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if(u!=="default"&&Object.prototype.hasOwnProperty.call(e,u)){var h=c?Object.getOwnPropertyDescriptor(e,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=e[u]}return o.default=e,i&&i.set(e,o),o}hn=xo.vec4=oU;let sU=Ji([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:U_}=sU,VA=Ji([{name:"a_pos_3",components:3,type:"Int16"}]);var Kc=Ji([{name:"a_pos",type:"Int16",components:2}]),jA={};(function(e,t){(function(i){function o(u,h,p){var f=c(256*u,256*(h=Math.pow(2,p)-h-1),p),g=c(256*(u+1),256*(h+1),p);return f[0]+","+f[1]+","+g[0]+","+g[1]}function c(u,h,p){var f=2*Math.PI*6378137/256/Math.pow(2,p);return[u*f-2*Math.PI*6378137/2,h*f-2*Math.PI*6378137/2]}i.getURL=function(u,h,p,f,g,v){return v=v||{},u+"?"+["bbox="+o(p,f,g),"format="+(v.format||"image/png"),"service="+(v.service||"WMS"),"version="+(v.version||"1.1.1"),"request="+(v.request||"GetMap"),"srs="+(v.srs||"EPSG:3857"),"width="+(v.width||256),"height="+(v.height||256),"layers="+h].join("&")},i.getTileBBox=o,i.getMercCoords=c,Object.defineProperty(i,"__esModule",{value:!0})})(t)})(0,jA);var aU=jA;class pa{constructor(t,i,o){this.z=t,this.x=i,this.y=o,this.key=Rp(0,t,t,i,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,i){let o=aU.getTileBBox(this.x,this.y,this.z),c=function(u,h,p){let f,g="";for(let v=u;v>0;v--)f=1<<v-1,g+=(h&f?1:0)+(p&f?2:0);return g}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Fw{constructor(t,i){this.wrap=t,this.canonical=i,this.key=Rp(t,i.z,i.z,i.x,i.y)}}class $i{constructor(t,i,o,c,u){this.overscaledZ=t,this.wrap=i,this.canonical=new pa(o,+c,+u),this.key=i===0&&t===o?this.canonical.key:Rp(i,t,o,c,u)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){let i=this.canonical.z-t;return t>this.canonical.z?new $i(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new $i(t,this.wrap,t,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(t,i=!0){if(this.overscaledZ===t&&i)return this.key;if(t>this.canonical.z)return Rp(this.wrap*+i,t,this.canonical.z,this.canonical.x,this.canonical.y);{let o=this.canonical.z-t;return Rp(this.wrap*+i,t,t,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;let i=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>i&&t.canonical.y===this.canonical.y>>i}children(t){if(this.overscaledZ>=t)return[new $i(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let i=this.canonical.z+1,o=2*this.canonical.x,c=2*this.canonical.y;return[new $i(i,this.wrap,i,o,c),new $i(i,this.wrap,i,o+1,c),new $i(i,this.wrap,i,o,c+1),new $i(i,this.wrap,i,o+1,c+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new $i(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new $i(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Fw(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Rp(e,t,i,o,c){let u=1<<Math.min(i,22),h=u*(c%u)+o%u;return e&&i<22&&(h+=u*u*((e<0?-2*e-1:2*e)%(1<<2*(22-i)))),16*(32*h+i)+(t-i)}let UA=[e=>{let t=e.canonical.x-1,i=e.wrap;return t<0&&(t=(1<<e.canonical.z)-1,i--),new $i(e.overscaledZ,i,e.canonical.z,t,e.canonical.y)},e=>{let t=e.canonical.x+1,i=e.wrap;return t===1<<e.canonical.z&&(t=0,i++),new $i(e.overscaledZ,i,e.canonical.z,t,e.canonical.y)},e=>new $i(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(e.canonical.y===0?1<<e.canonical.z:e.canonical.y)-1),e=>new $i(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)];Ce(pa,"CanonicalTileID"),Ce($i,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});class H_{constructor(t,i){this.pos=t,this.dir=i}intersectsPlane(t,i,o){let c=J.dot(i,this.dir);if(Math.abs(c)<1e-6)return!1;let u=((t[0]-this.pos[0])*i[0]+(t[1]-this.pos[1])*i[1]+(t[2]-this.pos[2])*i[2])/c;return o[0]=this.pos[0]+this.dir[0]*u,o[1]=this.pos[1]+this.dir[1]*u,o[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(t,i,o){if(J.equals(this.pos,t)||i===0)return o[0]=o[1]=o[2]=0,!1;let[c,u,h]=this.dir,p=this.pos[0]-t[0],f=this.pos[1]-t[1],g=this.pos[2]-t[2],v=c*c+u*u+h*h,y=2*(p*c+f*u+g*h),b=y*y-4*v*(p*p+f*f+g*g-i*i);if(b<0){let x=Math.max(-y/2,0),C=p+c*x,E=f+u*x,M=g+h*x,D=Math.hypot(C,E,M);return o[0]=C*i/D,o[1]=E*i/D,o[2]=M*i/D,!1}{let x=(-y-Math.sqrt(b))/(2*v);if(x<0){let C=Math.hypot(p,f,g);return o[0]=p*i/C,o[1]=f*i/C,o[2]=g*i/C,!1}return o[0]=p+c*x,o[1]=f+u*x,o[2]=g+h*x,!0}}}class Lw{constructor(t,i,o,c,u){this.TL=t,this.TR=i,this.BR=o,this.BL=c,this.horizon=u}static fromInvProjectionMatrix(t,i,o){let c=[-1,1,1],u=[1,1,1],h=[1,-1,1],p=[-1,-1,1],f=J.transformMat4(c,c,t),g=J.transformMat4(u,u,t),v=J.transformMat4(h,h,t),y=J.transformMat4(p,p,t);return new Lw(f,g,v,y,i/o)}}function Pp(e,t,i){let o=1/0,c=-1/0,u=[];for(let h of e){J.sub(u,h,t);let p=J.dot(u,i);o=Math.min(o,p),c=Math.max(c,p)}return[o,c]}function HA(e,t){let i=!0;for(let o=0;o<e.planes.length;o++){let c=e.planes[o],u=0;for(let h=0;h<t.length;h++)u+=J.dot(c,t[h])+c[3]>=0;if(u===0)return 0;u!==t.length&&(i=!1)}return i?2:1}function GA(e,t){for(let i of e.projections){let o=Pp(t,e.points[0],i.axis);if(i.projection[1]<o[0]||i.projection[0]>o[1])return 0}return 1}function qA(e,t){let i=0,o=[0,0,0,0];for(let c=0;c<e.length;c++)o[0]=e[c][0],o[1]=e[c][1],o[2]=e[c][2],o[3]=1,hn.dot(o,t)>=0&&i++;return i}class mc{constructor(t,i){this.points=t||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Vn.fromPoints(this.points),this.projections=[],this.frustumEdges=[J.sub([],this.points[2],this.points[3]),J.sub([],this.points[0],this.points[3]),J.sub([],this.points[4],this.points[0]),J.sub([],this.points[5],this.points[1]),J.sub([],this.points[6],this.points[2]),J.sub([],this.points[7],this.points[3])];for(let o of this.frustumEdges){let c=[0,-o[2],o[1]],u=[o[2],0,-o[0]];this.projections.push({axis:c,projection:Pp(this.points,this.points[0],c)}),this.projections.push({axis:u,projection:Pp(this.points,this.points[0],u)})}}static fromInvProjectionMatrix(t,i,o,c){let u=Math.pow(2,o),h=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(g=>{let v=hn.transformMat4([],g,t),y=1/v[3]/i*u;return hn.mul(v,v,[y,y,c?1/v[3]:y,y])}),p=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(g=>{let v=J.sub([],h[g[0]],h[g[1]]),y=J.sub([],h[g[2]],h[g[1]]),b=J.normalize([],J.cross([],v,y)),x=-J.dot(b,h[g[1]]);return b.concat(x)}),f=[];for(let g=0;g<h.length;g++)f.push([h[g][0],h[g][1],h[g][2]]);return new mc(f,p)}intersectsPrecise(t,i,o){for(let c=0;c<i.length;c++)if(!qA(t,i[c]))return 0;for(let c=0;c<this.planes.length;c++)if(!qA(t,this.planes[c]))return 0;for(let c of o)for(let u of this.frustumEdges){let h=J.cross([],c,u),p=J.length(h);if(p===0)continue;J.scale(h,h,1/p);let f=Pp(this.points,this.points[0],h),g=Pp(t,this.points[0],h);if(f[0]>g[1]||g[0]>f[1])return 0}return 1}}class Vn{static fromPoints(t){let i=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(let c of t)J.min(i,i,c),J.max(o,o,c);return new Vn(i,o)}static fromTileIdAndHeight(t,i,o){let c=1<<t.canonical.z,u=t.canonical.x,h=t.canonical.y;return new Vn([u/c,h/c,i],[(u+1)/c,(h+1)/c,o])}static applyTransform(t,i){let o=t.getCorners();for(let c=0;c<o.length;++c)J.transformMat4(o[c],o[c],i);return Vn.fromPoints(o)}static projectAabbCorners(t,i){let o=t.getCorners();for(let c=0;c<o.length;++c)J.transformMat4(o[c],o[c],i);return o}constructor(t,i){this.min=t,this.max=i,this.center=J.scale([],J.add([],this.min,this.max),.5)}quadrant(t){let i=[t%2==0,t<2],o=J.clone(this.min),c=J.clone(this.max);for(let u=0;u<i.length;u++)o[u]=i[u]?this.min[u]:this.center[u],c[u]=i[u]?this.center[u]:this.max[u];return c[2]=this.max[2],new Vn(o,c)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){let t=this.min,i=this.max;return[[t[0],t[1],t[2]],[i[0],t[1],t[2]],[i[0],i[1],t[2]],[t[0],i[1],t[2]],[t[0],t[1],i[2]],[i[0],t[1],i[2]],[i[0],i[1],i[2]],[t[0],i[1],i[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?HA(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?HA(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,i){return i||this.intersects(t)?GA(t,this.getCorners()):0}intersectsPreciseFlat(t,i){return i||this.intersectsFlat(t)?GA(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let i=0;i<3;++i)if(this.min[i]>t.max[i]||t.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],t.min[i]),this.max[i]=Math.max(this.max[i],t.max[i])}encapsulatePoint(t){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],t[i]),this.max[i]=Math.max(this.max[i],t[i])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}Ce(Vn,"Aabb");let Op=5,Qc=6,es=wt/Math.PI/2,lU=16383,vh=64,zw=[vh,32,16],fa=-es,ga=es,cU=[new Vn([fa,fa,fa],[ga,ga,ga]),new Vn([fa,fa,fa],[0,0,ga]),new Vn([0,fa,fa],[ga,0,ga]),new Vn([fa,0,fa],[0,ga,ga]),new Vn([0,0,fa],[ga,ga,ga])];function G_(e){return e*es/bh}function WA(e,t,i,o=!0){let c=J.scale([],e._camera.position,e.worldSize),u=[t,i,1,1];hn.transformMat4(u,u,e.pixelMatrixInverse),hn.scale(u,u,1/u[3]);let h=J.sub([],u,c),p=J.normalize([],h),f=e.globeMatrix,g=[f[12],f[13],f[14]],v=J.sub([],g,c),y=J.length(v),b=J.normalize([],v),x=e.worldSize/(2*Math.PI),C=J.dot(b,p),E=Math.asin(x/y);if(E<Math.acos(C)){if(!o)return null;let Y=[],Z=[];J.scale(Y,p,y/C),J.normalize(Z,J.sub(Z,Y,v)),J.normalize(p,J.add(p,v,J.scale(p,Z,Math.tan(E)*y)))}let M=[];new H_(c,p).closestPointOnSphere(g,x,M);let D=J.normalize([],gr(f,0)),A=J.normalize([],gr(f,1)),P=J.normalize([],gr(f,2)),O=J.dot(D,M),R=J.dot(A,M),F=J.dot(P,M),N=ei(Math.asin(-R/x)),j=ei(Math.atan2(O,F));j=e.center.lng+function(Y,Z){let tt=(Z-Y+180)%360-180;return tt<-180?tt+360:tt}(e.center.lng,j);let U=eo(j),G=ve(uo(N),0,1);return new Fi(U,G)}class dU{constructor(t,i,o){this.a=J.sub([],t,o),this.b=J.sub([],i,o),this.center=o;let c=J.normalize([],this.a),u=J.normalize([],this.b);this.angle=Math.acos(J.dot(c,u))}}function Nw(e,t){if(e.angle===0)return null;let i;return i=e.a[t]===0?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),i<0||i>1?null:function(o,c,u,h){let p=Math.sin(u);return o*(Math.sin((1-h)*u)/p)+c*(Math.sin(h*u)/p)}(e.a[t],e.b[t],e.angle,ve(i,0,1))+e.center[t]}function Zs(e){if(e.z<=1)return cU[e.z+2*e.y+e.x];let t=Vw(q_(e));return Vn.fromPoints(t)}function pc(e,t,i){return J.scale(e,e,1-i),J.scaleAndAdd(e,e,t,i)}function $A(e,t){let i=Co(t.zoom);if(i===0)return Zs(e);let o=q_(e),c=Vw(o),u=eo(o.getWest())*t.worldSize,h=eo(o.getEast())*t.worldSize,p=uo(o.getNorth())*t.worldSize,f=uo(o.getSouth())*t.worldSize,g=[u,p,0],v=[h,p,0],y=[u,f,0],b=[h,f,0],x=ft.invert([],t.globeMatrix);return J.transformMat4(g,g,x),J.transformMat4(v,v,x),J.transformMat4(y,y,x),J.transformMat4(b,b,x),c[0]=pc(c[0],y,i),c[1]=pc(c[1],b,i),c[2]=pc(c[2],v,i),c[3]=pc(c[3],g,i),Vn.fromPoints(c)}function YA(e,t,i){for(let o of e)J.transformMat4(o,o,t),J.scale(o,o,i)}function Bw(e,t,i,o){let c=t/e.worldSize,u=e.globeMatrix;if(i.z<=1){let U=Zs(i).getCorners();return YA(U,u,c),Vn.fromPoints(U)}let h=q_(i,o),p=Vw(h);YA(p,u,c);let f=Number.MAX_VALUE,g=[-f,-f,-f],v=[f,f,f];if(h.contains(e.center)){for(let Y of p)J.min(v,v,Y),J.max(g,g,Y);g[2]=0;let U=e.point,G=[U.x*c,U.y*c,0];return J.min(v,v,G),J.max(g,g,G),new Vn(v,g)}let y=[u[12]*c,u[13]*c,u[14]*c],b=h.getCenter(),x=ve(e.center.lat,-Ir,Ir),C=ve(b.lat,-Ir,Ir),E=eo(e.center.lng),M=uo(x),D=E-eo(b.lng),A=M-uo(C);D>.5?D-=1:D<-.5&&(D+=1);let P=0;if(Math.abs(D)>Math.abs(A))P=D>=0?1:3;else{P=A>=0?0:2;let U=[u[4]*c,u[5]*c,u[6]*c],G=-Math.sin(fe(A>=0?h.getSouth():h.getNorth()))*es;J.scaleAndAdd(y,y,U,G)}let O=p[P],R=p[(P+1)%4],F=new dU(O,R,y),N=[Nw(F,0)||O[0],Nw(F,1)||O[1],Nw(F,2)||O[2]],j=Co(e.zoom);if(j>0){let U=function({x:Y,y:Z,z:tt},$,rt,st,pt){let nt=1/(1<<tt),ot=Y*nt,vt=ot+nt,bt=Z*nt,yt=bt+nt,Ct=0,Et=(ot+vt)/2-st;return Et>.5?Ct=-1:Et<-.5&&(Ct=1),ot=((ot+Ct)*$-(st*=$))*rt+st,vt=((vt+Ct)*$-st)*rt+st,bt=(bt*$-(pt*=$))*rt+pt,yt=(yt*$-pt)*rt+pt,[[ot,yt,0],[vt,yt,0],[vt,bt,0],[ot,bt,0]]}(i,t,e._pixelsPerMercatorPixel,E,M);for(let Y=0;Y<p.length;Y++)pc(p[Y],U[Y],j);let G=J.add([],U[P],U[(P+1)%4]);J.scale(G,G,.5),pc(N,G,j)}for(let U of p)J.min(v,v,U),J.max(g,g,U);return v[2]=Math.min(O[2],R[2]),J.min(v,v,N),J.max(g,g,N),new Vn(v,g)}function q_({x:e,y:t,z:i},o=!1){let c=1/(1<<i),u=new Ze(Ms(e*c),t===(1<<i)-1&&o?-90:Wr((t+1)*c)),h=new Ze(Ms((e+1)*c),t===0&&o?90:Wr(t*c));return new Es(u,h)}function Vw(e){let t=fe(e.getNorth()),i=fe(e.getSouth()),o=Math.cos(t),c=Math.cos(i),u=Math.sin(t),h=Math.sin(i),p=e.getWest(),f=e.getEast();return[yh(c,h,p),yh(c,h,f),yh(o,u,f),yh(o,u,p)]}function yh(e,t,i,o=es){return i=fe(i),[e*Math.sin(i)*o,-t*o,e*Math.cos(i)*o]}function hs(e,t,i){return yh(Math.cos(fe(e)),Math.sin(fe(e)),t,i)}function Fp(e,t,i,o){let c=1<<i.z,u=(e/wt+i.x)/c;return hs(Wr((t/wt+i.y)/c),Ms(u),o)}function W_({min:e,max:t}){return lU/Math.max(t[0]-e[0],t[1]-e[1],t[2]-e[2])}let ZA=new Float64Array(16);function Jc(e){let t=W_(e),i=ft.fromScaling(ZA,[t,t,t]);return ft.translate(i,i,J.negate([],e.min))}function jw(e){let t=ft.fromTranslation(ZA,e.min),i=1/W_(e);return ft.scale(t,t,[i,i,i])}function Uw(e){let t=wt/(2*Math.PI);return e/(2*Math.PI)/t}function XA(e,t){return wt/(512*Math.pow(2,e))*W_(Zs(t))}function KA(e,t,i,o,c){let u=Uw(i),h=[e,t,-i/(2*Math.PI)],p=ft.identity(new Float64Array(16));return ft.translate(p,p,h),ft.scale(p,p,[u,u,u]),ft.rotateX(p,p,fe(-c)),ft.rotateY(p,p,fe(-o)),p}function QA(e){let t=e.pixelsPerMeter,i=t/yn(1,e.center.lat),o=ft.identity(new Float64Array(16));return ft.translate(o,o,[e.point.x,e.point.y,0]),ft.scale(o,o,[i,i,t]),Float32Array.from(o)}function Co(e){return Wo(Op,Qc,e)}function JA(e,t,i){let o=ft.identity(new Float64Array(16)),c=(t/(1<<e)-.5)*Math.PI*2;return ft.rotateY(o,i.globeMatrix,c),Float32Array.from(o)}function tk(e,t,i){let o=Co(i.zoom),c=e.style.map._antialias,u=t.options.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return o===0&&!c&&!u}function ek(e,t,i,o){let c=t.getNorth(),u=t.getSouth(),h=t.getWest(),p=t.getEast(),f=1<<e.z,g=p-h,v=c-u,y=g/vh,b=-v/zw[i],x=[0,y,0,b,0,0,c,h,0];if(e.z>0){let C=180/o;us.multiply(x,x,[C/g+1,0,0,0,C/v+1,0,-.5*C/y,.5*C/b,1])}return x[2]=f,x[5]=e.x,x[8]=e.y,x}function uU(e){let t=Ir-5;e=ve(e,-t,t)/t*90;let i=Math.pow(Math.abs(Math.sin(fe(e))),3);return Math.round(i*(zw.length-1))}function ik(e){let t=[0,0,0],i=ft.identity(new Float64Array(16));return ft.multiply(i,e.pixelMatrix,e.globeMatrix),J.transformMat4(t,t,i),new Q(t[0],t[1])}function nk(e,t){let i=hs(t.lat,t.lng),o=function(u){let h=hs(u._center.lat,u._center.lng),p=J.fromValues(0,1,0),f=J.cross([],p,h),g=ft.fromRotation([],-u.angle,h);f=J.transformMat4(f,f,g),ft.fromRotation(g,-u._pitch,f);let v=J.normalize([],h);return J.scale(v,v,G_(u.cameraToCenterDistance/u.pixelsPerMeter)),J.transformMat4(v,v,g),J.add([],h,v)}(e),c=J.subtract([],o,i);return J.angle(c,i)}function $_(e,t){return nk(e,t)>Math.PI/2*1.01}let rk=fe(85),hU=Math.cos(rk),mU=Math.sin(rk);class pU{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let t of this._poleSegments)t.destroy();for(let t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,i){let o=new Cs,c=new qr,u=[],h=t+1+2,p=i[0]+1,f=i[0]+1+(1+i.length),g=(v,y,b)=>{let x=v===h-1?v-2:v===0?v:v-1;return x+=b?24575:0,[x,y]};for(let v=0;v<h;++v)o.emplaceBack(...g(v,0,!0));for(let v=0;v<p;++v)for(let y=0;y<h;++y)o.emplaceBack(...g(y,v,(y===0||y===h-1)&&!0));for(let v=0;v<i.length;++v){let y=i[v];for(let b=0;b<h;++b)o.emplaceBack(...g(b,y,!0))}for(let v=0;v<i.length;++v){let y=c.length,b=i[v]+1+2,x=new qr;for(let M=0;M<b-1;M++){let D=M===b-2,A=D?h*(f-i.length+v-M):h;for(let P=0;P<h-1;P++){let O=M*h+P;M===0||D||P===0||P===h-2?(x.emplaceBack(O+1,O,O+A),x.emplaceBack(O+A,O+A+1,O+1)):(c.emplaceBack(O+1,O,O+A),c.emplaceBack(O+A,O+A+1,O+1))}}let C=un.simpleSegment(0,y,o.length,c.length-y);for(let M=0;M<x.uint16.length;M+=3)c.emplaceBack(x.uint16[M],x.uint16[M+1],x.uint16[M+2]);let E=un.simpleSegment(0,y,o.length,c.length-y);u.push({withoutSkirts:C,withSkirts:E})}return{vertices:o,indices:c,segments:u}}_createGrid(t){let i=this._fillGridMeshWithLods(vh,zw);this._gridSegments=i.segments,this._gridBuffer=t.createVertexBuffer(i.vertices,Kc.members),this._gridIndexBuffer=t.createIndexBuffer(i.indices,!0)}_createPoles(t){let i=new qr;for(let p=0;p<=vh;p++)i.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=t.createIndexBuffer(i,!0);let o=new eu,c=new eu,u=new eu,h=new eu;this._poleSegments=[];for(let p=0,f=0;p<Op;p++){let g=360/(1<<p);o.emplaceBack(0,-es,0,.5,0),c.emplaceBack(0,-es,0,.5,1),u.emplaceBack(0,-es,0,.5,.5),h.emplaceBack(0,-es,0,.5,.5);for(let v=0;v<=vh;v++){let y=v/vh,b=0,x=Ye(0,g,y),[C,E,M]=yh(hU,mU,x,es);o.emplaceBack(C,E,M,y,b),c.emplaceBack(C,E,M,y,1-b);let D=fe(x);y=.5+.5*Math.sin(D),b=.5+.5*Math.cos(D),u.emplaceBack(C,E,M,y,b),h.emplaceBack(C,E,M,y,1-b)}this._poleSegments.push(un.simpleSegment(f,0,66,64)),f+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(o,U_,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(c,U_,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(u,U_,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(h,U_,!1)}getGridBuffers(t,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,i){return[i?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,i?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}}let bh=63710088e-1,Hw=2*Math.PI*bh;class td{constructor(t,i){if(isNaN(t)||isNaN(i))throw new Error(`Invalid LngLat object: (${t}, ${i})`);if(this.lng=+t,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new td(ss(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){let i=Math.PI/180,o=this.lat*i,c=t.lat*i,u=Math.sin(o)*Math.sin(c)+Math.cos(o)*Math.cos(c)*Math.cos((t.lng-this.lng)*i);return bh*Math.acos(Math.min(u,1))}toBounds(t=0){let i=360*t/40075017,o=i/Math.cos(Math.PI/180*this.lat);return new Es(new td(this.lng-o,this.lat-i),new td(this.lng+o,this.lat+i))}toEcef(t){let i=G_(t);return hs(this.lat,this.lng,es+i)}static convert(t){if(t instanceof td)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new td(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new td(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Ze=td;let fU=0,gU=25.5;function Y_(e){return Hw*Math.cos(e*Math.PI/180)}function eo(e){return(180+e)/360}function uo(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function yn(e,t){return e/Y_(t)}function Ms(e){return 360*e-180}function Wr(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function ok(e,t){return e*Y_(Wr(t))}let Ir=85.051129;function sk(e){return Math.cos(fe(ve(e,-Ir,Ir)))}function ed(e,t){let i=ve(t,fU,gU),o=Math.pow(2,i);return sk(e)*Hw/(512*o)}function Gw(e){return 1/Math.cos(e*Math.PI/180)}function Lp(e,t=0){let i=Math.exp(Math.PI*(1-(e.y+t/wt)/(1<<e.z)*2));return 80150034*i/(i*i+1)/wt/(1<<e.z)}class Fi{constructor(t,i,o=0){this.x=+t,this.y=+i,this.z=+o}static fromLngLat(t,i=0){let o=Ze.convert(t);return new Fi(eo(o.lng),uo(o.lat),yn(i,o.lat))}toLngLat(){return new Ze(Ms(this.x),Wr(this.y))}toAltitude(){return ok(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Hw*Gw(Wr(this.y))}}function qw(e,t,i,o,c,u,h,p,f){let g=(t+o)/2,v=(i+c)/2,y=new Q(g,v);p(y),function(b,x,C,E,M,D){let A=C-M,P=E-D;return Math.abs((E-x)*A-(C-b)*P)/Math.hypot(A,P)}(y.x,y.y,u.x,u.y,h.x,h.y)>=f?(qw(e,t,i,g,v,u,y,p,f),qw(e,g,v,o,c,y,h,p,f)):e.push(h)}function ak(e,t,i){let o=e[0],c=o.x,u=o.y;t(o);let h=[o];for(let p=1;p<e.length;p++){let f=e[p],{x:g,y:v}=f;t(f),qw(h,c,u,g,v,o,f,t,i),c=g,u=v,o=f}return h}function Ww(e,t,i,o){if(o(t,i)){let c=t.add(i)._mult(.5);Ww(e,t,c,o),Ww(e,c,i,o)}else e.push(i)}function _U(e,t){let i=e[0],o=[i];for(let c=1;c<e.length;c++){let u=e[c];Ww(o,i,u,t),i=u}return o}let $w=Math.pow(2,14)-1,lk=-$w-1;function vU(e,t){let i=Math.round(e.x*t),o=Math.round(e.y*t);return e.x=ve(i,lk,$w),e.y=ve(o,lk,$w),(i<e.x||i>e.x+1||o<e.y||o>e.y+1)&&lt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function Dl(e,t,i){let o=e.loadGeometry(),c=e.extent,u=wt/c;if(t&&i&&i.projection.isReprojectedInTileSpace){let h=1<<t.z,{scale:p,x:f,y:g,projection:v}=i,y=b=>{let x=Ms((t.x+b.x/c)/h),C=Wr((t.y+b.y/c)/h),E=v.project(x,C);b.x=(E.x*p-f)*c,b.y=(E.y*p-g)*c};for(let b=0;b<o.length;b++)if(e.type!==1)o[b]=ak(o[b],y,1);else{let x=[];for(let C of o[b])C.x<0||C.x>=c||C.y<0||C.y>=c||(y(C),x.push(C));o[b]=x}}for(let h of o)for(let p of h)vU(p,u);return o}function id(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Dl(e):[]}}function Z_(e,t,i,o,c){e.emplaceBack(2*t+(o+1)/2,2*i+(c+1)/2)}function X_(e,t,i){e.emplaceBack(t.x,t.y,t.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Yw{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new Cs,this.indexArray=new qr,this.segments=new un,this.programConfigurations=new Zc(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,o,c){let u=this.layers[0],h=[],p=null;u.type==="circle"&&(p=u.layout.get("circle-sort-key"));for(let{feature:g,id:v,index:y,sourceLayerIndex:b}of t){let x=this.layers[0]._featureFilter.needGeometry,C=id(g,x);if(!this.layers[0]._featureFilter.filter(new ir(this.zoom),C,o))continue;let E=p?p.evaluate(C,{},o):void 0,M={id:v,properties:g.properties,type:g.type,sourceLayerIndex:b,index:y,geometry:x?C.geometry:Dl(g,o,c),patterns:{},sortKey:E};h.push(M)}p&&h.sort((g,v)=>g.sortKey-v.sortKey);let f=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new O_,f=c.projection);for(let g of h){let{geometry:v,index:y,sourceLayerIndex:b}=g,x=t[y].feature;this.addFeature(g,v,y,i.availableImages,o,f,i.brightness),i.featureIndex.insert(x,v,y,b,this.index)}}update(t,i,o,c,u){let h=Object.keys(t).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,i,h?this.stateDependentLayers:this.layers,o,c,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,T6.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,I6.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,i,o,c,u,h,p){for(let f of i)for(let g of f){let v=g.x,y=g.y;if(v<0||v>=wt||y<0||y>=wt)continue;if(h){let C=h.projectTilePoint(v,y,u),E=h.upVector(u,v,y),M=this.globeExtVertexArray;X_(M,C,E),X_(M,C,E),X_(M,C,E),X_(M,C,E)}let b=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),x=b.vertexLength;Z_(this.layoutVertexArray,v,y,-1,-1),Z_(this.layoutVertexArray,v,y,1,-1),Z_(this.layoutVertexArray,v,y,1,1),Z_(this.layoutVertexArray,v,y,-1,1),this.indexArray.emplaceBack(x,x+1,x+2),this.indexArray.emplaceBack(x,x+2,x+3),b.vertexLength+=4,b.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{},c,u,p)}}function ck(e,t){for(let i=0;i<e.length;i++)if(nd(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(nd(e,t[i]))return!0;return!!Zw(e,t)}function yU(e,t,i){return!!nd(e,t)||!!Xw(t,e,i)}function dk(e,t){if(e.length===1)return hk(t,e[0]);for(let i=0;i<t.length;i++){let o=t[i];for(let c=0;c<o.length;c++)if(nd(e,o[c]))return!0}for(let i=0;i<e.length;i++)if(hk(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(Zw(e,t[i]))return!0;return!1}function bU(e,t,i){if(e.length>1){if(Zw(e,t))return!0;for(let o=0;o<t.length;o++)if(Xw(t[o],e,i))return!0}for(let o=0;o<e.length;o++)if(Xw(e[o],t,i))return!0;return!1}function Zw(e,t){if(e.length===0||t.length===0)return!1;for(let i=0;i<e.length-1;i++){let o=e[i],c=e[i+1];for(let u=0;u<t.length-1;u++)if(xU(o,c,t[u],t[u+1]))return!0}return!1}function xU(e,t,i,o){return zt(e,i,o)!==zt(t,i,o)&&zt(e,t,i)!==zt(e,t,o)}function Xw(e,t,i){let o=i*i;if(t.length===1)return e.distSqr(t[0])<o;for(let c=1;c<t.length;c++)if(uk(e,t[c-1],t[c])<o)return!0;return!1}function uk(e,t,i){let o=t.distSqr(i);if(o===0)return e.distSqr(t);let c=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/o;return e.distSqr(c<0?t:c>1?i:i.sub(t)._mult(c)._add(t))}function hk(e,t){let i,o,c,u=!1;for(let h=0;h<e.length;h++){i=e[h];for(let p=0,f=i.length-1;p<i.length;f=p++)o=i[p],c=i[f],o.y>t.y!=c.y>t.y&&t.x<(c.x-o.x)*(t.y-o.y)/(c.y-o.y)+o.x&&(u=!u)}return u}function nd(e,t){let i=!1;for(let o=0,c=e.length-1;o<e.length;c=o++){let u=e[o],h=e[c];u.y>t.y!=h.y>t.y&&t.x<(h.x-u.x)*(t.y-u.y)/(h.y-u.y)+u.x&&(i=!i)}return i}function mk(e,t,i,o,c){for(let h of e)if(t<=h.x&&i<=h.y&&o>=h.x&&c>=h.y)return!0;let u=[new Q(t,i),new Q(t,c),new Q(o,c),new Q(o,i)];if(e.length>2){for(let h of u)if(nd(e,h))return!0}for(let h=0;h<e.length-1;h++)if(wU(e[h],e[h+1],u))return!0;return!1}function wU(e,t,i){let o=i[0],c=i[2];if(e.x<o.x&&t.x<o.x||e.x>c.x&&t.x>c.x||e.y<o.y&&t.y<o.y||e.y>c.y&&t.y>c.y)return!1;let u=zt(e,t,i[0]);return u!==zt(e,t,i[1])||u!==zt(e,t,i[2])||u!==zt(e,t,i[3])}function xh(e,t,i,o,c,u){let h=t.y-e.y,p=e.x-t.x;if(u=u||0){let f=h*h+p*p;if(f===0)return!0;let g=Math.sqrt(f);h/=g,p/=g}return!((i.x-e.x)*h+(i.y-e.y)*p-u<0||(o.x-e.x)*h+(o.y-e.y)*p-u<0||(c.x-e.x)*h+(c.y-e.y)*p-u<0)}function Kw(e,t,i,o,c,u,h){return!(xh(e,t,o,c,u,h)||xh(t,i,o,c,u,h)||xh(i,e,o,c,u,h)||xh(o,c,e,t,i,h)||xh(c,u,e,t,i,h)||xh(u,o,e,t,i,h))}function wh(e,t,i){let o=t.paint.get(e).value;return o.kind==="constant"?o.value:i.programConfigurations.get(t.id).getMaxValue(e)}function K_(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function pk(e,t,i,o,c){if(!t[0]&&!t[1])return e;let u=Q.convert(t)._mult(c);i==="viewport"&&u._rotate(-o);let h=[];for(let p=0;p<e.length;p++)h.push(e[p].sub(u));return h}function fk(e,t,i,o){let c=Q.convert(e)._mult(o);return t==="viewport"&&c._rotate(-i),c}Ce(Yw,"CircleBucket",{omit:["layers"]});let CU=new yr({"circle-sort-key":new Re(_t.layout_circle["circle-sort-key"]),visibility:new Ut(_t.layout_circle.visibility)});var SU={paint:new yr({"circle-radius":new Re(_t.paint_circle["circle-radius"]),"circle-color":new Re(_t.paint_circle["circle-color"]),"circle-blur":new Re(_t.paint_circle["circle-blur"]),"circle-opacity":new Re(_t.paint_circle["circle-opacity"]),"circle-translate":new Ut(_t.paint_circle["circle-translate"]),"circle-translate-anchor":new Ut(_t.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ut(_t.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ut(_t.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Re(_t.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Re(_t.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Re(_t.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Ut(_t.paint_circle["circle-emissive-strength"])}),layout:CU};let EU=ft.create(),MU=(e,t,i,o,c,u)=>{let h=e.transform,p=h.projection.name==="globe",f;if(u.paint.get("circle-pitch-alignment")==="map")if(p){let v=XA(h.zoom,t.canonical)*h._pixelsPerMercatorPixel;f=Float32Array.from([v,0,0,v])}else f=h.calculatePixelsToTileUnitsMatrix(i);else f=new Float32Array([h.pixelsToGLUnits[0],0,0,h.pixelsToGLUnits[1]]);let g={u_camera_to_center_distance:e.transform.getCameraToCenterDistance(h.projection),u_matrix:e.translatePosMatrix(t.projMatrix,i,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ii.devicePixelRatio,u_extrude_scale:f,u_inv_rot_matrix:EU,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:u.paint.get("circle-emissive-strength")};if(p){g.u_inv_rot_matrix=o,g.u_merc_center=c,g.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],g.u_zoom_transition=Co(h.zoom);let v=c[0]*wt,y=c[1]*wt;g.u_up_dir=h.projection.upVector(new pa(0,0,0),v,y)}return g},gk=e=>{let t=[];return e.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),e.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t};function _k(e,t,i,o,c,u,h,p,f){if(u&&e.queryGeometry.isAboveHorizon)return!1;u&&(f*=e.pixelToTileUnitsFactor);let g=e.tileID.canonical,v=i.projection.upVectorScale(g,i.center.lat,i.worldSize).metersToTile;for(let y of t)for(let b of y){let x=b.add(p),C=c&&i.elevation?i.elevation.exaggeration()*c.getElevationAt(x.x,x.y,!0):0,E=i.projection.projectTilePoint(x.x,x.y,g);if(C>0){let P=i.projection.upVector(g,x.x,x.y);E.x+=P[0]*v*C,E.y+=P[1]*v*C,E.z+=P[2]*v*C}let M=u?x:DU(E.x,E.y,E.z,o),D=u?e.tilespaceRays.map(P=>IU(P,C)):e.queryGeometry.screenGeometry,A=hn.transformMat4([],[E.x,E.y,E.z,1],o);if(!h&&u?f*=A[3]/i.cameraToCenterDistance:h&&!u&&(f*=i.cameraToCenterDistance/A[3]),u){let P=Wr((b.y/wt+g.y)/(1<<g.z));f/=i.projection.pixelsPerMeter(P,1)/yn(1,P)}if(yU(D,M,f))return!0}return!1}function DU(e,t,i,o){let c=hn.transformMat4([],[e,t,i,1],o);return new Q(c[0]/c[3],c[1]/c[3])}let vk=J.fromValues(0,0,0),TU=J.fromValues(0,0,1);function IU(e,t){let i=J.create();return vk[2]=t,e.intersectsPlane(vk,TU,i),new Q(i[0],i[1])}class yk extends Yw{}function bk(e,{width:t,height:i},o,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==t*i*o)throw new RangeError("mismatched image size")}else c=new Uint8Array(t*i*o);return e.width=t,e.height=i,e.data=c,e}function xk(e,t,i){let{width:o,height:c}=t;o===e.width&&c===e.height||(Qw(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,o),height:Math.min(e.height,c)},i),e.width=o,e.height=c,e.data=t.data)}function Qw(e,t,i,o,c,u){if(c.width===0||c.height===0)return t;if(c.width>e.width||c.height>e.height||i.x>e.width-c.width||i.y>e.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>t.width||c.height>t.height||o.x>t.width-c.width||o.y>t.height-c.height)throw new RangeError("out of range destination coordinates for image copy");let h=e.data,p=t.data;for(let f=0;f<c.height;f++){let g=((i.y+f)*e.width+i.x)*u,v=((o.y+f)*t.width+o.x)*u;for(let y=0;y<c.width*u;y++)p[v+y]=h[g+y]}return t}Ce(yk,"HeatmapBucket",{omit:["layers"]});class fc{constructor(t,i){bk(this,t,1,i)}resize(t){xk(this,new fc(t),1)}clone(){return new fc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,o,c,u){Qw(t,i,o,c,u,1)}}class Br{constructor(t,i){bk(this,t,4,i)}resize(t){xk(this,new Br(t),4)}replace(t,i){i?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Br({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,o,c,u){Qw(t,i,o,c,u,4)}}class wk{constructor(t,i){this.width=t.width,this.height=t.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}Ce(fc,"AlphaImage"),Ce(Br,"RGBAImage");let AU=new yr({visibility:new Ut(_t.layout_heatmap.visibility)});var kU={paint:new yr({"heatmap-radius":new Re(_t.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Re(_t.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ut(_t.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Mp(_t.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ut(_t.paint_heatmap["heatmap-opacity"])}),layout:AU};function Q_(e){let t={},i=e.resolution||256,o=e.clips?e.clips.length:1,c=e.image||new Br({width:i,height:o}),u=(h,p,f)=>{t[e.evaluationKey]=f;let g=e.expression.evaluate(t);g&&(c.data[h+p+0]=Math.floor(255*g.r/g.a),c.data[h+p+1]=Math.floor(255*g.g/g.a),c.data[h+p+2]=Math.floor(255*g.b/g.a),c.data[h+p+3]=Math.floor(255*g.a))};if(e.clips)for(let h=0,p=0;h<o;++h,p+=4*i)for(let f=0,g=0;f<i;f++,g+=4){let v=f/(i-1),{start:y,end:b}=e.clips[h];u(p,g,y*(1-v)+b*v)}else for(let h=0,p=0;h<i;h++,p+=4)u(0,p,h/(i-1));return c}let RU=new yr({visibility:new Ut(_t.layout_hillshade.visibility)});var PU={paint:new yr({"hillshade-illumination-direction":new Ut(_t.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ut(_t.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ut(_t.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ut(_t.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ut(_t.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ut(_t.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Ut(_t.paint_hillshade["hillshade-emissive-strength"])}),layout:RU};let OU=Ji([{name:"a_pos",components:2,type:"Int16"}],4),{members:FU}=OU;var Jw={exports:{}};function J_(e,t,i){i=i||2;var o,c,u,h,p,f,g,v=t&&t.length,y=v?t[0]*i:e.length,b=Ck(e,0,y,i,!0),x=[];if(!b||b.next===b.prev)return x;if(v&&(b=function(E,M,D,A){var P,O,R,F=[];for(P=0,O=M.length;P<O;P++)(R=Ck(E,M[P]*A,P<O-1?M[P+1]*A:E.length,A,!1))===R.next&&(R.steiner=!0),F.push(HU(R));for(F.sort(VU),P=0;P<F.length;P++)D=jU(F[P],D);return D}(e,t,b,i)),e.length>80*i){o=u=e[0],c=h=e[1];for(var C=i;C<y;C+=i)(p=e[C])<o&&(o=p),(f=e[C+1])<c&&(c=f),p>u&&(u=p),f>h&&(h=f);g=(g=Math.max(u-o,h-c))!==0?32767/g:0}return zp(b,x,i,o,c,g,0),x}function Ck(e,t,i,o,c){var u,h;if(c===iC(e,t,i,o)>0)for(u=t;u<i;u+=o)h=Mk(u,e[u],e[u+1],h);else for(u=i-o;u>=t;u-=o)h=Mk(u,e[u],e[u+1],h);return h&&t0(h,h.next)&&(Bp(h),h=h.next),h}function su(e,t){if(!e)return e;t||(t=e);var i,o=e;do if(i=!1,o.steiner||!t0(o,o.next)&&io(o.prev,o,o.next)!==0)o=o.next;else{if(Bp(o),(o=t=o.prev)===o.next)break;i=!0}while(i||o!==t);return t}function zp(e,t,i,o,c,u,h){if(e){!h&&u&&function(v,y,b,x){var C=v;do C.z===0&&(C.z=tC(C.x,C.y,y,b,x)),C.prevZ=C.prev,C.nextZ=C.next,C=C.next;while(C!==v);C.prevZ.nextZ=null,C.prevZ=null,function(E){var M,D,A,P,O,R,F,N,j=1;do{for(D=E,E=null,O=null,R=0;D;){for(R++,A=D,F=0,M=0;M<j&&(F++,A=A.nextZ);M++);for(N=j;F>0||N>0&&A;)F!==0&&(N===0||!A||D.z<=A.z)?(P=D,D=D.nextZ,F--):(P=A,A=A.nextZ,N--),O?O.nextZ=P:E=P,P.prevZ=O,O=P;D=A}O.nextZ=null,j*=2}while(R>1)}(C)}(e,o,c,u);for(var p,f,g=e;e.prev!==e.next;)if(p=e.prev,f=e.next,u?zU(e,o,c,u):LU(e))t.push(p.i/i|0),t.push(e.i/i|0),t.push(f.i/i|0),Bp(e),e=f.next,g=f.next;else if((e=f)===g){h?h===1?zp(e=NU(su(e),t,i),t,i,o,c,u,2):h===2&&BU(e,t,i,o,c,u):zp(su(e),t,i,o,c,u,1);break}}}function LU(e){var t=e.prev,i=e,o=e.next;if(io(t,i,o)>=0)return!1;for(var c=t.x,u=i.x,h=o.x,p=t.y,f=i.y,g=o.y,v=c<u?c<h?c:h:u<h?u:h,y=p<f?p<g?p:g:f<g?f:g,b=c>u?c>h?c:h:u>h?u:h,x=p>f?p>g?p:g:f>g?f:g,C=o.next;C!==t;){if(C.x>=v&&C.x<=b&&C.y>=y&&C.y<=x&&Ch(c,p,u,f,h,g,C.x,C.y)&&io(C.prev,C,C.next)>=0)return!1;C=C.next}return!0}function zU(e,t,i,o){var c=e.prev,u=e,h=e.next;if(io(c,u,h)>=0)return!1;for(var p=c.x,f=u.x,g=h.x,v=c.y,y=u.y,b=h.y,x=p<f?p<g?p:g:f<g?f:g,C=v<y?v<b?v:b:y<b?y:b,E=p>f?p>g?p:g:f>g?f:g,M=v>y?v>b?v:b:y>b?y:b,D=tC(x,C,t,i,o),A=tC(E,M,t,i,o),P=e.prevZ,O=e.nextZ;P&&P.z>=D&&O&&O.z<=A;){if(P.x>=x&&P.x<=E&&P.y>=C&&P.y<=M&&P!==c&&P!==h&&Ch(p,v,f,y,g,b,P.x,P.y)&&io(P.prev,P,P.next)>=0||(P=P.prevZ,O.x>=x&&O.x<=E&&O.y>=C&&O.y<=M&&O!==c&&O!==h&&Ch(p,v,f,y,g,b,O.x,O.y)&&io(O.prev,O,O.next)>=0))return!1;O=O.nextZ}for(;P&&P.z>=D;){if(P.x>=x&&P.x<=E&&P.y>=C&&P.y<=M&&P!==c&&P!==h&&Ch(p,v,f,y,g,b,P.x,P.y)&&io(P.prev,P,P.next)>=0)return!1;P=P.prevZ}for(;O&&O.z<=A;){if(O.x>=x&&O.x<=E&&O.y>=C&&O.y<=M&&O!==c&&O!==h&&Ch(p,v,f,y,g,b,O.x,O.y)&&io(O.prev,O,O.next)>=0)return!1;O=O.nextZ}return!0}function NU(e,t,i){var o=e;do{var c=o.prev,u=o.next.next;!t0(c,u)&&Sk(c,o,o.next,u)&&Np(c,u)&&Np(u,c)&&(t.push(c.i/i|0),t.push(o.i/i|0),t.push(u.i/i|0),Bp(o),Bp(o.next),o=e=u),o=o.next}while(o!==e);return su(o)}function BU(e,t,i,o,c,u){var h=e;do{for(var p=h.next.next;p!==h.prev;){if(h.i!==p.i&&GU(h,p)){var f=Ek(h,p);return h=su(h,h.next),f=su(f,f.next),zp(h,t,i,o,c,u,0),void zp(f,t,i,o,c,u,0)}p=p.next}h=h.next}while(h!==e)}function VU(e,t){return e.x-t.x}function jU(e,t){var i=function(c,u){var h,p=u,f=c.x,g=c.y,v=-1/0;do{if(g<=p.y&&g>=p.next.y&&p.next.y!==p.y){var y=p.x+(g-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(y<=f&&y>v&&(v=y,h=p.x<p.next.x?p:p.next,y===f))return h}p=p.next}while(p!==u);if(!h)return null;var b,x=h,C=h.x,E=h.y,M=1/0;p=h;do f>=p.x&&p.x>=C&&f!==p.x&&Ch(g<E?f:v,g,C,E,g<E?v:f,g,p.x,p.y)&&(b=Math.abs(g-p.y)/(f-p.x),Np(p,c)&&(b<M||b===M&&(p.x>h.x||p.x===h.x&&UU(h,p)))&&(h=p,M=b)),p=p.next;while(p!==x);return h}(e,t);if(!i)return t;var o=Ek(i,e);return su(o,o.next),su(i,i.next)}function UU(e,t){return io(e.prev,e,t.prev)<0&&io(t.next,e,e.next)<0}function tC(e,t,i,o,c){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function HU(e){var t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function Ch(e,t,i,o,c,u,h,p){return(c-h)*(t-p)>=(e-h)*(u-p)&&(e-h)*(o-p)>=(i-h)*(t-p)&&(i-h)*(u-p)>=(c-h)*(o-p)}function GU(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(i,o){var c=i;do{if(c.i!==i.i&&c.next.i!==i.i&&c.i!==o.i&&c.next.i!==o.i&&Sk(c,c.next,i,o))return!0;c=c.next}while(c!==i);return!1}(e,t)&&(Np(e,t)&&Np(t,e)&&function(i,o){var c=i,u=!1,h=(i.x+o.x)/2,p=(i.y+o.y)/2;do c.y>p!=c.next.y>p&&c.next.y!==c.y&&h<(c.next.x-c.x)*(p-c.y)/(c.next.y-c.y)+c.x&&(u=!u),c=c.next;while(c!==i);return u}(e,t)&&(io(e.prev,e,t.prev)||io(e,t.prev,t))||t0(e,t)&&io(e.prev,e,e.next)>0&&io(t.prev,t,t.next)>0)}function io(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function t0(e,t){return e.x===t.x&&e.y===t.y}function Sk(e,t,i,o){var c=i0(io(e,t,i)),u=i0(io(e,t,o)),h=i0(io(i,o,e)),p=i0(io(i,o,t));return c!==u&&h!==p||!(c!==0||!e0(e,i,t))||!(u!==0||!e0(e,o,t))||!(h!==0||!e0(i,e,o))||!(p!==0||!e0(i,t,o))}function e0(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function i0(e){return e>0?1:e<0?-1:0}function Np(e,t){return io(e.prev,e,e.next)<0?io(e,t,e.next)>=0&&io(e,e.prev,t)>=0:io(e,t,e.prev)<0||io(e,e.next,t)<0}function Ek(e,t){var i=new eC(e.i,e.x,e.y),o=new eC(t.i,t.x,t.y),c=e.next,u=t.prev;return e.next=t,t.prev=e,i.next=c,c.prev=i,o.next=i,i.prev=o,u.next=o,o.prev=u,o}function Mk(e,t,i,o){var c=new eC(e,t,i);return o?(c.next=o.next,c.prev=o,o.next.prev=c,o.next=c):(c.prev=c,c.next=c),c}function Bp(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function eC(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function iC(e,t,i,o){for(var c=0,u=t,h=i-o;u<i;u+=o)c+=(e[h]-e[u])*(e[u+1]+e[h+1]),h=u;return c}Jw.exports=J_,Jw.exports.default=J_,J_.deviation=function(e,t,i,o){var c=t&&t.length,u=Math.abs(iC(e,0,c?t[0]*i:e.length,i));if(c)for(var h=0,p=t.length;h<p;h++)u-=Math.abs(iC(e,t[h]*i,h<p-1?t[h+1]*i:e.length,i));var f=0;for(h=0;h<o.length;h+=3){var g=o[h]*i,v=o[h+1]*i,y=o[h+2]*i;f+=Math.abs((e[g]-e[y])*(e[v+1]-e[g+1])-(e[g]-e[v])*(e[y+1]-e[g+1]))}return u===0&&f===0?0:Math.abs((f-u)/u)},J_.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},o=0,c=0;c<e.length;c++){for(var u=0;u<e[c].length;u++)for(var h=0;h<t;h++)i.vertices.push(e[c][u][h]);c>0&&i.holes.push(o+=e[c-1].length)}return i};var n0=mt(Jw.exports);function nC(e,t){let i=e.length;if(i<=1)return[e];let o=[],c,u;for(let h=0;h<i;h++){let p=Vt(e[h]);p!==0&&(e[h].area=Math.abs(p),u===void 0&&(u=p<0),u===p<0?(c&&o.push(c),c=[e[h]]):c.push(e[h]))}if(c&&o.push(c),t>1)for(let h=0;h<o.length;h++)o[h].length<=t||(Dj(o[h],t,1,o[h].length-1,qU),o[h]=o[h].slice(0,t));return o}function qU(e,t){return t.area-e.area}function rC(e,t,i){let o=i.patternDependencies,c=!1;for(let u of t){let h=u.paint.get(`${e}-pattern`);h.isConstant()||(c=!0);let p=h.constantOr(null);p&&(c=!0,o[p]=!0)}return c}function oC(e,t,i,o,c){let u=c.patternDependencies;for(let h of t){let p=h.paint.get(`${e}-pattern`).value;if(p.kind!=="constant"){let f=p.evaluate({zoom:o},i,{},c.availableImages);f=f&&f.name?f.name:f,u[f]=!0,i.patterns[h.id]=f}}return i}class r0{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Cs,this.indexArray=new qr,this.indexArray2=new $c,this.programConfigurations=new Zc(t.layers,t.zoom),this.segments=new un,this.segments2=new un,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=t.projection}populate(t,i,o,c){this.hasPattern=rC("fill",this.layers,i);let u=this.layers[0].layout.get("fill-sort-key"),h=[];for(let{feature:p,id:f,index:g,sourceLayerIndex:v}of t){let y=this.layers[0]._featureFilter.needGeometry,b=id(p,y);if(!this.layers[0]._featureFilter.filter(new ir(this.zoom),b,o))continue;let x=u?u.evaluate(b,{},o,i.availableImages):void 0,C={id:f,properties:p.properties,type:p.type,sourceLayerIndex:v,index:g,geometry:y?b.geometry:Dl(p,o,c),patterns:{},sortKey:x};h.push(C)}u&&h.sort((p,f)=>p.sortKey-f.sortKey);for(let p of h){let{geometry:f,index:g,sourceLayerIndex:v}=p;if(this.hasPattern){let y=oC("fill",this.layers,p,this.zoom,i);this.patternFeatures.push(y)}else this.addFeature(p,f,g,o,{},i.availableImages,i.brightness);i.featureIndex.insert(t[g].feature,f,g,v,this.index)}}update(t,i,o,c,u){let h=Object.keys(t).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,i,h?this.stateDependentLayers:this.layers,o,c,u)}addFeatures(t,i,o,c,u,h){for(let p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,i,o,c,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,FU),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,i,o,c,u,h=[],p){for(let f of nC(i,500)){let g=0;for(let E of f)g+=E.length;let v=this.segments.prepareSegment(g,this.layoutVertexArray,this.indexArray),y=v.vertexLength,b=[],x=[];for(let E of f){if(E.length===0)continue;E!==f[0]&&x.push(b.length/2);let M=this.segments2.prepareSegment(E.length,this.layoutVertexArray,this.indexArray2),D=M.vertexLength;this.layoutVertexArray.emplaceBack(E[0].x,E[0].y),this.indexArray2.emplaceBack(D+E.length-1,D),b.push(E[0].x),b.push(E[0].y);for(let A=1;A<E.length;A++)this.layoutVertexArray.emplaceBack(E[A].x,E[A].y),this.indexArray2.emplaceBack(D+A-1,D+A),b.push(E[A].x),b.push(E[A].y);M.vertexLength+=E.length,M.primitiveLength+=E.length}let C=n0(b,x);for(let E=0;E<C.length;E+=3)this.indexArray.emplaceBack(y+C[E],y+C[E+1],y+C[E+2]);v.vertexLength+=g,v.primitiveLength+=C.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,u,h,c,p)}}Ce(r0,"FillBucket",{omit:["layers","patternFeatures"]});let WU=new yr({"fill-sort-key":new Re(_t.layout_fill["fill-sort-key"]),visibility:new Ut(_t.layout_fill.visibility)});var $U={paint:new yr({"fill-antialias":new Ut(_t.paint_fill["fill-antialias"]),"fill-opacity":new Re(_t.paint_fill["fill-opacity"]),"fill-color":new Re(_t.paint_fill["fill-color"]),"fill-outline-color":new Re(_t.paint_fill["fill-outline-color"]),"fill-translate":new Ut(_t.paint_fill["fill-translate"]),"fill-translate-anchor":new Ut(_t.paint_fill["fill-translate-anchor"]),"fill-pattern":new Re(_t.paint_fill["fill-pattern"]),"fill-emissive-strength":new Ut(_t.paint_fill["fill-emissive-strength"])}),layout:WU};let YU=Ji([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),ZU=Ji([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),XU=Ji([{name:"a_centroid_pos",components:2,type:"Uint16"}]),KU=Ji([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),QU=Ji([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:JU}=YU;var o0={},t8=Nt,Dk=Sh;function Sh(e,t,i,o,c){this.properties={},this.extent=i,this.type=0,this._pbf=e,this._geometry=-1,this._keys=o,this._values=c,e.readFields(e8,this,t)}function e8(e,t,i){e==1?t.id=i.readVarint():e==2?function(o,c){for(var u=o.readVarint()+o.pos;o.pos<u;){var h=c._keys[o.readVarint()],p=c._values[o.readVarint()];c.properties[h]=p}}(i,t):e==3?t.type=i.readVarint():e==4&&(t._geometry=i.pos)}function i8(e){for(var t,i,o=0,c=0,u=e.length,h=u-1;c<u;h=c++)o+=((i=e[h]).x-(t=e[c]).x)*(t.y+i.y);return o}Sh.types=["Unknown","Point","LineString","Polygon"],Sh.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,i=e.readVarint()+e.pos,o=1,c=0,u=0,h=0,p=[];e.pos<i;){if(c<=0){var f=e.readVarint();o=7&f,c=f>>3}if(c--,o===1||o===2)u+=e.readSVarint(),h+=e.readSVarint(),o===1&&(t&&p.push(t),t=[]),t.push(new t8(u,h));else{if(o!==7)throw new Error("unknown command "+o);t&&t.push(t[0].clone())}}return t&&p.push(t),p},Sh.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,i=1,o=0,c=0,u=0,h=1/0,p=-1/0,f=1/0,g=-1/0;e.pos<t;){if(o<=0){var v=e.readVarint();i=7&v,o=v>>3}if(o--,i===1||i===2)(c+=e.readSVarint())<h&&(h=c),c>p&&(p=c),(u+=e.readSVarint())<f&&(f=u),u>g&&(g=u);else if(i!==7)throw new Error("unknown command "+i)}return[h,f,p,g]},Sh.prototype.toGeoJSON=function(e,t,i){var o,c,u=this.extent*Math.pow(2,i),h=this.extent*e,p=this.extent*t,f=this.loadGeometry(),g=Sh.types[this.type];function v(x){for(var C=0;C<x.length;C++){var E=x[C];x[C]=[360*(E.x+h)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*(E.y+p)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var y=[];for(o=0;o<f.length;o++)y[o]=f[o][0];v(f=y);break;case 2:for(o=0;o<f.length;o++)v(f[o]);break;case 3:for(f=function(x){var C=x.length;if(C<=1)return[x];for(var E,M,D=[],A=0;A<C;A++){var P=i8(x[A]);P!==0&&(M===void 0&&(M=P<0),M===P<0?(E&&D.push(E),E=[x[A]]):E.push(x[A]))}return E&&D.push(E),D}(f),o=0;o<f.length;o++)for(c=0;c<f[o].length;c++)v(f[o][c])}f.length===1?f=f[0]:g="Multi"+g;var b={type:"Feature",geometry:{type:g,coordinates:f},properties:this.properties};return"id"in this&&(b.id=this.id),b};var n8=Dk,Tk=Ik;function Ik(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(r8,this,t),this.length=this._features.length}function r8(e,t,i){e===15?t.version=i.readVarint():e===1?t.name=i.readString():e===5?t.extent=i.readVarint():e===2?t._features.push(i.pos):e===3?t._keys.push(i.readString()):e===4&&t._values.push(function(o){for(var c=null,u=o.readVarint()+o.pos;o.pos<u;){var h=o.readVarint()>>3;c=h===1?o.readString():h===2?o.readFloat():h===3?o.readDouble():h===4?o.readVarint64():h===5?o.readVarint():h===6?o.readSVarint():h===7?o.readBoolean():null}return c}(i))}Ik.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new n8(this._pbf,t,this.extent,this._keys,this._values)};var o8=Tk;function s8(e,t,i){if(e===3){var o=new o8(i,i.readVarint()+i.pos);o.length&&(t[o.name]=o)}}var sC=o0.VectorTile=function(e,t){this.layers=e.readFields(s8,{},t)},s0=o0.VectorTileFeature=Dk;function a0(e,t,i,o){let c=[],u=o===0?(h,p,f,g,v,y)=>{h.push(new Q(y,f+(y-p)/(g-p)*(v-f)))}:(h,p,f,g,v,y)=>{h.push(new Q(p+(y-f)/(v-f)*(g-p),y))};for(let h of e){let p=[];for(let f of h){if(f.length<=2)continue;let g=[];for(let b=0;b<f.length-1;b++){let x=f[b].x,C=f[b].y,E=f[b+1].x,M=f[b+1].y,D=o===0?x:C,A=o===0?E:M;D<t?A>t&&u(g,x,C,E,M,t):D>i?A<i&&u(g,x,C,E,M,i):g.push(f[b]),A<t&&D>=t&&u(g,x,C,E,M,t),A>i&&D<=i&&u(g,x,C,E,M,i)}let v=f[f.length-1],y=o===0?v.x:v.y;y>=t&&y<=i&&g.push(v),g.length&&(v=g[g.length-1],g[0].x===v.x&&g[0].y===v.y||g.push(g[0]),p.push(g))}p.length&&c.push(p)}return c}o0.VectorTileLayer=Tk;class Ak{constructor(t){this._stringToNumber={},this._numberToString=[];for(let i=0;i<t.length;i++){let o=t[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}var a8={read:function(e,t,i,o,c){var u,h,p=8*c-o-1,f=(1<<p)-1,g=f>>1,v=-7,y=i?c-1:0,b=i?-1:1,x=e[t+y];for(y+=b,u=x&(1<<-v)-1,x>>=-v,v+=p;v>0;u=256*u+e[t+y],y+=b,v-=8);for(h=u&(1<<-v)-1,u>>=-v,v+=o;v>0;h=256*h+e[t+y],y+=b,v-=8);if(u===0)u=1-g;else{if(u===f)return h?NaN:1/0*(x?-1:1);h+=Math.pow(2,o),u-=g}return(x?-1:1)*h*Math.pow(2,u-o)},write:function(e,t,i,o,c,u){var h,p,f,g=8*u-c-1,v=(1<<g)-1,y=v>>1,b=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,x=o?0:u-1,C=o?1:-1,E=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(p=isNaN(t)?1:0,h=v):(h=Math.floor(Math.log(t)/Math.LN2),t*(f=Math.pow(2,-h))<1&&(h--,f*=2),(t+=h+y>=1?b/f:b*Math.pow(2,1-y))*f>=2&&(h++,f/=2),h+y>=v?(p=0,h=v):h+y>=1?(p=(t*f-1)*Math.pow(2,c),h+=y):(p=t*Math.pow(2,y-1)*Math.pow(2,c),h=0));c>=8;e[i+x]=255&p,x+=C,p/=256,c-=8);for(h=h<<c|p,g+=c;g>0;e[i+x]=255&h,x+=C,h/=256,g-=8);e[i+x-C]|=128*E}},kk=Qn,l0=a8;function Qn(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Qn.Varint=0,Qn.Fixed64=1,Qn.Bytes=2,Qn.Fixed32=5;var aC=4294967296,Rk=1/aC,Pk=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function gc(e){return e.type===Qn.Bytes?e.readVarint()+e.pos:e.pos+1}function Eh(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Ok(e,t,i){var o=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(o);for(var c=i.pos-1;c>=e;c--)i.buf[c+o]=i.buf[c]}function l8(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function c8(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function d8(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function u8(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function h8(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function m8(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function p8(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function f8(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function g8(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function c0(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Mh(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function Fk(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}Qn.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var o=this.readVarint(),c=o>>3,u=this.pos;this.type=7&o,e(c,t,this),this.pos===u&&this.skip(o)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=c0(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Fk(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=c0(this.buf,this.pos)+c0(this.buf,this.pos+4)*aC;return this.pos+=8,e},readSFixed64:function(){var e=c0(this.buf,this.pos)+Fk(this.buf,this.pos+4)*aC;return this.pos+=8,e},readFloat:function(){var e=l0.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=l0.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,i,o=this.buf;return t=127&(i=o[this.pos++]),i<128?t:(t|=(127&(i=o[this.pos++]))<<7,i<128?t:(t|=(127&(i=o[this.pos++]))<<14,i<128?t:(t|=(127&(i=o[this.pos++]))<<21,i<128?t:function(c,u,h){var p,f,g=h.buf;if(p=(112&(f=g[h.pos++]))>>4,f<128||(p|=(127&(f=g[h.pos++]))<<3,f<128)||(p|=(127&(f=g[h.pos++]))<<10,f<128)||(p|=(127&(f=g[h.pos++]))<<17,f<128)||(p|=(127&(f=g[h.pos++]))<<24,f<128)||(p|=(1&(f=g[h.pos++]))<<31,f<128))return Eh(c,p,u);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=o[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Pk?function(i,o,c){return Pk.decode(i.subarray(o,c))}(this.buf,t,e):function(i,o,c){for(var u="",h=o;h<c;){var p,f,g,v=i[h],y=null,b=v>239?4:v>223?3:v>191?2:1;if(h+b>c)break;b===1?v<128&&(y=v):b===2?(192&(p=i[h+1]))==128&&(y=(31&v)<<6|63&p)<=127&&(y=null):b===3?(f=i[h+2],(192&(p=i[h+1]))==128&&(192&f)==128&&((y=(15&v)<<12|(63&p)<<6|63&f)<=2047||y>=55296&&y<=57343)&&(y=null)):b===4&&(f=i[h+2],g=i[h+3],(192&(p=i[h+1]))==128&&(192&f)==128&&(192&g)==128&&((y=(15&v)<<18|(63&p)<<12|(63&f)<<6|63&g)<=65535||y>=1114112)&&(y=null)),y===null?(y=65533,b=1):y>65535&&(y-=65536,u+=String.fromCharCode(y>>>10&1023|55296),y=56320|1023&y),u+=String.fromCharCode(y),h+=b}return u}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Qn.Bytes)return e.push(this.readVarint(t));var i=gc(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Qn.Bytes)return e.push(this.readSVarint());var t=gc(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Qn.Bytes)return e.push(this.readBoolean());var t=gc(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Qn.Bytes)return e.push(this.readFloat());var t=gc(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Qn.Bytes)return e.push(this.readDouble());var t=gc(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Qn.Bytes)return e.push(this.readFixed32());var t=gc(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Qn.Bytes)return e.push(this.readSFixed32());var t=gc(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Qn.Bytes)return e.push(this.readFixed64());var t=gc(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Qn.Bytes)return e.push(this.readSFixed64());var t=gc(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Qn.Varint)for(;this.buf[this.pos++]>127;);else if(t===Qn.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Qn.Fixed32)this.pos+=4;else{if(t!==Qn.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Mh(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Mh(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Mh(this.buf,-1&e,this.pos),Mh(this.buf,Math.floor(e*Rk),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Mh(this.buf,-1&e,this.pos),Mh(this.buf,Math.floor(e*Rk),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,i){var o,c;if(t>=0?(o=t%4294967296|0,c=t/4294967296|0):(c=~(-t/4294967296),4294967295^(o=~(-t%4294967296))?o=o+1|0:(o=0,c=c+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(u,h,p){p.buf[p.pos++]=127&u|128,u>>>=7,p.buf[p.pos++]=127&u|128,u>>>=7,p.buf[p.pos++]=127&u|128,u>>>=7,p.buf[p.pos++]=127&u|128,p.buf[p.pos]=127&(u>>>=7)}(o,0,i),function(u,h){var p=(7&u)<<4;h.buf[h.pos++]|=p|((u>>>=3)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u)))))}(c,i)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(o,c,u){for(var h,p,f=0;f<c.length;f++){if((h=c.charCodeAt(f))>55295&&h<57344){if(!p){h>56319||f+1===c.length?(o[u++]=239,o[u++]=191,o[u++]=189):p=h;continue}if(h<56320){o[u++]=239,o[u++]=191,o[u++]=189,p=h;continue}h=p-55296<<10|h-56320|65536,p=null}else p&&(o[u++]=239,o[u++]=191,o[u++]=189,p=null);h<128?o[u++]=h:(h<2048?o[u++]=h>>6|192:(h<65536?o[u++]=h>>12|224:(o[u++]=h>>18|240,o[u++]=h>>12&63|128),o[u++]=h>>6&63|128),o[u++]=63&h|128)}return u}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&Ok(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),l0.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),l0.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var o=this.pos-i;o>=128&&Ok(i,o,this),this.pos=i-1,this.writeVarint(o),this.pos+=o},writeMessage:function(e,t,i){this.writeTag(e,Qn.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,l8,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,c8,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,h8,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,d8,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,u8,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,m8,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,p8,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,f8,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,g8,t)},writeBytesField:function(e,t){this.writeTag(e,Qn.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Qn.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Qn.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Qn.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Qn.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Qn.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Qn.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Qn.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Qn.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Qn.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,!!t)}};var d0=mt(kk);let _8=["tile","layer","source","sourceLayer","state"];class Lk{constructor(t,i,o,c,u){this.type="Feature",this._vectorTileFeature=t,this._z=i,this._x=o,this._y=c,this.properties=t.properties,this.id=u}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){let t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(t.id=this.id);for(let i of _8)this[i]!==void 0&&(t[i]=this[i]);return t}}class v8{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,i,o){let c=String(i);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][c]=this.stateChanges[t][c]||{},ge(this.stateChanges[t][c],o),this.deletedStates[t]===null){this.deletedStates[t]={};for(let u in this.state[t])u!==c&&(this.deletedStates[t][u]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][c]===null){this.deletedStates[t][c]={};for(let u in this.state[t][c])o[u]||(this.deletedStates[t][c][u]=null)}else for(let u in o)this.deletedStates[t]&&this.deletedStates[t][c]&&this.deletedStates[t][c][u]===null&&delete this.deletedStates[t][c][u]}removeFeatureState(t,i,o){if(this.deletedStates[t]===null)return;let c=String(i);if(this.deletedStates[t]=this.deletedStates[t]||{},o&&i!==void 0)this.deletedStates[t][c]!==null&&(this.deletedStates[t][c]=this.deletedStates[t][c]||{},this.deletedStates[t][c][o]=null);else if(i!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][c])for(o in this.deletedStates[t][c]={},this.stateChanges[t][c])this.deletedStates[t][c][o]=null;else this.deletedStates[t][c]=null;else this.deletedStates[t]=null}getState(t,i){let o=String(i),c=ge({},(this.state[t]||{})[o],(this.stateChanges[t]||{})[o]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){let u=this.deletedStates[t][i];if(u===null)return{};for(let h in u)delete c[h]}return c}initializeTileState(t,i){t.setFeatureState(this.state,i)}coalesceChanges(t,i){let o={};for(let c in this.stateChanges){this.state[c]=this.state[c]||{};let u={};for(let h in this.stateChanges[c])this.state[c][h]||(this.state[c][h]={}),ge(this.state[c][h],this.stateChanges[c][h]),u[h]=this.state[c][h];o[c]=u}for(let c in this.deletedStates){this.state[c]=this.state[c]||{};let u={};if(this.deletedStates[c]===null)for(let h in this.state[c])u[h]={},this.state[c][h]={};else for(let h in this.deletedStates[c]){if(this.deletedStates[c][h]===null)this.state[c][h]={};else if(this.state[c][h])for(let p of Object.keys(this.deletedStates[c][h]))delete this.state[c][h][p];u[h]=this.state[c][h]}o[c]=o[c]||{},ge(o[c],u)}if(this.stateChanges={},this.deletedStates={},Object.keys(o).length!==0)for(let c in t)t[c].setFeatureState(o,i)}}class zk{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,i){let o=this.toIdx(t,i);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(t,i){return this.leaves[this.toIdx(t,i)]}toIdx(t,i){return i*this.size+t}}function Nk(e,t,i,o){let c=0,u=Number.MAX_VALUE;for(let h=0;h<3;h++)if(Math.abs(o[h])<1e-15){if(i[h]<e[h]||i[h]>t[h])return null}else{let p=1/o[h],f=(e[h]-i[h])*p,g=(t[h]-i[h])*p;if(f>g){let v=f;f=g,g=v}if(f>c&&(c=f),g<u&&(u=g),c>u)return null}return c}function Bk(e,t,i,o,c,u,h,p,f,g,v){let y=o-e,b=c-t,x=u-i,C=h-e,E=p-t,M=f-i,D=v[1]*M-v[2]*E,A=v[2]*C-v[0]*M,P=v[0]*E-v[1]*C,O=y*D+b*A+x*P;if(Math.abs(O)<1e-15)return null;let R=1/O,F=g[0]-e,N=g[1]-t,j=g[2]-i,U=(F*D+N*A+j*P)*R;if(U<0||U>1)return null;let G=N*x-j*b,Y=j*y-F*x,Z=F*b-N*y,tt=(v[0]*G+v[1]*Y+v[2]*Z)*R;return tt<0||U+tt>1?null:(C*G+E*Y+M*Z)*R}function Vk(e,t,i){return(e-t)/(i-t)}function jk(e,t,i,o,c,u,h,p,f){let g=1<<i,v=u-o,y=h-c,b=(e+1)/g*v+o,x=(t+0)/g*y+c,C=(t+1)/g*y+c;p[0]=(e+0)/g*v+o,p[1]=x,f[0]=b,f[1]=C}class Uk{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let i=function(u){let h=Math.ceil(Math.log2(u.dim/8)),p=[],f=Math.ceil(Math.pow(2,h)),g=1/f,v=(x,C,E,M,D)=>{let A=M?1:0,P=(x+1)*E-A,O=C*E,R=(C+1)*E-A;D[0]=x*E,D[1]=O,D[2]=P,D[3]=R},y=new zk(f),b=[];for(let x=0;x<f*f;x++){v(x%f,Math.floor(x/f),g,!1,b);let C=rd(b[0],b[1],u),E=rd(b[2],b[1],u),M=rd(b[2],b[3],u),D=rd(b[0],b[3],u);y.minimums.push(Math.min(C,E,M,D)),y.maximums.push(Math.max(C,E,M,D)),y.leaves.push(1)}for(p.push(y),f/=2;f>=1;f/=2){let x=p[p.length-1];y=new zk(f);for(let C=0;C<f*f;C++){v(C%f,Math.floor(C/f),2,!0,b);let E=x.getElevation(b[0],b[1]),M=x.getElevation(b[2],b[1]),D=x.getElevation(b[2],b[3]),A=x.getElevation(b[0],b[3]),P=x.isLeaf(b[0],b[1]),O=x.isLeaf(b[2],b[1]),R=x.isLeaf(b[2],b[3]),F=x.isLeaf(b[0],b[3]),N=Math.min(E.min,M.min,D.min,A.min),j=Math.max(E.max,M.max,D.max,A.max),U=P&&O&&R&&F;y.maximums.push(j),y.minimums.push(N),y.leaves.push(j-N<=5&&U?1:0)}p.push(y)}return p}(this.dem),o=i.length-1,c=i[o];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(i,0,0,o,0)}raycastRoot(t,i,o,c,u,h,p=1){return Nk([t,i,-100],[o,c,this.maximums[0]*p],u,h)}raycast(t,i,o,c,u,h,p=1){if(!this.nodeCount)return null;let f=this.raycastRoot(t,i,o,c,u,h,p);if(f==null)return null;let g=[],v=[],y=[],b=[],x=[{idx:0,t:f,nodex:0,nodey:0,depth:0}];for(;x.length>0;){let{idx:C,t:E,nodex:M,nodey:D,depth:A}=x.pop();if(this.leaves[C]){jk(M,D,A,t,i,o,c,y,b);let O=1<<A,R=(M+0)/O,F=(M+1)/O,N=(D+0)/O,j=(D+1)/O,U=rd(R,N,this.dem)*p,G=rd(F,N,this.dem)*p,Y=rd(F,j,this.dem)*p,Z=rd(R,j,this.dem)*p,tt=Bk(y[0],y[1],U,b[0],y[1],G,b[0],b[1],Y,u,h),$=Bk(b[0],b[1],Y,y[0],b[1],Z,y[0],y[1],U,u,h),rt=Math.min(tt!==null?tt:Number.MAX_VALUE,$!==null?$:Number.MAX_VALUE);if(rt!==Number.MAX_VALUE)return rt;{let st=J.scaleAndAdd([],u,h,E);if(Hk(U,G,Z,Y,Vk(st[0],y[0],b[0]),Vk(st[1],y[1],b[1]))>=st[2])return E}continue}let P=0;for(let O=0;O<this._siblingOffset.length;O++){jk((M<<1)+this._siblingOffset[O][0],(D<<1)+this._siblingOffset[O][1],A+1,t,i,o,c,y,b),y[2]=-100,b[2]=this.maximums[this.childOffsets[C]+O]*p;let R=Nk(y,b,u,h);if(R!=null){let F=R;g[O]=F;let N=!1;for(let j=0;j<P&&!N;j++)F>=g[v[j]]&&(v.splice(j,0,O),N=!0);N||(v[P]=O),P++}}for(let O=0;O<P;O++){let R=v[O];x.push({idx:this.childOffsets[C]+R,t:g[R],nodex:(M<<1)+this._siblingOffset[R][0],nodey:(D<<1)+this._siblingOffset[R][1],depth:A+1})}}return null}_addNode(t,i,o){return this.minimums.push(t),this.maximums.push(i),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(t,i,o,c,u){if(t[c].isLeaf(i,o)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);let h=c-1,p=t[h],f=0,g=0;for(let v=0;v<this._siblingOffset.length;v++){let y=2*i+this._siblingOffset[v][0],b=2*o+this._siblingOffset[v][1],x=p.getElevation(y,b),C=p.isLeaf(y,b),E=this._addNode(x.min,x.max,C);C&&(f|=1<<v),g||(g=E)}for(let v=0;v<this._siblingOffset.length;v++)f&1<<v||this._construct(t,2*i+this._siblingOffset[v][0],2*o+this._siblingOffset[v][1],h,g+v)}}function Hk(e,t,i,o,c,u){return Ye(Ye(e,i,u),Ye(t,o,u),c)}function rd(e,t,i){let o=i.dim,c=ve(e*o-.5,0,o-1),u=ve(t*o-.5,0,o-1),h=Math.floor(c),p=Math.floor(u),f=Math.min(h+1,o-1),g=Math.min(p+1,o-1);return Hk(i.get(h,p),i.get(f,p),i.get(h,g),i.get(f,g),c-h,u-p)}let y8={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function b8(e,t,i){return(256*e*256+256*t+i)/10-1e4}function x8(e,t,i){return 256*e+t+i/256-32768}class u0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,i,o,c=!1){if(this.uid=t,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return lt(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;let u=this.dim=i.height-2,h=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=c,this._modifiedForSources={},!c){for(let f=0;f<u;f++)h[this._idx(-1,f)]=h[this._idx(0,f)],h[this._idx(u,f)]=h[this._idx(u-1,f)],h[this._idx(f,-1)]=h[this._idx(f,0)],h[this._idx(f,u)]=h[this._idx(f,u-1)];h[this._idx(-1,-1)]=h[this._idx(0,0)],h[this._idx(u,-1)]=h[this._idx(u-1,0)],h[this._idx(-1,u)]=h[this._idx(0,u-1)],h[this._idx(u,u)]=h[this._idx(u-1,u-1)]}let p=o==="terrarium"?x8:b8;for(let f=0;f<h.length;++f){let g=4*f;this.floatView[f]=p(this.pixels[g],this.pixels[g+1],this.pixels[g+2])}this._timestamp=ii.now()}_buildQuadTree(){this._tree=new Uk(this)}get(t,i,o=!1){o&&(t=ve(t,-1,this.dim),i=ve(i,-1,this.dim));let c=this._idx(t,i);return this.floatView[c]}set(t,i,o){let c=this._idx(t,i),u=this.floatView[c];return this.floatView[c]=o,o-u}static getUnpackVector(t){return y8[t]}_idx(t,i){if(t<-1||t>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(t+1)}static pack(t,i){let o=[0,0,0,0],c=u0.getUnpackVector(i),u=Math.floor((t+c[3])/c[2]);return o[2]=u%256,u=Math.floor(u/256),o[1]=u%256,u=Math.floor(u/256),o[0]=u,o}getPixels(){return new wk({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,i,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let c=i*this.dim,u=i*this.dim+this.dim,h=o*this.dim,p=o*this.dim+this.dim;switch(i){case-1:c=u-1;break;case 1:u=c+1}switch(o){case-1:h=p-1;break;case 1:p=h+1}let f=-i*this.dim,g=-o*this.dim;for(let v=h;v<p;v++)for(let y=c;y<u;y++){let b=4*this._idx(y,v),x=4*this._idx(y+f,v+g);this.pixels[b+0]=t.pixels[x+0],this.pixels[b+1]=t.pixels[x+1],this.pixels[b+2]=t.pixels[x+2],this.pixels[b+3]=t.pixels[x+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ce(u0,"DEMData"),Ce(Uk,"DemMinMaxQuadTree",{omit:["dem"]});class w8{isDataAvailableAtPoint(t){let i=this._source();if(this.isUsingMockSource()||!i||t.y<0||t.y>1)return!1;let o=i.getSource().maxzoom,c=1<<o,u=Math.floor(t.x),h=Math.floor((t.x-u)*c),p=Math.floor(t.y*c),f=this.findDEMTileFor(new $i(o,u,o,h,p));return!(!f||!f.dem)}getAtPointOrZero(t,i=0){return this.getAtPoint(t,i)||0}getAtPoint(t,i,o=!0){if(this.isUsingMockSource())return null;i==null&&(i=null);let c=this._source();if(!c||t.y<0||t.y>1)return i;let u=c.getSource().maxzoom,h=1<<u,p=Math.floor(t.x),f=t.x-p,g=new $i(u,p,u,Math.floor(f*h),Math.floor(t.y*h)),v=this.findDEMTileFor(g);if(!v||!v.dem)return i;let y=v.dem,b=1<<v.tileID.canonical.z,x=(f*b-v.tileID.canonical.x)*y.dim,C=(t.y*b-v.tileID.canonical.y)*y.dim,E=Math.floor(x),M=Math.floor(C);return(o?this.exaggeration():1)*Ye(Ye(y.get(E,M),y.get(E,M+1),C-M),Ye(y.get(E+1,M),y.get(E+1,M+1),C-M),x-E)}getAtTileOffset(t,i,o){let c=1<<t.canonical.z;return this.getAtPointOrZero(new Fi(t.wrap+(t.canonical.x+i/wt)/c,(t.canonical.y+o/wt)/c))}getAtTileOffsetFunc(t,i,o,c){return u=>{let h=this.getAtTileOffset(t,u.x,u.y),p=c.upVector(t.canonical,u.x,u.y),f=c.upVectorScale(t.canonical,i,o).metersToTile;return J.scale(p,p,h*f),p}}getForTilePoints(t,i,o,c){if(this.isUsingMockSource())return!1;let u=Dh.create(this,t,c);return!!u&&(i.forEach(h=>{h[2]=this.exaggeration()*u.getElevationAt(h[0],h[1],o)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;let i=this.findDEMTileFor(t);if(!i||!i.dem)return null;let o=i.dem.tree,c=i.tileID,u=1<<t.canonical.z-c.canonical.z,h=t.canonical.x/u-c.canonical.x,p=t.canonical.y/u-c.canonical.y,f=0;for(let g=0;g<t.canonical.z-c.canonical.z&&!o.leaves[f];g++){h*=2,p*=2;let v=2*Math.floor(p)+Math.floor(h);f=o.childOffsets[f]+v,h%=1,p%=1}return{min:this.exaggeration()*o.minimums[f],max:this.exaggeration()*o.maximums[f]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,i,o){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let t=this.visibleDemTiles;if(t.length===0)return null;let i=!1,o=Number.MAX_VALUE,c=Number.MIN_VALUE;for(let u of t){let h=this.getMinMaxForTile(u.tileID);h&&(o=Math.min(o,h.min),c=Math.max(c,h.max),i=!0)}return i?{min:o,max:c}:null}}class Dh{constructor(t,i,o){this._demTile=t,this._dem=this._demTile.dem,this._scale=i,this._offset=o}static create(t,i,o){let c=o||t.findDEMTileFor(i);if(!c||!c.dem)return;let u=c.dem,h=c.tileID,p=1<<i.canonical.z-h.canonical.z;return new Dh(c,u.dim/wt/p,[(i.canonical.x/p-h.canonical.x)*u.dim,(i.canonical.y/p-h.canonical.y)*u.dim])}tileCoordToPixel(t,i){let o=i*this._scale+this._offset[1],c=Math.floor(t*this._scale+this._offset[0]),u=Math.floor(o);return new Q(c,u)}getElevationAt(t,i,o,c){let u=t*this._scale+this._offset[0],h=i*this._scale+this._offset[1],p=Math.floor(u),f=Math.floor(h),g=this._dem;return c=!!c,o?Ye(Ye(g.get(p,f,c),g.get(p,f+1,c),h-f),Ye(g.get(p+1,f,c),g.get(p+1,f+1,c),h-f),u-p):g.get(p,f,c)}getElevationAtPixel(t,i,o){return this._dem.get(t,i,!!o)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*yn(1,t)*this._dem.stride}}class lC{constructor(t,i){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new uh(wt,16,0),this.featureIndexArray=new y2,this.promoteId=i}insert(t,i,o,c,u,h=0){let p=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,c,u,h);let f=this.grid;for(let g=0;g<i.length;g++){let v=i[g],y=[1/0,1/0,-1/0,-1/0];for(let b=0;b<v.length;b++){let x=v[b];y[0]=Math.min(y[0],x.x),y[1]=Math.min(y[1],x.y),y[2]=Math.max(y[2],x.x),y[3]=Math.max(y[3],x.y)}y[0]<wt&&y[1]<wt&&y[2]>=0&&y[3]>=0&&f.insert(p,y[0],y[1],y[2],y[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new sC(new d0(this.rawTileData)).layers,this.sourceLayerCoder=new Ak(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,i,o,c){this.loadVTLayers();let u=t.params||{},h=C_(u.filter),p=t.tileResult,f=t.transform,g=p.bufferedTilespaceBounds,v=this.grid.query(g.min.x,g.min.y,g.max.x,g.max.y,(C,E,M,D)=>mk(p.bufferedTilespaceGeometry,C,E,M,D));v.sort(C8);let y=null;f.elevation&&v.length>0&&(y=Dh.create(f.elevation,this.tileID));let b={},x;for(let C=0;C<v.length;C++){let E=v[C];if(E===x)continue;x=E;let M=this.featureIndexArray.get(E),D=null;this.loadMatchingFeature(b,M,h,u.layers,u.availableImages,i,o,c,(A,P,O,R=0)=>(D||(D=Dl(A,this.tileID.canonical,t.tileTransform)),P.queryIntersectsFeature(p,A,O,D,this.z,t.transform,t.pixelPosMatrix,y,R)))}return b}loadMatchingFeature(t,i,o,c,u,h,p,f,g){let{featureIndex:v,bucketIndex:y,sourceLayerIndex:b,layoutVertexArrayOffset:x}=i,C=this.bucketLayerIDs[y];if(c&&!function(A,P){for(let O=0;O<A.length;O++)if(P.indexOf(A[O])>=0)return!0;return!1}(c,C))return;let E=this.sourceLayerCoder.decode(b),M=this.vtLayers[E].feature(v);if(o.needGeometry){let A=id(M,!0);if(!o.filter(new ir(this.tileID.overscaledZ),A,this.tileID.canonical))return}else if(!o.filter(new ir(this.tileID.overscaledZ),M))return;let D=this.getId(M,E);for(let A=0;A<C.length;A++){let P=C[A];if(c&&c.indexOf(P)<0)continue;let O=h[P];if(!O)continue;let R={};D!==void 0&&f&&(R=f.getState(O.sourceLayer||"_geojsonTileLayer",D));let F=ge({},p[P]);F.paint=Gk(F.paint,O.paint,M,R,u),F.layout=Gk(F.layout,O.layout,M,R,u);let N=!g||g(M,O,R,x);if(!N)continue;let j=new Lk(M,this.z,this.x,this.y,D);j.layer=F;let U=t[P];U===void 0&&(U=t[P]=[]),U.push({featureIndex:v,feature:j,intersectionZ:N})}}lookupSymbolFeatures(t,i,o,c,u,h,p,f){let g={};this.loadVTLayers();let v=C_(u);for(let y of t)this.loadMatchingFeature(g,{bucketIndex:o,sourceLayerIndex:c,featureIndex:y,layoutVertexArrayOffset:0},v,h,p,f,i);return g}loadFeature(t){let{featureIndex:i,sourceLayerIndex:o}=t;this.loadVTLayers();let c=this.sourceLayerCoder.decode(o),u=this.vtFeatures[c];if(u[i])return u[i];let h=this.vtLayers[c].feature(i);return u[i]=h,h}hasLayer(t){for(let i of this.bucketLayerIDs)for(let o of i)if(t===o)return!0;return!1}getId(t,i){let o=t.id;if(this.promoteId){let c=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];c!=null&&(o=t.properties[c]),typeof o=="boolean"&&(o=Number(o))}return o}}function Gk(e,t,i,o,c){return Yu(e,(u,h)=>{let p=t instanceof Ep?t.get(h):null;return p&&p.evaluate?p.evaluate(i,o,c):p})}function C8(e,t){return t-e}Ce(lC,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});let S8=Ji([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),E8=Ji([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),M8=Ji([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ji([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let D8=Ji([{name:"a_z_offset",components:1,type:"Float32"}],4),T8=Ji([{name:"a_texb",components:2,type:"Uint16"}]),I8=Ji([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),A8=Ji([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Ji([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let qk=Ji([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),k8=Ji([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ji([{name:"triangle",components:3,type:"Uint16"}]),Ji([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ji([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Ji([{type:"Float32",name:"offsetX"}]),Ji([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var So=24;let Qa=128;function cC(e,t){let{expression:i}=t;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new ir(e+1))};if(i.kind==="source")return{kind:"source"};{let{zoomStops:o,interpolationType:c}=i,u=0;for(;u<o.length&&o[u]<=e;)u++;u=Math.max(0,u-1);let h=u;for(;h<o.length&&o[h]<e+1;)h++;h=Math.min(o.length-1,h);let p=o[u],f=o[h];return i.kind==="composite"?{kind:"composite",minZoom:p,maxZoom:f,interpolationType:c}:{kind:"camera",minZoom:p,maxZoom:f,minSize:i.evaluate(new ir(p)),maxSize:i.evaluate(new ir(f)),interpolationType:c}}}function Vp(e,{uSize:t,uSizeT:i},{lowerSize:o,upperSize:c}){return e.kind==="source"?o/Qa:e.kind==="composite"?Ye(o/Qa,c/Qa,i):t}function Tl(e,t){let i=0,o=0;if(e.kind==="constant")o=e.layoutSize;else if(e.kind!=="source"){let{interpolationType:c,minZoom:u,maxZoom:h}=e,p=c?ve(Cl.interpolationFactor(c,t,u,h),0,1):0;e.kind==="camera"?o=Ye(e.minSize,e.maxSize,p):i=p}return{uSizeT:i,uSize:o}}var R8=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Qa,evaluateSizeForFeature:Vp,evaluateSizeForZoom:Tl,getSizeData:cC});function P8(e,t,i){return e.sections.forEach(o=>{o.text=function(c,u,h){let p=u.layout.get("text-transform").evaluate(h,{});return p==="uppercase"?c=c.toLocaleUpperCase():p==="lowercase"&&(c=c.toLocaleLowerCase()),ha.applyArabicShaping&&(c=ha.applyArabicShaping(c)),c}(o.text,t,i)}),e}let jp={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function O8(e){return e==="\uFE36"||e==="\uFE48"||e==="\uFE38"||e==="\uFE44"||e==="\uFE42"||e==="\uFE3E"||e==="\uFE3C"||e==="\uFE3A"||e==="\uFE18"||e==="\uFE40"||e==="\uFE10"||e==="\uFE13"||e==="\uFE14"||e==="\uFF40"||e==="\uFFE3"||e==="\uFE11"||e==="\uFE12"}function F8(e){return e==="\uFE35"||e==="\uFE47"||e==="\uFE37"||e==="\uFE43"||e==="\uFE41"||e==="\uFE3D"||e==="\uFE3B"||e==="\uFE39"||e==="\uFE17"||e==="\uFE3F"}let dC=3;function L8(e,t,i){t.glyphs=[],e===1&&i.readMessage(z8,t)}function z8(e,t,i){if(e===3){let{id:o,bitmap:c,width:u,height:h,left:p,top:f,advance:g}=i.readMessage(N8,{});t.glyphs.push({id:o,bitmap:new fc({width:u+2*dC,height:h+2*dC},c),metrics:{width:u,height:h,left:p,top:f,advance:g}})}else e===4?t.ascender=i.readSVarint():e===5&&(t.descender=i.readSVarint())}function N8(e,t,i){e===1?t.id=i.readVarint():e===2?t.bitmap=i.readBytes():e===3?t.width=i.readVarint():e===4?t.height=i.readVarint():e===5?t.left=i.readSVarint():e===6?t.top=i.readSVarint():e===7&&(t.advance=i.readVarint())}let Wk=dC,Jn={horizontal:1,vertical:2,horizontalOnly:3},$k=-17;class Up{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,i){let o=new Up;return o.scale=t||1,o.fontStack=i,o}static forImage(t){let i=new Up;return i.imageName=t,i}}class Th{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,i){let o=new Th;for(let c=0;c<t.sections.length;c++){let u=t.sections[c];u.image?o.addImageSection(u):o.addTextSection(u,i)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(i,o){let c="";for(let u=0;u<i.length;u++){let h=i.charCodeAt(u+1)||null,p=i.charCodeAt(u-1)||null;c+=!o&&(h&&i2(h)&&!jp[i[u+1]]||p&&i2(p)&&!jp[i[u-1]])||!jp[i[u]]?i[u]:jp[i[u]]}return c}(this.text,t)}trim(){let t=0;for(let o=0;o<this.text.length&&h0[this.text.charCodeAt(o)];o++)t++;let i=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&h0[this.text.charCodeAt(o)];o--)i--;this.text=this.text.substring(t,i),this.sectionIndex=this.sectionIndex.slice(t,i)}substring(t,i){let o=new Th;return o.text=this.text.substring(t,i),o.sectionIndex=this.sectionIndex.slice(t,i),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,i)=>Math.max(t,this.sections[i].scale),0)}addTextSection(t,i){this.text+=t.text,this.sections.push(Up.forText(t.scale,t.fontStack||i));let o=this.sections.length-1;for(let c=0;c<t.text.length;++c)this.sectionIndex.push(o)}addImageSection(t){let i=t.image?t.image.namePrimary:"";if(i.length===0)return void lt("Can't add FormattedSection with an empty image.");let o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCodePoint(o),this.sections.push(Up.forImage(i)),this.sectionIndex.push(this.sections.length-1)):lt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function uC(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C){let E=Th.fromFeature(e,c);y===Jn.vertical&&E.verticalizePunctuation(b);let M=[],D=function(F,N,j,U,G,Y){if(!F)return[];let Z=[],tt=function(pt,nt,ot,vt,bt,yt){let Ct=0;for(let Et=0;Et<pt.length();Et++){let It=pt.getSection(Et);Ct+=Yk(pt.getCodePoint(Et),It,vt,bt,nt,yt)}return Ct/Math.max(1,Math.ceil(Ct/ot))}(F,N,j,U,G,Y),$=F.text.indexOf("\u200B")>=0,rt=0;for(let pt=0;pt<F.length();pt++){let nt=F.getSection(pt),ot=F.getCodePoint(pt);if(h0[ot]||(rt+=Yk(ot,nt,U,G,N,Y)),pt<F.length()-1){let vt=!((st=ot)<11904||!(De["Bopomofo Extended"](st)||De.Bopomofo(st)||De["CJK Compatibility Forms"](st)||De["CJK Compatibility Ideographs"](st)||De["CJK Compatibility"](st)||De["CJK Radicals Supplement"](st)||De["CJK Strokes"](st)||De["CJK Symbols and Punctuation"](st)||De["CJK Unified Ideographs Extension A"](st)||De["CJK Unified Ideographs"](st)||De["Enclosed CJK Letters and Months"](st)||De["Halfwidth and Fullwidth Forms"](st)||De.Hiragana(st)||De["Ideographic Description Characters"](st)||De["Kangxi Radicals"](st)||De["Katakana Phonetic Extensions"](st)||De.Katakana(st)||De["Vertical Forms"](st)||De["Yi Radicals"](st)||De["Yi Syllables"](st)));(B8[ot]||vt||nt.imageName)&&Z.push(Xk(pt+1,rt,tt,Z,V8(ot,F.getCodePoint(pt+1),vt&&$),!1))}}var st;return Kk(Xk(F.length(),rt,tt,Z,0,!0))}(E,g,u,t,o,x),{processBidirectionalText:A,processStyledBidirectionalText:P}=ha;if(A&&E.sections.length===1){let F=A(E.toString(),D);for(let N of F){let j=new Th;j.text=N,j.sections=E.sections;for(let U=0;U<N.length;U++)j.sectionIndex.push(0);M.push(j)}}else if(P){let F=P(E.text,E.sectionIndex,D);for(let N of F){let j=new Th;j.text=N[0],j.sectionIndex=N[1],j.sections=E.sections,M.push(j)}}else M=function(F,N){let j=[],U=F.text,G=0;for(let Y of N)j.push(F.substring(G,Y)),G=Y;return G<U.length&&j.push(F.substring(G,U.length)),j}(E,D);let O=[],R={positionedLines:O,text:E.toString(),top:v[1],bottom:v[1],left:v[0],right:v[0],writingMode:y,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(F,N,j,U,G,Y,Z,tt,$,rt,st,pt){let nt=0,ot=0,vt=0,bt=tt==="right"?1:tt==="left"?0:.5,yt=!1;for(let te of G){let ee=te.getSections();for(let de of ee){if(de.imageName)continue;let me=N[de.fontStack];if(me&&(yt=me.ascender!==void 0&&me.descender!==void 0,!yt))break}if(!yt)break}let Ct=0;for(let te of G){te.trim();let ee=te.getMaxScale(),de=(ee-1)*So,me={positionedGlyphs:[],lineOffset:0};F.positionedLines[Ct]=me;let Ge=me.positionedGlyphs,Ie=0;if(!te.length()){ot+=Y,++Ct;continue}let Ui=0,Mi=0;for(let je=0;je<te.length();je++){let ke=te.getSection(je),Ii=te.getSectionIndex(je),Vi=te.getCodePoint(je),gi=ke.scale,bn=null,Ar=null,mn=null,jn=So,zr=0,kr=!($===Jn.horizontal||!st&&!q1(Vi)||st&&(h0[Vi]||(Et=Vi,De.Arabic(Et)||De["Arabic Supplement"](Et)||De["Arabic Extended-A"](Et)||De["Arabic Presentation Forms-A"](Et)||De["Arabic Presentation Forms-B"](Et))));if(ke.imageName){let $n=U[ke.imageName];if(!$n)continue;mn=ke.imageName,F.iconsInText=F.iconsInText||!0,Ar=$n.paddedRect;let an=$n.displaySize;gi=gi*So/pt,bn={width:an[0],height:an[1],left:0,top:-Wk,advance:kr?an[1]:an[0],localGlyph:!1},zr=yt?-bn.height*gi:$k+ee*So-an[1]*gi,jn=bn.advance;let Po=(kr?an[0]:an[1])*gi-So*ee;Po>0&&Po>Ie&&(Ie=Po)}else{let $n=j[ke.fontStack];if(!$n)continue;$n[Vi]&&(Ar=$n[Vi]);let an=N[ke.fontStack];if(!an)continue;let Po=an.glyphs[Vi];if(!Po)continue;if(bn=Po.metrics,jn=Vi!==8203?So:0,yt){let Ol=an.ascender!==void 0?Math.abs(an.ascender):0,vc=an.descender!==void 0?Math.abs(an.descender):0,yc=(Ol+vc)*gi;Ui<yc&&(Ui=yc,Mi=(Ol-vc)/2*gi),zr=-Ol*gi}else zr=$k+(ee-gi)*So}kr?(F.verticalizable=!0,Ge.push({glyph:Vi,imageName:mn,x:nt,y:ot+zr,vertical:kr,scale:gi,localGlyph:bn.localGlyph,fontStack:ke.fontStack,sectionIndex:Ii,metrics:bn,rect:Ar}),nt+=jn*gi+rt):(Ge.push({glyph:Vi,imageName:mn,x:nt,y:ot+zr,vertical:kr,scale:gi,localGlyph:bn.localGlyph,fontStack:ke.fontStack,sectionIndex:Ii,metrics:bn,rect:Ar}),nt+=bn.advance*gi+rt)}Ge.length!==0&&(vt=Math.max(nt-rt,vt),yt?Qk(Ge,bt,Ie,Mi,Y*ee/2):Qk(Ge,bt,Ie,0,Y/2)),nt=0;let qe=Y*ee+Ie;me.lineOffset=Math.max(Ie,de),ot+=qe,++Ct}var Et;let It=ot,{horizontalAlign:xt,verticalAlign:Ft}=m0(Z);(function(te,ee,de,me,Ge,Ie){let Ui=(ee-de)*Ge,Mi=-Ie*me;for(let qe of te)for(let je of qe.positionedGlyphs)je.x+=Ui,je.y+=Mi})(F.positionedLines,bt,xt,Ft,vt,It),F.top+=-Ft*It,F.bottom=F.top+It,F.left+=-xt*vt,F.right=F.left+vt,F.hasBaseline=yt}(R,t,i,o,M,h,p,f,y,g,b,C),!function(F){for(let N of F)if(N.positionedGlyphs.length!==0)return!1;return!0}(O)&&R}let h0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},B8={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Yk(e,t,i,o,c,u){if(t.imageName){let h=o[t.imageName];return h?h.displaySize[0]*t.scale*So/u+c:0}{let h=i[t.fontStack],p=h&&h.glyphs[e];return p?p.metrics.advance*t.scale+c:0}}function Zk(e,t,i,o){let c=Math.pow(e-t,2);return o?e<t?c/2:2*c:c+Math.abs(i)*i}function V8(e,t,i){let o=0;return e===10&&(o-=1e4),i&&(o+=150),e!==40&&e!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function Xk(e,t,i,o,c,u){let h=null,p=Zk(t,i,c,u);for(let f of o){let g=Zk(t-f.x,i,c,u)+f.badness;g<=p&&(h=f,p=g)}return{index:e,x:t,priorBreak:h,badness:p}}function Kk(e){return e?Kk(e.priorBreak).concat(e.index):[]}function m0(e){let t=.5,i=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function Qk(e,t,i,o,c){if(!(t||i||o||c))return;let u=e.length-1,h=e[u],p=(h.x+h.metrics.advance*h.scale)*t;for(let f=0;f<=u;f++)e[f].x-=p,e[f].y+=i+o+c}function j8(e,t,i,o){let{horizontalAlign:c,verticalAlign:u}=m0(o),h=i[0]-e.displaySize[0]*c,p=i[1]-e.displaySize[1]*u;return{imagePrimary:e,imageSecondary:t,top:p,bottom:p+e.displaySize[1],left:h,right:h+e.displaySize[0]}}function Jk(e,t,i,o,c,u){let h=e.imagePrimary,p;if(h.content){let M=h.content,D=h.pixelRatio||1;p=[M[0]/D,M[1]/D,h.displaySize[0]-M[2]/D,h.displaySize[1]-M[3]/D]}let f=t.left*u,g=t.right*u,v,y,b,x;i==="width"||i==="both"?(x=c[0]+f-o[3],y=c[0]+g+o[1]):(x=c[0]+(f+g-h.displaySize[0])/2,y=x+h.displaySize[0]);let C=t.top*u,E=t.bottom*u;return i==="height"||i==="both"?(v=c[1]+C-o[0],b=c[1]+E+o[2]):(v=c[1]+(C+E-h.displaySize[1])/2,b=v+h.displaySize[1]),{imagePrimary:h,imageSecondary:void 0,top:v,right:y,bottom:b,left:x,collisionPadding:p}}class _c extends Q{constructor(t,i,o,c,u){super(t,i),this.angle=c,this.z=o,u!==void 0&&(this.segment=u)}clone(){return new _c(this.x,this.y,this.z,this.angle,this.segment)}}function tR(e,t,i,o,c){if(t.segment===void 0)return!0;let u=t,h=t.segment+1,p=0;for(;p>-i/2;){if(h--,h<0)return!1;p-=e[h].dist(u),u=e[h]}p+=e[h].dist(e[h+1]),h++;let f=[],g=0;for(;p<i/2;){let v=e[h],y=e[h+1];if(!y)return!1;let b=e[h-1].angleTo(v)-v.angleTo(y);for(b=Math.abs((b+3*Math.PI)%(2*Math.PI)-Math.PI),f.push({distance:p,angleDelta:b}),g+=b;p-f[0].distance>o;)g-=f.shift().angleDelta;if(g>c)return!1;h++,p+=v.dist(y)}return!0}function eR(e){let t=0;for(let i=0;i<e.length-1;i++)t+=e[i].dist(e[i+1]);return t}function iR(e,t,i){return e?.6*t*i:0}function nR(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function U8(e,t,i,o,c,u){let h=iR(i,c,u),p=nR(i,o)*u,f=0,g=eR(e)/2;for(let v=0;v<e.length-1;v++){let y=e[v],b=e[v+1],x=y.dist(b);if(f+x>g){let C=(g-f)/x,E=Ye(y.x,b.x,C),M=Ye(y.y,b.y,C),D=new _c(E,M,0,b.angleTo(y),v);return!h||tR(e,D,p,h,t)?D:void 0}f+=x}}function H8(e,t,i,o,c,u,h,p,f){let g=iR(o,u,h),v=nR(o,c),y=v*h,b=e[0].x===0||e[0].x===f||e[0].y===0||e[0].y===f;return t-y<t/4&&(t=y+t/4),rR(e,b?t/2*p%t:(v/2+2*u)*h*p%t,t,g,i,y,b,!1,f)}function rR(e,t,i,o,c,u,h,p,f){let g=u/2,v=eR(e),y=0,b=t-i,x=[];for(let C=0;C<e.length-1;C++){let E=e[C],M=e[C+1],D=E.dist(M),A=M.angleTo(E);for(;b+i<y+D;){b+=i;let P=(b-y)/D,O=Ye(E.x,M.x,P),R=Ye(E.y,M.y,P);if(O>=0&&O<f&&R>=0&&R<f&&b-g>=0&&b+g<=v){let F=new _c(O,R,0,A,C);o&&!tR(e,F,u,o,c)||x.push(F)}}y+=D}return p||x.length||h||(x=rR(e,y/2,i,o,c,u,h,!0,f)),x}function oR(e,t,i,o,c){let u=[];for(let h=0;h<e.length;h++){let p=e[h],f;for(let g=0;g<p.length-1;g++){let v=p[g],y=p[g+1];v.x<t&&y.x<t||(v.x<t?v=new Q(t,v.y+(t-v.x)/(y.x-v.x)*(y.y-v.y))._round():y.x<t&&(y=new Q(t,v.y+(t-v.x)/(y.x-v.x)*(y.y-v.y))._round()),v.y<i&&y.y<i||(v.y<i?v=new Q(v.x+(i-v.y)/(y.y-v.y)*(y.x-v.x),i)._round():y.y<i&&(y=new Q(v.x+(i-v.y)/(y.y-v.y)*(y.x-v.x),i)._round()),v.x>=o&&y.x>=o||(v.x>=o?v=new Q(o,v.y+(o-v.x)/(y.x-v.x)*(y.y-v.y))._round():y.x>=o&&(y=new Q(o,v.y+(o-v.x)/(y.x-v.x)*(y.y-v.y))._round()),v.y>=c&&y.y>=c||(v.y>=c?v=new Q(v.x+(c-v.y)/(y.y-v.y)*(y.x-v.x),c)._round():y.y>=c&&(y=new Q(v.x+(c-v.y)/(y.y-v.y)*(y.x-v.x),c)._round()),f&&v.equals(f[f.length-1])||(f=[v],u.push(f)),f.push(y)))))}}return u}function hC(e){let t=0,i=0;for(let h of e)t+=h.w*h.h,i=Math.max(i,h.w);e.sort((h,p)=>p.h-h.h);let o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}],c=0,u=0;for(let h of e)for(let p=o.length-1;p>=0;p--){let f=o[p];if(!(h.w>f.w||h.h>f.h)){if(h.x=f.x,h.y=f.y,u=Math.max(u,h.y+h.h),c=Math.max(c,h.x+h.w),h.w===f.w&&h.h===f.h){let g=o.pop();p<o.length&&(o[p]=g)}else h.h===f.h?(f.x+=h.w,f.w-=h.w):h.w===f.w?(f.y+=h.h,f.h-=h.h):(o.push({x:f.x+h.w,y:f.y,w:f.w-h.w,h:h.h}),f.y+=h.h,f.h-=h.h);break}}return{w:c,h:u,fill:t/(c*u)||0}}Ce(_c,"Anchor");let Ds=1;class mC{constructor(t,{pixelRatio:i,version:o,stretchX:c,stretchY:u,content:h}){this.paddedRect=t,this.pixelRatio=i,this.stretchX=c,this.stretchY=u,this.content=h,this.version=o}get tl(){return[this.paddedRect.x+Ds,this.paddedRect.y+Ds]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ds,this.paddedRect.y+this.paddedRect.h-Ds]}get displaySize(){return[(this.paddedRect.w-2*Ds)/this.pixelRatio,(this.paddedRect.h-2*Ds)/this.pixelRatio]}}class sR{constructor(t,i){let o={},c={};this.haveRenderCallbacks=[];let u=[];this.addImages(t,o,u),this.addImages(i,c,u);let{w:h,h:p}=hC(u),f=new Br({width:h||1,height:p||1});for(let g in t){let v=t[g],y=o[g].paddedRect;Br.copy(v.data,f,{x:0,y:0},{x:y.x+Ds,y:y.y+Ds},v.data)}for(let g in i){let v=i[g],y=c[g].paddedRect,b=y.x+Ds,x=y.y+Ds,C=v.data.width,E=v.data.height;Br.copy(v.data,f,{x:0,y:0},{x:b,y:x},v.data),Br.copy(v.data,f,{x:0,y:E-1},{x:b,y:x-1},{width:C,height:1}),Br.copy(v.data,f,{x:0,y:0},{x:b,y:x+E},{width:C,height:1}),Br.copy(v.data,f,{x:C-1,y:0},{x:b-1,y:x},{width:1,height:E}),Br.copy(v.data,f,{x:0,y:0},{x:b+C,y:x},{width:1,height:E})}this.image=f,this.iconPositions=o,this.patternPositions=c}addImages(t,i,o){for(let c in t){let u=t[c],h={x:0,y:0,w:u.data.width+2*Ds,h:u.data.height+2*Ds};o.push(h),i[c]=new mC(h,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(t,i,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>t.hasImage(c,o)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,o);for(let c in t.getUpdatedImages(o))this.patchUpdatedImage(this.iconPositions[c],t.getImage(c,o),i),this.patchUpdatedImage(this.patternPositions[c],t.getImage(c,o),i)}patchUpdatedImage(t,i,o){if(!t||!i||t.version===i.version)return;t.version=i.version;let[c,u]=t.tl;o.update(i.data,void 0,{x:c,y:u})}}Ce(mC,"ImagePosition"),Ce(sR,"ImageAtlas");let Hp=1e20;function aR(e,t,i,o,c,u,h,p,f){for(let g=t;g<t+o;g++)lR(e,i*u+g,u,c,h,p,f);for(let g=i;g<i+c;g++)lR(e,g*u+t,1,o,h,p,f)}function lR(e,t,i,o,c,u,h){u[0]=0,h[0]=-Hp,h[1]=Hp,c[0]=e[t];for(let p=1,f=0,g=0;p<o;p++){c[p]=e[t+p*i];let v=p*p;do{let y=u[f];g=(c[p]-c[y]+v-y*y)/(p-y)/2}while(g<=h[f]&&--f>-1);f++,u[f]=p,h[f]=g,h[f+1]=Hp}for(let p=0,f=0;p<o;p++){for(;h[f+1]<p;)f++;let g=u[f],v=p-g;e[t+p*i]=c[g]+v*v}}let Ja=2;class Ih{constructor(t,i,o){this.requestManager=t,this.localGlyphMode=i,this.localFontFamily=o,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t,i){this.urls[i]=t}getGlyphs(t,i,o){let c=[],u=this.urls[i]||S.GLYPHS_URL;for(let h in t)for(let p of t[h])c.push({stack:h,id:p});_s(c,({stack:h,id:p},f)=>{let g=this.entries[h];g||(g=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let v=g.glyphs[p];if(v!==void 0)return void f(null,{stack:h,id:p,glyph:v});if(v=this._tinySDF(g,h,p),v)return g.glyphs[p]=v,void f(null,{stack:h,id:p,glyph:v});let y=Math.floor(p/256);if(256*y>65535)return void f(new Error("glyphs > 65535 not supported"));if(g.ranges[y])return void f(null,{stack:h,id:p,glyph:v});let b=g.requests[y];b||(b=g.requests[y]=[],Ih.loadGlyphRange(h,y,u,this.requestManager,(x,C)=>{if(C){g.ascender=C.ascender,g.descender=C.descender;for(let E in C.glyphs)this._doesCharSupportLocalGlyph(+E)||(g.glyphs[+E]=C.glyphs[+E]);g.ranges[y]=!0}for(let E of b)E(x,C);delete g.requests[y]})),b.push((x,C)=>{x?f(x):C&&f(null,{stack:h,id:p,glyph:C.glyphs[p]||null})})},(h,p)=>{if(h)o(h);else if(p){let f={};for(let{stack:g,id:v,glyph:y}of p)f[g]===void 0&&(f[g]={}),f[g].glyphs===void 0&&(f[g].glyphs={}),f[g].glyphs[v]=y&&{id:y.id,bitmap:y.bitmap.clone(),metrics:y.metrics},f[g].ascender=this.entries[g].ascender,f[g].descender=this.entries[g].descender;o(null,f)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==0&&(this.localGlyphMode===2?!!this.localFontFamily:!!this.localFontFamily&&(De["CJK Unified Ideographs"](t)||De["Hangul Syllables"](t)||De.Hiragana(t)||De.Katakana(t)||De["CJK Symbols and Punctuation"](t)||De["CJK Unified Ideographs Extension A"](t)||De["CJK Unified Ideographs Extension B"](t)))}_tinySDF(t,i,o){let c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(o))return;let u=t.tinySDF;if(!u){let E="400";/bold/i.test(i)?E="900":/medium/i.test(i)?E="500":/light/i.test(i)&&(E="200"),u=t.tinySDF=new Ih.TinySDF({fontFamily:c,fontWeight:E,fontSize:24*Ja,buffer:3*Ja,radius:8*Ja}),u.fontWeight=E}if(this.localGlyphs[u.fontWeight][o])return this.localGlyphs[u.fontWeight][o];let h=String.fromCodePoint(o),{data:p,width:f,height:g,glyphWidth:v,glyphHeight:y,glyphLeft:b,glyphTop:x,glyphAdvance:C}=u.draw(h);return this.localGlyphs[u.fontWeight][o]={id:o,bitmap:new fc({width:f,height:g},p),metrics:{width:v/Ja,height:y/Ja,left:b/Ja,top:x/Ja-27,advance:C/Ja,localGlyph:!0}}}}Ih.loadGlyphRange=function(e,t,i,o,c){let u=256*t,h=u+255,p=o.transformRequest(o.normalizeGlyphsURL(i).replace("{fontstack}",e).replace("{range}",`${u}-${h}`),Dt.Glyphs);ne(p,(f,g)=>{if(f)c(f);else if(g){let v={},y=function(b){return new d0(b).readFields(L8,{})}(g);for(let b of y.glyphs)v[b.id]=b;c(null,{glyphs:v,ascender:y.ascender,descender:y.descender})}})},Ih.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:i=8,cutoff:o=.25,fontFamily:c="sans-serif",fontWeight:u="normal",fontStyle:h="normal"}={}){this.buffer=t,this.cutoff=o,this.radius=i;let p=this.size=e+4*t,f=this._createCanvas(p),g=this.ctx=f.getContext("2d",{willReadFrequently:!0});g.font=`${h} ${u} ${e}px ${c}`,g.textBaseline="alphabetic",g.textAlign="left",g.fillStyle="black",this.gridOuter=new Float64Array(p*p),this.gridInner=new Float64Array(p*p),this.f=new Float64Array(p),this.z=new Float64Array(p+1),this.v=new Uint16Array(p)}_createCanvas(e){let t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){let{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:o,actualBoundingBoxLeft:c,actualBoundingBoxRight:u}=this.ctx.measureText(e),h=Math.ceil(i),p=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(u-c))),f=Math.min(this.size-this.buffer,h+Math.ceil(o)),g=p+2*this.buffer,v=f+2*this.buffer,y=Math.max(g*v,0),b=new Uint8ClampedArray(y),x={data:b,width:g,height:v,glyphWidth:p,glyphHeight:f,glyphTop:h,glyphLeft:0,glyphAdvance:t};if(p===0||f===0)return x;let{ctx:C,buffer:E,gridInner:M,gridOuter:D}=this;C.clearRect(E,E,p,f),C.fillText(e,E,E+h);let A=C.getImageData(E,E,p,f);D.fill(Hp,0,y),M.fill(0,0,y);for(let P=0;P<f;P++)for(let O=0;O<p;O++){let R=A.data[4*(P*p+O)+3]/255;if(R===0)continue;let F=(P+E)*g+O+E;if(R===1)D[F]=0,M[F]=Hp;else{let N=.5-R;D[F]=N>0?N*N:0,M[F]=N<0?N*N:0}}aR(D,0,0,g,v,g,this.f,this.v,this.z),aR(M,E,E,p,f,g,this.f,this.v,this.z);for(let P=0;P<y;P++){let O=Math.sqrt(D[P])-Math.sqrt(M[P]);b[P]=Math.round(255-255*(O/this.radius+this.cutoff))}return x}};let od=Ds;function cR(e,t,i,o){let c=[],u=e.imagePrimary,h=u.pixelRatio,p=u.paddedRect.w-2*od,f=u.paddedRect.h-2*od,g=e.right-e.left,v=e.bottom-e.top,y=u.stretchX||[[0,p]],b=u.stretchY||[[0,f]],x=(Y,Z)=>Y+Z[1]-Z[0],C=y.reduce(x,0),E=b.reduce(x,0),M=p-C,D=f-E,A=0,P=C,O=0,R=E,F=0,N=M,j=0,U=D;if(u.content&&o){let Y=u.content;A=p0(y,0,Y[0]),O=p0(b,0,Y[1]),P=p0(y,Y[0],Y[2]),R=p0(b,Y[1],Y[3]),F=Y[0]-A,j=Y[1]-O,N=Y[2]-Y[0]-P,U=Y[3]-Y[1]-R}let G=(Y,Z,tt,$)=>{let rt=f0(Y.stretch-A,P,g,e.left),st=g0(Y.fixed-F,N,Y.stretch,C),pt=f0(Z.stretch-O,R,v,e.top),nt=g0(Z.fixed-j,U,Z.stretch,E),ot=f0(tt.stretch-A,P,g,e.left),vt=g0(tt.fixed-F,N,tt.stretch,C),bt=f0($.stretch-O,R,v,e.top),yt=g0($.fixed-j,U,$.stretch,E),Ct=new Q(rt,pt),Et=new Q(ot,pt),It=new Q(ot,bt),xt=new Q(rt,bt),Ft=new Q(st/h,nt/h),te=new Q(vt/h,yt/h),ee=t*Math.PI/180;if(ee){let Mi=Math.sin(ee),qe=Math.cos(ee),je=[qe,-Mi,Mi,qe];Ct._matMult(je),Et._matMult(je),xt._matMult(je),It._matMult(je)}let de=Y.stretch+Y.fixed,me=tt.stretch+tt.fixed,Ge=Z.stretch+Z.fixed,Ie=$.stretch+$.fixed,Ui=e.imageSecondary;return{tl:Ct,tr:Et,bl:xt,br:It,texPrimary:{x:u.paddedRect.x+od+de,y:u.paddedRect.y+od+Ge,w:me-de,h:Ie-Ge},texSecondary:Ui?{x:Ui.paddedRect.x+od+de,y:Ui.paddedRect.y+od+Ge,w:me-de,h:Ie-Ge}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ft,pixelOffsetBR:te,minFontScaleX:N/h/g,minFontScaleY:U/h/v,isSDF:i}};if(o&&(u.stretchX||u.stretchY)){let Y=dR(y,M,C),Z=dR(b,D,E);for(let tt=0;tt<Y.length-1;tt++){let $=Y[tt],rt=Y[tt+1];for(let st=0;st<Z.length-1;st++)c.push(G($,Z[st],rt,Z[st+1]))}}else c.push(G({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:p+1},{fixed:0,stretch:f+1}));return c}function p0(e,t,i){let o=0;for(let c of e)o+=Math.max(t,Math.min(i,c[1]))-Math.max(t,Math.min(i,c[0]));return o}function dR(e,t,i){let o=[{fixed:-od,stretch:0}];for(let[c,u]of e){let h=o[o.length-1];o.push({fixed:c-h.stretch,stretch:h.stretch}),o.push({fixed:c-h.stretch,stretch:h.stretch+(u-c)})}return o.push({fixed:t+od,stretch:i}),o}function f0(e,t,i,o){return e/t*i+o}function g0(e,t,i,o){return e-t*i/o}function G8(e,t,i,o){let c=t+e.positionedLines[o].lineOffset;return o===0?i+c/2:i+(c+(t+e.positionedLines[o-1].lineOffset))/2}function q8(e,t=1,i=!1){let o=1/0,c=1/0,u=-1/0,h=-1/0,p=e[0];for(let x=0;x<p.length;x++){let C=p[x];(!x||C.x<o)&&(o=C.x),(!x||C.y<c)&&(c=C.y),(!x||C.x>u)&&(u=C.x),(!x||C.y>h)&&(h=C.y)}let f=Math.min(u-o,h-c),g=f/2,v=new o1([],W8);if(f===0)return new Q(o,c);for(let x=o;x<u;x+=f)for(let C=c;C<h;C+=f)v.push(new Ah(x+g,C+g,g,e));let y=function(x){let C=0,E=0,M=0,D=x[0];for(let A=0,P=D.length,O=P-1;A<P;O=A++){let R=D[A],F=D[O],N=R.x*F.y-F.x*R.y;E+=(R.x+F.x)*N,M+=(R.y+F.y)*N,C+=3*N}return new Ah(E/C,M/C,0,x)}(e),b=v.length;for(;v.length;){let x=v.pop();(x.d>y.d||!y.d)&&(y=x,i&&console.log("found best %d after %d probes",Math.round(1e4*x.d)/1e4,b)),x.max-y.d<=t||(g=x.h/2,v.push(new Ah(x.p.x-g,x.p.y-g,g,e)),v.push(new Ah(x.p.x+g,x.p.y-g,g,e)),v.push(new Ah(x.p.x-g,x.p.y+g,g,e)),v.push(new Ah(x.p.x+g,x.p.y+g,g,e)),b+=4)}return i&&(console.log(`num probes: ${b}`),console.log(`best distance: ${y.d}`)),y.p}function W8(e,t){return t.max-e.max}class Ah{constructor(t,i,o,c){this.p=new Q(t,i),this.h=o,this.d=function(u,h){let p=!1,f=1/0;for(let g=0;g<h.length;g++){let v=h[g];for(let y=0,b=v.length,x=b-1;y<b;x=y++){let C=v[y],E=v[x];C.y>u.y!=E.y>u.y&&u.x<(E.x-C.x)*(u.y-C.y)/(E.y-C.y)+C.x&&(p=!p),f=Math.min(f,uk(u,C,E))}}return(p?1:-1)*Math.sqrt(f)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}}let kh=7,pC=Number.POSITIVE_INFINITY,$8=Math.sqrt(2);function fC(e,[t,i]){let o=0,c=0;if(i===pC){t<0&&(t=0);let u=t/$8;switch(e){case"top-right":case"top-left":c=u-kh;break;case"bottom-right":case"bottom-left":c=-u+kh;break;case"bottom":c=-t+kh;break;case"top":c=t-kh}switch(e){case"top-right":case"bottom-right":o=-u;break;case"top-left":case"bottom-left":o=u;break;case"left":o=t;break;case"right":o=-t}}else{switch(t=Math.abs(t),i=Math.abs(i),e){case"top-right":case"top-left":case"top":c=i-kh;break;case"bottom-right":case"bottom-left":case"bottom":c=-i+kh}switch(e){case"top-right":case"bottom-right":case"right":o=-t;break;case"top-left":case"bottom-left":case"left":o=t}}return[o,c]}function Y8(e,t,i,o,c,u,h,p,f,g,v){e.createArrays(),e.tilePixelRatio=wt/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;let y=e.layers[0].layout,b=e.layers[0]._unevaluatedLayout._values,x={};if(e.textSizeData.kind==="composite"){let{minZoom:D,maxZoom:A}=e.textSizeData;x.compositeTextSizes=[b["text-size"].possiblyEvaluate(new ir(D),p),b["text-size"].possiblyEvaluate(new ir(A),p)]}if(e.iconSizeData.kind==="composite"){let{minZoom:D,maxZoom:A}=e.iconSizeData;x.compositeIconSizes=[b["icon-size"].possiblyEvaluate(new ir(D),p),b["icon-size"].possiblyEvaluate(new ir(A),p)]}x.layoutTextSize=b["text-size"].possiblyEvaluate(new ir(f+1),p),x.layoutIconSize=b["icon-size"].possiblyEvaluate(new ir(f+1),p),x.textMaxSize=b["text-size"].possiblyEvaluate(new ir(18),p);let C=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point",E=y.get("text-size"),M=!1;for(let D of e.features)if(D.icon&&D.icon.nameSecondary){M=!0;break}for(let D of e.features){let A=y.get("text-font").evaluate(D,{},p).join(","),P=E.evaluate(D,{},p),O=x.layoutTextSize.evaluate(D,{},p),R=(x.layoutIconSize.evaluate(D,{},p),{horizontal:{},vertical:void 0}),F=D.text,N,j=[0,0];if(F){let Y=F.toString(),Z=y.get("text-letter-spacing").evaluate(D,{},p)*So,tt=y.get("text-line-height").evaluate(D,{},p)*So,$=x6(Y)?Z:0,rt=y.get("text-anchor").evaluate(D,{},p),st=y.get("text-variable-anchor");if(!st){let bt=y.get("text-radial-offset").evaluate(D,{},p);j=bt?fC(rt,[bt*So,pC]):y.get("text-offset").evaluate(D,{},p).map(yt=>yt*So)}let pt=C?"center":y.get("text-justify").evaluate(D,{},p),nt=y.get("symbol-placement")==="point",ot=nt?y.get("text-max-width").evaluate(D,{},p)*So:1/0,vt=bt=>{e.allowVerticalPlacement&&G1(Y)&&(R.vertical=uC(F,t,i,c,A,ot,tt,rt,bt,$,j,Jn.vertical,!0,O,P))};if(!C&&st){let bt=pt==="auto"?st.map(Ct=>gC(Ct)):[pt],yt=!1;for(let Ct=0;Ct<bt.length;Ct++){let Et=bt[Ct];if(!R.horizontal[Et])if(yt)R.horizontal[Et]=R.horizontal[0];else{let It=uC(F,t,i,c,A,ot,tt,"center",Et,$,j,Jn.horizontal,!1,O,P);It&&(R.horizontal[Et]=It,yt=It.positionedLines.length===1)}}vt("left")}else{if(pt==="auto"&&(pt=gC(rt)),nt||y.get("text-writing-mode").indexOf("horizontal")>=0||!G1(Y)){let bt=uC(F,t,i,c,A,ot,tt,rt,pt,$,j,Jn.horizontal,!1,O,P);bt&&(R.horizontal[pt]=bt)}vt(nt?"left":pt)}}let U=!1;if(D.icon&&D.icon.namePrimary){let Y=o[D.icon.namePrimary];Y&&(N=j8(c[D.icon.namePrimary],D.icon.nameSecondary?c[D.icon.nameSecondary]:void 0,y.get("icon-offset").evaluate(D,{},p),y.get("icon-anchor").evaluate(D,{},p)),U=Y.sdf,e.sdfIcons===void 0?e.sdfIcons=Y.sdf:e.sdfIcons!==Y.sdf&&lt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Y.pixelRatio!==e.pixelRatio||y.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}let G=hR(R.horizontal)||R.vertical;e.iconsInText||(e.iconsInText=!!G&&G.iconsInText),(G||N)&&Z8(e,D,R,N,o,x,O,0,j,U,h,p,g,v,M)}u&&e.generateCollisionDebugBuffers(f,e.collisionBoxArray)}function gC(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Z8(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C){let E=u.textMaxSize.evaluate(t,{},y);E===void 0&&(E=h);let M=e.layers[0].layout,D=M.get("icon-offset").evaluate(t,{},y),A=hR(i.horizontal)||i.vertical,P=b.name==="globe",O=So,R=h/O,F=e.tilePixelRatio*E/O,N=(rt=e.overscaling,e.zoom>18&&rt>2&&(rt>>=1),Math.max(wt/(512*rt),1)*M.get("symbol-spacing")),j=M.get("text-padding")*e.tilePixelRatio,U=M.get("icon-padding")*e.tilePixelRatio,G=fe(M.get("text-max-angle")),Y=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",Z=M.get("icon-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",tt=M.get("symbol-placement"),$=N/2;var rt;let st=M.get("icon-text-fit").evaluate(t,{},y),pt=M.get("icon-text-fit-padding").evaluate(t,{},y),nt=st!=="none",ot;e.hasAnyIconTextFit===!1&&nt&&(e.hasAnyIconTextFit=!0),o&&nt&&(e.allowVerticalPlacement&&i.vertical&&(ot=Jk(o,i.vertical,st,pt,D,R)),A&&(o=Jk(o,A,st,pt,D,R)));let vt=(bt,yt,Ct)=>{if(yt.x<0||yt.x>=wt||yt.y<0||yt.y>=wt)return;let Et=null;if(P){let{x:It,y:xt,z:Ft}=b.projectTilePoint(yt.x,yt.y,Ct);Et={anchor:new _c(It,xt,Ft,0,void 0),up:b.upVector(Ct,yt.x,yt.y)}}(function(It,xt,Ft,te,ee,de,me,Ge,Ie,Ui,Mi,qe,je,ke,Ii,Vi,gi,bn,Ar,mn,jn,zr,kr,$n,an,Po,Ol){let vc=It.addToLineVertexArray(xt,te),yc,hf,mf,hv,yF,bF,xF,wF=0,CF=0,SF=0,EF=0,gS=-1,_S=-1,Fl={},MF=fw(""),pu=Ft?Ft.anchor:xt,vS=Ie.layout.get("icon-text-fit").evaluate(jn,{},an)!=="none",yS=0,bS=0;if(Ie._unevaluatedLayout.getValue("text-radial-offset")===void 0?[yS,bS]=Ie.layout.get("text-offset").evaluate(jn,{},an).map(Is=>Is*So):(yS=Ie.layout.get("text-radial-offset").evaluate(jn,{},an)*So,bS=pC),It.allowVerticalPlacement&&ee.vertical){let Is=ee.vertical;if(Ii)bF=_C(Is),Ge&&(xF=_C(Ge));else{let As=Ie.layout.get("text-rotate").evaluate(jn,{},an)+90;mf=_0(Ui,pu,xt,Mi,qe,je,Is,ke,As,Vi),Ge&&(hv=_0(Ui,pu,xt,Mi,qe,je,Ge,bn,As))}}if(de){let Is=Ie.layout.get("icon-rotate").evaluate(jn,{},an),As=cR(de,Is,kr,vS),Uh=Ge?cR(Ge,Is,kr,vS):void 0;hf=_0(Ui,pu,xt,Mi,qe,je,de,bn,Is),wF=4*As.length;let DF=It.iconSizeData,fu=null;DF.kind==="source"?(fu=[Qa*Ie.layout.get("icon-size").evaluate(jn,{},an)],fu[0]>sd&&lt(`${It.layerIds[0]}: Value for "icon-size" is >= ${Gp}. Reduce your "icon-size".`)):DF.kind==="composite"&&(fu=[Qa*zr.compositeIconSizes[0].evaluate(jn,{},an),Qa*zr.compositeIconSizes[1].evaluate(jn,{},an)],(fu[0]>sd||fu[1]>sd)&&lt(`${It.layerIds[0]}: Value for "icon-size" is >= ${Gp}. Reduce your "icon-size".`)),It.addSymbols(It.icon,As,fu,mn,Ar,jn,!1,Ft,xt,vc.lineStartIndex,vc.lineLength,-1,$n,an,Po,Ol),gS=It.icon.placedSymbolArray.length-1,Uh&&(CF=4*Uh.length,It.addSymbols(It.icon,Uh,fu,mn,Ar,jn,Jn.vertical,Ft,xt,vc.lineStartIndex,vc.lineLength,-1,$n,an,Po,Ol),_S=It.icon.placedSymbolArray.length-1)}for(let Is in ee.horizontal){let As=ee.horizontal[Is];yc||(MF=fw(As.text),Ii?yF=_C(As):yc=_0(Ui,pu,xt,Mi,qe,je,As,ke,Ie.layout.get("text-rotate").evaluate(jn,{},an),Vi));let Uh=As.positionedLines.length===1;if(SF+=uR(It,Ft,xt,As,me,Ie,Ii,jn,Vi,vc,ee.vertical?Jn.horizontal:Jn.horizontalOnly,Uh?Object.keys(ee.horizontal):[Is],Fl,gS,zr,$n,an,Po),Uh)break}ee.vertical&&(EF+=uR(It,Ft,xt,ee.vertical,me,Ie,Ii,jn,Vi,vc,Jn.vertical,["vertical"],Fl,_S,zr,$n,an,Po));let md=-1,xS=(Is,As)=>Is?Math.max(Is,As):As;md=xS(yF,md),md=xS(bF,md),md=xS(xF,md);let P$=md>-1?1:0;It.glyphOffsetArray.length>=Zp.MAX_GLYPHS&&lt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),jn.sortKey!==void 0&&It.addToSortKeyRanges(It.symbolInstances.length,jn.sortKey),It.symbolInstances.emplaceBack(xt.x,xt.y,pu.x,pu.y,pu.z,Fl.right>=0?Fl.right:-1,Fl.center>=0?Fl.center:-1,Fl.left>=0?Fl.left:-1,Fl.vertical>=0?Fl.vertical:-1,gS,_S,MF,yc!==void 0?yc:It.collisionBoxArray.length,yc!==void 0?yc+1:It.collisionBoxArray.length,mf!==void 0?mf:It.collisionBoxArray.length,mf!==void 0?mf+1:It.collisionBoxArray.length,hf!==void 0?hf:It.collisionBoxArray.length,hf!==void 0?hf+1:It.collisionBoxArray.length,hv||It.collisionBoxArray.length,hv?hv+1:It.collisionBoxArray.length,Mi,SF,EF,wF,CF,P$,0,yS,bS,md,0,vS?1:0)})(e,yt,Et,bt,i,o,c,ot,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,j,Y,f,0,U,Z,D,t,u,g,v,y,x,C)};if(tt==="line")for(let bt of oR(t.geometry,0,0,wt,wt)){let yt=H8(bt,N,G,i.vertical||A,o,O,F,e.overscaling,wt);for(let Ct of yt)A&&X8(e,A.text,$,Ct)||vt(bt,Ct,y)}else if(tt==="line-center"){for(let bt of t.geometry)if(bt.length>1){let yt=U8(bt,G,i.vertical||A,o,O,F);yt&&vt(bt,yt,y)}}else if(t.type==="Polygon")for(let bt of nC(t.geometry,0)){let yt=q8(bt,16);vt(bt[0],new _c(yt.x,yt.y,0,0,void 0),y)}else if(t.type==="LineString")for(let bt of t.geometry)vt(bt,new _c(bt[0].x,bt[0].y,0,0,void 0),y);else if(t.type==="Point")for(let bt of t.geometry)for(let yt of bt)vt([yt],new _c(yt.x,yt.y,0,0,void 0),y)}let Gp=255,sd=Gp*Qa;function uR(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M,D){let A=function(R,F,N,j,U,G,Y,Z){let tt=[];if(F.positionedLines.length===0)return tt;let $=j.layout.get("text-rotate").evaluate(G,{})*Math.PI/180,rt=function(vt){let bt=vt[0],yt=vt[1],Ct=bt*yt;return Ct>0?[bt,-yt]:Ct<0?[-bt,yt]:bt===0?[yt,bt]:[yt,-bt]}(N),st=Math.abs(F.top-F.bottom);for(let vt of F.positionedLines)st-=vt.lineOffset;let pt=F.positionedLines.length,nt=st/pt,ot=F.top-N[1];for(let vt=0;vt<pt;++vt){let bt=F.positionedLines[vt];ot=G8(F,nt,ot,vt);for(let yt of bt.positionedGlyphs){if(!yt.rect)continue;let Ct=yt.rect||{},Et=Wk+1,It=!0,xt=1,Ft=0;if(yt.imageName){let mn=Y[yt.imageName];if(!mn)continue;if(mn.sdf){lt("SDF images are not supported in formatted text and will be ignored.");continue}It=!1,xt=mn.pixelRatio,Et=Ds/xt}let te=(U||Z)&&yt.vertical,ee=yt.metrics.advance*yt.scale/2,de=yt.metrics,me=yt.rect;if(me===null)continue;Z&&F.verticalizable&&(Ft=yt.imageName?ee-yt.metrics.width*yt.scale/2:0);let Ge=U?[yt.x+ee,yt.y]:[0,0],Ie=[0,0],Ui=[0,0],Mi=!1;U||(te?(Ui=[yt.x+ee+rt[0],yt.y+rt[1]-Ft],Mi=!0):Ie=[yt.x+ee+N[0],yt.y+N[1]-Ft]);let qe=me.w*yt.scale/(xt*(yt.localGlyph?Ja:1)),je=me.h*yt.scale/(xt*(yt.localGlyph?Ja:1)),ke,Ii,Vi,gi;if(te){let mn=yt.y-ot,jn=new Q(-ee,ee-mn),zr=-Math.PI/2,kr=new Q(...Ui);ke=new Q(-ee+Ie[0],Ie[1]),ke._rotateAround(zr,jn)._add(kr),ke.x+=-mn+ee,ke.y-=(de.left-Et)*yt.scale;let $n=yt.imageName?de.advance*yt.scale:So*yt.scale,an=String.fromCodePoint(yt.glyph);O8(an)?ke.x+=(1-Et)*yt.scale:F8(an)?ke.x+=$n-de.height*yt.scale+(-Et-1)*yt.scale:ke.x+=yt.imageName||de.width+2*Et===me.w&&de.height+2*Et===me.h?($n-je)/2:($n-(de.height+2*Et)*yt.scale)/2,Ii=new Q(ke.x,ke.y-qe),Vi=new Q(ke.x+je,ke.y),gi=new Q(ke.x+je,ke.y-qe)}else{let mn=(de.left-Et)*yt.scale-ee+Ie[0],jn=(-de.top-Et)*yt.scale+Ie[1],zr=mn+qe,kr=jn+je;ke=new Q(mn,jn),Ii=new Q(zr,jn),Vi=new Q(mn,kr),gi=new Q(zr,kr)}if($){let mn;mn=U?new Q(0,0):Mi?new Q(rt[0],rt[1]):new Q(N[0],N[1]),ke._rotateAround($,mn),Ii._rotateAround($,mn),Vi._rotateAround($,mn),gi._rotateAround($,mn)}let bn=new Q(0,0),Ar=new Q(0,0);tt.push({tl:ke,tr:Ii,bl:Vi,br:gi,texPrimary:Ct,texSecondary:void 0,writingMode:F.writingMode,glyphOffset:Ge,sectionIndex:yt.sectionIndex,isSDF:It,pixelOffsetTL:bn,pixelOffsetBR:Ar,minFontScaleX:0,minFontScaleY:0})}}return tt}(0,o,f,u,h,p,c,e.allowVerticalPlacement),P=e.textSizeData,O=null;P.kind==="source"?(O=[Qa*u.layout.get("text-size").evaluate(p,{},M)],O[0]>sd&&lt(`${e.layerIds[0]}: Value for "text-size" is >= ${Gp}. Reduce your "text-size".`)):P.kind==="composite"&&(O=[Qa*C.compositeTextSizes[0].evaluate(p,{},M),Qa*C.compositeTextSizes[1].evaluate(p,{},M)],(O[0]>sd||O[1]>sd)&&lt(`${e.layerIds[0]}: Value for "text-size" is >= ${Gp}. Reduce your "text-size".`)),e.addSymbols(e.text,A,O,f,h,p,v,t,i,g.lineStartIndex,g.lineLength,x,E,M,D,!1);for(let R of y)b[R]=e.text.placedSymbolArray.length-1;return 4*A.length}function hR(e){for(let t in e)return e[t];return null}function _0(e,t,i,o,c,u,h,p,f,g){let v=h.top,y=h.bottom,b=h.left,x=h.right,C=h.collisionPadding;if(C&&(b-=C[0],v-=C[1],x+=C[2],y+=C[3]),f){let E=new Q(b,v),M=new Q(x,v),D=new Q(b,y),A=new Q(x,y),P=fe(f),O=new Q(0,0);g&&(O=new Q(g[0],g[1])),E._rotateAround(P,O),M._rotateAround(P,O),D._rotateAround(P,O),A._rotateAround(P,O),b=Math.min(E.x,M.x,D.x,A.x),x=Math.max(E.x,M.x,D.x,A.x),v=Math.min(E.y,M.y,D.y,A.y),y=Math.max(E.y,M.y,D.y,A.y)}return e.emplaceBack(t.x,t.y,t.z,i.x,i.y,b,v,x,y,p,o,c,u),e.length-1}function _C(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);let t=e.bottom-e.top;return t>0?Math.max(10,t):null}function X8(e,t,i,o){let c=e.compareText;if(t in c){let u=c[t];for(let h=u.length-1;h>=0;h--)if(o.dist(u[h])<i)return!0}else c[t]=[];return c[t].push(o),!1}function mR(e,t){let i=e.fovAboveCenter,o=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,c=(e._camera.position[2]*e.worldSize-o)/Math.cos(e._pitch),u=Math.sin(i)*c/Math.sin(Math.max(Math.PI/2-e._pitch-i,.01)),h=Math.sin(e._pitch)*u+c;return Math.min(1.01*h,c*(1/e._horizonShift))}function au(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};let i=Math.pow(2,-e.z),o=e.x*i,c=(e.x+1)*i,u=e.y*i,h=(e.y+1)*i,p=Ms(o),f=Ms(c),g=Wr(u),v=Wr(h),y=t.project(p,g),b=t.project(f,g),x=t.project(f,v),C=t.project(p,v),E=Math.min(y.x,b.x,x.x,C.x),M=Math.min(y.y,b.y,x.y,C.y),D=Math.max(y.x,b.x,x.x,C.x),A=Math.max(y.y,b.y,x.y,C.y),P=i/16;function O(F,N,j,U,G,Y){let Z=(j+G)/2,tt=(U+Y)/2,$=t.project(Ms(Z),Wr(tt)),rt=Math.max(0,E-$.x,M-$.y,$.x-D,$.y-A);E=Math.min(E,$.x),D=Math.max(D,$.x),M=Math.min(M,$.y),A=Math.max(A,$.y),rt>P&&(O(F,$,j,U,Z,tt),O($,N,Z,tt,G,Y))}O(y,b,o,u,c,u),O(b,x,c,u,c,h),O(x,C,c,h,o,h),O(C,y,o,h,o,u),E-=P,M-=P,D+=P,A+=P;let R=1/Math.max(D-E,A-M);return{scale:R,x:E*R,y:M*R,x2:D*R,y2:A*R,projection:t}}function pR(e,t,i,o,c,u,h,p,f){if(f.name==="globe")return Bw(e,t,new pa(i,o,c),!1);let g=au({z:i,x:o,y:c},f);return new Vn([(u+g.x/g.scale)*t,t*(g.y/g.scale),h],[(u+g.x2/g.scale)*t,t*(g.y2/g.scale),p])}function fR(e,{x:t,y:i},o=0){return new Q(((t-o)*e.scale-e.x)*wt,(i*e.scale-e.y)*wt)}function gR(e,t,i=0){return J.fromValues(((t.x-i)*e.scale-e.x)*wt,(t.y*e.scale-e.y)*wt,ok(t.z,t.y))}let K8=ft.identity(new Float32Array(16));class ad{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,i){return{x:0,y:0,z:0}}unproject(t,i){return new Ze(0,0)}projectTilePoint(t,i,o){return{x:t,y:i,z:0}}locationPoint(t,i,o=!0){return t._coordinatePoint(t.locationCoordinate(i),o)}pixelsPerMeter(t,i){return yn(1,t)*i}pixelSpaceConversion(t,i,o){return 1}farthestPixelDistance(t){return mR(t,t.pixelsPerMeter)}pointCoordinate(t,i,o,c){let u=t.horizonLineFromTop(!1),h=new Q(i,Math.max(u,o));return t.rayIntersectionCoordinate(t.pointRayIntersection(h,c))}pointCoordinate3D(t,i,o){let c=new Q(i,o);if(t.elevation)return t.elevation.pointCoordinate(c);{let u=this.pointCoordinate(t,c.x,c.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(t,i){if(t.elevation)return!this.pointCoordinate3D(t,i.x,i.y);let o=t.horizonLineFromTop();return i.y<o}createInversionMatrix(t,i){return K8}createTileMatrix(t,i,o){let c,u,h,p=o.canonical,f=ft.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let g=au(p,this);c=1,u=g.x+o.wrap*g.scale,h=g.y,ft.scale(f,f,[c/g.scale,c/g.scale,t.pixelsPerMeter/i])}else c=i/t.zoomScale(p.z),u=(p.x+Math.pow(2,p.z)*o.wrap)*c,h=p.y*c;return ft.translate(f,f,[u,h,0]),ft.scale(f,f,[c/wt,c/wt,1]),f}upVector(t,i,o){return[0,0,1]}upVectorScale(t,i,o){return{metersToTile:1}}}class Q8 extends ad{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];let[i,o]=this.parallels=t.parallels||[29.5,45.5],c=Math.sin(fe(i));this.n=(c+Math.sin(fe(o)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(t,i){let{n:o,c,r0:u}=this,h=fe(t-this.center[0]),p=fe(i),f=Math.sqrt(c-2*o*Math.sin(p))/o;return{x:f*Math.sin(h*o),y:f*Math.cos(h*o)-u,z:0}}unproject(t,i){let{n:o,c,r0:u}=this,h=u+i,p=Math.atan2(t,Math.abs(h))*Math.sign(h);h*o<0&&(p-=Math.PI*Math.sign(t)*Math.sign(h));let f=fe(this.center[0])*o;p=ss(p,-Math.PI-f,Math.PI-f);let g=ve(ei(p/o)+this.center[0],-180,180),v=Math.asin(ve((c-(t*t+h*h)*o*o)/(2*o),-1,1)),y=ve(ei(v),-Ir,Ir);return new Ze(g,y)}}let qp=1.340264,Wp=-.081106,$p=893e-6,Yp=.003796,v0=Math.sqrt(3)/2;class J8 extends ad{project(t,i){i=i/180*Math.PI,t=t/180*Math.PI;let o=Math.asin(v0*Math.sin(i)),c=o*o,u=c*c*c;return{x:.5*(t*Math.cos(o)/(v0*(qp+3*Wp*c+u*(7*$p+9*Yp*c)))/Math.PI+.5),y:1-.5*(o*(qp+Wp*c+u*($p+Yp*c))/Math.PI+1),z:0}}unproject(t,i){t=(2*t-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,c=o*o,u=c*c*c;for(let v,y,b,x=0;x<12&&(y=o*(qp+Wp*c+u*($p+Yp*c))-i,b=qp+3*Wp*c+u*(7*$p+9*Yp*c),v=y/b,o=ve(o-v,-Math.PI/3,Math.PI/3),c=o*o,u=c*c*c,!(Math.abs(v)<1e-12));++x);let h=v0*t*(qp+3*Wp*c+u*(7*$p+9*Yp*c))/Math.cos(o),p=Math.asin(Math.sin(o)/v0),f=ve(180*h/Math.PI,-180,180),g=ve(180*p/Math.PI,-Ir,Ir);return new Ze(f,g)}}class tH extends ad{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,i){return{x:.5+t/360,y:.5-i/360,z:0}}unproject(t,i){let o=360*(t-.5),c=ve(360*(.5-i),-Ir,Ir);return new Ze(o,c)}}let Rh=Math.PI/2;function y0(e){return Math.tan((Rh+e)/2)}class eH extends ad{constructor(t){super(t),this.center=t.center||[0,30];let[i,o]=this.parallels=t.parallels||[30,30],c=fe(i),u=fe(o);this.southernCenter=c+u<0,this.southernCenter&&(c=-c,u=-u);let h=Math.cos(c),p=y0(c);this.n=c===u?Math.sin(c):Math.log(h/Math.cos(u))/Math.log(y0(u)/p),this.f=h*Math.pow(y0(c),this.n)/this.n}project(t,i){i=fe(i),this.southernCenter&&(i=-i),t=fe(t-this.center[0]);let o=1e-6,{n:c,f:u}=this;u>0?i<-Rh+o&&(i=-Rh+o):i>Rh-o&&(i=Rh-o);let h=u/Math.pow(y0(i),c),p=h*Math.sin(c*t),f=u-h*Math.cos(c*t);return p=.5*(p/Math.PI+.5),f=.5*(f/Math.PI+.5),{x:p,y:this.southernCenter?f:1-f,z:0}}unproject(t,i){t=(2*t-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;let{n:o,f:c}=this,u=c-i,h=Math.sign(u),p=Math.sign(o)*Math.sqrt(t*t+u*u),f=Math.atan2(t,Math.abs(u))*h;u*o<0&&(f-=Math.PI*Math.sign(t)*h);let g=ve(ei(f/o)+this.center[0],-180,180),v=ve(ei(2*Math.atan(Math.pow(c/p,1/o))-Rh),-Ir,Ir);return new Ze(g,this.southernCenter?-v:v)}}class _R extends ad{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,i){return{x:eo(t),y:uo(i),z:0}}unproject(t,i){let o=Ms(t),c=Wr(i);return new Ze(o,c)}}let vR=fe(Ir);class iH extends ad{project(t,i){let o=(i=fe(i))*i,c=o*o;return{x:.5*((t=fe(t))*(.8707-.131979*o+c*(c*(.003971*o-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+o*(.015085+c*(.028874*o-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(t,i){t=(2*t-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,c=25,u=0,h=o*o;do{h=o*o;let g=h*h;u=(o*(1.007226+h*(.015085+g*(.028874*h-.044475-.005916*g)))-i)/(1.007226+h*(.045255+g*(.259866*h-.311325-.005916*11*g))),o=ve(o-u,-vR,vR)}while(Math.abs(u)>1e-6&&--c>0);h=o*o;let p=ve(ei(t/(.8707+h*(h*(h*h*h*(.003971-.001529*h)-.013791)-.131979))),-180,180),f=ei(o);return new Ze(p,f)}}let yR=fe(Ir);class nH extends ad{project(t,i){i=fe(i),t=fe(t);let o=Math.cos(i),c=2/Math.PI,u=Math.acos(o*Math.cos(t/2)),h=Math.sin(u)/u,p=.5*(t*c+2*o*Math.sin(t/2)/h)||0,f=.5*(i+Math.sin(i)/h)||0;return{x:.5*(p/Math.PI+.5),y:1-.5*(f/Math.PI+1),z:0}}unproject(t,i){let o=t=(2*t-.5)*Math.PI,c=i=(2*(1-i)-1)*Math.PI,u=25,h=1e-6,p=0,f=0;do{let g=Math.cos(c),v=Math.sin(c),y=2*v*g,b=v*v,x=g*g,C=Math.cos(o/2),E=Math.sin(o/2),M=2*C*E,D=E*E,A=1-x*C*C,P=A?1/A:0,O=A?Math.acos(g*C)*Math.sqrt(1/A):0,R=.5*(2*O*g*E+2*o/Math.PI)-t,F=.5*(O*v+c)-i,N=.5*P*(x*D+O*g*C*b)+1/Math.PI,j=P*(M*y/4-O*v*E),U=.125*P*(y*E-O*v*x*M),G=.5*P*(b*C+O*D*g)+.5,Y=j*U-G*N;p=(F*j-R*G)/Y,f=(R*U-F*N)/Y,o=ve(o-p,-Math.PI,Math.PI),c=ve(c-f,-yR,yR)}while((Math.abs(p)>h||Math.abs(f)>h)&&--u>0);return new Ze(ei(o),ei(c))}}class bR extends ad{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(fe(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,i){let{scale:o,cosPhi:c}=this;return{x:fe(t)*c*o+.5,y:-Math.sin(fe(i))/c*o+.5,z:0}}unproject(t,i){let{scale:o,cosPhi:c}=this,u=-(i-.5)/o,h=ve(ei((t-.5)/o)/c,-180,180),p=Math.asin(ve(u*c,-1,1)),f=ve(ei(p),-Ir,Ir);return new Ze(h,f)}}class rH extends _R{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,i,o){let c=Fp(t,i,o),u=Jc(Zs(o));return J.transformMat4(c,c,u),{x:c[0],y:c[1],z:c[2]}}locationPoint(t,i){let o=hs(i.lat,i.lng),c=J.normalize([],o),u=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(i),t._centerAltitude):t._centerAltitude,h=yn(1,0)*wt*u;J.scaleAndAdd(o,o,c,h);let p=ft.identity(new Float64Array(16));return ft.multiply(p,t.pixelMatrix,t.globeMatrix),J.transformMat4(o,o,p),new Q(o[0],o[1])}pixelsPerMeter(t,i){return yn(1,0)*i}pixelSpaceConversion(t,i,o){let c=yn(1,t)*i,u=Ye(yn(1,45)*i,c,o);return this.pixelsPerMeter(t,i)/u}createTileMatrix(t,i,o){let c=jw(Zs(o.canonical));return ft.multiply(new Float64Array(16),t.globeMatrix,c)}createInversionMatrix(t,i){let{center:o}=t,c=Jc(Zs(i));return ft.rotateY(c,c,fe(o.lng)),ft.rotateX(c,c,fe(o.lat)),ft.scale(c,c,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(t,i,o,c){return WA(t,i,o,!0)||new Fi(0,0)}pointCoordinate3D(t,i,o){let c=this.pointCoordinate(t,i,o,0);return[c.x,c.y,c.z]}isPointAboveHorizon(t,i){return!WA(t,i.x,i.y,!1)}farthestPixelDistance(t){let i=function(c,u){let h=c.cameraToCenterDistance,p=c._centerAltitude*u,f=c._camera,g=c._camera.forward(),v=J.add([],J.scale([],g,-h),[0,0,p]),y=c.worldSize/(2*Math.PI),b=[0,0,-y],x=c.width/c.height,C=Math.tan(c.fovAboveCenter),E=J.scale([],f.up(),C),M=J.scale([],f.right(),C*x),D=J.normalize([],J.add([],J.add([],g,E),M)),A=[],P;if(new H_(v,D).closestPointOnSphere(b,y,A)){let O=J.add([],A,b),R=J.sub([],O,v);P=Math.cos(c.fovAboveCenter)*J.length(R)}else{let O=J.sub([],v,b),R=J.sub([],b,v);J.normalize(R,R);let F=J.length(O)-y;P=Math.sqrt(F*(F+2*y));let N=Math.acos(P/(y+F))-Math.acos(J.dot(g,R));P*=Math.cos(N)}return 1.01*P}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),o=Co(t.zoom);if(o>0){let c=mR(t,yn(1,t.center.lat)*t.worldSize),u=t.worldSize/(2*Math.PI),h=Math.max(t.width,t.height)/t.worldSize*Math.PI;return Ye(i,c+u*(1-Math.cos(h)),Math.pow(o,10))}return i}upVector(t,i,o){return Fp(i,o,t,1)}upVectorScale(t){return{metersToTile:G_(W_(Zs(t)))}}}function b0(e){let t=e.parallels,i=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new _R(e);case"equirectangular":return new tH(e);case"naturalEarth":return new iH(e);case"equalEarth":return new J8(e);case"winkelTripel":return new nH(e);case"albers":return i?new bR(e):new Q8(e);case"lambertConformalConic":return i?new bR(e):new eH(e);case"globe":return new rH(e)}throw new Error(`Invalid projection name: ${e.name}`)}let oH=new yr({"symbol-placement":new Ut(_t.layout_symbol["symbol-placement"]),"symbol-spacing":new Ut(_t.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ut(_t.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Re(_t.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ut(_t.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Ut(_t.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Ut(_t.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ut(_t.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ut(_t.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ut(_t.layout_symbol["icon-rotation-alignment"]),"icon-size":new Re(_t.layout_symbol["icon-size"]),"icon-text-fit":new Re(_t.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Re(_t.layout_symbol["icon-text-fit-padding"]),"icon-image":new Re(_t.layout_symbol["icon-image"]),"icon-rotate":new Re(_t.layout_symbol["icon-rotate"]),"icon-padding":new Ut(_t.layout_symbol["icon-padding"]),"icon-keep-upright":new Ut(_t.layout_symbol["icon-keep-upright"]),"icon-offset":new Re(_t.layout_symbol["icon-offset"]),"icon-anchor":new Re(_t.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ut(_t.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ut(_t.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ut(_t.layout_symbol["text-rotation-alignment"]),"text-field":new Re(_t.layout_symbol["text-field"]),"text-font":new Re(_t.layout_symbol["text-font"]),"text-size":new Re(_t.layout_symbol["text-size"]),"text-max-width":new Re(_t.layout_symbol["text-max-width"]),"text-line-height":new Re(_t.layout_symbol["text-line-height"]),"text-letter-spacing":new Re(_t.layout_symbol["text-letter-spacing"]),"text-justify":new Re(_t.layout_symbol["text-justify"]),"text-radial-offset":new Re(_t.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ut(_t.layout_symbol["text-variable-anchor"]),"text-anchor":new Re(_t.layout_symbol["text-anchor"]),"text-max-angle":new Ut(_t.layout_symbol["text-max-angle"]),"text-writing-mode":new Ut(_t.layout_symbol["text-writing-mode"]),"text-rotate":new Re(_t.layout_symbol["text-rotate"]),"text-padding":new Ut(_t.layout_symbol["text-padding"]),"text-keep-upright":new Ut(_t.layout_symbol["text-keep-upright"]),"text-transform":new Re(_t.layout_symbol["text-transform"]),"text-offset":new Re(_t.layout_symbol["text-offset"]),"text-allow-overlap":new Ut(_t.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ut(_t.layout_symbol["text-ignore-placement"]),"text-optional":new Ut(_t.layout_symbol["text-optional"]),visibility:new Ut(_t.layout_symbol.visibility)});var vC={paint:new yr({"icon-opacity":new Re(_t.paint_symbol["icon-opacity"]),"icon-emissive-strength":new Re(_t.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Re(_t.paint_symbol["text-emissive-strength"]),"icon-color":new Re(_t.paint_symbol["icon-color"]),"icon-halo-color":new Re(_t.paint_symbol["icon-halo-color"]),"icon-halo-width":new Re(_t.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Re(_t.paint_symbol["icon-halo-blur"]),"icon-translate":new Ut(_t.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ut(_t.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Re(_t.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Re(_t.paint_symbol["text-opacity"]),"text-color":new Re(_t.paint_symbol["text-color"],{runtimeType:ca,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new Re(_t.paint_symbol["text-halo-color"]),"text-halo-width":new Re(_t.paint_symbol["text-halo-width"]),"text-halo-blur":new Re(_t.paint_symbol["text-halo-blur"]),"text-translate":new Ut(_t.paint_symbol["text-translate"]),"text-translate-anchor":new Ut(_t.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Ut(_t.paint_symbol["icon-color-saturation"])}),layout:oH};class xR{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Ju,this.defaultValue=t}evaluate(t){if(t.formattedSection){let i=this.defaultValue.property.overrides;if(i&&i.hasOverride(t.formattedSection))return i.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ce(xR,"FormatSectionOverride",{omit:["defaultValue"]});class x0 extends Ws{constructor(t,i){super(t,vC,i)}recalculate(t,i){super.recalculate(t,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let o=this.layout.get("text-writing-mode");if(o){let c=[];for(let u of o)c.indexOf(u)<0&&c.push(u);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,i,o,c){let u=this.layout.get(t).evaluate(i,{},o,c),h=this._unevaluatedLayout._values[t];return h.isDataDriven()||y_(h.value)||!u?u:function(p,f){return f.replace(/{([^{}]+)}/g,(g,v)=>v in p?String(p[v]):"")}(i.properties,u)}createBucket(t){return new Zp(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let t of vC.paint.overridableProperties){if(!x0.hasPaintOverride(this.layout,t))continue;let i=this.paint.get(t),o=new xR(i),c=new z1(o,i.property.specification),u=null;u=i.value.kind==="constant"||i.value.kind==="source"?new N1("source",c):new Hc("composite",c,i.value.zoomStops,i.value._interpolationType),this.paint._values[t]=new ph(i.property,u,i.parameters)}}_handleOverridablePaintPropertyUpdate(t,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&x0.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,i){let o=t.get("text-field"),c=vC.paint.properties[i],u=!1,h=p=>{for(let f of p)if(c.overrides&&c.overrides.hasOverride(f))return void(u=!0)};if(o.value.kind==="constant"&&o.value.value instanceof xs)h(o.value.value.sections);else if(o.value.kind==="source"){let p=g=>{u||(g instanceof hp&&bo(g.value)===ap?h(g.value.sections):g instanceof mp?h(g.sections):g.eachChild(p))},f=o.value;f._styleExpression&&p(f._styleExpression.expression)}return u}getProgramIds(){let t=this.paint.get("icon-opacity").constantOr(1)!==0,i=this.paint.get("text-opacity").constantOr(1)!==0,o=[];return t&&o.push("symbolIcon"),i&&o.push("symbolSDF"),o}getDefaultProgramParams(t,i){return{config:new nu(this,i),overrideFog:!1}}}let sH=s0.types,aH=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function w0(e,t,i,o,c,u,h,p,f,g,v,y,b){let x=p?Math.min(sd,Math.round(p[0])):0,C=p?Math.min(sd,Math.round(p[1])):0;e.emplaceBack(t,i,Math.round(32*o),Math.round(32*c),u,h,(x<<1)+(f?1:0),C,16*g,16*v,256*y,256*b)}function C0(e,t,i){e.emplaceBack(t,i)}function S0(e,t,i,o,c,u,h){e.emplaceBack(t,i,o,c,u,h)}function E0(e,t,i,o,c){let u=5*t+2;e.float32[u+0]=i,e.float32[u+1]=o,e.float32[u+2]=c}function Ph(e,t,i,o,c){e.emplaceBack(t,i,o,c),e.emplaceBack(t,i,o,c),e.emplaceBack(t,i,o,c),e.emplaceBack(t,i,o,c)}function lH(e){for(let t of e.sections)if(S6(t.text))return!0;return!1}class yC{constructor(t){this.layoutVertexArray=new iw,this.indexArray=new qr,this.programConfigurations=t,this.segments=new un,this.dynamicLayoutVertexArray=new sc,this.opacityVertexArray=new rw,this.placedSymbolArray=new m2,this.iconTransitioningVertexArray=new $c,this.globeExtVertexArray=new nw,this.zOffsetVertexArray=new Dp}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(t,i,o,c,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,S8.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,M8.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,aH,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,T8.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,E8.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||u)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,D8.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||c)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Ce(yC,"SymbolBuffers");class bC{constructor(t,i,o){this.layoutVertexArray=new t,this.layoutAttributes=i,this.indexArray=new o,this.segments=new un,this.collisionVertexArray=new aw,this.collisionVertexArrayExt=new sc}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,I8.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,A8.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ce(bC,"CollisionBuffers");class M0{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(h=>h.fqid),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ft.identity([]),this.placementViewportMatrix=ft.identity([]);let i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=cC(this.zoom,i["text-size"]),this.iconSizeData=cC(this.zoom,i["icon-size"]);let o=this.layers[0].layout,c=o.get("symbol-sort-key"),u=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(h=>Jn[h]),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=o.get("symbol-z-elevate")}createArrays(){this.text=new yC(new Zc(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new yC(new Zc(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new g2,this.lineVertexArray=new _2,this.symbolInstances=new f2}calculateGlyphDependencies(t,i,o,c,u){for(let h=0;h<t.length;h++){let p=t.codePointAt(h);if(p===void 0)break;if(i[p]=!0,c&&u&&p<=65535){let f=jp[t.charAt(h)];f&&(i[f.charCodeAt(0)]=!0)}}}populate(t,i,o,c){let u=this.layers[0],h=u.layout,p=this.projection.name==="globe",f=h.get("text-font"),g=h.get("text-field"),v=h.get("icon-image"),y=(g.value.kind!=="constant"||g.value.value instanceof xs&&!g.value.value.isEmpty()||g.value.value.toString().length>0)&&(f.value.kind!=="constant"||f.value.value.length>0),b=v.value.kind!=="constant"||!!v.value.value||Object.keys(v.parameters).length>0,x=h.get("symbol-sort-key");if(this.features=[],!y&&!b)return;let C=i.iconDependencies,E=i.glyphDependencies,M=i.availableImages,D=new ir(this.zoom);for(let{feature:A,id:P,index:O,sourceLayerIndex:R}of t){let F=u._featureFilter.needGeometry,N=id(A,F);if(!u._featureFilter.filter(D,N,o))continue;if(F||(N.geometry=Dl(A,o,c)),p&&A.type!==1&&o.z<=5){let Y=N.geometry,Z=.98078528056,tt=($,rt)=>{let st=Fp($.x,$.y,o,1),pt=Fp(rt.x,rt.y,o,1);return J.dot(st,pt)<Z};for(let $=0;$<Y.length;$++)Y[$]=_U(Y[$],tt)}let j,U;if(y){let Y=u.getValueAndResolveTokens("text-field",N,o,M),Z=xs.factory(Y);lH(Z)&&(this.hasRTLText=!0),(!this.hasRTLText||Q1()==="unavailable"||this.hasRTLText&&ha.isParsed())&&(j=P8(Z,u,N))}if(b){let Y=u.getValueAndResolveTokens("icon-image",N,o,M);U=Y instanceof da?Y:da.fromString(Y)}if(!j&&!U)continue;let G=this.sortFeaturesByKey?x.evaluate(N,{},o):void 0;if(this.features.push({id:P,text:j,icon:U,index:O,sourceLayerIndex:R,geometry:N.geometry,properties:A.properties,type:sH[A.type],sortKey:G}),U&&(C[U.namePrimary]=!0,U.nameSecondary&&(C[U.nameSecondary]=!0)),j){let Y=f.evaluate(N,{},o).join(","),Z=h.get("text-rotation-alignment")==="map"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Jn.vertical)>=0;for(let tt of j.sections)if(tt.image)C[tt.image.namePrimary]=!0;else{let $=G1(j.toString()),rt=tt.fontStack||Y,st=E[rt]=E[rt]||{};this.calculateGlyphDependencies(tt.text,st,Z,this.allowVerticalPlacement,$)}}}h.get("symbol-placement")==="line"&&(this.features=function(A){let P={},O={},R=[],F=0;function N(Y){R.push(A[Y]),F++}function j(Y,Z,tt){let $=O[Y];return delete O[Y],O[Z]=$,R[$].geometry[0].pop(),R[$].geometry[0]=R[$].geometry[0].concat(tt[0]),$}function U(Y,Z,tt){let $=P[Z];return delete P[Z],P[Y]=$,R[$].geometry[0].shift(),R[$].geometry[0]=tt[0].concat(R[$].geometry[0]),$}function G(Y,Z,tt){let $=tt?Z[0][Z[0].length-1]:Z[0][0];return`${Y}:${$.x}:${$.y}`}for(let Y=0;Y<A.length;Y++){let Z=A[Y],tt=Z.geometry,$=Z.text?Z.text.toString():null;if(!$){N(Y);continue}let rt=G($,tt),st=G($,tt,!0);if(rt in O&&st in P&&O[rt]!==P[st]){let pt=U(rt,st,tt),nt=j(rt,st,R[pt].geometry);delete P[rt],delete O[st],O[G($,R[nt].geometry,!0)]=nt,R[pt].geometry=null}else rt in O?j(rt,st,tt):st in P?U(rt,st,tt):(N(Y),P[rt]=F-1,O[st]=F-1)}return R.filter(Y=>Y.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((A,P)=>A.sortKey-P.sortKey)}update(t,i,o,c,u){let h=Object.keys(t).length!==0;if(h&&!this.stateDependentLayers.length)return;let p=h?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(t,i,p,o,c,u),this.icon.programConfigurations.updatePaintArrays(t,i,p,o,c,u)}updateZOffset(){let t=(u,h,p)=>{o+=h,o>u.length&&u.resize(o);for(let f=-h;f<0;f++)u.emplace(f+o,p)},i=(u,h,p)=>{c+=h,c>u.length&&u.resize(c);for(let f=-h;f<0;f++)u.emplace(f+c,p)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let o=0,c=0;for(let u=0;u<this.symbolInstances.length;u++){let h=this.symbolInstances.get(u),{numHorizontalGlyphVertices:p,numVerticalGlyphVertices:f,numIconVertices:g}=h,v=h.zOffset,y=g>0;if((p>0||f>0)&&(t(this.text.zOffsetVertexArray,p,v),t(this.text.zOffsetVertexArray,f,v)),y){let{placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:x}=h;b>=0&&i(this.icon.zOffsetVertexArray,g,v),x>=0&&i(this.icon.zOffsetVertexArray,h.numVerticalIconVertices,v)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=b0(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,i){let o=this.lineVertexArray.length;if(t.segment!==void 0)for(let{x:c,y:u}of i)this.lineVertexArray.emplaceBack(c,u);return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M){let D=t.indexArray,A=t.layoutVertexArray,P=t.globeExtVertexArray,O=t.segments.prepareSegment(4*i.length,A,D,this.canOverlap?h.sortKey:void 0),R=this.glyphOffsetArray.length,F=O.vertexLength,N=this.allowVerticalPlacement&&p===Jn.vertical?Math.PI/2:0,j=h.text&&h.text.sections;for(let G=0;G<i.length;G++){let{tl:Y,tr:Z,bl:tt,br:$,texPrimary:rt,texSecondary:st,pixelOffsetTL:pt,pixelOffsetBR:nt,minFontScaleX:ot,minFontScaleY:vt,glyphOffset:bt,isSDF:yt,sectionIndex:Ct}=i[G],Et=O.vertexLength,It=bt[1];if(w0(A,g.x,g.y,Y.x,It+Y.y,rt.x,rt.y,o,yt,pt.x,pt.y,ot,vt),w0(A,g.x,g.y,Z.x,It+Z.y,rt.x+rt.w,rt.y,o,yt,nt.x,pt.y,ot,vt),w0(A,g.x,g.y,tt.x,It+tt.y,rt.x,rt.y+rt.h,o,yt,pt.x,nt.y,ot,vt),w0(A,g.x,g.y,$.x,It+$.y,rt.x+rt.w,rt.y+rt.h,o,yt,nt.x,nt.y,ot,vt),f){let{x:xt,y:Ft,z:te}=f.anchor,[ee,de,me]=f.up;S0(P,xt,Ft,te,ee,de,me),S0(P,xt,Ft,te,ee,de,me),S0(P,xt,Ft,te,ee,de,me),S0(P,xt,Ft,te,ee,de,me),Ph(t.dynamicLayoutVertexArray,xt,Ft,te,N)}else Ph(t.dynamicLayoutVertexArray,g.x,g.y,g.z,N);if(M){let xt=st||rt;C0(t.iconTransitioningVertexArray,xt.x,xt.y),C0(t.iconTransitioningVertexArray,xt.x+xt.w,xt.y),C0(t.iconTransitioningVertexArray,xt.x,xt.y+xt.h),C0(t.iconTransitioningVertexArray,xt.x+xt.w,xt.y+xt.h)}D.emplaceBack(Et,Et+1,Et+2),D.emplaceBack(Et+1,Et+2,Et+3),O.vertexLength+=4,O.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(bt[0]),G!==i.length-1&&Ct===i[G+1].sectionIndex||t.programConfigurations.populatePaintArrays(A.length,h,h.index,{},x,C,E,j&&j[Ct])}let U=f?f.anchor:g;t.placedSymbolArray.emplaceBack(U.x,U.y,U.z,g.x,g.y,R,this.glyphOffsetArray.length-R,F,v,y,g.segment,o?o[0]:0,o?o[1]:0,c[0],c[1],p,0,!1,0,b,0)}_commitLayoutVertex(t,i,o,c,u,h,p){t.emplaceBack(i,o,c,u,h,Math.round(p.x),Math.round(p.y))}_addCollisionDebugVertices(t,i,o,c,u,h,p){let f=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),g=f.vertexLength,v=p.tileAnchorX,y=p.tileAnchorY;for(let x=0;x<4;x++)o.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(o.collisionVertexArrayExt,i,t.padding,p.zOffset),this._commitLayoutVertex(o.layoutVertexArray,c,u,h,v,y,new Q(t.x1,t.y1)),this._commitLayoutVertex(o.layoutVertexArray,c,u,h,v,y,new Q(t.x2,t.y1)),this._commitLayoutVertex(o.layoutVertexArray,c,u,h,v,y,new Q(t.x2,t.y2)),this._commitLayoutVertex(o.layoutVertexArray,c,u,h,v,y,new Q(t.x1,t.y2)),f.vertexLength+=4;let b=o.indexArray;b.emplaceBack(g,g+1),b.emplaceBack(g+1,g+2),b.emplaceBack(g+2,g+3),b.emplaceBack(g+3,g),f.primitiveLength+=4}_addTextDebugCollisionBoxes(t,i,o,c,u,h){for(let p=c;p<u;p++){let f=o.get(p),g=this.getSymbolInstanceTextSize(t,h,i,p);this._addCollisionDebugVertices(f,g,this.textCollisionBox,f.projectedAnchorX,f.projectedAnchorY,f.projectedAnchorZ,h)}}_addIconDebugCollisionBoxes(t,i,o,c,u,h){for(let p=c;p<u;p++){let f=o.get(p),g=this.getSymbolInstanceIconSize(t,i,h.placedIconSymbolIndex);this._addCollisionDebugVertices(f,g,this.iconCollisionBox,f.projectedAnchorX,f.projectedAnchorY,f.projectedAnchorZ,h)}}generateCollisionDebugBuffers(t,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new bC(F_,qk.members,$c),this.iconCollisionBox=new bC(F_,qk.members,$c);let o=Tl(this.iconSizeData,t),c=Tl(this.textSizeData,t);for(let u=0;u<this.symbolInstances.length;u++){let h=this.symbolInstances.get(u);this._addTextDebugCollisionBoxes(c,t,i,h.textBoxStartIndex,h.textBoxEndIndex,h),this._addTextDebugCollisionBoxes(c,t,i,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h),this._addIconDebugCollisionBoxes(o,t,i,h.iconBoxStartIndex,h.iconBoxEndIndex,h),this._addIconDebugCollisionBoxes(o,t,i,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h)}}getSymbolInstanceTextSize(t,i,o,c){let u=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:c),h=Vp(this.textSizeData,t,u)/So;return this.tilePixelRatio*h}getSymbolInstanceIconSize(t,i,o){let c=this.icon.placedSymbolArray.get(o),u=Vp(this.iconSizeData,t,c);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(t,i,o,c){t.emplaceBack(i,-o,-o,c),t.emplaceBack(i,o,-o,c),t.emplaceBack(i,o,o,c),t.emplaceBack(i,-o,o,c)}_updateTextDebugCollisionBoxes(t,i,o,c,u,h){for(let p=c;p<u;p++){let f=o.get(p),g=this.getSymbolInstanceTextSize(t,h,i,p);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,g,f.padding,h.zOffset)}}_updateIconDebugCollisionBoxes(t,i,o,c,u,h){for(let p=c;p<u;p++){let f=o.get(p),g=this.getSymbolInstanceIconSize(t,i,h.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,g,f.padding,h.zOffset)}}updateCollisionDebugBuffers(t,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let o=Tl(this.iconSizeData,t),c=Tl(this.textSizeData,t);for(let u=0;u<this.symbolInstances.length;u++){let h=this.symbolInstances.get(u);this._updateTextDebugCollisionBoxes(c,t,i,h.textBoxStartIndex,h.textBoxEndIndex,h),this._updateTextDebugCollisionBoxes(c,t,i,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h),this._updateIconDebugCollisionBoxes(o,t,i,h.iconBoxStartIndex,h.iconBoxEndIndex,h),this._updateIconDebugCollisionBoxes(o,t,i,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,i,o,c,u,h,p,f,g){let v={};if(i<o){let{x1:y,y1:b,x2:x,y2:C,padding:E,projectedAnchorX:M,projectedAnchorY:D,projectedAnchorZ:A,tileAnchorX:P,tileAnchorY:O,featureIndex:R}=t.get(i);v.textBox={x1:y,y1:b,x2:x,y2:C,padding:E,projectedAnchorX:M,projectedAnchorY:D,projectedAnchorZ:A,tileAnchorX:P,tileAnchorY:O},v.textFeatureIndex=R}if(c<u){let{x1:y,y1:b,x2:x,y2:C,padding:E,projectedAnchorX:M,projectedAnchorY:D,projectedAnchorZ:A,tileAnchorX:P,tileAnchorY:O,featureIndex:R}=t.get(c);v.verticalTextBox={x1:y,y1:b,x2:x,y2:C,padding:E,projectedAnchorX:M,projectedAnchorY:D,projectedAnchorZ:A,tileAnchorX:P,tileAnchorY:O},v.verticalTextFeatureIndex=R}if(h<p){let{x1:y,y1:b,x2:x,y2:C,padding:E,projectedAnchorX:M,projectedAnchorY:D,projectedAnchorZ:A,tileAnchorX:P,tileAnchorY:O,featureIndex:R}=t.get(h);v.iconBox={x1:y,y1:b,x2:x,y2:C,padding:E,projectedAnchorX:M,projectedAnchorY:D,projectedAnchorZ:A,tileAnchorX:P,tileAnchorY:O},v.iconFeatureIndex=R}if(f<g){let{x1:y,y1:b,x2:x,y2:C,padding:E,projectedAnchorX:M,projectedAnchorY:D,projectedAnchorZ:A,tileAnchorX:P,tileAnchorY:O,featureIndex:R}=t.get(f);v.verticalIconBox={x1:y,y1:b,x2:x,y2:C,padding:E,projectedAnchorX:M,projectedAnchorY:D,projectedAnchorZ:A,tileAnchorX:P,tileAnchorY:O},v.verticalIconFeatureIndex=R}return v}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){let o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,i){let o=t.placedSymbolArray.get(i),c=o.vertexStartIndex+4*o.numGlyphs;for(let u=o.vertexStartIndex;u<c;u+=4)t.indexArray.emplaceBack(u,u+1,u+2),t.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let i=Math.sin(t),o=Math.cos(t),c=[],u=[],h=[];for(let p=0;p<this.symbolInstances.length;++p){h.push(p);let f=this.symbolInstances.get(p);c.push(0|Math.round(i*f.tileAnchorX+o*f.tileAnchorY)),u.push(f.featureIndex)}return h.sort((p,f)=>c[p]-c[f]||u[f]-u[p]),h}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((t,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(t).zOffset)}addToSortKeyRanges(t,i){let o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let i of this.symbolInstanceIndexes){let o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex);let{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:u,leftJustifiedTextSymbolIndex:h,verticalPlacedTextSymbolIndex:p,placedIconSymbolIndex:f,verticalPlacedIconSymbolIndex:g}=o;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),u>=0&&u!==c&&this.addIndicesForPlacedSymbol(this.text,u),h>=0&&h!==u&&h!==c&&this.addIndicesForPlacedSymbol(this.text,h),p>=0&&this.addIndicesForPlacedSymbol(this.text,p),f>=0&&this.addIndicesForPlacedSymbol(this.icon,f),g>=0&&this.addIndicesForPlacedSymbol(this.icon,g)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ce(M0,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),M0.MAX_GLYPHS=65535,M0.addDynamicAttributes=Ph;var Zp=M0;let cH=Ji([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:dH}=cH,uH=Ji([{name:"a_packed",components:4,type:"Float32"}]),{members:hH}=uH,mH=s0.types,pH=Math.cos(Math.PI/180*37.5);class D0{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new ew,this.layoutVertexArray2=new sc,this.indexArray=new qr,this.programConfigurations=new Zc(t.layers,t.zoom),this.segments=new un,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,o,c){this.hasPattern=rC("line",this.layers,i);let u=this.layers[0].layout.get("line-sort-key"),h=[];for(let{feature:v,id:y,index:b,sourceLayerIndex:x}of t){let C=this.layers[0]._featureFilter.needGeometry,E=id(v,C);if(!this.layers[0]._featureFilter.filter(new ir(this.zoom),E,o))continue;let M=u?u.evaluate(E,{},o):void 0,D={id:y,properties:v.properties,type:v.type,sourceLayerIndex:x,index:b,geometry:C?E.geometry:Dl(v,o,c),patterns:{},sortKey:M};h.push(D)}u&&h.sort((v,y)=>v.sortKey-y.sortKey);let{lineAtlas:p,featureIndex:f}=i,g=this.addConstantDashes(p);for(let v of h){let{geometry:y,index:b,sourceLayerIndex:x}=v;if(g&&this.addFeatureDashes(v,p),this.hasPattern){let C=oC("line",this.layers,v,this.zoom,i);this.patternFeatures.push(C)}else this.addFeature(v,y,b,o,p.positions,i.availableImages,i.brightness);f.insert(t[b].feature,y,b,x,this.index)}}addConstantDashes(t){let i=!1;for(let o of this.layers){let c=o.paint.get("line-dasharray").value,u=o.layout.get("line-cap").value;if(c.kind!=="constant"||u.kind!=="constant")i=!0;else{let h=u.value,p=c.value;if(!p)continue;t.addDash(p,h)}}return i}addFeatureDashes(t,i){let o=this.zoom;for(let c of this.layers){let u=c.paint.get("line-dasharray").value,h=c.layout.get("line-cap").value;if(u.kind==="constant"&&h.kind==="constant")continue;let p,f;if(u.kind==="constant"){if(p=u.value,!p)continue}else p=u.evaluate({zoom:o},t);f=h.kind==="constant"?h.value:h.evaluate({zoom:o},t),i.addDash(p,f),t.patterns[c.id]=i.getKey(p,f)}}update(t,i,o,c,u){let h=Object.keys(t).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,i,h?this.stateDependentLayers:this.layers,o,c,u)}addFeatures(t,i,o,c,u,h){for(let p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,i,o,c,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,hH)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,dH),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,i,o,c,u,h,p){let f=this.layers[0].layout,g=f.get("line-join").evaluate(t,{}),v=f.get("line-cap").evaluate(t,{}),y=f.get("line-miter-limit"),b=f.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(let x of i)this.addLine(x,t,g,v,y,b);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,u,h,c,p)}addLine(t,i,o,c,u,h){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let D=0;D<t.length-1;D++)this.totalDistance+=t[D].dist(t[D+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let p=mH[i.type]==="Polygon",f=t.length;for(;f>=2&&t[f-1].equals(t[f-2]);)f--;let g=0;for(;g<f-1&&t[g].equals(t[g+1]);)g++;if(f<(p?3:2))return;o==="bevel"&&(u=1.05);let v=this.overscaling<=16?15*wt/(512*this.overscaling):0,y=this.segments.prepareSegment(10*f,this.layoutVertexArray,this.indexArray),b,x,C,E,M;this.e1=this.e2=-1,p&&(b=t[f-2],M=t[g].sub(b)._unit()._perp());for(let D=g;D<f;D++){if(C=D===f-1?p?t[g+1]:void 0:t[D+1],C&&t[D].equals(C))continue;M&&(E=M),b&&(x=b),b=t[D],M=C?C.sub(b)._unit()._perp():E,E=E||M;let A=E.add(M);A.x===0&&A.y===0||A._unit();let P=E.x*M.x+E.y*M.y,O=A.x*M.x+A.y*M.y,R=O!==0?1/O:1/0,F=2*Math.sqrt(2-2*O),N=O<pH&&x&&C,j=E.x*M.y-E.y*M.x>0;if(N&&D>g){let Y=b.dist(x);if(Y>2*v){let Z=b.sub(b.sub(x)._mult(v/Y)._round());this.updateDistance(x,Z),this.addCurrentVertex(Z,E,0,0,y),x=Z}}let U=x&&C,G=U?o:p?"butt":c;if(U&&G==="round"&&(R<h?G="miter":R<=2&&(G="fakeround")),G==="miter"&&R>u&&(G="bevel"),G==="bevel"&&(R>2&&(G="flipbevel"),R<u&&(G="miter")),x&&this.updateDistance(x,b),G==="miter")A._mult(R),this.addCurrentVertex(b,A,0,0,y);else if(G==="flipbevel"){if(R>100)A=M.mult(-1);else{let Y=R*E.add(M).mag()/E.sub(M).mag();A._perp()._mult(Y*(j?-1:1))}this.addCurrentVertex(b,A,0,0,y),this.addCurrentVertex(b,A.mult(-1),0,0,y)}else if(G==="bevel"||G==="fakeround"){let Y=-Math.sqrt(R*R-1),Z=j?Y:0,tt=j?0:Y;if(x&&this.addCurrentVertex(b,E,Z,tt,y),G==="fakeround"){let $=Math.round(180*F/Math.PI/20);for(let rt=1;rt<$;rt++){let st=rt/$;if(st!==.5){let nt=st-.5;st+=st*nt*(st-1)*((1.0904+P*(P*(3.55645-1.43519*P)-3.2452))*nt*nt+(.848013+P*(.215638*P-1.06021)))}let pt=M.sub(E)._mult(st)._add(E)._unit()._mult(j?-1:1);this.addHalfVertex(b,pt.x,pt.y,!1,j,0,y)}}C&&this.addCurrentVertex(b,M,-Z,-tt,y)}else if(G==="butt")this.addCurrentVertex(b,A,0,0,y);else if(G==="square"){let Y=x?1:-1;x||this.addCurrentVertex(b,A,Y,Y,y),this.addCurrentVertex(b,A,0,0,y),x&&this.addCurrentVertex(b,A,Y,Y,y)}else G==="round"&&(x&&(this.addCurrentVertex(b,E,0,0,y),this.addCurrentVertex(b,E,1,1,y,!0)),C&&(this.addCurrentVertex(b,M,-1,-1,y,!0),this.addCurrentVertex(b,M,0,0,y)));if(N&&D<f-1){let Y=b.dist(C);if(Y>2*v){let Z=b.add(C.sub(b)._mult(v/Y)._round());this.updateDistance(b,Z),this.addCurrentVertex(Z,M,0,0,y),b=Z}}}}addCurrentVertex(t,i,o,c,u,h=!1){let p=i.y*c-i.x,f=-i.y-i.x*c;this.addHalfVertex(t,i.x+i.y*o,i.y-i.x*o,h,!1,o,u),this.addHalfVertex(t,p,f,h,!0,-c,u)}addHalfVertex({x:t,y:i},o,c,u,h,p,f){this.layoutVertexArray.emplaceBack((t<<1)+(u?1:0),(i<<1)+(h?1:0),Math.round(63*o)+128,Math.round(63*c)+128,1+(p===0?0:p<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let g=f.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,g),f.primitiveLength++),h?this.e2=g:this.e1=g}updateScaledDistance(){if(this.lineClips){let t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,i){this.distance+=t.dist(i),this.updateScaledDistance()}}Ce(D0,"LineBucket",{omit:["layers","patternFeatures"]});class or{constructor(t,i,o,c){this.context=t,this.format=o,this.texture=t.gl.createTexture(),this.update(i,c)}update(t,i,o){let{width:c,height:u}=t,{context:h}=this,{gl:p}=h,{HTMLImageElement:f,HTMLCanvasElement:g,HTMLVideoElement:v,ImageData:y,ImageBitmap:b}=m;if(p.bindTexture(p.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===p.RGBA&&(!i||i.premultiply!==!1)),o||this.size&&this.size[0]===c&&this.size[1]===u){let{x,y:C}=o||{x:0,y:0};if(t instanceof f||t instanceof g||t instanceof v||t instanceof y||b&&t instanceof b)p.texSubImage2D(p.TEXTURE_2D,0,x,C,p.RGBA,p.UNSIGNED_BYTE,t);else{let E=this.format,M=p.UNSIGNED_BYTE;this.format===p.R32F&&(E=p.RED,M=p.FLOAT),p.texSubImage2D(p.TEXTURE_2D,0,x,C,c,u,E,M,t.data)}}else if(this.size=[c,u],t instanceof f||t instanceof g||t instanceof v||t instanceof y||b&&t instanceof b){let x=this.format;this.format===p.R8&&(x=p.RED),p.texImage2D(p.TEXTURE_2D,0,this.format,x,p.UNSIGNED_BYTE,t)}else{let x=this.format,C=this.format,E=p.UNSIGNED_BYTE;this.format===p.DEPTH_COMPONENT&&(x=p.DEPTH_COMPONENT16,E=p.UNSIGNED_SHORT),this.format===p.R32F&&(E=p.FLOAT,C=p.RED),p.texImage2D(p.TEXTURE_2D,0,x,c,u,0,C,E,t.data)}this.useMipmap=!!(i&&i.useMipmap),this.useMipmap&&p.generateMipmap(p.TEXTURE_2D)}bind(t,i){let{context:o}=this,{gl:c}=o;c.bindTexture(c.TEXTURE_2D,this.texture),t!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,t),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap?t===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_NEAREST:t),this.minFilter=t),i!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,i),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(t,i,o,c){let{context:u}=this,{gl:h}=u;h.bindTexture(h.TEXTURE_2D,this.texture),i!==this.magFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,i),this.magFilter=i),t!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?t===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:t),this.minFilter=t),o!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),this.wrapS=o),c!==this.wrapT&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,c),this.wrapT=c)}destroy(){let{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class T0{constructor(t,i){this.context=t,this.texture=i}bind(t,i){let{context:o}=this,{gl:c}=o;c.bindTexture(c.TEXTURE_2D,this.texture),t!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,t),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,t),this.minFilter=t),i!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,i),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,i),this.wrapS=i)}}let _a=32,Il=33,ld=new Uint16Array(8184);for(let e=0;e<2046;e++){let t=e+2,i=0,o=0,c=0,u=0,h=0,p=0;for(1&t?c=u=h=_a:i=o=p=_a;(t>>=1)>1;){let g=i+c>>1,v=o+u>>1;1&t?(c=i,u=o,i=h,o=p):(i=c,o=u,c=h,u=p),h=g,p=v}let f=4*e;ld[f+0]=i,ld[f+1]=o,ld[f+2]=c,ld[f+3]=u}let Al=new Uint16Array(2178),cd=new Uint8Array(1089),I0=new Uint16Array(1089);function wR(e){return e===0?-.03125:e===32?.03125:0}var xC=Ji([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);let CR={type:2,extent:wt,loadGeometry:()=>[[new Q(0,0),new Q(wt+1,0),new Q(wt+1,wt+1),new Q(0,wt+1),new Q(0,0)]]};class Xp{constructor(t,i,o,c,u){this.tileID=t,this.uid=Wu(),this.uses=0,this.tileSize=i,this.tileZoom=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=u,c&&c.style&&(this._lastUpdatedBrightness=c.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",c&&c.transform&&(this.projection=c.transform.projection)}registerFadeDuration(t){let i=t+this.timeAdded;i<ii.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=au(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,i,o){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(c,u){let h={};if(!u)return h;for(let p of c){let f=p.layerIds.map(g=>u.getLayer(g)).filter(Boolean);if(f.length!==0){p.layers=f,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(g=>f.filter(v=>v.id===g)[0]));for(let g of f)h[g.fqid]=p}}return h}(t.buckets,i.style),this.hasSymbolBuckets=!1;for(let c in this.buckets){let u=this.buckets[c];if(u instanceof Zp){if(this.hasSymbolBuckets=!0,!o)break;u.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let c in this.buckets){let u=this.buckets[c];if(u instanceof Zp&&u.hasRTLText){this.hasRTLText=!0,ha.isLoading()||ha.isLoaded()||Q1()!=="deferred"||o2();break}}this.queryPadding=0;for(let c in this.buckets){let u=this.buckets[c],h=i.style.getOwnLayer(c);if(!h)continue;let p=h.queryRadius(u);this.queryPadding=Math.max(this.queryPadding,p)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new pw}unloadVectorData(){if(this.hasData()){for(let t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.fqid]}upload(t){for(let o in this.buckets){let c=this.buckets[o];c.uploadPending()&&c.upload(t)}let i=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new or(t,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new or(t,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new or(t,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t,i,o){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,o),!i||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let c=i.style.getBrightness();(this._lastUpdatedBrightness||c)&&(this._lastUpdatedBrightness&&c&&Math.abs(this._lastUpdatedBrightness-c)<.001||(this._lastUpdatedBrightness=c,this.updateBuckets(void 0,i)))}queryRenderedFeatures(t,i,o,c,u,h,p,f){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:c,pixelPosMatrix:p,transform:h,params:u,tileTransform:this.tileTransform},t,i,o):{}}querySourceFeatures(t,i){let o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;let c=o.loadVTLayers(),u=i?i.sourceLayer:"",h=c._geojsonTileLayer||c[u];if(!h)return;let p=C_(i&&i.filter),{z:f,x:g,y:v}=this.tileID.canonical,y={z:f,x:g,y:v};for(let b=0;b<h.length;b++){let x=h.feature(b);if(p.needGeometry){let M=id(x,!0);if(!p.filter(new ir(this.tileID.overscaledZ),M,this.tileID.canonical))continue}else if(!p.filter(new ir(this.tileID.overscaledZ),x))continue;let C=o.getId(x,u),E=new Lk(x,f,g,v,C);E.tile=y,t.push(E)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(let t in this.buckets)if(this.buckets[t].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){let i=this.expirationTime;if(t.cacheControl){let o=Pe(t.cacheControl);o["max-age"]&&(this.expirationTime=Date.now()+1e3*o["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){let o=Date.now(),c=!1;if(this.expirationTime>o)c=!1;else if(i)if(this.expirationTime<i)c=!0;else{let u=this.expirationTime-i;u?this.expirationTime=o+Math.max(u,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,i){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0&&i&&this.updateBuckets(t,i)}updateBuckets(t,i){if(!this.latestFeatureIndex)return;let o=this.latestFeatureIndex.loadVTLayers(),c=i.style.listImages(),u=i.style.getBrightness();for(let h in this.buckets){if(!i.style.hasLayer(h))continue;let p=this.buckets[h],f=p.layers[0].sourceLayer||"_geojsonTileLayer",g=o[f],v={};if(t&&(v=t[f],!g||!v||Object.keys(v).length===0))continue;if(p.update(v,g,c,this.imageAtlas&&this.imageAtlas.patternPositions||{},u),p instanceof D0||p instanceof r0){let b=i.style.getOwnSourceCache(p.layers[0].source);i._terrain&&i._terrain.enabled&&b&&p.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(b.id,this.tileID)}let y=i&&i.style&&i.style.getOwnLayer(h);y&&(this.queryPadding=Math.max(this.queryPadding,y.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ii.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=ii.now()+t}setTexture(t,i){let o=i.context,c=o.gl;this.texture=this.texture||i.getTileTexture(t.width),this.texture&&this.texture instanceof or?this.texture.update(t,{useMipmap:!0}):(this.texture=new or(o,t,c.RGBA,{useMipmap:!0}),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE))}setDependencies(t,i){let o={};for(let c of i)o[c]=!0;this.dependencies[t]=o}hasDependency(t,i){for(let o of t){let c=this.dependencies[o];if(c){for(let u of i)if(c[u])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;let o=Dl(CR,this.tileID.canonical,this.tileTransform)[0],c=new Cs,u=new Tp;for(let h=0;h<o.length;h++){let{x:p,y:f}=o[h];c.emplaceBack(p,f),u.emplaceBack(h)}u.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(u),this._tileDebugBuffer=t.createVertexBuffer(c,Kc.members),this._tileDebugSegments=un.simpleSegment(0,0,c.length,u.length)}_makeTileBoundsBuffers(t,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;let o=Dl(CR,this.tileID.canonical,this.tileTransform)[0],c,u;if(this.isRaster){let h=function(p,f){let g=au(p,f),v=Math.pow(2,p.z);for(let M=0;M<Il;M++)for(let D=0;D<Il;D++){let A=Ms((p.x+(D+wR(D))/_a)/v),P=Wr((p.y+(M+wR(M))/_a)/v),O=f.project(A,P),R=M*Il+D;Al[2*R+0]=Math.round((O.x*g.scale-g.x)*wt),Al[2*R+1]=Math.round((O.y*g.scale-g.y)*wt)}cd.fill(0),I0.fill(0);for(let M=2045;M>=0;M--){let D=4*M,A=ld[D+0],P=ld[D+1],O=ld[D+2],R=ld[D+3],F=A+O>>1,N=P+R>>1,j=F+N-P,U=N+A-F,G=P*Il+A,Y=R*Il+O,Z=N*Il+F,tt=Math.hypot((Al[2*G+0]+Al[2*Y+0])/2-Al[2*Z+0],(Al[2*G+1]+Al[2*Y+1])/2-Al[2*Z+1])>=16;cd[Z]=cd[Z]||(tt?1:0),M<1022&&(cd[Z]=cd[Z]||cd[(P+U>>1)*Il+(A+j>>1)]||cd[(R+U>>1)*Il+(O+j>>1)])}let y=new tu,b=new qr,x=0;function C(M,D){let A=D*Il+M;return I0[A]===0&&(y.emplaceBack(Al[2*A+0],Al[2*A+1],M*wt/_a,D*wt/_a),I0[A]=++x),I0[A]-1}function E(M,D,A,P,O,R){let F=M+A>>1,N=D+P>>1;if(Math.abs(M-O)+Math.abs(D-R)>1&&cd[N*Il+F])E(O,R,M,D,F,N),E(A,P,O,R,F,N);else{let j=C(M,D),U=C(A,P),G=C(O,R);b.emplaceBack(j,U,G)}}return E(0,0,_a,_a,_a,0),E(_a,_a,0,0,0,_a),{vertices:y,indices:b}}(this.tileID.canonical,i);c=h.vertices,u=h.indices}else{c=new tu,u=new qr;for(let{x:p,y:f}of o)c.emplaceBack(p,f,0,0);let h=n0(c.int16,void 0,4);for(let p=0;p<h.length;p+=3)u.emplaceBack(h[p],h[p+1],h[p+2])}this._tileBoundsBuffer=t.createVertexBuffer(c,xC.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(u),this._tileBoundsSegments=un.simpleSegment(0,0,c.length,u.length)}_makeGlobeTileDebugBuffers(t,i){let o=i.projection;if(!o||o.name!=="globe"||i.freezeTileCoverage)return;let c=this.tileID.canonical,u=Jc($A(c,i)),h=Co(i.zoom),p;h>0&&(p=ft.invert(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,c,i,u,p,h),this._makeGlobeTileDebugTextBuffer(t,c,i,u,p,h)}_globePoint(t,i,o,c,u,h,p){let f=Fp(t,i,o);if(h){let g=1<<o.z,v=eo(c.center.lng),y=uo(c.center.lat),b=(o.x+.5)/g-v,x=0;b>.5?x=-1:b<-.5&&(x=1);let C=(t/wt+o.x)/g+x,E=(i/wt+o.y)/g;C=(C-v)*c._pixelsPerMercatorPixel+v,E=(E-y)*c._pixelsPerMercatorPixel+y;let M=[C*c.worldSize,E*c.worldSize,0];J.transformMat4(M,M,h),f=pc(f,M,p)}return J.transformMat4(f,f,u)}_makeGlobeTileDebugBorderBuffer(t,i,o,c,u,h){let p=new Cs,f=new Tp,g=new R_,v=(b,x,C,E,M)=>{let D=(C-b)/(M-1),A=(E-x)/(M-1),P=p.length;for(let O=0;O<M;O++){let R=b+O*D,F=x+O*A;p.emplaceBack(R,F);let N=this._globePoint(R,F,i,o,c,u,h);g.emplaceBack(N[0],N[1],N[2]),f.emplaceBack(P+O)}},y=wt;v(0,0,y,0,16),v(y,0,y,y,16),v(y,y,0,y,16),v(0,y,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(f),this._tileDebugBuffer=t.createVertexBuffer(p,Kc.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(g,VA.members),this._tileDebugSegments=un.simpleSegment(0,0,p.length,f.length)}_makeGlobeTileDebugTextBuffer(t,i,o,c,u,h){let p=wt/4,f=new Cs,g=new qr,v=new R_,y=25;g.reserve(32),f.reserve(y),v.reserve(y);let b=(x,C)=>y*x+C;for(let x=0;x<y;x++){let C=x*p;for(let E=0;E<y;E++){let M=E*p;f.emplaceBack(M,C);let D=this._globePoint(M,C,i,o,c,u,h);v.emplaceBack(D[0],D[1],D[2])}}for(let x=0;x<4;x++)for(let C=0;C<4;C++){let E=b(x,C),M=b(x,C+1),D=b(x+1,C),A=b(x+1,C+1);g.emplaceBack(E,M,D),g.emplaceBack(D,M,A)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(g),this._tileDebugTextBuffer=t.createVertexBuffer(f,Kc.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(v,VA.members),this._tileDebugTextSegments=un.simpleSegment(0,0,y,32)}destroy(t=!1){for(let i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof or&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.latestFeatureIndex=null,this.state="unloaded"}}class fH{constructor(t,i){this.max=t,this.onRemove=i,this.reset()}reset(){for(let t in this.data)for(let i of this.data[t])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(t,i,o){let c=t.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);let u={value:i,timeout:void 0};if(o!==void 0&&(u.timeout=setTimeout(()=>{this.remove(t,u)},o)),this.data[c].push(u),this.order.push(c),this.order.length>this.max){let h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){let i=this.data[t].shift();return i.timeout&&clearTimeout(i.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),i.value}getByKey(t){let i=this.data[t];return i?i[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,i){if(!this.has(t))return this;let o=t.wrapped().key,c=i===void 0?0:this.data[o].indexOf(i),u=this.data[o][c];return this.data[o].splice(c,1),u.timeout&&clearTimeout(u.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(u.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){let i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(t){let i=[];for(let o in this.data)for(let c of this.data[o])t(c.value)||i.push(c);for(let o of i)this.remove(o.value.tileID,o)}}let SR=(()=>{class e{constructor(i,o,c,u){this.id=e.uniqueIdxCounter,e.uniqueIdxCounter++,this.context=i;let h=i.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||u||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){this.id=e.uniqueIdxCounter,e.uniqueIdxCounter++;let o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return e.uniqueIdxCounter=0,e})(),gH={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class _H{constructor(t,i,o,c,u,h){this.length=i.length,this.attributes=o,this.itemSize=i.bytesPerElement,this.dynamicDraw=c,this.instanceCount=h,this.context=t;let p=t.gl;this.buffer=p.createBuffer(),t.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||u||i.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){let i=this.context.gl;this.bind(),i.bufferSubData(i.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,i){for(let o=0;o<this.attributes.length;o++){let c=i.attributes[this.attributes[o].name];c!==void 0&&t.enableVertexAttribArray(c)}}setVertexAttribPointers(t,i,o){for(let c=0;c<this.attributes.length;c++){let u=this.attributes[c],h=i.attributes[u.name];h!==void 0&&t.vertexAttribPointer(h,u.components,t[gH[u.type]],!1,this.itemSize,u.offset+this.itemSize*(o||0))}}setVertexAttribDivisor(t,i,o){for(let c=0;c<this.attributes.length;c++){let u=i.attributes[this.attributes[c].name];u!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(u,o)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Wn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class vH extends Wn{getDefault(){return _i.transparent}set(t){let i=this.current;(t.r!==i.r||t.g!==i.g||t.b!==i.b||t.a!==i.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class yH extends Wn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class bH extends Wn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class xH extends Wn{getDefault(){return[!0,!0,!0,!0]}set(t){let i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[3]!==i[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class wH extends Wn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class CH extends Wn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class SH extends Wn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){let i=this.current;(t.func!==i.func||t.ref!==i.ref||t.mask!==i.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class EH extends Wn{getDefault(){let t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){let i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class MH extends Wn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;t?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),this.current=t,this.dirty=!1}}class DH extends Wn{getDefault(){return[0,1]}set(t){let i=this.current;(t[0]!==i[0]||t[1]!==i[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class TH extends Wn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;t?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),this.current=t,this.dirty=!1}}class IH extends Wn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class AH extends Wn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;t?i.enable(i.BLEND):i.disable(i.BLEND),this.current=t,this.dirty=!1}}class kH extends Wn{getDefault(){let t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){let i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[3]!==i[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class RH extends Wn{getDefault(){return _i.transparent}set(t){let i=this.current;(t.r!==i.r||t.g!==i.g||t.b!==i.b||t.a!==i.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class PH extends Wn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class OH extends Wn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;t?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),this.current=t,this.dirty=!1}}class FH extends Wn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class LH extends Wn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let zH=class extends Wn{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}};class NH extends Wn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class BH extends Wn{getDefault(){let t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){let i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[3]!==i[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class VH extends Wn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class jH extends Wn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.bindRenderbuffer(i.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class UH extends Wn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.bindTexture(i.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class HH extends Wn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class GH extends Wn{getDefault(){return null}set(t){let i=this.gl;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class qH extends Wn{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class WH extends Wn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class $H extends Wn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class YH extends Wn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class wC extends Wn{constructor(t,i){super(t),this.context=t,this.parent=i}getDefault(){return null}}class ZH extends wC{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class ER extends wC{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,this.attachment(),i.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class XH extends wC{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,this.attachment(),i.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class KH extends ER{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class QH{constructor(t,i,o,c,u){this.context=t,this.width=i,this.height=o;let h=this.framebuffer=t.gl.createFramebuffer();c&&(this.colorAttachment=new ZH(t,h)),u&&(this.depthAttachmentType=u,this.depthAttachment=u==="renderbuffer"?new ER(t,h):new XH(t,h))}destroy(){let t=this.context.gl;if(this.colorAttachment){let i=this.colorAttachment.get();i&&t.deleteTexture(i)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let i=this.depthAttachment.get();i&&t.deleteRenderbuffer(i)}else{let i=this.depthAttachment.get();i&&t.deleteTexture(i)}t.deleteFramebuffer(this.framebuffer)}}class He{constructor(t,i,o){this.func=t,this.mask=i,this.range=o}}He.ReadOnly=!1,He.ReadWrite=!0,He.disabled=new He(519,He.ReadOnly,[0,1]);let CC=7680;class vi{constructor(t,i,o,c,u,h){this.test=t,this.ref=i,this.mask=o,this.fail=c,this.depthFail=u,this.pass=h}}vi.disabled=new vi({func:519,mask:0},0,0,CC,CC,CC);let A0=771;class Gi{constructor(t,i,o,c){this.blendFunction=t,this.blendColor=i,this.mask=o,this.blendEquation=c}}Gi.Replace=[1,0,1,0],Gi.disabled=new Gi(Gi.Replace,_i.transparent,[!1,!1,!1,!1]),Gi.unblended=new Gi(Gi.Replace,_i.transparent,[!0,!0,!0,!0]),Gi.alphaBlended=new Gi([1,A0,1,A0],_i.transparent,[!0,!0,!0,!0]),Gi.multiply=new Gi([774,0,774,0],_i.transparent,[!0,!0,!0,!0]);let SC=1029,EC=2305;class bi{constructor(t,i,o){this.enable=t,this.mode=i,this.frontFace=o}}bi.disabled=new bi(!1,SC,EC),bi.backCCW=new bi(!0,SC,EC),bi.backCW=new bi(!0,SC,2304),bi.frontCW=new bi(!0,1028,2304),bi.frontCCW=new bi(!0,1028,EC);class JH{constructor(t,i){this.gl=t,this.clearColor=new vH(this),this.clearDepth=new yH(this),this.clearStencil=new bH(this),this.colorMask=new xH(this),this.depthMask=new wH(this),this.stencilMask=new CH(this),this.stencilFunc=new SH(this),this.stencilOp=new EH(this),this.stencilTest=new MH(this),this.depthRange=new DH(this),this.depthTest=new TH(this),this.depthFunc=new IH(this),this.blend=new AH(this),this.blendFunc=new kH(this),this.blendColor=new RH(this),this.blendEquation=new PH(this),this.cullFace=new OH(this),this.cullFaceSide=new FH(this),this.frontFace=new LH(this),this.program=new zH(this),this.activeTexture=new NH(this),this.viewport=new BH(this),this.bindFramebuffer=new VH(this),this.bindRenderbuffer=new jH(this),this.bindTexture=new UH(this),this.bindVertexBuffer=new HH(this),this.bindElementBuffer=new GH(this),this.bindVertexArrayOES=new qH(this),this.pixelStoreUnpack=new WH(this),this.pixelStoreUnpackPremultiplyAlpha=new $H(this),this.pixelStoreUnpackFlipY=new YH(this),this.options=i?qt({},i):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,i,o){return new SR(this,t,i,o)}createVertexBuffer(t,i,o,c,u){return new _H(this,t,i,o,c,u)}createRenderbuffer(t,i,o){let c=this.gl,u=c.createRenderbuffer();return this.bindRenderbuffer.set(u),c.renderbufferStorage(c.RENDERBUFFER,t,i,o),this.bindRenderbuffer.set(null),u}createFramebuffer(t,i,o,c){return new QH(this,t,i,o,c)}clear({color:t,depth:i,stencil:o,colorMask:c}){let u=this.gl,h=0;t&&(h|=u.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(c||[!0,!0,!0,!0])),i!==void 0&&(h|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),o!==void 0&&(h|=u.STENCIL_BUFFER_BIT,this.clearStencil.set(o),this.stencilMask.set(255)),u.clear(h)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){$t(t.blendFunction,Gi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class tl extends Hr{constructor(t,i,o){super(),this.id=t,this._onlySymbols=o,i.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new fH(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new v8,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let t in this._tiles){let i=this._tiles[t];if(i.state!=="errored"&&(i.state!=="loaded"||!i.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,i){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,i)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let i in this._tiles){let o=this._tiles[i];o.upload(t),o.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return qs(this._tiles).map(t=>t.tileID).sort(MR).map(t=>t.key)}getRenderableIds(t,i){let o=[];for(let c in this._tiles)this._isIdRenderable(+c,t,i)&&o.push(this._tiles[c]);return t?o.sort((c,u)=>{let h=c.tileID,p=u.tileID,f=new Q(h.canonical.x,h.canonical.y)._rotate(this.transform.angle),g=new Q(p.canonical.x,p.canonical.y)._rotate(this.transform.angle);return h.overscaledZ-p.overscaledZ||g.y-f.y||g.x-f.x}).map(c=>c.tileID.key):o.map(c=>c.tileID).sort(MR).map(c=>c.key)}hasRenderableParent(t){let i=this.findLoadedParent(t,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(t,i,o){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(i||!this._tiles[t].holdingForFade())&&(o||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,i){let o=this._tiles[t];o&&(o.state!=="loading"&&(o.state=i),this._loadTile(o,this._tileLoaded.bind(this,o,t,i)))}_tileLoaded(t,i,o,c){if(c)if(t.state="errored",c.status!==404)this._source.fire(new Xe(c,{tile:t}));else{if(!(t.tileID.key in this._loadedParentTiles))return void this._source.fire(new Wt("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let u=this.map.painter.terrain;this.update(this.transform,u.getScaledDemTileSize(),!0),u.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=ii.now(),o==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(i,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new Wt("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){let i=this.getRenderableIds();for(let c=0;c<i.length;c++){let u=i[c];if(t.neighboringTiles&&t.neighboringTiles[u]){let h=this.getTileByID(u);o(t,h),o(h,t)}}function o(c,u){if(!c.dem||c.dem.borderReady)return;c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0;let h=u.tileID.canonical.x-c.tileID.canonical.x,p=u.tileID.canonical.y-c.tileID.canonical.y,f=Math.pow(2,c.tileID.canonical.z),g=u.tileID.key;h===0&&p===0||Math.abs(p)>1||(Math.abs(h)>1&&(Math.abs(h+f)===1?h+=f:Math.abs(h-f)===1&&(h-=f)),u.dem&&c.dem&&(c.dem.backfillBorder(u.dem,h,p),c.neighboringTiles&&c.neighboringTiles[g]&&(c.neighboringTiles[g].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,i,o,c){for(let u in this._tiles){let h=this._tiles[u];if(c[u]||!h.hasData()||h.tileID.overscaledZ<=i||h.tileID.overscaledZ>o)continue;let p=h.tileID;for(;h&&h.tileID.overscaledZ>i+1;){let g=h.tileID.scaledTo(h.tileID.overscaledZ-1);h=this._tiles[g.key],h&&h.hasData()&&(p=g)}let f=p;for(;f.overscaledZ>i;)if(f=f.scaledTo(f.overscaledZ-1),t[f.key]){c[p.key]=p;break}}}findLoadedParent(t,i){if(t.key in this._loadedParentTiles){let o=this._loadedParentTiles[t.key];return o&&o.tileID.overscaledZ>=i?o:null}for(let o=t.overscaledZ-1;o>=i;o--){let c=t.scaledTo(o),u=this._getLoadedTile(c);if(u)return u}}_getLoadedTile(t){let i=this._tiles[t.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,i){i=i||this._source.tileSize;let o=Math.ceil(t.width/i)+1,c=Math.ceil(t.height/i)+1,u=Math.floor(o*c*5),h=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,u):u,p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._cache.setMaxSize(p)}handleWrapJump(t){let i=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,i){let o={};for(let c in this._tiles){let u=this._tiles[c];u.tileID=u.tileID.unwrapTo(u.tileID.wrap+i),o[u.tileID.key]=u}this._tiles=o;for(let c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(let c in this._tiles)this._setTileReloadTimer(+c,this._tiles[c])}}update(t,i,o,c){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!o)return;let u;if(this.updateCacheSize(t,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(f=>new $i(f.canonical.z,f.wrap,f.canonical.z,f.canonical.x,f.canonical.y)):(u=t.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!o,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(f=>this._source.hasTile(f)))):u=[],u.length>0&&this.castsShadows&&c&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!MC(this._source.type)){let f=t.coveringZoomLevel({tileSize:i||this._source.tileSize,roundZoom:this._source.roundZoom&&!o}),g=Math.min(f,this._source.maxzoom),v=t.extendTileCoverForShadows(u,c,g);for(let y of v)this._shadowCasterTiles[y.key]=!0,u.push(y)}let h=this._updateRetainedTiles(u);if(MC(this._source.type)&&u.length!==0){let f={},g={},v=Object.keys(h);for(let b of v){let x=h[b],C=this._tiles[b];if(!C||C.fadeEndTime&&C.fadeEndTime<=ii.now())continue;let E=this.findLoadedParent(x,Math.max(x.overscaledZ-tl.maxOverzooming,this._source.minzoom));E&&(this._addTile(E.tileID),f[E.tileID.key]=E.tileID),g[b]=x}let y=u[u.length-1].overscaledZ;for(let b in this._tiles){let x=this._tiles[b];if(h[b]||!x.hasData())continue;let C=x.tileID;for(;C.overscaledZ>y;){C=C.scaledTo(C.overscaledZ-1);let E=this._tiles[C.key];if(E&&E.hasData()&&g[C.key]){h[b]=x.tileID;break}}}for(let b in f)h[b]||(this._coveredTiles[b]=!0,h[b]=f[b])}for(let f in h)this._tiles[f].clearFadeHold();let p=function(f,g){let v=[];for(let y in f)y in g||v.push(y);return v}(this._tiles,h);for(let f of p){let g=this._tiles[f];g.hasSymbolBuckets&&!g.holdingForFade()?g.setHoldDuration(this.map._fadeDuration):g.hasSymbolBuckets&&!g.symbolFadeFinished()||this._removeTile(+f)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){let i={};if(t.length===0)return i;let o={},c=t.reduce((g,v)=>Math.min(g,v.overscaledZ),1/0),u=t[0].overscaledZ,h=Math.max(u-tl.maxOverzooming,this._source.minzoom),p=Math.max(u+tl.maxUnderzooming,this._source.minzoom),f={};for(let g of t){let v=this._addTile(g);i[g.key]=g,v.hasData()||c<this._source.maxzoom&&(f[g.key]=g)}this._retainLoadedChildren(f,c,p,i);for(let g of t){let v=this._tiles[g.key];if(v.hasData())continue;if(g.canonical.z>=this._source.maxzoom){let b=g.children(this._source.maxzoom)[0],x=this.getTile(b);if(x&&x.hasData()){i[b.key]=b;continue}}else{let b=g.children(this._source.maxzoom);if(i[b[0].key]&&i[b[1].key]&&i[b[2].key]&&i[b[3].key])continue}let y=v.wasRequested();for(let b=g.overscaledZ-1;b>=h;--b){let x=g.scaledTo(b);if(o[x.key]||(o[x.key]=!0,v=this.getTile(x),!v&&y&&(v=this._addTile(x)),v&&(i[x.key]=x,y=v.wasRequested(),v.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let t in this._tiles){let i=[],o,c=this._tiles[t].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){o=this._loadedParentTiles[c.key];break}i.push(c.key);let u=c.scaledTo(c.overscaledZ-1);if(o=this._getLoadedTile(u),o)break;c=u}for(let u of i)this._loadedParentTiles[u]=o}}_addTile(t){let i=this._tiles[t.key];if(i)return i.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),i;i=this._cache.getAndRemove(t),i&&(this._setTileReloadTimer(t.key,i),i.tileID=t,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,i)));let o=!!i;if(!o){let c=this.map?this.map.painter:null;i=new Xp(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,c,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,t.key,i.state))}return i?(i.uses++,this._tiles[t.key]=i,o||this._source.fire(new Wt("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(t,i){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);let o=i.getExpiryTimeout();o&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},o))}_removeTile(t){let i=this._tiles[t];i&&(i.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,i,o){let c=[],u=this.transform;if(!u)return c;let h=u.projection.name==="globe",p=eo(u.center.lng);for(let f in this._tiles){let g=this._tiles[f];if(o&&g.clearQueryDebugViz(),g.holdingForFade())continue;let v;if(h){let y=g.tileID.canonical;if(y.z===0){let b=[Math.abs(ve(p,...Kp(y,-1))-p),Math.abs(ve(p,...Kp(y,1))-p)];v=[0,2*b.indexOf(Math.min(...b))-1]}else{let b=[Math.abs(ve(p,...Kp(y,-1))-p),Math.abs(ve(p,...Kp(y,0))-p),Math.abs(ve(p,...Kp(y,1))-p)];v=[b.indexOf(Math.min(...b))-1]}}else v=[0];for(let y of v){let b=t.containsTile(g,u,i,y);b&&c.push(b)}}return c}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,i){let o=this.getRenderableIds(t,i).map(u=>this._tiles[u].tileID),c=this.transform.projection.name==="globe";for(let u of o)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped()),u.expandedProjMatrix=c?this.transform.calculateProjMatrix(u.toUnwrapped(),!1,!0):u.projMatrix;return o}sortCoordinatesByDistance(t){let i=t.slice(),o=this.transform._camera.position,c=this.transform._camera.forward(),u={};for(let h of i){let p=1/(1<<h.canonical.z);u[h.key]=((h.canonical.x+.5)*p+h.wrap-o[0])*c[0]+((h.canonical.y+.5)*p-o[1])*c[1]-o[2]*c[2]}return i.sort((h,p)=>u[h.key]-u[p.key]),i}hasTransition(){if(this._source.hasTransition())return!0;if(MC(this._source.type))for(let t in this._tiles){let i=this._tiles[t];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=ii.now())return!0}return!1}setFeatureState(t,i,o){this._state.updateState(t=t||"_geojsonTileLayer",i,o)}removeFeatureState(t,i,o){this._state.removeFeatureState(t=t||"_geojsonTileLayer",i,o)}getFeatureState(t,i){return this._state.getState(t=t||"_geojsonTileLayer",i)}setDependencies(t,i,o){let c=this._tiles[t];c&&c.setDependencies(i,o)}reloadTilesForDependencies(t,i){for(let o in this._tiles)this._tiles[o].hasDependency(t,i)&&this._reloadTile(+o,"reloading");this._cache.filter(o=>!o.hasDependency(t,i))}_preloadTiles(t,i){if(!this._sourceLoaded){let p=()=>{this._sourceLoaded&&(this._source.off("data",p),this._preloadTiles(t,i))};return void this._source.on("data",p)}let o=new Map,c=Array.isArray(t)?t:[t],u=this.map.painter.terrain,h=this.usedForTerrain&&u?u.getScaledDemTileSize():this._source.tileSize;for(let p of c){let f=p.coveringTiles({tileSize:h,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let g of f)o.set(g.key,g);this.usedForTerrain&&p.updateElevation(!1)}_s(Array.from(o.values()),(p,f)=>{let g=new Xp(p,this._source.tileSize*p.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(g,v=>{this._source.type==="raster-dem"&&g.dem&&this._backfillDEM(g),f(v,g)})},i)}}function MR(e,t){let i=Math.abs(2*e.wrap)-+(e.wrap<0),o=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||o-i||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function MC(e){return e==="raster"||e==="image"||e==="video"||e==="custom"}function Kp(e,t){let i=1<<e.z;return[e.x/i+t,(e.x+1)/i+t]}tl.maxOverzooming=10,tl.maxUnderzooming=3;let tG=Ji([{name:"a_pos_3f",components:3,type:"Float32"}]),eG=Ji([{name:"a_color_3f",components:3,type:"Float32"}]),iG=Ji([{name:"a_color_4f",components:4,type:"Float32"}]),nG=Ji([{name:"a_uv_2f",components:2,type:"Float32"}]),rG=Ji([{name:"a_normal_3f",components:3,type:"Float32"}]),oG=Ji([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),sG=Ji([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class DC{constructor(t=0,i=0,o=0,c=0){if(isNaN(t)||t<0||isNaN(i)||i<0||isNaN(o)||o<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=i,this.left=o,this.right=c}interpolate(t,i,o){return i.top!=null&&t.top!=null&&(this.top=Ye(t.top,i.top,o)),i.bottom!=null&&t.bottom!=null&&(this.bottom=Ye(t.bottom,i.bottom,o)),i.left!=null&&t.left!=null&&(this.left=Ye(t.left,i.left,o)),i.right!=null&&t.right!=null&&(this.right=Ye(t.right,i.right,o)),this}getCenter(t,i){let o=ve((this.left+t-this.right)/2,0,t),c=ve((this.top+i-this.bottom)/2,0,i);return new Q(o,c)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new DC(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function DR(e,t){let i=gr(e,3);ft.fromQuat(e,t),ko(e,3,i)}function TC(e,t){let i=Vo.identity([]);return Vo.rotateZ(i,i,-t),Vo.rotateX(i,i,-e),i}function TR(e,t){let i=[e[0],e[1],0],o=[t[0],t[1],0];if(J.length(i)>=1e-15){let h=J.normalize([],i);J.scale(o,h,J.dot(o,h)),t[0]=o[0],t[1]=o[1]}let c=J.cross([],t,e);if(J.len(c)<1e-15)return null;let u=Math.atan2(-c[1],c[0]);return TC(Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2]),u)}class IR{constructor(t,i){this.position=t,this.orientation=i}get position(){return this._position}set position(t){if(t){let i=t instanceof Fi?t:new Fi(t[0],t[1],t[2]);this._renderWorldCopies&&(i.x=ss(i.x,0,1)),this._position=i}else this._position=null}lookAtPoint(t,i){if(this.orientation=null,!this.position)return;let o=this.position,c=this._elevation?this._elevation.getAtPointOrZero(Fi.fromLngLat(t)):0,u=Fi.fromLngLat(t,c),h=[u.x-o.x,u.y-o.y,u.z-o.z];i||(i=[0,0,1]),i[2]=Math.abs(i[2]),this.orientation=TR(h,i)}setPitchBearing(t,i){this.orientation=TC(fe(t),fe(-i))}}class k0{constructor(t,i){this._transform=ft.identity([]),this.orientation=i,this.position=t}get mercatorPosition(){let t=this.position;return new Fi(t[0],t[1],t[2])}get position(){let t=gr(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var i;t&&ko(this._transform,3,[(i=t)[0],i[1],i[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||Vo.identity([]),t&&DR(this._transform,this._orientation)}getPitchBearing(){let t=this.forward(),i=this.right();return{bearing:Math.atan2(-i[1],i[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,i){this._orientation=TC(t,i),DR(this._transform,this._orientation)}forward(){let t=gr(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){let t=gr(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){let t=gr(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,i){let o=new Float64Array(16);return ft.invert(o,this.getWorldToCamera(t,i)),o}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,i,o){let c=this.position;J.scale(c,c,-t);let u=new Float64Array(16);return ft.fromScaling(u,[o,o,o]),ft.translate(u,u,c),u[10]*=i,u}getWorldToCamera(t,i){let o=new Float64Array(16),c=new Float64Array(4),u=this.position;return Vo.conjugate(c,this._orientation),J.scale(u,u,-t),ft.fromQuat(o,c),ft.translate(o,o,u),o[1]*=-1,o[5]*=-1,o[9]*=-1,o[13]*=-1,o[8]*=i,o[9]*=i,o[10]*=i,o[11]*=i,o}getCameraToClipPerspective(t,i,o,c){let u=new Float64Array(16);return ft.perspective(u,t,i,o,c),u}getCameraToClipOrthographic(t,i,o,c,u,h){let p=new Float64Array(16);return ft.ortho(p,t,i,o,c,u,h),p}getDistanceToElevation(t,i=!1){let o=t===0?0:yn(t,i?Wr(this.position[1]):this.position[1]),c=this.forward();return(o-this.position[2])/c[2]}clone(){return new k0([...this.position],[...this.orientation])}}function AR(e,t){let i=Qp(e.projection,e.zoom,e.width,e.height),o=function(u,h,p,f,g){let v=new Ze(p.lng-180*dd,p.lat),y=new Ze(p.lng+180*dd,p.lat),b=u.project(v.lng,v.lat),x=u.project(y.lng,y.lat),C=-Math.atan2(x.y-b.y,x.x-b.x),E=Fi.fromLngLat(p);E.y=ve(E.y,-1+dd,1-dd);let M=E.toLngLat(),D=u.project(M.lng,M.lat),A=Fi.fromLngLat(M);A.x+=dd;let P=A.toLngLat(),O=u.project(P.lng,P.lat),R=PR(O.x-D.x,O.y-D.y,C),F=Fi.fromLngLat(M);F.y+=dd;let N=F.toLngLat(),j=u.project(N.lng,N.lat),U=PR(j.x-D.x,j.y-D.y,C),G=Math.abs(R.x)/Math.abs(U.y),Y=ft.identity([]);ft.rotateZ(Y,Y,-C*(1-(g?0:f)));let Z=ft.identity([]);return ft.scale(Z,Z,[1,1-(1-G)*f,1]),Z[4]=-U.x/U.y*f,ft.rotateZ(Z,Z,C),ft.multiply(Z,Y,Z),Z}(e.projection,0,e.center,i,t),c=kR(e);return ft.scale(o,o,[c,c,1]),o}function kR(e){let t=e.projection,i=Qp(e.projection,e.zoom,e.width,e.height),o=RR(t,e.center),c=RR(t,Ze.convert(t.center));return Math.pow(2,o*i+(1-i)*c)}function Qp(e,t,i,o,c=1/0){let u=e.range;if(!u)return 0;let h=Math.min(c,Math.max(i,o)),p=Math.log(h/1024)/Math.LN2;return Wo(u[0]+p,u[1]+p,t)}let dd=1/4e4;function RR(e,t){let i=ve(t.lat,-Ir,Ir),o=new Ze(t.lng-180*dd,i),c=new Ze(t.lng+180*dd,i),u=e.project(o.lng,i),h=e.project(c.lng,i),p=Fi.fromLngLat(o),f=Fi.fromLngLat(c),g=h.x-u.x,v=h.y-u.y,y=f.x-p.x,b=f.y-p.y,x=Math.sqrt((y*y+b*b)/(g*g+v*v));return Math.log(x)/Math.LN2}function PR(e,t,i){let o=Math.cos(i),c=Math.sin(i);return{x:e*o-t*c,y:e*c+t*o}}function lu(e,t,i){return t*(wt/(e.tileSize*Math.pow(2,i-e.tileID.overscaledZ)))}let Oh={unknown:0,flipRequired:1,flipNotRequired:2},aG=Math.tan(85*Math.PI/180);function R0(e,t,i,o,c,u,h){let p=ft.create();if(i)if(u.name==="globe"){let f=function(g,v){let{x:y,y:b}=g.point,x=KA(y,b,g.worldSize/g._pixelsPerMercatorPixel,0,0);return ft.multiply(x,x,jw(Zs(v)))}(c,t);ft.multiply(p,p,f)}else{let f=_h.invert([],h);p[0]=f[0],p[1]=f[1],p[4]=f[2],p[5]=f[3],o||ft.rotateZ(p,p,c.angle)}else ft.multiply(p,c.labelPlaneMatrix,e);return p}function OR(e,t,i,o,c,u,h){let p=R0(e,t,i,o,c,u,h);return u.name==="globe"&&i||(p[2]=p[6]=p[10]=p[14]=0),p}function FR(e,t,i,o,c,u,h){if(i){if(u.name==="globe"){let p=R0(e,t,i,o,c,u,h);return ft.invert(p,p),ft.multiply(p,e,p),p}{let p=ft.clone(e),f=ft.identity([]);return f[0]=h[0],f[1]=h[1],f[4]=h[2],f[5]=h[3],ft.multiply(p,p,f),o||ft.rotateZ(p,p,-c.angle),p}}return c.glCoordMatrix}function el(e,t,i,o){let c=[e,t,i,1];i?hn.transformMat4(c,c,o):UR(c,c,o);let u=c[3];return c[0]/=u,c[1]/=u,c[2]/=u,c}function LR(e,t){return Math.min(.5+e/t*.5,1.5)}function lG(e,t){let i=e[0]/e[3],o=e[1]/e[3];return i>=-t[0]&&i<=t[0]&&o>=-t[1]&&o<=t[1]}function cG(e,t,i,o,c,u,h,p,f,g){let v=i.transform,y=o?e.textSizeData:e.iconSizeData,b=Tl(y,i.transform.zoom),x=v.projection.name==="globe",C=[256/i.width*2+1,256/i.height*2+1],E=o?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;E.clear();let M=null;x&&(M=o?e.text.globeExtVertexArray:e.icon.globeExtVertexArray);let D=e.lineVertexArray,A=o?e.text.placedSymbolArray:e.icon.placedSymbolArray,P=i.transform.width/i.transform.height,O,R=!1;for(let F=0;F<A.length;F++){let N=A.get(F),{numGlyphs:j,writingMode:U}=N;if(U!==Jn.vertical||R||O===Jn.horizontal||(R=!0),O=U,(N.hidden||U===Jn.vertical)&&!R){Fh(j,E);continue}R=!1;let G=new Q(N.tileAnchorX,N.tileAnchorY),{x:Y,y:Z,z:tt}=v.projection.projectTilePoint(G.x,G.y,g.canonical);if(f){let[Ct,Et,It]=f(G);Y+=Ct,Z+=Et,tt+=It}let $=[Y,Z,tt,1];if(hn.transformMat4($,$,t),!lG($,C)){Fh(j,E);continue}let rt=$[3],st=LR(i.transform.getCameraToCenterDistance(v.projection),rt),pt=Vp(y,b,N),nt=h?pt/st:pt*st,ot=el(Y,Z,tt,c);if(ot[3]<=0){Fh(j,E);continue}let vt={},bt=h?null:f,yt=BR(N,nt,!1,p,t,c,u,e.glyphOffsetArray,D,E,M,ot,G,vt,P,bt,v.projection,g,h);R=yt.useVertical,bt&&yt.needsFlipping&&(vt={}),(yt.notEnoughRoom||R||yt.needsFlipping&&BR(N,nt,!0,p,t,c,u,e.glyphOffsetArray,D,E,M,ot,G,vt,P,bt,v.projection,g,h).notEnoughRoom)&&Fh(j,E)}o?(e.text.dynamicLayoutVertexBuffer.updateData(E),M&&e.text.globeExtVertexBuffer&&e.text.globeExtVertexBuffer.updateData(M)):(e.icon.dynamicLayoutVertexBuffer.updateData(E),M&&e.icon.globeExtVertexBuffer&&e.icon.globeExtVertexBuffer.updateData(M))}function zR(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E){let{lineStartIndex:M,glyphStartIndex:D,segment:A}=p,P=D+p.numGlyphs,O=M+p.lineLength,R=t.getoffsetX(D),F=t.getoffsetX(P-1),N=P0(e*R,i,o,c,u,h,A,M,O,f,g,v,y,b,!0,x,C,E);if(!N)return null;let j=P0(e*F,i,o,c,u,h,A,M,O,f,g,v,y,b,!0,x,C,E);return j?{first:N,last:j}:null}function NR(e,t,i,o){return e===Jn.horizontal&&Math.abs(o)>Math.abs(i)?{useVertical:!0}:e===Jn.vertical?o>0?{needsFlipping:!0}:null:t!==Oh.unknown&&function(c,u){return c===0||Math.abs(u/c)>aG}(i,o)?t===Oh.flipRequired?{needsFlipping:!0}:null:i<0?{needsFlipping:!0}:null}function BR(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M,D,A){let P=t/24,O=e.lineOffsetX*P,R=e.lineOffsetY*P,{lineStartIndex:F,glyphStartIndex:N,numGlyphs:j,segment:U,writingMode:G,flipState:Y}=e,Z=F+e.lineLength,tt=$=>{if(v){let[nt,ot,vt]=$.up,bt=g.length;E0(v,bt+0,nt,ot,vt),E0(v,bt+1,nt,ot,vt),E0(v,bt+2,nt,ot,vt),E0(v,bt+3,nt,ot,vt)}let[rt,st,pt]=$.point;Ph(g,rt,st,pt,$.angle)};if(j>1){let $=zR(P,p,O,R,i,y,b,e,f,u,x,E,!1,M,D,A);if(!$)return{notEnoughRoom:!0};if(o&&!i){let[rt,st,pt]=$.first.point,[nt,ot,vt]=$.last.point;[rt,st]=el(rt,st,pt,h),[nt,ot]=el(nt,ot,vt,h);let bt=NR(G,Y,(nt-rt)*C,ot-st);if(e.flipState=bt&&bt.needsFlipping?Oh.flipRequired:Oh.flipNotRequired,bt)return bt}tt($.first);for(let rt=N+1;rt<N+j-1;rt++){let st=P0(P*p.getoffsetX(rt),O,R,i,y,b,U,F,Z,f,u,x,E,!1,!1,M,D,A);if(!st)return g.length-=4*(rt-N),{notEnoughRoom:!0};tt(st)}tt($.last)}else{if(o&&!i){let rt=el(b.x,b.y,0,c),st=F+U+1,pt=new Q(f.getx(st),f.gety(st)),nt=el(pt.x,pt.y,0,c),ot=nt[3]>0?nt:jR(b,pt,rt,1,c,void 0,M,D.canonical),vt=NR(G,Y,(ot[0]-rt[0])*C,ot[1]-rt[1]);if(e.flipState=vt&&vt.needsFlipping?Oh.flipRequired:Oh.flipNotRequired,vt)return vt}let $=P0(P*p.getoffsetX(N),O,R,i,y,b,U,F,Z,f,u,x,E,!1,!1,M,D,A);if(!$)return{notEnoughRoom:!0};tt($)}return{}}function VR(e,t,i,o,c){let{x:u,y:h,z:p}=o.projectTilePoint(e.x,e.y,t);if(!c)return el(u,h,p,i);let[f,g,v]=c(e);return el(u+f,h+g,p+v,i)}function jR(e,t,i,o,c,u,h,p){let f=VR(e.sub(t)._unit()._add(e),p,c,h,u);return J.sub(f,i,f),J.normalize(f,f),J.scaleAndAdd(f,i,f,o)}function P0(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M,D){let A=o?e-t:e+t,P=A>0?1:-1,O=0;o&&(P*=-1,O=Math.PI),P<0&&(O+=Math.PI);let R=p+h+(P>0?0:1)|0,F=c,N=c,j=0,U=0,G=Math.abs(A),Y=[],Z=[],tt=u,$=tt,rt=()=>jR($,tt,N,G-j+1,v,b,E,M.canonical);for(;j+U<=G;){if(R+=P,R<p||R>=f)return null;if(N=F,$=tt,Y.push(N),x&&Z.push($),tt=new Q(g.getx(R),g.gety(R)),F=y[R],!F){let Et=VR(tt,M.canonical,v,E,b);F=Et[3]>0?y[R]=Et:rt()}j+=U,U=J.distance(N,F)}C&&b&&(y[R]&&(F=rt(),U=J.distance(N,F)),y[R]=F);let st=(G-j)/U,pt=tt.sub($)._mult(st)._add($),nt=J.sub([],F,N),ot=J.scaleAndAdd([],N,nt,st),vt=[0,0,1],bt=nt[0],yt=nt[1];if(D&&(vt=E.upVector(M.canonical,pt.x,pt.y),vt[0]!==0||vt[1]!==0||vt[2]!==1)){let Et=[vt[2],0,-vt[0]],It=J.cross([],vt,Et);J.normalize(Et,Et),J.normalize(It,It),bt=J.dot(nt,Et),yt=J.dot(nt,It)}if(i){let Et=J.cross([],vt,nt);J.normalize(Et,Et),J.scaleAndAdd(ot,ot,Et,i*P)}let Ct=O+Math.atan2(yt,bt);return Y.push(ot),x&&Z.push(pt),{point:ot,angle:Ct,path:Y,tilePath:Z,up:vt}}function Fh(e,t){let i=t.length,o=i+4*e;t.resize(o),t.float32.fill(-1/0,4*i,4*o)}function UR(e,t,i){let o=t[0],c=t[1];return e[0]=i[0]*o+i[4]*c+i[12],e[1]=i[1]*o+i[5]*c+i[13],e[3]=i[3]*o+i[7]*c+i[15],e}let HR=(e,t,i)=>(1-i)*e+i*t,GR=e=>e*e*e*e*e;class IC{constructor(t,i,o,c,u,h,p){this.tileSize=512,this._renderWorldCopies=u===void 0||u,this._minZoom=t||0,this._maxZoom=i||22,this._minPitch=o??0,this._maxPitch=c??60,this.setProjection(h),this.setMaxBounds(p),this.width=0,this.height=0,this._center=new Ze(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new DC,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new k0,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let t=new IC(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,i=!1){let o=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||o)&&this._updateCameraOnTerrain(),(t||o)&&this._constrainCamera(i),this._calcMatrices()}getProjection(){return Go(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};let i=this.projection?this.getProjection():void 0;this.projection=b0(this.projectionOptions);let o=!$t(i,this.getProjection());return o&&this._calcMatrices(),this.mercatorFromTransition=!1,o}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){let t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=b0({name:"mercator"});let i=t!==this.projection.name;return i&&this._calcMatrices(),i}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){let t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return yn(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new Q(this.width,this.height)}get bearing(){return ss(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){let i=-t*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=_h.create(),_h.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){let i=ve(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=fe(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){let i=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==i&&(this._unmodified=!1,this._setZoom(i),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCameraOnTerrain(){let t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,i=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!i||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let o=this._elevation;i||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&o.exaggeration()&&this._centerAltitudeValidForExaggeration!==o.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*o.exaggeration(),this._centerAltitudeValidForExaggeration=o.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=o.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let t=this._elevation,i=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],o=this.horizonLineFromTop(),c=0,u=0;for(let h=0;h<i.length;h++){let p=new Q(i[h][0]*this.width,o+i[h][1]*(this.height-o)),f=t.pointCoordinate(p);if(!f)continue;let g=1/Math.hypot(f[0]-this._camera.position[0],f[1]-this._camera.position[1]);c+=f[3]*g,u+=g}return u===0?NaN:c/u}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let t=this._seaLevelZoom,i=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),o=this.pixelsPerMeter/this.worldSize*i,c=this._mercatorZfromZoom(t),u=this._mercatorZfromZoom(this._maxZoom),h=Math.max(c-o,u);this._setZoom(this._zoomFromMercatorZ(h))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){let i=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude())),o;o=t.z<this._camera.position[2]?[i.x,i.y,i.z]:[t.x,t.y,t.z];let c=J.length(J.sub([],this._camera.position,o));return ve(this._zoomFromMercatorZ(c),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let i=!1;if(t.orientation&&!Vo.exactEquals(t.orientation,this._camera.orientation)&&(i=this._setCameraOrientation(t.orientation)),t.position){let o=[t.position.x,t.position.y,t.position.z];J.exactEquals(o,this._camera.position)||(this._setCameraPosition(o),i=!0)}i&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let t=this._camera.position,i=new IR;return i.position=new Fi(t[0],t[1],t[2]),i.orientation=this._camera.orientation,i._elevation=this.elevation,i._renderWorldCopies=this.renderWorldCopies,i}_setCameraOrientation(t){if(!Vo.length(t))return!1;Vo.normalize(t,t);let i=J.transformQuat([],[0,0,-1],t),o=J.transformQuat([],[0,-1,0],t);if(o[2]<0)return!1;let c=TR(i,o);return!!c&&(this._camera.orientation=c,!0)}_setCameraPosition(t){let i=this.zoomScale(this.minZoom)*this.tileSize,o=this.zoomScale(this.maxZoom)*this.tileSize,c=this.cameraToCenterDistance;t[2]=ve(t[2],c/o,c/i),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,i,o){this._unmodified=!1,this._edgeInsets.interpolate(t,i,o),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){let i=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,i)}getVisibleUnwrappedCoordinates(t){let i=[new Fw(0,t)];if(this.renderWorldCopies){let o=this.pointCoordinate(new Q(0,0)),c=this.pointCoordinate(new Q(this.width,0)),u=this.pointCoordinate(new Q(this.width,this.height)),h=this.pointCoordinate(new Q(0,this.height)),p=Math.floor(Math.min(o.x,c.x,u.x,h.x)),f=Math.floor(Math.max(o.x,c.x,u.x,h.x)),g=1;for(let v=p-g;v<=f+g;v++)v!==0&&i.push(new Fw(v,t))}return i}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(t,i,o){let c=[];if(i[0]===0&&i[1]===0)return c;for(let h of t){let p=h.canonical,f=h.overscaledZ,g=h.wrap,v=1<<p.z,y=p.x+1<v,b=p.x>0,x=p.y+1<v,C=p.y>0,E=h.wrap-(b?0:1),M=h.wrap+(y?0:1),D=b?p.x-1:v-1,A=y?p.x+1:0;i[0]<0?(c.push(new $i(f,M,p.z,A,p.y)),i[1]<0&&x&&(c.push(new $i(f,g,p.z,p.x,p.y+1)),c.push(new $i(f,M,p.z,A,p.y+1))),i[1]>0&&C&&(c.push(new $i(f,g,p.z,p.x,p.y-1)),c.push(new $i(f,M,p.z,A,p.y-1)))):i[0]>0?(c.push(new $i(f,E,p.z,D,p.y)),i[1]<0&&x&&(c.push(new $i(f,g,p.z,p.x,p.y+1)),c.push(new $i(f,E,p.z,D,p.y+1))),i[1]>0&&C&&(c.push(new $i(f,g,p.z,p.x,p.y-1)),c.push(new $i(f,E,p.z,D,p.y-1)))):i[1]<0&&x?c.push(new $i(f,g,p.z,p.x,p.y+1)):C&&c.push(new $i(f,g,p.z,p.x,p.y-1))}if(c.length>1){c.sort((f,g)=>f.overscaledZ-g.overscaledZ||f.wrap-g.wrap||f.canonical.z-g.canonical.z||f.canonical.x-g.canonical.x||f.canonical.y-g.canonical.y);let h=0,p=0;for(;p<c.length;)c[p].equals(c[h])?++p:c[++h]=c[p++];c.length=h+1}let u=[];for(let h of c)c.some(p=>h.isChildOf(p))||u.push(h);return c=u.filter(h=>!t.some(p=>!!(h.overscaledZ<o&&p.isChildOf(h))||h.equals(p)||h.isChildOf(p))),c}coveringTiles(t){let i=this.coveringZoomLevel(t),o=i,c=this.elevation&&this.elevation.exaggeration(),u=c&&!t.isTerrainDEM,h=this.projection.name==="mercator";if(t.minzoom!==void 0&&i<t.minzoom)return[];t.maxzoom!==void 0&&i>t.maxzoom&&(i=t.maxzoom);let p=this.locationCoordinate(this.center),f=this.center.lat,g=1<<i,v=[g*p.x,g*p.y,0],y=this.projection.name==="globe",b=!y,x=mc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,b),C=y?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),E=g*yn(1,this.center.lat),M=this._camera.position[2]/yn(1,this.center.lat),D=[g*C.x,g*C.y,M*(b?1:E)],A=y||c,P=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),O=this.isLODDisabled(!0)?i:0,R;if(this._elevation&&t.isTerrainDEM)R=1e4*this._elevation.exaggeration();else if(this._elevation){let nt=this._elevation.getMinMaxForVisibleTiles();R=nt?nt.max:this._centerAltitude}else R=this._centerAltitude;let F=t.isTerrainDEM?-R:this._elevation?this._elevation.getMinElevationBelowMSL():0,N=this.projection.isReprojectedInTileSpace?kR(this):1,j=nt=>{let vt=new Fi(nt.x+25e-6,nt.y,nt.z),bt=new Fi(nt.x,nt.y+25e-6,nt.z),yt=nt.toLngLat(),Ct=vt.toLngLat(),Et=bt.toLngLat(),It=this.locationCoordinate(yt),xt=this.locationCoordinate(Ct),Ft=this.locationCoordinate(Et),te=Math.hypot(xt.x-It.x,xt.y-It.y),ee=Math.hypot(Ft.x-It.x,Ft.y-It.y);return Math.sqrt(te*ee)*N/25e-6},U=nt=>{let ot=R,vt=F;return{aabb:pR(this,g,0,0,0,nt,vt,ot,this.projection),zoom:0,x:0,y:0,minZ:vt,maxZ:ot,wrap:nt,fullyVisible:!1}},G=[],Y=[],Z=i,tt=t.reparseOverscaled?o:i,$=nt=>nt*nt,rt=$((M-this._centerAltitude)*E),st=nt=>{if(!this._elevation||!nt.tileID||!h)return;let ot=this._elevation.getMinMaxForTile(nt.tileID),vt=nt.aabb;ot?(vt.min[2]=ot.min,vt.max[2]=ot.max,vt.center[2]=(vt.min[2]+vt.max[2])/2):(nt.shouldSplit=pt(nt),nt.shouldSplit||(vt.min[2]=vt.max[2]=vt.center[2]=this._centerAltitude))},pt=nt=>{if(nt.zoom<O)return!0;if(nt.zoom===Z)return!1;if(nt.shouldSplit!=null)return nt.shouldSplit;let ot=nt.aabb.distanceX(D),vt=nt.aabb.distanceY(D),bt=rt,yt=1;if(y){bt=$(nt.aabb.distanceZ(D));let It=Math.pow(2,nt.zoom),xt=Wr((nt.y+1)/It),Ft=Wr(nt.y/It),te=Math.min(Math.max(f,xt),Ft),ee=Y_(te)/Y_(f);if(yt=te===f?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ee/this._mercatorScaleRatio),this.zoom<=Op&&nt.zoom===Z-1&&ee>=.9)return!0}else if(u&&(bt=$(nt.aabb.distanceZ(D)*E)),this.projection.isReprojectedInTileSpace&&o<=5){let It=Math.pow(2,nt.zoom),xt=j(new Fi((nt.x+.5)/It,(nt.y+.5)/It));yt=xt>.85?1:xt}let Ct=ot*ot+vt*vt+bt,Et=$((1<<Z-nt.zoom)*P*yt*((It,xt)=>{if(xt*$(.707)<It)return 1;let Ft=Math.sqrt(xt/It);return Ft/(1.4144271570014144+(Math.pow(1.1,Ft-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(bt,rt),Ct));return Ct<Et};if(this.renderWorldCopies)for(let nt=1;nt<=3;nt++)G.push(U(-nt)),G.push(U(nt));for(G.push(U(0));G.length>0;){let nt=G.pop(),ot=nt.x,vt=nt.y,bt=nt.fullyVisible,yt=()=>this.projection.name==="globe"&&(nt.y===0||nt.y===(1<<nt.zoom)-1);if(!bt){let Ct=A?nt.aabb.intersects(x):nt.aabb.intersectsFlat(x);if(Ct===0&&yt()){let Et=new pa(nt.zoom,ot,vt);Ct=Bw(this,g,Et,!0).intersects(x)}if(Ct===0)continue;bt=Ct===2}if(nt.zoom!==Z&&pt(nt))for(let Ct=0;Ct<4;Ct++){let Et=(ot<<1)+Ct%2,It=(vt<<1)+(Ct>>1),xt={aabb:h?nt.aabb.quadrant(Ct):pR(this,g,nt.zoom+1,Et,It,nt.wrap,nt.minZ,nt.maxZ,this.projection),zoom:nt.zoom+1,x:Et,y:It,wrap:nt.wrap,fullyVisible:bt,tileID:void 0,shouldSplit:void 0,minZ:nt.minZ,maxZ:nt.maxZ};u&&!y&&(xt.tileID=new $i(nt.zoom+1===Z?tt:nt.zoom+1,nt.wrap,nt.zoom+1,Et,It),st(xt)),G.push(xt)}else{let Ct=nt.zoom===Z?tt:nt.zoom;if(t.minzoom&&t.minzoom>Ct)continue;if(!bt){let Ft=A?nt.aabb.intersectsPrecise(x):nt.aabb.intersectsPreciseFlat(x);if(Ft===0&&yt()){let te=new pa(nt.zoom,ot,vt);Ft=Bw(this,g,te,!0).intersectsPrecise(x)}if(Ft===0)continue}let Et=v[0]-(.5+ot+(nt.wrap<<nt.zoom))*(1<<i-nt.zoom),It=v[1]-.5-vt,xt=nt.tileID?nt.tileID:new $i(Ct,nt.wrap,nt.zoom,ot,vt);Y.push({tileID:xt,distanceSq:Et*Et+It*It})}}if(this.fogCullDistSq){let nt=this.fogCullDistSq,ot=this.horizonLineFromTop();Y=Y.filter(vt=>{let bt=[0,0,0,1],yt=[wt,wt,0,1],Ct=this.calculateFogTileMatrix(vt.tileID.toUnwrapped());hn.transformMat4(bt,bt,Ct),hn.transformMat4(yt,yt,Ct);let Et=function(Ft,te,ee){let de=0;for(let me=0;me<2;++me)Ft[me]>0&&(de+=(Ft[me]-0)*(Ft[me]-0)),te[me]<0&&(de+=(0-te[me])*(0-te[me]));return de}(hn.min([],bt,yt),hn.max([],bt,yt));if(Et===0)return!0;let It=!1,xt=this._elevation;if(xt&&Et>nt&&ot!==0){let Ft=this.calculateProjMatrix(vt.tileID.toUnwrapped()),te;t.isTerrainDEM||(te=xt.getMinMaxForTile(vt.tileID)),te||(te={min:F,max:R});let ee=function(me){let Ge=Math.round((me+45+360)%360/90)%4;return Oi[Ge]}(this.rotation),de=[ee[0]*wt,ee[1]*wt,te.max];J.transformMat4(de,de,Ft),It=(1-de[1])*this.height*.5<ot}return Et<nt||It})}return Y.sort((nt,ot)=>nt.distanceSq-ot.distanceSq).map(nt=>nt.tileID)}resize(t,i){this.width=t,this.height=i,this.pixelsToGLUnits=[2/t,-2/i],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){let i=ve(t.lat,-Ir,Ir),o=this.projection.project(t.lng,i);return new Q(o.x*this.worldSize,o.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/yn(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,i){let o,c,u=this.centerPoint;if(this.projection.name==="globe"){let p=this.worldSize;o=(i.x-u.x)/p,c=(i.y-u.y)/p}else{let p=this.pointCoordinate(i),f=this.pointCoordinate(u);o=p.x-f.x,c=p.y-f.y}let h=this.locationCoordinate(t);this.setLocation(new Fi(h.x-o,h.y-c))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,i){let o=i?yn(i,t.lat):void 0,c=this.projection.project(t.lng,t.lat);return new Fi(c.x,c.y,o)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,i){let o=i??this._centerAltitude,c=[t.x,t.y,0,1],u=[t.x,t.y,1,1];hn.transformMat4(c,c,this.pixelMatrixInverse),hn.transformMat4(u,u,this.pixelMatrixInverse);let h=u[3];hn.scale(c,c,1/c[3]),hn.scale(u,u,1/h);let p=c[2],f=u[2];return{p0:c,p1:u,t:p===f?0:(o-p)/(f-p)}}screenPointToMercatorRay(t){let i=[t.x,t.y,0,1],o=[t.x,t.y,1,1];return hn.transformMat4(i,i,this.pixelMatrixInverse),hn.transformMat4(o,o,this.pixelMatrixInverse),hn.scale(i,i,1/i[3]),hn.scale(o,o,1/o[3]),i[2]=yn(i[2],this._center.lat)*this.worldSize,o[2]=yn(o[2],this._center.lat)*this.worldSize,hn.scale(i,i,1/this.worldSize),hn.scale(o,o,1/this.worldSize),new H_([i[0],i[1],i[2]],J.normalize([],J.sub([],o,i)))}rayIntersectionCoordinate(t){let{p0:i,p1:o,t:c}=t,u=yn(i[2],this._center.lat),h=yn(o[2],this._center.lat);return new Fi(Ye(i[0],o[0],c)/this.worldSize,Ye(i[1],o[1],c)/this.worldSize,Ye(u,h,c))}pointCoordinate(t,i=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,i)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let i=this.projection.pointCoordinate3D(this,t.x,t.y);if(i)return new Fi(i[0],i[1],i[2]);let o=0,c=this.horizonLineFromTop();if(t.y>c)return this.pointCoordinate(t);let u=.02*c,h=t.clone();for(let p=0;p<10&&c-o>u;p++){h.y=Ye(o,c,.66);let f=this.projection.pointCoordinate3D(this,h.x,h.y);f?(c=h.y,i=f):o=h.y}return i?new Fi(i[0],i[1],i[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=Qc)return!this.isPointAboveHorizon(t);let i=this.pointCoordinate(t);return i.y>=0&&i.y<=1}_coordinatePoint(t,i){let o=i&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,c=[t.x*this.worldSize,t.y*this.worldSize,o+t.toAltitude(),1];return hn.transformMat4(c,c,this.pixelMatrix),c[3]>0?new Q(c[0]/c[3],c[1]/c[3]):new Q(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:t,left:i}=this._edgeInsets,o=this.height-this._edgeInsets.bottom,c=this.width-this._edgeInsets.right,u=this.pointLocation3D(new Q(i,t)),h=this.pointLocation3D(new Q(c,t)),p=this.pointLocation3D(new Q(c,o)),f=this.pointLocation3D(new Q(i,o)),g=Math.min(u.lng,h.lng,p.lng,f.lng),v=Math.max(u.lng,h.lng,p.lng,f.lng),y=Math.min(u.lat,h.lat,p.lat,f.lat),b=Math.max(u.lat,h.lat,p.lat,f.lat),x=Math.pow(2,-this.zoom)/16*270,C=this.projection.name==="globe"?1:4,E=(M,D,A,P,O)=>{let R=(M+A)/2,F=(D+P)/2,N=new Q(R,F),{lng:j,lat:U}=this.pointLocation3D(N),G=Math.max(0,g-j,y-U,j-v,U-b);g=Math.min(g,j),v=Math.max(v,j),y=Math.min(y,U),b=Math.max(b,U),(O<C||G>x)&&(E(M,D,R,F,O+1),E(R,F,A,P,O+1))};if(E(i,t,c,t,1),E(c,t,c,o,1),E(c,o,i,o,1),E(i,o,i,t,1),this.projection.name==="globe"){let[M,D]=function(A){let P=ft.identity(new Float64Array(16));ft.multiply(P,A.pixelMatrix,A.globeMatrix);let O=[0,fa,0],R=[0,ga,0];return J.transformMat4(O,O,P),J.transformMat4(R,R,P),[O[0]>0&&O[0]<=A.width&&O[1]>0&&O[1]<=A.height&&!$_(A,new Ze(A.center.lat,90)),R[0]>0&&R[0]<=A.width&&R[1]>0&&R[1]<=A.height&&!$_(A,new Ze(A.center.lat,-90))]}(this);M?(b=90,v=180,g=-180):D&&(y=-90,v=180,g=-180)}return new Es(new Ze(g,y),new Ze(v,b))}_getBoundsRectangular(t,i){let{top:o,left:c}=this._edgeInsets,u=this.height-this._edgeInsets.bottom,h=this.width-this._edgeInsets.right,p=new Q(c,o),f=new Q(h,o),g=new Q(h,u),v=new Q(c,u),y=this.pointCoordinate(p,t),b=this.pointCoordinate(f,t),x=this.pointCoordinate(g,i),C=this.pointCoordinate(v,i),E=(M,D)=>(D.y-M.y)/(D.x-M.x);return y.y>1&&b.y>=0?y=new Fi((1-C.y)/E(C,y)+C.x,1):y.y<0&&b.y<=1&&(y=new Fi(-C.y/E(C,y)+C.x,0)),b.y>1&&y.y>=0?b=new Fi((1-x.y)/E(x,b)+x.x,1):b.y<0&&y.y<=1&&(b=new Fi(-x.y/E(x,b)+x.x,0)),new Es().extend(this.coordinateLocation(y)).extend(this.coordinateLocation(b)).extend(this.coordinateLocation(C)).extend(this.coordinateLocation(x))}_getBoundsRectangularTerrain(){let t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);let i=t.visibleDemTiles.reduce((o,c)=>{if(c.dem){let u=c.dem.tree;o.min=Math.min(o.min,u.minimums[0]),o.max=Math.max(o.max,u.maximums[0])}return o},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(i.min*t.exaggeration(),i.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){let i=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,o=this.height/2-i*(1-this._horizonShift);return t?Math.max(0,o):o}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-Ir,this.maxLat=Ir,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=eo(this.minLng)*this.tileSize,this.worldMaxX=eo(this.maxLng)*this.tileSize,this.worldMinY=uo(this.maxLat)*this.tileSize,this.worldMaxY=uo(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,i){return this.projection.createTileMatrix(this,i,t)}calculateDistanceTileData(t){let i=t.key,o=this._distanceTileDataCache;if(o[i])return o[i];let c=t.canonical,u=1/this.height,h=this.cameraWorldSize,p=h/this.zoomScale(c.z),f=(c.x+Math.pow(2,c.z)*t.wrap)*p,g=c.y*p,v=this.point;v.x*=h/this.worldSize,v.y*=h/this.worldSize;let y=this.angle,b=Math.sin(-y),x=-Math.cos(-y);return o[i]={bearing:[b,x],center:[(v.x-f)*u,(v.y-g)*u],scale:p/wt*u},o[i]}calculateFogTileMatrix(t){let i=t.key,o=this._fogTileMatrixCache;if(o[i])return o[i];let c=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return ft.multiply(c,this.worldToFogMatrix,c),o[i]=new Float32Array(c),o[i]}calculateProjMatrix(t,i=!1,o=!1){let c=t.key,u;if(u=o?this._expandedProjMatrixCache:i?this._alignedProjMatrixCache:this._projMatrixCache,u[c])return u[c];let h=this.calculatePosMatrix(t,this.worldSize),p;return p=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:o?this.expandedFarZProjMatrix:i?this.alignedProjMatrix:this.projMatrix,ft.multiply(h,p,h),u[c]=new Float32Array(h),u[c]}calculatePixelsToTileUnitsMatrix(t){let i=t.tileID.key,o=this._pixelsToTileUnitsCache;if(o[i])return o[i];let c=function(u,h){let{scale:p}=u.tileTransform,f=p*wt/(u.tileSize*Math.pow(2,h.zoom-u.tileID.overscaledZ+u.tileID.canonical.z));return _h.scale(new Float32Array(4),h.inverseAdjustmentMatrix,[f,f])}(t,this);return o[i]=c,o[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let t=1/this.worldSize,i=ft.fromScaling([],[t,t,t]);return ft.multiply(i,i,this.globeMatrix),i}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let t=this._elevation;this._updateCameraState();let i=yn(1,this._center.lat)*this.worldSize,o=this._computeCameraPosition(i),c=this._camera.forward(),u=yn(1,this._center.lat);o[2]/=u,c[2]/=u,J.normalize(c,c);let h=t.raycast(o,c,t.exaggeration());if(h){let p=J.scaleAndAdd([],o,c,h),f=new Fi(p[0],p[1],yn(p[2],Wr(p[1]))),g=(f.z+J.length([f.x-o[0],f.y-o[1],f.z-o[2]*u]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(g),this._centerAltitude=f.toAltitude(),this._center=this.coordinateLocation(f),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;let i=this._elevation,o=yn(1,this._center.lat)*this.worldSize,c=this._computeCameraPosition(o),u=i.getAtPointOrZero(new Fi(...c)),h=this.pixelsPerMeter/this.worldSize*u,p=this._minimumHeightOverTerrain(),f=c[2]-h;if(f<=p)if(f<0||t){let g=this.locationCoordinate(this._center,this._centerAltitude),v=[c[0],c[1],g.z-c[2]],y=J.length(v);v[2]-=(p-f)/this._pixelsPerMercatorPixel;let b=J.length(v);if(b===0)return;J.scale(v,v,y/b*this._pixelsPerMercatorPixel),this._camera.position=[c[0],c[1],g.z*this._pixelsPerMercatorPixel-v[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){let b=this.center;return b.lat=ve(b.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(b.lng=ve(b.lng,this.minLng,this.maxLng)),this.center=b,void(this._constraining=!1)}let i=this._unmodified,{x:o,y:c}=this.point,u=0,h=o,p=c,f=this.width/2,g=this.height/2,v=this.worldMinY*this.scale,y=this.worldMaxY*this.scale;if(c-g<v&&(p=v+g),c+g>y&&(p=y-g),y-v<this.height&&(u=Math.max(u,this.height/(y-v)),p=(y+v)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let b=this.worldMinX*this.scale,x=this.worldMaxX*this.scale,C=this.worldSize/2-(b+x)/2;h=(o+C+this.worldSize)%this.worldSize-C,h-f<b&&(h=b+f),h+f>x&&(h=x-f),x-b<this.width&&(u=Math.max(u,this.width/(x-b)),h=(x+b)/2)}h===o&&p===c||(this.center=this.unproject(new Q(h,p))),u&&(this.zoom+=this.scaleZoom(u)),this._constrainCamera(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let t=this.centerOffset,i=this.projection.name==="globe",o=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=yn(1,this.center.lat)/yn(1,45));let c=Qp(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,c),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let u=this.projection.zAxisUnit==="meters"?o:1,h=this._camera.getWorldToCamera(this.worldSize,u),p,f=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(f[8]=2*-t.x/this.width,f[9]=2*t.y/this.height,this.isOrthographic){let U=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),G=U*this.aspect,Y=-G,Z=-U;G-=t.x,Y-=t.x,U+=t.y,Z+=t.y,p=this._camera.getCameraToClipOrthographic(Y,G,Z,U,this._nearZ,this._farZ),((tt,$,rt,st)=>{for(let pt=0;pt<16;pt++)tt[pt]=HR($[pt],rt[pt],st)})(p,p,f,GR(this.pitch>=15?1:this.pitch/15))}else p=f;let g=ft.mul([],f,h),v=ft.mul([],p,h);if(this.projection.isReprojectedInTileSpace){let U=this.locationCoordinate(this.center),G=ft.identity([]);ft.translate(G,G,[U.x*this.worldSize,U.y*this.worldSize,0]),ft.multiply(G,G,AR(this)),ft.translate(G,G,[-U.x*this.worldSize,-U.y*this.worldSize,0]),ft.multiply(v,v,G),ft.multiply(g,g,G),this.inverseAdjustmentMatrix=function(Y){let Z=AR(Y,!0);return _h.invert([],[Z[0],Z[1],Z[4],Z[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=ft.scale([],v,[this.worldSize,this.worldSize,this.worldSize/u,1]),this.projMatrix=v,this.invProjMatrix=ft.invert(new Float64Array(16),this.projMatrix),i){let U=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);U[8]=2*-t.x/this.width,U[9]=2*t.y/this.height,this.expandedFarZProjMatrix=ft.mul([],U,h)}else this.expandedFarZProjMatrix=this.projMatrix;let y=ft.invert([],p);this.frustumCorners=Lw.fromInvProjectionMatrix(y,this.horizonLineFromTop(),this.height),this.cameraFrustum=mc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!i);let b=new Float32Array(16);ft.identity(b),ft.scale(b,b,[1,-1,1]),ft.rotateX(b,b,this._pitch),ft.rotateZ(b,b,this.angle);let x=ft.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=ft.clone(x);let C=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;x[8]=2*-t.x/this.width,x[9]=2*(t.y+C)/this.height,this.skyboxMatrix=ft.multiply(b,x,b);let E=this.point,M=E.x,D=E.y,A=this.width%2/2,P=this.height%2/2,O=Math.cos(this.angle),R=Math.sin(this.angle),F=M-Math.round(M)+O*A+R*P,N=D-Math.round(D)+O*P+R*A,j=new Float64Array(v);if(ft.translate(j,j,[F>.5?F-1:F,N>.5?N-1:N,0]),this.alignedProjMatrix=j,v=ft.create(),ft.scale(v,v,[this.width/2,-this.height/2,1]),ft.translate(v,v,[1,-1,0]),this.labelPlaneMatrix=v,v=ft.create(),ft.scale(v,v,[1,-1,1]),ft.translate(v,v,[-1,-1,0]),ft.scale(v,v,[2/this.width,2/this.height,1]),this.glCoordMatrix=v,this.pixelMatrix=ft.multiply(new Float64Array(16),this.labelPlaneMatrix,g),this._calcFogMatrices(),this._distanceTileDataCache={},v=ft.invert(new Float64Array(16),this.pixelMatrix),!v)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=v,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=function(G){let{x:Y,y:Z}=G.point,{lng:tt,lat:$}=G._center;return KA(Y,Z,G.worldSize,tt,$)}(this);let U=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=J.transformMat4(U,U,h),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=v;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let t=this.cameraWorldSizeForFog,i=this.cameraPixelsPerMeter,o=this._camera.position,c=1/this.height/this._pixelsPerMercatorPixel,u=[t,t,i];J.scale(u,u,c),J.scale(o,o,-1),J.multiply(o,o,u);let h=ft.create();ft.translate(h,h,o),ft.scale(h,h,u),this.mercatorFogMatrix=h,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,i,c)}_computeCameraPosition(t){let i=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,o=this._camera.forward(),c=this.point,u=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*i-t/this.worldSize*this._centerAltitude;return[c.x/this.worldSize-o[0]*u,c.y/this.worldSize-o[1]*u,t/this.worldSize*this._centerAltitude-o[2]*u]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){let i=this._maxCameraBoundsDistance()*Math.cos(this._pitch),o=this._camera.position[2],c=t[2],u=1;this.projection.wrap&&(this.center=this.center.wrap()),c>0&&(u=Math.min((i-o)/c,1)),this._camera.position=J.scaleAndAdd([],this._camera.position,t,u),this._updateStateFromCamera()}_updateStateFromCamera(){let t=this._camera.position,i=this._camera.forward(),{pitch:o,bearing:c}=this._camera.getPitchBearing(),u=yn(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,h=this._mercatorZfromZoom(this._maxZoom)*Math.cos(fe(this._maxPitch)),p=Math.max((t[2]-u)/Math.cos(o),h),f=this._zoomFromMercatorZ(p);J.scaleAndAdd(t,t,i,p),this._pitch=ve(o,fe(this.minPitch),fe(this.maxPitch)),this.angle=ss(c,-Math.PI,Math.PI),this._setZoom(ve(f,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new Fi(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){let t=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let i=0,o=Qc,c=0,u=1/0;for(;o-i>1e-6&&o>i;){let h=i+.5*(o-i),p=this.tileSize*Math.pow(2,h),f=this.getCameraToCenterDistance(this.projection,h,p),g=this.scaleZoom(f/(t*this.tileSize)),v=Math.abs(h-g);v<u&&(u=v,c=h),h<g?i=h:o=h}return c}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(lt("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,i){let o=Math.min(t.x,i.x),c=Math.max(t.x,i.x),u=Math.min(t.y,i.y),h=Math.max(t.y,i.y);if(u<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let p=[new Q(o,u),new Q(c,h),new Q(o,h),new Q(c,u)],f=this.renderWorldCopies?-3:0,g=this.renderWorldCopies?4:1;for(let v of p){let y=this.pointRayIntersection(v);if(y.t<0)return!0;let b=this.rayIntersectionCoordinate(y);if(b.x<f||b.y<0||b.x>g||b.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+ei(this.fovAboveCenter)>88||this.anyCornerOffEdge(new Q(0,0),new Q(this.width,this.height))}zoomDeltaToMovement(t,i){let o=J.length(J.sub([],this._camera.position,t)),c=this._zoomFromMercatorZ(o)+i;return o-this._mercatorZfromZoom(c)}getCameraPoint(){if(this.projection.name==="globe"){let t=function([i,o,c],u){let h=[i,o,c,1];hn.transformMat4(h,h,u);let p=h[3]=Math.max(h[3],1e-6);return h[0]/=p,h[1]/=p,h[2]/=p,h}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new Q(t[0],t[1])}{let t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new Q(0,t))}}getCameraToCenterDistance(t,i=this.zoom,o=this.worldSize){let c=Qp(t,i,this.width,this.height,1024),u=t.pixelSpaceConversion(this.center.lat,o,c),h=.5/Math.tan(.5*this._fov)*this.height*u;return this.isOrthographic&&(h=HR(1,h,GR(this.pitch>=15?1:this.pitch/15))),h}getWorldToCameraMatrix(){let t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&ft.multiply(t,t,this.globeMatrix),t}getFrustum(t){return mc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}function qR(e,t,i){ft.identity(e),ft.rotateZ(e,e,fe(t[2])),ft.rotateX(e,e,fe(t[0])),ft.rotateY(e,e,fe(t[1])),ft.scale(e,e,i),ft.multiply(e,e,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function O0(e,t,i,o,c,u,h,p){let f=[i[0]-t[0],i[1]-t[1],0],g=[o[0]-t[0],o[1]-t[1],0];if(J.length(f)<1e-12||J.length(g)<1e-12)return Vo.identity(e);let v=J.cross([],f,g);J.normalize(v,v),J.subtract(g,o,t),f[2]=(u-c)*p,g[2]=(h-c)*p;let y=f;return J.cross(y,f,g),J.normalize(y,y),Vo.rotationTo(e,v,y)}function WR(e,t,i=!1){let o=Co(t.zoom),c=function(u,h,p){let f=h.worldSize,g=[u[12],u[13],u[14]],v=Wr(g[1]/f),y=Ms(g[0]/f),b=ft.identity([]),x=yn(1,v)*f,C=yn(1,0)*f*ed(v,h.zoom),E=1/Uw(f),M=C*E;if(p){let O=Qp(h.projection,h.zoom,h.width,h.height,1024);M=E*h.projection.pixelSpaceConversion(h.center.lat,f,O)}let D=hs(v,y);J.add(D,D,J.scale([],J.normalize([],D),x*M*g[2]));let A=function(O){let R=[O[0],O[1],O[2]],F=[0,1,0],N=J.cross([],F,R);return J.cross(F,R,N),J.squaredLength(F)===0&&(F=[0,1,0],J.cross(N,R,F)),J.normalize(N,N),J.normalize(F,F),J.normalize(R,R),[N[0],N[1],N[2],0,F[0],F[1],F[2],0,R[0],R[1],R[2],0,O[0],O[1],O[2],1]}(D);ft.scale(b,b,[M,M,M*x]),ft.translate(b,b,[-g[0],-g[1],-g[2]]);let P=ft.multiply([],h.globeMatrix,A);return ft.multiply(P,P,b),ft.multiply(P,P,u),P}(e,t,i);if(o>0){let u=function(h,p){let f=p.worldSize,g=yn(1,0)*f*ed(p.center.lat,p.zoom)/Uw(f),v=yn(1,p.center.lat)*f,y=ft.identity([]);return ft.rotateY(y,y,fe(p.center.lng)),ft.rotateX(y,y,fe(p.center.lat)),ft.translate(y,y,[0,0,es]),ft.scale(y,y,[g,g,g*v]),ft.translate(y,y,[p.point.x-.5*f,p.point.y-.5*f,0]),ft.multiply(y,y,h),ft.multiply(y,p.globeMatrix,y)}(e,t);return function(h,p,f){let g=(C,E,M)=>{let D=J.length(C),A=J.length(E),P=pc(C,E,M);return J.scale(P,P,1/J.length(P)*Ye(D,A,M))},v=g([h[0],h[1],h[2]],[p[0],p[1],p[2]],f),y=g([h[4],h[5],h[6]],[p[4],p[5],p[6]],f),b=g([h[8],h[9],h[10]],[p[8],p[9],p[10]],f),x=pc([h[12],h[13],h[14]],[p[12],p[13],p[14]],f);return[v[0],v[1],v[2],0,y[0],y[1],y[2],0,b[0],b[1],b[2],0,x[0],x[1],x[2],1]}(c,u,o)}return c}let cu=64,dG=[1,1,1];class $R{constructor(t,i,o,c){this.id=t,this.position=i!=null?new Ze(i[0],i[1]):new Ze(0,0),this.orientation=o??[0,0,0],this.nodes=c,this.uploaded=!1,this.aabb=new Vn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,i){if(ft.multiply(t.matrix,i,t.matrix),t.meshes)for(let o of t.meshes){let c=Vn.applyTransform(o.aabb,t.matrix);this.aabb.encapsulate(c)}if(t.children)for(let o of t.children)this._applyTransformations(o,t.matrix)}computeBoundsAndApplyParent(){let t=ft.identity([]);for(let i of this.nodes)this._applyTransformations(i,t)}_positionModelOnTerrain(t,i){let o=t.elevation;if(!o)return 0;let c=Vn.projectAabbCorners(this.aabb,this.matrix),u=yn(1,this.position.lat)*t.worldSize,h=function(D,A){let P=[0,0,1],O=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let R of O){let F=D[R.corners[0]],N=D[R.corners[1]],j=D[R.corners[2]],U=[N[0]-F[0],N[1]-F[1],A*(N[2]-F[2])],G=J.cross(U,U,[j[0]-F[0],j[1]-F[1],A*(j[2]-F[2])]);J.normalize(G,G),R.dotProductWithUp=J.dot(G,P)}return O.sort((R,F)=>R.dotProductWithUp-F.dotProductWithUp),O[0].corners}(c,u),p=c[h[0]],f=c[h[1]],g=c[h[2]],v=c[h[3]],y=o.getAtPointOrZero(new Fi(p[0]/t.worldSize,p[1]/t.worldSize),0),b=o.getAtPointOrZero(new Fi(f[0]/t.worldSize,f[1]/t.worldSize),0),x=o.getAtPointOrZero(new Fi(g[0]/t.worldSize,g[1]/t.worldSize),0),C=o.getAtPointOrZero(new Fi(v[0]/t.worldSize,v[1]/t.worldSize),0),E=(y+C)/2,M=(b+x)/2;return E>M?b<x?O0(i,f,v,p,b,C,y,u):O0(i,g,p,v,x,y,C,u):y<C?O0(i,p,f,g,y,b,x,u):O0(i,v,g,f,C,x,b,u),Math.max(E,M)}computeModelMatrix(t,i,o,c,u,h,p=!1){let f=t.transform,g=f.zoom,v=f.project(this.position),y=ed(this.position.lat,g),b=1/y;ft.identity(this.matrix),ft.translate(this.matrix,this.matrix,[v.x+c[0]*b,v.y+c[1]*b,c[2]]);let x=1,C=1,E=f.worldSize;if(p){if(f.projection.name==="mercator"){let P=0;f.elevation&&(P=f.elevation.getAtPointOrZero(new Fi(v.x/E,v.y/E),0));let O=hn.transformMat4([],[v.x,v.y,P,1],f.projMatrix)[3]/f.cameraToCenterDistance;x=O,C=O*ed(f.center.lat,g)}else if(f.projection.name==="globe"){let P=WR(this.matrix,f),O=ft.multiply([],f.projMatrix,P),R=[0,0,0,1];hn.transformMat4(R,R,O);let F=R[3]/f.cameraToCenterDistance,N=Co(g),j=f.projection.pixelsPerMeter(this.position.lat,E)*ed(this.position.lat,g),U=f.projection.pixelsPerMeter(f.center.lat,E)*ed(f.center.lat,g);x=F/Ye(j,sk(f.center.lat),N),C=F*y/j,x*=U,C*=U}}else x=b;ft.scale(this.matrix,this.matrix,[x,x,C]);let M=[...this.matrix],D=this.orientation,A=[];if(qR(A,[D[0]+i[0],D[1]+i[1],D[2]+i[2]],o),ft.multiply(this.matrix,M,A),u&&f.elevation){let P=0,O=[];if(h&&f.elevation){P=this._positionModelOnTerrain(f,O);let R=ft.fromQuat([],O),F=ft.multiply([],R,A);ft.multiply(this.matrix,M,F)}else P=f.elevation.getAtPointOrZero(new Fi(v.x/E,v.y/E),0);P!==0&&(this.matrix[14]+=P)}}upload(t){if(!this.uploaded){for(let i of this.nodes)AC(i,t);for(let i of this.nodes)F0(i);this.uploaded=!0}}destroy(){for(let t of this.nodes)L0(t)}}function Jp(e,t,i=!1){e.uploaded||(e.gfxTexture=new or(t,e.image,i?t.gl.R8:t.gl.RGBA,{useMipmap:e.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),e.uploaded=!0,e.image=null)}function uG(e,t,i){e.indexBuffer=t.createIndexBuffer(e.indexArray,!1,!0),e.vertexBuffer=t.createVertexBuffer(e.vertexArray,tG.members,!1,!0),e.normalArray&&(e.normalBuffer=t.createVertexBuffer(e.normalArray,rG.members,!1,!0)),e.texcoordArray&&(e.texcoordBuffer=t.createVertexBuffer(e.texcoordArray,nG.members,!1,!0)),e.colorArray&&(e.colorBuffer=t.createVertexBuffer(e.colorArray,(e.colorArray.bytesPerElement===12?eG:iG).members,!1,!0)),e.featureArray&&(e.pbrBuffer=t.createVertexBuffer(e.featureArray,sG.members,!0)),e.segments=un.simpleSegment(0,0,e.vertexArray.length,e.indexArray.length);let o=e.material;o.pbrMetallicRoughness.baseColorTexture&&Jp(o.pbrMetallicRoughness.baseColorTexture,t),o.pbrMetallicRoughness.metallicRoughnessTexture&&Jp(o.pbrMetallicRoughness.metallicRoughnessTexture,t),o.normalTexture&&Jp(o.normalTexture,t),o.occlusionTexture&&Jp(o.occlusionTexture,t,i),o.emissionTexture&&Jp(o.emissionTexture,t)}function AC(e,t,i){if(e.meshes)for(let o of e.meshes)uG(o,t,i);if(e.children)for(let o of e.children)AC(o,t,i)}function F0(e){if(e.meshes)for(let t of e.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(e.children)for(let t of e.children)F0(t)}function L0(e){if(e.meshes)for(let i of e.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((t=i.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(e.children)for(let i of e.children)L0(i)}class YR{constructor(t,i){this.feature=t,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class ZR{constructor(){this.instancedDataArray=new hw,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class XR{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=t.projection,this.index=t.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(t,i,o,c){this.tileToMeter=Lp(o);let u=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:h,id:p,index:f,sourceLayerIndex:g}of t){let v=id(h,u);if(!this.layers[0]._featureFilter.filter(new ir(this.zoom),v,o))continue;let y={id:p,sourceLayerIndex:g,index:f,geometry:u?v.geometry:Dl(h,o,c),properties:h.properties,type:h.type,patterns:{}},b=this.addFeature(y,y.geometry,v);b&&i.featureIndex.insert(h,y.geometry,f,g,this.index,this.instancesPerModel[b].instancedDataArray.length)}this.lookup=null}update(t,i,o,c){for(let u in this.instancesPerModel){let h=this.instancesPerModel[u];for(let p in t)h.idToFeaturesIndex.hasOwnProperty(p)&&this.evaluate(h.features[h.idToFeaturesIndex[p]],t[p],h,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(let i in this.instancesPerModel){let o=this.instancesPerModel[i];for(let c of o.features){let u=this.layers[0],h=c.feature,p=this.canonical,f=u.paint.get("model-rotation").evaluate(h,{},p),g=u.paint.get("model-scale").evaluate(h,{},p),v=u.paint.get("model-translation").evaluate(h,{},p);J.exactEquals(c.rotation,f)&&J.exactEquals(c.scale,g)&&J.exactEquals(c.translation,v)||(this.evaluate(c,c.featureStates,o,!0),t=!0)}}return t}isEmpty(){for(let t in this.instancesPerModel)if(this.instancesPerModel[t].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(let i in this.instancesPerModel){let o=this.instancesPerModel[i];o.instancedDataArray.length<0||o.instancedDataArray.length===0||(o.instancedDataBuffer?o.instancedDataBuffer.updateData(o.instancedDataArray):o.instancedDataBuffer=t.createVertexBuffer(o.instancedDataArray,oG.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let t in this.instancesPerModel){let i=this.instancesPerModel[t];i.instancedDataArray.length!==0&&i.instancedDataBuffer&&i.instancedDataBuffer.destroy()}}addFeature(t,i,o){let c=this.layers[0],u=c.layout.get("model-id").evaluate(o,{},this.canonical);if(!u)return lt(`modelId is not evaluated for layer ${c.id} and it is not going to get rendered.`),u;this.instancesPerModel[u]||(this.instancesPerModel[u]=new ZR);let h=this.instancesPerModel[u],p=h.instancedDataArray,f=new YR(o,p.length);for(let g of i)for(let v of g){if(v.x<0||v.x>=wt||v.y<0||v.y>=wt)continue;let y=(this.lookupDim-1)/wt,b=this.lookupDim*(v.y*y|0)+v.x*y|0;if(this.lookup){if(this.lookup[b]!==0)continue;this.lookup[b]=1}this.instanceCount++;let x=p.length;p.resize(x+1),h.instancesEvaluatedElevation.push(0),p.float32[16*x]=v.x,p.float32[16*x+1]=v.y}return f.instancedDataCount=h.instancedDataArray.length-f.instancedDataOffset,f.instancedDataCount>0&&(t.id&&(h.idToFeaturesIndex[t.id]=h.features.length),h.features.push(f),this.evaluate(f,{},h,!1)),u}evaluate(t,i,o,c){let u=this.layers[0],h=t.feature,p=this.canonical,f=t.rotation=u.paint.get("model-rotation").evaluate(h,i,p),g=t.scale=u.paint.get("model-scale").evaluate(h,i,p),v=t.translation=u.paint.get("model-translation").evaluate(h,i,p),y=u.paint.get("model-color").evaluate(h,i,p);y.a=u.paint.get("model-color-mix-intensity").evaluate(h,i,p);let b=[];this.maxVerticalOffset<v[2]&&(this.maxVerticalOffset=v[2]),this.maxScale=Math.max(Math.max(this.maxScale,g[0]),Math.max(g[1],g[2])),qR(b,f,g);let x=Math.round(100*y.a)+y.b/1.05;for(let C=0;C<t.instancedDataCount;++C){let E=t.instancedDataOffset+C,M=16*E,D=o.instancedDataArray.float32,A=0;c&&(A=D[M+6]-o.instancesEvaluatedElevation[E]);let P=0|D[M+1];D[M]=(0|D[M])+y.r/1.05,D[M+1]=P+y.g/1.05,D[M+2]=x,D[M+3]=1/(p.z>10?this.tileToMeter:Lp(p,P)),D[M+4]=v[0],D[M+5]=v[1],D[M+6]=v[2]+A,D[M+7]=b[0],D[M+8]=b[1],D[M+9]=b[2],D[M+10]=b[4],D[M+11]=b[5],D[M+12]=b[6],D[M+13]=b[8],D[M+14]=b[9],D[M+15]=b[10],o.instancesEvaluatedElevation[E]=v[2]}}}Ce(XR,"ModelBucket",{omit:["layers"]}),Ce(ZR,"PerModelAttributes"),Ce(YR,"ModelFeature");let hG=new yr({visibility:new Ut(_t.layout_model.visibility),"model-id":new Re(_t.layout_model["model-id"])});var mG={paint:new yr({"model-opacity":new Ut(_t.paint_model["model-opacity"]),"model-rotation":new Re(_t.paint_model["model-rotation"]),"model-scale":new Re(_t.paint_model["model-scale"]),"model-translation":new Re(_t.paint_model["model-translation"]),"model-color":new Re(_t.paint_model["model-color"]),"model-color-mix-intensity":new Re(_t.paint_model["model-color-mix-intensity"]),"model-type":new Ut(_t.paint_model["model-type"]),"model-cast-shadows":new Ut(_t.paint_model["model-cast-shadows"]),"model-receive-shadows":new Ut(_t.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Ut(_t.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Re(_t.paint_model["model-emissive-strength"]),"model-roughness":new Re(_t.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Re(_t.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Ut(_t.paint_model["model-cutoff-fade-range"])}),layout:hG};let kC=new Float32Array(262144),du=new Uint8Array(262144);function KR(e){let t=0;if(e.meshes)for(let i of e.meshes)t=Math.max(t,i.aabb.max[2]);if(e.children)for(let i of e.children)t=Math.max(t,KR(i));return t}let QR=["","wall","door","roof","window","lamp","logo"];class JR{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:t.id,geometry:[],properties:{height:KR(t)}}}}class tP{constructor(t,i,o,c){this.nodes=t,this.id=i,this.modelTraits|=1,this.uploaded=!1,this.hasPattern=!1,o&&(this.modelTraits|=4),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=c,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;let i=this.getNodesInfo();for(let o of i){let c=o.node;this.uploaded?this.updatePbrBuffer(c):AC(c,t,!0)}for(let o of i)F0(o.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let i=!1;if(!t.meshes)return i;for(let o of t.meshes)o.pbrBuffer&&(o.pbrBuffer.updateData(o.featureArray),i=!0);return i}needsReEvaluation(t,i,o){let c=t.transform.projectionOptions,u=t.style.getBrightness(),h=this.brightness!==u;return!!(!this.uploaded||this.dirty||c.name!==this.projection.name||tf(o.paint.get("model-color").value,h)||tf(o.paint.get("model-color-mix-intensity").value,h)||tf(o.paint.get("model-roughness").value,h)||tf(o.paint.get("model-emissive-strength").value,h)||tf(o.paint.get("model-height-based-emissive-strength-multiplier").value,h))&&(this.projection=c,this.brightness=u,!0)}evaluateScale(t,i){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;let o=this.getNodesInfo(),c=this.id.canonical;for(let u of o){let h=u.feature;u.evaluatedScale=i.paint.get("model-scale").evaluate(h,{},c)}}evaluate(t){let i=this.getNodesInfo();for(let o of i){if(!o.node.meshes)continue;let c=o.feature,u=o.node.meshes&&o.node.meshes[0].featureData,h=o.evaluatedColor[2],p=o.evaluatedRMEA[2],f=this.id.canonical;if(o.hasTranslucentParts=!1,u){for(let g=0;g<QR.length;g++){let v=QR[g];v.length&&(c.properties.part=v);let y=t.paint.get("model-color").evaluate(c,{},f),b=t.paint.get("model-color-mix-intensity").evaluate(c,{},f);o.evaluatedColor[g]=[y.r,y.g,y.b,b],o.evaluatedRMEA[g][0]=t.paint.get("model-roughness").evaluate(c,{},f),o.evaluatedRMEA[g][2]=t.paint.get("model-emissive-strength").evaluate(c,{},f),o.evaluatedRMEA[g][3]=y.a,o.emissionHeightBasedParams[g]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(c,{},f),!o.hasTranslucentParts&&y.a<1&&(o.hasTranslucentParts=!0)}delete c.properties.part,fG(o,h!==o.evaluatedColor[2]||p!==o.evaluatedRMEA[2])}o.evaluatedScale=t.paint.get("model-scale").evaluate(c,{},f),this.updatePbrBuffer(o.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,i,o,c){let u=t.findDEMTileFor(o);if(u&&(u.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(u.dem&&u.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=u.tileID.overscaledZ;let h=Dh.create(t,o,u);if(!h)return;4&this.modelTraits&&this.updateDEM(t,h,o,c);for(let p of this.getNodesInfo()){let f=p.node;if(!f.footprint||!f.footprint.vertices||!f.footprint.vertices.length)continue;let g=f.footprint.vertices,v=h.getElevationAt(g[0].x,g[0].y,!0,!0);for(let y=1;y<g.length;y++)v=Math.min(v,h.getElevationAt(g[y].x,g[y].y,!0,!0));f.elevation=v}}this.terrainTile=u.tileID.canonical,this.terrainExaggeration=i}}updateDEM(t,i,o,c){let u=i._dem._modifiedForSources[c];if(u===void 0&&(i._dem._modifiedForSources[c]=[],u=i._dem._modifiedForSources[c]),u.includes(o.canonical))return;let h=i._dem.dim;u.push(o.canonical);let p=!1;for(let f of this.getNodesInfo()){let g=f.node;if(!g.footprint||!g.footprint.grid)continue;let v=g.footprint.grid,y=i.tileCoordToPixel(v.min.x,v.min.y),b=i.tileCoordToPixel(v.max.x,v.max.y),x=Math.min(Math.min(h-b.y,y.x),Math.min(y.y,h-b.x));if(x<0)continue;let C=ve(x,2,5),E=Math.max(0,y.x-C),M=Math.max(0,y.y-C),D=Math.min(b.x+C,h-1),A=Math.min(b.y+C,h-1);for(let F=M;F<=A;++F)for(let N=E;N<=D;++N)du[F*h+N]=255;let P=0,O=0;for(let F=0;F<v.cellsY;++F)for(let N=0;N<v.cellsX;++N){if(!v.cells[F*v.cellsX+N])continue;let j=i.tileCoordToPixel(v.min.x+N/v.xScale,v.min.y+F/v.yScale),U=i.tileCoordToPixel(v.min.x+(N+1)/v.xScale,v.min.y+(F+1)/v.yScale);for(let G=j.y;G<=Math.min(U.y+1,h-1);++G)for(let Y=j.x;Y<=Math.min(U.x+1,h-1);++Y)du[G*h+Y]===255&&(du[G*h+Y]=0,P+=i.getElevationAtPixel(Y,G),O++)}let R=P/O;E=Math.max(1,y.x-C),M=Math.max(1,y.y-C),D=Math.min(b.x+C,h-2),A=Math.min(b.y+C,h-2),p=!0;for(let F=M;F<=A;++F)for(let N=E;N<=D;++N)du[F*h+N]===0&&(kC[F*h+N]=i._dem.set(N,F,R));for(let F=1;F<C;++F){E=Math.max(1,y.x-F),M=Math.max(1,y.y-F),D=Math.min(b.x+F,h-2),A=Math.min(b.y+F,h-2);for(let N=M;N<=A;++N)for(let j=E;j<=D;++j){let U=N*h+j;if(du[U]===255){let G=0,Y=0,Z=-1,tt=-1;for(let $=-1;$<=1;++$)for(let rt=-1;rt<=1;++rt){let st=(N+$)*h+j+rt;if(du[st]>=F)continue;let pt=kC[st],nt=Math.abs(pt);nt>Y&&(G=pt,Y=nt,Z=rt,tt=$)}if(Y>.1){let $=1-(F+.5*Math.abs(Z*tt))/C,rt=i._dem.get(j,N)+G*$,st=i._dem.get(j+Z,N+tt),pt=i._dem.get(j-Z,N-tt,!0);(rt-st)*(rt-pt)>0&&(rt=(st+pt)/2),kC[U]=i._dem.set(j,N,rt),du[U]=F}}}}}p&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=ii.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(let t of this.nodes)this.nodesInfo.push(new JR(t));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(let t of this.nodes)L0(t);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();let t=this.getNodesInfo();for(let i of t)F0(i.node),L0(i.node)}isEmpty(){return!this.nodes.length}updateReplacement(t,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;let o=i.getReplacementRegionsForTile(t.toUnwrapped()),c=this.getNodesInfo();for(let u=0;u<this.nodesInfo.length;u++){let h=c[u].node;c[u].hiddenByReplacement=!!h.footprint&&!o.find(p=>p.footprint===h.footprint)}}getHeightAtTileCoord(t,i){let o=this.getNodesInfo(),c=[];for(let u=0;u<this.nodesInfo.length;u++){let h=o[u],p=h.node.meshes[0];if(t<p.aabb.min[0]||i<p.aabb.min[1]||t>p.aabb.max[0]||i>p.aabb.max[1])continue;let f=(t-p.aabb.min[0])/(p.aabb.max[0]-p.aabb.min[0])*cu|0,g=Math.min(63,(i-p.aabb.min[1])/(p.aabb.max[1]-p.aabb.min[1])*cu|0)*cu+Math.min(63,f);if(!(p.heightmap[g]<0&&h.node.footprint))return h.hiddenByReplacement?void 0:{height:p.heightmap[g],maxHeight:h.feature.properties.height,hidden:!1,verticalScale:h.evaluatedScale[2]};if(h.node.footprint.grid.query(new Q(t,i),new Q(t,i),c),c.length>0)return{height:void 0,maxHeight:h.feature.properties.height,hidden:h.hiddenByReplacement,verticalScale:h.evaluatedScale[2]}}}}function tf(e,t){return!e.isLightConstant&&t}function pG(e,t,i,o,c,u,h,p){let f=(61440&t|(61440&t)>>4)>>8,g=(3840&t|(3840&t)>>4)>>4,v=240&t|(240&t)>>4;i[3]>0&&(f=Ye(f,255*i[0],i[3]),g=Ye(g,255*i[1],i[3]),v=Ye(v,255*i[2],i[3]));let y=f<<8|g,b=v<<8|Math.floor(255*o[3]),x=function(F){let N=ve(F,0,2);return Math.min(Math.round(.5*N*255),255)}(o[2])<<8|15*o[0]<<4|15*o[1],C=ve(c[0],0,1),E=ve(c[1],0,1),M=ve(c[2],0,1),D=ve(c[3],0,1),A,P,O,R;if(C!==E&&h!==u&&E!==C){let F=h-u;P=1/(F*(E-C)),O=-(u+F*C)/(F*(E-C));let N=ve(c[4],-1,1);R=Math.pow(10,N),A=255*M<<8|255*D}else A=65535,P=0,O=1,R=1;if(e.emplaceBack(y,b,x,A,P,O,R),p){let F=p.length;p.clear();for(let N=0;N<F;N++)p.emplaceBack(y,b,x,A,P,O,R)}}function fG(e,t){let i=e.node,o=0;for(let c of i.meshes){if(i.lights&&i.lightMeshIndex===o||!c.featureData)continue;c.featureArray=new L_,c.featureArray.reserve(c.featureData.length);let u=t;for(let h of c.featureData){let p,f=65535&h,g=(15&f)<8?15&f:0,v=h>>16&65535,y=e.evaluatedRMEA[g],b=e.evaluatedColor[g],x=e.emissionHeightBasedParams[g];if(u&&g===2&&i.lights&&(p=new L_,p.resize(10*i.lights.length)),pG(c.featureArray,v,b,y,x,c.aabb.min[2],c.aabb.max[2],p),p&&u){u=!1;let C=i.meshes[i.lightMeshIndex];C.featureArray=p,C.featureArray._trim()}}c.featureArray._trim(),o++}}Ce(tP,"Tiled3dModelBucket",{omit:["layers"]}),Ce(JR,"Tiled3dModelFeature");class gG{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){let i=nP(new Q(0,0),new Q(wt,wt),t),o=[];for(let c of this._activeRegions){if(c.hiddenByOverlap||!iP(i,c))continue;let u=_G(c.min,c.max,t);o.push({min:u.min,max:u.max,sourceId:this._sourceIds[c.priority],footprint:c.footprint,footprintTileId:c.tileId})}return o}setSources(t){this._setSources(t.map(i=>({getSourceId:()=>i.cache.id,getFootprints:()=>{let o=[];for(let c of i.cache.getVisibleCoordinates()){let u=i.cache.getTile(c).buckets[i.layer];if(u)for(let h of u.getNodesInfo()){let p=h.node;p.footprint&&o.push({footprint:p.footprint,id:c.toUnwrapped()})}}return o}})))}_addSource(t){let i=t.getFootprints();if(i.length!==0){for(let o of i){if(!o.footprint)continue;let c=nP(o.footprint.min,o.footprint.max,o.id);this._activeRegions.push({min:c.min,max:c.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:o.id,footprint:o.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((i,o)=>i.priority-o.priority||z0(i.min,o.min)||z0(i.max,o.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let i=0,o=0;for(;!t&&i!==this._activeRegions.length;){let c=this._activeRegions[i],u=this._prevRegions[o];t=c.priority!==u.priority||!eP(c,u),++i,++o}}if(t){++this._updateTime;let i=o=>{let c=this._activeRegions;if(o>=c.length)return o;let u=c[o].priority;for(;o<c.length&&c[o].priority===u;)++o;return o};if(this._sourceIds.length>1){let o=0,c=i(o);for(;o!==c;){let u=o,h=o;for(;u!==c;){let p=this._activeRegions[u];p.hiddenByOverlap=!1;for(let f=0;f<h;f++){let g=this._activeRegions[f];if(!g.hiddenByOverlap&&iP(p,g)&&(p.hiddenByOverlap=oP(p.footprint,p.tileId,g.footprint,g.tileId),p.hiddenByOverlap))break}++u}o=c,c=i(o)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let i=t.length-1;i>=0;i--)this._addSource(t[i]);this._computeReplacement()}}function z0(e,t){return e.x-t.x||e.y-t.y}function eP(e,t){return z0(e.min,t.min)===0&&z0(e.max,t.max)===0}function iP(e,t){return!(e.min.x>t.max.x||e.max.x<t.min.x||e.min.y>t.max.y||e.max.y<t.min.y)}function nP(e,t,i){let o=1/wt,c=1/(1<<i.canonical.z),u=(t.x*o+i.canonical.x)*c+i.wrap,h=(t.y*o+i.canonical.y)*c;return{min:new Q((e.x*o+i.canonical.x)*c+i.wrap,(e.y*o+i.canonical.y)*c),max:new Q(u,h)}}function _G(e,t,i){let o=1<<i.canonical.z,c=((t.x-i.wrap)*o-i.canonical.x)*wt,u=(t.y*o-i.canonical.y)*wt;return{min:new Q(((e.x-i.wrap)*o-i.canonical.x)*wt,(e.y*o-i.canonical.y)*wt),max:new Q(c,u)}}function rP(e,t,i,o,c,u,h){let p=e.indices,f=e.vertices,g=[];for(let v=o;v<o+c;v+=3){let y=t[i[v+0]+u],b=t[i[v+1]+u],x=t[i[v+2]+u],C=Math.min(y.x,b.x,x.x),E=Math.max(y.x,b.x,x.x),M=Math.min(y.y,b.y,x.y),D=Math.max(y.y,b.y,x.y);g.length=0,e.grid.query(new Q(C,M),new Q(E,D),g);for(let A=0;A<g.length;A++){let P=g[A];if(Kw(f[p[3*P+0]],f[p[3*P+1]],f[p[3*P+2]],y,b,x,h))return!0}}return!1}function oP(e,t,i,o){if(!e||!i)return!1;let c=e.vertices;if(!t.canonical.equals(o.canonical)||t.wrap!==o.wrap){if(i.vertices.length<e.vertices.length)return oP(i,o,e,t);let u=t.canonical,h=o.canonical,p=Math.pow(2,h.z-u.z);c=e.vertices.map(f=>new Q(f.x*u.x*wt*p-h.x*wt,f.y*u.y*wt*p-h.y*wt))}return rP(i,c,e.indices,0,e.indices.length,0,0)}let vG=s0.types,yG=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],bG=["fill-extrusion-flood-light-ground-radius"],xG=Math.pow(2,13),wG=Math.pow(2,15)-1,sP=new Q(0,1),kl=2147483648;function ef(e,t,i,o,c,u,h,p){e.emplaceBack((t<<1)+h,(i<<1)+u,(Math.floor(o*xG)<<1)+c,Math.round(p))}function N0(e,t,i,o,c,u){e.emplaceBack(t.x,t.y,(i.x<<1)+o,(i.y<<1)+c,u)}function nf(e,t,i){e.emplaceBack(t.x,t.y,t.z,i[0]*16384,i[1]*16384,i[2]*16384)}class aP{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class lP{constructor(){this.centroidXY=new Q(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Q(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Q(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Q(this.max.x-this.min.x,this.max.y-this.min.y)}}class cP{constructor(){this.acc=new Q(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,i){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=i.x,t.min.y=t.max.y=i.y)}appendEdge(t,i,o){this.accCount++,this.acc._add(i);let c=!!this.borders;i.x<t.min.x?(t.min.x=i.x,c=!0):i.x>t.max.x&&(t.max.x=i.x,c=!0),i.y<t.min.y?(t.min.y=i.y,c=!0):i.y>t.max.y&&(t.max.y=i.y,c=!0),((i.x===0||i.x===wt)&&i.x===o.x)!=((i.y===0||i.y===wt)&&i.y===o.y)&&this.processBorderOverlap(i,o),c&&this.checkBorderIntersection(i,o)}checkBorderIntersection(t,i){i.x<0!=t.x<0&&this.addBorderIntersection(0,Ye(i.y,t.y,(0-i.x)/(t.x-i.x))),i.x>wt!=t.x>wt&&this.addBorderIntersection(1,Ye(i.y,t.y,(wt-i.x)/(t.x-i.x))),i.y<0!=t.y<0&&this.addBorderIntersection(2,Ye(i.x,t.x,(0-i.y)/(t.y-i.y))),i.y>wt!=t.y>wt&&this.addBorderIntersection(3,Ye(i.x,t.x,(wt-i.y)/(t.y-i.y)))}addBorderIntersection(t,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let o=this.borders[t];i<o[0]&&(o[0]=i),i>o[1]&&(o[1]=i)}processBorderOverlap(t,i){if(t.x===i.x){if(t.y===i.y)return;let o=t.x===0?0:1;this.addBorderIntersection(o,i.y),this.addBorderIntersection(o,t.y)}else{let o=t.y===0?2:3;this.addBorderIntersection(o,i.x),this.addBorderIntersection(o,t.x)}}centroid(){return this.accCount===0?new Q(0,0):new Q(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((t,i)=>t+ +(i[0]!==Number.MAX_VALUE),0):0}}function dP(e,t){let i=e.add(t)._unit(),o=ve(e.x*i.x+e.y*i.y,-1,1);var c,u,h;return c=Math.acos(o),Math.min(4,Math.max(-4,Math.tan(c)))/4*wG*((u=e).x*(h=t).y-u.y*h.x<0?-1:1)}let CG=[e=>e.x<0,e=>e.x>wt,e=>e.y<0,e=>e.y>wt];function SG(e,t,i,o){let c=[4];if(o===0)return c;i._mult(o);let u=e.sub(i),h=t.sub(i),p=[e,t,u,h];for(let f=0;f<4;f++)for(let g of p)if(CG[f](g)){c.push(f);break}return c}class uP{constructor(t){this.vertexArray=new tw,this.indexArray=new qr,this.programConfigurations=new Zc(t.layers,t.zoom,i=>bG.includes(i)),this._segments=new un,this.hiddenByLandmarkVertexArray=new mw,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new un}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(t,i,o,c=!1){let u=t.length;if(u>2){let h=Math.max(0,this._segments.get().length-1),p=this._segments._prepareSegment(4*u,this.vertexArray.length,2*this._segmentToGroundQuads[h].length),f;h!==this._segments.get().length-1&&(h++,this._segmentToGroundQuads[h]=[],this._segmentToRegionTriCounts[h]=[0,0,0,0,0]);{let g=t[0],v=t[1];f=dP(g.sub(t[u-1])._perp()._unit(),v.sub(g)._perp()._unit())}for(let g=0;g<u;g++){let v=g===u-1?0:g+1,y=t[g],b=t[v],x=t[v===u-1?0:v+1],C=b.sub(y)._perp()._unit(),E=dP(C,x.sub(b)._perp()._unit()),M=f,D=E;if(RC(y,b,i)||c&&pP(y,i)&&pP(b,i)){f=E;continue}let A=p.vertexLength;N0(this.vertexArray,y,b,1,1,M),N0(this.vertexArray,y,b,1,0,M),N0(this.vertexArray,y,b,0,1,D),N0(this.vertexArray,y,b,0,0,D),p.vertexLength+=4;let P=SG(y,b,C,o);for(let O of P)this._segmentToGroundQuads[h].push({id:A,region:O}),this._segmentToRegionTriCounts[h][O]+=2,p.primitiveLength+=2;f=E}}}prepareBorderSegments(){if(!this.hasData())return;let t=this._segments.get(),i=t.length;for(let o=0;o<i;o++)this._segmentToGroundQuads[o].sort((c,u)=>c.region-u.region);for(let o=0;o<i;o++){let c=this._segmentToGroundQuads[o],u=t[o],h=this._segmentToRegionTriCounts[o];h.reduce((f,g)=>f+g,0);let p=0;for(let f=0;f<=4;f++){let g=h[f];if(g!==0){let v=this.regionSegments[f];v||(v=this.regionSegments[f]=new un);let y={vertexOffset:u.vertexOffset,primitiveOffset:u.primitiveOffset+p,vertexLength:u.vertexLength,primitiveLength:g};v.get().push(y)}p+=g}for(let f=0;f<c.length;f++){let g=c[f].id;this.indexArray.emplaceBack(g,g+1,g+3),this.indexArray.emplaceBack(g,g+3,g+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,i,o,c,u,h){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,i,o,c,u,h)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,ZU.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,i,o,c,u,h){this.hasData()&&this.programConfigurations.updatePaintArrays(t,i,o,c,u,h)}updateHiddenByLandmark(t){if(!this.hasData())return;let i=t.groundVertexCount+t.groundVertexArrayOffset;if(t.groundVertexCount===0)return;let o=t.flags&kl?1:0;for(let c=t.groundVertexArrayOffset;c<i;++c)this.hiddenByLandmarkVertexArray.emplace(c,o);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,KU.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){let i=this.regionSegments[t];i&&i.destroy()}}}}class rf{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new qr,this.footprintVertices=new Cs,this.footprintSegments=[],this.layoutVertexArray=new tu,this.centroidVertexArray=new b2,this.indexArray=new qr,this.programConfigurations=new Zc(t.layers,t.zoom,i=>yG.includes(i)),this.segments=new un,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new uP(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(t,i,o,c){this.features=[],this.hasPattern=rC("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Lp(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:u,id:h,index:p,sourceLayerIndex:f}of t){let g=this.layers[0]._featureFilter.needGeometry,v=id(u,g);if(!this.layers[0]._featureFilter.filter(new ir(this.zoom),v,o))continue;let y={id:h,sourceLayerIndex:f,index:p,geometry:g?v.geometry:Dl(u,o,c),properties:u.properties,type:u.type,patterns:{}},b=this.layoutVertexArray.length;this.hasPattern?this.features.push(oC("fill-extrusion",this.layers,y,this.zoom,i)):this.addFeature(y,y.geometry,p,o,{},i.availableImages,c,i.brightness),i.featureIndex.insert(u,y.geometry,p,f,this.index,b)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,i,o,c,u,h){for(let p of this.features){let{geometry:f}=p;this.addFeature(p,f,p.index,i,o,c,u,h)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(t,i,o,c,u){let h=Object.keys(t).length!==0;if(h&&!this.stateDependentLayers.length)return;let p=h?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(t,i,p,o,c,u),this.groundEffect.update(t,i,p,o,c,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,JU),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,QU.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,XU.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,i,o,c,u,h,p,f){let g=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,v=[new Q(0,0),new Q(wt,wt)],y=p.projection,b=y.name==="globe",x=vG[t.type]==="Polygon",C=new cP;C.centroidDataIndex=this.centroidData.length;let E=new lP,M=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},c)<=0,D=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},c);E.height=D,E.vertexArrayOffset=this.layoutVertexArray.length,E.groundVertexArrayOffset=this.groundEffect.vertexArray.length,b&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new O_);let A=nC(i,500);for(let j=A.length-1;j>=0;j--){let U=A[j];(U.length===0||(P=U[0]).every(G=>G.x<=0)||P.every(G=>G.x>=wt)||P.every(G=>G.y<=0)||P.every(G=>G.y>=wt))&&A.splice(j,1)}var P;let O;if(b)O=vP(A,v,c);else{O=[];for(let j of A)O.push({polygon:j,bounds:v})}let R=x?this.edgeRadius:0,F=R>0&&this.zoom<17,N=(j,U)=>{if(j.length===0)return!1;let G=j[j.length-1];return U.x===G.x&&U.y===G.y};for(let{polygon:j,bounds:U}of O){let G=0,Y=0;for(let rt of j)x&&!rt[0].equals(rt[rt.length-1])&&rt.push(rt[0]),Y+=x?rt.length-1:rt.length;let Z=this.segments.prepareSegment((x?5:4)*Y,this.layoutVertexArray,this.indexArray);E.footprintSegIdx<0&&(E.footprintSegIdx=this.footprintSegments.length),E.polygonSegIdx<0&&(E.polygonSegIdx=this.polygonSegments.length);let tt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},$=new aP;if($.vertexOffset=this.footprintVertices.length,$.indexOffset=3*this.footprintIndices.length,$.ringIndices=[],x){let rt=[],st=[];G=Z.vertexLength;for(let nt=0;nt<j.length;nt++){let ot=j[nt];ot.length&&nt!==0&&st.push(rt.length/2);let vt=[],bt,yt;bt=ot[1].sub(ot[0])._perp()._unit(),$.ringIndices.push(ot.length-1);for(let Ct=1;Ct<ot.length;Ct++){let Et=ot[Ct],It=ot[Ct===ot.length-1?1:Ct+1],xt=Et.clone();if(R){yt=It.sub(Et)._perp()._unit();let Ft=bt.add(yt)._unit(),te=R*Math.min(4,1/(bt.x*Ft.x+bt.y*Ft.y));xt.x+=te*Ft.x,xt.y+=te*Ft.y,xt.x=Math.round(xt.x),xt.y=Math.round(xt.y),bt=yt}!M||R!==0&&!F||N(vt,xt)||vt.push(xt),ef(this.layoutVertexArray,xt.x,xt.y,0,0,1,1,0),Z.vertexLength++,this.footprintVertices.emplaceBack(Et.x,Et.y),rt.push(Et.x,Et.y),b&&nf(this.layoutVertexExtArray,y.projectTilePoint(xt.x,xt.y,c),y.upVector(c,xt.x,xt.y))}M&&(R===0||F)&&(vt.length!==0&&N(vt,vt[0])&&vt.pop(),this.groundEffect.addData(vt,U,g))}let pt=n0(rt,st);for(let nt=0;nt<pt.length;nt+=3)this.footprintIndices.emplaceBack($.vertexOffset+pt[nt+0],$.vertexOffset+pt[nt+1],$.vertexOffset+pt[nt+2]),this.indexArray.emplaceBack(G+pt[nt],G+pt[nt+2],G+pt[nt+1]),Z.primitiveLength++;$.indexCount+=pt.length,$.vertexCount+=this.footprintVertices.length-$.vertexOffset}for(let rt=0;rt<j.length;rt++){let st=j[rt];C.startRing(E,st[0]);let pt=st.length>4&&fP(st[st.length-2],st[0],st[1]),nt=R?EG(st[st.length-2],st[0],st[1],R):0,ot=[],vt,bt,yt;bt=st[1].sub(st[0])._perp()._unit();let Ct=!0;for(let Et=1,It=0;Et<st.length;Et++){let xt=st[Et-1],Ft=st[Et],te=st[Et===st.length-1?1:Et+1];if(C.appendEdge(E,Ft,xt),RC(Ft,xt,U)){R&&(bt=te.sub(Ft)._perp()._unit(),Ct=!Ct);continue}let ee=Ft.sub(xt)._perp(),de=ee.x/(Math.abs(ee.x)+Math.abs(ee.y)),me=ee.y>0?1:0,Ge=xt.dist(Ft);if(It+Ge>32768&&(It=0),R){yt=te.sub(Ft)._perp()._unit();let qe=mP(xt,Ft,te,hP(bt,yt),R);isNaN(qe)&&(qe=0);let je=Ft.sub(xt)._unit();xt=xt.add(je.mult(nt))._round(),Ft=Ft.add(je.mult(-qe))._round(),nt=qe,bt=yt,M&&this.zoom>=17&&(N(ot,xt)||ot.push(xt),N(ot,Ft)||ot.push(Ft))}let Ie=Z.vertexLength,Ui=st.length>4&&fP(xt,Ft,te),Mi=gP(It,pt,Ct);if(ef(this.layoutVertexArray,xt.x,xt.y,de,me,0,0,Mi),ef(this.layoutVertexArray,xt.x,xt.y,de,me,0,1,Mi),It+=Ge,Mi=gP(It,Ui,!Ct),pt=Ui,ef(this.layoutVertexArray,Ft.x,Ft.y,de,me,0,0,Mi),ef(this.layoutVertexArray,Ft.x,Ft.y,de,me,0,1,Mi),Z.vertexLength+=4,this.indexArray.emplaceBack(Ie+0,Ie+1,Ie+2),this.indexArray.emplaceBack(Ie+1,Ie+3,Ie+2),Z.primitiveLength+=2,R){let qe=G+(Et===1?st.length-2:Et-2),je=Et===1?G:qe+1;if(this.indexArray.emplaceBack(Ie+1,qe,Ie+3),this.indexArray.emplaceBack(qe,je,Ie+3),Z.primitiveLength+=2,vt===void 0&&(vt=Ie),!RC(te,st[Et],U)){let ke=Et===st.length-1?vt:Z.vertexLength;this.indexArray.emplaceBack(Ie+2,Ie+3,ke),this.indexArray.emplaceBack(Ie+3,ke+1,ke),this.indexArray.emplaceBack(Ie+3,je,ke+1),Z.primitiveLength+=3}Ct=!Ct}if(b){let qe=this.layoutVertexExtArray,je=y.projectTilePoint(xt.x,xt.y,c),ke=y.projectTilePoint(Ft.x,Ft.y,c),Ii=y.upVector(c,xt.x,xt.y),Vi=y.upVector(c,Ft.x,Ft.y);nf(qe,je,Ii),nf(qe,je,Ii),nf(qe,ke,Vi),nf(qe,ke,Vi)}}x&&(G+=st.length-1),M&&R&&this.zoom>=17&&(ot.length!==0&&N(ot,ot[0])&&ot.pop(),this.groundEffect.addData(ot,U,g,R>0))}this.footprintSegments.push($),tt.triangleCount=this.indexArray.length-tt.triangleArrayOffset,this.polygonSegments.push(tt),++E.footprintSegLen,++E.polygonSegLen}if(E.vertexCount=this.layoutVertexArray.length-E.vertexArrayOffset,E.groundVertexCount=this.groundEffect.vertexArray.length-E.groundVertexArrayOffset,E.vertexCount!==0){if(E.centroidXY=C.borders?sP:this.encodeCentroid(C,E),this.centroidData.push(E),C.borders){this.featuresOnBorder.push(C);let j=this.featuresOnBorder.length-1;for(let U=0;U<C.borders.length;U++)C.borders[U][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[U].push(j)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,u,h,c,f),this.groundEffect.addPaintPropertiesData(t,o,u,h,c,f),this.maxHeight=Math.max(this.maxHeight,D)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort((i,o)=>this.featuresOnBorder[i].borders[t][0]-this.featuresOnBorder[o].borders[t][0])}splitToSubtiles(){let t=[];for(let p=0;p<this.centroidData.length;p++){let f=this.centroidData[p],g=+(f.min.y+f.max.y>wt),v=2*g+(+(f.min.x+f.max.x>wt)^g);for(let y=0;y<f.polygonSegLen;y++){let b=f.polygonSegIdx+y;t.push({centroidIdx:p,subtile:v,polygonSegmentIdx:b,triangleSegmentIdx:this.polygonSegments[b].triangleSegIdx})}}let i=new qr;t.sort((p,f)=>p.triangleSegmentIdx===f.triangleSegmentIdx?p.subtile-f.subtile:p.triangleSegmentIdx-f.triangleSegmentIdx);let o=0,c=0,u=0;for(let p of t){if(p.triangleSegmentIdx!==o)break;u++}let h=t.length;for(;c!==t.length;){o=t[c].triangleSegmentIdx;let p=0,f=c,g=c;for(let v=f;v<u&&t[v].subtile===p;v++)g++;for(;f!==u;){let v=t[f];p=v.subtile;let y=this.centroidData[v.centroidIdx].min.clone(),b=this.centroidData[v.centroidIdx].max.clone(),x={vertexOffset:this.segments.segments[o].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[o].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let C=f;C<g;C++){let E=t[C],M=this.polygonSegments[E.polygonSegmentIdx],D=this.centroidData[E.centroidIdx].min,A=this.centroidData[E.centroidIdx].max,P=this.indexArray.uint16;for(let O=M.triangleArrayOffset;O<M.triangleArrayOffset+M.triangleCount;O++)i.emplaceBack(P[3*O],P[3*O+1],P[3*O+2]);x.primitiveLength+=M.triangleCount,y.x=Math.min(y.x,D.x),y.y=Math.min(y.y,D.y),b.x=Math.max(b.x,A.x),b.y=Math.max(b.y,A.y)}x.primitiveLength>0&&this.triangleSubSegments.push({segment:x,min:y,max:b}),f=g;for(let C=f;C<u&&t[C].subtile===t[f].subtile;C++)g++}c=u;for(let v=c;v<h&&t[v].triangleSegmentIdx===t[c].triangleSegmentIdx;v++)u++}i._trim(),this.indexArray=i}getVisibleSegments(t,i,o){let c=0,u=0,h=1<<t.canonical.z;if(i){let E=i.getMinMaxForTile(t);E&&(c=E.min,u=E.max)}u+=this.maxHeight;let p=t.toUnwrapped(),f,g=[p.canonical.x/h+p.wrap,p.canonical.y/h],v=[(p.canonical.x+1)/h+p.wrap,(p.canonical.y+1)/h],y=new un,b=(E,M,D)=>[E[0]*(1-D[0])+M[0]*D[0],E[1]*(1-D[1])+M[1]*D[1]],x=[],C=[];for(let E of this.triangleSubSegments){x[0]=E.min.x/wt,x[1]=E.min.y/wt,C[0]=E.max.x/wt,C[1]=E.max.y/wt;let M=b(g,v,x),D=b(g,v,C);if(new Vn([M[0],M[1],c],[D[0],D[1],u]).intersectsPrecise(o)===0){f&&(y.segments.push(f),f=void 0);continue}let A=E.segment;f&&f.vertexOffset!==A.vertexOffset&&(y.segments.push(f),f=void 0),f?(f.vertexLength+=A.vertexLength,f.primitiveLength+=A.primitiveLength):f={vertexOffset:A.vertexOffset,primitiveLength:A.primitiveLength,vertexLength:A.vertexLength,primitiveOffset:A.primitiveOffset,sortKey:void 0,vaos:{}}}return f&&y.segments.push(f),y}encodeCentroid(t,i){let o=t.centroid(),c=i.span(),u=Math.min(7,Math.round(c.x*this.tileToMeter/10)),h=Math.min(7,Math.round(c.y*this.tileToMeter/10));return new Q(ve(o.x,1,wt-1)<<3|u,ve(o.y,1,wt-1)<<3|h)}showCentroid(t){let i=this.centroidData[t.centroidDataIndex];i.flags&=kl,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);let i=t.vertexArrayOffset,o=t.vertexCount+t.vertexArrayOffset,c=t.flags&kl?sP:t.centroidXY,u=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==c.y||u!==c.x){for(let h=i;h<o;++h)this.centroidVertexArray.emplace(h,c.x,c.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;let o=i.getReplacementRegionsForTile(t.toUnwrapped());if(function(u,h){if(u.length!==h.length)return!1;for(let p=0;p<u.length;p++)if(u[p].sourceId!==h[p].sourceId||!eP(u[p],h[p]))return!1;return!0}(this.activeReplacements,o))return;if(this.activeReplacements=o,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let u of this.centroidData)u.flags&=2147483647;let c=[];for(let u of this.activeReplacements){let h=Math.pow(2,u.footprintTileId.canonical.z-t.canonical.z);for(let p of this.centroidData)if(!(p.flags&kl||u.min.x>p.max.x||p.min.x>u.max.x||u.min.y>p.max.y||p.min.y>u.max.y))for(let f=0;f<p.footprintSegLen;f++){let g=this.footprintSegments[p.footprintSegIdx+f];if(c.length=0,MG(this.footprintVertices,g.vertexOffset,g.vertexCount,u.footprintTileId.canonical,t.canonical,c),rP(u.footprint,c,this.footprintIndices.uint16,g.indexOffset,g.indexCount,-g.vertexOffset,-h)){p.flags|=kl;break}}}for(let u of this.centroidData)this.writeCentroidToBuffer(u);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,i,o){let c=!1;for(let u=0;u<o.footprintSegLen;u++){let h=this.footprintSegments[o.footprintSegIdx+u],p=0;for(let f of h.ringIndices){for(let g=p,v=f+p-1;g<f+p;v=g++){let y=this.footprintVertices.int16[2*(g+h.vertexOffset)+0],b=this.footprintVertices.int16[2*(g+h.vertexOffset)+1],x=this.footprintVertices.int16[2*(v+h.vertexOffset)+1];b>i!=x>i&&t<(this.footprintVertices.int16[2*(v+h.vertexOffset)+0]-y)*(i-b)/(x-b)+y&&(c=!c)}p=f}}return c}getHeightAtTileCoord(t,i){let o=Number.NEGATIVE_INFINITY,c=!0,u=4*(t+wt)*wt+(i+wt);if(this.partLookup.hasOwnProperty(u)){let h=this.partLookup[u];return h?{height:h.height,hidden:!!(h.flags&kl)}:void 0}for(let h of this.centroidData)t>h.max.x||h.min.x>t||i>h.max.y||h.min.y>i||this.footprintContainsPoint(t,i,h)&&h&&h.height>o&&(o=h.height,this.partLookup[u]=h,c=!!(h.flags&kl));if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:c};this.partLookup[u]=void 0}}function hP(e,t){let i=e.add(t)._unit();return e.x*i.x+e.y*i.y}function EG(e,t,i,o){let c=t.sub(e)._perp()._unit(),u=i.sub(t)._perp()._unit();return mP(e,t,i,hP(c,u),o)}function mP(e,t,i,o,c){let u=Math.sqrt(1-o*o);return Math.min(e.dist(t)/3,t.dist(i)/3,c*u/o)}function RC(e,t,i){return e.x<i[0].x&&t.x<i[0].x||e.x>i[1].x&&t.x>i[1].x||e.y<i[0].y&&t.y<i[0].y||e.y>i[1].y&&t.y>i[1].y}function pP(e,t){return e.x<t[0].x||e.x>t[1].x||e.y<t[0].y||e.y>t[1].y}function fP(e,t,i){if(e.x<0||e.x>=wt||t.x<0||t.x>=wt||i.x<0||i.x>=wt)return!1;let o=i.sub(t),c=o.perp(),u=e.sub(t);return(o.x*u.x+o.y*u.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(u.x*u.x+u.y*u.y))>-.866&&c.x*u.x+c.y*u.y<0}function gP(e,t,i){let o=t?2|e:-3&e;return i?1|o:-2&o}function _P(){let e=Math.PI/32,t=Math.tan(e),i=bh;return i*Math.sqrt(1+2*t*t)-i}function vP(e,t,i){let o=1<<i.z,c=Ms(i.x/o),u=Ms((i.x+1)/o),h=Wr(i.y/o),p=Wr((i.y+1)/o);return function(f,g,v,y,b=0,x){let C=[];if(!f.length||!v||!y)return C;let E=(F,N)=>{for(let j of F)C.push({polygon:j,bounds:N})},M=Math.ceil(Math.log2(v)),D=Math.ceil(Math.log2(y)),A=M-D,P=[];for(let F=0;F<Math.abs(A);F++)P.push(A>0?0:1);for(let F=0;F<Math.min(M,D);F++)P.push(0),P.push(1);let O=f;if(O=a0(O,g[0].y-b,g[1].y+b,1),O=a0(O,g[0].x-b,g[1].x+b,0),!O.length)return C;let R=[];for(P.length?R.push({polygons:O,bounds:g,depth:0}):E(O,g);R.length;){let F=R.pop(),N=F.depth,j=P[N],U=F.bounds[0],G=F.bounds[1],Y=j===0?U.x:U.y,Z=j===0?G.x:G.y,tt=x?x(j,Y,Z):.5*(Y+Z),$=a0(F.polygons,Y-b,tt+b,j),rt=a0(F.polygons,tt-b,Z+b,j);if($.length){let st=[U,new Q(j===0?tt:G.x,j===1?tt:G.y)];P.length>N+1?R.push({polygons:$,bounds:st,depth:N+1}):E($,st)}if(rt.length){let st=[new Q(j===0?tt:U.x,j===1?tt:U.y),G];P.length>N+1?R.push({polygons:rt,bounds:st,depth:N+1}):E(rt,st)}}return C}(e,t,Math.ceil((u-c)/11.25),Math.ceil((h-p)/11.25),1,(f,g,v)=>{if(f===0)return .5*(g+v);{let y=Wr((i.y+g/wt)/o);return(uo(.5*(Wr((i.y+v/wt)/o)+y))*o-i.y)*wt}})}function MG(e,t,i,o,c,u){let h=Math.pow(2,o.z-c.z);for(let p=0;p<i;p++){let f=e.int16[2*(p+t)+0],g=e.int16[2*(p+t)+1];f=(f+c.x*wt)*h-o.x*wt,g=(g+c.y*wt)*h-o.y*wt,u.push(new Q(f,g))}}Ce(rf,"FillExtrusionBucket",{omit:["layers","features"]}),Ce(lP,"PartData"),Ce(aP,"FootprintSegment"),Ce(cP,"BorderCentroidData"),Ce(uP,"GroundEffect");let DG=new yr({visibility:new Ut(_t["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Ut(_t["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var TG={paint:new yr({"fill-extrusion-opacity":new Ut(_t["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Re(_t["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ut(_t["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ut(_t["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Re(_t["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Re(_t["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Re(_t["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ut(_t["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ut(_t["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ut(_t["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Ut(_t["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Ut(_t["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Ut(_t["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Ut(_t["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Ut(_t["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Re(_t["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Re(_t["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Ut(_t["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Ut(_t["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Ut(_t["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Ut(_t["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Ut(_t["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:DG};class Lh extends Q{constructor(t,i,o){super(t,i),this.z=o}}function of(e,t){return e.x*t.x+e.y*t.y}function yP(e,t){if(e.length===1){let i=0,o=t[i++],c;for(;!c||o.equals(c);)if(c=t[i++],!c)return 1/0;for(;i<t.length;i++){let u=t[i],h=e[0],p=c.sub(o),f=u.sub(o),g=h.sub(o),v=of(p,p),y=of(p,f),b=of(f,f),x=of(g,p),C=of(g,f),E=v*b-y*y,M=(b*x-y*C)/E,D=(v*C-y*x)/E,A=o.z*(1-M-D)+c.z*M+u.z*D;if(isFinite(A))return A}return 1/0}{let i=1/0;for(let o of t)i=Math.min(i,o.z);return i}}function bP(e,t,i,o,c,u,h,p){let f=h*c.getElevationAt(e,t,!0,!0),g=u[0]!==0,v=g?u[1]===0?h*(u[0]/7-450):h*function(y,b,x){let C=Math.floor(b[0]/8),E=Math.floor(b[1]/8),M=10*(b[0]-8*C),D=10*(b[1]-8*E),A=y.getElevationAt(C,E,!0,!0),P=y.getMeterToDEM(x),O=Math.floor(.5*(M*P-1)),R=Math.floor(.5*(D*P-1)),F=y.tileCoordToPixel(C,E),N=2*O+1,j=2*R+1,U=function(rt,st,pt,nt,ot){return[rt.getElevationAtPixel(st,pt,!0),rt.getElevationAtPixel(st+ot,pt,!0),rt.getElevationAtPixel(st,pt+ot,!0),rt.getElevationAtPixel(st+nt,pt+ot,!0)]}(y,F.x-O,F.y-R,N,j),G=Math.abs(U[0]-U[1]),Y=Math.abs(U[2]-U[3]),Z=Math.abs(U[0]-U[2])+Math.abs(U[1]-U[3]),tt=Math.min(.25,.5*P*(G+Y)/N),$=Math.min(.25,.5*P*Z/j);return A+Math.max(tt*M,$*D)}(c,u,p):f;return{base:f+(i===0)?-1:i,top:g?Math.max(v+o,f+i+2):f+o}}let IG=new yr({"line-cap":new Re(_t.layout_line["line-cap"]),"line-join":new Re(_t.layout_line["line-join"]),"line-miter-limit":new Ut(_t.layout_line["line-miter-limit"]),"line-round-limit":new Ut(_t.layout_line["line-round-limit"]),"line-sort-key":new Re(_t.layout_line["line-sort-key"]),visibility:new Ut(_t.layout_line.visibility)});var xP={paint:new yr({"line-opacity":new Re(_t.paint_line["line-opacity"]),"line-color":new Re(_t.paint_line["line-color"]),"line-translate":new Ut(_t.paint_line["line-translate"]),"line-translate-anchor":new Ut(_t.paint_line["line-translate-anchor"]),"line-width":new Re(_t.paint_line["line-width"]),"line-gap-width":new Re(_t.paint_line["line-gap-width"]),"line-offset":new Re(_t.paint_line["line-offset"]),"line-blur":new Re(_t.paint_line["line-blur"]),"line-dasharray":new Re(_t.paint_line["line-dasharray"]),"line-pattern":new Re(_t.paint_line["line-pattern"]),"line-gradient":new Mp(_t.paint_line["line-gradient"]),"line-trim-offset":new Ut(_t.paint_line["line-trim-offset"]),"line-emissive-strength":new Ut(_t.paint_line["line-emissive-strength"]),"line-border-width":new Re(_t.paint_line["line-border-width"]),"line-border-color":new Re(_t.paint_line["line-border-color"])}),layout:IG};let AG=(e,t,i,o,c,u,h)=>{let p=e.transform,f=p.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:CP(e,t,i,o),u_pixels_to_tile_units:f,u_device_pixel_ratio:u,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:c,u_texsize:EP(i)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:wP(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:h,u_emissive_strength:i.paint.get("line-emissive-strength")}},kG=(e,t,i,o,c)=>{let u=e.transform;return{u_matrix:CP(e,t,i,o),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:u.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:c,u_image:0,u_tile_units_to_pixels:wP(t,u),u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function wP(e,t){return 1/lu(e,1,t.tileZoom)}function CP(e,t,i,o){return e.translatePosMatrix(o||t.tileID.projMatrix,t,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}let SP=e=>{let t=[];EP(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");let i=e.paint.get("line-trim-offset");return i[0]===0&&i[1]===0||t.push("RENDER_LINE_TRIM_OFFSET"),e.paint.get("line-border-width").constantOr(1)!==0&&t.push("RENDER_LINE_BORDER"),t};function EP(e){let t=e.paint.get("line-dasharray").value;return t.value||t.kind!=="constant"}let MP=new class extends Re{possiblyEvaluate(e,t){return t=new ir(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,i,o){return t=ge({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,i,o)}}(xP.paint.properties["line-width"].specification);function DP(e,t){return t>0?t+2*e:e}MP.useIntegerZoom=!0;let RG=new yr({visibility:new Ut(_t.layout_background.visibility)});var PG={paint:new yr({"background-color":new Ut(_t.paint_background["background-color"]),"background-pattern":new Ut(_t.paint_background["background-pattern"]),"background-opacity":new Ut(_t.paint_background["background-opacity"]),"background-emissive-strength":new Ut(_t.paint_background["background-emissive-strength"])}),layout:RG};let OG=new yr({visibility:new Ut(_t.layout_raster.visibility)});var FG={paint:new yr({"raster-opacity":new Ut(_t.paint_raster["raster-opacity"]),"raster-color":new Mp(_t.paint_raster["raster-color"]),"raster-color-mix":new Ut(_t.paint_raster["raster-color-mix"]),"raster-color-range":new Ut(_t.paint_raster["raster-color-range"]),"raster-hue-rotate":new Ut(_t.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ut(_t.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ut(_t.paint_raster["raster-brightness-max"]),"raster-saturation":new Ut(_t.paint_raster["raster-saturation"]),"raster-contrast":new Ut(_t.paint_raster["raster-contrast"]),"raster-resampling":new Ut(_t.paint_raster["raster-resampling"]),"raster-fade-duration":new Ut(_t.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Ut(_t.paint_raster["raster-emissive-strength"]),"raster-array-band":new Ut(_t.paint_raster["raster-array-band"]),"raster-elevation":new Ut(_t.paint_raster["raster-elevation"])}),layout:OG};function TP(e,t,i,o,c,u,h,p){let f=[e,i,c,t,o,u,1,1,1],g=[h,p,1],v=us.adjoint([],f),[y,b,x]=J.transformMat3(g,g,us.transpose(v,v));return us.multiply(f,[y,0,0,0,b,0,0,0,x],f)}class va extends Hr{constructor(t,i,o,c){super(),this.id=t,this.dispatcher=o,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(c),this.options=i,this._dirty=!1}load(t,i){if(this._loaded=i||!1,this.fire(new Wt("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=fi(this.map._requestManager.transformRequest(this.url,Dt.Image),(o,c)=>{if(this._imageRequest=null,this._loaded=!0,o)this.fire(new Xe(o));else if(c){let{HTMLImageElement:u}=m;this.image=c instanceof u?ii.getImageData(c):c,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading()}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new T0(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Wt("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof T0||this.texture.destroy()}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=t[0][1],o=t[0][1];for(let u of t)u[1]>o&&(o=u[1]),u[1]<i&&(i=u[1]);let c=(o+i)/2;if(c>Ir?this.onNorthPole=!0:c<-Ir&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let u=t.map(Fi.fromLngLat);this.tileID=function(h){let p=1/0,f=1/0,g=-1/0,v=-1/0;for(let C of h)p=Math.min(p,C.x),f=Math.min(f,C.y),g=Math.max(g,C.x),v=Math.max(v,C.y);let y=Math.max(g-p,v-f),b=Math.max(0,Math.floor(-Math.log(y)/Math.LN2)),x=Math.pow(2,b);return new pa(b,Math.floor((p+g)/2*x),Math.floor((f+v)/2*x))}(u),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Wt("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(t){for(let f in this.tiles){let g=this.tiles[f];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture)}if(this._boundsArray)return;let i=au(this.tileID,this.map.transform.projection),[o,c,u,h]=this.coordinates.map(f=>{let g=i.projection.project(f[0],f[1]);return fR(i,g)._round()});this.perspectiveTransform=function(f,g,v,y,b,x,C,E,M,D){let A=TP(0,0,f,0,0,g,f,g),P=TP(v,y,b,x,C,E,M,D);return us.multiply(P,us.adjoint(A,A),P),[P[6]/P[8]*f/wt,P[7]/P[8]*g/wt]}(this.width,this.height,o.x,o.y,c.x,c.y,h.x,h.y,u.x,u.y);let p=this._boundsArray=new tu;p.emplaceBack(o.x,o.y,0,0),p.emplaceBack(c.x,c.y,wt,0),p.emplaceBack(h.x,h.y,0,wt),p.emplaceBack(u.x,u.y,wt,wt),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=t.createVertexBuffer(p,xC.members),this.boundsSegments=un.simpleSegment(0,0,4,2)}prepare(){let t=Object.keys(this.tiles).length!==0;if(this.tileID&&!t)return;let i=this.map.painter.context,o=i.gl;!this._dirty||this.texture instanceof T0||(this.texture?this.texture.update(this.image):(this.texture=new or(i,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(i)}loadTile(t,i){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},i(null)):(t.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class LG extends Ws{constructor(t){super(t,{}),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(t){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}let zG=new yr({visibility:new Ut(_t.layout_sky.visibility)});var NG={paint:new yr({"sky-type":new Ut(_t.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ut(_t.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ut(_t.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ut(_t.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ut(_t.paint_sky["sky-gradient-radius"]),"sky-gradient":new Mp(_t.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ut(_t.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ut(_t.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ut(_t.paint_sky["sky-opacity"])}),layout:zG};function PC(e,t,i){let o=[0,0,1],c=Vo.identity([]);return Vo.rotateY(c,c,i?-fe(e)+Math.PI:fe(e)),Vo.rotateX(c,c,-fe(t)),J.transformQuat(o,o,c),J.normalize(o,o)}var BG={paint:new yr({})};let VG={circle:class extends Ws{constructor(e,t){super(e,SU,t)}createBucket(e){return new Yw(e)}queryRadius(e){let t=e;return wh("circle-radius",this,t)+wh("circle-stroke-width",this,t)+K_(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,i,o,c,u,h,p){let f=fk(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,e.pixelToTileUnitsFactor),g=this.paint.get("circle-radius").evaluate(t,i)+this.paint.get("circle-stroke-width").evaluate(t,i);return _k(e,o,u,h,p,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",f,g)}getProgramIds(){return["circle"]}getDefaultProgramParams(e,t){let i=gk(this);return{config:new nu(this,t),defines:i,overrideFog:!1}}},heatmap:class extends Ws{createBucket(e){return new yk(e)}constructor(e,t){super(e,kU,t),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Q_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return wh("heatmap-radius",this,e)}queryIntersectsFeature(e,t,i,o,c,u,h,p){let f=this.paint.get("heatmap-radius").evaluate(t,i);return _k(e,o,u,h,p,!0,!0,new Q(0,0),f)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(e,t){return e==="heatmap"?{config:new nu(this,t),overrideFog:!1}:{}}},hillshade:class extends Ws{constructor(e,t){super(e,PU,t)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},fill:class extends Ws{constructor(e,t){super(e,$U,t)}getProgramIds(){let e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),i=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(e,t){return{config:new nu(this,t),overrideFog:!1}}recalculate(e,t){super.recalculate(e,t);let i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new r0(e)}queryRadius(){return K_(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,i,o,c,u){return!e.queryGeometry.isAboveHorizon&&dk(pk(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,e.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}},"fill-extrusion":class extends Ws{constructor(e,t){super(e,TG,t),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new rf(e)}queryRadius(){return K_(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(e,t,i,o,c,u,h,p,f){let g=fk(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,e.pixelToTileUnitsFactor),v=this.paint.get("fill-extrusion-height").evaluate(t,i),y=this.paint.get("fill-extrusion-base").evaluate(t,i),b=[0,0],x=p&&u.elevation,C=u.elevation?u.elevation.exaggeration():1,E=e.tile.getBucket(this);if(x&&E instanceof rf){let O=E.centroidVertexArray,R=f+1;R<O.length&&(b[0]=O.geta_centroid_pos0(R),b[1]=O.geta_centroid_pos1(R))}if(b[0]===0&&b[1]===1)return!1;u.projection.name==="globe"&&(o=vP([o],[new Q(0,0),new Q(wt,wt)],e.tileID.canonical).map(O=>O.polygon).flat());let M=x?p:null,[D,A]=function(O,R,F,N,j,U,G,Y,Z,tt,$){return O.projection.name==="globe"?function(rt,st,pt,nt,ot,vt,bt,yt,Ct,Et,It){let xt=[],Ft=[],te=rt.projection.upVectorScale(It,rt.center.lat,rt.worldSize).metersToTile,ee=[0,0,0,1],de=[0,0,0,1],me=(Ie,Ui,Mi,qe)=>{Ie[0]=Ui,Ie[1]=Mi,Ie[2]=qe,Ie[3]=1},Ge=_P();pt>0&&(pt+=Ge),nt+=Ge;for(let Ie of st){let Ui=[],Mi=[];for(let qe of Ie){let je=qe.x+ot.x,ke=qe.y+ot.y,Ii=rt.projection.projectTilePoint(je,ke,It),Vi=rt.projection.upVector(It,qe.x,qe.y),gi=pt,bn=nt;if(bt){let Ar=bP(je,ke,pt,nt,bt,yt,Ct,Et);gi+=Ar.base,bn+=Ar.top}pt!==0?me(ee,Ii.x+Vi[0]*te*gi,Ii.y+Vi[1]*te*gi,Ii.z+Vi[2]*te*gi):me(ee,Ii.x,Ii.y,Ii.z),me(de,Ii.x+Vi[0]*te*bn,Ii.y+Vi[1]*te*bn,Ii.z+Vi[2]*te*bn),J.transformMat4(ee,ee,vt),J.transformMat4(de,de,vt),Ui.push(new Lh(ee[0],ee[1],ee[2])),Mi.push(new Lh(de[0],de[1],de[2]))}xt.push(Ui),Ft.push(Mi)}return[xt,Ft]}(O,R,F,N,j,U,G,Y,Z,tt,$):G?function(rt,st,pt,nt,ot,vt,bt,yt,Ct){let Et=[],It=[],xt=[0,0,0,1];for(let Ft of rt){let te=[],ee=[];for(let de of Ft){let me=de.x+nt.x,Ge=de.y+nt.y,Ie=bP(me,Ge,st,pt,vt,bt,yt,Ct);xt[0]=me,xt[1]=Ge,xt[2]=Ie.base,xt[3]=1,hn.transformMat4(xt,xt,ot),xt[3]=Math.max(xt[3],1e-5);let Ui=new Lh(xt[0]/xt[3],xt[1]/xt[3],xt[2]/xt[3]);xt[0]=me,xt[1]=Ge,xt[2]=Ie.top,xt[3]=1,hn.transformMat4(xt,xt,ot),xt[3]=Math.max(xt[3],1e-5);let Mi=new Lh(xt[0]/xt[3],xt[1]/xt[3],xt[2]/xt[3]);te.push(Ui),ee.push(Mi)}Et.push(te),It.push(ee)}return[Et,It]}(R,F,N,j,U,G,Y,Z,tt):function(rt,st,pt,nt,ot){let vt=[],bt=[],yt=ot[8]*st,Ct=ot[9]*st,Et=ot[10]*st,It=ot[11]*st,xt=ot[8]*pt,Ft=ot[9]*pt,te=ot[10]*pt,ee=ot[11]*pt;for(let de of rt){let me=[],Ge=[];for(let Ie of de){let Ui=Ie.x+nt.x,Mi=Ie.y+nt.y,qe=ot[0]*Ui+ot[4]*Mi+ot[12],je=ot[1]*Ui+ot[5]*Mi+ot[13],ke=ot[2]*Ui+ot[6]*Mi+ot[14],Ii=ot[3]*Ui+ot[7]*Mi+ot[15],Vi=qe+yt,gi=je+Ct,bn=ke+Et,Ar=Math.max(Ii+It,1e-5),mn=qe+xt,jn=je+Ft,zr=ke+te,kr=Math.max(Ii+ee,1e-5);me.push(new Lh(Vi/Ar,gi/Ar,bn/Ar)),Ge.push(new Lh(mn/kr,jn/kr,zr/kr))}vt.push(me),bt.push(Ge)}return[vt,bt]}(R,F,N,j,U)}(u,o,y,v,g,h,M,b,C,u.center.lat,e.tileID.canonical),P=e.queryGeometry;return function(O,R,F){let N=1/0;dk(F,R)&&(N=yP(F,R[0]));for(let j=0;j<R.length;j++){let U=R[j],G=O[j];for(let Y=0;Y<U.length-1;Y++){let Z=U[Y],tt=[Z,U[Y+1],G[Y+1],G[Y],Z];ck(F,tt)&&(N=Math.min(N,yP(F,tt)))}}return N!==1/0&&N}(D,A,P.isPointQuery()?P.screenBounds:P.screenGeometry)}},line:class extends Ws{constructor(e,t){super(e,xP,t),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){let t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof y1,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=MP.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new D0(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(e,t){let i=SP(this);return{config:new nu(this,t),defines:i,overrideFog:!1}}queryRadius(e){let t=e,i=DP(wh("line-width",this,t),wh("line-gap-width",this,t)),o=wh("line-offset",this,t);return i/2+Math.abs(o)+K_(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,i,o,c,u){if(e.queryGeometry.isAboveHorizon)return!1;let h=pk(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,e.pixelToTileUnitsFactor),p=e.pixelToTileUnitsFactor/2*DP(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i)),f=this.paint.get("line-offset").evaluate(t,i);return f&&(o=function(g,v){let y=[],b=new Q(0,0);for(let x=0;x<g.length;x++){let C=g[x],E=[];for(let M=0;M<C.length;M++){let D=C[M],A=C[M+1],P=M===0?b:D.sub(C[M-1])._unit()._perp(),O=M===C.length-1?b:A.sub(D)._unit()._perp(),R=P._add(O)._unit();R._mult(1/(R.x*O.x+R.y*O.y)),E.push(R._mult(v)._add(D))}y.push(E)}return y}(o,f*e.pixelToTileUnitsFactor)),function(g,v,y){for(let b=0;b<v.length;b++){let x=v[b];if(g.length>=3){for(let C=0;C<x.length;C++)if(nd(g,x[C]))return!0}if(bU(g,x,y))return!0}return!1}(h,o,p)}isTileClipped(){return!0}},symbol:x0,background:class extends Ws{constructor(e,t){super(e,PG,t)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},raster:class extends Ws{constructor(e,t){super(e,FG,t),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(e){return!(e&&e._source instanceof va)||!e._source.onNorthPole&&!e._source.onSouthPole&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-color"].value.expression,[t,i]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=Q_({expression:e,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:t,end:i}],resolution:256}),this.colorRampTexture=null}},sky:class extends Ws{constructor(e,t){super(e,NG,t),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="sky-gradient"?this._updateColorRamp():e!=="sky-atmosphere-sun"&&e!=="sky-atmosphere-halo-color"&&e!=="sky-atmosphere-color"&&e!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Q_({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if(this.paint.get("sky-type")==="atmosphere"){let o=this.paint.get("sky-atmosphere-sun"),c=!o,u=e.style.light,h=u.properties.get("position");return c&&u.properties.get("anchor")==="viewport"&&lt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?PC(h.azimuthal,90-h.polar,t):PC(o[0],90-o[1],t)}let i=this.paint.get("sky-gradient-center");return PC(i[0],90-i[1],t)}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let e=this.paint.get("sky-type");return e==="atmosphere"?["skyboxCapture","skybox"]:e==="gradient"?["skyboxGradient"]:null}},slot:class extends Ws{constructor(e,t){super(e,BG)}},model:class extends Ws{constructor(e,t){super(e,mG,t)}createBucket(e){return new XR(e)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(e,t,i){return!(!this.layout||t.isDataDriven()||i.isDataDriven()||e!=="model-color"&&e!=="model-color-mix-intensity"&&e!=="model-rotation"&&e!=="model-scale"&&e!=="model-translation"&&e!=="model-emissive-strength")}_isPropertyZoomDependent(e){let t=this._transitionablePaint._values[e];return t!=null&&t.value!=null&&t.value.expression!=null&&t.value.expression instanceof Hc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};function B0(e,t){return e.type==="custom"?new LG(e):new VG[e.type](e,t)}function jG(e){let{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class UG extends Hr{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new Br({width:1,height:1})}isLoaded(){for(let t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,i){if(this.loaded[i]!==t&&(this.loaded[i]=t,t)){for(let{ids:o,callback:c}of this.requestors)this._notify(o,i,c);this.requestors=[]}}hasImage(t,i){return!!this.getImage(t,i)}getImage(t,i){return this.images[i][t]}addImage(t,i,o){this._validate(t,o)&&(this.images[i][t]=o)}_validate(t,i){let o=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new Xe(new Error(`Image "${t}" has invalid "stretchX" value`))),o=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new Xe(new Error(`Image "${t}" has invalid "stretchY" value`))),o=!1),this._validateContent(i.content,i)||(this.fire(new Xe(new Error(`Image "${t}" has invalid "content" value`))),o=!1),o}_validateStretch(t,i){if(!t)return!0;let o=0;for(let c of t){if(c[0]<o||c[1]<c[0]||i<c[1])return!1;o=c[1]}return!0}_validateContent(t,i){return!(t&&(t.length!==4||t[0]<0||i.data.width<t[0]||t[1]<0||i.data.height<t[1]||t[2]<0||i.data.width<t[2]||t[3]<0||i.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,i,o){o.version=this.images[i][t].version+1,this.images[i][t]=o,this.updatedImages[i][t]=!0}removeImage(t,i){let o=this.images[i][t];delete this.images[i][t],delete this.patterns[i][t],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,i,o){let c=!0,u=!!this.loaded[i];if(!u)for(let h of t)this.images[i][h]||(c=!1);u||c?this._notify(t,i,o):this.requestors.push({ids:t,scope:i,callback:o})}getUpdatedImages(t){return this.updatedImages[t]}_notify(t,i,o){let c={};for(let u of t){this.images[i][u]||this.fire(new Wt("styleimagemissing",{id:u}));let h=this.images[i][u];h?c[u]={data:h.data.clone(),pixelRatio:h.pixelRatio,sdf:h.sdf,version:h.version,stretchX:h.stretchX,stretchY:h.stretchY,content:h.content,hasRenderCallback:!!(h.userImage&&h.userImage.render)}:lt(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}o(null,c)}getPixelSize(t){let{width:i,height:o}=this.atlasImage[t];return{width:i,height:o}}getPattern(t,i){let o=this.patterns[i][t],c=this.getImage(t,i);if(!c)return null;if(o&&o.position.version===c.version)return o.position;if(o)o.position.version=c.version;else{let u={w:c.data.width+2,h:c.data.height+2,x:0,y:0},h=new mC(u,c);this.patterns[i][t]={bin:u,position:h}}return this._updatePatternAtlas(i),this.patterns[i][t].position}bind(t,i){let o=t.gl,c=this.atlasTexture[i];c?this.dirty&&(c.update(this.atlasImage[i]),this.dirty=!1):(c=new or(t,this.atlasImage[i],o.RGBA),this.atlasTexture[i]=c),c.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(t){let i=[];for(let h in this.patterns[t])i.push(this.patterns[t][h].bin);let{w:o,h:c}=hC(i),u=this.atlasImage[t];u.resize({width:o||1,height:c||1});for(let h in this.patterns[t]){let{bin:p}=this.patterns[t][h],f=p.x+1,g=p.y+1,v=this.images[t][h].data,y=v.width,b=v.height;Br.copy(v,u,{x:0,y:0},{x:f,y:g},{width:y,height:b}),Br.copy(v,u,{x:0,y:b-1},{x:f,y:g-1},{width:y,height:1}),Br.copy(v,u,{x:0,y:0},{x:f,y:g+b},{width:y,height:1}),Br.copy(v,u,{x:y-1,y:0},{x:f-1,y:g},{width:1,height:b}),Br.copy(v,u,{x:0,y:0},{x:f+y,y:g},{width:1,height:b})}this.dirty=!0}beginFrame(){for(let t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,i){for(let o of t){if(this.callbackDispatchedThisFrame[i][o])continue;this.callbackDispatchedThisFrame[i][o]=!0;let c=this.images[i][o];jG(c)&&this.updateImage(o,i,c)}}}let HG=new yr({anchor:new Ut(_t.light.anchor),position:new class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return _e(e.expression.evaluate(t))}interpolate(e,t,i){return{x:Ye(e.x,t.x,i),y:Ye(e.y,t.y,i),z:Ye(e.z,t.z,i),azimuthal:Ye(e.azimuthal,t.azimuthal,i),polar:Ye(e.polar,t.polar,i)}}}(_t.light.position),color:new Ut(_t.light.color),intensity:new Ut(_t.light.intensity)});class IP extends Hr{constructor(t,i="flat"){super(),this._transitionable=new Sp(HG),this.setLight(t,i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,i,o={}){this._validate(h6,t,o)||(this._transitionable.setTransitionOrValue(t),this.id=i)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,i,o){return(!o||o.validate!==!1)&&M_(this,t.call(dh,ge({value:i,style:{glyphs:!0,sprite:!0},styleSpec:_t})))}}let GG=new yr({source:new Ut(_t.terrain.source),exaggeration:new Ut(_t.terrain.exaggeration)}),qG=class extends Hr{constructor(e,t,i,o){super(),this.scope=i,this._transitionable=new Sp(GG,o),this._transitionable.setTransitionOrValue(e,o),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(e,t){this._transitionable.setTransitionOrValue(e,t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}getExaggeration(e){return this._transitioning.possiblyEvaluate(new ir(e)).get("exaggeration")}isZoomDependent(){let e=this._transitionable._values.exaggeration;return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Hc}},AP=45,kP=65,uu=.05;function V0(e,t,i,o){let c=Wo(AP,kP,i),[u,h]=RP(e,o),p=1-Math.min(1,Math.exp((t-u)/(h-u)*-6));return p*=p*p,p=Math.min(1,1.00747*p),p*c*e.alpha}function RP(e,t){let i=.5/Math.tan(.5*t);return[e.range[0]+i,e.range[1]+i]}function PP(e,t,i,o,c){let u=J.transformMat4([],[t,i,o],c.mercatorFogMatrix);return V0(e,J.length(u),c.pitch,c._fov)}function OP(e,t,i,o,c,u,h){let p=[[i,o,0],[c,o,0],[c,u,0],[i,u,0]],f=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let v of p){let y=J.transformMat4([],v,t),b=J.length(y);f=Math.min(f,b),g=Math.max(g,b)}return[V0(e,f,h.pitch,h._fov),V0(e,g,h.pitch,h._fov)]}let WG=new yr({range:new Ut(_t.fog.range),color:new Ut(_t.fog.color),"high-color":new Ut(_t.fog["high-color"]),"space-color":new Ut(_t.fog["space-color"]),"horizon-blend":new Ut(_t.fog["horizon-blend"]),"star-intensity":new Ut(_t.fog["star-intensity"]),"vertical-range":new Ut(_t.fog["vertical-range"])});class $G extends Hr{constructor(t,i){super(),this._transitionable=new Sp(WG),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=i}get state(){let t=this._transform,i=t.projection.name==="globe",o=Co(t.zoom),c=this.properties.get("range"),u=[.5,3];return{range:i?[Ye(u[0],c[0],o),Ye(u[1],c[1],o)]:c,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,i={}){if(this._validate(f6,t,i))return;let o=ge({},t);for(let c of Object.keys(_t.fog))o[c]===void 0&&(o[c]=_t.fog[c].default);this._transitionable.setTransitionOrValue(o)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;let i=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:Wo(AP,kP,t))*i.a}getOpacityAtLatLng(t,i){return this._transform.projection.supportsFog?function(o,c,u){let h=Fi.fromLngLat(c),p=u.elevation?u.elevation.getAtPointOrZero(h):0;return PP(o,h.x,h.y,p,u)}(this.state,t,i):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];let i=this._transform.calculateFogTileMatrix(t.toUnwrapped());return OP(this.state,i,0,0,wt,wt,this._transform)}getOpacityForBounds(t,i,o,c,u){return this._transform.projection.supportsFog?OP(this.state,t,i,o,c,u,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?RP(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;let i=[4,5,6,7];for(let o of i){let c=t.points[o],u;if(c[2]>=0)u=c;else{let h=t.points[o-4];u=aI(h,c,h[2]/(h[2]-c[2]))}if(PP(this.state,u[0],u[1],0,this._transform)>=uu)return!0}return!1}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,i,o){return(!o||o.validate!==!1)&&M_(this,t.call(dh,ge({value:i,style:{glyphs:!0,sprite:!0},styleSpec:_t})))}}class YG{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class ZG{constructor(){this.tasks={},this.taskQueue=[],vo(["process"],this),this.invoker=new YG(this.process),this.nextId=0}add(t,i){let o=this.nextId++,c=function({type:u,isSymbolTile:h,zoom:p}){return p=p||0,u==="message"?0:u!=="maybePrepare"||h?u!=="parseTile"||h?u==="parseTile"&&h?300-p:u==="maybePrepare"&&h?400-p:500:200-p:100-p}(i);if(c===0){jt();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[o]={fn:t,metadata:i,priority:c,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){jt();try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;let t=this.pick();if(t===null)return;let i=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let t=null,i=1/0;for(let c=0;c<this.taskQueue.length;c++){let u=this.tasks[this.taskQueue[c]];u.priority<i&&(i=u.priority,t=c)}if(t===null)return null;let o=this.taskQueue[t];return this.taskQueue.splice(t,1),o}remove(){this.invoker.remove()}}class FP{constructor(t,i,o){this.target=t,this.parent=i,this.mapId=o,this.callbacks={},this.cancelCallbacks={},vo(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new ZG}send(t,i,o,c,u=!1,h){let p=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=h,this.callbacks[p]=o);let f=new Set;return this.target.postMessage({id:p,type:t,hasCallback:!!o,targetMapId:c,mustQueue:u,sourceMapId:this.mapId,data:hh(i,f)},f),{cancel:()=>{o&&delete this.callbacks[p],this.target.postMessage({id:p,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(t){let i=t.data,o=i.id;if(o&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){let c=this.cancelCallbacks[o];delete this.cancelCallbacks[o],c&&c.cancel()}else if(i.mustQueue||jt()){let c=this.callbacks[o];this.cancelCallbacks[o]=this.scheduler.add(()=>this.processTask(o,i),c&&c.metadata||{type:"message"})}else this.processTask(o,i)}processTask(t,i){if(i.type==="<response>"){let o=this.callbacks[t];delete this.callbacks[t],o&&(i.error?o(mh(i.error)):o(null,mh(i.data)))}else{let o=new Set,c=i.hasCallback?(h,p)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:h?hh(h):null,data:hh(p,o)},o)}:h=>{},u=mh(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,u,c);else if(this.parent.getWorkerSource){let h=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,h[0],u.source,u.scope)[h[1]](u,c)}else c(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let j0=(()=>{class e{constructor(i,o){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=Wu();let c=this.workerPool.acquire(this.id);for(let u=0;u<c.length;u++){let h=new e.Actor(c[u],o,this.id);h.name=`Worker ${u}`,this.actors.push(h)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,o,c){_s(this.actors,(u,h)=>{u.send(i,o,h)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}return e.Actor=FP,e})();class LP extends Hr{constructor(t,i,o,c){super(),this.scope=o,this._options=t,this.properties=new Ep(i),this._transitionable=new Sp(i,new Map(c)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,i){this._options=t,this._transitionable.setTransitionOrValue(t.properties,i)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let XG=new yr({color:new Ut(_t.properties_light_ambient.color),intensity:new Ut(_t.properties_light_ambient.intensity)}),KG=new yr({direction:new class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return function([i,o]){let c=_e([1,i,o]);return{x:c.x,y:c.y,z:c.z}}(e.expression.evaluate(t))}interpolate(e,t,i){return{x:Ye(e.x,t.x,i),y:Ye(e.y,t.y,i),z:Ye(e.z,t.z,i)}}}(_t.properties_light_directional.direction),color:new Ut(_t.properties_light_directional.color),intensity:new Ut(_t.properties_light_directional.intensity),"cast-shadows":new Ut(_t.properties_light_directional["cast-shadows"]),"shadow-intensity":new Ut(_t.properties_light_directional["shadow-intensity"])});class OC{constructor(t,i,o,c){this.screenBounds=t,this.cameraPoint=i,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=o,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,c)}static createFromScreenPoints(t,i){let o,c;if(t instanceof Q||typeof t[0]=="number"){let u=Q.convert(t);o=[u],c=i.isPointAboveHorizon(u)}else{let u=Q.convert(t[0]),h=Q.convert(t[1]);o=[u,h],c=Gn(u,h).every(p=>i.isPointAboveHorizon(p))}return new OC(o,i.getCameraPoint(),c,i)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return Gn(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){let i=this.screenBounds[0],o=this.screenBounds.length===1?this.screenBounds[0].add(new Q(1,1)):this.screenBounds[1],c=Gn(i,o,0,!1);return this.cameraPoint.y>o.y&&(this.cameraPoint.x>i.x&&this.cameraPoint.x<o.x?c.splice(3,0,this.cameraPoint):this.cameraPoint.x>=o.x?c[2]=this.cameraPoint:this.cameraPoint.x<=i.x&&(c[3]=this.cameraPoint)),function(u,h){let p=[];for(let f=0;f<u.length;f++){let g=ss(f-1,-1,u.length-1),v=ss(f+1,-1,u.length-1),y=u[f],b=u[v],x=u[g].sub(y).unit(),C=b.sub(y).unit(),E=C.angleWithSep(x.x,x.y),M=x.add(C).unit().mult(-1*h/Math.sin(E/2));p.push(y.add(M))}return p}(c,t)}bufferedCameraGeometryGlobe(t){let i=this.screenBounds[0],o=this.screenBounds.length===1?this.screenBounds[0].add(new Q(1,1)):this.screenBounds[1],c=Gn(i,o,t),u=this.cameraPoint.clone();switch(3*((u.y>i.y)+(u.y>o.y))+((u.x>i.x)+(u.x>o.x))){case 0:c[0]=u,c[4]=u.clone();break;case 1:c.splice(1,0,u);break;case 2:c[1]=u;break;case 3:c.splice(4,0,u);break;case 5:c.splice(2,0,u);break;case 6:c[3]=u;break;case 7:c.splice(3,0,u);break;case 8:c[2]=u}return c}containsTile(t,i,o,c=0){let u=t.queryPadding/i._pixelsPerMercatorPixel+1,h=o?this._bufferedCameraMercator(u,i):this._bufferedScreenMercator(u,i),p=t.tileID.wrap+(h.unwrapped?c:0),f=h.polygon.map(M=>fR(t.tileTransform,M,p));if(!mk(f,0,0,wt,wt))return;p=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?c:0);let g=this.screenGeometryMercator.polygon.map(M=>gR(t.tileTransform,M,p)),v=g.map(M=>new Q(M[0],M[1])),y=i.getFreeCameraOptions().position||new Fi(0,0,0),b=gR(t.tileTransform,y,p),x=g.map(M=>{let D=J.sub(M,M,b);return J.normalize(D,D),new H_(b,D)}),C=lu(t,1,i.zoom)*i._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:v,tilespaceRays:x,bufferedTilespaceGeometry:f,bufferedTilespaceBounds:(E=Ri(f),E.min.x=ve(E.min.x,0,wt),E.min.y=ve(E.min.y,0,wt),E.max.x=ve(E.max.x,0,wt),E.max.y=ve(E.max.y,0,wt),E),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:C};var E}_bufferedScreenMercator(t,i){let o=zP(t);if(this._screenRaycastCache[o])return this._screenRaycastCache[o];{let c;return c=i.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),i):{polygon:this.bufferedScreenGeometry(t).map(u=>i.pointCoordinate3D(u)),unwrapped:!0},this._screenRaycastCache[o]=c,c}}_bufferedCameraMercator(t,i){let o=zP(t);if(this._cameraRaycastCache[o])return this._cameraRaycastCache[o];{let c;return c=i.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),i):{polygon:this.bufferedCameraGeometry(t).map(u=>i.pointCoordinate3D(u)),unwrapped:!0},this._cameraRaycastCache[o]=c,c}}_projectAndResample(t,i){let o=function(u,h){let p=ft.multiply([],h.pixelMatrix,h.globeMatrix),f=[0,-es,0,1],g=[0,es,0,1],v=[0,0,0,1];hn.transformMat4(f,f,p),hn.transformMat4(g,g,p),hn.transformMat4(v,v,p);let y=new Q(f[0]/f[3],f[1]/f[3]),b=new Q(g[0]/g[3],g[1]/g[3]),x=nd(u,y)&&f[3]<v[3],C=nd(u,b)&&g[3]<v[3];if(!x&&!C)return null;let E=function(N,j,U){for(let G=1;G<N.length;G++){let Y=sf(j.pointCoordinate3D(N[G-1]).x),Z=sf(j.pointCoordinate3D(N[G]).x);if(U<0){if(Y<Z)return{idx:G,t:-Y/(Z-1-Y)}}else if(Z<Y)return{idx:G,t:(1-Y)/(Z+1-Y)}}return null}(u,h,x?-1:1);if(!E)return null;let{idx:M,t:D}=E,A=M>1?FC(u.slice(0,M),h):[],P=M<u.length?FC(u.slice(M),h):[];A=A.map(N=>new Q(sf(N.x),N.y)),P=P.map(N=>new Q(sf(N.x),N.y));let O=[...A];O.length===0&&O.push(P[P.length-1]);let R=Ye(O[O.length-1].y,(P.length===0?A[0]:P[0]).y,D),F;return F=x?[new Q(0,R),new Q(0,0),new Q(1,0),new Q(1,R)]:[new Q(1,R),new Q(1,1),new Q(0,1),new Q(0,R)],O.push(...F),P.length===0?O.push(A[0]):O.push(...P),{polygon:O.map(N=>new Fi(N.x,N.y)),unwrapped:!1}}(t,i);if(o)return o;let c=function(u,h){let p=!1,f=-1/0,g=0;for(let y=0;y<u.length-1;y++)u[y].x>f&&(f=u[y].x,g=y);for(let y=0;y<u.length-1;y++){let b=(g+y)%(u.length-1),x=u[b],C=u[b+1];Math.abs(x.x-C.x)>.5&&(x.x<C.x?(x.x+=1,b===0&&(u[u.length-1].x+=1)):(C.x+=1,b+1===u.length-1&&(u[0].x+=1)),p=!0)}let v=eo(h.center.lng);return p&&v<Math.abs(v-1)&&u.forEach(y=>{y.x-=1}),{polygon:u,unwrapped:p}}(FC(t,i).map(u=>new Q(sf(u.x),u.y)),i);return{polygon:c.polygon.map(u=>new Fi(u.x,u.y)),unwrapped:c.unwrapped}}}function FC(e,t){return ak(e,i=>{let o=t.pointCoordinate3D(i);i.x=o.x,i.y=o.y},1/256)}function sf(e){return e<0?1+e%1:e%1}function zP(e){return 100*e|0}function LC(e,t,i,o,c){let u=function(h,p){if(h)return c(h);if(p){e.url&&p.tiles&&e.tiles&&delete e.tiles;let f=Go(ge(p,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);p.vector_layers&&(f.vectorLayers=p.vector_layers,f.vectorLayerIds=f.vectorLayers.map(g=>g.id)),f.tiles=t.canonicalizeTileset(f,e.url),c(null,f)}};return e.url?Xt(t.transformRequest(t.normalizeSourceURL(e.url,null,i,o),Dt.Source),u):ii.frame(()=>u(null,e))}class U0{constructor(t,i,o){this.bounds=Es.convert(this.validateBounds(t)),this.minzoom=i||0,this.maxzoom=o||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){let i=Math.pow(2,t.z),o=Math.floor(eo(this.bounds.getWest())*i),c=Math.floor(uo(this.bounds.getNorth())*i),u=Math.ceil(eo(this.bounds.getEast())*i),h=Math.ceil(uo(this.bounds.getSouth())*i);return t.x>=o&&t.x<u&&t.y>=c&&t.y<h}}class NP{constructor(t,i){this.width=t,this.height=i,this.nextRow=0,this.image=new fc({width:t,height:i}),this.positions={},this.uploaded=!1}getDash(t,i){let o=this.getKey(t,i);return this.positions[o]}trim(){let t=this.width,i=this.height=Kg(this.nextRow);this.image.resize({width:t,height:i})}getKey(t,i){return t.join(",")+i}getDashRanges(t,i,o){let c=[],u=t.length%2==1?-t[t.length-1]*o:0,h=t[0]*o,p=!0;c.push({left:u,right:h,isDash:p,zeroLength:t[0]===0});let f=t[0];for(let g=1;g<t.length;g++){p=!p;let v=t[g];u=f*o,f+=v,h=f*o,c.push({left:u,right:h,isDash:p,zeroLength:v===0})}return c}addRoundDash(t,i,o){let c=i/2;for(let u=-o;u<=o;u++){let h=this.width*(this.nextRow+o+u),p=0,f=t[p];for(let g=0;g<this.width;g++){g/f.right>1&&(f=t[++p]);let v=Math.abs(g-f.left),y=Math.abs(g-f.right),b=Math.min(v,y),x,C=u/o*(c+1);if(f.isDash){let E=c-Math.abs(C);x=Math.sqrt(b*b+E*E)}else x=c-Math.sqrt(b*b+C*C);this.image.data[h+g]=Math.max(0,Math.min(255,x+128))}}}addRegularDash(t,i){for(let f=t.length-1;f>=0;--f){let g=t[f],v=t[f+1];g.zeroLength?t.splice(f,1):v&&v.isDash===g.isDash&&(v.left=g.left,t.splice(f,1))}let o=t[0],c=t[t.length-1];o.isDash===c.isDash&&(o.left=c.left-this.width,c.right=o.right+this.width);let u=this.width*this.nextRow,h=0,p=t[h];for(let f=0;f<this.width;f++){f/p.right>1&&(p=t[++h]);let g=Math.abs(f-p.left),v=Math.abs(f-p.right),y=Math.min(g,v);this.image.data[u+f]=Math.max(0,Math.min(255,(p.isDash?y:-y)+i+128))}}addDash(t,i){let o=this.getKey(t,i);if(this.positions[o])return this.positions[o];let c=i==="round",u=c?7:0,h=2*u+1;if(this.nextRow+h>this.height)return lt("LineAtlas out of space"),null;t.length===0&&t.push(1);let p=0;for(let v=0;v<t.length;v++)t[v]<0&&(lt("Negative value is found in line dasharray, replacing values with 0"),t[v]=0),p+=t[v];if(p!==0){let v=this.width/p,y=this.getDashRanges(t,this.width,v);c?this.addRoundDash(y,v,u):this.addRegularDash(y,i==="square"?.5*v:0)}let f=this.nextRow+u;this.nextRow+=h;let g={tl:[f,u],br:[p,0]};return this.positions[o]=g,g}}Ce(NP,"LineAtlas");let BP=1*Ja;class VP{constructor(t){let i={},o=[];for(let p in t){let f=t[p],g=i[p]={};for(let v in f.glyphs){let y=f.glyphs[+v];if(!y||y.bitmap.width===0||y.bitmap.height===0)continue;let b=y.metrics.localGlyph?BP:1,x={x:0,y:0,w:y.bitmap.width+2*b,h:y.bitmap.height+2*b};o.push(x),g[v]=x}}let{w:c,h:u}=hC(o),h=new fc({width:c||1,height:u||1});for(let p in t){let f=t[p];for(let g in f.glyphs){let v=f.glyphs[+g];if(!v||v.bitmap.width===0||v.bitmap.height===0)continue;let y=i[p][g],b=v.metrics.localGlyph?BP:1;fc.copy(v.bitmap,h,{x:0,y:0},{x:y.x+b,y:y.y+b},v.bitmap)}}this.image=h,this.positions=i}}Ce(VP,"GlyphAtlas");class QG{constructor(t){this.tileID=new $i(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.scope=t.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.promoteId=t.promoteId,this.isSymbolTile=t.isSymbolTile,this.tileTransform=au(t.tileID.canonical,t.projection),this.projection=t.projection,this.brightness=t.brightness,this.extraShadowCaster=!!t.extraShadowCaster}parse(t,i,o,c,u){this.status="parsing",this.data=t,this.collisionBoxArray=new pw;let h=new Ak(Object.keys(t.layers).sort()),p=new lC(this.tileID,this.promoteId);p.bucketLayerIDs=[];let f={},g=new NP(256,256),v={featureIndex:p,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:g,availableImages:o,brightness:this.brightness},y=i.familiesBySource[this.source];for(let A in y){let P=t.layers[A];if(!P)continue;let O=!1,R=!1,F=!1;for(let U of y[A])U[0].type==="symbol"?O=!0:R=!0,U[0].is3D()&&U[0].type!=="model"&&(F=!0);if(this.extraShadowCaster&&!F||this.isSymbolTile===!0&&!O||this.isSymbolTile===!1&&!R)continue;P.version===1&&lt(`Vector tile source "${this.source}" layer "${A}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let N=h.encode(A),j=[];for(let U=0;U<P.length;U++){let G=P.feature(U),Y=p.getId(G,A);j.push({feature:G,id:Y,index:U,sourceLayerIndex:N})}for(let U of y[A]){let G=U[0];(!this.extraShadowCaster||G.is3D()&&G.type!=="model")&&(this.isSymbolTile!==void 0&&G.type==="symbol"!==this.isSymbolTile||G.minzoom&&this.zoom<Math.floor(G.minzoom)||G.maxzoom&&this.zoom>=G.maxzoom||G.visibility!=="none"&&(zC(U,this.zoom,v.brightness,o),(f[G.id]=G.createBucket({index:p.bucketLayerIDs.length,layers:U,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:N,sourceID:this.source,projection:this.projection.spec})).populate(j,v,this.tileID.canonical,this.tileTransform),p.bucketLayerIDs.push(U.map(Y=>Y.id))))}}let b,x,C,E;g.trim();let M={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},D=()=>{if(b)return this.status="done",u(b);if(this.extraShadowCaster)this.status="done",u(null,{buckets:qs(f).filter(A=>!A.isEmpty()),featureIndex:p,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:v.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(x&&C&&E){let A=new VP(x),P=new sR(C,E);for(let O in f){let R=f[O];R instanceof Zp?(zC(R.layers,this.zoom,v.brightness,o),Y8(R,x,A.positions,C,P.iconPositions,this.showCollisionBoxes,o,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):R.hasPattern&&(R instanceof D0||R instanceof r0||R instanceof rf)&&(zC(R.layers,this.zoom,v.brightness,o),R.addFeatures(v,this.tileID.canonical,P.patternPositions,o,this.tileTransform,this.brightness))}this.status="done",u(null,{buckets:qs(f).filter(O=>!O.isEmpty()),featureIndex:p,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:A.image,lineAtlas:g,imageAtlas:P,brightness:v.brightness})}};if(!this.extraShadowCaster){let A=Yu(v.glyphDependencies,R=>Object.keys(R).map(Number));Object.keys(A).length?c.send("getGlyphs",{uid:this.uid,stacks:A,scope:this.scope},(R,F)=>{b||(b=R,x=F,D())},void 0,!1,M):x={};let P=Object.keys(v.iconDependencies);P.length?c.send("getImages",{icons:P,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(R,F)=>{b||(b=R,C=F,D())},void 0,!1,M):C={};let O=Object.keys(v.patternDependencies);O.length?c.send("getImages",{icons:O,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(R,F)=>{b||(b=R,E=F,D())},void 0,!1,M):E={}}D()}}function zC(e,t,i,o){let c=new ir(t,{brightness:i});for(let u of e)u.recalculate(c,o)}class jP{constructor(t){this.entries={},this.scheduler=t}request(t,i,o,c){let u=this.entries[t]=this.entries[t]||{callbacks:[]};if(u.result){let[h,p]=u.result;return this.scheduler?this.scheduler.add(()=>{c(h,p)},i):c(h,p),()=>{}}return u.callbacks.push(c),u.cancel||(u.cancel=o((h,p)=>{u.result=[h,p];for(let f of u.callbacks)this.scheduler?this.scheduler.add(()=>{f(h,p)},i):f(h,p);setTimeout(()=>delete this.entries[t],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(h=>h!==c),u.callbacks.length||(u.cancel(),delete this.entries[t]))}}}function UP(e,t,i){let o=JSON.stringify(e.request);return e.data&&(this.deduped.entries[o]={result:[null,e.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},c=>{let u=ne(e.request,(h,p,f,g)=>{h?c(h):p&&c(null,{vectorTile:i?void 0:new sC(new d0(p)),rawData:p,cacheControl:f,expires:g})});return()=>{u.cancel(),c()}},t)}class HP extends Hr{constructor(t,i,o,c){if(super(),this.id=t,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,ge(this,Go(i,["url","scheme","tileSize","promoteId"])),this._options=ge({type:"vector"},i),this._collectResourceTiming=!!i.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c),this._tileWorkers={},this._deduped=new jP}load(t){this._loaded=!1,this.fire(new Wt("dataloading",{dataType:"source"}));let i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map._worldview;this._tileJSONRequest=LC(this._options,this.map._requestManager,i,o,(c,u)=>{this._tileJSONRequest=null,this._loaded=!0,c?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),o&&o.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new Xe(c))):u&&(ge(this,u),u.bounds&&(this.tileBounds=new U0(u.bounds,this.minzoom,this.maxzoom)),zx(u.tiles,this.map._requestManager._customAccessToken),this.fire(new Wt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Wt("data",{dataType:"source",sourceDataType:"content"}))),t&&t(c)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();let t=Xo(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return ge({},this._options)}loadTile(t,i){let o=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),c={request:this.map._requestManager.transformRequest(o,Dt.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:ii.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster};if(c.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=i:t.request=t.actor.send("reloadTile",c,u.bind(this));else if(t.actor=this._tileWorkers[o]=this._tileWorkers[o]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",c,u.bind(this),void 0,!0);else{let h=UP.call({deduped:this._deduped},c,(p,f)=>{p||!f?u.call(this,p):(c.data={cacheControl:f.cacheControl,expires:f.expires,rawData:f.rawData.slice(0)},t.actor&&t.actor.send("loadTile",c,u.bind(this),void 0,!0))},!0);t.request={cancel:h}}function u(h,p){return delete t.request,t.aborted?i(null):h&&h.status!==404?i(h):(p&&p.resourceTiming&&(t.resourceTiming=p.resourceTiming),this.map._refreshExpiredTiles&&p&&t.setExpiryData(p),t.loadVectorData(p,this.map.painter),Xu(this.dispatcher),i(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class NC extends Hr{constructor(t,i,o,c){super(),this.id=t,this.dispatcher=o,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=ge({type:"raster"},i),ge(this,Go(i,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new Wt("dataloading",{dataType:"source"})),this._tileJSONRequest=LC(this._options,this.map._requestManager,null,null,(i,o)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new Xe(i)):o&&(ge(this,o),o.bounds&&(this.tileBounds=new U0(o.bounds,this.minzoom,this.maxzoom)),zx(o.tiles),this.fire(new Wt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Wt("data",{dataType:"source",sourceDataType:"content"}))),t&&t(i)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();let t=Xo(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return ge({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,i){let o=ii.devicePixelRatio>=2,c=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),o,this.tileSize);t.request=fi(this.map._requestManager.transformRequest(c,Dt.Tile),(u,h,p,f)=>(delete t.request,t.aborted?(t.state="unloaded",i(null)):u?(t.state="errored",i(u)):h?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:p,expires:f}),t.setTexture(h,this.map.painter),t.state="loaded",Xu(this.dispatcher),void i(null)):i(null)))}abortTile(t,i){t.request&&(t.request.cancel(),delete t.request),i()}unloadTile(t,i){t.texture&&t.texture instanceof or?(t.destroy(!0),t.texture&&t.texture instanceof or&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),i()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function JG(){return uv.workerClass!=null?new uv.workerClass:new m.Worker(uv.workerUrl)}let BC="mapboxgl_preloaded_worker_pool";class zh{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<zh.workerCount;)this.workers.push(new JG);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[BC]}numActive(){return Object.keys(this.active).length}}let af;function lf(){return af||(af=new zh),af}zh.workerCount=2;let H0,VC,il,jC=null;function GP(){return jt()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:VC||S.DRACO_URL}let UC=5123,HC=5126,GC={5120:Int8Array,5121:Uint8Array,5122:Int16Array,[UC]:Uint16Array,5125:Uint32Array,[HC]:Float32Array},tq={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",[UC]:"DT_UINT16",5125:"DT_UINT32",[HC]:"DT_FLOAT32"},qC={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function qP(e,t,i){let o=i.json.bufferViews.length,c=i.buffers.length;t.bufferView=o,i.json.bufferViews[o]={buffer:c,byteLength:e.byteLength},i.buffers[c]=e}let WC="KHR_draco_mesh_compression";function eq(e,t){let i=e.extensions&&e.extensions[WC];if(!i)return;let o=new il.Decoder,c=ZP(t,i.bufferView),u=new il.Mesh;if(!o.DecodeArrayToMesh(c,c.byteLength,u))throw new Error("Failed to decode Draco mesh");let h=t.json.accessors[e.indices],p=GC[h.componentType],f=h.count*p.BYTES_PER_ELEMENT,g=il._malloc(f);p===Uint16Array?o.GetTrianglesUInt16Array(u,f,g):o.GetTrianglesUInt32Array(u,f,g),qP(il.memory.buffer.slice(g,g+f),h,t),il._free(g);for(let v of Object.keys(i.attributes)){let y=o.GetAttributeByUniqueId(u,i.attributes[v]),b=t.json.accessors[e.attributes[v]],x=tq[b.componentType],C=b.count*qC[b.type]*GC[b.componentType].BYTES_PER_ELEMENT,E=il._malloc(C);o.GetAttributeDataArrayForAllPoints(u,y,il[x],C,E),qP(il.memory.buffer.slice(E,E+C),b,t),il._free(E)}o.destroy(),u.destroy(),delete e.extensions[WC]}let WP=1179937895,$P=new TextDecoder("utf8");function YP(e,t){return new URL(e,t).href}function iq(e,t,i,o){return fetch(YP(e.uri,o)).then(c=>c.arrayBuffer()).then(c=>{t.buffers[i]=c})}function ZP(e,t){let i=e.json.bufferViews[t];return new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function nq(e,t,i,o){if(e.uri){let c=YP(e.uri,o);return fetch(c).then(u=>u.blob()).then(u=>m.createImageBitmap(u)).then(u=>{t.images[i]=u})}if(e.bufferView!==void 0){let c=ZP(t,e.bufferView),u=new m.Blob([c],{type:e.mimeType});return m.createImageBitmap(u).then(h=>{t.images[i]=h})}}function XP(e,t=0,i){let o={json:null,images:[],buffers:[]};if(new Uint32Array(e,t,1)[0]===WP){let g=new Uint32Array(e,t),v=2,y=(g[v++]>>2)-3,b=g[v++]>>2;if(v++,o.json=JSON.parse($P.decode(g.subarray(v,v+b))),v+=b,v<y){let x=g[v++];v++;let C=t+(v<<2);o.buffers[0]=e.slice(C,C+x)}}else o.json=JSON.parse($P.decode(new Uint8Array(e,t)));let{buffers:c,images:u,meshes:h,extensionsUsed:p}=o.json,f=Promise.resolve();if(c){let g=[];for(let v=0;v<c.length;v++){let y=c[v];y.uri?g.push(iq(y,o,v,i)):o.buffers[v]||(o.buffers[v]=null)}f=Promise.all(g)}return f.then(()=>{let g=[],v=p&&p.includes(WC);if(v&&g.push(function(){if(!il)return H0||(H0=function(y){let b,x=null;function C(){b=new Uint8Array(x.buffer)}function E(){throw new Error("Unexpected Draco error.")}let M={a:{a:E,d:function(D,A,P){return b.copyWithin(D,A,A+P)},c:function(D){let A=b.length,P=Math.max(D>>>0,Math.ceil(1.2*A)),O=Math.ceil((P-A)/65536);try{return x.grow(O),C(),!0}catch{return!1}},b:E}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(y,M):y.then(D=>D.arrayBuffer()).then(D=>WebAssembly.instantiate(D,M))).then(D=>{let{Rb:A,Qb:P,P:O,T:R,X:F,Ja:N,La:j,Qa:U,Va:G,Wa:Y,eb:Z,jb:tt,f:$,e:rt,yb:st,zb:pt,Ab:nt,Bb:ot,Db:vt,Gb:bt}=D.instance.exports;x=rt;let yt=(()=>{let Ct=0,Et=0,It=0,xt=0;return Ft=>{It&&(A(xt),A(Ct),Et+=It,It=Ct=0),Ct||(Et+=128,Ct=P(Et));let te=Ft.length+7&-8,ee=Ct;te>=Et&&(It=te,ee=xt=P(te));for(let de=0;de<Ft.length;de++)b[ee+de]=Ft[de];return ee}})();return C(),$(),{memory:rt,_free:A,_malloc:P,Mesh:class{constructor(){this.ptr=O()}destroy(){R(this.ptr)}},Decoder:class{constructor(){this.ptr=N()}destroy(){tt(this.ptr)}DecodeArrayToMesh(Ct,Et,It){let xt=yt(Ct),Ft=j(this.ptr,xt,Et,It.ptr);return!!F(Ft)}GetAttributeByUniqueId(Ct,Et){return{ptr:U(this.ptr,Ct.ptr,Et)}}GetTrianglesUInt16Array(Ct,Et,It){G(this.ptr,Ct.ptr,Et,It)}GetTrianglesUInt32Array(Ct,Et,It){Y(this.ptr,Ct.ptr,Et,It)}GetAttributeDataArrayForAllPoints(Ct,Et,It,xt,Ft){Z(this.ptr,Ct.ptr,Et.ptr,It,xt,Ft)}},DT_INT8:st(),DT_UINT8:pt(),DT_INT16:nt(),DT_UINT16:ot(),DT_UINT32:vt(),DT_FLOAT32:bt()}})}(fetch(GP())),H0.then(y=>{il=y,H0=void 0}))}()),u)for(let y=0;y<u.length;y++)g.push(nq(u[y],o,y,i));return(g.length?Promise.all(g):Promise.resolve()).then(()=>{if(v&&h)for(let{primitives:y}of h)for(let b of y)eq(b,o);return o})})}function KP(e){return fetch(e).then(t=>t.arrayBuffer()).then(t=>XP(t,0,e))}class QP{constructor(t,i,o){if(this.triangleCount=i.length/3,this.min=new Q(0,0),this.max=new Q(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||t.length===0||o===0)return;let c=t.map(v=>v.x),u=t.map(v=>v.y);this.min=new Q(Math.min(...c),Math.min(...u)),this.max=new Q(Math.max(...c),Math.max(...u));let h=this.max.sub(this.min);h.x=Math.max(h.x,1),h.y=Math.max(h.y,1);let p=Math.max(h.x,h.y)/o;this.cellsX=Math.max(1,Math.ceil(h.x/p)),this.cellsY=Math.max(1,Math.ceil(h.y/p)),this.xScale=1/p,this.yScale=1/p;let f=[];for(let v=0;v<this.triangleCount;v++){let y=t[i[3*v+0]].sub(this.min),b=t[i[3*v+1]].sub(this.min),x=t[i[3*v+2]].sub(this.min),C=ud(Math.floor(Math.min(y.x,b.x,x.x)),this.xScale,this.cellsX),E=ud(Math.floor(Math.max(y.x,b.x,x.x)),this.xScale,this.cellsX),M=ud(Math.floor(Math.min(y.y,b.y,x.y)),this.yScale,this.cellsY),D=ud(Math.floor(Math.max(y.y,b.y,x.y)),this.yScale,this.cellsY),A=new Q(0,0),P=new Q(0,0),O=new Q(0,0),R=new Q(0,0);for(let F=M;F<=D;++F){A.y=P.y=F*p,O.y=R.y=(F+1)*p;for(let N=C;N<=E;++N)A.x=O.x=N*p,P.x=R.x=(N+1)*p,(Kw(y,b,x,A,P,R)||Kw(y,b,x,A,R,O))&&f.push({cellIdx:F*this.cellsX+N,triIdx:v})}}if(f.length===0)return;f.sort((v,y)=>v.cellIdx-y.cellIdx||v.triIdx-y.triIdx);let g=0;for(;g<f.length;){let v=f[g].cellIdx,y={start:this.payload.length,len:0};for(;g<f.length&&f[g].cellIdx===v;)++y.len,this.payload.push(f[g++].triIdx);this.cells[v]=y}}query(t,i,o){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>i.x||t.y>this.max.y||this.min.y>i.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let f=0;f<this.lookup.length;f++)this.lookup[f]=0;let c=ud(t.x-this.min.x,this.xScale,this.cellsX),u=ud(i.x-this.min.x,this.xScale,this.cellsX),h=ud(t.y-this.min.y,this.yScale,this.cellsY),p=ud(i.y-this.min.y,this.yScale,this.cellsY);for(let f=h;f<=p;f++)for(let g=c;g<=u;g++){let v=this.cells[f*this.cellsX+g];if(v)for(let y=0;y<v.len;y++){let b=this.payload[v.start+y],x=Math.floor(b/8),C=1<<b%8;if(!(this.lookup[x]&C)&&(this.lookup[x]|=C,o.push(b),o.length===this.triangleCount))return}}}}function ud(e,t,i){return Math.max(0,Math.min(i-1,Math.floor(e*t)))}function hu(e,t){let i=e.json.bufferViews[t.bufferView];return new GC[t.componentType](e.buffers[i.buffer],(t.byteOffset||0)+(i.byteOffset||0),t.count*qC[t.type])}function rq(e,t,i){let o=e.indices,c=e.attributes,u={};u.indexArray=new qr;let h=t.json.accessors[o],p=h.count/3;u.indexArray.reserve(p);let f=hu(t,h);for(let b=0;b<p;b++)u.indexArray.emplaceBack(f[3*b],f[3*b+1],f[3*b+2]);u.indexArray._trim(),u.vertexArray=new iu;let g=t.json.accessors[c.POSITION];u.vertexArray.reserve(g.count);let v=hu(t,g);for(let b=0;b<g.count;b++)u.vertexArray.emplaceBack(v[3*b],v[3*b+1],v[3*b+2]);if(u.vertexArray._trim(),u.aabb=new Vn(g.min,g.max),u.centroid=function(b,x){let C=[0,0,0],E=b.length;if(E>0){for(let M=0;M<E;M++){let D=3*b[M];C[0]+=x[D],C[1]+=x[D+1],C[2]+=x[D+2]}C[0]/=E,C[1]/=E,C[2]/=E}return C}(f,v),c.COLOR_0!==void 0){let b=t.json.accessors[c.COLOR_0],x=qC[b.type];if(b.componentType===HC){u.colorArray=x===3?new iu:new sc,u.colorArray.reserve(b.count);let C=hu(t,b);if(x===3)for(let E=0;E<b.count;E++)u.colorArray.emplaceBack(C[3*E],C[3*E+1],C[3*E+2]);else for(let E=0;E<b.count;E++)u.colorArray.emplaceBack(C[4*E],C[4*E+1],C[4*E+2],C[4*E+3]);u.colorArray._trim()}else if(b.componentType===UC&&x===4){u.colorArray=new sc,u.colorArray.resize(b.count);let C=hu(t,b),E=1/65535,M=u.colorArray.float32;for(let D=0;D<4*C.length;++D)M[D]=C[D]*E}else lt(`glTF color buffer parsing for accessor ${JSON.stringify(b)} is not supported`)}if(c.NORMAL!==void 0){u.normalArray=new iu;let b=t.json.accessors[c.NORMAL];u.normalArray.reserve(b.count);let x=hu(t,b);for(let C=0;C<b.count;C++)u.normalArray.emplaceBack(x[3*C],x[3*C+1],x[3*C+2]);u.normalArray._trim()}if(c.TEXCOORD_0!==void 0&&i.length>0){u.texcoordArray=new Ip;let b=t.json.accessors[c.TEXCOORD_0];u.texcoordArray.reserve(b.count);let x=hu(t,b);for(let C=0;C<b.count;C++)u.texcoordArray.emplaceBack(x[2*C],x[2*C+1]);u.texcoordArray._trim()}let y=e.material;return u.material=function(b,x){let{emissiveFactor:C=[0,0,0],alphaMode:E="OPAQUE",alphaCutoff:M=.5,normalTexture:D,occlusionTexture:A,emissiveTexture:P,doubleSided:O}=b,{baseColorFactor:R=[1,1,1,1],metallicFactor:F=1,roughnessFactor:N=1,baseColorTexture:j,metallicRoughnessTexture:U}=b.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new _i(...R),metallicFactor:F,roughnessFactor:N,baseColorTexture:j?x[j.index]:void 0,metallicRoughnessTexture:U?x[U.index]:void 0},doubleSided:O,emissiveFactor:C,alphaMode:E,alphaCutoff:M,normalTexture:D?x[D.index]:void 0,occlusionTexture:A?x[A.index]:void 0,emissionTexture:P?x[P.index]:void 0,defined:b.defined===void 0}}(y!==void 0?t.json.materials[y]:{defined:!1},i),c._FEATURE_RGBA4444!==void 0&&(u.featureData=new Uint32Array(hu(t,t.json.accessors[c._FEATURE_RGBA4444]).buffer)),u}function JP(e,t,i){let{matrix:o,rotation:c,translation:u,scale:h,mesh:p,extras:f,children:g}=e,v={};if(v.matrix=o||ft.fromRotationTranslationScale([],c||[0,0,0,1],u||[0,0,0],h||[1,1,1]),p!==void 0){v.meshes=i[p];let y=v.anchor=[0,0];for(let b of v.meshes){let{min:x,max:C}=b.aabb;y[0]+=x[0]+C[0],y[1]+=x[1]+C[1]}y[0]=Math.floor(y[0]/v.meshes.length/2),y[1]=Math.floor(y[1]/v.meshes.length/2)}if(f&&(f.id&&(v.id=f.id),f.lights&&(v.lights=function(y){if(!y.length)return[];let b=function(D){let A=atob(D),P=new Uint8Array(A.length);for(let O=0;O<A.length;O++)P[O]=A.codePointAt(O);return P}(y),x=[],C=b.length/24,E=new Uint16Array(b.buffer),M=new Float32Array(b.buffer);for(let D=0;D<C;D++){let A=E[2*D*6]/30,P=E[2*D*6+1]/30,O=E[2*D*6+10]/100,R=M[6*D+1],F=M[6*D+2],N=M[6*D+3],j=M[6*D+4],U=N-R,G=j-F,Y=Math.hypot(U,G);x.push({pos:[R+.5*U,F+.5*G,P],normal:[G/Y,-U/Y,0],width:Y,height:A,depth:O,points:[R,F,N,j]})}return x}(f.lights))),g){let y=[];for(let b of g)y.push(JP(t.json.nodes[b],t,i));v.children=y}return v}function oq(e){if(e.vertices.length===0||e.indices.length===0)return null;let[t,i]=[e.vertices[0].clone(),e.vertices[0].clone()];for(let h=1;h<e.vertices.length;++h){let p=e.vertices[h];t.x=Math.min(t.x,p.x),t.y=Math.min(t.y,p.y),i.x=Math.max(i.x,p.x),i.y=Math.max(i.y,p.y)}let o=Math.ceil(Math.max(i.x-t.x,i.y-t.y)/256),c=Math.max(8,o),u=new QP(e.vertices,e.indices,c);return{vertices:e.vertices,indices:e.indices,grid:u,min:t,max:i}}function sq(e){if(!e.extras||!e.extras.ground)return null;let t=e.extras.ground;if(!t||!Array.isArray(t)||t.length===0)return null;let i=t[0];if(!i||!Array.isArray(i)||i.length===0)return null;let o=[];for(let h of i){if(!Array.isArray(h)||h.length!==2)continue;let p=h[0],f=h[1];typeof p=="number"&&typeof f=="number"&&o.push(new Q(p,f))}if(o.length<3)return null;o.length>1&&o[o.length-1].equals(o[0])&&o.pop();let c=0;for(let h=0;h<o.length;h++){let p=o[h],f=o[(h+1)%o.length],g=o[(h+2)%o.length];c+=(p.x-f.x)*(g.y-f.y)-(g.x-f.x)*(p.y-f.y)}c>0&&o.reverse();let u=n0(o.flatMap(h=>[h.x,h.y]),[]);return u.length===0?null:{vertices:o,indices:u}}function aq(e){let t=[],i=[],o=0;for(let c of e){o=t.length;let u=c.vertexArray.float32,h=c.indexArray.uint16;for(let p=0;p<c.vertexArray.length;p++)t.push(new Q(u[3*p+0],u[3*p+1]));for(let p=0;p<3*c.indexArray.length;p++)i.push(h[p]+o)}if(i.length%3!=0)return null;for(let c=0;c<i.length;c+=3){let u=t[i[c+0]],h=t[i[c+1]],p=t[i[c+2]];(u.x-h.x)*(p.y-h.y)-(p.x-h.x)*(u.y-h.y)>0&&([i[c+1],i[c+2]]=[i[c+2],i[c+1]])}return{vertices:t,indices:i}}function $C(e){let t=function(f,g){let v=[],y=m.WebGL2RenderingContext;if(f.json.textures)for(let b of f.json.textures){let x={magFilter:y.LINEAR,minFilter:y.NEAREST,wrapS:y.REPEAT,wrapT:y.REPEAT};b.sampler!==void 0&&Object.assign(x,f.json.samplers[b.sampler]),v.push({image:g[b.source],sampler:x,uploaded:!1})}return v}(e,e.images),i=function(f,g){let v=[];for(let y of f.json.meshes){let b=[];for(let x of y.primitives)b.push(rq(x,f,g));v.push(b)}return v}(e,t),{scenes:o,scene:c,nodes:u}=e.json,h=o?o[c||0].nodes:u,p=[];for(let f of h)p.push(JP(u[f],e,i));return function(f,g,v){let y={},b=new Set;for(let x=0;x<f.length;x++){let C=v[g[x]];if(!C.extras)continue;let E=C.extras["mapbox:footprint:version"],M=C.extras["mapbox:footprint:id"];(E||M)&&b.add(x),E==="1.0.0"&&M&&(y[M]=x)}for(let x=0;x<f.length;x++){if(b.has(x))continue;let C=f[x],E=v[g[x]];if(!E.extras)continue;let M=null;C.id in y&&(M=aq(f[y[C.id]].meshes)),M||(M=sq(E)),M&&(C.footprint=oq(M))}if(b.size>0){let x=Array.from(b.values()).sort((C,E)=>C-E);for(let C=x.length-1;C>=0;C--)f.splice(x[C],1)}}(p,h,e.json.nodes),p}function lq(e){e.heightmap=new Float32Array(4096),e.heightmap.fill(-1);let t=e.vertexArray.float32,i=e.aabb.min[0]-1,o=e.aabb.min[1]-1,c=cu/(e.aabb.max[0]-i+2),u=cu/(e.aabb.max[1]-o+2);for(let h=0;h<t.length;h+=3){let p=t[h+2],f=(t[h+0]-i)*c|0,g=(t[h+1]-o)*u|0;p>e.heightmap[g*cu+f]&&(e.heightmap[g*cu+f]=p)}}function cq(e,t){let i={};i.indexArray=new qr,i.indexArray.reserve(4*e.length),i.vertexArray=new iu,i.vertexArray.reserve(10*e.length),i.colorArray=new sc,i.vertexArray.reserve(10*e.length);let o=0;for(let h of e){let p=Math.min(10,Math.max(4,1.3*h.height))*t,f=[-h.normal[1],h.normal[0],0],g=Math.min(.29,.1*h.width/h.depth),v=h.width-2*h.depth*t*(g+.01),y=J.scaleAndAdd([],h.pos,f,v/2),b=J.scaleAndAdd([],h.pos,f,-v/2),x=[y[0],y[1],y[2]+h.height],C=[b[0],b[1],b[2]+h.height],E=J.scaleAndAdd([],h.normal,f,g);J.scale(E,E,p);let M=J.scaleAndAdd([],h.normal,f,-g);J.scale(M,M,p),J.add(E,y,E),J.add(M,b,M),y[2]+=.1,b[2]+=.1,i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(M[0],M[1],M[2]),i.vertexArray.emplaceBack(y[0],y[1],y[2]),i.vertexArray.emplaceBack(b[0],b[1],b[2]),i.vertexArray.emplaceBack(x[0],x[1],x[2]),i.vertexArray.emplaceBack(C[0],C[1],C[2]),i.vertexArray.emplaceBack(y[0],y[1],y[2]),i.vertexArray.emplaceBack(b[0],b[1],b[2]),i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(M[0],M[1],M[2]);let D=v/p/2;i.colorArray.emplaceBack(-D-g,-1,D,.8),i.colorArray.emplaceBack(D+g,-1,D,.8),i.colorArray.emplaceBack(-D,0,D,1.3),i.colorArray.emplaceBack(D,0,D,1.3),i.colorArray.emplaceBack(D+g,-.8,D,.7),i.colorArray.emplaceBack(D+g,-.8,D,.7),i.colorArray.emplaceBack(0,0,D,1.3),i.colorArray.emplaceBack(0,0,D,1.3),i.colorArray.emplaceBack(D+g,-1.2,D,.8),i.colorArray.emplaceBack(D+g,-1.2,D,.8),i.indexArray.emplaceBack(6+o,4+o,8+o),i.indexArray.emplaceBack(7+o,9+o,5+o),i.indexArray.emplaceBack(0+o,1+o,2+o),i.indexArray.emplaceBack(1+o,3+o,2+o),o+=10}let c={defined:!0,emissiveFactor:[0,0,0]},u={};return u.baseColorFactor=_i.white,c.pbrMetallicRoughness=u,i.material=c,i.aabb=new Vn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}Ce(QP,"TriangleGridIndex");let YC={vector:HP,raster:NC,"raster-dem":class extends NC{constructor(e,t,i,o){super(e,t,i,o),this.type="raster-dem",this.maxzoom=22,this._options=ge({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(e,t){let i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function o(c,u){c&&(e.state="errored",t(c)),u&&(e.dem=u,e.dem.onDeserialize(),e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0,e.state="loaded",t(null))}e.request=fi(this.map._requestManager.transformRequest(i,Dt.Tile),(function(c,u,h,p){if(delete e.request,e.aborted)e.state="unloaded",t(null);else if(c)e.state="errored",t(c);else if(u){this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:h,expires:p});let g=m.ImageBitmap&&u instanceof m.ImageBitmap&&OT(),v=1-(u.width-((f=u.width)<=1?1:Math.pow(2,Math.floor(Math.log(f)/Math.LN2))))/2;v<1||e.neighboringTiles||(e.neighboringTiles=this._getNeighboringTiles(e.tileID));let y=g?u:ii.getImageData(u,v),b={uid:e.uid,coord:e.tileID,source:this.id,scope:this.scope,rawImageData:y,encoding:this.encoding,padding:v};e.actor&&e.state!=="expired"||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",b,o.bind(this),void 0,!0))}var f}).bind(this))}_getNeighboringTiles(e){let t=e.canonical,i=Math.pow(2,t.z),o=(t.x-1+i)%i,c=t.x===0?e.wrap-1:e.wrap,u=(t.x+1+i)%i,h=t.x+1===i?e.wrap+1:e.wrap,p={};return p[new $i(e.overscaledZ,c,t.z,o,t.y).key]={backfilled:!1},p[new $i(e.overscaledZ,h,t.z,u,t.y).key]={backfilled:!1},t.y>0&&(p[new $i(e.overscaledZ,c,t.z,o,t.y-1).key]={backfilled:!1},p[new $i(e.overscaledZ,e.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},p[new $i(e.overscaledZ,h,t.z,u,t.y-1).key]={backfilled:!1}),t.y+1<i&&(p[new $i(e.overscaledZ,c,t.z,o,t.y+1).key]={backfilled:!1},p[new $i(e.overscaledZ,e.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},p[new $i(e.overscaledZ,h,t.z,u,t.y+1).key]={backfilled:!1}),p}},geojson:class extends Hr{constructor(e,t,i,o){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(o),this._data=t.data,this._options=ge({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;let c=wt/this.tileSize;this.workerOptions=ge({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*c,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*c,extent:wt,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:wt,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*c,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterLeaves(e,t,i,o){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:e,limit:t,offset:i},o),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new Wt("dataloading",{dataType:"source"})),this._loaded=!1;let e=ge({},this.workerOptions);e.scope=this.scope;let t=this._data;typeof t=="string"?(e.request=this.map._requestManager.transformRequest(ii.resolveURL(t),Dt.Source),e.request.collectResourceTiming=this._collectResourceTiming):e.data=JSON.stringify(t),this._pendingLoad=this.actor.send(`${this.type}.loadData`,e,(i,o)=>{if(this._loaded=!0,this._pendingLoad=null,i)this.fire(new Xe(i));else{let c={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&o&&o.resourceTiming&&o.resourceTiming[this.id]&&(c.resourceTiming=o.resourceTiming[this.id]),this.fire(new Wt("data",c)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(e,t){let i=e.actor?"reloadTile":"loadTile";e.actor=this.actor;let o={type:this.type,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:ii.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};e.request=this.actor.send(i,o,(c,u)=>(delete e.request,e.destroy(),e.aborted?t(null):c?t(c):(e.loadVectorData(u,this.map.painter,i==="reloadTile"),t(null))),void 0,i==="loadTile")}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return ge({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends va{constructor(e,t,i,o){super(e,t,i,o),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;let e=this.options;this.urls=[];for(let t of e.urls)this.urls.push(this.map._requestManager.transformRequest(t,Dt.Source).url);(function(t,i){let o=m.document.createElement("video");o.muted=!0,o.onloadstart=function(){i(null,o)};for(let c=0;c<t.length;c++){let u=m.document.createElement("source");ce(t[c])||(o.crossOrigin="Anonymous"),u.src=t[c],o.appendChild(u)}})(this.urls,(t,i)=>{this._loaded=!0,t?this.fire(new Xe(t)):i&&(this.video=i,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){let t=this.video.seekable;e<t.start(0)||e>t.end(0)?this.fire(new Xe(new xe(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let e=this.map.painter.context,t=e.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new or(e,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(e)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:va,model:class extends Hr{constructor(e,t,i,o){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){let e=[];for(let t in this._options.models){let i=this._options.models[t],o=KP(this.map._requestManager.transformRequest(i.uri,Dt.Model).url).then(c=>{if(!c)return;let u=$C(c),h=new $R(t,i.position,i.orientation,u);h.computeBoundsAndApplyParent(),this.models.push(h)}).catch(c=>{this.fire(new Xe(new Error(`Could not load model ${t} from ${i.uri}: ${c.message}`)))});e.push(o)}return Promise.allSettled(e).then(()=>{this._loaded=!0,this.fire(new Wt("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new Xe(new Error(`Could not load models: ${t.message}`)))})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,t){}serialize(){return{type:"model"}}},"batched-model":class extends Hr{constructor(e,t,i,o){super(),this.type="batched-model",this.id=e,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=i,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(o)}onAdd(e){this.map=e,this.load()}load(e){this._loaded=!1,this.fire(new Wt("dataloading",{dataType:"source"}));let t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,i=this.map._worldview;this._tileJSONRequest=LC(this._options,this.map._requestManager,t,i,(o,c)=>{this._tileJSONRequest=null,this._loaded=!0,o?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),i&&i.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${i}`),this.fire(new Xe(o))):c&&(ge(this,c),c.bounds&&(this.tileBounds=new U0(c.bounds,this.minzoom,this.maxzoom)),zx(c.tiles,this.map._requestManager._customAccessToken),this.fire(new Wt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Wt("data",{dataType:"source",sourceDataType:"content"}))),e&&e(o)})}hasTransition(){return!1}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loaded(){return this._loaded}loadTile(e,t){let i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),o={request:this.map._requestManager.transformRequest(i,Dt.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(e.actor&&e.state!=="expired")if(e.state==="loading")e.reloadCallback=t;else{if(e.buckets){let u=Object.values(e.buckets);for(let h of u)h.dirty=!0;return void(e.state="loaded")}e.request=e.actor.send("reloadTile",o,c.bind(this))}else e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",o,c.bind(this),void 0,!0);function c(u,h){return e.aborted?t(null):u&&u.status!==404?t(u):(h&&(h.resourceTiming&&(e.resourceTiming=h.resourceTiming),this.map._refreshExpiredTiles&&e.setExpiryData(h),e.buckets=qt(qt({},e.buckets),h.buckets)),e.state="loaded",void t(null))}}serialize(){return ge({},this._options)}},canvas:class extends va{constructor(e,t,i,o){super(e,t,i,o),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(c=>!Array.isArray(c)||c.length!==2||c.some(u=>typeof u!="number"))||this.fire(new Xe(new xe(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new Xe(new xe(`sources.${e}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new Xe(new xe(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof m.HTMLCanvasElement||this.fire(new Xe(new xe(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new Xe(new xe(`sources.${e}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof m.HTMLCanvasElement?this.options.canvas:m.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new Xe(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let t=this.map.painter.context;this.texture?!e&&!this._playing||this.texture instanceof T0||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new or(t,this.canvas,t.gl.RGBA,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends Hr{constructor(e,t,i,o){super(),this.id=e,this.type="custom",this._dataType="raster",this._dispatcher=i,this._implementation=t,this.setEventedParent(o),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new Xe(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new Xe(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new U0(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),ge(this,Go(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return Go(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new Wt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Wt("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(e){this._map=e,this._loaded=!1,this.fire(new Wt("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(e),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){let{x:t,y:i,z:o}=e.canonical;return this._implementation.hasTile({x:t,y:i,z:o})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,t){let{x:i,y:o,z:c}=e.tileID.canonical,u=new m.AbortController;e.request=Promise.resolve(this._implementation.loadTile({x:i,y:o,z:c},{signal:u.signal})).then((function(h){return delete e.request,e.aborted?(e.state="unloaded",t(null)):h===void 0?(e.state="errored",t(null)):h===null?(this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",t(null)):function(p){return p instanceof m.ImageData||p instanceof m.HTMLCanvasElement||p instanceof m.ImageBitmap||p instanceof m.HTMLImageElement}(h)?(this.loadTileData(e,h),e.state="loaded",void t(null)):(e.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(h=>{h.code!==20&&(e.state="errored",t(h))}),e.request.cancel=()=>u.abort()}loadTileData(e,t){e.setTexture(t,this._map.painter)}unloadTile(e,t){if(e.texture&&e.texture instanceof or?(e.destroy(!0),e.texture&&e.texture instanceof or&&this._map.painter.saveTileTexture(e.texture)):e.destroy(),this._implementation.unloadTile){let{x:i,y:o,z:c}=e.tileID.canonical;this._implementation.unloadTile({x:i,y:o,z:c})}t()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z}))}_clearTiles(){let e=Xo(this.id,this.scope);this._map.style.clearSource(e)}_update(){this.fire(new Wt("data",{dataType:"source",sourceDataType:"content"}))}}},ZC=function(e,t,i,o){let c=new YC[t.type](e,t,i,o);if(c.id!==e)throw new Error(`Expected Source id to be ${e} instead of ${c.id}`);return vo(["load","abort","unload","serialize","prepare"],c),c};function dq(e,t){let i=ft.identity([]);return ft.scale(i,i,[.5*e.width,.5*-e.height,1]),ft.translate(i,i,[1,-1,0]),ft.multiply(i,i,e.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(i)}function uq(e,t,i,o,c,u,h,p=!1){let f=e.tilesIn(o,h,p);f.sort(tO);let g=[];for(let y of f)g.push({wrappedTileID:y.tile.tileID.wrapped().key,queryResults:y.tile.queryRenderedFeatures(t,i,e._state,y,c,u,dq(e.transform,y.tile.tileID),p)});let v=function(y){let b={},x={};for(let C of y){let E=C.queryResults,M=C.wrappedTileID,D=x[M]=x[M]||{};for(let A in E){let P=E[A],O=D[A]=D[A]||{},R=b[A]=b[A]||[];for(let F of P)O[F.featureIndex]||(O[F.featureIndex]=!0,R.push(F))}}return b}(g);for(let y in v)v[y].forEach(b=>{let x=b.feature,C=x.layer;C&&C.type!=="background"&&C.type!=="sky"&&C.type!=="slot"&&(x.source=C.source,C["source-layer"]&&(x.sourceLayer=C["source-layer"]),x.state=x.id!==void 0?e.getFeatureState(C["source-layer"],x.id):{})});return v}function hq(e,t){let i=e.getRenderableIds().map(u=>e.getTileByID(u)),o=[],c={};for(let u=0;u<i.length;u++){let h=i[u],p=h.tileID.canonical.key;c[p]||(c[p]=!0,h.querySourceFeatures(o,t))}return o}function tO(e,t){let i=e.tileID,o=t.tileID;return i.overscaledZ-o.overscaledZ||i.canonical.y-o.canonical.y||i.wrap-o.wrap||i.canonical.x-o.canonical.x}class mq{constructor(t){this.style=t}processLayersChanged(){this.layers=[];for(let t in this.style._mergedLayers){let i=this.style._mergedLayers[t];if(i.type==="fill-extrusion")this.layers.push(i);else if(i.type==="model"){let o=this.style.getLayerSource(i);o&&o.type==="batched-model"&&this.layers.push(i)}}}updateZOffset(t,i){this.currentBuildingBuckets=[];for(let c=0;c<this.layers.length;++c){let u=this.layers[c],h=this.style.getLayerSourceCache(u),p=1;u.type==="fill-extrusion"&&(p=u.paint.get("fill-extrusion-opacity")>0?u.paint.get("fill-extrusion-vertical-scale"):0);let f=h?h.getTile(i):null;if(!f&&h&&i.canonical.z>h.getSource().minzoom){let g=i.scaledTo(Math.min(h.getSource().maxzoom,i.overscaledZ-1));for(;g.overscaledZ>=h.getSource().minzoom&&(f=h.getTile(g),!f&&g.overscaledZ!==0);)g=g.scaledTo(g.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:f?f.getBucket(u):null,tileID:f?f.tileID:i,verticalScale:p})}t.hasAnyZOffset=!1;let o=!1;for(let c=0;c<t.symbolInstances.length;c++){let u=t.symbolInstances.get(c),h=u.zOffset,p=this._getHeightAtTileOffset(i,u.tileAnchorX,u.tileAnchorY);u.zOffset=p!==-1?p:h,o||h===u.zOffset||(o=!0),t.hasAnyZOffset||u.zOffset===0||(t.hasAnyZOffset=!0)}o&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,i,o,c){let u=i,h=o;if(t.canonical.z!==c.canonical.z){let p=c.canonical,f=1/(1<<t.canonical.z-p.z);u=(i+t.canonical.x*wt)*f-p.x*wt|0,h=(o+t.canonical.y*wt)*f-p.y*wt|0}return{tileX:u,tileY:h}}_getHeightAtTileOffset(t,i,o){let c;for(let u=0;u<this.layers.length;++u){if(this.layers[u].type!=="fill-extrusion")continue;let{bucket:h,tileID:p,verticalScale:f}=this.currentBuildingBuckets[u];if(!h)continue;let{tileX:g,tileY:v}=this._mapCoordToOverlappingTile(t,i,o,p),y=h.getHeightAtTileCoord(g,v);if(y&&y.height!==void 0){if(!y.hidden)return y.height*f;c=y.height}}for(let u=0;u<this.layers.length;++u){if(this.layers[u].type!=="model")continue;let{bucket:h,tileID:p}=this.currentBuildingBuckets[u];if(!h)continue;let{tileX:f,tileY:g}=this._mapCoordToOverlappingTile(t,i,o,p),v=h.getHeightAtTileCoord(f,g);if(v&&!v.hidden)return v.height===void 0&&c!==void 0?Math.min(v.maxHeight,c)*v.verticalScale:(v.height||0)*v.verticalScale}return-1}}var eO=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function pq(e,t){let i={};for(let o in e)o!=="ref"&&(i[o]=e[o]);return eO.forEach(o=>{o in t&&(i[o]=t[o])}),i}function iO(e){e=e.slice();let t=Object.create(null);for(let i=0;i<e.length;i++)t[e[i].id]=e[i];for(let i=0;i<e.length;i++)"ref"in e[i]&&(e[i]=pq(e[i],t[e[i].ref]));return e}let Ki={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function nO(e,t,i){i.push({command:Ki.addSource,args:[e,t[e]]})}function rO(e,t,i){t.push({command:Ki.removeSource,args:[e]}),i[e]=!0}function fq(e,t,i,o){rO(e,i,o),nO(e,t,i)}function gq(e,t,i){let o;for(o in e[i])if(e[i].hasOwnProperty(o)&&o!=="data"&&!$t(e[i][o],t[i][o]))return!1;for(o in t[i])if(t[i].hasOwnProperty(o)&&o!=="data"&&!$t(e[i][o],t[i][o]))return!1;return!0}function G0(e,t,i,o,c,u){let h;for(h in t=t||{},e=e||{})e.hasOwnProperty(h)&&($t(e[h],t[h])||i.push({command:u,args:[o,h,t[h],c]}));for(h in t)t.hasOwnProperty(h)&&!e.hasOwnProperty(h)&&($t(e[h],t[h])||i.push({command:u,args:[o,h,t[h],c]}))}function q0(e){return e.id}function W0(e,t){return e[t.id]=t,e}class _q{constructor(t,i){this.reset(t,i)}reset(t,i){this.points=t||[],this._distances=[0];for(let o=1;o<this.points.length;o++)this._distances[o]=this._distances[o-1]+this.points[o].dist(this.points[o-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(i||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=ve(t,0,1);let i=1,o=this._distances[i],c=t*this.paddedLength+this.padding;for(;o<c&&i<this._distances.length;)o=this._distances[++i];let u=i-1,h=this._distances[u],p=o-h,f=p>0?(c-h)/p:0;return this.points[u].mult(1-f).add(this.points[i].mult(f))}}class oO{constructor(t,i,o){let c=this.boxCells=[],u=this.circleCells=[];this.xCellCount=Math.ceil(t/o),this.yCellCount=Math.ceil(i/o);for(let h=0;h<this.xCellCount*this.yCellCount;h++)c.push([]),u.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=i,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/i,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,i,o,c,u){this._forEachCell(i,o,c,u,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(u)}insertCircle(t,i,o,c){this._forEachCell(i-c,o-c,i+c,o+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(i),this.circles.push(o),this.circles.push(c)}_insertBoxCell(t,i,o,c,u,h){this.boxCells[u].push(h)}_insertCircleCell(t,i,o,c,u,h){this.circleCells[u].push(h)}_query(t,i,o,c,u,h){if(o<0||t>this.width||c<0||i>this.height)return!u&&[];let p=[];if(t<=0&&i<=0&&this.width<=o&&this.height<=c){if(u)return!0;for(let f=0;f<this.boxKeys.length;f++)p.push({key:this.boxKeys[f],x1:this.bboxes[4*f],y1:this.bboxes[4*f+1],x2:this.bboxes[4*f+2],y2:this.bboxes[4*f+3]});for(let f=0;f<this.circleKeys.length;f++){let g=this.circles[3*f],v=this.circles[3*f+1],y=this.circles[3*f+2];p.push({key:this.circleKeys[f],x1:g-y,y1:v-y,x2:g+y,y2:v+y})}return h?p.filter(h):p}return this._forEachCell(t,i,o,c,this._queryCell,p,{hitTest:u,seenUids:{box:{},circle:{}}},h),u?p.length>0:p}_queryCircle(t,i,o,c,u){let h=t-o,p=t+o,f=i-o,g=i+o;if(p<0||h>this.width||g<0||f>this.height)return!c&&[];let v=[];return this._forEachCell(h,f,p,g,this._queryCellCircle,v,{hitTest:c,circle:{x:t,y:i,radius:o},seenUids:{box:{},circle:{}}},u),c?v.length>0:v}query(t,i,o,c,u){return this._query(t,i,o,c,!1,u)}hitTest(t,i,o,c,u){return this._query(t,i,o,c,!0,u)}hitTestCircle(t,i,o,c){return this._queryCircle(t,i,o,!0,c)}_queryCell(t,i,o,c,u,h,p,f){let g=p.seenUids,v=this.boxCells[u];if(v!==null){let b=this.bboxes;for(let x of v)if(!g.box[x]){g.box[x]=!0;let C=4*x;if(t<=b[C+2]&&i<=b[C+3]&&o>=b[C+0]&&c>=b[C+1]&&(!f||f(this.boxKeys[x]))){if(p.hitTest)return h.push(!0),!0;h.push({key:this.boxKeys[x],x1:b[C],y1:b[C+1],x2:b[C+2],y2:b[C+3]})}}}let y=this.circleCells[u];if(y!==null){let b=this.circles;for(let x of y)if(!g.circle[x]){g.circle[x]=!0;let C=3*x;if(this._circleAndRectCollide(b[C],b[C+1],b[C+2],t,i,o,c)&&(!f||f(this.circleKeys[x]))){if(p.hitTest)return h.push(!0),!0;{let E=b[C],M=b[C+1],D=b[C+2];h.push({key:this.circleKeys[x],x1:E-D,y1:M-D,x2:E+D,y2:M+D})}}}}}_queryCellCircle(t,i,o,c,u,h,p,f){let g=p.circle,v=p.seenUids,y=this.boxCells[u];if(y!==null){let x=this.bboxes;for(let C of y)if(!v.box[C]){v.box[C]=!0;let E=4*C;if(this._circleAndRectCollide(g.x,g.y,g.radius,x[E+0],x[E+1],x[E+2],x[E+3])&&(!f||f(this.boxKeys[C])))return h.push(!0),!0}}let b=this.circleCells[u];if(b!==null){let x=this.circles;for(let C of b)if(!v.circle[C]){v.circle[C]=!0;let E=3*C;if(this._circlesCollide(x[E],x[E+1],x[E+2],g.x,g.y,g.radius)&&(!f||f(this.circleKeys[C])))return h.push(!0),!0}}}_forEachCell(t,i,o,c,u,h,p,f){let g=this._convertToXCellCoord(t),v=this._convertToYCellCoord(i),y=this._convertToXCellCoord(o),b=this._convertToYCellCoord(c);for(let x=g;x<=y;x++)for(let C=v;C<=b;C++)if(u.call(this,t,i,o,c,this.xCellCount*C+x,h,p,f))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,i,o,c,u,h){let p=c-t,f=u-i,g=o+h;return g*g>p*p+f*f}_circleAndRectCollide(t,i,o,c,u,h,p){let f=(h-c)/2,g=Math.abs(t-(c+f));if(g>f+o)return!1;let v=(p-u)/2,y=Math.abs(i-(u+v));if(y>v+o)return!1;if(g<=f||y<=v)return!0;let b=g-f,x=y-v;return b*b+x*x<=o*o}}let Rl=100;class vq{constructor(t,i,o=new oO(t.width+200,t.height+200,25),c=new oO(t.width+200,t.height+200,25)){this.transform=t,this.grid=o,this.ignoredGrid=c,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Rl,this.screenBottomBoundary=t.height+Rl,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=i}placeCollisionBox(t,i,o,c,u,h,p,f){let g=o.projectedAnchorX,v=o.projectedAnchorY,y=o.projectedAnchorZ,b=o.elevation,x=o.tileID,C=t.getProjection();if(b&&x){let[F,N,j]=C.upVector(x.canonical,o.tileAnchorX,o.tileAnchorY),U=C.upVectorScale(x.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;g+=F*b*U,v+=N*b*U,y+=j*b*U}let E=this.projectAndGetPerspectiveRatio(p,g,v,y,o.tileID,C.name==="globe"||!!b||this.transform.pitch>0,C),M=h*E.perspectiveRatio,D=(o.x1*i+c.x-o.padding)*M+E.point.x,A=(o.y1*i+c.y-o.padding)*M+E.point.y,P=(o.x2*i+c.x+o.padding)*M+E.point.x,O=(o.y2*i+c.y+o.padding)*M+E.point.y,R=E.perspectiveRatio<=.55||E.occluded;return!this.isInsideGrid(D,A,P,O)||!u&&this.grid.hitTest(D,A,P,O,f)||R?{box:[],offscreen:!1,occluded:E.occluded}:{box:[D,A,P,O],offscreen:this.isOffscreen(D,A,P,O),occluded:!1}}placeCollisionCircles(t,i,o,c,u,h,p,f,g,v,y,b,x,C,E){let M=[],D=this.transform.elevation,A=t.getProjection(),P=D?D.getAtTileOffsetFunc(E,this.transform.center.lat,this.transform.worldSize,A):null,O=new Q(o.tileAnchorX,o.tileAnchorY),{x:R,y:F,z:N}=A.projectTilePoint(O.x,O.y,E.canonical);if(P){let[pt,nt,ot]=P(O);R+=pt,F+=nt,N+=ot}let j=A.name==="globe",U=this.projectAndGetPerspectiveRatio(p,R,F,N,E,j||!!D||this.transform.pitch>0,A),{perspectiveRatio:G}=U,Y=(y?h/G:h*G)/So,Z=el(R,F,N,f),tt=U.signedDistanceFromCamera>0?zR(Y,u,o.lineOffsetX*Y,o.lineOffsetY*Y,!1,Z,O,o,c,f,{},D&&!y?P:null,y&&!!D,A,E,y):null,$=!1,rt=!1,st=!0;if(tt&&!U.occluded){let pt=.5*x*G+C,nt=new Q(-100,-100),ot=new Q(this.screenRightBoundary,this.screenBottomBoundary),vt=new _q,{first:bt,last:yt}=tt,Ct=bt.path.length,Et=[];for(let Ft=Ct-1;Ft>=1;Ft--)Et.push(bt.path[Ft]);for(let Ft=1;Ft<yt.path.length;Ft++)Et.push(yt.path[Ft]);let It=2.5*pt;g&&(Et=Et.map(([Ft,te,ee],de)=>(P&&!j&&(ee=P(de<Ct-1?bt.tilePath[Ct-1-de]:yt.tilePath[de-Ct+2])[2]),el(Ft,te,ee,g))),Et.some(Ft=>Ft[3]<=0)&&(Et=[]));let xt=[];if(Et.length>0){let Ft=1/0,te=-1/0,ee=1/0,de=-1/0;for(let me of Et)Ft=Math.min(Ft,me[0]),ee=Math.min(ee,me[1]),te=Math.max(te,me[0]),de=Math.max(de,me[1]);te>=nt.x&&Ft<=ot.x&&de>=nt.y&&ee<=ot.y&&(xt=[Et.map(me=>new Q(me[0],me[1]))],(Ft<nt.x||te>ot.x||ee<nt.y||de>ot.y)&&(xt=oR(xt,nt.x,nt.y,ot.x,ot.y)))}for(let Ft of xt){vt.reset(Ft,.25*pt);let te=0;te=vt.length<=.5*pt?1:Math.ceil(vt.paddedLength/It)+1;for(let ee=0;ee<te;ee++){let de=ee/Math.max(te-1,1),me=vt.lerp(de),Ge=me.x+Rl,Ie=me.y+Rl;M.push(Ge,Ie,pt,0);let Ui=Ge-pt,Mi=Ie-pt,qe=Ge+pt,je=Ie+pt;if(st=st&&this.isOffscreen(Ui,Mi,qe,je),rt=rt||this.isInsideGrid(Ui,Mi,qe,je),!i&&this.grid.hitTestCircle(Ge,Ie,pt,b)&&($=!0,!v))return{circles:[],offscreen:!1,collisionDetected:$,occluded:!1}}}}return{circles:!v&&$||!rt?[]:M,offscreen:st,collisionDetected:$,occluded:U.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let i=[],o=1/0,c=1/0,u=-1/0,h=-1/0;for(let v of t){let y=new Q(v.x+Rl,v.y+Rl);o=Math.min(o,y.x),c=Math.min(c,y.y),u=Math.max(u,y.x),h=Math.max(h,y.y),i.push(y)}let p=this.grid.query(o,c,u,h).concat(this.ignoredGrid.query(o,c,u,h)),f={},g={};for(let v of p){let y=v.key;f[y.bucketInstanceId]===void 0&&(f[y.bucketInstanceId]={}),f[y.bucketInstanceId][y.featureIndex]||ck(i,[new Q(v.x1,v.y1),new Q(v.x2,v.y1),new Q(v.x2,v.y2),new Q(v.x1,v.y2)])&&(f[y.bucketInstanceId][y.featureIndex]=!0,g[y.bucketInstanceId]===void 0&&(g[y.bucketInstanceId]=[]),g[y.bucketInstanceId].push(y.featureIndex))}return g}insertCollisionBox(t,i,o,c,u){(i?this.ignoredGrid:this.grid).insert({bucketInstanceId:o,featureIndex:c,collisionGroupID:u},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,i,o,c,u){let h=i?this.ignoredGrid:this.grid,p={bucketInstanceId:o,featureIndex:c,collisionGroupID:u};for(let f=0;f<t.length;f+=4)h.insertCircle(p,t[f],t[f+1],t[f+2])}projectAndGetPerspectiveRatio(t,i,o,c,u,h,p){let f=[i,o,c,1],g=!1;c||this.transform.pitch>0?(hn.transformMat4(f,f,t),this.fogState&&u&&p.name!=="globe"&&(g=function(b,x,C,E,M,D){let A=D.calculateFogTileMatrix(M),P=[x,C,E];return J.transformMat4(P,P,A),V0(b,J.length(P),D.pitch,D._fov)}(this.fogState,i,o,c,u.toUnwrapped(),this.transform)>.9)):UR(f,f,t);let v=f[3];return{point:new Q((f[0]/v+1)/2*this.transform.width+Rl,(-f[1]/v+1)/2*this.transform.height+Rl),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(p)/v*.5,1.5),signedDistanceFromCamera:v,occluded:h&&f[2]>v||g}}isOffscreen(t,i,o,c){return o<Rl||t>=this.screenRightBoundary||c<Rl||i>this.screenBottomBoundary}isInsideGrid(t,i,o,c){return o>=0&&t<this.gridRightBoundary&&c>=0&&i<this.gridBottomBoundary}getViewportMatrix(){let t=ft.identity([]);return ft.translate(t,t,[-100,-100,0]),t}}function XC(e,t,i){let o=t.createTileMatrix(e,e.worldSize,i.toUnwrapped());return ft.multiply(new Float32Array(16),e.projMatrix,o)}function yq(e,t,i){if(t.projection.name===i.projection.name)return e.projMatrix;let o=i.clone();return o.setProjection(t.projection),XC(o,t.getProjection(),e)}function KC(e,t,i){return t.name===i.projection.name?e.projMatrix:XC(i,t,e)}class sO{constructor(t,i,o,c){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?i:-i))):c&&o?1:0,this.placed=o}isHidden(){return this.opacity===0&&!this.placed}}class cf{constructor(t,i,o,c,u,h=!1){this.text=new sO(t?t.text:null,i,o,u),this.icon=new sO(t?t.icon:null,i,c,u),this.clipped=h}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class QC{constructor(t,i,o,c=!1){this.text=t,this.icon=i,this.skipFade=o,this.clipped=c}}class bq{constructor(){this.invProjMatrix=ft.create(),this.viewportMatrix=ft.create(),this.circles=[]}}class xq{constructor(t,i,o,c,u){this.bucketInstanceId=t,this.featureIndex=i,this.sourceLayerIndex=o,this.bucketIndex=c,this.tileID=u}}class wq{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){let i=++this.maxGroupID;this.collisionGroups[t]={ID:i,predicate:o=>o.collisionGroupID===i}}return this.collisionGroups[t]}}function aO(e,t,i,o,c){let{horizontalAlign:u,verticalAlign:h}=m0(e),p=-(u-.5)*t,f=-(h-.5)*i,g=fC(e,o);return new Q(p+g[0]*c,f+g[1]*c)}function JC(e,t,i,o,c){let u=new Q(e,t);return i&&u._rotate(o?c:-c),u}class Cq{constructor(t,i,o,c,u,h){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new vq(this.transform,u),this.buildingIndex=h,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=i,this.retainedQueryData={},this.collisionGroups=new wq(o),this.collisionCircleArrays={},this.prevPlacement=c,c&&(c.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,i,o,c){let u=o.getBucket(i),h=o.latestFeatureIndex;if(!u||!h||i.fqid!==u.layerIds[0])return;let p=u.layers[0].layout,f=o.collisionBoxArray,g=Math.pow(2,this.transform.zoom-o.tileID.overscaledZ),v=o.tileSize/wt,y=o.tileID.toUnwrapped();this.transform.setProjection(u.projection);let b=(x=o.tileID,C=u.getProjection(),E=this.transform,C.name===this.projection?E.calculateProjMatrix(x.toUnwrapped()):XC(E,C,x));var x,C,E;let M=p.get("text-pitch-alignment")==="map",D=p.get("text-rotation-alignment")==="map";i.compileFilter();let A=i.dynamicFilter(),P=i.dynamicFilterNeedsFeature(),O=this.transform.calculatePixelsToTileUnitsMatrix(o),R=OR(b,o.tileID.canonical,M,D,this.transform,u.getProjection(),O),F=null;if(M){let U=FR(b,o.tileID.canonical,M,D,this.transform,u.getProjection(),O);F=ft.multiply([],this.transform.labelPlaneMatrix,U)}let N=null;A&&o.latestFeatureIndex&&(N={unwrappedTileID:y,dynamicFilter:A,dynamicFilterNeedsFeature:P,featureIndex:o.latestFeatureIndex}),this.retainedQueryData[u.bucketInstanceId]=new xq(u.bucketInstanceId,h,u.sourceLayerIndex,u.index,o.tileID);let j={bucket:u,layout:p,posMatrix:b,textLabelPlaneMatrix:R,labelToScreenMatrix:F,clippingData:N,scale:g,textPixelRatio:v,holdingForFade:o.holdingForFade(),collisionBoxArray:f,partiallyEvaluatedTextSize:Tl(u.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:Tl(u.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(u.sourceID)};if(c)for(let U of u.sortKeyRanges){let{sortKey:G,symbolInstanceStart:Y,symbolInstanceEnd:Z}=U;t.push({sortKey:G,symbolInstanceStart:Y,symbolInstanceEnd:Z,parameters:j})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:u.symbolInstances.length,parameters:j})}attemptAnchorPlacement(t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M,D,A){let{textOffset0:P,textOffset1:O,crossTileID:R}=b,F=[P,O],N=aO(t,o,c,F,u),j=this.collisionIndex.placeCollisionBox(C,u,i,JC(N.x,N.y,h,p,this.transform.angle),y,f,g,v.predicate);if(M){let U=C.getSymbolInstanceIconSize(A,this.transform.zoom,b.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(C,U,M,JC(N.x,N.y,h,p,this.transform.angle),y,f,g,v.predicate).box.length===0)return}if(j.box.length>0){let U;return this.prevPlacement&&this.prevPlacement.variableOffsets[R]&&this.prevPlacement.placements[R]&&this.prevPlacement.placements[R].text&&(U=this.prevPlacement.variableOffsets[R].anchor),this.variableOffsets[R]={textOffset:F,width:o,height:c,anchor:t,textScale:u,prevAnchor:U},this.markUsedJustification(C,t,b,E),C.allowVerticalPlacement&&(this.markUsedOrientation(C,E,b),this.placedOrientations[R]=E),{shift:N,placedGlyphBoxes:j}}}placeLayerBucketPart(t,i,o,c){let{bucket:u,layout:h,posMatrix:p,textLabelPlaneMatrix:f,labelToScreenMatrix:g,clippingData:v,textPixelRatio:y,holdingForFade:b,collisionBoxArray:x,partiallyEvaluatedTextSize:C,partiallyEvaluatedIconSize:E,collisionGroup:M}=t.parameters,D=h.get("text-optional"),A=h.get("icon-optional"),P=h.get("text-allow-overlap"),O=h.get("icon-allow-overlap"),R=h.get("text-rotation-alignment")==="map",F=h.get("text-pitch-alignment")==="map",N=h.get("symbol-z-order")==="viewport-y",j=h.get("symbol-z-elevate");this.transform.setProjection(u.projection);let U=P&&(O||!u.hasIconData()||A),G=O&&(P||!u.hasTextData()||D);!u.collisionArrays&&x&&u.deserializeCollisionBoxes(x),o&&c&&u.updateCollisionDebugBuffers(this.transform.zoom,x);let Y=(Z,tt,$)=>{let{crossTileID:rt,numVerticalGlyphVertices:st}=Z;if(v){let qe={zoom:this.transform.zoom,pitch:this.transform.pitch},je=null;if(v.dynamicFilterNeedsFeature){let ke=this.retainedQueryData[u.bucketInstanceId];je=v.featureIndex.loadFeature({featureIndex:Z.featureIndex,bucketIndex:ke.bucketIndex,sourceLayerIndex:ke.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,v.dynamicFilter)(qe,je,this.retainedQueryData[u.bucketInstanceId].tileID.canonical,new Q(Z.tileAnchorX,Z.tileAnchorY),this.transform.calculateDistanceTileData(v.unwrappedTileID)))return this.placements[rt]=new QC(!1,!1,!1,!0),void i.add(rt)}if(i.has(rt))return;if(b)return void(this.placements[rt]=new QC(!1,!1,!1));let pt=!1,nt=!1,ot=!0,vt=!1,bt=!1,yt=null,Ct={box:null,offscreen:null,occluded:null},Et={box:null,offscreen:null,occluded:null},It=null,xt=null,Ft=null,te=0,ee=0,de=0;$.textFeatureIndex?te=$.textFeatureIndex:Z.useRuntimeCollisionCircles&&(te=Z.featureIndex),$.verticalTextFeatureIndex&&(ee=$.verticalTextFeatureIndex);let me=qe=>{qe.tileID=this.retainedQueryData[u.bucketInstanceId].tileID;let je=this.transform.elevation;qe.elevation=Z.zOffset+(je?je.getAtTileOffset(qe.tileID,qe.tileAnchorX,qe.tileAnchorY):0)},Ge=$.textBox;if(Ge){me(Ge);let qe=ke=>{let Ii=Jn.horizontal;if(u.allowVerticalPlacement&&!ke&&this.prevPlacement){let Vi=this.prevPlacement.placedOrientations[rt];Vi&&(this.placedOrientations[rt]=Vi,Ii=Vi,this.markUsedOrientation(u,Ii,Z))}return Ii},je=(ke,Ii)=>{if(u.allowVerticalPlacement&&st>0&&$.verticalTextBox){for(let Vi of u.writingModes)if(Vi===Jn.vertical?(Ct=Ii(),Et=Ct):Ct=ke(),Ct&&Ct.box&&Ct.box.length)break}else Ct=ke()};if(h.get("text-variable-anchor")){let ke=h.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[rt]){let gi=this.prevPlacement.variableOffsets[rt];ke.indexOf(gi.anchor)>0&&(ke=ke.filter(bn=>bn!==gi.anchor),ke.unshift(gi.anchor))}let Ii=(gi,bn,Ar)=>{let mn=u.getSymbolInstanceTextSize(C,Z,this.transform.zoom,tt),jn=(gi.x2-gi.x1)*mn+2*gi.padding,zr=(gi.y2-gi.y1)*mn+2*gi.padding,kr=Z.hasIconTextFit&&!O?bn:null;kr&&me(kr);let $n={box:[],offscreen:!1,occluded:!1},an=P?2*ke.length:ke.length;for(let Po=0;Po<an;++Po){let Ol=this.attemptAnchorPlacement(ke[Po%ke.length],gi,jn,zr,mn,R,F,y,p,M,Po>=ke.length,Z,tt,u,Ar,kr,C,E);if(Ol&&($n=Ol.placedGlyphBoxes,$n&&$n.box&&$n.box.length)){pt=!0,yt=Ol.shift;break}}return $n};je(()=>Ii(Ge,$.iconBox,Jn.horizontal),()=>{let gi=$.verticalTextBox;return gi&&me(gi),u.allowVerticalPlacement&&!(Ct&&Ct.box&&Ct.box.length)&&st>0&&gi?Ii(gi,$.verticalIconBox,Jn.vertical):{box:null,offscreen:null,occluded:null}}),Ct&&(pt=Ct.box,ot=Ct.offscreen,vt=Ct.occluded);let Vi=qe(!(!Ct||!Ct.box));if(!pt&&this.prevPlacement){let gi=this.prevPlacement.variableOffsets[rt];gi&&(this.variableOffsets[rt]=gi,this.markUsedJustification(u,gi.anchor,Z,Vi))}}else{let ke=(Ii,Vi)=>{let gi=u.getSymbolInstanceTextSize(C,Z,this.transform.zoom,tt),bn=this.collisionIndex.placeCollisionBox(u,gi,Ii,new Q(0,0),P,y,p,M.predicate);return bn&&bn.box&&bn.box.length&&(this.markUsedOrientation(u,Vi,Z),this.placedOrientations[rt]=Vi),bn};je(()=>ke(Ge,Jn.horizontal),()=>{let Ii=$.verticalTextBox;return u.allowVerticalPlacement&&st>0&&Ii?(me(Ii),ke(Ii,Jn.vertical)):{box:null,offscreen:null,occluded:null}}),qe(!!(Ct&&Ct.box&&Ct.box.length))}}if(It=Ct,pt=It&&It.box&&It.box.length>0,ot=It&&It.offscreen,vt=It&&It.occluded,Z.useRuntimeCollisionCircles){let qe=u.text.placedSymbolArray.get(Z.centerJustifiedTextSymbolIndex>=0?Z.centerJustifiedTextSymbolIndex:Z.verticalPlacedTextSymbolIndex),je=Vp(u.textSizeData,C,qe),ke=h.get("text-padding");xt=this.collisionIndex.placeCollisionCircles(u,P,qe,u.lineVertexArray,u.glyphOffsetArray,je,p,f,g,o,F,M.predicate,Z.collisionCircleDiameter*je/So,ke,this.retainedQueryData[u.bucketInstanceId].tileID),pt=P||xt.circles.length>0&&!xt.collisionDetected,ot=ot&&xt.offscreen,vt=xt.occluded}if($.iconFeatureIndex&&(de=$.iconFeatureIndex),$.iconBox){let qe=je=>{me(je);let ke=Z.hasIconTextFit&&yt?JC(yt.x,yt.y,R,F,this.transform.angle):new Q(0,0),Ii=u.getSymbolInstanceIconSize(E,this.transform.zoom,Z.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(u,Ii,je,ke,O,y,p,M.predicate)};Et&&Et.box&&Et.box.length&&$.verticalIconBox?(Ft=qe($.verticalIconBox),nt=Ft.box.length>0):(Ft=qe($.iconBox),nt=Ft.box.length>0),ot=ot&&Ft.offscreen,bt=Ft.occluded}let Ie=D||Z.numHorizontalGlyphVertices===0&&st===0,Ui=A||Z.numIconVertices===0;if(Ie||Ui?Ui?Ie||(nt=nt&&pt):pt=nt&&pt:nt=pt=nt&&pt,pt&&It&&It.box&&this.collisionIndex.insertCollisionBox(It.box,h.get("text-ignore-placement"),u.bucketInstanceId,Et&&Et.box&&ee?ee:te,M.ID),nt&&Ft&&this.collisionIndex.insertCollisionBox(Ft.box,h.get("icon-ignore-placement"),u.bucketInstanceId,de,M.ID),xt&&(pt&&this.collisionIndex.insertCollisionCircles(xt.circles,h.get("text-ignore-placement"),u.bucketInstanceId,te,M.ID),o)){let qe=u.bucketInstanceId,je=this.collisionCircleArrays[qe];je===void 0&&(je=this.collisionCircleArrays[qe]=new bq);for(let ke=0;ke<xt.circles.length;ke+=4)je.circles.push(xt.circles[ke+0]),je.circles.push(xt.circles[ke+1]),je.circles.push(xt.circles[ke+2]),je.circles.push(xt.collisionDetected?1:0)}let Mi=u.projection.name!=="globe";U=U&&(Mi||!vt),G=G&&(Mi||!bt),this.placements[rt]=new QC(pt||U,nt||G,ot||u.justReloaded),i.add(rt)};if(j&&this.buildingIndex&&(this.buildingIndex.updateZOffset(u,this.retainedQueryData[u.bucketInstanceId].tileID),u.updateZOffset()),N){let Z=u.getSortedSymbolIndexes(this.transform.angle);for(let tt=Z.length-1;tt>=0;--tt){let $=Z[tt];Y(u.symbolInstances.get($),$,u.collisionArrays[$])}u.hasAnyZOffset&&lt(`${u.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(u.hasAnyZOffset){let Z=u.getSortedIndexesByZOffset();for(let tt=0;tt<Z.length;++tt){let $=Z[tt];Y(u.symbolInstances.get($),$,u.collisionArrays[$])}}else for(let Z=t.symbolInstanceStart;Z<t.symbolInstanceEnd;Z++)Y(u.symbolInstances.get(Z),Z,u.collisionArrays[Z]);if(o&&u.bucketInstanceId in this.collisionCircleArrays){let Z=this.collisionCircleArrays[u.bucketInstanceId];ft.invert(Z.invProjMatrix,p),Z.viewportMatrix=this.collisionIndex.getViewportMatrix()}u.justReloaded=!1}markUsedJustification(t,i,o,c){let{leftJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:h,rightJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:f,crossTileID:g}=o,v=gC(i),y=c===Jn.vertical?f:v==="left"?u:v==="center"?h:v==="right"?p:-1;u>=0&&(t.text.placedSymbolArray.get(u).crossTileID=y>=0&&u!==y?0:g),h>=0&&(t.text.placedSymbolArray.get(h).crossTileID=y>=0&&h!==y?0:g),p>=0&&(t.text.placedSymbolArray.get(p).crossTileID=y>=0&&p!==y?0:g),f>=0&&(t.text.placedSymbolArray.get(f).crossTileID=y>=0&&f!==y?0:g)}markUsedOrientation(t,i,o){let c=i===Jn.horizontal||i===Jn.horizontalOnly?i:0,u=i===Jn.vertical?i:0,{leftJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:p,rightJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:g}=o,v=t.text.placedSymbolArray;h>=0&&(v.get(h).placedOrientation=c),p>=0&&(v.get(p).placedOrientation=c),f>=0&&(v.get(f).placedOrientation=c),g>=0&&(v.get(g).placedOrientation=u)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;let i=this.prevPlacement,o=!1;this.prevZoomAdjustment=i?i.zoomAdjustment(this.transform.zoom):0;let c=i?i.symbolFadeChange(t):1,u=i?i.opacities:{},h=i?i.variableOffsets:{},p=i?i.placedOrientations:{};for(let f in this.placements){let g=this.placements[f],v=u[f];v?(this.opacities[f]=new cf(v,c,g.text,g.icon,null,g.clipped),o=o||g.text!==v.text.placed||g.icon!==v.icon.placed):(this.opacities[f]=new cf(null,c,g.text,g.icon,g.skipFade,g.clipped),o=o||g.text||g.icon)}for(let f in u){let g=u[f];if(!this.opacities[f]){let v=new cf(g,c,!1,!1);v.isHidden()||(this.opacities[f]=v,o=o||g.text.placed||g.icon.placed)}}for(let f in h)this.variableOffsets[f]||!this.opacities[f]||this.opacities[f].isHidden()||(this.variableOffsets[f]=h[f]);for(let f in p)this.placedOrientations[f]||!this.opacities[f]||this.opacities[f].isHidden()||(this.placedOrientations[f]=p[f]);o?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=i?i.lastPlacementChangeTime:t)}updateLayerOpacities(t,i){let o=new Set;for(let c of i){let u=c.getBucket(t);u&&c.latestFeatureIndex&&t.fqid===u.layerIds[0]&&(this.updateBucketOpacities(u,o,c.collisionBoxArray),u.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(u,c.tileID),u.updateZOffset()))}}updateBucketOpacities(t,i,o){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();let c=t.layers[0].layout,u=!!t.layers[0].dynamicFilter(),h=new cf(null,0,!1,!1,!0),p=c.get("text-allow-overlap"),f=c.get("icon-allow-overlap"),g=c.get("text-variable-anchor"),v=c.get("text-rotation-alignment")==="map",y=c.get("text-pitch-alignment")==="map",b=new cf(null,0,p&&(f||!t.hasIconData()||c.get("icon-optional")),f&&(p||!t.hasTextData()||c.get("text-optional")),!0);!t.collisionArrays&&o&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(o);let x=(E,M,D)=>{for(let A=0;A<M/4;A++)E.opacityVertexArray.emplaceBack(D)},C=0;for(let E=0;E<t.symbolInstances.length;E++){let M=t.symbolInstances.get(E),{numHorizontalGlyphVertices:D,numVerticalGlyphVertices:A,crossTileID:P,numIconVertices:O}=M,R=i.has(P),F=this.opacities[P];R?F=h:F||(F=b,this.opacities[P]=F),i.add(P);let N=D>0||A>0,j=O>0,U=this.placedOrientations[P],G=U===Jn.vertical,Y=U===Jn.horizontal||U===Jn.horizontalOnly;if(!N&&!j||F.isHidden()||C++,N){let Z=lO(F.text);x(t.text,D,G?Y0:Z),x(t.text,A,Y?Y0:Z);let tt=F.text.isHidden(),{leftJustifiedTextSymbolIndex:$,centerJustifiedTextSymbolIndex:rt,rightJustifiedTextSymbolIndex:st,verticalPlacedTextSymbolIndex:pt}=M,nt=t.text.placedSymbolArray,ot=tt||G?1:0;$>=0&&(nt.get($).hidden=ot),rt>=0&&(nt.get(rt).hidden=ot),st>=0&&(nt.get(st).hidden=ot),pt>=0&&(nt.get(pt).hidden=tt||Y?1:0);let vt=this.variableOffsets[P];vt&&this.markUsedJustification(t,vt.anchor,M,U);let bt=this.placedOrientations[P];bt&&(this.markUsedJustification(t,"left",M,bt),this.markUsedOrientation(t,bt,M))}if(j){let Z=lO(F.icon),{placedIconSymbolIndex:tt,verticalPlacedIconSymbolIndex:$}=M,rt=t.icon.placedSymbolArray,st=F.icon.isHidden()?1:0;tt>=0&&(x(t.icon,O,G?Y0:Z),rt.get(tt).hidden=st),$>=0&&(x(t.icon,M.numVerticalIconVertices,Y?Y0:Z),rt.get($).hidden=st)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){let Z=t.collisionArrays[E];if(Z){let tt=new Q(0,0),$=!0;if(Z.textBox||Z.verticalTextBox){if(g){let st=this.variableOffsets[P];st?(tt=aO(st.anchor,st.width,st.height,st.textOffset,st.textScale),v&&tt._rotate(y?this.transform.angle:-this.transform.angle)):$=!1}u&&($=!F.clipped),Z.textBox&&$0(t.textCollisionBox.collisionVertexArray,F.text.placed,!$||G,tt.x,tt.y),Z.verticalTextBox&&$0(t.textCollisionBox.collisionVertexArray,F.text.placed,!$||Y,tt.x,tt.y)}let rt=$&&!!(!Y&&Z.verticalIconBox);Z.iconBox&&$0(t.iconCollisionBox.collisionVertexArray,F.icon.placed,rt,M.hasIconTextFit?tt.x:0,M.hasIconTextFit?tt.y:0),Z.verticalIconBox&&$0(t.iconCollisionBox.collisionVertexArray,F.icon.placed,!rt,M.hasIconTextFit?tt.x:0,M.hasIconTextFit?tt.y:0)}}}if(t.fullyClipped=C===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){let E=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=E.invProjMatrix,t.placementViewportMatrix=E.viewportMatrix,t.collisionCircleArray=E.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,i){let o=this.zoomAtLastRecencyCheck===i?1-this.zoomAdjustment(i):1;return this.zoomAtLastRecencyCheck=i,this.commitTime+this.fadeDuration*o>t}setStale(){this.stale=!0}}function $0(e,t,i,o,c){e.emplaceBack(t?1:0,i?1:0,o||0,c||0),e.emplaceBack(t?1:0,i?1:0,o||0,c||0),e.emplaceBack(t?1:0,i?1:0,o||0,c||0),e.emplaceBack(t?1:0,i?1:0,o||0,c||0)}let Sq=Math.pow(2,25),Eq=Math.pow(2,24),Mq=Math.pow(2,17),Dq=Math.pow(2,16),Tq=Math.pow(2,9),Iq=Math.pow(2,8),Aq=Math.pow(2,1);function lO(e){if(e.opacity===0&&!e.placed)return 0;if(e.opacity===1&&e.placed)return 4294967295;let t=e.placed?1:0,i=Math.floor(127*e.opacity);return i*Sq+t*Eq+i*Mq+t*Dq+i*Tq+t*Iq+i*Aq+t}let Y0=0;class kq{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,i,o,c,u){let h=this._bucketParts;for(;this._currentTileIndex<t.length;)if(i.getBucketParts(h,c,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,u())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,h.sort((p,f)=>p.sortKey-f.sortKey));this._currentPartIndex<h.length;){let p=h[this._currentPartIndex];if(i.placeLayerBucketPart(p,this._seenCrossTileIDs,o,p.symbolInstanceStart===0),this._currentPartIndex++,u())return!0}return!1}}class Rq{constructor(t,i,o,c,u,h,p,f,g){this.placement=new Cq(t,u,h,p,f,g),this._currentPlacementIndex=i.length-1,this._forceFullPlacement=o,this._showCollisionBoxes=c,this._done=!1}isDone(){return this._done}continuePlacement(t,i,o,c){let u=ii.now(),h=()=>{let p=ii.now()-u;return!this._forceFullPlacement&&p>2};for(;this._currentPlacementIndex>=0;){let p=i[t[this._currentPlacementIndex]],f=this.placement.collisionIndex.transform.zoom;if(p.type==="symbol"&&(!p.minzoom||p.minzoom<=f)&&(!p.maxzoom||p.maxzoom>f)){let g=p,v=g.layout.get("symbol-z-elevate"),y=this._inProgressLayer=this._inProgressLayer||new kq(g),b=Xo(p.source,p.scope);if(y.continuePlacement(v?c[b]:o[b],this.placement,this._showCollisionBoxes,p,h))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}let cO=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Z0{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[i,o]=new Uint8Array(t,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");let c=o>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);let u=cO[15&o];if(!u)throw new Error("Unrecognized array type.");let[h]=new Uint16Array(t,2,1),[p]=new Uint32Array(t,4,1);return new Z0(p,h,u,t)}constructor(t,i=64,o=Float64Array,c){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;let u=cO.indexOf(this.ArrayType),h=2*t*this.ArrayType.BYTES_PER_ELEMENT,p=t*this.IndexArrayType.BYTES_PER_ELEMENT,f=(8-p%8)%8;if(u<0)throw new Error(`Unexpected typed array class: ${o}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+p+f,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+h+p+f),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+p+f,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+u]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=t)}add(t,i){let o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=i,o}finish(){let t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return tS(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,i,o,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:u,coords:h,nodeSize:p}=this,f=[0,u.length-1,0],g=[];for(;f.length;){let v=f.pop()||0,y=f.pop()||0,b=f.pop()||0;if(y-b<=p){for(let M=b;M<=y;M++){let D=h[2*M],A=h[2*M+1];D>=t&&D<=o&&A>=i&&A<=c&&g.push(u[M])}continue}let x=b+y>>1,C=h[2*x],E=h[2*x+1];C>=t&&C<=o&&E>=i&&E<=c&&g.push(u[x]),(v===0?t<=C:i<=E)&&(f.push(b),f.push(x-1),f.push(1-v)),(v===0?o>=C:c>=E)&&(f.push(x+1),f.push(y),f.push(1-v))}return g}within(t,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:c,coords:u,nodeSize:h}=this,p=[0,c.length-1,0],f=[],g=o*o;for(;p.length;){let v=p.pop()||0,y=p.pop()||0,b=p.pop()||0;if(y-b<=h){for(let M=b;M<=y;M++)uO(u[2*M],u[2*M+1],t,i)<=g&&f.push(c[M]);continue}let x=b+y>>1,C=u[2*x],E=u[2*x+1];uO(C,E,t,i)<=g&&f.push(c[x]),(v===0?t-o<=C:i-o<=E)&&(p.push(b),p.push(x-1),p.push(1-v)),(v===0?t+o>=C:i+o>=E)&&(p.push(x+1),p.push(y),p.push(1-v))}return f}}function tS(e,t,i,o,c,u){if(c-o<=i)return;let h=o+c>>1;dO(e,t,h,o,c,u),tS(e,t,i,o,h-1,1-u),tS(e,t,i,h+1,c,1-u)}function dO(e,t,i,o,c,u){for(;c>o;){if(c-o>600){let g=c-o+1,v=i-o+1,y=Math.log(g),b=.5*Math.exp(2*y/3),x=.5*Math.sqrt(y*b*(g-b)/g)*(v-g/2<0?-1:1);dO(e,t,i,Math.max(o,Math.floor(i-v*b/g+x)),Math.min(c,Math.floor(i+(g-v)*b/g+x)),u)}let h=t[2*i+u],p=o,f=c;for(df(e,t,o,i),t[2*c+u]>h&&df(e,t,o,c);p<f;){for(df(e,t,p,f),p++,f--;t[2*p+u]<h;)p++;for(;t[2*f+u]>h;)f--}t[2*o+u]===h?df(e,t,o,f):(f++,df(e,t,f,c)),f<=i&&(o=f+1),i<=f&&(c=f-1)}}function df(e,t,i,o){eS(e,i,o),eS(t,2*i,2*o),eS(t,2*i+1,2*o+1)}function eS(e,t,i){let o=e[t];e[t]=e[i],e[i]=o}function uO(e,t,i,o){let c=e-i,u=t-o;return c*c+u*u}let iS=512/wt/2;class Pq{constructor(t,i,o){this.tileID=t,this.bucketInstanceId=o,this.index=new Z0(i.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let c=t.canonical.x*wt,u=t.canonical.y*wt;for(let h=0;h<i.length;h++){let{key:p,crossTileID:f,tileAnchorX:g,tileAnchorY:v}=i.get(h),y=Math.floor((c+g)*iS),b=Math.floor((u+v)*iS);this.index.add(y,b),this.keys.push(p),this.crossTileIDs.push(f)}this.index.finish()}findMatches(t,i,o){let c=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z),u=iS/Math.pow(2,i.canonical.z-this.tileID.canonical.z),h=i.canonical.x*wt,p=i.canonical.y*wt;for(let f=0;f<t.length;f++){let g=t.get(f);if(g.crossTileID)continue;let{key:v,tileAnchorX:y,tileAnchorY:b}=g,x=Math.floor((h+y)*u),C=Math.floor((p+b)*u),E=this.index.range(x-c,C-c,x+c,C+c);for(let M of E){let D=this.crossTileIDs[M];if(this.keys[M]===v&&!o.has(D)){o.add(D),g.crossTileID=D;break}}}}}class Oq{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Fq{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){let i=Math.round((t-this.lng)/360);if(i!==0)for(let o in this.indexes){let c=this.indexes[o],u={};for(let h in c){let p=c[h];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+i),u[p.tileID.key]=p}this.indexes[o]=u}this.lng=t}addBucket(t,i,o){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===i.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let u=0;u<i.symbolInstances.length;u++)i.symbolInstances.get(u).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);let c=this.usedCrossTileIDs[t.overscaledZ];for(let u in this.indexes){let h=this.indexes[u];if(Number(u)>t.overscaledZ)for(let p in h){let f=h[p];f.tileID.isChildOf(t)&&f.findMatches(i.symbolInstances,t,c)}else{let p=h[t.scaledTo(Number(u)).key];p&&p.findMatches(i.symbolInstances,t,c)}}for(let u=0;u<i.symbolInstances.length;u++){let h=i.symbolInstances.get(u);h.crossTileID||(h.crossTileID=o.generate(),c.add(h.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Pq(t,i.symbolInstances,i.bucketInstanceId),!0}removeBucketCrossTileIDs(t,i){for(let o of i.crossTileIDs)this.usedCrossTileIDs[t].delete(o)}removeStaleBuckets(t){let i=!1;for(let o in this.indexes){let c=this.indexes[o];for(let u in c)t[c[u].bucketInstanceId]||(this.removeBucketCrossTileIDs(o,c[u]),delete c[u],i=!0)}return i}}class Lq{constructor(){this.layerIndexes={},this.crossTileIDs=new Oq,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,i,o,c){let u=this.layerIndexes[t.fqid];u===void 0&&(u=this.layerIndexes[t.fqid]=new Fq);let h=!1,p={};c.name!=="globe"&&u.handleWrapJump(o);for(let f of i){let g=f.getBucket(t);g&&t.fqid===g.layerIds[0]&&(g.bucketInstanceId||(g.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(f.tileID,g,this.crossTileIDs)&&(h=!0),p[g.bucketInstanceId]=!0)}return u.removeStaleBuckets(p)&&(h=!0),h}pruneUnusedLayers(t){let i={};t.forEach(o=>{i[o]=!0});for(let o in this.layerIndexes)i[o]||delete this.layerIndexes[o]}}var hO=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w-0.0001;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,mO="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",pO=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,fO=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,gO=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,_O=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);vec4 _raTexLinearCoord(vec2 texCoord,vec2 texResolution,out vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return (texCoord.xxyy+vec2(1.5,0.5).xyxy)/texResolution.xxyy;}vec2 _raTexLinearMix(vec2 fxy,vec4 colorMix,float colorOffset,vec4 t00,vec4 t10,vec4 t01,vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image0,c.yz),texture(u_image0,c.xz),texture(u_image0,c.yw),texture(u_image0,c.xw)
);}vec2 raTexture2D_image1_linear(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image1,c.yz),texture(u_image1,c.xz),texture(u_image1,c.yw),texture(u_image1,c.xw)
);}vec2 raTexture2D_image0_nearest(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec4 t=texture(u_image0,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec4 t=texture(u_image1,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,vO=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,yO=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let bO=[];Q0(hO,bO);let X0={"_prelude_fog.vertex.glsl":fO,"_prelude_terrain.vertex.glsl":pO,"_prelude_shadow.vertex.glsl":vO,"_prelude_fog.fragment.glsl":gO,"_prelude_shadow.fragment.glsl":yO,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":_O},K0={};on("",pO),on(gO,fO),on(yO,vO),on(_O,"");let xO=on(`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif`,`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`),wO=hO;var CO={background:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:on("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:on(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:on(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:on("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:on("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:on("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in vec2 v_pos;in vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;out vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#ifdef RENDER_CUTOFF
invariant gl_Position;
#endif
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),fillExtrusionDepth:on(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:on(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:on(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;HANDLE_WIREFRAME_DEBUG;
#endif
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;
#ifdef FORCE_ABS_FL_GROUND_RADIUS
fl_ground_radius=abs(flood_light_ground_radius);
#endif
float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:on(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform vec4 u_tl_br;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#elif defined(PROJECTION_GLOBE_VIEW)
in vec2 a_pos;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec2 globe_tl=vec2(u_tl_br.x,u_tl_br.y);vec2 globe_br=vec2(u_tl_br.z,u_tl_br.w);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=1.0-((mercatorY-globe_br.y)/(globe_tl.y-globe_br.y));float mercatorX=mercatorXfromLng(latLng[1]);float uvX=(mercatorX-globe_br.x)/(globe_tl.x-globe_br.x);vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);uv=vec2(uvX,uvY);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
uv=a_texture_pos/8192.0;
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),symbolIcon:on(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
uniform mediump float u_icon_saturation;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;
#else
out_color=texture(u_texture,v_tex_a)*alpha;
#endif
#ifdef SATURATION
vec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:on(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:on(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:on("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:on(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,mO),skyboxGradient:on(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,mO),skyboxCapture:on(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:on(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:on(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
texColor.rgb=sRGBToLinear(texColor.rgb);if(u_baseTextureIsAlpha) {if (texColor.w < 0.5) {discard;}albedo*=mix(vec4(texColor.rgb,texColor.a),vec4(texColor.a),float(u_baseTextureIsAlpha));} else {albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 diffuse=getDiffuseShadedColor(getBaseColor().rgb,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(diffuse,1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
ao=(texture(u_occlusionTexture,uv_2f).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=local_pos;
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:on(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:on(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function Q0(e,t){let i=e.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let o of i)if(o=o.trim(),o[0]==="#"&&o.includes("if")&&!o.includes("endif")){o=o.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let c=o.split(" ");for(let u of c)t.includes(u)||t.push(u)}}function on(e,t){let i=/#include\s+"([^"]+)"/g,o=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,c=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);c&&(c=c.map(g=>{let v=g.split(" ");return v[v.length-1]}),c=[...new Set(c)]);let u={},h=[],p=[];e=e.replace(i,(g,v)=>(p.push(v),"")),t=t.replace(i,(g,v)=>(h.push(v),""));let f=[...bO];Q0(e,f),Q0(t,f);for(let g of[...h,...p])X0[g]||console.error(`Undefined include: ${g}`),K0[g]||(K0[g]=[],Q0(X0[g],K0[g])),f=[...f,...K0[g]];return{fragmentSource:e=e.replace(o,(g,v,y,b,x)=>(u[x]=!0,v==="define"?`
#ifndef HAS_UNIFORM_u_${x}
in ${y} ${b} ${x};
#else
uniform ${y} ${b} u_${x};
#endif
`:v==="initialize"?`
#ifdef HAS_UNIFORM_u_${x}
    ${y} ${b} ${x} = u_${x};
#endif
`:v==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${x}
    in ${y} ${b} ${x};
#endif
`:v==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(o,(g,v,y,b,x)=>{let C=b==="float"?"vec2":b,E=x.match(/color/)?"color":C;return v==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${x}
in ${y} ${b} a_${x};
#endif
`:u[x]?v==="define"?`
#ifndef HAS_UNIFORM_u_${x}
uniform lowp float u_${x}_t;
in ${y} ${C} a_${x};
out ${y} ${b} ${x};
#else
uniform ${y} ${b} u_${x};
#endif
`:v==="initialize"?E==="vec4"?`
#ifndef HAS_UNIFORM_u_${x}
    ${x} = a_${x};
#else
    ${y} ${b} ${x} = u_${x};
#endif
`:`
#ifndef HAS_UNIFORM_u_${x}
    ${x} = unpack_mix_${E}(a_${x}, u_${x}_t);
#else
    ${y} ${b} ${x} = u_${x};
#endif
`:v==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${x}
    in ${y} ${b} a_${x};
    out ${y} ${b} ${x};
#endif
`:v==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${x}
    ${x} = a_${x};
#endif
`:void 0:v==="define"?`
#ifndef HAS_UNIFORM_u_${x}
uniform lowp float u_${x}_t;
in ${y} ${C} a_${x};
#else
uniform ${y} ${b} u_${x};
#endif
`:v==="define-instanced"?E==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${x}0;
in vec4 a_${x}1;
in vec4 a_${x}2;
in vec4 a_${x}3;
#else
uniform ${y} ${b} u_${x};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${y} ${C} a_${x};
#else
uniform ${y} ${b} u_${x};
#endif
`:v==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${x}
    ${y} ${b} ${x} = a_${x};
#endif
`:E==="vec4"?`
#ifndef HAS_UNIFORM_u_${x}
    ${y} ${b} ${x} = a_${x};
#else
    ${y} ${b} ${x} = u_${x};
#endif
`:`
#ifndef HAS_UNIFORM_u_${x}
    ${y} ${b} ${x} = unpack_mix_${E}(a_${x}, u_${x}_t);
#else
    ${y} ${b} ${x} = u_${x};
#endif
`}),staticAttributes:c,usedDefines:f,vertexIncludes:h,fragmentIncludes:p}}class zq{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,i,o,c,u,h,p,f){this.context=t;let g=this.boundPaintVertexBuffers.length!==c.length;for(let y=0;!g&&y<c.length;y++)this.boundPaintVertexBuffers[y]!==c[y]&&(g=!0);let v=this.boundDynamicVertexBuffers.length!==p.length;for(let y=0;!v&&y<p.length;y++)this.boundDynamicVertexBuffers[y]!==p[y]&&(v=!0);if(!this.vao||this.boundProgram!==i||this.boundLayoutVertexBuffer!==o||g||v||this.boundIndexBuffer!==u||this.boundVertexOffset!==h)this.freshBind(i,o,c,u,h,p,f);else{t.bindVertexArrayOES.set(this.vao);for(let y of p)y&&(y.bind(),f&&y.instanceCount&&y.setVertexAttribDivisor(t.gl,i,f));u&&u.dynamicDraw&&u.bind()}}freshBind(t,i,o,c,u,h,p){let f=t.numAttributes,g=this.context,v=g.gl;this.vao&&this.destroy(),this.vao=g.gl.createVertexArray(),g.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=i,this.boundPaintVertexBuffers=o,this.boundIndexBuffer=c,this.boundVertexOffset=u,this.boundDynamicVertexBuffers=h,i.enableAttributes(v,t),i.bind(),i.setVertexAttribPointers(v,t,u);for(let y of o)y.enableAttributes(v,t),y.bind(),y.setVertexAttribPointers(v,t,u);for(let y of h)y&&(y.enableAttributes(v,t),y.bind(),y.setVertexAttribPointers(v,t,u),p&&y.instanceCount&&y.setVertexAttribDivisor(v,t,p));c&&c.bind(),g.currentNumAttributes=f}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Nq(e,t){let i=Math.pow(2,t.canonical.z),o=t.canonical.y;return[new Fi(0,o/i).toLngLat().lat,new Fi(0,(o+1)/i).toLngLat().lat]}function Bq(e,t,i,o,c,u,h){let p=e.context,f=p.gl,g=i.hillshadeFBO;if(!g)return;e.prepareDrawTile();let v=e.isTileAffectedByFog(t),y=e.getOrCreateProgram("hillshade",{overrideFog:v});p.activeTexture.set(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,g.colorAttachment.get());let b=((M,D,A,P)=>{let O=A.paint.get("hillshade-shadow-color"),R=A.paint.get("hillshade-highlight-color"),F=A.paint.get("hillshade-accent-color"),N=A.paint.get("hillshade-emissive-strength"),j=fe(A.paint.get("hillshade-illumination-direction"));if(A.paint.get("hillshade-illumination-anchor")==="viewport")j-=M.transform.angle;else if(M.style&&M.style.enable3dLights()&&M.style.directionalLight){let G=M.style.directionalLight.properties.get("direction");j=fe(Ae(G.x,G.y,G.z)[1])}let U=!M.options.moving;return{u_matrix:P||M.transform.calculateProjMatrix(D.tileID.toUnwrapped(),U),u_image:0,u_latrange:Nq(0,D.tileID),u_light:[A.paint.get("hillshade-exaggeration"),j],u_shadow:O,u_highlight:R,u_emissive_strength:N,u_accent:F}})(e,i,o,e.terrain?t.projMatrix:null);e.uploadCommonUniforms(p,y,t.toUnwrapped());let{tileBoundsBuffer:x,tileBoundsIndexBuffer:C,tileBoundsSegments:E}=e.getTileBoundsBuffers(i);y.draw(e,f.TRIANGLES,c,u,h,bi.disabled,b,o.id,x,C,E)}function SO(e,t,i){if(!t.needsDEMTextureUpload)return;let o=e.context,c=o.gl;o.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||e.getTileTexture(i.stride);let u=i.getPixels();t.demTexture?t.demTexture.update(u,{premultiply:!1}):t.demTexture=new or(o,u,c.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Vq(e,t,i){let o=e.context,c=o.gl;if(!t.dem)return;let u=t.dem;if(o.activeTexture.set(c.TEXTURE1),SO(e,t,u),!t.demTexture)return;t.demTexture.bind(c.NEAREST,c.CLAMP_TO_EDGE);let h=u.dim;o.activeTexture.set(c.TEXTURE0);let p=t.hillshadeFBO;if(!p){let b=new or(o,{width:h,height:h,data:null},c.RGBA);b.bind(c.LINEAR,c.CLAMP_TO_EDGE),p=t.hillshadeFBO=o.createFramebuffer(h,h,!0,"renderbuffer"),p.colorAttachment.set(b.texture)}o.bindFramebuffer.set(p.framebuffer),o.viewport.set([0,0,h,h]);let{tileBoundsBuffer:f,tileBoundsIndexBuffer:g,tileBoundsSegments:v}=e.getMercatorTileBoundsBuffers(),y=[];e.linearFloatFilteringSupported()&&y.push("TERRAIN_DEM_FLOAT_FORMAT"),e.getOrCreateProgram("hillshadePrepare",{defines:y}).draw(e,c.TRIANGLES,He.disabled,vi.disabled,Gi.unblended,bi.disabled,((b,x)=>{let C=x.stride,E=ft.create();return ft.ortho(E,0,wt,-wt,0,0,1),ft.translate(E,E,[0,-wt,0]),{u_matrix:E,u_image:1,u_dimension:[C,C],u_zoom:b.overscaledZ}})(t.tileID,u),i.id,f,g,v),t.needsHillshadePrepare=!1}let EO=e=>({u_matrix:new si(e),u_image0:new wi(e),u_skirt_height:new Bt(e),u_ground_shadow_factor:new di(e)}),MO=(e,t,i)=>({u_matrix:e,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:i}),DO=(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(o),u_merc_matrix:i,u_zoom_transition:c,u_merc_center:u,u_image0:0,u_frustum_tl:h,u_frustum_tr:p,u_frustum_br:f,u_frustum_bl:g,u_globe_pos:v,u_globe_radius:y,u_viewport:b,u_grid_matrix:C?Float32Array.from(C):new Float32Array(9),u_skirt_height:x}),Nh=(e,t)=>{if(t>0&&e.terrain&&lt("Cutoff is currently disabled on terrain"),t<=0||e.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,0]}};let i=e.transform,o=Math.max(Math.abs(i._zoom-(e.minCutoffZoom-1)),1),c=i.isLODDisabled(!1)?Wo(60,45,i.pitch):Wo(30,15,i.pitch),u=i._farZ-i._nearZ,h=t*i.height,p=((1-(f=c))*(.75*i.cameraToCenterDistance)+f*(i._farZ+h))*o;var f;return{shouldRenderCutoff:c<1,uniformValues:{u_cutoff_params:[i._nearZ,i._farZ,(p-i._nearZ)/u,(p-h-i._nearZ)/u]}}};function TO(e,t){return e!=null&&t!=null&&!(!e.hasData()||!t.hasData())&&e.demTexture!=null&&t.demTexture!=null&&e.tileID.key!==t.tileID.key}let Bh=new class{constructor(){this.operations={}}newMorphing(e,t,i,o,c){if(e in this.operations){let u=this.operations[e];u.to.tileID.key!==i.tileID.key&&(u.queued=i)}else this.operations[e]={startTime:o,phase:0,duration:c,from:t,to:i,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;let t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(let t in this.operations){let i=this.operations[t];for(i.phase=(e-i.startTime)/i.duration;i.phase>=1||!this._validOp(i);)if(!this._nextOp(i,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},IO={0:null,1:"TERRAIN_VERTEX_MORPHING"};function AO(e,t,i){if(t===0)return 0;let o=t<1&&i===514?.25/t:1;return 6*Math.pow(1.5,22-e)*Math.max(t,1)*o}function jq(e,t){let i=1<<e.z;return!t&&(e.x===0||e.x===i-1)||e.y===0||e.y===i-1}let nS=e=>({u_matrix:e});function kO(e,t,i,o,c){if(c>0){let u=ii.now(),h=(u-e.timeAdded)/c,p=t?(u-t.timeAdded)/c:-1,f=i.getSource(),g=o.coveringZoomLevel({tileSize:f.tileSize,roundZoom:f.roundZoom}),v=!t||Math.abs(t.tileID.overscaledZ-g)>Math.abs(e.tileID.overscaledZ-g),y=v&&e.refreshedUponExpiration?1:ve(v?h:1-p,0,1);return e.refreshedUponExpiration&&h>=1&&(e.refreshedUponExpiration=!1),t?{opacity:1,mix:1-y}:{opacity:y,mix:0}}return{opacity:1,mix:0}}class Uq extends tl{constructor(t){let i={type:"raster-dem",maxzoom:t.transform.maxZoom},o=new j0(lf(),null),c=ZC("mock-dem",i,o,t.style);super("mock-dem",c,!1),c.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,i){t.state="loaded",i(null)}}class Hq extends tl{constructor(t){let i=ZC("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new j0(lf(),null),t.style);super("proxy",i,!1),i.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,i,o){if(t.freezeTileCoverage)return;this.transform=t;let c=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((u,h)=>{if(u[h.key]="",!this._tiles[h.key]){let p=new Xp(h,this._source.tileSize*h.overscaleFactor(),t.tileZoom);p.state="loaded",this._tiles[h.key]=p}return u},{});for(let u in this._tiles)u in c||(this.freeFBO(u),this._tiles[u].unloadVectorData(),delete this._tiles[u])}freeFBO(t){let i=this.proxyCachedFBO[t];if(i!==void 0){let o=Object.values(i);this.renderCachePool.push(...o),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class RO extends $i{constructor(t,i,o){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=i,this.projMatrix=o}}class Gq extends w8{constructor(t,i){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[o,c,u]=function(f){let g=new Cs,v=new qr,y=131;g.reserve(17161),v.reserve(33800);let b=wt/128,x=wt+b/2,C=x+b;for(let M=-b;M<C;M+=b)for(let D=-b;D<C;D+=b){let A=D<0||D>x||M<0||M>x?24575:0,P=ve(Math.round(D),0,wt),O=ve(Math.round(M),0,wt);g.emplaceBack(P+A,O)}let E=(M,D)=>{let A=D*y+M;v.emplaceBack(A+1,A,A+y),v.emplaceBack(A+y,A+y+1,A+1)};for(let M=1;M<129;M++)for(let D=1;D<129;D++)E(D,M);return[0,129].forEach(M=>{for(let D=0;D<130;D++)E(D,M),E(M,D)}),[g,v,32768]}(),h=t.context;this.gridBuffer=h.createVertexBuffer(o,Kc.members),this.gridIndexBuffer=h.createIndexBuffer(c),this.gridSegments=un.simpleSegment(0,0,o.length,c.length),this.gridNoSkirtSegments=un.simpleSegment(0,0,o.length,u),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Hq(i.map),this.orthoMatrix=ft.create(),ft.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,wt,0,wt,0,1);let p=h.gl;this._overlapStencilMode=new vi({func:p.GEQUAL,mask:255},0,255,p.KEEP,p.KEEP,p.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=i,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Uq(i.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,i,o){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);let c=t.terrain.properties,u=t.terrain.drapeRenderMode===0,h=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=ii.now();let p=t.terrain&&t.terrain.scope,f=c.get("source"),g=u?this._mockSourceCache:t.getSourceCache(f,p);if(!g)return void lt(`Couldn't find terrain source "${f}".`);if(this.sourceCache=g,this._exaggeration=h?this.calculateExaggeration(i):c.get("exaggeration"),!i.projection.requiresDraping&&h&&this._exaggeration===0)return void this._disable();this.enabled=!0;let v=()=>{this.sourceCache.used&&lt(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let y=this.getScaledDemTileSize();this.sourceCache.update(i,y,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,v(),this._initializing=!0),v(),i.updateElevation(!0,o),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(i),this._emptyDEMTextureDirty=!0,this._previousZoom=i.zoom}else this._disable()}calculateExaggeration(t){let i=this._previousCameraAltitude,o=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=o;let c=i!=null?o-i:Number.MAX_VALUE;if(Math.abs(c)<2)return this._exaggeration;let u=t.zoom,h=this._style.terrain;if(!this._previousUpdateTimestamp)return h.getExaggeration(u);let p=u-this._previousZoom,f=this._previousUpdateTimestamp,g=u;this._evaluationZoom!=null&&(g=this._evaluationZoom,Math.abs(u-g)>.5&&(p=.5*(u-g+p)),p*c<0&&(g+=p)),this._evaluationZoom=g;let v=h.getExaggeration(g),y=v===h.getExaggeration(Math.max(0,g-.1));if(y&&Math.abs(v-this._exaggeration)<.01)return v;let b=Math.min(.1,.00375*(this._updateTimestamp-f));return(y||v<.1||Math.abs(p)<1e-4)&&(b=Math.min(.2,4*b)),Ye(this._exaggeration,v,b)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let i=this.proxySourceCache,o=this.painter.transform;this._initializing&&(this._initializing=o._centerAltitude===0&&this.getAtPointOrZero(Fi.fromLngLat(o.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let c=this.proxyCoords=i.getIds().map(f=>{let g=i.getTileByID(f).tileID;return g.projMatrix=o.calculateProjMatrix(g.toUnwrapped()),g});(function(f,g){let v=g.transform.pointCoordinate(g.transform.getCameraPoint()),y=new Q(v.x,v.y);f.sort((b,x)=>{if(x.overscaledZ-b.overscaledZ)return x.overscaledZ-b.overscaledZ;let C=new Q(b.canonical.x+(1<<b.canonical.z)*b.wrap,b.canonical.y),E=new Q(x.canonical.x+(1<<x.canonical.z)*x.wrap,x.canonical.y),M=y.mult(1<<b.canonical.z);return M.x-=.5,M.y-=.5,M.distSqr(C)-M.distSqr(E)})})(c,this.painter);let u=this.proxyToSource||{};this.proxyToSource={},c.forEach(f=>{this.proxyToSource[f.key]={}}),this.terrainTileForTile={};let h=this._style._mergedSourceCaches;for(let f in h){let g=h[f];if(!g.used||(g!==this.sourceCache&&this.resetTileLookupCache(g.id),this._setupProxiedCoordsForOrtho(g,t[f],u),g.usedForTerrain))continue;let v=t[f];g.getSource().reparseOverscaled&&this._assignTerrainTiles(v)}this.proxiedCoords[i.id]=c.map(f=>new RO(f,f.key,this.orthoMatrix)),this._assignTerrainTiles(c),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(u),this.renderingToTexture=!1;let p={};this._visibleDemTiles=[];for(let f of this.proxyCoords){let g=this.terrainTileForTile[f.key];if(!g)continue;let v=g.tileID.key;v in p||(this._visibleDemTiles.push(g),p[v]=v)}}_assignTerrainTiles(t){this._initializing||t.forEach(i=>{if(this.terrainTileForTile[i.key])return;let o=this._findTileCoveringTileID(i,this.sourceCache);o&&(this.terrainTileForTile[i.key]=o)})}_prepareDEMTextures(){let t=this.painter.context,i=t.gl;for(let o in this.terrainTileForTile){let c=this.terrainTileForTile[o],u=c.dem;!u||c.demTexture&&!c.needsDEMTextureUpload||(t.activeTexture.set(i.TEXTURE1),SO(this.painter,c,u))}}_prepareDemTileUniforms(t,i,o,c){if(!i||i.demTexture==null)return!1;let u=t.tileID.canonical,h=Math.pow(2,i.tileID.canonical.z-u.z),p=c||"";return o[`u_dem_tl${p}`]=[u.x*h%1,u.y*h%1],o[`u_dem_scale${p}`]=h,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let t=this.painter.context,i=t.gl;if(!this._emptyDepthBufferTexture){let o=new Br({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new or(t,o,i.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let t=0,i=this._visibleDemTiles.reduce((o,c)=>{if(!c.dem)return o;let u=c.dem.tree.minimums[0];return u>0&&t++,o+u},0);return t?i/t:0}_updateEmptyDEMTexture(){let t=this.painter.context,i=t.gl;t.activeTexture.set(i.TEXTURE2);let o=this._getLoadedAreaMinimum(),[c,u]=(()=>{let p=new wk({width:1,height:1},new Float32Array([o]));return[i.R32F,p]})();this._emptyDEMTextureDirty=!1;let h=this._emptyDEMTexture;return h?h.update(u,{premultiply:!1}):h=this._emptyDEMTexture=new or(t,u,c,{premultiply:!1}),h}setupElevationDraw(t,i,o){let c=this.painter.context,u=c.gl,h={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};h.u_exaggeration=this.exaggeration();let p=null,f=null,g=1;if(o&&o.morphing&&this._useVertexMorphing){let b=o.morphing.srcDemTile,x=o.morphing.dstDemTile;g=o.morphing.phase,b&&x&&(this._prepareDemTileUniforms(t,b,h,"_prev")&&(f=b),this._prepareDemTileUniforms(t,x,h)&&(p=x))}let v=b=>b&&b.demTexture&&this.painter.linearFloatFilteringSupported()?u.LINEAR:u.NEAREST,y=b=>{h.u_dem_size=b.size[0]===1?1:b.size[0]-2};if(f&&p)c.activeTexture.set(u.TEXTURE2),p.demTexture.bind(v(p),u.CLAMP_TO_EDGE),c.activeTexture.set(u.TEXTURE4),f.demTexture.bind(v(f),u.CLAMP_TO_EDGE),p.demTexture&&y(p.demTexture),h.u_dem_lerp=g;else{p=this.terrainTileForTile[t.tileID.key],c.activeTexture.set(u.TEXTURE2);let b=this._prepareDemTileUniforms(t,p,h)?p.demTexture:this.emptyDEMTexture;b.bind(v(p),u.CLAMP_TO_EDGE),y(b)}if(c.activeTexture.set(u.TEXTURE3),o&&o.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(u.NEAREST,u.CLAMP_TO_EDGE),this._depthFBO&&(h.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(u.NEAREST,u.CLAMP_TO_EDGE),h.u_depth_size_inv=[1,1]),o&&o.useMeterToDem&&p){let b=(1<<p.tileID.canonical.z)*yn(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;h.u_meter_to_dem=b}if(o&&o.labelPlaneMatrixInv&&(h.u_label_plane_matrix_inv=o.labelPlaneMatrixInv),i.setTerrainUniformValues(c,h),this.painter.transform.projection.name==="globe"){let b=this.globeUniformValues(this.painter.transform,t.tileID.canonical,o&&o.useDenormalizedUpVectorScale);i.setGlobeUniformValues(c,b)}}globeUniformValues(t,i,o){let c=t.projection;return{u_tile_tl_up:c.upVector(i,0,0),u_tile_tr_up:c.upVector(i,wt,0),u_tile_br_up:c.upVector(i,wt,wt),u_tile_bl_up:c.upVector(i,0,wt),u_tile_up_scale:o?G_(1):c.upVectorScale(i,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){let i=this.painter,o=this.painter.context;t.length!==0&&(o.bindFramebuffer.set(null),o.viewport.set([0,0,i.width,i.height]),i.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(c,u,h,p,f){if(c.transform.projection.name==="globe")(function(g,v,y,b,x){let C=g.context,E=C.gl,M,D,A=g.transform,P=tk(g,C,A),O=(tt,$)=>{if(D===$)return;let rt=[IO[$],"PROJECTION_GLOBE_VIEW"];P&&rt.push("CUSTOM_ANTIALIASING");let st=g.isTileAffectedByFog(tt);M=g.getOrCreateProgram("globeRaster",{defines:rt,overrideFog:st}),D=$},R=g.colorModeForRenderPass(),F=new He(E.LEQUAL,He.ReadWrite,g.depthRangeFor3D);Bh.update(x);let N=QA(A),j=[eo(A.center.lng),uo(A.center.lat)],U=g.globeSharedBuffers,G=[A.width*ii.devicePixelRatio,A.height*ii.devicePixelRatio],Y=Float32Array.from(A.globeMatrix),Z={useDenormalizedUpVectorScale:!0};{let tt=g.transform,$=AO(tt.zoom,v.exaggeration(),v.sourceCache._source.tileSize);D=-1;let rt=E.TRIANGLES;for(let st of b){let pt=y.getTile(st),nt=vi.disabled,ot=v.prevTerrainTileForTile[st.key],vt=v.terrainTileForTile[st.key];TO(ot,vt)&&Bh.newMorphing(st.key,ot,vt,x,250),C.activeTexture.set(E.TEXTURE0),pt.texture&&pt.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE);let bt=Bh.getMorphValuesForProxy(st.key),yt=bt?1:0;bt&&ic(Z,{morphing:{srcDemTile:bt.from,dstDemTile:bt.to,phase:Dr(bt.phase)}});let Ct=q_(st.canonical),Et=uU(Ct.getCenter().lat),It=ek(st.canonical,Ct,Et,tt.worldSize/tt._pixelsPerMercatorPixel),xt=Jc(Zs(st.canonical)),Ft=DO(tt.expandedFarZProjMatrix,Y,N,xt,Co(tt.zoom),j,tt.frustumCorners.TL,tt.frustumCorners.TR,tt.frustumCorners.BR,tt.frustumCorners.BL,tt.globeCenterInViewSpace,tt.globeRadius,G,$,It);if(O(st,yt),M&&(v.setupElevationDraw(pt,M,Z),g.uploadCommonUniforms(C,M,st.toUnwrapped()),U)){let[te,ee,de]=U.getGridBuffers(Et,$!==0);M.draw(g,rt,F,nt,R,bi.backCCW,Ft,"globe_raster",te,ee,de)}}}if(U&&(g.renderDefaultNorthPole||g.renderDefaultSouthPole)){let tt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];P&&tt.push("CUSTOM_ANTIALIASING"),M=g.getOrCreateProgram("globeRaster",{defines:tt});for(let $ of b){let{x:rt,y:st,z:pt}=$.canonical,nt=st===0,ot=st===(1<<pt)-1,[vt,bt,yt,Ct]=U.getPoleBuffers(pt,!1);if(Ct&&(nt||ot)){let Et=y.getTile($);C.activeTexture.set(E.TEXTURE0),Et.texture&&Et.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE);let It=JA(pt,rt,A),xt=Jc(Zs($.canonical)),Ft=(te,ee)=>te.draw(g,E.TRIANGLES,F,vi.disabled,R,bi.disabled,DO(A.expandedFarZProjMatrix,It,It,xt,0,j,A.frustumCorners.TL,A.frustumCorners.TR,A.frustumCorners.BR,A.frustumCorners.BL,A.globeCenterInViewSpace,A.globeRadius,G,0),"globe_pole_raster",ee,yt,Ct);v.setupElevationDraw(Et,M,Z),g.uploadCommonUniforms(C,M,$.toUnwrapped()),nt&&g.renderDefaultNorthPole&&Ft(M,vt),ot&&g.renderDefaultSouthPole&&(It=ft.scale(ft.create(),It,[1,-1,1]),Ft(M,bt))}}}})(c,u,h,p,f);else{let g=c.context,v=g.gl,y,b,x=c.shadowRenderer,C=Nh(c,c.longestCutoffRange),E=R=>{if(b===R)return;let F=[];F.push(IO[R]),C.shouldRenderCutoff&&F.push("RENDER_CUTOFF"),y=c.getOrCreateProgram("terrainRaster",{defines:F}),b=R},M=c.colorModeForRenderPass(),D=new He(v.LEQUAL,He.ReadWrite,c.depthRangeFor3D);Bh.update(f);let A=c.transform,P=AO(A.zoom,u.exaggeration(),u.sourceCache._source.tileSize),O=[0,0,0];if(x){let R=c.style.directionalLight,F=c.style.ambientLight;R&&F&&(O=lS(R,F))}{b=-1;let R=v.TRIANGLES,[F,N]=[u.gridIndexBuffer,u.gridSegments];for(let j of p){let U=h.getTile(j),G=vi.disabled,Y=u.prevTerrainTileForTile[j.key],Z=u.terrainTileForTile[j.key];TO(Y,Z)&&Bh.newMorphing(j.key,Y,Z,f,250),g.activeTexture.set(v.TEXTURE0),U.texture&&U.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE);let tt=Bh.getMorphValuesForProxy(j.key),$=tt?1:0,rt;tt&&(rt={morphing:{srcDemTile:tt.from,dstDemTile:tt.to,phase:Dr(tt.phase)}});let st=MO(j.projMatrix,jq(j.canonical,A.renderWorldCopies)?P/10:P,O);if(E($),!y)continue;u.setupElevationDraw(U,y,rt);let pt=j.toUnwrapped();x&&x.setupShadows(pt,y),c.uploadCommonUniforms(g,y,pt,null,C),y.draw(c,R,D,G,M,bi.backCCW,st,"terrain_raster",u.gridBuffer,F,N)}}}}(i,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,i.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;let i=this.painter,o=this.painter.context,c=this.proxySourceCache,u=this.proxiedCoords[c.id],h=this._drapedRenderBatches.shift(),p=i.style.order,f=[],g=0;for(let v of u){let y=c.getTileByID(v.proxyTileKey),b=c.proxyCachedFBO[v.key]?c.proxyCachedFBO[v.key][t]:void 0,x=b!==void 0?c.renderCache[b]:this.pool[g++],C=b!==void 0;if(y.texture=x.tex,C&&!x.dirty){f.push(y.tileID);continue}let E;o.bindFramebuffer.set(x.fb.framebuffer),this.renderedToTile=!1,x.dirty&&(o.clear({color:_i.transparent,stencil:0}),x.dirty=!1);for(let M=h.start;M<=h.end;++M){let D=i.style._mergedLayers[p[M]];if(D.isHidden(i.transform.zoom))continue;let A=i.style.getLayerSourceCache(D),P=A?this.proxyToSource[v.key][A.id]:[v];if(!P)continue;let O=P;o.viewport.set([0,0,x.fb.width,x.fb.height]),E!==(A?A.id:null)&&(this._setupStencil(x,P,D,A),E=A?A.id:null),i.renderLayer(i,A,D,O)}if(this._drapedRenderBatches.length===0)for(let M of this._pendingGroundEffectLayers){let D=i.style._mergedLayers[p[M]];if(D.isHidden(i.transform.zoom))continue;let A=i.style.getLayerSourceCache(D),P=A?this.proxyToSource[v.key][A.id]:[v];if(!P)continue;let O=P;o.viewport.set([0,0,x.fb.width,x.fb.height]),E!==(A?A.id:null)&&(this._setupStencil(x,P,D,A),E=A?A.id:null),i.renderLayer(i,A,D,O)}this.renderedToTile?(x.dirty=!0,f.push(y.tileID)):C||--g,g===5&&(g=0,this.renderToBackBuffer(f))}return this.renderToBackBuffer(f),this.renderingToTexture=!1,o.bindFramebuffer.set(null),o.viewport.set([0,0,i.width,i.height]),h.end+1}postRender(){}isLayerOrderingCorrect(t){let i=t.order.length,o=-1,c=i;for(let u=0;u<i;++u)this._style.isLayerDraped(t._mergedLayers[t.order[u]])?o=Math.max(o,u):c=Math.min(c,u);return c>o}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(i=>i.dem).forEach(i=>{t=Math.min(t,i.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,i,o){if(!this._visibleDemTiles)return null;let c=this._visibleDemTiles.filter(u=>u.dem).map(u=>{let h=u.tileID,p=1<<h.overscaledZ,{x:f,y:g}=h.canonical,v=f/p,y=(f+1)/p,b=g/p,x=(g+1)/p;return{minx:v,miny:b,maxx:y,maxy:x,t:u.dem.tree.raycastRoot(v,b,y,x,t,i,o),tile:u}});c.sort((u,h)=>(u.t!==null?u.t:Number.MAX_VALUE)-(h.t!==null?h.t:Number.MAX_VALUE));for(let u of c){if(u.t==null)return null;let h=u.tile.dem.tree.raycast(u.minx,u.miny,u.maxx,u.maxy,t,i,o);if(h!=null)return h}return null}_createFBO(){let t=this.painter.context,i=t.gl,o=this.drapeBufferSize;t.activeTexture.set(i.TEXTURE0);let c=new or(t,{width:o[0],height:o[1],data:null},i.RGBA);c.bind(i.LINEAR,i.CLAMP_TO_EDGE);let u=t.createFramebuffer(o[0],o[1],!0,null);return u.colorAttachment.set(c.texture),u.depthAttachment=new KH(t,u.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,o[0],o[1]),this._stencilRef=0,u.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):u.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&i.texParameterf(i.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:u,tex:c,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.hasLightTransitions())return!0;for(let t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{let i=this._style._mergedLayers[t],o=i.isHidden(this.painter.transform.zoom);return i.type==="custom"?!o&&i.shouldRedrape():!o&&i.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(let o of this._style.getSources())if(o instanceof HP){t=!0;break}if(!t)return;let i={};for(let o=0;o<this._style.order.length;++o){let c=this._style._mergedLayers[this._style.order[o]],u=this._style.getLayerSourceCache(c);if(u&&!i[u.id]&&!c.isHidden(this.painter.transform.zoom)&&c.type==="line"&&c.widthExpression()instanceof Hc){i[u.id]=!0;for(let h of this.proxyCoords){let p=this.proxyToSource[h.key][u.id];if(p)for(let f of p)this._clearRenderCacheForTile(u.id,f)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(let o in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[o]._source instanceof NC){t=!0;break}if(!t)return;let i={};for(let o=0;o<this._style.order.length;++o){let c=this._style._mergedLayers[this._style.order[o]],u=this._style.getLayerSourceCache(c);if(!u||i[u.id]||c.isHidden(this.painter.transform.zoom)||c.type!=="raster")continue;let h=c.paint.get("raster-fade-duration");for(let p of this.proxyCoords){let f=this.proxyToSource[p.key][u.id];if(f)for(let g of f){let v=kO(u.getTile(g),u.findLoadedParent(g,0),u,this.painter.transform,h);(v.opacity!==1||v.mix!==0)&&this._clearRenderCacheForTile(u.id,g)}}}}_setupDrapedRenderBatches(){let t=this._style.order,i=t.length;if(i===0)return;let o=[];this._pendingGroundEffectLayers=[];let c,u=0,h=this._style._mergedLayers[t[u]];for(;!this._style.isLayerDraped(h)&&h.isHidden(this.painter.transform.zoom)&&++u<i;)h=this._style._mergedLayers[t[u]];for(;u<i;++u){let p=this._style._mergedLayers[t[u]];p.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(p)?c===void 0&&(c=u):(p.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(u),c!==void 0&&(o.push({start:c,end:u-1}),c=void 0)))}if(c!==void 0&&o.push({start:c,end:u-1}),o.length!==0){let p=o[o.length-1];this._pendingGroundEffectLayers.every(g=>g>p.end)||lt("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=o}_setupRenderCache(t){let i=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,i.renderCache.length>i.renderCachePool.length){let h=Object.values(i.proxyCachedFBO);i.proxyCachedFBO={};for(let p=0;p<h.length;++p){let f=Object.values(h[p]);i.renderCachePool.push(...f)}}return}this._clearRasterLayersFromRenderCache();let o=this.proxyCoords,c=this._tilesDirty;for(let h=o.length-1;h>=0;h--){let p=o[h];if(i.getTileByID(p.key),i.proxyCachedFBO[p.key]!==void 0){let f=t[p.key],g=this.proxyToSource[p.key],v=0;for(let y in g){let b=g[y],x=f[y];if(!x||x.length!==b.length||b.some((C,E)=>C!==x[E]||c[y]&&c[y].hasOwnProperty(C.key))){v=-1;break}++v}for(let y in i.proxyCachedFBO[p.key])i.renderCache[i.proxyCachedFBO[p.key][y]].dirty=v<0||v!==Object.values(f).length}}let u=[...this._drapedRenderBatches];u.sort((h,p)=>p.end-p.start-(h.end-h.start));for(let h of u)for(let p of o){if(i.proxyCachedFBO[p.key])continue;let f=i.renderCachePool.pop();f===void 0&&i.renderCache.length<50&&(f=i.renderCache.length,i.renderCache.push(this._createFBO())),f!==void 0&&(i.proxyCachedFBO[p.key]={},i.proxyCachedFBO[p.key][h.start]=f,i.renderCache[f].dirty=!0)}this._tilesDirty={}}_setupStencil(t,i,o,c){if(!c||!this._sourceTilesOverlap[c.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let u=this.painter.context,h=u.gl;if(i.length<=1)return void(this._overlapStencilType=!1);let p;if(o.isTileClipped())p=i.length,this._overlapStencilMode.test={func:h.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(i[0].overscaledZ>i[i.length-1].overscaledZ))return void(this._overlapStencilType=!1);p=1,this._overlapStencilMode.test={func:h.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+p>255&&(u.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=p,this._overlapStencilMode.ref=this._stencilRef,o.isTileClipped()&&this._renderTileClippingMasks(i,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):vi.disabled}_renderTileClippingMasks(t,i){let o=this.painter,c=this.painter.context,u=c.gl;o._tileClippingMaskIDs={},c.setColorMode(Gi.disabled),c.setDepthMode(He.disabled);let h=o.getOrCreateProgram("clippingMask");for(let p of t){let f=o._tileClippingMaskIDs[p.key]=--i;h.draw(o,u.TRIANGLES,He.disabled,new vi({func:u.ALWAYS,mask:0},f,255,u.KEEP,u.KEEP,u.REPLACE),Gi.disabled,bi.disabled,nS(p.projMatrix),"$clipping",o.tileExtentBuffer,o.quadTriangleIndexBuffer,o.tileExtentSegments)}}pointCoordinate(t){let i=this.painter.transform;if(t.x<0||t.x>i.width||t.y<0||t.y>i.height)return null;let o=[t.x,t.y,1,1];hn.transformMat4(o,o,i.pixelMatrixInverse),hn.scale(o,o,1/o[3]),o[0]/=i.worldSize,o[1]/=i.worldSize;let c=i._camera.position,u=yn(1,i.center.lat),h=[c[0],c[1],c[2]/u,0],p=J.subtract([],o.slice(0,3),h);J.normalize(p,p);let f=this.raycast(h,p,this._exaggeration);return f!==null&&f?(J.scaleAndAdd(h,h,p,f),h[3]=h[2],h[2]*=u,h):null}drawDepth(){let t=this.painter,i=t.context,o=this.proxySourceCache,c=Math.ceil(t.width),u=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===c&&this._depthFBO.height===u||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let h=i.gl,p=i.createFramebuffer(c,u,!0,"renderbuffer");i.activeTexture.set(h.TEXTURE0);let f=new or(i,{width:c,height:u,data:null},h.RGBA);f.bind(h.NEAREST,h.CLAMP_TO_EDGE),p.colorAttachment.set(f.texture);let g=i.createRenderbuffer(i.gl.DEPTH_COMPONENT16,c,u);p.depthAttachment.set(g),this._depthFBO=p,this._depthTexture=f}i.bindFramebuffer.set(this._depthFBO.framebuffer),i.viewport.set([0,0,c,u]),function(h,p,f,g){if(h.transform.projection.name==="globe")return;let v=h.context,y=v.gl;v.clear({depth:1});let b=h.getOrCreateProgram("terrainDepth"),x=new He(y.LESS,He.ReadWrite,h.depthRangeFor3D);for(let C of g){let E=f.getTile(C),M=MO(C.projMatrix,0,[0,0,0]);p.setupElevationDraw(E,b),b.draw(h,y.TRIANGLES,x,vi.disabled,Gi.unblended,bi.backCCW,M,"terrain_depth",p.gridBuffer,p.gridIndexBuffer,p.gridNoSkirtSegments)}}(t,this,o,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,i,o){if(t.getSource()instanceof va)return this._setupProxiedCoordsForImageSource(t,i,o);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};let c=this.proxiedCoords[t.id]=[],u=this.proxyCoords;for(let p=0;p<u.length;p++){let f=u[p],g=this._findTileCoveringTileID(f,t);if(g){let v=this._createProxiedId(f,g,o[f.key]&&o[f.key][t.id]);c.push(v),this.proxyToSource[f.key][t.id]=[v]}}let h=!1;for(let p=0;p<i.length;p++){let f=t.getTile(i[p]);if(!f||!f.hasData())continue;let g=this._findTileCoveringTileID(f.tileID,this.proxySourceCache);if(g&&g.tileID.canonical.z!==f.tileID.canonical.z){let v=this.proxyToSource[g.tileID.key][t.id],y=this._createProxiedId(g.tileID,f,o[g.tileID.key]&&o[g.tileID.key][t.id]);v?v.splice(v.length-1,0,y):this.proxyToSource[g.tileID.key][t.id]=[y],c.push(y),h=!0}}this._sourceTilesOverlap[t.id]=h}_setupProxiedCoordsForImageSource(t,i,o){if(!t.getSource().loaded())return;let c=this.proxiedCoords[t.id]=[],u=this.proxyCoords,h=t.getSource(),p=h.tileID;if(!p)return;let f=new Q(p.x,p.y)._div(1<<p.z),g=h.coordinates.map(Fi.fromLngLat).reduce((y,b)=>(y.min.x=Math.min(y.min.x,b.x-f.x),y.min.y=Math.min(y.min.y,b.y-f.y),y.max.x=Math.max(y.max.x,b.x-f.x),y.max.y=Math.max(y.max.y,b.y-f.y),y),{min:new Q(Number.MAX_VALUE,Number.MAX_VALUE),max:new Q(-Number.MAX_VALUE,-Number.MAX_VALUE)}),v=(y,b)=>{let x=y.wrap+y.canonical.x/(1<<y.canonical.z),C=y.canonical.y/(1<<y.canonical.z),E=wt/(1<<y.canonical.z),M=b.wrap+b.canonical.x/(1<<b.canonical.z),D=b.canonical.y/(1<<b.canonical.z);return x+E<M+g.min.x||x>M+g.max.x||C+E<D+g.min.y||C>D+g.max.y};for(let y=0;y<u.length;y++){let b=u[y];for(let x=0;x<i.length;x++){let C=t.getTile(i[x]);if(!C||!C.hasData()||v(b,C.tileID))continue;let E=this._createProxiedId(b,C,o[b.key]&&o[b.key][t.id]),M=this.proxyToSource[b.key][t.id];M?M.push(E):this.proxyToSource[b.key][t.id]=[E],c.push(E)}}}_createProxiedId(t,i,o){let c=this.orthoMatrix;if(o){let u=o.find(h=>h.key===i.tileID.key);if(u)return u}if(i.tileID.key!==t.key){let u=t.canonical.z-i.tileID.canonical.z,h,p,f;c=ft.create();let g=i.tileID.wrap-t.wrap<<t.overscaledZ;u>0?(h=wt>>u,p=h*((i.tileID.canonical.x<<u)-t.canonical.x+g),f=h*((i.tileID.canonical.y<<u)-t.canonical.y)):(h=wt<<-u,p=wt*(i.tileID.canonical.x-(t.canonical.x+g<<-u)),f=wt*(i.tileID.canonical.y-(t.canonical.y<<-u))),ft.ortho(c,0,h,0,h,0,1),ft.translate(c,c,[p,f,0])}return new RO(i.tileID,t.key,c)}_findTileCoveringTileID(t,i){let o=i.getTile(t);if(o&&o.hasData())return o;let c=this._findCoveringTileCache[i.id],u=c[t.key];if(o=u?i.getTileByID(u):null,o&&o.hasData()||u===null)return o;let h=o?o.tileID:t,p=h.overscaledZ,f=i.getSource().minzoom,g=[];if(!u){let y=i.getSource().maxzoom;if(t.canonical.z>=y){let b=t.canonical.z-y;i.getSource().reparseOverscaled?(p=Math.max(t.canonical.z+2,i.transform.tileZoom),h=new $i(p,t.wrap,y,t.canonical.x>>b,t.canonical.y>>b)):b!==0&&(p=y,h=new $i(p,t.wrap,y,t.canonical.x>>b,t.canonical.y>>b))}h.key!==t.key&&(g.push(h.key),o=i.getTile(h))}let v=y=>{g.forEach(b=>{c[b]=y}),g.length=0};for(p-=1;p>=f&&(!o||!o.hasData());p--){o&&v(o.tileID.key);let y=h.calculateScaledKey(p);if(o=i.getTileByID(y),o&&o.hasData())break;let b=c[y];if(b===null)break;b===void 0?g.push(y):o=i.getTileByID(b)}return v(o?o.tileID.key:null),o&&o.hasData()?o:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,i){let o=this._tilesDirty[t];o||(o=this._tilesDirty[t]={}),o[i.key]=!0}}function qq(e,t,i){let o=function(p,f,g){let v=J.dot(f,p),y=J.dot(g,[.2126,.7152,.0722]),b=(C,E,M)=>(1-M)*C+M*E,x=b(1-.3*Math.min(y,1),1,Math.min(v+1,1));return b(.92,1,Math.asin(ve(f[2],-1,1))/Math.PI+.5)*x}(e,[0,0,1],t),c=[0,0,0];J.scale(c,i.slice(0,3),o);let u=[0,0,0];J.scale(u,t.slice(0,3),e[2]);let h=[0,0,0];return J.add(h,c,u),Fr(h)}let Wq=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],$q=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class PO{static cacheKey(t,i,o,c){let u=`${i}${c?c.cacheKey:""}`;for(let h of o)t.usedDefines.includes(h)&&(u+=`/${h}`);return u}constructor(t,i,o,c,u,h){let p=t.gl;this.program=p.createProgram(),this.configuration=c,this.name=i,this.fixedDefines=[...h];let f=c?c.getBinderAttributes():[],g=(o.staticAttributes||[]).concat(f),v=c?c.defines():[];v=v.concat(h.map(M=>`#define ${M}`));let y=`#version 300 es
`,b=y+v.concat("precision mediump float;",wO,xO.fragmentSource).join(`
`);for(let M of o.fragmentIncludes)b+=`
${X0[M]}`;b+=`
${o.fragmentSource}`;let x=y+v.concat("precision highp float;",wO,xO.vertexSource).join(`
`);for(let M of o.vertexIncludes)x+=`
${X0[M]}`;x+=`
${o.vertexSource}`;let C=p.createShader(p.FRAGMENT_SHADER);if(p.isContextLost())return void(this.failedToCreate=!0);p.shaderSource(C,b),p.compileShader(C),p.attachShader(this.program,C);let E=p.createShader(p.VERTEX_SHADER);if(p.isContextLost())this.failedToCreate=!0;else{p.shaderSource(E,x),p.compileShader(E),p.attachShader(this.program,E),this.attributes={},this.numAttributes=g.length;for(let M=0;M<this.numAttributes;M++)if(g[M]){let D=g[M].startsWith("a_")?g[M]:`a_${g[M]}`;p.bindAttribLocation(this.program,M,D),this.attributes[D]=M}p.linkProgram(this.program),p.deleteShader(E),p.deleteShader(C),this.fixedUniforms=u(t),this.binderUniforms=c?c.getUniforms(t):[],h.includes("TERRAIN")&&(this.terrainUniforms=(M=>({u_dem:new wi(M),u_dem_prev:new wi(M),u_dem_tl:new Ci(M),u_dem_scale:new Bt(M),u_dem_tl_prev:new Ci(M),u_dem_scale_prev:new Bt(M),u_dem_size:new Bt(M),u_dem_lerp:new Bt(M),u_exaggeration:new Bt(M),u_depth:new wi(M),u_depth_size_inv:new Ci(M),u_meter_to_dem:new Bt(M),u_label_plane_matrix_inv:new si(M)}))(t)),h.includes("GLOBE")&&(this.globeUniforms=(M=>({u_tile_tl_up:new di(M),u_tile_tr_up:new di(M),u_tile_br_up:new di(M),u_tile_bl_up:new di(M),u_tile_up_scale:new Bt(M)}))(t)),h.includes("FOG")&&(this.fogUniforms=(M=>({u_fog_matrix:new si(M),u_fog_range:new Ci(M),u_fog_color:new Ss(M),u_fog_horizon_blend:new Bt(M),u_fog_vertical_limit:new Ci(M),u_fog_temporal_offset:new Bt(M),u_frustum_tl:new di(M),u_frustum_tr:new di(M),u_frustum_br:new di(M),u_frustum_bl:new di(M),u_globe_pos:new di(M),u_globe_radius:new Bt(M),u_globe_transition:new Bt(M),u_is_globe:new wi(M),u_viewport:new Ci(M)}))(t)),h.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(M=>({u_cutoff_params:new Ss(M)}))(t)),h.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(M=>({u_lighting_ambient_color:new di(M),u_lighting_directional_dir:new di(M),u_lighting_directional_color:new di(M),u_ground_radiance:new di(M)}))(t)),h.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(M=>({u_light_matrix_0:new si(M),u_light_matrix_1:new si(M),u_fade_range:new Ci(M),u_shadow_normal_offset:new di(M),u_shadow_intensity:new Bt(M),u_shadow_texel_size:new Bt(M),u_shadow_map_resolution:new Bt(M),u_shadow_direction:new di(M),u_shadow_bias:new di(M),u_shadowmap_0:new wi(M),u_shadowmap_1:new wi(M)}))(t))}}setTerrainUniformValues(t,i){if(!this.terrainUniforms)return;let o=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let c in i)o[c]&&o[c].set(this.program,c,i[c])}}setGlobeUniformValues(t,i){if(!this.globeUniforms)return;let o=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let c in i)o[c]&&o[c].set(this.program,c,i[c])}}setFogUniformValues(t,i){if(!this.fogUniforms)return;let o=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let c in i)o[c].set(this.program,c,i[c])}}setCutoffUniformValues(t,i){if(!this.cutoffUniforms)return;let o=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let c in i)o[c].set(this.program,c,i[c])}}setLightsUniformValues(t,i){if(!this.lightsUniforms)return;let o=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let c in i)o[c].set(this.program,c,i[c])}}setShadowUniformValues(t,i){if(this.failedToCreate||!this.shadowUniforms)return;let o=this.shadowUniforms;t.program.set(this.program);for(let c in i)o[c].set(this.program,c,i[c])}_drawDebugWireframe(t,i,o,c,u,h,p,f,g,v){let y=t.options.wireframe;if(y.terrain===!1&&y.layers2D===!1&&y.layers3D===!1)return;let b=t.context;if(!(!(!y.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!y.layers2D||t._terrain&&t._terrain.renderingToTexture||!Wq.includes(this.name))||!(!y.layers3D||!$q.includes(this.name))))return;let x=b.gl,C=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,u,b);if(!C)return;let E=[...this.fixedDefines];E.push("DEBUG_WIREFRAME");let M=t.getOrCreateProgram(this.name,{config:this.configuration,defines:E});b.program.set(M.program);let D=(O,R,F)=>{if(R[O]&&F[O])for(let N in R[O])F[O][N]&&F[O][N].set(F.program,N,R[O][N].current)};g&&g.setUniforms(M.program,b,M.binderUniforms,p,{zoom:f}),D("fixedUniforms",this,M),D("terrainUniforms",this,M),D("globeUniforms",this,M),D("fogUniforms",this,M),D("lightsUniforms",this,M),D("shadowUniforms",this,M),C.bind(),b.setColorMode(new Gi([x.ONE,x.ONE_MINUS_SRC_ALPHA,x.ZERO,x.ONE],_i.transparent,[!0,!0,!0,!1])),b.setDepthMode(new He(i.func===x.LESS?x.LEQUAL:i.func,He.ReadOnly,i.range)),b.setStencilMode(vi.disabled);let A=3*h.primitiveLength*2,P=3*h.primitiveOffset*2*2;v&&v>1?x.drawElementsInstanced(x.LINES,A,x.UNSIGNED_SHORT,P,v):x.drawElements(x.LINES,A,x.UNSIGNED_SHORT,P),u.bind(),b.program.set(this.program),b.setDepthMode(i),b.setStencilMode(o),b.setColorMode(c)}draw(t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M){let D=t.context,A=D.gl;if(this.failedToCreate)return;D.program.set(this.program),D.setDepthMode(o),D.setStencilMode(c),D.setColorMode(u),D.setCullFace(h);for(let R of Object.keys(this.fixedUniforms))this.fixedUniforms[R].set(this.program,R,p[R]);C&&C.setUniforms(this.program,D,this.binderUniforms,b,{zoom:x});let P={[A.LINES]:2,[A.TRIANGLES]:3,[A.LINE_STRIP]:1}[i],O=M&&M>0?1:void 0;for(let R of y.get()){let F=R.vaos||(R.vaos={});(F[f]||(F[f]=new zq)).bind(D,this,g,C?C.getPaintVertexBuffers():[],v,R.vertexOffset,E||[],O),M&&M>1?A.drawElementsInstanced(i,R.primitiveLength*P,A.UNSIGNED_SHORT,R.primitiveOffset*P*2,M):A.drawElements(i,R.primitiveLength*P,A.UNSIGNED_SHORT,R.primitiveOffset*P*2),i===A.TRIANGLES&&this._drawDebugWireframe(t,o,c,u,v,R,b,x,C,M)}}}function OO(e,t){let i=Math.pow(2,t.tileID.overscaledZ),o=t.tileSize*Math.pow(2,e.transform.tileZoom)/i,c=o*(t.tileID.canonical.x+t.tileID.wrap*i),u=o*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/lu(t,1,e.transform.tileZoom),u_pixel_coord_upper:[c>>16,u>>16],u_pixel_coord_lower:[65535&c,65535&u]}}let Yq=ft.create(),FO=(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E)=>{let M=t.style.light,D=M.properties.get("position"),A=[D.x,D.y,D.z],P=us.create();M.properties.get("anchor")==="viewport"&&(us.fromRotation(P,-t.transform.angle),J.transformMat3(A,A,P));let O=M.properties.get("color"),R=t.transform,F={u_matrix:e,u_lightpos:A,u_lightintensity:M.properties.get("intensity"),u_lightcolor:[O.r,O.g,O.b],u_vertical_gradient:+i,u_opacity:o,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Yq,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:c,u_edge_radius:u,u_flood_light_color:y,u_vertical_scale:b,u_flood_light_intensity:x,u_ground_shadow_factor:C,u_emissive_strength:E};return R.projection.name==="globe"&&(F.u_tile_id=[h.canonical.x,h.canonical.y,1<<h.canonical.z],F.u_zoom_transition=f,F.u_inv_rot_matrix=v,F.u_merc_center=g,F.u_up_dir=R.projection.upVector(new pa(0,0,0),g[0]*wt,g[1]*wt),F.u_height_lift=p),F},Zq=(e,t,i)=>({u_matrix:e,u_edge_radius:t,u_vertical_scale:i}),Xq=(e,t,i,o,c,u,h,p,f,g,v,y,b,x)=>{let C=FO(e,t,i,o,c,u,h,f,g,v,y,b,x,1,[0,0,0],0),E={u_height_factor:-Math.pow(2,h.overscaledZ)/p.tileSize/8};return ge(C,OO(t,p),E)},LO=(e,t)=>({u_matrix:e,u_emissive_strength:t}),zO=(e,t,i,o)=>ge(LO(e,t),OO(i,o)),Kq=(e,t,i)=>({u_matrix:e,u_world:i,u_emissive_strength:t}),Qq=(e,t,i,o,c)=>ge(zO(e,t,i,o),{u_world:c}),Jq=(e,t,i,o)=>{let c=wt/i.tileSize;return{u_matrix:e,u_camera_to_center_distance:t.getCameraToCenterDistance(o),u_extrude_scale:[t.pixelsToGLUnits[0]/c,t.pixelsToGLUnits[1]/c]}},NO=(e,t,i=1)=>({u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:i}),tW=ft.create(),eW=(e,t,i,o,c,u,h)=>{let p=e.transform,f=p.projection.name==="globe",g=f?XA(p.zoom,t.canonical)*p._pixelsPerMercatorPixel:lu(i,1,u),v={u_matrix:t.projMatrix,u_extrude_scale:g,u_intensity:h,u_inv_rot_matrix:tW,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(f){v.u_inv_rot_matrix=o,v.u_merc_center=c,v.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],v.u_zoom_transition=Co(p.zoom);let y=c[0]*wt,b=c[1]*wt;v.u_up_dir=p.projection.upVector(new pa(0,0,0),y,b)}return v},BO=(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M,D,A,P,O,R)=>{return{u_matrix:e,u_normalize_matrix:t,u_globe_matrix:i,u_merc_matrix:o,u_grid_matrix:c,u_tl_parent:u,u_scale_parent:v,u_fade_t:y.mix,u_opacity:y.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(N=b.paint.get("raster-saturation"),N>0?1-1/(1.001-N):-N),u_contrast_factor:(F=b.paint.get("raster-contrast"),F>0?1/(1-F):1+F),u_spin_weights:iW(b.paint.get("raster-hue-rotate")),u_perspective_transform:x,u_raster_elevation:C,u_tl_br:h,u_zoom_transition:p,u_merc_center:f,u_cutoff_params:g,u_colorization_mix:nW(M,A),u_colorization_offset:rW(D,A),u_color_ramp:E,u_texture_offset:[O/(P+2*O),P/(P+2*O)],u_texture_res:[P+2*O,P+2*O],u_emissive_strength:R};var F,N};function iW(e){e*=Math.PI/180;let t=Math.sin(e),i=Math.cos(e);return[(2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3]}function nW([e,t,i,o],[c,u]){if(c===u)return[0,0,0,0];let h=259/257/(u-c);return[e*h,t*h,i*h,o*h]}function rW(e,[t,i]){return t===i?0:((e-t)/(i-t)*259-1)/257}let VO=ft.create(),jO=(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M,D)=>{let A=c.transform,P={u_is_size_zoom_constant:+(e==="constant"||e==="source"),u_is_size_feature_constant:+(e==="constant"||e==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:A.getCameraToCenterDistance(E),u_rotate_symbol:+i,u_aspect_ratio:A.width/A.height,u_fade_change:c.options.fadeDuration?c.symbolFadeChange:1,u_matrix:u,u_label_plane_matrix:h,u_coord_matrix:p,u_is_text:+f,u_pitch_with_map:+o,u_texsize:g,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:VO,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:VO,u_up_vector:[0,-1,0],u_icon_transition:D||0,u_icon_saturation:M};return E.name==="globe"&&(P.u_tile_id=[v.canonical.x,v.canonical.y,1<<v.canonical.z],P.u_zoom_transition=y,P.u_inv_rot_matrix=x,P.u_merc_center=b,P.u_camera_forward=A._camera.forward(),P.u_ecef_origin=function(O,R){let F=[0,0,0],N=Jc(Zs(R.canonical));return J.transformMat4(F,F,N),J.transformMat4(F,F,O),F}(A.globeMatrix,v.toUnwrapped()),P.u_tile_matrix=Float32Array.from(A.globeMatrix),P.u_up_vector=C),P},UO=(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M)=>ge(jO(e,t,i,o,c,u,h,p,f,g,y,b,x,C,E,M,1),{u_gamma_scale:o?c.transform.getCameraToCenterDistance(M)*Math.cos(c.terrain?0:c.transform._pitch):1,u_device_pixel_ratio:ii.devicePixelRatio,u_is_halo:+v,undefined:void 0}),oW=(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E)=>ge(UO(e,t,i,o,c,u,h,p,!0,f,!0,v,y,b,x,C,E),{u_texsize_icon:g,u_texture_icon:1}),sW=(e,t,i,o)=>({u_matrix:e,u_emissive_strength:t,u_opacity:i,u_color:o}),aW=(e,t,i,o,c,u,h)=>ge(function(p,f,g,v){let y=g.imageManager.getPattern(p.toString(),f),{width:b,height:x}=g.imageManager.getPixelSize(f),C=Math.pow(2,v.tileID.overscaledZ),E=v.tileSize*Math.pow(2,g.transform.tileZoom)/C,M=E*(v.tileID.canonical.x+v.tileID.wrap*C),D=E*v.tileID.canonical.y;return{u_image:0,u_pattern_tl:y.tl,u_pattern_br:y.br,u_texsize:[b,x],u_pattern_size:y.displaySize,u_tile_units_to_pixels:1/lu(v,1,g.transform.tileZoom),u_pixel_coord_upper:[M>>16,D>>16],u_pixel_coord_lower:[65535&M,65535&D]}}(c,u,o,h),{u_matrix:e,u_emissive_strength:t,u_opacity:i}),Ts={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},rS=(e,t,i,o,c,u,h,p,f,g,v,y,b=[0,0,0])=>{let x=o.style.light,C=x.properties.get("position"),E=[-C.x,-C.y,C.z],M=us.create();x.properties.get("anchor")==="viewport"&&(us.fromRotation(M,-o.transform.angle),J.transformMat3(E,E,M));let D=g.alphaMode==="MASK",A=x.properties.get("color"),P=y.paint.get("model-ambient-occlusion-intensity"),O=y.paint.get("model-color").constantOr(_i.white),R=y.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:e,u_lighting_matrix:t,u_normal_matrix:i,u_lightpos:E,u_lightintensity:x.properties.get("intensity"),u_lightcolor:[A.r,A.g,A.b],u_camera_pos:b,u_opacity:c,u_baseTextureIsAlpha:0,u_alphaMask:+D,u_alphaCutoff:g.alphaCutoff,u_baseColorFactor:[u.r,u.g,u.b,u.a],u_emissiveFactor:[h[0],h[1],h[2],1],u_metallicFactor:p,u_roughnessFactor:f,u_baseColorTexture:Ts.BaseColor,u_metallicRoughnessTexture:Ts.MetallicRoughness,u_normalTexture:Ts.Normal,u_occlusionTexture:Ts.Occlusion,u_emissionTexture:Ts.Emission,u_color_mix:[O.r,O.g,O.b,R],u_aoIntensity:P,u_emissive_strength:v}},HO=new Float32Array(16),GO=(e,t=HO,i=HO)=>({u_matrix:e,u_instance:t,u_node_matrix:i}),lW={fillExtrusion:e=>({u_matrix:new si(e),u_lightpos:new di(e),u_lightintensity:new Bt(e),u_lightcolor:new di(e),u_vertical_gradient:new Bt(e),u_opacity:new Bt(e),u_edge_radius:new Bt(e),u_ao:new Ci(e),u_tile_id:new di(e),u_zoom_transition:new Bt(e),u_inv_rot_matrix:new si(e),u_merc_center:new Ci(e),u_up_dir:new di(e),u_height_lift:new Bt(e),u_flood_light_color:new di(e),u_vertical_scale:new Bt(e),u_flood_light_intensity:new Bt(e),u_ground_shadow_factor:new di(e),u_emissive_strength:new Bt(e)}),fillExtrusionDepth:e=>({u_matrix:new si(e),u_edge_radius:new Bt(e),u_vertical_scale:new Bt(e)}),fillExtrusionPattern:e=>({u_matrix:new si(e),u_lightpos:new di(e),u_lightintensity:new Bt(e),u_lightcolor:new di(e),u_vertical_gradient:new Bt(e),u_height_factor:new Bt(e),u_edge_radius:new Bt(e),u_ao:new Ci(e),u_tile_id:new di(e),u_zoom_transition:new Bt(e),u_inv_rot_matrix:new si(e),u_merc_center:new Ci(e),u_up_dir:new di(e),u_height_lift:new Bt(e),u_image:new wi(e),u_texsize:new Ci(e),u_pixel_coord_upper:new Ci(e),u_pixel_coord_lower:new Ci(e),u_tile_units_to_pixels:new Bt(e),u_opacity:new Bt(e)}),fillExtrusionGroundEffect:e=>({u_matrix:new si(e),u_opacity:new Bt(e),u_ao_pass:new Bt(e),u_meter_to_tile:new Bt(e),u_ao:new Ci(e),u_flood_light_intensity:new Bt(e),u_flood_light_color:new di(e),u_attenuation:new Bt(e),u_edge_radius:new Bt(e),u_fb:new wi(e),u_fb_size:new Bt(e)}),fill:e=>({u_matrix:new si(e),u_emissive_strength:new Bt(e)}),fillPattern:e=>({u_matrix:new si(e),u_emissive_strength:new Bt(e),u_image:new wi(e),u_texsize:new Ci(e),u_pixel_coord_upper:new Ci(e),u_pixel_coord_lower:new Ci(e),u_tile_units_to_pixels:new Bt(e)}),fillOutline:e=>({u_matrix:new si(e),u_emissive_strength:new Bt(e),u_world:new Ci(e)}),fillOutlinePattern:e=>({u_matrix:new si(e),u_emissive_strength:new Bt(e),u_world:new Ci(e),u_image:new wi(e),u_texsize:new Ci(e),u_pixel_coord_upper:new Ci(e),u_pixel_coord_lower:new Ci(e),u_tile_units_to_pixels:new Bt(e)}),circle:e=>({u_camera_to_center_distance:new Bt(e),u_extrude_scale:new vw(e),u_device_pixel_ratio:new Bt(e),u_matrix:new si(e),u_inv_rot_matrix:new si(e),u_merc_center:new Ci(e),u_tile_id:new di(e),u_zoom_transition:new Bt(e),u_up_dir:new di(e),u_emissive_strength:new Bt(e)}),collisionBox:e=>({u_matrix:new si(e),u_camera_to_center_distance:new Bt(e),u_extrude_scale:new Ci(e)}),collisionCircle:e=>({u_matrix:new si(e),u_inv_matrix:new si(e),u_camera_to_center_distance:new Bt(e),u_viewport_size:new Ci(e)}),debug:e=>({u_color:new fh(e),u_matrix:new si(e),u_overlay:new wi(e),u_overlay_scale:new Bt(e)}),clippingMask:e=>({u_matrix:new si(e)}),heatmap:e=>({u_extrude_scale:new Bt(e),u_intensity:new Bt(e),u_matrix:new si(e),u_inv_rot_matrix:new si(e),u_merc_center:new Ci(e),u_tile_id:new di(e),u_zoom_transition:new Bt(e),u_up_dir:new di(e)}),heatmapTexture:e=>({u_image:new wi(e),u_color_ramp:new wi(e),u_opacity:new Bt(e)}),hillshade:e=>({u_matrix:new si(e),u_image:new wi(e),u_latrange:new Ci(e),u_light:new Ci(e),u_shadow:new fh(e),u_highlight:new fh(e),u_emissive_strength:new Bt(e),u_accent:new fh(e)}),hillshadePrepare:e=>({u_matrix:new si(e),u_image:new wi(e),u_dimension:new Ci(e),u_zoom:new Bt(e)}),line:e=>({u_matrix:new si(e),u_pixels_to_tile_units:new vw(e),u_device_pixel_ratio:new Bt(e),u_units_to_pixels:new Ci(e),u_dash_image:new wi(e),u_gradient_image:new wi(e),u_image_height:new Bt(e),u_texsize:new Ci(e),u_tile_units_to_pixels:new Bt(e),u_alpha_discard_threshold:new Bt(e),u_trim_offset:new Ci(e),u_emissive_strength:new Bt(e)}),linePattern:e=>({u_matrix:new si(e),u_texsize:new Ci(e),u_pixels_to_tile_units:new vw(e),u_device_pixel_ratio:new Bt(e),u_image:new wi(e),u_units_to_pixels:new Ci(e),u_tile_units_to_pixels:new Bt(e),u_alpha_discard_threshold:new Bt(e)}),raster:e=>({u_matrix:new si(e),u_normalize_matrix:new si(e),u_globe_matrix:new si(e),u_merc_matrix:new si(e),u_grid_matrix:new _w(e),u_tl_parent:new Ci(e),u_scale_parent:new Bt(e),u_fade_t:new Bt(e),u_opacity:new Bt(e),u_image0:new wi(e),u_image1:new wi(e),u_brightness_low:new Bt(e),u_brightness_high:new Bt(e),u_saturation_factor:new Bt(e),u_contrast_factor:new Bt(e),u_spin_weights:new di(e),u_perspective_transform:new Ci(e),u_raster_elevation:new Bt(e),u_tl_br:new Ss(e),u_zoom_transition:new Bt(e),u_merc_center:new Ci(e),u_cutoff_params:new Ss(e),u_colorization_mix:new Ss(e),u_colorization_offset:new Bt(e),u_color_ramp:new wi(e),u_texture_offset:new Ci(e),u_texture_res:new Ci(e),u_emissive_strength:new Bt(e)}),symbolIcon:e=>({u_is_size_zoom_constant:new wi(e),u_is_size_feature_constant:new wi(e),u_size_t:new Bt(e),u_size:new Bt(e),u_camera_to_center_distance:new Bt(e),u_rotate_symbol:new wi(e),u_aspect_ratio:new Bt(e),u_fade_change:new Bt(e),u_matrix:new si(e),u_label_plane_matrix:new si(e),u_coord_matrix:new si(e),u_is_text:new wi(e),u_pitch_with_map:new wi(e),u_texsize:new Ci(e),u_tile_id:new di(e),u_zoom_transition:new Bt(e),u_inv_rot_matrix:new si(e),u_merc_center:new Ci(e),u_camera_forward:new di(e),u_tile_matrix:new si(e),u_up_vector:new di(e),u_ecef_origin:new di(e),u_texture:new wi(e),u_icon_transition:new Bt(e),u_icon_saturation:new Bt(e)}),symbolSDF:e=>({u_is_size_zoom_constant:new wi(e),u_is_size_feature_constant:new wi(e),u_size_t:new Bt(e),u_size:new Bt(e),u_camera_to_center_distance:new Bt(e),u_rotate_symbol:new wi(e),u_aspect_ratio:new Bt(e),u_fade_change:new Bt(e),u_matrix:new si(e),u_label_plane_matrix:new si(e),u_coord_matrix:new si(e),u_is_text:new wi(e),u_pitch_with_map:new wi(e),u_texsize:new Ci(e),u_texture:new wi(e),u_gamma_scale:new Bt(e),u_device_pixel_ratio:new Bt(e),u_tile_id:new di(e),u_zoom_transition:new Bt(e),u_inv_rot_matrix:new si(e),u_merc_center:new Ci(e),u_camera_forward:new di(e),u_tile_matrix:new si(e),u_up_vector:new di(e),u_ecef_origin:new di(e),u_is_halo:new wi(e)}),symbolTextAndIcon:e=>({u_is_size_zoom_constant:new wi(e),u_is_size_feature_constant:new wi(e),u_size_t:new Bt(e),u_size:new Bt(e),u_camera_to_center_distance:new Bt(e),u_rotate_symbol:new wi(e),u_aspect_ratio:new Bt(e),u_fade_change:new Bt(e),u_matrix:new si(e),u_label_plane_matrix:new si(e),u_coord_matrix:new si(e),u_is_text:new wi(e),u_pitch_with_map:new wi(e),u_texsize:new Ci(e),u_texsize_icon:new Ci(e),u_texture:new wi(e),u_texture_icon:new wi(e),u_gamma_scale:new Bt(e),u_device_pixel_ratio:new Bt(e),u_is_halo:new wi(e)}),background:e=>({u_matrix:new si(e),u_emissive_strength:new Bt(e),u_opacity:new Bt(e),u_color:new fh(e)}),backgroundPattern:e=>({u_matrix:new si(e),u_emissive_strength:new Bt(e),u_opacity:new Bt(e),u_image:new wi(e),u_pattern_tl:new Ci(e),u_pattern_br:new Ci(e),u_texsize:new Ci(e),u_pattern_size:new Ci(e),u_pixel_coord_upper:new Ci(e),u_pixel_coord_lower:new Ci(e),u_tile_units_to_pixels:new Bt(e)}),terrainRaster:EO,terrainDepth:EO,skybox:e=>({u_matrix:new si(e),u_sun_direction:new di(e),u_cubemap:new wi(e),u_opacity:new Bt(e),u_temporal_offset:new Bt(e)}),skyboxGradient:e=>({u_matrix:new si(e),u_color_ramp:new wi(e),u_center_direction:new di(e),u_radius:new Bt(e),u_opacity:new Bt(e),u_temporal_offset:new Bt(e)}),skyboxCapture:e=>({u_matrix_3f:new _w(e),u_sun_direction:new di(e),u_sun_intensity:new Bt(e),u_color_tint_r:new Ss(e),u_color_tint_m:new Ss(e),u_luminance:new Bt(e)}),globeRaster:e=>({u_proj_matrix:new si(e),u_globe_matrix:new si(e),u_normalize_matrix:new si(e),u_merc_matrix:new si(e),u_zoom_transition:new Bt(e),u_merc_center:new Ci(e),u_image0:new wi(e),u_grid_matrix:new _w(e),u_skirt_height:new Bt(e),u_frustum_tl:new di(e),u_frustum_tr:new di(e),u_frustum_br:new di(e),u_frustum_bl:new di(e),u_globe_pos:new di(e),u_globe_radius:new Bt(e),u_viewport:new Ci(e)}),globeAtmosphere:e=>({u_frustum_tl:new di(e),u_frustum_tr:new di(e),u_frustum_br:new di(e),u_frustum_bl:new di(e),u_horizon:new Bt(e),u_transition:new Bt(e),u_fadeout_range:new Bt(e),u_color:new Ss(e),u_high_color:new Ss(e),u_space_color:new Ss(e),u_temporal_offset:new Bt(e),u_horizon_angle:new Bt(e)}),model:e=>({u_matrix:new si(e),u_lighting_matrix:new si(e),u_normal_matrix:new si(e),u_lightpos:new di(e),u_lightintensity:new Bt(e),u_lightcolor:new di(e),u_camera_pos:new di(e),u_opacity:new Bt(e),u_baseColorFactor:new Ss(e),u_emissiveFactor:new Ss(e),u_metallicFactor:new Bt(e),u_roughnessFactor:new Bt(e),u_baseTextureIsAlpha:new wi(e),u_alphaMask:new wi(e),u_alphaCutoff:new Bt(e),u_baseColorTexture:new wi(e),u_metallicRoughnessTexture:new wi(e),u_normalTexture:new wi(e),u_occlusionTexture:new wi(e),u_emissionTexture:new wi(e),u_color_mix:new Ss(e),u_aoIntensity:new Bt(e),u_emissive_strength:new Bt(e)}),modelDepth:e=>({u_matrix:new si(e),u_instance:new si(e),u_node_matrix:new si(e)}),groundShadow:e=>({u_matrix:new si(e),u_ground_shadow_factor:new di(e)}),stars:e=>({u_matrix:new si(e),u_up:new di(e),u_right:new di(e),u_intensity_multiplier:new Bt(e)})},J0;function qO(e,t,i,o,c,u,h){let p=e.context,f=p.gl,g=e.transform,v=e.getOrCreateProgram("collisionBox"),y=[],b=0,x=0;for(let O=0;O<o.length;O++){let R=o[O],F=t.getTile(R),N=F.getBucket(i);if(!N)continue;let j=yq(R,N,g),U=j;c[0]===0&&c[1]===0||(U=e.translatePosMatrix(j,F,c,u));let G=h?N.textCollisionBox:N.iconCollisionBox,Y=N.collisionCircleArray;if(Y.length>0){let Z=ft.create(),tt=U;ft.mul(Z,N.placementInvProjMatrix,g.glCoordMatrix),ft.mul(Z,Z,N.placementViewportMatrix),y.push({circleArray:Y,circleOffset:x,transform:tt,invTransform:Z,projection:N.getProjection()}),b+=Y.length/4,x=b}G&&(e.terrain&&e.terrain.setupElevationDraw(F,v),v.draw(e,f.LINES,He.disabled,vi.disabled,e.colorModeForRenderPass(),bi.disabled,Jq(U,g,F,N.getProjection()),i.id,G.layoutVertexBuffer,G.indexBuffer,G.segments,null,g.zoom,null,[G.collisionVertexBuffer,G.collisionVertexBufferExt]))}if(!h||!y.length)return;let C=e.getOrCreateProgram("collisionCircle"),E=new sw;E.resize(4*b),E._trim();let M=0;for(let O of y)for(let R=0;R<O.circleArray.length/4;R++){let F=4*R,N=O.circleArray[F+0],j=O.circleArray[F+1],U=O.circleArray[F+2],G=O.circleArray[F+3];E.emplace(M++,N,j,U,G,0),E.emplace(M++,N,j,U,G,1),E.emplace(M++,N,j,U,G,2),E.emplace(M++,N,j,U,G,3)}(!J0||J0.length<2*b)&&(J0=function(O){let R=2*O,F=new qr;F.resize(R),F._trim();for(let N=0;N<R;N++){let j=6*N;F.uint16[j+0]=4*N+0,F.uint16[j+1]=4*N+1,F.uint16[j+2]=4*N+2,F.uint16[j+3]=4*N+2,F.uint16[j+4]=4*N+3,F.uint16[j+5]=4*N+0}return F}(b));let D=p.createIndexBuffer(J0,!0),A=p.createVertexBuffer(E,k8.members,!0);for(let O of y){let R={u_matrix:O.transform,u_inv_matrix:O.invTransform,u_camera_to_center_distance:(P=g).getCameraToCenterDistance(O.projection),u_viewport_size:[P.width,P.height]};C.draw(e,f.TRIANGLES,He.disabled,vi.disabled,e.colorModeForRenderPass(),bi.disabled,R,i.id,A,D,un.simpleSegment(0,2*O.circleOffset,O.circleArray.length,O.circleArray.length/2),null,g.zoom)}var P;A.destroy(),D.destroy()}let WO=ft.create();function cW({width:e,height:t,anchor:i,textOffset:o,textScale:c},u){let{horizontalAlign:h,verticalAlign:p}=m0(i),f=-(h-.5)*e,g=-(p-.5)*t,v=fC(i,o);return new Q((f/c+v[0])*u,(g/c+v[1])*u)}function dW(e,t,i,o,c,u,h,p,f,g,v){let y=e.text.placedSymbolArray,b=e.text.dynamicLayoutVertexArray,x=e.icon.dynamicLayoutVertexArray,C={},E=e.getProjection(),M=KC(p,E,u),D=u.elevation,A=E.upVectorScale(p.canonical,u.center.lat,u.worldSize).metersToTile;b.clear();for(let P=0;P<y.length;P++){let O=y.get(P),{tileAnchorX:R,tileAnchorY:F,numGlyphs:N}=O,j=O.hidden||!O.crossTileID||e.allowVerticalPlacement&&!O.placedOrientation?null:o[O.crossTileID];if(j){let U=0,G=0,Y=0;if(D){let vt=D?D.getAtTileOffset(p,R,F):0,[bt,yt,Ct]=E.upVector(p.canonical,R,F);U=vt*bt*A,G=vt*yt*A,Y=vt*Ct*A}let[Z,tt,$,rt]=el(O.projectedAnchorX+U,O.projectedAnchorY+G,O.projectedAnchorZ+Y,i?M:h),st=LR(u.getCameraToCenterDistance(E),rt),pt=c.evaluateSizeForFeature(e.textSizeData,g,O)*st/So;i&&(pt*=e.tilePixelRatio/f);let nt=cW(j,pt);i?({x:Z,y:tt,z:$}=E.projectTilePoint(R+nt.x,F+nt.y,p.canonical),[Z,tt,$]=el(Z+U,tt+G,$+Y,h)):(t&&nt._rotate(-u.angle),Z+=nt.x,tt+=nt.y,$=0);let ot=e.allowVerticalPlacement&&O.placedOrientation===Jn.vertical?Math.PI/2:0;for(let vt=0;vt<N;vt++)Ph(b,Z,tt,$,ot);v&&O.associatedIconIndex>=0&&(C[O.associatedIconIndex]={x:Z,y:tt,z:$,angle:ot})}else Fh(N,b)}if(v){x.clear();let P=e.icon.placedSymbolArray;for(let O=0;O<P.length;O++){let R=P.get(O),{numGlyphs:F}=R,N=C[O];if(R.hidden||!N)Fh(F,x);else{let{x:j,y:U,z:G,angle:Y}=N;for(let Z=0;Z<F;Z++)Ph(x,j,U,G,Y)}}e.icon.dynamicLayoutVertexBuffer.updateData(x)}e.text.dynamicLayoutVertexBuffer.updateData(b)}function uW(e,t,i){return i.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function $O(e,t,i,o,c,u,h,p,f,g,v,y,b){let x=e.context,C=x.gl,E=e.transform,M=p==="map",D=f==="map",A=M&&i.layout.get("symbol-placement")!=="point",P=M&&!D&&!A,O=i.layout.get("symbol-sort-key").constantOr(1)!==void 0,R=!1,F=e.depthModeForSublayer(0,He.ReadOnly),N=[eo(E.center.lng),uo(E.center.lat)],j=i.layout.get("text-variable-anchor"),U=E.projection.name==="globe",G=[],Y=[0,-1,0],Z=Y;!U&&!E.mercatorFromTransition||M||(Z=function(tt){let $=tt._camera.getWorldToCamera(tt.worldSize,1),rt=ft.multiply([],$,tt.globeMatrix);ft.invert(rt,rt);let st=[0,0,0],pt=[0,1,0,0];return hn.transformMat4(pt,pt,rt),st[0]=pt[0],st[1]=pt[1],st[2]=pt[2],J.normalize(st,st),st}(E));for(let tt of o){let $=t.getTile(tt),rt=$.getBucket(i);if(!rt||rt.projection.name==="mercator"&&U)continue;let st=c?rt.text:rt.icon;if(!st||rt.fullyClipped||!st.segments.get().length)continue;let pt=st.programConfigurations.get(i.id),nt=c||rt.sdfIcons,ot=c?rt.textSizeData:rt.iconSizeData,vt=D||E.pitch!==0,bt=Tl(ot,E.zoom),yt,Ct,Et,It,xt=[0,0],Ft=null;if(c)Ct=$.glyphAtlasTexture?$.glyphAtlasTexture:null,Et=C.LINEAR,yt=$.glyphAtlasTexture?$.glyphAtlasTexture.size:[0,0],rt.iconsInText&&(xt=$.imageAtlasTexture?$.imageAtlasTexture.size:[0,0],Ft=$.imageAtlasTexture?$.imageAtlasTexture:null,It=vt||e.options.rotating||e.options.zooming||ot.kind==="composite"||ot.kind==="camera"?C.LINEAR:C.NEAREST);else{let $n=i.layout.get("icon-size").constantOr(0)!==1||rt.iconsNeedLinear;Ct=$.imageAtlasTexture?$.imageAtlasTexture:null,Et=nt||e.options.rotating||e.options.zooming||$n||vt?C.LINEAR:C.NEAREST,yt=$.imageAtlasTexture?$.imageAtlasTexture.size:[0,0]}let te=rt.projection.name==="globe",ee=te?Z:Y,de=te?Co(E.zoom):0,me=KC(tt,rt.getProjection(),E),Ge=E.calculatePixelsToTileUnitsMatrix($),Ie=R0(me,$.tileID.canonical,D,M,E,rt.getProjection(),Ge),Ui=e.terrain&&D&&A?ft.invert(ft.create(),Ie):WO,Mi=FR(me,$.tileID.canonical,D,M,E,rt.getProjection(),Ge),qe=j&&rt.hasTextData(),je=rt.hasIconTextFit()&&qe&&rt.hasIconData();if(A){let $n=E.elevation,an=$n?$n.getAtTileOffsetFunc(tt,E.center.lat,E.worldSize,rt.getProjection()):null,Po=OR(me,$.tileID.canonical,D,M,E,rt.getProjection(),Ge);cG(rt,me,e,c,Po,Mi,D,g,an,tt)}let ke=A||c&&j||je,Ii=e.translatePosMatrix(me,$,u,h),Vi=ke?WO:Ie,gi=e.translatePosMatrix(Mi,$,u,h,!0),bn=rt.getProjection().createInversionMatrix(E,tt.canonical),Ar=i.paint.get("icon-image-cross-fade").constantOr(0),mn=[];e.terrainRenderModeElevated()&&D&&mn.push("PITCH_WITH_MAP_TERRAIN"),te&&(mn.push("PROJECTION_GLOBE_VIEW"),ke&&mn.push("PROJECTED_POS_ON_VIEWPORT")),Ar>0&&mn.push("ICON_TRANSITION"),st.zOffsetVertexBuffer&&mn.push("Z_OFFSET");let jn=nt&&i.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0,zr;nt?zr=rt.iconsInText?oW(ot.kind,bt,P,D,e,Ii,Vi,gi,yt,xt,tt,de,N,bn,ee,rt.getProjection()):UO(ot.kind,bt,P,D,e,Ii,Vi,gi,c,yt,!0,tt,de,N,bn,ee,rt.getProjection()):(v<1&&mn.push("SATURATION"),zr=jO(ot.kind,bt,P,D,e,Ii,Vi,gi,c,yt,tt,de,N,bn,ee,rt.getProjection(),v,Ar));let kr={program:e.getOrCreateProgram(uW(nt,c,rt),{config:pt,defines:mn}),buffers:st,uniformValues:zr,atlasTexture:Ct,atlasTextureIcon:Ft,atlasInterpolation:Et,atlasInterpolationIcon:It,isSDF:nt,hasHalo:jn,tile:$,labelPlaneMatrixInv:Ui};if(O&&rt.canOverlap){R=!0;let $n=st.segments.get();for(let an of $n)G.push({segments:new un([an]),sortKey:an.sortKey,state:kr})}else G.push({segments:st.segments,sortKey:0,state:kr})}R&&G.sort((tt,$)=>tt.sortKey-$.sortKey);for(let tt of G){let $=tt.state;if(e.terrain&&e.terrain.setupElevationDraw($.tile,$.program,{useDepthForOcclusion:E.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:$.labelPlaneMatrixInv}),x.activeTexture.set(C.TEXTURE0),$.atlasTexture&&$.atlasTexture.bind($.atlasInterpolation,C.CLAMP_TO_EDGE),$.atlasTextureIcon&&(x.activeTexture.set(C.TEXTURE1),$.atlasTextureIcon&&$.atlasTextureIcon.bind($.atlasInterpolationIcon,C.CLAMP_TO_EDGE)),e.uploadCommonLightUniforms(e.context,$.program),$.hasHalo){let rt=$.uniformValues;rt.u_is_halo=1,oS($.buffers,tt.segments,i,e,$.program,F,y,b,rt,2),rt.u_is_halo=0}else{if($.isSDF){let rt=$.uniformValues;$.hasHalo&&(rt.u_is_halo=1,oS($.buffers,tt.segments,i,e,$.program,F,y,b,rt,1)),rt.u_is_halo=0}oS($.buffers,tt.segments,i,e,$.program,F,y,b,$.uniformValues,1)}}}function oS(e,t,i,o,c,u,h,p,f,g){let v=[e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.iconTransitioningVertexBuffer,e.globeExtVertexBuffer,e.zOffsetVertexBuffer];c.draw(o,o.context.gl.TRIANGLES,u,h,p,bi.disabled,f,i.id,e.layoutVertexBuffer,e.indexBuffer,t,i.paint,o.transform.zoom,e.programConfigurations.get(i.id),v,g)}function YO(e,t,i,o,c,u,h){let p=e.context.gl,f=i.paint.get("fill-pattern"),g=f&&f.constantOr(1),v,y,b,x,C;h?(y=g&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",v=p.LINES):(y=g?"fillPattern":"fill",v=p.TRIANGLES);for(let E of o){let M=t.getTile(E);if(g&&!M.patternsLoaded())continue;let D=M.getBucket(i);if(!D)continue;e.prepareDrawTile();let A=D.programConfigurations.get(i.id),P=e.isTileAffectedByFog(E),O=e.getOrCreateProgram(y,{config:A,overrideFog:P});g&&(e.context.activeTexture.set(p.TEXTURE0),M.imageAtlasTexture&&M.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),A.updatePaintBuffers());let R=f.constantOr(null);if(R&&M.imageAtlas){let j=M.imageAtlas.patternPositions[R.toString()];j&&A.setConstantPatternPositions(j)}let F=e.translatePosMatrix(E.projMatrix,M,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor")),N=i.paint.get("fill-emissive-strength");if(h){x=D.indexBuffer2,C=D.segments2;let j=e.terrain&&e.terrain.renderingToTexture?e.terrain.drapeBufferSize:[p.drawingBufferWidth,p.drawingBufferHeight];b=y==="fillOutlinePattern"&&g?Qq(F,N,e,M,j):Kq(F,N,j)}else x=D.indexBuffer,C=D.segments,b=g?zO(F,N,e,M):LO(F,N);e.uploadCommonUniforms(e.context,O,E.toUnwrapped()),O.draw(e,v,c,e.stencilModeForClipping(E),u,bi.disabled,b,i.id,D.layoutVertexBuffer,x,C,i.paint,e.transform.zoom,A,void 0)}}function tv(e,t,i,o,c,u,h,p){i.resetLayerRenderingStats();let f=e.context,g=f.gl,v=e.transform,y=i.paint.get("fill-extrusion-pattern"),b=y.constantOr(1),x=i.paint.get("fill-extrusion-opacity"),C=e.style.enable3dLights(),E=i.paint.get(C&&!b?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),M=[i.paint.get("fill-extrusion-ambient-occlusion-intensity"),E],D=i.layout.get("fill-extrusion-edge-radius"),A=D>0&&!i.paint.get("fill-extrusion-rounded-roof"),P=A?0:D,O=v.projection.name==="globe"?_P():0,R=v.projection.name==="globe",F=R?Co(v.zoom):0,N=[eo(v.center.lng),uo(v.center.lat)],j=i.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),U=i.paint.get("fill-extrusion-flood-light-intensity"),G=i.paint.get("fill-extrusion-vertical-scale"),Y=Nh(e,i.paint.get("fill-extrusion-cutoff-fade-range")),Z=i.paint.get("fill-extrusion-emissive-strength"),tt=[],$;R&&tt.push("PROJECTION_GLOBE_VIEW"),M[0]>0&&tt.push("FAUX_AO"),A&&tt.push("ZERO_ROOF_RADIUS"),p&&tt.push("HAS_CENTROID"),U>0&&tt.push("FLOOD_LIGHT"),Y.shouldRenderCutoff&&tt.push("RENDER_CUTOFF");let rt=e.renderPass==="shadow",st=e.shadowRenderer,pt=rt&&!!st;e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!0);let nt=[0,0,0];if(st){let bt=e.style.directionalLight,yt=e.style.ambientLight;bt&&yt&&(nt=lS(bt,yt)),$=tt.concat(["SHADOWS_SINGLE_CASCADE"])}let ot=pt?"fillExtrusionDepth":b?"fillExtrusionPattern":"fillExtrusion",vt=i.getLayerRenderingStats();for(let bt of o){let yt=t.getTile(bt),Ct=yt.getBucket(i);if(!Ct||Ct.projection.name!==v.projection.name)continue;let Et=!1;st&&(Et=st.getMaxCascadeForTile(bt.toUnwrapped())===0);let It=e.isTileAffectedByFog(bt),xt=Ct.programConfigurations.get(i.id),Ft=e.getOrCreateProgram(ot,{config:xt,defines:Et?$:tt,overrideFog:It});if(e.terrain&&e.terrain.setupElevationDraw(yt,Ft,{useMeterToDem:!0}),!Ct.centroidVertexBuffer){let Ie=Ft.attributes.a_centroid_pos;Ie!==void 0&&g.vertexAttrib2f(Ie,0,0)}!rt&&st&&st.setupShadows(yt.tileID.toUnwrapped(),Ft,"vector-tile",yt.tileID.overscaledZ),b&&(e.context.activeTexture.set(g.TEXTURE0),yt.imageAtlasTexture&&yt.imageAtlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),xt.updatePaintBuffers());let te=y.constantOr(null);if(te&&yt.imageAtlas){let Ie=yt.imageAtlas.patternPositions[te.toString()];Ie&&xt.setConstantPatternPositions(Ie)}let ee=i.paint.get("fill-extrusion-vertical-gradient"),de;if(rt&&st){if(gW(yt.tileID,Ct,e))continue;let Ie=st.calculateShadowPassMatrixFromTile(yt.tileID.toUnwrapped());de=Zq(Ie,P,G)}else{let Ie=e.translatePosMatrix(bt.expandedProjMatrix,yt,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),Ui=v.projection.createInversionMatrix(v,bt.canonical);de=b?Xq(Ie,e,ee,x,M,P,bt,yt,O,F,N,Ui,j,G):FO(Ie,e,ee,x,M,P,bt,O,F,N,Ui,j,G,U,nt,Z)}e.uploadCommonUniforms(f,Ft,bt.toUnwrapped(),null,Y);let me=Ct.segments;if(v.projection.name==="mercator"&&!rt&&(me=Ct.getVisibleSegments(yt.tileID,e.terrain,e.transform.getFrustum(0)),!me.get().length))continue;if(vt)if(rt)for(let Ie of me.get())vt.numRenderedVerticesInShadowPass+=Ie.primitiveLength;else for(let Ie of me.get())vt.numRenderedVerticesInTransparentPass+=Ie.primitiveLength;let Ge=[];(e.terrain||p)&&Ge.push(Ct.centroidVertexBuffer),R&&Ge.push(Ct.layoutVertexExtBuffer),Ft.draw(e,f.gl.TRIANGLES,c,u,h,bi.backCCW,de,i.id,Ct.layoutVertexBuffer,Ct.indexBuffer,me,i.paint,e.transform.zoom,xt,Ge)}e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!1)}function Vh(e,t,i,o,c,u,h,p,f,g,v,y,b,x,C,E,M,D,A){let P=e.context,O=P.gl,R=e.transform,F=e.transform.zoom,N=[],j=Nh(e,i.paint.get("fill-extrusion-cutoff-fade-range"));g==="clear"?(N.push("CLEAR_SUBPASS"),A&&(N.push("CLEAR_FROM_TEXTURE"),P.activeTexture.set(O.TEXTURE0),A.bind(O.LINEAR,O.CLAMP_TO_EDGE))):g==="sdf"&&N.push("SDF_SUBPASS"),M&&N.push("HAS_CENTROID"),j.shouldRenderCutoff&&N.push("RENDER_CUTOFF");let U=i.layout.get("fill-extrusion-edge-radius"),G=(Y,Z,tt,$,rt)=>{let st=Z.programConfigurations.get(i.id),pt=e.isTileAffectedByFog(Y),nt=e.getOrCreateProgram("fillExtrusionGroundEffect",{config:st,defines:N,overrideFog:pt}),ot=((bt,yt,Ct,Et,It,xt,Ft,te,ee,de,me)=>({u_matrix:yt,u_opacity:Ct,u_ao_pass:Et?1:0,u_meter_to_tile:It,u_ao:xt,u_flood_light_intensity:Ft,u_flood_light_color:te,u_attenuation:ee,u_edge_radius:de,u_fb:0,u_fb_size:me}))(0,$,v,f,rt,[y,b*rt],x,C,E,F>=17?0:U*rt,A?A.size[0]:0),vt=[];M&&vt.push(Z.hiddenByLandmarkVertexBuffer),e.uploadCommonUniforms(P,nt,Y.toUnwrapped(),null,j),nt.draw(e,P.gl.TRIANGLES,c,u,h,p,ot,i.id,Z.vertexBuffer,Z.indexBuffer,tt,i.paint,F,st,vt)};for(let Y of o){let Z=t.getTile(Y),tt=Z.getBucket(i);if(!tt||tt.projection.name!==R.projection.name||!tt.groundEffect||tt.groundEffect&&!tt.groundEffect.hasData())continue;let $=tt.groundEffect,rt=1/tt.tileToMeter;{let st=e.translatePosMatrix(Y.projMatrix,Z,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),pt=$.getDefaultSegment();G(Y,$,pt,st,rt)}if(D)for(let st=0;st<4;st++){let pt=UA[st](Y),nt=t.getTile(pt);if(!nt)continue;let ot=nt.getBucket(i);if(!ot||ot.projection.name!==R.projection.name||!ot.groundEffect||ot.groundEffect&&!ot.groundEffect.hasData())continue;let vt=ot.groundEffect,bt,yt;st===0?(bt=[-wt,0,0],yt=1):st===1?(bt=[wt,0,0],yt=0):st===2?(bt=[0,-wt,0],yt=3):(bt=[0,wt,0],yt=2);let Ct=vt.regionSegments[yt];if(!Ct)continue;let Et=new Float32Array(16);ft.translate(Et,Y.projMatrix,bt),G(Y,vt,Ct,e.translatePosMatrix(Et,Z,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),rt)}}}function hW(e,t,i,o,c,u,h){o.centroidVertexArray.length===0&&o.createCentroidsBuffer();let p=u?u.findDEMTileFor(i):null;if(!(p&&p.dem||h))return;let f=D=>{let A=t.getSource().minzoom,P=R=>{let F=t.getTileByID(R);if(F&&F.hasData())return F.getBucket(c)},O=[0,-1,1];for(let R of O){if(D.overscaledZ+R<A)continue;let F=P(D.calculateScaledKey(D.overscaledZ+R));if(F)return F}},g=[0,0,0],v=(D,A)=>(g[0]=Math.min(D.min.y,A.min.y),g[1]=Math.max(D.max.y,A.max.y),g[2]=wt-A.min.x>D.max.x?A.min.x-wt:D.max.x,g),y=(D,A)=>(g[0]=Math.min(D.min.x,A.min.x),g[1]=Math.max(D.max.x,A.max.x),g[2]=wt-A.min.y>D.max.y?A.min.y-wt:D.max.y,g),b=[(D,A)=>v(D,A),(D,A)=>v(A,D),(D,A)=>y(D,A),(D,A)=>y(A,D)],x=(D,A,P,O,R,F,N)=>{if(!u)return 0;let j=[[F?P:D,F?D:P,0],[F?P:A,F?A:P,0]],U=N<0?wt+N:N,G=[F?U:(D+A)/2,F?(D+A)/2:U,0];return P===0&&N<0||P!==0&&N>0?u.getForTilePoints(R,[G],!0,O):j.push(G),u.getForTilePoints(i,j,!0,p),Math.max(j[0][2],j[1][2],G[2])/u.exaggeration()};for(let D=0;D<4;D++){let A=o.borderFeatureIndices[D];if(A.length===0)continue;let P=UA[D](i),O=f(P);if(!(O&&O instanceof rf)||o.borderDoneWithNeighborZ[D]===O.canonical.z)continue;O.centroidVertexArray.length===0&&O.createCentroidsBuffer();let R=u?u.findDEMTileFor(P):null;if(!(R&&R.dem||h))continue;let F=(D<2?1:5)-D,N=O.borderDoneWithNeighborZ[F]!==o.canonical.z,j=O.borderFeatureIndices[F],U=0;if(o.canonical.z!==O.canonical.z){for(let G of A)o.showCentroid(o.featuresOnBorder[G]);if(N)for(let G of j)O.showCentroid(O.featuresOnBorder[G]);o.borderDoneWithNeighborZ[D]=O.canonical.z,O.borderDoneWithNeighborZ[F]=o.canonical.z}for(let G of A){let Y=o.featuresOnBorder[G],Z=o.centroidData[Y.centroidDataIndex],tt=Y.borders[D],$;for(;U<j.length;){$=O.featuresOnBorder[j[U]];let rt=$.borders[F];if(rt[1]>tt[0]+3||rt[0]>tt[0]-3)break;O.showCentroid($),U++}if($&&U<j.length){let rt=U,st=0;for(;!($.borders[F][0]>tt[1]-3)&&(st++,++U!==j.length);)$=O.featuresOnBorder[j[U]];if($=O.featuresOnBorder[j[rt]],st>1){let ot=$.borders[F];Math.abs(tt[0]-ot[0])<3&&Math.abs(tt[1]-ot[1])<3&&(st=1,U=rt+1)}else if(st===0){o.showCentroid(Y);continue}let pt=O.centroidData[$.centroidDataIndex];h&&st===1&&(((E=Z).flags|(M=pt).flags)&kl?(E.flags|=kl,M.flags|=kl):(E.flags&=2147483647,M.flags&=2147483647));let nt=new Q(0,0);if(st>1)U=rt;else if(R&&R.dem&&!(Y.intersectsCount()>1||$.intersectsCount()>1)){let ot=b[D](Z,pt),vt=D%2?wt-1:0;C=x(ot[0],Math.min(wt-1,ot[1]),vt,R,P,D<2,ot[2]),nt=new Q(Math.ceil(7*(C+450)),0)}Z.centroidXY=pt.centroidXY=nt,o.writeCentroidToBuffer(Z),O.writeCentroidToBuffer(pt)}else o.showCentroid(Y)}o.borderDoneWithNeighborZ[D]=O.canonical.z,O.borderDoneWithNeighborZ[F]=o.canonical.z}var C,E,M;(o.needsCentroidUpdate||!o.centroidVertexBuffer&&o.centroidVertexArray.length!==0)&&o.uploadCentroid(e)}let mW=[1,0,0],pW=[0,1,0],fW=[0,0,1];function gW(e,t,i){let o=i.transform,c=i.shadowRenderer;if(!c)return!0;let u=e.toUnwrapped(),h=o.tileSize*c._cascades[i.currentShadowCascade].scale,p=t.maxHeight;if(o.elevation){let E=o.elevation.getMinMaxForTile(e);E&&(p+=E.max)}let f=[...c.shadowDirection];f[2]=-f[2];let g=c.computeSimplifiedTileShadowVolume(u,p,h,f);if(!g)return!1;let v=[mW,pW,fW,f,[f[0],0,f[2]],[0,f[1],f[2]]],y=o.projection.name==="globe",b=o.scaleZoom(h),x=mc.fromInvProjectionMatrix(o.invProjMatrix,o.worldSize,b,!y),C=c.getCurrentCascadeFrustum();return x.intersectsPrecise(g.vertices,g.planes,v)===0||C.intersectsPrecise(g.vertices,g.planes,v)===0}function _W(e){let t=e._nearZ,i=e.projection.farthestPixelDistance(e),o=i-t,c=.2*e.height,u=t+c;return[t,i,(u-c-t)/o,(u-t)/o]}let vW=new _i(1,0,0,1),yW=new _i(0,1,0,1),bW=new _i(0,0,1,1),xW=new _i(1,0,1,1),wW=new _i(0,1,1,1);function CW(e,t,i){let o=e.context,c=e.transform,u=o.gl,h=c.projection.name==="globe",p=h?["PROJECTION_GLOBE_VIEW"]:[],f=i.projMatrix;if(h&&Co(c.zoom)>0){let G=jw($A(i.canonical,c));f=ft.multiply(new Float32Array(16),c.globeMatrix,G),ft.multiply(f,c.projMatrix,f)}let g=e.getOrCreateProgram("debug",{defines:p}),v=t.getTileByID(i.key);e.terrain&&e.terrain.setupElevationDraw(v,g);let y=He.disabled,b=vi.disabled,x=e.colorModeForRenderPass(),C="$debug";o.activeTexture.set(u.TEXTURE0),e.emptyTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),h?v._makeGlobeTileDebugBuffers(e.context,c):v._makeDebugTileBoundsBuffers(e.context,c.projection);let E=v._tileDebugBuffer||e.debugBuffer,M=v._tileDebugIndexBuffer||e.debugIndexBuffer,D=v._tileDebugSegments||e.debugSegments;g.draw(e,u.LINE_STRIP,y,b,x,bi.disabled,NO(f,_i.red),C,E,M,D,null,null,null,[v._globeTileDebugBorderBuffer]);let A=v.latestRawTileData,P=Math.floor((A&&A.byteLength||0)/1024),O=t.getTile(i).tileSize,R=512/Math.min(O,512)*(i.overscaledZ/c.zoom)*.5,F=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(F+=` => ${i.overscaledZ}`),F+=` ${P}kb`,function(G,Y){G.initDebugOverlayCanvas();let Z=G.debugOverlayCanvas,tt=G.context.gl,$=G.debugOverlayCanvas.getContext("2d");$.clearRect(0,0,Z.width,Z.height),$.shadowColor="white",$.shadowBlur=2,$.lineWidth=1.5,$.strokeStyle="white",$.textBaseline="top",$.font="bold 36px Open Sans, sans-serif",$.fillText(Y,5,5),$.strokeText(Y,5,5),G.debugOverlayTexture.update(Z),G.debugOverlayTexture.bind(tt.LINEAR,tt.CLAMP_TO_EDGE)}(e,F);let N=v._tileDebugTextBuffer||e.debugBuffer,j=v._tileDebugTextIndexBuffer||e.quadTriangleIndexBuffer,U=v._tileDebugTextSegments||e.debugSegments;g.draw(e,u.TRIANGLES,y,b,Gi.alphaBlended,bi.disabled,NO(f,_i.transparent,R),C,N,j,U,null,null,null,[v._globeTileDebugTextBuffer])}function ZO(e,t,i,o){ev(e,0,t+i/2,e.transform.width,i,o)}function XO(e,t,i,o){ev(e,t-i/2,0,i,e.transform.height,o)}function ev(e,t,i,o,c,u){let h=e.context,p=h.gl;p.enable(p.SCISSOR_TEST),p.scissor(t*ii.devicePixelRatio,i*ii.devicePixelRatio,o*ii.devicePixelRatio,c*ii.devicePixelRatio),h.clear({color:u}),p.disable(p.SCISSOR_TEST)}let SW=Ji([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:EW}=SW;function hd(e,t,i,o){e.emplaceBack(t,i,o)}class KO{constructor(t){this.vertexArray=new iu,this.indices=new qr,hd(this.vertexArray,-1,-1,1),hd(this.vertexArray,1,-1,1),hd(this.vertexArray,-1,1,1),hd(this.vertexArray,1,1,1),hd(this.vertexArray,-1,-1,-1),hd(this.vertexArray,1,-1,-1),hd(this.vertexArray,-1,1,-1),hd(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,EW),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=un.simpleSegment(0,0,36,12)}}function jh(e,t,i,o,c,u){let h=e.context.gl,p=t.paint.get("sky-atmosphere-color"),f=t.paint.get("sky-atmosphere-halo-color"),g=t.paint.get("sky-atmosphere-sun-intensity"),v=((y,b,x,C,E)=>({u_matrix_3f:y,u_sun_direction:b,u_sun_intensity:x,u_color_tint_r:[C.r,C.g,C.b,C.a],u_color_tint_m:[E.r,E.g,E.b,E.a],u_luminance:5e-5}))(us.fromMat4(us.create(),o),c,g,p,f);h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_CUBE_MAP_POSITIVE_X+u,t.skyboxTexture,0),i.draw(e,h.TRIANGLES,He.disabled,vi.disabled,Gi.unblended,bi.frontCW,v,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}let MW=Ji([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class DW{constructor(t){let i=new eu;i.emplaceBack(-1,1,1,0,0),i.emplaceBack(1,1,1,1,0),i.emplaceBack(1,-1,1,1,1),i.emplaceBack(-1,-1,1,0,1);let o=new qr;o.emplaceBack(0,1,2),o.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(i,MW.members),this.indexBuffer=t.createIndexBuffer(o),this.segments=un.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let TW=Ji([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class IW{constructor(){this.colorModeAlphaBlendedWriteRGB=new Gi([1,A0,1,A0],_i.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Gi([1,0,1,0],_i.transparent,[!1,!1,!1,!0])}update(t){let i=t.context;if(!this.atmosphereBuffer){this.atmosphereBuffer=new DW(i);let o=100,c=200,u=function(v){let y=P1(30),b=[];for(let x=0;x<16e3;++x){let C=2*Math.PI*y(),E=Math.acos(1-2*y())-.5*Math.PI;b.push(J.fromValues(Math.cos(E)*Math.cos(C),Math.cos(E)*Math.sin(C),Math.sin(E)))}return b}(),h=P1(300),p=new dw,f=new qr,g=0;for(let v=0;v<u.length;++v){let y=J.scale([],u[v],200),b=Math.max(0,1+.01*o*(1*h()-.5)),x=Math.max(0,1+.01*c*(1*h()-.5));p.emplaceBack(y[0],y[1],y[2],-1,-1,b,x),p.emplaceBack(y[0],y[1],y[2],1,-1,b,x),p.emplaceBack(y[0],y[1],y[2],1,1,b,x),p.emplaceBack(y[0],y[1],y[2],-1,1,b,x),f.emplaceBack(g+0,g+1,g+2),f.emplaceBack(g+0,g+2,g+3),g+=4}this.starsVx=i.createVertexBuffer(p,TW.members),this.starsIdx=i.createIndexBuffer(f),this.starsSegments=un.simpleSegment(0,0,p.length,f.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,i){let o=t.context,c=o.gl,u=t.transform,h=new He(c.LEQUAL,He.ReadOnly,[0,1]),p=Co(u.zoom),f=i.properties.get("color").toArray01(),g=i.properties.get("high-color").toArray01(),v=i.properties.get("space-color").toArray01PremultipliedAlpha(),y=5e-4,b=ve((i.properties.get("horizon-blend")-0)/1*.2495+y,5e-4,.25),x=tk(t,o,u)&&b===y?u.worldSize/(2*Math.PI*1.025)-1:u.globeRadius,C=t.frameCounter/1e3%1,E=J.length(u.globeCenterInViewSpace),M=Math.sqrt(Math.pow(E,2)-Math.pow(x,2)),D=Math.acos(M/E),A=P=>{let O=u.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];P&&O.push("ALPHA_PASS");let R=t.getOrCreateProgram("globeAtmosphere",{defines:O}),F=((j,U,G,Y,Z,tt,$,rt,st,pt,nt,ot)=>({u_frustum_tl:j,u_frustum_tr:U,u_frustum_br:G,u_frustum_bl:Y,u_horizon:Z,u_transition:tt,u_fadeout_range:$,u_color:rt,u_high_color:st,u_space_color:pt,u_temporal_offset:nt,u_horizon_angle:ot}))(u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.frustumCorners.horizon,p,b,f,g,v,C,D);t.uploadCommonUniforms(o,R);let N=this.atmosphereBuffer;N&&R.draw(t,c.TRIANGLES,h,vi.disabled,P?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,bi.backCW,F,P?"atmosphere_glow_alpha":"atmosphere_glow",N.vertexBuffer,N.indexBuffer,N.segments)};A(!1),A(!0)}drawStars(t,i){let o=ve(i.properties.get("star-intensity"),0,1);if(o===0)return;let c=t.context,u=c.gl,h=t.transform,p=t.getOrCreateProgram("stars"),f=Vo.identity([]);Vo.rotateX(f,f,-h._pitch),Vo.rotateZ(f,f,-h.angle),Vo.rotateX(f,f,fe(h._center.lat)),Vo.rotateY(f,f,-fe(h._center.lng));let g=ft.fromQuat(new Float32Array(16),f),v=ft.multiply([],h.starsProjMatrix,g),y=us.fromMat4([],g),b=us.invert([],y),x=[0,1,0];J.transformMat3(x,x,b),J.scale(x,x,.15);let C=[1,0,0];J.transformMat3(C,C,b),J.scale(C,C,.15);let E=((M,D,A,P)=>({u_matrix:Float32Array.from(M),u_up:D,u_right:A,u_intensity_multiplier:P}))(v,x,C,o);t.uploadCommonUniforms(c,p),this.starsVx&&this.starsIdx&&p.draw(t,u.TRIANGLES,He.disabled,vi.disabled,this.colorModeAlphaBlendedWriteRGB,bi.disabled,E,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function QO(e,t){let i=[...e],o=t.cameraWorldSizeForFog/t.worldSize,c=ft.identity([]);return ft.scale(c,c,[o,o,1]),ft.multiply(i,c,i),ft.multiply(i,t.worldToFogMatrix,i),i}function sS(e,t,i,o){let c=i.material,u=o.context,{baseColorTexture:h,metallicRoughnessTexture:p}=c.pbrMetallicRoughness,{normalTexture:f,occlusionTexture:g,emissionTexture:v}=c;function y(b,x,C){if(b&&(e.push(x),u.activeTexture.set(u.gl.TEXTURE0+C),b.gfxTexture)){let{minFilter:E,magFilter:M,wrapS:D,wrapT:A}=b.sampler;b.gfxTexture.bindExtraParam(E,M,D,A)}}y(h,"HAS_TEXTURE_u_baseColorTexture",Ts.BaseColor),y(p,"HAS_TEXTURE_u_metallicRoughnessTexture",Ts.MetallicRoughness),y(f,"HAS_TEXTURE_u_normalTexture",Ts.Normal),y(g,"HAS_TEXTURE_u_occlusionTexture",Ts.Occlusion),y(v,"HAS_TEXTURE_u_emissionTexture",Ts.Emission),i.texcoordBuffer&&(e.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(i.texcoordBuffer)),i.colorBuffer&&(e.push(i.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(i.colorBuffer)),i.normalBuffer&&(e.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(i.normalBuffer)),i.pbrBuffer&&(e.push("HAS_ATTRIBUTE_a_pbr"),e.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(i.pbrBuffer)),c.alphaMode!=="OPAQUE"&&c.alphaMode!=="MASK"||e.push("UNPREMULT_TEXTURE_IN_SHADER"),c.defined||e.push("DIFFUSE_SHADED"),e.push("USE_STANDARD_DERIVATIVES")}function iv(e,t,i,o,c,u){let h=i.paint.get("model-opacity"),p=t.context,f=new He(t.context.gl.LEQUAL,He.ReadWrite,t.depthRangeFor3D),g=t.transform,v=e.mesh,y=v.material,b=y.pbrMetallicRoughness,x=t.style.fog,C;C=t.transform.projection.zAxisUnit==="pixels"?[...e.nodeModelMatrix]:ft.multiply([],o.zScaleMatrix,e.nodeModelMatrix),ft.multiply(C,o.negCameraPosMatrix,C);let E=ft.invert([],C);ft.transpose(E,E);let M=i.paint.get("model-emissive-strength").constantOr(0),D=rS(new Float32Array(e.worldViewProjection),new Float32Array(C),new Float32Array(E),t,h,b.baseColorFactor,y.emissiveFactor,b.metallicFactor,b.roughnessFactor,y,M,i),A={defines:[]},P=[];sS(A.defines,P,v,t);let O=t.shadowRenderer;O&&(O.useNormalOffset=!1);let R=null;if(x){let j=QO(e.nodeModelMatrix,t.transform);if(R=new Float32Array(j),g.projection.name!=="globe"){let U=v.aabb.min,G=v.aabb.max,[Y,Z]=x.getOpacityForBounds(j,U[0],U[1],G[0],G[1]);A.overrideFog=Y>=uu||Z>=uu}}let F=Nh(t,i.paint.get("model-cutoff-fade-range"));F.shouldRenderCutoff&&A.defines.push("RENDER_CUTOFF");let N=t.getOrCreateProgram("model",A);t.uploadCommonUniforms(p,N,null,R,F),t.renderPass!=="shadow"&&O&&O.setupShadowsFromMatrix(e.nodeModelMatrix,N),N.draw(t,p.gl.TRIANGLES,f,c,u,v.material.doubleSided?bi.disabled:bi.backCCW,D,i.id,v.vertexBuffer,v.indexBuffer,v.segments,i.paint,t.transform.zoom,void 0,P)}function JO(e,t,i,o,c,u,h){let p;p=e.projection.name==="globe"?WR(i,e):[...i],ft.multiply(p,p,t.matrix);let f=ft.multiply([],o,p);if(t.meshes)for(let g of t.meshes){if(g.material.alphaMode!=="BLEND"){h.push({mesh:g,depth:0,modelIndex:c,worldViewProjection:f,nodeModelMatrix:p});continue}let v=J.transformMat4([],g.centroid,f);v[2]>0&&u.push({mesh:g,depth:v[2],modelIndex:c,worldViewProjection:f,nodeModelMatrix:p})}if(t.children)for(let g of t.children)JO(e,g,i,o,c,u,h)}function aS(e,t,i,o){let c=i.shadowRenderer;if(!c)return;let u=c.getShadowPassDepthMode(),h=c.getShadowPassColorMode(),p=c.calculateShadowPassMatrixFromMatrix(t),f=GO(p);i.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(i,i.context.gl.TRIANGLES,u,vi.disabled,h,bi.backCCW,f,o.id,e.vertexBuffer,e.indexBuffer,e.segments,o.paint,i.transform.zoom,void 0,void 0)}function AW(e,t,i){let o=t.updateZoomBasedPaintProperties(),c=function(u,h,p){let f,g,v,y=u.terrain?u.terrain.exaggeration():0;if(u.terrain&&y>0){let b=u.terrain,x=b.findDEMTileFor(p);x&&x.dem?f=Dh.create(b,p,x):y=0}if(y===0&&(h.terrainElevationMin=0,h.terrainElevationMax=0),y===h.validForExaggeration&&(y===0||f&&f._demTile&&f._demTile.tileID===h.validForDEMTile.id&&f._dem._timestamp===h.validForDEMTile.timestamp))return!1;for(let b in h.instancesPerModel){let x=h.instancesPerModel[b];for(let C=0;C<x.instancedDataArray.length;++C){let E=(f?y*f.getElevationAt(0|x.instancedDataArray.float32[16*C],0|x.instancedDataArray.float32[16*C+1],!0,!0):0)+x.instancesEvaluatedElevation[C];x.instancedDataArray.float32[16*C+6]=E,g=g?Math.min(h.terrainElevationMin,E):E,v=v?Math.max(h.terrainElevationMax,E):E}}return h.terrainElevationMin=g||0,h.terrainElevationMax=v||0,h.validForExaggeration=y,h.validForDEMTile=f&&f._demTile?{id:f._demTile.tileID,timestamp:f._dem._timestamp}:{id:void 0,timestamp:0},!0}(e,t,i);(o||c)&&(t.uploaded=!1,t.upload(e.context))}let Pl={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new Vn([0,0,0],[wt,wt,0])};function kW(e,t){let i=1<<e.canonical.z,o=t.getFreeCameraOptions().position,c=t.elevation,u=e.canonical.x/i,h=(e.canonical.x+1)/i,p=e.canonical.y/i,f=(e.canonical.y+1)/i,g=t._centerAltitude;if(c){let x=c.getMinMaxForTile(e);x&&x.max>g&&(g=x.max)}let v=ve(o.x,u,h)-o.x,y=ve(o.y,p,f)-o.y,b=yn(g,t.center.lat)-o.z;return t._zoomFromMercatorZ(Math.sqrt(v*v+y*y+b*b))}function tF(e,t,i,o,c,u,h){let p=e.context,f=e.renderPass==="shadow",g=e.shadowRenderer,v=f&&g?g.getShadowPassDepthMode():new He(p.gl.LEQUAL,He.ReadWrite,e.depthRangeFor3D),y=e.isTileAffectedByFog(u);if(i.meshes)for(let b of i.meshes){let x=["MODEL_POSITION_ON_GPU"],C=[],E,M,D;o.instancedDataArray.length>20&&x.push("INSTANCED_ARRAYS");let A=Nh(e,t.paint.get("model-cutoff-fade-range"));if(A.shouldRenderCutoff&&x.push("RENDER_CUTOFF"),f&&g)E=e.getOrCreateProgram("modelDepth",{defines:x}),M=GO(h.shadowTileMatrix,h.shadowTileMatrix,Float32Array.from(i.matrix)),D=g.getShadowPassColorMode();else{sS(x,C,b,e),E=e.getOrCreateProgram("model",{defines:x,overrideFog:y});let O=b.material,R=O.pbrMetallicRoughness,F=t.paint.get("model-opacity"),N=t.paint.get("model-emissive-strength").constantOr(0);M=rS(u.expandedProjMatrix,Float32Array.from(i.matrix),new Float32Array(16),e,F,R.baseColorFactor,O.emissiveFactor,R.metallicFactor,R.roughnessFactor,O,N,t,c),g&&(h.shadowUniformsInitialized?E.setShadowUniformValues(p,g.getShadowUniformValues()):(g.setupShadows(u.toUnwrapped(),E,"model-tile",u.overscaledZ),h.shadowUniformsInitialized=!0)),D=A.shouldRenderCutoff||F<1||O.alphaMode!=="OPAQUE"?Gi.alphaBlended:Gi.unblended}e.uploadCommonUniforms(p,E,u.toUnwrapped(),null,A);let P=b.material.doubleSided?bi.disabled:bi.backCCW;if(o.instancedDataArray.length>20)C.push(o.instancedDataBuffer),E.draw(e,p.gl.TRIANGLES,v,vi.disabled,D,P,M,t.id,b.vertexBuffer,b.indexBuffer,b.segments,t.paint,e.transform.zoom,void 0,C,o.instancedDataArray.length);else{let O=f?"u_instance":"u_normal_matrix";for(let R=0;R<o.instancedDataArray.length;++R)M[O]=new Float32Array(o.instancedDataArray.arrayBuffer,64*R,16),E.draw(e,p.gl.TRIANGLES,v,vi.disabled,D,P,M,t.id,b.vertexBuffer,b.indexBuffer,b.segments,t.paint,e.transform.zoom,void 0,C)}}if(i.children)for(let b of i.children)tF(e,t,b,o,c,u,h)}let RW=[1,-1,1];function PW(e,t,i,o){if(!i.modelManager)return!0;let c=i.modelManager;if(!i.shadowRenderer)return!0;let u=i.shadowRenderer,h=t.aabb,p=!0,f=e.maxHeight;if(f===0){let v=0;for(let y in e.instancesPerModel){let b=c.getModel(y,o);b?v=Math.max(v,Math.max(Math.max(b.aabb.max[0],b.aabb.max[1]),b.aabb.max[2])):p=!1}f=e.maxScale*v*1.41+e.maxVerticalOffset,p&&(e.maxHeight=f)}h.max[2]=f,h.min[2]+=e.terrainElevationMin,h.max[2]+=e.terrainElevationMax,J.transformMat4(h.min,h.min,t.tileMatrix),J.transformMat4(h.max,h.max,t.tileMatrix);let g=h.intersects(u.getCurrentCascadeFrustum());return i.currentShadowCascade===0&&(e.isInsideFirstShadowMapFrustum=g===2),g===0}class OW{}class FW{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,i,o){{let y=this._storage.get(i.id);if(y)return y.lastUsedFrameIdx=t,y.buf}let c=o.gl,u=c.getBufferParameter(c.ELEMENT_ARRAY_BUFFER,c.BUFFER_SIZE),h=new ArrayBuffer(u),p=new Int16Array(h);c.getBufferSubData(c.ELEMENT_ARRAY_BUFFER,0,new Int16Array(h));let f=new $c;for(let y=0;y<u/2;y+=3){let b=p[y],x=p[y+1],C=p[y+2];f.emplaceBack(b,x),f.emplaceBack(x,C),f.emplaceBack(C,b)}let g=o.bindVertexArrayOES.current,v=new OW;return v.buf=new SR(o,f),v.lastUsedFrameIdx=t,this._storage.set(i.id,v),o.bindVertexArrayOES.set(g),v.buf}update(t){for(let[i,o]of this._storage)t-o.lastUsedFrameIdx>30&&(o.buf.destroy(),this._storage.delete(i))}destroy(){for(let[t,i]of this._storage)i.buf.destroy(),this._storage.delete(t)}}let eF={symbol:function(e,t,i,o,c){if(e.renderPass!=="translucent")return;let u=vi.disabled,h=e.colorModeForRenderPass();i.layout.get("text-variable-anchor")&&function(p,f,g,v,y,b,x){let C=f.transform,E=y==="map",M=b==="map";for(let D of p){let A=v.getTile(D),P=A.getBucket(g);if(!P||!P.text||!P.text.segments.get().length)continue;let O=Tl(P.textSizeData,C.zoom),R=KC(D,P.getProjection(),C),F=C.calculatePixelsToTileUnitsMatrix(A),N=R0(R,A.tileID.canonical,M,E,C,P.getProjection(),F),j=P.hasIconTextFit()&&P.hasIconData();if(O){let U=Math.pow(2,C.zoom-A.tileID.overscaledZ);dW(P,E,M,x,R8,C,N,D,U,O,j)}}}(o,e,i,t,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),c),i.paint.get("icon-opacity").constantOr(1)!==0&&$O(e,t,i,o,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright"),i.paint.get("icon-color-saturation"),u,h),i.paint.get("text-opacity").constantOr(1)!==0&&$O(e,t,i,o,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright"),i.paint.get("icon-color-saturation"),u,h),t.map.showCollisionBoxes&&(qO(e,t,i,o,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),qO(e,t,i,o,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1))},circle:function(e,t,i,o){if(e.renderPass!=="translucent")return;let c=i.paint.get("circle-opacity"),u=i.paint.get("circle-stroke-width"),h=i.paint.get("circle-stroke-opacity"),p=i.layout.get("circle-sort-key").constantOr(1)!==void 0,f=i.paint.get("circle-emissive-strength");if(c.constantOr(1)===0&&(u.constantOr(1)===0||h.constantOr(1)===0))return;let g=e.context,v=g.gl,y=e.transform,b=e.depthModeForSublayer(0,He.ReadOnly),x=vi.disabled,C=e.colorModeForDrapableLayerRenderPass(f),E=y.projection.name==="globe",M=[eo(y.center.lng),uo(y.center.lat)],D=[];for(let P=0;P<o.length;P++){let O=o[P],R=t.getTile(O),F=R.getBucket(i);if(!F||F.projection.name!==y.projection.name)continue;let N=F.programConfigurations.get(i.id),j=gk(i),U=e.isTileAffectedByFog(O);E&&j.push("PROJECTION_GLOBE_VIEW");let G=e.getOrCreateProgram("circle",{config:N,defines:j,overrideFog:U}),Y=F.layoutVertexBuffer,Z=F.globeExtVertexBuffer,tt=F.indexBuffer,$=y.projection.createInversionMatrix(y,O.canonical),rt={programConfiguration:N,program:G,layoutVertexBuffer:Y,globeExtVertexBuffer:Z,indexBuffer:tt,uniformValues:MU(e,O,R,$,M,i),tile:R};if(p){let st=F.segments.get();for(let pt of st)D.push({segments:new un([pt]),sortKey:pt.sortKey,state:rt})}else D.push({segments:F.segments,sortKey:0,state:rt})}p&&D.sort((P,O)=>P.sortKey-O.sortKey);let A={useDepthForOcclusion:y.depthOcclusionForSymbolsAndCircles};for(let P of D){let{programConfiguration:O,program:R,layoutVertexBuffer:F,globeExtVertexBuffer:N,indexBuffer:j,uniformValues:U,tile:G}=P.state,Y=P.segments;e.terrain&&e.terrain.setupElevationDraw(G,R,A),e.uploadCommonUniforms(g,R,G.tileID.toUnwrapped()),R.draw(e,v.TRIANGLES,b,x,C,bi.disabled,U,i.id,F,j,Y,i.paint,y.zoom,O,[N])}},heatmap:function(e,t,i,o){if(i.paint.get("heatmap-opacity")!==0)if(e.renderPass==="offscreen"){let c=e.context,u=c.gl,h=vi.disabled,p=new Gi([u.ONE,u.ONE,u.ONE,u.ONE],_i.transparent,[!0,!0,!0,!0]);(function(x,C,E,M){let D=x.gl,A=C.width*M,P=C.height*M;x.activeTexture.set(D.TEXTURE1),x.viewport.set([0,0,A,P]);let O=E.heatmapFbo;if(!O||O&&(O.width!==A||O.height!==P)){O&&O.destroy();let R=D.createTexture();D.bindTexture(D.TEXTURE_2D,R),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_S,D.CLAMP_TO_EDGE),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_T,D.CLAMP_TO_EDGE),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,D.LINEAR),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MAG_FILTER,D.LINEAR),O=E.heatmapFbo=x.createFramebuffer(A,P,!0,null),function(F,N,j,U,G,Y){let Z=F.gl;Z.texImage2D(Z.TEXTURE_2D,0,F.extRenderToTextureHalfFloat?Z.RGBA16F:Z.RGBA,G,Y,0,Z.RGBA,F.extRenderToTextureHalfFloat?Z.HALF_FLOAT:Z.UNSIGNED_BYTE,null),U.colorAttachment.set(j)}(x,0,R,O,A,P)}else D.bindTexture(D.TEXTURE_2D,O.colorAttachment.get()),x.bindFramebuffer.set(O.framebuffer)})(c,e,i,e.transform.projection.name==="globe"?.5:.25),c.clear({color:_i.transparent});let f=e.transform,g=f.projection.name==="globe",v=g?["PROJECTION_GLOBE_VIEW"]:[],y=g?bi.frontCCW:bi.disabled,b=[eo(f.center.lng),uo(f.center.lat)];for(let x=0;x<o.length;x++){let C=o[x];if(t.hasRenderableParent(C))continue;let E=t.getTile(C),M=E.getBucket(i);if(!M||M.projection.name!==f.projection.name)continue;let D=e.isTileAffectedByFog(C),A=M.programConfigurations.get(i.id),P=e.getOrCreateProgram("heatmap",{config:A,defines:v,overrideFog:D}),{zoom:O}=e.transform;e.terrain&&e.terrain.setupElevationDraw(E,P),e.uploadCommonUniforms(c,P,C.toUnwrapped());let R=f.projection.createInversionMatrix(f,C.canonical);P.draw(e,u.TRIANGLES,He.disabled,h,p,y,eW(e,C,E,R,b,O,i.paint.get("heatmap-intensity")),i.id,M.layoutVertexBuffer,M.indexBuffer,M.segments,i.paint,e.transform.zoom,A,g?[M.globeExtVertexBuffer]:null)}c.viewport.set([0,0,e.width,e.height])}else e.renderPass==="translucent"&&(e.context.setColorMode(e.colorModeForRenderPass()),function(c,u){let h=c.context,p=h.gl,f=u.heatmapFbo;if(!f)return;h.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,f.colorAttachment.get()),h.activeTexture.set(p.TEXTURE1);let g=u.colorRampTexture;g||(g=u.colorRampTexture=new or(h,u.colorRamp,p.RGBA)),g.bind(p.LINEAR,p.CLAMP_TO_EDGE),c.getOrCreateProgram("heatmapTexture").draw(c,p.TRIANGLES,He.disabled,vi.disabled,c.colorModeForRenderPass(),bi.disabled,((v,y,b,x)=>({u_image:0,u_color_ramp:1,u_opacity:y.paint.get("heatmap-opacity")}))(0,u),u.id,c.viewportBuffer,c.quadTriangleIndexBuffer,c.viewportSegments,u.paint,c.transform.zoom)}(e,i))},line:function(e,t,i,o){if(e.renderPass!=="translucent")return;let c=i.paint.get("line-opacity"),u=i.paint.get("line-width");if(c.constantOr(1)===0||u.constantOr(1)===0)return;let h=i.paint.get("line-emissive-strength"),p=e.depthModeForSublayer(0,He.ReadOnly),f=e.colorModeForDrapableLayerRenderPass(h),g=e.terrain&&e.terrain.renderingToTexture?1:ii.devicePixelRatio,v=i.paint.get("line-dasharray"),y=v.constantOr(1),b=i.layout.get("line-cap"),x=i.paint.get("line-pattern"),C=x.constantOr(1),E=i.paint.get("line-pattern").constantOr(1),M=i.paint.get("line-opacity").constantOr(1)!==1,D=!E&&M,A=i.paint.get("line-gradient"),P=C?"linePattern":"line",O=e.context,R=O.gl,F=SP(i);e.terrain&&e.terrain.clipOrMaskOverlapStencilType()&&(D=!1);for(let N of o){let j=t.getTile(N);if(C&&!j.patternsLoaded())continue;let U=j.getBucket(i);if(!U)continue;e.prepareDrawTile();let G=U.programConfigurations.get(i.id),Y=e.isTileAffectedByFog(N),Z=e.getOrCreateProgram(P,{config:G,defines:F,overrideFog:Y}),tt=x.constantOr(null);if(tt&&j.imageAtlas){let bt=j.imageAtlas.patternPositions[tt.toString()];bt&&G.setConstantPatternPositions(bt)}let $=v.constantOr(null),rt=b.constantOr(null);if(!C&&$&&rt&&j.lineAtlas){let bt=j.lineAtlas.getDash($,rt);bt&&G.setConstantPatternPositions(bt)}let[st,pt]=i.paint.get("line-trim-offset");(rt==="round"||rt==="square")&&st!==pt&&(st===0&&(st-=1),pt===1&&(pt+=1));let nt=e.terrain?N.projMatrix:null,ot=C?kG(e,j,i,nt,g):AG(e,j,i,nt,U.lineClipsArray.length,g,[st,pt]);if(A){let bt=U.gradients[i.id],yt=bt.texture;if(i.gradientVersion!==bt.version){let Ct=256;if(i.stepInterpolant){let Et=t.getSource().maxzoom,It=N.canonical.z===Et?Math.ceil(1<<e.transform.maxZoom-N.canonical.z):1;Ct=ve(Kg(U.maxLineLength/wt*1024*It),256,O.maxTextureSize)}bt.gradient=Q_({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:Ct,image:bt.gradient||void 0,clips:U.lineClipsArray}),bt.texture?bt.texture.update(bt.gradient):bt.texture=new or(O,bt.gradient,R.RGBA),bt.version=i.gradientVersion,yt=bt.texture}O.activeTexture.set(R.TEXTURE1),yt.bind(i.stepInterpolant?R.NEAREST:R.LINEAR,R.CLAMP_TO_EDGE)}y&&(O.activeTexture.set(R.TEXTURE0),j.lineAtlasTexture&&j.lineAtlasTexture.bind(R.LINEAR,R.REPEAT),G.updatePaintBuffers()),C&&(O.activeTexture.set(R.TEXTURE0),j.imageAtlasTexture&&j.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),G.updatePaintBuffers()),e.uploadCommonUniforms(O,Z,N.toUnwrapped());let vt=bt=>{Z.draw(e,R.TRIANGLES,p,bt,f,bi.disabled,ot,i.id,U.layoutVertexBuffer,U.indexBuffer,U.segments,i.paint,e.transform.zoom,G,[U.layoutVertexBuffer2])};if(D){let bt=e.stencilModeForClipping(N).ref;bt===0&&e.terrain&&O.clear({stencil:0});let yt={func:R.EQUAL,mask:255};ot.u_alpha_discard_threshold=.8,vt(new vi(yt,bt,255,R.KEEP,R.KEEP,R.INVERT)),ot.u_alpha_discard_threshold=0,vt(new vi(yt,bt,255,R.KEEP,R.KEEP,R.KEEP))}else vt(e.stencilModeForClipping(N))}D&&(e.resetStencilClippingMasks(),e.terrain&&O.clear({stencil:0}))},fill:function(e,t,i,o){let c=i.paint.get("fill-color"),u=i.paint.get("fill-opacity");if(u.constantOr(1)===0)return;let h=i.paint.get("fill-emissive-strength"),p=e.colorModeForDrapableLayerRenderPass(h),f=i.paint.get("fill-pattern"),g=e.opaquePassEnabledForLayer()&&!f.constantOr(1)&&c.constantOr(_i.transparent).a===1&&u.constantOr(0)===1?"opaque":"translucent";if(e.renderPass===g){let v=e.depthModeForSublayer(1,e.renderPass==="opaque"?He.ReadWrite:He.ReadOnly);YO(e,t,i,o,v,p,!1)}if(e.renderPass==="translucent"&&i.paint.get("fill-antialias")){let v=e.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,He.ReadOnly);YO(e,t,i,o,v,p,!0)}},"fill-extrusion":function(e,t,i,o){let c=i.paint.get("fill-extrusion-opacity"),u=e.context,h=u.gl,p=e.terrain,f=p&&p.renderingToTexture,g=i.paint.get("fill-extrusion-cutoff-fade-range");if(c===0)return;let v=e.conflationActive&&e.layerUsedInConflation(i,t.getSource());if(v&&function(y,b,x,C){for(let E of C){let M=b.getTile(E).getBucket(x);M&&(M.updateReplacement(E,y.replacementSource),M.uploadCentroid(y.context))}}(e,t,i,o),p||v)for(let y of o){let b=t.getTile(y).getBucket(i);b&&hW(e.context,t,y,b,i,p,v)}if(e.renderPass==="shadow"&&e.shadowRenderer){let y=e.shadowRenderer;if(p&&c<.65&&i._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof Hc)return;let b=y.getShadowPassDepthMode(),x=y.getShadowPassColorMode();tv(e,t,i,o,b,vi.disabled,x,v)}else if(e.renderPass==="translucent"){let y=!i.paint.get("fill-extrusion-pattern").constantOr(1);if(!f){let b=new He(e.context.gl.LEQUAL,He.ReadWrite,e.depthRangeFor3D);g===0&&c===1&&y?tv(e,t,i,o,b,vi.disabled,Gi.unblended,v):(tv(e,t,i,o,b,vi.disabled,Gi.disabled,v),tv(e,t,i,o,b,e.stencilModeFor3D(),e.colorModeForRenderPass(),v),e.resetStencilClippingMasks())}if(e.style.enable3dLights()&&y&&(!p&&e.transform.projection.name!=="globe"||f)){let b=i.paint.get("fill-extrusion-opacity"),x=i.paint.get("fill-extrusion-ambient-occlusion-intensity"),C=i.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),E=i.paint.get("fill-extrusion-flood-light-intensity"),M=i.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),D=x>0&&C>0,A=E>0,P=(R,F,N)=>(1-N)*R+N*F,O=R=>{let F=e.depthModeForSublayer(1,He.ReadOnly,h.LEQUAL,!0),N=i.paint.get(R?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),j=P(.1,3,N),U=e._showOverdrawInspector;if(!U){let G=new vi({func:h.ALWAYS,mask:255},255,255,h.KEEP,h.KEEP,h.REPLACE),Y=new Gi([h.ONE,h.ONE,h.ONE,h.ONE],_i.transparent,[!1,!1,!1,!0],h.MIN);Vh(e,t,i,o,F,G,Y,bi.disabled,R,"sdf",b,x,C,E,M,j,v,!1)}{let G=U?vi.disabled:new vi({func:h.EQUAL,mask:255},255,255,h.KEEP,h.DECR,h.DECR),Y=U?e.colorModeForRenderPass():new Gi([h.ONE_MINUS_DST_ALPHA,h.DST_ALPHA,h.ONE,h.ONE],_i.transparent,[!0,!0,!0,!0]);Vh(e,t,i,o,F,G,Y,bi.disabled,R,"color",b,x,C,E,M,j,v,!1)}};if(f){let R=(F,N,j)=>{let U=e.depthModeForSublayer(1,He.ReadOnly,h.LEQUAL,!1),G=i.paint.get(F?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Y=P(.1,3,G);{let Z=new Gi([h.ONE,h.ONE,h.ONE,h.ONE],_i.transparent,[!1,!1,!1,!0]);Vh(e,t,i,o,U,vi.disabled,Z,bi.disabled,F,"clear",b,x,C,E,M,Y,v,N)}{let Z=new vi({func:h.ALWAYS,mask:255},255,255,h.KEEP,h.KEEP,h.REPLACE),tt=new Gi([h.ONE,h.ONE,h.ONE,h.ONE],_i.transparent,[!1,!1,!1,!0],h.MIN);Vh(e,t,i,o,U,Z,tt,bi.disabled,F,"sdf",b,x,C,E,M,Y,v,N)}{let Z=F?h.ZERO:h.ONE_MINUS_DST_ALPHA,tt=new vi({func:h.EQUAL,mask:255},255,255,h.KEEP,h.DECR,h.DECR),$=new Gi([Z,h.DST_ALPHA,h.ONE_MINUS_DST_ALPHA,h.ZERO],_i.transparent,[!0,!0,!0,!0]);Vh(e,t,i,o,U,tt,$,bi.disabled,F,"color",b,x,C,E,M,Y,v,N)}{let Z=new Gi([h.ONE,h.ONE,h.ONE,F?h.ZERO:h.ONE],_i.transparent,[!1,!1,!1,!0],F?h.FUNC_ADD:h.MAX);Vh(e,t,i,o,U,vi.disabled,Z,bi.disabled,F,"clear",b,x,C,E,M,Y,v,N,j)}};if(D||A){let F;if(e.prepareDrawTile(),p){let N=p.drapeBufferSize[0],j=p.drapeBufferSize[1];F=p.framebufferCopyTexture,F&&(!F||F.size[0]===N&&F.size[1]===j)||(F&&F.destroy(),F=p.framebufferCopyTexture=new or(u,new Br({width:N,height:j}),h.RGBA)),F.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.copyTexImage2D(h.TEXTURE_2D,0,h.RGBA,0,0,N,j,0)}D&&R(!0,!1,F),A&&R(!1,!0,F)}}else D&&O(!0),A&&O(!1)}}},hillshade:function(e,t,i,o){if(e.renderPass!=="offscreen"&&e.renderPass!=="translucent"||e.style.disableElevatedTerrain)return;let c=e.context,u=e.terrain&&e.terrain.renderingToTexture,[h,p]=e.renderPass!=="translucent"||u?[{},o]:e.stencilConfigForOverlap(o);for(let f of p){let g=t.getTile(f);if(g.needsHillshadePrepare&&e.renderPass==="offscreen")Vq(e,g,i);else if(e.renderPass==="translucent"){let v=e.depthModeForSublayer(0,He.ReadOnly),y=i.paint.get("hillshade-emissive-strength"),b=e.colorModeForDrapableLayerRenderPass(y),x=u&&e.terrain?e.terrain.stencilModeForRTTOverlap(f):h[f.overscaledZ];Bq(e,f,g,i,v,x,b)}}c.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()},raster:function(e,t,i,o,c,u){if(e.renderPass!=="translucent"||i.paint.get("raster-opacity")===0)return;let h=e.context,p=h.gl,f=t.getSource(),g=function(N,j,U){let G=N.paint.get("raster-color"),Y=[],Z=N.paint.get("raster-resampling"),tt=N.paint.get("raster-color-mix"),$=N.paint.get("raster-color-range"),rt=[tt[0],tt[1],tt[2],0],st=tt[3],pt=Z==="nearest"?U.NEAREST:U.LINEAR;if(G&&Y.push("RASTER_COLOR"),G){j.activeTexture.set(U.TEXTURE2);let nt=N.colorRampTexture;nt||(nt=N.colorRampTexture=new or(j,N.colorRamp,U.RGBA)),nt.bind(U.LINEAR,U.CLAMP_TO_EDGE)}return{mix:rt,range:$,offset:st,defines:Y,resampling:pt}}(i,h,p),v=g.defines,y=e.transform.projection.name==="globe",b=!1;if(f instanceof va&&!o.length){if(!y)return;if(f.onNorthPole)b=!0,v.push("GLOBE_POLES");else{if(!f.onSouthPole)return;b=!0,v.push("GLOBE_POLES")}}let x=i.paint.get("raster-emissive-strength"),C=e.colorModeForDrapableLayerRenderPass(x),E=e.terrain&&e.terrain.renderingToTexture,M=f instanceof va&&i.paint.get("raster-elevation")!==0,D=!e.options.moving,A=i.paint.get("raster-resampling")==="nearest"?p.NEAREST:p.LINEAR;if(b){let N=t.getSource();if(!(N instanceof va))return;let j=N.texture;if(!j)return;let U=e.globeSharedBuffers;if(!U)return;let G=new He(p.LEQUAL,He.ReadWrite,e.depthRangeFor3D),Y=Float32Array.from(e.transform.expandedFarZProjMatrix),Z=JA(0,0,e.transform),tt=Float32Array.from(Jc(Zs(new pa(0,0,0)))),$={opacity:1,mix:0};e.terrain&&e.terrain.prepareDrawTile(),h.activeTexture.set(p.TEXTURE0),j.bind(A,p.CLAMP_TO_EDGE),h.activeTexture.set(p.TEXTURE1),j.bind(A,p.CLAMP_TO_EDGE),j.useMipmap&&h.extTextureFilterAnisotropic&&e.transform.pitch>20&&p.texParameterf(p.TEXTURE_2D,h.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,h.extTextureFilterAnisotropicMax);let[rt,st,pt,nt]=U.getPoleBuffers(0,!0),ot;N.onNorthPole?(ot=rt,e.renderDefaultNorthPole=!1):(Z=ft.scale(ft.create(),Z,[1,-1,1]),ot=st,e.renderDefaultSouthPole=!1);let vt=((yt,Ct,Et,It,xt,Ft,te,ee,de,me,Ge,Ie)=>BO(yt,Ct,Et,new Float32Array(16),new Float32Array(9),[0,0],[0,0,0,0],0,[0,0],[0,0,0,0],1,It,xt,Ft||[0,0],te,2,de,me,Ge,1,0,Ie))(Y,tt,Z,$,i,N.perspectiveTransform||[0,0],i.paint.get("raster-elevation"),0,g.mix,g.offset,g.range,x),bt=e.getOrCreateProgram("raster",{defines:g.defines});return e.uploadCommonUniforms(h,bt,null),void bt.draw(e,p.TRIANGLES,G,vi.disabled,C,bi.disabled,vt,i.id,ot,pt,nt)}if(!o.length)return;let[P,O]=f instanceof va||E?[{},o]:e.stencilConfigForOverlap(o),R=O[O.length-1].overscaledZ,F=M&&y;F&&g.defines.push("PROJECTION_GLOBE_VIEW"),M&&g.defines.push("RENDER_CUTOFF");for(let N of O){let j=N.toUnwrapped(),U=t.getTile(N);if(E&&(!U||!U.hasData())||!U.texture)continue;let G,Y;E?(G=He.disabled,Y=N.projMatrix):M?(G=new He(p.LEQUAL,He.ReadWrite,e.depthRangeFor3D),Y=y?Float32Array.from(e.transform.expandedFarZProjMatrix):e.transform.calculateProjMatrix(j,D)):(G=e.depthModeForSublayer(N.overscaledZ-R,i.paint.get("raster-opacity")===1?He.ReadWrite:He.ReadOnly,p.LESS),Y=e.transform.calculateProjMatrix(j,D));let Z=e.terrain&&E?e.terrain.stencilModeForRTTOverlap(N):P[N.overscaledZ],tt=u?0:i.paint.get("raster-fade-duration");U.registerFadeDuration(tt);let $=t.findLoadedParent(N,0),rt=kO(U,$,t,e.transform,tt),st,pt;e.terrain&&e.terrain.prepareDrawTile(),h.activeTexture.set(p.TEXTURE0),U.texture&&U.texture.bind(A,p.CLAMP_TO_EDGE),h.activeTexture.set(p.TEXTURE1),$?($.texture&&$.texture.bind(A,p.CLAMP_TO_EDGE),st=Math.pow(2,$.tileID.overscaledZ-U.tileID.overscaledZ),pt=[U.tileID.canonical.x*st%1,U.tileID.canonical.y*st%1]):U.texture&&U.texture.bind(A,p.CLAMP_TO_EDGE),U.texture&&U.texture.useMipmap&&h.extTextureFilterAnisotropic&&e.transform.pitch>20&&p.texParameterf(p.TEXTURE_2D,h.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,h.extTextureFilterAnisotropicMax);let nt=e.transform,ot=f instanceof va?f.perspectiveTransform:[0,0],vt=M?_W(nt):[0,0,0,0],bt,yt,Ct,Et,It,xt;if(F&&f instanceof va&&f.coordinates.length>3){bt=Float32Array.from(Jc(Zs(new pa(0,0,0)))),yt=Float32Array.from(nt.globeMatrix),Ct=Float32Array.from(QA(nt)),Et=[eo(nt.center.lng),uo(nt.center.lat)],xt=[eo(f.coordinates[1][0]),uo(f.coordinates[1][1]),eo(f.coordinates[3][0]),uo(f.coordinates[3][1])];let de=new Es(f.coordinates[1],f.coordinates[3]);It=Float32Array.from(ek(new pa(0,0,0),de,0,nt.worldSize/e.transform._pixelsPerMercatorPixel))}else bt=new Float32Array(16),yt=new Float32Array(9),Ct=new Float32Array(16),Et=[0,0],It=new Float32Array(16),xt=[0,0,0,0];let Ft=BO(Y,bt,yt,Ct,It,pt||[0,0],xt,Co(e.transform.zoom),Et,vt,st||1,rt,i,ot,M?i.paint.get("raster-elevation"):0,2,g.mix,g.offset,g.range,1,0,x),te=e.isTileAffectedByFog(N),ee=e.getOrCreateProgram("raster",{defines:g.defines,overrideFog:te});if(e.uploadCommonUniforms(h,ee,j),f instanceof va){if(E||!y)f.boundsBuffer&&f.boundsSegments&&ee.draw(e,p.TRIANGLES,G,vi.disabled,C,bi.disabled,Ft,i.id,f.boundsBuffer,e.quadTriangleIndexBuffer,f.boundsSegments);else if(e.globeSharedBuffers){let[de,me,Ge]=e.globeSharedBuffers.getGridBuffers(0,!1);ee.draw(e,p.TRIANGLES,G,vi.disabled,C,bi.frontCCW,Ft,i.id,de,me,Ge),ee.draw(e,p.TRIANGLES,G,vi.disabled,C,bi.backCCW,Ft,i.id,de,me,Ge)}}else{let{tileBoundsBuffer:de,tileBoundsIndexBuffer:me,tileBoundsSegments:Ge}=e.getTileBoundsBuffers(U);ee.draw(e,p.TRIANGLES,G,Z,C,bi.disabled,Ft,i.id,de,me,Ge)}}e.resetStencilClippingMasks()},background:function(e,t,i,o){let c=i.paint.get("background-color"),u=i.paint.get("background-opacity"),h=i.paint.get("background-emissive-strength");if(u===0)return;let p=e.context,f=p.gl,g=e.transform,v=g.tileSize,y=i.paint.get("background-pattern");if(e.isPatternMissing(y,i.scope))return;let b=!y&&c.a===1&&u===1&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==b)return;let x=vi.disabled,C=e.depthModeForSublayer(0,b==="opaque"?He.ReadWrite:He.ReadOnly),E=e.colorModeForDrapableLayerRenderPass(h),M=y?"backgroundPattern":"background",D,A=o;A||(D=e.getBackgroundTiles(),A=Object.values(D).map(P=>P.tileID)),y&&(p.activeTexture.set(f.TEXTURE0),e.imageManager.bind(e.context,i.scope));for(let P of A){let O=e.isTileAffectedByFog(P),R=e.getOrCreateProgram(M,{overrideFog:O}),F=P.toUnwrapped(),N=o?P.projMatrix:e.transform.calculateProjMatrix(F);e.prepareDrawTile();let j=t?t.getTile(P):D?D[P.key]:new Xp(P,v,g.zoom,e),U=y?aW(N,h,u,e,y,i.scope,{tileID:P,tileSize:v}):sW(N,h,u,c);e.uploadCommonUniforms(p,R,F);let{tileBoundsBuffer:G,tileBoundsIndexBuffer:Y,tileBoundsSegments:Z}=e.getTileBoundsBuffers(j);R.draw(e,f.TRIANGLES,C,x,E,bi.disabled,U,i.id,G,Y,Z)}},sky:function(e,t,i){let o=e._atmosphere?Co(e.transform.zoom):1,c=i.paint.get("sky-opacity")*o;if(c===0)return;let u=e.context,h=i.paint.get("sky-type"),p=new He(u.gl.LEQUAL,He.ReadOnly,[0,1]),f=e.frameCounter/1e3%1;h==="atmosphere"?e.renderPass==="offscreen"?i.needsSkyboxCapture(e)&&(function(g,v,y,b){let x=g.context,C=x.gl,E=v.skyboxFbo;if(!E){E=v.skyboxFbo=x.createFramebuffer(32,32,!0,null),v.skyboxGeometry=new KO(x),v.skyboxTexture=x.gl.createTexture(),C.bindTexture(C.TEXTURE_CUBE_MAP,v.skyboxTexture),C.texParameteri(C.TEXTURE_CUBE_MAP,C.TEXTURE_WRAP_S,C.CLAMP_TO_EDGE),C.texParameteri(C.TEXTURE_CUBE_MAP,C.TEXTURE_WRAP_T,C.CLAMP_TO_EDGE),C.texParameteri(C.TEXTURE_CUBE_MAP,C.TEXTURE_MIN_FILTER,C.LINEAR),C.texParameteri(C.TEXTURE_CUBE_MAP,C.TEXTURE_MAG_FILTER,C.LINEAR);for(let P=0;P<6;++P)C.texImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+P,0,C.RGBA,32,32,0,C.RGBA,C.UNSIGNED_BYTE,null)}x.bindFramebuffer.set(E.framebuffer),x.viewport.set([0,0,32,32]);let M=v.getCenter(g,!0),D=g.getOrCreateProgram("skyboxCapture"),A=new Float64Array(16);ft.identity(A),ft.rotateY(A,A,.5*-Math.PI),jh(g,v,D,A,M,0),ft.identity(A),ft.rotateY(A,A,.5*Math.PI),jh(g,v,D,A,M,1),ft.identity(A),ft.rotateX(A,A,.5*-Math.PI),jh(g,v,D,A,M,2),ft.identity(A),ft.rotateX(A,A,.5*Math.PI),jh(g,v,D,A,M,3),ft.identity(A),jh(g,v,D,A,M,4),ft.identity(A),ft.rotateY(A,A,Math.PI),jh(g,v,D,A,M,5),x.viewport.set([0,0,g.width,g.height])}(e,i),i.markSkyboxValid(e)):e.renderPass==="sky"&&function(g,v,y,b,x){let C=g.context,E=C.gl,M=g.transform,D=g.getOrCreateProgram("skybox");C.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_CUBE_MAP,v.skyboxTexture);let A=((P,O,R,F,N)=>({u_matrix:P,u_sun_direction:O,u_cubemap:0,u_opacity:F,u_temporal_offset:N}))(M.skyboxMatrix,v.getCenter(g,!1),0,b,x);g.uploadCommonUniforms(C,D),D.draw(g,E.TRIANGLES,y,vi.disabled,g.colorModeForRenderPass(),bi.backCW,A,"skybox",v.skyboxGeometry.vertexBuffer,v.skyboxGeometry.indexBuffer,v.skyboxGeometry.segment)}(e,i,p,c,f):h==="gradient"&&e.renderPass==="sky"&&function(g,v,y,b,x){let C=g.context,E=C.gl,M=g.transform,D=g.getOrCreateProgram("skyboxGradient");v.skyboxGeometry||(v.skyboxGeometry=new KO(C)),C.activeTexture.set(E.TEXTURE0);let A=v.colorRampTexture;A||(A=v.colorRampTexture=new or(C,v.colorRamp,E.RGBA)),A.bind(E.LINEAR,E.CLAMP_TO_EDGE);let P=((O,R,F,N,j)=>({u_matrix:O,u_color_ramp:0,u_center_direction:R,u_radius:fe(F),u_opacity:N,u_temporal_offset:j}))(M.skyboxMatrix,v.getCenter(g,!1),v.paint.get("sky-gradient-radius"),b,x);g.uploadCommonUniforms(C,D),D.draw(g,E.TRIANGLES,y,vi.disabled,g.colorModeForRenderPass(),bi.backCW,P,"skyboxGradient",v.skyboxGeometry.vertexBuffer,v.skyboxGeometry.indexBuffer,v.skyboxGeometry.segment)}(e,i,p,c,f)},debug:function(e,t,i){for(let o=0;o<i.length;o++)CW(e,t,i[o])},custom:function(e,t,i,o){let c=e.context,u=i.implementation;if(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes("custom")||e.terrain&&(e.terrain.renderingToTexture||e.renderPass==="offscreen")&&i.isLayerDraped(t)){if(e.renderPass==="offscreen"){let h=u.prerender;if(h){if(e.setCustomLayerDefaults(),c.setColorMode(e.colorModeForRenderPass()),e.transform.projection.name==="globe"){let p=e.transform.pointMerc;h.call(u,c.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),Co(e.transform.zoom),[p.x,p.y],e.transform.pixelsPerMeterRatio)}else h.call(u,c.gl,e.transform.customLayerMatrix());c.setDirty(),e.setBaseState()}}else if(e.renderPass==="translucent"){if(e.terrain&&e.terrain.renderingToTexture){let p=u.renderToTile;if(p){let f=o[0].canonical,g=new Fi(f.x+o[0].wrap*(1<<f.z),f.y,f.z);c.setDepthMode(He.disabled),c.setStencilMode(vi.disabled),c.setColorMode(e.colorModeForRenderPass()),e.setCustomLayerDefaults(),p.call(u,c.gl,g),c.setDirty(),e.setBaseState()}return}e.setCustomLayerDefaults(),c.setColorMode(e.colorModeForRenderPass()),c.setStencilMode(vi.disabled);let h=u.renderingMode==="3d"?new He(e.context.gl.LEQUAL,He.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,He.ReadOnly);if(c.setDepthMode(h),e.transform.projection.name==="globe"){let p=e.transform.pointMerc;u.render(c.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),Co(e.transform.zoom),[p.x,p.y],e.transform.pixelsPerMeterRatio)}else u.render(c.gl,e.transform.customLayerMatrix());c.setDirty(),e.setBaseState(),c.bindFramebuffer.set(null)}}else lt("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(e,t,i,o){if(e.renderPass==="opaque")return;let c=i.paint.get("model-opacity");if(c===0)return;let u=i.paint.get("model-cast-shadows");if(e.renderPass==="shadow"&&(!u||e.terrain&&c<.65&&i._transitionablePaint._values["model-opacity"].value.expression instanceof Hc))return;let h=e.shadowRenderer,p=i.paint.get("model-receive-shadows");h&&(h.useNormalOffset=!0,p||(h.enabled=!1));let f=()=>{h&&(h.useNormalOffset=!0,p||(h.enabled=!0))},g=t.getSource();if(e.renderPass==="light-beam"&&g.type!=="batched-model")return;if(g.type==="vector"||g.type==="geojson")return function(D,A,P,O){let R=D.transform;if(R.projection.name!=="mercator")return void lt(`Drawing 3D models for ${R.projection.name} projection is not yet implemented`);let F=R.getFreeCameraOptions().position;if(!D.modelManager)return;let N=D.modelManager,j=D.shadowRenderer;if(!P._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let U=P._unevaluatedLayout._values["model-id"],G=qt({},P.layout.get("model-id").parameters);for(let Y of O){let Z=A.getTile(Y).getBucket(P);if(!Z||Z.projection.name!==R.projection.name)continue;let tt=kW(Y,R);G.zoom=tt;let $=U.possiblyEvaluate(G);if(AW(D,Z,Y),Pl.shadowUniformsInitialized=!1,Pl.useSingleShadowCascade=!!j&&j.getMaxCascadeForTile(Y.toUnwrapped())===0,D.renderPass==="shadow"&&j){if(D.currentShadowCascade===1&&Z.isInsideFirstShadowMapFrustum)continue;let pt=R.calculatePosMatrix(Y.toUnwrapped(),R.worldSize);if(Pl.tileMatrix.set(pt),Pl.shadowTileMatrix=Float32Array.from(j.calculateShadowPassMatrixFromMatrix(pt)),Pl.aabb.min.fill(0),Pl.aabb.max[0]=Pl.aabb.max[1]=wt,Pl.aabb.max[2]=0,PW(Z,Pl,D,P.scope))continue}let rt=1<<Y.canonical.z,st=[((F.x-Y.wrap)*rt-Y.canonical.x)*wt,(F.y*rt-Y.canonical.y)*wt,F.z*rt*wt];for(let pt in Z.instancesPerModel){let nt=Z.instancesPerModel[pt];nt.features.length>0&&(pt=$.evaluate(nt.features[0].feature,{}));let ot=N.getModel(pt,P.scope);if(ot&&ot.uploaded)for(let vt of ot.nodes)tF(D,P,vt,nt,st,Y,Pl)}}}(e,t,i,o),void f();if(!g.loaded())return;if(g.type==="batched-model")return function(D,A,P,O){let R=D.context,F=D.transform,N=D.style.fog,j=D.shadowRenderer;if(F.projection.name!=="mercator")return void lt(`Drawing 3D landmark models for ${F.projection.name} projection is not yet implemented`);let U=D.transform.getFreeCameraOptions().position,G=J.scale([],[U.x,U.y,U.z],D.transform.worldSize);J.negate(G,G);let Y=ft.identity([]),Z=ed(F.center.lat,F.zoom),tt=ft.fromScaling([],[1,1,1/Z]);ft.translate(Y,Y,G);let $=P.paint.get("model-opacity"),rt=new He(R.gl.LEQUAL,He.ReadWrite,D.depthRangeFor3D),st=new He(R.gl.LEQUAL,He.ReadOnly,D.depthRangeFor3D),pt=function(nt,ot){for(let vt of O){let bt=A.getTile(vt).getBucket(P);if(!bt||!bt.uploaded)continue;let yt=!1;j&&(yt=j.getMaxCascadeForTile(vt.toUnwrapped())===0);let Ct=F.calculatePosMatrix(vt.toUnwrapped(),F.worldSize),Et=bt.modelTraits;for(let It of bt.getNodesInfo()){if(It.hiddenByReplacement||!It.node.meshes)continue;let xt=It.node,Ft=D.renderPass==="light-beam",te=[...Ct],ee=It.evaluatedScale,de=0;D.terrain&&xt.elevation&&(de=xt.elevation*D.terrain.exaggeration()),ft.translate(te,te,[(xt.anchor?xt.anchor[0]:0)*(ee[0]-1),(xt.anchor?xt.anchor[1]:0)*(ee[1]-1),de]),ee!==dG&&ft.scale(te,te,ee),ft.multiply(te,te,xt.matrix);let me=ft.multiply([],tt,te);ft.multiply(me,Y,me);let Ge=ft.invert([],me);ft.transpose(Ge,Ge),ft.scale(Ge,Ge,RW);let Ie=ft.multiply([],F.expandedFarZProjMatrix,te);for(let Ui=0;Ui<xt.meshes.length;++Ui){let Mi=xt.meshes[Ui],qe=Ui===xt.lightMeshIndex;if(qe){if(!Ft&&!D.terrain&&D.shadowRenderer){D.currentLayer<D.firstLightBeamLayer&&(D.firstLightBeamLayer=D.currentLayer);continue}}else if(Ft)continue;let je={defines:[]},ke=[];sS(je.defines,ke,Mi,D),4&Et||je.defines.push("DIFFUSE_SHADED"),yt&&je.defines.push("SHADOWS_SINGLE_CASCADE");let Ii=D.renderPass==="shadow";if(Ii){aS(Mi,te,D,P);continue}let Vi=null;if(N){let zr=QO(te,D.transform);if(Vi=new Float32Array(zr),F.projection.name!=="globe"){let kr=Mi.aabb.min,$n=Mi.aabb.max,[an,Po]=N.getOpacityForBounds(zr,kr[0],kr[1],$n[0],$n[1]);je.overrideFog=an>=uu||Po>=uu}}let gi=D.getOrCreateProgram("model",je);!Ii&&j&&(j.useNormalOffset=!!Mi.normalBuffer,j.setupShadowsFromMatrix(te,gi,j.useNormalOffset)),D.uploadCommonUniforms(R,gi,vt.toUnwrapped(),Vi);let bn=Mi.material,Ar=bn.pbrMetallicRoughness;Ar.metallicFactor=.9,Ar.roughnessFactor=.5;let mn=0,jn=rS(new Float32Array(Ie),new Float32Array(me),new Float32Array(Ge),D,$,Ar.baseColorFactor,bn.emissiveFactor,Ar.metallicFactor,Ar.roughnessFactor,bn,mn,P);gi.draw(D,R.gl.TRIANGLES,ot&&!qe?rt:st,vi.disabled,nt?qe||$<1||It.hasTranslucentParts?Gi.alphaBlended:Gi.unblended:Gi.disabled,bi.backCCW,jn,P.id,Mi.vertexBuffer,Mi.indexBuffer,Mi.segments,P.paint,D.transform.zoom,void 0,ke)}}}};(function(nt,ot,vt,bt){let yt=nt.terrain?nt.terrain.exaggeration():0,Ct=nt.transform.zoom;for(let Et of bt){let It=ot.getTile(Et).getBucket(vt);It&&(nt.conflationActive&&It.updateReplacement(Et,nt.replacementSource),It.evaluateScale(nt,vt),nt.terrain&&yt>0&&It.elevationUpdate(nt.terrain,yt,Et,vt.source),It.needsReEvaluation(nt,Ct,vt)&&It.evaluate(vt))}})(D,A,P,O),$===1?pt(!0,!0):(pt(!1,!0),pt(!0,!1))}(e,t,i,o),void f();let v=g.getModels(),y=[],b=e.transform.getFreeCameraOptions().position,x=J.scale([],[b.x,b.y,b.z],e.transform.worldSize);J.negate(x,x);let C=[],E=[],M=0;for(let D of v){let A=i.paint.get("model-rotation").constantOr(null),P=i.paint.get("model-scale").constantOr(null),O=i.paint.get("model-translation").constantOr(null);D.computeModelMatrix(e,A,P,O,!0,!0,!1);let R=ft.identity([]),F=ed(D.position.lat,e.transform.zoom),N=ft.fromScaling([],[1,1,1/F]);ft.translate(R,R,x),y.push({zScaleMatrix:N,negCameraPosMatrix:R});for(let j of D.nodes)JO(e.transform,j,D.matrix,e.transform.expandedFarZProjMatrix,M,C,E);M++}if(C.sort((D,A)=>A.depth-D.depth),e.renderPass!=="shadow"){if(c===1)for(let D of E)iv(D,e,i,y[D.modelIndex],vi.disabled,e.colorModeForRenderPass());else{for(let D of E)iv(D,e,i,y[D.modelIndex],vi.disabled,Gi.disabled);for(let D of E)iv(D,e,i,y[D.modelIndex],e.stencilModeFor3D(),e.colorModeForRenderPass());e.resetStencilClippingMasks()}for(let D of C)iv(D,e,i,y[D.modelIndex],vi.disabled,e.colorModeForRenderPass());f()}else{for(let D of E)aS(D.mesh,D.nodeModelMatrix,e,i);for(let D of C)aS(D.mesh,D.nodeModelMatrix,e,i);f()}}},iF={modelUpload:function(e,t,i){let o=t.getSource();if(!o.loaded())return;if(o.type==="vector"||o.type==="geojson")return void(e.modelManager&&e.modelManager.upload(e,i));if(o.type==="batched-model")return;let c=o.getModels();for(let u of c)u.upload(e.context)}};class LW{constructor(t,i,o){this.context=new JH(t,i),this.transform=o,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=tl.maxUnderzooming+tl.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new gG,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new BW(this),this._wireframeDebugCache=new FW,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(t,i){let o=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(o||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Gq(this,t));let c=this._terrain;this.transform.elevation=o?c:null,c.update(t,this.transform,i),this.transform.elevation&&!c.enabled&&(this.transform.elevation=null)}_updateFog(t){let i=t.fog;if(!i||this.transform.projection.name==="globe"||i.getOpacity(this.transform.pitch)<1||i.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[o,c]=i.getFovAdjustedRange(this.transform._fov);if(o>c)return void(this.transform.fogCullDistSq=null);let u=o+.78*(c-o);this.transform.fogCullDistSq=u*u}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,i){if(this.width=t*ii.devicePixelRatio,this.height=i*ii.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let o of this.style.order)this.style._mergedLayers[o].resize()}setup(){let t=this.context,i=new Cs;i.emplaceBack(0,0),i.emplaceBack(wt,0),i.emplaceBack(0,wt),i.emplaceBack(wt,wt),this.tileExtentBuffer=t.createVertexBuffer(i,Kc.members),this.tileExtentSegments=un.simpleSegment(0,0,4,2);let o=new Cs;o.emplaceBack(0,0),o.emplaceBack(wt,0),o.emplaceBack(0,wt),o.emplaceBack(wt,wt),this.debugBuffer=t.createVertexBuffer(o,Kc.members),this.debugSegments=un.simpleSegment(0,0,4,5);let c=new Cs;c.emplaceBack(-1,-1),c.emplaceBack(1,-1),c.emplaceBack(-1,1),c.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(c,Kc.members),this.viewportSegments=un.simpleSegment(0,0,4,2);let u=new tu;u.emplaceBack(0,0,0,0),u.emplaceBack(wt,0,wt,0),u.emplaceBack(0,wt,0,wt),u.emplaceBack(wt,wt,wt,wt),this.mercatorBoundsBuffer=t.createVertexBuffer(u,xC.members),this.mercatorBoundsSegments=un.simpleSegment(0,0,4,2);let h=new qr;h.emplaceBack(0,1,2),h.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(h);let p=new Tp;for(let g of[0,1,3,2,0])p.emplaceBack(g);this.debugIndexBuffer=t.createIndexBuffer(p),this.emptyTexture=new or(t,new Br({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=ft.create();let f=this.context.gl;this.stencilClearMode=new vi({func:f.ALWAYS,mask:0},0,255,f.ZERO,f.ZERO,f.ZERO),this.loadTimeStamps.push(m.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,He.disabled,this.stencilClearMode,Gi.disabled,bi.disabled,nS(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,i,o){if(!i||this.currentStencilSource===i.id||!t.isTileClipped()||!o||o.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let p=!1;for(let f of o)if(this._tileClippingMaskIDs[f.key]===void 0){p=!0;break}if(!p)return}this.currentStencilSource=i.id;let c=this.context,u=c.gl;this.nextStencilID+o.length>256&&this.clearStencil(),c.setColorMode(Gi.disabled),c.setDepthMode(He.disabled);let h=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let p of o){let f=i.getTile(p),g=this._tileClippingMaskIDs[p.key]=this.nextStencilID++,{tileBoundsBuffer:v,tileBoundsIndexBuffer:y,tileBoundsSegments:b}=this.getTileBoundsBuffers(f);h.draw(this,u.TRIANGLES,He.disabled,new vi({func:u.ALWAYS,mask:0},g,255,u.KEEP,u.KEEP,u.REPLACE),Gi.disabled,bi.disabled,nS(p.projMatrix),"$clipping",v,y,b)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let t=this.nextStencilID++,i=this.context.gl;return new vi({func:i.NOTEQUAL,mask:255},t,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);let i=this.context.gl;return new vi({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,i.KEEP,i.KEEP,i.REPLACE)}stencilConfigForOverlap(t){let i=this.context.gl,o=t.sort((h,p)=>p.overscaledZ-h.overscaledZ),c=o[o.length-1].overscaledZ,u=o[0].overscaledZ-c+1;if(u>1){this.currentStencilSource=void 0,this.nextStencilID+u>256&&this.clearStencil();let h={};for(let p=0;p<u;p++)h[p+c]=new vi({func:i.GEQUAL,mask:255},p+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=u,[h,o]}return[{[c]:vi.disabled},o]}colorModeForRenderPass(){let t=this.context.gl;return this._showOverdrawInspector?new Gi([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new _i(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Gi.unblended:Gi.alphaBlended}colorModeForDrapableLayerRenderPass(t){let i=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Gi([i.ONE,i.ONE_MINUS_SRC_ALPHA,i.CONSTANT_ALPHA,i.ONE_MINUS_SRC_ALPHA],new _i(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,i,o,c=!1){if(!this.opaquePassEnabledForLayer()&&!c)return He.disabled;let u=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new He(o||this.context.gl.LEQUAL,i,[u,u])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,i){this._wireframeDebugCache.update(this.frameCounter),this.style=t,this.options=i;let o=this.style._mergedLayers,c=this.style.order,u=c.map(R=>o[R]),h=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(ii.now()),this.imageManager.beginFrame();let p=0,f=!1;for(let R in h){let F=h[R];F.used&&(F.prepare(this.context),F.getSource().usedInConflation&&++p)}let g={},v={},y={},b={},x={};for(let R in h){let F=h[R];g[R]=F.getVisibleCoordinates(),v[R]=g[R].slice().reverse(),y[R]=F.getVisibleCoordinates(!0).reverse(),b[R]=F.getShadowCasterCoordinates(),x[R]=F.sortCoordinatesByDistance(g[R])}let C=R=>{let F=this.style.getLayerSourceCache(R);return F&&F.used?F.getSource():null};if(p){let R=[];for(let F of u)this.layerUsedInConflation(F,C(F))&&R.push(F);if(R&&R.length>1){let F=[];for(let N of R){let j=this.style.getLayerSourceCache(N);j&&j.used&&j.getSource().usedInConflation&&F.push({layer:N.fqid,cache:j})}this.replacementSource.setSources(F),f=!0}}f||this.replacementSource.clear(),this.conflationActive=f,this.minCutoffZoom=0,this.longestCutoffRange=0;for(let R of u){let F=R.cutoffRange();if(this.longestCutoffRange=Math.max(F,this.longestCutoffRange),F>0){let N=C(R);N&&(this.minCutoffZoom=Math.max(N.minzoom,this.minCutoffZoom)),R.minzoom&&(this.minCutoffZoom=Math.max(R.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let R=0;R<u.length;R++)if(u[R].is3D()){this.opaquePassCutoff=R;break}let E=this.style&&this.style.fog;E?(this._fogVisible=E.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=E.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(y),this.opaquePassCutoff=0);let M=this._shadowRenderer;if(M){M.updateShadowParameters(this.transform,this.style.directionalLight);for(let R in h)for(let F of g[R]){let N={min:0,max:0};this.terrain&&(N=this.terrain.getMinMaxForTile(F)||N),M.addShadowReceiver(F.toUnwrapped(),N.min,N.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new pU(this.context));for(let R of u){if(R.isHidden(this.transform.zoom))continue;let F=t.getLayerSourceCache(R);this.uploadLayer(this,R,F)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new IW),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!Jg.has(this.context.gl))return;this.renderPass="offscreen";for(let R of u){let F=t.getLayerSourceCache(R);if(!R.hasOffscreenPass()||R.isHidden(this.transform.zoom))continue;let N=F?v[F.id]:void 0;(R.type==="custom"||R.type==="raster"||R.isSky()||N&&N.length)&&this.renderLayer(this,F,R,N)}this.depthRangeFor3D=[0,1-(u.length+2)*this.numSublayers*this.depthEpsilon];let D=this.terrain;D&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&D.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,b)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let A=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),P=(()=>{if(i.showOverdrawInspector)return _i.black;if(this.style.fog&&this.transform.projection.supportsFog&&!A){let R=this.style.fog.properties.get("color").toArray01();return new _i(...R)}if(this.style.fog&&this.transform.projection.supportsFog&&A){let R=this.style.fog.properties.get("space-color").toArray01();return new _i(...R)}return _i.transparent})();if(this.context.clear({color:P,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&A&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=c.length-1;this.currentLayer>=0;this.currentLayer--){let R=u[this.currentLayer],F=t.getLayerSourceCache(R);if(R.isSky())continue;let N=F?(R.is3D()?x:v)[F.id]:void 0;this._renderTileClippingMasks(R,F,N),this.renderLayer(this,F,R,N)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&A&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||Co(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<c.length;this.currentLayer++){let R=u[this.currentLayer],F=t.getLayerSourceCache(R);R.isSky()&&this.renderLayer(this,F,R,F?v[F.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let O=0;for(M&&(O=M.getShadowCastingLayerCount());this.currentLayer<c.length;){let R=u[this.currentLayer],F=t.getLayerSourceCache(R);if(R.isSky()){++this.currentLayer;continue}if(D&&this.style.isLayerDraped(R)){if(R.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=D.renderBatch(this.currentLayer);continue}let N;if(F&&(N=(R.type==="symbol"?y:R.is3D()?x:v)[F.id]),this._renderTileClippingMasks(R,F,F?g[F.id]:void 0),this.renderLayer(this,F,R,N),!D&&M&&O>0&&R.hasShadowPass()&&--O==0&&(M.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let j=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=j;this.currentLayer++){let U=u[this.currentLayer];if(!U.hasLightBeamPass())continue;let G=t.getLayerSourceCache(U);this.renderLayer(this,G,U,G?v[G.id]:void 0)}this.currentLayer=j,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let R=null;u.forEach(F=>{let N=t.getLayerSourceCache(F);N&&!F.isHidden(this.transform.zoom)&&N.getVisibleCoordinates().length&&(!R||R.getSource().maxzoom<N.getSource().maxzoom)&&(R=N)}),R&&this.options.showTileBoundaries&&eF.debug(this,R,R.getVisibleCoordinates())}this.options.showPadding&&function(R){let F=R.transform.padding;ZO(R,R.transform.height-(F.top||0),3,vW),ZO(R,F.bottom||0,3,yW),XO(R,F.left||0,3,bW),XO(R,R.transform.width-(F.right||0),3,xW);let N=R.transform.centerPoint;(function(j,U,G,Y){ev(j,U-1,G-10,2,20,Y),ev(j,U-10,G-1,20,2,Y)})(R,N.x,R.transform.height-N.y,wW)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(m.performance.now()),this.saveCanvasCopy()),f||(this.conflationActive=!1)}uploadLayer(t,i,o){this.gpuTimingStart(i),(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes(i.type)||t.terrain&&i.type==="custom")&&iF[`${i.type}Upload`]&&iF[`${i.type}Upload`](t,o,i.scope),this.gpuTimingEnd()}renderLayer(t,i,o,c){o.isHidden(this.transform.zoom)||(o.type==="background"||o.type==="sky"||o.type==="custom"||o.type==="model"||o.type==="raster"||c&&c.length)&&(this.id=o.id,this.gpuTimingStart(o),(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes(o.type)||t.terrain&&o.type==="custom")&&eF[o.type](t,i,o,c,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;let i=this.context.extTimerQuery,o=this.context.gl,c=this.gpuTimers[t.id];c||(c=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:o.createQuery()}),c.calls++,o.beginQuery(i.TIME_ELAPSED_EXT,c.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let t=this.context.extTimerQuery,i=this.context.gl,o=i.createQuery();this.deferredRenderGpuTimeQueries.push(o),i.beginQuery(t.TIME_ELAPSED_EXT,o)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){let t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){let i={};for(let o in t){let c=t[o],u=this.context.extTimerQuery,h=u.getQueryParameter(c.query,this.context.gl.QUERY_RESULT)/1e6;u.deleteQueryEXT(c.query),i[o]=h}return i}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;let i=this.context.extTimerQuery,o=this.context.gl,c=0;for(let u of t)c+=i.getQueryParameter(u,o.QUERY_RESULT)/1e6,i.deleteQueryEXT(u);return c}translatePosMatrix(t,i,o,c,u){if(!o[0]&&!o[1])return t;let h=u?c==="map"?this.transform.angle:0:c==="viewport"?-this.transform.angle:0;if(h){let g=Math.sin(h),v=Math.cos(h);o=[o[0]*v-o[1]*g,o[0]*g+o[1]*v]}let p=[u?o[0]:lu(i,o[0],this.transform.zoom),u?o[1]:lu(i,o[1],this.transform.zoom),0],f=new Float32Array(16);return ft.translate(f,t,p),f}saveTileTexture(t){let i=t.size[0],o=this._tileTextures[i];o?o.push(t):this._tileTextures[i]=[t]}getTileTexture(t){let i=this._tileTextures[t];return i&&i.length>0?i.pop():null}isPatternMissing(t,i){return t===null||t!==void 0&&!this.imageManager.getPattern(t.toString(),i)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,i,o){let c=o===void 0?this.terrain&&this.terrain.renderingToTexture:o,u=this.terrain&&this.terrain.exaggeration()===0,h=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(h.push("LIGHTING_3D_MODE"),h.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):c||h.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||h.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?h.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):h.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(h.push("TERRAIN"),this.linearFloatFilteringSupported()&&h.push("TERRAIN_DEM_FLOAT_FORMAT"),u&&h.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&h.push("GLOBE"),!this._fogVisible||c||i!==void 0&&!i||h.push("FOG","FOG_DITHERING"),c&&h.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&h.push("OVERDRAW_INSPECTOR"),h}getOrCreateProgram(t,i){this.cache=this.cache||{};let o=i&&i.defines||[],c=i&&i.config,u=this.currentGlobalDefines(t,i&&i.overrideFog,i&&i.overrideRtt).concat(o),h=PO.cacheKey(CO[t],t,u,c);return this.cache[h]||(this.cache[h]=new PO(this.context,t,CO[t],c,lW[t],u)),this.cache[h]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=m.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new or(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,i){if(this.style.enable3dLights()){let o=this.style.directionalLight,c=this.style.ambientLight;if(o&&c){let u=((h,p)=>{let f=h.properties.get("direction"),g=h.properties.get("color").toArray01(),v=h.properties.get("intensity"),y=p.properties.get("color").toArray01(),b=p.properties.get("intensity"),x=[f.x,f.y,f.z],C=_r(y,b),E=_r(g,v);return{u_lighting_ambient_color:C,u_lighting_directional_dir:x,u_lighting_directional_color:E,u_ground_radiance:qq(x,E,C)}})(o,c);i.setLightsUniformValues(t,u)}}}uploadCommonUniforms(t,i,o,c,u){if(this.uploadCommonLightUniforms(t,i),this.terrain&&this.terrain.renderingToTexture)return;let h=this.style.fog;if(h){let p=h.getOpacity(this.transform.pitch),f=((g,v,y,b,x,C,E,M,D,A,P,O)=>{let R=g.transform,F=v.properties.get("color").toArray01();F[3]=b;let N=g.frameCounter/1e3%1,[j,U]=v.properties.get("vertical-range");return{u_fog_matrix:y?R.calculateFogTileMatrix(y):O||g.identityMat,u_fog_range:v.getFovAdjustedRange(R._fov),u_fog_color:F,u_fog_horizon_blend:v.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(j,U),U],u_fog_temporal_offset:N,u_frustum_tl:x,u_frustum_tr:C,u_frustum_br:E,u_frustum_bl:M,u_globe_pos:D,u_globe_radius:A,u_viewport:P,u_globe_transition:Co(R.zoom),u_is_globe:+(R.projection.name==="globe")}})(this,h,o,p,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*ii.devicePixelRatio,this.transform.height*ii.devicePixelRatio],c);i.setFogUniformValues(t,f)}u&&i.setCutoffUniformValues(t,u.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){let t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){let t=this.context.gl,i=t.createTexture();return t.bindTexture(t.TEXTURE_2D,i),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),i}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let t=this._backgroundTiles,i=this._backgroundTiles={},o=this.transform.coveringTiles({tileSize:512});for(let c of o)i[c.key]=t[c.key]||new Xp(c,512,this.transform.tileZoom,this);return i}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(t,i){return!(!t.is3D()||t.minzoom&&t.minzoom>this.transform.zoom||t.sourceLayer!=="building"&&(!i||i.type!=="batched-model"))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let i=this._cachedTileFogOpacities[t.key];return i||(this._cachedTileFogOpacities[t.key]=i=this.style.fog.getOpacityForTile(t)),i[0]>=uu||i[1]>=uu}}let mu=2048;class zW{constructor(t,i){this.aabb=t,this.lastCascade=i}}class NW{add(t,i){let o=this.receivers[t.key];o!==void 0?(o.aabb.min[0]=Math.min(o.aabb.min[0],i.min[0]),o.aabb.min[1]=Math.min(o.aabb.min[1],i.min[1]),o.aabb.min[2]=Math.min(o.aabb.min[2],i.min[2]),o.aabb.max[0]=Math.max(o.aabb.max[0],i.max[0]),o.aabb.max[1]=Math.max(o.aabb.max[1],i.max[1]),o.aabb.max[2]=Math.max(o.aabb.max[2],i.max[2])):this.receivers[t.key]=new zW(i,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,i,o){let c=Vn.fromPoints(t.points),u=0;for(let h in this.receivers){let p=this.receivers[h];if(!p||!c.intersectsAabb(p.aabb))continue;p.aabb.min=c.closestPoint(p.aabb.min),p.aabb.max=c.closestPoint(p.aabb.max);let f=p.aabb.getCorners();for(let g=0;g<o.length;g++){let v=!0;for(let y of f){let b=[y[0]*i,y[1]*i,y[2]];if(J.transformMat4(b,b,o[g].matrix),b[0]<-1||b[0]>1||b[1]<-1||b[1]>1){v=!1;break}}if(p.lastCascade=g,u=Math.max(u,g),v)break}}return u+1}}class BW{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new NW,this._depthMode=new He(t.context.gl.LEQUAL,He.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1}destroy(){for(let t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,i){let o=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!i||!i.properties)return;let c=i.properties.get("shadow-intensity");if(!i.shadowsEnabled()||c<=0||(this._shadowLayerCount=o.style.order.reduce((x,C)=>{let E=o.style._mergedLayers[C];return x+(E.hasShadowPass()&&!E.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;let u=o.context,h=mu,p=mu;if(this._cascades.length===0)for(let x=0;x<2;++x){let C=o._shadowMapDebug,E=u.gl,M=u.createFramebuffer(h,p,C,"texture"),D=new or(u,{width:h,height:p,data:null},E.DEPTH_COMPONENT);if(M.depthAttachment.set(D.texture),C){let A=new or(u,{width:h,height:p,data:null},E.RGBA);M.colorAttachment.set(A.texture)}this._cascades.push({framebuffer:M,texture:D,matrix:[],far:0,boundingSphereRadius:0,frustum:new mc,scale:0})}this.shadowDirection=nF(i);let f=0;if(t.elevation){let x=t.elevation,C=[1e4,-1e4];x.visibleDemTiles.filter(E=>E.dem).forEach(E=>{let M=E.dem.tree;C[0]=Math.min(C[0],M.minimums[0]),C[1]=Math.max(C[1],M.maximums[0])}),C[0]!==1e4&&(f=(C[1]-C[0])*x.exaggeration())}let g=1.5*t.cameraToCenterDistance,v=3*g,y=new Float64Array(16);for(let x=0;x<2;++x){let C=this._cascades[x],E=t.height/50,M=1;x===0?M=g:(E=g,M=v);let[D,A]=VW(t,this.shadowDirection,E,M,mu,f);C.scale=t.scale,C.matrix=D,C.boundingSphereRadius=A,ft.invert(y,C.matrix),C.frustum=mc.fromInvProjectionMatrix(y,1,0,!0),C.far=M}this._uniformValues.u_fade_range=[.75*this._cascades[1].far,this._cascades[1].far],this._uniformValues.u_shadow_intensity=c,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=mu,this._uniformValues.u_shadowmap_0=Ts.ShadowMap0,this._uniformValues.u_shadowmap_1=Ts.ShadowMap0+1,this._groundShadowTiles=o.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let b=o.transform.elevation;for(let x of this._groundShadowTiles){let C={min:0,max:0};if(b){let E=b.getMinMaxForTile(x);E&&(C=E)}this.addShadowReceiver(x.toUnwrapped(),C.min,C.max)}}get enabled(){return this._enabled}set enabled(t){this._enabled=t}drawShadowPass(t,i){if(!this._enabled)return;let o=this.painter,c=o.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(o.transform.getFrustum(0),o.transform.worldSize,this._cascades),c.viewport.set([0,0,mu,mu]);for(let u=0;u<this._numCascadesToRender;++u){o.currentShadowCascade=u,c.bindFramebuffer.set(this._cascades[u].framebuffer.framebuffer),c.clear({color:_i.white,depth:1});for(let h of t.order){let p=t._mergedLayers[h];if(!p.hasShadowPass()||p.isHidden(o.transform.zoom))continue;let f=t.getLayerSourceCache(p),g=f?i[f.id]:void 0;(p.type==="model"||g&&g.length)&&o.renderLayer(o,f,p,g)}}o.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;let t=this.painter,i=t.style,o=t.context,c=i.directionalLight,u=i.ambientLight;if(!c||!u)return;let h=[],p=Nh(t,t.longestCutoffRange);p.shouldRenderCutoff&&h.push("RENDER_CUTOFF");let f=lS(c,u),g=new He(o.gl.LEQUAL,He.ReadOnly,t.depthRangeFor3D);for(let v of this._groundShadowTiles){let y=v.toUnwrapped(),b=t.isTileAffectedByFog(v),x=t.getOrCreateProgram("groundShadow",{defines:h,overrideFog:b});this.setupShadows(y,x),t.uploadCommonUniforms(o,x,y,null,p);let C={u_matrix:t.transform.calculateProjMatrix(y),u_ground_shadow_factor:f};x.draw(t,o.gl.TRIANGLES,g,vi.disabled,Gi.multiply,bi.disabled,C,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Gi.unblended:Gi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){let i=this.painter.transform,o=i.calculatePosMatrix(t,i.worldSize);return ft.multiply(o,this._cascades[this.painter.currentShadowCascade].matrix,o),Float32Array.from(o)}calculateShadowPassMatrixFromMatrix(t){return ft.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,i,o,c=0){if(!this._enabled)return;let u=this.painter.transform,h=this.painter.context,p=h.gl,f=this._uniformValues,g=new Float64Array(16),v=u.calculatePosMatrix(t,u.worldSize);for(let y=0;y<2;y++)ft.multiply(g,this._cascades[y].matrix,v),f[y===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(g),h.activeTexture.set(p.TEXTURE0+Ts.ShadowMap0+y),this._cascades[y].texture.bind(p.NEAREST,p.CLAMP_TO_EDGE);if(this.useNormalOffset=!!o,this.useNormalOffset){let y=Lp(t.canonical),b=2/u.tileSize*wt/mu,x=b*this._cascades[0].boundingSphereRadius,C=b*this._cascades[1].boundingSphereRadius,E=(o==="vector-tile"?1:3)/Math.pow(2,c-t.canonical.z-(1-u.zoom+Math.floor(u.zoom)));f.u_shadow_normal_offset=[y,x*E,C*E],f.u_shadow_bias=[6e-5,.0012,.012]}else f.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(h,f)}setupShadowsFromMatrix(t,i,o=!1){if(!this._enabled)return;let c=this.painter.context,u=c.gl,h=this._uniformValues,p=new Float64Array(16);for(let f=0;f<2;f++)ft.multiply(p,this._cascades[f].matrix,t),h[f===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(p),c.activeTexture.set(u.TEXTURE0+Ts.ShadowMap0+f),this._cascades[f].texture.bind(u.NEAREST,u.CLAMP_TO_EDGE);this.useNormalOffset=o,o?(h.u_shadow_normal_offset=[1,5,5],h.u_shadow_bias=[6e-5,.0012,.012]):h.u_shadow_bias=[36e-5,.0012,.012],i.setShadowUniformValues(c,h)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,i,o,c){if(c[2]>=0)return{};let u=function(f,g,v){let y=v/(1<<f.canonical.z);return new Vn([f.canonical.x*y+f.wrap*v,f.canonical.y*y+f.wrap*v,0],[(f.canonical.x+1)*y+f.wrap*v,(f.canonical.y+1)*y+f.wrap*v,g])}(t,i,o).getCorners(),h=i/-c[2];c[0]<0?(J.add(u[0],u[0],[c[0]*h,0,0]),J.add(u[3],u[3],[c[0]*h,0,0])):c[0]>0&&(J.add(u[1],u[1],[c[0]*h,0,0]),J.add(u[2],u[2],[c[0]*h,0,0])),c[1]<0?(J.add(u[0],u[0],[0,c[1]*h,0]),J.add(u[1],u[1],[0,c[1]*h,0])):c[1]>0&&(J.add(u[2],u[2],[0,c[1]*h,0]),J.add(u[3],u[3],[0,c[1]*h,0]));let p={};return p.vertices=u,p.planes=[nv(u[1],u[0],u[4]),nv(u[2],u[1],u[5]),nv(u[3],u[2],u[6]),nv(u[0],u[3],u[7])],p}addShadowReceiver(t,i,o){this._receivers.add(t,Vn.fromTileIdAndHeight(t,i,o))}getMaxCascadeForTile(t){let i=this._receivers.get(t);return i&&i.lastCascade?i.lastCascade:0}}function nv(e,t,i){let o=J.sub([],i,t),c=J.sub([],e,t),u=J.cross([],o,c),h=J.length(u);return h===0?[0,0,1,0]:(J.scale(u,u,1/h),[u[0],u[1],u[2],-J.dot(u,t)])}function nF(e){let t=e.properties.get("direction"),i=Ae(t.x,t.y,t.z);i[2]=ve(i[2],0,75);let o=_e([i[0],i[1],i[2]]);return J.fromValues(o.x,o.y,o.z)}function lS(e,t){let i=e.properties.get("color"),o=e.properties.get("intensity"),c=e.properties.get("direction"),u=[c.x,c.y,c.z],h=t.properties.get("color"),p=t.properties.get("intensity"),f=Math.max(J.dot([0,0,1],u),0),g=[0,0,0];J.scale(g,h.toArray01Linear().slice(0,3),p);let v=[0,0,0];return J.scale(v,i.toArray01Linear().slice(0,3),f*o),Fr([g[0]>0?g[0]/(g[0]+v[0]):0,g[1]>0?g[1]/(g[1]+v[1]):0,g[2]>0?g[2]/(g[2]+v[2]):0])}function VW(e,t,i,o,c,u){let h=e.zoom,p=e.scale,f=e.worldSize,g=1/f,v=e.aspect,y=Math.sqrt(1+v*v)*Math.tan(.5*e.fovX),b=y*y,x=o-i,C=o+i,E,M;b>x/C?(E=o,M=o*y):(E=.5*C*(1+b),M=.5*Math.sqrt(x*x+2*(o*o+i*i)*b+C*C*b*b));let D=e.projection.pixelsPerMeter(e.center.lat,f),A=e._camera.getCameraToWorldMercator(),P=[0,0,-E*g];J.transformMat4(P,P,A);let O=M*g,R=e._edgeInsets;if(!(R.left===0&&R.top===0&&R.right===0&&R.bottom===0||R.left===R.right&&R.top===R.bottom)){let bt=e._camera.getWorldToCamera(e.worldSize,e.projection.zAxisUnit==="meters"?D:1),yt=e._camera.getCameraToClipPerspective(e._fov,e.width/e.height,i,o);yt[8]=2*-e.centerOffset.x/e.width,yt[9]=2*e.centerOffset.y/e.height;let Ct=new Float64Array(16);ft.mul(Ct,yt,bt);let Et=new Float64Array(16);ft.invert(Et,Ct);let It=mc.fromInvProjectionMatrix(Et,f,h,!0);for(let xt of It.points){let Ft=((F=xt)[0]/=p,F[1]/=p,F[2]=yn(F[2],e._center.lat),F);O=Math.max(O,J.len(J.subtract([],P,Ft)))}}var F;O*=c/(c-1);let N=Math.acos(t[2]),j=Math.atan2(-t[0],-t[1]),U=new k0;U.position=P,U.setPitchBearing(N,j);let G=U.getWorldToCamera(f,D),Y=O*f,Z=Math.min(e._mercatorZfromZoom(17)*f*-2,-2*Y),tt=U.getCameraToClipOrthographic(-Y,Y,-Y,Y,Z,(Y+u*D)/t[2]),$=new Float64Array(16);ft.multiply($,tt,G);let rt=J.fromValues(Math.floor(1e6*P[0])/1e6*f,Math.floor(1e6*P[1])/1e6*f,0),st=.5*c,pt=[0,0,0];J.transformMat4(pt,rt,$),J.scale(pt,pt,st);let nt=[Math.floor(pt[0]),Math.floor(pt[1]),Math.floor(pt[2])],ot=[0,0,0];J.sub(ot,pt,nt),J.scale(ot,ot,-1/st);let vt=new Float64Array(16);return ft.identity(vt),ft.translate(vt,vt,ot),ft.multiply($,vt,$),[$,Y]}class jW extends Hr{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.numModelsLoading={}}loadModel(t,i){return KP(this.requestManager.transformRequest(i,Dt.Model).url).then(o=>{if(!o)return;let c=$C(o),u=new $R(t,void 0,void 0,c);return u.computeBoundsAndApplyParent(),u}).catch(o=>{this.fire(new Xe(new Error(`Could not load model ${t} from ${i}: ${o.message}`)))})}load(t,i){this.models[i]||(this.models[i]={});let o=Object.keys(t);this.numModelsLoading[i]=(this.numModelsLoading[i]||0)+o.length;let c=[];for(let u of o)c.push(this.loadModel(u,t[u]));Promise.allSettled(c).then(u=>{for(let h=0;h<u.length;h++){let{status:p,value:f}=u[h];p==="fulfilled"&&f&&(this.models[i][o[h]]=f)}this.numModelsLoading[i]-=o.length,this.fire(new Wt("data",{dataType:"style"}))}).catch(u=>{this.fire(new Xe(new Error(`Could not load models: ${u.message}`)))})}isLoaded(){for(let t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,i){return!!this.getModel(t,i)}getModel(t,i){return this.models[i]||(this.models[i]={}),this.models[i][t]}addModel(t,i,o){this.models[o]||(this.models[o]={}),this.hasModel(t,o)&&this.removeModel(t,o),this.load({[t]:this.requestManager.normalizeModelURL(i)},o)}addModels(t,i){let o={};for(let c in t)o[c]=this.requestManager.normalizeModelURL(t[c]);this.load(o,i)}removeModel(t,i){this.models[i]||(this.models[i]={});let o=this.models[i][t];delete this.models[i][t],o.destroy()}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,i){this.models[i]||(this.models[i]={});for(let o in this.models[i])this.models[i][o].upload(t.context)}}let uf=(e,t)=>M_(e,t&&t.filter(i=>i.identifier!=="source.canvas")),UW=Go(Ki,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),HW=Go(Ki,["setCenter","setZoom","setBearing","setPitch"]),rF={version:8,layers:[],sources:{}},oF={duration:300,delay:0},GW=new Set(["fill","line","background","hillshade","raster"]);class nl extends Hr{constructor(t,i={}){super(),this.map=t,this.scope=i.scope||"",this.fragments=[],this.importDepth=i.importDepth||0,this.importsCache=i.importsCache||new Map,this.resolvedImports=i.resolvedImports||new Set,this.transition=ge({},oF),this._buildingIndex=new mq(this),this.crossTileSymbolIndex=new Lq,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=i.styleChanges||new M6,this.dispatcher=i.dispatcher?i.dispatcher:new j0(lf(),this),i.imageManager?this.imageManager=i.imageManager:(this.imageManager=new UG,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=i.glyphManager?i.glyphManager:new Ih(t._requestManager,i.localFontFamily?2:i.localIdeographFontFamily?1:0,i.localFontFamily||i.localIdeographFontFamily),i.modelManager?this.modelManager=i.modelManager:(this.modelManager=new jW(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=new Map,this._configDependentLayers=new Set,this._config=i.config,this.dispatcher.broadcast("setReferrer",Gt());let o=this;this._rtlTextPluginCallback=nl.registerForPluginStateChange(c=>{o.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:c.pluginStatus,pluginURL:c.pluginURL},(u,h)=>{if(r2(u),h&&h.every(p=>p))for(let p in o._sourceCaches){let f=o._sourceCaches[p],g=f.getSource().type;g!=="vector"&&g!=="geojson"||f.reload()}})}),this.on("data",c=>{if(c.dataType!=="source"||c.sourceDataType!=="metadata")return;let u=this.getOwnSource(c.sourceId);if(u&&u.vectorLayerIds)for(let h in this._layers){let p=this._layers[h];p.source===u.id&&this._validateLayer(p)}})}loadURL(t,i={}){this.fire(new Wt("dataloading",{dataType:"style"}));let o=typeof i.validate=="boolean"?i.validate:!cn(t);t=this.map._requestManager.normalizeStyleURL(t,i.accessToken),this.resolvedImports.add(t);let c=this.importsCache.get(t);if(c)return this._load(c,o);let u=this.map._requestManager.transformRequest(t,Dt.Style);this._request=Xt(u,(h,p)=>{if(this._request=null,h)this.fire(new Xe(h));else if(p)return this.importsCache.set(t,p),this._load(p,o)})}loadJSON(t,i={}){this.fire(new Wt("dataloading",{dataType:"style"})),this._request=ii.frame(()=>{this._request=null,this._load(t,i.validate!==!1)})}loadEmpty(){this.fire(new Wt("dataloading",{dataType:"style"})),this._load(rF,!1)}_loadImports(t,i){if(this.importDepth>=4)return lt("Style doesn't support nesting deeper than 5"),Promise.resolve();let o=[];for(let c of t){let u=this._createFragmentStyle(c),h=new Promise(f=>{u.once("style.import.load",f),u.once("error",f)}).then(()=>this.mergeAll());if(o.push(h),this.resolvedImports.has(c.url)){u.loadEmpty();continue}let p=c.data||this.importsCache.get(c.url);p?u.loadJSON(p,{validate:i}):c.url?u.loadURL(c.url,{validate:i}):u.loadEmpty(),this.fragments.push({style:u,id:c.id,config:c.config})}return Promise.allSettled(o)}_createFragmentStyle(t){let i=this.scope?Xo(t.id,this.scope):t.id,o=new nl(this.map,{scope:i,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:t.config});return o.setEventedParent(this.map,{style:o}),o}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});let t=this.isRootStyle();this._shouldPrecompile=t,this.fire(new Wt(t?"style.load":"style.import.load"))}_load(t,i){let o=t.schema;if(this.isRootStyle()&&(t.fragment||o&&t.fragment!==!1)){let h=ge({},rF,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(h,i)}if(this.setConfig(this._config,o),i&&uf(this,dh(t)))return;this._loaded=!0,this.stylesheet=K(t);for(let h in t.sources)this.addSource(h,t.sources[h],{validate:!1,isInitialLoad:!0});t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);let c=iO(this.stylesheet.layers);if(this._order=c.map(h=>h.id),this.stylesheet.light&&lt("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let h=this.stylesheet.lights[0];this.light=new IP(h.properties,h.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new IP(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let h of c){let p=B0(h,this.options);p.setScope(this.scope),p.isConfigDependent&&this._configDependentLayers.add(p.fqid),p.setEventedParent(this,{layer:{id:p.id}}),this._layers[p.id]=p,this._serializedLayers[p.id]=p.serialize();let f=this.getOwnLayerSourceCache(p),g=!!this.directionalLight&&this.directionalLight.shadowsEnabled();f&&p.canCastShadows()&&g&&(f.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let u=this.stylesheet.terrain;u&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=ii.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?lt("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(u,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new Wt("data",{dataType:"style"})),t.imports?this._loadImports(t.imports,i).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,i,o,c,u,h,p,f;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(g=>{if(g.stylesheet){if(g.light!=null&&(t=g.light),g.stylesheet.lights)for(let v of g.stylesheet.lights)v.type==="ambient"&&g.ambientLight!=null&&(i=g.ambientLight),v.type==="directional"&&g.directionalLight!=null&&(o=g.directionalLight);c=this._prioritizeTerrain(c,g.terrain,g.stylesheet.terrain),g.stylesheet.fog&&g.fog!=null&&(u=g.fog),g.stylesheet.camera!=null&&(f=g.stylesheet.camera),g.stylesheet.projection!=null&&(h=g.stylesheet.projection),g.stylesheet.transition!=null&&(p=g.stylesheet.transition)}}),this.light=t,this.ambientLight=i,this.directionalLight=o,this.fog=u,c===null?delete this.terrain:this.terrain=c,this.camera=f||{"camera-projection":"perspective"},this.projection=h||{name:"mercator"},this.transition=ge({},oF,p),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){let i=o=>{for(let c of o.fragments)i(c.style);t(o)};i(this)}_prioritizeTerrain(t,i,o){let c=t&&t.drapeRenderMode===0;return o===null?i&&i.drapeRenderMode===0?i:c?t:null:i!=null&&(!t||c||i&&i.drapeRenderMode===1)?i:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(i=>{t=this._prioritizeTerrain(t,i.terrain,i.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(i=>{i.stylesheet.projection!=null&&(t=i.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){let t={},i={},o={};this.forEachFragmentStyle(c=>{for(let u in c._sourceCaches){let h=Xo(u,c.scope);t[h]=c._sourceCaches[u]}for(let u in c._otherSourceCaches){let h=Xo(u,c.scope);i[h]=c._otherSourceCaches[u]}for(let u in c._symbolSourceCaches){let h=Xo(u,c.scope);o[h]=c._symbolSourceCaches[u]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=i,this._mergedSymbolSourceCaches=o}mergeLayers(){let t={},i=[],o={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(u=>{for(let h of u._order){let p=u._layers[h];if(p.type==="slot"){let f=A_(h);if(t[f])continue;t[f]=[]}p.slot&&t[p.slot]?t[p.slot].push(p):i.push(p)}}),this._mergedOrder=[];let c=(u=[])=>{for(let h of u)if(h.type==="slot"){let p=A_(h.id);t[p]&&c(t[p])}else{let p=Xo(h.id,h.scope);this._mergedOrder.push(p),o[p]=h,h.is3D()&&(this._has3DLayers=!0),h.type==="circle"&&(this._hasCircleLayers=!0),h.type==="symbol"&&(this._hasSymbolLayers=!0)}};c(i),this._mergedLayers=o,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=ge({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(i,o,c){let u,h,p,f=ii.devicePixelRatio>1?"@2x":"",g=Xt(o.transformRequest(o.normalizeSpriteURL(i,f,".json"),Dt.SpriteJSON),(b,x)=>{g=null,p||(p=b,u=x,y())}),v=fi(o.transformRequest(o.normalizeSpriteURL(i,f,".png"),Dt.SpriteImage),(b,x)=>{v=null,p||(p=b,h=x,y())});function y(){if(p)c(p);else if(u&&h){let b=ii.getImageData(h),x={};for(let C in u){let{width:E,height:M,x:D,y:A,sdf:P,pixelRatio:O,stretchX:R,stretchY:F,content:N}=u[C],j=new Br({width:E,height:M});Br.copy(b,j,{x:D,y:A},{x:0,y:0},{width:E,height:M}),x[C]={data:j,pixelRatio:O,sdf:P,stretchX:R,stretchY:F,content:N}}c(null,x)}}return{cancel(){g&&(g.cancel(),g=null),v&&(v.cancel(),v=null)}}}(t,this.map._requestManager,(i,o)=>{if(this._spriteRequest=null,i)this.fire(new Xe(i));else if(o)for(let c in o)this.imageManager.addImage(c,this.scope,o[c]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new Wt("data",{dataType:"style"}))})}_validateLayer(t){let i=this.getOwnSource(t.source);if(!i)return;let o=t.sourceLayer;o&&(i.type==="geojson"||i.vectorLayerIds&&i.vectorLayerIds.indexOf(o)===-1)&&this.fire(new Xe(new Error(`Source layer "${o}" does not exist on source "${i.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(let{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,i)=>{let o=this.fragments[i];return o&&o.style&&(t.data=o.style.serialize()),t})}_serializeSources(){let t={};for(let i in this._sourceCaches){let o=this._sourceCaches[i].getSource();t[o.id]||(t[o.id]=o.serialize())}return t}_serializeLayers(t){let i=[];for(let o of t){let c=this._layers[o];c&&c.type!=="custom"&&i.push(c.serialize())}return i}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(let t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&(typeof t.isLayerDraped=="function"?t.isLayerDraped(this.getLayerSourceCache(t)):GW.has(t.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){let i=this.getOwnLayer(t);if(i)return i;this.fire(new Xe(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){let i=this.getOwnSource(t);if(i)return i;this.fire(new Xe(new Error(`The source '${t}' does not exist in the map's style.`)))}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);let i=this.calculateLightsBrightness();t.brightness=i||0,i!==this._brightness&&(this._brightness=i,this.dispatcher.broadcast("setBrightness",i));let o=this._changes.isDirty();if(this._changes.isDirty()){let u=this._changes.getLayerUpdatesByScope();for(let h in u){let{updatedIds:p,removedIds:f}=u[h];(p||f)&&this._updateWorkerLayers(h,p,f)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._changes.reset()}let c={};for(let u in this._mergedSourceCaches){let h=this._mergedSourceCaches[u];c[u]=h.used,h.used=!1}for(let u of this._mergedOrder){let h=this._mergedLayers[u];if(h.recalculate(t,this._availableImages),!h.isHidden(t.zoom)){let p=this.getLayerSourceCache(h);p&&(p.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let p=h.minzoom||0;p<(h.maxzoom||25.5);p++){let f=this.map.painter;if(f){let g=h.getProgramIds();if(!g)continue;for(let v of g){let y=h.getDefaultProgramParams(v,t.zoom);y&&(f.style=this,this.fog&&(f._fogVisible=!0,y.overrideFog=!0,f.getOrCreateProgram(v,y)),f._fogVisible=!1,y.overrideFog=!1,f.getOrCreateProgram(v,y),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(y.overrideRtt=!0,f.getOrCreateProgram(v,y)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(let u in c){let h=this._mergedSourceCaches[u];c[u]!==h.used&&h.getSource().fire(new Wt("data",{sourceDataType:"visibility",dataType:"source",sourceId:h.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),o&&this.fire(new Wt("data",{dataType:"style"}))}_updateTilesForChangedImages(){let t=this._changes.getUpdatedImages();if(t.length){for(let i in this._sourceCaches)this._sourceCaches[i].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,i,o){let c=this.getFragmentStyle(t);c&&this.dispatcher.broadcast("updateLayers",{layers:i?c._serializeLayers(i):[],scope:t,removedIds:o||[],options:c.options})}setState(t){if(this._checkLoaded(),uf(this,dh(t)))return!1;(t=K(t)).layers=iO(t.layers);let i=function(c,u){if(!c)return[{command:Ki.setStyle,args:[u]}];let h=[];try{if(!$t(c.version,u.version))return[{command:Ki.setStyle,args:[u]}];$t(c.center,u.center)||h.push({command:Ki.setCenter,args:[u.center]}),$t(c.zoom,u.zoom)||h.push({command:Ki.setZoom,args:[u.zoom]}),$t(c.bearing,u.bearing)||h.push({command:Ki.setBearing,args:[u.bearing]}),$t(c.pitch,u.pitch)||h.push({command:Ki.setPitch,args:[u.pitch]}),$t(c.sprite,u.sprite)||h.push({command:Ki.setSprite,args:[u.sprite]}),$t(c.glyphs,u.glyphs)||h.push({command:Ki.setGlyphs,args:[u.glyphs]}),$t(c.imports,u.imports)||function(y=[],b=[],x){b=b||[];let C=(y=y||[]).map(q0),E=b.map(q0),M=y.reduce(W0,{}),D=b.reduce(W0,{}),A=C.slice(),P,O,R,F;for(P=0,O=0;P<C.length;P++)R=C[P],D.hasOwnProperty(R)?O++:(x.push({command:Ki.removeImport,args:[R]}),A.splice(A.indexOf(R,O),1));for(P=0,O=0;P<E.length;P++)R=E[E.length-1-P],A[A.length-1-P]!==R&&(M.hasOwnProperty(R)?(x.push({command:Ki.removeImport,args:[R]}),A.splice(A.lastIndexOf(R,A.length-O),1)):O++,F=A[A.length-P],x.push({command:Ki.addImport,args:[D[R],F]}),A.splice(A.length-P,0,R));for(let N of b){let j=M[N.id];if(!j||$t(j,N))continue;$t(j.config,N.config)||x.push({command:Ki.setImportConfig,args:[N.id,N.config]}),$t(j.url,N.url)||x.push({command:Ki.setImportUrl,args:[N.id,N.url]});let U=N.data;$t(j&&j.data,U)||x.push({command:Ki.setImportData,args:[N.id,U]})}}(c.imports,u.imports,h),$t(c.transition,u.transition)||h.push({command:Ki.setTransition,args:[u.transition]}),$t(c.light,u.light)||h.push({command:Ki.setLight,args:[u.light]}),$t(c.fog,u.fog)||h.push({command:Ki.setFog,args:[u.fog]}),$t(c.projection,u.projection)||h.push({command:Ki.setProjection,args:[u.projection]}),$t(c.lights,u.lights)||h.push({command:Ki.setLights,args:[u.lights]}),$t(c.camera,u.camera)||h.push({command:Ki.setCamera,args:[u.camera]});let p={},f=[];(function(y,b,x,C){let E;for(E in b=b||{},y=y||{})y.hasOwnProperty(E)&&(b.hasOwnProperty(E)||rO(E,x,C));for(E in b){if(!b.hasOwnProperty(E))continue;let M=b[E];y.hasOwnProperty(E)?$t(y[E],M)||(y[E].type==="geojson"&&M.type==="geojson"&&gq(y,b,E)?x.push({command:Ki.setGeoJSONSourceData,args:[E,M.data]}):fq(E,b,x,C)):nO(E,b,x)}})(c.sources,u.sources,f,p);let g=[];c.layers&&c.layers.forEach(y=>{y.source&&p[y.source]?h.push({command:Ki.removeLayer,args:[y.id]}):g.push(y)});let v=c.terrain;v&&p[v.source]&&(h.push({command:Ki.setTerrain,args:[void 0]}),v=void 0),h=h.concat(f),$t(v,u.terrain)||h.push({command:Ki.setTerrain,args:[u.terrain]}),function(y,b,x){b=b||[];let C=(y=y||[]).map(q0),E=b.map(q0),M=y.reduce(W0,{}),D=b.reduce(W0,{}),A=C.slice(),P=Object.create(null),O,R,F,N,j,U,G;for(O=0,R=0;O<C.length;O++)F=C[O],D.hasOwnProperty(F)?R++:(x.push({command:Ki.removeLayer,args:[F]}),A.splice(A.indexOf(F,R),1));for(O=0,R=0;O<E.length;O++)F=E[E.length-1-O],A[A.length-1-O]!==F&&(M.hasOwnProperty(F)?(x.push({command:Ki.removeLayer,args:[F]}),A.splice(A.lastIndexOf(F,A.length-R),1)):R++,U=A[A.length-O],x.push({command:Ki.addLayer,args:[D[F],U]}),A.splice(A.length-O,0,F),P[F]=!0);for(O=0;O<E.length;O++)if(F=E[O],N=M[F],j=D[F],!P[F]&&!$t(N,j))if($t(N.source,j.source)&&$t(N["source-layer"],j["source-layer"])&&$t(N.type,j.type)){for(G in G0(N.layout,j.layout,x,F,null,Ki.setLayoutProperty),G0(N.paint,j.paint,x,F,null,Ki.setPaintProperty),$t(N.slot,j.slot)||x.push({command:Ki.setSlot,args:[F,j.slot]}),$t(N.filter,j.filter)||x.push({command:Ki.setFilter,args:[F,j.filter]}),$t(N.minzoom,j.minzoom)&&$t(N.maxzoom,j.maxzoom)||x.push({command:Ki.setLayerZoomRange,args:[F,j.minzoom,j.maxzoom]}),N)N.hasOwnProperty(G)&&G!=="layout"&&G!=="paint"&&G!=="filter"&&G!=="metadata"&&G!=="minzoom"&&G!=="maxzoom"&&G!=="slot"&&(G.indexOf("paint.")===0?G0(N[G],j[G],x,F,G.slice(6),Ki.setPaintProperty):$t(N[G],j[G])||x.push({command:Ki.setLayerProperty,args:[F,G,j[G]]}));for(G in j)j.hasOwnProperty(G)&&!N.hasOwnProperty(G)&&G!=="layout"&&G!=="paint"&&G!=="filter"&&G!=="metadata"&&G!=="minzoom"&&G!=="maxzoom"&&G!=="slot"&&(G.indexOf("paint.")===0?G0(N[G],j[G],x,F,G.slice(6),Ki.setPaintProperty):$t(N[G],j[G])||x.push({command:Ki.setLayerProperty,args:[F,G,j[G]]}))}else x.push({command:Ki.removeLayer,args:[F]}),U=A[A.lastIndexOf(F)+1],x.push({command:Ki.addLayer,args:[j,U]})}(g,u.layers,h)}catch(p){console.warn("Unable to compute style diff:",p),h=[{command:Ki.setStyle,args:[u]}]}return h}(this.serialize(),t).filter(c=>!(c.command in HW));if(i.length===0)return!1;let o=i.filter(c=>!(c.command in UW));if(o.length>0)throw new Error(`Unimplemented: ${o.map(c=>c.command).join(", ")}.`);return i.forEach(c=>{this[c.command].apply(this,c.args)}),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,i){return this.getImage(t)?this.fire(new Xe(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,i),this._afterImageUpdated(t),this)}updateImage(t,i){this.imageManager.updateImage(t,this.scope,i)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new Xe(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(t),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new Wt("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,i,o={}){return this._checkLoaded(),this._validate(y6,`models.${t}`,i,null,o)||(this.modelManager.addModel(t,i,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new Xe(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,i,o={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(u6,`sources.${t}`,i,null,o))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);let c=ZC(t,i,this.dispatcher,this);c.scope=this.scope,c.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(c.id),source:c.serialize(),sourceId:c.id}));let u=h=>{let p=(h?"symbol:":"other:")+c.id,f=Xo(p,this.scope),g=this._sourceCaches[p]=new tl(f,c,h);(h?this._symbolSourceCaches:this._otherSourceCaches)[c.id]=g,g.onAdd(this.map)};u(!1),i.type!=="vector"&&i.type!=="geojson"||u(!0),c.onAdd&&c.onAdd(this.map),o.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();let i=this.getOwnSource(t);if(!i)throw new Error("There is no source with this ID");for(let c in this._layers)if(this._layers[c].source===t)return this.fire(new Xe(new Error(`Source "${t}" cannot be removed while layer "${c}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new Xe(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));let o=this.getOwnSourceCaches(t);for(let c of o){let u=A_(c.id);delete this._sourceCaches[u],this._changes.discardSourceCacheUpdate(c.id),c.fire(new Wt("data",{sourceDataType:"metadata",dataType:"source",sourceId:c.getSource().id})),c.setEventedParent(null),c.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),i.setEventedParent(null),i.onRemove&&i.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,i){this._checkLoaded(),this.getOwnSource(t).setData(i),this._changes.setDirty()}getOwnSource(t){let i=this.getOwnSourceCache(t);return i&&i.getSource()}getOwnSources(){let t=[];for(let i in this._otherSourceCaches){let o=this.getOwnSourceCache(i);o&&t.push(o.getSource())}return t}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;let i=this._getTransitionParameters();for(let c of t){if(this._validate(m6,"lights",c))return;switch(c.type){case"ambient":if(this.ambientLight){let u=this.ambientLight;u.set(c),u.updateTransitions(i)}else this.ambientLight=new LP(c,XG,this.scope,this.options);break;case"directional":if(this.directionalLight){let u=this.directionalLight;u.set(c),u.updateTransitions(i)}else this.directionalLight=new LP(c,KG,this.scope,this.options)}}let o=new ir(this.z||0,i);this.ambientLight&&this.ambientLight.recalculate(o),this.directionalLight&&this.directionalLight.recalculate(o),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let t=this.directionalLight,i=this.ambientLight;if(!t||!i)return;let o=y=>.2126*(y[0]<=.03928?y[0]/12.92:Math.pow((y[0]+.055)/1.055,2.4))+.7152*(y[1]<=.03928?y[1]/12.92:Math.pow((y[1]+.055)/1.055,2.4))+.0722*(y[2]<=.03928?y[2]/12.92:Math.pow((y[2]+.055)/1.055,2.4)),c=t.properties.get("color").toArray01(),u=t.properties.get("intensity"),h=t.properties.get("direction"),p=1-Ae(h.x,h.y,h.z)[2]/90,f=o(c)*u*p,g=i.properties.get("color").toArray01(),v=i.properties.get("intensity");return(f+o(g)*v)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(l2(t)){let i=function(u){let h=u.indexOf(I_);return h>=0?u.slice(h+1):""}(t),o=this.fragments.find(({id:u})=>u===i);if(!o)throw new Error(`Style import not found: ${t}`);let c=A_(t);return o.style.getFragmentStyle(c)}{let i=this.fragments.find(({id:o})=>o===t);if(!i)throw new Error(`Style import not found: ${t}`);return i.style}}getConfigProperty(t,i){let o=this.getFragmentStyle(t);if(!o)return null;let c=o.options.get(i),u=c?c.value||c.default:null;return u?u.serialize():null}setConfigProperty(t,i,o){let c=Uc(o);if(c.result!=="success")return void uf(this,c.value);let u=c.value.expression,h=this.getFragmentStyle(t);if(!h)return;let p=h.options.get(i);p&&(h.options.set(i,Pi(qt({},p),{value:u})),h.updateConfigDependencies())}setConfig(t,i){if(this._config=t,t||i)if(i){this.options.clear();for(let o in i){let c,u,h=Uc(i[o].default);if(h.result==="success"&&(c=h.value.expression),t&&t[o]!==void 0){let b=Uc(t[o]);b.result==="success"&&(u=b.value.expression)}let{minValue:p,maxValue:f,stepValue:g,type:v,values:y}=i[o];c?this.options.set(o,{default:c,value:u,minValue:p,maxValue:f,stepValue:g,type:v,values:y}):this.fire(new Xe(new Error(`No schema defined for config option "${o}".`)))}}else this.fire(new Xe(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(let t of this._configDependentLayers){let i=this.getLayer(t);i&&(i.possiblyEvaluateVisibility(),this._updateLayer(i))}this.ambientLight&&this.ambientLight.scope===this.scope&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.scope===this.scope&&this.directionalLight.updateConfig(this.options),this._changes.setDirty()}addLayer(t,i,o={}){this._checkLoaded();let c=t.id;if(this._layers[c])return void this.fire(new Xe(new Error(`Layer with id "${c}" already exists on this map`)));let u;if(t.type==="custom"){if(uf(this,function(v){let y=[],b=v.id;return b===void 0&&y.push({message:`layers.${b}: missing required property "id"`}),v.render===void 0&&y.push({message:`layers.${b}: missing required method "render"`}),v.renderingMode&&v.renderingMode!=="2d"&&v.renderingMode!=="3d"&&y.push({message:`layers.${b}: property "renderingMode" must be either "2d" or "3d"`}),y}(t)))return;u=B0(t,this.options)}else{if(typeof t.source=="object"&&(this.addSource(c,t.source),t=ge(t=K(t),{source:c})),this._validate(g6,`layers.${c}`,t,{arrayIndex:-1},o))return;u=B0(t,this.options),this._validateLayer(u),u.setEventedParent(this,{layer:{id:c}}),this._serializedLayers[u.id]=u.serialize()}u.isConfigDependent&&this._configDependentLayers.add(u.fqid),u.setScope(this.scope);let h=this._order.length;if(i){let v=this._order.indexOf(i);if(v===-1)return void this.fire(new Xe(new Error(`Layer with id "${i}" does not exist on this map.`)));u.slot===this._layers[i].slot?h=v:lt(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(h,0,c),this._layerOrderChanged=!0,this._layers[c]=u;let p=this.getOwnLayerSourceCache(u),f=!!this.directionalLight&&this.directionalLight.shadowsEnabled();p&&u.canCastShadows()&&f&&(p.castsShadows=!0);let g=this._changes.getRemovedLayer(u);if(g&&u.source&&p&&u.type!=="custom"){this._changes.discardLayerRemoval(u);let v=Xo(u.source,u.scope);g.type!==u.type?this._changes.updateSourceCache(v,"clear"):(this._changes.updateSourceCache(v,"reload"),p.pause())}this._updateLayer(u),u.onAdd&&u.onAdd(this.map),u.scope=this.scope,this.mergeLayers()}moveLayer(t,i){this._checkLoaded();let o=this._checkLayer(t);if(!o||t===i)return;let c=this._order.indexOf(t);this._order.splice(c,1);let u=this._order.length;if(i){let h=this._order.indexOf(i);if(h===-1)return void this.fire(new Xe(new Error(`Layer with id "${i}" does not exist on this map.`)));o.slot===this._layers[i].slot?u=h:lt(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(u,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();let i=this._checkLayer(t);if(!i)return;i.setEventedParent(null);let o=this._order.indexOf(t);this._order.splice(o,1),delete this._layers[t],delete this._serializedLayers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(i.fqid),this._changes.removeLayer(i);let c=this.getOwnLayerSourceCache(i);if(c&&c.castsShadows){let u=!1;for(let h in this._layers)if(this._layers[h].source===i.source&&this._layers[h].canCastShadows()){u=!0;break}c.castsShadows=u}i.onRemove&&i.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(let i in this._layers)if(this._layers[i].type===t)return!0;return!1}setLayerZoomRange(t,i,o){this._checkLoaded();let c=this._checkLayer(t);c&&(c.minzoom===i&&c.maxzoom===o||(i!=null&&(c.minzoom=i),o!=null&&(c.maxzoom=o),this._updateLayer(c)))}setSlot(t,i){this._checkLoaded();let o=this._checkLayer(t);o&&o.slot!==i&&(o.slot=i,this._updateLayer(o))}setFilter(t,i,o={}){this._checkLoaded();let c=this._checkLayer(t);if(c&&!$t(c.filter,i))return i==null?(c.filter=void 0,void this._updateLayer(c)):void(this._validate(H1,`layers.${c.id}.filter`,i,{layerType:c.type},o)||(c.filter=K(i),this._updateLayer(c)))}getFilter(t){let i=this._checkLayer(t);if(i)return K(i.filter)}setLayoutProperty(t,i,o,c={}){this._checkLoaded();let u=this._checkLayer(t);u&&($t(u.getLayoutProperty(i),o)||(u.setLayoutProperty(i,o,c),u.isConfigDependent&&this._configDependentLayers.add(u.fqid),this._updateLayer(u)))}getLayoutProperty(t,i){let o=this._checkLayer(t);if(o)return o.getLayoutProperty(i)}setPaintProperty(t,i,o,c={}){this._checkLoaded();let u=this._checkLayer(t);if(!u||$t(u.getPaintProperty(i),o))return;let h=u.setPaintProperty(i,o,c);u.isConfigDependent&&this._configDependentLayers.add(u.fqid),h&&this._updateLayer(u),this._changes.updatePaintProperties(u)}getPaintProperty(t,i){let o=this._checkLayer(t);if(o)return o.getPaintProperty(i)}setFeatureState(t,i){this._checkLoaded();let o=t.source,c=t.sourceLayer,u=this._checkSource(o);if(!u)return;let h=u.type;if(h==="geojson"&&c)return void this.fire(new Xe(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(h==="vector"&&!c)return void this.fire(new Xe(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new Xe(new Error("The feature id parameter must be provided.")));let p=this.getOwnSourceCaches(o);for(let f of p)f.setFeatureState(c,t.id,i)}removeFeatureState(t,i){this._checkLoaded();let o=t.source,c=this._checkSource(o);if(!c)return;let u=c.type,h=u==="vector"?t.sourceLayer:void 0;if(u==="vector"&&!h)return void this.fire(new Xe(new Error("The sourceLayer parameter must be provided for vector source types.")));if(i&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new Xe(new Error("A feature id is required to remove its specific state property.")));let p=this.getOwnSourceCaches(o);for(let f of p)f.removeFeatureState(h,t.id,i)}getFeatureState(t){this._checkLoaded();let i=t.source,o=t.sourceLayer,c=this._checkSource(i);if(c){if(c.type!=="vector"||o)return t.id===void 0&&this.fire(new Xe(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(i)[0].getFeatureState(o,t.id);this.fire(new Xe(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=ge({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return ge({},this.stylesheet.transition)}serialize(){this._checkLoaded();let t=this.getTerrain(),i=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return Yt({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:i,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},o=>o!==void 0)}_updateLayer(t){this._changes.updateLayer(t);let i=this.getLayerSourceCache(t),o=Xo(t.source,t.scope),c=this._changes.getUpdatedSourceCaches();t.source&&!c[o]&&i&&i.getSource().type!=="raster"&&(this._changes.updateSourceCache(o,"reload"),i.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){let i=p=>this._mergedLayers[p].type==="fill-extrusion",o=this.order,c={},u=[];for(let p=o.length-1;p>=0;p--){let f=o[p];if(i(f)){c[f]=p;for(let g of t){let v=g[f];if(v)for(let y of v)u.push(y)}}}u.sort((p,f)=>f.intersectionZ-p.intersectionZ);let h=[];for(let p=o.length-1;p>=0;p--){let f=o[p];if(i(f))for(let g=u.length-1;g>=0;g--){let v=u[g].feature;if(c[v.layer.id]<p)break;h.push(v),u.pop()}else for(let g of t){let v=g[f];if(v)for(let y of v)h.push(y.feature)}}return h}queryRenderedFeatures(t,i,o){i&&i.filter&&this._validate(H1,"queryRenderedFeatures.filter",i.filter,null,i),i.scope=this.scope,i.availableImages=this._availableImages,i.serializedLayers=this._serializedLayers;let c={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new Xe(new Error("parameters.layers must be an Array."))),[];for(let g of i.layers){let v=this._mergedLayers[g];if(!v)return this.fire(new Xe(new Error(`The layer '${g}' does not exist in the map's style and cannot be queried for features.`))),[];c[v.source]=!0}}let u=[],h=i.serializedLayers||{},p=i&&i.layers?i.layers.some(g=>{let v=this.getLayer(g);return v&&v.is3D()}):this.has3DLayers(),f=OC.createFromScreenPoints(t,o);for(let g in this._mergedSourceCaches){let v=this._mergedSourceCaches[g].getSource();if(!v||v.scope!==i.scope)continue;let y=this._mergedSourceCaches[g].getSource().id;i.layers&&!c[y]||u.push(uq(this._mergedSourceCaches[g],this._mergedLayers,h,f,i,o,p,!!this.map._showQueryGeometry))}return this.placement&&u.push(function(g,v,y,b,x,C,E){let M={},D=C.queryRenderedSymbols(b),A=[];for(let P of Object.keys(D).map(Number))A.push(E[P]);A.sort(tO);for(let P of A){let O=P.featureIndex.lookupSymbolFeatures(D[P.bucketInstanceId],v,P.bucketIndex,P.sourceLayerIndex,x.filter,x.layers,x.availableImages,g);for(let R in O){let F=M[R]=M[R]||[],N=O[R];N.sort((j,U)=>{let G=P.featureSortOrder;if(G){let Y=G.indexOf(j.featureIndex);return G.indexOf(U.featureIndex)-Y}return U.featureIndex-j.featureIndex});for(let j of N)F.push(j)}}for(let P in M)M[P].forEach(O=>{let R=O.feature,F=y(g[P]);if(!F)return;let N=F.getFeatureState(R.layer["source-layer"],R.id);R.source=R.layer.source,R.layer["source-layer"]&&(R.sourceLayer=R.layer["source-layer"]),R.state=N});return M}(this._mergedLayers,h,this.getLayerSourceCache.bind(this),f.screenGeometry,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(u)}querySourceFeatures(t,i){i&&i.filter&&this._validate(H1,"querySourceFeatures.filter",i.filter,null,i);let o=this.getOwnSourceCaches(t),c=[];for(let u of o)c=c.concat(hq(u,i));return c}addSourceType(t,i,o){return nl.getSourceType(t)?o(new Error(`A source type called "${t}" already exists.`)):(nl.setSourceType(t,i),i.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:i.workerSourceURL},o):o(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,i,o={}){this._checkLoaded();let c=this.light.getLight(),u=!1;for(let p in t)if(!$t(t[p],c[p])){u=!0;break}if(!u)return;let h=this._getTransitionParameters();this.light.setLight(t,i,o),this.light.updateTransitions(h)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(t,i=1){if(this._checkLoaded(),!t)return delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let o=t,c=t.source==null;if(i===1){if(typeof o.source=="object"){let p="terrain-dem-src";this.addSource(p,o.source),o=K(o),o=ge(o,{source:p})}let u=ge({},o),h={};if(this.terrain&&c){u.source=this.terrain.get().source;let p=this.terrain?this.getFragmentStyle(this.terrain.scope):null;p&&(h.style=p.serialize())}if(this._validate(p6,"terrain",u,h))return}if(!this.terrain||this.terrain.scope!==this.scope&&!c||this.terrain&&i!==this.terrain.drapeRenderMode){if(!o)return;this._createTerrain(o,i),this.fire(new Wt("data",{dataType:"style"}))}else{let u=this.terrain,h=u.get();for(let p of Object.keys(_t.terrain))!o.hasOwnProperty(p)&&_t.terrain[p].default&&(o[p]=_t.terrain[p].default);for(let p in t)if(!$t(t[p],h[p])){u.set(t,this.options),this.stylesheet.terrain=t;let f=this._getTransitionParameters({duration:0});u.updateTransitions(f),this.fire(new Wt("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){let i=this.fog=new $G(t,this.map.transform);this.stylesheet.fog=i.get();let o=this._getTransitionParameters({duration:0});i.updateTransitions(o)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let i=this.fog;if(!$t(i.get(),t)){i.set(t),this.stylesheet.fog=i.get();let o=this._getTransitionParameters({duration:0});i.updateTransitions(o)}}else this._createFog(t);this._markersNeedUpdate=!0}_getTransitionParameters(t){return{now:ii.now(),transition:ge(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;let t=[],i=[];for(let o in this._mergedLayers)this.isLayerDraped(this._mergedLayers[o])?t.push(o):i.push(o);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...i)}_createTerrain(t,i){let o=this.terrain=new qG(t,i,this.scope,this.options);i===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let c=this._getTransitionParameters({duration:0});o.updateTransitions(c)}_force3DLayerUpdate(){for(let t in this._layers){let i=this._layers[t];i.type==="fill-extrusion"&&this._updateLayer(i)}}_forceSymbolLayerUpdate(){for(let t in this._layers){let i=this._layers[t];i.type==="symbol"&&this._updateLayer(i)}}_validate(t,i,o,c,u={}){if(u&&u.validate===!1)return!1;let h=ge({},this.serialize());return uf(this,t.call(dh,ge({key:i,style:h,value:o,styleSpec:_t},c)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),K1.off("pluginStateChange",this._rtlTextPluginCallback);for(let t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(let t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){let i=this.getSourceCaches(t);for(let o of i)o.clearTiles()}clearSources(){for(let t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){let i=this.getSourceCaches(t);for(let o of i)o.resume(),o.reload()}reloadSources(){for(let t of this.getSources())t.reload&&t.reload()}updateSources(t){let i;this.directionalLight&&(i=nF(this.directionalLight));for(let o in this._mergedSourceCaches)this._mergedSourceCaches[o].update(t,void 0,void 0,i)}_generateCollisionBoxes(){for(let t in this._sourceCaches){let i=this._sourceCaches[t];i.resume(),i.reload()}}_updatePlacement(t,i,o,c,u=!1){let h=!1,p=!1,f={},g={};for(let v of this._mergedOrder){let y=this._mergedLayers[v];if(y.type!=="symbol")continue;let b=Xo(y.source,y.scope),x=f[b];if(!x){let E=this.getLayerSourceCache(y);if(!E)continue;let M=E.getRenderableIds(!0).map(D=>E.getTileByID(D));g[b]=M.slice(),x=f[b]=M.sort((D,A)=>A.tileID.overscaledZ-D.tileID.overscaledZ||(D.tileID.isLessThan(A.tileID)?-1:1))}let C=this.crossTileSymbolIndex.addLayer(y,x,t.center.lng,t.projection);h=h||C}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),u=u||this._layerOrderChanged||o===0,this._layerOrderChanged&&this.fire(new Wt("neworder")),(u||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ii.now(),t.zoom))&&(this.pauseablePlacement=new Rq(t,this._mergedOrder,u,i,o,c,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,f,g),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ii.now()),p=!0),h&&this.pauseablePlacement.placement.setStale()),p||h)for(let v of this._mergedOrder){let y=this._mergedLayers[v];y.type==="symbol"&&this.placement.updateLayerOpacities(y,f[Xo(y.source,y.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ii.now())}_releaseSymbolFadeTiles(){for(let t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t){this._checkLoaded();let i=this.stylesheet.imports=this.stylesheet.imports||[];return i.findIndex(({id:c})=>c===t.id)!==-1?this.fire(new Xe(new Error(`Import with id '${t.id}' already exists in the map's style.`))):(i.push(t),this._loadImports([t],!0),this)}setImportUrl(t,i){this._checkLoaded();let o=this.stylesheet.imports||[],c=this.getImportIndex(t);if(c===-1)return this;o[c].url=i;let u=this.fragments[c];return u.style=this._createFragmentStyle(o[c]),u.style.on("style.import.load",()=>this.mergeAll()),u.style.loadURL(i),this}setImportData(t,i){this._checkLoaded();let o=this.getImportIndex(t),c=this.stylesheet.imports||[];return o===-1?this:i?(this.fragments[o].style.setState(i),this._reloadImports(),this):(delete c[o].data,this.setImportUrl(t,c[o].url))}setImportConfig(t,i){this._checkLoaded();let o=this.getImportIndex(t),c=this.stylesheet.imports||[];if(o===-1)return this;i?c[o].config=i:delete c[o].config;let u=this.fragments[o],h=u.style.stylesheet&&u.style.stylesheet.schema;return u.config=i,u.style.setConfig(i,h),u.style.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();let i=this.stylesheet.imports||[],o=this.getImportIndex(t);return o===-1||(i.splice(o,1),this.fragments[o].style._remove(),this.fragments.splice(o,1),this._reloadImports()),this}getImportIndex(t){let i=(this.stylesheet.imports||[]).findIndex(o=>o.id===t);return i===-1&&this.fire(new Xe(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),i}getLayer(t){return this._mergedLayers[t]}getSources(){let t=[];for(let i in this._mergedOtherSourceCaches){let o=this._mergedOtherSourceCaches[i];o&&t.push(o.getSource())}return t}getSource(t,i){let o=this.getSourceCache(t,i);return o&&o.getSource()}getLayerSource(t){let i=this.getLayerSourceCache(t);return i&&i.getSource()}getSourceCache(t,i){let o=Xo(t,i);return this._mergedOtherSourceCaches[o]}getLayerSourceCache(t){let i=Xo(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[i]:this._mergedOtherSourceCaches[i]}getSourceCaches(t){let i=[];return this._mergedOtherSourceCaches[t]&&i.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&i.push(this._mergedSymbolSourceCaches[t]),i}updateSourceCaches(){let t=this._changes.getUpdatedSourceCaches();for(let i in t){let o=t[i];o==="reload"?this.reloadSource(i):o==="clear"&&this.clearSource(i)}}updateLayers(t){let i=this._changes.getUpdatedPaintProperties();for(let o of i){let c=this.getLayer(o);c&&c.updateTransitions(t)}}getImages(t,i,o){this.imageManager.getImages(i.icons,i.scope,o),this._updateTilesForChangedImages();let c=u=>{u&&u.setDependencies(i.tileID.key,i.type,i.icons)};c(this._otherSourceCaches[i.source]),c(this._symbolSourceCaches[i.source])}getGlyphs(t,i,o){this.glyphManager.getGlyphs(i.stacks,i.scope,o)}getResource(t,i,o){return Zt(i,o)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){let i=[];return this._otherSourceCaches[t]&&i.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&i.push(this._symbolSourceCaches[t]),i}_isSourceCacheLoaded(t){let i=this.getOwnSourceCaches(t);return i.length===0?(this.fire(new Xe(new Error(`There is no source with ID '${t}'`))),!1):i.every(o=>o.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function sF(e,t){let i=!1,o=null,c=()=>{o=null,i&&(e(),o=setTimeout(c,t),i=!1)};return()=>(i=!0,o||c(),o)}nl.getSourceType=function(e){return YC[e]},nl.setSourceType=function(e,t){YC[e]=t},nl.registerForPluginStateChange=function(e){return e({pluginStatus:ws,pluginURL:qc}),K1.on("pluginStateChange",e),e};class qW{constructor(t){this._hashName=t&&encodeURIComponent(t),vo(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=sF(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,m.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),m.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let t=this._map;if(!t)return"";let i=aF(t);if(this._hashName){let o=this._hashName,c=!1,u=m.location.hash.slice(1).split("&").map(h=>{let p=h.split("=")[0];return p===o?(c=!0,`${p}=${i}`):h}).filter(h=>h);return c||u.push(`${o}=${i}`),`#${u.join("&")}`}return`#${i}`}_getCurrentHash(){let t=m.location.hash.replace("#","");if(this._hashName){let i;return t.split("&").map(o=>o.split("=")).forEach(o=>{o[0]===this._hashName&&(i=o)}),(i&&i[1]||"").split("/")}return t.split("/")}_onHashChange(){let t=this._map;if(!t)return!1;let i=this._getCurrentHash();if(i.length>=3&&!i.some(o=>isNaN(o))){let o=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(i[3]||0):t.getBearing();return t.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:o,pitch:+(i[4]||0)}),!0}return!1}_updateHashUnthrottled(){let t=m.location.href.replace(/(#.+)?$/,this.getHashString());m.history.replaceState(m.history.state,null,t)}}function aF(e,t){let i=e.getCenter(),o=Math.round(100*e.getZoom())/100,c=Math.ceil((o*Math.LN2+Math.log(512/360/.5))/Math.LN10),u=Math.pow(10,c),h=Math.round(i.lng*u)/u,p=Math.round(i.lat*u)/u,f=e.getBearing(),g=e.getPitch(),v=t?`/${h}/${p}/${o}`:`${o}/${p}/${h}`;return(f||g)&&(v+="/"+Math.round(10*f)/10),g&&(v+=`/${Math.round(g)}`),v}let rv={linearity:.3,easing:_n(0,0,.3,1)},WW=ge({deceleration:2500,maxSpeed:1400},rv),$W=ge({deceleration:20,maxSpeed:1400},rv),YW=ge({deceleration:1e3,maxSpeed:360},rv),ZW=ge({deceleration:1e3,maxSpeed:90},rv);class XW{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ii.now(),settings:t})}_drainInertiaBuffer(){let t=this._inertiaBuffer,i=ii.now();for(;t.length>0&&i-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let i={zoom:0,bearing:0,pitch:0,pan:new Q(0,0),pinchAround:void 0,around:void 0};for(let{settings:u}of this._inertiaBuffer)i.zoom+=u.zoomDelta||0,i.bearing+=u.bearingDelta||0,i.pitch+=u.pitchDelta||0,u.panDelta&&i.pan._add(u.panDelta),u.around&&(i.around=u.around),u.pinchAround&&(i.pinchAround=u.pinchAround);let o=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(i.pan.mag()){let u=sv(i.pan.mag(),o,ge({},WW,t||{}));c.offset=i.pan.mult(u.amount/i.pan.mag()),c.center=this._map.transform.center,ov(c,u)}if(i.zoom){let u=sv(i.zoom,o,$W);c.zoom=this._map.transform.zoom+u.amount,ov(c,u)}if(i.bearing){let u=sv(i.bearing,o,YW);c.bearing=this._map.transform.bearing+ve(u.amount,-179,179),ov(c,u)}if(i.pitch){let u=sv(i.pitch,o,ZW);c.pitch=this._map.transform.pitch+u.amount,ov(c,u)}if(c.zoom||c.bearing){let u=i.pinchAround===void 0?i.around:i.pinchAround;c.around=u?this._map.unproject(u):this._map.getCenter()}return this.clear(),c.noMoveStart=!0,c}}function ov(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function sv(e,t,i){let{maxSpeed:o,linearity:c,deceleration:u}=i,h=ve(e*c/(t/1e3),-o,o),p=Math.abs(h)/(u*c);return{easing:i.easing,duration:1e3*p,amount:h*(p/2)}}class Xs extends Wt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,o,c={}){let u=sp(i.getCanvasContainer(),o);super(t,ge({point:u,lngLat:i.unproject(u),originalEvent:o},c)),this._defaultPrevented=!1,this.target=i}}class av extends Wt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,o){let c=t==="touchend"?o.changedTouches:o.touches,u=n_(i.getCanvasContainer(),c),h=u.map(f=>i.unproject(f)),p=u.reduce((f,g,v,y)=>f.add(g.div(y.length)),new Q(0,0));super(t,{points:u,point:p,lngLats:h,lngLat:i.unproject(p),originalEvent:o}),this._defaultPrevented=!1}}class KW extends Wt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,o){super(t,{originalEvent:o}),this._defaultPrevented=!1}}class QW{constructor(t,i){this._map=t,this._clickTolerance=i.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new KW(t.type,this._map,t))}mousedown(t,i){return this._mousedownPos=i,this._firePreventable(new Xs(t.type,this._map,t))}mouseup(t){this._map.fire(new Xs(t.type,this._map,t))}preclick(t){let i=ge({},t);i.type="preclick",this._map.fire(new Xs(i.type,this._map,i))}click(t,i){this._mousedownPos&&this._mousedownPos.dist(i)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Xs(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Xs(t.type,this._map,t))}mouseover(t){this._map.fire(new Xs(t.type,this._map,t))}mouseout(t){this._map.fire(new Xs(t.type,this._map,t))}touchstart(t){return this._firePreventable(new av(t.type,this._map,t))}touchmove(t){this._map.fire(new av(t.type,this._map,t))}touchend(t){this._map.fire(new av(t.type,this._map,t))}touchcancel(t){this._map.fire(new av(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class JW{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Xs(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Xs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Xs(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class t${constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=i.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,i){this.isEnabled()&&t.shiftKey&&t.button===0&&(LT(),this._startPos=this._lastPos=i,this._active=!0)}mousemoveWindow(t,i){if(!this._active)return;let o=i,c=this._startPos,u=this._lastPos;if(!c||!u||u.equals(o)||!this._box&&o.dist(c)<this._clickTolerance)return;this._lastPos=o,this._box||(this._box=Rn("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));let h=Math.min(c.x,o.x),p=Math.max(c.x,o.x),f=Math.min(c.y,o.y),g=Math.max(c.y,o.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${h}px,${f}px)`,this._box.style.width=p-h+"px",this._box.style.height=g-f+"px")})}mouseupWindow(t,i){if(!this._active)return;let o=this._startPos,c=i;if(o&&t.button===0){if(this.reset(),Hx(),o.x!==c.x||o.y!==c.y)return this._map.fire(new Wt("boxzoomend",{originalEvent:t})),{cameraAnimation:u=>u.fitScreenCoordinates(o,c,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),zT(),delete this._startPos,delete this._lastPos}_fireEvent(t,i){return this._map.fire(new Wt(t,{originalEvent:i}))}}function cS(e,t){let i={};for(let o=0;o<e.length;o++)i[e[o].identifier]=t[o];return i}class e${constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,i,o){(this.centroid||o.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),o.length===this.numTouches&&(this.centroid=function(c){let u=new Q(0,0);for(let h of c)u._add(h);return u.div(c.length)}(i),this.touches=cS(o,i)))}touchmove(t,i,o){if(this.aborted||!this.centroid)return;let c=cS(o,i);for(let u in this.touches){let h=c[u];(!h||h.dist(this.touches[u])>30)&&(this.aborted=!0)}}touchend(t,i,o){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),o.length===0){let c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class dS{constructor(t){this.singleTap=new e$(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,i,o){this.singleTap.touchstart(t,i,o)}touchmove(t,i,o){this.singleTap.touchmove(t,i,o)}touchend(t,i,o){let c=this.singleTap.touchend(t,i,o);if(c){let u=t.timeStamp-this.lastTime<500,h=!this.lastTap||this.lastTap.dist(c)<30;if(u&&h||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class i${constructor(){this._zoomIn=new dS({numTouches:1,numTaps:2}),this._zoomOut=new dS({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,i,o){this._zoomIn.touchstart(t,i,o),this._zoomOut.touchstart(t,i,o)}touchmove(t,i,o){this._zoomIn.touchmove(t,i,o),this._zoomOut.touchmove(t,i,o)}touchend(t,i,o){let c=this._zoomIn.touchend(t,i,o),u=this._zoomOut.touchend(t,i,o);return c?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:h=>h.easeTo({duration:300,zoom:h.getZoom()+1,around:h.unproject(c)},{originalEvent:t})}):u?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:h=>h.easeTo({duration:300,zoom:h.getZoom()-1,around:h.unproject(u)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let n$={0:1,2:2};class uS{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,i){return!1}_move(t,i){return{}}mousedown(t,i){if(this._lastPoint)return;let o=NT(t);this._correctButton(t,o)&&(this._lastPoint=i,this._eventButton=o)}mousemoveWindow(t,i){let o=this._lastPoint;if(o){if(t.preventDefault(),this._eventButton!=null&&function(c,u){let h=n$[u];return c.buttons===void 0||(c.buttons&h)!==h}(t,this._eventButton))this.reset();else if(this._moved||!(i.dist(o)<this._clickTolerance))return this._moved=!0,this._lastPoint=i,this._move(o,i)}}mouseupWindow(t){this._lastPoint&&NT(t)===this._eventButton&&(this._moved&&Hx(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class r$ extends uS{mousedown(t,i){super.mousedown(t,i),this._lastPoint&&(this._active=!0)}_correctButton(t,i){return i===0&&!t.ctrlKey}_move(t,i){return{around:i,panDelta:i.sub(t)}}}class lF extends uS{_correctButton(t,i){return i===0&&t.ctrlKey||i===2}_move(t,i){let o=.8*(i.x-t.x);if(o)return this._active=!0,{bearingDelta:o}}contextmenu(t){t.preventDefault()}}class cF extends uS{_correctButton(t,i){return i===0&&t.ctrlKey||i===2}_move(t,i){let o=-.5*(i.y-t.y);if(o)return this._active=!0,{pitchDelta:o}}contextmenu(t){t.preventDefault()}}class o${constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),vo(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new Q(0,0)}touchstart(t,i,o){return this._calculateTransform(t,i,o)}touchmove(t,i,o){if(this._active&&!(o.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(o.length===1&&!Ke())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,i,o)}}touchend(t,i,o){this._calculateTransform(t,i,o),this._active&&o.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,i,o){o.length>0&&(this._active=!0);let c=cS(o,i),u=new Q(0,0),h=new Q(0,0),p=0;for(let g in c){let v=c[g],y=this._touches[g];y&&(u._add(v),h._add(v.sub(y)),p++,c[g]=v)}if(this._touches=c,p<this._minTouches||!h.mag())return;let f=h.div(p);return this._sum._add(f),this._sum.mag()<this._clickTolerance?void 0:{around:u.div(p),panDelta:f}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Rn("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class hS{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,i,o){return{}}touchstart(t,i,o){this._firstTwoTouches||o.length<2||(this._firstTwoTouches=[o[0].identifier,o[1].identifier],this._start([i[0],i[1]]))}touchmove(t,i,o){let c=this._firstTwoTouches;if(!c)return;t.preventDefault();let[u,h]=c,p=lv(o,i,u),f=lv(o,i,h);if(!p||!f)return;let g=this._aroundCenter?null:p.add(f).div(2);return this._move([p,f],g,t)}touchend(t,i,o){if(!this._firstTwoTouches)return;let[c,u]=this._firstTwoTouches,h=lv(o,i,c),p=lv(o,i,u);h&&p||(this._active&&Hx(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function lv(e,t,i){for(let o=0;o<e.length;o++)if(e[o].identifier===i)return t[o]}function dF(e,t){return Math.log(e/t)/Math.LN2}class s$ extends hS{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,i){let o=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(dF(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:dF(this._distance,o),pinchAround:i}}}function uF(e,t){return 180*e.angleWith(t)/Math.PI}class a$ extends hS{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,i){let o=this._vector;if(this._vector=t[0].sub(t[1]),o&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:uF(this._vector,o),pinchAround:i}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());let i=25/(Math.PI*this._minDiameter)*360,o=this._startVector;if(!o)return!1;let c=uF(t,o);return Math.abs(c)<i}}function mS(e){return Math.abs(e.y)>Math.abs(e.x)}class l$ extends hS{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,mS(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,i,o){let c=this._lastPoints;if(!c)return;let u=t[0].sub(c[0]),h=t[1].sub(c[1]);return this._map._cooperativeGestures&&!Ke()&&o.touches.length<3||(this._valid=this.gestureBeginsVertically(u,h,o.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(u.y+h.y)/2*-.5})}gestureBeginsVertically(t,i,o){if(this._valid!==void 0)return this._valid;let c=t.mag()>=2,u=i.mag()>=2;if(!c&&!u)return;if(!c||!u)return this._firstMove==null&&(this._firstMove=o),o-this._firstMove<100&&void 0;let h=t.y>0==i.y>0;return mS(t)&&mS(i)&&h}}let c$={panStep:100,bearingStep:15,pitchStep:10};class d${constructor(){let t=c$;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let i=0,o=0,c=0,u=0,h=0;switch(t.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:t.shiftKey?o=-1:(t.preventDefault(),u=-1);break;case 39:t.shiftKey?o=1:(t.preventDefault(),u=1);break;case 38:t.shiftKey?c=1:(t.preventDefault(),h=-1);break;case 40:t.shiftKey?c=-1:(t.preventDefault(),h=1);break;default:return}return this._rotationDisabled&&(o=0,c=0),{cameraAnimation:p=>{let f=p.getZoom();p.easeTo({duration:300,easeId:"keyboardHandler",easing:u$,zoom:i?Math.round(f)+i*(t.shiftKey?2:1):f,bearing:p.getBearing()+o*this._bearingStep,pitch:p.getPitch()+c*this._pitchStep,offset:[-u*this._panStep,-h*this._panStep],center:p.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function u$(e){return e*(2-e)}let hF=4.000244140625;class h${constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._handler=i,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,vo(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||Ke()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let i=t.deltaMode===m.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY,o=ii.now(),c=o-(this._lastWheelEventTime||0);this._lastWheelEventTime=o,i!==0&&i%hF==0?this._type="wheel":i!==0&&Math.abs(i)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(c*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),t.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=t,this._delta-=i,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let i=sp(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:i,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let i=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){let g=this._type==="wheel"&&Math.abs(this._delta)>hF?this._wheelZoomRate:this._defaultZoomRate,v=2/(1+Math.exp(-Math.abs(this._delta*g)));this._delta<0&&v!==0&&(v=1/v);let y=i(),b=Math.pow(2,y),x=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):b;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(x*v))),this._type==="wheel"&&(this._startZoom=y,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let o=typeof this._targetZoom=="number"?this._targetZoom:i(),c=this._startZoom,u=this._easing,h,p=!1;if(this._type==="wheel"&&c&&u){let g=Math.min((ii.now()-this._lastWheelEventTime)/200,1);h=Ye(c,o,u(g)),g<1?this._frameId||(this._frameId=!0):p=!0}else h=o,p=!0;this._active=!0,p&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let f=h-i();return f*this._lastDelta<0&&(f=0),{noInertia:!0,needsRenderFrame:!p,zoomDelta:f,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let i=fr;if(this._prevEase){let o=this._prevEase,c=(ii.now()-o.start)/o.duration,u=o.easing(c+.01)-o.easing(c),h=.27/Math.sqrt(u*u+1e-4)*.01;i=_n(h,Math.sqrt(.0729-h*h),.25,1)}return this._prevEase={start:ii.now(),duration:t,easing:i},i}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Rn("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(m.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class m${constructor(t,i){this._clickZoom=t,this._tapZoom=i}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class p${constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,i){return t.preventDefault(),{cameraAnimation:o=>{o.easeTo({duration:300,zoom:o.getZoom()+(t.shiftKey?-1:1),around:o.unproject(i)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class f${constructor(){this._tap=new dS({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,i,o){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?o.length>0&&(this._swipePoint=i[0],this._swipeTouch=o[0].identifier):this._tap.touchstart(t,i,o))}touchmove(t,i,o){if(this._tapTime){if(this._swipePoint){if(o[0].identifier!==this._swipeTouch)return;let c=i[0],u=c.y-this._swipePoint.y;return this._swipePoint=c,t.preventDefault(),this._active=!0,{zoomDelta:u/128}}}else this._tap.touchmove(t,i,o)}touchend(t,i,o){this._tapTime?this._swipePoint&&o.length===0&&this.reset():this._tap.touchend(t,i,o)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class g${constructor(t,i,o){this._el=t,this._mousePan=i,this._touchPan=o}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class _${constructor(t,i,o){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=i,this._mousePitch=o}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class v${constructor(t,i,o,c){this._el=t,this._touchZoom=i,this._touchRotate=o,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let cv=e=>e.zoom||e.drag||e.pitch||e.rotate;class y$ extends Wt{}class b${constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,i){let o=J.sub([],i,t);this.radius=J.length(o[2]<0?J.div([],o,this.constants):[o[0],o[1],0])}projectRay(t){J.div(t,t,this.constants),J.normalize(t,t),J.mul(t,t,this.constants);let i=J.scale([],t,this.radius);if(i[2]>0){let o=J.scale([],[0,0,1],J.dot(i,[0,0,1])),c=J.scale([],J.normalize([],[i[0],i[1],0]),this.radius),u=J.add([],i,J.scale([],J.sub([],J.add([],c,o),i),2));i[0]=u[0],i[1]=u[1]}return i}}function dv(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class x${constructor(t,i){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new XW(t),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new b$,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(i),vo(["handleEvent","handleWindowEvent"],this);let o=this._el;this._listeners=[[o,"touchstart",{passive:!0}],[o,"touchmove",{passive:!1}],[o,"touchend",void 0],[o,"touchcancel",void 0],[o,"mousedown",void 0],[o,"mousemove",void 0],[o,"mouseup",void 0],[m.document,"mousemove",{capture:!0}],[m.document,"mouseup",void 0],[o,"mouseover",void 0],[o,"mouseout",void 0],[o,"dblclick",void 0],[o,"click",void 0],[o,"keydown",{capture:!1}],[o,"keyup",void 0],[o,"wheel",{passive:!1}],[o,"contextmenu",void 0],[m,"blur",void 0]];for(let[c,u,h]of this._listeners)c.addEventListener(u,c===m.document?this.handleWindowEvent:this.handleEvent,h)}destroy(){for(let[t,i,o]of this._listeners)t.removeEventListener(i,t===m.document?this.handleWindowEvent:this.handleEvent,o)}_addDefaultHandlers(t){let i=this._map,o=i.getCanvasContainer();this._add("mapEvent",new QW(i,t));let c=i.boxZoom=new t$(i,t);this._add("boxZoom",c);let u=new i$,h=new p$;i.doubleClickZoom=new m$(h,u),this._add("tapZoom",u),this._add("clickZoom",h);let p=new f$;this._add("tapDragZoom",p);let f=i.touchPitch=new l$(i);this._add("touchPitch",f);let g=new lF(t),v=new cF(t);i.dragRotate=new _$(t,g,v),this._add("mouseRotate",g,["mousePitch"]),this._add("mousePitch",v,["mouseRotate"]);let y=new r$(t),b=new o$(i,t);i.dragPan=new g$(o,y,b),this._add("mousePan",y),this._add("touchPan",b,["touchZoom","touchRotate"]);let x=new a$,C=new s$;i.touchZoomRotate=new v$(o,C,x,p),this._add("touchRotate",x,["touchPan","touchZoom"]),this._add("touchZoom",C,["touchPan","touchRotate"]),this._add("blockableMapEvent",new JW(i));let E=i.scrollZoom=new h$(i,this);this._add("scrollZoom",E,["mousePan"]);let M=i.keyboard=new d$;this._add("keyboard",M);for(let D of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[D]&&i[D].enable(t[D])}_add(t,i,o){this._handlers.push({handlerName:t,handler:i,allowed:o}),this._handlersById[t]=i}stop(t){if(!this._updatingCamera){for(let{handler:i}of this._handlers)i.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!cv(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,i,o){for(let c in t)if(c!==o&&(!i||i.indexOf(c)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){let i=[];for(let o of t)this._el.contains(o.target)&&i.push(o);return i}handleEvent(t,i){this._updatingCamera=!0;let o=t.type==="renderFrame",c=o?void 0:t,u={needsRenderFrame:!1},h={},p={},f=t.touches?this._getMapTouches(t.touches):void 0,g=f?n_(this._el,f):o?void 0:sp(this._el,t);for(let{handlerName:b,handler:x,allowed:C}of this._handlers){if(!x.isEnabled())continue;let E;this._blockedByActive(p,C,b)?x.reset():x[i||t.type]&&(E=x[i||t.type](t,g,f),this.mergeHandlerResult(u,h,E,b,c),E&&E.needsRenderFrame&&this._triggerRenderFrame()),(E||x.isActive())&&(p[b]=x)}let v={};for(let b in this._previousActiveHandlers)p[b]||(v[b]=c);this._previousActiveHandlers=p,(Object.keys(v).length||dv(u))&&(this._changes.push([u,h,v]),this._triggerRenderFrame()),(Object.keys(p).length||dv(u))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:y}=u;y&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],y(this._map))}mergeHandlerResult(t,i,o,c,u){if(!o)return;ge(t,o);let h={handlerName:c,originalEvent:o.originalEvent||u};o.zoomDelta!==void 0&&(i.zoom=h),o.panDelta!==void 0&&(i.drag=h),o.pitchDelta!==void 0&&(i.pitch=h),o.bearingDelta!==void 0&&(i.rotate=h)}_applyChanges(){let t={},i={},o={};for(let[c,u,h]of this._changes)c.panDelta&&(t.panDelta=(t.panDelta||new Q(0,0))._add(c.panDelta)),c.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+c.pitchDelta),c.around!==void 0&&(t.around=c.around),c.aroundCoord!==void 0&&(t.aroundCoord=c.aroundCoord),c.pinchAround!==void 0&&(t.pinchAround=c.pinchAround),c.noInertia&&(t.noInertia=c.noInertia),ge(i,u),ge(o,h);this._updateMapTransform(t,i,o),this._changes=[]}_updateMapTransform(t,i,o){let c=this._map,u=c.transform,h=A=>[A.x,A.y,A.z];if((A=>{let P=this._eventsInProgress.drag;return P&&!this._handlersById[P.handlerName].isActive()})()&&!dv(t)){let A=u.zoom;u.cameraElevationReference="sea",this._originalZoom!=null&&u._orthographicProjectionAtLowPitch&&u.projection.name!=="globe"&&u.pitch===0?(u.cameraElevationReference="ground",u.zoom=this._originalZoom):(u.recenterOnTerrain(),u.cameraElevationReference="ground"),A!==u.zoom&&this._map._update(!0)}if(u._isCameraConstrained&&c._stop(!0),!dv(t))return void this._fireEvents(i,o,!0);let{panDelta:p,zoomDelta:f,bearingDelta:g,pitchDelta:v,around:y,aroundCoord:b,pinchAround:x}=t;u._isCameraConstrained&&(f>0&&(f=0),u._isCameraConstrained=!1),x!==void 0&&(y=x),(f||(A=>i[A]&&!this._eventsInProgress[A])("drag"))&&y&&(this._dragOrigin=h(u.pointCoordinate3D(y)),this._originalZoom=u.zoom,this._trackingEllipsoid.setup(u._camera.position,this._dragOrigin)),u.cameraElevationReference="sea",c._stop(!0),y=y||c.transform.centerPoint,g&&(u.bearing+=g),v&&(u.pitch+=v),u._updateCameraState();let C=[0,0,0];if(p)if(u.projection.name==="mercator"){let A=this._trackingEllipsoid.projectRay(u.screenPointToMercatorRay(y).dir),P=this._trackingEllipsoid.projectRay(u.screenPointToMercatorRay(y.sub(p)).dir);C[0]=P[0]-A[0],C[1]=P[1]-A[1]}else{let A=u.pointCoordinate(y);if(u.projection.name==="globe"){p=p.rotate(-u.angle);let P=u._pixelsPerMercatorPixel/u.worldSize;C[0]=-p.x*Gw(Wr(A.y))*P,C[1]=-p.y*Gw(u.center.lat)*P}else{let P=u.pointCoordinate(y.sub(p));A&&P&&(C[0]=P.x-A.x,C[1]=P.y-A.y)}}let E=u.zoom,M=[0,0,0];if(f){let A=h(b||u.pointCoordinate3D(y)),P={dir:J.normalize([],J.sub([],A,u._camera.position))};if(P.dir[2]<0){let O=u.zoomDeltaToMovement(A,f);J.scale(M,P.dir,O)}}let D=J.add(C,C,M);u._translateCameraConstrained(D),f&&Math.abs(u.zoom-E)>1e-4&&u.recenterOnTerrain(),u.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(i,o,!0)}_fireEvents(t,i,o){let c=cv(this._eventsInProgress),u=cv(t),h={};for(let v in t){let{originalEvent:y}=t[v];this._eventsInProgress[v]||(h[`${v}start`]=y),this._eventsInProgress[v]=t[v]}!c&&u&&this._fireEvent("movestart",u.originalEvent);for(let v in h)this._fireEvent(v,h[v]);u&&this._fireEvent("move",u.originalEvent);for(let v in t){let{originalEvent:y}=t[v];this._fireEvent(v,y)}let p={},f;for(let v in this._eventsInProgress){let{handlerName:y,originalEvent:b}=this._eventsInProgress[v];this._handlersById[y].isActive()||(delete this._eventsInProgress[v],f=i[y]||b,p[`${v}end`]=f)}for(let v in p)this._fireEvent(v,p[v]);let g=cv(this._eventsInProgress);if(o&&(c||u)&&!g){this._updatingCamera=!0;let v=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),y=b=>b!==0&&-this._bearingSnap<b&&b<this._bearingSnap;v?(y(v.bearing||this._map.getBearing())&&(v.bearing=0),this._map.easeTo(v,{originalEvent:f})):(this._map.fire(new Wt("moveend",{originalEvent:f})),y(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,i){this._map.fire(new Wt(t,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new y$("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let mF="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class w$ extends Hr{constructor(t,i){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=i.bearingSnap,this._respectPrefersReducedMotion=i.respectPrefersReducedMotion!==!1,vo(["_renderFrameCallback"],this)}getCenter(){return new Ze(this.transform.center.lng,this.transform.center.lat)}setCenter(t,i){return this.jumpTo({center:t},i)}panBy(t,i,o){return t=Q.convert(t).mult(-1),this.panTo(this.transform.center,ge({offset:t},i),o)}panTo(t,i,o){return this.easeTo(ge({center:t},i),o)}getZoom(){return this.transform.zoom}setZoom(t,i){return this.jumpTo({zoom:t},i),this}zoomTo(t,i,o){return this.easeTo(ge({zoom:t},i),o)}zoomIn(t,i){return this.zoomTo(this.getZoom()+1,t,i),this}zoomOut(t,i){return this.zoomTo(this.getZoom()-1,t,i),this}getBearing(){return this.transform.bearing}setBearing(t,i){return this.jumpTo({bearing:t},i),this}getPadding(){return this.transform.padding}setPadding(t,i){return this.jumpTo({padding:t},i),this}rotateTo(t,i,o){return this.easeTo(ge({bearing:t},i),o)}resetNorth(t,i){return this.rotateTo(0,ge({duration:1e3},t),i),this}resetNorthPitch(t,i){return this.easeTo(ge({bearing:0,pitch:0,duration:1e3},t),i),this}snapToNorth(t,i){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,i):this}getPitch(){return this.transform.pitch}setPitch(t,i){return this.jumpTo({pitch:t},i),this}cameraForBounds(t,i){t=Es.convert(t);let o=i&&i.bearing||0,c=i&&i.pitch||0,u=t.getNorthWest(),h=t.getSouthEast();return this._cameraForBounds(this.transform,u,h,o,c,i)}_extendCameraOptions(t){let i={top:0,bottom:0,right:0,left:0};if(typeof(t=ge({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=="number"){let o=t.padding;t.padding={top:o,bottom:o,right:o,left:o}}return t.padding=ge(i,t.padding),t}_minimumAABBFrustumDistance(t,i){let o=i.max[0]-i.min[0],c=i.max[1]-i.min[1];return o/c>t.aspect?o/(2*Math.tan(.5*t.fovX)*t.aspect):c/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,i,o,c,u,h){let p=t.clone(),f=this._extendCameraOptions(h);p.bearing=c,p.pitch=u;let g=Ze.convert(i),v=Ze.convert(o),y=.5*(g.lat+v.lat),b=.5*(g.lng+v.lng),x=hs(y,b),C=J.normalize([],x),E=J.normalize([],J.cross([],C,[0,1,0])),M=J.cross([],E,C),D=[E[0],E[1],E[2],0,M[0],M[1],M[2],0,C[0],C[1],C[2],0,0,0,0,1],A=[x,hs(g.lat,g.lng),hs(v.lat,g.lng),hs(v.lat,v.lng),hs(g.lat,v.lng),hs(y,g.lng),hs(y,v.lng),hs(g.lat,b),hs(v.lat,b)],P=Vn.fromPoints(A.map(ot=>[J.dot(E,ot),J.dot(M,ot),J.dot(C,ot)])),O=J.transformMat4([],P.center,D);J.squaredLength(O)===0&&J.set(O,0,0,1),J.normalize(O,O),J.scale(O,O,es),p.center=function([ot,vt,bt]){let yt=Math.hypot(ot,vt,bt),Ct=Math.atan2(ot,bt),Et=.5*Math.PI-Math.acos(-vt/yt);return new Ze(ei(Ct),ei(Et))}(O);let R=p.getWorldToCameraMatrix(),F=ft.invert(new Float64Array(16),R);P=Vn.applyTransform(P,ft.multiply([],R,D)),J.transformMat4(O,O,R);let N=.5*(P.max[2]-P.min[2]),j=this._minimumAABBFrustumDistance(p,P),U=J.scale([],[0,0,1],N),G=J.add(U,O,U),Y=j+(p.pitch===0?0:J.distance(O,G)),Z=p.globeCenterInViewSpace,tt=J.sub([],O,[Z[0],Z[1],Z[2]]);J.normalize(tt,tt),J.scale(tt,tt,Y);let $=J.add([],O,tt);J.transformMat4($,$,F);let rt=bh/es,st=J.length($),pt=yn(Math.max(st*rt-bh,Number.EPSILON),0),nt=Math.min(p.zoomFromMercatorZAdjusted(pt),f.maxZoom);return nt>.5*(Op+Qc)?(p.setProjection({name:"mercator"}),p.zoom=nt,this._cameraForBounds(p,i,o,c,u,h)):{center:p.center,zoom:nt,bearing:c,pitch:u}}queryTerrainElevation(t,i){let o=this.transform.elevation;return o?(i=ge({},{exaggerated:!0},i),o.getAtPoint(Fi.fromLngLat(t),null,i.exaggerated)):null}_cameraForBounds(t,i,o,c,u,h){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,i,o,c,u,h);let p=t.clone(),f=this._extendCameraOptions(h),g=p.padding;p.bearing=c,p.pitch=u;let v=Ze.convert(i),y=Ze.convert(o),b=new Ze(v.lng,y.lat),x=new Ze(y.lng,v.lat),C=p.project(v),E=p.project(y),M=this.queryTerrainElevation(v),D=this.queryTerrainElevation(y),A=this.queryTerrainElevation(b),P=this.queryTerrainElevation(x),O=[[C.x,C.y,Math.min(M||0,D||0,A||0,P||0)],[E.x,E.y,Math.max(M||0,D||0,A||0,P||0)]],R=Vn.fromPoints(O),F=p.getWorldToCameraMatrix(),N=ft.invert(new Float64Array(16),F);R=Vn.applyTransform(R,F);let j=J.sub([],R.max,R.min),U=g.left||0,G=g.right||0,Y=g.bottom||0,Z=g.top||0,{left:tt,right:$,top:rt,bottom:st}=f.padding,pt=.5*(U+G),nt=.5*(Z+Y),ot=Math.min(p.scaleZoom(p.scale*Math.min((p.width-(U+G+tt+$))/j[0],(p.height-(Y+Z+st+rt))/j[1])),f.maxZoom),vt=p.scale/p.zoomScale(ot);R=new Vn([R.min[0]-(tt+pt)*vt,R.min[1]-(st+nt)*vt,R.min[2]],[R.max[0]+($+pt)*vt,R.max[1]+(rt+nt)*vt,R.max[2]]);let bt=.5*j[2],yt=this._minimumAABBFrustumDistance(p,R),Ct=[0,0,1,0];hn.transformMat4(Ct,Ct,F),hn.normalize(Ct,Ct);let Et=J.scale([],Ct,yt+bt),It=J.add([],R.center,Et),xt=(typeof f.offset.x=="number"&&typeof f.offset.y=="number"?new Q(f.offset.x,f.offset.y):Q.convert(f.offset)).rotate(-fe(c));R.center[0]-=xt.x*vt,R.center[1]+=xt.y*vt,J.transformMat4(R.center,R.center,N),J.transformMat4(It,It,N);let Ft=[R.center[0],R.center[1],It[2]*p.pixelsPerMeter];J.scale(Ft,Ft,1/p.worldSize);let te=Ms(Ft[0]),ee=Wr(Ft[1]),de=Math.min(p._zoomFromMercatorZ(Ft[2]),f.maxZoom),me=new Ze(te,ee);return p.mercatorFromTransition&&de<.5*(Op+Qc)?(p.setProjection({name:"globe"}),p.zoom=de,this._cameraForBounds(p,i,o,c,u,h)):{center:me,zoom:de,bearing:c,pitch:u}}fitBounds(t,i,o){let c=this.cameraForBounds(t,i);return this._fitInternal(c,i,o)}fitScreenCoordinates(t,i,o,c,u){let h=Q.convert(t),p=Q.convert(i),f=new Q(Math.min(h.x,p.x),Math.min(h.y,p.y)),g=new Q(Math.max(h.x,p.x),Math.max(h.y,p.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(h,p))return this;let v=this.transform.pointLocation3D(f),y=this.transform.pointLocation3D(g),b=this.transform.pointLocation3D(new Q(f.x,g.y)),x=this.transform.pointLocation3D(new Q(g.x,f.y)),C=[Math.min(v.lng,y.lng,b.lng,x.lng),Math.min(v.lat,y.lat,b.lat,x.lat)],E=[Math.max(v.lng,y.lng,b.lng,x.lng),Math.max(v.lat,y.lat,b.lat,x.lat)],M=c&&c.pitch?c.pitch:this.getPitch(),D=this._cameraForBounds(this.transform,C,E,o,M,c);return this._fitInternal(D,c,u)}_fitInternal(t,i,o){return t?(delete(i=ge(t,i)).padding,i.linear?this.easeTo(i,o):this.flyTo(i,o)):this}jumpTo(t,i){this.stop();let o=t.preloadOnly?this.transform.clone():this.transform,c=!1,u=!1,h=!1;return"zoom"in t&&o.zoom!==+t.zoom&&(c=!0,o.zoom=+t.zoom),t.center!==void 0&&(o.center=Ze.convert(t.center)),"bearing"in t&&o.bearing!==+t.bearing&&(u=!0,o.bearing=+t.bearing),"pitch"in t&&o.pitch!==+t.pitch&&(h=!0,o.pitch=+t.pitch),t.padding==null||o.isPaddingEqual(t.padding)||(o.padding=t.padding),t.preloadOnly?(this._preloadTiles(o),this):(this.fire(new Wt("movestart",i)).fire(new Wt("move",i)),c&&this.fire(new Wt("zoomstart",i)).fire(new Wt("zoom",i)).fire(new Wt("zoomend",i)),u&&this.fire(new Wt("rotatestart",i)).fire(new Wt("rotate",i)).fire(new Wt("rotateend",i)),h&&this.fire(new Wt("pitchstart",i)).fire(new Wt("pitch",i)).fire(new Wt("pitchend",i)),this.fire(new Wt("moveend",i)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||lt(mF),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,i){let o=this.transform;if(!o.projection.supportsFreeCamera)return lt(mF),this;this.stop();let c=o.zoom,u=o.pitch,h=o.bearing;o.setFreeCameraOptions(t);let p=c!==o.zoom,f=u!==o.pitch,g=h!==o.bearing;return this.fire(new Wt("movestart",i)).fire(new Wt("move",i)),p&&this.fire(new Wt("zoomstart",i)).fire(new Wt("zoom",i)).fire(new Wt("zoomend",i)),g&&this.fire(new Wt("rotatestart",i)).fire(new Wt("rotate",i)).fire(new Wt("rotateend",i)),f&&this.fire(new Wt("pitchstart",i)).fire(new Wt("pitch",i)).fire(new Wt("pitchend",i)),this.fire(new Wt("moveend",i)),this}easeTo(t,i){this._stop(!1,t.easeId),((t=ge({offset:[0,0],duration:500,easing:fr},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);let o=this.transform,c=this.getZoom(),u=this.getBearing(),h=this.getPitch(),p=this.getPadding(),f="zoom"in t?+t.zoom:c,g="bearing"in t?this._normalizeBearing(t.bearing,u):u,v="pitch"in t?+t.pitch:h,y="padding"in t?t.padding:o.padding,b=Q.convert(t.offset),x,C,E;if(o.projection.name==="globe"){let U=Fi.fromLngLat(o.center),G=b.rotate(-o.angle);U.x+=G.x/o.worldSize,U.y+=G.y/o.worldSize;let Y=U.toLngLat(),Z=Ze.convert(t.center||Y);this._normalizeCenter(Z),x=o.centerPoint.add(G),C=new Q(U.x,U.y).mult(o.worldSize),E=new Q(eo(Z.lng),uo(Z.lat)).mult(o.worldSize).sub(C)}else{x=o.centerPoint.add(b);let U=o.pointLocation(x),G=Ze.convert(t.center||U);this._normalizeCenter(G),C=o.project(U),E=o.project(G).sub(C)}let M=o.zoomScale(f-c),D,A;t.around&&(D=Ze.convert(t.around),A=o.locationPoint(D));let P=this._zooming||f!==c,O=this._rotating||u!==g,R=this._pitching||v!==h,F=!o.isPaddingEqual(y),N=U=>G=>{if(P&&(U.zoom=Ye(c,f,G)),O&&(U.bearing=Ye(u,g,G)),R&&(U.pitch=Ye(h,v,G)),F&&(U.interpolatePadding(p,y,G),x=U.centerPoint.add(b)),D)U.setLocationAtPoint(D,A);else{let Y=U.zoomScale(U.zoom-c),Z=f>c?Math.min(2,M):Math.max(.5,M),tt=Math.pow(Z,1-G),$=U.unproject(C.add(E.mult(G*tt)).mult(Y));U.setLocationAtPoint(U.renderWorldCopies?$.wrap():$,x)}return t.preloadOnly||this._fireMoveEvents(i),U};if(t.preloadOnly){let U=this._emulate(N,t.duration,o);return this._preloadTiles(U),this}let j={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=P,this._rotating=O,this._pitching=R,this._padding=F,this._easeId=t.easeId,this._prepareEase(i,t.noMoveStart,j),this._ease(N(o),U=>{o.cameraElevationReference==="sea"&&o.recenterOnTerrain(),this._afterEase(i,U)},t),this}_prepareEase(t,i,o={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),i||o.moving||this.fire(new Wt("movestart",t)),this._zooming&&!o.zooming&&this.fire(new Wt("zoomstart",t)),this._rotating&&!o.rotating&&this.fire(new Wt("rotatestart",t)),this._pitching&&!o.pitching&&this.fire(new Wt("pitchstart",t))}_fireMoveEvents(t){this.fire(new Wt("move",t)),this._zooming&&this.fire(new Wt("zoom",t)),this._rotating&&this.fire(new Wt("rotate",t)),this._pitching&&this.fire(new Wt("pitch",t))}_afterEase(t,i){if(this._easeId&&i&&this._easeId===i)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let o=this._zooming,c=this._rotating,u=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,o&&this.fire(new Wt("zoomend",t)),c&&this.fire(new Wt("rotateend",t)),u&&this.fire(new Wt("pitchend",t)),this.fire(new Wt("moveend",t))}flyTo(t,i){if(this._prefersReducedMotion(t)){let ot=Go(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ot,i)}this.stop(),t=ge({offset:[0,0],speed:1.2,curve:1.42,easing:fr},t);let o=this.transform,c=this.getZoom(),u=this.getBearing(),h=this.getPitch(),p=this.getPadding(),f="zoom"in t?ve(+t.zoom,o.minZoom,o.maxZoom):c,g="bearing"in t?this._normalizeBearing(t.bearing,u):u,v="pitch"in t?+t.pitch:h,y="padding"in t?t.padding:o.padding,b=o.zoomScale(f-c),x=Q.convert(t.offset),C=o.centerPoint.add(x),E=o.pointLocation(C),M=Ze.convert(t.center||E);this._normalizeCenter(M);let D=o.project(E),A=o.project(M).sub(D),P=t.curve,O=Math.max(o.width,o.height),R=O/b,F=A.mag();if("minZoom"in t){let ot=ve(Math.min(t.minZoom,c,f),o.minZoom,o.maxZoom),vt=O/o.zoomScale(ot-c);P=Math.sqrt(vt/F*2)}let N=P*P;function j(ot){let vt=(R*R-O*O+(ot?-1:1)*N*N*F*F)/(2*(ot?R:O)*N*F);return Math.log(Math.sqrt(vt*vt+1)-vt)}function U(ot){return(Math.exp(ot)-Math.exp(-ot))/2}function G(ot){return(Math.exp(ot)+Math.exp(-ot))/2}let Y=j(0),Z=function(ot){return G(Y)/G(Y+P*ot)},tt=function(ot){return O*((G(Y)*(U(vt=Y+P*ot)/G(vt))-U(Y))/N)/F;var vt},$=(j(1)-Y)/P;if(Math.abs(F)<1e-6||!isFinite($)){if(Math.abs(O-R)<1e-6)return this.easeTo(t,i);let ot=R<O?-1:1;$=Math.abs(Math.log(R/O))/P,tt=function(){return 0},Z=function(vt){return Math.exp(ot*P*vt)}}t.duration="duration"in t?+t.duration:1e3*$/("screenSpeed"in t?+t.screenSpeed/P:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);let rt=u!==g,st=v!==h,pt=!o.isPaddingEqual(y),nt=ot=>vt=>{let bt=vt*$,yt=1/Z(bt);ot.zoom=vt===1?f:c+ot.scaleZoom(yt),rt&&(ot.bearing=Ye(u,g,vt)),st&&(ot.pitch=Ye(h,v,vt)),pt&&(ot.interpolatePadding(p,y,vt),C=ot.centerPoint.add(x));let Ct=vt===1?M:ot.unproject(D.add(A.mult(tt(bt))).mult(yt));return ot.setLocationAtPoint(ot.renderWorldCopies?Ct.wrap():Ct,C),ot._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(i),ot};if(t.preloadOnly){let ot=this._emulate(nt,t.duration,o);return this._preloadTiles(ot),this}return this._zooming=!0,this._rotating=rt,this._pitching=st,this._padding=pt,this._prepareEase(i,!1),this._ease(nt(o),()=>this._afterEase(i),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,i){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let o=this._onEaseEnd;this._onEaseEnd=void 0,o.call(this,i)}if(!t){let o=this.handlers;o&&o.stop(!1)}return this}_ease(t,i,o){o.animate===!1||o.duration===0?(t(1),i()):(this._easeStart=ii.now(),this._easeOptions=o,this._onEaseFrame=t,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let t=Math.min((ii.now()-this._easeStart)/this._easeOptions.duration,1),i=this._onEaseFrame;i&&i(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,i){t=ss(t,-180,180);let o=Math.abs(t-i);return Math.abs(t-360-i)<o&&(t-=360),Math.abs(t+360-i)<o&&(t+=360),t}_normalizeCenter(t){let i=this.transform;if(i.maxBounds||i.projection.name!=="globe"&&!i.renderWorldCopies)return;let o=t.lng-i.center.lng;t.lng+=o>180?-360:o<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&ii.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,i,o){let c=Math.ceil(15*i/1e3),u=[],h=t(o.clone());for(let p=0;p<=c;p++){let f=h(p/c);u.push(f.clone())}return u}}class pF{constructor(t={}){this.options=t,vo(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){let i=this.options&&this.options.compact;return this._map=t,this._container=Rn("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Rn("button","mapboxgl-ctrl-attrib-button",this._container),Rn("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Rn("div","mapboxgl-ctrl-attrib-inner",this._container),i&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),i===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,i){let o=this._map._getUIString(`AttributionControl.${i}`);t.removeAttribute("title"),t.firstElementChild&&t.firstElementChild.setAttribute("title",o)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));let i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||S.ACCESS_TOKEN}];if(t){let o=i.reduce((c,u,h)=>(u.value&&(c+=`${u.key}=${u.value}${h<i.length-1?"&":""}`),c),"?");t.href=`${S.FEEDBACK_URL}/${o}#${aF(this._map,!0)}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){let c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}let i=this._map.style._mergedSourceCaches;for(let c in i){let u=i[c];if(u.used){let h=u.getSource();h.attribution&&t.indexOf(h.attribution)<0&&t.push(h.attribution)}}t.sort((c,u)=>c.length-u.length),t=t.filter((c,u)=>{for(let h=u+1;h<t.length;h++)if(t[h].indexOf(c)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));let o=t.join(" | ");o!==this._attribHTML&&(this._attribHTML=o,t.length?(this._innerContainer.innerHTML=o,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class fF{constructor(){vo(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=Rn("div","mapboxgl-ctrl");let i=Rn("a","mapboxgl-ctrl-logo");return i.target="_blank",i.rel="noopener nofollow",i.href="https://www.mapbox.com/",i.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),i.setAttribute("rel","noopener nofollow"),this._container.appendChild(i),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(let i in t){let o=t[i].getSource();if(o.hasOwnProperty("mapbox_logo")&&!o.mapbox_logo)return!1}return!0}_updateCompact(){let t=this._container.children;if(t.length){let i=t[0];this._map.getCanvasContainer().offsetWidth<250?i.classList.add("mapboxgl-compact"):i.classList.remove("mapboxgl-compact")}}}class gF{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){let i=++this._id;return this._queue.push({callback:t,id:i,cancelled:!1}),i}remove(t){let i=this._currentlyRunning,o=i?this._queue.concat(i):this._queue;for(let c of o)if(c.id===t)return void(c.cancelled=!0)}run(t=0){let i=this._currentlyRunning=this._queue;this._queue=[];for(let o of i)if(!o.cancelled&&(o.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function _F(e,t,i){if(e=new Ze(e.lng,e.lat),t){let o=new Ze(e.lng-360,e.lat),c=new Ze(e.lng+360,e.lat),u=360*Math.ceil(Math.abs(e.lng-i.center.lng)/360),h=i.locationPoint(e).distSqr(t),p=t.x<0||t.y<0||t.x>i.width||t.y>i.height;i.locationPoint(o).distSqr(t)<h&&(p||Math.abs(o.lng-i.center.lng)<u)?e=o:i.locationPoint(c).distSqr(t)<h&&(p||Math.abs(c.lng-i.center.lng)<u)&&(e=c)}for(;Math.abs(e.lng-i.center.lng)>180;){let o=i.locationPoint(e);if(o.x>=0&&o.y>=0&&o.x<=i.width&&o.y<=i.height)break;e.lng>i.center.lng?e.lng-=360:e.lng+=360}return e}let pS={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class fS extends Hr{constructor(t,i){if(super(),(t instanceof m.HTMLElement||i)&&(t=ge({element:t},i)),vo(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=Q.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=Rn("div");let u=41,h=27,p=ec("svg",{display:"block",height:u*this._scale+"px",width:h*this._scale+"px",viewBox:`0 0 ${h} ${u}`},this._element),f=ec("radialGradient",{id:"shadowGradient"},ec("defs",{},p));ec("stop",{offset:"10%","stop-opacity":.4},f),ec("stop",{offset:"100%","stop-opacity":.05},f),ec("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},p),ec("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},p),ec("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},p),ec("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},p),this._offset=Q.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",u=>{u.preventDefault()}),this._element.addEventListener("mousedown",u=>{u.preventDefault()});let o=this._element.classList;for(let u in pS)o.remove(`mapboxgl-marker-anchor-${u}`);o.add(`mapboxgl-marker-anchor-${this._anchor}`);let c=t&&t.className?t.className.trim().split(/\s+/):[];o.add(...c),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){let t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=Ze.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){let c=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){let i=t.code,o=t.charCode||t.keyCode;i!=="Space"&&i!=="Enter"&&o!==32&&o!==13||this.togglePopup()}_onMapClick(t){let i=t.originalEvent.target,o=this._element;this._popup&&(i===o||o.contains(i))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let t=this._map,i=this._pos;if(!t||!i)return!1;let o=t.unproject(i),c=t.getFreeCameraOptions();if(!c.position)return!1;let u=c.position.toLngLat();return u.distanceTo(o)<.9*u.distanceTo(this._lngLat)}_evaluateOpacity(){let t=this._map;if(!t)return;let i=this._pos;if(!i||i.x<0||i.x>t.transform.width||i.y<0||i.y>t.transform.height)return void this._clearFadeTimer();let o=t.unproject(i),c;t._showingGlobe()&&$_(t.transform,this._lngLat)?c=0:(c=1-t._queryFogOpacity(o),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(c*=this._occludedOpacity)),this._element.style.opacity=`${c}`,this._element.style.pointerEvents=c>0?"auto":"none",this._popup&&this._popup._setOpacity(c),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let t=this._pos;if(!t||!this._map)return;let i=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${pS[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${i.x}px,${i.y}px)
        `}_calculateXYTransform(){let t=this._pos,i=this._map,o=this.getPitchAlignment();if(!i||!t||o!=="map")return"";if(!i._showingGlobe()){let f=i.getPitch();return f?`rotateX(${f}deg)`:""}let c=ei(nk(i.transform,this._lngLat)),u=t.sub(ik(i.transform)),h=Math.abs(u.x)+Math.abs(u.y);if(h===0)return"";let p=c/h;return`rotateX(${-u.y*p}deg) rotateY(${u.x*p}deg)`}_calculateZTransform(){let t=this._pos,i=this._map;if(!i||!t)return"";let o=0,c=this.getRotationAlignment();if(c==="map")if(i._showingGlobe()){let u=i.project(new Ze(this._lngLat.lng,this._lngLat.lat+.001)),h=i.project(new Ze(this._lngLat.lng,this._lngLat.lat-.001)).sub(u);o=ei(Math.atan2(h.y,h.x))-90}else o=-i.getBearing();else if(c==="horizon"){let u=Wo(4,6,i.getZoom()),h=ik(i.transform);h.y+=u*i.transform.height;let p=t.sub(h),f=ei(Math.atan2(p.y,p.x));o=(f>90?f-270:f+90)*(1-u)}return o+=this._rotation,o?`rotateZ(${o}deg)`:""}_update(t){m.cancelAnimationFrame(this._updateFrameId);let i=this._map;i&&(i.transform.renderWorldCopies&&(this._lngLat=_F(this._lngLat,this._pos,i.transform)),this._pos=i.project(this._lngLat),t===!0?this._updateFrameId=m.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),i._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(i._showingGlobe()||i.getTerrain()||i.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=Q.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){let i=this._map;if(!i)return;let o=this._pointerdownPos,c=this._positionDelta;if(o&&c){if(!this._isDragging){let u=this._clickTolerance||i._clickTolerance;if(t.point.dist(o)<u)return;this._isDragging=!0}this._pos=t.point.sub(c),this._lngLat=i.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new Wt("dragstart"))),this.fire(new Wt("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new Wt("dragend")),this._state="inactive"}_addDragHandler(t){let i=this._map,o=this._pos;i&&o&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(o),this._pointerdownPos=t.point,this._state="pending",i.on("mousemove",this._onMove),i.on("touchmove",this._onMove),i.once("mouseup",this._onUp),i.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;let i=this._map;return i&&(t?(i.on("mousedown",this._addDragHandler),i.on("touchstart",this._addDragHandler)):(i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let C$={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},S$=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function vF(e=new Q(0,0),t="bottom"){if(typeof e=="number"){let i=Math.round(Math.sqrt(.5*Math.pow(e,2)));switch(t){case"top":return new Q(0,e);case"top-left":return new Q(i,i);case"top-right":return new Q(-i,i);case"bottom":return new Q(0,-e);case"bottom-left":return new Q(i,-i);case"bottom-right":return new Q(-i,-i);case"left":return new Q(e,0);case"right":return new Q(-e,0)}return new Q(0,0)}return e instanceof Q||Array.isArray(e)?Q.convert(e):Q.convert(e[t]||[0,0])}class E${constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;let i=Dr((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-i)+this._end*i}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,i,o){this._start=this.getValue(i),this._end=t,this._startTime=i,this._endTime=i+o}}let M$={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},D$={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},T$={showCompass:!0,showZoom:!0,visualizePitch:!1};class I${constructor(t,i,o=!1){this._clickTolerance=10,this.element=i,this.mouseRotate=new lF({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,o&&(this.mousePitch=new cF({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),vo(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener("mousedown",this.mousedown),i.addEventListener("touchstart",this.touchstart,{passive:!1}),i.addEventListener("touchmove",this.touchmove),i.addEventListener("touchend",this.touchend),i.addEventListener("touchcancel",this.reset)}down(t,i){this.mouseRotate.mousedown(t,i),this.mousePitch&&this.mousePitch.mousedown(t,i),LT()}move(t,i){let o=this.map,c=this.mouseRotate.mousemoveWindow(t,i),u=c&&c.bearingDelta;if(u&&o.setBearing(o.getBearing()+u),this.mousePitch){let h=this.mousePitch.mousemoveWindow(t,i),p=h&&h.pitchDelta;p&&o.setPitch(o.getPitch()+p)}}off(){let t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){zT(),m.removeEventListener("mousemove",this.mousemove),m.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(ge({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),sp(this.element,t)),m.addEventListener("mousemove",this.mousemove),m.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,sp(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=n_(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=n_(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let A$={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},k$={maxWidth:100,unit:"metric"},R$={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},uv={version:_,supported:PT,setRTLTextPlugin:function(e,t,i=!1){if(ws===W1||ws===$1||ws===Y1)throw new Error("setRTLTextPlugin cannot be called multiple times.");qc=ii.resolveURL(e),ws=W1,Z1=t,X1(),i||o2()},getRTLTextPluginStatus:Q1,Map:class extends w${constructor(e){kT.mark(t_.create);let t=e;if((e=ge({},D$,e)).minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(e.antialias&&function(i){let o=i.navigator?i.navigator.userAgent:null;return!!function(c){if($e==null){let u=c.navigator?c.navigator.userAgent:null;$e=!!c.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return $e}(i)&&o&&(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))}(m)&&(e.antialias=!1,lt("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new IC(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),e),this._interactive=e.interactive,this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=e.crossSourceCollisions,this._collectResourceTiming=e.collectResourceTiming,this._language=this._parseLanguage(e.language),this._worldview=e.worldview,this._renderTaskQueue=new gF,this._domRenderTaskQueue=new gF,this._controls=[],this._markers=[],this._popups=[],this._mapId=Wu(),this._locale=ge({},M$,e.locale),this._clickTolerance=e.clickTolerance,this._cooperativeGestures=e.cooperativeGestures,this._performanceMetricsCollection=e.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new E$(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new Oe(e.transformRequest,e.accessToken,e.testMode),this._silenceAuthErrors=!!e.testMode,this._contextCreateOptions=e.contextCreateOptions?qt({},e.contextCreateOptions):{},typeof e.container=="string"){if(this._container=m.document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container.toString()}' not found.`)}else{if(!(e.container instanceof m.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(this._container.childNodes.length>0&&lt("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),e.maxBounds&&this.setMaxBounds(e.maxBounds),vo(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),m!==void 0&&(this._fullscreenchangeEvent="onfullscreenchange"in m.document?"fullscreenchange":"webkitfullscreenchange",m.addEventListener("online",this._onWindowOnline,!1),m.addEventListener("resize",this._onWindowResize,!1),m.addEventListener("orientationchange",this._onWindowResize,!1),m.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),m.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new x$(this,e),this._localFontFamily=e.localFontFamily,this._localIdeographFontFamily=e.localIdeographFontFamily,(e.style||!e.testMode)&&this.setStyle(e.style||S.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),e.projection&&this.setProjection(e.projection),e.hash&&(this._hash=new qW(typeof e.hash=="string"&&e.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch});let i=e.bounds;i&&(this.resize(),this.fitBounds(i,ge({},e.fitBoundsOptions,{duration:0})))}this.resize(),e.attributionControl&&this.addControl(new pF({customAttribution:e.customAttribution})),this._logoControl=new fF,this.addControl(this._logoControl,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update(i.dataType==="style"),this.fire(new Wt(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new Wt(`${i.dataType}dataloading`,i))})}_getMapId(){return this._mapId}addControl(e,t){if(t===void 0&&(t=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new Xe(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let i=e.onAdd(this);this._controls.push(e);let o=this._controlPositions[t];return t.indexOf("bottom")!==-1?o.insertBefore(i,o.firstChild):o.appendChild(i),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new Xe(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let t=this._controls.indexOf(e);return t>-1&&this._controls.splice(t,1),e.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(e){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let t=!this._moving;return t&&this.fire(new Wt("movestart",e)).fire(new Wt("move",e)),this.fire(new Wt("resize",e)),t&&this.fire(new Wt("moveend",e)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(e){return this.transform.setMaxBounds(Es.convert(e)),this._update()}setMinZoom(e){if((e=e??-2)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e?this.setZoom(e):this.fire(new Wt("zoomstart")).fire(new Wt("zoom")).fire(new Wt("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=e??22)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e?this.setZoom(e):this.fire(new Wt("zoomstart")).fire(new Wt("zoom")).fire(new Wt("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=e??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e?this.setPitch(e):this.fire(new Wt("pitchstart")).fire(new Wt("pitch")).fire(new Wt("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=e??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e?this.setPitch(e):this.fire(new Wt("pitchstart")).fire(new Wt("pitch")).fire(new Wt("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(e){return e==="auto"?m.navigator.language:Array.isArray(e)?e.length===0?void 0:e.map(t=>t==="auto"?m.navigator.language:t):e}setLanguage(e){let t=this._parseLanguage(e);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(let i of this._controls)i._setLanguage&&i._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview?(this._worldview=e,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(e){return this._lazyInitEmptyStyle(),e?typeof e=="string"&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let e=this.transform,t=e.projection.name,i;t==="globe"&&e.zoom>=Qc?(e.setMercatorFromTransition(),i=!0):t==="mercator"&&e.zoom<Qc&&(e.setProjection({name:"globe"}),i=!0),i&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(e,t){return this._updateProjection(e||t||{name:"mercator"})}_updateProjection(e){let t;return t=e.name==="globe"&&this.transform.zoom>=Qc?this.transform.setMercatorFromTransition():this.transform.setProjection(e),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(e){return this.transform.locationPoint3D(Ze.convert(e))}unproject(e){return this.transform.pointLocation3D(Q.convert(e))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(e,t,i){if(e==="mouseenter"||e==="mouseover"){let o=!1,c=h=>{let p=t.filter(g=>this.getLayer(g)),f=p.length?this.queryRenderedFeatures(h.point,{layers:p}):[];f.length?o||(o=!0,i.call(this,new Xs(e,this,h.originalEvent,{features:f}))):o=!1},u=()=>{o=!1};return{layers:new Set(t),listener:i,delegates:{mousemove:c,mouseout:u}}}if(e==="mouseleave"||e==="mouseout"){let o=!1,c=h=>{let p=t.filter(f=>this.getLayer(f));(p.length?this.queryRenderedFeatures(h.point,{layers:p}):[]).length?o=!0:o&&(o=!1,i.call(this,new Xs(e,this,h.originalEvent)))},u=h=>{o&&(o=!1,i.call(this,new Xs(e,this,h.originalEvent)))};return{layers:new Set(t),listener:i,delegates:{mousemove:c,mouseout:u}}}{let o=c=>{let u=t.filter(p=>this.getLayer(p)),h=u.length?this.queryRenderedFeatures(c.point,{layers:u}):[];h.length&&(c.features=h,i.call(this,c),delete c.features)};return{layers:new Set(t),listener:i,delegates:{[e]:o}}}}on(e,t,i){if(i===void 0)return super.on(e,t);if(Array.isArray(t)||(t=[t]),t){for(let c of t)if(!this._isValidId(c))return this}let o=this._createDelegatedListener(e,t,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(o);for(let c in o.delegates)this.on(c,o.delegates[c]);return this}once(e,t,i){if(i===void 0)return super.once(e,t);if(Array.isArray(t)||(t=[t]),t){for(let c of t)if(!this._isValidId(c))return this}let o=this._createDelegatedListener(e,t,i);for(let c in o.delegates)this.once(c,o.delegates[c]);return this}off(e,t,i){if(i===void 0)return super.off(e,t);t=new Set(Array.isArray(t)?t:[t]);for(let u of t)if(!this._isValidId(u))return this;let o=(u,h)=>{if(u.size!==h.size)return!1;for(let p of u)if(!h.has(p))return!1;return!0},c=this._delegatedListeners?this._delegatedListeners[e]:void 0;return c&&(u=>{for(let h=0;h<u.length;h++){let p=u[h];if(p.listener===i&&o(p.layers,t)){for(let f in p.delegates)this.off(f,p.delegates[f]);return u.splice(h,1),this}}})(c),this}queryRenderedFeatures(e,t){if(!this.style)return[];if(t!==void 0||e===void 0||e instanceof Q||Array.isArray(e)||(t=e,e=void 0),e=e||[[0,0],[this.transform.width,this.transform.height]],(t=t||{}).layers&&Array.isArray(t.layers)){for(let i of t.layers)if(!this._isValidId(i))return[]}return this.style.queryRenderedFeatures(e,t,this.transform)}querySourceFeatures(e,t){return this._isValidId(e)?this.style.querySourceFeatures(e,t):[]}isPointOnSurface(e){let{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&lt(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(Q.convert(e))}setStyle(e,t){return(t=ge({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&e?(this._diffStyle(e,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(e,t))}_getUIString(e){let t=this._locale[e];if(t==null)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),e&&(this.style=new nl(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof e=="string"?this.style.loadURL(e):this.style.loadJSON(e)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new nl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,t){if(typeof e=="string"){let i=this._requestManager.normalizeStyleURL(e),o=this._requestManager.transformRequest(i,Dt.Style);Xt(o,(c,u)=>{c?this.fire(new Xe(c)):u&&this._updateDiff(u,t)})}else typeof e=="object"&&this._updateDiff(e,t)}_updateDiff(e,t){try{this.style.setState(e)&&this._update(!0)}catch(i){lt(`Unable to perform style diff: ${i.message||i.error||i}.  Rebuilding the style from scratch.`),this._updateStyle(e,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(lt("There is no style added to the map."),!1)}_isValidId(e){return e==null?(this.fire(new Xe(new Error("IDs can't be empty."))),!1):!l2(e)||(this.fire(new Xe(new Error(`IDs can't contain special symbols: "${e}".`))),!1)}addSource(e,t){return this._isValidId(e)?(this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)):this}isSourceLoaded(e){return!!this._isValidId(e)&&!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){let e=this.style&&this.style._sourceCaches;for(let t in e){let i=e[t]._tiles;for(let o in i){let c=i[o];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}addSourceType(e,t,i){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,i)}removeSource(e){return this._isValidId(e)?(this.style.removeSource(e),this._updateTerrain(),this._update(!0)):this}getSource(e){return this._isValidId(e)?this.style.getOwnSource(e):null}addImage(e,t,{pixelRatio:i=1,sdf:o=!1,stretchX:c,stretchY:u,content:h}={}){if(this._lazyInitEmptyStyle(),t instanceof m.HTMLImageElement||m.ImageBitmap&&t instanceof m.ImageBitmap){let{width:p,height:f,data:g}=ii.getImageData(t);this.style.addImage(e,{data:new Br({width:p,height:f},g),pixelRatio:i,stretchX:c,stretchY:u,content:h,sdf:o,version:0})}else if(t.width===void 0||t.height===void 0)this.fire(new Xe(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:p,height:f}=t,g=t;this.style.addImage(e,{data:new Br({width:p,height:f},new Uint8Array(g.data)),pixelRatio:i,stretchX:c,stretchY:u,content:h,sdf:o,version:0,userImage:g}),g.onAdd&&g.onAdd(this,e)}}updateImage(e,t){this._lazyInitEmptyStyle();let i=this.style.getImage(e);if(!i)return void this.fire(new Xe(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let o=t instanceof m.HTMLImageElement||m.ImageBitmap&&t instanceof m.ImageBitmap?ii.getImageData(t):t,{width:c,height:u}=o;c!==void 0&&u!==void 0?c===i.data.width&&u===i.data.height?(i.data.replace(o.data,!(t instanceof m.HTMLImageElement||m.ImageBitmap&&t instanceof m.ImageBitmap)),this.style.updateImage(e,i)):this.fire(new Xe(new Error(`The width and height of the updated image (${c}, ${u})
                must be that same as the previous version of the image
                (${i.data.width}, ${i.data.height})`))):this.fire(new Xe(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(e){return e?!!this.style&&!!this.style.getImage(e):(this.fire(new Xe(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(e,t){fi(this._requestManager.transformRequest(e,Dt.Image),(i,o)=>{t(i,o instanceof m.HTMLImageElement?ii.getImageData(o):o)})}listImages(){return this.style.listImages()}addModel(e,t){this._lazyInitEmptyStyle(),this.style.addModel(e,t)}hasModel(e){return e?this.style.hasModel(e):(this.fire(new Xe(new Error("Missing required model id"))),!1)}removeModel(e){this.style.removeModel(e)}listModels(){return this.style.listModels()}addLayer(e,t){return this._isValidId(e.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)):this}moveLayer(e,t){return this._isValidId(e)?(this.style.moveLayer(e,t),this._update(!0)):this}removeLayer(e){return this._isValidId(e)?(this.style.removeLayer(e),this._update(!0)):this}getLayer(e){return this._isValidId(e)?this.style.getOwnLayer(e):null}setLayerZoomRange(e,t,i){return this._isValidId(e)?(this.style.setLayerZoomRange(e,t,i),this._update(!0)):this}setFilter(e,t,i={}){return this._isValidId(e)?(this.style.setFilter(e,t,i),this._update(!0)):this}getFilter(e){return this._isValidId(e)?this.style.getFilter(e):null}setPaintProperty(e,t,i,o={}){return this._isValidId(e)?(this.style.setPaintProperty(e,t,i,o),this._update(!0)):this}getPaintProperty(e,t){return this._isValidId(e)?this.style.getPaintProperty(e,t):null}setLayoutProperty(e,t,i,o={}){return this._isValidId(e)?(this.style.setLayoutProperty(e,t,i,o),this._update(!0)):this}getLayoutProperty(e,t){return this._isValidId(e)?this.style.getLayoutProperty(e,t):null}getConfigProperty(e,t){return this.style.getConfigProperty(e,t)}setConfigProperty(e,t,i){return this.style.setConfigProperty(e,t,i),this._update(!0)}setLights(e){if(this._lazyInitEmptyStyle(),e&&e.length===1&&e[0].type==="flat"){let t=e[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(e),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let e=this.style.getLights()||[];return e.length===0&&e.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),e}setLight(e,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:e}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(e){return this.style.setCamera(e),this._triggerCameraUpdate(e)}_triggerCameraUpdate(e){return this._update(this.transform.setOrthographicProjectionAtLowPitch(e["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(e){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(Ze.convert(e),this.transform):0}setFeatureState(e,t){return this._isValidId(e.source)?(this.style.setFeatureState(e,t),this._update()):this}removeFeatureState(e,t){return this._isValidId(e.source)?(this.style.removeFeatureState(e,t),this._update()):this}getFeatureState(e){return this._isValidId(e.source)?this.style.getFeatureState(e):null}_updateContainerDimensions(){if(!this._container)return;let e=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300,i,o,c,u=this._container;for(;u&&(!o||!c);){let h=m.getComputedStyle(u).transform;h&&h!=="none"&&(i=h.match(/matrix.*\((.+)\)/)[1].split(", "),i[0]&&i[0]!=="0"&&i[0]!=="1"&&(o=i[0]),i[3]&&i[3]!=="0"&&i[3]!=="1"&&(c=i[3])),u=u.parentElement}this._containerWidth=o?Math.abs(e/o):e,this._containerHeight=c?Math.abs(t/c):t}_detectMissingCSS(){m.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&lt("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=Rn("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();let t=this._canvasContainer=Rn("div","mapboxgl-canvas-container",e);this._canvas=Rn("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let i=this._controlContainer=Rn("div","mapboxgl-control-container",e),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(c=>{o[c]=Rn("div",`mapboxgl-ctrl-${c}`,i)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,t){let i=ii.devicePixelRatio||1;this._canvas.width=i*Math.ceil(e),this._canvas.height=i*Math.ceil(t),this._canvas.style.width=`${e}px`,this._canvas.style.height=`${t}px`}_addMarker(e){this._markers.push(e)}_removeMarker(e){let t=this._markers.indexOf(e);t!==-1&&this._markers.splice(t,1)}_addPopup(e){this._popups.push(e)}_removePopup(e){let t=this._popups.indexOf(e);t!==-1&&this._popups.splice(t,1)}_setupPainter(){let e=ge({},PT.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",e);t?(AT(t,!0),this.painter=new LW(t,this._contextCreateOptions,this.transform),this.on("data",i=>{i.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),I.testSupport(t)):this.fire(new Xe(new Error("Failed to initialize WebGL")))}_contextLost(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new Wt("webglcontextlost",{originalEvent:e}))}_contextRestored(e){this._setupPainter(),this.resize(),this._update(),this.fire(new Wt("webglcontextrestored",{originalEvent:e}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(e){let t;this.fire(new Wt("renderstart"));let i=this.painter.context.extTimerQuery,o=ii.now(),c=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=c.createQuery(),c.beginQuery(i.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],m.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],m.performance.now())),this._renderTaskQueue.run(e),this._domRenderTaskQueue.run(e),this._removed)return;this._updateProjectionTransition();let u=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let f=this.transform.zoom,g=this.transform.pitch,v=ii.now(),y=new ir(f,{now:v,fadeDuration:u,pitch:g,transition:this.style.transition});this.style.update(y)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let h=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),h=this._updateAverageElevation(o),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):h=this._updateAverageElevation(o),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,u,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:u,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new Wt("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new Wt("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){let f=ii.now()-o;c.endQuery(i.TIME_ELAPSED_EXT),setTimeout(()=>{let g=c.getQueryParameter(t,c.QUERY_RESULT)/1e6;c.deleteQuery(t),this.fire(new Wt("gpu-timing-frame",{cpuTime:f,gpuTime:g})),m.performance.mark("frame-gpu",{startTime:o,detail:{gpuTime:g}})},50)}if(this.listens("gpu-timing-layer")){let f=this.painter.collectGpuTimers();setTimeout(()=>{let g=this.painter.queryGpuTimers(f);this.fire(new Wt("gpu-timing-layer",{layerTimes:g}))},50)}if(this.listens("gpu-timing-deferred-render")){let f=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let g=this.painter.queryGpuTimeDeferredRender(f);this.fire(new Wt("gpu-timing-deferred-render",{gpuTime:g}))},50)}let p=this._sourcesDirty||this._styleDirty||this._placementDirty||h;if(p||this._repaint)this.triggerRepaint();else{let f=!this.isMoving()&&this.loaded();if(f&&(h=this._updateAverageElevation(o,!0)),h)this.triggerRepaint();else if(this._triggerFrame(!1),f&&(this.fire(new Wt("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let g=this._calculateSpeedIndex();this.fire(new Wt("speedindexcompleted",{speedIndex:g})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,kT.mark(t_.fullLoad),this._performanceMetricsCollection&&_j(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(e){for(let t of this._markers)e&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(let t of this._popups)!e||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(e,t=!1){let i=c=>(this.transform.averageElevation=c,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&i(0);let o=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(o||(t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){let c=this.transform.averageElevation,u=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(u)?u=0:this._averageElevationLastSampledAt=e;let h=Math.abs(c-u);if(h>1){if(this._isInitialLoad||o)return this._averageElevation.jumpTo(u),i(u);this._averageElevation.easeTo(u,e,300)}else if(h>1e-4)return this._averageElevation.jumpTo(u),i(u)}return!!this._averageElevation.isEasing(e)&&i(this._averageElevation.getValue(e))}_authenticate(){vj(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,e=>{if(e&&(e.message===vn||e.status===401)){let t=this.painter.context.gl;AT(t,!1),this._logoControl instanceof fF&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new Xe(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),gj(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){let e=this._isDragging();this.painter.updateTerrain(this.style,e)}_calculateSpeedIndex(){let e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());let i=this.painter.context.gl,o=i.createFramebuffer();function c(u){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,u,0);let h=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,h),h}return i.bindFramebuffer(i.FRAMEBUFFER,o),this._canvasPixelComparison(c(e),t.canvasCopies.map(c),t.timeStamps)}_canvasPixelComparison(e,t,i){let o=i[1]-i[0],c=e.length/4;for(let u=0;u<t.length;u++){let h=t[u],p=0;for(let f=0;f<h.length;f+=4)h[f]===e[f]&&h[f+1]===e[f+1]&&h[f+2]===e[f+2]&&h[f+3]===e[f+3]&&(p+=1);o+=(i[u+2]-i[u+1])*(1-p/c)}return o}remove(){this._hash&&this._hash.remove();for(let t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),m!==void 0&&(m.removeEventListener("resize",this._onWindowResize,!1),m.removeEventListener("orientationchange",this._onWindowResize,!1),m.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),m.removeEventListener("online",this._onWindowOnline,!1),m.removeEventListener("visibilitychange",this._onVisibilityChange,!1));let e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Jg.delete(this.painter.context.gl),this._removed=!0,this.fire(new Wt("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(e){this._renderNextFrame=this._renderNextFrame||e,this.style&&!this._frame&&(this._frame=ii.frame(t=>{let i=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,i&&this._render(t)}))}_preloadTiles(e){return _s(this.style?Object.values(this.style._sourceCaches):[],(t,i)=>t._preloadTiles(e,i),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}_onVisibilityChange(){m.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(e){this._showLayers2DWireframe!==e&&(this._showLayers2DWireframe=e,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(e){this._showLayers3DWireframe!==e&&(this._showLayers3DWireframe=e,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&(this._showTileAABBs=e,e&&this._update())}_setCacheLimits(e,t){(function(i,o){$o=i,as=o})(e,t)}get version(){return _}},NavigationControl:class{constructor(e){this.options=ge({},T$,e),this._container=Rn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(vo(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),Rn("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),Rn("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(vo(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{let i=this._map;i&&(this.options.visualizePitch?i.resetNorthPitch({},{originalEvent:t}):i.resetNorth({},{originalEvent:t}))}),this._compassIcon=Rn("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let e=this._map;if(!e)return;let t=e.getZoom(),i=t===e.getMaxZoom(),o=t===e.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=o,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",o.toString())}_rotateCompassArrow(){let e=this._map;if(!e)return;let t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5)}) rotateX(${e.transform.pitch}deg) rotateZ(${e.transform.angle*(180/Math.PI)}deg)`:`rotate(${e.transform.angle*(180/Math.PI)}deg)`;e._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new I$(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){let e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){let i=Rn("button",e,this._container);return i.type="button",i.addEventListener("click",t),i}_setButtonTitle(e,t){if(!this._map)return;let i=this._map._getUIString(`NavigationControl.${t}`);e.setAttribute("aria-label",i),e.firstElementChild&&e.firstElementChild.setAttribute("title",i)}},GeolocateControl:class extends Hr{constructor(e){super(),this.options=ge({geolocation:m.navigator.geolocation},A$,e),vo(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=sF(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=Rn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(e){let t=(i=!!this.options.geolocation)=>{this._supportsGeolocation=i,e(i)};this._supportsGeolocation!==void 0?e(this._supportsGeolocation):m.navigator.permissions!==void 0?m.navigator.permissions.query({name:"geolocation"}).then(i=>t(i.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(e){let t=this._map.getMaxBounds(),i=e.coords;return!!t&&(i.longitude<t.getWest()||i.longitude>t.getEast()||i.latitude<t.getSouth()||i.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new Wt("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new Wt("geolocate",e)),this._finish()}}_updateCamera(e){let t=new Ze(e.coords.longitude,e.coords.latitude),i=e.coords.accuracy,o=ge({bearing:this._map.getBearing()},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(i),o,{geolocateSource:!0})}_updateMarker(e){if(e){let t=new Ze(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let e=this._map.transform,t=yn(1,e._center.lat)*e.worldSize,i=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${i}px`,this._circleElement.style.height=`${i}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(e){if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new Wt("error",e)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(e){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=Rn("button","mapboxgl-ctrl-geolocate",this._container),Rn("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",e===!1){lt("Geolocation support is not available so the GeolocateControl will be disabled.");let t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{let t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Rn("div","mapboxgl-user-location"),this._dotElement.appendChild(Rn("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Rn("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new fS({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Rn("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new fS({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new Wt("trackuserlocationend")))})}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:e.absolute===!0&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return lt("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new Wt("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new Wt("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new Wt("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let e=()=>{m.addEventListener("ondeviceorientationabsolute"in m?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};m.DeviceMotionEvent!==void 0&&typeof m.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&e()}).catch(console.error):e()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),m.removeEventListener("deviceorientation",this._onDeviceOrientation),m.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:pF,ScaleControl:class{constructor(e){this.options=ge({},k$,e),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),vo(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let e=this.options.maxWidth||100,t=this._map,i=t._containerHeight/2,o=t._containerWidth/2-e/2,c=t.unproject([o,i]),u=t.unproject([o+e,i]),h=c.distanceTo(u);if(this.options.unit==="imperial"){let p=3.2808*h;p>5280?this._setScale(e,p/5280,"mile"):this._setScale(e,p,"foot")}else this.options.unit==="nautical"?this._setScale(e,h/1852,"nautical-mile"):h>=1e3?this._setScale(e,h/1e3,"kilometer"):this._setScale(e,h,"meter")}_setScale(e,t,i){this._map._requestDomTask(()=>{let o=function(u){let h=Math.pow(10,`${Math.floor(u)}`.length-1),p=u/h;return p=p>=10?10:p>=5?5:p>=3?3:p>=2?2:p>=1?1:function(f){let g=Math.pow(10,Math.ceil(-Math.log(f)/Math.LN10));return Math.round(f*g)/g}(p),h*p}(t),c=o/t;this._container.innerHTML=this._isNumberFormatSupported&&i!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:i}).format(o):`${o}&nbsp;${R$[i]}`,this._container.style.width=e*c+"px"})}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=Rn("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof m.HTMLElement?this._container=e.container:lt("Full screen control 'container' must be a DOM element.")),vo(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in m.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in m.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=Rn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",lt("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,m.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!m.document.fullscreenEnabled&&!m.document.webkitFullscreenEnabled)}_setupUI(){let e=this._fullscreenButton=Rn("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Rn("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),m.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(m.document.fullscreenElement||m.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?m.document.exitFullscreen?m.document.exitFullscreen():m.document.webkitCancelFullScreen&&m.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends Hr{constructor(e){super(),this.options=ge(Object.create(C$),e),vo(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(e&&e.className?e.className.trim().split(/\s+/):[])}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&e.on("preclick",this._onClose),this.options.closeOnMove&&e.on("move",this._onClose),e.on("remove",this.remove),this._update(),e._addPopup(this),this._focusFirstElement(),this._trackPointer?(e.on("mousemove",this._onMouseEvent),e.on("mouseup",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")):e.on("move",this._update),this.fire(new Wt("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let e=this._map;return e&&(e.off("move",this._update),e.off("move",this._onClose),e.off("preclick",this._onClose),e.off("click",this._onClose),e.off("remove",this.remove),e.off("mousemove",this._onMouseEvent),e.off("mouseup",this._onMouseEvent),e.off("drag",this._onMouseEvent),e._canvasContainer&&e._canvasContainer.classList.remove("mapboxgl-track-pointer"),e._removePopup(this),this._map=void 0),this.fire(new Wt("close")),this}getLngLat(){return this._lngLat}setLngLat(e){this._lngLat=Ze.convert(e),this._pos=null,this._trackPointer=!1,this._update();let t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(m.document.createTextNode(e))}setHTML(e){let t=m.document.createDocumentFragment(),i=m.document.createElement("body"),o;for(i.innerHTML=e;o=i.firstChild,o;)t.appendChild(o);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=Rn("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){let i=this._closeButton=Rn("button","mapboxgl-popup-close-button",t);i.type="button",i.setAttribute("aria-label","Close popup"),i.setAttribute("aria-hidden","true"),i.innerHTML="&#215;",i.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;let t=this._map,i=this._container,o=this._pos;if(!t||!i||!o)return"bottom";let c=i.offsetWidth,u=i.offsetHeight,h=o.x<c/2,p=o.x>t.transform.width-c/2;if(o.y+e<u)return h?"top-left":p?"top-right":"top";if(o.y>t.transform.height-u){if(h)return"bottom-left";if(p)return"bottom-right"}return h?"left":p?"right":"bottom"}_updateClassList(){let e=this._container;if(!e)return;let t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ")}_update(e){let t=this._map,i=this._content;if(!t||!this._lngLat&&!this._trackPointer||!i)return;let o=this._container;if(o||(o=this._container=Rn("div","mapboxgl-popup",t.getContainer()),this._tip=Rn("div","mapboxgl-popup-tip",o),o.appendChild(i)),this.options.maxWidth&&o.style.maxWidth!==this.options.maxWidth&&(o.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=_F(this._lngLat,this._pos,t.transform)),!this._trackPointer||e){let c=this._pos=this._trackPointer&&e?e:t.project(this._lngLat),u=vF(this.options.offset),h=this._anchor=this._getAnchor(u.y),p=vF(this.options.offset,h),f=c.add(p).round();t._requestDomTask(()=>{this._container&&h&&(this._container.style.transform=`${pS[h]} translate(${f.x}px,${f.y}px)`)})}if(!this._marker&&t._showingGlobe()){let c=$_(t.transform,this._lngLat)?0:1;this._setOpacity(c)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let e=this._container.querySelector(S$);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity=`${e}`),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:fS,Style:nl,LngLat:Ze,LngLatBounds:Es,Point:Q,MercatorCoordinate:Fi,FreeCameraOptions:IR,Evented:Hr,config:S,prewarm:function(){lf().acquire(BC)},clearPrewarmedResources:function(){let e=af;e&&(e.isPreloaded()&&e.numActive()===1?(e.release(BC),af=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return S.ACCESS_TOKEN},set accessToken(e){S.ACCESS_TOKEN=e},get baseApiUrl(){return S.API_URL},set baseApiUrl(e){S.API_URL=e},get workerCount(){return zh.workerCount},set workerCount(e){zh.workerCount=e},get maxParallelImageRequests(){return S.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){S.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(e){(function(t){if(!Zu())return;let i=m.caches.delete(qn);t&&i.catch(t).then(()=>t())})(e)},workerUrl:"",workerClass:null,get dracoUrl(){return GP()},set dracoUrl(e){(function(t){VC=ii.resolveURL(t),jC||(jC=new j0(lf(),new Hr)),jC.broadcast("setDracoUrl",VC)})(e)},setNow:ii.setNow,restoreNow:ii.restoreNow};d.A=FP,d.D=u0,d.E=wt,d.F=lC,d.K=Z0,d.O=$i,d.P=Q,d.T=tP,d.V=s0,d.a=o0,d.b=kk,d.c=B0,d.d=class extends Hr{constructor(e,t,i,o,c,u){super(),this.actor=e,this.layerIndex=t,this.availableImages=i,this.loadVectorData=c||UP,this.loading={},this.loaded={},this.deduped=new jP(e.scheduler),this.isSpriteLoaded=o,this.scheduler=e.scheduler,this.brightness=u}loadTile(e,t){let i=e.uid,o=e&&e.request,c=o&&o.collectResourceTiming,u=this.loading[i]=new QG(e);u.abort=this.loadVectorData(e,(h,p)=>{let f=!this.loading[i];if(delete this.loading[i],f||h||!p)return u.status="done",f||(this.loaded[i]=u),t(h);let g=p.rawData,v={};p.expires&&(v.expires=p.expires),p.cacheControl&&(v.cacheControl=p.cacheControl),u.vectorTile=p.vectorTile||new sC(new d0(g));let y=()=>{u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,(b,x)=>{if(b||!x)return t(b);let C={};if(c){let E=RT(o);E.length>0&&(C.resourceTiming=JSON.parse(JSON.stringify(E)))}t(null,ge({rawTileData:g.slice(0)},x,v,C))})};this.isSpriteLoaded?y():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(y,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):y()}),this.loaded=this.loaded||{},this.loaded[i]=u})}reloadTile(e,t){let i=this.loaded,o=e.uid,c=this;if(i&&i[o]){let u=i[o];u.showCollisionBoxes=e.showCollisionBoxes,u.projection=e.projection,u.brightness=e.brightness,u.tileTransform=au(e.tileID.canonical,e.projection),u.extraShadowCaster=e.extraShadowCaster;let h=(p,f)=>{let g=u.reloadCallback;g&&(delete u.reloadCallback,u.parse(u.vectorTile,c.layerIndex,this.availableImages,c.actor,g)),t(p,f)};u.status==="parsing"?u.reloadCallback=h:u.status==="done"&&(u.vectorTile?u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,h):h())}else t(null,void 0)}abortTile(e,t){let i=e.uid,o=this.loading[i];o&&(o.abort&&o.abort(),delete this.loading[i]),t()}removeTile(e,t){let i=this.loaded,o=e.uid;i&&i[o]&&delete i[o],t()}},d.e=Uc,d.f=RT,d.g=mt,d.h=Xt,d.i=ne,d.j=function(e,t){let i=$C(e);for(let o of i){for(let c of o.meshes)lq(c);o.lights&&(o.lightMeshIndex=o.meshes.length,o.meshes.push(cq(o.lights,t)))}return i},d.k=ir,d.l=function(e){let t=0;if(new Uint32Array(e,0,1)[0]!==WP){let i=new Uint32Array(e,0,7),[,,o,c,u,h]=i;t=i.byteLength+c+u+h+u,(o!==e.byteLength||t>=e.byteLength)&&lt("Invalid b3dm header information.")}return XP(e,t)},d.m=b0,d.n=ha,d.o=Wt,d.p=Nt,d.q=function(e){vs(),ls&&ls.then(t=>{t.keys().then(i=>{for(let o=0;o<i.length-e;o++)t.delete(i[o])})})},d.r=eO,d.s=uv,d.t=Lp,d.v=qs,d.w=m}),n(["./shared"],function(d){"use strict";function m(Yt){if(typeof Yt=="number"||typeof Yt=="boolean"||typeof Yt=="string"||Yt==null)return JSON.stringify(Yt);if(Array.isArray(Yt)){let et="[";for(let lt of Yt)et+=`${m(lt)},`;return`${et}]`}let K="{";for(let et of Object.keys(Yt).sort())K+=`${et}:${m(Yt[et])},`;return`${K}}`}function _(Yt){let K="";for(let et of d.r)K+=`/${m(Yt[et])}`;return K}class w{constructor(K){this.keyCache={},this._layers={},this._layerConfigs={},K&&this.replace(K)}replace(K,et){this._layerConfigs={},this._layers={},this.update(K,[],et)}update(K,et,lt){this._options=lt;for(let Vt of K){this._layerConfigs[Vt.id]=Vt;let _e=this._layers[Vt.id]=d.c(Vt,this._options);_e.setScope(this.scope),_e.compileFilter(),this.keyCache[Vt.id]&&delete this.keyCache[Vt.id]}for(let Vt of et)delete this.keyCache[Vt],delete this._layerConfigs[Vt],delete this._layers[Vt];this.familiesBySource={};let zt=function(Vt,_e){let Ae={};for(let Pe=0;Pe<Vt.length;Pe++){let $e=_e&&_e[Vt[Pe].id]||_(Vt[Pe]);_e&&(_e[Vt[Pe].id]=$e);let Ke=Ae[$e];Ke||(Ke=Ae[$e]=[]),Ke.push(Vt[Pe])}let jt=[];for(let Pe in Ae)jt.push(Ae[Pe]);return jt}(d.v(this._layerConfigs),this.keyCache);for(let Vt of zt){let _e=Vt.map(On=>this._layers[On.id]),Ae=_e[0];if(Ae.visibility==="none")continue;let jt=Ae.source||"",Pe=this.familiesBySource[jt];Pe||(Pe=this.familiesBySource[jt]={});let $e=Ae.sourceLayer||"_geojsonTileLayer",Ke=Pe[$e];Ke||(Ke=Pe[$e]=[]),Ke.push(_e)}}}class S{loadTile(K,et){let{uid:lt,encoding:zt,rawImageData:Vt,padding:_e}=K,Ae=d.w.ImageBitmap&&Vt instanceof d.w.ImageBitmap?this.getImageData(Vt,_e):Vt;et(null,new d.D(lt,Ae,zt,_e<1))}getImageData(K,et){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(K.width,K.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=K.width,this.offscreenCanvas.height=K.height,this.offscreenCanvasContext.drawImage(K,0,0,K.width,K.height);let lt=this.offscreenCanvasContext.getImageData(-et,-et,K.width+2*et,K.height+2*et);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),lt}}function I(Yt,K){if(Yt.length!==0){L(Yt[0],K);for(var et=1;et<Yt.length;et++)L(Yt[et],!K)}}function L(Yt,K){for(var et=0,lt=0,zt=0,Vt=Yt.length,_e=Vt-1;zt<Vt;_e=zt++){var Ae=(Yt[zt][0]-Yt[_e][0])*(Yt[_e][1]+Yt[zt][1]),jt=et+Ae;lt+=Math.abs(et)>=Math.abs(Ae)?et-jt+Ae:Ae-jt+et,et=jt}et+lt>=0!=!!K&&Yt.reverse()}var H=d.g(function Yt(K,et){var lt,zt=K&&K.type;if(zt==="FeatureCollection")for(lt=0;lt<K.features.length;lt++)Yt(K.features[lt],et);else if(zt==="GeometryCollection")for(lt=0;lt<K.geometries.length;lt++)Yt(K.geometries[lt],et);else if(zt==="Feature")Yt(K.geometry,et);else if(zt==="Polygon")I(K.coordinates,et);else if(zt==="MultiPolygon")for(lt=0;lt<K.coordinates.length;lt++)I(K.coordinates[lt],et);return K});let q=d.V.prototype.toGeoJSON;var X={exports:{}},it=d.p,at=d.a.VectorTileFeature,mt=Mt;function Mt(Yt,K){this.options=K||{},this.features=Yt,this.length=Yt.length}function Lt(Yt,K){this.id=typeof Yt.id=="number"?Yt.id:void 0,this.type=Yt.type,this.rawGeometry=Yt.type===1?[Yt.geometry]:Yt.geometry,this.properties=Yt.tags,this.extent=K||4096}Mt.prototype.feature=function(Yt){return new Lt(this.features[Yt],this.options.extent)},Lt.prototype.loadGeometry=function(){var Yt=this.rawGeometry;this.geometry=[];for(var K=0;K<Yt.length;K++){for(var et=Yt[K],lt=[],zt=0;zt<et.length;zt++)lt.push(new it(et[zt][0],et[zt][1]));this.geometry.push(lt)}return this.geometry},Lt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Yt=this.geometry,K=1/0,et=-1/0,lt=1/0,zt=-1/0,Vt=0;Vt<Yt.length;Vt++)for(var _e=Yt[Vt],Ae=0;Ae<_e.length;Ae++){var jt=_e[Ae];K=Math.min(K,jt.x),et=Math.max(et,jt.x),lt=Math.min(lt,jt.y),zt=Math.max(zt,jt.y)}return[K,lt,et,zt]},Lt.prototype.toGeoJSON=at.prototype.toGeoJSON;var Pt=d.b,Nt=mt;function ue(Yt){var K=new Pt;return function(et,lt){for(var zt in et.layers)lt.writeMessage(3,Q,et.layers[zt])}(Yt,K),K.finish()}function Q(Yt,K){var et;K.writeVarintField(15,Yt.version||1),K.writeStringField(1,Yt.name||""),K.writeVarintField(5,Yt.extent||4096);var lt={keys:[],values:[],keycache:{},valuecache:{}};for(et=0;et<Yt.length;et++)lt.feature=Yt.feature(et),K.writeMessage(2,$t,lt);var zt=lt.keys;for(et=0;et<zt.length;et++)K.writeStringField(3,zt[et]);var Vt=lt.values;for(et=0;et<Vt.length;et++)K.writeMessage(4,Oi,Vt[et])}function $t(Yt,K){var et=Yt.feature;et.id!==void 0&&K.writeVarintField(1,et.id),K.writeMessage(2,Ue,Yt),K.writeVarintField(3,et.type),K.writeMessage(4,ei,et)}function Ue(Yt,K){var et=Yt.feature,lt=Yt.keys,zt=Yt.values,Vt=Yt.keycache,_e=Yt.valuecache;for(var Ae in et.properties){var jt=et.properties[Ae],Pe=Vt[Ae];if(jt!==null){Pe===void 0&&(lt.push(Ae),Vt[Ae]=Pe=lt.length-1),K.writeVarint(Pe);var $e=typeof jt;$e!=="string"&&$e!=="boolean"&&$e!=="number"&&(jt=JSON.stringify(jt));var Ke=$e+":"+jt,On=_e[Ke];On===void 0&&(zt.push(jt),_e[Ke]=On=zt.length-1),K.writeVarint(On)}}}function ki(Yt,K){return(K<<3)+(7&Yt)}function fe(Yt){return Yt<<1^Yt>>31}function ei(Yt,K){for(var et=Yt.loadGeometry(),lt=Yt.type,zt=0,Vt=0,_e=et.length,Ae=0;Ae<_e;Ae++){var jt=et[Ae],Pe=1;lt===1&&(Pe=jt.length),K.writeVarint(ki(1,Pe));for(var $e=lt===3?jt.length-1:jt.length,Ke=0;Ke<$e;Ke++){Ke===1&&lt!==1&&K.writeVarint(ki(2,$e-1));var On=jt[Ke].x-zt,gr=jt[Ke].y-Vt;K.writeVarint(fe(On)),K.writeVarint(fe(gr)),zt+=On,Vt+=gr}lt===3&&K.writeVarint(ki(7,1))}}function Oi(Yt,K){var et=typeof Yt;et==="string"?K.writeStringField(1,Yt):et==="boolean"?K.writeBooleanField(7,Yt):et==="number"&&(Yt%1!=0?K.writeDoubleField(3,Yt):Yt<0?K.writeSVarintField(6,Yt):K.writeVarintField(5,Yt))}X.exports=ue,X.exports.fromVectorTileJs=ue,X.exports.fromGeojsonVt=function(Yt,K){K=K||{};var et={};for(var lt in Yt)et[lt]=new Nt(Yt[lt].features,K),et[lt].name=lt,et[lt].version=K.version,et[lt].extent=K.extent;return ue({layers:et})},X.exports.GeoJSONWrapper=Nt;var Dr=d.g(X.exports);let Ri={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Yt=>Yt},Gn=Math.fround||(_n=new Float32Array(1),Yt=>(_n[0]=+Yt,_n[0]));var _n;let fr=3,ve=5,Wo=6;class ss{constructor(K){this.options=Object.assign(Object.create(Ri),K),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(K){let{log:et,minZoom:lt,maxZoom:zt}=this.options;et&&console.time("total time");let Vt=`prepare ${K.length} points`;et&&console.time(Vt),this.points=K;let _e=[];for(let jt=0;jt<K.length;jt++){let Pe=K[jt];if(!Pe.geometry)continue;let[$e,Ke]=Pe.geometry.coordinates,On=Gn(ge($e)),gr=Gn(Go(Ke));_e.push(On,gr,1/0,jt,-1,1),this.options.reduce&&_e.push(0)}let Ae=this.trees[zt+1]=this._createTree(_e);et&&console.timeEnd(Vt);for(let jt=zt;jt>=lt;jt--){let Pe=+Date.now();Ae=this.trees[jt]=this._createTree(this._cluster(Ae,jt)),et&&console.log("z%d: %d clusters in %dms",jt,Ae.numItems,+Date.now()-Pe)}return et&&console.timeEnd("total time"),this}getClusters(K,et){let lt=((K[0]+180)%360+360)%360-180,zt=Math.max(-90,Math.min(90,K[1])),Vt=K[2]===180?180:((K[2]+180)%360+360)%360-180,_e=Math.max(-90,Math.min(90,K[3]));if(K[2]-K[0]>=360)lt=-180,Vt=180;else if(lt>Vt){let Ke=this.getClusters([lt,zt,180,_e],et),On=this.getClusters([-180,zt,Vt,_e],et);return Ke.concat(On)}let Ae=this.trees[this._limitZoom(et)],jt=Ae.range(ge(lt),Go(_e),ge(Vt),Go(zt)),Pe=Ae.data,$e=[];for(let Ke of jt){let On=this.stride*Ke;$e.push(Pe[On+ve]>1?_s(Pe,On,this.clusterProps):this.points[Pe[On+fr]])}return $e}getChildren(K){let et=this._getOriginId(K),lt=this._getOriginZoom(K),zt="No cluster with the specified id.",Vt=this.trees[lt];if(!Vt)throw new Error(zt);let _e=Vt.data;if(et*this.stride>=_e.length)throw new Error(zt);let Ae=this.options.radius/(this.options.extent*Math.pow(2,lt-1)),jt=Vt.within(_e[et*this.stride],_e[et*this.stride+1],Ae),Pe=[];for(let $e of jt){let Ke=$e*this.stride;_e[Ke+4]===K&&Pe.push(_e[Ke+ve]>1?_s(_e,Ke,this.clusterProps):this.points[_e[Ke+fr]])}if(Pe.length===0)throw new Error(zt);return Pe}getLeaves(K,et,lt){let zt=[];return this._appendLeaves(zt,K,et=et||10,lt=lt||0,0),zt}getTile(K,et,lt){let zt=this.trees[this._limitZoom(K)],Vt=Math.pow(2,K),{extent:_e,radius:Ae}=this.options,jt=Ae/_e,Pe=(lt-jt)/Vt,$e=(lt+1+jt)/Vt,Ke={features:[]};return this._addTileFeatures(zt.range((et-jt)/Vt,Pe,(et+1+jt)/Vt,$e),zt.data,et,lt,Vt,Ke),et===0&&this._addTileFeatures(zt.range(1-jt/Vt,Pe,1,$e),zt.data,Vt,lt,Vt,Ke),et===Vt-1&&this._addTileFeatures(zt.range(0,Pe,jt/Vt,$e),zt.data,-1,lt,Vt,Ke),Ke.features.length?Ke:null}getClusterExpansionZoom(K){let et=this._getOriginZoom(K)-1;for(;et<=this.options.maxZoom;){let lt=this.getChildren(K);if(et++,lt.length!==1)break;K=lt[0].properties.cluster_id}return et}_appendLeaves(K,et,lt,zt,Vt){let _e=this.getChildren(et);for(let Ae of _e){let jt=Ae.properties;if(jt&&jt.cluster?Vt+jt.point_count<=zt?Vt+=jt.point_count:Vt=this._appendLeaves(K,jt.cluster_id,lt,zt,Vt):Vt<zt?Vt++:K.push(Ae),K.length===lt)break}return Vt}_createTree(K){let et=new d.K(K.length/this.stride|0,this.options.nodeSize,Float32Array);for(let lt=0;lt<K.length;lt+=this.stride)et.add(K[lt],K[lt+1]);return et.finish(),et.data=K,et}_addTileFeatures(K,et,lt,zt,Vt,_e){for(let Ae of K){let jt=Ae*this.stride,Pe=et[jt+ve]>1,$e,Ke,On;if(Pe)$e=qs(et,jt,this.clusterProps),Ke=et[jt],On=et[jt+1];else{let _r=this.points[et[jt+fr]];$e=_r.properties;let[Fr,qn]=_r.geometry.coordinates;Ke=ge(Fr),On=Go(qn)}let gr={type:1,geometry:[[Math.round(this.options.extent*(Ke*Vt-lt)),Math.round(this.options.extent*(On*Vt-zt))]],tags:$e},ko;ko=Pe||this.options.generateId?et[jt+fr]:this.points[et[jt+fr]].id,ko!==void 0&&(gr.id=ko),_e.features.push(gr)}}_limitZoom(K){return Math.max(this.options.minZoom,Math.min(Math.floor(+K),this.options.maxZoom+1))}_cluster(K,et){let{radius:lt,extent:zt,reduce:Vt,minPoints:_e}=this.options,Ae=lt/(zt*Math.pow(2,et)),jt=K.data,Pe=[],$e=this.stride;for(let Ke=0;Ke<jt.length;Ke+=$e){if(jt[Ke+2]<=et)continue;jt[Ke+2]=et;let On=jt[Ke],gr=jt[Ke+1],ko=K.within(jt[Ke],jt[Ke+1],Ae),_r=jt[Ke+ve],Fr=_r;for(let qn of ko){let $o=qn*$e;jt[$o+2]>et&&(Fr+=jt[$o+ve])}if(Fr>_r&&Fr>=_e){let qn,$o=On*_r,as=gr*_r,ls=-1,$a=((Ke/$e|0)<<5)+(et+1)+this.points.length;for(let Zu of ko){let vs=Zu*$e;if(jt[vs+2]<=et)continue;jt[vs+2]=et;let tc=jt[vs+ve];$o+=jt[vs]*tc,as+=jt[vs+1]*tc,jt[vs+4]=$a,Vt&&(qn||(qn=this._map(jt,Ke,!0),ls=this.clusterProps.length,this.clusterProps.push(qn)),Vt(qn,this._map(jt,vs)))}jt[Ke+4]=$a,Pe.push($o/Fr,as/Fr,1/0,$a,-1,Fr),Vt&&Pe.push(ls)}else{for(let qn=0;qn<$e;qn++)Pe.push(jt[Ke+qn]);if(Fr>1)for(let qn of ko){let $o=qn*$e;if(!(jt[$o+2]<=et)){jt[$o+2]=et;for(let as=0;as<$e;as++)Pe.push(jt[$o+as])}}}}return Pe}_getOriginId(K){return K-this.points.length>>5}_getOriginZoom(K){return(K-this.points.length)%32}_map(K,et,lt){if(K[et+ve]>1){let _e=this.clusterProps[K[et+Wo]];return lt?Object.assign({},_e):_e}let zt=this.points[K[et+fr]].properties,Vt=this.options.map(zt);return lt&&Vt===zt?Object.assign({},Vt):Vt}}function _s(Yt,K,et){return{type:"Feature",id:Yt[K+fr],properties:qs(Yt,K,et),geometry:{type:"Point",coordinates:[(lt=Yt[K],360*(lt-.5)),Hd(Yt[K+1])]}};var lt}function qs(Yt,K,et){let lt=Yt[K+ve],zt=lt>=1e4?`${Math.round(lt/1e3)}k`:lt>=1e3?Math.round(lt/100)/10+"k":lt,Vt=Yt[K+Wo],_e=Vt===-1?{}:Object.assign({},et[Vt]);return Object.assign(_e,{cluster:!0,cluster_id:Yt[K+fr],point_count:lt,point_count_abbreviated:zt})}function ge(Yt){return Yt/360+.5}function Go(Yt){let K=Math.sin(Yt*Math.PI/180),et=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return et<0?0:et>1?1:et}function Hd(Yt){let K=(180-360*Yt)*Math.PI/180;return 360*Math.atan(Math.exp(K))/Math.PI-90}var Wu={exports:{}};Wu.exports=function(){function Yt(Dt,Ot,Gt,Zt){for(var Xt,ne=Zt,ce=Gt-Ot>>1,Jt=Gt-Ot,Me=Dt[Ot],re=Dt[Ot+1],fi=Dt[Gt],vn=Dt[Gt+1],Oe=Ot+3;Oe<Gt;Oe+=3){var cn=K(Dt[Oe],Dt[Oe+1],Me,re,fi,vn);if(cn>ne)Xt=Oe,ne=cn;else if(cn===ne){var vr=Math.abs(Oe-ce);vr<Jt&&(Xt=Oe,Jt=vr)}}ne>Zt&&(Xt-Ot>3&&Yt(Dt,Ot,Xt,Zt),Dt[Xt+2]=ne,Gt-Xt>3&&Yt(Dt,Xt,Gt,Zt))}function K(Dt,Ot,Gt,Zt,Xt,ne){var ce=Xt-Gt,Jt=ne-Zt;if(ce!==0||Jt!==0){var Me=((Dt-Gt)*ce+(Ot-Zt)*Jt)/(ce*ce+Jt*Jt);Me>1?(Gt=Xt,Zt=ne):Me>0&&(Gt+=ce*Me,Zt+=Jt*Me)}return(ce=Dt-Gt)*ce+(Jt=Ot-Zt)*Jt}function et(Dt,Ot,Gt,Zt){var Xt={id:Dt===void 0?null:Dt,type:Ot,geometry:Gt,tags:Zt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ne){var ce=ne.geometry,Jt=ne.type;if(Jt==="Point"||Jt==="MultiPoint"||Jt==="LineString")lt(ne,ce);else if(Jt==="Polygon"||Jt==="MultiLineString")for(var Me=0;Me<ce.length;Me++)lt(ne,ce[Me]);else if(Jt==="MultiPolygon")for(Me=0;Me<ce.length;Me++)for(var re=0;re<ce[Me].length;re++)lt(ne,ce[Me][re])}(Xt),Xt}function lt(Dt,Ot){for(var Gt=0;Gt<Ot.length;Gt+=3)Dt.minX=Math.min(Dt.minX,Ot[Gt]),Dt.minY=Math.min(Dt.minY,Ot[Gt+1]),Dt.maxX=Math.max(Dt.maxX,Ot[Gt]),Dt.maxY=Math.max(Dt.maxY,Ot[Gt+1])}function zt(Dt,Ot,Gt,Zt){if(Ot.geometry){var Xt=Ot.geometry.coordinates,ne=Ot.geometry.type,ce=Math.pow(Gt.tolerance/((1<<Gt.maxZoom)*Gt.extent),2),Jt=[],Me=Ot.id;if(Gt.promoteId?Me=Ot.properties[Gt.promoteId]:Gt.generateId&&(Me=Zt||0),ne==="Point")Vt(Xt,Jt);else if(ne==="MultiPoint")for(var re=0;re<Xt.length;re++)Vt(Xt[re],Jt);else if(ne==="LineString")_e(Xt,Jt,ce,!1);else if(ne==="MultiLineString"){if(Gt.lineMetrics){for(re=0;re<Xt.length;re++)_e(Xt[re],Jt=[],ce,!1),Dt.push(et(Me,"LineString",Jt,Ot.properties));return}Ae(Xt,Jt,ce,!1)}else if(ne==="Polygon")Ae(Xt,Jt,ce,!0);else{if(ne!=="MultiPolygon"){if(ne==="GeometryCollection"){for(re=0;re<Ot.geometry.geometries.length;re++)zt(Dt,{id:Me,geometry:Ot.geometry.geometries[re],properties:Ot.properties},Gt,Zt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(re=0;re<Xt.length;re++){var fi=[];Ae(Xt[re],fi,ce,!0),Jt.push(fi)}}Dt.push(et(Me,ne,Jt,Ot.properties))}}function Vt(Dt,Ot){Ot.push(jt(Dt[0])),Ot.push(Pe(Dt[1])),Ot.push(0)}function _e(Dt,Ot,Gt,Zt){for(var Xt,ne,ce=0,Jt=0;Jt<Dt.length;Jt++){var Me=jt(Dt[Jt][0]),re=Pe(Dt[Jt][1]);Ot.push(Me),Ot.push(re),Ot.push(0),Jt>0&&(ce+=Zt?(Xt*re-Me*ne)/2:Math.sqrt(Math.pow(Me-Xt,2)+Math.pow(re-ne,2))),Xt=Me,ne=re}var fi=Ot.length-3;Ot[2]=1,Yt(Ot,0,fi,Gt),Ot[fi+2]=1,Ot.size=Math.abs(ce),Ot.start=0,Ot.end=Ot.size}function Ae(Dt,Ot,Gt,Zt){for(var Xt=0;Xt<Dt.length;Xt++){var ne=[];_e(Dt[Xt],ne,Gt,Zt),Ot.push(ne)}}function jt(Dt){return Dt/360+.5}function Pe(Dt){var Ot=Math.sin(Dt*Math.PI/180),Gt=.5-.25*Math.log((1+Ot)/(1-Ot))/Math.PI;return Gt<0?0:Gt>1?1:Gt}function $e(Dt,Ot,Gt,Zt,Xt,ne,ce,Jt){if(Zt/=Ot,ne>=(Gt/=Ot)&&ce<Zt)return Dt;if(ce<Gt||ne>=Zt)return null;for(var Me=[],re=0;re<Dt.length;re++){var fi=Dt[re],vn=fi.geometry,Oe=fi.type,cn=Xt===0?fi.minX:fi.minY,vr=Xt===0?fi.maxX:fi.maxY;if(cn>=Gt&&vr<Zt)Me.push(fi);else if(!(vr<Gt||cn>=Zt)){var Lr=[];if(Oe==="Point"||Oe==="MultiPoint")Ke(vn,Lr,Gt,Zt,Xt);else if(Oe==="LineString")On(vn,Lr,Gt,Zt,Xt,!1,Jt.lineMetrics);else if(Oe==="MultiLineString")ko(vn,Lr,Gt,Zt,Xt,!1);else if(Oe==="Polygon")ko(vn,Lr,Gt,Zt,Xt,!0);else if(Oe==="MultiPolygon")for(var Jr=0;Jr<vn.length;Jr++){var Yo=[];ko(vn[Jr],Yo,Gt,Zt,Xt,!0),Yo.length&&Lr.push(Yo)}if(Lr.length){if(Jt.lineMetrics&&Oe==="LineString"){for(Jr=0;Jr<Lr.length;Jr++)Me.push(et(fi.id,Oe,Lr[Jr],fi.tags));continue}Oe!=="LineString"&&Oe!=="MultiLineString"||(Lr.length===1?(Oe="LineString",Lr=Lr[0]):Oe="MultiLineString"),Oe!=="Point"&&Oe!=="MultiPoint"||(Oe=Lr.length===3?"Point":"MultiPoint"),Me.push(et(fi.id,Oe,Lr,fi.tags))}}}return Me.length?Me:null}function Ke(Dt,Ot,Gt,Zt,Xt){for(var ne=0;ne<Dt.length;ne+=3){var ce=Dt[ne+Xt];ce>=Gt&&ce<=Zt&&(Ot.push(Dt[ne]),Ot.push(Dt[ne+1]),Ot.push(Dt[ne+2]))}}function On(Dt,Ot,Gt,Zt,Xt,ne,ce){for(var Jt,Me,re=gr(Dt),fi=Xt===0?Fr:qn,vn=Dt.start,Oe=0;Oe<Dt.length-3;Oe+=3){var cn=Dt[Oe],vr=Dt[Oe+1],Lr=Dt[Oe+2],Jr=Dt[Oe+3],Yo=Dt[Oe+4],la=Xt===0?cn:vr,yo=Xt===0?Jr:Yo,cs=!1;ce&&(Jt=Math.sqrt(Math.pow(cn-Jr,2)+Math.pow(vr-Yo,2))),la<Gt?yo>Gt&&(Me=fi(re,cn,vr,Jr,Yo,Gt),ce&&(re.start=vn+Jt*Me)):la>Zt?yo<Zt&&(Me=fi(re,cn,vr,Jr,Yo,Zt),ce&&(re.start=vn+Jt*Me)):_r(re,cn,vr,Lr),yo<Gt&&la>=Gt&&(Me=fi(re,cn,vr,Jr,Yo,Gt),cs=!0),yo>Zt&&la<=Zt&&(Me=fi(re,cn,vr,Jr,Yo,Zt),cs=!0),!ne&&cs&&(ce&&(re.end=vn+Jt*Me),Ot.push(re),re=gr(Dt)),ce&&(vn+=Jt)}var Zo=Dt.length-3;cn=Dt[Zo],vr=Dt[Zo+1],Lr=Dt[Zo+2],(la=Xt===0?cn:vr)>=Gt&&la<=Zt&&_r(re,cn,vr,Lr),Zo=re.length-3,ne&&Zo>=3&&(re[Zo]!==re[0]||re[Zo+1]!==re[1])&&_r(re,re[0],re[1],re[2]),re.length&&Ot.push(re)}function gr(Dt){var Ot=[];return Ot.size=Dt.size,Ot.start=Dt.start,Ot.end=Dt.end,Ot}function ko(Dt,Ot,Gt,Zt,Xt,ne){for(var ce=0;ce<Dt.length;ce++)On(Dt[ce],Ot,Gt,Zt,Xt,ne,!1)}function _r(Dt,Ot,Gt,Zt){Dt.push(Ot),Dt.push(Gt),Dt.push(Zt)}function Fr(Dt,Ot,Gt,Zt,Xt,ne){var ce=(ne-Ot)/(Zt-Ot);return Dt.push(ne),Dt.push(Gt+(Xt-Gt)*ce),Dt.push(1),ce}function qn(Dt,Ot,Gt,Zt,Xt,ne){var ce=(ne-Gt)/(Xt-Gt);return Dt.push(Ot+(Zt-Ot)*ce),Dt.push(ne),Dt.push(1),ce}function $o(Dt,Ot){for(var Gt=[],Zt=0;Zt<Dt.length;Zt++){var Xt,ne=Dt[Zt],ce=ne.type;if(ce==="Point"||ce==="MultiPoint"||ce==="LineString")Xt=as(ne.geometry,Ot);else if(ce==="MultiLineString"||ce==="Polygon"){Xt=[];for(var Jt=0;Jt<ne.geometry.length;Jt++)Xt.push(as(ne.geometry[Jt],Ot))}else if(ce==="MultiPolygon")for(Xt=[],Jt=0;Jt<ne.geometry.length;Jt++){for(var Me=[],re=0;re<ne.geometry[Jt].length;re++)Me.push(as(ne.geometry[Jt][re],Ot));Xt.push(Me)}Gt.push(et(ne.id,ce,Xt,ne.tags))}return Gt}function as(Dt,Ot){var Gt=[];Gt.size=Dt.size,Dt.start!==void 0&&(Gt.start=Dt.start,Gt.end=Dt.end);for(var Zt=0;Zt<Dt.length;Zt+=3)Gt.push(Dt[Zt]+Ot,Dt[Zt+1],Dt[Zt+2]);return Gt}function ls(Dt,Ot){if(Dt.transformed)return Dt;var Gt,Zt,Xt,ne=1<<Dt.z,ce=Dt.x,Jt=Dt.y;for(Gt=0;Gt<Dt.features.length;Gt++){var Me=Dt.features[Gt],re=Me.geometry,fi=Me.type;if(Me.geometry=[],fi===1)for(Zt=0;Zt<re.length;Zt+=2)Me.geometry.push($a(re[Zt],re[Zt+1],Ot,ne,ce,Jt));else for(Zt=0;Zt<re.length;Zt++){var vn=[];for(Xt=0;Xt<re[Zt].length;Xt+=2)vn.push($a(re[Zt][Xt],re[Zt][Xt+1],Ot,ne,ce,Jt));Me.geometry.push(vn)}}return Dt.transformed=!0,Dt}function $a(Dt,Ot,Gt,Zt,Xt,ne){return[Math.round(Gt*(Dt*Zt-Xt)),Math.round(Gt*(Ot*Zt-ne))]}function Zu(Dt,Ot,Gt,Zt,Xt){for(var ne=Ot===Xt.maxZoom?0:Xt.tolerance/((1<<Ot)*Xt.extent),ce={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Gt,y:Zt,z:Ot,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Jt=0;Jt<Dt.length;Jt++){ce.numFeatures++,vs(ce,Dt[Jt],ne,Xt);var Me=Dt[Jt].minX,re=Dt[Jt].minY,fi=Dt[Jt].maxX,vn=Dt[Jt].maxY;Me<ce.minX&&(ce.minX=Me),re<ce.minY&&(ce.minY=re),fi>ce.maxX&&(ce.maxX=fi),vn>ce.maxY&&(ce.maxY=vn)}return ce}function vs(Dt,Ot,Gt,Zt){var Xt=Ot.geometry,ne=Ot.type,ce=[];if(ne==="Point"||ne==="MultiPoint")for(var Jt=0;Jt<Xt.length;Jt+=3)ce.push(Xt[Jt]),ce.push(Xt[Jt+1]),Dt.numPoints++,Dt.numSimplified++;else if(ne==="LineString")tc(ce,Xt,Dt,Gt,!1,!1);else if(ne==="MultiLineString"||ne==="Polygon")for(Jt=0;Jt<Xt.length;Jt++)tc(ce,Xt[Jt],Dt,Gt,ne==="Polygon",Jt===0);else if(ne==="MultiPolygon")for(var Me=0;Me<Xt.length;Me++){var re=Xt[Me];for(Jt=0;Jt<re.length;Jt++)tc(ce,re[Jt],Dt,Gt,!0,Jt===0)}if(ce.length){var fi=Ot.tags||null;if(ne==="LineString"&&Zt.lineMetrics){for(var vn in fi={},Ot.tags)fi[vn]=Ot.tags[vn];fi.mapbox_clip_start=Xt.start/Xt.size,fi.mapbox_clip_end=Xt.end/Xt.size}var Oe={geometry:ce,type:ne==="Polygon"||ne==="MultiPolygon"?3:ne==="LineString"||ne==="MultiLineString"?2:1,tags:fi};Ot.id!==null&&(Oe.id=Ot.id),Dt.features.push(Oe)}}function tc(Dt,Ot,Gt,Zt,Xt,ne){var ce=Zt*Zt;if(Zt>0&&Ot.size<(Xt?ce:Zt))Gt.numPoints+=Ot.length/3;else{for(var Jt=[],Me=0;Me<Ot.length;Me+=3)(Zt===0||Ot[Me+2]>ce)&&(Gt.numSimplified++,Jt.push(Ot[Me]),Jt.push(Ot[Me+1])),Gt.numPoints++;Xt&&function(re,fi){for(var vn=0,Oe=0,cn=re.length,vr=cn-2;Oe<cn;vr=Oe,Oe+=2)vn+=(re[Oe]-re[vr])*(re[Oe+1]+re[vr+1]);if(vn>0===fi)for(Oe=0,cn=re.length;Oe<cn/2;Oe+=2){var Lr=re[Oe],Jr=re[Oe+1];re[Oe]=re[cn-2-Oe],re[Oe+1]=re[cn-1-Oe],re[cn-2-Oe]=Lr,re[cn-1-Oe]=Jr}}(Jt,ne),Dt.push(Jt)}}function Bc(Dt,Ot){var Gt=(Ot=this.options=function(Xt,ne){for(var ce in ne)Xt[ce]=ne[ce];return Xt}(Object.create(this.options),Ot)).debug;if(Gt&&console.time("preprocess data"),Ot.maxZoom<0||Ot.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Ot.promoteId&&Ot.generateId)throw new Error("promoteId and generateId cannot be used together.");var Zt=function(Xt,ne){var ce=[];if(Xt.type==="FeatureCollection")for(var Jt=0;Jt<Xt.features.length;Jt++)zt(ce,Xt.features[Jt],ne,Jt);else zt(ce,Xt.type==="Feature"?Xt:{geometry:Xt},ne);return ce}(Dt,Ot);this.tiles={},this.tileCoords=[],Gt&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Ot.indexMaxZoom,Ot.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Zt=function(Xt,ne){var ce=ne.buffer/ne.extent,Jt=Xt,Me=$e(Xt,1,-1-ce,ce,0,-1,2,ne),re=$e(Xt,1,1-ce,2+ce,0,-1,2,ne);return(Me||re)&&(Jt=$e(Xt,1,-ce,1+ce,0,-1,2,ne)||[],Me&&(Jt=$o(Me,1).concat(Jt)),re&&(Jt=Jt.concat($o(re,-1)))),Jt}(Zt,Ot)).length&&this.splitTile(Zt,0,0,0),Gt&&(Zt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Xu(Dt,Ot,Gt){return 32*((1<<Dt)*Gt+Ot)+Dt}return Bc.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Bc.prototype.splitTile=function(Dt,Ot,Gt,Zt,Xt,ne,ce){for(var Jt=[Dt,Ot,Gt,Zt],Me=this.options,re=Me.debug;Jt.length;){Zt=Jt.pop(),Gt=Jt.pop(),Ot=Jt.pop(),Dt=Jt.pop();var fi=1<<Ot,vn=Xu(Ot,Gt,Zt),Oe=this.tiles[vn];if(!Oe&&(re>1&&console.time("creation"),Oe=this.tiles[vn]=Zu(Dt,Ot,Gt,Zt,Me),this.tileCoords.push({z:Ot,x:Gt,y:Zt}),re)){re>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ot,Gt,Zt,Oe.numFeatures,Oe.numPoints,Oe.numSimplified),console.timeEnd("creation"));var cn="z"+Ot;this.stats[cn]=(this.stats[cn]||0)+1,this.total++}if(Oe.source=Dt,Xt){if(Ot===Me.maxZoom||Ot===Xt)continue;var vr=1<<Xt-Ot;if(Gt!==Math.floor(ne/vr)||Zt!==Math.floor(ce/vr))continue}else if(Ot===Me.indexMaxZoom||Oe.numPoints<=Me.indexMaxPoints)continue;if(Oe.source=null,Dt.length!==0){re>1&&console.time("clipping");var Lr,Jr,Yo,la,yo,cs,Zo=.5*Me.buffer/Me.extent,Ku=.5-Zo,Vc=.5+Zo,Qu=1+Zo;Lr=Jr=Yo=la=null,yo=$e(Dt,fi,Gt-Zo,Gt+Vc,0,Oe.minX,Oe.maxX,Me),cs=$e(Dt,fi,Gt+Ku,Gt+Qu,0,Oe.minX,Oe.maxX,Me),Dt=null,yo&&(Lr=$e(yo,fi,Zt-Zo,Zt+Vc,1,Oe.minY,Oe.maxY,Me),Jr=$e(yo,fi,Zt+Ku,Zt+Qu,1,Oe.minY,Oe.maxY,Me),yo=null),cs&&(Yo=$e(cs,fi,Zt-Zo,Zt+Vc,1,Oe.minY,Oe.maxY,Me),la=$e(cs,fi,Zt+Ku,Zt+Qu,1,Oe.minY,Oe.maxY,Me),cs=null),re>1&&console.timeEnd("clipping"),Jt.push(Lr||[],Ot+1,2*Gt,2*Zt),Jt.push(Jr||[],Ot+1,2*Gt,2*Zt+1),Jt.push(Yo||[],Ot+1,2*Gt+1,2*Zt),Jt.push(la||[],Ot+1,2*Gt+1,2*Zt+1)}}},Bc.prototype.getTile=function(Dt,Ot,Gt){var Zt=this.options,Xt=Zt.extent,ne=Zt.debug;if(Dt<0||Dt>24)return null;var ce=1<<Dt,Jt=Xu(Dt,Ot=(Ot%ce+ce)%ce,Gt);if(this.tiles[Jt])return ls(this.tiles[Jt],Xt);ne>1&&console.log("drilling down to z%d-%d-%d",Dt,Ot,Gt);for(var Me,re=Dt,fi=Ot,vn=Gt;!Me&&re>0;)re--,fi=Math.floor(fi/2),vn=Math.floor(vn/2),Me=this.tiles[Xu(re,fi,vn)];return Me&&Me.source?(ne>1&&console.log("found parent tile z%d-%d-%d",re,fi,vn),ne>1&&console.time("drilling down"),this.splitTile(Me.source,re,fi,vn,Dt,Ot,Gt),ne>1&&console.timeEnd("drilling down"),this.tiles[Jt]?ls(this.tiles[Jt],Xt):null):null},function(Dt,Ot){return new Bc(Dt,Ot)}}();var Xg=d.g(Wu.exports);function Kg(Yt,K){let et=Yt.tileID.canonical;if(!this._geoJSONIndex)return K(null,null);let lt=this._geoJSONIndex.getTile(et.z,et.x,et.y);if(!lt)return K(null,null);let zt=new class{constructor(_e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.E,this.length=_e.length,this._features=_e}feature(_e){return new class{constructor(Ae){this._feature=Ae,this.extent=d.E,this.type=Ae.type,this.properties=Ae.tags,"id"in Ae&&!isNaN(Ae.id)&&(this.id=parseInt(Ae.id,10))}loadGeometry(){if(this._feature.type===1){let Ae=[];for(let jt of this._feature.geometry)Ae.push([new d.P(jt[0],jt[1])]);return Ae}{let Ae=[];for(let jt of this._feature.geometry){let Pe=[];for(let $e of jt)Pe.push(new d.P($e[0],$e[1]));Ae.push(Pe)}return Ae}}toGeoJSON(Ae,jt,Pe){return q.call(this,Ae,jt,Pe)}}(this._features[_e])}}(lt.features),Vt=Dr(zt);Vt.byteOffset===0&&Vt.byteLength===Vt.buffer.byteLength||(Vt=new Uint8Array(Vt)),K(null,{vectorTile:zt,rawData:Vt.buffer})}class Qg extends d.d{constructor(K,et,lt,zt,Vt,_e){super(K,et,lt,zt,Kg,_e),Vt&&(this.loadGeoJSON=Vt)}loadData(K,et){let lt=K&&K.request,zt=lt&&lt.collectResourceTiming;this.loadGeoJSON(K,(Vt,_e)=>{if(Vt||!_e)return et(Vt);if(typeof _e!="object")return et(new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`));{H(_e,!0);try{if(K.filter){let jt=d.e(K.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(jt.result==="error")throw new Error(jt.value.map($e=>`${$e.key}: ${$e.message}`).join(", "));_e={type:"FeatureCollection",features:_e.features.filter($e=>jt.value.evaluate({zoom:0},$e))}}this._geoJSONIndex=K.cluster?new ss(function({superclusterOptions:jt,clusterProperties:Pe}){if(!Pe||!jt)return jt;let $e={},Ke={},On={accumulated:null,zoom:0},gr={properties:null},ko=Object.keys(Pe);for(let _r of ko){let[Fr,qn]=Pe[_r],$o=d.e(qn),as=d.e(typeof Fr=="string"?[Fr,["accumulated"],["get",_r]]:Fr);$e[_r]=$o.value,Ke[_r]=as.value}return jt.map=_r=>{gr.properties=_r;let Fr={};for(let qn of ko)Fr[qn]=$e[qn].evaluate(On,gr);return Fr},jt.reduce=(_r,Fr)=>{gr.properties=Fr;for(let qn of ko)On.accumulated=_r[qn],_r[qn]=Ke[qn].evaluate(On,gr)},jt}(K)).load(_e.features):Xg(_e,K.geojsonVtOptions)}catch(jt){return et(jt)}this.loaded={};let Ae={};if(zt){let jt=d.f(lt);jt&&(Ae.resourceTiming={},Ae.resourceTiming[K.source]=JSON.parse(JSON.stringify(jt)))}et(null,Ae)}})}reloadTile(K,et){let lt=this.loaded;return lt&&lt[K.uid]?super.reloadTile(K,et):this.loadTile(K,et)}loadGeoJSON(K,et){if(K.request)d.h(K.request,et);else{if(typeof K.data!="string")return et(new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`));try{return et(null,JSON.parse(K.data))}catch{return et(new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(K,et){try{et(null,this._geoJSONIndex.getClusterExpansionZoom(K.clusterId))}catch(lt){et(lt)}}getClusterChildren(K,et){try{et(null,this._geoJSONIndex.getChildren(K.clusterId))}catch(lt){et(lt)}}getClusterLeaves(K,et){try{et(null,this._geoJSONIndex.getLeaves(K.clusterId,K.limit,K.offset))}catch(lt){et(lt)}}}class vo{constructor(K,et){this.tileID=new d.O(K.tileID.overscaledZ,K.tileID.wrap,K.tileID.canonical.z,K.tileID.canonical.x,K.tileID.canonical.y),this.tileZoom=K.tileZoom,this.uid=K.uid,this.zoom=K.zoom,this.canonical=K.tileID.canonical,this.pixelRatio=K.pixelRatio,this.tileSize=K.tileSize,this.source=K.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=K.projection,this.brightness=et}parse(K,et,lt,zt){this.status="parsing";let Vt=new d.O(lt.tileID.overscaledZ,lt.tileID.wrap,lt.tileID.canonical.z,lt.tileID.canonical.x,lt.tileID.canonical.y),_e={},Ae=et.familiesBySource[lt.source],jt=new d.F(Vt,lt.promoteId);return jt.bucketLayerIDs=[],d.l(K).then(Pe=>{if(!Pe)return zt(new Error("Could not parse tile"));let $e=d.j(Pe,1/d.t(lt.tileID.canonical)),Ke=Pe.json.extensionsUsed&&Pe.json.extensionsUsed.includes("MAPBOX_mesh_features"),On=new d.k(this.zoom,{brightness:this.brightness});for(let gr in Ae)for(let ko of Ae[gr]){let _r=ko[0],Fr=Pe.json.extensionsUsed;_r.recalculate(On,[]);let qn=new d.T($e,Vt,Fr&&Fr.includes("MAPBOX_mesh_features"),this.brightness);Ke||(qn.needsUpload=!0),_e[_r.fqid]=qn,qn.evaluate(_r)}this.status="done",zt(null,{buckets:_e,featureIndex:jt})}).catch(Pe=>zt(new Error(Pe.message)))}}class $u{constructor(K,et,lt,zt,Vt,_e){this.actor=K,this.layerIndex=et,this.brightness=_e,this.loading={},this.loaded={}}loadTile(K,et){let lt=K.uid,zt=this.loading[lt]=new vo(K,this.brightness);d.i(K.request,(Vt,_e)=>{let Ae=!this.loading[lt];return delete this.loading[lt],Ae||Vt?(zt.status="done",Ae||(this.loaded[lt]=zt),et(Vt)):_e&&_e.byteLength!==0?void zt.parse(_e,this.layerIndex,K,(jt,Pe)=>{zt.status="done",this.loaded=this.loaded||{},this.loaded[lt]=zt,jt||!Pe?et(jt):et(null,Pe)}):(zt.status="done",this.loaded[lt]=zt,et())})}reloadTile(K,et){let lt=this.loaded,zt=K.uid;if(lt&&lt[zt]){let Vt=lt[zt];Vt.projection=K.projection,Vt.brightness=K.brightness;let _e=(Ae,jt)=>{Vt.reloadCallback&&(delete Vt.reloadCallback,this.loadTile(K,et)),et(Ae,jt)};Vt.status==="parsing"?Vt.reloadCallback=_e:Vt.status==="done"&&this.loadTile(K,et)}}abortTile(K,et){let lt=K.uid;this.loading[lt]&&delete this.loading[lt],et()}removeTile(K,et){let lt=this.loaded,zt=K.uid;lt&&lt[zt]&&delete lt[zt],et()}}class Yu{constructor(K){this.self=K,this.actor=new d.A(K,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=d.m({name:"mercator"}),this.workerSourceTypes={vector:d.d,geojson:Qg,"batched-model":$u},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(et,lt)=>{if(this.workerSourceTypes[et])throw new Error(`Worker source with name "${et}" already registered.`);this.workerSourceTypes[et]=lt},this.self.registerRTLTextPlugin=et=>{if(d.n.isParsed())throw new Error("RTL text plugin already registered.");d.n.applyArabicShaping=et.applyArabicShaping,d.n.processBidirectionalText=et.processBidirectionalText,d.n.processStyledBidirectionalText=et.processStyledBidirectionalText}}clearCaches(K,et,lt){delete this.layerIndexes[K],delete this.availableImages[K],delete this.workerSources[K],delete this.demWorkerSources[K],lt()}checkIfReady(K,et,lt){lt()}setReferrer(K,et){this.referrer=et}spriteLoaded(K,{scope:et,isLoaded:lt}){if(this.isSpriteLoaded[K]||(this.isSpriteLoaded[K]={}),this.isSpriteLoaded[K][et]=lt,this.workerSources[K]&&this.workerSources[K][et])for(let zt in this.workerSources[K][et]){let Vt=this.workerSources[K][et][zt];for(let _e in Vt)Vt[_e]instanceof d.d&&(Vt[_e].isSpriteLoaded=lt,Vt[_e].fire(new d.o("isSpriteLoaded")))}}setImages(K,{scope:et,images:lt},zt){if(this.availableImages[K]||(this.availableImages[K]={}),this.availableImages[K][et]=lt,this.workerSources[K]&&this.workerSources[K][et]){for(let Vt in this.workerSources[K][et]){let _e=this.workerSources[K][et][Vt];for(let Ae in _e)_e[Ae].availableImages=lt}zt()}else zt()}setProjection(K,et){this.projections[K]=d.m(et)}setBrightness(K,et,lt){this.brightness=et,lt()}setLayers(K,et,lt){this.getLayerIndex(K,et.scope).replace(et.layers,et.options),lt()}updateLayers(K,et,lt){this.getLayerIndex(K,et.scope).update(et.layers,et.removedIds,et.options),lt()}loadTile(K,et,lt){et.projection=this.projections[K]||this.defaultProjection,this.getWorkerSource(K,et.type,et.source,et.scope).loadTile(et,lt)}loadDEMTile(K,et,lt){this.getDEMWorkerSource(K,et.source,et.scope).loadTile(et,lt)}reloadTile(K,et,lt){et.projection=this.projections[K]||this.defaultProjection,this.getWorkerSource(K,et.type,et.source,et.scope).reloadTile(et,lt)}abortTile(K,et,lt){this.getWorkerSource(K,et.type,et.source,et.scope).abortTile(et,lt)}removeTile(K,et,lt){this.getWorkerSource(K,et.type,et.source,et.scope).removeTile(et,lt)}removeSource(K,et,lt){if(!(this.workerSources[K]&&this.workerSources[K][et.scope]&&this.workerSources[K][et.scope][et.type]&&this.workerSources[K][et.scope][et.type][et.source]))return;let zt=this.workerSources[K][et.scope][et.type][et.source];delete this.workerSources[K][et.scope][et.type][et.source],zt.removeSource!==void 0?zt.removeSource(et,lt):lt()}loadWorkerSource(K,et,lt){try{this.self.importScripts(et.url),lt()}catch(zt){lt(zt.toString())}}syncRTLPluginState(K,et,lt){try{d.n.setState(et);let zt=d.n.getPluginURL();if(d.n.isLoaded()&&!d.n.isParsed()&&zt!=null){this.self.importScripts(zt);let Vt=d.n.isParsed();lt(Vt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${zt}`),Vt)}}catch(zt){lt(zt.toString())}}setDracoUrl(K,et){this.dracoUrl=et}getAvailableImages(K,et){this.availableImages[K]||(this.availableImages[K]={});let lt=this.availableImages[K][et];return lt||(lt=[]),lt}getLayerIndex(K,et){this.layerIndexes[K]||(this.layerIndexes[K]={});let lt=this.layerIndexes[K][et];return lt||(lt=this.layerIndexes[K][et]=new w,lt.scope=et),lt}getWorkerSource(K,et,lt,zt){if(this.workerSources[K]||(this.workerSources[K]={}),this.workerSources[K][zt]||(this.workerSources[K][zt]={}),this.workerSources[K][zt][et]||(this.workerSources[K][zt][et]={}),this.isSpriteLoaded[K]||(this.isSpriteLoaded[K]={}),!this.workerSources[K][zt][et][lt]){let Vt={send:(_e,Ae,jt,Pe,$e,Ke)=>{this.actor.send(_e,Ae,jt,K,$e,Ke)},scheduler:this.actor.scheduler};this.workerSources[K][zt][et][lt]=new this.workerSourceTypes[et](Vt,this.getLayerIndex(K,zt),this.getAvailableImages(K,zt),this.isSpriteLoaded[K][zt],void 0,this.brightness)}return this.workerSources[K][zt][et][lt]}getDEMWorkerSource(K,et,lt){return this.demWorkerSources[K]||(this.demWorkerSources[K]={}),this.demWorkerSources[K][lt]||(this.demWorkerSources[K][lt]={}),this.demWorkerSources[K][lt][et]||(this.demWorkerSources[K][lt][et]=new S),this.demWorkerSources[K][lt][et]}enforceCacheSizeLimit(K,et){d.q(et)}getWorkerPerformanceMetrics(K,et,lt){lt(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Yu(self)),Yu}),n(["./shared"],function(d){"use strict";return d.s});var s=l;return s})});var Mf=class{},Ov=class{},Su=class a{constructor(r){this.normalizedNames=new Map,this.lazyUpdate=null,r?typeof r=="string"?this.lazyInit=()=>{this.headers=new Map,r.split(`
`).forEach(l=>{let n=l.indexOf(":");if(n>0){let s=l.slice(0,n),d=s.toLowerCase(),m=l.slice(n+1).trim();this.maybeSetNormalizedName(s,d),this.headers.has(d)?this.headers.get(d).push(m):this.headers.set(d,[m])}})}:typeof Headers<"u"&&r instanceof Headers?(this.headers=new Map,r.forEach((l,n)=>{this.setHeaderEntries(n,l)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(r).forEach(([l,n])=>{this.setHeaderEntries(l,n)})}:this.headers=new Map}has(r){return this.init(),this.headers.has(r.toLowerCase())}get(r){this.init();let l=this.headers.get(r.toLowerCase());return l&&l.length>0?l[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(r){return this.init(),this.headers.get(r.toLowerCase())||null}append(r,l){return this.clone({name:r,value:l,op:"a"})}set(r,l){return this.clone({name:r,value:l,op:"s"})}delete(r,l){return this.clone({name:r,value:l,op:"d"})}maybeSetNormalizedName(r,l){this.normalizedNames.has(l)||this.normalizedNames.set(l,r)}init(){this.lazyInit&&(this.lazyInit instanceof a?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(r=>this.applyUpdate(r)),this.lazyUpdate=null))}copyFrom(r){r.init(),Array.from(r.headers.keys()).forEach(l=>{this.headers.set(l,r.headers.get(l)),this.normalizedNames.set(l,r.normalizedNames.get(l))})}clone(r){let l=new a;return l.lazyInit=this.lazyInit&&this.lazyInit instanceof a?this.lazyInit:this,l.lazyUpdate=(this.lazyUpdate||[]).concat([r]),l}applyUpdate(r){let l=r.name.toLowerCase();switch(r.op){case"a":case"s":let n=r.value;if(typeof n=="string"&&(n=[n]),n.length===0)return;this.maybeSetNormalizedName(r.name,l);let s=(r.op==="a"?this.headers.get(l):void 0)||[];s.push(...n),this.headers.set(l,s);break;case"d":let d=r.value;if(!d)this.headers.delete(l),this.normalizedNames.delete(l);else{let m=this.headers.get(l);if(!m)return;m=m.filter(_=>d.indexOf(_)===-1),m.length===0?(this.headers.delete(l),this.normalizedNames.delete(l)):this.headers.set(l,m)}break}}setHeaderEntries(r,l){let n=(Array.isArray(l)?l:[l]).map(d=>d.toString()),s=r.toLowerCase();this.headers.set(s,n),this.maybeSetNormalizedName(r,s)}forEach(r){this.init(),Array.from(this.normalizedNames.keys()).forEach(l=>r(this.normalizedNames.get(l),this.headers.get(l)))}};var LS=class{encodeKey(r){return mL(r)}encodeValue(r){return mL(r)}decodeKey(r){return decodeURIComponent(r)}decodeValue(r){return decodeURIComponent(r)}};function N$(a,r){let l=new Map;return a.length>0&&a.replace(/^\?/,"").split("&").forEach(s=>{let d=s.indexOf("="),[m,_]=d==-1?[r.decodeKey(s),""]:[r.decodeKey(s.slice(0,d)),r.decodeValue(s.slice(d+1))],w=l.get(m)||[];w.push(_),l.set(m,w)}),l}var B$=/%(\d[a-f0-9])/gi,V$={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function mL(a){return encodeURIComponent(a).replace(B$,(r,l)=>V$[l]??r)}function Pv(a){return`${a}`}var Vl=class a{constructor(r={}){if(this.updates=null,this.cloneFrom=null,this.encoder=r.encoder||new LS,r.fromString){if(r.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=N$(r.fromString,this.encoder)}else r.fromObject?(this.map=new Map,Object.keys(r.fromObject).forEach(l=>{let n=r.fromObject[l],s=Array.isArray(n)?n.map(Pv):[Pv(n)];this.map.set(l,s)})):this.map=null}has(r){return this.init(),this.map.has(r)}get(r){this.init();let l=this.map.get(r);return l?l[0]:null}getAll(r){return this.init(),this.map.get(r)||null}keys(){return this.init(),Array.from(this.map.keys())}append(r,l){return this.clone({param:r,value:l,op:"a"})}appendAll(r){let l=[];return Object.keys(r).forEach(n=>{let s=r[n];Array.isArray(s)?s.forEach(d=>{l.push({param:n,value:d,op:"a"})}):l.push({param:n,value:s,op:"a"})}),this.clone(l)}set(r,l){return this.clone({param:r,value:l,op:"s"})}delete(r,l){return this.clone({param:r,value:l,op:"d"})}toString(){return this.init(),this.keys().map(r=>{let l=this.encoder.encodeKey(r);return this.map.get(r).map(n=>l+"="+this.encoder.encodeValue(n)).join("&")}).filter(r=>r!=="").join("&")}clone(r){let l=new a({encoder:this.encoder});return l.cloneFrom=this.cloneFrom||this,l.updates=(this.updates||[]).concat(r),l}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(r=>this.map.set(r,this.cloneFrom.map.get(r))),this.updates.forEach(r=>{switch(r.op){case"a":case"s":let l=(r.op==="a"?this.map.get(r.param):void 0)||[];l.push(Pv(r.value)),this.map.set(r.param,l);break;case"d":if(r.value!==void 0){let n=this.map.get(r.param)||[],s=n.indexOf(Pv(r.value));s!==-1&&n.splice(s,1),n.length>0?this.map.set(r.param,n):this.map.delete(r.param)}else{this.map.delete(r.param);break}}}),this.cloneFrom=this.updates=null)}};var zS=class{constructor(){this.map=new Map}set(r,l){return this.map.set(r,l),this}get(r){return this.map.has(r)||this.map.set(r,r.defaultValue()),this.map.get(r)}delete(r){return this.map.delete(r),this}has(r){return this.map.has(r)}keys(){return this.map.keys()}};function j$(a){switch(a){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function pL(a){return typeof ArrayBuffer<"u"&&a instanceof ArrayBuffer}function fL(a){return typeof Blob<"u"&&a instanceof Blob}function gL(a){return typeof FormData<"u"&&a instanceof FormData}function U$(a){return typeof URLSearchParams<"u"&&a instanceof URLSearchParams}var Ef=class a{constructor(r,l,n,s){this.url=l,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=r.toUpperCase();let d;if(j$(this.method)||s?(this.body=n!==void 0?n:null,d=s):d=n,d&&(this.reportProgress=!!d.reportProgress,this.withCredentials=!!d.withCredentials,d.responseType&&(this.responseType=d.responseType),d.headers&&(this.headers=d.headers),d.context&&(this.context=d.context),d.params&&(this.params=d.params),this.transferCache=d.transferCache),this.headers??=new Su,this.context??=new zS,!this.params)this.params=new Vl,this.urlWithParams=l;else{let m=this.params.toString();if(m.length===0)this.urlWithParams=l;else{let _=l.indexOf("?"),w=_===-1?"?":_<l.length-1?"&":"";this.urlWithParams=l+w+m}}}serializeBody(){return this.body===null?null:pL(this.body)||fL(this.body)||gL(this.body)||U$(this.body)||typeof this.body=="string"?this.body:this.body instanceof Vl?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||gL(this.body)?null:fL(this.body)?this.body.type||null:pL(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof Vl?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(r={}){let l=r.method||this.method,n=r.url||this.url,s=r.responseType||this.responseType,d=r.body!==void 0?r.body:this.body,m=r.withCredentials!==void 0?r.withCredentials:this.withCredentials,_=r.reportProgress!==void 0?r.reportProgress:this.reportProgress,w=r.headers||this.headers,S=r.params||this.params,I=r.context??this.context;return r.setHeaders!==void 0&&(w=Object.keys(r.setHeaders).reduce((L,H)=>L.set(H,r.setHeaders[H]),w)),r.setParams&&(S=Object.keys(r.setParams).reduce((L,H)=>L.set(H,r.setParams[H]),S)),new a(l,n,d,{params:S,headers:w,context:I,reportProgress:_,responseType:s,withCredentials:m})}},em=function(a){return a[a.Sent=0]="Sent",a[a.UploadProgress=1]="UploadProgress",a[a.ResponseHeader=2]="ResponseHeader",a[a.DownloadProgress=3]="DownloadProgress",a[a.Response=4]="Response",a[a.User=5]="User",a}(em||{}),Df=class{constructor(r,l=Lv.Ok,n="OK"){this.headers=r.headers||new Su,this.status=r.status!==void 0?r.status:l,this.statusText=r.statusText||n,this.url=r.url||null,this.ok=this.status>=200&&this.status<300}},NS=class a extends Df{constructor(r={}){super(r),this.type=em.ResponseHeader}clone(r={}){return new a({headers:r.headers||this.headers,status:r.status!==void 0?r.status:this.status,statusText:r.statusText||this.statusText,url:r.url||this.url||void 0})}},im=class a extends Df{constructor(r={}){super(r),this.type=em.Response,this.body=r.body!==void 0?r.body:null}clone(r={}){return new a({body:r.body!==void 0?r.body:this.body,headers:r.headers||this.headers,status:r.status!==void 0?r.status:this.status,statusText:r.statusText||this.statusText,url:r.url||this.url||void 0})}},Fv=class extends Df{constructor(r){super(r,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${r.url||"(unknown url)"}`:this.message=`Http failure response for ${r.url||"(unknown url)"}: ${r.status} ${r.statusText}`,this.error=r.error||null}},Lv=function(a){return a[a.Continue=100]="Continue",a[a.SwitchingProtocols=101]="SwitchingProtocols",a[a.Processing=102]="Processing",a[a.EarlyHints=103]="EarlyHints",a[a.Ok=200]="Ok",a[a.Created=201]="Created",a[a.Accepted=202]="Accepted",a[a.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",a[a.NoContent=204]="NoContent",a[a.ResetContent=205]="ResetContent",a[a.PartialContent=206]="PartialContent",a[a.MultiStatus=207]="MultiStatus",a[a.AlreadyReported=208]="AlreadyReported",a[a.ImUsed=226]="ImUsed",a[a.MultipleChoices=300]="MultipleChoices",a[a.MovedPermanently=301]="MovedPermanently",a[a.Found=302]="Found",a[a.SeeOther=303]="SeeOther",a[a.NotModified=304]="NotModified",a[a.UseProxy=305]="UseProxy",a[a.Unused=306]="Unused",a[a.TemporaryRedirect=307]="TemporaryRedirect",a[a.PermanentRedirect=308]="PermanentRedirect",a[a.BadRequest=400]="BadRequest",a[a.Unauthorized=401]="Unauthorized",a[a.PaymentRequired=402]="PaymentRequired",a[a.Forbidden=403]="Forbidden",a[a.NotFound=404]="NotFound",a[a.MethodNotAllowed=405]="MethodNotAllowed",a[a.NotAcceptable=406]="NotAcceptable",a[a.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",a[a.RequestTimeout=408]="RequestTimeout",a[a.Conflict=409]="Conflict",a[a.Gone=410]="Gone",a[a.LengthRequired=411]="LengthRequired",a[a.PreconditionFailed=412]="PreconditionFailed",a[a.PayloadTooLarge=413]="PayloadTooLarge",a[a.UriTooLong=414]="UriTooLong",a[a.UnsupportedMediaType=415]="UnsupportedMediaType",a[a.RangeNotSatisfiable=416]="RangeNotSatisfiable",a[a.ExpectationFailed=417]="ExpectationFailed",a[a.ImATeapot=418]="ImATeapot",a[a.MisdirectedRequest=421]="MisdirectedRequest",a[a.UnprocessableEntity=422]="UnprocessableEntity",a[a.Locked=423]="Locked",a[a.FailedDependency=424]="FailedDependency",a[a.TooEarly=425]="TooEarly",a[a.UpgradeRequired=426]="UpgradeRequired",a[a.PreconditionRequired=428]="PreconditionRequired",a[a.TooManyRequests=429]="TooManyRequests",a[a.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",a[a.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",a[a.InternalServerError=500]="InternalServerError",a[a.NotImplemented=501]="NotImplemented",a[a.BadGateway=502]="BadGateway",a[a.ServiceUnavailable=503]="ServiceUnavailable",a[a.GatewayTimeout=504]="GatewayTimeout",a[a.HttpVersionNotSupported=505]="HttpVersionNotSupported",a[a.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",a[a.InsufficientStorage=507]="InsufficientStorage",a[a.LoopDetected=508]="LoopDetected",a[a.NotExtended=510]="NotExtended",a[a.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",a}(Lv||{});function FS(a,r){return{body:r,headers:a.headers,context:a.context,observe:a.observe,params:a.params,reportProgress:a.reportProgress,responseType:a.responseType,withCredentials:a.withCredentials,transferCache:a.transferCache}}var Hi=(()=>{let r=class r{constructor(n){this.handler=n}request(n,s,d={}){let m;if(n instanceof Ef)m=n;else{let S;d.headers instanceof Su?S=d.headers:S=new Su(d.headers);let I;d.params&&(d.params instanceof Vl?I=d.params:I=new Vl({fromObject:d.params})),m=new Ef(n,s,d.body!==void 0?d.body:null,{headers:S,context:d.context,params:I,reportProgress:d.reportProgress,responseType:d.responseType||"json",withCredentials:d.withCredentials,transferCache:d.transferCache})}let _=Fe(m).pipe(gu(S=>this.handler.handle(S)));if(n instanceof Ef||d.observe==="events")return _;let w=_.pipe(pn(S=>S instanceof im));switch(d.observe||"body"){case"body":switch(m.responseType){case"arraybuffer":return w.pipe(Li(S=>{if(S.body!==null&&!(S.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return S.body}));case"blob":return w.pipe(Li(S=>{if(S.body!==null&&!(S.body instanceof Blob))throw new Error("Response is not a Blob.");return S.body}));case"text":return w.pipe(Li(S=>{if(S.body!==null&&typeof S.body!="string")throw new Error("Response is not a string.");return S.body}));case"json":default:return w.pipe(Li(S=>S.body))}case"response":return w;default:throw new Error(`Unreachable: unhandled observe type ${d.observe}}`)}}delete(n,s={}){return this.request("DELETE",n,s)}get(n,s={}){return this.request("GET",n,s)}head(n,s={}){return this.request("HEAD",n,s)}jsonp(n,s){return this.request("JSONP",n,{params:new Vl().append(s,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(n,s={}){return this.request("OPTIONS",n,s)}patch(n,s,d={}){return this.request("PATCH",n,FS(d,s))}post(n,s,d={}){return this.request("POST",n,FS(d,s))}put(n,s,d={}){return this.request("PUT",n,FS(d,s))}};r.\u0275fac=function(s){return new(s||r)(ht(Mf))},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})();function bL(a,r){return r(a)}function H$(a,r){return(l,n)=>r.intercept(l,{handle:s=>a(s,n)})}function G$(a,r,l){return(n,s)=>Sc(l,()=>r(n,d=>a(d,s)))}var BS=new Se(""),VS=new Se(""),q$=new Se(""),W$=new Se("");function $$(){let a=null;return(r,l)=>{a===null&&(a=(le(BS,{optional:!0})??[]).reduceRight(H$,bL));let n=le(Cf),s=n.add();return a(r,l).pipe(rl(()=>n.remove(s)))}}var _L=(()=>{let r=class r extends Mf{constructor(n,s){super(),this.backend=n,this.injector=s,this.chain=null,this.pendingTasks=le(Cf);let d=le(W$,{optional:!0});this.backend=d??n}handle(n){if(this.chain===null){let d=Array.from(new Set([...this.injector.get(VS),...this.injector.get(q$,[])]));this.chain=d.reduceRight((m,_)=>G$(m,_,this.injector),bL)}let s=this.pendingTasks.add();return this.chain(n,d=>this.backend.handle(d)).pipe(rl(()=>this.pendingTasks.remove(s)))}};r.\u0275fac=function(s){return new(s||r)(ht(Ov),ht(qh))},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})();var Y$=/^\)\]\}',?\n/;function Z$(a){return"responseURL"in a&&a.responseURL?a.responseURL:/^X-Request-URL:/m.test(a.getAllResponseHeaders())?a.getResponseHeader("X-Request-URL"):null}var vL=(()=>{let r=class r{constructor(n){this.xhrFactory=n}handle(n){if(n.method==="JSONP")throw new dr(-2800,!1);let s=this.xhrFactory;return(s.\u0275loadImpl?Oo(s.\u0275loadImpl()):Fe(null)).pipe(ro(()=>new ya(m=>{let _=s.build();if(_.open(n.method,n.urlWithParams),n.withCredentials&&(_.withCredentials=!0),n.headers.forEach((at,mt)=>_.setRequestHeader(at,mt.join(","))),n.headers.has("Accept")||_.setRequestHeader("Accept","application/json, text/plain, */*"),!n.headers.has("Content-Type")){let at=n.detectContentTypeHeader();at!==null&&_.setRequestHeader("Content-Type",at)}if(n.responseType){let at=n.responseType.toLowerCase();_.responseType=at!=="json"?at:"text"}let w=n.serializeBody(),S=null,I=()=>{if(S!==null)return S;let at=_.statusText||"OK",mt=new Su(_.getAllResponseHeaders()),Mt=Z$(_)||n.url;return S=new NS({headers:mt,status:_.status,statusText:at,url:Mt}),S},L=()=>{let{headers:at,status:mt,statusText:Mt,url:Lt}=I(),Pt=null;mt!==Lv.NoContent&&(Pt=typeof _.response>"u"?_.responseText:_.response),mt===0&&(mt=Pt?Lv.Ok:0);let Nt=mt>=200&&mt<300;if(n.responseType==="json"&&typeof Pt=="string"){let ue=Pt;Pt=Pt.replace(Y$,"");try{Pt=Pt!==""?JSON.parse(Pt):null}catch(Q){Pt=ue,Nt&&(Nt=!1,Pt={error:Q,text:Pt})}}Nt?(m.next(new im({body:Pt,headers:at,status:mt,statusText:Mt,url:Lt||void 0})),m.complete()):m.error(new Fv({error:Pt,headers:at,status:mt,statusText:Mt,url:Lt||void 0}))},H=at=>{let{url:mt}=I(),Mt=new Fv({error:at,status:_.status||0,statusText:_.statusText||"Unknown Error",url:mt||void 0});m.error(Mt)},q=!1,X=at=>{q||(m.next(I()),q=!0);let mt={type:em.DownloadProgress,loaded:at.loaded};at.lengthComputable&&(mt.total=at.total),n.responseType==="text"&&_.responseText&&(mt.partialText=_.responseText),m.next(mt)},it=at=>{let mt={type:em.UploadProgress,loaded:at.loaded};at.lengthComputable&&(mt.total=at.total),m.next(mt)};return _.addEventListener("load",L),_.addEventListener("error",H),_.addEventListener("timeout",H),_.addEventListener("abort",H),n.reportProgress&&(_.addEventListener("progress",X),w!==null&&_.upload&&_.upload.addEventListener("progress",it)),_.send(w),m.next({type:em.Sent}),()=>{_.removeEventListener("error",H),_.removeEventListener("abort",H),_.removeEventListener("load",L),_.removeEventListener("timeout",H),n.reportProgress&&(_.removeEventListener("progress",X),w!==null&&_.upload&&_.upload.removeEventListener("progress",it)),_.readyState!==_.DONE&&_.abort()}})))}};r.\u0275fac=function(s){return new(s||r)(ht(Tv))},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})(),xL=new Se(""),X$="XSRF-TOKEN",K$=new Se("",{providedIn:"root",factory:()=>X$}),Q$="X-XSRF-TOKEN",J$=new Se("",{providedIn:"root",factory:()=>Q$}),zv=class{},t7=(()=>{let r=class r{constructor(n,s,d){this.doc=n,this.platform=s,this.cookieName=d,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let n=this.doc.cookie||"";return n!==this.lastCookieString&&(this.parseCount++,this.lastToken=Mv(n,this.cookieName),this.lastCookieString=n),this.lastToken}};r.\u0275fac=function(s){return new(s||r)(ht(ci),ht(Cc),ht(K$))},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})();function e7(a,r){let l=a.url.toLowerCase();if(!le(xL)||a.method==="GET"||a.method==="HEAD"||l.startsWith("http://")||l.startsWith("https://"))return r(a);let n=le(zv).getToken(),s=le(J$);return n!=null&&!a.headers.has(s)&&(a=a.clone({headers:a.headers.set(s,n)})),r(a)}var wL=function(a){return a[a.Interceptors=0]="Interceptors",a[a.LegacyInterceptors=1]="LegacyInterceptors",a[a.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",a[a.NoXsrfProtection=3]="NoXsrfProtection",a[a.JsonpSupport=4]="JsonpSupport",a[a.RequestsMadeViaParent=5]="RequestsMadeViaParent",a[a.Fetch=6]="Fetch",a}(wL||{});function i7(a,r){return{\u0275kind:a,\u0275providers:r}}function CL(...a){let r=[Hi,vL,_L,{provide:Mf,useExisting:_L},{provide:Ov,useExisting:vL},{provide:VS,useValue:e7,multi:!0},{provide:xL,useValue:!0},{provide:zv,useClass:t7}];for(let l of a)r.push(...l.\u0275providers);return yu(r)}var yL=new Se("");function SL(){return i7(wL.LegacyInterceptors,[{provide:yL,useFactory:$$},{provide:VS,useExisting:yL,multi:!0}])}var HS=class extends rL{constructor(){super(...arguments),this.supportsDOMEvents=!0}},GS=class a extends HS{static makeCurrent(){nL(new a)}onAndCancel(r,l,n){return r.addEventListener(l,n),()=>{r.removeEventListener(l,n)}}dispatchEvent(r,l){r.dispatchEvent(l)}remove(r){r.parentNode&&r.parentNode.removeChild(r)}createElement(r,l){return l=l||this.getDefaultDocument(),l.createElement(r)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(r){return r.nodeType===Node.ELEMENT_NODE}isShadowRoot(r){return r instanceof DocumentFragment}getGlobalEventTarget(r,l){return l==="window"?window:l==="document"?r:l==="body"?r.body:null}getBaseHref(r){let l=r7();return l==null?null:o7(l)}resetBaseElement(){Tf=null}getUserAgent(){return window.navigator.userAgent}getCookie(r){return Mv(document.cookie,r)}},Tf=null;function r7(){return Tf=Tf||document.querySelector("base"),Tf?Tf.getAttribute("href"):null}function o7(a){return new URL(a,document.baseURI).pathname}var s7=(()=>{let r=class r{build(){return new XMLHttpRequest}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})(),qS=new Se(""),DL=(()=>{let r=class r{constructor(n,s){this._zone=s,this._eventNameToPlugin=new Map,n.forEach(d=>{d.manager=this}),this._plugins=n.slice().reverse()}addEventListener(n,s,d){return this._findPluginFor(s).addEventListener(n,s,d)}getZone(){return this._zone}_findPluginFor(n){let s=this._eventNameToPlugin.get(n);if(s)return s;if(s=this._plugins.find(m=>m.supports(n)),!s)throw new dr(5101,!1);return this._eventNameToPlugin.set(n,s),s}};r.\u0275fac=function(s){return new(s||r)(ht(qS),ht(Be))},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})(),Nv=class{constructor(r){this._doc=r}},jS="ng-app-id",TL=(()=>{let r=class r{constructor(n,s,d,m={}){this.doc=n,this.appId=s,this.nonce=d,this.platformId=m,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=OS(m),this.resetHostNodes()}addStyles(n){for(let s of n)this.changeUsageCount(s,1)===1&&this.onStyleAdded(s)}removeStyles(n){for(let s of n)this.changeUsageCount(s,-1)<=0&&this.onStyleRemoved(s)}ngOnDestroy(){let n=this.styleNodesInDOM;n&&(n.forEach(s=>s.remove()),n.clear());for(let s of this.getAllStyles())this.onStyleRemoved(s);this.resetHostNodes()}addHost(n){this.hostNodes.add(n);for(let s of this.getAllStyles())this.addStyleToHost(n,s)}removeHost(n){this.hostNodes.delete(n)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(n){for(let s of this.hostNodes)this.addStyleToHost(s,n)}onStyleRemoved(n){let s=this.styleRef;s.get(n)?.elements?.forEach(d=>d.remove()),s.delete(n)}collectServerRenderedStyles(){let n=this.doc.head?.querySelectorAll(`style[${jS}="${this.appId}"]`);if(n?.length){let s=new Map;return n.forEach(d=>{d.textContent!=null&&s.set(d.textContent,d)}),s}return null}changeUsageCount(n,s){let d=this.styleRef;if(d.has(n)){let m=d.get(n);return m.usage+=s,m.usage}return d.set(n,{usage:s,elements:[]}),s}getStyleElement(n,s){let d=this.styleNodesInDOM,m=d?.get(s);if(m?.parentNode===n)return d.delete(s),m.removeAttribute(jS),m;{let _=this.doc.createElement("style");return this.nonce&&_.setAttribute("nonce",this.nonce),_.textContent=s,this.platformIsServer&&_.setAttribute(jS,this.appId),n.appendChild(_),_}}addStyleToHost(n,s){let d=this.getStyleElement(n,s),m=this.styleRef,_=m.get(s)?.elements;_?_.push(d):m.set(s,{elements:[d],usage:1})}resetHostNodes(){let n=this.hostNodes;n.clear(),n.add(this.doc.head)}};r.\u0275fac=function(s){return new(s||r)(ht(ci),ht(yf),ht(bf,8),ht(Cc))},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})(),US={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},YS=/%COMP%/g,IL="%COMP%",a7=`_nghost-${IL}`,l7=`_ngcontent-${IL}`,c7=!0,d7=new Se("",{providedIn:"root",factory:()=>c7});function u7(a){return l7.replace(YS,a)}function h7(a){return a7.replace(YS,a)}function AL(a,r){return r.map(l=>l.replace(YS,a))}var nm=(()=>{let r=class r{constructor(n,s,d,m,_,w,S,I=null){this.eventManager=n,this.sharedStylesHost=s,this.appId=d,this.removeStylesOnCompDestroy=m,this.doc=_,this.platformId=w,this.ngZone=S,this.nonce=I,this.rendererByCompId=new Map,this.platformIsServer=OS(w),this.defaultRenderer=new If(n,_,S,this.platformIsServer)}createRenderer(n,s){if(!n||!s)return this.defaultRenderer;this.platformIsServer&&s.encapsulation===_f.ShadowDom&&(s=Pi(qt({},s),{encapsulation:_f.Emulated}));let d=this.getOrCreateRenderer(n,s);return d instanceof Bv?d.applyToHost(n):d instanceof Af&&d.applyStyles(),d}getOrCreateRenderer(n,s){let d=this.rendererByCompId,m=d.get(s.id);if(!m){let _=this.doc,w=this.ngZone,S=this.eventManager,I=this.sharedStylesHost,L=this.removeStylesOnCompDestroy,H=this.platformIsServer;switch(s.encapsulation){case _f.Emulated:m=new Bv(S,I,s,this.appId,L,_,w,H);break;case _f.ShadowDom:return new WS(S,I,n,s,_,w,this.nonce,H);default:m=new Af(S,I,s,L,_,w,H);break}d.set(s.id,m)}return m}ngOnDestroy(){this.rendererByCompId.clear()}};r.\u0275fac=function(s){return new(s||r)(ht(DL),ht(TL),ht(yf),ht(d7),ht(ci),ht(Cc),ht(Be),ht(bf))},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})(),If=class{constructor(r,l,n,s){this.eventManager=r,this.doc=l,this.ngZone=n,this.platformIsServer=s,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(r,l){return l?this.doc.createElementNS(US[l]||l,r):this.doc.createElement(r)}createComment(r){return this.doc.createComment(r)}createText(r){return this.doc.createTextNode(r)}appendChild(r,l){(EL(r)?r.content:r).appendChild(l)}insertBefore(r,l,n){r&&(EL(r)?r.content:r).insertBefore(l,n)}removeChild(r,l){r&&r.removeChild(l)}selectRootElement(r,l){let n=typeof r=="string"?this.doc.querySelector(r):r;if(!n)throw new dr(-5104,!1);return l||(n.textContent=""),n}parentNode(r){return r.parentNode}nextSibling(r){return r.nextSibling}setAttribute(r,l,n,s){if(s){l=s+":"+l;let d=US[s];d?r.setAttributeNS(d,l,n):r.setAttribute(l,n)}else r.setAttribute(l,n)}removeAttribute(r,l,n){if(n){let s=US[n];s?r.removeAttributeNS(s,l):r.removeAttribute(`${n}:${l}`)}else r.removeAttribute(l)}addClass(r,l){r.classList.add(l)}removeClass(r,l){r.classList.remove(l)}setStyle(r,l,n,s){s&(xf.DashCase|xf.Important)?r.style.setProperty(l,n,s&xf.Important?"important":""):r.style[l]=n}removeStyle(r,l,n){n&xf.DashCase?r.style.removeProperty(l):r.style[l]=""}setProperty(r,l,n){r!=null&&(r[l]=n)}setValue(r,l){r.nodeValue=l}listen(r,l,n){if(typeof r=="string"&&(r=tm().getGlobalEventTarget(this.doc,r),!r))throw new Error(`Unsupported event target ${r} for event ${l}`);return this.eventManager.addEventListener(r,l,this.decoratePreventDefault(n))}decoratePreventDefault(r){return l=>{if(l==="__ngUnwrap__")return r;(this.platformIsServer?this.ngZone.runGuarded(()=>r(l)):r(l))===!1&&l.preventDefault()}}};function EL(a){return a.tagName==="TEMPLATE"&&a.content!==void 0}var WS=class extends If{constructor(r,l,n,s,d,m,_,w){super(r,d,m,w),this.sharedStylesHost=l,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let S=AL(s.id,s.styles);for(let I of S){let L=document.createElement("style");_&&L.setAttribute("nonce",_),L.textContent=I,this.shadowRoot.appendChild(L)}}nodeOrShadowRoot(r){return r===this.hostEl?this.shadowRoot:r}appendChild(r,l){return super.appendChild(this.nodeOrShadowRoot(r),l)}insertBefore(r,l,n){return super.insertBefore(this.nodeOrShadowRoot(r),l,n)}removeChild(r,l){return super.removeChild(this.nodeOrShadowRoot(r),l)}parentNode(r){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(r)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Af=class extends If{constructor(r,l,n,s,d,m,_,w){super(r,d,m,_),this.sharedStylesHost=l,this.removeStylesOnCompDestroy=s,this.styles=w?AL(w,n.styles):n.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},Bv=class extends Af{constructor(r,l,n,s,d,m,_,w){let S=s+"-"+n.id;super(r,l,n,d,m,_,w,S),this.contentAttr=u7(S),this.hostAttr=h7(S)}applyToHost(r){this.applyStyles(),this.setAttribute(r,this.hostAttr,"")}createElement(r,l){let n=super.createElement(r,l);return super.setAttribute(n,this.contentAttr,""),n}},m7=(()=>{let r=class r extends Nv{constructor(n){super(n)}supports(n){return!0}addEventListener(n,s,d){return n.addEventListener(s,d,!1),()=>this.removeEventListener(n,s,d)}removeEventListener(n,s,d){return n.removeEventListener(s,d)}};r.\u0275fac=function(s){return new(s||r)(ht(ci))},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})(),ML=["alt","control","meta","shift"],p7={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},f7={alt:a=>a.altKey,control:a=>a.ctrlKey,meta:a=>a.metaKey,shift:a=>a.shiftKey},g7=(()=>{let r=class r extends Nv{constructor(n){super(n)}supports(n){return r.parseEventName(n)!=null}addEventListener(n,s,d){let m=r.parseEventName(s),_=r.eventCallback(m.fullKey,d,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>tm().onAndCancel(n,m.domEventName,_))}static parseEventName(n){let s=n.toLowerCase().split("."),d=s.shift();if(s.length===0||!(d==="keydown"||d==="keyup"))return null;let m=r._normalizeKey(s.pop()),_="",w=s.indexOf("code");if(w>-1&&(s.splice(w,1),_="code."),ML.forEach(I=>{let L=s.indexOf(I);L>-1&&(s.splice(L,1),_+=I+".")}),_+=m,s.length!=0||m.length===0)return null;let S={};return S.domEventName=d,S.fullKey=_,S}static matchEventFullKeyCode(n,s){let d=p7[n.key]||n.key,m="";return s.indexOf("code.")>-1&&(d=n.code,m="code."),d==null||!d?!1:(d=d.toLowerCase(),d===" "?d="space":d==="."&&(d="dot"),ML.forEach(_=>{if(_!==d){let w=f7[_];w(n)&&(m+=_+".")}}),m+=d,m===s)}static eventCallback(n,s,d){return m=>{r.matchEventFullKeyCode(m,n)&&d.runGuarded(()=>s(m))}}static _normalizeKey(n){return n==="esc"?"escape":n}};r.\u0275fac=function(s){return new(s||r)(ht(ci))},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})();function kL(a,r){return iL(qt({rootComponent:a},_7(r)))}function _7(a){return{appProviders:[...w7,...a?.providers??[]],platformProviders:x7}}function v7(){GS.makeCurrent()}function y7(){return new bu}function b7(){return NF(document),document}var x7=[{provide:Cc,useValue:aL},{provide:VF,useValue:v7,multi:!0},{provide:ci,useFactory:b7,deps:[]}];var w7=[{provide:jF,useValue:"root"},{provide:bu,useFactory:y7,deps:[]},{provide:qS,useClass:m7,multi:!0,deps:[ci,Be,Cc]},{provide:qS,useClass:g7,multi:!0,deps:[ci]},nm,TL,DL,{provide:Yh,useExisting:nm},{provide:Tv,useClass:s7,deps:[]},[]];var RL=(()=>{let r=class r{constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}};r.\u0275fac=function(s){return new(s||r)(ht(ci))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var ZS=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:function(s){let d=null;return s?d=new(s||r):d=ht(C7),d},providedIn:"root"});let a=r;return a})(),C7=(()=>{let r=class r extends ZS{constructor(n){super(),this._doc=n}sanitize(n,s){if(s==null)return null;switch(n){case Qs.NONE:return s;case Qs.HTML:return $h(s,"HTML")?Wh(s):YF(this._doc,String(s)).toString();case Qs.STYLE:return $h(s,"Style")?Wh(s):s;case Qs.SCRIPT:if($h(s,"Script"))return Wh(s);throw new dr(5200,!1);case Qs.URL:return $h(s,"URL")?Wh(s):$F(String(s));case Qs.RESOURCE_URL:if($h(s,"ResourceURL"))return Wh(s);throw new dr(5201,!1);default:throw new dr(5202,!1)}}bypassSecurityTrustHtml(n){return UF(n)}bypassSecurityTrustStyle(n){return HF(n)}bypassSecurityTrustScript(n){return GF(n)}bypassSecurityTrustUrl(n){return qF(n)}bypassSecurityTrustResourceUrl(n){return WF(n)}};r.\u0275fac=function(s){return new(s||r)(ht(ci))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var sn="primary",Gf=Symbol("RouteTitle"),tE=class{constructor(r){this.params=r||{}}has(r){return Object.prototype.hasOwnProperty.call(this.params,r)}get(r){if(this.has(r)){let l=this.params[r];return Array.isArray(l)?l[0]:l}return null}getAll(r){if(this.has(r)){let l=this.params[r];return Array.isArray(l)?l:[l]}return[]}get keys(){return Object.keys(this.params)}};function lm(a){return new tE(a)}function S7(a,r,l){let n=l.path.split("/");if(n.length>a.length||l.pathMatch==="full"&&(r.hasChildren()||n.length<a.length))return null;let s={};for(let d=0;d<n.length;d++){let m=n[d],_=a[d];if(m.startsWith(":"))s[m.substring(1)]=_;else if(m!==_.path)return null}return{consumed:a.slice(0,n.length),posParams:s}}function E7(a,r){if(a.length!==r.length)return!1;for(let l=0;l<a.length;++l)if(!jl(a[l],r[l]))return!1;return!0}function jl(a,r){let l=a?eE(a):void 0,n=r?eE(r):void 0;if(!l||!n||l.length!=n.length)return!1;let s;for(let d=0;d<l.length;d++)if(s=l[d],!BL(a[s],r[s]))return!1;return!0}function eE(a){return[...Object.keys(a),...Object.getOwnPropertySymbols(a)]}function BL(a,r){if(Array.isArray(a)&&Array.isArray(r)){if(a.length!==r.length)return!1;let l=[...a].sort(),n=[...r].sort();return l.every((s,d)=>n[d]===s)}else return a===r}function VL(a){return a.length>0?a[a.length-1]:null}function vd(a){return Hh(a)?a:Ev(a)?Oo(Promise.resolve(a)):Fe(a)}var M7={exact:UL,subset:HL},jL={exact:D7,subset:T7,ignored:()=>!0};function OL(a,r,l){return M7[l.paths](a.root,r.root,l.matrixParams)&&jL[l.queryParams](a.queryParams,r.queryParams)&&!(l.fragment==="exact"&&a.fragment!==r.fragment)}function D7(a,r){return jl(a,r)}function UL(a,r,l){if(!Du(a.segments,r.segments)||!Uv(a.segments,r.segments,l)||a.numberOfChildren!==r.numberOfChildren)return!1;for(let n in r.children)if(!a.children[n]||!UL(a.children[n],r.children[n],l))return!1;return!0}function T7(a,r){return Object.keys(r).length<=Object.keys(a).length&&Object.keys(r).every(l=>BL(a[l],r[l]))}function HL(a,r,l){return GL(a,r,r.segments,l)}function GL(a,r,l,n){if(a.segments.length>l.length){let s=a.segments.slice(0,l.length);return!(!Du(s,l)||r.hasChildren()||!Uv(s,l,n))}else if(a.segments.length===l.length){if(!Du(a.segments,l)||!Uv(a.segments,l,n))return!1;for(let s in r.children)if(!a.children[s]||!HL(a.children[s],r.children[s],n))return!1;return!0}else{let s=l.slice(0,a.segments.length),d=l.slice(a.segments.length);return!Du(a.segments,s)||!Uv(a.segments,s,n)||!a.children[sn]?!1:GL(a.children[sn],r,d,n)}}function Uv(a,r,l){return r.every((n,s)=>jL[l](a[s].parameters,n.parameters))}var gd=class{constructor(r=new ar([],{}),l={},n=null){this.root=r,this.queryParams=l,this.fragment=n}get queryParamMap(){return this._queryParamMap??=lm(this.queryParams),this._queryParamMap}toString(){return k7.serialize(this)}},ar=class{constructor(r,l){this.segments=r,this.children=l,this.parent=null,Object.values(l).forEach(n=>n.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Hv(this)}},Mu=class{constructor(r,l){this.path=r,this.parameters=l}get parameterMap(){return this._parameterMap??=lm(this.parameters),this._parameterMap}toString(){return WL(this)}};function I7(a,r){return Du(a,r)&&a.every((l,n)=>jl(l.parameters,r[n].parameters))}function Du(a,r){return a.length!==r.length?!1:a.every((l,n)=>l.path===r[n].path)}function A7(a,r){let l=[];return Object.entries(a.children).forEach(([n,s])=>{n===sn&&(l=l.concat(r(s,n)))}),Object.entries(a.children).forEach(([n,s])=>{n!==sn&&(l=l.concat(r(s,n)))}),l}var DE=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:()=>new qv,providedIn:"root"});let a=r;return a})(),qv=class{parse(r){let l=new nE(r);return new gd(l.parseRootSegment(),l.parseQueryParams(),l.parseFragment())}serialize(r){let l=`/${kf(r.root,!0)}`,n=O7(r.queryParams),s=typeof r.fragment=="string"?`#${R7(r.fragment)}`:"";return`${l}${n}${s}`}},k7=new qv;function Hv(a){return a.segments.map(r=>WL(r)).join("/")}function kf(a,r){if(!a.hasChildren())return Hv(a);if(r){let l=a.children[sn]?kf(a.children[sn],!1):"",n=[];return Object.entries(a.children).forEach(([s,d])=>{s!==sn&&n.push(`${s}:${kf(d,!1)}`)}),n.length>0?`${l}(${n.join("//")})`:l}else{let l=A7(a,(n,s)=>s===sn?[kf(a.children[sn],!1)]:[`${s}:${kf(n,!1)}`]);return Object.keys(a.children).length===1&&a.children[sn]!=null?`${Hv(a)}/${l[0]}`:`${Hv(a)}/(${l.join("//")})`}}function qL(a){return encodeURIComponent(a).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Vv(a){return qL(a).replace(/%3B/gi,";")}function R7(a){return encodeURI(a)}function iE(a){return qL(a).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Gv(a){return decodeURIComponent(a)}function FL(a){return Gv(a.replace(/\+/g,"%20"))}function WL(a){return`${iE(a.path)}${P7(a.parameters)}`}function P7(a){return Object.entries(a).map(([r,l])=>`;${iE(r)}=${iE(l)}`).join("")}function O7(a){let r=Object.entries(a).map(([l,n])=>Array.isArray(n)?n.map(s=>`${Vv(l)}=${Vv(s)}`).join("&"):`${Vv(l)}=${Vv(n)}`).filter(l=>l);return r.length?`?${r.join("&")}`:""}var F7=/^[^\/()?;#]+/;function XS(a){let r=a.match(F7);return r?r[0]:""}var L7=/^[^\/()?;=#]+/;function z7(a){let r=a.match(L7);return r?r[0]:""}var N7=/^[^=?&#]+/;function B7(a){let r=a.match(N7);return r?r[0]:""}var V7=/^[^&#]+/;function j7(a){let r=a.match(V7);return r?r[0]:""}var nE=class{constructor(r){this.url=r,this.remaining=r}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new ar([],{}):new ar([],this.parseChildren())}parseQueryParams(){let r={};if(this.consumeOptional("?"))do this.parseQueryParam(r);while(this.consumeOptional("&"));return r}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let r=[];for(this.peekStartsWith("(")||r.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),r.push(this.parseSegment());let l={};this.peekStartsWith("/(")&&(this.capture("/"),l=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(r.length>0||Object.keys(l).length>0)&&(n[sn]=new ar(r,l)),n}parseSegment(){let r=XS(this.remaining);if(r===""&&this.peekStartsWith(";"))throw new dr(4009,!1);return this.capture(r),new Mu(Gv(r),this.parseMatrixParams())}parseMatrixParams(){let r={};for(;this.consumeOptional(";");)this.parseParam(r);return r}parseParam(r){let l=z7(this.remaining);if(!l)return;this.capture(l);let n="";if(this.consumeOptional("=")){let s=XS(this.remaining);s&&(n=s,this.capture(n))}r[Gv(l)]=Gv(n)}parseQueryParam(r){let l=B7(this.remaining);if(!l)return;this.capture(l);let n="";if(this.consumeOptional("=")){let m=j7(this.remaining);m&&(n=m,this.capture(n))}let s=FL(l),d=FL(n);if(r.hasOwnProperty(s)){let m=r[s];Array.isArray(m)||(m=[m],r[s]=m),m.push(d)}else r[s]=d}parseParens(r){let l={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let n=XS(this.remaining),s=this.remaining[n.length];if(s!=="/"&&s!==")"&&s!==";")throw new dr(4010,!1);let d;n.indexOf(":")>-1?(d=n.slice(0,n.indexOf(":")),this.capture(d),this.capture(":")):r&&(d=sn);let m=this.parseChildren();l[d]=Object.keys(m).length===1?m[sn]:new ar([],m),this.consumeOptional("//")}return l}peekStartsWith(r){return this.remaining.startsWith(r)}consumeOptional(r){return this.peekStartsWith(r)?(this.remaining=this.remaining.substring(r.length),!0):!1}capture(r){if(!this.consumeOptional(r))throw new dr(4011,!1)}};function $L(a){return a.segments.length>0?new ar([],{[sn]:a}):a}function YL(a){let r={};for(let[n,s]of Object.entries(a.children)){let d=YL(s);if(n===sn&&d.segments.length===0&&d.hasChildren())for(let[m,_]of Object.entries(d.children))r[m]=_;else(d.segments.length>0||d.hasChildren())&&(r[n]=d)}let l=new ar(a.segments,r);return U7(l)}function U7(a){if(a.numberOfChildren===1&&a.children[sn]){let r=a.children[sn];return new ar(a.segments.concat(r.segments),r.children)}return a}function cm(a){return a instanceof gd}function H7(a,r,l=null,n=null){let s=ZL(a);return XL(s,r,l,n)}function ZL(a){let r;function l(d){let m={};for(let w of d.children){let S=l(w);m[w.outlet]=S}let _=new ar(d.url,m);return d===a&&(r=_),_}let n=l(a.root),s=$L(n);return r??s}function XL(a,r,l,n){let s=a;for(;s.parent;)s=s.parent;if(r.length===0)return KS(s,s,s,l,n);let d=G7(r);if(d.toRoot())return KS(s,s,new ar([],{}),l,n);let m=q7(d,s,a),_=m.processChildren?Of(m.segmentGroup,m.index,d.commands):QL(m.segmentGroup,m.index,d.commands);return KS(s,m.segmentGroup,_,l,n)}function Wv(a){return typeof a=="object"&&a!=null&&!a.outlets&&!a.segmentPath}function zf(a){return typeof a=="object"&&a!=null&&a.outlets}function KS(a,r,l,n,s){let d={};n&&Object.entries(n).forEach(([w,S])=>{d[w]=Array.isArray(S)?S.map(I=>`${I}`):`${S}`});let m;a===r?m=l:m=KL(a,r,l);let _=$L(YL(m));return new gd(_,d,s)}function KL(a,r,l){let n={};return Object.entries(a.children).forEach(([s,d])=>{d===r?n[s]=l:n[s]=KL(d,r,l)}),new ar(a.segments,n)}var $v=class{constructor(r,l,n){if(this.isAbsolute=r,this.numberOfDoubleDots=l,this.commands=n,r&&n.length>0&&Wv(n[0]))throw new dr(4003,!1);let s=n.find(zf);if(s&&s!==VL(n))throw new dr(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function G7(a){if(typeof a[0]=="string"&&a.length===1&&a[0]==="/")return new $v(!0,0,a);let r=0,l=!1,n=a.reduce((s,d,m)=>{if(typeof d=="object"&&d!=null){if(d.outlets){let _={};return Object.entries(d.outlets).forEach(([w,S])=>{_[w]=typeof S=="string"?S.split("/"):S}),[...s,{outlets:_}]}if(d.segmentPath)return[...s,d.segmentPath]}return typeof d!="string"?[...s,d]:m===0?(d.split("/").forEach((_,w)=>{w==0&&_==="."||(w==0&&_===""?l=!0:_===".."?r++:_!=""&&s.push(_))}),s):[...s,d]},[]);return new $v(l,r,n)}var sm=class{constructor(r,l,n){this.segmentGroup=r,this.processChildren=l,this.index=n}};function q7(a,r,l){if(a.isAbsolute)return new sm(r,!0,0);if(!l)return new sm(r,!1,NaN);if(l.parent===null)return new sm(l,!0,0);let n=Wv(a.commands[0])?0:1,s=l.segments.length-1+n;return W7(l,s,a.numberOfDoubleDots)}function W7(a,r,l){let n=a,s=r,d=l;for(;d>s;){if(d-=s,n=n.parent,!n)throw new dr(4005,!1);s=n.segments.length}return new sm(n,!1,s-d)}function $7(a){return zf(a[0])?a[0].outlets:{[sn]:a}}function QL(a,r,l){if(a??=new ar([],{}),a.segments.length===0&&a.hasChildren())return Of(a,r,l);let n=Y7(a,r,l),s=l.slice(n.commandIndex);if(n.match&&n.pathIndex<a.segments.length){let d=new ar(a.segments.slice(0,n.pathIndex),{});return d.children[sn]=new ar(a.segments.slice(n.pathIndex),a.children),Of(d,0,s)}else return n.match&&s.length===0?new ar(a.segments,{}):n.match&&!a.hasChildren()?rE(a,r,l):n.match?Of(a,0,s):rE(a,r,l)}function Of(a,r,l){if(l.length===0)return new ar(a.segments,{});{let n=$7(l),s={};if(Object.keys(n).some(d=>d!==sn)&&a.children[sn]&&a.numberOfChildren===1&&a.children[sn].segments.length===0){let d=Of(a.children[sn],r,l);return new ar(a.segments,d.children)}return Object.entries(n).forEach(([d,m])=>{typeof m=="string"&&(m=[m]),m!==null&&(s[d]=QL(a.children[d],r,m))}),Object.entries(a.children).forEach(([d,m])=>{n[d]===void 0&&(s[d]=m)}),new ar(a.segments,s)}}function Y7(a,r,l){let n=0,s=r,d={match:!1,pathIndex:0,commandIndex:0};for(;s<a.segments.length;){if(n>=l.length)return d;let m=a.segments[s],_=l[n];if(zf(_))break;let w=`${_}`,S=n<l.length-1?l[n+1]:null;if(s>0&&w===void 0)break;if(w&&S&&typeof S=="object"&&S.outlets===void 0){if(!zL(w,S,m))return d;n+=2}else{if(!zL(w,{},m))return d;n++}s++}return{match:!0,pathIndex:s,commandIndex:n}}function rE(a,r,l){let n=a.segments.slice(0,r),s=0;for(;s<l.length;){let d=l[s];if(zf(d)){let w=Z7(d.outlets);return new ar(n,w)}if(s===0&&Wv(l[0])){let w=a.segments[r];n.push(new Mu(w.path,LL(l[0]))),s++;continue}let m=zf(d)?d.outlets[sn]:`${d}`,_=s<l.length-1?l[s+1]:null;m&&_&&Wv(_)?(n.push(new Mu(m,LL(_))),s+=2):(n.push(new Mu(m,{})),s++)}return new ar(n,{})}function Z7(a){let r={};return Object.entries(a).forEach(([l,n])=>{typeof n=="string"&&(n=[n]),n!==null&&(r[l]=rE(new ar([],{}),0,n))}),r}function LL(a){let r={};return Object.entries(a).forEach(([l,n])=>r[l]=`${n}`),r}function zL(a,r,l){return a==l.path&&jl(r,l.parameters)}var Ff="imperative",Ko=function(a){return a[a.NavigationStart=0]="NavigationStart",a[a.NavigationEnd=1]="NavigationEnd",a[a.NavigationCancel=2]="NavigationCancel",a[a.NavigationError=3]="NavigationError",a[a.RoutesRecognized=4]="RoutesRecognized",a[a.ResolveStart=5]="ResolveStart",a[a.ResolveEnd=6]="ResolveEnd",a[a.GuardsCheckStart=7]="GuardsCheckStart",a[a.GuardsCheckEnd=8]="GuardsCheckEnd",a[a.RouteConfigLoadStart=9]="RouteConfigLoadStart",a[a.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",a[a.ChildActivationStart=11]="ChildActivationStart",a[a.ChildActivationEnd=12]="ChildActivationEnd",a[a.ActivationStart=13]="ActivationStart",a[a.ActivationEnd=14]="ActivationEnd",a[a.Scroll=15]="Scroll",a[a.NavigationSkipped=16]="NavigationSkipped",a}(Ko||{}),xa=class{constructor(r,l){this.id=r,this.url=l}},Mc=class extends xa{constructor(r,l,n="imperative",s=null){super(r,l),this.type=Ko.NavigationStart,this.navigationTrigger=n,this.restoredState=s}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},ps=class extends xa{constructor(r,l,n){super(r,l),this.urlAfterRedirects=n,this.type=Ko.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},ba=function(a){return a[a.Redirect=0]="Redirect",a[a.SupersededByNewNavigation=1]="SupersededByNewNavigation",a[a.NoDataFromResolver=2]="NoDataFromResolver",a[a.GuardRejected=3]="GuardRejected",a}(ba||{}),oE=function(a){return a[a.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",a[a.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",a}(oE||{}),_d=class extends xa{constructor(r,l,n,s){super(r,l),this.reason=n,this.code=s,this.type=Ko.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Tu=class extends xa{constructor(r,l,n,s){super(r,l),this.reason=n,this.code=s,this.type=Ko.NavigationSkipped}},Nf=class extends xa{constructor(r,l,n,s){super(r,l),this.error=n,this.target=s,this.type=Ko.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Yv=class extends xa{constructor(r,l,n,s){super(r,l),this.urlAfterRedirects=n,this.state=s,this.type=Ko.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},sE=class extends xa{constructor(r,l,n,s){super(r,l),this.urlAfterRedirects=n,this.state=s,this.type=Ko.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},aE=class extends xa{constructor(r,l,n,s,d){super(r,l),this.urlAfterRedirects=n,this.state=s,this.shouldActivate=d,this.type=Ko.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},lE=class extends xa{constructor(r,l,n,s){super(r,l),this.urlAfterRedirects=n,this.state=s,this.type=Ko.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},cE=class extends xa{constructor(r,l,n,s){super(r,l),this.urlAfterRedirects=n,this.state=s,this.type=Ko.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},dE=class{constructor(r){this.route=r,this.type=Ko.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},uE=class{constructor(r){this.route=r,this.type=Ko.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},hE=class{constructor(r){this.snapshot=r,this.type=Ko.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},mE=class{constructor(r){this.snapshot=r,this.type=Ko.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},pE=class{constructor(r){this.snapshot=r,this.type=Ko.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},fE=class{constructor(r){this.snapshot=r,this.type=Ko.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var Bf=class{},Vf=class{constructor(r){this.url=r}};var gE=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new ty,this.attachRef=null}},ty=(()=>{let r=class r{constructor(){this.contexts=new Map}onChildOutletCreated(n,s){let d=this.getOrCreateContext(n);d.outlet=s,this.contexts.set(n,d)}onChildOutletDestroyed(n){let s=this.getContext(n);s&&(s.outlet=null,s.attachRef=null)}onOutletDeactivated(){let n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let s=this.getContext(n);return s||(s=new gE,this.contexts.set(n,s)),s}getContext(n){return this.contexts.get(n)||null}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),Zv=class{constructor(r){this._root=r}get root(){return this._root.value}parent(r){let l=this.pathFromRoot(r);return l.length>1?l[l.length-2]:null}children(r){let l=_E(r,this._root);return l?l.children.map(n=>n.value):[]}firstChild(r){let l=_E(r,this._root);return l&&l.children.length>0?l.children[0].value:null}siblings(r){let l=vE(r,this._root);return l.length<2?[]:l[l.length-2].children.map(s=>s.value).filter(s=>s!==r)}pathFromRoot(r){return vE(r,this._root).map(l=>l.value)}};function _E(a,r){if(a===r.value)return r;for(let l of r.children){let n=_E(a,l);if(n)return n}return null}function vE(a,r){if(a===r.value)return[r];for(let l of r.children){let n=vE(a,l);if(n.length)return n.unshift(r),n}return[]}var ta=class{constructor(r,l){this.value=r,this.children=l}toString(){return`TreeNode(${this.value})`}};function om(a){let r={};return a&&a.children.forEach(l=>r[l.value.outlet]=l),r}var Xv=class extends Zv{constructor(r,l){super(r),this.snapshot=l,IE(this,r)}toString(){return this.snapshot.toString()}};function JL(a){let r=X7(a),l=new We([new Mu("",{})]),n=new We({}),s=new We({}),d=new We({}),m=new We(""),_=new Tn(l,n,d,m,s,sn,a,r.root);return _.snapshot=r.root,new Xv(new ta(_,[]),r)}function X7(a){let r={},l={},n={},s="",d=new jf([],r,n,s,l,sn,a,null,{});return new Kv("",new ta(d,[]))}var Tn=class{constructor(r,l,n,s,d,m,_,w){this.urlSubject=r,this.paramsSubject=l,this.queryParamsSubject=n,this.fragmentSubject=s,this.dataSubject=d,this.outlet=m,this.component=_,this._futureSnapshot=w,this.title=this.dataSubject?.pipe(Li(S=>S[Gf]))??Fe(void 0),this.url=r,this.params=l,this.queryParams=n,this.fragment=s,this.data=d}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Li(r=>lm(r))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Li(r=>lm(r))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function TE(a,r,l="emptyOnly"){let n,{routeConfig:s}=a;return r!==null&&(l==="always"||s?.path===""||!r.component&&!r.routeConfig?.loadComponent)?n={params:qt(qt({},r.params),a.params),data:qt(qt({},r.data),a.data),resolve:qt(qt(qt(qt({},a.data),r.data),s?.data),a._resolvedData)}:n={params:qt({},a.params),data:qt({},a.data),resolve:qt(qt({},a.data),a._resolvedData??{})},s&&e3(s)&&(n.resolve[Gf]=s.title),n}var jf=class{get title(){return this.data?.[Gf]}constructor(r,l,n,s,d,m,_,w,S){this.url=r,this.params=l,this.queryParams=n,this.fragment=s,this.data=d,this.outlet=m,this.component=_,this.routeConfig=w,this._resolve=S}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=lm(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=lm(this.queryParams),this._queryParamMap}toString(){let r=this.url.map(n=>n.toString()).join("/"),l=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${r}', path:'${l}')`}},Kv=class extends Zv{constructor(r,l){super(l),this.url=r,IE(this,l)}toString(){return t3(this._root)}};function IE(a,r){r.value._routerState=a,r.children.forEach(l=>IE(a,l))}function t3(a){let r=a.children.length>0?` { ${a.children.map(t3).join(", ")} } `:"";return`${a.value}${r}`}function QS(a){if(a.snapshot){let r=a.snapshot,l=a._futureSnapshot;a.snapshot=l,jl(r.queryParams,l.queryParams)||a.queryParamsSubject.next(l.queryParams),r.fragment!==l.fragment&&a.fragmentSubject.next(l.fragment),jl(r.params,l.params)||a.paramsSubject.next(l.params),E7(r.url,l.url)||a.urlSubject.next(l.url),jl(r.data,l.data)||a.dataSubject.next(l.data)}else a.snapshot=a._futureSnapshot,a.dataSubject.next(a._futureSnapshot.data)}function yE(a,r){let l=jl(a.params,r.params)&&I7(a.url,r.url),n=!a.parent!=!r.parent;return l&&!n&&(!a.parent||yE(a.parent,r.parent))}function e3(a){return typeof a.title=="string"||a.title===null}var cl=(()=>{let r=class r{constructor(){this.activated=null,this._activatedRoute=null,this.name=sn,this.activateEvents=new ye,this.deactivateEvents=new ye,this.attachEvents=new ye,this.detachEvents=new ye,this.parentContexts=le(ty),this.location=le(Do),this.changeDetector=le(Zi),this.environmentInjector=le(qh),this.inputBinder=le(AE,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(n){if(n.name){let{firstChange:s,previousValue:d}=n.name;if(s)return;this.isTrackedInParentContexts(d)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(d)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(n){return this.parentContexts.getContext(n)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let n=this.parentContexts.getContext(this.name);n?.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new dr(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new dr(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new dr(4012,!1);this.location.detach();let n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,s){this.activated=n,this._activatedRoute=s,this.location.insert(n.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){let n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,s){if(this.isActivated)throw new dr(4013,!1);this._activatedRoute=n;let d=this.location,_=n.snapshot.component,w=this.parentContexts.getOrCreateContext(this.name).children,S=new bE(n,w,d.injector);this.activated=d.createComponent(_,{index:d.length,injector:S,environmentInjector:s??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};r.\u0275fac=function(s){return new(s||r)},r.\u0275dir=oe({type:r,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Yn]});let a=r;return a})(),bE=class{constructor(r,l,n){this.route=r,this.childContexts=l,this.parent=n}get(r,l){return r===Tn?this.route:r===ty?this.childContexts:this.parent.get(r,l)}},AE=new Se("");function K7(a,r,l){let n=Uf(a,r._root,l?l._root:void 0);return new Xv(n,r)}function Uf(a,r,l){if(l&&a.shouldReuseRoute(r.value,l.value.snapshot)){let n=l.value;n._futureSnapshot=r.value;let s=Q7(a,r,l);return new ta(n,s)}else{if(a.shouldAttach(r.value)){let d=a.retrieve(r.value);if(d!==null){let m=d.route;return m.value._futureSnapshot=r.value,m.children=r.children.map(_=>Uf(a,_)),m}}let n=J7(r.value),s=r.children.map(d=>Uf(a,d));return new ta(n,s)}}function Q7(a,r,l){return r.children.map(n=>{for(let s of l.children)if(a.shouldReuseRoute(n.value,s.value.snapshot))return Uf(a,n,s);return Uf(a,n)})}function J7(a){return new Tn(new We(a.url),new We(a.params),new We(a.queryParams),new We(a.fragment),new We(a.data),a.outlet,a.component,a)}var i3="ngNavigationCancelingError";function n3(a,r){let{redirectTo:l,navigationBehaviorOptions:n}=cm(r)?{redirectTo:r,navigationBehaviorOptions:void 0}:r,s=r3(!1,ba.Redirect);return s.url=l,s.navigationBehaviorOptions=n,s}function r3(a,r){let l=new Error(`NavigationCancelingError: ${a||""}`);return l[i3]=!0,l.cancellationCode=r,l}function t9(a){return o3(a)&&cm(a.url)}function o3(a){return!!a&&a[i3]}var e9=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=St({type:r,selectors:[["ng-component"]],standalone:!0,features:[At],decls:1,vars:0,template:function(s,d){s&1&&dt(0,"router-outlet")},dependencies:[cl],encapsulation:2});let a=r;return a})();function i9(a,r){return a.providers&&!a._injector&&(a._injector=QF(a.providers,r,`Route: ${a.path}`)),a._injector??r}function kE(a){let r=a.children&&a.children.map(kE),l=r?Pi(qt({},a),{children:r}):qt({},a);return!l.component&&!l.loadComponent&&(r||l.loadChildren)&&l.outlet&&l.outlet!==sn&&(l.component=e9),l}function Ul(a){return a.outlet||sn}function n9(a,r){let l=a.filter(n=>Ul(n)===r);return l.push(...a.filter(n=>Ul(n)!==r)),l}function qf(a){if(!a)return null;if(a.routeConfig?._injector)return a.routeConfig._injector;for(let r=a.parent;r;r=r.parent){let l=r.routeConfig;if(l?._loadedInjector)return l._loadedInjector;if(l?._injector)return l._injector}return null}var r9=(a,r,l,n)=>Li(s=>(new xE(r,s.targetRouterState,s.currentRouterState,l,n).activate(a),s)),xE=class{constructor(r,l,n,s,d){this.routeReuseStrategy=r,this.futureState=l,this.currState=n,this.forwardEvent=s,this.inputBindingEnabled=d}activate(r){let l=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(l,n,r),QS(this.futureState.root),this.activateChildRoutes(l,n,r)}deactivateChildRoutes(r,l,n){let s=om(l);r.children.forEach(d=>{let m=d.value.outlet;this.deactivateRoutes(d,s[m],n),delete s[m]}),Object.values(s).forEach(d=>{this.deactivateRouteAndItsChildren(d,n)})}deactivateRoutes(r,l,n){let s=r.value,d=l?l.value:null;if(s===d)if(s.component){let m=n.getContext(s.outlet);m&&this.deactivateChildRoutes(r,l,m.children)}else this.deactivateChildRoutes(r,l,n);else d&&this.deactivateRouteAndItsChildren(l,n)}deactivateRouteAndItsChildren(r,l){r.value.component&&this.routeReuseStrategy.shouldDetach(r.value.snapshot)?this.detachAndStoreRouteSubtree(r,l):this.deactivateRouteAndOutlet(r,l)}detachAndStoreRouteSubtree(r,l){let n=l.getContext(r.value.outlet),s=n&&r.value.component?n.children:l,d=om(r);for(let m of Object.values(d))this.deactivateRouteAndItsChildren(m,s);if(n&&n.outlet){let m=n.outlet.detach(),_=n.children.onOutletDeactivated();this.routeReuseStrategy.store(r.value.snapshot,{componentRef:m,route:r,contexts:_})}}deactivateRouteAndOutlet(r,l){let n=l.getContext(r.value.outlet),s=n&&r.value.component?n.children:l,d=om(r);for(let m of Object.values(d))this.deactivateRouteAndItsChildren(m,s);n&&(n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated()),n.attachRef=null,n.route=null)}activateChildRoutes(r,l,n){let s=om(l);r.children.forEach(d=>{this.activateRoutes(d,s[d.value.outlet],n),this.forwardEvent(new fE(d.value.snapshot))}),r.children.length&&this.forwardEvent(new mE(r.value.snapshot))}activateRoutes(r,l,n){let s=r.value,d=l?l.value:null;if(QS(s),s===d)if(s.component){let m=n.getOrCreateContext(s.outlet);this.activateChildRoutes(r,l,m.children)}else this.activateChildRoutes(r,l,n);else if(s.component){let m=n.getOrCreateContext(s.outlet);if(this.routeReuseStrategy.shouldAttach(s.snapshot)){let _=this.routeReuseStrategy.retrieve(s.snapshot);this.routeReuseStrategy.store(s.snapshot,null),m.children.onOutletReAttached(_.contexts),m.attachRef=_.componentRef,m.route=_.route.value,m.outlet&&m.outlet.attach(_.componentRef,_.route.value),QS(_.route.value),this.activateChildRoutes(r,null,m.children)}else{let _=qf(s.snapshot);m.attachRef=null,m.route=s,m.injector=_,m.outlet&&m.outlet.activateWith(s,m.injector),this.activateChildRoutes(r,null,m.children)}}else this.activateChildRoutes(r,null,n)}},Qv=class{constructor(r){this.path=r,this.route=this.path[this.path.length-1]}},am=class{constructor(r,l){this.component=r,this.route=l}};function o9(a,r,l){let n=a._root,s=r?r._root:null;return Rf(n,s,l,[n.value])}function s9(a){let r=a.routeConfig?a.routeConfig.canActivateChild:null;return!r||r.length===0?null:{node:a,guards:r}}function um(a,r){let l=Symbol(),n=r.get(a,l);return n===l?typeof a=="function"&&!BF(a)?a:r.get(a):n}function Rf(a,r,l,n,s={canDeactivateChecks:[],canActivateChecks:[]}){let d=om(r);return a.children.forEach(m=>{a9(m,d[m.value.outlet],l,n.concat([m.value]),s),delete d[m.value.outlet]}),Object.entries(d).forEach(([m,_])=>Lf(_,l.getContext(m),s)),s}function a9(a,r,l,n,s={canDeactivateChecks:[],canActivateChecks:[]}){let d=a.value,m=r?r.value:null,_=l?l.getContext(a.value.outlet):null;if(m&&d.routeConfig===m.routeConfig){let w=l9(m,d,d.routeConfig.runGuardsAndResolvers);w?s.canActivateChecks.push(new Qv(n)):(d.data=m.data,d._resolvedData=m._resolvedData),d.component?Rf(a,r,_?_.children:null,n,s):Rf(a,r,l,n,s),w&&_&&_.outlet&&_.outlet.isActivated&&s.canDeactivateChecks.push(new am(_.outlet.component,m))}else m&&Lf(r,_,s),s.canActivateChecks.push(new Qv(n)),d.component?Rf(a,null,_?_.children:null,n,s):Rf(a,null,l,n,s);return s}function l9(a,r,l){if(typeof l=="function")return l(a,r);switch(l){case"pathParamsChange":return!Du(a.url,r.url);case"pathParamsOrQueryParamsChange":return!Du(a.url,r.url)||!jl(a.queryParams,r.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!yE(a,r)||!jl(a.queryParams,r.queryParams);case"paramsChange":default:return!yE(a,r)}}function Lf(a,r,l){let n=om(a),s=a.value;Object.entries(n).forEach(([d,m])=>{s.component?r?Lf(m,r.children.getContext(d),l):Lf(m,null,l):Lf(m,r,l)}),s.component?r&&r.outlet&&r.outlet.isActivated?l.canDeactivateChecks.push(new am(r.outlet.component,s)):l.canDeactivateChecks.push(new am(null,s)):l.canDeactivateChecks.push(new am(null,s))}function Wf(a){return typeof a=="function"}function c9(a){return typeof a=="boolean"}function d9(a){return a&&Wf(a.canLoad)}function u9(a){return a&&Wf(a.canActivate)}function h9(a){return a&&Wf(a.canActivateChild)}function m9(a){return a&&Wf(a.canDeactivate)}function p9(a){return a&&Wf(a.canMatch)}function s3(a){return a instanceof AF||a?.name==="EmptyError"}var jv=Symbol("INITIAL_VALUE");function dm(){return ro(a=>xc(a.map(r=>r.pipe(tn(1),ho(jv)))).pipe(Li(r=>{for(let l of r)if(l!==!0){if(l===jv)return jv;if(l===!1||l instanceof gd)return l}return!0}),pn(r=>r!==jv),tn(1)))}function f9(a,r){return ks(l=>{let{targetSnapshot:n,currentSnapshot:s,guards:{canActivateChecks:d,canDeactivateChecks:m}}=l;return m.length===0&&d.length===0?Fe(Pi(qt({},l),{guardsResult:!0})):g9(m,n,s,a).pipe(ks(_=>_&&c9(_)?_9(n,d,a,r):Fe(_)),Li(_=>Pi(qt({},l),{guardsResult:_})))})}function g9(a,r,l,n){return Oo(a).pipe(ks(s=>w9(s.component,s.route,l,r,n)),Nl(s=>s!==!0,!0))}function _9(a,r,l,n){return Oo(r).pipe(gu(s=>pv(y9(s.route.parent,n),v9(s.route,n),x9(a,s.path,l),b9(a,s.route,l))),Nl(s=>s!==!0,!0))}function v9(a,r){return a!==null&&r&&r(new pE(a)),Fe(!0)}function y9(a,r){return a!==null&&r&&r(new hE(a)),Fe(!0)}function b9(a,r,l){let n=r.routeConfig?r.routeConfig.canActivate:null;if(!n||n.length===0)return Fe(!0);let s=n.map(d=>wc(()=>{let m=qf(r)??l,_=um(d,m),w=u9(_)?_.canActivate(r,a):Sc(m,()=>_(r,a));return vd(w).pipe(Nl())}));return Fe(s).pipe(dm())}function x9(a,r,l){let n=r[r.length-1],d=r.slice(0,r.length-1).reverse().map(m=>s9(m)).filter(m=>m!==null).map(m=>wc(()=>{let _=m.guards.map(w=>{let S=qf(m.node)??l,I=um(w,S),L=h9(I)?I.canActivateChild(n,a):Sc(S,()=>I(n,a));return vd(L).pipe(Nl())});return Fe(_).pipe(dm())}));return Fe(d).pipe(dm())}function w9(a,r,l,n,s){let d=r&&r.routeConfig?r.routeConfig.canDeactivate:null;if(!d||d.length===0)return Fe(!0);let m=d.map(_=>{let w=qf(r)??s,S=um(_,w),I=m9(S)?S.canDeactivate(a,r,l,n):Sc(w,()=>S(a,r,l,n));return vd(I).pipe(Nl())});return Fe(m).pipe(dm())}function C9(a,r,l,n){let s=r.canLoad;if(s===void 0||s.length===0)return Fe(!0);let d=s.map(m=>{let _=um(m,a),w=d9(_)?_.canLoad(r,l):Sc(a,()=>_(r,l));return vd(w)});return Fe(d).pipe(dm(),a3(n))}function a3(a){return IF($r(r=>{if(cm(r))throw n3(a,r)}),Li(r=>r===!0))}function S9(a,r,l,n){let s=r.canMatch;if(!s||s.length===0)return Fe(!0);let d=s.map(m=>{let _=um(m,a),w=p9(_)?_.canMatch(r,l):Sc(a,()=>_(r,l));return vd(w)});return Fe(d).pipe(dm(),a3(n))}var Hf=class{constructor(r){this.segmentGroup=r||null}},Jv=class extends Error{constructor(r){super(),this.urlTree=r}};function rm(a){return Ll(new Hf(a))}function E9(a){return Ll(new dr(4e3,!1))}function M9(a){return Ll(r3(!1,ba.GuardRejected))}var wE=class{constructor(r,l){this.urlSerializer=r,this.urlTree=l}lineralizeSegments(r,l){let n=[],s=l.root;for(;;){if(n=n.concat(s.segments),s.numberOfChildren===0)return Fe(n);if(s.numberOfChildren>1||!s.children[sn])return E9(r.redirectTo);s=s.children[sn]}}applyRedirectCommands(r,l,n){let s=this.applyRedirectCreateUrlTree(l,this.urlSerializer.parse(l),r,n);if(l.startsWith("/"))throw new Jv(s);return s}applyRedirectCreateUrlTree(r,l,n,s){let d=this.createSegmentGroup(r,l.root,n,s);return new gd(d,this.createQueryParams(l.queryParams,this.urlTree.queryParams),l.fragment)}createQueryParams(r,l){let n={};return Object.entries(r).forEach(([s,d])=>{if(typeof d=="string"&&d.startsWith(":")){let _=d.substring(1);n[s]=l[_]}else n[s]=d}),n}createSegmentGroup(r,l,n,s){let d=this.createSegments(r,l.segments,n,s),m={};return Object.entries(l.children).forEach(([_,w])=>{m[_]=this.createSegmentGroup(r,w,n,s)}),new ar(d,m)}createSegments(r,l,n,s){return l.map(d=>d.path.startsWith(":")?this.findPosParam(r,d,s):this.findOrReturn(d,n))}findPosParam(r,l,n){let s=n[l.path.substring(1)];if(!s)throw new dr(4001,!1);return s}findOrReturn(r,l){let n=0;for(let s of l){if(s.path===r.path)return l.splice(n),s;n++}return r}},CE={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function D9(a,r,l,n,s){let d=RE(a,r,l);return d.matched?(n=i9(r,n),S9(n,r,l,s).pipe(Li(m=>m===!0?d:qt({},CE)))):Fe(d)}function RE(a,r,l){if(r.path==="**")return T9(l);if(r.path==="")return r.pathMatch==="full"&&(a.hasChildren()||l.length>0)?qt({},CE):{matched:!0,consumedSegments:[],remainingSegments:l,parameters:{},positionalParamSegments:{}};let s=(r.matcher||S7)(l,a,r);if(!s)return qt({},CE);let d={};Object.entries(s.posParams??{}).forEach(([_,w])=>{d[_]=w.path});let m=s.consumed.length>0?qt(qt({},d),s.consumed[s.consumed.length-1].parameters):d;return{matched:!0,consumedSegments:s.consumed,remainingSegments:l.slice(s.consumed.length),parameters:m,positionalParamSegments:s.posParams??{}}}function T9(a){return{matched:!0,parameters:a.length>0?VL(a).parameters:{},consumedSegments:a,remainingSegments:[],positionalParamSegments:{}}}function NL(a,r,l,n){return l.length>0&&k9(a,l,n)?{segmentGroup:new ar(r,A9(n,new ar(l,a.children))),slicedSegments:[]}:l.length===0&&R9(a,l,n)?{segmentGroup:new ar(a.segments,I9(a,l,n,a.children)),slicedSegments:l}:{segmentGroup:new ar(a.segments,a.children),slicedSegments:l}}function I9(a,r,l,n){let s={};for(let d of l)if(ey(a,r,d)&&!n[Ul(d)]){let m=new ar([],{});s[Ul(d)]=m}return qt(qt({},n),s)}function A9(a,r){let l={};l[sn]=r;for(let n of a)if(n.path===""&&Ul(n)!==sn){let s=new ar([],{});l[Ul(n)]=s}return l}function k9(a,r,l){return l.some(n=>ey(a,r,n)&&Ul(n)!==sn)}function R9(a,r,l){return l.some(n=>ey(a,r,n))}function ey(a,r,l){return(a.hasChildren()||r.length>0)&&l.pathMatch==="full"?!1:l.path===""}function P9(a,r,l,n){return Ul(a)!==n&&(n===sn||!ey(r,l,a))?!1:RE(r,a,l).matched}function O9(a,r,l){return r.length===0&&!a.children[l]}var SE=class{};function F9(a,r,l,n,s,d,m="emptyOnly"){return new EE(a,r,l,n,s,m,d).recognize()}var L9=31,EE=class{constructor(r,l,n,s,d,m,_){this.injector=r,this.configLoader=l,this.rootComponentType=n,this.config=s,this.urlTree=d,this.paramsInheritanceStrategy=m,this.urlSerializer=_,this.applyRedirects=new wE(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(r){return new dr(4002,`'${r.segmentGroup}'`)}recognize(){let r=NL(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(r).pipe(Li(l=>{let n=new jf([],Object.freeze({}),Object.freeze(qt({},this.urlTree.queryParams)),this.urlTree.fragment,{},sn,this.rootComponentType,null,{}),s=new ta(n,l),d=new Kv("",s),m=H7(n,[],this.urlTree.queryParams,this.urlTree.fragment);return m.queryParams=this.urlTree.queryParams,d.url=this.urlSerializer.serialize(m),this.inheritParamsAndData(d._root,null),{state:d,tree:m}}))}match(r){return this.processSegmentGroup(this.injector,this.config,r,sn).pipe(zl(n=>{if(n instanceof Jv)return this.urlTree=n.urlTree,this.match(n.urlTree.root);throw n instanceof Hf?this.noMatchError(n):n}))}inheritParamsAndData(r,l){let n=r.value,s=TE(n,l,this.paramsInheritanceStrategy);n.params=Object.freeze(s.params),n.data=Object.freeze(s.data),r.children.forEach(d=>this.inheritParamsAndData(d,n))}processSegmentGroup(r,l,n,s){return n.segments.length===0&&n.hasChildren()?this.processChildren(r,l,n):this.processSegment(r,l,n,n.segments,s,!0).pipe(Li(d=>d instanceof ta?[d]:[]))}processChildren(r,l,n){let s=[];for(let d of Object.keys(n.children))d==="primary"?s.unshift(d):s.push(d);return Oo(s).pipe(gu(d=>{let m=n.children[d],_=n9(l,d);return this.processSegmentGroup(r,_,m,d)}),FF((d,m)=>(d.push(...m),d)),MS(null),PF(),ks(d=>{if(d===null)return rm(n);let m=l3(d);return z9(m),Fe(m)}))}processSegment(r,l,n,s,d,m){return Oo(l).pipe(gu(_=>this.processSegmentAgainstRoute(_._injector??r,l,_,n,s,d,m).pipe(zl(w=>{if(w instanceof Hf)return Fe(null);throw w}))),Nl(_=>!!_),zl(_=>{if(s3(_))return O9(n,s,d)?Fe(new SE):rm(n);throw _}))}processSegmentAgainstRoute(r,l,n,s,d,m,_){return P9(n,s,d,m)?n.redirectTo===void 0?this.matchSegmentAgainstRoute(r,s,n,d,m):this.allowRedirects&&_?this.expandSegmentAgainstRouteUsingRedirect(r,s,l,n,d,m):rm(s):rm(s)}expandSegmentAgainstRouteUsingRedirect(r,l,n,s,d,m){let{matched:_,consumedSegments:w,positionalParamSegments:S,remainingSegments:I}=RE(l,s,d);if(!_)return rm(l);s.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>L9&&(this.allowRedirects=!1));let L=this.applyRedirects.applyRedirectCommands(w,s.redirectTo,S);return this.applyRedirects.lineralizeSegments(s,L).pipe(ks(H=>this.processSegment(r,n,l,H.concat(I),m,!1)))}matchSegmentAgainstRoute(r,l,n,s,d){let m=D9(l,n,s,r,this.urlSerializer);return n.path==="**"&&(l.children={}),m.pipe(ro(_=>_.matched?(r=n._injector??r,this.getChildConfig(r,n,s).pipe(ro(({routes:w})=>{let S=n._loadedInjector??r,{consumedSegments:I,remainingSegments:L,parameters:H}=_,q=new jf(I,H,Object.freeze(qt({},this.urlTree.queryParams)),this.urlTree.fragment,B9(n),Ul(n),n.component??n._loadedComponent??null,n,V9(n)),{segmentGroup:X,slicedSegments:it}=NL(l,I,L,w);if(it.length===0&&X.hasChildren())return this.processChildren(S,w,X).pipe(Li(mt=>mt===null?null:new ta(q,mt)));if(w.length===0&&it.length===0)return Fe(new ta(q,[]));let at=Ul(n)===d;return this.processSegment(S,w,X,it,at?sn:d,!0).pipe(Li(mt=>new ta(q,mt instanceof ta?[mt]:[])))}))):rm(l)))}getChildConfig(r,l,n){return l.children?Fe({routes:l.children,injector:r}):l.loadChildren?l._loadedRoutes!==void 0?Fe({routes:l._loadedRoutes,injector:l._loadedInjector}):C9(r,l,n,this.urlSerializer).pipe(ks(s=>s?this.configLoader.loadChildren(r,l).pipe($r(d=>{l._loadedRoutes=d.routes,l._loadedInjector=d.injector})):M9(l))):Fe({routes:[],injector:r})}};function z9(a){a.sort((r,l)=>r.value.outlet===sn?-1:l.value.outlet===sn?1:r.value.outlet.localeCompare(l.value.outlet))}function N9(a){let r=a.value.routeConfig;return r&&r.path===""}function l3(a){let r=[],l=new Set;for(let n of a){if(!N9(n)){r.push(n);continue}let s=r.find(d=>n.value.routeConfig===d.value.routeConfig);s!==void 0?(s.children.push(...n.children),l.add(s)):r.push(n)}for(let n of l){let s=l3(n.children);r.push(new ta(n.value,s))}return r.filter(n=>!l.has(n))}function B9(a){return a.data||{}}function V9(a){return a.resolve||{}}function j9(a,r,l,n,s,d){return ks(m=>F9(a,r,l,n,m.extractedUrl,s,d).pipe(Li(({state:_,tree:w})=>Pi(qt({},m),{targetSnapshot:_,urlAfterRedirects:w}))))}function U9(a,r){return ks(l=>{let{targetSnapshot:n,guards:{canActivateChecks:s}}=l;if(!s.length)return Fe(l);let d=new Set(s.map(w=>w.route)),m=new Set;for(let w of d)if(!m.has(w))for(let S of c3(w))m.add(S);let _=0;return Oo(m).pipe(gu(w=>d.has(w)?H9(w,n,a,r):(w.data=TE(w,w.parent,a).resolve,Fe(void 0))),$r(()=>_++),DS(1),ks(w=>_===m.size?Fe(l):bc))})}function c3(a){let r=a.children.map(l=>c3(l)).flat();return[a,...r]}function H9(a,r,l,n){let s=a.routeConfig,d=a._resolve;return s?.title!==void 0&&!e3(s)&&(d[Gf]=s.title),G9(d,a,r,n).pipe(Li(m=>(a._resolvedData=m,a.data=TE(a,a.parent,l).resolve,null)))}function G9(a,r,l,n){let s=eE(a);if(s.length===0)return Fe({});let d={};return Oo(s).pipe(ks(m=>q9(a[m],r,l,n).pipe(Nl(),$r(_=>{d[m]=_}))),DS(1),RF(d),zl(m=>s3(m)?bc:Ll(m)))}function q9(a,r,l,n){let s=qf(r)??n,d=um(a,s),m=d.resolve?d.resolve(r,l):Sc(s,()=>d(r,l));return vd(m)}function JS(a){return ro(r=>{let l=a(r);return l?Oo(l).pipe(Li(()=>r)):Fe(r)})}var d3=(()=>{let r=class r{buildTitle(n){let s,d=n.root;for(;d!==void 0;)s=this.getResolvedTitleForRoute(d)??s,d=d.children.find(m=>m.outlet===sn);return s}getResolvedTitleForRoute(n){return n.data[Gf]}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:()=>le(W9),providedIn:"root"});let a=r;return a})(),W9=(()=>{let r=class r extends d3{constructor(n){super(),this.title=n}updateTitle(n){let s=this.buildTitle(n);s!==void 0&&this.title.setTitle(s)}};r.\u0275fac=function(s){return new(s||r)(ht(RL))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),PE=new Se("",{providedIn:"root",factory:()=>({})}),OE=new Se(""),$9=(()=>{let r=class r{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=le(RS)}loadComponent(n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return Fe(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);let s=vd(n.loadComponent()).pipe(Li(u3),$r(m=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=m}),rl(()=>{this.componentLoaders.delete(n)})),d=new pf(s,()=>new pe).pipe(CS());return this.componentLoaders.set(n,d),d}loadChildren(n,s){if(this.childrenLoaders.get(s))return this.childrenLoaders.get(s);if(s._loadedRoutes)return Fe({routes:s._loadedRoutes,injector:s._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(s);let m=Y9(s,this.compiler,n,this.onLoadEndListener).pipe(rl(()=>{this.childrenLoaders.delete(s)})),_=new pf(m,()=>new pe).pipe(CS());return this.childrenLoaders.set(s,_),_}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function Y9(a,r,l,n){return vd(a.loadChildren()).pipe(Li(u3),ks(s=>s instanceof KF||Array.isArray(s)?Fe(s):Oo(r.compileModuleAsync(s))),Li(s=>{n&&n(a);let d,m,_=!1;return Array.isArray(s)?(m=s,_=!0):(d=s.create(l).injector,m=d.get(OE,[],{optional:!0,self:!0}).flat()),{routes:m.map(kE),injector:d}}))}function Z9(a){return a&&typeof a=="object"&&"default"in a}function u3(a){return Z9(a)?a.default:a}var FE=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:()=>le(X9),providedIn:"root"});let a=r;return a})(),X9=(()=>{let r=class r{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,s){return n}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),K9=new Se("");var Q9=(()=>{let r=class r{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new pe,this.transitionAbortSubject=new pe,this.configLoader=le($9),this.environmentInjector=le(qh),this.urlSerializer=le(DE),this.rootContexts=le(ty),this.location=le(Bl),this.inputBindingEnabled=le(AE,{optional:!0})!==null,this.titleStrategy=le(d3),this.options=le(PE,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=le(FE),this.createViewTransition=le(K9,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Fe(void 0),this.rootComponentType=null;let n=d=>this.events.next(new dE(d)),s=d=>this.events.next(new uE(d));this.configLoader.onLoadEndListener=s,this.configLoader.onLoadStartListener=n}complete(){this.transitions?.complete()}handleNavigationRequest(n){let s=++this.navigationId;this.transitions?.next(Pi(qt(qt({},this.transitions.value),n),{id:s}))}setupNavigations(n,s,d){return this.transitions=new We({id:0,currentUrlTree:s,currentRawUrl:s,extractedUrl:this.urlHandlingStrategy.extract(s),urlAfterRedirects:this.urlHandlingStrategy.extract(s),rawUrl:s,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Ff,restoredState:null,currentSnapshot:d.snapshot,targetSnapshot:null,currentRouterState:d,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(pn(m=>m.id!==0),Li(m=>Pi(qt({},m),{extractedUrl:this.urlHandlingStrategy.extract(m.rawUrl)})),ro(m=>{this.currentTransition=m;let _=!1,w=!1;return Fe(m).pipe($r(S=>{this.currentNavigation={id:S.id,initialUrl:S.rawUrl,extractedUrl:S.extractedUrl,trigger:S.source,extras:S.extras,previousNavigation:this.lastSuccessfulNavigation?Pi(qt({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),ro(S=>{let I=!n.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),L=S.extras.onSameUrlNavigation??n.onSameUrlNavigation;if(!I&&L!=="reload"){let H="";return this.events.next(new Tu(S.id,this.urlSerializer.serialize(S.rawUrl),H,oE.IgnoredSameUrlNavigation)),S.resolve(null),bc}if(this.urlHandlingStrategy.shouldProcessUrl(S.rawUrl))return Fe(S).pipe(ro(H=>{let q=this.transitions?.getValue();return this.events.next(new Mc(H.id,this.urlSerializer.serialize(H.extractedUrl),H.source,H.restoredState)),q!==this.transitions?.getValue()?bc:Promise.resolve(H)}),j9(this.environmentInjector,this.configLoader,this.rootComponentType,n.config,this.urlSerializer,this.paramsInheritanceStrategy),$r(H=>{m.targetSnapshot=H.targetSnapshot,m.urlAfterRedirects=H.urlAfterRedirects,this.currentNavigation=Pi(qt({},this.currentNavigation),{finalUrl:H.urlAfterRedirects});let q=new Yv(H.id,this.urlSerializer.serialize(H.extractedUrl),this.urlSerializer.serialize(H.urlAfterRedirects),H.targetSnapshot);this.events.next(q)}));if(I&&this.urlHandlingStrategy.shouldProcessUrl(S.currentRawUrl)){let{id:H,extractedUrl:q,source:X,restoredState:it,extras:at}=S,mt=new Mc(H,this.urlSerializer.serialize(q),X,it);this.events.next(mt);let Mt=JL(this.rootComponentType).snapshot;return this.currentTransition=m=Pi(qt({},S),{targetSnapshot:Mt,urlAfterRedirects:q,extras:Pi(qt({},at),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=q,Fe(m)}else{let H="";return this.events.next(new Tu(S.id,this.urlSerializer.serialize(S.extractedUrl),H,oE.IgnoredByUrlHandlingStrategy)),S.resolve(null),bc}}),$r(S=>{let I=new sE(S.id,this.urlSerializer.serialize(S.extractedUrl),this.urlSerializer.serialize(S.urlAfterRedirects),S.targetSnapshot);this.events.next(I)}),Li(S=>(this.currentTransition=m=Pi(qt({},S),{guards:o9(S.targetSnapshot,S.currentSnapshot,this.rootContexts)}),m)),f9(this.environmentInjector,S=>this.events.next(S)),$r(S=>{if(m.guardsResult=S.guardsResult,cm(S.guardsResult))throw n3(this.urlSerializer,S.guardsResult);let I=new aE(S.id,this.urlSerializer.serialize(S.extractedUrl),this.urlSerializer.serialize(S.urlAfterRedirects),S.targetSnapshot,!!S.guardsResult);this.events.next(I)}),pn(S=>S.guardsResult?!0:(this.cancelNavigationTransition(S,"",ba.GuardRejected),!1)),JS(S=>{if(S.guards.canActivateChecks.length)return Fe(S).pipe($r(I=>{let L=new lE(I.id,this.urlSerializer.serialize(I.extractedUrl),this.urlSerializer.serialize(I.urlAfterRedirects),I.targetSnapshot);this.events.next(L)}),ro(I=>{let L=!1;return Fe(I).pipe(U9(this.paramsInheritanceStrategy,this.environmentInjector),$r({next:()=>L=!0,complete:()=>{L||this.cancelNavigationTransition(I,"",ba.NoDataFromResolver)}}))}),$r(I=>{let L=new cE(I.id,this.urlSerializer.serialize(I.extractedUrl),this.urlSerializer.serialize(I.urlAfterRedirects),I.targetSnapshot);this.events.next(L)}))}),JS(S=>{let I=L=>{let H=[];L.routeConfig?.loadComponent&&!L.routeConfig._loadedComponent&&H.push(this.configLoader.loadComponent(L.routeConfig).pipe($r(q=>{L.component=q}),Li(()=>{})));for(let q of L.children)H.push(...I(q));return H};return xc(I(S.targetSnapshot.root)).pipe(MS(null),tn(1))}),JS(()=>this.afterPreactivation()),ro(()=>{let{currentSnapshot:S,targetSnapshot:I}=m,L=this.createViewTransition?.(this.environmentInjector,S.root,I.root);return L?Oo(L).pipe(Li(()=>m)):Fe(m)}),Li(S=>{let I=K7(n.routeReuseStrategy,S.targetSnapshot,S.currentRouterState);return this.currentTransition=m=Pi(qt({},S),{targetRouterState:I}),this.currentNavigation.targetRouterState=I,m}),$r(()=>{this.events.next(new Bf)}),r9(this.rootContexts,n.routeReuseStrategy,S=>this.events.next(S),this.inputBindingEnabled),tn(1),$r({next:S=>{_=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new ps(S.id,this.urlSerializer.serialize(S.extractedUrl),this.urlSerializer.serialize(S.urlAfterRedirects))),this.titleStrategy?.updateTitle(S.targetRouterState.snapshot),S.resolve(!0)},complete:()=>{_=!0}}),ni(this.transitionAbortSubject.pipe($r(S=>{throw S}))),rl(()=>{!_&&!w&&this.cancelNavigationTransition(m,"",ba.SupersededByNewNavigation),this.currentNavigation?.id===m.id&&(this.currentNavigation=null)}),zl(S=>{if(w=!0,o3(S))this.events.next(new _d(m.id,this.urlSerializer.serialize(m.extractedUrl),S.message,S.cancellationCode)),t9(S)?this.events.next(new Vf(S.url)):m.resolve(!1);else{this.events.next(new Nf(m.id,this.urlSerializer.serialize(m.extractedUrl),S,m.targetSnapshot??void 0));try{m.resolve(n.errorHandler(S))}catch(I){this.options.resolveNavigationPromiseOnError?m.resolve(!1):m.reject(I)}}return bc}))}))}cancelNavigationTransition(n,s,d){let m=new _d(n.id,this.urlSerializer.serialize(n.extractedUrl),s,d);this.events.next(m),n.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function J9(a){return a!==Ff}var tY=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:()=>le(eY),providedIn:"root"});let a=r;return a})(),ME=class{shouldDetach(r){return!1}store(r,l){}shouldAttach(r){return!1}retrieve(r){return null}shouldReuseRoute(r,l){return r.routeConfig===l.routeConfig}},eY=(()=>{let r=class r extends ME{};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=Nr(r)))(d||r)}})(),r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),h3=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:()=>le(iY),providedIn:"root"});let a=r;return a})(),iY=(()=>{let r=class r extends h3{constructor(){super(...arguments),this.location=le(Bl),this.urlSerializer=le(DE),this.options=le(PE,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=le(FE),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new gd,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=JL(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(n){return this.location.subscribe(s=>{s.type==="popstate"&&n(s.url,s.state)})}handleRouterEvent(n,s){if(n instanceof Mc)this.stateMemento=this.createStateMemento();else if(n instanceof Tu)this.rawUrlTree=s.initialUrl;else if(n instanceof Yv){if(this.urlUpdateStrategy==="eager"&&!s.extras.skipLocationChange){let d=this.urlHandlingStrategy.merge(s.finalUrl,s.initialUrl);this.setBrowserUrl(d,s)}}else n instanceof Bf?(this.currentUrlTree=s.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(s.finalUrl,s.initialUrl),this.routerState=s.targetRouterState,this.urlUpdateStrategy==="deferred"&&(s.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,s))):n instanceof _d&&(n.code===ba.GuardRejected||n.code===ba.NoDataFromResolver)?this.restoreHistory(s):n instanceof Nf?this.restoreHistory(s,!0):n instanceof ps&&(this.lastSuccessfulId=n.id,this.currentPageId=this.browserPageId)}setBrowserUrl(n,s){let d=this.urlSerializer.serialize(n);if(this.location.isCurrentPathEqualTo(d)||s.extras.replaceUrl){let m=this.browserPageId,_=qt(qt({},s.extras.state),this.generateNgRouterState(s.id,m));this.location.replaceState(d,"",_)}else{let m=qt(qt({},s.extras.state),this.generateNgRouterState(s.id,this.browserPageId+1));this.location.go(d,"",m)}}restoreHistory(n,s=!1){if(this.canceledNavigationResolution==="computed"){let d=this.browserPageId,m=this.currentPageId-d;m!==0?this.location.historyGo(m):this.currentUrlTree===n.finalUrl&&m===0&&(this.resetState(n),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(s&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(n,s){return this.canceledNavigationResolution==="computed"?{navigationId:n,\u0275routerPageId:s}:{navigationId:n}}};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=Nr(r)))(d||r)}})(),r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),Pf=function(a){return a[a.COMPLETE=0]="COMPLETE",a[a.FAILED=1]="FAILED",a[a.REDIRECTING=2]="REDIRECTING",a}(Pf||{});function nY(a,r){a.events.pipe(pn(l=>l instanceof ps||l instanceof _d||l instanceof Nf||l instanceof Tu),Li(l=>l instanceof ps||l instanceof Tu?Pf.COMPLETE:(l instanceof _d?l.code===ba.Redirect||l.code===ba.SupersededByNewNavigation:!1)?Pf.REDIRECTING:Pf.FAILED),pn(l=>l!==Pf.REDIRECTING),tn(1)).subscribe(()=>{r()})}function rY(a){throw a}var oY={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},sY={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},zi=(()=>{let r=class r{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=le(Sv),this.stateManager=le(h3),this.options=le(PE,{optional:!0})||{},this.pendingTasks=le(Cf),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=le(Q9),this.urlSerializer=le(DE),this.location=le(Bl),this.urlHandlingStrategy=le(FE),this._events=new pe,this.errorHandler=this.options.errorHandler||rY,this.navigated=!1,this.routeReuseStrategy=le(tY),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=le(OE,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!le(AE,{optional:!0}),this.eventsSubscription=new sr,this.isNgZoneEnabled=le(Be)instanceof Be&&Be.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:n=>{this.console.warn(n)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let n=this.navigationTransitions.events.subscribe(s=>{try{let d=this.navigationTransitions.currentTransition,m=this.navigationTransitions.currentNavigation;if(d!==null&&m!==null){if(this.stateManager.handleRouterEvent(s,m),s instanceof _d&&s.code!==ba.Redirect&&s.code!==ba.SupersededByNewNavigation)this.navigated=!0;else if(s instanceof ps)this.navigated=!0;else if(s instanceof Vf){let _=this.urlHandlingStrategy.merge(s.url,d.currentRawUrl),w={info:d.extras.info,skipLocationChange:d.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||J9(d.source)};this.scheduleNavigation(_,Ff,null,w,{resolve:d.resolve,reject:d.reject,promise:d.promise})}}lY(s)&&this._events.next(s)}catch(d){this.navigationTransitions.transitionAbortSubject.next(d)}});this.eventsSubscription.add(n)}resetRootComponentType(n){this.routerState.root.component=n,this.navigationTransitions.rootComponentType=n}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Ff,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((n,s)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(n,"popstate",s)},0)})}navigateToSyncWithBrowser(n,s,d){let m={replaceUrl:!0},_=d?.navigationId?d:null;if(d){let S=qt({},d);delete S.navigationId,delete S.\u0275routerPageId,Object.keys(S).length!==0&&(m.state=S)}let w=this.parseUrl(n);this.scheduleNavigation(w,s,_,m)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(n){this.config=n.map(kE),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(n,s={}){let{relativeTo:d,queryParams:m,fragment:_,queryParamsHandling:w,preserveFragment:S}=s,I=S?this.currentUrlTree.fragment:_,L=null;switch(w){case"merge":L=qt(qt({},this.currentUrlTree.queryParams),m);break;case"preserve":L=this.currentUrlTree.queryParams;break;default:L=m||null}L!==null&&(L=this.removeEmptyProps(L));let H;try{let q=d?d.snapshot:this.routerState.snapshot.root;H=ZL(q)}catch{(typeof n[0]!="string"||!n[0].startsWith("/"))&&(n=[]),H=this.currentUrlTree.root}return XL(H,n,L,I??null)}navigateByUrl(n,s={skipLocationChange:!1}){let d=cm(n)?n:this.parseUrl(n),m=this.urlHandlingStrategy.merge(d,this.rawUrlTree);return this.scheduleNavigation(m,Ff,null,s)}navigate(n,s={skipLocationChange:!1}){return aY(n),this.navigateByUrl(this.createUrlTree(n,s),s)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){try{return this.urlSerializer.parse(n)}catch{return this.urlSerializer.parse("/")}}isActive(n,s){let d;if(s===!0?d=qt({},oY):s===!1?d=qt({},sY):d=s,cm(n))return OL(this.currentUrlTree,n,d);let m=this.parseUrl(n);return OL(this.currentUrlTree,m,d)}removeEmptyProps(n){return Object.entries(n).reduce((s,[d,m])=>(m!=null&&(s[d]=m),s),{})}scheduleNavigation(n,s,d,m,_){if(this.disposed)return Promise.resolve(!1);let w,S,I;_?(w=_.resolve,S=_.reject,I=_.promise):I=new Promise((H,q)=>{w=H,S=q});let L=this.pendingTasks.add();return nY(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(L))}),this.navigationTransitions.handleNavigationRequest({source:s,restoredState:d,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:n,extras:m,resolve:w,reject:S,promise:I,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),I.catch(H=>Promise.reject(H))}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function aY(a){for(let r=0;r<a.length;r++)if(a[r]==null)throw new dr(4008,!1)}function lY(a){return!(a instanceof Bf)&&!(a instanceof Vf)}var kn=(()=>{let r=class r{constructor(n,s,d,m,_,w){this.router=n,this.route=s,this.tabIndexAttribute=d,this.renderer=m,this.el=_,this.locationStrategy=w,this.href=null,this.commands=null,this.onChanges=new pe,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;let S=_.nativeElement.tagName?.toLowerCase();this.isAnchorElement=S==="a"||S==="area",this.isAnchorElement?this.subscription=n.events.subscribe(I=>{I instanceof ps&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(n){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",n)}ngOnChanges(n){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(n){n!=null?(this.commands=Array.isArray(n)?n:[n],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(n,s,d,m,_){let w=this.urlTree;if(w===null||this.isAnchorElement&&(n!==0||s||d||m||_||typeof this.target=="string"&&this.target!="_self"))return!0;let S={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(w,S),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let n=this.urlTree;this.href=n!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(n)):null;let s=this.href===null?null:XF(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",s)}applyAttributeValue(n,s){let d=this.renderer,m=this.el.nativeElement;s!==null?d.setAttribute(m,n,s):d.removeAttribute(m,n)}get urlTree(){return this.commands===null?null:this.router.createUrlTree(this.commands,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}};r.\u0275fac=function(s){return new(s||r)(V(zi),V(Tn),ol("tabindex"),V(Lo),V(Ee),V(PS))},r.\u0275dir=oe({type:r,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(s,d){s&1&&ct("click",function(_){return d.onClick(_.button,_.ctrlKey,_.shiftKey,_.altKey,_.metaKey)}),s&2&&ri("target",d.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[Rt.HasDecoratorInputTransform,"preserveFragment","preserveFragment",Qe],skipLocationChange:[Rt.HasDecoratorInputTransform,"skipLocationChange","skipLocationChange",Qe],replaceUrl:[Rt.HasDecoratorInputTransform,"replaceUrl","replaceUrl",Qe],routerLink:"routerLink"},standalone:!0,features:[Fn,Yn]});let a=r;return a})(),m3=(()=>{let r=class r{get isActive(){return this._isActive}constructor(n,s,d,m,_){this.router=n,this.element=s,this.renderer=d,this.cdr=m,this.link=_,this.classes=[],this._isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new ye,this.routerEventsSubscription=n.events.subscribe(w=>{w instanceof ps&&this.update()})}ngAfterContentInit(){Fe(this.links.changes,Fe(null)).pipe(SS()).subscribe(n=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();let n=[...this.links.toArray(),this.link].filter(s=>!!s).map(s=>s.onChanges);this.linkInputChangesSubscription=Oo(n).pipe(SS()).subscribe(s=>{this._isActive!==this.isLinkActive(this.router)(s)&&this.update()})}set routerLinkActive(n){let s=Array.isArray(n)?n:n.split(" ");this.classes=s.filter(d=>!!d)}ngOnChanges(n){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{let n=this.hasActiveLinks();this._isActive!==n&&(this._isActive=n,this.cdr.markForCheck(),this.classes.forEach(s=>{n?this.renderer.addClass(this.element.nativeElement,s):this.renderer.removeClass(this.element.nativeElement,s)}),n&&this.ariaCurrentWhenActive!==void 0?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this.isActiveChange.emit(n))})}isLinkActive(n){let s=cY(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return d=>{let m=d.urlTree;return m?n.isActive(m,s):!1}}hasActiveLinks(){let n=this.isLinkActive(this.router);return this.link&&n(this.link)||this.links.some(n)}};r.\u0275fac=function(s){return new(s||r)(V(zi),V(Ee),V(Lo),V(Zi),V(kn,8))},r.\u0275dir=oe({type:r,selectors:[["","routerLinkActive",""]],contentQueries:function(s,d,m){if(s&1&&fn(m,kn,5),s&2){let _;se(_=ae())&&(d.links=_)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],standalone:!0,features:[Yn]});let a=r;return a})();function cY(a){return!!a.paths}var dY=new Se("");function p3(a,...r){return yu([{provide:OE,multi:!0,useValue:a},[],{provide:Tn,useFactory:uY,deps:[zi]},{provide:kS,multi:!0,useFactory:hY},r.map(l=>l.\u0275providers)])}function uY(a){return a.routerState.root}function hY(){let a=le(mo);return r=>{let l=a.get(Cu);if(r!==l.components[0])return;let n=a.get(zi),s=a.get(mY);a.get(pY)===1&&n.initialNavigation(),a.get(fY,null,IS.Optional)?.setUpPreloading(),a.get(dY,null,IS.Optional)?.init(),n.resetRootComponentType(l.componentTypes[0]),s.closed||(s.next(),s.complete(),s.unsubscribe())}}var mY=new Se("",{factory:()=>new pe}),pY=new Se("",{providedIn:"root",factory:()=>1});var fY=new Se("");var iy=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=St({type:r,selectors:[["app-loading"]],standalone:!0,features:[At],decls:8,vars:0,consts:[[1,"d-flex","align-items-center","justify-content-center","loading-overlay"],[1,"p-3","rounded","w-25","h-25","d-flex","align-items-center","justify-content-center"],[1,"row"],[1,"col-auto"],["role","status",1,"spinner-border"],[1,"col"],[1,"ms-2","me-2","mb-1","fs-4"]],template:function(s,d){s&1&&(T(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),dt(4,"div",4),k(),T(5,"div",5)(6,"div",6),B(7,"Loading..."),k()()()()())},styles:[".loading-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#0000004d;display:flex;justify-content:center;align-items:center;z-index:9999;-webkit-backdrop-filter:blur(100px);backdrop-filter:blur(100px)}"]});let a=r;return a})();var S3=(()=>{let r=class r{constructor(n,s){this._renderer=n,this._elementRef=s,this.onChange=d=>{},this.onTouched=()=>{}}setProperty(n,s){this._renderer.setProperty(this._elementRef.nativeElement,n,s)}registerOnTouched(n){this.onTouched=n}registerOnChange(n){this.onChange=n}setDisabledState(n){this.setProperty("disabled",n)}};r.\u0275fac=function(s){return new(s||r)(V(Lo),V(Ee))},r.\u0275dir=oe({type:r});let a=r;return a})(),fm=(()=>{let r=class r extends S3{};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=Nr(r)))(d||r)}})(),r.\u0275dir=oe({type:r,features:[Di]});let a=r;return a})(),wa=new Se(""),gY={provide:wa,useExisting:jo(()=>Kf),multi:!0},Kf=(()=>{let r=class r extends fm{writeValue(n){this.setProperty("checked",n)}};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=Nr(r)))(d||r)}})(),r.\u0275dir=oe({type:r,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(s,d){s&1&&ct("change",function(_){return d.onChange(_.target.checked)})("blur",function(){return d.onTouched()})},features:[ji([gY]),Di]});let a=r;return a})(),_Y={provide:wa,useExisting:jo(()=>en),multi:!0};function vY(){let a=tm()?tm().getUserAgent():"";return/android (\d+)/.test(a.toLowerCase())}var yY=new Se(""),en=(()=>{let r=class r extends S3{constructor(n,s,d){super(n,s),this._compositionMode=d,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!vY())}writeValue(n){let s=n??"";this.setProperty("value",s)}_handleInput(n){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(n)}_compositionStart(){this._composing=!0}_compositionEnd(n){this._composing=!1,this._compositionMode&&this.onChange(n)}};r.\u0275fac=function(s){return new(s||r)(V(Lo),V(Ee),V(yY,8))},r.\u0275dir=oe({type:r,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(s,d){s&1&&ct("input",function(_){return d._handleInput(_.target.value)})("blur",function(){return d.onTouched()})("compositionstart",function(){return d._compositionStart()})("compositionend",function(_){return d._compositionEnd(_.target.value)})},features:[ji([_Y]),Di]});let a=r;return a})();function yd(a){return a==null||(typeof a=="string"||Array.isArray(a))&&a.length===0}function E3(a){return a!=null&&typeof a.length=="number"}var bd=new Se(""),uy=new Se(""),bY=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,Le=class{static min(r){return xY(r)}static max(r){return wY(r)}static required(r){return M3(r)}static requiredTrue(r){return D3(r)}static email(r){return CY(r)}static minLength(r){return SY(r)}static maxLength(r){return EY(r)}static pattern(r){return MY(r)}static nullValidator(r){return ry(r)}static compose(r){return P3(r)}static composeAsync(r){return O3(r)}};function xY(a){return r=>{if(yd(r.value)||yd(a))return null;let l=parseFloat(r.value);return!isNaN(l)&&l<a?{min:{min:a,actual:r.value}}:null}}function wY(a){return r=>{if(yd(r.value)||yd(a))return null;let l=parseFloat(r.value);return!isNaN(l)&&l>a?{max:{max:a,actual:r.value}}:null}}function M3(a){return yd(a.value)?{required:!0}:null}function D3(a){return a.value===!0?null:{required:!0}}function CY(a){return yd(a.value)||bY.test(a.value)?null:{email:!0}}function SY(a){return r=>yd(r.value)||!E3(r.value)?null:r.value.length<a?{minlength:{requiredLength:a,actualLength:r.value.length}}:null}function EY(a){return r=>E3(r.value)&&r.value.length>a?{maxlength:{requiredLength:a,actualLength:r.value.length}}:null}function MY(a){if(!a)return ry;let r,l;return typeof a=="string"?(l="",a.charAt(0)!=="^"&&(l+="^"),l+=a,a.charAt(a.length-1)!=="$"&&(l+="$"),r=new RegExp(l)):(l=a.toString(),r=a),n=>{if(yd(n.value))return null;let s=n.value;return r.test(s)?null:{pattern:{requiredPattern:l,actualValue:s}}}}function ry(a){return null}function T3(a){return a!=null}function I3(a){return Ev(a)?Oo(a):a}function A3(a){let r={};return a.forEach(l=>{r=l!=null?qt(qt({},r),l):r}),Object.keys(r).length===0?null:r}function k3(a,r){return r.map(l=>l(a))}function DY(a){return!a.validate}function R3(a){return a.map(r=>DY(r)?r:l=>r.validate(l))}function P3(a){if(!a)return null;let r=a.filter(T3);return r.length==0?null:function(l){return A3(k3(l,r))}}function BE(a){return a!=null?P3(R3(a)):null}function O3(a){if(!a)return null;let r=a.filter(T3);return r.length==0?null:function(l){let n=k3(l,r).map(I3);return fv(n).pipe(Li(A3))}}function VE(a){return a!=null?O3(R3(a)):null}function f3(a,r){return a===null?[r]:Array.isArray(a)?[...a,r]:[a,r]}function F3(a){return a._rawValidators}function L3(a){return a._rawAsyncValidators}function LE(a){return a?Array.isArray(a)?a:[a]:[]}function oy(a,r){return Array.isArray(a)?a.includes(r):a===r}function g3(a,r){let l=LE(r);return LE(a).forEach(s=>{oy(l,s)||l.push(s)}),l}function _3(a,r){return LE(r).filter(l=>!oy(a,l))}var sy=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(r){this._rawValidators=r||[],this._composedValidatorFn=BE(this._rawValidators)}_setAsyncValidators(r){this._rawAsyncValidators=r||[],this._composedAsyncValidatorFn=VE(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(r){this._onDestroyCallbacks.push(r)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(r=>r()),this._onDestroyCallbacks=[]}reset(r=void 0){this.control&&this.control.reset(r)}hasError(r,l){return this.control?this.control.hasError(r,l):!1}getError(r,l){return this.control?this.control.getError(r,l):null}},Dc=class extends sy{get formDirective(){return null}get path(){return null}},fs=class extends sy{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},ay=class{constructor(r){this._cd=r}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},TY={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},Uut=Pi(qt({},TY),{"[class.ng-submitted]":"isSubmitted"}),qi=(()=>{let r=class r extends ay{constructor(n){super(n)}};r.\u0275fac=function(s){return new(s||r)(V(fs,2))},r.\u0275dir=oe({type:r,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(s,d){s&2&&li("ng-untouched",d.isUntouched)("ng-touched",d.isTouched)("ng-pristine",d.isPristine)("ng-dirty",d.isDirty)("ng-valid",d.isValid)("ng-invalid",d.isInvalid)("ng-pending",d.isPending)},features:[Di]});let a=r;return a})(),Cr=(()=>{let r=class r extends ay{constructor(n){super(n)}};r.\u0275fac=function(s){return new(s||r)(V(Dc,10))},r.\u0275dir=oe({type:r,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(s,d){s&2&&li("ng-untouched",d.isUntouched)("ng-touched",d.isTouched)("ng-pristine",d.isPristine)("ng-dirty",d.isDirty)("ng-valid",d.isValid)("ng-invalid",d.isInvalid)("ng-pending",d.isPending)("ng-submitted",d.isSubmitted)},features:[Di]});let a=r;return a})();var $f="VALID",ny="INVALID",hm="PENDING",Yf="DISABLED";function jE(a){return(hy(a)?a.validators:a)||null}function IY(a){return Array.isArray(a)?BE(a):a||null}function UE(a,r){return(hy(r)?r.asyncValidators:a)||null}function AY(a){return Array.isArray(a)?VE(a):a||null}function hy(a){return a!=null&&!Array.isArray(a)&&typeof a=="object"}function z3(a,r,l){let n=a.controls;if(!(r?Object.keys(n):n).length)throw new dr(1e3,"");if(!n[l])throw new dr(1001,"")}function N3(a,r,l){a._forEachChild((n,s)=>{if(l[s]===void 0)throw new dr(1002,"")})}var mm=class{constructor(r,l){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(r),this._assignAsyncValidators(l)}get validator(){return this._composedValidatorFn}set validator(r){this._rawValidators=this._composedValidatorFn=r}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(r){this._rawAsyncValidators=this._composedAsyncValidatorFn=r}get parent(){return this._parent}get valid(){return this.status===$f}get invalid(){return this.status===ny}get pending(){return this.status==hm}get disabled(){return this.status===Yf}get enabled(){return this.status!==Yf}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(r){this._assignValidators(r)}setAsyncValidators(r){this._assignAsyncValidators(r)}addValidators(r){this.setValidators(g3(r,this._rawValidators))}addAsyncValidators(r){this.setAsyncValidators(g3(r,this._rawAsyncValidators))}removeValidators(r){this.setValidators(_3(r,this._rawValidators))}removeAsyncValidators(r){this.setAsyncValidators(_3(r,this._rawAsyncValidators))}hasValidator(r){return oy(this._rawValidators,r)}hasAsyncValidator(r){return oy(this._rawAsyncValidators,r)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(r={}){this.touched=!0,this._parent&&!r.onlySelf&&this._parent.markAsTouched(r)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(r=>r.markAllAsTouched())}markAsUntouched(r={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(l=>{l.markAsUntouched({onlySelf:!0})}),this._parent&&!r.onlySelf&&this._parent._updateTouched(r)}markAsDirty(r={}){this.pristine=!1,this._parent&&!r.onlySelf&&this._parent.markAsDirty(r)}markAsPristine(r={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(l=>{l.markAsPristine({onlySelf:!0})}),this._parent&&!r.onlySelf&&this._parent._updatePristine(r)}markAsPending(r={}){this.status=hm,r.emitEvent!==!1&&this.statusChanges.emit(this.status),this._parent&&!r.onlySelf&&this._parent.markAsPending(r)}disable(r={}){let l=this._parentMarkedDirty(r.onlySelf);this.status=Yf,this.errors=null,this._forEachChild(n=>{n.disable(Pi(qt({},r),{onlySelf:!0}))}),this._updateValue(),r.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Pi(qt({},r),{skipPristineCheck:l})),this._onDisabledChange.forEach(n=>n(!0))}enable(r={}){let l=this._parentMarkedDirty(r.onlySelf);this.status=$f,this._forEachChild(n=>{n.enable(Pi(qt({},r),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:r.emitEvent}),this._updateAncestors(Pi(qt({},r),{skipPristineCheck:l})),this._onDisabledChange.forEach(n=>n(!1))}_updateAncestors(r){this._parent&&!r.onlySelf&&(this._parent.updateValueAndValidity(r),r.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(r){this._parent=r}getRawValue(){return this.value}updateValueAndValidity(r={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===$f||this.status===hm)&&this._runAsyncValidator(r.emitEvent)),r.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!r.onlySelf&&this._parent.updateValueAndValidity(r)}_updateTreeValidity(r={emitEvent:!0}){this._forEachChild(l=>l._updateTreeValidity(r)),this.updateValueAndValidity({onlySelf:!0,emitEvent:r.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Yf:$f}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(r){if(this.asyncValidator){this.status=hm,this._hasOwnPendingAsyncValidator=!0;let l=I3(this.asyncValidator(this));this._asyncValidationSubscription=l.subscribe(n=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(n,{emitEvent:r})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(r,l={}){this.errors=r,this._updateControlsErrors(l.emitEvent!==!1)}get(r){let l=r;return l==null||(Array.isArray(l)||(l=l.split(".")),l.length===0)?null:l.reduce((n,s)=>n&&n._find(s),this)}getError(r,l){let n=l?this.get(l):this;return n&&n.errors?n.errors[r]:null}hasError(r,l){return!!this.getError(r,l)}get root(){let r=this;for(;r._parent;)r=r._parent;return r}_updateControlsErrors(r){this.status=this._calculateStatus(),r&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(r)}_initObservables(){this.valueChanges=new ye,this.statusChanges=new ye}_calculateStatus(){return this._allControlsDisabled()?Yf:this.errors?ny:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(hm)?hm:this._anyControlsHaveStatus(ny)?ny:$f}_anyControlsHaveStatus(r){return this._anyControls(l=>l.status===r)}_anyControlsDirty(){return this._anyControls(r=>r.dirty)}_anyControlsTouched(){return this._anyControls(r=>r.touched)}_updatePristine(r={}){this.pristine=!this._anyControlsDirty(),this._parent&&!r.onlySelf&&this._parent._updatePristine(r)}_updateTouched(r={}){this.touched=this._anyControlsTouched(),this._parent&&!r.onlySelf&&this._parent._updateTouched(r)}_registerOnCollectionChange(r){this._onCollectionChange=r}_setUpdateStrategy(r){hy(r)&&r.updateOn!=null&&(this._updateOn=r.updateOn)}_parentMarkedDirty(r){let l=this._parent&&this._parent.dirty;return!r&&!!l&&!this._parent._anyControlsDirty()}_find(r){return null}_assignValidators(r){this._rawValidators=Array.isArray(r)?r.slice():r,this._composedValidatorFn=IY(this._rawValidators)}_assignAsyncValidators(r){this._rawAsyncValidators=Array.isArray(r)?r.slice():r,this._composedAsyncValidatorFn=AY(this._rawAsyncValidators)}},pm=class extends mm{constructor(r,l,n){super(jE(l),UE(n,l)),this.controls=r,this._initObservables(),this._setUpdateStrategy(l),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(r,l){return this.controls[r]?this.controls[r]:(this.controls[r]=l,l.setParent(this),l._registerOnCollectionChange(this._onCollectionChange),l)}addControl(r,l,n={}){this.registerControl(r,l),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}removeControl(r,l={}){this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),delete this.controls[r],this.updateValueAndValidity({emitEvent:l.emitEvent}),this._onCollectionChange()}setControl(r,l,n={}){this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),delete this.controls[r],l&&this.registerControl(r,l),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}contains(r){return this.controls.hasOwnProperty(r)&&this.controls[r].enabled}setValue(r,l={}){N3(this,!0,r),Object.keys(r).forEach(n=>{z3(this,!0,n),this.controls[n].setValue(r[n],{onlySelf:!0,emitEvent:l.emitEvent})}),this.updateValueAndValidity(l)}patchValue(r,l={}){r!=null&&(Object.keys(r).forEach(n=>{let s=this.controls[n];s&&s.patchValue(r[n],{onlySelf:!0,emitEvent:l.emitEvent})}),this.updateValueAndValidity(l))}reset(r={},l={}){this._forEachChild((n,s)=>{n.reset(r?r[s]:null,{onlySelf:!0,emitEvent:l.emitEvent})}),this._updatePristine(l),this._updateTouched(l),this.updateValueAndValidity(l)}getRawValue(){return this._reduceChildren({},(r,l,n)=>(r[n]=l.getRawValue(),r))}_syncPendingControls(){let r=this._reduceChildren(!1,(l,n)=>n._syncPendingControls()?!0:l);return r&&this.updateValueAndValidity({onlySelf:!0}),r}_forEachChild(r){Object.keys(this.controls).forEach(l=>{let n=this.controls[l];n&&r(n,l)})}_setUpControls(){this._forEachChild(r=>{r.setParent(this),r._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(r){for(let[l,n]of Object.entries(this.controls))if(this.contains(l)&&r(n))return!0;return!1}_reduceValue(){let r={};return this._reduceChildren(r,(l,n,s)=>((n.enabled||this.disabled)&&(l[s]=n.value),l))}_reduceChildren(r,l){let n=r;return this._forEachChild((s,d)=>{n=l(n,s,d)}),n}_allControlsDisabled(){for(let r of Object.keys(this.controls))if(this.controls[r].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(r){return this.controls.hasOwnProperty(r)?this.controls[r]:null}};var zE=class extends pm{};var gm=new Se("CallSetDisabledState",{providedIn:"root",factory:()=>Qf}),Qf="always";function B3(a,r){return[...r.path,a]}function ly(a,r,l=Qf){HE(a,r),r.valueAccessor.writeValue(a.value),(a.disabled||l==="always")&&r.valueAccessor.setDisabledState?.(a.disabled),RY(a,r),OY(a,r),PY(a,r),kY(a,r)}function v3(a,r,l=!0){let n=()=>{};r.valueAccessor&&(r.valueAccessor.registerOnChange(n),r.valueAccessor.registerOnTouched(n)),dy(a,r),a&&(r._invokeOnDestroyCallbacks(),a._registerOnCollectionChange(()=>{}))}function cy(a,r){a.forEach(l=>{l.registerOnValidatorChange&&l.registerOnValidatorChange(r)})}function kY(a,r){if(r.valueAccessor.setDisabledState){let l=n=>{r.valueAccessor.setDisabledState(n)};a.registerOnDisabledChange(l),r._registerOnDestroy(()=>{a._unregisterOnDisabledChange(l)})}}function HE(a,r){let l=F3(a);r.validator!==null?a.setValidators(f3(l,r.validator)):typeof l=="function"&&a.setValidators([l]);let n=L3(a);r.asyncValidator!==null?a.setAsyncValidators(f3(n,r.asyncValidator)):typeof n=="function"&&a.setAsyncValidators([n]);let s=()=>a.updateValueAndValidity();cy(r._rawValidators,s),cy(r._rawAsyncValidators,s)}function dy(a,r){let l=!1;if(a!==null){if(r.validator!==null){let s=F3(a);if(Array.isArray(s)&&s.length>0){let d=s.filter(m=>m!==r.validator);d.length!==s.length&&(l=!0,a.setValidators(d))}}if(r.asyncValidator!==null){let s=L3(a);if(Array.isArray(s)&&s.length>0){let d=s.filter(m=>m!==r.asyncValidator);d.length!==s.length&&(l=!0,a.setAsyncValidators(d))}}}let n=()=>{};return cy(r._rawValidators,n),cy(r._rawAsyncValidators,n),l}function RY(a,r){r.valueAccessor.registerOnChange(l=>{a._pendingValue=l,a._pendingChange=!0,a._pendingDirty=!0,a.updateOn==="change"&&V3(a,r)})}function PY(a,r){r.valueAccessor.registerOnTouched(()=>{a._pendingTouched=!0,a.updateOn==="blur"&&a._pendingChange&&V3(a,r),a.updateOn!=="submit"&&a.markAsTouched()})}function V3(a,r){a._pendingDirty&&a.markAsDirty(),a.setValue(a._pendingValue,{emitModelToViewChange:!1}),r.viewToModelUpdate(a._pendingValue),a._pendingChange=!1}function OY(a,r){let l=(n,s)=>{r.valueAccessor.writeValue(n),s&&r.viewToModelUpdate(n)};a.registerOnChange(l),r._registerOnDestroy(()=>{a._unregisterOnChange(l)})}function j3(a,r){a==null,HE(a,r)}function FY(a,r){return dy(a,r)}function U3(a,r){if(!a.hasOwnProperty("model"))return!1;let l=a.model;return l.isFirstChange()?!0:!Object.is(r,l.currentValue)}function LY(a){return Object.getPrototypeOf(a.constructor)===fm}function H3(a,r){a._syncPendingControls(),r.forEach(l=>{let n=l.control;n.updateOn==="submit"&&n._pendingChange&&(l.viewToModelUpdate(n._pendingValue),n._pendingChange=!1)})}function G3(a,r){if(!r)return null;Array.isArray(r);let l,n,s;return r.forEach(d=>{d.constructor===en?l=d:LY(d)?n=d:s=d}),s||n||l||null}function zY(a,r){let l=a.indexOf(r);l>-1&&a.splice(l,1)}var NY={provide:Dc,useExisting:jo(()=>Jf)},Zf=Promise.resolve(),Jf=(()=>{let r=class r extends Dc{constructor(n,s,d){super(),this.callSetDisabledState=d,this.submitted=!1,this._directives=new Set,this.ngSubmit=new ye,this.form=new pm({},BE(n),VE(s))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(n){Zf.then(()=>{let s=this._findContainer(n.path);n.control=s.registerControl(n.name,n.control),ly(n.control,n,this.callSetDisabledState),n.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(n)})}getControl(n){return this.form.get(n.path)}removeControl(n){Zf.then(()=>{let s=this._findContainer(n.path);s&&s.removeControl(n.name),this._directives.delete(n)})}addFormGroup(n){Zf.then(()=>{let s=this._findContainer(n.path),d=new pm({});j3(d,n),s.registerControl(n.name,d),d.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(n){Zf.then(()=>{let s=this._findContainer(n.path);s&&s.removeControl(n.name)})}getFormGroup(n){return this.form.get(n.path)}updateModel(n,s){Zf.then(()=>{this.form.get(n.path).setValue(s)})}setValue(n){this.control.setValue(n)}onSubmit(n){return this.submitted=!0,H3(this.form,this._directives),this.ngSubmit.emit(n),n?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(n=void 0){this.form.reset(n),this.submitted=!1}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(n){return n.pop(),n.length?this.form.get(n):this.form}};r.\u0275fac=function(s){return new(s||r)(V(bd,10),V(uy,10),V(gm,8))},r.\u0275dir=oe({type:r,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(s,d){s&1&&ct("submit",function(_){return d.onSubmit(_)})("reset",function(){return d.onReset()})},inputs:{options:[Rt.None,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[ji([NY]),Di]});let a=r;return a})();function y3(a,r){let l=a.indexOf(r);l>-1&&a.splice(l,1)}function b3(a){return typeof a=="object"&&a!==null&&Object.keys(a).length===2&&"value"in a&&"disabled"in a}var Xf=class extends mm{constructor(r=null,l,n){super(jE(l),UE(n,l)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(r),this._setUpdateStrategy(l),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),hy(l)&&(l.nonNullable||l.initialValueIsDefault)&&(b3(r)?this.defaultValue=r.value:this.defaultValue=r)}setValue(r,l={}){this.value=this._pendingValue=r,this._onChange.length&&l.emitModelToViewChange!==!1&&this._onChange.forEach(n=>n(this.value,l.emitViewToModelChange!==!1)),this.updateValueAndValidity(l)}patchValue(r,l={}){this.setValue(r,l)}reset(r=this.defaultValue,l={}){this._applyFormState(r),this.markAsPristine(l),this.markAsUntouched(l),this.setValue(this.value,l),this._pendingChange=!1}_updateValue(){}_anyControls(r){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(r){this._onChange.push(r)}_unregisterOnChange(r){y3(this._onChange,r)}registerOnDisabledChange(r){this._onDisabledChange.push(r)}_unregisterOnDisabledChange(r){y3(this._onDisabledChange,r)}_forEachChild(r){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(r){b3(r)?(this.value=this._pendingValue=r.value,r.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=r}};var BY=a=>a instanceof Xf;var VY={provide:fs,useExisting:jo(()=>To)},x3=Promise.resolve(),To=(()=>{let r=class r extends fs{constructor(n,s,d,m,_,w){super(),this._changeDetectorRef=_,this.callSetDisabledState=w,this.control=new Xf,this._registered=!1,this.name="",this.update=new ye,this._parent=n,this._setValidators(s),this._setAsyncValidators(d),this.valueAccessor=G3(this,m)}ngOnChanges(n){if(this._checkForErrors(),!this._registered||"name"in n){if(this._registered&&(this._checkName(),this.formDirective)){let s=n.name.previousValue;this.formDirective.removeControl({name:s,path:this._getPath(s)})}this._setUpControl()}"isDisabled"in n&&this._updateDisabled(n),U3(n,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(n){this.viewModel=n,this.update.emit(n)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){ly(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(n){x3.then(()=>{this.control.setValue(n,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(n){let s=n.isDisabled.currentValue,d=s!==0&&Qe(s);x3.then(()=>{d&&!this.control.disabled?this.control.disable():!d&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(n){return this._parent?B3(n,this._parent):[n]}};r.\u0275fac=function(s){return new(s||r)(V(Dc,9),V(bd,10),V(uy,10),V(wa,10),V(Zi,8),V(gm,8))},r.\u0275dir=oe({type:r,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[Rt.None,"disabled","isDisabled"],model:[Rt.None,"ngModel","model"],options:[Rt.None,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[ji([VY]),Di,Yn]});let a=r;return a})(),Sr=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275dir=oe({type:r,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]});let a=r;return a})(),jY={provide:wa,useExisting:jo(()=>GE),multi:!0},GE=(()=>{let r=class r extends fm{writeValue(n){let s=n??"";this.setProperty("value",s)}registerOnChange(n){this.onChange=s=>{n(s==""?null:parseFloat(s))}}};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=Nr(r)))(d||r)}})(),r.\u0275dir=oe({type:r,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(s,d){s&1&&ct("input",function(_){return d.onChange(_.target.value)})("blur",function(){return d.onTouched()})},features:[ji([jY]),Di]});let a=r;return a})(),UY={provide:wa,useExisting:jo(()=>Tc),multi:!0};var HY=(()=>{let r=class r{constructor(){this._accessors=[]}add(n,s){this._accessors.push([n,s])}remove(n){for(let s=this._accessors.length-1;s>=0;--s)if(this._accessors[s][1]===n){this._accessors.splice(s,1);return}}select(n){this._accessors.forEach(s=>{this._isSameGroup(s,n)&&s[1]!==n&&s[1].fireUncheck(n.value)})}_isSameGroup(n,s){return n[0].control?n[0]._parent===s._control._parent&&n[1].name===s.name:!1}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),Tc=(()=>{let r=class r extends fm{constructor(n,s,d,m){super(n,s),this._registry=d,this._injector=m,this.setDisabledStateFired=!1,this.onChange=()=>{},this.callSetDisabledState=le(gm,{optional:!0})??Qf}ngOnInit(){this._control=this._injector.get(fs),this._checkName(),this._registry.add(this._control,this)}ngOnDestroy(){this._registry.remove(this)}writeValue(n){this._state=n===this.value,this.setProperty("checked",this._state)}registerOnChange(n){this._fn=n,this.onChange=()=>{n(this.value),this._registry.select(this)}}setDisabledState(n){(this.setDisabledStateFired||n||this.callSetDisabledState==="whenDisabledForLegacyCode")&&this.setProperty("disabled",n),this.setDisabledStateFired=!0}fireUncheck(n){this.writeValue(n)}_checkName(){this.name&&this.formControlName&&(this.name,this.formControlName),!this.name&&this.formControlName&&(this.name=this.formControlName)}};r.\u0275fac=function(s){return new(s||r)(V(Lo),V(Ee),V(HY),V(mo))},r.\u0275dir=oe({type:r,selectors:[["input","type","radio","formControlName",""],["input","type","radio","formControl",""],["input","type","radio","ngModel",""]],hostBindings:function(s,d){s&1&&ct("change",function(){return d.onChange()})("blur",function(){return d.onTouched()})},inputs:{name:"name",formControlName:"formControlName",value:"value"},features:[ji([UY]),Di]});let a=r;return a})();var q3=new Se("");var GY={provide:Dc,useExisting:jo(()=>Hn)},Hn=(()=>{let r=class r extends Dc{constructor(n,s,d){super(),this.callSetDisabledState=d,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new ye,this._setValidators(n),this._setAsyncValidators(s)}ngOnChanges(n){this._checkFormPresent(),n.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(dy(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(n){let s=this.form.get(n.path);return ly(s,n,this.callSetDisabledState),s.updateValueAndValidity({emitEvent:!1}),this.directives.push(n),s}getControl(n){return this.form.get(n.path)}removeControl(n){v3(n.control||null,n,!1),zY(this.directives,n)}addFormGroup(n){this._setUpFormContainer(n)}removeFormGroup(n){this._cleanUpFormContainer(n)}getFormGroup(n){return this.form.get(n.path)}addFormArray(n){this._setUpFormContainer(n)}removeFormArray(n){this._cleanUpFormContainer(n)}getFormArray(n){return this.form.get(n.path)}updateModel(n,s){this.form.get(n.path).setValue(s)}onSubmit(n){return this.submitted=!0,H3(this.form,this.directives),this.ngSubmit.emit(n),n?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(n=void 0){this.form.reset(n),this.submitted=!1}_updateDomValue(){this.directives.forEach(n=>{let s=n.control,d=this.form.get(n.path);s!==d&&(v3(s||null,n),BY(d)&&(ly(d,n,this.callSetDisabledState),n.control=d))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(n){let s=this.form.get(n.path);j3(s,n),s.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(n){if(this.form){let s=this.form.get(n.path);s&&FY(s,n)&&s.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){HE(this.form,this),this._oldForm&&dy(this._oldForm,this)}_checkFormPresent(){this.form}};r.\u0275fac=function(s){return new(s||r)(V(bd,10),V(uy,10),V(gm,8))},r.\u0275dir=oe({type:r,selectors:[["","formGroup",""]],hostBindings:function(s,d){s&1&&ct("submit",function(_){return d.onSubmit(_)})("reset",function(){return d.onReset()})},inputs:{form:[Rt.None,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[ji([GY]),Di,Yn]});let a=r;return a})();var qY={provide:fs,useExisting:jo(()=>hr)},hr=(()=>{let r=class r extends fs{set isDisabled(n){}constructor(n,s,d,m,_){super(),this._ngModelWarningConfig=_,this._added=!1,this.name=null,this.update=new ye,this._ngModelWarningSent=!1,this._parent=n,this._setValidators(s),this._setAsyncValidators(d),this.valueAccessor=G3(this,m)}ngOnChanges(n){this._added||this._setUpControl(),U3(n,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(n){this.viewModel=n,this.update.emit(n)}get path(){return B3(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}};r._ngModelWarningSentOnce=!1,r.\u0275fac=function(s){return new(s||r)(V(Dc,13),V(bd,10),V(uy,10),V(wa,10),V(q3,8))},r.\u0275dir=oe({type:r,selectors:[["","formControlName",""]],inputs:{name:[Rt.None,"formControlName","name"],isDisabled:[Rt.None,"disabled","isDisabled"],model:[Rt.None,"ngModel","model"]},outputs:{update:"ngModelChange"},features:[ji([qY]),Di,Yn]});let a=r;return a})(),WY={provide:wa,useExisting:jo(()=>Ca),multi:!0};function W3(a,r){return a==null?`${r}`:(r&&typeof r=="object"&&(r="Object"),`${a}: ${r}`.slice(0,50))}function $Y(a){return a.split(":")[0]}var Ca=(()=>{let r=class r extends fm{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(n){this._compareWith=n}writeValue(n){this.value=n;let s=this._getOptionId(n),d=W3(s,n);this.setProperty("value",d)}registerOnChange(n){this.onChange=s=>{this.value=this._getOptionValue(s),n(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(n){for(let s of this._optionMap.keys())if(this._compareWith(this._optionMap.get(s),n))return s;return null}_getOptionValue(n){let s=$Y(n);return this._optionMap.has(s)?this._optionMap.get(s):n}};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=Nr(r)))(d||r)}})(),r.\u0275dir=oe({type:r,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(s,d){s&1&&ct("change",function(_){return d.onChange(_.target.value)})("blur",function(){return d.onTouched()})},inputs:{compareWith:"compareWith"},features:[ji([WY]),Di]});let a=r;return a})(),Fs=(()=>{let r=class r{constructor(n,s,d){this._element=n,this._renderer=s,this._select=d,this._select&&(this.id=this._select._registerOption())}set ngValue(n){this._select!=null&&(this._select._optionMap.set(this.id,n),this._setElementValue(W3(this.id,n)),this._select.writeValue(this._select.value))}set value(n){this._setElementValue(n),this._select&&this._select.writeValue(this._select.value)}_setElementValue(n){this._renderer.setProperty(this._element.nativeElement,"value",n)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}};r.\u0275fac=function(s){return new(s||r)(V(Ee),V(Lo),V(Ca,9))},r.\u0275dir=oe({type:r,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}});let a=r;return a})(),YY={provide:wa,useExisting:jo(()=>$3),multi:!0};function w3(a,r){return a==null?`${r}`:(typeof r=="string"&&(r=`'${r}'`),r&&typeof r=="object"&&(r="Object"),`${a}: ${r}`.slice(0,50))}function ZY(a){return a.split(":")[0]}var $3=(()=>{let r=class r extends fm{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(n){this._compareWith=n}writeValue(n){this.value=n;let s;if(Array.isArray(n)){let d=n.map(m=>this._getOptionId(m));s=(m,_)=>{m._setSelected(d.indexOf(_.toString())>-1)}}else s=(d,m)=>{d._setSelected(!1)};this._optionMap.forEach(s)}registerOnChange(n){this.onChange=s=>{let d=[],m=s.selectedOptions;if(m!==void 0){let _=m;for(let w=0;w<_.length;w++){let S=_[w],I=this._getOptionValue(S.value);d.push(I)}}else{let _=s.options;for(let w=0;w<_.length;w++){let S=_[w];if(S.selected){let I=this._getOptionValue(S.value);d.push(I)}}}this.value=d,n(d)}}_registerOption(n){let s=(this._idCounter++).toString();return this._optionMap.set(s,n),s}_getOptionId(n){for(let s of this._optionMap.keys())if(this._compareWith(this._optionMap.get(s)._value,n))return s;return null}_getOptionValue(n){let s=ZY(n);return this._optionMap.has(s)?this._optionMap.get(s)._value:n}};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=Nr(r)))(d||r)}})(),r.\u0275dir=oe({type:r,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(s,d){s&1&&ct("change",function(_){return d.onChange(_.target)})("blur",function(){return d.onTouched()})},inputs:{compareWith:"compareWith"},features:[ji([YY]),Di]});let a=r;return a})(),Ls=(()=>{let r=class r{constructor(n,s,d){this._element=n,this._renderer=s,this._select=d,this._select&&(this.id=this._select._registerOption(this))}set ngValue(n){this._select!=null&&(this._value=n,this._setElementValue(w3(this.id,n)),this._select.writeValue(this._select.value))}set value(n){this._select?(this._value=n,this._setElementValue(w3(this.id,n)),this._select.writeValue(this._select.value)):this._setElementValue(n)}_setElementValue(n){this._renderer.setProperty(this._element.nativeElement,"value",n)}_setSelected(n){this._renderer.setProperty(this._element.nativeElement,"selected",n)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}};r.\u0275fac=function(s){return new(s||r)(V(Ee),V(Lo),V($3,9))},r.\u0275dir=oe({type:r,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}});let a=r;return a})();var XY=(()=>{let r=class r{constructor(){this._validator=ry}ngOnChanges(n){if(this.inputName in n){let s=this.normalizeInput(n[this.inputName].currentValue);this._enabled=this.enabled(s),this._validator=this._enabled?this.createValidator(s):ry,this._onChange&&this._onChange()}}validate(n){return this._validator(n)}registerOnValidatorChange(n){this._onChange=n}enabled(n){return n!=null}};r.\u0275fac=function(s){return new(s||r)},r.\u0275dir=oe({type:r,features:[Yn]});let a=r;return a})();var KY={provide:bd,useExisting:jo(()=>Yr),multi:!0},QY={provide:bd,useExisting:jo(()=>qE),multi:!0},Yr=(()=>{let r=class r extends XY{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=Qe,this.createValidator=n=>M3}enabled(n){return n}};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=Nr(r)))(d||r)}})(),r.\u0275dir=oe({type:r,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(s,d){s&2&&ri("required",d._enabled?"":null)},inputs:{required:"required"},features:[ji([KY]),Di]});let a=r;return a})(),qE=(()=>{let r=class r extends Yr{constructor(){super(...arguments),this.createValidator=n=>D3}};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=Nr(r)))(d||r)}})(),r.\u0275dir=oe({type:r,selectors:[["input","type","checkbox","required","","formControlName",""],["input","type","checkbox","required","","formControl",""],["input","type","checkbox","required","","ngModel",""]],hostVars:1,hostBindings:function(s,d){s&2&&ri("required",d._enabled?"":null)},features:[ji([QY]),Di]});let a=r;return a})();var Y3=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275mod=Si({type:r}),r.\u0275inj=Ei({});let a=r;return a})(),NE=class extends mm{constructor(r,l,n){super(jE(l),UE(n,l)),this.controls=r,this._initObservables(),this._setUpdateStrategy(l),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(r){return this.controls[this._adjustIndex(r)]}push(r,l={}){this.controls.push(r),this._registerControl(r),this.updateValueAndValidity({emitEvent:l.emitEvent}),this._onCollectionChange()}insert(r,l,n={}){this.controls.splice(r,0,l),this._registerControl(l),this.updateValueAndValidity({emitEvent:n.emitEvent})}removeAt(r,l={}){let n=this._adjustIndex(r);n<0&&(n=0),this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),this.controls.splice(n,1),this.updateValueAndValidity({emitEvent:l.emitEvent})}setControl(r,l,n={}){let s=this._adjustIndex(r);s<0&&(s=0),this.controls[s]&&this.controls[s]._registerOnCollectionChange(()=>{}),this.controls.splice(s,1),l&&(this.controls.splice(s,0,l),this._registerControl(l)),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(r,l={}){N3(this,!1,r),r.forEach((n,s)=>{z3(this,!1,s),this.at(s).setValue(n,{onlySelf:!0,emitEvent:l.emitEvent})}),this.updateValueAndValidity(l)}patchValue(r,l={}){r!=null&&(r.forEach((n,s)=>{this.at(s)&&this.at(s).patchValue(n,{onlySelf:!0,emitEvent:l.emitEvent})}),this.updateValueAndValidity(l))}reset(r=[],l={}){this._forEachChild((n,s)=>{n.reset(r[s],{onlySelf:!0,emitEvent:l.emitEvent})}),this._updatePristine(l),this._updateTouched(l),this.updateValueAndValidity(l)}getRawValue(){return this.controls.map(r=>r.getRawValue())}clear(r={}){this.controls.length<1||(this._forEachChild(l=>l._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:r.emitEvent}))}_adjustIndex(r){return r<0?r+this.length:r}_syncPendingControls(){let r=this.controls.reduce((l,n)=>n._syncPendingControls()?!0:l,!1);return r&&this.updateValueAndValidity({onlySelf:!0}),r}_forEachChild(r){this.controls.forEach((l,n)=>{r(l,n)})}_updateValue(){this.value=this.controls.filter(r=>r.enabled||this.disabled).map(r=>r.value)}_anyControls(r){return this.controls.some(l=>l.enabled&&r(l))}_setUpControls(){this._forEachChild(r=>this._registerControl(r))}_allControlsDisabled(){for(let r of this.controls)if(r.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(r){r.setParent(this),r._registerOnCollectionChange(this._onCollectionChange)}_find(r){return this.at(r)??null}};function C3(a){return!!a&&(a.asyncValidators!==void 0||a.validators!==void 0||a.updateOn!==void 0)}var Er=(()=>{let r=class r{constructor(){this.useNonNullable=!1}get nonNullable(){let n=new r;return n.useNonNullable=!0,n}group(n,s=null){let d=this._reduceControls(n),m={};return C3(s)?m=s:s!==null&&(m.validators=s.validator,m.asyncValidators=s.asyncValidator),new pm(d,m)}record(n,s=null){let d=this._reduceControls(n);return new zE(d,s)}control(n,s,d){let m={};return this.useNonNullable?(C3(s)?m=s:(m.validators=s,m.asyncValidators=d),new Xf(n,Pi(qt({},m),{nonNullable:!0}))):new Xf(n,s,d)}array(n,s,d){let m=n.map(_=>this._createControl(_));return new NE(m,s,d)}_reduceControls(n){let s={};return Object.keys(n).forEach(d=>{s[d]=this._createControl(n[d])}),s}_createControl(n){if(n instanceof Xf)return n;if(n instanceof mm)return n;if(Array.isArray(n)){let s=n[0],d=n.length>1?n[1]:null,m=n.length>2?n[2]:null;return this.control(s,d,m)}else return this.control(n)}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var Ni=(()=>{let r=class r{static withConfig(n){return{ngModule:r,providers:[{provide:gm,useValue:n.callSetDisabledState??Qf}]}}};r.\u0275fac=function(s){return new(s||r)},r.\u0275mod=Si({type:r}),r.\u0275inj=Ei({imports:[Y3]});let a=r;return a})(),Mn=(()=>{let r=class r{static withConfig(n){return{ngModule:r,providers:[{provide:q3,useValue:n.warnOnNgModelWithFormControl??"always"},{provide:gm,useValue:n.callSetDisabledState??Qf}]}}};r.\u0275fac=function(s){return new(s||r)},r.\u0275mod=Si({type:r}),r.\u0275inj=Ei({imports:[Y3]});let a=r;return a})();function ao(a){return a!=null&&`${a}`!="false"}function Hl(a,r=0){return WE(a)?Number(a):r}function WE(a){return!isNaN(parseFloat(a))&&!isNaN(Number(a))}function _m(a){return Array.isArray(a)?a:[a]}function Io(a){return a==null?"":typeof a=="string"?a:`${a}px`}function zs(a){return a instanceof Ee?a.nativeElement:a}function Z3(a,r=/\s+/){let l=[];if(a!=null){let n=Array.isArray(a)?a:`${a}`.split(r);for(let s of n){let d=`${s}`.trim();d&&l.push(d)}}return l}var YE;try{YE=typeof Intl<"u"&&Intl.v8BreakIterator}catch{YE=!1}var gn=(()=>{let r=class r{constructor(n){this._platformId=n,this.isBrowser=this._platformId?lL(this._platformId):typeof document=="object"&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!!(window.chrome||YE)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}};r.\u0275fac=function(s){return new(s||r)(ht(Cc))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var vm,X3=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function ZE(){if(vm)return vm;if(typeof document!="object"||!document)return vm=new Set(X3),vm;let a=document.createElement("input");return vm=new Set(X3.filter(r=>(a.setAttribute("type",r),a.type===r))),vm}var tg;function JY(){if(tg==null&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>tg=!0}))}finally{tg=tg||!1}return tg}function is(a){return JY()?a:!!a.capture}var Iu;function K3(){if(Iu==null){if(typeof document!="object"||!document||typeof Element!="function"||!Element)return Iu=!1,Iu;if("scrollBehavior"in document.documentElement.style)Iu=!0;else{let a=Element.prototype.scrollTo;a?Iu=!/\{\s*\[native code\]\s*\}/.test(a.toString()):Iu=!1}}return Iu}var $E;function tZ(){if($E==null){let a=typeof document<"u"?document.head:null;$E=!!(a&&(a.createShadowRoot||a.attachShadow))}return $E}function Q3(a){if(tZ()){let r=a.getRootNode?a.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&r instanceof ShadowRoot)return r}return null}function xd(){let a=typeof document<"u"&&document?document.activeElement:null;for(;a&&a.shadowRoot;){let r=a.shadowRoot.activeElement;if(r===a)break;a=r}return a}function dl(a){return a.composedPath?a.composedPath()[0]:a.target}function my(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}var eZ=new Se("cdk-dir-doc",{providedIn:"root",factory:iZ});function iZ(){return le(ci)}var nZ=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function rZ(a){let r=a?.toLowerCase()||"";return r==="auto"&&typeof navigator<"u"&&navigator?.language?nZ.test(navigator.language)?"rtl":"ltr":r==="rtl"?"rtl":"ltr"}var Ao=(()=>{let r=class r{constructor(n){if(this.value="ltr",this.change=new ye,n){let s=n.body?n.body.dir:null,d=n.documentElement?n.documentElement.dir:null;this.value=rZ(s||d||"ltr")}}ngOnDestroy(){this.change.complete()}};r.\u0275fac=function(s){return new(s||r)(ht(eZ,8))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var eg=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275mod=Si({type:r}),r.\u0275inj=Ei({});let a=r;return a})();var py=class{};function gy(a){return a&&typeof a.connect=="function"&&!(a instanceof pf)}var ym=function(a){return a[a.REPLACED=0]="REPLACED",a[a.INSERTED=1]="INSERTED",a[a.MOVED=2]="MOVED",a[a.REMOVED=3]="REMOVED",a}(ym||{}),ig=new Se("_ViewRepeater"),bm=class{applyChanges(r,l,n,s,d){r.forEachOperation((m,_,w)=>{let S,I;if(m.previousIndex==null){let L=n(m,_,w);S=l.createEmbeddedView(L.templateRef,L.context,L.index),I=ym.INSERTED}else w==null?(l.remove(_),I=ym.REMOVED):(S=l.get(_),l.move(S,w),I=ym.MOVED);d&&d({context:S?.context,operation:I,record:m})})}detach(){}};var fy=class{get selected(){return this._selected||(this._selected=Array.from(this._selection.values())),this._selected}constructor(r=!1,l,n=!0,s){this._multiple=r,this._emitChanges=n,this.compareWith=s,this._selection=new Set,this._deselectedToEmit=[],this._selectedToEmit=[],this.changed=new pe,l&&l.length&&(r?l.forEach(d=>this._markSelected(d)):this._markSelected(l[0]),this._selectedToEmit.length=0)}select(...r){this._verifyValueAssignment(r),r.forEach(n=>this._markSelected(n));let l=this._hasQueuedChanges();return this._emitChangeEvent(),l}deselect(...r){this._verifyValueAssignment(r),r.forEach(n=>this._unmarkSelected(n));let l=this._hasQueuedChanges();return this._emitChangeEvent(),l}setSelection(...r){this._verifyValueAssignment(r);let l=this.selected,n=new Set(r);r.forEach(d=>this._markSelected(d)),l.filter(d=>!n.has(this._getConcreteValue(d,n))).forEach(d=>this._unmarkSelected(d));let s=this._hasQueuedChanges();return this._emitChangeEvent(),s}toggle(r){return this.isSelected(r)?this.deselect(r):this.select(r)}clear(r=!0){this._unmarkAll();let l=this._hasQueuedChanges();return r&&this._emitChangeEvent(),l}isSelected(r){return this._selection.has(this._getConcreteValue(r))}isEmpty(){return this._selection.size===0}hasValue(){return!this.isEmpty()}sort(r){this._multiple&&this.selected&&this._selected.sort(r)}isMultipleSelection(){return this._multiple}_emitChangeEvent(){this._selected=null,(this._selectedToEmit.length||this._deselectedToEmit.length)&&(this.changed.next({source:this,added:this._selectedToEmit,removed:this._deselectedToEmit}),this._deselectedToEmit=[],this._selectedToEmit=[])}_markSelected(r){r=this._getConcreteValue(r),this.isSelected(r)||(this._multiple||this._unmarkAll(),this.isSelected(r)||this._selection.add(r),this._emitChanges&&this._selectedToEmit.push(r))}_unmarkSelected(r){r=this._getConcreteValue(r),this.isSelected(r)&&(this._selection.delete(r),this._emitChanges&&this._deselectedToEmit.push(r))}_unmarkAll(){this.isEmpty()||this._selection.forEach(r=>this._unmarkSelected(r))}_verifyValueAssignment(r){r.length>1&&this._multiple}_hasQueuedChanges(){return!!(this._deselectedToEmit.length||this._selectedToEmit.length)}_getConcreteValue(r,l){if(this.compareWith){l=l??this._selection;for(let n of l)if(this.compareWith(r,n))return n;return r}else return r}};var oZ=20,ng=(()=>{let r=class r{constructor(n,s,d){this._ngZone=n,this._platform=s,this._scrolled=new pe,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=d}register(n){this.scrollContainers.has(n)||this.scrollContainers.set(n,n.elementScrolled().subscribe(()=>this._scrolled.next(n)))}deregister(n){let s=this.scrollContainers.get(n);s&&(s.unsubscribe(),this.scrollContainers.delete(n))}scrolled(n=oZ){return this._platform.isBrowser?new ya(s=>{this._globalSubscription||this._addGlobalListener();let d=n>0?this._scrolled.pipe(ES(n)).subscribe(s):this._scrolled.subscribe(s);return this._scrolledCount++,()=>{d.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):Fe()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((n,s)=>this.deregister(s)),this._scrolled.complete()}ancestorScrolled(n,s){let d=this.getAncestorScrollContainers(n);return this.scrolled(s).pipe(pn(m=>!m||d.indexOf(m)>-1))}getAncestorScrollContainers(n){let s=[];return this.scrollContainers.forEach((d,m)=>{this._scrollableContainsElement(m,n)&&s.push(m)}),s}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(n,s){let d=zs(s),m=n.getElementRef().nativeElement;do if(d==m)return!0;while(d=d.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>{let n=this._getWindow();return Fo(n.document,"scroll").subscribe(()=>this._scrolled.next())})}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}};r.\u0275fac=function(s){return new(s||r)(ht(Be),ht(gn),ht(ci,8))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var sZ=20,wd=(()=>{let r=class r{constructor(n,s,d){this._platform=n,this._change=new pe,this._changeListener=m=>{this._change.next(m)},this._document=d,s.runOutsideAngular(()=>{if(n.isBrowser){let m=this._getWindow();m.addEventListener("resize",this._changeListener),m.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){let n=this._getWindow();n.removeEventListener("resize",this._changeListener),n.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();let n={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),n}getViewportRect(){let n=this.getViewportScrollPosition(),{width:s,height:d}=this.getViewportSize();return{top:n.top,left:n.left,bottom:n.top+d,right:n.left+s,height:d,width:s}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};let n=this._document,s=this._getWindow(),d=n.documentElement,m=d.getBoundingClientRect(),_=-m.top||n.body.scrollTop||s.scrollY||d.scrollTop||0,w=-m.left||n.body.scrollLeft||s.scrollX||d.scrollLeft||0;return{top:_,left:w}}change(n=sZ){return n>0?this._change.pipe(ES(n)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){let n=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:n.innerWidth,height:n.innerHeight}:{width:0,height:0}}};r.\u0275fac=function(s){return new(s||r)(ht(gn),ht(Be),ht(ci,8))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var J3=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275mod=Si({type:r}),r.\u0275inj=Ei({});let a=r;return a})(),XE=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275mod=Si({type:r}),r.\u0275inj=Ei({imports:[eg,J3,eg,J3]});let a=r;return a})();var rg=class{attach(r){return this._attachedHost=r,r.attach(this)}detach(){let r=this._attachedHost;r!=null&&(this._attachedHost=null,r.detach())}get isAttached(){return this._attachedHost!=null}setAttachedHost(r){this._attachedHost=r}},ns=class extends rg{constructor(r,l,n,s,d){super(),this.component=r,this.viewContainerRef=l,this.injector=n,this.componentFactoryResolver=s,this.projectableNodes=d}},Ns=class extends rg{constructor(r,l,n,s){super(),this.templateRef=r,this.viewContainerRef=l,this.context=n,this.injector=s}get origin(){return this.templateRef.elementRef}attach(r,l=this.context){return this.context=l,super.attach(r)}detach(){return this.context=void 0,super.detach()}},QE=class extends rg{constructor(r){super(),this.element=r instanceof Ee?r.nativeElement:r}},Cd=class{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(r){if(r instanceof ns)return this._attachedPortal=r,this.attachComponentPortal(r);if(r instanceof Ns)return this._attachedPortal=r,this.attachTemplatePortal(r);if(this.attachDomPortal&&r instanceof QE)return this._attachedPortal=r,this.attachDomPortal(r)}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(r){this._disposeFn=r}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}};var og=class extends Cd{constructor(r,l,n,s,d){super(),this.outletElement=r,this._componentFactoryResolver=l,this._appRef=n,this._defaultInjector=s,this.attachDomPortal=m=>{this._document;let _=m.element;_.parentNode;let w=this._document.createComment("dom-portal");_.parentNode.insertBefore(w,_),this.outletElement.appendChild(_),this._attachedPortal=m,super.setDisposeFn(()=>{w.parentNode&&w.parentNode.replaceChild(_,w)})},this._document=d}attachComponentPortal(r){let n=(r.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(r.component),s;return r.viewContainerRef?(s=r.viewContainerRef.createComponent(n,r.viewContainerRef.length,r.injector||r.viewContainerRef.injector,r.projectableNodes||void 0),this.setDisposeFn(()=>s.destroy())):(s=n.create(r.injector||this._defaultInjector||mo.NULL),this._appRef.attachView(s.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(s.hostView),s.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(s)),this._attachedPortal=r,s}attachTemplatePortal(r){let l=r.viewContainerRef,n=l.createEmbeddedView(r.templateRef,r.context,{injector:r.injector});return n.rootNodes.forEach(s=>this.outletElement.appendChild(s)),n.detectChanges(),this.setDisposeFn(()=>{let s=l.indexOf(n);s!==-1&&l.remove(s)}),this._attachedPortal=r,n}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(r){return r.hostView.rootNodes[0]}};var ul=(()=>{let r=class r extends Cd{constructor(n,s,d){super(),this._componentFactoryResolver=n,this._viewContainerRef=s,this._isInitialized=!1,this.attached=new ye,this.attachDomPortal=m=>{this._document;let _=m.element;_.parentNode;let w=this._document.createComment("dom-portal");m.setAttachedHost(this),_.parentNode.insertBefore(w,_),this._getRootNode().appendChild(_),this._attachedPortal=m,super.setDisposeFn(()=>{w.parentNode&&w.parentNode.replaceChild(_,w)})},this._document=d}get portal(){return this._attachedPortal}set portal(n){this.hasAttached()&&!n&&!this._isInitialized||(this.hasAttached()&&super.detach(),n&&super.attach(n),this._attachedPortal=n||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedRef=this._attachedPortal=null}attachComponentPortal(n){n.setAttachedHost(this);let s=n.viewContainerRef!=null?n.viewContainerRef:this._viewContainerRef,m=(n.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(n.component),_=s.createComponent(m,s.length,n.injector||s.injector,n.projectableNodes||void 0);return s!==this._viewContainerRef&&this._getRootNode().appendChild(_.hostView.rootNodes[0]),super.setDisposeFn(()=>_.destroy()),this._attachedPortal=n,this._attachedRef=_,this.attached.emit(_),_}attachTemplatePortal(n){n.setAttachedHost(this);let s=this._viewContainerRef.createEmbeddedView(n.templateRef,n.context,{injector:n.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=n,this._attachedRef=s,this.attached.emit(s),s}_getRootNode(){let n=this._viewContainerRef.element.nativeElement;return n.nodeType===n.ELEMENT_NODE?n:n.parentNode}};r.\u0275fac=function(s){return new(s||r)(V(wf),V(Do),V(ci))},r.\u0275dir=oe({type:r,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:[Rt.None,"cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],standalone:!0,features:[Di]});let a=r;return a})();var xm=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275mod=Si({type:r}),r.\u0275inj=Ei({});let a=r;return a})();function Zr(a,...r){return r.length?r.some(l=>a[l]):a.altKey||a.shiftKey||a.ctrlKey||a.metaKey}var tz=K3(),JE=class{constructor(r,l){this._viewportRuler=r,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=l}attach(){}enable(){if(this._canBeEnabled()){let r=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=r.style.left||"",this._previousHTMLStyles.top=r.style.top||"",r.style.left=Io(-this._previousScrollPosition.left),r.style.top=Io(-this._previousScrollPosition.top),r.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){let r=this._document.documentElement,l=this._document.body,n=r.style,s=l.style,d=n.scrollBehavior||"",m=s.scrollBehavior||"";this._isEnabled=!1,n.left=this._previousHTMLStyles.left,n.top=this._previousHTMLStyles.top,r.classList.remove("cdk-global-scrollblock"),tz&&(n.scrollBehavior=s.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),tz&&(n.scrollBehavior=d,s.scrollBehavior=m)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;let l=this._document.body,n=this._viewportRuler.getViewportSize();return l.scrollHeight>n.height||l.scrollWidth>n.width}};var tM=class{constructor(r,l,n,s){this._scrollDispatcher=r,this._ngZone=l,this._viewportRuler=n,this._config=s,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(r){this._overlayRef,this._overlayRef=r}enable(){if(this._scrollSubscription)return;let r=this._scrollDispatcher.scrolled(0).pipe(pn(l=>!l||!this._overlayRef.overlayElement.contains(l.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=r.subscribe(()=>{let l=this._viewportRuler.getViewportScrollPosition().top;Math.abs(l-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=r.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},_y=class{enable(){}disable(){}attach(){}};function eM(a,r){return r.some(l=>{let n=a.bottom<l.top,s=a.top>l.bottom,d=a.right<l.left,m=a.left>l.right;return n||s||d||m})}function ez(a,r){return r.some(l=>{let n=a.top<l.top,s=a.bottom>l.bottom,d=a.left<l.left,m=a.right>l.right;return n||s||d||m})}var iM=class{constructor(r,l,n,s){this._scrollDispatcher=r,this._viewportRuler=l,this._ngZone=n,this._config=s,this._scrollSubscription=null}attach(r){this._overlayRef,this._overlayRef=r}enable(){if(!this._scrollSubscription){let r=this._config?this._config.scrollThrottle:0;this._scrollSubscription=this._scrollDispatcher.scrolled(r).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){let l=this._overlayRef.overlayElement.getBoundingClientRect(),{width:n,height:s}=this._viewportRuler.getViewportSize();eM(l,[{width:n,height:s,bottom:s,right:n,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}})}}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},aZ=(()=>{let r=class r{constructor(n,s,d,m){this._scrollDispatcher=n,this._viewportRuler=s,this._ngZone=d,this.noop=()=>new _y,this.close=_=>new tM(this._scrollDispatcher,this._ngZone,this._viewportRuler,_),this.block=()=>new JE(this._viewportRuler,this._document),this.reposition=_=>new iM(this._scrollDispatcher,this._viewportRuler,this._ngZone,_),this._document=m}};r.\u0275fac=function(s){return new(s||r)(ht(ng),ht(wd),ht(Be),ht(ci))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),rs=class{constructor(r){if(this.scrollStrategy=new _y,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,r){let l=Object.keys(r);for(let n of l)r[n]!==void 0&&(this[n]=r[n])}}};var nM=class{constructor(r,l){this.connectionPair=r,this.scrollableViewProperties=l}};var sz=(()=>{let r=class r{constructor(n){this._attachedOverlays=[],this._document=n}ngOnDestroy(){this.detach()}add(n){this.remove(n),this._attachedOverlays.push(n)}remove(n){let s=this._attachedOverlays.indexOf(n);s>-1&&this._attachedOverlays.splice(s,1),this._attachedOverlays.length===0&&this.detach()}};r.\u0275fac=function(s){return new(s||r)(ht(ci))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),lZ=(()=>{let r=class r extends sz{constructor(n,s){super(n),this._ngZone=s,this._keydownListener=d=>{let m=this._attachedOverlays;for(let _=m.length-1;_>-1;_--)if(m[_]._keydownEvents.observers.length>0){let w=m[_]._keydownEvents;this._ngZone?this._ngZone.run(()=>w.next(d)):w.next(d);break}}}add(n){super.add(n),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}};r.\u0275fac=function(s){return new(s||r)(ht(ci),ht(Be,8))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),cZ=(()=>{let r=class r extends sz{constructor(n,s,d){super(n),this._platform=s,this._ngZone=d,this._cursorStyleIsSet=!1,this._pointerDownListener=m=>{this._pointerDownEventTarget=dl(m)},this._clickListener=m=>{let _=dl(m),w=m.type==="click"&&this._pointerDownEventTarget?this._pointerDownEventTarget:_;this._pointerDownEventTarget=null;let S=this._attachedOverlays.slice();for(let I=S.length-1;I>-1;I--){let L=S[I];if(L._outsidePointerEvents.observers.length<1||!L.hasAttached())continue;if(L.overlayElement.contains(_)||L.overlayElement.contains(w))break;let H=L._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>H.next(m)):H.next(m)}}}add(n){if(super.add(n),!this._isAttached){let s=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(s)):this._addEventListeners(s),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=s.style.cursor,s.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){let n=this._document.body;n.removeEventListener("pointerdown",this._pointerDownListener,!0),n.removeEventListener("click",this._clickListener,!0),n.removeEventListener("auxclick",this._clickListener,!0),n.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(n.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(n){n.addEventListener("pointerdown",this._pointerDownListener,!0),n.addEventListener("click",this._clickListener,!0),n.addEventListener("auxclick",this._clickListener,!0),n.addEventListener("contextmenu",this._clickListener,!0)}};r.\u0275fac=function(s){return new(s||r)(ht(ci),ht(gn),ht(Be,8))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),wm=(()=>{let r=class r{constructor(n,s){this._platform=s,this._document=n}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let n="cdk-overlay-container";if(this._platform.isBrowser||my()){let d=this._document.querySelectorAll(`.${n}[platform="server"], .${n}[platform="test"]`);for(let m=0;m<d.length;m++)d[m].remove()}let s=this._document.createElement("div");s.classList.add(n),my()?s.setAttribute("platform","test"):this._platform.isBrowser||s.setAttribute("platform","server"),this._document.body.appendChild(s),this._containerElement=s}};r.\u0275fac=function(s){return new(s||r)(ht(ci),ht(gn))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),Ic=class{constructor(r,l,n,s,d,m,_,w,S,I=!1){this._portalOutlet=r,this._host=l,this._pane=n,this._config=s,this._ngZone=d,this._keyboardDispatcher=m,this._document=_,this._location=w,this._outsideClickDispatcher=S,this._animationsDisabled=I,this._backdropElement=null,this._backdropClick=new pe,this._attachments=new pe,this._detachments=new pe,this._locationChanges=sr.EMPTY,this._backdropClickHandler=L=>this._backdropClick.next(L),this._backdropTransitionendHandler=L=>{this._disposeBackdrop(L.target)},this._keydownEvents=new pe,this._outsidePointerEvents=new pe,s.scrollStrategy&&(this._scrollStrategy=s.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=s.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(r){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);let l=this._portalOutlet.attach(r);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(tn(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),typeof l?.onDestroy=="function"&&l.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),l}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();let r=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),r}dispose(){let r=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,r&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(r){r!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=r,this.hasAttached()&&(r.attach(this),this.updatePosition()))}updateSize(r){this._config=qt(qt({},this._config),r),this._updateElementSize()}setDirection(r){this._config=Pi(qt({},this._config),{direction:r}),this._updateElementDirection()}addPanelClass(r){this._pane&&this._toggleClasses(this._pane,r,!0)}removePanelClass(r){this._pane&&this._toggleClasses(this._pane,r,!1)}getDirection(){let r=this._config.direction;return r?typeof r=="string"?r:r.value:"ltr"}updateScrollStrategy(r){r!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=r,this.hasAttached()&&(r.attach(this),r.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;let r=this._pane.style;r.width=Io(this._config.width),r.height=Io(this._config.height),r.minWidth=Io(this._config.minWidth),r.minHeight=Io(this._config.minHeight),r.maxWidth=Io(this._config.maxWidth),r.maxHeight=Io(this._config.maxHeight)}_togglePointerEvents(r){this._pane.style.pointerEvents=r?"":"none"}_attachBackdrop(){let r="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(r)})}):this._backdropElement.classList.add(r)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){let r=this._backdropElement;if(r){if(this._animationsDisabled){this._disposeBackdrop(r);return}r.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{r.addEventListener("transitionend",this._backdropTransitionendHandler)}),r.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(r)},500))}}_toggleClasses(r,l,n){let s=_m(l||[]).filter(d=>!!d);s.length&&(n?r.classList.add(...s):r.classList.remove(...s))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{let r=this._ngZone.onStable.pipe(ni(no(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||this._pane.children.length===0)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),r.unsubscribe())})})}_disposeScrollStrategy(){let r=this._scrollStrategy;r&&(r.disable(),r.detach&&r.detach())}_disposeBackdrop(r){r&&(r.removeEventListener("click",this._backdropClickHandler),r.removeEventListener("transitionend",this._backdropTransitionendHandler),r.remove(),this._backdropElement===r&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}},iz="cdk-overlay-connected-position-bounding-box",dZ=/([A-Za-z%]+)$/,sg=class{get positions(){return this._preferredPositions}constructor(r,l,n,s,d){this._viewportRuler=l,this._document=n,this._platform=s,this._overlayContainer=d,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new pe,this._resizeSubscription=sr.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(r)}attach(r){this._overlayRef&&this._overlayRef,this._validatePositions(),r.hostElement.classList.add(iz),this._overlayRef=r,this._boundingBox=r.hostElement,this._pane=r.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition){this.reapplyLastPosition();return}this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let r=this._originRect,l=this._overlayRect,n=this._viewportRect,s=this._containerRect,d=[],m;for(let _ of this._preferredPositions){let w=this._getOriginPoint(r,s,_),S=this._getOverlayPoint(w,l,_),I=this._getOverlayFit(S,l,n,_);if(I.isCompletelyWithinViewport){this._isPushed=!1,this._applyPosition(_,w);return}if(this._canFitWithFlexibleDimensions(I,S,n)){d.push({position:_,origin:w,overlayRect:l,boundingBoxRect:this._calculateBoundingBoxRect(w,_)});continue}(!m||m.overlayFit.visibleArea<I.visibleArea)&&(m={overlayFit:I,overlayPoint:S,originPoint:w,position:_,overlayRect:l})}if(d.length){let _=null,w=-1;for(let S of d){let I=S.boundingBoxRect.width*S.boundingBoxRect.height*(S.position.weight||1);I>w&&(w=I,_=S)}this._isPushed=!1,this._applyPosition(_.position,_.origin);return}if(this._canPush){this._isPushed=!0,this._applyPosition(m.position,m.originPoint);return}this._applyPosition(m.position,m.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&ku(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(iz),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;let r=this._lastPosition;if(r){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let l=this._getOriginPoint(this._originRect,this._containerRect,r);this._applyPosition(r,l)}else this.apply()}withScrollableContainers(r){return this._scrollables=r,this}withPositions(r){return this._preferredPositions=r,r.indexOf(this._lastPosition)===-1&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(r){return this._viewportMargin=r,this}withFlexibleDimensions(r=!0){return this._hasFlexibleDimensions=r,this}withGrowAfterOpen(r=!0){return this._growAfterOpen=r,this}withPush(r=!0){return this._canPush=r,this}withLockedPosition(r=!0){return this._positionLocked=r,this}setOrigin(r){return this._origin=r,this}withDefaultOffsetX(r){return this._offsetX=r,this}withDefaultOffsetY(r){return this._offsetY=r,this}withTransformOriginOn(r){return this._transformOriginSelector=r,this}_getOriginPoint(r,l,n){let s;if(n.originX=="center")s=r.left+r.width/2;else{let m=this._isRtl()?r.right:r.left,_=this._isRtl()?r.left:r.right;s=n.originX=="start"?m:_}l.left<0&&(s-=l.left);let d;return n.originY=="center"?d=r.top+r.height/2:d=n.originY=="top"?r.top:r.bottom,l.top<0&&(d-=l.top),{x:s,y:d}}_getOverlayPoint(r,l,n){let s;n.overlayX=="center"?s=-l.width/2:n.overlayX==="start"?s=this._isRtl()?-l.width:0:s=this._isRtl()?0:-l.width;let d;return n.overlayY=="center"?d=-l.height/2:d=n.overlayY=="top"?0:-l.height,{x:r.x+s,y:r.y+d}}_getOverlayFit(r,l,n,s){let d=rz(l),{x:m,y:_}=r,w=this._getOffset(s,"x"),S=this._getOffset(s,"y");w&&(m+=w),S&&(_+=S);let I=0-m,L=m+d.width-n.width,H=0-_,q=_+d.height-n.height,X=this._subtractOverflows(d.width,I,L),it=this._subtractOverflows(d.height,H,q),at=X*it;return{visibleArea:at,isCompletelyWithinViewport:d.width*d.height===at,fitsInViewportVertically:it===d.height,fitsInViewportHorizontally:X==d.width}}_canFitWithFlexibleDimensions(r,l,n){if(this._hasFlexibleDimensions){let s=n.bottom-l.y,d=n.right-l.x,m=nz(this._overlayRef.getConfig().minHeight),_=nz(this._overlayRef.getConfig().minWidth),w=r.fitsInViewportVertically||m!=null&&m<=s,S=r.fitsInViewportHorizontally||_!=null&&_<=d;return w&&S}return!1}_pushOverlayOnScreen(r,l,n){if(this._previousPushAmount&&this._positionLocked)return{x:r.x+this._previousPushAmount.x,y:r.y+this._previousPushAmount.y};let s=rz(l),d=this._viewportRect,m=Math.max(r.x+s.width-d.width,0),_=Math.max(r.y+s.height-d.height,0),w=Math.max(d.top-n.top-r.y,0),S=Math.max(d.left-n.left-r.x,0),I=0,L=0;return s.width<=d.width?I=S||-m:I=r.x<this._viewportMargin?d.left-n.left-r.x:0,s.height<=d.height?L=w||-_:L=r.y<this._viewportMargin?d.top-n.top-r.y:0,this._previousPushAmount={x:I,y:L},{x:r.x+I,y:r.y+L}}_applyPosition(r,l){if(this._setTransformOrigin(r),this._setOverlayElementStyles(l,r),this._setBoundingBoxStyles(l,r),r.panelClass&&this._addPanelClasses(r.panelClass),this._lastPosition=r,this._positionChanges.observers.length){let n=this._getScrollVisibility(),s=new nM(r,n);this._positionChanges.next(s)}this._isInitialRender=!1}_setTransformOrigin(r){if(!this._transformOriginSelector)return;let l=this._boundingBox.querySelectorAll(this._transformOriginSelector),n,s=r.overlayY;r.overlayX==="center"?n="center":this._isRtl()?n=r.overlayX==="start"?"right":"left":n=r.overlayX==="start"?"left":"right";for(let d=0;d<l.length;d++)l[d].style.transformOrigin=`${n} ${s}`}_calculateBoundingBoxRect(r,l){let n=this._viewportRect,s=this._isRtl(),d,m,_;if(l.overlayY==="top")m=r.y,d=n.height-m+this._viewportMargin;else if(l.overlayY==="bottom")_=n.height-r.y+this._viewportMargin*2,d=n.height-_+this._viewportMargin;else{let q=Math.min(n.bottom-r.y+n.top,r.y),X=this._lastBoundingBoxSize.height;d=q*2,m=r.y-q,d>X&&!this._isInitialRender&&!this._growAfterOpen&&(m=r.y-X/2)}let w=l.overlayX==="start"&&!s||l.overlayX==="end"&&s,S=l.overlayX==="end"&&!s||l.overlayX==="start"&&s,I,L,H;if(S)H=n.width-r.x+this._viewportMargin,I=r.x-this._viewportMargin;else if(w)L=r.x,I=n.right-r.x;else{let q=Math.min(n.right-r.x+n.left,r.x),X=this._lastBoundingBoxSize.width;I=q*2,L=r.x-q,I>X&&!this._isInitialRender&&!this._growAfterOpen&&(L=r.x-X/2)}return{top:m,left:L,bottom:_,right:H,width:I,height:d}}_setBoundingBoxStyles(r,l){let n=this._calculateBoundingBoxRect(r,l);!this._isInitialRender&&!this._growAfterOpen&&(n.height=Math.min(n.height,this._lastBoundingBoxSize.height),n.width=Math.min(n.width,this._lastBoundingBoxSize.width));let s={};if(this._hasExactPosition())s.top=s.left="0",s.bottom=s.right=s.maxHeight=s.maxWidth="",s.width=s.height="100%";else{let d=this._overlayRef.getConfig().maxHeight,m=this._overlayRef.getConfig().maxWidth;s.height=Io(n.height),s.top=Io(n.top),s.bottom=Io(n.bottom),s.width=Io(n.width),s.left=Io(n.left),s.right=Io(n.right),l.overlayX==="center"?s.alignItems="center":s.alignItems=l.overlayX==="end"?"flex-end":"flex-start",l.overlayY==="center"?s.justifyContent="center":s.justifyContent=l.overlayY==="bottom"?"flex-end":"flex-start",d&&(s.maxHeight=Io(d)),m&&(s.maxWidth=Io(m))}this._lastBoundingBoxSize=n,ku(this._boundingBox.style,s)}_resetBoundingBoxStyles(){ku(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){ku(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(r,l){let n={},s=this._hasExactPosition(),d=this._hasFlexibleDimensions,m=this._overlayRef.getConfig();if(s){let I=this._viewportRuler.getViewportScrollPosition();ku(n,this._getExactOverlayY(l,r,I)),ku(n,this._getExactOverlayX(l,r,I))}else n.position="static";let _="",w=this._getOffset(l,"x"),S=this._getOffset(l,"y");w&&(_+=`translateX(${w}px) `),S&&(_+=`translateY(${S}px)`),n.transform=_.trim(),m.maxHeight&&(s?n.maxHeight=Io(m.maxHeight):d&&(n.maxHeight="")),m.maxWidth&&(s?n.maxWidth=Io(m.maxWidth):d&&(n.maxWidth="")),ku(this._pane.style,n)}_getExactOverlayY(r,l,n){let s={top:"",bottom:""},d=this._getOverlayPoint(l,this._overlayRect,r);if(this._isPushed&&(d=this._pushOverlayOnScreen(d,this._overlayRect,n)),r.overlayY==="bottom"){let m=this._document.documentElement.clientHeight;s.bottom=`${m-(d.y+this._overlayRect.height)}px`}else s.top=Io(d.y);return s}_getExactOverlayX(r,l,n){let s={left:"",right:""},d=this._getOverlayPoint(l,this._overlayRect,r);this._isPushed&&(d=this._pushOverlayOnScreen(d,this._overlayRect,n));let m;if(this._isRtl()?m=r.overlayX==="end"?"left":"right":m=r.overlayX==="end"?"right":"left",m==="right"){let _=this._document.documentElement.clientWidth;s.right=`${_-(d.x+this._overlayRect.width)}px`}else s.left=Io(d.x);return s}_getScrollVisibility(){let r=this._getOriginRect(),l=this._pane.getBoundingClientRect(),n=this._scrollables.map(s=>s.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:ez(r,n),isOriginOutsideView:eM(r,n),isOverlayClipped:ez(l,n),isOverlayOutsideView:eM(l,n)}}_subtractOverflows(r,...l){return l.reduce((n,s)=>n-Math.max(s,0),r)}_getNarrowedViewportRect(){let r=this._document.documentElement.clientWidth,l=this._document.documentElement.clientHeight,n=this._viewportRuler.getViewportScrollPosition();return{top:n.top+this._viewportMargin,left:n.left+this._viewportMargin,right:n.left+r-this._viewportMargin,bottom:n.top+l-this._viewportMargin,width:r-2*this._viewportMargin,height:l-2*this._viewportMargin}}_isRtl(){return this._overlayRef.getDirection()==="rtl"}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(r,l){return l==="x"?r.offsetX==null?this._offsetX:r.offsetX:r.offsetY==null?this._offsetY:r.offsetY}_validatePositions(){}_addPanelClasses(r){this._pane&&_m(r).forEach(l=>{l!==""&&this._appliedPanelClasses.indexOf(l)===-1&&(this._appliedPanelClasses.push(l),this._pane.classList.add(l))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(r=>{this._pane.classList.remove(r)}),this._appliedPanelClasses=[])}_getOriginRect(){let r=this._origin;if(r instanceof Ee)return r.nativeElement.getBoundingClientRect();if(r instanceof Element)return r.getBoundingClientRect();let l=r.width||0,n=r.height||0;return{top:r.y,bottom:r.y+n,left:r.x,right:r.x+l,height:n,width:l}}};function ku(a,r){for(let l in r)r.hasOwnProperty(l)&&(a[l]=r[l]);return a}function nz(a){if(typeof a!="number"&&a!=null){let[r,l]=a.split(dZ);return!l||l==="px"?parseFloat(r):null}return a||null}function rz(a){return{top:Math.floor(a.top),right:Math.floor(a.right),bottom:Math.floor(a.bottom),left:Math.floor(a.left),width:Math.floor(a.width),height:Math.floor(a.height)}}var oz="cdk-global-overlay-wrapper",rM=class{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(r){let l=r.getConfig();this._overlayRef=r,this._width&&!l.width&&r.updateSize({width:this._width}),this._height&&!l.height&&r.updateSize({height:this._height}),r.hostElement.classList.add(oz),this._isDisposed=!1}top(r=""){return this._bottomOffset="",this._topOffset=r,this._alignItems="flex-start",this}left(r=""){return this._xOffset=r,this._xPosition="left",this}bottom(r=""){return this._topOffset="",this._bottomOffset=r,this._alignItems="flex-end",this}right(r=""){return this._xOffset=r,this._xPosition="right",this}start(r=""){return this._xOffset=r,this._xPosition="start",this}end(r=""){return this._xOffset=r,this._xPosition="end",this}width(r=""){return this._overlayRef?this._overlayRef.updateSize({width:r}):this._width=r,this}height(r=""){return this._overlayRef?this._overlayRef.updateSize({height:r}):this._height=r,this}centerHorizontally(r=""){return this.left(r),this._xPosition="center",this}centerVertically(r=""){return this.top(r),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;let r=this._overlayRef.overlayElement.style,l=this._overlayRef.hostElement.style,n=this._overlayRef.getConfig(),{width:s,height:d,maxWidth:m,maxHeight:_}=n,w=(s==="100%"||s==="100vw")&&(!m||m==="100%"||m==="100vw"),S=(d==="100%"||d==="100vh")&&(!_||_==="100%"||_==="100vh"),I=this._xPosition,L=this._xOffset,H=this._overlayRef.getConfig().direction==="rtl",q="",X="",it="";w?it="flex-start":I==="center"?(it="center",H?X=L:q=L):H?I==="left"||I==="end"?(it="flex-end",q=L):(I==="right"||I==="start")&&(it="flex-start",X=L):I==="left"||I==="start"?(it="flex-start",q=L):(I==="right"||I==="end")&&(it="flex-end",X=L),r.position=this._cssPosition,r.marginLeft=w?"0":q,r.marginTop=S?"0":this._topOffset,r.marginBottom=this._bottomOffset,r.marginRight=w?"0":X,l.justifyContent=it,l.alignItems=S?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;let r=this._overlayRef.overlayElement.style,l=this._overlayRef.hostElement,n=l.style;l.classList.remove(oz),n.justifyContent=n.alignItems=r.marginTop=r.marginBottom=r.marginLeft=r.marginRight=r.position="",this._overlayRef=null,this._isDisposed=!0}},ag=(()=>{let r=class r{constructor(n,s,d,m){this._viewportRuler=n,this._document=s,this._platform=d,this._overlayContainer=m}global(){return new rM}flexibleConnectedTo(n){return new sg(n,this._viewportRuler,this._document,this._platform,this._overlayContainer)}};r.\u0275fac=function(s){return new(s||r)(ht(wd),ht(ci),ht(gn),ht(wm))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),uZ=0,Zn=(()=>{let r=class r{constructor(n,s,d,m,_,w,S,I,L,H,q,X){this.scrollStrategies=n,this._overlayContainer=s,this._componentFactoryResolver=d,this._positionBuilder=m,this._keyboardDispatcher=_,this._injector=w,this._ngZone=S,this._document=I,this._directionality=L,this._location=H,this._outsideClickDispatcher=q,this._animationsModuleType=X}create(n){let s=this._createHostElement(),d=this._createPaneElement(s),m=this._createPortalOutlet(d),_=new rs(n);return _.direction=_.direction||this._directionality.value,new Ic(m,s,d,_,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,this._animationsModuleType==="NoopAnimations")}position(){return this._positionBuilder}_createPaneElement(n){let s=this._document.createElement("div");return s.id=`cdk-overlay-${uZ++}`,s.classList.add("cdk-overlay-pane"),n.appendChild(s),s}_createHostElement(){let n=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(n),n}_createPortalOutlet(n){return this._appRef||(this._appRef=this._injector.get(Cu)),new og(n,this._componentFactoryResolver,this._appRef,this._injector,this._document)}};r.\u0275fac=function(s){return new(s||r)(ht(aZ),ht(wm),ht(wf),ht(ag),ht(lZ),ht(mo),ht(Be),ht(ci),ht(Ao),ht(Bl),ht(cZ),ht(Eo,8))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),hZ=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],az=new Se("cdk-connected-overlay-scroll-strategy",{providedIn:"root",factory:()=>{let a=le(Zn);return()=>a.scrollStrategies.reposition()}}),vy=(()=>{let r=class r{constructor(n){this.elementRef=n}};r.\u0275fac=function(s){return new(s||r)(V(Ee))},r.\u0275dir=oe({type:r,selectors:[["","cdk-overlay-origin",""],["","overlay-origin",""],["","cdkOverlayOrigin",""]],exportAs:["cdkOverlayOrigin"],standalone:!0});let a=r;return a})(),oM=(()=>{let r=class r{get offsetX(){return this._offsetX}set offsetX(n){this._offsetX=n,this._position&&this._updatePositionStrategy(this._position)}get offsetY(){return this._offsetY}set offsetY(n){this._offsetY=n,this._position&&this._updatePositionStrategy(this._position)}get disposeOnNavigation(){return this._disposeOnNavigation}set disposeOnNavigation(n){this._disposeOnNavigation=n}constructor(n,s,d,m,_){this._overlay=n,this._dir=_,this._backdropSubscription=sr.EMPTY,this._attachSubscription=sr.EMPTY,this._detachSubscription=sr.EMPTY,this._positionSubscription=sr.EMPTY,this._disposeOnNavigation=!1,this.viewportMargin=0,this.open=!1,this.disableClose=!1,this.hasBackdrop=!1,this.lockPosition=!1,this.flexibleDimensions=!1,this.growAfterOpen=!1,this.push=!1,this.backdropClick=new ye,this.positionChange=new ye,this.attach=new ye,this.detach=new ye,this.overlayKeydown=new ye,this.overlayOutsideClick=new ye,this._templatePortal=new Ns(s,d),this._scrollStrategyFactory=m,this.scrollStrategy=this._scrollStrategyFactory()}get overlayRef(){return this._overlayRef}get dir(){return this._dir?this._dir.value:"ltr"}ngOnDestroy(){this._attachSubscription.unsubscribe(),this._detachSubscription.unsubscribe(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._overlayRef&&this._overlayRef.dispose()}ngOnChanges(n){this._position&&(this._updatePositionStrategy(this._position),this._overlayRef.updateSize({width:this.width,minWidth:this.minWidth,height:this.height,minHeight:this.minHeight}),n.origin&&this.open&&this._position.apply()),n.open&&(this.open?this._attachOverlay():this._detachOverlay())}_createOverlay(){(!this.positions||!this.positions.length)&&(this.positions=hZ);let n=this._overlayRef=this._overlay.create(this._buildConfig());this._attachSubscription=n.attachments().subscribe(()=>this.attach.emit()),this._detachSubscription=n.detachments().subscribe(()=>this.detach.emit()),n.keydownEvents().subscribe(s=>{this.overlayKeydown.next(s),s.keyCode===27&&!this.disableClose&&!Zr(s)&&(s.preventDefault(),this._detachOverlay())}),this._overlayRef.outsidePointerEvents().subscribe(s=>{this.overlayOutsideClick.next(s)})}_buildConfig(){let n=this._position=this.positionStrategy||this._createPositionStrategy(),s=new rs({direction:this._dir,positionStrategy:n,scrollStrategy:this.scrollStrategy,hasBackdrop:this.hasBackdrop,disposeOnNavigation:this.disposeOnNavigation});return(this.width||this.width===0)&&(s.width=this.width),(this.height||this.height===0)&&(s.height=this.height),(this.minWidth||this.minWidth===0)&&(s.minWidth=this.minWidth),(this.minHeight||this.minHeight===0)&&(s.minHeight=this.minHeight),this.backdropClass&&(s.backdropClass=this.backdropClass),this.panelClass&&(s.panelClass=this.panelClass),s}_updatePositionStrategy(n){let s=this.positions.map(d=>({originX:d.originX,originY:d.originY,overlayX:d.overlayX,overlayY:d.overlayY,offsetX:d.offsetX||this.offsetX,offsetY:d.offsetY||this.offsetY,panelClass:d.panelClass||void 0}));return n.setOrigin(this._getFlexibleConnectedPositionStrategyOrigin()).withPositions(s).withFlexibleDimensions(this.flexibleDimensions).withPush(this.push).withGrowAfterOpen(this.growAfterOpen).withViewportMargin(this.viewportMargin).withLockedPosition(this.lockPosition).withTransformOriginOn(this.transformOriginSelector)}_createPositionStrategy(){let n=this._overlay.position().flexibleConnectedTo(this._getFlexibleConnectedPositionStrategyOrigin());return this._updatePositionStrategy(n),n}_getFlexibleConnectedPositionStrategyOrigin(){return this.origin instanceof vy?this.origin.elementRef:this.origin}_attachOverlay(){this._overlayRef?this._overlayRef.getConfig().hasBackdrop=this.hasBackdrop:this._createOverlay(),this._overlayRef.hasAttached()||this._overlayRef.attach(this._templatePortal),this.hasBackdrop?this._backdropSubscription=this._overlayRef.backdropClick().subscribe(n=>{this.backdropClick.emit(n)}):this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this.positionChange.observers.length>0&&(this._positionSubscription=this._position.positionChanges.pipe(zF(()=>this.positionChange.observers.length>0)).subscribe(n=>{this.positionChange.emit(n),this.positionChange.observers.length===0&&this._positionSubscription.unsubscribe()}))}_detachOverlay(){this._overlayRef&&this._overlayRef.detach(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe()}};r.\u0275fac=function(s){return new(s||r)(V(Zn),V(Mo),V(Do),V(az),V(Ao,8))},r.\u0275dir=oe({type:r,selectors:[["","cdk-connected-overlay",""],["","connected-overlay",""],["","cdkConnectedOverlay",""]],inputs:{origin:[Rt.None,"cdkConnectedOverlayOrigin","origin"],positions:[Rt.None,"cdkConnectedOverlayPositions","positions"],positionStrategy:[Rt.None,"cdkConnectedOverlayPositionStrategy","positionStrategy"],offsetX:[Rt.None,"cdkConnectedOverlayOffsetX","offsetX"],offsetY:[Rt.None,"cdkConnectedOverlayOffsetY","offsetY"],width:[Rt.None,"cdkConnectedOverlayWidth","width"],height:[Rt.None,"cdkConnectedOverlayHeight","height"],minWidth:[Rt.None,"cdkConnectedOverlayMinWidth","minWidth"],minHeight:[Rt.None,"cdkConnectedOverlayMinHeight","minHeight"],backdropClass:[Rt.None,"cdkConnectedOverlayBackdropClass","backdropClass"],panelClass:[Rt.None,"cdkConnectedOverlayPanelClass","panelClass"],viewportMargin:[Rt.None,"cdkConnectedOverlayViewportMargin","viewportMargin"],scrollStrategy:[Rt.None,"cdkConnectedOverlayScrollStrategy","scrollStrategy"],open:[Rt.None,"cdkConnectedOverlayOpen","open"],disableClose:[Rt.None,"cdkConnectedOverlayDisableClose","disableClose"],transformOriginSelector:[Rt.None,"cdkConnectedOverlayTransformOriginOn","transformOriginSelector"],hasBackdrop:[Rt.HasDecoratorInputTransform,"cdkConnectedOverlayHasBackdrop","hasBackdrop",Qe],lockPosition:[Rt.HasDecoratorInputTransform,"cdkConnectedOverlayLockPosition","lockPosition",Qe],flexibleDimensions:[Rt.HasDecoratorInputTransform,"cdkConnectedOverlayFlexibleDimensions","flexibleDimensions",Qe],growAfterOpen:[Rt.HasDecoratorInputTransform,"cdkConnectedOverlayGrowAfterOpen","growAfterOpen",Qe],push:[Rt.HasDecoratorInputTransform,"cdkConnectedOverlayPush","push",Qe],disposeOnNavigation:[Rt.HasDecoratorInputTransform,"cdkConnectedOverlayDisposeOnNavigation","disposeOnNavigation",Qe]},outputs:{backdropClick:"backdropClick",positionChange:"positionChange",attach:"attach",detach:"detach",overlayKeydown:"overlayKeydown",overlayOutsideClick:"overlayOutsideClick"},exportAs:["cdkConnectedOverlay"],standalone:!0,features:[Fn,Yn]});let a=r;return a})();function mZ(a){return()=>a.scrollStrategies.reposition()}var pZ={provide:az,deps:[Zn],useFactory:mZ},hl=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275mod=Si({type:r}),r.\u0275inj=Ei({providers:[Zn,pZ],imports:[eg,xm,XE,XE]});let a=r;return a})();function fZ(a,r){if(a&1){let l=we();T(0,"div",2),ct("@fade.done",function(s){Kt(l);let d=gt();return Qt(d.onAnimationEnd(s))}),k()}if(a&2){let l=gt();W("@fade",l.animationState)("@.disabled",!l.animation)("innerHTML",l.title,ZF)}}function gZ(a,r){if(a&1){let l=we();T(0,"div",3),ct("@fade.done",function(s){Kt(l);let d=gt();return Qt(d.onAnimationEnd(s))}),B(1),k()}if(a&2){let l=gt();W("@fade",l.animationState)("@.disabled",!l.animation),z(),ie(" ",l.title,`
`)}}var _Z=(()=>{class a{_cdRef;title;html;animation;tooltip=!0;_hidden=new pe;animationState="hidden";constructor(l){this._cdRef=l}markForCheck(){this._cdRef.markForCheck()}onAnimationEnd(l){l.toState==="hidden"&&this._hidden.next()}static \u0275fac=function(n){return new(n||a)(V(Zi))};static \u0275cmp=St({type:a,selectors:[["mdb-tooltip"]],hostVars:2,hostBindings:function(n,s){n&2&&li("tooltip",s.tooltip)},inputs:{title:"title",html:"html",animation:"animation"},decls:2,vars:2,consts:[["class","tooltip-inner",3,"innerHTML",4,"ngIf"],["class","tooltip-inner",4,"ngIf"],[1,"tooltip-inner",3,"innerHTML"],[1,"tooltip-inner"]],template:function(n,s){n&1&&ut(0,fZ,1,3,"div",0)(1,gZ,2,3,"div",1),n&2&&(W("ngIf",s.html),z(),W("ngIf",!s.html))},dependencies:[Ve],encapsulation:2,data:{animation:[wr("fade",[En("visible",hi({opacity:1})),En("hidden",hi({opacity:0})),ln("visible => hidden",Sn("150ms linear")),ln(":enter",Sn("150ms linear"))])]},changeDetection:0})}return a})(),lz=(()=>{class a{_overlay;_overlayPositionBuilder;_elementRef;mdbTooltip="";tooltipDisabled=!1;placement="top";html=!1;animation=!0;trigger="hover focus";delayShow=0;delayHide=0;offset=0;tooltipShow=new ye;tooltipShown=new ye;tooltipHide=new ye;tooltipHidden=new ye;_overlayRef;_tooltipRef;_open=!1;_showTimeout=0;_hideTimeout=0;_destroy$=new pe;constructor(l,n,s){this._overlay=l,this._overlayPositionBuilder=n,this._elementRef=s}ngOnInit(){this.tooltipDisabled||this.mdbTooltip===""||this._bindTriggerEvents()}ngOnDestroy(){(this._open||this._showTimeout)&&this.hide(),this._destroy$.next(),this._destroy$.complete()}_bindTriggerEvents(){this.trigger.split(" ").forEach(n=>{if(n==="click")Fo(this._elementRef.nativeElement,n).pipe(ni(this._destroy$)).subscribe(()=>this.toggle());else if(n!=="manual"){let s=n==="hover"?"mouseenter":"focusin",d=n==="hover"?"mouseleave":"focusout";Fo(this._elementRef.nativeElement,s).pipe(ni(this._destroy$)).subscribe(()=>this.show()),Fo(this._elementRef.nativeElement,d).pipe(ni(this._destroy$)).subscribe(()=>this.hide())}})}_createOverlayConfig(){let l=this._overlayPositionBuilder.flexibleConnectedTo(this._elementRef).withPositions(this._getPosition());return new rs({hasBackdrop:!1,scrollStrategy:this._overlay.scrollStrategies.reposition(),positionStrategy:l})}_createOverlay(){this._overlayRef=this._overlay.create(this._createOverlayConfig())}_getPosition(){let l,n={originX:"center",originY:"top",overlayX:"center",overlayY:"bottom",offsetY:-this.offset},s={originX:"center",originY:"bottom",overlayX:"center",overlayY:"top",offsetY:this.offset},d={originX:"end",originY:"center",overlayX:"start",overlayY:"center",offsetX:this.offset},m={originX:"start",originY:"center",overlayX:"end",overlayY:"center",offsetX:-this.offset};switch(this.placement){case"top":l=[n,s];break;case"bottom":l=[s,n];break;case"left":l=[m,d];break;case"right":l=[d,m];break;default:break}return l}show(){(this._hideTimeout||this._open)&&(this._overlayRef.detach(),clearTimeout(this._hideTimeout),this._hideTimeout=null),this._createOverlay(),this._showTimeout=setTimeout(()=>{if(!this._overlayRef.hasAttached()){let l=new ns(_Z);this.tooltipShow.emit(this),this._open=!0,this._tooltipRef=this._overlayRef.attach(l),this._tooltipRef.instance.title=this.mdbTooltip,this._tooltipRef.instance.html=this.html,this._tooltipRef.instance.animation=this.animation,this._tooltipRef.instance.animationState="visible",this._tooltipRef.instance.markForCheck(),this.tooltipShown.emit(this)}},this.delayShow)}hide(){if(this._showTimeout)clearTimeout(this._showTimeout),this._showTimeout=null;else return;this._hideTimeout=setTimeout(()=>{this.tooltipHide.emit(this),this._tooltipRef?(this._tooltipRef.instance._hidden.pipe(Nl()).subscribe(()=>{this._overlayRef.detach(),this._open=!1,this.tooltipHidden.emit(this)}),this._tooltipRef.instance.animationState="hidden",this._tooltipRef.instance.markForCheck()):(this._overlayRef.detach(),this._open=!1,this.tooltipHidden.emit(this))},this.delayHide)}toggle(){this._open?this.hide():this.show()}static \u0275fac=function(n){return new(n||a)(V(Zn),V(ag),V(Ee))};static \u0275dir=oe({type:a,selectors:[["","mdbTooltip",""]],inputs:{mdbTooltip:"mdbTooltip",tooltipDisabled:"tooltipDisabled",placement:"placement",html:"html",animation:"animation",trigger:"trigger",delayShow:"delayShow",delayHide:"delayHide",offset:"offset"},outputs:{tooltipShow:"tooltipShow",tooltipShown:"tooltipShown",tooltipHide:"tooltipHide",tooltipHidden:"tooltipHidden"},exportAs:["mdbTooltip"]})}return a})(),Cm=(()=>{class a{static \u0275fac=function(n){return new(n||a)};static \u0275mod=Si({type:a});static \u0275inj=Ei({imports:[zo,hl]})}return a})();var cz=350,dz=(()=>{class a{_elementRef;_renderer;constructor(l,n){this._elementRef=l,this._renderer=n}collapseClass=!0;collapseShow=new ye;collapseShown=new ye;collapseHide=new ye;collapseHidden=new ye;set collapsed(l){l!==this._collapsed&&(l?this.hide():this.show(),this._collapsed=l)}get collapsed(){return this._collapsed}_collapsed=!0;get host(){return this._elementRef.nativeElement}_isTransitioning=!1;show(){if(this._isTransitioning||!this.collapsed)return;this.collapseShow.emit(this),this._renderer.removeClass(this.host,"collapse"),this._renderer.addClass(this.host,"collapsing"),this._renderer.setStyle(this.host,"height","0px"),this._isTransitioning=!0;let l=this.host.scrollHeight;Fo(this.host,"transitionend").pipe(tn(1)).subscribe(()=>{this._isTransitioning=!1,this.collapsed=!1,this._renderer.removeClass(this.host,"collapsing"),this._renderer.addClass(this.host,"collapse"),this._renderer.addClass(this.host,"show"),this._renderer.removeStyle(this.host,"height"),this.collapseShown.emit(this)}),this._emulateTransitionEnd(this.host,cz),this._renderer.setStyle(this.host,"height",`${l}px`)}hide(){if(this._isTransitioning||this.collapsed)return;this.collapseHide.emit(this);let l=this.host.getBoundingClientRect().height;this._renderer.setStyle(this.host,"height",`${l}px`),this._reflow(this.host),this._renderer.addClass(this.host,"collapsing"),this._renderer.removeClass(this.host,"collapse"),this._renderer.removeClass(this.host,"show"),this._isTransitioning=!0,Fo(this.host,"transitionend").pipe(tn(1)).subscribe(()=>{this._renderer.removeClass(this.host,"collapsing"),this._renderer.addClass(this.host,"collapse"),this._isTransitioning=!1,this.collapsed=!0,this.collapseHidden.emit(this)}),this._renderer.removeStyle(this.host,"height"),this._emulateTransitionEnd(this.host,cz)}toggle(){this._isTransitioning||(this.collapsed=!this.collapsed,this.collapsed?this.hide():this.show())}_reflow(l){return l.offsetHeight}_emulateTransitionEnd(l,n){let s=!1,m=n+5;Fo(l,"transitionend").pipe(tn(1)).subscribe(()=>{s=!0}),setTimeout(()=>{s||l.dispatchEvent(new Event("transitionend"))},m)}static \u0275fac=function(n){return new(n||a)(V(Ee),V(Lo))};static \u0275dir=oe({type:a,selectors:[["","mdbCollapse",""]],hostVars:2,hostBindings:function(n,s){n&2&&li("collapse",s.collapseClass)},inputs:{collapsed:"collapsed"},outputs:{collapseShow:"collapseShow",collapseShown:"collapseShown",collapseHide:"collapseHide",collapseHidden:"collapseHidden"},exportAs:["mdbCollapse"]})}return a})(),Gl=(()=>{class a{static \u0275fac=function(n){return new(n||a)};static \u0275mod=Si({type:a});static \u0275inj=Ei({})}return a})();var uz=(()=>{let r=class r{constructor(){this.showDropdownSubject=new We(!1),this.showDropdown$=this.showDropdownSubject.asObservable()}setShowDropdown(n){this.showDropdownSubject.next(n)}toggleDropdown(){this.showDropdownSubject.next(!this.showDropdownSubject.value)}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var yy=(()=>{let r=class r{constructor(){}parseJwt(n){let d=n.split(".")[1].replace("-","+").replace("_","/");return JSON.parse(window.atob(d))}isLoggedIn(){let n=this.getToken();if(n===null)return!1;let s=this.parseJwt(n),m=new Date().getTime()/1e3;return s.exp>m}getRole(){let n=this.getToken();return n===null?"":this.parseJwt(n).role}setToken(n,s){s?localStorage.setItem("token",n):sessionStorage.setItem("token",n)}removeToken(){localStorage.removeItem("token"),sessionStorage.removeItem("token")}getToken(){return localStorage.getItem("token")||sessionStorage.getItem("token")||null}getUsername(){return this.parseJwt(this.getToken()).sub}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var xZ=(()=>{let r=class r{create(n){return typeof MutationObserver>"u"?null:new MutationObserver(n)}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),mz=(()=>{let r=class r{constructor(n){this._mutationObserverFactory=n,this._observedElements=new Map}ngOnDestroy(){this._observedElements.forEach((n,s)=>this._cleanupObserver(s))}observe(n){let s=zs(n);return new ya(d=>{let _=this._observeElement(s).subscribe(d);return()=>{_.unsubscribe(),this._unobserveElement(s)}})}_observeElement(n){if(this._observedElements.has(n))this._observedElements.get(n).count++;else{let s=new pe,d=this._mutationObserverFactory.create(m=>s.next(m));d&&d.observe(n,{characterData:!0,childList:!0,subtree:!0}),this._observedElements.set(n,{observer:d,stream:s,count:1})}return this._observedElements.get(n).stream}_unobserveElement(n){this._observedElements.has(n)&&(this._observedElements.get(n).count--,this._observedElements.get(n).count||this._cleanupObserver(n))}_cleanupObserver(n){if(this._observedElements.has(n)){let{observer:s,stream:d}=this._observedElements.get(n);s&&s.disconnect(),d.complete(),this._observedElements.delete(n)}}};r.\u0275fac=function(s){return new(s||r)(ht(xZ))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var pz=new Set,Ru,CZ=(()=>{let r=class r{constructor(n,s){this._platform=n,this._nonce=s,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):EZ}matchMedia(n){return(this._platform.WEBKIT||this._platform.BLINK)&&SZ(n,this._nonce),this._matchMedia(n)}};r.\u0275fac=function(s){return new(s||r)(ht(gn),ht(bf,8))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function SZ(a,r){if(!pz.has(a))try{Ru||(Ru=document.createElement("style"),r&&(Ru.nonce=r),Ru.setAttribute("type","text/css"),document.head.appendChild(Ru)),Ru.sheet&&(Ru.sheet.insertRule(`@media ${a} {body{ }}`,0),pz.add(a))}catch(l){console.error(l)}}function EZ(a){return{matches:a==="all"||a==="",media:a,addListener:()=>{},removeListener:()=>{}}}var by=(()=>{let r=class r{constructor(n,s){this._mediaMatcher=n,this._zone=s,this._queries=new Map,this._destroySubject=new pe}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(n){return fz(_m(n)).some(d=>this._registerQuery(d).mql.matches)}observe(n){let d=fz(_m(n)).map(_=>this._registerQuery(_).observable),m=xc(d);return m=pv(m.pipe(tn(1)),m.pipe(_v(1),gv(0))),m.pipe(Li(_=>{let w={matches:!1,breakpoints:{}};return _.forEach(({matches:S,query:I})=>{w.matches=w.matches||S,w.breakpoints[I]=S}),w}))}_registerQuery(n){if(this._queries.has(n))return this._queries.get(n);let s=this._mediaMatcher.matchMedia(n),m={observable:new ya(_=>{let w=S=>this._zone.run(()=>_.next(S));return s.addListener(w),()=>{s.removeListener(w)}}).pipe(ho(s),Li(({matches:_})=>({query:n,matches:_})),ni(this._destroySubject)),mql:s};return this._queries.set(n,m),m}};r.\u0275fac=function(s){return new(s||r)(ht(CZ),ht(Be))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function fz(a){return a.map(r=>r.split(",")).reduce((r,l)=>r.concat(l)).map(r=>r.trim())}var gz={XSmall:"(max-width: 599.98px)",Small:"(min-width: 600px) and (max-width: 959.98px)",Medium:"(min-width: 960px) and (max-width: 1279.98px)",Large:"(min-width: 1280px) and (max-width: 1919.98px)",XLarge:"(min-width: 1920px)",Handset:"(max-width: 599.98px) and (orientation: portrait), (max-width: 959.98px) and (orientation: landscape)",Tablet:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait), (min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",Web:"(min-width: 840px) and (orientation: portrait), (min-width: 1280px) and (orientation: landscape)",HandsetPortrait:"(max-width: 599.98px) and (orientation: portrait)",TabletPortrait:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait)",WebPortrait:"(min-width: 840px) and (orientation: portrait)",HandsetLandscape:"(max-width: 959.98px) and (orientation: landscape)",TabletLandscape:"(min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",WebLandscape:"(min-width: 1280px) and (orientation: landscape)"};var bz=" ";function dM(a,r,l){let n=Sy(a,r);l=l.trim(),!n.some(s=>s.trim()===l)&&(n.push(l),a.setAttribute(r,n.join(bz)))}function Ty(a,r,l){let n=Sy(a,r);l=l.trim();let s=n.filter(d=>d!==l);s.length?a.setAttribute(r,s.join(bz)):a.removeAttribute(r)}function Sy(a,r){return a.getAttribute(r)?.match(/\S+/g)??[]}var xz="cdk-describedby-message",xy="cdk-describedby-host",aM=0,Iy=(()=>{let r=class r{constructor(n,s){this._platform=s,this._messageRegistry=new Map,this._messagesContainer=null,this._id=`${aM++}`,this._document=n,this._id=le(yf)+"-"+aM++}describe(n,s,d){if(!this._canBeDescribed(n,s))return;let m=sM(s,d);typeof s!="string"?(vz(s,this._id),this._messageRegistry.set(m,{messageElement:s,referenceCount:0})):this._messageRegistry.has(m)||this._createMessageElement(s,d),this._isElementDescribedByMessage(n,m)||this._addMessageReference(n,m)}removeDescription(n,s,d){if(!s||!this._isElementNode(n))return;let m=sM(s,d);if(this._isElementDescribedByMessage(n,m)&&this._removeMessageReference(n,m),typeof s=="string"){let _=this._messageRegistry.get(m);_&&_.referenceCount===0&&this._deleteMessageElement(m)}this._messagesContainer?.childNodes.length===0&&(this._messagesContainer.remove(),this._messagesContainer=null)}ngOnDestroy(){let n=this._document.querySelectorAll(`[${xy}="${this._id}"]`);for(let s=0;s<n.length;s++)this._removeCdkDescribedByReferenceIds(n[s]),n[s].removeAttribute(xy);this._messagesContainer?.remove(),this._messagesContainer=null,this._messageRegistry.clear()}_createMessageElement(n,s){let d=this._document.createElement("div");vz(d,this._id),d.textContent=n,s&&d.setAttribute("role",s),this._createMessagesContainer(),this._messagesContainer.appendChild(d),this._messageRegistry.set(sM(n,s),{messageElement:d,referenceCount:0})}_deleteMessageElement(n){this._messageRegistry.get(n)?.messageElement?.remove(),this._messageRegistry.delete(n)}_createMessagesContainer(){if(this._messagesContainer)return;let n="cdk-describedby-message-container",s=this._document.querySelectorAll(`.${n}[platform="server"]`);for(let m=0;m<s.length;m++)s[m].remove();let d=this._document.createElement("div");d.style.visibility="hidden",d.classList.add(n),d.classList.add("cdk-visually-hidden"),this._platform&&!this._platform.isBrowser&&d.setAttribute("platform","server"),this._document.body.appendChild(d),this._messagesContainer=d}_removeCdkDescribedByReferenceIds(n){let s=Sy(n,"aria-describedby").filter(d=>d.indexOf(xz)!=0);n.setAttribute("aria-describedby",s.join(" "))}_addMessageReference(n,s){let d=this._messageRegistry.get(s);dM(n,"aria-describedby",d.messageElement.id),n.setAttribute(xy,this._id),d.referenceCount++}_removeMessageReference(n,s){let d=this._messageRegistry.get(s);d.referenceCount--,Ty(n,"aria-describedby",d.messageElement.id),n.removeAttribute(xy)}_isElementDescribedByMessage(n,s){let d=Sy(n,"aria-describedby"),m=this._messageRegistry.get(s),_=m&&m.messageElement.id;return!!_&&d.indexOf(_)!=-1}_canBeDescribed(n,s){if(!this._isElementNode(n))return!1;if(s&&typeof s=="object")return!0;let d=s==null?"":`${s}`.trim(),m=n.getAttribute("aria-label");return d?!m||m.trim()!==d:!1}_isElementNode(n){return n.nodeType===this._document.ELEMENT_NODE}};r.\u0275fac=function(s){return new(s||r)(ht(ci),ht(gn))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function sM(a,r){return typeof a=="string"?`${r||""}/${a}`:a}function vz(a,r){a.id||(a.id=`${xz}-${r}-${aM++}`)}var Ey=class{constructor(r){this._items=r,this._activeItemIndex=-1,this._activeItem=null,this._wrap=!1,this._letterKeyStream=new pe,this._typeaheadSubscription=sr.EMPTY,this._vertical=!0,this._allowedModifierKeys=[],this._homeAndEnd=!1,this._pageUpAndDown={enabled:!1,delta:10},this._skipPredicateFn=l=>l.disabled,this._pressedLetters=[],this.tabOut=new pe,this.change=new pe,r instanceof vf&&(this._itemChangesSubscription=r.changes.subscribe(l=>{if(this._activeItem){let s=l.toArray().indexOf(this._activeItem);s>-1&&s!==this._activeItemIndex&&(this._activeItemIndex=s)}}))}skipPredicate(r){return this._skipPredicateFn=r,this}withWrap(r=!0){return this._wrap=r,this}withVerticalOrientation(r=!0){return this._vertical=r,this}withHorizontalOrientation(r){return this._horizontal=r,this}withAllowedModifierKeys(r){return this._allowedModifierKeys=r,this}withTypeAhead(r=200){return this._typeaheadSubscription.unsubscribe(),this._typeaheadSubscription=this._letterKeyStream.pipe($r(l=>this._pressedLetters.push(l)),gv(r),pn(()=>this._pressedLetters.length>0),Li(()=>this._pressedLetters.join(""))).subscribe(l=>{let n=this._getItemsArray();for(let s=1;s<n.length+1;s++){let d=(this._activeItemIndex+s)%n.length,m=n[d];if(!this._skipPredicateFn(m)&&m.getLabel().toUpperCase().trim().indexOf(l)===0){this.setActiveItem(d);break}}this._pressedLetters=[]}),this}cancelTypeahead(){return this._pressedLetters=[],this}withHomeAndEnd(r=!0){return this._homeAndEnd=r,this}withPageUpDown(r=!0,l=10){return this._pageUpAndDown={enabled:r,delta:l},this}setActiveItem(r){let l=this._activeItem;this.updateActiveItem(r),this._activeItem!==l&&this.change.next(this._activeItemIndex)}onKeydown(r){let l=r.keyCode,s=["altKey","ctrlKey","metaKey","shiftKey"].every(d=>!r[d]||this._allowedModifierKeys.indexOf(d)>-1);switch(l){case 9:this.tabOut.next();return;case 40:if(this._vertical&&s){this.setNextItemActive();break}else return;case 38:if(this._vertical&&s){this.setPreviousItemActive();break}else return;case 39:if(this._horizontal&&s){this._horizontal==="rtl"?this.setPreviousItemActive():this.setNextItemActive();break}else return;case 37:if(this._horizontal&&s){this._horizontal==="rtl"?this.setNextItemActive():this.setPreviousItemActive();break}else return;case 36:if(this._homeAndEnd&&s){this.setFirstItemActive();break}else return;case 35:if(this._homeAndEnd&&s){this.setLastItemActive();break}else return;case 33:if(this._pageUpAndDown.enabled&&s){let d=this._activeItemIndex-this._pageUpAndDown.delta;this._setActiveItemByIndex(d>0?d:0,1);break}else return;case 34:if(this._pageUpAndDown.enabled&&s){let d=this._activeItemIndex+this._pageUpAndDown.delta,m=this._getItemsArray().length;this._setActiveItemByIndex(d<m?d:m-1,-1);break}else return;default:(s||Zr(r,"shiftKey"))&&(r.key&&r.key.length===1?this._letterKeyStream.next(r.key.toLocaleUpperCase()):(l>=65&&l<=90||l>=48&&l<=57)&&this._letterKeyStream.next(String.fromCharCode(l)));return}this._pressedLetters=[],r.preventDefault()}get activeItemIndex(){return this._activeItemIndex}get activeItem(){return this._activeItem}isTyping(){return this._pressedLetters.length>0}setFirstItemActive(){this._setActiveItemByIndex(0,1)}setLastItemActive(){this._setActiveItemByIndex(this._items.length-1,-1)}setNextItemActive(){this._activeItemIndex<0?this.setFirstItemActive():this._setActiveItemByDelta(1)}setPreviousItemActive(){this._activeItemIndex<0&&this._wrap?this.setLastItemActive():this._setActiveItemByDelta(-1)}updateActiveItem(r){let l=this._getItemsArray(),n=typeof r=="number"?r:l.indexOf(r),s=l[n];this._activeItem=s??null,this._activeItemIndex=n}destroy(){this._typeaheadSubscription.unsubscribe(),this._itemChangesSubscription?.unsubscribe(),this._letterKeyStream.complete(),this.tabOut.complete(),this.change.complete(),this._pressedLetters=[]}_setActiveItemByDelta(r){this._wrap?this._setActiveInWrapMode(r):this._setActiveInDefaultMode(r)}_setActiveInWrapMode(r){let l=this._getItemsArray();for(let n=1;n<=l.length;n++){let s=(this._activeItemIndex+r*n+l.length)%l.length,d=l[s];if(!this._skipPredicateFn(d)){this.setActiveItem(s);return}}}_setActiveInDefaultMode(r){this._setActiveItemByIndex(this._activeItemIndex+r,r)}_setActiveItemByIndex(r,l){let n=this._getItemsArray();if(n[r]){for(;this._skipPredicateFn(n[r]);)if(r+=l,!n[r])return;this.setActiveItem(r)}}_getItemsArray(){return this._items instanceof vf?this._items.toArray():this._items}},My=class extends Ey{setActiveItem(r){this.activeItem&&this.activeItem.setInactiveStyles(),super.setActiveItem(r),this.activeItem&&this.activeItem.setActiveStyles()}},Dy=class extends Ey{constructor(){super(...arguments),this._origin="program"}setFocusOrigin(r){return this._origin=r,this}setActiveItem(r){super.setActiveItem(r),this.activeItem&&this.activeItem.focus(this._origin)}};var dg=(()=>{let r=class r{constructor(n){this._platform=n}isDisabled(n){return n.hasAttribute("disabled")}isVisible(n){return LZ(n)&&getComputedStyle(n).visibility==="visible"}isTabbable(n){if(!this._platform.isBrowser)return!1;let s=FZ(GZ(n));if(s&&(yz(s)===-1||!this.isVisible(s)))return!1;let d=n.nodeName.toLowerCase(),m=yz(n);return n.hasAttribute("contenteditable")?m!==-1:d==="iframe"||d==="object"||this._platform.WEBKIT&&this._platform.IOS&&!UZ(n)?!1:d==="audio"?n.hasAttribute("controls")?m!==-1:!1:d==="video"?m===-1?!1:m!==null?!0:this._platform.FIREFOX||n.hasAttribute("controls"):n.tabIndex>=0}isFocusable(n,s){return HZ(n)&&!this.isDisabled(n)&&(s?.ignoreVisibility||this.isVisible(n))}};r.\u0275fac=function(s){return new(s||r)(ht(gn))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function FZ(a){try{return a.frameElement}catch{return null}}function LZ(a){return!!(a.offsetWidth||a.offsetHeight||typeof a.getClientRects=="function"&&a.getClientRects().length)}function zZ(a){let r=a.nodeName.toLowerCase();return r==="input"||r==="select"||r==="button"||r==="textarea"}function NZ(a){return VZ(a)&&a.type=="hidden"}function BZ(a){return jZ(a)&&a.hasAttribute("href")}function VZ(a){return a.nodeName.toLowerCase()=="input"}function jZ(a){return a.nodeName.toLowerCase()=="a"}function wz(a){if(!a.hasAttribute("tabindex")||a.tabIndex===void 0)return!1;let r=a.getAttribute("tabindex");return!!(r&&!isNaN(parseInt(r,10)))}function yz(a){if(!wz(a))return null;let r=parseInt(a.getAttribute("tabindex")||"",10);return isNaN(r)?-1:r}function UZ(a){let r=a.nodeName.toLowerCase(),l=r==="input"&&a.type;return l==="text"||l==="password"||r==="select"||r==="textarea"}function HZ(a){return NZ(a)?!1:zZ(a)||BZ(a)||a.hasAttribute("contenteditable")||wz(a)}function GZ(a){return a.ownerDocument&&a.ownerDocument.defaultView||window}var lM=class{get enabled(){return this._enabled}set enabled(r){this._enabled=r,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(r,this._startAnchor),this._toggleAnchorTabIndex(r,this._endAnchor))}constructor(r,l,n,s,d=!1){this._element=r,this._checker=l,this._ngZone=n,this._document=s,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,d||this.attachAnchors()}destroy(){let r=this._startAnchor,l=this._endAnchor;r&&(r.removeEventListener("focus",this.startAnchorListener),r.remove()),l&&(l.removeEventListener("focus",this.endAnchorListener),l.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return this._hasAttached?!0:(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(r){return new Promise(l=>{this._executeOnStable(()=>l(this.focusInitialElement(r)))})}focusFirstTabbableElementWhenReady(r){return new Promise(l=>{this._executeOnStable(()=>l(this.focusFirstTabbableElement(r)))})}focusLastTabbableElementWhenReady(r){return new Promise(l=>{this._executeOnStable(()=>l(this.focusLastTabbableElement(r)))})}_getRegionBoundary(r){let l=this._element.querySelectorAll(`[cdk-focus-region-${r}], [cdkFocusRegion${r}], [cdk-focus-${r}]`);return r=="start"?l.length?l[0]:this._getFirstTabbableElement(this._element):l.length?l[l.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(r){let l=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(l){if(!this._checker.isFocusable(l)){let n=this._getFirstTabbableElement(l);return n?.focus(r),!!n}return l.focus(r),!0}return this.focusFirstTabbableElement(r)}focusFirstTabbableElement(r){let l=this._getRegionBoundary("start");return l&&l.focus(r),!!l}focusLastTabbableElement(r){let l=this._getRegionBoundary("end");return l&&l.focus(r),!!l}hasAttached(){return this._hasAttached}_getFirstTabbableElement(r){if(this._checker.isFocusable(r)&&this._checker.isTabbable(r))return r;let l=r.children;for(let n=0;n<l.length;n++){let s=l[n].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(l[n]):null;if(s)return s}return null}_getLastTabbableElement(r){if(this._checker.isFocusable(r)&&this._checker.isTabbable(r))return r;let l=r.children;for(let n=l.length-1;n>=0;n--){let s=l[n].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(l[n]):null;if(s)return s}return null}_createAnchor(){let r=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,r),r.classList.add("cdk-visually-hidden"),r.classList.add("cdk-focus-trap-anchor"),r.setAttribute("aria-hidden","true"),r}_toggleAnchorTabIndex(r,l){r?l.setAttribute("tabindex","0"):l.removeAttribute("tabindex")}toggleAnchors(r){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(r,this._startAnchor),this._toggleAnchorTabIndex(r,this._endAnchor))}_executeOnStable(r){this._ngZone.isStable?r():this._ngZone.onStable.pipe(tn(1)).subscribe(r)}},ug=(()=>{let r=class r{constructor(n,s,d){this._checker=n,this._ngZone=s,this._document=d}create(n,s=!1){return new lM(n,this._checker,this._ngZone,this._document,s)}};r.\u0275fac=function(s){return new(s||r)(ht(dg),ht(Be),ht(ci))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),Cz=(()=>{let r=class r{get enabled(){return this.focusTrap?.enabled||!1}set enabled(n){this.focusTrap&&(this.focusTrap.enabled=n)}constructor(n,s,d){this._elementRef=n,this._focusTrapFactory=s,this._previouslyFocusedElement=null,le(gn).isBrowser&&(this.focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement,!0))}ngOnDestroy(){this.focusTrap?.destroy(),this._previouslyFocusedElement&&(this._previouslyFocusedElement.focus(),this._previouslyFocusedElement=null)}ngAfterContentInit(){this.focusTrap?.attachAnchors(),this.autoCapture&&this._captureFocus()}ngDoCheck(){this.focusTrap&&!this.focusTrap.hasAttached()&&this.focusTrap.attachAnchors()}ngOnChanges(n){let s=n.autoCapture;s&&!s.firstChange&&this.autoCapture&&this.focusTrap?.hasAttached()&&this._captureFocus()}_captureFocus(){this._previouslyFocusedElement=xd(),this.focusTrap?.focusInitialElementWhenReady()}};r.\u0275fac=function(s){return new(s||r)(V(Ee),V(ug),V(ci))},r.\u0275dir=oe({type:r,selectors:[["","cdkTrapFocus",""]],inputs:{enabled:[Rt.HasDecoratorInputTransform,"cdkTrapFocus","enabled",Qe],autoCapture:[Rt.HasDecoratorInputTransform,"cdkTrapFocusAutoCapture","autoCapture",Qe]},exportAs:["cdkTrapFocus"],standalone:!0,features:[Fn,Yn]});let a=r;return a})();function hg(a){return a.buttons===0||a.detail===0}function mg(a){let r=a.touches&&a.touches[0]||a.changedTouches&&a.changedTouches[0];return!!r&&r.identifier===-1&&(r.radiusX==null||r.radiusX===1)&&(r.radiusY==null||r.radiusY===1)}var qZ=new Se("cdk-input-modality-detector-options"),WZ={ignoreKeys:[18,17,224,91,16]},Sz=650,Sm=is({passive:!0,capture:!0}),$Z=(()=>{let r=class r{get mostRecentModality(){return this._modality.value}constructor(n,s,d,m){this._platform=n,this._mostRecentTarget=null,this._modality=new We(null),this._lastTouchMs=0,this._onKeydown=_=>{this._options?.ignoreKeys?.some(w=>w===_.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=dl(_))},this._onMousedown=_=>{Date.now()-this._lastTouchMs<Sz||(this._modality.next(hg(_)?"keyboard":"mouse"),this._mostRecentTarget=dl(_))},this._onTouchstart=_=>{if(mg(_)){this._modality.next("keyboard");return}this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=dl(_)},this._options=qt(qt({},WZ),m),this.modalityDetected=this._modality.pipe(_v(1)),this.modalityChanged=this.modalityDetected.pipe(gf()),n.isBrowser&&s.runOutsideAngular(()=>{d.addEventListener("keydown",this._onKeydown,Sm),d.addEventListener("mousedown",this._onMousedown,Sm),d.addEventListener("touchstart",this._onTouchstart,Sm)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,Sm),document.removeEventListener("mousedown",this._onMousedown,Sm),document.removeEventListener("touchstart",this._onTouchstart,Sm))}};r.\u0275fac=function(s){return new(s||r)(ht(gn),ht(Be),ht(ci),ht(qZ,8))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),YZ=new Se("liveAnnouncerElement",{providedIn:"root",factory:ZZ});function ZZ(){return null}var XZ=new Se("LIVE_ANNOUNCER_DEFAULT_OPTIONS"),KZ=0,Ay=(()=>{let r=class r{constructor(n,s,d,m){this._ngZone=s,this._defaultOptions=m,this._document=d,this._liveElement=n||this._createLiveElement()}announce(n,...s){let d=this._defaultOptions,m,_;return s.length===1&&typeof s[0]=="number"?_=s[0]:[m,_]=s,this.clear(),clearTimeout(this._previousTimeout),m||(m=d&&d.politeness?d.politeness:"polite"),_==null&&d&&(_=d.duration),this._liveElement.setAttribute("aria-live",m),this._liveElement.id&&this._exposeAnnouncerToModals(this._liveElement.id),this._ngZone.runOutsideAngular(()=>(this._currentPromise||(this._currentPromise=new Promise(w=>this._currentResolve=w)),clearTimeout(this._previousTimeout),this._previousTimeout=setTimeout(()=>{this._liveElement.textContent=n,typeof _=="number"&&(this._previousTimeout=setTimeout(()=>this.clear(),_)),this._currentResolve(),this._currentPromise=this._currentResolve=void 0},100),this._currentPromise))}clear(){this._liveElement&&(this._liveElement.textContent="")}ngOnDestroy(){clearTimeout(this._previousTimeout),this._liveElement?.remove(),this._liveElement=null,this._currentResolve?.(),this._currentPromise=this._currentResolve=void 0}_createLiveElement(){let n="cdk-live-announcer-element",s=this._document.getElementsByClassName(n),d=this._document.createElement("div");for(let m=0;m<s.length;m++)s[m].remove();return d.classList.add(n),d.classList.add("cdk-visually-hidden"),d.setAttribute("aria-atomic","true"),d.setAttribute("aria-live","polite"),d.id=`cdk-live-announcer-${KZ++}`,this._document.body.appendChild(d),d}_exposeAnnouncerToModals(n){let s=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let d=0;d<s.length;d++){let m=s[d],_=m.getAttribute("aria-owns");_?_.indexOf(n)===-1&&m.setAttribute("aria-owns",_+" "+n):m.setAttribute("aria-owns",n)}}};r.\u0275fac=function(s){return new(s||r)(ht(YZ,8),ht(Be),ht(ci),ht(XZ,8))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var Cy=function(a){return a[a.IMMEDIATE=0]="IMMEDIATE",a[a.EVENTUAL=1]="EVENTUAL",a}(Cy||{}),QZ=new Se("cdk-focus-monitor-default-options"),wy=is({passive:!0,capture:!0}),Bs=(()=>{let r=class r{constructor(n,s,d,m,_){this._ngZone=n,this._platform=s,this._inputModalityDetector=d,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new pe,this._rootNodeFocusAndBlurListener=w=>{let S=dl(w);for(let I=S;I;I=I.parentElement)w.type==="focus"?this._onFocus(w,I):this._onBlur(w,I)},this._document=m,this._detectionMode=_?.detectionMode||Cy.IMMEDIATE}monitor(n,s=!1){let d=zs(n);if(!this._platform.isBrowser||d.nodeType!==1)return Fe();let m=Q3(d)||this._getDocument(),_=this._elementInfo.get(d);if(_)return s&&(_.checkChildren=!0),_.subject;let w={checkChildren:s,subject:new pe,rootNode:m};return this._elementInfo.set(d,w),this._registerGlobalListeners(w),w.subject}stopMonitoring(n){let s=zs(n),d=this._elementInfo.get(s);d&&(d.subject.complete(),this._setClasses(s),this._elementInfo.delete(s),this._removeGlobalListeners(d))}focusVia(n,s,d){let m=zs(n),_=this._getDocument().activeElement;m===_?this._getClosestElementsInfo(m).forEach(([w,S])=>this._originChanged(w,s,S)):(this._setOrigin(s),typeof m.focus=="function"&&m.focus(d))}ngOnDestroy(){this._elementInfo.forEach((n,s)=>this.stopMonitoring(s))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(n){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(n)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:n&&this._isLastInteractionFromInputLabel(n)?"mouse":"program"}_shouldBeAttributedToTouch(n){return this._detectionMode===Cy.EVENTUAL||!!n?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(n,s){n.classList.toggle("cdk-focused",!!s),n.classList.toggle("cdk-touch-focused",s==="touch"),n.classList.toggle("cdk-keyboard-focused",s==="keyboard"),n.classList.toggle("cdk-mouse-focused",s==="mouse"),n.classList.toggle("cdk-program-focused",s==="program")}_setOrigin(n,s=!1){this._ngZone.runOutsideAngular(()=>{if(this._origin=n,this._originFromTouchInteraction=n==="touch"&&s,this._detectionMode===Cy.IMMEDIATE){clearTimeout(this._originTimeoutId);let d=this._originFromTouchInteraction?Sz:1;this._originTimeoutId=setTimeout(()=>this._origin=null,d)}})}_onFocus(n,s){let d=this._elementInfo.get(s),m=dl(n);!d||!d.checkChildren&&s!==m||this._originChanged(s,this._getFocusOrigin(m),d)}_onBlur(n,s){let d=this._elementInfo.get(s);!d||d.checkChildren&&n.relatedTarget instanceof Node&&s.contains(n.relatedTarget)||(this._setClasses(s),this._emitOrigin(d,null))}_emitOrigin(n,s){n.subject.observers.length&&this._ngZone.run(()=>n.subject.next(s))}_registerGlobalListeners(n){if(!this._platform.isBrowser)return;let s=n.rootNode,d=this._rootNodeFocusListenerCount.get(s)||0;d||this._ngZone.runOutsideAngular(()=>{s.addEventListener("focus",this._rootNodeFocusAndBlurListener,wy),s.addEventListener("blur",this._rootNodeFocusAndBlurListener,wy)}),this._rootNodeFocusListenerCount.set(s,d+1),++this._monitoredElementCount===1&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(ni(this._stopInputModalityDetector)).subscribe(m=>{this._setOrigin(m,!0)}))}_removeGlobalListeners(n){let s=n.rootNode;if(this._rootNodeFocusListenerCount.has(s)){let d=this._rootNodeFocusListenerCount.get(s);d>1?this._rootNodeFocusListenerCount.set(s,d-1):(s.removeEventListener("focus",this._rootNodeFocusAndBlurListener,wy),s.removeEventListener("blur",this._rootNodeFocusAndBlurListener,wy),this._rootNodeFocusListenerCount.delete(s))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(n,s,d){this._setClasses(n,s),this._emitOrigin(d,s),this._lastFocusOrigin=s}_getClosestElementsInfo(n){let s=[];return this._elementInfo.forEach((d,m)=>{(m===n||d.checkChildren&&m.contains(n))&&s.push([m,d])}),s}_isLastInteractionFromInputLabel(n){let{_mostRecentTarget:s,mostRecentModality:d}=this._inputModalityDetector;if(d!=="mouse"||!s||s===n||n.nodeName!=="INPUT"&&n.nodeName!=="TEXTAREA"||n.disabled)return!1;let m=n.labels;if(m){for(let _=0;_<m.length;_++)if(m[_].contains(s))return!0}return!1}};r.\u0275fac=function(s){return new(s||r)(ht(Be),ht(gn),ht($Z),ht(ci,8),ht(QZ,8))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),Ez=(()=>{let r=class r{constructor(n,s){this._elementRef=n,this._focusMonitor=s,this._focusOrigin=null,this.cdkFocusChange=new ye}get focusOrigin(){return this._focusOrigin}ngAfterViewInit(){let n=this._elementRef.nativeElement;this._monitorSubscription=this._focusMonitor.monitor(n,n.nodeType===1&&n.hasAttribute("cdkMonitorSubtreeFocus")).subscribe(s=>{this._focusOrigin=s,this.cdkFocusChange.emit(s)})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._monitorSubscription&&this._monitorSubscription.unsubscribe()}};r.\u0275fac=function(s){return new(s||r)(V(Ee),V(Bs))},r.\u0275dir=oe({type:r,selectors:[["","cdkMonitorElementFocus",""],["","cdkMonitorSubtreeFocus",""]],outputs:{cdkFocusChange:"cdkFocusChange"},exportAs:["cdkMonitorFocus"],standalone:!0});let a=r;return a})();var JZ=["text"];function tX(a,r){if(a&1&&dt(0,"mat-pseudo-checkbox",6),a&2){let l=gt();W("disabled",l.disabled)("state",l.selected?"checked":"unchecked")}}function eX(a,r){if(a&1&&dt(0,"mat-pseudo-checkbox",7),a&2){let l=gt();W("disabled",l.disabled)}}function iX(a,r){if(a&1&&(T(0,"span",8),B(1),k()),a&2){let l=gt();z(),ie("(",l.group.label,")")}}var nX=[[["mat-icon"]],"*"],rX=["mat-icon","*"];var Fz=(()=>{let r=class r{};r.STANDARD_CURVE="cubic-bezier(0.4,0.0,0.2,1)",r.DECELERATION_CURVE="cubic-bezier(0.0,0.0,0.2,1)",r.ACCELERATION_CURVE="cubic-bezier(0.4,0.0,1,1)",r.SHARP_CURVE="cubic-bezier(0.4,0.0,0.6,1)";let a=r;return a})(),Lz=(()=>{let r=class r{};r.COMPLEX="375ms",r.ENTERING="225ms",r.EXITING="195ms";let a=r;return a})();var Ou=class{constructor(r,l,n,s,d){this._defaultMatcher=r,this.ngControl=l,this._parentFormGroup=n,this._parentForm=s,this._stateChanges=d,this.errorState=!1}updateErrorState(){let r=this.errorState,l=this._parentFormGroup||this._parentForm,n=this.matcher||this._defaultMatcher,s=this.ngControl?this.ngControl.control:null,d=n?.isErrorState(s,l)??!1;d!==r&&(this.errorState=d,this._stateChanges.next())}};function Ry(a){return class extends a{constructor(...r){super(...r),this._isInitialized=!1,this._pendingSubscribers=[],this.initialized=new ya(l=>{this._isInitialized?this._notifySubscriber(l):this._pendingSubscribers.push(l)})}_markInitialized(){this._isInitialized,this._isInitialized=!0,this._pendingSubscribers.forEach(this._notifySubscriber),this._pendingSubscribers=null}_notifySubscriber(r){r.next(),r.complete()}}}var Mz=new Se("MAT_DATE_LOCALE",{providedIn:"root",factory:oX});function oX(){return le(eL)}var Qo=class{constructor(){this._localeChanges=new pe,this.localeChanges=this._localeChanges}getValidDateOrNull(r){return this.isDateInstance(r)&&this.isValid(r)?r:null}deserialize(r){return r==null||this.isDateInstance(r)&&this.isValid(r)?r:this.invalid()}setLocale(r){this.locale=r,this._localeChanges.next()}compareDate(r,l){return this.getYear(r)-this.getYear(l)||this.getMonth(r)-this.getMonth(l)||this.getDate(r)-this.getDate(l)}sameDate(r,l){if(r&&l){let n=this.isValid(r),s=this.isValid(l);return n&&s?!this.compareDate(r,l):n==s}return r==l}clampDate(r,l,n){return l&&this.compareDate(r,l)<0?l:n&&this.compareDate(r,n)>0?n:r}},Ed=new Se("mat-date-formats"),sX=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|(?:(?:\+|-)\d{2}:\d{2}))?)?$/;function uM(a,r){let l=Array(a);for(let n=0;n<a;n++)l[n]=r(n);return l}var aX=(()=>{let r=class r extends Qo{constructor(n){super(),this.useUtcForDisplay=!1,this._matDateLocale=le(Mz,{optional:!0}),n!==void 0&&(this._matDateLocale=n),super.setLocale(this._matDateLocale)}getYear(n){return n.getFullYear()}getMonth(n){return n.getMonth()}getDate(n){return n.getDate()}getDayOfWeek(n){return n.getDay()}getMonthNames(n){let s=new Intl.DateTimeFormat(this.locale,{month:n,timeZone:"utc"});return uM(12,d=>this._format(s,new Date(2017,d,1)))}getDateNames(){let n=new Intl.DateTimeFormat(this.locale,{day:"numeric",timeZone:"utc"});return uM(31,s=>this._format(n,new Date(2017,0,s+1)))}getDayOfWeekNames(n){let s=new Intl.DateTimeFormat(this.locale,{weekday:n,timeZone:"utc"});return uM(7,d=>this._format(s,new Date(2017,0,d+1)))}getYearName(n){let s=new Intl.DateTimeFormat(this.locale,{year:"numeric",timeZone:"utc"});return this._format(s,n)}getFirstDayOfWeek(){return 0}getNumDaysInMonth(n){return this.getDate(this._createDateWithOverflow(this.getYear(n),this.getMonth(n)+1,0))}clone(n){return new Date(n.getTime())}createDate(n,s,d){let m=this._createDateWithOverflow(n,s,d);return m.getMonth()!=s,m}today(){return new Date}parse(n,s){return typeof n=="number"?new Date(n):n?new Date(Date.parse(n)):null}format(n,s){if(!this.isValid(n))throw Error("NativeDateAdapter: Cannot format invalid date.");let d=new Intl.DateTimeFormat(this.locale,Pi(qt({},s),{timeZone:"utc"}));return this._format(d,n)}addCalendarYears(n,s){return this.addCalendarMonths(n,s*12)}addCalendarMonths(n,s){let d=this._createDateWithOverflow(this.getYear(n),this.getMonth(n)+s,this.getDate(n));return this.getMonth(d)!=((this.getMonth(n)+s)%12+12)%12&&(d=this._createDateWithOverflow(this.getYear(d),this.getMonth(d),0)),d}addCalendarDays(n,s){return this._createDateWithOverflow(this.getYear(n),this.getMonth(n),this.getDate(n)+s)}toIso8601(n){return[n.getUTCFullYear(),this._2digit(n.getUTCMonth()+1),this._2digit(n.getUTCDate())].join("-")}deserialize(n){if(typeof n=="string"){if(!n)return null;if(sX.test(n)){let s=new Date(n);if(this.isValid(s))return s}}return super.deserialize(n)}isDateInstance(n){return n instanceof Date}isValid(n){return!isNaN(n.getTime())}invalid(){return new Date(NaN)}_createDateWithOverflow(n,s,d){let m=new Date;return m.setFullYear(n,s,d),m.setHours(0,0,0,0),m}_2digit(n){return("00"+n).slice(-2)}_format(n,s){let d=new Date;return d.setUTCFullYear(s.getFullYear(),s.getMonth(),s.getDate()),d.setUTCHours(s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()),n.format(d)}};r.\u0275fac=function(s){return new(s||r)(ht(Mz,8))},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})(),lX={parse:{dateInput:null},display:{dateInput:{year:"numeric",month:"numeric",day:"numeric"},monthYearLabel:{year:"numeric",month:"short"},dateA11yLabel:{year:"numeric",month:"long",day:"numeric"},monthYearA11yLabel:{year:"numeric",month:"long"}}};function Py(a=lX){return[{provide:Qo,useClass:aX},{provide:Ed,useValue:a}]}var fg=(()=>{let r=class r{isErrorState(n,s){return!!(n&&n.invalid&&(n.touched||s&&s.submitted))}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var Ta=function(a){return a[a.FADING_IN=0]="FADING_IN",a[a.VISIBLE=1]="VISIBLE",a[a.FADING_OUT=2]="FADING_OUT",a[a.HIDDEN=3]="HIDDEN",a}(Ta||{}),pM=class{constructor(r,l,n,s=!1){this._renderer=r,this.element=l,this.config=n,this._animationForciblyDisabledThroughCss=s,this.state=Ta.HIDDEN}fadeOut(){this._renderer.fadeOutRipple(this)}},Dz=is({passive:!0,capture:!0}),fM=class{constructor(){this._events=new Map,this._delegateEventHandler=r=>{let l=dl(r);l&&this._events.get(r.type)?.forEach((n,s)=>{(s===l||s.contains(l))&&n.forEach(d=>d.handleEvent(r))})}}addHandler(r,l,n,s){let d=this._events.get(l);if(d){let m=d.get(n);m?m.add(s):d.set(n,new Set([s]))}else this._events.set(l,new Map([[n,new Set([s])]])),r.runOutsideAngular(()=>{document.addEventListener(l,this._delegateEventHandler,Dz)})}removeHandler(r,l,n){let s=this._events.get(r);if(!s)return;let d=s.get(l);d&&(d.delete(n),d.size===0&&s.delete(l),s.size===0&&(this._events.delete(r),document.removeEventListener(r,this._delegateEventHandler,Dz)))}},Tz={enterDuration:225,exitDuration:150},cX=800,Iz=is({passive:!0,capture:!0}),Az=["mousedown","touchstart"],kz=["mouseup","mouseleave","touchend","touchcancel"],pg=class pg{constructor(r,l,n,s){this._target=r,this._ngZone=l,this._platform=s,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,s.isBrowser&&(this._containerElement=zs(n))}fadeInRipple(r,l,n={}){let s=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),d=qt(qt({},Tz),n.animation);n.centered&&(r=s.left+s.width/2,l=s.top+s.height/2);let m=n.radius||dX(r,l,s),_=r-s.left,w=l-s.top,S=d.enterDuration,I=document.createElement("div");I.classList.add("mat-ripple-element"),I.style.left=`${_-m}px`,I.style.top=`${w-m}px`,I.style.height=`${m*2}px`,I.style.width=`${m*2}px`,n.color!=null&&(I.style.backgroundColor=n.color),I.style.transitionDuration=`${S}ms`,this._containerElement.appendChild(I);let L=window.getComputedStyle(I),H=L.transitionProperty,q=L.transitionDuration,X=H==="none"||q==="0s"||q==="0s, 0s"||s.width===0&&s.height===0,it=new pM(this,I,n,X);I.style.transform="scale3d(1, 1, 1)",it.state=Ta.FADING_IN,n.persistent||(this._mostRecentTransientRipple=it);let at=null;return!X&&(S||d.exitDuration)&&this._ngZone.runOutsideAngular(()=>{let mt=()=>this._finishRippleTransition(it),Mt=()=>this._destroyRipple(it);I.addEventListener("transitionend",mt),I.addEventListener("transitioncancel",Mt),at={onTransitionEnd:mt,onTransitionCancel:Mt}}),this._activeRipples.set(it,at),(X||!S)&&this._finishRippleTransition(it),it}fadeOutRipple(r){if(r.state===Ta.FADING_OUT||r.state===Ta.HIDDEN)return;let l=r.element,n=qt(qt({},Tz),r.config.animation);l.style.transitionDuration=`${n.exitDuration}ms`,l.style.opacity="0",r.state=Ta.FADING_OUT,(r._animationForciblyDisabledThroughCss||!n.exitDuration)&&this._finishRippleTransition(r)}fadeOutAll(){this._getActiveRipples().forEach(r=>r.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(r=>{r.config.persistent||r.fadeOut()})}setupTriggerEvents(r){let l=zs(r);!this._platform.isBrowser||!l||l===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=l,Az.forEach(n=>{pg._eventManager.addHandler(this._ngZone,n,l,this)}))}handleEvent(r){r.type==="mousedown"?this._onMousedown(r):r.type==="touchstart"?this._onTouchStart(r):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{kz.forEach(l=>{this._triggerElement.addEventListener(l,this,Iz)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(r){r.state===Ta.FADING_IN?this._startFadeOutTransition(r):r.state===Ta.FADING_OUT&&this._destroyRipple(r)}_startFadeOutTransition(r){let l=r===this._mostRecentTransientRipple,{persistent:n}=r.config;r.state=Ta.VISIBLE,!n&&(!l||!this._isPointerDown)&&r.fadeOut()}_destroyRipple(r){let l=this._activeRipples.get(r)??null;this._activeRipples.delete(r),this._activeRipples.size||(this._containerRect=null),r===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),r.state=Ta.HIDDEN,l!==null&&(r.element.removeEventListener("transitionend",l.onTransitionEnd),r.element.removeEventListener("transitioncancel",l.onTransitionCancel)),r.element.remove()}_onMousedown(r){let l=hg(r),n=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+cX;!this._target.rippleDisabled&&!l&&!n&&(this._isPointerDown=!0,this.fadeInRipple(r.clientX,r.clientY,this._target.rippleConfig))}_onTouchStart(r){if(!this._target.rippleDisabled&&!mg(r)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;let l=r.changedTouches;if(l)for(let n=0;n<l.length;n++)this.fadeInRipple(l[n].clientX,l[n].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(r=>{let l=r.state===Ta.VISIBLE||r.config.terminateOnPointerUp&&r.state===Ta.FADING_IN;!r.config.persistent&&l&&r.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){let r=this._triggerElement;r&&(Az.forEach(l=>pg._eventManager.removeHandler(l,r,this)),this._pointerUpEventsRegistered&&kz.forEach(l=>r.removeEventListener(l,this,Iz)))}};pg._eventManager=new fM;var gM=pg;function dX(a,r,l){let n=Math.max(Math.abs(a-l.left),Math.abs(a-l.right)),s=Math.max(Math.abs(r-l.top),Math.abs(r-l.bottom));return Math.sqrt(n*n+s*s)}var zz=new Se("mat-ripple-global-options"),Oy=(()=>{let r=class r{get disabled(){return this._disabled}set disabled(n){n&&this.fadeOutAllNonPersistent(),this._disabled=n,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(n){this._trigger=n,this._setupTriggerEventsIfEnabled()}constructor(n,s,d,m,_){this._elementRef=n,this._animationMode=_,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=m||{},this._rippleRenderer=new gM(this,s,n,d)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:qt(qt(qt({},this._globalOptions.animation),this._animationMode==="NoopAnimations"?{enterDuration:0,exitDuration:0}:{}),this.animation),terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(n,s=0,d){return typeof n=="number"?this._rippleRenderer.fadeInRipple(n,s,qt(qt({},this.rippleConfig),d)):this._rippleRenderer.fadeInRipple(0,0,qt(qt({},this.rippleConfig),n))}};r.\u0275fac=function(s){return new(s||r)(V(Ee),V(Be),V(gn),V(zz,8),V(Eo,8))},r.\u0275dir=oe({type:r,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(s,d){s&2&&li("mat-ripple-unbounded",d.unbounded)},inputs:{color:[Rt.None,"matRippleColor","color"],unbounded:[Rt.None,"matRippleUnbounded","unbounded"],centered:[Rt.None,"matRippleCentered","centered"],radius:[Rt.None,"matRippleRadius","radius"],animation:[Rt.None,"matRippleAnimation","animation"],disabled:[Rt.None,"matRippleDisabled","disabled"],trigger:[Rt.None,"matRippleTrigger","trigger"]},exportAs:["matRipple"],standalone:!0});let a=r;return a})();var uX=(()=>{let r=class r{constructor(n){this._animationMode=n,this.state="unchecked",this.disabled=!1,this.appearance="full"}};r.\u0275fac=function(s){return new(s||r)(V(Eo,8))},r.\u0275cmp=St({type:r,selectors:[["mat-pseudo-checkbox"]],hostAttrs:[1,"mat-pseudo-checkbox"],hostVars:12,hostBindings:function(s,d){s&2&&li("mat-pseudo-checkbox-indeterminate",d.state==="indeterminate")("mat-pseudo-checkbox-checked",d.state==="checked")("mat-pseudo-checkbox-disabled",d.disabled)("mat-pseudo-checkbox-minimal",d.appearance==="minimal")("mat-pseudo-checkbox-full",d.appearance==="full")("_mat-animation-noopable",d._animationMode==="NoopAnimations")},inputs:{state:"state",disabled:"disabled",appearance:"appearance"},standalone:!0,features:[At],decls:0,vars:0,template:function(s,d){},styles:['.mat-pseudo-checkbox{border-radius:2px;cursor:pointer;display:inline-block;vertical-align:middle;box-sizing:border-box;position:relative;flex-shrink:0;transition:border-color 90ms cubic-bezier(0, 0, 0.2, 0.1),background-color 90ms cubic-bezier(0, 0, 0.2, 0.1)}.mat-pseudo-checkbox::after{position:absolute;opacity:0;content:"";border-bottom:2px solid currentColor;transition:opacity 90ms cubic-bezier(0, 0, 0.2, 0.1)}.mat-pseudo-checkbox._mat-animation-noopable{transition:none !important;animation:none !important}.mat-pseudo-checkbox._mat-animation-noopable::after{transition:none}.mat-pseudo-checkbox-disabled{cursor:default}.mat-pseudo-checkbox-indeterminate::after{left:1px;opacity:1;border-radius:2px}.mat-pseudo-checkbox-checked::after{left:1px;border-left:2px solid currentColor;transform:rotate(-45deg);opacity:1;box-sizing:content-box}.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-checked::after,.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-indeterminate::after{color:var(--mat-minimal-pseudo-checkbox-selected-checkmark-color)}.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-checked.mat-pseudo-checkbox-disabled::after,.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-indeterminate.mat-pseudo-checkbox-disabled::after{color:var(--mat-minimal-pseudo-checkbox-disabled-selected-checkmark-color)}.mat-pseudo-checkbox-full{border-color:var(--mat-full-pseudo-checkbox-unselected-icon-color);border-width:2px;border-style:solid}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-disabled{border-color:var(--mat-full-pseudo-checkbox-disabled-unselected-icon-color)}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-checked,.mat-pseudo-checkbox-full.mat-pseudo-checkbox-indeterminate{background-color:var(--mat-full-pseudo-checkbox-selected-icon-color);border-color:rgba(0,0,0,0)}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-checked::after,.mat-pseudo-checkbox-full.mat-pseudo-checkbox-indeterminate::after{color:var(--mat-full-pseudo-checkbox-selected-checkmark-color)}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-checked.mat-pseudo-checkbox-disabled,.mat-pseudo-checkbox-full.mat-pseudo-checkbox-indeterminate.mat-pseudo-checkbox-disabled{background-color:var(--mat-full-pseudo-checkbox-disabled-selected-icon-color)}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-checked.mat-pseudo-checkbox-disabled::after,.mat-pseudo-checkbox-full.mat-pseudo-checkbox-indeterminate.mat-pseudo-checkbox-disabled::after{color:var(--mat-full-pseudo-checkbox-disabled-selected-checkmark-color)}.mat-pseudo-checkbox{width:18px;height:18px}.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-checked::after{width:14px;height:6px;transform-origin:center;top:-4.2426406871px;left:0;bottom:0;right:0;margin:auto}.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-indeterminate::after{top:8px;width:16px}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-checked::after{width:10px;height:4px;transform-origin:center;top:-2.8284271247px;left:0;bottom:0;right:0;margin:auto}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-indeterminate::after{top:6px;width:12px}'],encapsulation:2,changeDetection:0});let a=r;return a})();var vM=new Se("MAT_OPTION_PARENT_COMPONENT");var yM=new Se("MatOptgroup");var hX=0,_M=class{constructor(r,l=!1){this.source=r,this.isUserInput=l}},Fy=(()=>{let r=class r{get multiple(){return this._parent&&this._parent.multiple}get selected(){return this._selected}get disabled(){return this.group&&this.group.disabled||this._disabled}set disabled(n){this._disabled=n}get disableRipple(){return!!(this._parent&&this._parent.disableRipple)}get hideSingleSelectionIndicator(){return!!(this._parent&&this._parent.hideSingleSelectionIndicator)}constructor(n,s,d,m){this._element=n,this._changeDetectorRef=s,this._parent=d,this.group=m,this._selected=!1,this._active=!1,this._disabled=!1,this._mostRecentViewValue="",this.id=`mat-option-${hX++}`,this.onSelectionChange=new ye,this._stateChanges=new pe}get active(){return this._active}get viewValue(){return(this._text?.nativeElement.textContent||"").trim()}select(n=!0){this._selected||(this._selected=!0,this._changeDetectorRef.markForCheck(),n&&this._emitSelectionChangeEvent())}deselect(n=!0){this._selected&&(this._selected=!1,this._changeDetectorRef.markForCheck(),n&&this._emitSelectionChangeEvent())}focus(n,s){let d=this._getHostElement();typeof d.focus=="function"&&d.focus(s)}setActiveStyles(){this._active||(this._active=!0,this._changeDetectorRef.markForCheck())}setInactiveStyles(){this._active&&(this._active=!1,this._changeDetectorRef.markForCheck())}getLabel(){return this.viewValue}_handleKeydown(n){(n.keyCode===13||n.keyCode===32)&&!Zr(n)&&(this._selectViaInteraction(),n.preventDefault())}_selectViaInteraction(){this.disabled||(this._selected=this.multiple?!this._selected:!0,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent(!0))}_getTabIndex(){return this.disabled?"-1":"0"}_getHostElement(){return this._element.nativeElement}ngAfterViewChecked(){if(this._selected){let n=this.viewValue;n!==this._mostRecentViewValue&&(this._mostRecentViewValue&&this._stateChanges.next(),this._mostRecentViewValue=n)}}ngOnDestroy(){this._stateChanges.complete()}_emitSelectionChangeEvent(n=!1){this.onSelectionChange.emit(new _M(this,n))}};r.\u0275fac=function(s){return new(s||r)(V(Ee),V(Zi),V(vM,8),V(yM,8))},r.\u0275cmp=St({type:r,selectors:[["mat-option"]],viewQuery:function(s,d){if(s&1&&ze(JZ,7),s&2){let m;se(m=ae())&&(d._text=m.first)}},hostAttrs:["role","option",1,"mat-mdc-option","mdc-list-item"],hostVars:11,hostBindings:function(s,d){s&1&&ct("click",function(){return d._selectViaInteraction()})("keydown",function(_){return d._handleKeydown(_)}),s&2&&(Os("id",d.id),ri("aria-selected",d.selected)("aria-disabled",d.disabled.toString()),li("mdc-list-item--selected",d.selected)("mat-mdc-option-multiple",d.multiple)("mat-mdc-option-active",d.active)("mdc-list-item--disabled",d.disabled))},inputs:{value:"value",id:"id",disabled:[Rt.HasDecoratorInputTransform,"disabled","disabled",Qe]},outputs:{onSelectionChange:"onSelectionChange"},exportAs:["matOption"],standalone:!0,features:[Fn,At],ngContentSelectors:rX,decls:8,vars:5,consts:[["class","mat-mdc-option-pseudo-checkbox","aria-hidden","true",3,"disabled","state"],[1,"mdc-list-item__primary-text"],["text",""],["class","mat-mdc-option-pseudo-checkbox","state","checked","aria-hidden","true","appearance","minimal",3,"disabled"],["class","cdk-visually-hidden"],["aria-hidden","true","mat-ripple","",1,"mat-mdc-option-ripple","mat-mdc-focus-indicator",3,"matRippleTrigger","matRippleDisabled"],["aria-hidden","true",1,"mat-mdc-option-pseudo-checkbox",3,"disabled","state"],["state","checked","aria-hidden","true","appearance","minimal",1,"mat-mdc-option-pseudo-checkbox",3,"disabled"],[1,"cdk-visually-hidden"]],template:function(s,d){s&1&&(Un(nX),ut(0,tX,1,2,"mat-pseudo-checkbox",0),Ai(1),T(2,"span",1,2),Ai(4,1),k(),ut(5,eX,1,1,"mat-pseudo-checkbox",3)(6,iX,2,1,"span",4),dt(7,"div",5)),s&2&&(Xi(0,d.multiple?0:-1),z(5),Xi(5,!d.multiple&&d.selected&&!d.hideSingleSelectionIndicator?5:-1),z(),Xi(6,d.group&&d.group._inert?6:-1),z(),W("matRippleTrigger",d._getHostElement())("matRippleDisabled",d.disabled||d.disableRipple))},dependencies:[uX,Oy],styles:['.mat-mdc-option{display:flex;position:relative;align-items:center;justify-content:flex-start;overflow:hidden;padding:0;padding-left:16px;padding-right:16px;-webkit-user-select:none;user-select:none;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;cursor:pointer;-webkit-tap-highlight-color:rgba(0,0,0,0);color:var(--mat-option-label-text-color);font-family:var(--mat-option-label-text-font);line-height:var(--mat-option-label-text-line-height);font-size:var(--mat-option-label-text-size);letter-spacing:var(--mat-option-label-text-tracking);font-weight:var(--mat-option-label-text-weight);min-height:48px}.mat-mdc-option:focus{outline:none}[dir=rtl] .mat-mdc-option,.mat-mdc-option[dir=rtl]{padding-left:16px;padding-right:16px}.mat-mdc-option:hover:not(.mdc-list-item--disabled){background-color:var(--mat-option-hover-state-layer-color)}.mat-mdc-option:focus.mdc-list-item,.mat-mdc-option.mat-mdc-option-active.mdc-list-item{background-color:var(--mat-option-focus-state-layer-color)}.mat-mdc-option.mdc-list-item--selected:not(.mdc-list-item--disabled) .mdc-list-item__primary-text{color:var(--mat-option-selected-state-label-text-color)}.mat-mdc-option.mdc-list-item--selected:not(.mdc-list-item--disabled):not(.mat-mdc-option-multiple){background-color:var(--mat-option-selected-state-layer-color)}.mat-mdc-option.mdc-list-item{align-items:center;background:rgba(0,0,0,0)}.mat-mdc-option.mdc-list-item--disabled{cursor:default;pointer-events:none}.mat-mdc-option.mdc-list-item--disabled .mat-mdc-option-pseudo-checkbox,.mat-mdc-option.mdc-list-item--disabled .mdc-list-item__primary-text,.mat-mdc-option.mdc-list-item--disabled>mat-icon{opacity:.38}.mat-mdc-optgroup .mat-mdc-option:not(.mat-mdc-option-multiple){padding-left:32px}[dir=rtl] .mat-mdc-optgroup .mat-mdc-option:not(.mat-mdc-option-multiple){padding-left:16px;padding-right:32px}.mat-mdc-option .mat-icon,.mat-mdc-option .mat-pseudo-checkbox-full{margin-right:16px;flex-shrink:0}[dir=rtl] .mat-mdc-option .mat-icon,[dir=rtl] .mat-mdc-option .mat-pseudo-checkbox-full{margin-right:0;margin-left:16px}.mat-mdc-option .mat-pseudo-checkbox-minimal{margin-left:16px;flex-shrink:0}[dir=rtl] .mat-mdc-option .mat-pseudo-checkbox-minimal{margin-right:16px;margin-left:0}.mat-mdc-option .mat-mdc-option-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-mdc-option .mdc-list-item__primary-text{white-space:normal;font-size:inherit;font-weight:inherit;letter-spacing:inherit;line-height:inherit;font-family:inherit;text-decoration:inherit;text-transform:inherit;margin-right:auto}[dir=rtl] .mat-mdc-option .mdc-list-item__primary-text{margin-right:0;margin-left:auto}.cdk-high-contrast-active .mat-mdc-option.mdc-list-item--selected:not(.mat-mdc-option-multiple)::after{content:"";position:absolute;top:50%;right:16px;transform:translateY(-50%);width:10px;height:0;border-bottom:solid 10px;border-radius:10px}[dir=rtl] .cdk-high-contrast-active .mat-mdc-option.mdc-list-item--selected:not(.mat-mdc-option-multiple)::after{right:auto;left:16px}.mat-mdc-option-multiple{--mdc-list-list-item-selected-container-color:var(--mdc-list-list-item-container-color, transparent)}.mat-mdc-option-active .mat-mdc-focus-indicator::before{content:""}'],encapsulation:2,changeDetection:0});let a=r;return a})();function Nz(a,r,l){if(l.length){let n=r.toArray(),s=l.toArray(),d=0;for(let m=0;m<a+1;m++)n[m].group&&n[m].group===s[d]&&d++;return d}return 0}function Bz(a,r,l,n){return a<l?a:a+r>l+n?Math.max(0,a-n+r):l}var Rz={capture:!0},Pz=["focus","click","mouseenter","touchstart"],hM="mat-ripple-loader-uninitialized",mM="mat-ripple-loader-class-name",Oz="mat-ripple-loader-centered",ky="mat-ripple-loader-disabled",Vz=(()=>{let r=class r{constructor(){this._document=le(ci,{optional:!0}),this._animationMode=le(Eo,{optional:!0}),this._globalRippleOptions=le(zz,{optional:!0}),this._platform=le(gn),this._ngZone=le(Be),this._hosts=new Map,this._onInteraction=n=>{if(!(n.target instanceof HTMLElement))return;let d=n.target.closest(`[${hM}]`);d&&this._createRipple(d)},this._ngZone.runOutsideAngular(()=>{for(let n of Pz)this._document?.addEventListener(n,this._onInteraction,Rz)})}ngOnDestroy(){let n=this._hosts.keys();for(let s of n)this.destroyRipple(s);for(let s of Pz)this._document?.removeEventListener(s,this._onInteraction,Rz)}configureRipple(n,s){n.setAttribute(hM,""),(s.className||!n.hasAttribute(mM))&&n.setAttribute(mM,s.className||""),s.centered&&n.setAttribute(Oz,""),s.disabled&&n.setAttribute(ky,"")}getRipple(n){return this._hosts.get(n)||this._createRipple(n)}setDisabled(n,s){let d=this._hosts.get(n);if(d){d.disabled=s;return}s?n.setAttribute(ky,""):n.removeAttribute(ky)}_createRipple(n){if(!this._document)return;let s=this._hosts.get(n);if(s)return s;n.querySelector(".mat-ripple")?.remove();let d=this._document.createElement("span");d.classList.add("mat-ripple",n.getAttribute(mM)),n.append(d);let m=new Oy(new Ee(d),this._ngZone,this._platform,this._globalRippleOptions?this._globalRippleOptions:void 0,this._animationMode?this._animationMode:void 0);return m._isInitialized=!0,m.trigger=n,m.centered=n.hasAttribute(Oz),m.disabled=n.hasAttribute(ky),this.attachRipple(n,m),m}attachRipple(n,s){n.removeAttribute(hM),this._hosts.set(n,s)}destroyRipple(n){let s=this._hosts.get(n);s&&(s.ngOnDestroy(),this._hosts.delete(n))}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var pX=["mat-button",""],fX=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],gX=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"];var _X=".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}";var vX=["mat-icon-button",""],yX=["*"];var bX=new Se("MAT_BUTTON_CONFIG");var xX=[{attribute:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{attribute:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{attribute:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{attribute:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{attribute:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab"]},{attribute:"mat-mini-fab",mdcClasses:["mdc-fab","mdc-fab--mini","mat-mdc-mini-fab"]},{attribute:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}],jz=(()=>{let r=class r{get ripple(){return this._rippleLoader?.getRipple(this._elementRef.nativeElement)}set ripple(n){this._rippleLoader?.attachRipple(this._elementRef.nativeElement,n)}get disableRipple(){return this._disableRipple}set disableRipple(n){this._disableRipple=n,this._updateRippleDisabled()}get disabled(){return this._disabled}set disabled(n){this._disabled=n,this._updateRippleDisabled()}constructor(n,s,d,m){this._elementRef=n,this._platform=s,this._ngZone=d,this._animationMode=m,this._focusMonitor=le(Bs),this._rippleLoader=le(Vz),this._isFab=!1,this._disableRipple=!1,this._disabled=!1;let _=le(bX,{optional:!0}),w=n.nativeElement,S=w.classList;this.disabledInteractive=_?.disabledInteractive??!1,this._rippleLoader?.configureRipple(w,{className:"mat-mdc-button-ripple"});for(let{attribute:I,mdcClasses:L}of xX)w.hasAttribute(I)&&S.add(...L)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._rippleLoader?.destroyRipple(this._elementRef.nativeElement)}focus(n="program",s){n?this._focusMonitor.focusVia(this._elementRef.nativeElement,n,s):this._elementRef.nativeElement.focus(s)}_getAriaDisabled(){return this.ariaDisabled!=null?this.ariaDisabled:this.disabled&&this.disabledInteractive?!0:null}_getDisabledAttribute(){return this.disabledInteractive||!this.disabled?null:!0}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}};r.\u0275fac=function(s){xu()},r.\u0275dir=oe({type:r,inputs:{color:"color",disableRipple:[Rt.HasDecoratorInputTransform,"disableRipple","disableRipple",Qe],disabled:[Rt.HasDecoratorInputTransform,"disabled","disabled",Qe],ariaDisabled:[Rt.HasDecoratorInputTransform,"aria-disabled","ariaDisabled",Qe],disabledInteractive:[Rt.HasDecoratorInputTransform,"disabledInteractive","disabledInteractive",Qe]},features:[Fn]});let a=r;return a})();var ea=(()=>{let r=class r extends jz{constructor(n,s,d,m){super(n,s,d,m)}};r.\u0275fac=function(s){return new(s||r)(V(Ee),V(gn),V(Be),V(Eo,8))},r.\u0275cmp=St({type:r,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostVars:14,hostBindings:function(s,d){s&2&&(ri("disabled",d._getDisabledAttribute())("aria-disabled",d._getAriaDisabled()),al(d.color?"mat-"+d.color:""),li("mat-mdc-button-disabled",d.disabled)("mat-mdc-button-disabled-interactive",d.disabledInteractive)("_mat-animation-noopable",d._animationMode==="NoopAnimations")("mat-unthemed",!d.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],standalone:!0,features:[Di,At],attrs:pX,ngContentSelectors:gX,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(s,d){s&1&&(Un(fX),dt(0,"span",0),Ai(1),T(2,"span",1),Ai(3,1),k(),Ai(4,2),dt(5,"span",2)(6,"span",3)),s&2&&li("mdc-button__ripple",!d._isFab)("mdc-fab__ripple",d._isFab)},styles:['.mdc-touch-target-wrapper{display:inline}.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button{position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;user-select:none;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0)}.mdc-button .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top}[dir=rtl] .mdc-button .mdc-button__icon,.mdc-button .mdc-button__icon[dir=rtl]{margin-left:8px;margin-right:0}.mdc-button .mdc-button__progress-indicator{font-size:0;position:absolute;transform:translate(-50%, -50%);top:50%;left:50%;line-height:initial}.mdc-button .mdc-button__label{position:relative}.mdc-button .mdc-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px);display:none}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring{border-color:CanvasText}}.mdc-button .mdc-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring::after{border-color:CanvasText}}@media screen and (forced-colors: active){.mdc-button.mdc-ripple-upgraded--background-focused .mdc-button__focus-ring,.mdc-button:not(.mdc-ripple-upgraded):focus .mdc-button__focus-ring{display:block}}.mdc-button .mdc-button__touch{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mdc-button__label+.mdc-button__icon{margin-left:8px;margin-right:0}[dir=rtl] .mdc-button__label+.mdc-button__icon,.mdc-button__label+.mdc-button__icon[dir=rtl]{margin-left:0;margin-right:8px}svg.mdc-button__icon{fill:currentColor}.mdc-button--touch{margin-top:6px;margin-bottom:6px}.mdc-button{padding:0 8px 0 8px}.mdc-button--unelevated{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--unelevated.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--unelevated.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--raised{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--raised.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--raised.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--outlined{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button--outlined .mdc-button__ripple{border-style:solid;border-color:rgba(0,0,0,0)}.mat-mdc-button{font-family:var(--mdc-text-button-label-text-font);font-size:var(--mdc-text-button-label-text-size);letter-spacing:var(--mdc-text-button-label-text-tracking);font-weight:var(--mdc-text-button-label-text-weight);text-transform:var(--mdc-text-button-label-text-transform);height:var(--mdc-text-button-container-height);border-radius:var(--mdc-text-button-container-shape);padding:0 var(--mat-text-button-horizontal-padding, 8px)}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color)}.mat-mdc-button:disabled{color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape)}.mat-mdc-button:has(.material-icons,mat-icon,[matButtonIcon]){padding:0 var(--mat-text-button-with-icon-horizontal-padding, 8px)}.mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}[dir=rtl] .mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}.mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}.mat-mdc-button .mat-ripple-element{background-color:var(--mat-text-button-ripple-color)}.mat-mdc-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-state-layer-color)}.mat-mdc-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-disabled-state-layer-color)}.mat-mdc-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-hover-state-layer-opacity)}.mat-mdc-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-focus-state-layer-opacity)}.mat-mdc-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-pressed-state-layer-opacity)}.mat-mdc-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-text-button-touch-target-display)}.mat-mdc-button[disabled],.mat-mdc-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-unelevated-button{font-family:var(--mdc-filled-button-label-text-font);font-size:var(--mdc-filled-button-label-text-size);letter-spacing:var(--mdc-filled-button-label-text-tracking);font-weight:var(--mdc-filled-button-label-text-weight);text-transform:var(--mdc-filled-button-label-text-transform);height:var(--mdc-filled-button-container-height);border-radius:var(--mdc-filled-button-container-shape);padding:0 var(--mat-filled-button-horizontal-padding, 16px)}.mat-mdc-unelevated-button:not(:disabled){background-color:var(--mdc-filled-button-container-color)}.mat-mdc-unelevated-button:disabled{background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color)}.mat-mdc-unelevated-button:disabled{color:var(--mdc-filled-button-disabled-label-text-color)}.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape)}.mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}.mat-mdc-unelevated-button .mat-ripple-element{background-color:var(--mat-filled-button-ripple-color)}.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-state-layer-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-disabled-state-layer-color)}.mat-mdc-unelevated-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-hover-state-layer-opacity)}.mat-mdc-unelevated-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-focus-state-layer-opacity)}.mat-mdc-unelevated-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-pressed-state-layer-opacity)}.mat-mdc-unelevated-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-filled-button-touch-target-display)}.mat-mdc-unelevated-button[disabled],.mat-mdc-unelevated-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-filled-button-disabled-label-text-color);background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-raised-button{font-family:var(--mdc-protected-button-label-text-font);font-size:var(--mdc-protected-button-label-text-size);letter-spacing:var(--mdc-protected-button-label-text-tracking);font-weight:var(--mdc-protected-button-label-text-weight);text-transform:var(--mdc-protected-button-label-text-transform);height:var(--mdc-protected-button-container-height);border-radius:var(--mdc-protected-button-container-shape);padding:0 var(--mat-protected-button-horizontal-padding, 16px);box-shadow:var(--mdc-protected-button-container-elevation-shadow)}.mat-mdc-raised-button:not(:disabled){background-color:var(--mdc-protected-button-container-color)}.mat-mdc-raised-button:disabled{background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color)}.mat-mdc-raised-button:disabled{color:var(--mdc-protected-button-disabled-label-text-color)}.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape)}.mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}.mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}.mat-mdc-raised-button .mat-ripple-element{background-color:var(--mat-protected-button-ripple-color)}.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-state-layer-color)}.mat-mdc-raised-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-disabled-state-layer-color)}.mat-mdc-raised-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-hover-state-layer-opacity)}.mat-mdc-raised-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-focus-state-layer-opacity)}.mat-mdc-raised-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-pressed-state-layer-opacity)}.mat-mdc-raised-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-protected-button-touch-target-display)}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation-shadow)}.mat-mdc-raised-button:focus{box-shadow:var(--mdc-protected-button-focus-container-elevation-shadow)}.mat-mdc-raised-button:active,.mat-mdc-raised-button:focus:active{box-shadow:var(--mdc-protected-button-pressed-container-elevation-shadow)}.mat-mdc-raised-button[disabled],.mat-mdc-raised-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-protected-button-disabled-label-text-color);background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button[disabled].mat-mdc-button-disabled,.mat-mdc-raised-button.mat-mdc-button-disabled.mat-mdc-button-disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation-shadow)}.mat-mdc-raised-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button{font-family:var(--mdc-outlined-button-label-text-font);font-size:var(--mdc-outlined-button-label-text-size);letter-spacing:var(--mdc-outlined-button-label-text-tracking);font-weight:var(--mdc-outlined-button-label-text-weight);text-transform:var(--mdc-outlined-button-label-text-transform);height:var(--mdc-outlined-button-container-height);border-radius:var(--mdc-outlined-button-container-shape);padding:0 15px 0 15px;border-width:var(--mdc-outlined-button-outline-width);padding:0 var(--mat-outlined-button-horizontal-padding, 15px)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color)}.mat-mdc-outlined-button:disabled{color:var(--mdc-outlined-button-disabled-label-text-color)}.mat-mdc-outlined-button .mdc-button__ripple{border-radius:var(--mdc-outlined-button-container-shape)}.mat-mdc-outlined-button:not(:disabled){border-color:var(--mdc-outlined-button-outline-color)}.mat-mdc-outlined-button:disabled{border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mdc-button--icon-trailing{padding:0 11px 0 15px}.mat-mdc-outlined-button.mdc-button--icon-leading{padding:0 15px 0 11px}.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:var(--mdc-outlined-button-outline-width)}.mat-mdc-outlined-button .mdc-button__touch{left:calc(-1 * var(--mdc-outlined-button-outline-width));width:calc(100% + 2 * var(--mdc-outlined-button-outline-width))}.mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-outlined-button-ripple-color)}.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-state-layer-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-disabled-state-layer-color)}.mat-mdc-outlined-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-hover-state-layer-opacity)}.mat-mdc-outlined-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-focus-state-layer-opacity)}.mat-mdc-outlined-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-pressed-state-layer-opacity)}.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-outlined-button-touch-target-display)}.mat-mdc-outlined-button[disabled],.mat-mdc-outlined-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-outlined-button-disabled-label-text-color);border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-button-base{text-decoration:none}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-button .mdc-button__label,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-outlined-button .mdc-button__label{z-index:1}.mat-mdc-button .mat-mdc-focus-indicator,.mat-mdc-unelevated-button .mat-mdc-focus-indicator,.mat-mdc-raised-button .mat-mdc-focus-indicator,.mat-mdc-outlined-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-unelevated-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-raised-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-outlined-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:-1px}.mat-mdc-unelevated-button .mat-mdc-focus-indicator::before,.mat-mdc-raised-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-outlined-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 3px)*-1)}',".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0});let a=r;return a})();var Ac=(()=>{let r=class r extends jz{constructor(n,s,d,m){super(n,s,d,m),this._rippleLoader.configureRipple(this._elementRef.nativeElement,{centered:!0})}};r.\u0275fac=function(s){return new(s||r)(V(Ee),V(gn),V(Be),V(Eo,8))},r.\u0275cmp=St({type:r,selectors:[["button","mat-icon-button",""]],hostVars:14,hostBindings:function(s,d){s&2&&(ri("disabled",d._getDisabledAttribute())("aria-disabled",d._getAriaDisabled()),al(d.color?"mat-"+d.color:""),li("mat-mdc-button-disabled",d.disabled)("mat-mdc-button-disabled-interactive",d.disabledInteractive)("_mat-animation-noopable",d._animationMode==="NoopAnimations")("mat-unthemed",!d.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],standalone:!0,features:[Di,At],attrs:vX,ngContentSelectors:yX,decls:4,vars:0,consts:[[1,"mat-mdc-button-persistent-ripple","mdc-icon-button__ripple"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(s,d){s&1&&(Un(),dt(0,"span",0),Ai(1),dt(2,"span",1)(3,"span",2))},styles:['.mdc-icon-button{display:inline-block;position:relative;box-sizing:border-box;border:none;outline:none;background-color:rgba(0,0,0,0);fill:currentColor;color:inherit;text-decoration:none;cursor:pointer;user-select:none;z-index:0;overflow:visible}.mdc-icon-button .mdc-icon-button__touch{position:absolute;top:50%;height:48px;left:50%;width:48px;transform:translate(-50%, -50%)}@media screen and (forced-colors: active){.mdc-icon-button.mdc-ripple-upgraded--background-focused .mdc-icon-button__focus-ring,.mdc-icon-button:not(.mdc-ripple-upgraded):focus .mdc-icon-button__focus-ring{display:block}}.mdc-icon-button:disabled{cursor:default;pointer-events:none}.mdc-icon-button[hidden]{display:none}.mdc-icon-button--display-flex{align-items:center;display:inline-flex;justify-content:center}.mdc-icon-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:100%;width:100%;display:none}@media screen and (forced-colors: active){.mdc-icon-button__focus-ring{border-color:CanvasText}}.mdc-icon-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-icon-button__focus-ring::after{border-color:CanvasText}}.mdc-icon-button__icon{display:inline-block}.mdc-icon-button__icon.mdc-icon-button__icon--on{display:none}.mdc-icon-button--on .mdc-icon-button__icon{display:none}.mdc-icon-button--on .mdc-icon-button__icon.mdc-icon-button__icon--on{display:inline-block}.mdc-icon-button__link{height:100%;left:0;outline:none;position:absolute;top:0;width:100%}.mat-mdc-icon-button{color:var(--mdc-icon-button-icon-color)}.mat-mdc-icon-button .mdc-button__icon{font-size:var(--mdc-icon-button-icon-size)}.mat-mdc-icon-button svg,.mat-mdc-icon-button img{width:var(--mdc-icon-button-icon-size);height:var(--mdc-icon-button-icon-size)}.mat-mdc-icon-button:disabled{color:var(--mdc-icon-button-disabled-icon-color)}.mat-mdc-icon-button{border-radius:50%;flex-shrink:0;text-align:center;width:var(--mdc-icon-button-state-layer-size, 48px);height:var(--mdc-icon-button-state-layer-size, 48px);padding:calc(calc(var(--mdc-icon-button-state-layer-size, 48px) - var(--mdc-icon-button-icon-size, 24px)) / 2);font-size:var(--mdc-icon-button-icon-size);-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-icon-button svg{vertical-align:baseline}.mat-mdc-icon-button[disabled],.mat-mdc-icon-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-icon-button-disabled-icon-color)}.mat-mdc-icon-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-icon-button .mat-mdc-button-ripple,.mat-mdc-icon-button .mat-mdc-button-persistent-ripple,.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-icon-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-icon-button .mdc-button__label{z-index:1}.mat-mdc-icon-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-icon-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-icon-button .mat-ripple-element{background-color:var(--mat-icon-button-ripple-color)}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-icon-button-state-layer-color)}.mat-mdc-icon-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-icon-button-disabled-state-layer-color)}.mat-mdc-icon-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-hover-state-layer-opacity)}.mat-mdc-icon-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-icon-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-icon-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-focus-state-layer-opacity)}.mat-mdc-icon-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-pressed-state-layer-opacity)}.mat-mdc-icon-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:50%;width:48px;transform:translate(-50%, -50%);display:var(--mat-icon-button-touch-target-display)}.mat-mdc-icon-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple{border-radius:50%}.mat-mdc-icon-button.mat-unthemed:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-primary:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-accent:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-warn:not(.mdc-ripple-upgraded):focus::before{background:rgba(0,0,0,0);opacity:1}',_X],encapsulation:2,changeDetection:0});let a=r;return a})();function wX(a,r){if(a&1){let l=we();T(0,"div",1)(1,"button",2),ct("click",function(){Kt(l);let s=gt();return Qt(s.action())}),B(2),k()()}if(a&2){let l=gt();z(2),ie(" ",l.data.action," ")}}var CX=["label"];function SX(a,r){}var EX=Math.pow(2,31)-1,_g=class{constructor(r,l){this._overlayRef=l,this._afterDismissed=new pe,this._afterOpened=new pe,this._onAction=new pe,this._dismissedByAction=!1,this.containerInstance=r,r._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}dismissWithAction(){this._onAction.closed||(this._dismissedByAction=!0,this._onAction.next(),this._onAction.complete(),this.dismiss()),clearTimeout(this._durationTimeoutId)}closeWithAction(){this.dismissWithAction()}_dismissAfter(r){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(r,EX))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._onAction.closed||this._onAction.complete(),this._afterDismissed.next({dismissedByAction:this._dismissedByAction}),this._afterDismissed.complete(),this._dismissedByAction=!1}afterDismissed(){return this._afterDismissed}afterOpened(){return this.containerInstance._onEnter}onAction(){return this._onAction}},Hz=new Se("MatSnackBarData"),Dm=class{constructor(){this.politeness="assertive",this.announcementMessage="",this.duration=0,this.data=null,this.horizontalPosition="center",this.verticalPosition="bottom"}},MX=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275dir=oe({type:r,selectors:[["","matSnackBarLabel",""]],hostAttrs:[1,"mat-mdc-snack-bar-label","mdc-snackbar__label"],standalone:!0});let a=r;return a})(),DX=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275dir=oe({type:r,selectors:[["","matSnackBarActions",""]],hostAttrs:[1,"mat-mdc-snack-bar-actions","mdc-snackbar__actions"],standalone:!0});let a=r;return a})(),TX=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275dir=oe({type:r,selectors:[["","matSnackBarAction",""]],hostAttrs:[1,"mat-mdc-snack-bar-action","mdc-snackbar__action"],standalone:!0});let a=r;return a})(),IX=(()=>{let r=class r{constructor(n,s){this.snackBarRef=n,this.data=s}action(){this.snackBarRef.dismissWithAction()}get hasAction(){return!!this.data.action}};r.\u0275fac=function(s){return new(s||r)(V(_g),V(Hz))},r.\u0275cmp=St({type:r,selectors:[["simple-snack-bar"]],hostAttrs:[1,"mat-mdc-simple-snack-bar"],exportAs:["matSnackBar"],standalone:!0,features:[At],decls:3,vars:2,consts:[["matSnackBarLabel",""],["matSnackBarActions",""],["mat-button","","matSnackBarAction","",3,"click"]],template:function(s,d){s&1&&(T(0,"div",0),B(1),k(),ut(2,wX,3,1,"div",1)),s&2&&(z(),ie(" ",d.data.message,`
`),z(),Xi(2,d.hasAction?2:-1))},dependencies:[ea,MX,DX,TX],styles:[".mat-mdc-simple-snack-bar{display:flex}"],encapsulation:2,changeDetection:0});let a=r;return a})(),AX={snackBarState:wr("state",[En("void, hidden",hi({transform:"scale(0.8)",opacity:0})),En("visible",hi({transform:"scale(1)",opacity:1})),ln("* => visible",Sn("150ms cubic-bezier(0, 0, 0.2, 1)")),ln("* => void, * => hidden",Sn("75ms cubic-bezier(0.4, 0.0, 1, 1)",hi({opacity:0})))])},kX=0,RX=(()=>{let r=class r extends Cd{constructor(n,s,d,m,_){super(),this._ngZone=n,this._elementRef=s,this._changeDetectorRef=d,this._platform=m,this.snackBarConfig=_,this._document=le(ci),this._trackedModals=new Set,this._announceDelay=150,this._destroyed=!1,this._onAnnounce=new pe,this._onExit=new pe,this._onEnter=new pe,this._animationState="void",this._liveElementId=`mat-snack-bar-container-live-${kX++}`,this.attachDomPortal=w=>{this._assertNotAttached();let S=this._portalOutlet.attachDomPortal(w);return this._afterPortalAttached(),S},_.politeness==="assertive"&&!_.announcementMessage?this._live="assertive":_.politeness==="off"?this._live="off":this._live="polite",this._platform.FIREFOX&&(this._live==="polite"&&(this._role="status"),this._live==="assertive"&&(this._role="alert"))}attachComponentPortal(n){this._assertNotAttached();let s=this._portalOutlet.attachComponentPortal(n);return this._afterPortalAttached(),s}attachTemplatePortal(n){this._assertNotAttached();let s=this._portalOutlet.attachTemplatePortal(n);return this._afterPortalAttached(),s}onAnimationEnd(n){let{fromState:s,toState:d}=n;if((d==="void"&&s!=="void"||d==="hidden")&&this._completeExit(),d==="visible"){let m=this._onEnter;this._ngZone.run(()=>{m.next(),m.complete()})}}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.markForCheck(),this._changeDetectorRef.detectChanges(),this._screenReaderAnnounce())}exit(){return this._ngZone.run(()=>{this._animationState="hidden",this._changeDetectorRef.markForCheck(),this._elementRef.nativeElement.setAttribute("mat-exit",""),clearTimeout(this._announceTimeoutId)}),this._onExit}ngOnDestroy(){this._destroyed=!0,this._clearFromModals(),this._completeExit()}_completeExit(){queueMicrotask(()=>{this._onExit.next(),this._onExit.complete()})}_afterPortalAttached(){let n=this._elementRef.nativeElement,s=this.snackBarConfig.panelClass;s&&(Array.isArray(s)?s.forEach(_=>n.classList.add(_)):n.classList.add(s)),this._exposeToModals();let d=this._label.nativeElement,m="mdc-snackbar__label";d.classList.toggle(m,!d.querySelector(`.${m}`))}_exposeToModals(){let n=this._liveElementId,s=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let d=0;d<s.length;d++){let m=s[d],_=m.getAttribute("aria-owns");this._trackedModals.add(m),_?_.indexOf(n)===-1&&m.setAttribute("aria-owns",_+" "+n):m.setAttribute("aria-owns",n)}}_clearFromModals(){this._trackedModals.forEach(n=>{let s=n.getAttribute("aria-owns");if(s){let d=s.replace(this._liveElementId,"").trim();d.length>0?n.setAttribute("aria-owns",d):n.removeAttribute("aria-owns")}}),this._trackedModals.clear()}_assertNotAttached(){this._portalOutlet.hasAttached()}_screenReaderAnnounce(){this._announceTimeoutId||this._ngZone.runOutsideAngular(()=>{this._announceTimeoutId=setTimeout(()=>{let n=this._elementRef.nativeElement.querySelector("[aria-hidden]"),s=this._elementRef.nativeElement.querySelector("[aria-live]");if(n&&s){let d=null;this._platform.isBrowser&&document.activeElement instanceof HTMLElement&&n.contains(document.activeElement)&&(d=document.activeElement),n.removeAttribute("aria-hidden"),s.appendChild(n),d?.focus(),this._onAnnounce.next(),this._onAnnounce.complete()}},this._announceDelay)})}};r.\u0275fac=function(s){return new(s||r)(V(Be),V(Ee),V(Zi),V(gn),V(Dm))},r.\u0275cmp=St({type:r,selectors:[["mat-snack-bar-container"]],viewQuery:function(s,d){if(s&1&&(ze(ul,7),ze(CX,7)),s&2){let m;se(m=ae())&&(d._portalOutlet=m.first),se(m=ae())&&(d._label=m.first)}},hostAttrs:[1,"mdc-snackbar","mat-mdc-snack-bar-container","mdc-snackbar--open"],hostVars:1,hostBindings:function(s,d){s&1&&wv("@state.done",function(_){return d.onAnimationEnd(_)}),s&2&&xv("@state",d._animationState)},standalone:!0,features:[Di,At],decls:6,vars:3,consts:[[1,"mdc-snackbar__surface"],[1,"mat-mdc-snack-bar-label"],["label",""],["aria-hidden","true"],["cdkPortalOutlet",""]],template:function(s,d){s&1&&(T(0,"div",0)(1,"div",1,2)(3,"div",3),ut(4,SX,0,0,"ng-template",4),k(),dt(5,"div"),k()()),s&2&&(z(5),ri("aria-live",d._live)("role",d._role)("id",d._liveElementId))},dependencies:[ul],styles:['.mdc-snackbar{display:none;position:fixed;right:0;bottom:0;left:0;align-items:center;justify-content:center;box-sizing:border-box;pointer-events:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mdc-snackbar--opening,.mdc-snackbar--open,.mdc-snackbar--closing{display:flex}.mdc-snackbar--open .mdc-snackbar__label,.mdc-snackbar--open .mdc-snackbar__actions{visibility:visible}.mdc-snackbar__surface{padding-left:0;padding-right:8px;display:flex;align-items:center;justify-content:flex-start;box-sizing:border-box;transform:scale(0.8);opacity:0}.mdc-snackbar__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-snackbar__surface::before{border-color:CanvasText}}[dir=rtl] .mdc-snackbar__surface,.mdc-snackbar__surface[dir=rtl]{padding-left:8px;padding-right:0}.mdc-snackbar--open .mdc-snackbar__surface{transform:scale(1);opacity:1;pointer-events:auto}.mdc-snackbar--closing .mdc-snackbar__surface{transform:scale(1)}.mdc-snackbar__label{padding-left:16px;padding-right:8px;width:100%;flex-grow:1;box-sizing:border-box;margin:0;visibility:hidden;padding-top:14px;padding-bottom:14px}[dir=rtl] .mdc-snackbar__label,.mdc-snackbar__label[dir=rtl]{padding-left:8px;padding-right:16px}.mdc-snackbar__label::before{display:inline;content:attr(data-mdc-snackbar-label-text)}.mdc-snackbar__actions{display:flex;flex-shrink:0;align-items:center;box-sizing:border-box;visibility:hidden}.mdc-snackbar__action+.mdc-snackbar__dismiss{margin-left:8px;margin-right:0}[dir=rtl] .mdc-snackbar__action+.mdc-snackbar__dismiss,.mdc-snackbar__action+.mdc-snackbar__dismiss[dir=rtl]{margin-left:0;margin-right:8px}.mat-mdc-snack-bar-container{margin:8px;position:static}.mat-mdc-snack-bar-container .mdc-snackbar__surface{min-width:344px}@media(max-width: 480px),(max-width: 344px){.mat-mdc-snack-bar-container .mdc-snackbar__surface{min-width:100%}}@media(max-width: 480px),(max-width: 344px){.mat-mdc-snack-bar-container{width:100vw}}.mat-mdc-snack-bar-container .mdc-snackbar__surface{max-width:672px}.mat-mdc-snack-bar-container .mdc-snackbar__surface{box-shadow:0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 6px 10px 0px rgba(0, 0, 0, 0.14), 0px 1px 18px 0px rgba(0, 0, 0, 0.12)}.mat-mdc-snack-bar-container .mdc-snackbar__surface{background-color:var(--mdc-snackbar-container-color)}.mat-mdc-snack-bar-container .mdc-snackbar__surface{border-radius:var(--mdc-snackbar-container-shape)}.mat-mdc-snack-bar-container .mdc-snackbar__label{color:var(--mdc-snackbar-supporting-text-color)}.mat-mdc-snack-bar-container .mdc-snackbar__label{font-size:var(--mdc-snackbar-supporting-text-size);font-family:var(--mdc-snackbar-supporting-text-font);font-weight:var(--mdc-snackbar-supporting-text-weight);line-height:var(--mdc-snackbar-supporting-text-line-height)}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled){color:var(--mat-snack-bar-button-color);--mat-text-button-state-layer-color:currentColor;--mat-text-button-ripple-color:currentColor}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled) .mat-ripple-element{opacity:.1}.mat-mdc-snack-bar-container .mdc-snackbar__label::before{display:none}.mat-mdc-snack-bar-handset,.mat-mdc-snack-bar-container,.mat-mdc-snack-bar-label{flex:1 1 auto}.mat-mdc-snack-bar-handset .mdc-snackbar__surface{width:100%}'],encapsulation:2,data:{animation:[AX.snackBarState]}});let a=r;return a})();function PX(){return new Dm}var OX=new Se("mat-snack-bar-default-options",{providedIn:"root",factory:PX}),Je=(()=>{let r=class r{get _openedSnackBarRef(){let n=this._parentSnackBar;return n?n._openedSnackBarRef:this._snackBarRefAtThisLevel}set _openedSnackBarRef(n){this._parentSnackBar?this._parentSnackBar._openedSnackBarRef=n:this._snackBarRefAtThisLevel=n}constructor(n,s,d,m,_,w){this._overlay=n,this._live=s,this._injector=d,this._breakpointObserver=m,this._parentSnackBar=_,this._defaultConfig=w,this._snackBarRefAtThisLevel=null,this.simpleSnackBarComponent=IX,this.snackBarContainerComponent=RX,this.handsetCssClass="mat-mdc-snack-bar-handset"}openFromComponent(n,s){return this._attach(n,s)}openFromTemplate(n,s){return this._attach(n,s)}open(n,s="",d){let m=qt(qt({},this._defaultConfig),d);return m.data={message:n,action:s},m.announcementMessage===n&&(m.announcementMessage=void 0),this.openFromComponent(this.simpleSnackBarComponent,m)}dismiss(){this._openedSnackBarRef&&this._openedSnackBarRef.dismiss()}ngOnDestroy(){this._snackBarRefAtThisLevel&&this._snackBarRefAtThisLevel.dismiss()}_attachSnackBarContainer(n,s){let d=s&&s.viewContainerRef&&s.viewContainerRef.injector,m=mo.create({parent:d||this._injector,providers:[{provide:Dm,useValue:s}]}),_=new ns(this.snackBarContainerComponent,s.viewContainerRef,m),w=n.attach(_);return w.instance.snackBarConfig=s,w.instance}_attach(n,s){let d=qt(qt(qt({},new Dm),this._defaultConfig),s),m=this._createOverlay(d),_=this._attachSnackBarContainer(m,d),w=new _g(_,m);if(n instanceof Mo){let S=new Ns(n,null,{$implicit:d.data,snackBarRef:w});w.instance=_.attachTemplatePortal(S)}else{let S=this._createInjector(d,w),I=new ns(n,void 0,S),L=_.attachComponentPortal(I);w.instance=L.instance}return this._breakpointObserver.observe(gz.HandsetPortrait).pipe(ni(m.detachments())).subscribe(S=>{m.overlayElement.classList.toggle(this.handsetCssClass,S.matches)}),d.announcementMessage&&_._onAnnounce.subscribe(()=>{this._live.announce(d.announcementMessage,d.politeness)}),this._animateSnackBar(w,d),this._openedSnackBarRef=w,this._openedSnackBarRef}_animateSnackBar(n,s){n.afterDismissed().subscribe(()=>{this._openedSnackBarRef==n&&(this._openedSnackBarRef=null),s.announcementMessage&&this._live.clear()}),this._openedSnackBarRef?(this._openedSnackBarRef.afterDismissed().subscribe(()=>{n.containerInstance.enter()}),this._openedSnackBarRef.dismiss()):n.containerInstance.enter(),s.duration&&s.duration>0&&n.afterOpened().subscribe(()=>n._dismissAfter(s.duration))}_createOverlay(n){let s=new rs;s.direction=n.direction;let d=this._overlay.position().global(),m=n.direction==="rtl",_=n.horizontalPosition==="left"||n.horizontalPosition==="start"&&!m||n.horizontalPosition==="end"&&m,w=!_&&n.horizontalPosition!=="center";return _?d.left("0"):w?d.right("0"):d.centerHorizontally(),n.verticalPosition==="top"?d.top("0"):d.bottom("0"),s.positionStrategy=d,this._overlay.create(s)}_createInjector(n,s){let d=n&&n.viewContainerRef&&n.viewContainerRef.injector;return mo.create({parent:d||this._injector,providers:[{provide:_g,useValue:s},{provide:Hz,useValue:n.data}]})}};r.\u0275fac=function(s){return new(s||r)(ht(Zn),ht(Ay),ht(mo),ht(by),ht(r,12),ht(OX))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var oi=(()=>{let r=class r{constructor(n,s,d,m,_){this.http=n,this.jwtHandler=s,this.snackBar=d,this.location=m,this.router=_}login(n,s,d){this.http.post(be+"/authenticate",{username:n,password:s}).subscribe({next:m=>{this.jwtHandler.setToken(m.token,d),this.location.back()},error:m=>{this.snackBar.open(m.error,"Dismiss",{duration:3e3})}})}logout(n){this.http.post(be+"/logout",null,{headers:{Authorization:"Bearer "+this.jwtHandler.getToken()}}).subscribe({next:()=>{this.jwtHandler.removeToken(),n!==""&&this.router.navigate(["/"]),this.snackBar.open("Ai fost deconectat cu succes!","Close",{duration:3e3})},error:s=>{this.snackBar.open(s.error,"Close",{duration:3e3})}})}register(n,s,d,m,_){this.http.post(be+"/register",{firstName:n,lastName:s,username:d,password:m,email:_}).subscribe({next:()=>(this.location.back(),this.snackBar.open("Contul a fost creat cu succes!","Close",{duration:3e3}),!0),error:w=>(this.snackBar.open(w.error,"Close",{duration:3e3}),!1)})}forgotPassword(n){this.http.post(be+"/forgot-password?email="+n,null).subscribe({next:()=>{this.location.back(),this.snackBar.open("Un email a fost trimis!","Close",{duration:3e3})},error:s=>{this.snackBar.open(s.error,"Close",{duration:300})}})}resetPassword(n,s){this.http.post(be+"/reset-password?token="+n+"&password="+s,null).subscribe({next:()=>{this.location.back(),this.snackBar.open("Parola a fost schimbata!","Close",{duration:3e3})},error:d=>{this.snackBar.open(d.error,"Close",{duration:3e3})}})}verifyAccount(n){return this.http.post(be+"/verify-account?token="+n,null)}resendVerifyAccountEmail(n){return this.http.post(be+"/resend-verify-account-email?email="+n,null)}isLoggedIn(){return this.jwtHandler.isLoggedIn()}isUser(){return this.jwtHandler.getRole()==="USER"}isAdmin(){return this.jwtHandler.getRole()==="ADMIN"}isValidator(){return this.jwtHandler.getRole()==="TICKET_VALIDATOR"}getUsername(){return this.jwtHandler.getUsername()}getToken(){return this.jwtHandler.getToken()}};r.\u0275fac=function(s){return new(s||r)(ht(Hi),ht(yy),ht(Je),ht(Bl),ht(zi))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var ql=(()=>{let r=class r{constructor(n,s,d){this.http=n,this.identityService=s,this.snackBar=d,this.headerDataSubject=new We({}),this.shoppingCartSizeSubject=new We(0),this.searchResultsSubject=new We({})}setHeaderData(n){this.headerDataSubject.next(n)}getHeaderData(){return this.headerDataSubject.asObservable()}setShoppingCartSize(n){this.shoppingCartSizeSubject.next(n)}getShoppingCartSize(){return this.shoppingCartSizeSubject.asObservable()}setSearchResults(n){this.searchResultsSubject.next(n)}getSearchResults(){return this.searchResultsSubject.asObservable()}fetchHeaderData(){return Tt(this,null,function*(){if(this.identityService.getToken())try{let s=yield Ne(this.http.get(be+"/header/data",{headers:{Authorization:"Bearer "+this.identityService.getToken()||""}}));this.setHeaderData({locations:s.locations,artists:s.artists,broadGenres:s.broadGenres}),this.setShoppingCartSize(s.shoppingCartSize)}catch{this.snackBar.open("Failed to fetch header data","Close",{duration:3e3})}else try{let s=yield Ne(this.http.get(be+"/header/data"));this.setHeaderData({locations:s.locations,artists:s.artists,broadGenres:s.broadGenres}),this.setShoppingCartSize(s.shoppingCartSize)}catch{this.snackBar.open("Failed to fetch header data","Close",{duration:3e3})}})}search(n){return Tt(this,null,function*(){try{let s=yield Ne(this.http.get(be+"/search",{params:{query:n}}));this.setSearchResults(s)}catch{this.snackBar.open("Failed to search","Close",{duration:3e3})}})}};r.\u0275fac=function(s){return new(s||r)(ht(Hi),ht(oi),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var FX=["searchInput"],LX=["searchDropdown"];function zX(a,r){a&1&&(T(0,"h4"),B(1,"Locatii"),k())}var Gz=()=>["events"],NX=a=>({location:a});function BX(a,r){if(a&1&&(T(0,"li",12)(1,"a"),B(2),k()()),a&2){let l=r.$implicit;W("routerLink",Ln(3,Gz))("queryParams",xi(4,NX,l.name)),z(2),Te(l==null?null:l.name)}}function VX(a,r){a&1&&(T(0,"h4",13),B(1,"Evenimente"),k())}var jX=a=>["event",a],UX=a=>({id:a});function HX(a,r){if(a&1&&(T(0,"li",12)(1,"a"),B(2),k()()),a&2){let l=r.$implicit;W("routerLink",xi(3,jX,l.title))("queryParams",xi(5,UX,l.id)),z(2),Te(l==null?null:l.title)}}function GX(a,r){a&1&&(T(0,"h4",13),B(1,"Artisti"),k())}var qX=a=>({artist:a});function WX(a,r){if(a&1&&(T(0,"li",12)(1,"a"),B(2),k()()),a&2){let l=r.$implicit;W("routerLink",Ln(3,Gz))("queryParams",xi(4,qX,l.name)),z(2),Te(l==null?null:l.name)}}function $X(a,r){if(a&1&&(T(0,"div",7,8)(2,"ul"),ut(3,zX,2,0,"h4",9)(4,BX,3,6,"li",10)(5,VX,2,0,"h4",11)(6,HX,3,7,"li",10)(7,GX,2,0,"h4",11)(8,WX,3,6,"li",10),k()()),a&2){let l=gt();z(3),W("ngIf",l.searchLocations.length>0),z(),W("ngForOf",l.searchLocations),z(),W("ngIf",l.searchEvents.length>0),z(),W("ngForOf",l.searchEvents),z(),W("ngIf",l.searchArtists.length>0),z(),W("ngForOf",l.searchArtists)}}var Ly=(()=>{let r=class r{constructor(n,s,d){this.dropdownService=n,this.router=s,this.headerService=d,this.searchText="",this.searchLocations=[],this.searchEvents=[],this.searchArtists=[],this.showDropdown=!1}ngOnInit(){this.dropdownService.setShowDropdown(!1),this.router.events.subscribe(n=>{n instanceof ps&&(this.searchText="",this.searchLocations=[],this.searchEvents=[],this.searchArtists=[],this.dropdownService.setShowDropdown(!1))}),this.searchResultSubscription=this.dropdownService.showDropdown$.subscribe({next:n=>{this.showDropdown=n}})}ngOnDestroy(){this.searchResultSubscription?.unsubscribe()}onDocumentClick(n){let s=this.searchDropdown&&this.searchDropdown.nativeElement&&this.searchDropdown.nativeElement.contains(n.target),d=this.searchInput&&this.searchInput.nativeElement&&this.searchInput.nativeElement.contains(n.target);!s&&!d?this.dropdownService.setShowDropdown(!1):d&&(this.searchLocations.length>0||this.searchEvents.length>0||this.searchArtists.length>0)&&this.dropdownService.setShowDropdown(!0)}onDocumentKeydown(n){n.key==="Enter"&&this.searchInput.nativeElement.contains(document.activeElement)&&this.search()}search(){return Tt(this,null,function*(){this.searchText!==""&&(yield this.headerService.search(this.searchText),this.searchResultSubscription=this.headerService.getSearchResults().subscribe({next:n=>{this.searchLocations=n.locationList,this.searchEvents=n.eventList,this.searchArtists=n.artistList}}),this.dropdownService.setShowDropdown(!0))})}};r.\u0275fac=function(s){return new(s||r)(V(uz),V(zi),V(ql))},r.\u0275cmp=St({type:r,selectors:[["app-search-dropdown"]],viewQuery:function(s,d){if(s&1&&(ze(FX,5),ze(LX,5)),s&2){let m;se(m=ae())&&(d.searchInput=m.first),se(m=ae())&&(d.searchDropdown=m.first)}},hostBindings:function(s,d){s&1&&ct("click",function(_){return d.onDocumentClick(_)},!1,sl)("keydown",function(_){return d.onDocumentKeydown(_)},!1,sl)},standalone:!0,features:[At],decls:7,vars:2,consts:[[1,"input-group-wrapper"],[1,"input-group"],["type","search","placeholder","Cauta","aria-label","Search",1,"form-control","rounded","form-control-lg","ms-3",3,"ngModel","ngModelChange"],["searchInput",""],["role","button",1,"btn","btn-light","input-group-text","border-0","ms-1","me-4",3,"click"],[1,"fas","fa-search","fs-6"],["class","search-dropdown",4,"ngIf"],[1,"search-dropdown"],["searchDropdown",""],[4,"ngIf"],[3,"routerLink","queryParams",4,"ngFor","ngForOf"],["class","mt-2",4,"ngIf"],[3,"routerLink","queryParams"],[1,"mt-2"]],template:function(s,d){s&1&&(T(0,"div",0)(1,"div",1)(2,"input",2,3),Cn("ngModelChange",function(_){return wn(d.searchText,_)||(d.searchText=_),_}),k(),T(4,"span",4),ct("click",function(){return d.search()}),dt(5,"i",5),k()(),ut(6,$X,9,6,"div",6),k()),s&2&&(z(2),xn("ngModel",d.searchText),z(4),W("ngIf",d.showDropdown))},dependencies:[Ve,pi,kn,Mn,en,qi,Ni,To],styles:[".input-group-wrapper[_ngcontent-%COMP%]{position:relative}.input-group[_ngcontent-%COMP%]{display:flex;gap:0!important;align-items:center}.search-dropdown[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;width:100%;background-color:#fff;z-index:100;box-shadow:0 0 10px #ccc;border-radius:5px;padding:1rem}.search-dropdown[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0}.search-dropdown[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{width:100%;padding:.5rem;border-bottom:1px solid #ccc}.search-dropdown[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{background-color:#f5f5f5;cursor:pointer}span[_ngcontent-%COMP%]{padding:10px}"]});let a=r;return a})();var YX=["searchInput"],ZX=["searchDropdown"],xM=()=>["/events"],XX=a=>({location:a});function KX(a,r){if(a&1&&(T(0,"a",17),B(1),k()),a&2){let l=r.$implicit;W("routerLink",Ln(3,xM))("queryParams",xi(4,XX,l.name)),z(),ie(" ",l.name," ")}}var QX=a=>({artist:a});function JX(a,r){if(a&1&&(T(0,"a",17),B(1),k()),a&2){let l=r.$implicit;W("routerLink",Ln(3,xM))("queryParams",xi(4,QX,l.name)),z(),Te(l.name)}}var tK=a=>["/artists",a];function eK(a,r){if(a&1&&(T(0,"div")(1,"a",18)(2,"b"),B(3),k()(),ut(4,JX,2,6,"a",4),k()),a&2){let l=r.$implicit;z(),W("routerLink",xi(3,tK,l.key)),z(2),Te(l.key),z(),W("ngForOf",l.value)}}var iK=a=>({genre:a});function nK(a,r){if(a&1&&(T(0,"a",17),B(1),k()),a&2){let l=r.$implicit;W("routerLink",Ln(3,xM))("queryParams",xi(4,iK,l.name)),z(),ie(" ",l.name," ")}}function rK(a,r){if(a&1&&(T(0,"span",19),B(1),k()),a&2){let l=gt();z(),ie(" ",l.shoppingCartSize," ")}}function oK(a,r){if(a&1&&(T(0,"span"),B(1),k()),a&2){let l=gt();z(),ie("Salut, ",l.getIdentityService().getUsername(),"")}}function sK(a,r){a&1&&(T(0,"span"),B(1,"Contul meu"),k())}function aK(a,r){if(a&1){let l=we();T(0,"div")(1,"a",20),B(2,"Contul meu"),k(),T(3,"a",21),B(4,"Comenzile mele"),k(),T(5,"a",22),B(6,"Urmareste evenimentele"),k(),T(7,"a",23),B(8,"Setari"),k(),T(9,"a",24),ct("click",function(){Kt(l);let s=gt();return Qt(s.logout())}),B(10,"Deconectare"),k()()}}function lK(a,r){a&1&&(T(0,"div")(1,"a",25),B(2,"Autentificare"),k(),T(3,"a",26),B(4,"Inregistrare"),k()())}var qz=(()=>{let r=class r{constructor(n,s,d){this.identityService=n,this.router=s,this.snackBar=d,this.locationsDropdownIsVisible=!1,this.artistsDropdownIsVisible=!1,this.genresDropdownIsVisible=!1,this.accountDropdownIsVisible=!1}ngOnDestroy(){this.searchResultSubscription?.unsubscribe()}ngOnInit(){this.router.events.subscribe(()=>{this.locationsDropdownIsVisible=!1,this.artistsDropdownIsVisible=!1,this.genresDropdownIsVisible=!1,this.accountDropdownIsVisible=!1})}onShoppingCartClick(){this.identityService.isLoggedIn()?this.router.navigate(["/shopping-cart"]):this.snackBar.open("Trebuie sa fii autentificat pentru a vedea cosul de cumparaturi!","Close",{duration:3e3})}logout(){this.identityService.logout("")}getIdentityService(){return this.identityService}toggleLocationsDropdown(){this.locationsDropdownIsVisible=!this.locationsDropdownIsVisible,this.artistsDropdownIsVisible=!1,this.genresDropdownIsVisible=!1,this.accountDropdownIsVisible=!1}toggleArtistsDropdown(){this.artistsDropdownIsVisible=!this.artistsDropdownIsVisible,this.locationsDropdownIsVisible=!1,this.genresDropdownIsVisible=!1,this.accountDropdownIsVisible=!1}toggleGenresDropdown(){this.genresDropdownIsVisible=!this.genresDropdownIsVisible,this.locationsDropdownIsVisible=!1,this.artistsDropdownIsVisible=!1,this.accountDropdownIsVisible=!1}toggleAccountDropdown(){this.accountDropdownIsVisible=!this.accountDropdownIsVisible,this.locationsDropdownIsVisible=!1,this.artistsDropdownIsVisible=!1,this.genresDropdownIsVisible=!1}};r.\u0275fac=function(s){return new(s||r)(V(oi),V(zi),V(Je))},r.\u0275cmp=St({type:r,selectors:[["app-full-size-navigation"]],viewQuery:function(s,d){if(s&1&&(ze(YX,5),ze(ZX,5)),s&2){let m;se(m=ae())&&(d.searchInput=m.first),se(m=ae())&&(d.searchDropdown=m.first)}},inputs:{locations:"locations",artists:"artists",broadGenres:"broadGenres",shoppingCartSize:"shoppingCartSize"},standalone:!0,features:[At],decls:35,vars:14,consts:[[1,"nav-item",3,"click"],[1,"dropdown-container"],[1,"dropdown-title"],[1,"locations-container"],[3,"routerLink","queryParams",4,"ngFor","ngForOf"],[1,"artists-container"],[4,"ngFor","ngForOf"],[1,"genres-container"],["routerLink","/events",1,"nav-item"],[1,"search"],[1,"right-buttons"],["role","button","mdbTooltip","Cos de cumparaturi",1,"shopping-cart-button","nav-item",3,"click"],["id","shopping-cart-icon",1,"fas","fa-shopping-cart","me-1"],["id","badge","class","badge text-primary",4,"ngIf"],[1,"nav-item","account-button",3,"click"],[4,"ngIf"],[1,"dropdown-container","account-dropdown"],[3,"routerLink","queryParams"],[3,"routerLink"],["id","badge",1,"badge","text-primary"],["routerLink","/account",1,"dropdown-item"],["routerLink","/account/orders",1,"dropdown-item"],["routerLink","/track",1,"dropdown-item"],["routerLink","/account/settings",1,"dropdown-item"],["role","button",1,"dropdown-item",3,"click"],["routerLink","/login",1,"dropdown-item"],["routerLink","/register",1,"dropdown-item"]],template:function(s,d){s&1&&(T(0,"a",0),ct("click",function(){return d.toggleLocationsDropdown()}),B(1,"Locatii"),k(),T(2,"div",1)(3,"h1",2),B(4,"Ce se intampla la ..."),k(),T(5,"div",3),ut(6,KX,2,6,"a",4),k()(),T(7,"a",0),ct("click",function(){return d.toggleArtistsDropdown()}),B(8,"Artisti"),k(),T(9,"div",1)(10,"h1",2),B(11,"Artisti"),k(),T(12,"div",5),ut(13,eK,5,5,"div",6),qo(14,"keyvalue"),k()(),T(15,"a",0),ct("click",function(){return d.toggleGenresDropdown()}),B(16,"Genuri"),k(),T(17,"div",1)(18,"h1",2),B(19,"Genuri"),k(),T(20,"div",7),ut(21,nK,2,6,"a",4),k()(),T(22,"a",8),B(23,"Evenimente"),k(),dt(24,"app-search-dropdown",9),T(25,"div",10)(26,"div",11),ct("click",function(){return d.onShoppingCartClick()}),dt(27,"i",12),ut(28,rK,2,1,"span",13),k(),T(29,"a",14),ct("click",function(){return d.toggleAccountDropdown()}),ut(30,oK,2,1,"span",15)(31,sK,2,0,"span",15),k(),T(32,"div",16),ut(33,aK,11,0,"div",15)(34,lK,5,0,"div",15),k()()),s&2&&(z(2),W("@dropdown",d.locationsDropdownIsVisible?"true":"false"),z(4),W("ngForOf",d.locations),z(3),W("@dropdown",d.artistsDropdownIsVisible?"true":"false"),z(4),W("ngForOf",ms(14,12,d.artists)),z(4),W("@dropdown",d.genresDropdownIsVisible?"true":"false"),z(4),W("ngForOf",d.broadGenres),z(7),W("ngIf",d.getIdentityService().isLoggedIn()&&d.shoppingCartSize>0),z(2),W("ngIf",d.getIdentityService().isLoggedIn()),z(),W("ngIf",!d.getIdentityService().isLoggedIn()),z(),W("@dropdown",d.accountDropdownIsVisible?"true":"false"),z(),W("ngIf",d.getIdentityService().isLoggedIn()),z(),W("ngIf",!d.getIdentityService().isLoggedIn()))},dependencies:[Cm,lz,pi,Ve,Mn,kn,Ni,Ly,Dv],styles:["a[_ngcontent-%COMP%]{color:#000}ul[_ngcontent-%COMP%]{list-style:none;padding:0}.full-size-navbar-items[_ngcontent-%COMP%]{display:flex}.nav-item[_ngcontent-%COMP%]{padding:10px;text-align:center;cursor:pointer;color:#000;text-decoration:none;font-size:18px;min-width:85px}.nav-item[_ngcontent-%COMP%]:hover{background-color:#000;color:#fff}.dropdown[_ngcontent-%COMP%]{position:relative;display:inline-block}.dropdown-container[_ngcontent-%COMP%]{display:none;position:absolute;top:100%;left:0;width:100%;background-color:#fff;box-shadow:0 8px 16px #0003;z-index:10}.dropdown-container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#000;padding:12px 16px;text-decoration:none;display:block}.dropdown-container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#f1f1f1}.account-dropdown[_ngcontent-%COMP%]{max-width:210px;left:auto}.locations-container[_ngcontent-%COMP%], .artists-container[_ngcontent-%COMP%], .genres-container[_ngcontent-%COMP%]{padding:20px;gap:20px;width:50%}.right-buttons[_ngcontent-%COMP%]{display:flex}.account-button[_ngcontent-%COMP%]{width:120px}.shopping-cart-button[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;font-size:18px}.search[_ngcontent-%COMP%]{flex:1}"],data:{animation:[wr("dropdown",[En("true",hi({opacity:1,display:"block"})),En("false",hi({opacity:0,display:"none"})),ln("true <=> false",Sn("200ms ease-in-out"))])]}});let a=r;return a})();function cK(a,r){if(a&1&&(T(0,"span",19),B(1),k()),a&2){let l=gt(2);z(),ie(" ",l.shoppingCartSize," ")}}var dK=()=>["shopping-cart"];function uK(a,r){if(a&1){let l=we();T(0,"div")(1,"div",11)(2,"h2"),B(3),k(),T(4,"div",12),dt(5,"i",13),ut(6,cK,2,1,"span",14),k()(),dt(7,"hr"),T(8,"ul")(9,"li")(10,"a",15),B(11,"Contul meu"),k()(),T(12,"li")(13,"a",16),B(14,"Comenzile mele"),k()(),T(15,"li")(16,"a",17),B(17,"Urmareste evenimentele"),k()(),T(18,"li")(19,"a",18),B(20,"Setari"),k()(),T(21,"li")(22,"a",8),ct("click",function(){Kt(l);let s=gt();return Qt(s.logout())}),B(23,"Deconectare"),k()()()()}if(a&2){let l=gt();z(3),ie("Salut, ",l.getIdentityService().getUsername(),""),z(),W("routerLink",Ln(3,dK)),z(2),W("ngIf",l.getIdentityService().isLoggedIn()&&l.shoppingCartSize>0)}}function hK(a,r){a&1&&(T(0,"div")(1,"ul")(2,"li")(3,"a",20),B(4,"Autentificare"),k()(),T(5,"li")(6,"a",21),B(7,"Inregistrare"),k()()()())}var wM=()=>["/events"],mK=a=>({location:a});function pK(a,r){if(a&1&&(T(0,"div",24)(1,"a",25),B(2),k()()),a&2){let l=r.$implicit;z(),W("routerLink",Ln(3,wM))("queryParams",xi(4,mK,l.name)),z(),ie(" ",l.name," ")}}function fK(a,r){if(a&1&&(T(0,"div",22),ut(1,pK,3,6,"div",23),k()),a&2){let l=gt();z(),W("ngForOf",l.locations)}}var gK=a=>({artist:a});function _K(a,r){if(a&1&&(T(0,"a",25),B(1),k()),a&2){let l=r.$implicit;W("routerLink",Ln(3,wM))("queryParams",xi(4,gK,l.name)),z(),ie(" ",l.name," ")}}var vK=a=>["/artists",a];function yK(a,r){if(a&1&&(T(0,"div",27)(1,"a",28)(2,"b"),B(3),k()(),ut(4,_K,2,6,"a",29),k()),a&2){let l=r.$implicit;z(),W("routerLink",xi(3,vK,l.key)),z(2),Te(l.key),z(),W("ngForOf",l.value)}}function bK(a,r){if(a&1&&(T(0,"div",22),ut(1,yK,5,5,"div",26),qo(2,"keyvalue"),dt(3,"hr"),k()),a&2){let l=gt();z(),W("ngForOf",ms(2,1,l.artists))}}var xK=a=>({genre:a});function wK(a,r){if(a&1&&(T(0,"div",31)(1,"a",25),B(2),k()()),a&2){let l=r.$implicit;z(),W("routerLink",Ln(3,wM))("queryParams",xi(4,xK,l.name)),z(),ie(" ",l.name," ")}}function CK(a,r){if(a&1&&(T(0,"div",22),ut(1,wK,3,6,"div",30),k()),a&2){let l=gt();z(),W("ngForOf",l.broadGenres)}}var Wz=(()=>{let r=class r{constructor(n,s){this.identityService=n,this.router=s,this.panelDisplay=!1,this.shouldDisplayLocations=!1,this.shouldDisplayArtists=!1,this.shouldDisplayGenres=!1}ngOnInit(){this.router.events.subscribe(n=>{this.panelDisplay=!1,this.shouldDisplayLocations=!1,this.shouldDisplayArtists=!1,this.shouldDisplayGenres=!1,document.body.style.overflow="auto"})}logout(){this.identityService.logout("")}getIdentityService(){return this.identityService}togglePanel(){this.panelDisplay=!this.panelDisplay,document.body.style.overflow=this.panelDisplay?"hidden":"auto",this.panelDisplay?window.addEventListener("resize",this.handleResize):window.removeEventListener("resize",this.handleResize)}handleResize(){window.innerWidth>768&&(document.body.style.overflow="auto")}toggleContentDisplay(n){switch(n){case"locations":this.shouldDisplayLocations=!this.shouldDisplayLocations,this.shouldDisplayArtists=!1,this.shouldDisplayGenres=!1;break;case"artists":this.shouldDisplayArtists=!this.shouldDisplayArtists,this.shouldDisplayLocations=!1,this.shouldDisplayGenres=!1;break;case"genres":this.shouldDisplayGenres=!this.shouldDisplayGenres,this.shouldDisplayLocations=!1,this.shouldDisplayArtists=!1;break}}};r.\u0275fac=function(s){return new(s||r)(V(oi),V(zi))},r.\u0275cmp=St({type:r,selectors:[["app-mobile-size-navigation"]],inputs:{shoppingCartSize:"shoppingCartSize",locations:"locations",artists:"artists",broadGenres:"broadGenres"},standalone:!0,features:[At],decls:28,vars:6,consts:[[1,"navbar-toggler",3,"click"],[1,"fas","fa-bars"],[1,"panel"],[1,"panel-header"],[1,"search"],[1,"panel-close-button",3,"click"],[1,"fas","fa-times"],[4,"ngIf"],["role","button",3,"click"],["class","nav-options",4,"ngIf"],["role","button","routerLink","/events"],[1,"title-shopping-cart-container"],["role","button",1,"shopping-cart-button","nav-item",3,"routerLink"],["id","shopping-cart-icon",1,"fas","fa-shopping-cart","me-1"],["id","badge","class","badge text-primary",4,"ngIf"],["role","button","routerLink","/account"],["role","button","routerLink","/account/orders"],["role","button","routerLink","/track"],["role","button","routerLink","/account/settings"],["id","badge",1,"badge","text-primary"],["role","button","routerLink","/login"],["role","button","routerLink","/register"],[1,"nav-options"],["class","location-column",4,"ngFor","ngForOf"],[1,"location-column"],[3,"routerLink","queryParams"],["class","artist-column",4,"ngFor","ngForOf"],[1,"artist-column"],[3,"routerLink"],[3,"routerLink","queryParams",4,"ngFor","ngForOf"],["class","genre-column",4,"ngFor","ngForOf"],[1,"genre-column"]],template:function(s,d){s&1&&(T(0,"button",0),ct("click",function(){return d.togglePanel()}),dt(1,"i",1),k(),T(2,"div",2)(3,"div",3),dt(4,"app-search-dropdown",4),T(5,"button",5),ct("click",function(){return d.togglePanel()}),dt(6,"i",6),k()(),dt(7,"hr"),ut(8,uK,24,4,"div",7)(9,hK,8,0,"div",7),dt(10,"hr"),T(11,"ul")(12,"li")(13,"a",8),ct("click",function(){return d.toggleContentDisplay("locations")}),B(14,"Locatii"),k(),ut(15,fK,2,1,"div",9),k(),T(16,"li")(17,"a",8),ct("click",function(){return d.toggleContentDisplay("artists")}),B(18,"Artisti"),k(),ut(19,bK,4,3,"div",9),k(),T(20,"li")(21,"a",8),ct("click",function(){return d.toggleContentDisplay("genres")}),B(22,"Genuri"),k(),ut(23,CK,2,1,"div",9),k(),T(24,"li")(25,"a",10),B(26,"Evenimente"),k(),dt(27,"div"),k()()()),s&2&&(z(2),W("@slide",d.panelDisplay?"in":"out"),z(6),W("ngIf",d.getIdentityService().isLoggedIn()),z(),W("ngIf",!d.getIdentityService().isLoggedIn()),z(6),W("ngIf",d.shouldDisplayLocations),z(4),W("ngIf",d.shouldDisplayArtists),z(4),W("ngIf",d.shouldDisplayGenres))},dependencies:[pi,Ve,kn,Ly,Dv,Cm],styles:[".nav-menu-button[_ngcontent-%COMP%]{background-color:#fff;color:#333;border:2px solid #333333;border-radius:5px;padding:10px 20px;font-size:14px;cursor:pointer}.nav-menu-button[_ngcontent-%COMP%]:hover{background-color:#333;color:#fff}.panel[_ngcontent-%COMP%]{position:fixed;top:0;right:0;width:100%;height:100%;background-color:#fff;box-shadow:0 0 10px #00000080;z-index:1000;overflow-y:auto;padding:12px 20px 20px;transition:transform .3s ease}.panel[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:10px;color:#333}.panel[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.panel[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:10px}.panel[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#000;text-decoration:none}.nav-options[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.panel[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.panel[_ngcontent-%COMP%]   hr[_ngcontent-%COMP%]{margin:20px 0;border:0;border-top:1px solid #cccccc}.panel-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.search[_ngcontent-%COMP%]{flex:1}.panel-close-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;font-size:20px;color:#333;margin-right:14px}.panel-close-button[_ngcontent-%COMP%]:hover{color:red}.location-column[_ngcontent-%COMP%]{flex:0 0 50%;padding:5px}.artist-column[_ngcontent-%COMP%]{flex:0 0 33%;padding:5px}.artist-column[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;align-items:center}.genre-column[_ngcontent-%COMP%]{flex:0 0 50%;padding:5px}.nav-menu-button[_ngcontent-%COMP%]{display:block}.title-shopping-cart-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.shopping-cart-button[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;font-size:18px;margin-bottom:6px}"],data:{animation:[wr("slide",[En("in",hi({display:"block",transform:"translate3d(0, 0, 0)"})),En("out",hi({display:"none",transform:"translate3d(100%, 0, 0)"})),ln("in => out",Sn("400ms ease-in-out")),ln("out => in",Sn("400ms ease-in-out"))])]}});let a=r;return a})();var SK=["searchInput"],EK=["searchDropdown"],$z=(()=>{let r=class r{constructor(n){this.headerService=n,this.locations=[],this.broadGenres=[]}ngOnInit(){return Tt(this,null,function*(){yield this.headerService.fetchHeaderData(),this.headerDataSubscription=this.headerService.getHeaderData().subscribe({next:n=>{this.locations=n.locations,this.artists=n.artists,this.broadGenres=n.broadGenres}}),this.shoppingCartSubscription=this.headerService.getShoppingCartSize().subscribe({next:n=>{this.shoppingCartSize=n}})})}ngOnDestroy(){this.shoppingCartSubscription?.unsubscribe(),this.headerDataSubscription?.unsubscribe()}};r.\u0275fac=function(s){return new(s||r)(V(ql))},r.\u0275cmp=St({type:r,selectors:[["app-header"]],viewQuery:function(s,d){if(s&1&&(ze(SK,5),ze(EK,5)),s&2){let m;se(m=ae())&&(d.searchInput=m.first),se(m=ae())&&(d.searchDropdown=m.first)}},standalone:!0,features:[At],decls:6,vars:8,consts:[[1,"navbar"],["routerLink","/",1,"navbar-brand"],[1,"full-size-navbar-container",3,"locations","artists","broadGenres","shoppingCartSize"],[1,"mobile-size-navbar-container",3,"locations","artists","broadGenres","shoppingCartSize"]],template:function(s,d){s&1&&(T(0,"header")(1,"nav",0)(2,"a",1),B(3,"Bileteria"),k(),dt(4,"app-full-size-navigation",2)(5,"app-mobile-size-navigation",3),k()()),s&2&&(z(4),W("locations",d.locations)("artists",d.artists)("broadGenres",d.broadGenres)("shoppingCartSize",d.shoppingCartSize),z(),W("locations",d.locations)("artists",d.artists)("broadGenres",d.broadGenres)("shoppingCartSize",d.shoppingCartSize))},dependencies:[kn,Ni,Cm,Gl,qz,Wz],styles:["a[_ngcontent-%COMP%]{color:#000}.navbar[_ngcontent-%COMP%]{padding-right:10px;padding-left:10px;z-index:11}.full-size-navbar-container[_ngcontent-%COMP%]{display:flex;flex:1;align-items:center}.mobile-size-navbar-container[_ngcontent-%COMP%]{display:none}.card[_ngcontent-%COMP%]{padding:1rem;flex:1 0 calc(19% - 1rem);max-width:calc(19% - 1rem)}@media (max-width: 768px){.card[_ngcontent-%COMP%]{flex-basis:100%;max-width:100%}}@media (max-width: 992px){.full-size-navbar-container[_ngcontent-%COMP%]{display:none!important}.mobile-size-navbar-container[_ngcontent-%COMP%]{display:block!important}}"]});let a=r;return a})();var Yz=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=St({type:r,selectors:[["app-footer"]],standalone:!0,features:[At],decls:76,vars:0,consts:[[1,"text-center","text-lg-start","bg-light","text-muted"],[1,"d-flex","justify-content-center","justify-content-lg-between","p-4","border-bottom"],[1,"me-5","d-none","d-lg-block"],["href","",1,"me-4","text-reset"],[1,"fab","fa-facebook-f"],[1,"fab","fa-twitter"],[1,"fab","fa-google"],[1,"fab","fa-instagram"],[1,"fab","fa-linkedin"],[1,"fab","fa-github"],[1,""],[1,"container","text-center","text-md-start","mt-5"],[1,"row","mt-3"],[1,"col-md-3","col-lg-4","col-xl-3","mx-auto","mb-4"],[1,"text-uppercase","fw-bold","mb-4"],[1,"fas","fa-gem","me-3"],[1,"col-md-2","col-lg-2","col-xl-2","mx-auto","mb-4"],["href","#!",1,"text-reset"],[1,"col-md-3","col-lg-2","col-xl-2","mx-auto","mb-4"],[1,"col-md-4","col-lg-3","col-xl-3","mx-auto","mb-md-0","mb-4"],[1,"fas","fa-home","me-3"],[1,"fas","fa-envelope","me-3"],[1,"fas","fa-phone","me-3"],[1,"fas","fa-print","me-3"],[1,"text-center","p-4",2,"background-color","rgba(0, 0, 0, 0.05)"],["href","https://mdbootstrap.com/",1,"text-reset","fw-bold"]],template:function(s,d){s&1&&(T(0,"footer",0)(1,"section",1)(2,"div",2)(3,"span"),B(4,"Urmareste-ne pe retelele sociale:"),k()(),T(5,"div")(6,"a",3),dt(7,"i",4),k(),T(8,"a",3),dt(9,"i",5),k(),T(10,"a",3),dt(11,"i",6),k(),T(12,"a",3),dt(13,"i",7),k(),T(14,"a",3),dt(15,"i",8),k(),T(16,"a",3),dt(17,"i",9),k()()(),T(18,"section",10)(19,"div",11)(20,"div",12)(21,"div",13)(22,"h6",14),dt(23,"i",15),B(24,"Bileteria "),k(),T(25,"p"),B(26," Here you can use rows and columns to organize your footer content. Lorem ipsum dolor sit amet, consectetur adipisicing elit. "),k()(),T(27,"div",16)(28,"h6",14),B(29," Products "),k(),T(30,"p")(31,"a",17),B(32,"Angular"),k()(),T(33,"p")(34,"a",17),B(35,"React"),k()(),T(36,"p")(37,"a",17),B(38,"Vue"),k()(),T(39,"p")(40,"a",17),B(41,"Laravel"),k()()(),T(42,"div",18)(43,"h6",14),B(44," Useful links "),k(),T(45,"p")(46,"a",17),B(47,"Pricing"),k()(),T(48,"p")(49,"a",17),B(50,"Settings"),k()(),T(51,"p")(52,"a",17),B(53,"Orders"),k()(),T(54,"p")(55,"a",17),B(56,"Help"),k()()(),T(57,"div",19)(58,"h6",14),B(59," Contact "),k(),T(60,"p"),dt(61,"i",20),B(62," New York, NY 10012, US"),k(),T(63,"p"),dt(64,"i",21),B(65," info@example.com "),k(),T(66,"p"),dt(67,"i",22),B(68," + 01 234 567 88"),k(),T(69,"p"),dt(70,"i",23),B(71," + 01 234 567 89"),k()()()()(),T(72,"div",24),B(73," \xA9 2024 Copyright: "),T(74,"a",25),B(75,"Bileteria"),k()()())}});let a=r;return a})();var Zz=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=St({type:r,selectors:[["app-root"]],standalone:!0,features:[At],decls:5,vars:0,consts:[[1,"root-container"],[1,"main-container"]],template:function(s,d){s&1&&(T(0,"div",0),dt(1,"app-header"),T(2,"main",1),dt(3,"router-outlet"),k(),dt(4,"app-footer"),k())},dependencies:[$z,Yz,cl],styles:[".root-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-height:100vh}.main-container[_ngcontent-%COMP%]{flex:1;padding-top:10px;padding-bottom:10px}"]});let a=r;return a})();var Xz=["*"];function MK(a,r){if(a&1){let l=we();T(0,"button",7),ct("click",function(){let d=Kt(l).index,m=gt(2);return Qt(m.to(d))}),k()}if(a&2){let l=r.index,n=gt(2);li("active",l===n.activeSlide),ri("aria-current",l===n.activeSlide)}}function DK(a,r){if(a&1&&(T(0,"div",5),ut(1,MK,1,3,"button",6),k()),a&2){let l=gt();z(),W("ngForOf",l.items)}}function TK(a,r){if(a&1){let l=we();T(0,"button",8),ct("click",function(){Kt(l);let s=gt();return Qt(s.prev())}),dt(1,"span",9),T(2,"span",10),B(3,"Previous"),k()()}}function IK(a,r){if(a&1){let l=we();T(0,"button",11),ct("click",function(){Kt(l);let s=gt();return Qt(s.next())}),dt(1,"span",12),T(2,"span",10),B(3,"Next"),k()()}}var CM=(()=>{class a{_elementRef;interval=null;carouselItem=!0;active=!1;next=!1;prev=!1;start=!1;end=!1;get host(){return this._elementRef.nativeElement}constructor(l){this._elementRef=l}static \u0275fac=function(n){return new(n||a)(V(Ee))};static \u0275cmp=St({type:a,selectors:[["mdb-carousel-item"]],hostVars:12,hostBindings:function(n,s){n&2&&li("carousel-item",s.carouselItem)("active",s.active)("carousel-item-next",s.next)("carousel-item-prev",s.prev)("carousel-item-start",s.start)("carousel-item-end",s.end)},inputs:{interval:"interval"},ngContentSelectors:Xz,decls:1,vars:0,template:function(n,s){n&1&&(Un(),Ai(0))},encapsulation:2})}return a})(),fl=function(a){return a[a.UNKNOWN=0]="UNKNOWN",a[a.NEXT=1]="NEXT",a[a.PREV=2]="PREV",a}(fl||{}),Kz=(()=>{class a{_elementRef;_cdRef;_items;get items(){return this._items&&this._items.toArray()}animation="slide";get controls(){return this._controls}set controls(l){this._controls=ao(l)}_controls=!1;get dark(){return this._dark}set dark(l){this._dark=ao(l)}_dark=!1;get indicators(){return this._indicators}set indicators(l){this._indicators=ao(l)}_indicators=!1;get ride(){return this._ride}set ride(l){this._ride=ao(l)}_ride=!0;get interval(){return this._interval}set interval(l){this._interval=l,this.items&&this._restartInterval()}_interval=5e3;keyboard=!0;pause=!0;wrap=!0;slide=new ye;slideChange=new ye;get activeSlide(){return this._activeSlide}set activeSlide(l){this.items.length&&this._activeSlide!==l&&(this._activeSlide=l,this._restartInterval())}_activeSlide=0;_lastInterval;_isPlaying=!1;_isSliding=!1;_destroy$=new pe;onMouseEnter(){this.pause&&this._isPlaying&&this.stop()}onMouseLeave(){this.pause&&!this._isPlaying&&this.play()}display=!0;constructor(l,n){this._elementRef=l,this._cdRef=n}ngAfterViewInit(){Promise.resolve().then(()=>{this._setActiveSlide(this._activeSlide),this.interval>0&&this.ride&&this.play(),this._cdRef.markForCheck()}),this.keyboard&&Fo(this._elementRef.nativeElement,"keydown").pipe(ni(this._destroy$)).subscribe(l=>{l.key==="ArrowRight"?this.next():l.key==="ArrowLeft"&&this.prev()})}ngOnDestroy(){this._destroy$.next(),this._destroy$.complete()}_setActiveSlide(l){let n=this.items[this._activeSlide];n.active=!1;let s=this.items[l];s.active=!0,this._activeSlide=l}_restartInterval(){this._resetInterval();let l=this.items[this.activeSlide],n=l.interval?l.interval:this.interval;!isNaN(n)&&n>0&&(this._lastInterval=setInterval(()=>{let s=+n;this._isPlaying&&!isNaN(s)&&s>0?(this.next(),this._cdRef.markForCheck()):this.stop()},n))}_resetInterval(){this._lastInterval&&(clearInterval(this._lastInterval),this._lastInterval=null)}play(){this._isPlaying||(this._isPlaying=!0,this._restartInterval())}stop(){this._isPlaying&&(this._isPlaying=!1,this._resetInterval())}to(l){if(l>this.items.length-1||l<0)return;if(this.activeSlide===l){this.stop(),this.play();return}let n=l>this.activeSlide?fl.NEXT:fl.PREV;this._animateSlides(n,this.activeSlide,l),this.activeSlide=l}next(){this._isSliding||this._slide(fl.NEXT)}prev(){this._isSliding||this._slide(fl.PREV)}_slide(l){let n=this._activeSlide===0,s=this._activeSlide===this.items.length-1;if(!this.wrap&&(l===fl.NEXT&&s||l===fl.PREV&&n))return;let d=this._getNewSlideIndex(l);this._animateSlides(l,this.activeSlide,d),this.activeSlide=d,this.slide.emit()}_animateSlides(l,n,s){let d=this.items[n],m=this.items[s],_=d.host,w=m.host;if(this._isSliding=!0,this._isPlaying&&this.stop(),l===fl.NEXT){m.next=!0,setTimeout(()=>{this._reflow(w),d.start=!0,m.start=!0,this._cdRef.markForCheck()},0);let S=600;Fo(_,"transitionend").pipe(tn(1)).subscribe(()=>{m.next=!1,m.start=!1,m.active=!0,d.active=!1,d.start=!1,d.next=!1,this.slideChange.emit(),this._isSliding=!1}),this._emulateTransitionEnd(_,S)}else if(l===fl.PREV){m.prev=!0,setTimeout(()=>{this._reflow(w),d.end=!0,m.end=!0,this._cdRef.markForCheck()},0);let S=600;Fo(_,"transitionend").pipe(tn(1)).subscribe(()=>{m.prev=!1,m.end=!1,m.active=!0,d.active=!1,d.end=!1,d.prev=!1,this.slideChange.emit(),this._isSliding=!1}),this._emulateTransitionEnd(_,S)}!this._isPlaying&&this.interval>0&&this.play()}_reflow(l){return l.offsetHeight}_emulateTransitionEnd(l,n){let s=!1,m=n+5;Fo(l,"transitionend").pipe(tn(1)).subscribe(()=>{s=!0}),setTimeout(()=>{s||l.dispatchEvent(new Event("transitionend"))},m)}_getNewSlideIndex(l){let n;return l===fl.NEXT&&(n=this._getNextSlideIndex()),l===fl.PREV&&(n=this._getPrevSlideIndex()),n}_getNextSlideIndex(){let l=this._activeSlide===this.items.length-1;return l?this.wrap&&l?0:this._activeSlide:this._activeSlide+1}_getPrevSlideIndex(){let l=this._activeSlide===0;return l?this.wrap&&l?this.items.length-1:this._activeSlide:this._activeSlide-1}static ngAcceptInputType_controls;static ngAcceptInputType_dark;static ngAcceptInputType_indicators;static ngAcceptInputType_ride;static \u0275fac=function(n){return new(n||a)(V(Ee),V(Zi))};static \u0275cmp=St({type:a,selectors:[["mdb-carousel"]],contentQueries:function(n,s,d){if(n&1&&fn(d,CM,4),n&2){let m;se(m=ae())&&(s._items=m)}},hostVars:2,hostBindings:function(n,s){n&1&&ct("mouseenter",function(){return s.onMouseEnter()})("mouseleave",function(){return s.onMouseLeave()}),n&2&&li("d-block",s.display)},inputs:{animation:"animation",controls:"controls",dark:"dark",indicators:"indicators",ride:"ride",interval:"interval",keyboard:"keyboard",pause:"pause",wrap:"wrap"},outputs:{slide:"slide",slideChange:"slideChange"},ngContentSelectors:Xz,decls:6,vars:7,consts:[[1,"carousel","slide"],["class","carousel-indicators",4,"ngIf"],[1,"carousel-inner"],["class","carousel-control-prev","type","button",3,"click",4,"ngIf"],["class","carousel-control-next","type","button",3,"click",4,"ngIf"],[1,"carousel-indicators"],["type","button",3,"active","click",4,"ngFor","ngForOf"],["type","button",3,"click"],["type","button",1,"carousel-control-prev",3,"click"],["aria-hidden","true",1,"carousel-control-prev-icon"],[1,"visually-hidden"],["type","button",1,"carousel-control-next",3,"click"],["aria-hidden","true",1,"carousel-control-next-icon"]],template:function(n,s){n&1&&(Un(),T(0,"div",0),ut(1,DK,2,1,"div",1),T(2,"div",2),Ai(3),k(),ut(4,TK,4,0,"button",3)(5,IK,4,0,"button",4),k()),n&2&&(li("carousel-fade",s.animation==="fade")("carousel-dark",s.dark),z(),W("ngIf",s.indicators),z(3),W("ngIf",s.controls),z(),W("ngIf",s.controls))},dependencies:[pi,Ve],encapsulation:2,changeDetection:0})}return a})(),Qz=(()=>{class a{static \u0275fac=function(n){return new(n||a)};static \u0275mod=Si({type:a});static \u0275inj=Ei({imports:[zo]})}return a})();var Jz=(()=>{let r=class r{constructor(n,s){this.http=n,this.identityService=s,this.homeEventsSubject=new We({recommendedEvents:[],selectedEvents:[]})}setHomeEvents(n){this.homeEventsSubject.next(n)}getHomeEvents(){return this.homeEventsSubject.asObservable()}fetchHomeEvents(){return Tt(this,null,function*(){if(this.identityService.getToken())try{let s=yield Ne(this.http.get(be+"/events/home",{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setHomeEvents(s)}catch(s){console.error("Error fetching recommended events",s)}else try{let s=yield Ne(this.http.get(be+"/events/home"));this.setHomeEvents(s)}catch(s){console.error("Error fetching recommended events",s)}})}};r.\u0275fac=function(s){return new(s||r)(ht(Hi),ht(oi))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var RK=()=>["events"],PK=a=>({location:a});function OK(a,r){if(a&1&&(T(0,"mdb-carousel-item"),dt(1,"img",8),T(2,"div",9)(3,"h5"),B(4),k(),T(5,"p"),B(6),k()()()),a&2){let l=r.$implicit;z(),Js("src",l.imageUrl,Vr),z(),W("routerLink",Ln(5,RK))("queryParams",xi(6,PK,l.name)),z(2),Te(l.name),z(2),Te(l.address)}}function FK(a,r){if(a&1&&(T(0,"mdb-carousel",6),ut(1,OK,7,8,"mdb-carousel-item",7),k()),a&2){let l=gt();W("animation","slide")("controls",!0)("interval",5e3)("indicators",!0),z(),W("ngForOf",l.locations)}}var tN=a=>["event",a],eN=a=>({id:a});function LK(a,r){if(a&1&&(T(0,"div",11),dt(1,"img",12),T(2,"div",13)(3,"p",14),B(4),k()()()),a&2){let l=r.$implicit;W("routerLink",xi(4,tN,l.title))("queryParams",xi(6,eN,l.id)),z(),Js("src",l.imageUrl,Vr),z(3),Te(l.title)}}function zK(a,r){if(a&1&&(T(0,"div",10),dt(1,"hr"),T(2,"h1",3),B(3,"Evenimente recomandate"),k(),T(4,"div",4),ut(5,LK,5,8,"div",5),k()()),a&2){let l=gt();z(5),W("ngForOf",l.recommendedEvents)}}function NK(a,r){if(a&1&&(T(0,"div",11),dt(1,"img",12),T(2,"div",13)(3,"p",14),B(4),k()()()),a&2){let l=r.$implicit;W("routerLink",xi(4,tN,l.title))("queryParams",xi(6,eN,l.id)),z(),Js("src",l.imageUrl,Vr),z(3),Te(l.title)}}var iN=(()=>{let r=class r{constructor(n,s,d){this.homeService=n,this.identityService=s,this.headerService=d,this.selectedEvents=[],this.recommendedEvents=[],this.locations=[]}ngOnInit(){return Tt(this,null,function*(){yield this.homeService.fetchHomeEvents(),this.homeEventsSubscription=this.homeService.getHomeEvents().subscribe(n=>{this.selectedEvents=n.selectedEvents,this.recommendedEvents=n.recommendedEvents}),this.locationSubscription=this.headerService.getHeaderData().subscribe(n=>{this.locations=n.locations})})}ngOnDestroy(){this.homeEventsSubscription?.unsubscribe(),this.locationSubscription?.unsubscribe()}isLoggedIn(){return this.identityService.isLoggedIn()}};r.\u0275fac=function(s){return new(s||r)(V(Jz),V(oi),V(ql))},r.\u0275cmp=St({type:r,selectors:[["app-home"]],standalone:!0,features:[At],decls:9,vars:3,consts:[[1,"container-fluid"],["class","carousel",3,"animation","controls","interval","indicators",4,"ngIf"],["class","recommended-events",4,"ngIf"],[1,"text-center"],[1,"cards-container"],["class","card",3,"routerLink","queryParams",4,"ngFor","ngForOf"],[1,"carousel",3,"animation","controls","interval","indicators"],[4,"ngFor","ngForOf"],["alt","First slide",1,"d-block","w-100",3,"src"],["role","button",1,"carousel-caption","d-none","d-md-block",3,"routerLink","queryParams"],[1,"recommended-events"],[1,"card",3,"routerLink","queryParams"],["alt","",1,"card-img-top",3,"src"],[1,"card-body"],[1,"card-text"]],template:function(s,d){s&1&&(T(0,"div",0),ut(1,FK,2,5,"mdb-carousel",1)(2,zK,6,1,"div",2),dt(3,"hr"),T(4,"h1",3),B(5,"Evenimente selectate"),k(),T(6,"div",4),ut(7,NK,5,8,"div",5),k()(),dt(8,"hr")),s&2&&(z(),W("ngIf",d.locations==null?null:d.locations.length),z(),W("ngIf",d.isLoggedIn()),z(5),W("ngForOf",d.selectedEvents))},dependencies:[pi,Ve,Qz,Kz,CM,kn],styles:[".container-fluid[_ngcontent-%COMP%]{padding-left:100px;padding-right:100px}.cards-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:center;align-items:center;gap:20px}.card[_ngcontent-%COMP%]{padding:10px;border:1px solid #ccc;border-radius:5px;box-shadow:0 2px 3px #ccc;width:200px;height:450px;text-align:center;background-color:#f8f8f8;cursor:pointer;transition:all .3s ease-in-out}.card[_ngcontent-%COMP%]:hover{transform:scale(1.05);box-shadow:0 4px 6px #ccc}.carousel-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:600px;object-fit:cover}@media (max-width: 768px){.container-fluid[_ngcontent-%COMP%]{padding-left:20px;padding-right:20px}.card[_ngcontent-%COMP%]{width:250px;height:450px}.card-body[_ngcontent-%COMP%]{padding:5px}.carousel-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:200px}}@media (max-width: 576px){.container-fluid[_ngcontent-%COMP%]{padding-left:10px;padding-right:10px}}"]});let a=r;return a})();var nN=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=St({type:r,selectors:[["app-location"]],standalone:!0,features:[At],decls:2,vars:0,template:function(s,d){s&1&&(T(0,"p"),B(1,"location component"),k())}});let a=r;return a})();var SM=class{constructor(r){this._box=r,this._destroyed=new pe,this._resizeSubject=new pe,this._elementObservables=new Map,typeof ResizeObserver<"u"&&(this._resizeObserver=new ResizeObserver(l=>this._resizeSubject.next(l)))}observe(r){return this._elementObservables.has(r)||this._elementObservables.set(r,new ya(l=>{let n=this._resizeSubject.subscribe(l);return this._resizeObserver?.observe(r,{box:this._box}),()=>{this._resizeObserver?.unobserve(r),n.unsubscribe(),this._elementObservables.delete(r)}}).pipe(pn(l=>l.some(n=>n.target===r)),TS({bufferSize:1,refCount:!0}),ni(this._destroyed))),this._elementObservables.get(r)}destroy(){this._destroyed.next(),this._destroyed.complete(),this._resizeSubject.complete(),this._elementObservables.clear()}},rN=(()=>{let r=class r{constructor(){this._observers=new Map,this._ngZone=le(Be),typeof ResizeObserver<"u"}ngOnDestroy(){for(let[,n]of this._observers)n.destroy();this._observers.clear(),typeof ResizeObserver<"u"}observe(n,s){let d=s?.box||"content-box";return this._observers.has(d)||this._observers.set(d,new SM(d)),this._observers.get(d).observe(n)}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var BK=["notch"],VK=["matFormFieldNotchedOutline",""],jK=["*"],UK=["textField"],HK=["iconPrefixContainer"],GK=["textPrefixContainer"];function qK(a,r){a&1&&dt(0,"span",16)}function WK(a,r){if(a&1&&(T(0,"label",14),Ai(1,1),ut(2,qK,1,0,"span",15),k()),a&2){let l=gt(2);W("floating",l._shouldLabelFloat())("monitorResize",l._hasOutline())("id",l._labelId),ri("for",l._control.id),z(2),Xi(2,!l.hideRequiredMarker&&l._control.required?2:-1)}}function $K(a,r){if(a&1&&ut(0,WK,3,5,"label",14),a&2){let l=gt();Xi(0,l._hasFloatingLabel()?0:-1)}}function YK(a,r){a&1&&dt(0,"div",17)}function ZK(a,r){}function XK(a,r){if(a&1&&ut(0,ZK,0,0,"ng-template",9),a&2){gt(2);let l=oo(1);W("ngTemplateOutlet",l)}}function KK(a,r){if(a&1&&(T(0,"div",5),ut(1,XK,1,1,null,9),k()),a&2){let l=gt();W("matFormFieldNotchedOutlineOpen",l._shouldLabelFloat()),z(),Xi(1,l._forceDisplayInfixLabel()?-1:1)}}function QK(a,r){a&1&&(T(0,"div",18,19),Ai(2,2),k())}function JK(a,r){a&1&&(T(0,"div",20,21),Ai(2,3),k())}function tQ(a,r){}function eQ(a,r){if(a&1&&ut(0,tQ,0,0,"ng-template",9),a&2){gt();let l=oo(1);W("ngTemplateOutlet",l)}}function iQ(a,r){a&1&&(T(0,"div",22),Ai(1,4),k())}function nQ(a,r){a&1&&(T(0,"div",23),Ai(1,5),k())}function rQ(a,r){a&1&&dt(0,"div",12)}function oQ(a,r){if(a&1&&(T(0,"div",24),Ai(1,6),k()),a&2){let l=gt();W("@transitionMessages",l._subscriptAnimationState)}}function sQ(a,r){if(a&1&&(T(0,"mat-hint",26),B(1),k()),a&2){let l=gt(2);W("id",l._hintLabelId),z(),Te(l.hintLabel)}}function aQ(a,r){if(a&1&&(T(0,"div",25),ut(1,sQ,2,2,"mat-hint",26),Ai(2,7),dt(3,"div",27),Ai(4,8),k()),a&2){let l=gt();W("@transitionMessages",l._subscriptAnimationState),z(),Xi(1,l.hintLabel?1:-1)}}var lQ=["*",[["mat-label"]],[["","matPrefix",""],["","matIconPrefix",""]],[["","matTextPrefix",""]],[["","matTextSuffix",""]],[["","matSuffix",""],["","matIconSuffix",""]],[["mat-error"],["","matError",""]],[["mat-hint",3,"align","end"]],[["mat-hint","align","end"]]],cQ=["*","mat-label","[matPrefix], [matIconPrefix]","[matTextPrefix]","[matTextSuffix]","[matSuffix], [matIconSuffix]","mat-error, [matError]","mat-hint:not([align='end'])","mat-hint[align='end']"],Ny=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275dir=oe({type:r,selectors:[["mat-label"]],standalone:!0});let a=r;return a})();var dQ=new Se("MatError");var uQ=0,oN=(()=>{let r=class r{constructor(){this.align="start",this.id=`mat-mdc-hint-${uQ++}`}};r.\u0275fac=function(s){return new(s||r)},r.\u0275dir=oe({type:r,selectors:[["mat-hint"]],hostAttrs:[1,"mat-mdc-form-field-hint","mat-mdc-form-field-bottom-align"],hostVars:4,hostBindings:function(s,d){s&2&&(Os("id",d.id),ri("align",null),li("mat-mdc-form-field-hint-end",d.align==="end"))},inputs:{align:"align",id:"id"},standalone:!0});let a=r;return a})(),hQ=new Se("MatPrefix");var mN=new Se("MatSuffix"),pN=(()=>{let r=class r{constructor(){this._isText=!1}set _isTextSelector(n){this._isText=!0}};r.\u0275fac=function(s){return new(s||r)},r.\u0275dir=oe({type:r,selectors:[["","matSuffix",""],["","matIconSuffix",""],["","matTextSuffix",""]],inputs:{_isTextSelector:[Rt.None,"matTextSuffix","_isTextSelector"]},standalone:!0,features:[ji([{provide:mN,useExisting:r}])]});let a=r;return a})(),fN=new Se("FloatingLabelParent"),sN=(()=>{let r=class r{get floating(){return this._floating}set floating(n){this._floating=n,this.monitorResize&&this._handleResize()}get monitorResize(){return this._monitorResize}set monitorResize(n){this._monitorResize=n,this._monitorResize?this._subscribeToResize():this._resizeSubscription.unsubscribe()}constructor(n){this._elementRef=n,this._floating=!1,this._monitorResize=!1,this._resizeObserver=le(rN),this._ngZone=le(Be),this._parent=le(fN),this._resizeSubscription=new sr}ngOnDestroy(){this._resizeSubscription.unsubscribe()}getWidth(){return mQ(this._elementRef.nativeElement)}get element(){return this._elementRef.nativeElement}_handleResize(){setTimeout(()=>this._parent._handleLabelResized())}_subscribeToResize(){this._resizeSubscription.unsubscribe(),this._ngZone.runOutsideAngular(()=>{this._resizeSubscription=this._resizeObserver.observe(this._elementRef.nativeElement,{box:"border-box"}).subscribe(()=>this._handleResize())})}};r.\u0275fac=function(s){return new(s||r)(V(Ee))},r.\u0275dir=oe({type:r,selectors:[["label","matFormFieldFloatingLabel",""]],hostAttrs:[1,"mdc-floating-label","mat-mdc-floating-label"],hostVars:2,hostBindings:function(s,d){s&2&&li("mdc-floating-label--float-above",d.floating)},inputs:{floating:"floating",monitorResize:"monitorResize"},standalone:!0});let a=r;return a})();function mQ(a){let r=a;if(r.offsetParent!==null)return r.scrollWidth;let l=r.cloneNode(!0);l.style.setProperty("position","absolute"),l.style.setProperty("transform","translate(-9999px, -9999px)"),document.documentElement.appendChild(l);let n=l.scrollWidth;return l.remove(),n}var aN="mdc-line-ripple--active",zy="mdc-line-ripple--deactivating",lN=(()=>{let r=class r{constructor(n,s){this._elementRef=n,this._handleTransitionEnd=d=>{let m=this._elementRef.nativeElement.classList,_=m.contains(zy);d.propertyName==="opacity"&&_&&m.remove(aN,zy)},s.runOutsideAngular(()=>{n.nativeElement.addEventListener("transitionend",this._handleTransitionEnd)})}activate(){let n=this._elementRef.nativeElement.classList;n.remove(zy),n.add(aN)}deactivate(){this._elementRef.nativeElement.classList.add(zy)}ngOnDestroy(){this._elementRef.nativeElement.removeEventListener("transitionend",this._handleTransitionEnd)}};r.\u0275fac=function(s){return new(s||r)(V(Ee),V(Be))},r.\u0275dir=oe({type:r,selectors:[["div","matFormFieldLineRipple",""]],hostAttrs:[1,"mdc-line-ripple"],standalone:!0});let a=r;return a})(),cN=(()=>{let r=class r{constructor(n,s){this._elementRef=n,this._ngZone=s,this.open=!1}ngAfterViewInit(){let n=this._elementRef.nativeElement.querySelector(".mdc-floating-label");n?(this._elementRef.nativeElement.classList.add("mdc-notched-outline--upgraded"),typeof requestAnimationFrame=="function"&&(n.style.transitionDuration="0s",this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>n.style.transitionDuration="")}))):this._elementRef.nativeElement.classList.add("mdc-notched-outline--no-label")}_setNotchWidth(n){!this.open||!n?this._notch.nativeElement.style.width="":this._notch.nativeElement.style.width=`calc(${n}px * var(--mat-mdc-form-field-floating-label-scale, 0.75) + 9px)`}};r.\u0275fac=function(s){return new(s||r)(V(Ee),V(Be))},r.\u0275cmp=St({type:r,selectors:[["div","matFormFieldNotchedOutline",""]],viewQuery:function(s,d){if(s&1&&ze(BK,5),s&2){let m;se(m=ae())&&(d._notch=m.first)}},hostAttrs:[1,"mdc-notched-outline"],hostVars:2,hostBindings:function(s,d){s&2&&li("mdc-notched-outline--notched",d.open)},inputs:{open:[Rt.None,"matFormFieldNotchedOutlineOpen","open"]},standalone:!0,features:[At],attrs:VK,ngContentSelectors:jK,decls:5,vars:0,consts:[[1,"mdc-notched-outline__leading"],[1,"mdc-notched-outline__notch"],["notch",""],[1,"mdc-notched-outline__trailing"]],template:function(s,d){s&1&&(Un(),dt(0,"div",0),T(1,"div",1,2),Ai(3),k(),dt(4,"div",3))},encapsulation:2,changeDetection:0});let a=r;return a})(),pQ={transitionMessages:wr("transitionMessages",[En("enter",hi({opacity:1,transform:"translateY(0%)"})),ln("void => enter",[hi({opacity:0,transform:"translateY(-5px)"}),Sn("300ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])},Tm=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275dir=oe({type:r});let a=r;return a})();var Fu=new Se("MatFormField"),fQ=new Se("MAT_FORM_FIELD_DEFAULT_OPTIONS"),dN=0,uN="fill",gQ="auto",hN="fixed",_Q="translateY(-50%)",By=(()=>{let r=class r{get hideRequiredMarker(){return this._hideRequiredMarker}set hideRequiredMarker(n){this._hideRequiredMarker=ao(n)}get floatLabel(){return this._floatLabel||this._defaults?.floatLabel||gQ}set floatLabel(n){n!==this._floatLabel&&(this._floatLabel=n,this._changeDetectorRef.markForCheck())}get appearance(){return this._appearance}set appearance(n){let s=this._appearance,d=n||this._defaults?.appearance||uN;this._appearance=d,this._appearance==="outline"&&this._appearance!==s&&(this._needsOutlineLabelOffsetUpdateOnStable=!0)}get subscriptSizing(){return this._subscriptSizing||this._defaults?.subscriptSizing||hN}set subscriptSizing(n){this._subscriptSizing=n||this._defaults?.subscriptSizing||hN}get hintLabel(){return this._hintLabel}set hintLabel(n){this._hintLabel=n,this._processHints()}get _control(){return this._explicitFormFieldControl||this._formFieldControl}set _control(n){this._explicitFormFieldControl=n}constructor(n,s,d,m,_,w,S,I){this._elementRef=n,this._changeDetectorRef=s,this._ngZone=d,this._dir=m,this._platform=_,this._defaults=w,this._animationMode=S,this._hideRequiredMarker=!1,this.color="primary",this._appearance=uN,this._subscriptSizing=null,this._hintLabel="",this._hasIconPrefix=!1,this._hasTextPrefix=!1,this._hasIconSuffix=!1,this._hasTextSuffix=!1,this._labelId=`mat-mdc-form-field-label-${dN++}`,this._hintLabelId=`mat-mdc-hint-${dN++}`,this._subscriptAnimationState="",this._destroyed=new pe,this._isFocused=null,this._needsOutlineLabelOffsetUpdateOnStable=!1,w&&(w.appearance&&(this.appearance=w.appearance),this._hideRequiredMarker=!!w?.hideRequiredMarker,w.color&&(this.color=w.color))}ngAfterViewInit(){this._updateFocusState(),this._subscriptAnimationState="enter",this._changeDetectorRef.detectChanges()}ngAfterContentInit(){this._assertFormFieldControl(),this._initializeControl(),this._initializeSubscript(),this._initializePrefixAndSuffix(),this._initializeOutlineLabelOffsetSubscriptions()}ngAfterContentChecked(){this._assertFormFieldControl()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}getLabelId(){return this._hasFloatingLabel()?this._labelId:null}getConnectedOverlayOrigin(){return this._textField||this._elementRef}_animateAndLockLabel(){this._hasFloatingLabel()&&(this.floatLabel="always")}_initializeControl(){let n=this._control;n.controlType&&this._elementRef.nativeElement.classList.add(`mat-mdc-form-field-type-${n.controlType}`),n.stateChanges.subscribe(()=>{this._updateFocusState(),this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),n.ngControl&&n.ngControl.valueChanges&&n.ngControl.valueChanges.pipe(ni(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck())}_checkPrefixAndSuffixTypes(){this._hasIconPrefix=!!this._prefixChildren.find(n=>!n._isText),this._hasTextPrefix=!!this._prefixChildren.find(n=>n._isText),this._hasIconSuffix=!!this._suffixChildren.find(n=>!n._isText),this._hasTextSuffix=!!this._suffixChildren.find(n=>n._isText)}_initializePrefixAndSuffix(){this._checkPrefixAndSuffixTypes(),no(this._prefixChildren.changes,this._suffixChildren.changes).subscribe(()=>{this._checkPrefixAndSuffixTypes(),this._changeDetectorRef.markForCheck()})}_initializeSubscript(){this._hintChildren.changes.subscribe(()=>{this._processHints(),this._changeDetectorRef.markForCheck()}),this._errorChildren.changes.subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),this._validateHints(),this._syncDescribedByIds()}_assertFormFieldControl(){this._control}_updateFocusState(){this._control.focused&&!this._isFocused?(this._isFocused=!0,this._lineRipple?.activate()):!this._control.focused&&(this._isFocused||this._isFocused===null)&&(this._isFocused=!1,this._lineRipple?.deactivate()),this._textField?.nativeElement.classList.toggle("mdc-text-field--focused",this._control.focused)}_initializeOutlineLabelOffsetSubscriptions(){this._prefixChildren.changes.subscribe(()=>this._needsOutlineLabelOffsetUpdateOnStable=!0),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(ni(this._destroyed)).subscribe(()=>{this._needsOutlineLabelOffsetUpdateOnStable&&(this._needsOutlineLabelOffsetUpdateOnStable=!1,this._updateOutlineLabelOffset())})}),this._dir.change.pipe(ni(this._destroyed)).subscribe(()=>this._needsOutlineLabelOffsetUpdateOnStable=!0)}_shouldAlwaysFloat(){return this.floatLabel==="always"}_hasOutline(){return this.appearance==="outline"}_forceDisplayInfixLabel(){return!this._platform.isBrowser&&this._prefixChildren.length&&!this._shouldLabelFloat()}_hasFloatingLabel(){return!!this._labelChildNonStatic||!!this._labelChildStatic}_shouldLabelFloat(){return this._control.shouldLabelFloat||this._shouldAlwaysFloat()}_shouldForward(n){let s=this._control?this._control.ngControl:null;return s&&s[n]}_getDisplayedMessages(){return this._errorChildren&&this._errorChildren.length>0&&this._control.errorState?"error":"hint"}_handleLabelResized(){this._refreshOutlineNotchWidth()}_refreshOutlineNotchWidth(){!this._hasOutline()||!this._floatingLabel||!this._shouldLabelFloat()?this._notchedOutline?._setNotchWidth(0):this._notchedOutline?._setNotchWidth(this._floatingLabel.getWidth())}_processHints(){this._validateHints(),this._syncDescribedByIds()}_validateHints(){this._hintChildren}_syncDescribedByIds(){if(this._control){let n=[];if(this._control.userAriaDescribedBy&&typeof this._control.userAriaDescribedBy=="string"&&n.push(...this._control.userAriaDescribedBy.split(" ")),this._getDisplayedMessages()==="hint"){let s=this._hintChildren?this._hintChildren.find(m=>m.align==="start"):null,d=this._hintChildren?this._hintChildren.find(m=>m.align==="end"):null;s?n.push(s.id):this._hintLabel&&n.push(this._hintLabelId),d&&n.push(d.id)}else this._errorChildren&&n.push(...this._errorChildren.map(s=>s.id));this._control.setDescribedByIds(n)}}_updateOutlineLabelOffset(){if(!this._platform.isBrowser||!this._hasOutline()||!this._floatingLabel)return;let n=this._floatingLabel.element;if(!(this._iconPrefixContainer||this._textPrefixContainer)){n.style.transform="";return}if(!this._isAttachedToDom()){this._needsOutlineLabelOffsetUpdateOnStable=!0;return}let s=this._iconPrefixContainer?.nativeElement,d=this._textPrefixContainer?.nativeElement,m=s?.getBoundingClientRect().width??0,_=d?.getBoundingClientRect().width??0,w=this._dir.value==="rtl"?"-1":"1",S=`${m+_}px`,L=`calc(${w} * (${S} + var(--mat-mdc-form-field-label-offset-x, 0px)))`;n.style.transform=`var(
        --mat-mdc-form-field-label-transform,
        ${_Q} translateX(${L})
    )`}_isAttachedToDom(){let n=this._elementRef.nativeElement;if(n.getRootNode){let s=n.getRootNode();return s&&s!==n}return document.documentElement.contains(n)}};r.\u0275fac=function(s){return new(s||r)(V(Ee),V(Zi),V(Be),V(Ao),V(gn),V(fQ,8),V(Eo,8),V(ci))},r.\u0275cmp=St({type:r,selectors:[["mat-form-field"]],contentQueries:function(s,d,m){if(s&1&&(fn(m,Ny,5),fn(m,Ny,7),fn(m,Tm,5),fn(m,hQ,5),fn(m,mN,5),fn(m,dQ,5),fn(m,oN,5)),s&2){let _;se(_=ae())&&(d._labelChildNonStatic=_.first),se(_=ae())&&(d._labelChildStatic=_.first),se(_=ae())&&(d._formFieldControl=_.first),se(_=ae())&&(d._prefixChildren=_),se(_=ae())&&(d._suffixChildren=_),se(_=ae())&&(d._errorChildren=_),se(_=ae())&&(d._hintChildren=_)}},viewQuery:function(s,d){if(s&1&&(ze(UK,5),ze(HK,5),ze(GK,5),ze(sN,5),ze(cN,5),ze(lN,5)),s&2){let m;se(m=ae())&&(d._textField=m.first),se(m=ae())&&(d._iconPrefixContainer=m.first),se(m=ae())&&(d._textPrefixContainer=m.first),se(m=ae())&&(d._floatingLabel=m.first),se(m=ae())&&(d._notchedOutline=m.first),se(m=ae())&&(d._lineRipple=m.first)}},hostAttrs:[1,"mat-mdc-form-field"],hostVars:42,hostBindings:function(s,d){s&2&&li("mat-mdc-form-field-label-always-float",d._shouldAlwaysFloat())("mat-mdc-form-field-has-icon-prefix",d._hasIconPrefix)("mat-mdc-form-field-has-icon-suffix",d._hasIconSuffix)("mat-form-field-invalid",d._control.errorState)("mat-form-field-disabled",d._control.disabled)("mat-form-field-autofilled",d._control.autofilled)("mat-form-field-no-animations",d._animationMode==="NoopAnimations")("mat-form-field-appearance-fill",d.appearance=="fill")("mat-form-field-appearance-outline",d.appearance=="outline")("mat-form-field-hide-placeholder",d._hasFloatingLabel()&&!d._shouldLabelFloat())("mat-focused",d._control.focused)("mat-primary",d.color!=="accent"&&d.color!=="warn")("mat-accent",d.color==="accent")("mat-warn",d.color==="warn")("ng-untouched",d._shouldForward("untouched"))("ng-touched",d._shouldForward("touched"))("ng-pristine",d._shouldForward("pristine"))("ng-dirty",d._shouldForward("dirty"))("ng-valid",d._shouldForward("valid"))("ng-invalid",d._shouldForward("invalid"))("ng-pending",d._shouldForward("pending"))},inputs:{hideRequiredMarker:"hideRequiredMarker",color:"color",floatLabel:"floatLabel",appearance:"appearance",subscriptSizing:"subscriptSizing",hintLabel:"hintLabel"},exportAs:["matFormField"],standalone:!0,features:[ji([{provide:Fu,useExisting:r},{provide:fN,useExisting:r}]),At],ngContentSelectors:cQ,decls:18,vars:21,consts:[["labelTemplate",""],[1,"mat-mdc-text-field-wrapper","mdc-text-field",3,"click"],["textField",""],["class","mat-mdc-form-field-focus-overlay"],[1,"mat-mdc-form-field-flex"],["matFormFieldNotchedOutline","",3,"matFormFieldNotchedOutlineOpen"],["class","mat-mdc-form-field-icon-prefix"],["class","mat-mdc-form-field-text-prefix"],[1,"mat-mdc-form-field-infix"],[3,"ngTemplateOutlet"],["class","mat-mdc-form-field-text-suffix"],["class","mat-mdc-form-field-icon-suffix"],["matFormFieldLineRipple",""],[1,"mat-mdc-form-field-subscript-wrapper","mat-mdc-form-field-bottom-align"],["matFormFieldFloatingLabel","",3,"floating","monitorResize","id"],["aria-hidden","true","class","mat-mdc-form-field-required-marker mdc-floating-label--required"],["aria-hidden","true",1,"mat-mdc-form-field-required-marker","mdc-floating-label--required"],[1,"mat-mdc-form-field-focus-overlay"],[1,"mat-mdc-form-field-icon-prefix"],["iconPrefixContainer",""],[1,"mat-mdc-form-field-text-prefix"],["textPrefixContainer",""],[1,"mat-mdc-form-field-text-suffix"],[1,"mat-mdc-form-field-icon-suffix"],[1,"mat-mdc-form-field-error-wrapper"],[1,"mat-mdc-form-field-hint-wrapper"],[3,"id"],[1,"mat-mdc-form-field-hint-spacer"]],template:function(s,d){if(s&1&&(Un(lQ),ut(0,$K,1,1,"ng-template",null,0,Cv),T(2,"div",1,2),ct("click",function(_){return d._control.onContainerClick(_)}),ut(4,YK,1,0,"div",3),T(5,"div",4),ut(6,KK,2,2,"div",5)(7,QK,3,0,"div",6)(8,JK,3,0,"div",7),T(9,"div",8),ut(10,eQ,1,1,null,9),Ai(11),k(),ut(12,iQ,2,0,"div",10)(13,nQ,2,0,"div",11),k(),ut(14,rQ,1,0,"div",12),k(),T(15,"div",13),ut(16,oQ,2,1)(17,aQ,5,2),k()),s&2){let m;z(2),li("mdc-text-field--filled",!d._hasOutline())("mdc-text-field--outlined",d._hasOutline())("mdc-text-field--no-label",!d._hasFloatingLabel())("mdc-text-field--disabled",d._control.disabled)("mdc-text-field--invalid",d._control.errorState),z(2),Xi(4,!d._hasOutline()&&!d._control.disabled?4:-1),z(2),Xi(6,d._hasOutline()?6:-1),z(),Xi(7,d._hasIconPrefix?7:-1),z(),Xi(8,d._hasTextPrefix?8:-1),z(2),Xi(10,!d._hasOutline()||d._forceDisplayInfixLabel()?10:-1),z(2),Xi(12,d._hasTextSuffix?12:-1),z(),Xi(13,d._hasIconSuffix?13:-1),z(),Xi(14,d._hasOutline()?-1:14),z(),li("mat-mdc-form-field-subscript-dynamic-size",d.subscriptSizing==="dynamic"),z(),Xi(16,(m=d._getDisplayedMessages())==="error"?16:m==="hint"?17:-1)}},dependencies:[sN,cN,sL,lN,oN],styles:['.mdc-text-field{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:0;border-bottom-left-radius:0;display:inline-flex;align-items:baseline;padding:0 16px;position:relative;box-sizing:border-box;overflow:hidden;will-change:opacity,transform,color}.mdc-text-field .mdc-floating-label{top:50%;transform:translateY(-50%);pointer-events:none}.mdc-text-field__input{height:28px;width:100%;min-width:0;border:none;border-radius:0;background:none;appearance:none;padding:0}.mdc-text-field__input::-ms-clear{display:none}.mdc-text-field__input::-webkit-calendar-picker-indicator{display:none}.mdc-text-field__input:focus{outline:none}.mdc-text-field__input:invalid{box-shadow:none}@media all{.mdc-text-field__input::placeholder{opacity:0}}@media all{.mdc-text-field__input:-ms-input-placeholder{opacity:0}}@media all{.mdc-text-field--no-label .mdc-text-field__input::placeholder,.mdc-text-field--focused .mdc-text-field__input::placeholder{opacity:1}}@media all{.mdc-text-field--no-label .mdc-text-field__input:-ms-input-placeholder,.mdc-text-field--focused .mdc-text-field__input:-ms-input-placeholder{opacity:1}}.mdc-text-field__affix{height:28px;opacity:0;white-space:nowrap}.mdc-text-field--label-floating .mdc-text-field__affix,.mdc-text-field--no-label .mdc-text-field__affix{opacity:1}@supports(-webkit-hyphens: none){.mdc-text-field--outlined .mdc-text-field__affix{align-items:center;align-self:center;display:inline-flex;height:100%}}.mdc-text-field__affix--prefix{padding-left:0;padding-right:2px}[dir=rtl] .mdc-text-field__affix--prefix,.mdc-text-field__affix--prefix[dir=rtl]{padding-left:2px;padding-right:0}.mdc-text-field--end-aligned .mdc-text-field__affix--prefix{padding-left:0;padding-right:12px}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__affix--prefix,.mdc-text-field--end-aligned .mdc-text-field__affix--prefix[dir=rtl]{padding-left:12px;padding-right:0}.mdc-text-field__affix--suffix{padding-left:12px;padding-right:0}[dir=rtl] .mdc-text-field__affix--suffix,.mdc-text-field__affix--suffix[dir=rtl]{padding-left:0;padding-right:12px}.mdc-text-field--end-aligned .mdc-text-field__affix--suffix{padding-left:2px;padding-right:0}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__affix--suffix,.mdc-text-field--end-aligned .mdc-text-field__affix--suffix[dir=rtl]{padding-left:0;padding-right:2px}.mdc-text-field--filled{height:56px}.mdc-text-field--filled::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}.mdc-text-field--filled .mdc-floating-label{left:16px;right:initial}[dir=rtl] .mdc-text-field--filled .mdc-floating-label,.mdc-text-field--filled .mdc-floating-label[dir=rtl]{left:initial;right:16px}.mdc-text-field--filled .mdc-floating-label--float-above{transform:translateY(-106%) scale(0.75)}.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__input{height:100%}.mdc-text-field--filled.mdc-text-field--no-label .mdc-floating-label{display:none}.mdc-text-field--filled.mdc-text-field--no-label::before{display:none}@supports(-webkit-hyphens: none){.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__affix{align-items:center;align-self:center;display:inline-flex;height:100%}}.mdc-text-field--outlined{height:56px;overflow:visible}.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-37.25px) scale(1)}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-34.75px) scale(0.75)}.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--outlined .mdc-text-field__input{height:100%}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:4px;border-bottom-left-radius:var(--mdc-shape-small, 4px)}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading[dir=rtl]{border-top-left-radius:0;border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:4px;border-bottom-right-radius:var(--mdc-shape-small, 4px);border-bottom-left-radius:0}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{width:max(12px,var(--mdc-shape-small, 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__notch{max-width:calc(100% - max(12px,var(--mdc-shape-small, 4px))*2)}}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing{border-top-left-radius:0;border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:4px;border-bottom-right-radius:var(--mdc-shape-small, 4px);border-bottom-left-radius:0}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing[dir=rtl]{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:4px;border-bottom-left-radius:var(--mdc-shape-small, 4px)}@supports(top: max(0%)){.mdc-text-field--outlined{padding-left:max(16px,calc(var(--mdc-shape-small, 4px) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined{padding-right:max(16px,var(--mdc-shape-small, 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-left:max(16px,calc(var(--mdc-shape-small, 4px) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-right:max(16px,var(--mdc-shape-small, 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-left:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-right:max(16px,var(--mdc-shape-small, 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-right:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:max(16px,var(--mdc-shape-small, 4px))}}.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-right:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-left:max(16px,calc(var(--mdc-shape-small, 4px) + 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-right:max(16px,calc(var(--mdc-shape-small, 4px) + 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:1px}.mdc-text-field--outlined .mdc-floating-label{left:4px;right:initial}[dir=rtl] .mdc-text-field--outlined .mdc-floating-label,.mdc-text-field--outlined .mdc-floating-label[dir=rtl]{left:initial;right:4px}.mdc-text-field--outlined .mdc-text-field__input{display:flex;border:none !important;background-color:rgba(0,0,0,0)}.mdc-text-field--outlined .mdc-notched-outline{z-index:1}.mdc-text-field--textarea{flex-direction:column;align-items:center;width:auto;height:auto;padding:0}.mdc-text-field--textarea .mdc-floating-label{top:19px}.mdc-text-field--textarea .mdc-floating-label:not(.mdc-floating-label--float-above){transform:none}.mdc-text-field--textarea .mdc-text-field__input{flex-grow:1;height:auto;min-height:1.5rem;overflow-x:hidden;overflow-y:auto;box-sizing:border-box;resize:none;padding:0 16px}.mdc-text-field--textarea.mdc-text-field--filled::before{display:none}.mdc-text-field--textarea.mdc-text-field--filled .mdc-floating-label--float-above{transform:translateY(-10.25px) scale(0.75)}.mdc-text-field--textarea.mdc-text-field--filled .mdc-text-field__input{margin-top:23px;margin-bottom:9px}.mdc-text-field--textarea.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__input{margin-top:16px;margin-bottom:16px}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:0}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-27.25px) scale(1)}.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-24.75px) scale(0.75)}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-text-field__input{margin-top:16px;margin-bottom:16px}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label{top:18px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field__input{margin-bottom:2px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter{align-self:flex-end;padding:0 16px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter::after{display:inline-block;width:0;height:16px;content:"";vertical-align:-16px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter::before{display:none}.mdc-text-field__resizer{align-self:stretch;display:inline-flex;flex-direction:column;flex-grow:1;max-height:100%;max-width:100%;min-height:56px;min-width:fit-content;min-width:-moz-available;min-width:-webkit-fill-available;overflow:hidden;resize:both}.mdc-text-field--filled .mdc-text-field__resizer{transform:translateY(-1px)}.mdc-text-field--filled .mdc-text-field__resizer .mdc-text-field__input,.mdc-text-field--filled .mdc-text-field__resizer .mdc-text-field-character-counter{transform:translateY(1px)}.mdc-text-field--outlined .mdc-text-field__resizer{transform:translateX(-1px) translateY(-1px)}[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer,.mdc-text-field--outlined .mdc-text-field__resizer[dir=rtl]{transform:translateX(1px) translateY(-1px)}.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input,.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter{transform:translateX(1px) translateY(1px)}[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input,[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter,.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input[dir=rtl],.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter[dir=rtl]{transform:translateX(-1px) translateY(1px)}.mdc-text-field--with-leading-icon{padding-left:0;padding-right:16px}[dir=rtl] .mdc-text-field--with-leading-icon,.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:16px;padding-right:0}.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 48px);left:48px;right:initial}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label,.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label[dir=rtl]{left:initial;right:48px}.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100%/0.75 - 64px/0.75)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label{left:36px;right:initial}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label[dir=rtl]{left:initial;right:36px}.mdc-text-field--with-leading-icon.mdc-text-field--outlined :not(.mdc-notched-outline--notched) .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-37.25px) translateX(-32px) scale(1)}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above[dir=rtl]{transform:translateY(-37.25px) translateX(32px) scale(1)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-34.75px) translateX(-32px) scale(0.75)}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above[dir=rtl],.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above[dir=rtl]{transform:translateY(-34.75px) translateX(32px) scale(0.75)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--with-trailing-icon{padding-left:16px;padding-right:0}[dir=rtl] .mdc-text-field--with-trailing-icon,.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0;padding-right:16px}.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 64px)}.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100%/0.75 - 64px/0.75)}.mdc-text-field--with-trailing-icon.mdc-text-field--outlined :not(.mdc-notched-outline--notched) .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 96px)}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100%/0.75 - 96px/0.75)}.mdc-text-field-helper-line{display:flex;justify-content:space-between;box-sizing:border-box}.mdc-text-field+.mdc-text-field-helper-line{padding-right:16px;padding-left:16px}.mdc-form-field>.mdc-text-field+label{align-self:flex-start}.mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--focused .mdc-notched-outline__trailing{border-width:2px}.mdc-text-field--focused+.mdc-text-field-helper-line .mdc-text-field-helper-text:not(.mdc-text-field-helper-text--validation-msg){opacity:1}.mdc-text-field--focused.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:2px}.mdc-text-field--focused.mdc-text-field--outlined.mdc-text-field--textarea .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:0}.mdc-text-field--invalid+.mdc-text-field-helper-line .mdc-text-field-helper-text--validation-msg{opacity:1}.mdc-text-field--disabled{pointer-events:none}@media screen and (forced-colors: active){.mdc-text-field--disabled .mdc-text-field__input{background-color:Window}.mdc-text-field--disabled .mdc-floating-label{z-index:1}}.mdc-text-field--disabled .mdc-floating-label{cursor:default}.mdc-text-field--disabled.mdc-text-field--filled .mdc-text-field__ripple{display:none}.mdc-text-field--disabled .mdc-text-field__input{pointer-events:auto}.mdc-text-field--end-aligned .mdc-text-field__input{text-align:right}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__input,.mdc-text-field--end-aligned .mdc-text-field__input[dir=rtl]{text-align:left}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__input,[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__input,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix{direction:ltr}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--prefix{padding-left:0;padding-right:2px}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--suffix{padding-left:12px;padding-right:0}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__icon--leading,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__icon--leading{order:1}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--suffix{order:2}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__input,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__input{order:3}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--prefix{order:4}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__icon--trailing,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__icon--trailing{order:5}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__input,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__input{text-align:right}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__affix--prefix{padding-right:12px}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__affix--suffix{padding-left:2px}.mdc-floating-label{position:absolute;left:0;-webkit-transform-origin:left top;transform-origin:left top;line-height:1.15rem;text-align:left;text-overflow:ellipsis;white-space:nowrap;cursor:text;overflow:hidden;will-change:transform}[dir=rtl] .mdc-floating-label,.mdc-floating-label[dir=rtl]{right:0;left:auto;-webkit-transform-origin:right top;transform-origin:right top;text-align:right}.mdc-floating-label--float-above{cursor:auto}.mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after{margin-left:1px;margin-right:0px;content:"*"}[dir=rtl] .mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after,.mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)[dir=rtl]::after{margin-left:0;margin-right:1px}.mdc-notched-outline{display:flex;position:absolute;top:0;right:0;left:0;box-sizing:border-box;width:100%;max-width:100%;height:100%;text-align:left;pointer-events:none}[dir=rtl] .mdc-notched-outline,.mdc-notched-outline[dir=rtl]{text-align:right}.mdc-notched-outline__leading,.mdc-notched-outline__notch,.mdc-notched-outline__trailing{box-sizing:border-box;height:100%;pointer-events:none}.mdc-notched-outline__trailing{flex-grow:1}.mdc-notched-outline__notch{flex:0 0 auto;width:auto}.mdc-notched-outline .mdc-floating-label{display:inline-block;position:relative;max-width:100%}.mdc-notched-outline .mdc-floating-label--float-above{text-overflow:clip}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:133.3333333333%}.mdc-notched-outline--notched .mdc-notched-outline__notch{padding-left:0;padding-right:8px;border-top:none}[dir=rtl] .mdc-notched-outline--notched .mdc-notched-outline__notch,.mdc-notched-outline--notched .mdc-notched-outline__notch[dir=rtl]{padding-left:8px;padding-right:0}.mdc-notched-outline--no-label .mdc-notched-outline__notch{display:none}.mdc-line-ripple::before,.mdc-line-ripple::after{position:absolute;bottom:0;left:0;width:100%;border-bottom-style:solid;content:""}.mdc-line-ripple::before{z-index:1}.mdc-line-ripple::after{transform:scaleX(0);opacity:0;z-index:2}.mdc-line-ripple--active::after{transform:scaleX(1);opacity:1}.mdc-line-ripple--deactivating::after{opacity:0}.mdc-floating-label--float-above{transform:translateY(-106%) scale(0.75)}.mdc-notched-outline__leading,.mdc-notched-outline__notch,.mdc-notched-outline__trailing{border-top:1px solid;border-bottom:1px solid}.mdc-notched-outline__leading{border-left:1px solid;border-right:none;width:12px}[dir=rtl] .mdc-notched-outline__leading,.mdc-notched-outline__leading[dir=rtl]{border-left:none;border-right:1px solid}.mdc-notched-outline__trailing{border-left:none;border-right:1px solid}[dir=rtl] .mdc-notched-outline__trailing,.mdc-notched-outline__trailing[dir=rtl]{border-left:1px solid;border-right:none}.mdc-notched-outline__notch{max-width:calc(100% - 12px*2)}.mdc-line-ripple::before{border-bottom-width:1px}.mdc-line-ripple::after{border-bottom-width:2px}.mdc-text-field--filled{border-top-left-radius:var(--mdc-filled-text-field-container-shape);border-top-right-radius:var(--mdc-filled-text-field-container-shape);border-bottom-right-radius:0;border-bottom-left-radius:0}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-filled-text-field-caret-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-filled-text-field-error-caret-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-filled-text-field-input-text-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-filled-text-field-disabled-input-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-label-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-focus-label-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label,.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-hover-label-text-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--disabled .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-disabled-label-text-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-error-label-text-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-error-focus-label-text-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-error-hover-label-text-color)}.mdc-text-field--filled .mdc-floating-label{font-family:var(--mdc-filled-text-field-label-text-font);font-size:var(--mdc-filled-text-field-label-text-size);font-weight:var(--mdc-filled-text-field-label-text-weight);letter-spacing:var(--mdc-filled-text-field-label-text-tracking)}@media all{.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color)}}@media all{.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color)}}.mdc-text-field--filled:not(.mdc-text-field--disabled){background-color:var(--mdc-filled-text-field-container-color)}.mdc-text-field--filled.mdc-text-field--disabled{background-color:var(--mdc-filled-text-field-disabled-container-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-active-indicator-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-hover-active-indicator-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-focus-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-disabled-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-hover-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-error-focus-active-indicator-color)}.mdc-text-field--filled .mdc-line-ripple::before{border-bottom-width:var(--mdc-filled-text-field-active-indicator-height)}.mdc-text-field--filled .mdc-line-ripple::after{border-bottom-width:var(--mdc-filled-text-field-focus-active-indicator-height)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-outlined-text-field-caret-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-outlined-text-field-error-caret-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-outlined-text-field-input-text-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-outlined-text-field-disabled-input-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-label-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-focus-label-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label,.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-hover-label-text-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-disabled-label-text-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-error-label-text-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-error-focus-label-text-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-error-hover-label-text-color)}.mdc-text-field--outlined .mdc-floating-label{font-family:var(--mdc-outlined-text-field-label-text-font);font-size:var(--mdc-outlined-text-field-label-text-size);font-weight:var(--mdc-outlined-text-field-label-text-weight);letter-spacing:var(--mdc-outlined-text-field-label-text-tracking)}@media all{.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color)}}@media all{.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color)}}.mdc-text-field--outlined.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:calc(.75*var(--mdc-outlined-text-field-label-text-size))}.mdc-text-field--outlined.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:var(--mdc-outlined-text-field-label-text-size)}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{border-top-left-radius:var(--mdc-outlined-text-field-container-shape);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape)}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading[dir=rtl]{border-top-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-left-radius:0}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{width:max(12px,var(--mdc-outlined-text-field-container-shape))}}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__notch{max-width:calc(100% - max(12px,var(--mdc-outlined-text-field-container-shape))*2)}}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing{border-top-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-left-radius:0}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing[dir=rtl]{border-top-left-radius:var(--mdc-outlined-text-field-container-shape);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape)}@supports(top: max(0%)){.mdc-text-field--outlined{padding-left:max(16px,calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined{padding-right:max(16px,var(--mdc-outlined-text-field-container-shape))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-left:max(16px,calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-right:max(16px,var(--mdc-outlined-text-field-container-shape))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-left:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-right:max(16px,var(--mdc-outlined-text-field-container-shape))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-right:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:max(16px,var(--mdc-outlined-text-field-container-shape))}}.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-right:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-left:max(16px,calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-right:max(16px,calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-hover-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-focus-outline-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-disabled-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-hover-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-focus-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__trailing{border-width:var(--mdc-outlined-text-field-outline-width)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__trailing{border-width:var(--mdc-outlined-text-field-focus-outline-width)}.mat-mdc-form-field-textarea-control{vertical-align:middle;resize:vertical;box-sizing:border-box;height:auto;margin:0;padding:0;border:none;overflow:auto}.mat-mdc-form-field-input-control.mat-mdc-form-field-input-control{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:inherit;letter-spacing:inherit;text-decoration:inherit;text-transform:inherit;border:none}.mat-mdc-form-field .mat-mdc-floating-label.mdc-floating-label{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;line-height:normal;pointer-events:all}.mat-mdc-form-field:not(.mat-form-field-disabled) .mat-mdc-floating-label.mdc-floating-label{cursor:inherit}.mdc-text-field--no-label:not(.mdc-text-field--textarea) .mat-mdc-form-field-input-control.mdc-text-field__input,.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control{height:auto}.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control.mdc-text-field__input[type=color]{height:23px}.mat-mdc-text-field-wrapper{height:auto;flex:auto}.mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-left:0;--mat-mdc-form-field-label-offset-x: -16px}.mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-right:0}[dir=rtl] .mat-mdc-text-field-wrapper{padding-left:16px;padding-right:16px}[dir=rtl] .mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-left:0}[dir=rtl] .mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-right:0}.mat-form-field-disabled .mdc-text-field__input::placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input::-moz-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input::-webkit-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input:-ms-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-mdc-form-field-label-always-float .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms;opacity:1}.mat-mdc-text-field-wrapper .mat-mdc-form-field-infix .mat-mdc-floating-label{left:auto;right:auto}.mat-mdc-text-field-wrapper.mdc-text-field--outlined .mdc-text-field__input{display:inline-block}.mat-mdc-form-field .mat-mdc-text-field-wrapper.mdc-text-field .mdc-notched-outline__notch{padding-top:0}.mat-mdc-text-field-wrapper::before{content:none}.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field .mdc-notched-outline__notch{border-left:1px solid rgba(0,0,0,0)}[dir=rtl] .mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field .mdc-notched-outline__notch{border-left:none;border-right:1px solid rgba(0,0,0,0)}.mat-mdc-form-field-infix{min-height:var(--mat-form-field-container-height);padding-top:var(--mat-form-field-filled-with-label-container-padding-top);padding-bottom:var(--mat-form-field-filled-with-label-container-padding-bottom)}.mdc-text-field--outlined .mat-mdc-form-field-infix,.mdc-text-field--no-label .mat-mdc-form-field-infix{padding-top:var(--mat-form-field-container-vertical-padding);padding-bottom:var(--mat-form-field-container-vertical-padding)}.mat-mdc-text-field-wrapper .mat-mdc-form-field-flex .mat-mdc-floating-label{top:calc(var(--mat-form-field-container-height)/2)}.mdc-text-field--filled .mat-mdc-floating-label{display:var(--mat-form-field-filled-label-display, block)}.mat-mdc-text-field-wrapper.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{--mat-mdc-form-field-label-transform: translateY(calc(calc(6.75px + var(--mat-form-field-container-height) / 2) * -1)) scale(var(--mat-mdc-form-field-floating-label-scale, 0.75));transform:var(--mat-mdc-form-field-label-transform)}.mat-mdc-form-field-subscript-wrapper{box-sizing:border-box;width:100%;position:relative}.mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-error-wrapper{position:absolute;top:0;left:0;right:0;padding:0 16px}.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-error-wrapper{position:static}.mat-mdc-form-field-bottom-align::before{content:"";display:inline-block;height:16px}.mat-mdc-form-field-bottom-align.mat-mdc-form-field-subscript-dynamic-size::before{content:unset}.mat-mdc-form-field-hint-end{order:1}.mat-mdc-form-field-hint-wrapper{display:flex}.mat-mdc-form-field-hint-spacer{flex:1 0 1em}.mat-mdc-form-field-error{display:block;color:var(--mat-form-field-error-text-color)}.mat-mdc-form-field-subscript-wrapper,.mat-mdc-form-field-bottom-align::before{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-form-field-subscript-text-font);line-height:var(--mat-form-field-subscript-text-line-height);font-size:var(--mat-form-field-subscript-text-size);letter-spacing:var(--mat-form-field-subscript-text-tracking);font-weight:var(--mat-form-field-subscript-text-weight)}.mat-mdc-form-field-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;opacity:0;pointer-events:none;background-color:var(--mat-form-field-state-layer-color)}.mat-mdc-text-field-wrapper:hover .mat-mdc-form-field-focus-overlay{opacity:var(--mat-form-field-hover-state-layer-opacity)}.mat-mdc-form-field.mat-focused .mat-mdc-form-field-focus-overlay{opacity:var(--mat-form-field-focus-state-layer-opacity)}select.mat-mdc-form-field-input-control{-moz-appearance:none;-webkit-appearance:none;background-color:rgba(0,0,0,0);display:inline-flex;box-sizing:border-box}select.mat-mdc-form-field-input-control:not(:disabled){cursor:pointer}select.mat-mdc-form-field-input-control:not(.mat-mdc-native-select-inline) option{color:var(--mat-form-field-select-option-text-color)}select.mat-mdc-form-field-input-control:not(.mat-mdc-native-select-inline) option:disabled{color:var(--mat-form-field-select-disabled-option-text-color)}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{content:"";width:0;height:0;border-left:5px solid rgba(0,0,0,0);border-right:5px solid rgba(0,0,0,0);border-top:5px solid;position:absolute;right:0;top:50%;margin-top:-2.5px;pointer-events:none;color:var(--mat-form-field-enabled-select-arrow-color)}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{right:auto;left:0}.mat-mdc-form-field-type-mat-native-select.mat-focused .mat-mdc-form-field-infix::after{color:var(--mat-form-field-focus-select-arrow-color)}.mat-mdc-form-field-type-mat-native-select.mat-form-field-disabled .mat-mdc-form-field-infix::after{color:var(--mat-form-field-disabled-select-arrow-color)}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:15px}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:0;padding-left:15px}.cdk-high-contrast-active .mat-form-field-appearance-fill .mat-mdc-text-field-wrapper{outline:solid 1px}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-form-field-disabled .mat-mdc-text-field-wrapper{outline-color:GrayText}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-focused .mat-mdc-text-field-wrapper{outline:dashed 3px}.cdk-high-contrast-active .mat-mdc-form-field.mat-focused .mdc-notched-outline{border:dashed 3px}.mat-mdc-form-field-input-control[type=date],.mat-mdc-form-field-input-control[type=datetime],.mat-mdc-form-field-input-control[type=datetime-local],.mat-mdc-form-field-input-control[type=month],.mat-mdc-form-field-input-control[type=week],.mat-mdc-form-field-input-control[type=time]{line-height:1}.mat-mdc-form-field-input-control::-webkit-datetime-edit{line-height:1;padding:0;margin-bottom:-2px}.mat-mdc-form-field{--mat-mdc-form-field-floating-label-scale: 0.75;display:inline-flex;flex-direction:column;min-width:0;text-align:left;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-form-field-container-text-font);line-height:var(--mat-form-field-container-text-line-height);font-size:var(--mat-form-field-container-text-size);letter-spacing:var(--mat-form-field-container-text-tracking);font-weight:var(--mat-form-field-container-text-weight)}[dir=rtl] .mat-mdc-form-field{text-align:right}.mat-mdc-form-field .mdc-text-field--outlined .mdc-floating-label--float-above{font-size:calc(var(--mat-form-field-outlined-label-text-populated-size)*var(--mat-mdc-form-field-floating-label-scale))}.mat-mdc-form-field .mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:var(--mat-form-field-outlined-label-text-populated-size)}.mat-mdc-form-field-flex{display:inline-flex;align-items:baseline;box-sizing:border-box;width:100%}.mat-mdc-text-field-wrapper{width:100%}.mat-mdc-form-field-icon-prefix,.mat-mdc-form-field-icon-suffix{align-self:center;line-height:0;pointer-events:auto;position:relative;z-index:1}.mat-mdc-form-field-icon-prefix>.mat-icon,.mat-mdc-form-field-icon-suffix>.mat-icon{padding:0 12px;box-sizing:content-box}.mat-mdc-form-field-icon-prefix{color:var(--mat-form-field-leading-icon-color)}.mat-form-field-disabled .mat-mdc-form-field-icon-prefix{color:var(--mat-form-field-disabled-leading-icon-color)}.mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-trailing-icon-color)}.mat-form-field-disabled .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-disabled-trailing-icon-color)}.mat-form-field-invalid .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-trailing-icon-color)}.mat-form-field-invalid:not(.mat-focused):not(.mat-form-field-disabled) .mat-mdc-text-field-wrapper:hover .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-hover-trailing-icon-color)}.mat-form-field-invalid.mat-focused .mat-mdc-text-field-wrapper .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-focus-trailing-icon-color)}.mat-mdc-form-field-icon-prefix,[dir=rtl] .mat-mdc-form-field-icon-suffix{padding:0 4px 0 0}.mat-mdc-form-field-icon-suffix,[dir=rtl] .mat-mdc-form-field-icon-prefix{padding:0 0 0 4px}.mat-mdc-form-field-subscript-wrapper .mat-icon,.mat-mdc-form-field label .mat-icon{width:1em;height:1em;font-size:inherit}.mat-mdc-form-field-infix{flex:auto;min-width:0;width:180px;position:relative;box-sizing:border-box}.mat-mdc-form-field .mdc-notched-outline__notch{margin-left:-1px;-webkit-clip-path:inset(-9em -999em -9em 1px);clip-path:inset(-9em -999em -9em 1px)}[dir=rtl] .mat-mdc-form-field .mdc-notched-outline__notch{margin-left:0;margin-right:-1px;-webkit-clip-path:inset(-9em 1px -9em -999em);clip-path:inset(-9em 1px -9em -999em)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input{transition:opacity 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}@media all{.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder{transition:opacity 67ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}}@media all{.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder{transition:opacity 67ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}}@media all{.mdc-text-field--no-label .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder,.mdc-text-field--focused .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms}}@media all{.mdc-text-field--no-label .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder,.mdc-text-field--focused .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder{transition-delay:40ms;transition-duration:110ms}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__affix{transition:opacity 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--filled.mdc-ripple-upgraded--background-focused .mdc-text-field__ripple::before,.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--filled:not(.mdc-ripple-upgraded):focus .mdc-text-field__ripple::before{transition-duration:75ms}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea{transition:none}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea.mdc-text-field--filled .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-textarea-filled 250ms 1}@keyframes mdc-floating-label-shake-float-above-textarea-filled{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-textarea-outlined 250ms 1}@keyframes mdc-floating-label-shake-float-above-textarea-outlined{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined-leading-icon 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined-leading-icon{0%{transform:translateX(calc(0% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}}[dir=rtl] .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--shake,.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined[dir=rtl] .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined-leading-icon 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined-leading-icon-rtl{0%{transform:translateX(calc(0% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-floating-label{transition:transform 150ms cubic-bezier(0.4, 0, 0.2, 1),color 150ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-standard 250ms 1}@keyframes mdc-floating-label-shake-float-above-standard{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-line-ripple::after{transition:transform 180ms cubic-bezier(0.4, 0, 0.2, 1),opacity 180ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-notched-outline .mdc-floating-label{max-width:calc(100% + 1px)}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:calc(133.3333333333% + 1px)}'],encapsulation:2,data:{animation:[pQ.transitionMessages]},changeDetection:0});let a=r;return a})();var gN=is({passive:!0}),Vy=(()=>{let r=class r{constructor(n,s){this._platform=n,this._ngZone=s,this._monitoredElements=new Map}monitor(n){if(!this._platform.isBrowser)return bc;let s=zs(n),d=this._monitoredElements.get(s);if(d)return d.subject;let m=new pe,_="cdk-text-field-autofilled",w=S=>{S.animationName==="cdk-text-field-autofill-start"&&!s.classList.contains(_)?(s.classList.add(_),this._ngZone.run(()=>m.next({target:S.target,isAutofilled:!0}))):S.animationName==="cdk-text-field-autofill-end"&&s.classList.contains(_)&&(s.classList.remove(_),this._ngZone.run(()=>m.next({target:S.target,isAutofilled:!1})))};return this._ngZone.runOutsideAngular(()=>{s.addEventListener("animationstart",w,gN),s.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(s,{subject:m,unlisten:()=>{s.removeEventListener("animationstart",w,gN)}}),m}stopMonitoring(n){let s=zs(n),d=this._monitoredElements.get(s);d&&(d.unlisten(),d.subject.complete(),s.classList.remove("cdk-text-field-autofill-monitored"),s.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(s))}ngOnDestroy(){this._monitoredElements.forEach((n,s)=>this.stopMonitoring(s))}};r.\u0275fac=function(s){return new(s||r)(ht(gn),ht(Be))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var EM=new Se("MAT_INPUT_VALUE_ACCESSOR"),yQ=["button","checkbox","file","hidden","image","radio","range","reset","submit"],bQ=0,vN=(()=>{let r=class r{get disabled(){return this._disabled}set disabled(n){this._disabled=ao(n),this.focused&&(this.focused=!1,this.stateChanges.next())}get id(){return this._id}set id(n){this._id=n||this._uid}get required(){return this._required??this.ngControl?.control?.hasValidator(Le.required)??!1}set required(n){this._required=ao(n)}get type(){return this._type}set type(n){this._type=n||"text",this._validateType(),!this._isTextarea&&ZE().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}get errorStateMatcher(){return this._errorStateTracker.matcher}set errorStateMatcher(n){this._errorStateTracker.matcher=n}get value(){return this._inputValueAccessor.value}set value(n){n!==this.value&&(this._inputValueAccessor.value=n,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(n){this._readonly=ao(n)}get errorState(){return this._errorStateTracker.errorState}set errorState(n){this._errorStateTracker.errorState=n}constructor(n,s,d,m,_,w,S,I,L,H){this._elementRef=n,this._platform=s,this.ngControl=d,this._autofillMonitor=I,this._formField=H,this._uid=`mat-input-${bQ++}`,this.focused=!1,this.stateChanges=new pe,this.controlType="mat-input",this.autofilled=!1,this._disabled=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(it=>ZE().has(it)),this._iOSKeyupListener=it=>{let at=it.target;!at.value&&at.selectionStart===0&&at.selectionEnd===0&&(at.setSelectionRange(1,1),at.setSelectionRange(0,0))};let q=this._elementRef.nativeElement,X=q.nodeName.toLowerCase();this._inputValueAccessor=S||q,this._previousNativeValue=this.value,this.id=this.id,s.IOS&&L.runOutsideAngular(()=>{n.nativeElement.addEventListener("keyup",this._iOSKeyupListener)}),this._errorStateTracker=new Ou(w,d,_,m,this.stateChanges),this._isServer=!this._platform.isBrowser,this._isNativeSelect=X==="select",this._isTextarea=X==="textarea",this._isInFormField=!!H,this._isNativeSelect&&(this.controlType=q.multiple?"mat-native-select-multiple":"mat-native-select")}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(n=>{this.autofilled=n.isAutofilled,this.stateChanges.next()})}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement),this._platform.IOS&&this._elementRef.nativeElement.removeEventListener("keyup",this._iOSKeyupListener)}ngDoCheck(){this.ngControl&&(this.updateErrorState(),this.ngControl.disabled!==null&&this.ngControl.disabled!==this.disabled&&(this.disabled=this.ngControl.disabled,this.stateChanges.next())),this._dirtyCheckNativeValue(),this._dirtyCheckPlaceholder()}focus(n){this._elementRef.nativeElement.focus(n)}updateErrorState(){this._errorStateTracker.updateErrorState()}_focusChanged(n){n!==this.focused&&(this.focused=n,this.stateChanges.next())}_onInput(){}_dirtyCheckNativeValue(){let n=this._elementRef.nativeElement.value;this._previousNativeValue!==n&&(this._previousNativeValue=n,this.stateChanges.next())}_dirtyCheckPlaceholder(){let n=this._getPlaceholder();if(n!==this._previousPlaceholder){let s=this._elementRef.nativeElement;this._previousPlaceholder=n,n?s.setAttribute("placeholder",n):s.removeAttribute("placeholder")}}_getPlaceholder(){return this.placeholder||null}_validateType(){yQ.indexOf(this._type)>-1}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){let n=this._elementRef.nativeElement.validity;return n&&n.badInput}get empty(){return!this._isNeverEmpty()&&!this._elementRef.nativeElement.value&&!this._isBadInput()&&!this.autofilled}get shouldLabelFloat(){if(this._isNativeSelect){let n=this._elementRef.nativeElement,s=n.options[0];return this.focused||n.multiple||!this.empty||!!(n.selectedIndex>-1&&s&&s.label)}else return this.focused||!this.empty}setDescribedByIds(n){n.length?this._elementRef.nativeElement.setAttribute("aria-describedby",n.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}_isInlineSelect(){let n=this._elementRef.nativeElement;return this._isNativeSelect&&(n.multiple||n.size>1)}};r.\u0275fac=function(s){return new(s||r)(V(Ee),V(gn),V(fs,10),V(Jf,8),V(Hn,8),V(fg),V(EM,10),V(Vy),V(Be),V(Fu,8))},r.\u0275dir=oe({type:r,selectors:[["input","matInput",""],["textarea","matInput",""],["select","matNativeControl",""],["input","matNativeControl",""],["textarea","matNativeControl",""]],hostAttrs:[1,"mat-mdc-input-element"],hostVars:18,hostBindings:function(s,d){s&1&&ct("focus",function(){return d._focusChanged(!0)})("blur",function(){return d._focusChanged(!1)})("input",function(){return d._onInput()}),s&2&&(Os("id",d.id)("disabled",d.disabled)("required",d.required),ri("name",d.name||null)("readonly",d.readonly&&!d._isNativeSelect||null)("aria-invalid",d.empty&&d.required?null:d.errorState)("aria-required",d.required)("id",d.id),li("mat-input-server",d._isServer)("mat-mdc-form-field-textarea-control",d._isInFormField&&d._isTextarea)("mat-mdc-form-field-input-control",d._isInFormField)("mdc-text-field__input",d._isInFormField)("mat-mdc-native-select-inline",d._isInlineSelect()))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:[Rt.None,"aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly"},exportAs:["matInput"],standalone:!0,features:[ji([{provide:Tm,useExisting:r}]),Yn]});let a=r;return a})();var xQ=["*"],jy;function wQ(){if(jy===void 0&&(jy=null,typeof window<"u")){let a=window;a.trustedTypes!==void 0&&(jy=a.trustedTypes.createPolicy("angular#components",{createHTML:r=>r}))}return jy}function yg(a){return wQ()?.createHTML(a)||a}function yN(a){return Error(`Unable to find icon with the name "${a}"`)}function CQ(){return Error("Could not find HttpClient provider for use with Angular Material icons. Please include the HttpClientModule from @angular/common/http in your app imports.")}function bN(a){return Error(`The URL provided to MatIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${a}".`)}function xN(a){return Error(`The literal provided to MatIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${a}".`)}var kc=class{constructor(r,l,n){this.url=r,this.svgText=l,this.options=n}},SQ=(()=>{let r=class r{constructor(n,s,d,m){this._httpClient=n,this._sanitizer=s,this._errorHandler=m,this._svgIconConfigs=new Map,this._iconSetConfigs=new Map,this._cachedIconsByUrl=new Map,this._inProgressUrlFetches=new Map,this._fontCssClassesByAlias=new Map,this._resolvers=[],this._defaultFontSetClass=["material-icons","mat-ligature-font"],this._document=d}addSvgIcon(n,s,d){return this.addSvgIconInNamespace("",n,s,d)}addSvgIconLiteral(n,s,d){return this.addSvgIconLiteralInNamespace("",n,s,d)}addSvgIconInNamespace(n,s,d,m){return this._addSvgIconConfig(n,s,new kc(d,null,m))}addSvgIconResolver(n){return this._resolvers.push(n),this}addSvgIconLiteralInNamespace(n,s,d,m){let _=this._sanitizer.sanitize(Qs.HTML,d);if(!_)throw xN(d);let w=yg(_);return this._addSvgIconConfig(n,s,new kc("",w,m))}addSvgIconSet(n,s){return this.addSvgIconSetInNamespace("",n,s)}addSvgIconSetLiteral(n,s){return this.addSvgIconSetLiteralInNamespace("",n,s)}addSvgIconSetInNamespace(n,s,d){return this._addSvgIconSetConfig(n,new kc(s,null,d))}addSvgIconSetLiteralInNamespace(n,s,d){let m=this._sanitizer.sanitize(Qs.HTML,s);if(!m)throw xN(s);let _=yg(m);return this._addSvgIconSetConfig(n,new kc("",_,d))}registerFontClassAlias(n,s=n){return this._fontCssClassesByAlias.set(n,s),this}classNameForFontAlias(n){return this._fontCssClassesByAlias.get(n)||n}setDefaultFontSetClass(...n){return this._defaultFontSetClass=n,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(n){let s=this._sanitizer.sanitize(Qs.RESOURCE_URL,n);if(!s)throw bN(n);let d=this._cachedIconsByUrl.get(s);return d?Fe(Uy(d)):this._loadSvgIconFromConfig(new kc(n,null)).pipe($r(m=>this._cachedIconsByUrl.set(s,m)),Li(m=>Uy(m)))}getNamedSvgIcon(n,s=""){let d=wN(s,n),m=this._svgIconConfigs.get(d);if(m)return this._getSvgFromConfig(m);if(m=this._getIconConfigFromResolvers(s,n),m)return this._svgIconConfigs.set(d,m),this._getSvgFromConfig(m);let _=this._iconSetConfigs.get(s);return _?this._getSvgFromIconSetConfigs(n,_):Ll(yN(d))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(n){return n.svgText?Fe(Uy(this._svgElementFromConfig(n))):this._loadSvgIconFromConfig(n).pipe(Li(s=>Uy(s)))}_getSvgFromIconSetConfigs(n,s){let d=this._extractIconWithNameFromAnySet(n,s);if(d)return Fe(d);let m=s.filter(_=>!_.svgText).map(_=>this._loadSvgIconSetFromConfig(_).pipe(zl(w=>{let I=`Loading icon set URL: ${this._sanitizer.sanitize(Qs.RESOURCE_URL,_.url)} failed: ${w.message}`;return this._errorHandler.handleError(new Error(I)),Fe(null)})));return fv(m).pipe(Li(()=>{let _=this._extractIconWithNameFromAnySet(n,s);if(!_)throw yN(n);return _}))}_extractIconWithNameFromAnySet(n,s){for(let d=s.length-1;d>=0;d--){let m=s[d];if(m.svgText&&m.svgText.toString().indexOf(n)>-1){let _=this._svgElementFromConfig(m),w=this._extractSvgIconFromSet(_,n,m.options);if(w)return w}}return null}_loadSvgIconFromConfig(n){return this._fetchIcon(n).pipe($r(s=>n.svgText=s),Li(()=>this._svgElementFromConfig(n)))}_loadSvgIconSetFromConfig(n){return n.svgText?Fe(null):this._fetchIcon(n).pipe($r(s=>n.svgText=s))}_extractSvgIconFromSet(n,s,d){let m=n.querySelector(`[id="${s}"]`);if(!m)return null;let _=m.cloneNode(!0);if(_.removeAttribute("id"),_.nodeName.toLowerCase()==="svg")return this._setSvgAttributes(_,d);if(_.nodeName.toLowerCase()==="symbol")return this._setSvgAttributes(this._toSvgElement(_),d);let w=this._svgElementFromString(yg("<svg></svg>"));return w.appendChild(_),this._setSvgAttributes(w,d)}_svgElementFromString(n){let s=this._document.createElement("DIV");s.innerHTML=n;let d=s.querySelector("svg");if(!d)throw Error("<svg> tag not found");return d}_toSvgElement(n){let s=this._svgElementFromString(yg("<svg></svg>")),d=n.attributes;for(let m=0;m<d.length;m++){let{name:_,value:w}=d[m];_!=="id"&&s.setAttribute(_,w)}for(let m=0;m<n.childNodes.length;m++)n.childNodes[m].nodeType===this._document.ELEMENT_NODE&&s.appendChild(n.childNodes[m].cloneNode(!0));return s}_setSvgAttributes(n,s){return n.setAttribute("fit",""),n.setAttribute("height","100%"),n.setAttribute("width","100%"),n.setAttribute("preserveAspectRatio","xMidYMid meet"),n.setAttribute("focusable","false"),s&&s.viewBox&&n.setAttribute("viewBox",s.viewBox),n}_fetchIcon(n){let{url:s,options:d}=n,m=d?.withCredentials??!1;if(!this._httpClient)throw CQ();if(s==null)throw Error(`Cannot fetch icon from URL "${s}".`);let _=this._sanitizer.sanitize(Qs.RESOURCE_URL,s);if(!_)throw bN(s);let w=this._inProgressUrlFetches.get(_);if(w)return w;let S=this._httpClient.get(_,{responseType:"text",withCredentials:m}).pipe(Li(I=>yg(I)),rl(()=>this._inProgressUrlFetches.delete(_)),LF());return this._inProgressUrlFetches.set(_,S),S}_addSvgIconConfig(n,s,d){return this._svgIconConfigs.set(wN(n,s),d),this}_addSvgIconSetConfig(n,s){let d=this._iconSetConfigs.get(n);return d?d.push(s):this._iconSetConfigs.set(n,[s]),this}_svgElementFromConfig(n){if(!n.svgElement){let s=this._svgElementFromString(n.svgText);this._setSvgAttributes(s,n.options),n.svgElement=s}return n.svgElement}_getIconConfigFromResolvers(n,s){for(let d=0;d<this._resolvers.length;d++){let m=this._resolvers[d](s,n);if(m)return EQ(m)?new kc(m.url,null,m.options):new kc(m,null)}}};r.\u0275fac=function(s){return new(s||r)(ht(Hi,8),ht(ZS),ht(ci,8),ht(bu))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function Uy(a){return a.cloneNode(!0)}function wN(a,r){return a+":"+r}function EQ(a){return!!(a.url&&a.options)}var MQ=new Se("MAT_ICON_DEFAULT_OPTIONS"),DQ=new Se("mat-icon-location",{providedIn:"root",factory:TQ});function TQ(){let a=le(ci),r=a?a.location:null;return{getPathname:()=>r?r.pathname+r.search:""}}var CN=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],IQ=CN.map(a=>`[${a}]`).join(", "),AQ=/^url\(['"]?#(.*?)['"]?\)$/,Hy=(()=>{let r=class r{get color(){return this._color||this._defaultColor}set color(n){this._color=n}get svgIcon(){return this._svgIcon}set svgIcon(n){n!==this._svgIcon&&(n?this._updateSvgIcon(n):this._svgIcon&&this._clearSvgElement(),this._svgIcon=n)}get fontSet(){return this._fontSet}set fontSet(n){let s=this._cleanupFontValue(n);s!==this._fontSet&&(this._fontSet=s,this._updateFontIconClasses())}get fontIcon(){return this._fontIcon}set fontIcon(n){let s=this._cleanupFontValue(n);s!==this._fontIcon&&(this._fontIcon=s,this._updateFontIconClasses())}constructor(n,s,d,m,_,w){this._elementRef=n,this._iconRegistry=s,this._location=m,this._errorHandler=_,this.inline=!1,this._previousFontSetClass=[],this._currentIconFetch=sr.EMPTY,w&&(w.color&&(this.color=this._defaultColor=w.color),w.fontSet&&(this.fontSet=w.fontSet)),d||n.nativeElement.setAttribute("aria-hidden","true")}_splitIconName(n){if(!n)return["",""];let s=n.split(":");switch(s.length){case 1:return["",s[0]];case 2:return s;default:throw Error(`Invalid icon name: "${n}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){let n=this._elementsWithExternalReferences;if(n&&n.size){let s=this._location.getPathname();s!==this._previousPath&&(this._previousPath=s,this._prependPathToReferences(s))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(n){this._clearSvgElement();let s=this._location.getPathname();this._previousPath=s,this._cacheChildrenWithExternalReferences(n),this._prependPathToReferences(s),this._elementRef.nativeElement.appendChild(n)}_clearSvgElement(){let n=this._elementRef.nativeElement,s=n.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();s--;){let d=n.childNodes[s];(d.nodeType!==1||d.nodeName.toLowerCase()==="svg")&&d.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;let n=this._elementRef.nativeElement,s=(this.fontSet?this._iconRegistry.classNameForFontAlias(this.fontSet).split(/ +/):this._iconRegistry.getDefaultFontSetClass()).filter(d=>d.length>0);this._previousFontSetClass.forEach(d=>n.classList.remove(d)),s.forEach(d=>n.classList.add(d)),this._previousFontSetClass=s,this.fontIcon!==this._previousFontIconClass&&!s.includes("mat-ligature-font")&&(this._previousFontIconClass&&n.classList.remove(this._previousFontIconClass),this.fontIcon&&n.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(n){return typeof n=="string"?n.trim().split(" ")[0]:n}_prependPathToReferences(n){let s=this._elementsWithExternalReferences;s&&s.forEach((d,m)=>{d.forEach(_=>{m.setAttribute(_.name,`url('${n}#${_.value}')`)})})}_cacheChildrenWithExternalReferences(n){let s=n.querySelectorAll(IQ),d=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let m=0;m<s.length;m++)CN.forEach(_=>{let w=s[m],S=w.getAttribute(_),I=S?S.match(AQ):null;if(I){let L=d.get(w);L||(L=[],d.set(w,L)),L.push({name:_,value:I[1]})}})}_updateSvgIcon(n){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),n){let[s,d]=this._splitIconName(n);s&&(this._svgNamespace=s),d&&(this._svgName=d),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(d,s).pipe(tn(1)).subscribe(m=>this._setSvgElement(m),m=>{let _=`Error retrieving icon ${s}:${d}! ${m.message}`;this._errorHandler.handleError(new Error(_))})}}};r.\u0275fac=function(s){return new(s||r)(V(Ee),V(SQ),ol("aria-hidden"),V(DQ),V(bu),V(MQ,8))},r.\u0275cmp=St({type:r,selectors:[["mat-icon"]],hostAttrs:["role","img",1,"mat-icon","notranslate"],hostVars:10,hostBindings:function(s,d){s&2&&(ri("data-mat-icon-type",d._usingFontIcon()?"font":"svg")("data-mat-icon-name",d._svgName||d.fontIcon)("data-mat-icon-namespace",d._svgNamespace||d.fontSet)("fontIcon",d._usingFontIcon()?d.fontIcon:null),al(d.color?"mat-"+d.color:""),li("mat-icon-inline",d.inline)("mat-icon-no-color",d.color!=="primary"&&d.color!=="accent"&&d.color!=="warn"))},inputs:{color:"color",inline:[Rt.HasDecoratorInputTransform,"inline","inline",Qe],svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["matIcon"],standalone:!0,features:[Fn,At],ngContentSelectors:xQ,decls:1,vars:0,template:function(s,d){s&1&&(Un(),Ai(0))},styles:["mat-icon,mat-icon.mat-primary,mat-icon.mat-accent,mat-icon.mat-warn{color:var(--mat-icon-color)}.mat-icon{-webkit-user-select:none;user-select:none;background-repeat:no-repeat;display:inline-block;fill:currentColor;height:24px;width:24px;overflow:hidden}.mat-icon.mat-icon-inline{font-size:inherit;height:inherit;line-height:inherit;width:inherit}.mat-icon.mat-ligature-font[fontIcon]::before{content:attr(fontIcon)}[dir=rtl] .mat-icon-rtl-mirror{transform:scale(-1, 1)}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon{display:block}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button .mat-icon{margin:auto}"],encapsulation:2,changeDetection:0});let a=r;return a})();var Gy=(()=>{let r=class r{constructor(n,s){this.http=n,this.snackBar=s,this.eventSubject=new We({}),this.eventListSubject=new We({})}setEvent(n){this.eventSubject.next(n)}getEvent(){return this.eventSubject.asObservable()}fetchEventById(n){return Tt(this,null,function*(){try{let s=yield Ne(this.http.get(be+"/events/"+n));this.setEvent(s)}catch{this.snackBar.open("Failed to fetch event","Close",{duration:3e3})}})}setEventList(n){this.eventListSubject.next(n)}getEventList(){return this.eventListSubject.asObservable()}fetchEventList(n,s,d,m,_,w,S){return Tt(this,null,function*(){try{let I=new Vl;n!==void 0&&(I=I.append("location",n)),s!==void 0&&(I=I.append("artist",s)),d!==void 0&&(I=I.append("genre",d)),m!==void 0&&(I=I.append("startDate",m)),_!==void 0&&(I=I.append("endDate",_)),I=I.append("page",w.toString()),I=I.append("size",S.toString());let L=yield Ne(this.http.get(be+"/events/list",{params:I}));if(w===0)this.setEventList(L);else{let H=this.eventListSubject.getValue(),q=Pi(qt({},H),{content:[...H.content,...L.content]});this.setEventList(q)}return L.content.length}catch(I){console.error(I),this.snackBar.open("Error fetching events","Close",{duration:3e3})}})}};r.\u0275fac=function(s){return new(s||r)(ht(Hi),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var qy=(()=>{let r=class r{constructor(n,s,d,m){this.http=n,this.identityService=s,this.headerService=d,this.snackBar=m,this.shoppingCartSubject=new We({})}setShoppingCart(n){this.shoppingCartSubject.next(n)}getShoppingCart(){return this.shoppingCartSubject.asObservable()}fetchShoppingCart(){return Tt(this,null,function*(){try{let n=yield Ne(this.http.get(be+"/shopping-cart",{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setShoppingCart(n)}catch{this.snackBar.open("Error fetching shopping cart","Dismiss",{duration:3e3})}})}updateQuantity(n){return Tt(this,null,function*(){try{let s=yield Ne(this.http.patch(be+"/shopping-cart/"+n.id+"?quantity="+n.quantity,null,{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setShoppingCart(s),this.snackBar.open("Cantitate actualizata cu succes!","Dismiss",{duration:3e3})}catch{this.snackBar.open("Error updating quantity","Dismiss",{duration:3e3})}})}removeTicketFromShoppingCart(n){return Tt(this,null,function*(){try{let s=yield Ne(this.http.put(be+"/shopping-cart/"+n.id,null,{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setShoppingCart(s),this.headerService.setShoppingCartSize(s?.shoppingCartItemList.length),this.snackBar.open("Biletul a fost sters din cosul de cumparaturi!","Dismiss",{duration:3e3})}catch{this.snackBar.open("Error removing ticket from shopping cart","Dismiss",{duration:3e3})}})}buyTickets(){return Tt(this,null,function*(){try{yield Ne(this.http.post(be+"/orders",null,{headers:{Authorization:"Bearer "+this.identityService.getToken()}})),this.setShoppingCart({shoppingCartItemList:[]}),this.headerService.setShoppingCartSize(0),this.snackBar.open("Comanda a fost realizata cu succes!","Dismiss",{duration:3e3})}catch{this.snackBar.open("Error buying tickets","Dismiss",{duration:3e3})}})}};r.\u0275fac=function(s){return new(s||r)(ht(Hi),ht(oi),ht(ql),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var MN=(()=>{let r=class r{constructor(n,s,d,m,_){this.http=n,this.identityService=s,this.snackBar=d,this.shoppingCartService=m,this.headerService=_}buyTickets(n){if(!this.identityService.isLoggedIn()){this.snackBar.open("You must be logged in to buy tickets","Dismiss",{duration:3e3});return}if(n.length===0){this.snackBar.open("You must select at least one ticket","Dismiss",{duration:3e3});return}this.http.post(be+"/shopping-cart",n,{headers:{Authorization:"Bearer "+this.identityService.getToken()}}).subscribe({next:s=>{this.shoppingCartService.setShoppingCart(s),this.headerService.setShoppingCartSize(s.shoppingCartItemList?.length),this.snackBar.open("Tickets added to shopping cart!","Dismiss",{duration:3e3})},error:s=>{this.snackBar.open(s.error,"Dismiss",{duration:3e3})}})}};r.\u0275fac=function(s){return new(s||r)(ht(Hi),ht(oi),ht(Je),ht(qy),ht(ql))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function RQ(a,r){if(a&1&&(T(0,"p",10),B(1),k()),a&2){let l=gt();z(),Te(l.event.description)}}function PQ(a,r){if(a&1){let l=we();T(0,"div",14),dt(1,"hr"),T(2,"h3",15),B(3),k(),T(4,"p",16)(5,"strong"),B(6,"Pret:"),k(),B(7),k(),T(8,"div",17)(9,"button",18),ct("click",function(){let d=Kt(l).$implicit,m=gt(2);return Qt(m.decrementQuantity(d))}),dt(10,"span",19),k(),T(11,"input",20),Cn("ngModelChange",function(s){let m=Kt(l).$implicit;return wn(m.reservedQuantity,s)||(m.reservedQuantity=s),Qt(s)}),k(),T(12,"button",21),ct("click",function(){let d=Kt(l).$implicit,m=gt(2);return Qt(m.incrementQuantity(d))}),dt(13,"span",22),k()(),T(14,"p",23)(15,"strong"),B(16),k()()()}if(a&2){let l=r.$implicit;z(3),Te(l.name),z(4),ie(" ",l.price," RON"),z(4),xn("ngModel",l.reservedQuantity),z(5),ie("Cantitate ramasa: ",l.remainingQuantity,"")}}function OQ(a,r){if(a&1){let l=we();T(0,"div")(1,"h2",11),B(2,"Bilete"),k(),ut(3,PQ,17,4,"div",12),T(4,"button",13),ct("click",function(){Kt(l);let s=gt();return Qt(s.buyTickets())}),B(5,"Cumpara"),k()()}if(a&2){let l=gt();z(3),W("ngForOf",l.event.ticketTypeList)}}function FQ(a,r){a&1&&(T(0,"div")(1,"h2",24),B(2,"Nu sunt bilete disponibile pentru acest eveniment"),k()())}var DN=(()=>{let r=class r{constructor(n,s,d,m){this.route=n,this.router=s,this.eventService=d,this.ticketService=m,this.event={},this.descriptionIsVisible=!1}ngOnInit(){this.route.queryParams.subscribe(n=>Tt(this,null,function*(){n.id||(yield this.router.navigate(["/page-not-found"])),yield this.eventService.fetchEventById(n.id),this.eventSubscription=this.eventService.getEvent().subscribe({next:s=>{this.event=s,this.event.ticketTypeList&&this.event.ticketTypeList.forEach(d=>{d.reservedQuantity=0})}})}))}ngOnDestroy(){this.eventSubscription?.unsubscribe()}toggleDescription(){this.descriptionIsVisible=!this.descriptionIsVisible}incrementQuantity(n){n.remainingQuantity>n.reservedQuantity&&n.reservedQuantity<10&&n.reservedQuantity++}decrementQuantity(n){n.reservedQuantity>0&&n.reservedQuantity--}buyTickets(){let n=[];this.event.ticketTypeList.forEach(s=>{s.reservedQuantity>0&&n.push({ticketTypeId:s.id,quantity:s.reservedQuantity}),s.reservedQuantity=0}),this.ticketService.buyTickets(n)}};r.\u0275fac=function(s){return new(s||r)(V(Tn),V(zi),V(Gy),V(MN))},r.\u0275cmp=St({type:r,selectors:[["app-event"]],standalone:!0,features:[At],decls:22,vars:9,consts:[[1,"container-fluid"],[1,"event-container","mb-4"],["alt","",1,"img-fluid","rounded","mr-4",2,"max-width","200px",3,"src"],[1,"event-details"],[1,"h3","mb-4","text-gray-800"],[1,"mb-4"],["class","mt-5",4,"ngIf"],[1,"view-details","text-decoration-underline",3,"click"],[1,"tickets-container"],[4,"ngIf"],[1,"mt-5"],[1,"mb-4","text-gray-800"],["class","row ticket-details",4,"ngFor","ngForOf"],[1,"btn","btn-primary","buy-button",3,"click"],[1,"row","ticket-details"],[1,"h3","text-gray-800","ticket-name","col-sm-6"],[1,"col-sm-3","price"],[1,"ticket-number-selector-container","col-sm-3"],[1,"btn","btn-primary","ticket-number-button","left",3,"click"],[1,"fa","fa-minus"],["type","number","readonly","",1,"ticket-number",3,"ngModel","ngModelChange"],[1,"btn","btn-primary","ticket-number-button","right",3,"click"],[1,"fa","fa-plus"],[1,"remaining-quantity","mt-1"],[1,"h4","mt-3","mb-4","text-gray-800"]],template:function(s,d){s&1&&(T(0,"div",0)(1,"div",1),dt(2,"img",2),T(3,"div",3)(4,"h1",4),B(5),k(),T(6,"p")(7,"strong"),B(8,"Data:"),k(),B(9),k(),T(10,"p")(11,"strong"),B(12,"Locatie:"),k(),B(13),k(),T(14,"p",5),B(15),k(),ut(16,RQ,2,1,"p",6),T(17,"a",7),ct("click",function(){return d.toggleDescription()}),B(18,"Apasa pentru a vedea detalii"),k()()(),T(19,"div",8),ut(20,OQ,6,1,"div",9)(21,FQ,3,0,"div",9),k()()),s&2&&(z(2),Js("src",d.event.imageUrl,Vr),z(3),Te(d.event.title),z(4),ie(" ",d.event.date,""),z(4),po(" ",d.event.location==null?null:d.event.location.name,", ",d.event.location==null?null:d.event.location.address,""),z(2),Te(d.event.shortDescription),z(),W("ngIf",d.descriptionIsVisible),z(4),W("ngIf",(d.event.ticketTypeList==null?null:d.event.ticketTypeList.length)>0),z(),W("ngIf",(d.event.ticketTypeList==null?null:d.event.ticketTypeList.length)==0))},dependencies:[Ve,pi,Ni,en,GE,qi,To],styles:[".container-fluid[_ngcontent-%COMP%]{margin:0 auto;display:flex;flex-direction:column;justify-content:center;width:60%}.event-container[_ngcontent-%COMP%]{display:flex;align-items:start}.event-details[_ngcontent-%COMP%]{margin-left:1rem;width:100%}.img-fluid[_ngcontent-%COMP%]{max-width:100%;height:auto}.h3[_ngcontent-%COMP%]{font-size:1.5rem;margin-bottom:.5rem}.mb-1[_ngcontent-%COMP%]{margin-bottom:.25rem}.mb-2[_ngcontent-%COMP%]{margin-bottom:.5rem}.mr-2[_ngcontent-%COMP%]{margin-right:.5rem}.rounded[_ngcontent-%COMP%]{border-radius:.25rem}.view-details[_ngcontent-%COMP%]{color:#000;cursor:pointer;-webkit-user-select:none;user-select:none}.tickets-container[_ngcontent-%COMP%]{margin:0 auto;padding:1rem;background-color:#f5f5f5;border:1px solid #ccc;width:100%}.ticket-name[_ngcontent-%COMP%], .price[_ngcontent-%COMP%]{margin:0;align-content:center}.remaining-quantity[_ngcontent-%COMP%]{margin:0;text-align:end}.ticket-number-selector-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center}.ticket-number[_ngcontent-%COMP%]{width:35px}.ticket-number[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.ticket-number-button[_ngcontent-%COMP%]{width:30px;height:31.5px;padding:.25rem .5rem;font-size:.7rem}.left[_ngcontent-%COMP%]{border-radius:1rem 0 0 1rem}.right[_ngcontent-%COMP%]{border-radius:0 1rem 1rem 0}@media (max-width: 768px){.event-details[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:20px}.container-fluid[_ngcontent-%COMP%]{width:90%}.ticket-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.ticket-number-selector-container[_ngcontent-%COMP%]{justify-content:center}.ticket-name[_ngcontent-%COMP%], .price[_ngcontent-%COMP%], .remaining-quantity[_ngcontent-%COMP%]{text-align:center}.buy-button[_ngcontent-%COMP%]{margin-top:15px;width:100%}}@media (max-width: 576px){.event-container[_ngcontent-%COMP%]{flex-direction:column;align-items:center;gap:10px}}"]});let a=r;return a})();var TN=(()=>{class a{static \u0275fac=function(n){return new(n||a)};static \u0275mod=Si({type:a});static \u0275inj=Ei({imports:[zo]})}return a})();var LQ=["notchLeading"],zQ=["notchMiddle"],NQ=["*"],IN=(()=>{class a{stateChanges;input;labelActive;static \u0275fac=function(n){return new(n||a)};static \u0275dir=oe({type:a})}return a})(),lo=(()=>{class a{constructor(){}static \u0275fac=function(n){return new(n||a)};static \u0275dir=oe({type:a,selectors:[["","mdbLabel",""]],exportAs:["mdbLabel"]})}return a})(),fo=(()=>{class a{_renderer;_contentObserver;_elementRef;_ngZone;_notchLeading;_notchMiddle;_formControl;_label;outline=!0;display=!0;get input(){return this._formControl.input}constructor(l,n,s,d){this._renderer=l,this._contentObserver=n,this._elementRef=s,this._ngZone=d}_destroy$=new pe;_notchLeadingLength=9;_labelMarginLeft=0;_labelGapPadding=8;_labelScale=.8;_recalculateGapWhenVisible=!1;ngAfterContentInit(){this._label?setTimeout(()=>{this._updateBorderGap()},0):this._renderer.addClass(this.input,"placeholder-active"),this._updateLabelActiveState(),this._label&&this._contentObserver.observe(this._label.nativeElement).pipe(ni(this._destroy$)).subscribe(()=>{this._updateBorderGap()}),this._formControl.stateChanges.pipe(ni(this._destroy$)).subscribe(()=>{this._updateLabelActiveState(),this._label&&this._updateBorderGap()}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(ni(this._destroy$)).subscribe(()=>{this._label&&this._recalculateGapWhenVisible&&this._updateBorderGap()})})}ngOnDestroy(){this._destroy$.next(),this._destroy$.unsubscribe()}_getLabelWidth(){return this._label.nativeElement.clientWidth*this._labelScale+this._labelGapPadding}_updateBorderGap(){if(this._isHidden()){this._recalculateGapWhenVisible=!0;return}let l=`${this._labelMarginLeft+this._notchLeadingLength}px`,n=`${this._getLabelWidth()}px`;this._notchLeading.nativeElement.style.width=l,this._notchMiddle.nativeElement.style.width=n,this._label.nativeElement.style.marginLeft=`${this._labelMarginLeft}px`,this._recalculateGapWhenVisible=!1}_updateLabelActiveState(){this._isLabelActive()?this._renderer.addClass(this.input,"active"):this._renderer.removeClass(this.input,"active")}_isLabelActive(){return this._formControl&&this._formControl.labelActive}_isHidden(){let l=this._elementRef.nativeElement;return!l.offsetHeight&&!l.offsetWidth}static \u0275fac=function(n){return new(n||a)(V(Lo),V(mz),V(Ee),V(Be))};static \u0275cmp=St({type:a,selectors:[["mdb-form-control"]],contentQueries:function(n,s,d){if(n&1&&(fn(d,IN,7),fn(d,lo,7,Ee)),n&2){let m;se(m=ae())&&(s._formControl=m.first),se(m=ae())&&(s._label=m.first)}},viewQuery:function(n,s){if(n&1&&(ze(LQ,7),ze(zQ,7)),n&2){let d;se(d=ae())&&(s._notchLeading=d.first),se(d=ae())&&(s._notchMiddle=d.first)}},hostVars:4,hostBindings:function(n,s){n&2&&li("form-outline",s.outline)("d-block",s.display)},ngContentSelectors:NQ,decls:7,vars:0,consts:[[1,"form-notch"],[1,"form-notch-leading"],["notchLeading",""],[1,"form-notch-middle"],["notchMiddle",""],[1,"form-notch-trailing"]],template:function(n,s){n&1&&(Un(),Ai(0),T(1,"div",0),dt(2,"div",1,2)(4,"div",3,4)(6,"div",5),k())},encapsulation:2,changeDetection:0})}return a})(),go=(()=>{class a{_elementRef;_renderer;_ngControl;_autofill;constructor(l,n,s,d){this._elementRef=l,this._renderer=n,this._ngControl=s,this._autofill=d}stateChanges=new pe;_focused=!1;_autofilled=!1;_color="";ngAfterViewInit(){typeof getComputedStyle=="function"&&(this._color=getComputedStyle(this._elementRef.nativeElement).color,this._hasTypeInterferingPlaceholder()&&this._updateTextColorForDateType()),this._autofill.monitor(this.input).subscribe(l=>{this._autofilled=l.isAutofilled,this.stateChanges.next()})}_currentNativeValue;get disabled(){return this._ngControl&&this._ngControl.disabled!==null?this._ngControl.disabled:this._disabled}set disabled(l){this._disabled=ao(l)}_disabled=!1;get readonly(){return this._readonly}set readonly(l){l?this._renderer.setAttribute(this._elementRef.nativeElement,"readonly",""):this._renderer.removeAttribute(this._elementRef.nativeElement,"readonly"),this._readonly=ao(l)}_readonly=!1;get value(){return this._elementRef.nativeElement.value}set value(l){l!==this.value&&(this._elementRef.nativeElement.value=l,this._value=l,this.stateChanges.next())}_value;_updateTextColorForDateType(){let l=getComputedStyle(this._elementRef.nativeElement).color;this._color=l!=="rgba(0, 0, 0, 0)"?l:this._color;let n=this.labelActive?this._color:"transparent";this._renderer.setStyle(this._elementRef.nativeElement,"color",n)}_onFocus(){this._focused=!0,this._hasTypeInterferingPlaceholder()&&this._updateTextColorForDateType(),this.stateChanges.next()}_onBlur(){this._focused=!1,this._hasTypeInterferingPlaceholder()&&this._updateTextColorForDateType(),this.stateChanges.next()}ngDoCheck(){let l=this._elementRef.nativeElement.value;this._currentNativeValue!==l&&(this._currentNativeValue=l,this.stateChanges.next())}get hasValue(){return this._elementRef.nativeElement.value!==""}get focused(){return this._focused}get autofilled(){return this._autofilled}get input(){return this._elementRef.nativeElement}get labelActive(){return this.focused||this.hasValue||this.autofilled}_hasTypeInterferingPlaceholder(){return["date","datetime-local","time","month","week"].includes(this._elementRef.nativeElement.type)}static ngAcceptInputType_disabled;static ngAcceptInputType_readonly;ngOnDestroy(){this._autofill.stopMonitoring(this.input)}static \u0275fac=function(n){return new(n||a)(V(Ee),V(Lo),V(fs,10),V(Vy))};static \u0275dir=oe({type:a,selectors:[["","mdbInput",""]],hostVars:1,hostBindings:function(n,s){n&1&&ct("focus",function(){return s._onFocus()})("blur",function(){return s._onBlur()}),n&2&&Os("disabled",s.disabled)},inputs:{disabled:"disabled",readonly:"readonly",value:"value"},exportAs:["mdbInput"],features:[ji([{provide:IN,useExisting:a}])]})}return a})(),Xr=(()=>{class a{static \u0275fac=function(n){return new(n||a)};static \u0275mod=Si({type:a});static \u0275inj=Ei({imports:[zo,Ni]})}return a})();function BQ(a,r){a&1&&(T(0,"div",25),B(1," Completeaza toate campurile "),k())}var AN=(()=>{let r=class r{constructor(n,s,d){this.router=n,this.identityService=s,this.fb=d,this.registrationForm=this.fb.group({username:["",Le.required],password:["",[Le.required]],rememberMe:[!1]})}ngOnInit(){}onLogin(){if(this.registrationForm.markAllAsTouched(),this.registrationForm.valid){let n=this.registrationForm.get("username")?.value,s=this.registrationForm.get("password")?.value,d=this.registrationForm.get("rememberMe")?.value;this.identityService.login(n,s,d)}}};r.\u0275fac=function(s){return new(s||r)(V(zi),V(oi),V(Er))},r.\u0275cmp=St({type:r,selectors:[["app-login"]],standalone:!0,features:[At],decls:39,vars:2,consts:[[1,"container-fluid",3,"keydown.enter"],[3,"formGroup"],[1,"mb-4"],["mdbInput","","type","text","id","username","formControlName","username","required","",1,"form-control"],["username",""],["mdbLabel","","for","username",1,"form-label"],["mdbInput","","type","password","id","password","formControlName","password","required","",1,"form-control"],["password",""],["mdbLabel","","for","password",1,"form-label"],["class","text-danger mb-4",4,"ngIf"],[1,"row","mb-4"],[1,"col","d-flex","justify-content-center"],[1,"form-check"],["type","checkbox","value","","id","checkbox","formControlName","rememberMe",1,"form-check-input"],["for","checkbox",1,"form-check-label"],[1,"col"],["routerLink","/forgot-password"],["type","button",1,"btn","btn-primary","btn-block","mb-4",3,"click"],[1,"text-center"],["routerLink","/register"],["type","button",1,"btn","btn-link","btn-floating","mx-1"],[1,"fab","fa-facebook-f"],[1,"fab","fa-google"],[1,"fab","fa-twitter"],[1,"fab","fa-github"],[1,"text-danger","mb-4"]],template:function(s,d){if(s&1&&(T(0,"div",0),ct("keydown.enter",function(){return d.onLogin()}),T(1,"form",1)(2,"mdb-form-control",2),dt(3,"input",3,4),T(5,"label",5),B(6,"Username"),k()(),T(7,"mdb-form-control",2),dt(8,"input",6,7),T(10,"label",8),B(11,"Password"),k()(),ut(12,BQ,2,0,"div",9),T(13,"div",10)(14,"div",11)(15,"div",12),dt(16,"input",13),T(17,"label",14),B(18," Tine-ma minte "),k()()(),T(19,"div",15)(20,"a",16),B(21,"Ai uitat parola?"),k()()(),T(22,"button",17),ct("click",function(){return d.onLogin()}),B(23,"Sign in"),k(),T(24,"div",18)(25,"p"),B(26,"Nu ai cont? "),T(27,"a",19),B(28,"Inregistreaza-te"),k()(),T(29,"p"),B(30,"sau incearca cu:"),k(),T(31,"button",20),dt(32,"i",21),k(),T(33,"button",20),dt(34,"i",22),k(),T(35,"button",20),dt(36,"i",23),k(),T(37,"button",20),dt(38,"i",24),k()()()()),s&2){let m;z(),W("formGroup",d.registrationForm),z(11),W("ngIf",((m=d.registrationForm.get("username"))==null?null:m.invalid)&&((m=d.registrationForm.get("username"))==null?null:m.touched)&&((m=d.registrationForm.get("password"))==null?null:m.invalid)&&((m=d.registrationForm.get("password"))==null?null:m.touched))}},dependencies:[kn,Ni,Sr,en,Kf,qi,Cr,Yr,TN,Mn,Hn,hr,Ve,Xr,fo,go,lo],styles:[".container-fluid[_ngcontent-%COMP%]{background:#f5f5f5;height:100vh;display:flex;justify-content:center;align-items:center;-webkit-user-select:none;user-select:none}form[_ngcontent-%COMP%]{padding:20px;box-shadow:0 0 10px #ccc;width:400px;height:400px}"]});let a=r;return a})();function Im(a){let r=a.get("password"),l=a.get("confirmPassword");return r&&l&&r.value!==l.value?{passwordMismatch:!0}:null}function VQ(a,r){a&1&&(T(0,"div",32),B(1," Prenumele este obligatoriu "),k())}function jQ(a,r){a&1&&(T(0,"div",32),B(1," Numele este obligatoriu "),k())}function UQ(a,r){a&1&&(T(0,"div",32),B(1," Username-ul este obligatoriu "),k())}function HQ(a,r){a&1&&(T(0,"div",32),B(1," Email-ul este obligatoriu "),k())}function GQ(a,r){a&1&&(T(0,"div",32),B(1," Email-ul are un format invalid "),k())}function qQ(a,r){a&1&&(T(0,"div",32),B(1," Parola este obligatorie "),k())}function WQ(a,r){a&1&&(T(0,"div",32),B(1," Parola trebuie sa aiba minim 6 caractere "),k())}function $Q(a,r){a&1&&(T(0,"div",32),B(1," Parolele nu coincid "),k())}var YQ=a=>({"border-color":a}),kN=(()=>{let r=class r{constructor(n,s,d,m){this.fb=n,this.identityService=s,this.router=d,this.snackBar=m,this.registrationForm=this.fb.group({firstName:["",Le.required],lastName:["",Le.required],username:["",Le.required],email:["",[Le.required,Le.email]],password:["",[Le.required,Le.minLength(6)]],confirmPassword:["",Le.required],terms:[!1,Le.requiredTrue]},{validators:[Im]})}onRegister(){if(this.registrationForm.markAllAsTouched(),this.registrationForm.valid){let n=this.registrationForm.get("firstName")?.value,s=this.registrationForm.get("lastName")?.value,d=this.registrationForm.get("username")?.value,m=this.registrationForm.get("email")?.value,_=this.registrationForm.get("password")?.value,w=this.registrationForm.get("confirmPassword")?.value;this.identityService.register(n,s,d,_,m)}}};r.\u0275fac=function(s){return new(s||r)(V(Er),V(oi),V(zi),V(Je))},r.\u0275cmp=St({type:r,selectors:[["app-register"]],standalone:!0,features:[At],decls:55,vars:12,consts:[[1,"container-fluid"],[3,"formGroup"],[1,"mb-4"],["mdbInput","","type","text","id","firstName","formControlName","firstName","required","",1,"form-control"],["firstName",""],["mdbLabel","","for","firstName",1,"form-label"],["class","text-danger mb-4",4,"ngIf"],["mdbInput","","type","text","id","lastName","formControlName","lastName","required","",1,"form-control"],["lastName",""],["mdbLabel","","for","lastName",1,"form-label"],["mdbInput","","type","text","id","username","formControlName","username","required","",1,"form-control"],["username",""],["mdbLabel","","for","username",1,"form-label"],["mdbInput","","type","text","id","email","formControlName","email","required","",1,"form-control"],["email",""],["mdbLabel","","for","email",1,"form-label"],["mdbInput","","type","password","id","password","formControlName","password","required","",1,"form-control"],["password",""],["mdbLabel","","for","password",1,"form-label"],["mdbInput","","type","password","id","confirmPassword","formControlName","confirmPassword","required","",1,"form-control"],["confirmPassword",""],["mdbLabel","","for","confirmPassword",1,"form-label"],[1,"row","mb-4"],[1,"col"],[1,"form-check"],["mdbInput","","type","checkbox","id","terms","formControlName","terms","required","",1,"form-check-input",3,"ngStyle"],["terms",""],["for","terms",1,"form-check-label","font-12"],["href",""],[1,"col","font-12","ms-5"],["routerLink","/login"],["type","button",1,"btn","btn-primary","btn-block","mb-4",3,"click"],[1,"text-danger","mb-4"]],template:function(s,d){if(s&1&&(T(0,"div",0)(1,"form",1)(2,"mdb-form-control",2),dt(3,"input",3,4),T(5,"label",5),B(6,"Prenume"),k()(),ut(7,VQ,2,0,"div",6),T(8,"mdb-form-control",2),dt(9,"input",7,8),T(11,"label",9),B(12,"Nume"),k()(),ut(13,jQ,2,0,"div",6),T(14,"mdb-form-control",2),dt(15,"input",10,11),T(17,"label",12),B(18,"Username"),k()(),ut(19,UQ,2,0,"div",6),T(20,"mdb-form-control",2),dt(21,"input",13,14),T(23,"label",15),B(24,"Email"),k()(),ut(25,HQ,2,0,"div",6)(26,GQ,2,0,"div",6),T(27,"mdb-form-control",2),dt(28,"input",16,17),T(30,"label",18),B(31,"Password"),k()(),ut(32,qQ,2,0,"div",6)(33,WQ,2,0,"div",6),T(34,"mdb-form-control",2),dt(35,"input",19,20),T(37,"label",21),B(38,"Confirm password"),k()(),ut(39,$Q,2,0,"div",6),T(40,"div",22)(41,"div",23)(42,"div",24),dt(43,"input",25,26),T(45,"label",27),B(46,"Sunt de acord cu "),T(47,"a",28),B(48,"termenii si conditiile"),k()()()(),T(49,"div",29),B(50," Ai cont? "),T(51,"a",30),B(52,"Inapoi la login?"),k()()(),T(53,"button",31),ct("click",function(){return d.onRegister()}),B(54,"Sign in"),k()()()),s&2){let m,_,w,S,I,L,H,q,X;z(),W("formGroup",d.registrationForm),z(6),W("ngIf",((m=d.registrationForm.get("firstName"))==null?null:m.invalid)&&((m=d.registrationForm.get("firstName"))==null?null:m.touched)),z(6),W("ngIf",((_=d.registrationForm.get("lastName"))==null?null:_.invalid)&&((_=d.registrationForm.get("lastName"))==null?null:_.touched)),z(6),W("ngIf",((w=d.registrationForm.get("username"))==null?null:w.invalid)&&((w=d.registrationForm.get("username"))==null?null:w.touched)),z(6),W("ngIf",((S=d.registrationForm.get("email"))==null||S.errors==null?null:S.errors.required)&&((S=d.registrationForm.get("email"))==null?null:S.touched)),z(),W("ngIf",((I=d.registrationForm.get("email"))==null||I.errors==null?null:I.errors.email)&&((I=d.registrationForm.get("email"))==null?null:I.touched)),z(6),W("ngIf",((L=d.registrationForm.get("password"))==null||L.errors==null?null:L.errors.required)&&((L=d.registrationForm.get("password"))==null?null:L.touched)),z(),W("ngIf",((H=d.registrationForm.get("password"))==null||H.errors==null?null:H.errors.minlength)&&((H=d.registrationForm.get("password"))==null?null:H.touched)),z(6),W("ngIf",((q=d.registrationForm.get("password"))==null?null:q.touched)&&((q=d.registrationForm.get("confirmPassword"))==null?null:q.touched)&&(d.registrationForm.errors==null?null:d.registrationForm.errors.passwordMismatch)&&!((q=d.registrationForm.get("password"))!=null&&q.errors)),z(4),W("ngStyle",xi(10,YQ,(X=d.registrationForm.get("terms"))!=null&&X.invalid&&((X=d.registrationForm.get("terms"))!=null&&X.touched)?"red":""))}},dependencies:[Ni,Sr,en,Kf,qi,Cr,Yr,qE,Xr,fo,go,lo,kn,Mn,Hn,hr,Ve,oL],styles:[".container-fluid[_ngcontent-%COMP%]{background:#f5f5f5;height:100vh;display:flex;justify-content:center;align-items:center;-webkit-user-select:none;user-select:none}form[_ngcontent-%COMP%]{padding:20px;box-shadow:0 0 10px #ccc;width:450px;height:auto}.font-12[_ngcontent-%COMP%]{font-size:12px}.terms-conditions[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{padding-left:5px}"]});let a=r;return a})();function ZQ(a,r){a&1&&(T(0,"div",15),B(1," Email-ul este obligatoriu "),k())}function XQ(a,r){a&1&&(T(0,"div",15),B(1," Email-ul are un format invalid "),k())}var RN=(()=>{let r=class r{constructor(n,s,d,m){this.router=n,this.identityService=s,this.fb=d,this.snackBar=m,this.registrationForm=this.fb.group({email:["",[Le.required,Le.email]]})}onResetPasswordClick(){this.registrationForm.markAllAsTouched(),this.registrationForm.valid&&this.identityService.forgotPassword(this.registrationForm.value.email)}};r.\u0275fac=function(s){return new(s||r)(V(zi),V(oi),V(Er),V(Je))},r.\u0275cmp=St({type:r,selectors:[["app-forgot-password"]],standalone:!0,features:[At],decls:22,vars:3,consts:[[1,"container-fluid"],[1,"card","text-center",2,"width","300px"],[1,"card-header","h5","text-white","bg-primary"],[1,"card-body","px-5"],[1,"card-text","py-2"],[3,"formGroup"],[1,"mb-4"],["mdbInput","","type","text","id","email","formControlName","email","required","",1,"form-control"],["email",""],["mdbLabel","","for","email",1,"form-label"],["class","text-danger mb-4",4,"ngIf"],["href","#",1,"btn","btn-primary","w-100",3,"click"],[1,"d-flex","justify-content-between","mt-4"],["routerLink","/login",1,""],["routerLink","/register",1,""],[1,"text-danger","mb-4"]],template:function(s,d){if(s&1&&(T(0,"div",0)(1,"div",1)(2,"div",2),B(3,"Resetare parola"),k(),T(4,"div",3)(5,"p",4),B(6," Introduce adresa email si iti vom trimite un email cu instructiuni pentru resetarea parolei. "),k(),T(7,"form",5)(8,"mdb-form-control",6),dt(9,"input",7,8),T(11,"label",9),B(12,"Email"),k()(),ut(13,ZQ,2,0,"div",10)(14,XQ,2,0,"div",10),k(),T(15,"button",11),ct("click",function(){return d.onResetPasswordClick()}),B(16,"Resetare parola"),k(),T(17,"div",12)(18,"a",13),B(19,"Login"),k(),T(20,"a",14),B(21,"Inregistrare"),k()()()()()),s&2){let m,_;z(7),W("formGroup",d.registrationForm),z(6),W("ngIf",((m=d.registrationForm.get("email"))==null||m.errors==null?null:m.errors.required)&&((m=d.registrationForm.get("email"))==null?null:m.touched)),z(),W("ngIf",((_=d.registrationForm.get("email"))==null||_.errors==null?null:_.errors.email)&&((_=d.registrationForm.get("email"))==null?null:_.touched))}},dependencies:[kn,Mn,Sr,en,qi,Cr,Yr,Hn,hr,Xr,fo,go,lo,Ve],styles:[".container-fluid[_ngcontent-%COMP%]{background:#f5f5f5;height:100vh;display:flex;justify-content:center;align-items:center;-webkit-user-select:none;user-select:none}"]});let a=r;return a})();function KQ(a,r){a&1&&(T(0,"h4"),B(1,"Cosul de cumparaturi este gol"),k())}function QQ(a,r){if(a&1&&(T(0,"option"),B(1),k()),a&2){let l=r.$implicit;z(),Te(l)}}function JQ(a,r){if(a&1){let l=we();T(0,"div",5)(1,"div",6)(2,"div",7)(3,"div",8)(4,"h4",9),B(5),k(),T(6,"h5",10),B(7),k(),T(8,"h6",10),B(9),k(),T(10,"p",11),B(11),k()(),T(12,"div",12)(13,"select",13),ct("change",function(s){let m=Kt(l).$implicit,_=gt(2);return Qt(_.onQuantityChange(s,m))}),T(14,"option",14),B(15),k(),ut(16,QQ,2,1,"option",15),k(),T(17,"button",16),ct("click",function(){let d=Kt(l).$implicit,m=gt(2);return Qt(m.removeFromCart(d))}),B(18,"Sterge"),k()()()()()}if(a&2){let l=r.$implicit,n=gt(2);z(5),Te(l.ticketType.event.title),z(2),po("",l.ticketType.event.location.name," | ",l.ticketType.event.date,""),z(2),Te(l.ticketType.name),z(2),tL("",l.ticketType.price," RON x ",l.quantity," = ",l.ticketType.price*l.quantity," RON"),z(3),W("selected",l.quantity),z(),Te(l.quantity),z(),W("ngForOf",n.generateQuantityList(l.quantity))}}function tJ(a,r){if(a&1){let l=we();T(0,"div"),ut(1,JQ,19,10,"div",2),T(2,"h4",3),B(3),k(),T(4,"button",4),ct("click",function(){Kt(l);let s=gt();return Qt(s.onBuyClick())}),B(5,"Cumpara"),k()()}if(a&2){let l=gt();z(),W("ngForOf",l.shoppingCart.shoppingCartItemList),z(2),ie("Total: ",l.shoppingCart.price," RON")}}var PN=(()=>{let r=class r{constructor(n,s){this.shoppingCartService=n,this.snackBar=s,this.shoppingCart={}}ngOnInit(){return Tt(this,null,function*(){yield this.shoppingCartService.fetchShoppingCart(),this.shoppingCartSubscription=this.shoppingCartService.getShoppingCart().subscribe(n=>{this.shoppingCart=n})})}ngOnDestroy(){this.shoppingCartSubscription?.unsubscribe()}generateQuantityList(n){let s=[];for(let d=1;d<=10;d++)d!==n&&s.push(d);return s}onQuantityChange(n,s){return Tt(this,null,function*(){s.quantity=n.target.value,yield this.shoppingCartService.updateQuantity(s)})}removeFromCart(n){return Tt(this,null,function*(){yield this.shoppingCartService.removeTicketFromShoppingCart(n.ticketType)})}onBuyClick(){return Tt(this,null,function*(){yield this.shoppingCartService.buyTickets()})}};r.\u0275fac=function(s){return new(s||r)(V(qy),V(Je))},r.\u0275cmp=St({type:r,selectors:[["app-shopping-cart"]],standalone:!0,features:[At],decls:5,vars:2,consts:[[1,"container-fluid"],[4,"ngIf"],["class","card",4,"ngFor","ngForOf"],[1,"mt-3"],[1,"btn","btn-primary","mt-3",3,"click"],[1,"card"],[1,"card-body"],[1,"row"],[1,"col-md-9"],[1,"card-title"],[1,"card-subtitle","mb-2","text-muted"],[1,"card-text"],[1,"col-md-3"],[1,"custom-select","me-2",3,"change"],[3,"selected"],[4,"ngFor","ngForOf"],[1,"btn","btn-danger",3,"click"]],template:function(s,d){s&1&&(T(0,"div",0)(1,"h1"),B(2,"Cos"),k(),ut(3,KQ,2,0,"h4",1)(4,tJ,6,2,"div",1),k()),s&2&&(z(3),W("ngIf",(d.shoppingCart==null||d.shoppingCart.shoppingCartItemList==null?null:d.shoppingCart.shoppingCartItemList.length)===0),z(),W("ngIf",(d.shoppingCart==null||d.shoppingCart.shoppingCartItemList==null?null:d.shoppingCart.shoppingCartItemList.length)>0))},dependencies:[Ve,pi,Mn,Fs,Ls,Ni],styles:[".container-fluid[_ngcontent-%COMP%]{width:65%;margin:0 auto;border:2px solid #ccc;padding:20px;border-radius:8px}.custom-select[_ngcontent-%COMP%]{width:4rem;padding:.375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;border:1px solid #ced4da;border-radius:.25rem}"]});let a=r;return a})();var eJ=["submenu"];function iJ(a,r){if(a&1&&dt(0,"i"),a&2){let l=gt(2).$implicit;al(l.icon)}}var MM=a=>({active:a});function nJ(a,r){if(a&1){let l=we();br(0),T(1,"a",16),ct("click",function(){Kt(l);let s=gt().$implicit,d=gt();return Qt(d.onMenuItemClick(s))}),ut(2,iJ,1,3,"i",17),T(3,"span"),B(4),k()(),xr()}if(a&2){let l=gt().$implicit,n=gt();z(),W("ngClass",xi(3,MM,n.isCurrentPage(l.label))),z(),W("ngIf",l.icon),z(2),Te(l.label)}}function rJ(a,r){if(a&1&&dt(0,"i"),a&2){let l=gt(2).$implicit;al(l.icon)}}function oJ(a,r){if(a&1&&dt(0,"i"),a&2){let l=gt().$implicit;al(l.icon)}}function sJ(a,r){if(a&1){let l=we();T(0,"li",23),ct("click",function(){let d=Kt(l).$implicit,m=gt(3);return Qt(m.onMenuItemClick(d))}),ut(1,oJ,1,3,"i",17),T(2,"span"),B(3),k()()}if(a&2){let l=r.$implicit,n=gt(3);W("ngClass",xi(3,MM,n.isCurrentPage(l.label))),z(),W("ngIf",l.icon),z(2),Te(l.label)}}function aJ(a,r){if(a&1){let l=we();br(0),T(1,"a",18),ct("click",function(){Kt(l);let s=oo(7);return Qt(s.toggle())}),ut(2,rJ,1,3,"i",17),T(3,"span"),B(4),k(),dt(5,"i",19),k(),T(6,"ul",20,21),ut(8,sJ,4,5,"li",22),k(),xr()}if(a&2){let l=oo(7),n=gt().$implicit,s=gt();z(),W("ngClass",xi(7,MM,s.isCurrentPage(n.label))),ri("aria-expanded",!l.collapsed),z(),W("ngIf",n.icon),z(2),Te(n.label),z(),li("rotate",n.expanded),z(3),W("ngForOf",n.submenu)}}function lJ(a,r){if(a&1&&(br(0),ut(1,nJ,5,5,"ng-container",15)(2,aJ,9,9,"ng-container",15),xr()),a&2){let l=r.$implicit;z(),W("ngIf",!l.submenu),z(),W("ngIf",l.submenu)}}var Am=(()=>{let r=class r{constructor(n,s,d){this.router=n,this.route=s,this.identityService=d,this.menuItems=[],this.brand="",this.activePage="",this.page="",this.pageNameMap={"/admin-dashboard":"Acasa","/admin-dashboard/manage/users":"Gestioneaza Utilizatori","/admin-dashboard/manage/locations":"Gestioneaza Locatii","/admin-dashboard/manage/events":"Gestioneaza Evenimente","/admin-dashboard/manage/artists":"Gestioneaza Artisti","/admin-dashboard/manage/orders":"Gestioneaza Comenzi","/admin-dashboard/statistics":"Statistici","/admin-dashboard/settings":"Setari"}}ngOnInit(){this.page=this.router.url.split("/").join("/").split("?")[0],this.page.includes("manage")?this.activePage=this.pageNameMap[this.page].split(" ")[1]:this.activePage=this.pageNameMap[this.page],this.router.events.pipe(pn(n=>n instanceof ps)).subscribe(()=>{let n=this.router.url;this.page=n.split("/").join("/").split("?")[0],this.page.includes("manage")?this.activePage=this.pageNameMap[this.page].split(" ")[1]:this.activePage=this.pageNameMap[this.page]})}isCurrentPage(n){return this.activePage===n}onMenuItemClick(n){n.route&&(n.route.includes("manage")?this.router.navigate([n.route],{queryParams:{page:0,size:5}}):this.router.navigate([n.route]))}onLogoutClick(){this.identityService.logout("go home")}};r.\u0275fac=function(s){return new(s||r)(V(zi),V(Tn),V(oi))},r.\u0275cmp=St({type:r,selectors:[["app-sidebar"]],viewQuery:function(s,d){if(s&1&&ze(eJ,5),s&2){let m;se(m=ae())&&(d.submenu=m.first)}},inputs:{menuItems:"menuItems",brand:"brand"},standalone:!0,features:[At],decls:20,vars:4,consts:[["id","sidebarMenu","mdbCollapse","",1,"collapse","d-lg-block","sidebar","collapse","bg-white"],["sidebarMenu","mdbCollapse"],[1,"position-sticky"],[1,"list-group","list-group-flush","mx-3","mt-4"],[4,"ngFor","ngForOf"],[1,"list-group-item","list-group-item-action","py-2","ripple",3,"click"],[1,"fas","fa-sign-out-alt","fa-fw","me-3"],["id","main-navbar",1,"navbar","navbar-expand-lg","navbar-light","bg-light","fixed-top"],[1,"container-fluid"],["routerLink","",1,"navbar-brand"],[1,"navbar-nav","me-auto","mb-2","mb-lg-0"],[1,"nav-item"],[1,"nav-link"],["type","button","aria-controls","sidebarMenu",1,"navbar-toggler",3,"click"],[1,"fas","fa-bars"],[4,"ngIf"],["aria-current","true",1,"list-group-item","list-group-item-action","py-2","ripple",3,"ngClass","click"],[3,"class",4,"ngIf"],["aria-controls","submenu",1,"list-group-item","list-group-item-action","py-2","ripple",3,"ngClass","click"],[1,"fa","fa-chevron-right","fa-fw"],["id","submenu","mdbCollapse",""],["submenu","mdbCollapse"],["class","list-group-item list-group-item-action py-2 ripple","role","button",3,"ngClass","click",4,"ngFor","ngForOf"],["role","button",1,"list-group-item","list-group-item-action","py-2","ripple",3,"ngClass","click"]],template:function(s,d){if(s&1){let m=we();T(0,"header")(1,"nav",0,1)(3,"div",2)(4,"div",3),ut(5,lJ,3,2,"ng-container",4),T(6,"a",5),ct("click",function(){return d.onLogoutClick()}),dt(7,"i",6),T(8,"span"),B(9,"Logout"),k()()()()(),T(10,"nav",7)(11,"div",8)(12,"a",9),B(13),k(),T(14,"ul",10)(15,"li",11)(16,"a",12),B(17),k()()(),T(18,"button",13),ct("click",function(){Kt(m);let w=oo(2);return Qt(w.toggle())}),dt(19,"i",14),k()()()()}if(s&2){let m=oo(2);z(5),W("ngForOf",d.menuItems),z(8),Te(d.brand),z(4),Te(d.pageNameMap[d.page]),z(),ri("aria-expanded",!m.collapsed)}},dependencies:[Gl,dz,Uo,pi,Ve,kn],styles:["@media (min-width: 991.98px){main[_ngcontent-%COMP%]{padding-left:240px}}.sidebar[_ngcontent-%COMP%]{position:fixed;top:0;bottom:0;left:0;padding:58px 0 0;box-shadow:0 2px 5px #0000000d,0 2px 10px #0000000d;width:240px;z-index:600}@media (max-width: 991.98px){.sidebar[_ngcontent-%COMP%]{width:100%}}.sidebar[_ngcontent-%COMP%]   .active[_ngcontent-%COMP%]{border-radius:5px;box-shadow:0 2px 5px #00000029,0 2px 10px #0000001f}.sidebar-sticky[_ngcontent-%COMP%]{position:relative;top:0;height:calc(100vh - 48px);padding-top:.5rem;overflow-x:hidden;overflow-y:auto}a[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none}.list-group-item[_ngcontent-%COMP%]{border-left:none;border-right:none}"]});let a=r;return a})();var ON=(()=>{let r=class r{constructor(){this.menuItems=[{label:"Contul meu",route:"account",icon:"fa-solid fa-user fa-fw me-3"},{label:"Comenzi",route:"account/orders",icon:"fa-solid fa-envelope fa-fw me-3"},{label:"Setari",route:"account/settings",icon:"fa-solid fa-gear fa-fw me-3"}]}};r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=St({type:r,selectors:[["app-account"]],standalone:!0,features:[At],decls:3,vars:2,consts:[[3,"menuItems","brand"]],template:function(s,d){s&1&&(dt(0,"app-sidebar",0),T(1,"main"),dt(2,"router-outlet"),k()),s&2&&W("menuItems",d.menuItems)("brand","Bileteria")},dependencies:[Gl,cl,Am],styles:["@media (min-width: 991.98px){main[_ngcontent-%COMP%]{padding-left:240px}}main[_ngcontent-%COMP%]{padding-top:70px;margin-left:15px}"]});let a=r;return a})();var FN=(()=>{let r=class r{constructor(){this.menuItems=[{label:"Acasa",route:"admin-dashboard",icon:"fa-solid fa-home fa-fw me-3"},{label:"Gestioneaza",icon:"fa-solid fa-cogs fa-fw me-3",submenu:[{label:"Utilizatori",route:"admin-dashboard/manage/users",icon:"fa-solid fa-user fa-fw me-3"},{label:"Locatii",route:"admin-dashboard/manage/locations",icon:"fa-solid fa-map-marker fa-fw me-3"},{label:"Evenimente",route:"admin-dashboard/manage/events",icon:"fa-solid fa-calendar fa-fw me-3"},{label:"Artisti",route:"admin-dashboard/manage/artists",icon:"fa-solid fa-microphone fa-fw me-3"},{label:"Comenzi",route:"admin-dashboard/manage/orders",icon:"fa-solid fa-envelope fa-fw me-3"}]},{label:"Statistici",route:"admin-dashboard/statistics",icon:"fa-solid fa-chart-bar fa-fw me-3"},{label:"Setari",route:"admin-dashboard/settings",icon:"fa-solid fa-gear fa-fw me-3"}]}};r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=St({type:r,selectors:[["app-admin-dashboard"]],standalone:!0,features:[At],decls:3,vars:2,consts:[[3,"menuItems","brand"]],template:function(s,d){s&1&&(dt(0,"app-sidebar",0),T(1,"main"),dt(2,"router-outlet"),k()),s&2&&W("menuItems",d.menuItems)("brand","Admin dashboard")},dependencies:[Gl,cl,Am],styles:["@media (min-width: 991.98px){main[_ngcontent-%COMP%]{padding-left:240px}}main[_ngcontent-%COMP%]{padding-top:70px;margin-left:15px}"]});let a=r;return a})();var LN=(()=>{let r=class r{constructor(n,s){this.identityService=n,this.router=s}canActivate(n,s){return this.identityService.isUser()||!this.identityService.isLoggedIn()?(this.router.navigate([""]),!1):this.identityService.isValidator()?(this.router.navigate(["validator-dashboard"]),!1):!0}};r.\u0275fac=function(s){return new(s||r)(ht(oi),ht(zi))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var zN=(()=>{let r=class r{constructor(n,s){this.identityService=n,this.router=s}canActivate(n,s){return this.identityService.isAdmin()?(this.router.navigate(["admin-dashboard"]),!1):this.identityService.isValidator()?(this.router.navigate(["validator-dashboard"]),!1):!0}};r.\u0275fac=function(s){return new(s||r)(ht(oi),ht(zi))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var Wy=(()=>{let r=class r{constructor(n,s,d){this.http=n,this.identityService=s,this.snackBar=d,this.selectedEventListSubject=new We([]),this.eventListForSelectionSubject=new We([])}setSelectedEventList(n){this.selectedEventListSubject.next(n)}getSelectedEventList(){return this.selectedEventListSubject.asObservable()}setEventListForSelection(n){this.eventListForSelectionSubject.next(n)}getEventListForSelection(){return this.eventListForSelectionSubject.asObservable()}fetchEventListForSelection(){return Tt(this,null,function*(){try{let n=yield Ne(this.http.get(be+"/events/all-for-selection",{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setEventListForSelection(n)}catch{this.snackBar.open("Failed to fetch event list for selection","Close",{duration:3e3})}})}fetchSelectedEvents(){return Tt(this,null,function*(){try{let n=yield Ne(this.http.get(be+"/events/selected"));this.setSelectedEventList(n)}catch{this.snackBar.open("Failed to fetch selected events","Close",{duration:3e3})}})}addSelectedEventList(n){return Tt(this,null,function*(){try{let s=yield Ne(this.http.post(be+"/events/select",n,{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setSelectedEventList([...this.selectedEventListSubject.value,...s])}catch{this.snackBar.open("Failed to add selected events","Close",{duration:3e3})}})}deleteSelectedEvent(n){return Tt(this,null,function*(){try{let s=yield Ne(this.http.delete(be+"/events/deselect/"+n,{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setSelectedEventList(this.selectedEventListSubject.value.filter(d=>d.id!==n))}catch{this.snackBar.open("Failed to delete selected event","Close",{duration:3e3})}})}};r.\u0275fac=function(s){return new(s||r)(ht(Hi),ht(oi),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function cJ(a,r){}var Lu=class{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0,this.closeOnOverlayDetachments=!0}};var TM=(()=>{let r=class r extends Cd{constructor(n,s,d,m,_,w,S,I){super(),this._elementRef=n,this._focusTrapFactory=s,this._config=m,this._interactivityChecker=_,this._ngZone=w,this._overlayRef=S,this._focusMonitor=I,this._platform=le(gn),this._focusTrap=null,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this._ariaLabelledByQueue=[],this._changeDetectorRef=le(Zi),this.attachDomPortal=L=>{this._portalOutlet.hasAttached();let H=this._portalOutlet.attachDomPortal(L);return this._contentAttached(),H},this._document=d,this._config.ariaLabelledBy&&this._ariaLabelledByQueue.push(this._config.ariaLabelledBy)}_addAriaLabelledBy(n){this._ariaLabelledByQueue.push(n),this._changeDetectorRef.markForCheck()}_removeAriaLabelledBy(n){let s=this._ariaLabelledByQueue.indexOf(n);s>-1&&(this._ariaLabelledByQueue.splice(s,1),this._changeDetectorRef.markForCheck())}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(n){this._portalOutlet.hasAttached();let s=this._portalOutlet.attachComponentPortal(n);return this._contentAttached(),s}attachTemplatePortal(n){this._portalOutlet.hasAttached();let s=this._portalOutlet.attachTemplatePortal(n);return this._contentAttached(),s}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(n,s){this._interactivityChecker.isFocusable(n)||(n.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{let d=()=>{n.removeEventListener("blur",d),n.removeEventListener("mousedown",d),n.removeAttribute("tabindex")};n.addEventListener("blur",d),n.addEventListener("mousedown",d)})),n.focus(s)}_focusByCssSelector(n,s){let d=this._elementRef.nativeElement.querySelector(n);d&&this._forceFocus(d,s)}_trapFocus(){let n=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||n.focus();break;case!0:case"first-tabbable":this._focusTrap?.focusInitialElementWhenReady().then(s=>{s||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus);break}}_restoreFocus(){let n=this._config.restoreFocus,s=null;if(typeof n=="string"?s=this._document.querySelector(n):typeof n=="boolean"?s=n?this._elementFocusedBeforeDialogWasOpened:null:n&&(s=n),this._config.restoreFocus&&s&&typeof s.focus=="function"){let d=xd(),m=this._elementRef.nativeElement;(!d||d===this._document.body||d===m||m.contains(d))&&(this._focusMonitor?(this._focusMonitor.focusVia(s,this._closeInteractionType),this._closeInteractionType=null):s.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){let n=this._elementRef.nativeElement,s=xd();return n===s||n.contains(s)}_initializeFocusTrap(){this._platform.isBrowser&&(this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=xd()))}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}};r.\u0275fac=function(s){return new(s||r)(V(Ee),V(ug),V(ci,8),V(Lu),V(dg),V(Be),V(Ic),V(Bs))},r.\u0275cmp=St({type:r,selectors:[["cdk-dialog-container"]],viewQuery:function(s,d){if(s&1&&ze(ul,7),s&2){let m;se(m=ae())&&(d._portalOutlet=m.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(s,d){s&2&&ri("id",d._config.id||null)("role",d._config.role)("aria-modal",d._config.ariaModal)("aria-labelledby",d._config.ariaLabel?null:d._ariaLabelledByQueue[0])("aria-label",d._config.ariaLabel)("aria-describedby",d._config.ariaDescribedBy||null)},standalone:!0,features:[Di,At],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(s,d){s&1&&ut(0,cJ,0,0,"ng-template",0)},dependencies:[ul],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2});let a=r;return a})(),bg=class{constructor(r,l){this.overlayRef=r,this.config=l,this.closed=new pe,this.disableClose=l.disableClose,this.backdropClick=r.backdropClick(),this.keydownEvents=r.keydownEvents(),this.outsidePointerEvents=r.outsidePointerEvents(),this.id=l.id,this.keydownEvents.subscribe(n=>{n.keyCode===27&&!this.disableClose&&!Zr(n)&&(n.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})}),this._detachSubscription=r.detachments().subscribe(()=>{l.closeOnOverlayDetachments!==!1&&this.close()})}close(r,l){if(this.containerInstance){let n=this.closed;this.containerInstance._closeInteractionType=l?.focusOrigin||"program",this._detachSubscription.unsubscribe(),this.overlayRef.dispose(),n.next(r),n.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(r="",l=""){return this.overlayRef.updateSize({width:r,height:l}),this}addPanelClass(r){return this.overlayRef.addPanelClass(r),this}removePanelClass(r){return this.overlayRef.removePanelClass(r),this}},dJ=new Se("DialogScrollStrategy",{providedIn:"root",factory:()=>{let a=le(Zn);return()=>a.scrollStrategies.block()}}),uJ=new Se("DialogData"),hJ=new Se("DefaultDialogConfig");var mJ=0,BN=(()=>{let r=class r{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}constructor(n,s,d,m,_,w){this._overlay=n,this._injector=s,this._defaultOptions=d,this._parentDialog=m,this._overlayContainer=_,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new pe,this._afterOpenedAtThisLevel=new pe,this._ariaHiddenElements=new Map,this.afterAllClosed=wc(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(ho(void 0))),this._scrollStrategy=w}open(n,s){let d=this._defaultOptions||new Lu;s=qt(qt({},d),s),s.id=s.id||`cdk-dialog-${mJ++}`,s.id&&this.getDialogById(s.id);let m=this._getOverlayConfig(s),_=this._overlay.create(m),w=new bg(_,s),S=this._attachContainer(_,w,s);return w.containerInstance=S,this._attachDialogContent(n,w,S,s),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(w),w.closed.subscribe(()=>this._removeOpenDialog(w,!0)),this.afterOpened.next(w),w}closeAll(){DM(this.openDialogs,n=>n.close())}getDialogById(n){return this.openDialogs.find(s=>s.id===n)}ngOnDestroy(){DM(this._openDialogsAtThisLevel,n=>{n.config.closeOnDestroy===!1&&this._removeOpenDialog(n,!1)}),DM(this._openDialogsAtThisLevel,n=>n.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(n){let s=new rs({positionStrategy:n.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:n.scrollStrategy||this._scrollStrategy(),panelClass:n.panelClass,hasBackdrop:n.hasBackdrop,direction:n.direction,minWidth:n.minWidth,minHeight:n.minHeight,maxWidth:n.maxWidth,maxHeight:n.maxHeight,width:n.width,height:n.height,disposeOnNavigation:n.closeOnNavigation});return n.backdropClass&&(s.backdropClass=n.backdropClass),s}_attachContainer(n,s,d){let m=d.injector||d.viewContainerRef?.injector,_=[{provide:Lu,useValue:d},{provide:bg,useValue:s},{provide:Ic,useValue:n}],w;d.container?typeof d.container=="function"?w=d.container:(w=d.container.type,_.push(...d.container.providers(d))):w=TM;let S=new ns(w,d.viewContainerRef,mo.create({parent:m||this._injector,providers:_}),d.componentFactoryResolver);return n.attach(S).instance}_attachDialogContent(n,s,d,m){if(n instanceof Mo){let _=this._createInjector(m,s,d,void 0),w={$implicit:m.data,dialogRef:s};m.templateContext&&(w=qt(qt({},w),typeof m.templateContext=="function"?m.templateContext():m.templateContext)),d.attachTemplatePortal(new Ns(n,null,w,_))}else{let _=this._createInjector(m,s,d,this._injector),w=d.attachComponentPortal(new ns(n,m.viewContainerRef,_,m.componentFactoryResolver));s.componentRef=w,s.componentInstance=w.instance}}_createInjector(n,s,d,m){let _=n.injector||n.viewContainerRef?.injector,w=[{provide:uJ,useValue:n.data},{provide:bg,useValue:s}];return n.providers&&(typeof n.providers=="function"?w.push(...n.providers(s,n,d)):w.push(...n.providers)),n.direction&&(!_||!_.get(Ao,null,{optional:!0}))&&w.push({provide:Ao,useValue:{value:n.direction,change:Fe()}}),mo.create({parent:_||m,providers:w})}_removeOpenDialog(n,s){let d=this.openDialogs.indexOf(n);d>-1&&(this.openDialogs.splice(d,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((m,_)=>{m?_.setAttribute("aria-hidden",m):_.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),s&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){let n=this._overlayContainer.getContainerElement();if(n.parentElement){let s=n.parentElement.children;for(let d=s.length-1;d>-1;d--){let m=s[d];m!==n&&m.nodeName!=="SCRIPT"&&m.nodeName!=="STYLE"&&!m.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(m,m.getAttribute("aria-hidden")),m.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){let n=this._parentDialog;return n?n._getAfterAllClosed():this._afterAllClosedAtThisLevel}};r.\u0275fac=function(s){return new(s||r)(ht(Zn),ht(mo),ht(hJ,8),ht(r,12),ht(wm),ht(dJ))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function DM(a,r){let l=a.length;for(;l--;)r(a[l])}function pJ(a,r){}var xg=class{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.delayFocusTrap=!0,this.closeOnNavigation=!0}},IM="mdc-dialog--open",VN="mdc-dialog--opening",jN="mdc-dialog--closing",fJ=150,gJ=75,_J=(()=>{let r=class r extends TM{constructor(n,s,d,m,_,w,S,I,L){super(n,s,d,m,_,w,S,L),this._animationMode=I,this._animationStateChanged=new ye,this._animationsEnabled=this._animationMode!=="NoopAnimations",this._actionSectionCount=0,this._hostElement=this._elementRef.nativeElement,this._enterAnimationDuration=this._animationsEnabled?HN(this._config.enterAnimationDuration)??fJ:0,this._exitAnimationDuration=this._animationsEnabled?HN(this._config.exitAnimationDuration)??gJ:0,this._animationTimer=null,this._finishDialogOpen=()=>{this._clearAnimationClasses(),this._openAnimationDone(this._enterAnimationDuration)},this._finishDialogClose=()=>{this._clearAnimationClasses(),this._animationStateChanged.emit({state:"closed",totalTime:this._exitAnimationDuration})}}_contentAttached(){super._contentAttached(),this._startOpenAnimation()}_startOpenAnimation(){this._animationStateChanged.emit({state:"opening",totalTime:this._enterAnimationDuration}),this._animationsEnabled?(this._hostElement.style.setProperty(UN,`${this._enterAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(VN,IM)),this._waitForAnimationToComplete(this._enterAnimationDuration,this._finishDialogOpen)):(this._hostElement.classList.add(IM),Promise.resolve().then(()=>this._finishDialogOpen()))}_startExitAnimation(){this._animationStateChanged.emit({state:"closing",totalTime:this._exitAnimationDuration}),this._hostElement.classList.remove(IM),this._animationsEnabled?(this._hostElement.style.setProperty(UN,`${this._exitAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(jN)),this._waitForAnimationToComplete(this._exitAnimationDuration,this._finishDialogClose)):Promise.resolve().then(()=>this._finishDialogClose())}_updateActionSectionCount(n){this._actionSectionCount+=n,this._changeDetectorRef.markForCheck()}_clearAnimationClasses(){this._hostElement.classList.remove(VN,jN)}_waitForAnimationToComplete(n,s){this._animationTimer!==null&&clearTimeout(this._animationTimer),this._animationTimer=setTimeout(s,n)}_requestAnimationFrame(n){this._ngZone.runOutsideAngular(()=>{typeof requestAnimationFrame=="function"?requestAnimationFrame(n):n()})}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_openAnimationDone(n){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:n})}ngOnDestroy(){super.ngOnDestroy(),this._animationTimer!==null&&clearTimeout(this._animationTimer)}attachComponentPortal(n){let s=super.attachComponentPortal(n);return s.location.nativeElement.classList.add("mat-mdc-dialog-component-host"),s}};r.\u0275fac=function(s){return new(s||r)(V(Ee),V(ug),V(ci,8),V(xg),V(dg),V(Be),V(Ic),V(Eo,8),V(Bs))},r.\u0275cmp=St({type:r,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1",1,"mat-mdc-dialog-container","mdc-dialog"],hostVars:10,hostBindings:function(s,d){s&2&&(Os("id",d._config.id),ri("aria-modal",d._config.ariaModal)("role",d._config.role)("aria-labelledby",d._config.ariaLabel?null:d._ariaLabelledByQueue[0])("aria-label",d._config.ariaLabel)("aria-describedby",d._config.ariaDescribedBy||null),li("_mat-animation-noopable",!d._animationsEnabled)("mat-mdc-dialog-container-with-actions",d._actionSectionCount>0))},standalone:!0,features:[Di,At],decls:3,vars:0,consts:[[1,"mdc-dialog__container"],[1,"mat-mdc-dialog-surface","mdc-dialog__surface"],["cdkPortalOutlet",""]],template:function(s,d){s&1&&(T(0,"div",0)(1,"div",1),ut(2,pJ,0,0,"ng-template",2),k()())},dependencies:[ul],styles:['.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-dialog,.mdc-dialog__scrim{position:fixed;top:0;left:0;align-items:center;justify-content:center;box-sizing:border-box;width:100%;height:100%}.mdc-dialog{display:none;z-index:var(--mdc-dialog-z-index, 7)}.mdc-dialog .mdc-dialog__content{padding:20px 24px 20px 24px}.mdc-dialog .mdc-dialog__surface{min-width:280px}@media(max-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:calc(100vw - 32px)}}@media(min-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:560px}}.mdc-dialog .mdc-dialog__surface{max-height:calc(100% - 32px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-width:none}@media(max-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px;width:560px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 112px)}}@media(max-width: 720px)and (min-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:560px}}@media(max-width: 720px)and (max-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:calc(100vh - 160px)}}@media(max-width: 720px)and (min-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px}}@media(max-width: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-height: 400px),(max-width: 600px),(min-width: 720px)and (max-height: 400px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{height:100%;max-height:100vh;max-width:100vw;width:100vw;border-radius:0}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{order:-1;left:-12px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__header{padding:0 16px 9px;justify-content:flex-start}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__title{margin-left:calc(16px - 2 * 12px)}}@media(min-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 400px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}.mdc-dialog.mdc-dialog__scrim--hidden .mdc-dialog__scrim{opacity:0}.mdc-dialog__scrim{opacity:0;z-index:-1}.mdc-dialog__container{display:flex;flex-direction:row;align-items:center;justify-content:space-around;box-sizing:border-box;height:100%;opacity:0;pointer-events:none}.mdc-dialog__surface{position:relative;display:flex;flex-direction:column;flex-grow:0;flex-shrink:0;box-sizing:border-box;max-width:100%;max-height:100%;pointer-events:auto;overflow-y:auto;outline:0;transform:scale(0.8)}.mdc-dialog__surface .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}[dir=rtl] .mdc-dialog__surface,.mdc-dialog__surface[dir=rtl]{text-align:right}@media screen and (forced-colors: active),(-ms-high-contrast: active){.mdc-dialog__surface{outline:2px solid windowText}}.mdc-dialog__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:2px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-dialog__surface::before{border-color:CanvasText}}@media screen and (-ms-high-contrast: active),screen and (-ms-high-contrast: none){.mdc-dialog__surface::before{content:none}}.mdc-dialog__title{display:block;margin-top:0;position:relative;flex-shrink:0;box-sizing:border-box;margin:0 0 1px;padding:0 24px 9px}.mdc-dialog__title::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}[dir=rtl] .mdc-dialog__title,.mdc-dialog__title[dir=rtl]{text-align:right}.mdc-dialog--scrollable .mdc-dialog__title{margin-bottom:1px;padding-bottom:15px}.mdc-dialog--fullscreen .mdc-dialog__header{align-items:baseline;border-bottom:1px solid rgba(0,0,0,0);display:inline-flex;justify-content:space-between;padding:0 24px 9px;z-index:1}@media screen and (forced-colors: active){.mdc-dialog--fullscreen .mdc-dialog__header{border-bottom-color:CanvasText}}.mdc-dialog--fullscreen .mdc-dialog__header .mdc-dialog__close{right:-12px}.mdc-dialog--fullscreen .mdc-dialog__title{margin-bottom:0;padding:0;border-bottom:0}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__title{border-bottom:0;margin-bottom:0}.mdc-dialog--fullscreen .mdc-dialog__close{top:5px}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--fullscreen--titleless .mdc-dialog__close{margin-top:4px}.mdc-dialog--fullscreen--titleless.mdc-dialog--scrollable .mdc-dialog__close{margin-top:0}.mdc-dialog__content{flex-grow:1;box-sizing:border-box;margin:0;overflow:auto}.mdc-dialog__content>:first-child{margin-top:0}.mdc-dialog__content>:last-child{margin-bottom:0}.mdc-dialog__title+.mdc-dialog__content,.mdc-dialog__header+.mdc-dialog__content{padding-top:0}.mdc-dialog--scrollable .mdc-dialog__title+.mdc-dialog__content{padding-top:8px;padding-bottom:8px}.mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:6px 0 0}.mdc-dialog--scrollable .mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:0}.mdc-dialog__actions{display:flex;position:relative;flex-shrink:0;flex-wrap:wrap;align-items:center;justify-content:flex-end;box-sizing:border-box;min-height:52px;margin:0;padding:8px;border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--stacked .mdc-dialog__actions{flex-direction:column;align-items:flex-end}.mdc-dialog__button{margin-left:8px;margin-right:0;max-width:100%;text-align:right}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{margin-left:0;margin-right:8px}.mdc-dialog__button:first-child{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button:first-child,.mdc-dialog__button:first-child[dir=rtl]{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{text-align:left}.mdc-dialog--stacked .mdc-dialog__button:not(:first-child){margin-top:12px}.mdc-dialog--open,.mdc-dialog--opening,.mdc-dialog--closing{display:flex}.mdc-dialog--opening .mdc-dialog__scrim{transition:opacity 150ms linear}.mdc-dialog--opening .mdc-dialog__container{transition:opacity 75ms linear,transform 150ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-dialog--closing .mdc-dialog__scrim,.mdc-dialog--closing .mdc-dialog__container{transition:opacity 75ms linear}.mdc-dialog--closing .mdc-dialog__container{transform:none}.mdc-dialog--closing .mdc-dialog__surface{transform:none}.mdc-dialog--open .mdc-dialog__scrim{opacity:1}.mdc-dialog--open .mdc-dialog__container{opacity:1}.mdc-dialog--open .mdc-dialog__surface{transform:none}.mdc-dialog--open.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim{opacity:1}.mdc-dialog--open.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{transition:opacity 75ms linear}.mdc-dialog--open.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim{transition:opacity 150ms linear}.mdc-dialog__surface-scrim{display:none;opacity:0;position:absolute;width:100%;height:100%;z-index:1}.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{display:block}.mdc-dialog-scroll-lock{overflow:hidden}.mdc-dialog--no-content-padding .mdc-dialog__content{padding:0}.mdc-dialog--sheet .mdc-dialog__container .mdc-dialog__close{right:12px;top:9px;position:absolute;z-index:1}.mdc-dialog__scrim--removed{pointer-events:none}.mdc-dialog__scrim--removed .mdc-dialog__scrim,.mdc-dialog__scrim--removed .mdc-dialog__surface-scrim{display:none}.mat-mdc-dialog-content{max-height:65vh}.mat-mdc-dialog-container{position:static;display:block}.mat-mdc-dialog-container,.mat-mdc-dialog-container .mdc-dialog__container,.mat-mdc-dialog-container .mdc-dialog__surface{max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit}.mat-mdc-dialog-container .mdc-dialog__surface{width:100%;height:100%}.mat-mdc-dialog-component-host{display:contents}.mat-mdc-dialog-container{--mdc-dialog-container-elevation: var(--mdc-dialog-container-elevation-shadow);outline:0}.mat-mdc-dialog-container .mdc-dialog__surface{background-color:var(--mdc-dialog-container-color, white)}.mat-mdc-dialog-container .mdc-dialog__surface{box-shadow:var(--mdc-dialog-container-elevation, 0px 11px 15px -7px rgba(0, 0, 0, 0.2), 0px 24px 38px 3px rgba(0, 0, 0, 0.14), 0px 9px 46px 8px rgba(0, 0, 0, 0.12))}.mat-mdc-dialog-container .mdc-dialog__surface{border-radius:var(--mdc-dialog-container-shape, 4px)}.mat-mdc-dialog-container .mdc-dialog__title{font-family:var(--mdc-dialog-subhead-font, Roboto, sans-serif);line-height:var(--mdc-dialog-subhead-line-height, 1.5rem);font-size:var(--mdc-dialog-subhead-size, 1rem);font-weight:var(--mdc-dialog-subhead-weight, 400);letter-spacing:var(--mdc-dialog-subhead-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__title{color:var(--mdc-dialog-subhead-color, rgba(0, 0, 0, 0.87))}.mat-mdc-dialog-container .mdc-dialog__content{font-family:var(--mdc-dialog-supporting-text-font, Roboto, sans-serif);line-height:var(--mdc-dialog-supporting-text-line-height, 1.5rem);font-size:var(--mdc-dialog-supporting-text-size, 1rem);font-weight:var(--mdc-dialog-supporting-text-weight, 400);letter-spacing:var(--mdc-dialog-supporting-text-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__content{color:var(--mdc-dialog-supporting-text-color, rgba(0, 0, 0, 0.6))}.mat-mdc-dialog-container .mdc-dialog__container{transition:opacity linear var(--mat-dialog-transition-duration, 0ms)}.mat-mdc-dialog-container .mdc-dialog__surface{transition:transform var(--mat-dialog-transition-duration, 0ms) 0ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-dialog-container._mat-animation-noopable .mdc-dialog__container,.mat-mdc-dialog-container._mat-animation-noopable .mdc-dialog__surface{transition:none}.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-max-width, 80vw);min-width:var(--mat-dialog-container-min-width, 0)}@media(max-width: 599px){.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-small-max-width, 80vw)}}.mat-mdc-dialog-title{padding:var(--mat-dialog-headline-padding, 0 24px 9px)}.mat-mdc-dialog-content{display:block}.mat-mdc-dialog-container .mat-mdc-dialog-content{padding:var(--mat-dialog-content-padding, 20px 24px)}.mat-mdc-dialog-container-with-actions .mat-mdc-dialog-content{padding:var(--mat-dialog-with-actions-content-padding, 20px 24px)}.mat-mdc-dialog-container .mat-mdc-dialog-title+.mat-mdc-dialog-content{padding-top:0}.mat-mdc-dialog-actions{padding:var(--mat-dialog-actions-padding, 8px);justify-content:var(--mat-dialog-actions-alignment, start)}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-start,.mat-mdc-dialog-actions[align=start]{justify-content:start}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-center,.mat-mdc-dialog-actions[align=center]{justify-content:center}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-end,.mat-mdc-dialog-actions[align=end]{justify-content:flex-end}.mat-mdc-dialog-actions .mat-button-base+.mat-button-base,.mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-mdc-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}'],encapsulation:2});let a=r;return a})(),UN="--mat-dialog-transition-duration";function HN(a){return a==null?null:typeof a=="number"?a:a.endsWith("ms")?Hl(a.substring(0,a.length-2)):a.endsWith("s")?Hl(a.substring(0,a.length-1))*1e3:a==="0"?0:null}var $y=function(a){return a[a.OPEN=0]="OPEN",a[a.CLOSING=1]="CLOSING",a[a.CLOSED=2]="CLOSED",a}($y||{}),er=class{constructor(r,l,n){this._ref=r,this._containerInstance=n,this._afterOpened=new pe,this._beforeClosed=new pe,this._state=$y.OPEN,this.disableClose=l.disableClose,this.id=r.id,r.addPanelClass("mat-mdc-dialog-panel"),n._animationStateChanged.pipe(pn(s=>s.state==="opened"),tn(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),n._animationStateChanged.pipe(pn(s=>s.state==="closed"),tn(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),r.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),no(this.backdropClick(),this.keydownEvents().pipe(pn(s=>s.keyCode===27&&!this.disableClose&&!Zr(s)))).subscribe(s=>{this.disableClose||(s.preventDefault(),vJ(this,s.type==="keydown"?"keyboard":"mouse"))})}close(r){this._result=r,this._containerInstance._animationStateChanged.pipe(pn(l=>l.state==="closing"),tn(1)).subscribe(l=>{this._beforeClosed.next(r),this._beforeClosed.complete(),this._ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),l.totalTime+100)}),this._state=$y.CLOSING,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}updatePosition(r){let l=this._ref.config.positionStrategy;return r&&(r.left||r.right)?r.left?l.left(r.left):l.right(r.right):l.centerHorizontally(),r&&(r.top||r.bottom)?r.top?l.top(r.top):l.bottom(r.bottom):l.centerVertically(),this._ref.updatePosition(),this}updateSize(r="",l=""){return this._ref.updateSize(r,l),this}addPanelClass(r){return this._ref.addPanelClass(r),this}removePanelClass(r){return this._ref.removePanelClass(r),this}getState(){return this._state}_finishDialogClose(){this._state=$y.CLOSED,this._ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}};function vJ(a,r,l){return a._closeInteractionType=r,a.close(l)}var jr=new Se("MatMdcDialogData"),yJ=new Se("mat-mdc-dialog-default-options"),bJ=new Se("mat-mdc-dialog-scroll-strategy",{providedIn:"root",factory:()=>{let a=le(Zn);return()=>a.scrollStrategies.block()}});var xJ=0,Kr=(()=>{let r=class r{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){let n=this._parentDialog;return n?n._getAfterAllClosed():this._afterAllClosedAtThisLevel}constructor(n,s,d,m,_,w,S,I){this._overlay=n,this._defaultOptions=m,this._scrollStrategy=_,this._parentDialog=w,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new pe,this._afterOpenedAtThisLevel=new pe,this.dialogConfigClass=xg,this.afterAllClosed=wc(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(ho(void 0))),this._dialog=s.get(BN),this._dialogRefConstructor=er,this._dialogContainerType=_J,this._dialogDataToken=jr}open(n,s){let d;s=qt(qt({},this._defaultOptions||new xg),s),s.id=s.id||`mat-mdc-dialog-${xJ++}`,s.scrollStrategy=s.scrollStrategy||this._scrollStrategy();let m=this._dialog.open(n,Pi(qt({},s),{positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,closeOnOverlayDetachments:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:this.dialogConfigClass,useValue:s},{provide:Lu,useValue:s}]},templateContext:()=>({dialogRef:d}),providers:(_,w,S)=>(d=new this._dialogRefConstructor(_,s,S),d.updatePosition(s?.position),[{provide:this._dialogContainerType,useValue:S},{provide:this._dialogDataToken,useValue:w.data},{provide:this._dialogRefConstructor,useValue:d}])}));return d.componentRef=m.componentRef,d.componentInstance=m.componentInstance,this.openDialogs.push(d),this.afterOpened.next(d),d.afterClosed().subscribe(()=>{let _=this.openDialogs.indexOf(d);_>-1&&(this.openDialogs.splice(_,1),this.openDialogs.length||this._getAfterAllClosed().next())}),d}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(n){return this.openDialogs.find(s=>s.id===n)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(n){let s=n.length;for(;s--;)n[s].close()}};r.\u0275fac=function(s){return new(s||r)(ht(Zn),ht(mo),ht(Bl,8),ht(yJ,8),ht(bJ),ht(r,12),ht(wm),ht(Eo,8))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function wJ(a,r){a&1&&(T(0,"div",17),dt(1,"i",18),k())}var CJ=(a,r)=>({selected:a,disabled:r});function SJ(a,r){if(a&1){let l=we();T(0,"div",11),ct("click",function(){let d=Kt(l).$implicit,m=gt();return Qt(m.onCardClick(d))}),dt(1,"img",12),T(2,"div",13)(3,"h5",14),B(4),k(),T(5,"p",15),B(6),k()(),ut(7,wJ,2,0,"div",16),k()}if(a&2){let l=r.$implicit;W("ngClass",Jh(6,CJ,l.toBeSelected,l.selected)),z(),W("src",l.imageUrl,Vr),z(3),Te(l.title),z(2),po("",l.location.name," | ",l.date,""),z(),W("ngIf",l.toBeSelected||l.selected)}}var GN=(()=>{let r=class r{constructor(n,s){this.homeAdminService=n,this.dialogRef=s,this.eventList=[],this.filteredEventList=[],this.searchText=""}ngOnInit(){return Tt(this,null,function*(){yield this.homeAdminService.fetchEventListForSelection(),this.eventListSubscription=this.homeAdminService.getEventListForSelection().subscribe(n=>{this.eventList=n,this.filteredEventList=n})})}ngOnDestroy(){this.eventListSubscription?.unsubscribe()}searchEvent(){this.filteredEventList=this.eventList.filter(n=>n.title.toLowerCase().includes(this.searchText.toLowerCase()))}onConfirmClick(){let n=this.eventList.filter(s=>s.toBeSelected).map(s=>s.id);this.dialogRef.close(n)}onCardClick(n){(n.selected===null||n.selected===!1)&&(n.toBeSelected=!n.toBeSelected)}onCloseClick(){this.dialogRef.close()}};r.\u0275fac=function(s){return new(s||r)(V(Wy),V(er))},r.\u0275cmp=St({type:r,selectors:[["app-add-top-event"]],standalone:!0,features:[At],decls:14,vars:2,consts:[[1,"container-fluid"],[1,"input-group","rounded","pt-2"],["type","search","placeholder","Cauta","aria-label","Search","aria-describedby","search-addon",1,"form-control","rounded",3,"ngModel","ngModelChange"],["id","search-addon",1,"input-group-text","border-0"],[1,"fas","fa-search"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"text-center","mb-2","mt-2"],[1,"cards-container"],["class","card",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"btn","btn-danger","mt-2","mb-4","me-3",3,"click"],[1,"btn","btn-primary","mt-2","mb-4",3,"click"],[1,"card",3,"ngClass","click"],["alt","...",1,"card-img-top",3,"src"],[1,"card-body"],[1,"card-title"],[1,"card-text"],["class","icon-container",4,"ngIf"],[1,"icon-container"],[1,"fa-solid","fa-check","fa-lg"]],template:function(s,d){s&1&&(T(0,"div",0)(1,"div",1)(2,"input",2),Cn("ngModelChange",function(_){return wn(d.searchText,_)||(d.searchText=_),_}),ct("ngModelChange",function(){return d.searchEvent()}),k(),T(3,"span",3),dt(4,"i",4),k(),T(5,"button",5),ct("click",function(){return d.onCloseClick()}),k()(),T(6,"h1",6),B(7,"Evenimente"),k(),T(8,"div",7),ut(9,SJ,8,9,"div",8),k(),T(10,"button",9),ct("click",function(){return d.onCloseClick()}),B(11,"Anuleaza"),k(),T(12,"button",10),ct("click",function(){return d.onConfirmClick()}),B(13,"Adauga"),k()()),s&2&&(z(2),xn("ngModel",d.searchText),z(7),W("ngForOf",d.filteredEventList))},dependencies:[Ni,en,qi,To,pi,Uo,Ve],styles:[".cards-container[_ngcontent-%COMP%]{max-height:500px;overflow-y:auto}.card[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 2fr 1fr;border:1px solid #ccc;margin:10px;cursor:pointer}.card[_ngcontent-%COMP%]:hover{background-color:#f4f4f4;box-shadow:0 0 10px #0000001a}.card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:100%;object-fit:contain}.selected[_ngcontent-%COMP%]{opacity:70%}.icon-container[_ngcontent-%COMP%]{display:flex;justify-content:right;align-items:flex-end}i[_ngcontent-%COMP%]{margin:15px}.disabled[_ngcontent-%COMP%]{cursor:not-allowed}"]});let a=r;return a})();function EJ(a,r){if(a&1){let l=we();T(0,"div",4)(1,"button",5),ct("click",function(){let d=Kt(l).$implicit,m=gt();return Qt(m.deleteTopEvent(d))}),dt(2,"i",6),k(),dt(3,"img",7),T(4,"div",8)(5,"h5",9),B(6),k(),T(7,"p",10),B(8),k()()()}if(a&2){let l=r.$implicit;z(3),Js("src",l.imageUrl,Vr),z(3),Te(l.title),z(2),po("",l.location.name," | ",l.date,"")}}var qN=(()=>{let r=class r{constructor(n,s,d){this.homeAdminService=n,this.snackBar=s,this.dialog=d,this.selectedEventList=[]}ngOnInit(){return Tt(this,null,function*(){yield this.homeAdminService.fetchSelectedEvents(),this.selectedEventListSubscription=this.homeAdminService.getSelectedEventList().subscribe(n=>{this.selectedEventList=n})})}ngOnDestroy(){this.selectedEventListSubscription?.unsubscribe()}addTopEvent(){this.dialog.open(GN,{width:"60%"}).afterClosed().subscribe(s=>Tt(this,null,function*(){s.length>0&&(yield this.homeAdminService.addSelectedEventList(s))}))}deleteTopEvent(n){return Tt(this,null,function*(){yield this.homeAdminService.deleteSelectedEvent(n.id)})}};r.\u0275fac=function(s){return new(s||r)(V(Wy),V(Je),V(Kr))},r.\u0275cmp=St({type:r,selectors:[["app-home-admin"]],standalone:!0,features:[At],decls:7,vars:1,consts:[[1,"container-fluid"],["id","btnAddEvent",1,"btn","btn-primary",3,"click"],[1,"cards-container"],["class","card",4,"ngFor","ngForOf"],[1,"card"],[1,"btn","btn-danger","btn-delete",3,"click"],[1,"fa","fa-x"],["alt","",1,"card-img-top",3,"src"],[1,"card-body"],[1,"card-title"],[1,"card-text"]],template:function(s,d){s&1&&(T(0,"div",0)(1,"h1"),B(2,"Recommended events"),k(),T(3,"button",1),ct("click",function(){return d.addTopEvent()}),B(4,"Add event"),k(),T(5,"div",2),ut(6,EJ,9,4,"div",3),k()()),s&2&&(z(6),W("ngForOf",d.selectedEventList))},dependencies:[pi],styles:[".cards-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;flex-wrap:wrap;margin-top:50px}.card[_ngcontent-%COMP%]{margin:20px;padding:20px;border-radius:10px;box-shadow:0 4px 8px #0003;transition:.3s;background-color:#f5f5f5;color:#000;text-align:center;font-size:20px;font-weight:700;width:300px}.btn-delete[_ngcontent-%COMP%]{width:30px;height:28px;padding:0;position:absolute;top:0;right:0;opacity:0;transition:opacity .5s ease}.card[_ngcontent-%COMP%]:hover   .btn-delete[_ngcontent-%COMP%]{opacity:1}"]});let a=r;return a})();function $l(){}var sB=function(){let a=0;return function(){return a++}}();function zn(a){return a===null||typeof a>"u"}function Rr(a){if(Array.isArray&&Array.isArray(a))return!0;let r=Object.prototype.toString.call(a);return r.slice(0,7)==="[object"&&r.slice(-6)==="Array]"}function In(a){return a!==null&&Object.prototype.toString.call(a)==="[object Object]"}var _o=a=>(typeof a=="number"||a instanceof Number)&&isFinite(+a);function na(a,r){return _o(a)?a:r}function nn(a,r){return typeof a>"u"?r:a}var aB=(a,r)=>typeof a=="string"&&a.endsWith("%")?parseFloat(a)/100:a/r,zM=(a,r)=>typeof a=="string"&&a.endsWith("%")?parseFloat(a)/100*r:+a;function Pr(a,r,l){if(a&&typeof a.call=="function")return a.apply(l,r)}function lr(a,r,l,n){let s,d,m;if(Rr(a))if(d=a.length,n)for(s=d-1;s>=0;s--)r.call(l,a[s],s);else for(s=0;s<d;s++)r.call(l,a[s],s);else if(In(a))for(m=Object.keys(a),d=m.length,s=0;s<d;s++)r.call(l,a[m[s]],m[s])}function Mg(a,r){let l,n,s,d;if(!a||!r||a.length!==r.length)return!1;for(l=0,n=a.length;l<n;++l)if(s=a[l],d=r[l],s.datasetIndex!==d.datasetIndex||s.index!==d.index)return!1;return!0}function Jy(a){if(Rr(a))return a.map(Jy);if(In(a)){let r=Object.create(null),l=Object.keys(a),n=l.length,s=0;for(;s<n;++s)r[l[s]]=Jy(a[l[s]]);return r}return a}function lB(a){return["__proto__","prototype","constructor"].indexOf(a)===-1}function MJ(a,r,l,n){if(!lB(a))return;let s=r[a],d=l[a];In(s)&&In(d)?Pm(s,d,n):r[a]=Jy(d)}function Pm(a,r,l){let n=Rr(r)?r:[r],s=n.length;if(!In(a))return a;l=l||{};let d=l.merger||MJ;for(let m=0;m<s;++m){if(r=n[m],!In(r))continue;let _=Object.keys(r);for(let w=0,S=_.length;w<S;++w)d(_[w],a,r,l)}return a}function Lm(a,r){return Pm(a,r,{merger:DJ})}function DJ(a,r,l){if(!lB(a))return;let n=r[a],s=l[a];In(n)&&In(s)?Lm(n,s):Object.prototype.hasOwnProperty.call(r,a)||(r[a]=Jy(s))}var WN={"":a=>a,x:a=>a.x,y:a=>a.y};function Oc(a,r){return(WN[r]||(WN[r]=TJ(r)))(a)}function TJ(a){let r=IJ(a);return l=>{for(let n of r){if(n==="")break;l=l&&l[n]}return l}}function IJ(a){let r=a.split("."),l=[],n="";for(let s of r)n+=s,n.endsWith("\\")?n=n.slice(0,-1)+".":(l.push(n),n="");return l}function nb(a){return a.charAt(0).toUpperCase()+a.slice(1)}var ia=a=>typeof a<"u",Pc=a=>typeof a=="function",NM=(a,r)=>{if(a.size!==r.size)return!1;for(let l of a)if(!r.has(l))return!1;return!0};function cB(a){return a.type==="mouseup"||a.type==="click"||a.type==="contextmenu"}var Ur=Math.PI,mr=2*Ur,AJ=mr+Ur,tb=Number.POSITIVE_INFINITY,kJ=Ur/180,co=Ur/2,wg=Ur/4,$N=Ur*2/3,ra=Math.log10,_l=Math.sign;function BM(a){let r=Math.round(a);a=zm(a,r,a/1e3)?r:a;let l=Math.pow(10,Math.floor(ra(a))),n=a/l;return(n<=1?1:n<=2?2:n<=5?5:10)*l}function dB(a){let r=[],l=Math.sqrt(a),n;for(n=1;n<l;n++)a%n===0&&(r.push(n),r.push(a/n));return l===(l|0)&&r.push(l),r.sort((s,d)=>s-d).pop(),r}function Bu(a){return!isNaN(parseFloat(a))&&isFinite(a)}function zm(a,r,l){return Math.abs(a-r)<l}function uB(a,r){let l=Math.round(a);return l-r<=a&&l+r>=a}function VM(a,r,l){let n,s,d;for(n=0,s=a.length;n<s;n++)d=a[n][l],isNaN(d)||(r.min=Math.min(r.min,d),r.max=Math.max(r.max,d))}function Aa(a){return a*(Ur/180)}function rb(a){return a*(180/Ur)}function jM(a){if(!_o(a))return;let r=1,l=0;for(;Math.round(a*r)/r!==a;)r*=10,l++;return l}function UM(a,r){let l=r.x-a.x,n=r.y-a.y,s=Math.sqrt(l*l+n*n),d=Math.atan2(n,l);return d<-.5*Ur&&(d+=mr),{angle:d,distance:s}}function eb(a,r){return Math.sqrt(Math.pow(r.x-a.x,2)+Math.pow(r.y-a.y,2))}function RJ(a,r){return(a-r+AJ)%mr-Ur}function Us(a){return(a%mr+mr)%mr}function Nm(a,r,l,n){let s=Us(a),d=Us(r),m=Us(l),_=Us(d-s),w=Us(m-s),S=Us(s-d),I=Us(s-m);return s===d||s===m||n&&d===m||_>w&&S<I}function Ho(a,r,l){return Math.max(r,Math.min(l,a))}function hB(a){return Ho(a,-32768,32767)}function Yl(a,r,l,n=1e-6){return a>=Math.min(r,l)-n&&a<=Math.max(r,l)+n}function ob(a,r,l){l=l||(m=>a[m]<r);let n=a.length-1,s=0,d;for(;n-s>1;)d=s+n>>1,l(d)?s=d:n=d;return{lo:s,hi:n}}var Wl=(a,r,l,n)=>ob(a,l,n?s=>a[s][r]<=l:s=>a[s][r]<l),mB=(a,r,l)=>ob(a,l,n=>a[n][r]>=l);function pB(a,r,l){let n=0,s=a.length;for(;n<s&&a[n]<r;)n++;for(;s>n&&a[s-1]>l;)s--;return n>0||s<a.length?a.slice(n,s):a}var fB=["push","pop","shift","splice","unshift"];function gB(a,r){if(a._chartjs){a._chartjs.listeners.push(r);return}Object.defineProperty(a,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[r]}}),fB.forEach(l=>{let n="_onData"+nb(l),s=a[l];Object.defineProperty(a,l,{configurable:!0,enumerable:!1,value(...d){let m=s.apply(this,d);return a._chartjs.listeners.forEach(_=>{typeof _[n]=="function"&&_[n](...d)}),m}})})}function HM(a,r){let l=a._chartjs;if(!l)return;let n=l.listeners,s=n.indexOf(r);s!==-1&&n.splice(s,1),!(n.length>0)&&(fB.forEach(d=>{delete a[d]}),delete a._chartjs)}function GM(a){let r=new Set,l,n;for(l=0,n=a.length;l<n;++l)r.add(a[l]);return r.size===n?a:Array.from(r)}var qM=function(){return typeof window>"u"?function(a){return a()}:window.requestAnimationFrame}();function WM(a,r,l){let n=l||(m=>Array.prototype.slice.call(m)),s=!1,d=[];return function(...m){d=n(m),s||(s=!0,qM.call(window,()=>{s=!1,a.apply(r,d)}))}}function _B(a,r){let l;return function(...n){return r?(clearTimeout(l),l=setTimeout(a,r,n)):a.apply(this,n),r}}var sb=a=>a==="start"?"left":a==="end"?"right":"center",Jo=(a,r,l)=>a==="start"?r:a==="end"?l:(r+l)/2,vB=(a,r,l,n)=>a===(n?"left":"right")?l:a==="center"?(r+l)/2:r;function $M(a,r,l){let n=r.length,s=0,d=n;if(a._sorted){let{iScale:m,_parsed:_}=a,w=m.axis,{min:S,max:I,minDefined:L,maxDefined:H}=m.getUserBounds();L&&(s=Ho(Math.min(Wl(_,m.axis,S).lo,l?n:Wl(r,w,m.getPixelForValue(S)).lo),0,n-1)),H?d=Ho(Math.max(Wl(_,m.axis,I,!0).hi+1,l?0:Wl(r,w,m.getPixelForValue(I),!0).hi+1),s,n)-s:d=n-s}return{start:s,count:d}}function YM(a){let{xScale:r,yScale:l,_scaleRanges:n}=a,s={xmin:r.min,xmax:r.max,ymin:l.min,ymax:l.max};if(!n)return a._scaleRanges=s,!0;let d=n.xmin!==r.min||n.xmax!==r.max||n.ymin!==l.min||n.ymax!==l.max;return Object.assign(n,s),d}var Yy=a=>a===0||a===1,YN=(a,r,l)=>-(Math.pow(2,10*(a-=1))*Math.sin((a-r)*mr/l)),ZN=(a,r,l)=>Math.pow(2,-10*a)*Math.sin((a-r)*mr/l)+1,Rm={linear:a=>a,easeInQuad:a=>a*a,easeOutQuad:a=>-a*(a-2),easeInOutQuad:a=>(a/=.5)<1?.5*a*a:-.5*(--a*(a-2)-1),easeInCubic:a=>a*a*a,easeOutCubic:a=>(a-=1)*a*a+1,easeInOutCubic:a=>(a/=.5)<1?.5*a*a*a:.5*((a-=2)*a*a+2),easeInQuart:a=>a*a*a*a,easeOutQuart:a=>-((a-=1)*a*a*a-1),easeInOutQuart:a=>(a/=.5)<1?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2),easeInQuint:a=>a*a*a*a*a,easeOutQuint:a=>(a-=1)*a*a*a*a+1,easeInOutQuint:a=>(a/=.5)<1?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2),easeInSine:a=>-Math.cos(a*co)+1,easeOutSine:a=>Math.sin(a*co),easeInOutSine:a=>-.5*(Math.cos(Ur*a)-1),easeInExpo:a=>a===0?0:Math.pow(2,10*(a-1)),easeOutExpo:a=>a===1?1:-Math.pow(2,-10*a)+1,easeInOutExpo:a=>Yy(a)?a:a<.5?.5*Math.pow(2,10*(a*2-1)):.5*(-Math.pow(2,-10*(a*2-1))+2),easeInCirc:a=>a>=1?a:-(Math.sqrt(1-a*a)-1),easeOutCirc:a=>Math.sqrt(1-(a-=1)*a),easeInOutCirc:a=>(a/=.5)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1),easeInElastic:a=>Yy(a)?a:YN(a,.075,.3),easeOutElastic:a=>Yy(a)?a:ZN(a,.075,.3),easeInOutElastic(a){return Yy(a)?a:a<.5?.5*YN(a*2,.1125,.45):.5+.5*ZN(a*2-1,.1125,.45)},easeInBack(a){return a*a*((1.70158+1)*a-1.70158)},easeOutBack(a){return(a-=1)*a*((1.70158+1)*a+1.70158)+1},easeInOutBack(a){let r=1.70158;return(a/=.5)<1?.5*(a*a*(((r*=1.525)+1)*a-r)):.5*((a-=2)*a*(((r*=1.525)+1)*a+r)+2)},easeInBounce:a=>1-Rm.easeOutBounce(1-a),easeOutBounce(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},easeInOutBounce:a=>a<.5?Rm.easeInBounce(a*2)*.5:Rm.easeOutBounce(a*2-1)*.5+.5};function Dg(a){return a+.5|0}var Dd=(a,r,l)=>Math.max(Math.min(a,l),r);function Cg(a){return Dd(Dg(a*2.55),0,255)}function Td(a){return Dd(Dg(a*255),0,255)}function Rc(a){return Dd(Dg(a/2.55)/100,0,1)}function XN(a){return Dd(Dg(a*100),0,100)}var Ia={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},OM=[..."0123456789ABCDEF"],PJ=a=>OM[a&15],OJ=a=>OM[(a&240)>>4]+OM[a&15],Zy=a=>(a&240)>>4===(a&15),FJ=a=>Zy(a.r)&&Zy(a.g)&&Zy(a.b)&&Zy(a.a);function LJ(a){var r=a.length,l;return a[0]==="#"&&(r===4||r===5?l={r:255&Ia[a[1]]*17,g:255&Ia[a[2]]*17,b:255&Ia[a[3]]*17,a:r===5?Ia[a[4]]*17:255}:(r===7||r===9)&&(l={r:Ia[a[1]]<<4|Ia[a[2]],g:Ia[a[3]]<<4|Ia[a[4]],b:Ia[a[5]]<<4|Ia[a[6]],a:r===9?Ia[a[7]]<<4|Ia[a[8]]:255})),l}var zJ=(a,r)=>a<255?r(a):"";function NJ(a){var r=FJ(a)?PJ:OJ;return a?"#"+r(a.r)+r(a.g)+r(a.b)+zJ(a.a,r):void 0}var BJ=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function yB(a,r,l){let n=r*Math.min(l,1-l),s=(d,m=(d+a/30)%12)=>l-n*Math.max(Math.min(m-3,9-m,1),-1);return[s(0),s(8),s(4)]}function VJ(a,r,l){let n=(s,d=(s+a/60)%6)=>l-l*r*Math.max(Math.min(d,4-d,1),0);return[n(5),n(3),n(1)]}function jJ(a,r,l){let n=yB(a,1,.5),s;for(r+l>1&&(s=1/(r+l),r*=s,l*=s),s=0;s<3;s++)n[s]*=1-r-l,n[s]+=r;return n}function UJ(a,r,l,n,s){return a===s?(r-l)/n+(r<l?6:0):r===s?(l-a)/n+2:(a-r)/n+4}function ZM(a){let l=a.r/255,n=a.g/255,s=a.b/255,d=Math.max(l,n,s),m=Math.min(l,n,s),_=(d+m)/2,w,S,I;return d!==m&&(I=d-m,S=_>.5?I/(2-d-m):I/(d+m),w=UJ(l,n,s,I,d),w=w*60+.5),[w|0,S||0,_]}function XM(a,r,l,n){return(Array.isArray(r)?a(r[0],r[1],r[2]):a(r,l,n)).map(Td)}function KM(a,r,l){return XM(yB,a,r,l)}function HJ(a,r,l){return XM(jJ,a,r,l)}function GJ(a,r,l){return XM(VJ,a,r,l)}function bB(a){return(a%360+360)%360}function qJ(a){let r=BJ.exec(a),l=255,n;if(!r)return;r[5]!==n&&(l=r[6]?Cg(+r[5]):Td(+r[5]));let s=bB(+r[2]),d=+r[3]/100,m=+r[4]/100;return r[1]==="hwb"?n=HJ(s,d,m):r[1]==="hsv"?n=GJ(s,d,m):n=KM(s,d,m),{r:n[0],g:n[1],b:n[2],a:l}}function WJ(a,r){var l=ZM(a);l[0]=bB(l[0]+r),l=KM(l),a.r=l[0],a.g=l[1],a.b=l[2]}function $J(a){if(!a)return;let r=ZM(a),l=r[0],n=XN(r[1]),s=XN(r[2]);return a.a<255?`hsla(${l}, ${n}%, ${s}%, ${Rc(a.a)})`:`hsl(${l}, ${n}%, ${s}%)`}var KN={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},QN={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function YJ(){let a={},r=Object.keys(QN),l=Object.keys(KN),n,s,d,m,_;for(n=0;n<r.length;n++){for(m=_=r[n],s=0;s<l.length;s++)d=l[s],_=_.replace(d,KN[d]);d=parseInt(QN[m],16),a[_]=[d>>16&255,d>>8&255,d&255]}return a}var Xy;function ZJ(a){Xy||(Xy=YJ(),Xy.transparent=[0,0,0,0]);let r=Xy[a.toLowerCase()];return r&&{r:r[0],g:r[1],b:r[2],a:r.length===4?r[3]:255}}var XJ=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function KJ(a){let r=XJ.exec(a),l=255,n,s,d;if(r){if(r[7]!==n){let m=+r[7];l=r[8]?Cg(m):Dd(m*255,0,255)}return n=+r[1],s=+r[3],d=+r[5],n=255&(r[2]?Cg(n):Dd(n,0,255)),s=255&(r[4]?Cg(s):Dd(s,0,255)),d=255&(r[6]?Cg(d):Dd(d,0,255)),{r:n,g:s,b:d,a:l}}}function QJ(a){return a&&(a.a<255?`rgba(${a.r}, ${a.g}, ${a.b}, ${Rc(a.a)})`:`rgb(${a.r}, ${a.g}, ${a.b})`)}var AM=a=>a<=.0031308?a*12.92:Math.pow(a,1/2.4)*1.055-.055,km=a=>a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4);function JJ(a,r,l){let n=km(Rc(a.r)),s=km(Rc(a.g)),d=km(Rc(a.b));return{r:Td(AM(n+l*(km(Rc(r.r))-n))),g:Td(AM(s+l*(km(Rc(r.g))-s))),b:Td(AM(d+l*(km(Rc(r.b))-d))),a:a.a+l*(r.a-a.a)}}function Ky(a,r,l){if(a){let n=ZM(a);n[r]=Math.max(0,Math.min(n[r]+n[r]*l,r===0?360:1)),n=KM(n),a.r=n[0],a.g=n[1],a.b=n[2]}}function xB(a,r){return a&&Object.assign(r||{},a)}function JN(a){var r={r:0,g:0,b:0,a:255};return Array.isArray(a)?a.length>=3&&(r={r:a[0],g:a[1],b:a[2],a:255},a.length>3&&(r.a=Td(a[3]))):(r=xB(a,{r:0,g:0,b:0,a:1}),r.a=Td(r.a)),r}function ttt(a){return a.charAt(0)==="r"?KJ(a):qJ(a)}var FM=class a{constructor(r){if(r instanceof a)return r;let l=typeof r,n;l==="object"?n=JN(r):l==="string"&&(n=LJ(r)||ZJ(r)||ttt(r)),this._rgb=n,this._valid=!!n}get valid(){return this._valid}get rgb(){var r=xB(this._rgb);return r&&(r.a=Rc(r.a)),r}set rgb(r){this._rgb=JN(r)}rgbString(){return this._valid?QJ(this._rgb):void 0}hexString(){return this._valid?NJ(this._rgb):void 0}hslString(){return this._valid?$J(this._rgb):void 0}mix(r,l){if(r){let n=this.rgb,s=r.rgb,d,m=l===d?.5:l,_=2*m-1,w=n.a-s.a,S=((_*w===-1?_:(_+w)/(1+_*w))+1)/2;d=1-S,n.r=255&S*n.r+d*s.r+.5,n.g=255&S*n.g+d*s.g+.5,n.b=255&S*n.b+d*s.b+.5,n.a=m*n.a+(1-m)*s.a,this.rgb=n}return this}interpolate(r,l){return r&&(this._rgb=JJ(this._rgb,r._rgb,l)),this}clone(){return new a(this.rgb)}alpha(r){return this._rgb.a=Td(r),this}clearer(r){let l=this._rgb;return l.a*=1-r,this}greyscale(){let r=this._rgb,l=Dg(r.r*.3+r.g*.59+r.b*.11);return r.r=r.g=r.b=l,this}opaquer(r){let l=this._rgb;return l.a*=1+r,this}negate(){let r=this._rgb;return r.r=255-r.r,r.g=255-r.g,r.b=255-r.b,this}lighten(r){return Ky(this._rgb,2,r),this}darken(r){return Ky(this._rgb,2,-r),this}saturate(r){return Ky(this._rgb,1,r),this}desaturate(r){return Ky(this._rgb,1,-r),this}rotate(r){return WJ(this._rgb,r),this}};function wB(a){return new FM(a)}function CB(a){if(a&&typeof a=="object"){let r=a.toString();return r==="[object CanvasPattern]"||r==="[object CanvasGradient]"}return!1}function QM(a){return CB(a)?a:wB(a)}function kM(a){return CB(a)?a:wB(a).saturate(.5).darken(.1).hexString()}var Id=Object.create(null),ab=Object.create(null);function Sg(a,r){if(!r)return a;let l=r.split(".");for(let n=0,s=l.length;n<s;++n){let d=l[n];a=a[d]||(a[d]=Object.create(null))}return a}function RM(a,r,l){return typeof r=="string"?Pm(Sg(a,r),l):Pm(Sg(a,""),r)}var LM=class{constructor(r){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=l=>l.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(l,n)=>kM(n.backgroundColor),this.hoverBorderColor=(l,n)=>kM(n.borderColor),this.hoverColor=(l,n)=>kM(n.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(r)}set(r,l){return RM(this,r,l)}get(r){return Sg(this,r)}describe(r,l){return RM(ab,r,l)}override(r,l){return RM(Id,r,l)}route(r,l,n,s){let d=Sg(this,r),m=Sg(this,n),_="_"+l;Object.defineProperties(d,{[_]:{value:d[l],writable:!0},[l]:{enumerable:!0,get(){let w=this[_],S=m[s];return In(w)?Object.assign({},S,w):nn(w,S)},set(w){this[_]=w}}})}},An=new LM({_scriptable:a=>!a.startsWith("on"),_indexable:a=>a!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}});function ett(a){return!a||zn(a.size)||zn(a.family)?null:(a.style?a.style+" ":"")+(a.weight?a.weight+" ":"")+a.size+"px "+a.family}function Eg(a,r,l,n,s){let d=r[s];return d||(d=r[s]=a.measureText(s).width,l.push(s)),d>n&&(n=d),n}function SB(a,r,l,n){n=n||{};let s=n.data=n.data||{},d=n.garbageCollect=n.garbageCollect||[];n.font!==r&&(s=n.data={},d=n.garbageCollect=[],n.font=r),a.save(),a.font=r;let m=0,_=l.length,w,S,I,L,H;for(w=0;w<_;w++)if(L=l[w],L!=null&&Rr(L)!==!0)m=Eg(a,s,d,m,L);else if(Rr(L))for(S=0,I=L.length;S<I;S++)H=L[S],H!=null&&!Rr(H)&&(m=Eg(a,s,d,m,H));a.restore();let q=d.length/2;if(q>l.length){for(w=0;w<q;w++)delete s[d[w]];d.splice(0,q)}return m}function Ad(a,r,l){let n=a.currentDevicePixelRatio,s=l!==0?Math.max(l/2,.5):0;return Math.round((r-s)*n)/n+s}function JM(a,r){r=r||a.getContext("2d"),r.save(),r.resetTransform(),r.clearRect(0,0,a.width,a.height),r.restore()}function lb(a,r,l,n){tD(a,r,l,n,null)}function tD(a,r,l,n,s){let d,m,_,w,S,I,L=r.pointStyle,H=r.rotation,q=r.radius,X=(H||0)*kJ;if(L&&typeof L=="object"&&(d=L.toString(),d==="[object HTMLImageElement]"||d==="[object HTMLCanvasElement]")){a.save(),a.translate(l,n),a.rotate(X),a.drawImage(L,-L.width/2,-L.height/2,L.width,L.height),a.restore();return}if(!(isNaN(q)||q<=0)){switch(a.beginPath(),L){default:s?a.ellipse(l,n,s/2,q,0,0,mr):a.arc(l,n,q,0,mr),a.closePath();break;case"triangle":a.moveTo(l+Math.sin(X)*q,n-Math.cos(X)*q),X+=$N,a.lineTo(l+Math.sin(X)*q,n-Math.cos(X)*q),X+=$N,a.lineTo(l+Math.sin(X)*q,n-Math.cos(X)*q),a.closePath();break;case"rectRounded":S=q*.516,w=q-S,m=Math.cos(X+wg)*w,_=Math.sin(X+wg)*w,a.arc(l-m,n-_,S,X-Ur,X-co),a.arc(l+_,n-m,S,X-co,X),a.arc(l+m,n+_,S,X,X+co),a.arc(l-_,n+m,S,X+co,X+Ur),a.closePath();break;case"rect":if(!H){w=Math.SQRT1_2*q,I=s?s/2:w,a.rect(l-I,n-w,2*I,2*w);break}X+=wg;case"rectRot":m=Math.cos(X)*q,_=Math.sin(X)*q,a.moveTo(l-m,n-_),a.lineTo(l+_,n-m),a.lineTo(l+m,n+_),a.lineTo(l-_,n+m),a.closePath();break;case"crossRot":X+=wg;case"cross":m=Math.cos(X)*q,_=Math.sin(X)*q,a.moveTo(l-m,n-_),a.lineTo(l+m,n+_),a.moveTo(l+_,n-m),a.lineTo(l-_,n+m);break;case"star":m=Math.cos(X)*q,_=Math.sin(X)*q,a.moveTo(l-m,n-_),a.lineTo(l+m,n+_),a.moveTo(l+_,n-m),a.lineTo(l-_,n+m),X+=wg,m=Math.cos(X)*q,_=Math.sin(X)*q,a.moveTo(l-m,n-_),a.lineTo(l+m,n+_),a.moveTo(l+_,n-m),a.lineTo(l-_,n+m);break;case"line":m=s?s/2:Math.cos(X)*q,_=Math.sin(X)*q,a.moveTo(l-m,n-_),a.lineTo(l+m,n+_);break;case"dash":a.moveTo(l,n),a.lineTo(l+Math.cos(X)*q,n+Math.sin(X)*q);break}a.fill(),r.borderWidth>0&&a.stroke()}}function Om(a,r,l){return l=l||.5,!r||a&&a.x>r.left-l&&a.x<r.right+l&&a.y>r.top-l&&a.y<r.bottom+l}function Tg(a,r){a.save(),a.beginPath(),a.rect(r.left,r.top,r.right-r.left,r.bottom-r.top),a.clip()}function Ig(a){a.restore()}function EB(a,r,l,n,s){if(!r)return a.lineTo(l.x,l.y);if(s==="middle"){let d=(r.x+l.x)/2;a.lineTo(d,r.y),a.lineTo(d,l.y)}else s==="after"!=!!n?a.lineTo(r.x,l.y):a.lineTo(l.x,r.y);a.lineTo(l.x,l.y)}function MB(a,r,l,n){if(!r)return a.lineTo(l.x,l.y);a.bezierCurveTo(n?r.cp1x:r.cp2x,n?r.cp1y:r.cp2y,n?l.cp2x:l.cp1x,n?l.cp2y:l.cp1y,l.x,l.y)}function kd(a,r,l,n,s,d={}){let m=Rr(r)?r:[r],_=d.strokeWidth>0&&d.strokeColor!=="",w,S;for(a.save(),a.font=s.string,itt(a,d),w=0;w<m.length;++w)S=m[w],_&&(d.strokeColor&&(a.strokeStyle=d.strokeColor),zn(d.strokeWidth)||(a.lineWidth=d.strokeWidth),a.strokeText(S,l,n,d.maxWidth)),a.fillText(S,l,n,d.maxWidth),ntt(a,l,n,S,d),n+=s.lineHeight;a.restore()}function itt(a,r){r.translation&&a.translate(r.translation[0],r.translation[1]),zn(r.rotation)||a.rotate(r.rotation),r.color&&(a.fillStyle=r.color),r.textAlign&&(a.textAlign=r.textAlign),r.textBaseline&&(a.textBaseline=r.textBaseline)}function ntt(a,r,l,n,s){if(s.strikethrough||s.underline){let d=a.measureText(n),m=r-d.actualBoundingBoxLeft,_=r+d.actualBoundingBoxRight,w=l-d.actualBoundingBoxAscent,S=l+d.actualBoundingBoxDescent,I=s.strikethrough?(w+S)/2:S;a.strokeStyle=a.fillStyle,a.beginPath(),a.lineWidth=s.decorationWidth||2,a.moveTo(m,I),a.lineTo(_,I),a.stroke()}}function Bm(a,r){let{x:l,y:n,w:s,h:d,radius:m}=r;a.arc(l+m.topLeft,n+m.topLeft,m.topLeft,-co,Ur,!0),a.lineTo(l,n+d-m.bottomLeft),a.arc(l+m.bottomLeft,n+d-m.bottomLeft,m.bottomLeft,Ur,co,!0),a.lineTo(l+s-m.bottomRight,n+d),a.arc(l+s-m.bottomRight,n+d-m.bottomRight,m.bottomRight,co,0,!0),a.lineTo(l+s,n+m.topRight),a.arc(l+s-m.topRight,n+m.topRight,m.topRight,0,-co,!0),a.lineTo(l+m.topLeft,n)}var rtt=new RegExp(/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/),ott=new RegExp(/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/);function stt(a,r){let l=(""+a).match(rtt);if(!l||l[1]==="normal")return r*1.2;switch(a=+l[2],l[3]){case"px":return a;case"%":a/=100;break}return r*a}var att=a=>+a||0;function cb(a,r){let l={},n=In(r),s=n?Object.keys(r):r,d=In(a)?n?m=>nn(a[m],a[r[m]]):m=>a[m]:()=>a;for(let m of s)l[m]=att(d(m));return l}function eD(a){return cb(a,{top:"y",right:"x",bottom:"y",left:"x"})}function Rd(a){return cb(a,["topLeft","topRight","bottomLeft","bottomRight"])}function ts(a){let r=eD(a);return r.width=r.left+r.right,r.height=r.top+r.bottom,r}function No(a,r){a=a||{},r=r||An.font;let l=nn(a.size,r.size);typeof l=="string"&&(l=parseInt(l,10));let n=nn(a.style,r.style);n&&!(""+n).match(ott)&&(console.warn('Invalid font style specified: "'+n+'"'),n="");let s={family:nn(a.family,r.family),lineHeight:stt(nn(a.lineHeight,r.lineHeight),l),size:l,style:n,weight:nn(a.weight,r.weight),string:""};return s.string=ett(s),s}function Vm(a,r,l,n){let s=!0,d,m,_;for(d=0,m=a.length;d<m;++d)if(_=a[d],_!==void 0&&(r!==void 0&&typeof _=="function"&&(_=_(r),s=!1),l!==void 0&&Rr(_)&&(_=_[l%_.length],s=!1),_!==void 0))return n&&!s&&(n.cacheable=!1),_}function DB(a,r,l){let{min:n,max:s}=a,d=zM(r,(s-n)/2),m=(_,w)=>l&&_===0?0:_+w;return{min:m(n,-Math.abs(d)),max:m(s,d)}}function Fc(a,r){return Object.assign(Object.create(a),r)}function db(a,r=[""],l=a,n,s=()=>a[0]){ia(n)||(n=AB("_fallback",a));let d={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:a,_rootScopes:l,_fallback:n,_getTarget:s,override:m=>db([m,...a],r,l,n)};return new Proxy(d,{deleteProperty(m,_){return delete m[_],delete m._keys,delete a[0][_],!0},get(m,_){return TB(m,_,()=>ftt(_,r,a,m))},getOwnPropertyDescriptor(m,_){return Reflect.getOwnPropertyDescriptor(m._scopes[0],_)},getPrototypeOf(){return Reflect.getPrototypeOf(a[0])},has(m,_){return eB(m).includes(_)},ownKeys(m){return eB(m)},set(m,_,w){let S=m._storage||(m._storage=s());return m[_]=S[_]=w,delete m._keys,!0}})}function Nu(a,r,l,n){let s={_cacheable:!1,_proxy:a,_context:r,_subProxy:l,_stack:new Set,_descriptors:iD(a,n),setContext:d=>Nu(a,d,l,n),override:d=>Nu(a.override(d),r,l,n)};return new Proxy(s,{deleteProperty(d,m){return delete d[m],delete a[m],!0},get(d,m,_){return TB(d,m,()=>ctt(d,m,_))},getOwnPropertyDescriptor(d,m){return d._descriptors.allKeys?Reflect.has(a,m)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(a,m)},getPrototypeOf(){return Reflect.getPrototypeOf(a)},has(d,m){return Reflect.has(a,m)},ownKeys(){return Reflect.ownKeys(a)},set(d,m,_){return a[m]=_,delete d[m],!0}})}function iD(a,r={scriptable:!0,indexable:!0}){let{_scriptable:l=r.scriptable,_indexable:n=r.indexable,_allKeys:s=r.allKeys}=a;return{allKeys:s,scriptable:l,indexable:n,isScriptable:Pc(l)?l:()=>l,isIndexable:Pc(n)?n:()=>n}}var ltt=(a,r)=>a?a+nb(r):r,nD=(a,r)=>In(r)&&a!=="adapters"&&(Object.getPrototypeOf(r)===null||r.constructor===Object);function TB(a,r,l){if(Object.prototype.hasOwnProperty.call(a,r))return a[r];let n=l();return a[r]=n,n}function ctt(a,r,l){let{_proxy:n,_context:s,_subProxy:d,_descriptors:m}=a,_=n[r];return Pc(_)&&m.isScriptable(r)&&(_=dtt(r,_,a,l)),Rr(_)&&_.length&&(_=utt(r,_,a,m.isIndexable)),nD(r,_)&&(_=Nu(_,s,d&&d[r],m)),_}function dtt(a,r,l,n){let{_proxy:s,_context:d,_subProxy:m,_stack:_}=l;if(_.has(a))throw new Error("Recursion detected: "+Array.from(_).join("->")+"->"+a);return _.add(a),r=r(d,m||n),_.delete(a),nD(a,r)&&(r=rD(s._scopes,s,a,r)),r}function utt(a,r,l,n){let{_proxy:s,_context:d,_subProxy:m,_descriptors:_}=l;if(ia(d.index)&&n(a))r=r[d.index%r.length];else if(In(r[0])){let w=r,S=s._scopes.filter(I=>I!==w);r=[];for(let I of w){let L=rD(S,s,a,I);r.push(Nu(L,d,m&&m[a],_))}}return r}function IB(a,r,l){return Pc(a)?a(r,l):a}var htt=(a,r)=>a===!0?r:typeof a=="string"?Oc(r,a):void 0;function mtt(a,r,l,n,s){for(let d of r){let m=htt(l,d);if(m){a.add(m);let _=IB(m._fallback,l,s);if(ia(_)&&_!==l&&_!==n)return _}else if(m===!1&&ia(n)&&l!==n)return null}return!1}function rD(a,r,l,n){let s=r._rootScopes,d=IB(r._fallback,l,n),m=[...a,...s],_=new Set;_.add(n);let w=tB(_,m,l,d||l,n);return w===null||ia(d)&&d!==l&&(w=tB(_,m,d,w,n),w===null)?!1:db(Array.from(_),[""],s,d,()=>ptt(r,l,n))}function tB(a,r,l,n,s){for(;l;)l=mtt(a,r,l,n,s);return l}function ptt(a,r,l){let n=a._getTarget();r in n||(n[r]={});let s=n[r];return Rr(s)&&In(l)?l:s}function ftt(a,r,l,n){let s;for(let d of r)if(s=AB(ltt(d,a),l),ia(s))return nD(a,s)?rD(l,n,a,s):s}function AB(a,r){for(let l of r){if(!l)continue;let n=l[a];if(ia(n))return n}}function eB(a){let r=a._keys;return r||(r=a._keys=gtt(a._scopes)),r}function gtt(a){let r=new Set;for(let l of a)for(let n of Object.keys(l).filter(s=>!s.startsWith("_")))r.add(n);return Array.from(r)}function oD(a,r,l,n){let{iScale:s}=a,{key:d="r"}=this._parsing,m=new Array(n),_,w,S,I;for(_=0,w=n;_<w;++_)S=_+l,I=r[S],m[_]={r:s.parse(Oc(I,d),S)};return m}var _tt=Number.EPSILON||1e-14,Fm=(a,r)=>r<a.length&&!a[r].skip&&a[r],kB=a=>a==="x"?"y":"x";function vtt(a,r,l,n){let s=a.skip?r:a,d=r,m=l.skip?r:l,_=eb(d,s),w=eb(m,d),S=_/(_+w),I=w/(_+w);S=isNaN(S)?0:S,I=isNaN(I)?0:I;let L=n*S,H=n*I;return{previous:{x:d.x-L*(m.x-s.x),y:d.y-L*(m.y-s.y)},next:{x:d.x+H*(m.x-s.x),y:d.y+H*(m.y-s.y)}}}function ytt(a,r,l){let n=a.length,s,d,m,_,w,S=Fm(a,0);for(let I=0;I<n-1;++I)if(w=S,S=Fm(a,I+1),!(!w||!S)){if(zm(r[I],0,_tt)){l[I]=l[I+1]=0;continue}s=l[I]/r[I],d=l[I+1]/r[I],_=Math.pow(s,2)+Math.pow(d,2),!(_<=9)&&(m=3/Math.sqrt(_),l[I]=s*m*r[I],l[I+1]=d*m*r[I])}}function btt(a,r,l="x"){let n=kB(l),s=a.length,d,m,_,w=Fm(a,0);for(let S=0;S<s;++S){if(m=_,_=w,w=Fm(a,S+1),!_)continue;let I=_[l],L=_[n];m&&(d=(I-m[l])/3,_[`cp1${l}`]=I-d,_[`cp1${n}`]=L-d*r[S]),w&&(d=(w[l]-I)/3,_[`cp2${l}`]=I+d,_[`cp2${n}`]=L+d*r[S])}}function xtt(a,r="x"){let l=kB(r),n=a.length,s=Array(n).fill(0),d=Array(n),m,_,w,S=Fm(a,0);for(m=0;m<n;++m)if(_=w,w=S,S=Fm(a,m+1),!!w){if(S){let I=S[r]-w[r];s[m]=I!==0?(S[l]-w[l])/I:0}d[m]=_?S?_l(s[m-1])!==_l(s[m])?0:(s[m-1]+s[m])/2:s[m-1]:s[m]}ytt(a,s,d),btt(a,d,r)}function Qy(a,r,l){return Math.max(Math.min(a,l),r)}function wtt(a,r){let l,n,s,d,m,_=Om(a[0],r);for(l=0,n=a.length;l<n;++l)m=d,d=_,_=l<n-1&&Om(a[l+1],r),d&&(s=a[l],m&&(s.cp1x=Qy(s.cp1x,r.left,r.right),s.cp1y=Qy(s.cp1y,r.top,r.bottom)),_&&(s.cp2x=Qy(s.cp2x,r.left,r.right),s.cp2y=Qy(s.cp2y,r.top,r.bottom)))}function RB(a,r,l,n,s){let d,m,_,w;if(r.spanGaps&&(a=a.filter(S=>!S.skip)),r.cubicInterpolationMode==="monotone")xtt(a,s);else{let S=n?a[a.length-1]:a[0];for(d=0,m=a.length;d<m;++d)_=a[d],w=vtt(S,_,a[Math.min(d+1,m-(n?0:1))%m],r.tension),_.cp1x=w.previous.x,_.cp1y=w.previous.y,_.cp2x=w.next.x,_.cp2y=w.next.y,S=_}r.capBezierPoints&&wtt(a,l)}function sD(){return typeof window<"u"&&typeof document<"u"}function ub(a){let r=a.parentNode;return r&&r.toString()==="[object ShadowRoot]"&&(r=r.host),r}function ib(a,r,l){let n;return typeof a=="string"?(n=parseInt(a,10),a.indexOf("%")!==-1&&(n=n/100*r.parentNode[l])):n=a,n}var hb=a=>window.getComputedStyle(a,null);function Ctt(a,r){return hb(a).getPropertyValue(r)}var Stt=["top","right","bottom","left"];function zu(a,r,l){let n={};l=l?"-"+l:"";for(let s=0;s<4;s++){let d=Stt[s];n[d]=parseFloat(a[r+"-"+d+l])||0}return n.width=n.left+n.right,n.height=n.top+n.bottom,n}var Ett=(a,r,l)=>(a>0||r>0)&&(!l||!l.shadowRoot);function Mtt(a,r){let l=a.touches,n=l&&l.length?l[0]:a,{offsetX:s,offsetY:d}=n,m=!1,_,w;if(Ett(s,d,a.target))_=s,w=d;else{let S=r.getBoundingClientRect();_=n.clientX-S.left,w=n.clientY-S.top,m=!0}return{x:_,y:w,box:m}}function Pd(a,r){if("native"in a)return a;let{canvas:l,currentDevicePixelRatio:n}=r,s=hb(l),d=s.boxSizing==="border-box",m=zu(s,"padding"),_=zu(s,"border","width"),{x:w,y:S,box:I}=Mtt(a,l),L=m.left+(I&&_.left),H=m.top+(I&&_.top),{width:q,height:X}=r;return d&&(q-=m.width+_.width,X-=m.height+_.height),{x:Math.round((w-L)/q*l.width/n),y:Math.round((S-H)/X*l.height/n)}}function Dtt(a,r,l){let n,s;if(r===void 0||l===void 0){let d=ub(a);if(!d)r=a.clientWidth,l=a.clientHeight;else{let m=d.getBoundingClientRect(),_=hb(d),w=zu(_,"border","width"),S=zu(_,"padding");r=m.width-S.width-w.width,l=m.height-S.height-w.height,n=ib(_.maxWidth,d,"clientWidth"),s=ib(_.maxHeight,d,"clientHeight")}}return{width:r,height:l,maxWidth:n||tb,maxHeight:s||tb}}var PM=a=>Math.round(a*10)/10;function PB(a,r,l,n){let s=hb(a),d=zu(s,"margin"),m=ib(s.maxWidth,a,"clientWidth")||tb,_=ib(s.maxHeight,a,"clientHeight")||tb,w=Dtt(a,r,l),{width:S,height:I}=w;if(s.boxSizing==="content-box"){let L=zu(s,"border","width"),H=zu(s,"padding");S-=H.width+L.width,I-=H.height+L.height}return S=Math.max(0,S-d.width),I=Math.max(0,n?Math.floor(S/n):I-d.height),S=PM(Math.min(S,m,w.maxWidth)),I=PM(Math.min(I,_,w.maxHeight)),S&&!I&&(I=PM(S/2)),{width:S,height:I}}function aD(a,r,l){let n=r||1,s=Math.floor(a.height*n),d=Math.floor(a.width*n);a.height=s/n,a.width=d/n;let m=a.canvas;return m.style&&(l||!m.style.height&&!m.style.width)&&(m.style.height=`${a.height}px`,m.style.width=`${a.width}px`),a.currentDevicePixelRatio!==n||m.height!==s||m.width!==d?(a.currentDevicePixelRatio=n,m.height=s,m.width=d,a.ctx.setTransform(n,0,0,n,0,0),!0):!1}var OB=function(){let a=!1;try{let r={get passive(){return a=!0,!1}};window.addEventListener("test",null,r),window.removeEventListener("test",null,r)}catch{}return a}();function lD(a,r){let l=Ctt(a,r),n=l&&l.match(/^(\d+)(\.\d+)?px$/);return n?+n[1]:void 0}function Md(a,r,l,n){return{x:a.x+l*(r.x-a.x),y:a.y+l*(r.y-a.y)}}function FB(a,r,l,n){return{x:a.x+l*(r.x-a.x),y:n==="middle"?l<.5?a.y:r.y:n==="after"?l<1?a.y:r.y:l>0?r.y:a.y}}function LB(a,r,l,n){let s={x:a.cp2x,y:a.cp2y},d={x:r.cp1x,y:r.cp1y},m=Md(a,s,l),_=Md(s,d,l),w=Md(d,r,l),S=Md(m,_,l),I=Md(_,w,l);return Md(S,I,l)}var iB=new Map;function Ttt(a,r){r=r||{};let l=a+JSON.stringify(r),n=iB.get(l);return n||(n=new Intl.NumberFormat(a,r),iB.set(l,n)),n}function jm(a,r,l){return Ttt(r,l).format(a)}var Itt=function(a,r){return{x(l){return a+a+r-l},setWidth(l){r=l},textAlign(l){return l==="center"?l:l==="right"?"left":"right"},xPlus(l,n){return l-n},leftForLtr(l,n){return l-n}}},Att=function(){return{x(a){return a},setWidth(a){},textAlign(a){return a},xPlus(a,r){return a+r},leftForLtr(a,r){return a}}};function Vu(a,r,l){return a?Itt(r,l):Att()}function cD(a,r){let l,n;(r==="ltr"||r==="rtl")&&(l=a.canvas.style,n=[l.getPropertyValue("direction"),l.getPropertyPriority("direction")],l.setProperty("direction",r,"important"),a.prevTextDirection=n)}function dD(a,r){r!==void 0&&(delete a.prevTextDirection,a.canvas.style.setProperty("direction",r[0],r[1]))}function zB(a){return a==="angle"?{between:Nm,compare:RJ,normalize:Us}:{between:Yl,compare:(r,l)=>r-l,normalize:r=>r}}function nB({start:a,end:r,count:l,loop:n,style:s}){return{start:a%l,end:r%l,loop:n&&(r-a+1)%l===0,style:s}}function ktt(a,r,l){let{property:n,start:s,end:d}=l,{between:m,normalize:_}=zB(n),w=r.length,{start:S,end:I,loop:L}=a,H,q;if(L){for(S+=w,I+=w,H=0,q=w;H<q&&m(_(r[S%w][n]),s,d);++H)S--,I--;S%=w,I%=w}return I<S&&(I+=w),{start:S,end:I,loop:L,style:a.style}}function uD(a,r,l){if(!l)return[a];let{property:n,start:s,end:d}=l,m=r.length,{compare:_,between:w,normalize:S}=zB(n),{start:I,end:L,loop:H,style:q}=ktt(a,r,l),X=[],it=!1,at=null,mt,Mt,Lt,Pt=()=>w(s,Lt,mt)&&_(s,Lt)!==0,Nt=()=>_(d,mt)===0||w(d,Lt,mt),ue=()=>it||Pt(),Q=()=>!it||Nt();for(let $t=I,Ue=I;$t<=L;++$t)Mt=r[$t%m],!Mt.skip&&(mt=S(Mt[n]),mt!==Lt&&(it=w(mt,s,d),at===null&&ue()&&(at=_(mt,s)===0?$t:Ue),at!==null&&Q()&&(X.push(nB({start:at,end:$t,loop:H,count:m,style:q})),at=null),Ue=$t,Lt=mt));return at!==null&&X.push(nB({start:at,end:L,loop:H,count:m,style:q})),X}function hD(a,r){let l=[],n=a.segments;for(let s=0;s<n.length;s++){let d=uD(n[s],a.points,r);d.length&&l.push(...d)}return l}function Rtt(a,r,l,n){let s=0,d=r-1;if(l&&!n)for(;s<r&&!a[s].skip;)s++;for(;s<r&&a[s].skip;)s++;for(s%=r,l&&(d+=s);d>s&&a[d%r].skip;)d--;return d%=r,{start:s,end:d}}function Ptt(a,r,l,n){let s=a.length,d=[],m=r,_=a[r],w;for(w=r+1;w<=l;++w){let S=a[w%s];S.skip||S.stop?_.skip||(n=!1,d.push({start:r%s,end:(w-1)%s,loop:n}),r=m=S.stop?w:null):(m=w,_.skip&&(r=w)),_=S}return m!==null&&d.push({start:r%s,end:m%s,loop:n}),d}function NB(a,r){let l=a.points,n=a.options.spanGaps,s=l.length;if(!s)return[];let d=!!a._loop,{start:m,end:_}=Rtt(l,s,d,n);if(n===!0)return rB(a,[{start:m,end:_,loop:d}],l,r);let w=_<m?_+s:_,S=!!a._fullLoop&&m===0&&_===s-1;return rB(a,Ptt(l,m,w,S),l,r)}function rB(a,r,l,n){return!n||!n.setContext||!l?r:Ott(a,r,l,n)}function Ott(a,r,l,n){let s=a._chart.getContext(),d=oB(a.options),{_datasetIndex:m,options:{spanGaps:_}}=a,w=l.length,S=[],I=d,L=r[0].start,H=L;function q(X,it,at,mt){let Mt=_?-1:1;if(X!==it){for(X+=w;l[X%w].skip;)X-=Mt;for(;l[it%w].skip;)it+=Mt;X%w!==it%w&&(S.push({start:X%w,end:it%w,loop:at,style:mt}),I=mt,L=it%w)}}for(let X of r){L=_?L:X.start;let it=l[L%w],at;for(H=L+1;H<=X.end;H++){let mt=l[H%w];at=oB(n.setContext(Fc(s,{type:"segment",p0:it,p1:mt,p0DataIndex:(H-1)%w,p1DataIndex:H%w,datasetIndex:m}))),Ftt(at,I)&&q(L,H-1,X.loop,I),it=mt,I=at}L<H-1&&q(L,H-1,X.loop,I)}return S}function oB(a){return{backgroundColor:a.backgroundColor,borderCapStyle:a.borderCapStyle,borderDash:a.borderDash,borderDashOffset:a.borderDashOffset,borderJoinStyle:a.borderJoinStyle,borderWidth:a.borderWidth,borderColor:a.borderColor}}function Ftt(a,r){return r&&JSON.stringify(a)!==JSON.stringify(r)}var wD=class{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(r,l,n,s){let d=l.listeners[s],m=l.duration;d.forEach(_=>_({chart:r,initial:l.initial,numSteps:m,currentStep:Math.min(n-l.start,m)}))}_refresh(){this._request||(this._running=!0,this._request=qM.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(r=Date.now()){let l=0;this._charts.forEach((n,s)=>{if(!n.running||!n.items.length)return;let d=n.items,m=d.length-1,_=!1,w;for(;m>=0;--m)w=d[m],w._active?(w._total>n.duration&&(n.duration=w._total),w.tick(r),_=!0):(d[m]=d[d.length-1],d.pop());_&&(s.draw(),this._notify(s,n,r,"progress")),d.length||(n.running=!1,this._notify(s,n,r,"complete"),n.initial=!1),l+=d.length}),this._lastDate=r,l===0&&(this._running=!1)}_getAnims(r){let l=this._charts,n=l.get(r);return n||(n={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},l.set(r,n)),n}listen(r,l,n){this._getAnims(r).listeners[l].push(n)}add(r,l){!l||!l.length||this._getAnims(r).items.push(...l)}has(r){return this._getAnims(r).items.length>0}start(r){let l=this._charts.get(r);l&&(l.running=!0,l.start=Date.now(),l.duration=l.items.reduce((n,s)=>Math.max(n,s._duration),0),this._refresh())}running(r){if(!this._running)return!1;let l=this._charts.get(r);return!(!l||!l.running||!l.items.length)}stop(r){let l=this._charts.get(r);if(!l||!l.items.length)return;let n=l.items,s=n.length-1;for(;s>=0;--s)n[s].cancel();l.items=[],this._notify(r,l,Date.now(),"complete")}remove(r){return this._charts.delete(r)}},Lc=new wD,BB="transparent",Ltt={boolean(a,r,l){return l>.5?r:a},color(a,r,l){let n=QM(a||BB),s=n.valid&&QM(r||BB);return s&&s.valid?s.mix(n,l).hexString():r},number(a,r,l){return a+(r-a)*l}},CD=class{constructor(r,l,n,s){let d=l[n];s=Vm([r.to,s,d,r.from]);let m=Vm([r.from,d,s]);this._active=!0,this._fn=r.fn||Ltt[r.type||typeof m],this._easing=Rm[r.easing]||Rm.linear,this._start=Math.floor(Date.now()+(r.delay||0)),this._duration=this._total=Math.floor(r.duration),this._loop=!!r.loop,this._target=l,this._prop=n,this._from=m,this._to=s,this._promises=void 0}active(){return this._active}update(r,l,n){if(this._active){this._notify(!1);let s=this._target[this._prop],d=n-this._start,m=this._duration-d;this._start=n,this._duration=Math.floor(Math.max(m,r.duration)),this._total+=d,this._loop=!!r.loop,this._to=Vm([r.to,l,s,r.from]),this._from=Vm([r.from,s,l])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(r){let l=r-this._start,n=this._duration,s=this._prop,d=this._from,m=this._loop,_=this._to,w;if(this._active=d!==_&&(m||l<n),!this._active){this._target[s]=_,this._notify(!0);return}if(l<0){this._target[s]=d;return}w=l/n%2,w=m&&w>1?2-w:w,w=this._easing(Math.min(1,Math.max(0,w))),this._target[s]=this._fn(d,_,w)}wait(){let r=this._promises||(this._promises=[]);return new Promise((l,n)=>{r.push({res:l,rej:n})})}_notify(r){let l=r?"res":"rej",n=this._promises||[];for(let s=0;s<n.length;s++)n[s][l]()}},ztt=["x","y","borderWidth","radius","tension"],Ntt=["color","borderColor","backgroundColor"];An.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0});var Btt=Object.keys(An.animation);An.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:a=>a!=="onProgress"&&a!=="onComplete"&&a!=="fn"});An.set("animations",{colors:{type:"color",properties:Ntt},numbers:{type:"number",properties:ztt}});An.describe("animations",{_fallback:"animation"});An.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:a=>a|0}}}});var bb=class{constructor(r,l){this._chart=r,this._properties=new Map,this.configure(l)}configure(r){if(!In(r))return;let l=this._properties;Object.getOwnPropertyNames(r).forEach(n=>{let s=r[n];if(!In(s))return;let d={};for(let m of Btt)d[m]=s[m];(Rr(s.properties)&&s.properties||[n]).forEach(m=>{(m===n||!l.has(m))&&l.set(m,d)})})}_animateOptions(r,l){let n=l.options,s=jtt(r,n);if(!s)return[];let d=this._createAnimations(s,n);return n.$shared&&Vtt(r.options.$animations,n).then(()=>{r.options=n},()=>{}),d}_createAnimations(r,l){let n=this._properties,s=[],d=r.$animations||(r.$animations={}),m=Object.keys(l),_=Date.now(),w;for(w=m.length-1;w>=0;--w){let S=m[w];if(S.charAt(0)==="$")continue;if(S==="options"){s.push(...this._animateOptions(r,l));continue}let I=l[S],L=d[S],H=n.get(S);if(L)if(H&&L.active()){L.update(H,I,_);continue}else L.cancel();if(!H||!H.duration){r[S]=I;continue}d[S]=L=new CD(H,r,S,I),s.push(L)}return s}update(r,l){if(this._properties.size===0){Object.assign(r,l);return}let n=this._createAnimations(r,l);if(n.length)return Lc.add(this._chart,n),!0}};function Vtt(a,r){let l=[],n=Object.keys(r);for(let s=0;s<n.length;s++){let d=a[n[s]];d&&d.active()&&l.push(d.wait())}return Promise.all(l)}function jtt(a,r){if(!r)return;let l=a.options;if(!l){a.options=r;return}return l.$shared&&(a.options=l=Object.assign({},l,{$shared:!1,$animations:{}})),l}function VB(a,r){let l=a&&a.options||{},n=l.reverse,s=l.min===void 0?r:0,d=l.max===void 0?r:0;return{start:n?d:s,end:n?s:d}}function Utt(a,r,l){if(l===!1)return!1;let n=VB(a,l),s=VB(r,l);return{top:s.end,right:n.end,bottom:s.start,left:n.start}}function Htt(a){let r,l,n,s;return In(a)?(r=a.top,l=a.right,n=a.bottom,s=a.left):r=l=n=s=a,{top:r,right:l,bottom:n,left:s,disabled:a===!1}}function k4(a,r){let l=[],n=a._getSortedDatasetMetas(r),s,d;for(s=0,d=n.length;s<d;++s)l.push(n[s].index);return l}function jB(a,r,l,n={}){let s=a.keys,d=n.mode==="single",m,_,w,S;if(r!==null){for(m=0,_=s.length;m<_;++m){if(w=+s[m],w===l){if(n.all)continue;break}S=a.values[w],_o(S)&&(d||r===0||_l(r)===_l(S))&&(r+=S)}return r}}function Gtt(a){let r=Object.keys(a),l=new Array(r.length),n,s,d;for(n=0,s=r.length;n<s;++n)d=r[n],l[n]={x:d,y:a[d]};return l}function UB(a,r){let l=a&&a.options.stacked;return l||l===void 0&&r.stack!==void 0}function qtt(a,r,l){return`${a.id}.${r.id}.${l.stack||l.type}`}function Wtt(a){let{min:r,max:l,minDefined:n,maxDefined:s}=a.getUserBounds();return{min:n?r:Number.NEGATIVE_INFINITY,max:s?l:Number.POSITIVE_INFINITY}}function $tt(a,r,l){let n=a[r]||(a[r]={});return n[l]||(n[l]={})}function HB(a,r,l,n){for(let s of r.getMatchingVisibleMetas(n).reverse()){let d=a[s.index];if(l&&d>0||!l&&d<0)return s.index}return null}function GB(a,r){let{chart:l,_cachedMeta:n}=a,s=l._stacks||(l._stacks={}),{iScale:d,vScale:m,index:_}=n,w=d.axis,S=m.axis,I=qtt(d,m,n),L=r.length,H;for(let q=0;q<L;++q){let X=r[q],{[w]:it,[S]:at}=X,mt=X._stacks||(X._stacks={});H=mt[S]=$tt(s,I,it),H[_]=at,H._top=HB(H,m,!0,n.type),H._bottom=HB(H,m,!1,n.type)}}function mD(a,r){let l=a.scales;return Object.keys(l).filter(n=>l[n].axis===r).shift()}function Ytt(a,r){return Fc(a,{active:!1,dataset:void 0,datasetIndex:r,index:r,mode:"default",type:"dataset"})}function Ztt(a,r,l){return Fc(a,{active:!1,dataIndex:r,parsed:void 0,raw:void 0,element:l,index:r,mode:"default",type:"data"})}function Ag(a,r){let l=a.controller.index,n=a.vScale&&a.vScale.axis;if(n){r=r||a._parsed;for(let s of r){let d=s._stacks;if(!d||d[n]===void 0||d[n][l]===void 0)return;delete d[n][l]}}}var pD=a=>a==="reset"||a==="none",qB=(a,r)=>r?a:Object.assign({},a),Xtt=(a,r,l)=>a&&!r.hidden&&r._stacked&&{keys:k4(l,!0),values:null},Ql=(()=>{class a{constructor(l,n){this.chart=l,this._ctx=l.ctx,this.index=n,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.initialize()}initialize(){let l=this._cachedMeta;this.configure(),this.linkScales(),l._stacked=UB(l.vScale,l),this.addElements()}updateIndex(l){this.index!==l&&Ag(this._cachedMeta),this.index=l}linkScales(){let l=this.chart,n=this._cachedMeta,s=this.getDataset(),d=(H,q,X,it)=>H==="x"?q:H==="r"?it:X,m=n.xAxisID=nn(s.xAxisID,mD(l,"x")),_=n.yAxisID=nn(s.yAxisID,mD(l,"y")),w=n.rAxisID=nn(s.rAxisID,mD(l,"r")),S=n.indexAxis,I=n.iAxisID=d(S,m,_,w),L=n.vAxisID=d(S,_,m,w);n.xScale=this.getScaleForId(m),n.yScale=this.getScaleForId(_),n.rScale=this.getScaleForId(w),n.iScale=this.getScaleForId(I),n.vScale=this.getScaleForId(L)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(l){return this.chart.scales[l]}_getOtherScale(l){let n=this._cachedMeta;return l===n.iScale?n.vScale:n.iScale}reset(){this._update("reset")}_destroy(){let l=this._cachedMeta;this._data&&HM(this._data,this),l._stacked&&Ag(l)}_dataCheck(){let l=this.getDataset(),n=l.data||(l.data=[]),s=this._data;if(In(n))this._data=Gtt(n);else if(s!==n){if(s){HM(s,this);let d=this._cachedMeta;Ag(d),d._parsed=[]}n&&Object.isExtensible(n)&&gB(n,this),this._syncList=[],this._data=n}}addElements(){let l=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(l.dataset=new this.datasetElementType)}buildOrUpdateElements(l){let n=this._cachedMeta,s=this.getDataset(),d=!1;this._dataCheck();let m=n._stacked;n._stacked=UB(n.vScale,n),n.stack!==s.stack&&(d=!0,Ag(n),n.stack=s.stack),this._resyncElements(l),(d||m!==n._stacked)&&GB(this,n._parsed)}configure(){let l=this.chart.config,n=l.datasetScopeKeys(this._type),s=l.getOptionScopes(this.getDataset(),n,!0);this.options=l.createResolver(s,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(l,n){let{_cachedMeta:s,_data:d}=this,{iScale:m,_stacked:_}=s,w=m.axis,S=l===0&&n===d.length?!0:s._sorted,I=l>0&&s._parsed[l-1],L,H,q;if(this._parsing===!1)s._parsed=d,s._sorted=!0,q=d;else{Rr(d[l])?q=this.parseArrayData(s,d,l,n):In(d[l])?q=this.parseObjectData(s,d,l,n):q=this.parsePrimitiveData(s,d,l,n);let X=()=>H[w]===null||I&&H[w]<I[w];for(L=0;L<n;++L)s._parsed[L+l]=H=q[L],S&&(X()&&(S=!1),I=H);s._sorted=S}_&&GB(this,q)}parsePrimitiveData(l,n,s,d){let{iScale:m,vScale:_}=l,w=m.axis,S=_.axis,I=m.getLabels(),L=m===_,H=new Array(d),q,X,it;for(q=0,X=d;q<X;++q)it=q+s,H[q]={[w]:L||m.parse(I[it],it),[S]:_.parse(n[it],it)};return H}parseArrayData(l,n,s,d){let{xScale:m,yScale:_}=l,w=new Array(d),S,I,L,H;for(S=0,I=d;S<I;++S)L=S+s,H=n[L],w[S]={x:m.parse(H[0],L),y:_.parse(H[1],L)};return w}parseObjectData(l,n,s,d){let{xScale:m,yScale:_}=l,{xAxisKey:w="x",yAxisKey:S="y"}=this._parsing,I=new Array(d),L,H,q,X;for(L=0,H=d;L<H;++L)q=L+s,X=n[q],I[L]={x:m.parse(Oc(X,w),q),y:_.parse(Oc(X,S),q)};return I}getParsed(l){return this._cachedMeta._parsed[l]}getDataElement(l){return this._cachedMeta.data[l]}applyStack(l,n,s){let d=this.chart,m=this._cachedMeta,_=n[l.axis],w={keys:k4(d,!0),values:n._stacks[l.axis]};return jB(w,_,m.index,{mode:s})}updateRangeFromParsed(l,n,s,d){let m=s[n.axis],_=m===null?NaN:m,w=d&&s._stacks[n.axis];d&&w&&(d.values=w,_=jB(d,m,this._cachedMeta.index)),l.min=Math.min(l.min,_),l.max=Math.max(l.max,_)}getMinMax(l,n){let s=this._cachedMeta,d=s._parsed,m=s._sorted&&l===s.iScale,_=d.length,w=this._getOtherScale(l),S=Xtt(n,s,this.chart),I={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:L,max:H}=Wtt(w),q,X;function it(){X=d[q];let at=X[w.axis];return!_o(X[l.axis])||L>at||H<at}for(q=0;q<_&&!(!it()&&(this.updateRangeFromParsed(I,l,X,S),m));++q);if(m){for(q=_-1;q>=0;--q)if(!it()){this.updateRangeFromParsed(I,l,X,S);break}}return I}getAllParsedValues(l){let n=this._cachedMeta._parsed,s=[],d,m,_;for(d=0,m=n.length;d<m;++d)_=n[d][l.axis],_o(_)&&s.push(_);return s}getMaxOverflow(){return!1}getLabelAndValue(l){let n=this._cachedMeta,s=n.iScale,d=n.vScale,m=this.getParsed(l);return{label:s?""+s.getLabelForValue(m[s.axis]):"",value:d?""+d.getLabelForValue(m[d.axis]):""}}_update(l){let n=this._cachedMeta;this.update(l||"default"),n._clip=Htt(nn(this.options.clip,Utt(n.xScale,n.yScale,this.getMaxOverflow())))}update(l){}draw(){let l=this._ctx,n=this.chart,s=this._cachedMeta,d=s.data||[],m=n.chartArea,_=[],w=this._drawStart||0,S=this._drawCount||d.length-w,I=this.options.drawActiveElementsOnTop,L;for(s.dataset&&s.dataset.draw(l,m,w,S),L=w;L<w+S;++L){let H=d[L];H.hidden||(H.active&&I?_.push(H):H.draw(l,m))}for(L=0;L<_.length;++L)_[L].draw(l,m)}getStyle(l,n){let s=n?"active":"default";return l===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(s):this.resolveDataElementOptions(l||0,s)}getContext(l,n,s){let d=this.getDataset(),m;if(l>=0&&l<this._cachedMeta.data.length){let _=this._cachedMeta.data[l];m=_.$context||(_.$context=Ztt(this.getContext(),l,_)),m.parsed=this.getParsed(l),m.raw=d.data[l],m.index=m.dataIndex=l}else m=this.$context||(this.$context=Ytt(this.chart.getContext(),this.index)),m.dataset=d,m.index=m.datasetIndex=this.index;return m.active=!!n,m.mode=s,m}resolveDatasetElementOptions(l){return this._resolveElementOptions(this.datasetElementType.id,l)}resolveDataElementOptions(l,n){return this._resolveElementOptions(this.dataElementType.id,n,l)}_resolveElementOptions(l,n="default",s){let d=n==="active",m=this._cachedDataOpts,_=l+"-"+n,w=m[_],S=this.enableOptionSharing&&ia(s);if(w)return qB(w,S);let I=this.chart.config,L=I.datasetElementScopeKeys(this._type,l),H=d?[`${l}Hover`,"hover",l,""]:[l,""],q=I.getOptionScopes(this.getDataset(),L),X=Object.keys(An.elements[l]),it=()=>this.getContext(s,d),at=I.resolveNamedOptions(q,X,it,H);return at.$shared&&(at.$shared=S,m[_]=Object.freeze(qB(at,S))),at}_resolveAnimations(l,n,s){let d=this.chart,m=this._cachedDataOpts,_=`animation-${n}`,w=m[_];if(w)return w;let S;if(d.options.animation!==!1){let L=this.chart.config,H=L.datasetAnimationScopeKeys(this._type,n),q=L.getOptionScopes(this.getDataset(),H);S=L.createResolver(q,this.getContext(l,s,n))}let I=new bb(d,S&&S.animations);return S&&S._cacheable&&(m[_]=Object.freeze(I)),I}getSharedOptions(l){if(l.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},l))}includeOptions(l,n){return!n||pD(l)||this.chart._animationsDisabled}_getSharedOptions(l,n){let s=this.resolveDataElementOptions(l,n),d=this._sharedOptions,m=this.getSharedOptions(s),_=this.includeOptions(n,m)||m!==d;return this.updateSharedOptions(m,n,s),{sharedOptions:m,includeOptions:_}}updateElement(l,n,s,d){pD(d)?Object.assign(l,s):this._resolveAnimations(n,d).update(l,s)}updateSharedOptions(l,n,s){l&&!pD(n)&&this._resolveAnimations(void 0,n).update(l,s)}_setStyle(l,n,s,d){l.active=d;let m=this.getStyle(n,d);this._resolveAnimations(n,s,d).update(l,{options:!d&&this.getSharedOptions(m)||m})}removeHoverStyle(l,n,s){this._setStyle(l,s,"active",!1)}setHoverStyle(l,n,s){this._setStyle(l,s,"active",!0)}_removeDatasetHoverStyle(){let l=this._cachedMeta.dataset;l&&this._setStyle(l,void 0,"active",!1)}_setDatasetHoverStyle(){let l=this._cachedMeta.dataset;l&&this._setStyle(l,void 0,"active",!0)}_resyncElements(l){let n=this._data,s=this._cachedMeta.data;for(let[w,S,I]of this._syncList)this[w](S,I);this._syncList=[];let d=s.length,m=n.length,_=Math.min(m,d);_&&this.parse(0,_),m>d?this._insertElements(d,m-d,l):m<d&&this._removeElements(m,d-m)}_insertElements(l,n,s=!0){let d=this._cachedMeta,m=d.data,_=l+n,w,S=I=>{for(I.length+=n,w=I.length-1;w>=_;w--)I[w]=I[w-n]};for(S(m),w=l;w<_;++w)m[w]=new this.dataElementType;this._parsing&&S(d._parsed),this.parse(l,n),s&&this.updateElements(m,l,n,"reset")}updateElements(l,n,s,d){}_removeElements(l,n){let s=this._cachedMeta;if(this._parsing){let d=s._parsed.splice(l,n);s._stacked&&Ag(s,d)}s.data.splice(l,n)}_sync(l){if(this._parsing)this._syncList.push(l);else{let[n,s,d]=l;this[n](s,d)}this.chart._dataChanges.push([this.index,...l])}_onDataPush(){let l=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-l,l])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(l,n){n&&this._sync(["_removeElements",l,n]);let s=arguments.length-2;s&&this._sync(["_insertElements",l,s])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}return a.defaults={},a})();Ql.prototype.datasetElementType=null;Ql.prototype.dataElementType=null;function Ktt(a,r){if(!a._cache.$bar){let l=a.getMatchingVisibleMetas(r),n=[];for(let s=0,d=l.length;s<d;s++)n=n.concat(l[s].controller.getAllParsedValues(a));a._cache.$bar=GM(n.sort((s,d)=>s-d))}return a._cache.$bar}function Qtt(a){let r=a.iScale,l=Ktt(r,a.type),n=r._length,s,d,m,_,w=()=>{m===32767||m===-32768||(ia(_)&&(n=Math.min(n,Math.abs(m-_)||n)),_=m)};for(s=0,d=l.length;s<d;++s)m=r.getPixelForValue(l[s]),w();for(_=void 0,s=0,d=r.ticks.length;s<d;++s)m=r.getPixelForTick(s),w();return n}function Jtt(a,r,l,n){let s=l.barThickness,d,m;return zn(s)?(d=r.min*l.categoryPercentage,m=l.barPercentage):(d=s*n,m=1),{chunk:d/n,ratio:m,start:r.pixels[a]-d/2}}function tet(a,r,l,n){let s=r.pixels,d=s[a],m=a>0?s[a-1]:null,_=a<s.length-1?s[a+1]:null,w=l.categoryPercentage;m===null&&(m=d-(_===null?r.end-r.start:_-d)),_===null&&(_=d+d-m);let S=d-(d-Math.min(m,_))/2*w;return{chunk:Math.abs(_-m)/2*w/n,ratio:l.barPercentage,start:S}}function eet(a,r,l,n){let s=l.parse(a[0],n),d=l.parse(a[1],n),m=Math.min(s,d),_=Math.max(s,d),w=m,S=_;Math.abs(m)>Math.abs(_)&&(w=_,S=m),r[l.axis]=S,r._custom={barStart:w,barEnd:S,start:s,end:d,min:m,max:_}}function R4(a,r,l,n){return Rr(a)?eet(a,r,l,n):r[l.axis]=l.parse(a,n),r}function WB(a,r,l,n){let s=a.iScale,d=a.vScale,m=s.getLabels(),_=s===d,w=[],S,I,L,H;for(S=l,I=l+n;S<I;++S)H=r[S],L={},L[s.axis]=_||s.parse(m[S],S),w.push(R4(H,L,d,S));return w}function fD(a){return a&&a.barStart!==void 0&&a.barEnd!==void 0}function iet(a,r,l){return a!==0?_l(a):(r.isHorizontal()?1:-1)*(r.min>=l?1:-1)}function net(a){let r,l,n,s,d;return a.horizontal?(r=a.base>a.x,l="left",n="right"):(r=a.base<a.y,l="bottom",n="top"),r?(s="end",d="start"):(s="start",d="end"),{start:l,end:n,reverse:r,top:s,bottom:d}}function ret(a,r,l,n){let s=r.borderSkipped,d={};if(!s){a.borderSkipped=d;return}if(s===!0){a.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}let{start:m,end:_,reverse:w,top:S,bottom:I}=net(a);s==="middle"&&l&&(a.enableBorderRadius=!0,(l._top||0)===n?s=S:(l._bottom||0)===n?s=I:(d[$B(I,m,_,w)]=!0,s=S)),d[$B(s,m,_,w)]=!0,a.borderSkipped=d}function $B(a,r,l,n){return n?(a=oet(a,r,l),a=YB(a,l,r)):a=YB(a,r,l),a}function oet(a,r,l){return a===r?l:a===l?r:a}function YB(a,r,l){return a==="start"?r:a==="end"?l:a}function set(a,{inflateAmount:r},l){a.inflateAmount=r==="auto"?l===1?.33:0:r}var aet=(()=>{class a extends Ql{parsePrimitiveData(l,n,s,d){return WB(l,n,s,d)}parseArrayData(l,n,s,d){return WB(l,n,s,d)}parseObjectData(l,n,s,d){let{iScale:m,vScale:_}=l,{xAxisKey:w="x",yAxisKey:S="y"}=this._parsing,I=m.axis==="x"?w:S,L=_.axis==="x"?w:S,H=[],q,X,it,at;for(q=s,X=s+d;q<X;++q)at=n[q],it={},it[m.axis]=m.parse(Oc(at,I),q),H.push(R4(Oc(at,L),it,_,q));return H}updateRangeFromParsed(l,n,s,d){super.updateRangeFromParsed(l,n,s,d);let m=s._custom;m&&n===this._cachedMeta.vScale&&(l.min=Math.min(l.min,m.min),l.max=Math.max(l.max,m.max))}getMaxOverflow(){return 0}getLabelAndValue(l){let n=this._cachedMeta,{iScale:s,vScale:d}=n,m=this.getParsed(l),_=m._custom,w=fD(_)?"["+_.start+", "+_.end+"]":""+d.getLabelForValue(m[d.axis]);return{label:""+s.getLabelForValue(m[s.axis]),value:w}}initialize(){this.enableOptionSharing=!0,super.initialize();let l=this._cachedMeta;l.stack=this.getDataset().stack}update(l){let n=this._cachedMeta;this.updateElements(n.data,0,n.data.length,l)}updateElements(l,n,s,d){let m=d==="reset",{index:_,_cachedMeta:{vScale:w}}=this,S=w.getBasePixel(),I=w.isHorizontal(),L=this._getRuler(),{sharedOptions:H,includeOptions:q}=this._getSharedOptions(n,d);for(let X=n;X<n+s;X++){let it=this.getParsed(X),at=m||zn(it[w.axis])?{base:S,head:S}:this._calculateBarValuePixels(X),mt=this._calculateBarIndexPixels(X,L),Mt=(it._stacks||{})[w.axis],Lt={horizontal:I,base:at.base,enableBorderRadius:!Mt||fD(it._custom)||_===Mt._top||_===Mt._bottom,x:I?at.head:mt.center,y:I?mt.center:at.head,height:I?mt.size:Math.abs(at.size),width:I?Math.abs(at.size):mt.size};q&&(Lt.options=H||this.resolveDataElementOptions(X,l[X].active?"active":d));let Pt=Lt.options||l[X].options;ret(Lt,Pt,Mt,_),set(Lt,Pt,L.ratio),this.updateElement(l[X],X,Lt,d)}}_getStacks(l,n){let{iScale:s}=this._cachedMeta,d=s.getMatchingVisibleMetas(this._type).filter(S=>S.controller.options.grouped),m=s.options.stacked,_=[],w=S=>{let I=S.controller.getParsed(n),L=I&&I[S.vScale.axis];if(zn(L)||isNaN(L))return!0};for(let S of d)if(!(n!==void 0&&w(S))&&((m===!1||_.indexOf(S.stack)===-1||m===void 0&&S.stack===void 0)&&_.push(S.stack),S.index===l))break;return _.length||_.push(void 0),_}_getStackCount(l){return this._getStacks(void 0,l).length}_getStackIndex(l,n,s){let d=this._getStacks(l,s),m=n!==void 0?d.indexOf(n):-1;return m===-1?d.length-1:m}_getRuler(){let l=this.options,n=this._cachedMeta,s=n.iScale,d=[],m,_;for(m=0,_=n.data.length;m<_;++m)d.push(s.getPixelForValue(this.getParsed(m)[s.axis],m));let w=l.barThickness;return{min:w||Qtt(n),pixels:d,start:s._startPixel,end:s._endPixel,stackCount:this._getStackCount(),scale:s,grouped:l.grouped,ratio:w?1:l.categoryPercentage*l.barPercentage}}_calculateBarValuePixels(l){let{_cachedMeta:{vScale:n,_stacked:s},options:{base:d,minBarLength:m}}=this,_=d||0,w=this.getParsed(l),S=w._custom,I=fD(S),L=w[n.axis],H=0,q=s?this.applyStack(n,w,s):L,X,it;q!==L&&(H=q-L,q=L),I&&(L=S.barStart,q=S.barEnd-S.barStart,L!==0&&_l(L)!==_l(S.barEnd)&&(H=0),H+=L);let at=!zn(d)&&!I?d:H,mt=n.getPixelForValue(at);if(this.chart.getDataVisibility(l)?X=n.getPixelForValue(H+q):X=mt,it=X-mt,Math.abs(it)<m){it=iet(it,n,_)*m,L===_&&(mt-=it/2);let Mt=n.getPixelForDecimal(0),Lt=n.getPixelForDecimal(1),Pt=Math.min(Mt,Lt),Nt=Math.max(Mt,Lt);mt=Math.max(Math.min(mt,Nt),Pt),X=mt+it}if(mt===n.getPixelForValue(_)){let Mt=_l(it)*n.getLineWidthForValue(_)/2;mt+=Mt,it-=Mt}return{size:it,base:mt,head:X,center:X+it/2}}_calculateBarIndexPixels(l,n){let s=n.scale,d=this.options,m=d.skipNull,_=nn(d.maxBarThickness,1/0),w,S;if(n.grouped){let I=m?this._getStackCount(l):n.stackCount,L=d.barThickness==="flex"?tet(l,n,d,I):Jtt(l,n,d,I),H=this._getStackIndex(this.index,this._cachedMeta.stack,m?l:void 0);w=L.start+L.chunk*H+L.chunk/2,S=Math.min(_,L.chunk*L.ratio)}else w=s.getPixelForValue(this.getParsed(l)[s.axis],l),S=Math.min(_,n.min*n.ratio);return{base:w-S/2,head:w+S/2,center:w,size:S}}draw(){let l=this._cachedMeta,n=l.vScale,s=l.data,d=s.length,m=0;for(;m<d;++m)this.getParsed(m)[n.axis]!==null&&s[m].draw(this._ctx)}}return a.id="bar",a.defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}},a.overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}},a})(),cet=(()=>{class a extends Ql{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(l,n,s,d){let m=super.parsePrimitiveData(l,n,s,d);for(let _=0;_<m.length;_++)m[_]._custom=this.resolveDataElementOptions(_+s).radius;return m}parseArrayData(l,n,s,d){let m=super.parseArrayData(l,n,s,d);for(let _=0;_<m.length;_++){let w=n[s+_];m[_]._custom=nn(w[2],this.resolveDataElementOptions(_+s).radius)}return m}parseObjectData(l,n,s,d){let m=super.parseObjectData(l,n,s,d);for(let _=0;_<m.length;_++){let w=n[s+_];m[_]._custom=nn(w&&w.r&&+w.r,this.resolveDataElementOptions(_+s).radius)}return m}getMaxOverflow(){let l=this._cachedMeta.data,n=0;for(let s=l.length-1;s>=0;--s)n=Math.max(n,l[s].size(this.resolveDataElementOptions(s))/2);return n>0&&n}getLabelAndValue(l){let n=this._cachedMeta,{xScale:s,yScale:d}=n,m=this.getParsed(l),_=s.getLabelForValue(m.x),w=d.getLabelForValue(m.y),S=m._custom;return{label:n.label,value:"("+_+", "+w+(S?", "+S:"")+")"}}update(l){let n=this._cachedMeta.data;this.updateElements(n,0,n.length,l)}updateElements(l,n,s,d){let m=d==="reset",{iScale:_,vScale:w}=this._cachedMeta,{sharedOptions:S,includeOptions:I}=this._getSharedOptions(n,d),L=_.axis,H=w.axis;for(let q=n;q<n+s;q++){let X=l[q],it=!m&&this.getParsed(q),at={},mt=at[L]=m?_.getPixelForDecimal(.5):_.getPixelForValue(it[L]),Mt=at[H]=m?w.getBasePixel():w.getPixelForValue(it[H]);at.skip=isNaN(mt)||isNaN(Mt),I&&(at.options=S||this.resolveDataElementOptions(q,X.active?"active":d),m&&(at.options.radius=0)),this.updateElement(X,q,at,d)}}resolveDataElementOptions(l,n){let s=this.getParsed(l),d=super.resolveDataElementOptions(l,n);d.$shared&&(d=Object.assign({},d,{$shared:!1}));let m=d.radius;return n!=="active"&&(d.radius=0),d.radius+=nn(s&&s._custom,m),d}}return a.id="bubble",a.defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}},a.overrides={scales:{x:{type:"linear"},y:{type:"linear"}},plugins:{tooltip:{callbacks:{title(){return""}}}}},a})();function det(a,r,l){let n=1,s=1,d=0,m=0;if(r<mr){let _=a,w=_+r,S=Math.cos(_),I=Math.sin(_),L=Math.cos(w),H=Math.sin(w),q=(Lt,Pt,Nt)=>Nm(Lt,_,w,!0)?1:Math.max(Pt,Pt*l,Nt,Nt*l),X=(Lt,Pt,Nt)=>Nm(Lt,_,w,!0)?-1:Math.min(Pt,Pt*l,Nt,Nt*l),it=q(0,S,L),at=q(co,I,H),mt=X(Ur,S,L),Mt=X(Ur+co,I,H);n=(it-mt)/2,s=(at-Mt)/2,d=-(it+mt)/2,m=-(at+Mt)/2}return{ratioX:n,ratioY:s,offsetX:d,offsetY:m}}var P4=(()=>{class a extends Ql{constructor(l,n){super(l,n),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(l,n){let s=this.getDataset().data,d=this._cachedMeta;if(this._parsing===!1)d._parsed=s;else{let m=S=>+s[S];if(In(s[l])){let{key:S="value"}=this._parsing;m=I=>+Oc(s[I],S)}let _,w;for(_=l,w=l+n;_<w;++_)d._parsed[_]=m(_)}}_getRotation(){return Aa(this.options.rotation-90)}_getCircumference(){return Aa(this.options.circumference)}_getRotationExtents(){let l=mr,n=-mr;for(let s=0;s<this.chart.data.datasets.length;++s)if(this.chart.isDatasetVisible(s)){let d=this.chart.getDatasetMeta(s).controller,m=d._getRotation(),_=d._getCircumference();l=Math.min(l,m),n=Math.max(n,m+_)}return{rotation:l,circumference:n-l}}update(l){let n=this.chart,{chartArea:s}=n,d=this._cachedMeta,m=d.data,_=this.getMaxBorderWidth()+this.getMaxOffset(m)+this.options.spacing,w=Math.max((Math.min(s.width,s.height)-_)/2,0),S=Math.min(aB(this.options.cutout,w),1),I=this._getRingWeight(this.index),{circumference:L,rotation:H}=this._getRotationExtents(),{ratioX:q,ratioY:X,offsetX:it,offsetY:at}=det(H,L,S),mt=(s.width-_)/q,Mt=(s.height-_)/X,Lt=Math.max(Math.min(mt,Mt)/2,0),Pt=zM(this.options.radius,Lt),Nt=Math.max(Pt*S,0),ue=(Pt-Nt)/this._getVisibleDatasetWeightTotal();this.offsetX=it*Pt,this.offsetY=at*Pt,d.total=this.calculateTotal(),this.outerRadius=Pt-ue*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-ue*I,0),this.updateElements(m,0,m.length,l)}_circumference(l,n){let s=this.options,d=this._cachedMeta,m=this._getCircumference();return n&&s.animation.animateRotate||!this.chart.getDataVisibility(l)||d._parsed[l]===null||d.data[l].hidden?0:this.calculateCircumference(d._parsed[l]*m/mr)}updateElements(l,n,s,d){let m=d==="reset",_=this.chart,w=_.chartArea,I=_.options.animation,L=(w.left+w.right)/2,H=(w.top+w.bottom)/2,q=m&&I.animateScale,X=q?0:this.innerRadius,it=q?0:this.outerRadius,{sharedOptions:at,includeOptions:mt}=this._getSharedOptions(n,d),Mt=this._getRotation(),Lt;for(Lt=0;Lt<n;++Lt)Mt+=this._circumference(Lt,m);for(Lt=n;Lt<n+s;++Lt){let Pt=this._circumference(Lt,m),Nt=l[Lt],ue={x:L+this.offsetX,y:H+this.offsetY,startAngle:Mt,endAngle:Mt+Pt,circumference:Pt,outerRadius:it,innerRadius:X};mt&&(ue.options=at||this.resolveDataElementOptions(Lt,Nt.active?"active":d)),Mt+=Pt,this.updateElement(Nt,Lt,ue,d)}}calculateTotal(){let l=this._cachedMeta,n=l.data,s=0,d;for(d=0;d<n.length;d++){let m=l._parsed[d];m!==null&&!isNaN(m)&&this.chart.getDataVisibility(d)&&!n[d].hidden&&(s+=Math.abs(m))}return s}calculateCircumference(l){let n=this._cachedMeta.total;return n>0&&!isNaN(l)?mr*(Math.abs(l)/n):0}getLabelAndValue(l){let n=this._cachedMeta,s=this.chart,d=s.data.labels||[],m=jm(n._parsed[l],s.options.locale);return{label:d[l]||"",value:m}}getMaxBorderWidth(l){let n=0,s=this.chart,d,m,_,w,S;if(!l){for(d=0,m=s.data.datasets.length;d<m;++d)if(s.isDatasetVisible(d)){_=s.getDatasetMeta(d),l=_.data,w=_.controller;break}}if(!l)return 0;for(d=0,m=l.length;d<m;++d)S=w.resolveDataElementOptions(d),S.borderAlign!=="inner"&&(n=Math.max(n,S.borderWidth||0,S.hoverBorderWidth||0));return n}getMaxOffset(l){let n=0;for(let s=0,d=l.length;s<d;++s){let m=this.resolveDataElementOptions(s);n=Math.max(n,m.offset||0,m.hoverOffset||0)}return n}_getRingWeightOffset(l){let n=0;for(let s=0;s<l;++s)this.chart.isDatasetVisible(s)&&(n+=this._getRingWeight(s));return n}_getRingWeight(l){return Math.max(nn(this.chart.data.datasets[l].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}return a.id="doughnut",a.defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"},a.descriptors={_scriptable:r=>r!=="spacing",_indexable:r=>r!=="spacing"},a.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(r){let l=r.data;if(l.labels.length&&l.datasets.length){let{labels:{pointStyle:n}}=r.legend.options;return l.labels.map((s,d)=>{let _=r.getDatasetMeta(0).controller.getStyle(d);return{text:s,fillStyle:_.backgroundColor,strokeStyle:_.borderColor,lineWidth:_.borderWidth,pointStyle:n,hidden:!r.getDataVisibility(d),index:d}})}return[]}},onClick(r,l,n){n.chart.toggleDataVisibility(l.index),n.chart.update()}},tooltip:{callbacks:{title(){return""},label(r){let l=r.label,n=": "+r.formattedValue;return Rr(l)?(l=l.slice(),l[0]+=n):l+=n,l}}}}},a})(),uet=(()=>{class a extends Ql{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(l){let n=this._cachedMeta,{dataset:s,data:d=[],_dataset:m}=n,_=this.chart._animationsDisabled,{start:w,count:S}=$M(n,d,_);this._drawStart=w,this._drawCount=S,YM(n)&&(w=0,S=d.length),s._chart=this.chart,s._datasetIndex=this.index,s._decimated=!!m._decimated,s.points=d;let I=this.resolveDatasetElementOptions(l);this.options.showLine||(I.borderWidth=0),I.segment=this.options.segment,this.updateElement(s,void 0,{animated:!_,options:I},l),this.updateElements(d,w,S,l)}updateElements(l,n,s,d){let m=d==="reset",{iScale:_,vScale:w,_stacked:S,_dataset:I}=this._cachedMeta,{sharedOptions:L,includeOptions:H}=this._getSharedOptions(n,d),q=_.axis,X=w.axis,{spanGaps:it,segment:at}=this.options,mt=Bu(it)?it:Number.POSITIVE_INFINITY,Mt=this.chart._animationsDisabled||m||d==="none",Lt=n>0&&this.getParsed(n-1);for(let Pt=n;Pt<n+s;++Pt){let Nt=l[Pt],ue=this.getParsed(Pt),Q=Mt?Nt:{},$t=zn(ue[X]),Ue=Q[q]=_.getPixelForValue(ue[q],Pt),ki=Q[X]=m||$t?w.getBasePixel():w.getPixelForValue(S?this.applyStack(w,ue,S):ue[X],Pt);Q.skip=isNaN(Ue)||isNaN(ki)||$t,Q.stop=Pt>0&&Math.abs(ue[q]-Lt[q])>mt,at&&(Q.parsed=ue,Q.raw=I.data[Pt]),H&&(Q.options=L||this.resolveDataElementOptions(Pt,Nt.active?"active":d)),Mt||this.updateElement(Nt,Pt,Q,d),Lt=ue}}getMaxOverflow(){let l=this._cachedMeta,n=l.dataset,s=n.options&&n.options.borderWidth||0,d=l.data||[];if(!d.length)return s;let m=d[0].size(this.resolveDataElementOptions(0)),_=d[d.length-1].size(this.resolveDataElementOptions(d.length-1));return Math.max(s,m,_)/2}draw(){let l=this._cachedMeta;l.dataset.updateControlPoints(this.chart.chartArea,l.iScale.axis),super.draw()}}return a.id="line",a.defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1},a.overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}},a})(),het=(()=>{class a extends Ql{constructor(l,n){super(l,n),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(l){let n=this._cachedMeta,s=this.chart,d=s.data.labels||[],m=jm(n._parsed[l].r,s.options.locale);return{label:d[l]||"",value:m}}parseObjectData(l,n,s,d){return oD.bind(this)(l,n,s,d)}update(l){let n=this._cachedMeta.data;this._updateRadius(),this.updateElements(n,0,n.length,l)}getMinMax(){let l=this._cachedMeta,n={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return l.data.forEach((s,d)=>{let m=this.getParsed(d).r;!isNaN(m)&&this.chart.getDataVisibility(d)&&(m<n.min&&(n.min=m),m>n.max&&(n.max=m))}),n}_updateRadius(){let l=this.chart,n=l.chartArea,s=l.options,d=Math.min(n.right-n.left,n.bottom-n.top),m=Math.max(d/2,0),_=Math.max(s.cutoutPercentage?m/100*s.cutoutPercentage:1,0),w=(m-_)/l.getVisibleDatasetCount();this.outerRadius=m-w*this.index,this.innerRadius=this.outerRadius-w}updateElements(l,n,s,d){let m=d==="reset",_=this.chart,S=_.options.animation,I=this._cachedMeta.rScale,L=I.xCenter,H=I.yCenter,q=I.getIndexAngle(0)-.5*Ur,X=q,it,at=360/this.countVisibleElements();for(it=0;it<n;++it)X+=this._computeAngle(it,d,at);for(it=n;it<n+s;it++){let mt=l[it],Mt=X,Lt=X+this._computeAngle(it,d,at),Pt=_.getDataVisibility(it)?I.getDistanceFromCenterForValue(this.getParsed(it).r):0;X=Lt,m&&(S.animateScale&&(Pt=0),S.animateRotate&&(Mt=Lt=q));let Nt={x:L,y:H,innerRadius:0,outerRadius:Pt,startAngle:Mt,endAngle:Lt,options:this.resolveDataElementOptions(it,mt.active?"active":d)};this.updateElement(mt,it,Nt,d)}}countVisibleElements(){let l=this._cachedMeta,n=0;return l.data.forEach((s,d)=>{!isNaN(this.getParsed(d).r)&&this.chart.getDataVisibility(d)&&n++}),n}_computeAngle(l,n,s){return this.chart.getDataVisibility(l)?Aa(this.resolveDataElementOptions(l,n).angle||s):0}}return a.id="polarArea",a.defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0},a.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(r){let l=r.data;if(l.labels.length&&l.datasets.length){let{labels:{pointStyle:n}}=r.legend.options;return l.labels.map((s,d)=>{let _=r.getDatasetMeta(0).controller.getStyle(d);return{text:s,fillStyle:_.backgroundColor,strokeStyle:_.borderColor,lineWidth:_.borderWidth,pointStyle:n,hidden:!r.getDataVisibility(d),index:d}})}return[]}},onClick(r,l,n){n.chart.toggleDataVisibility(l.index),n.chart.update()}},tooltip:{callbacks:{title(){return""},label(r){return r.chart.data.labels[r.dataIndex]+": "+r.formattedValue}}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}},a})(),met=(()=>{class a extends P4{}return a.id="pie",a.defaults={cutout:0,rotation:0,circumference:360,radius:"100%"},a})(),pet=(()=>{class a extends Ql{getLabelAndValue(l){let n=this._cachedMeta.vScale,s=this.getParsed(l);return{label:n.getLabels()[l],value:""+n.getLabelForValue(s[n.axis])}}parseObjectData(l,n,s,d){return oD.bind(this)(l,n,s,d)}update(l){let n=this._cachedMeta,s=n.dataset,d=n.data||[],m=n.iScale.getLabels();if(s.points=d,l!=="resize"){let _=this.resolveDatasetElementOptions(l);this.options.showLine||(_.borderWidth=0);let w={_loop:!0,_fullLoop:m.length===d.length,options:_};this.updateElement(s,void 0,w,l)}this.updateElements(d,0,d.length,l)}updateElements(l,n,s,d){let m=this._cachedMeta.rScale,_=d==="reset";for(let w=n;w<n+s;w++){let S=l[w],I=this.resolveDataElementOptions(w,S.active?"active":d),L=m.getPointPositionForValue(w,this.getParsed(w).r),H=_?m.xCenter:L.x,q=_?m.yCenter:L.y,X={x:H,y:q,angle:L.angle,skip:isNaN(H)||isNaN(q),options:I};this.updateElement(S,w,X,d)}}}return a.id="radar",a.defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}},a.overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}},a})(),oa=class{constructor(){this.x=void 0,this.y=void 0,this.active=!1,this.options=void 0,this.$animations=void 0}tooltipPosition(r){let{x:l,y:n}=this.getProps(["x","y"],r);return{x:l,y:n}}hasValue(){return Bu(this.x)&&Bu(this.y)}getProps(r,l){let n=this.$animations;if(!l||!n)return this;let s={};return r.forEach(d=>{s[d]=n[d]&&n[d].active()?n[d]._to:this[d]}),s}};oa.defaults={};oa.defaultRoutes=void 0;var O4={values(a){return Rr(a)?a:""+a},numeric(a,r,l){if(a===0)return"0";let n=this.chart.options.locale,s,d=a;if(l.length>1){let S=Math.max(Math.abs(l[0].value),Math.abs(l[l.length-1].value));(S<1e-4||S>1e15)&&(s="scientific"),d=fet(a,l)}let m=ra(Math.abs(d)),_=Math.max(Math.min(-1*Math.floor(m),20),0),w={notation:s,minimumFractionDigits:_,maximumFractionDigits:_};return Object.assign(w,this.options.ticks.format),jm(a,n,w)},logarithmic(a,r,l){if(a===0)return"0";let n=a/Math.pow(10,Math.floor(ra(a)));return n===1||n===2||n===5?O4.numeric.call(this,a,r,l):""}};function fet(a,r){let l=r.length>3?r[2].value-r[1].value:r[1].value-r[0].value;return Math.abs(l)>=1&&a!==Math.floor(a)&&(l=a-Math.floor(a)),l}var Mb={formatters:O4};An.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",grace:0,grid:{display:!0,lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(a,r)=>r.lineWidth,tickColor:(a,r)=>r.color,offset:!1,borderDash:[],borderDashOffset:0,borderWidth:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Mb.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}});An.route("scale.ticks","color","","color");An.route("scale.grid","color","","borderColor");An.route("scale.grid","borderColor","","borderColor");An.route("scale.title","color","","color");An.describe("scale",{_fallback:!1,_scriptable:a=>!a.startsWith("before")&&!a.startsWith("after")&&a!=="callback"&&a!=="parser",_indexable:a=>a!=="borderDash"&&a!=="tickBorderDash"});An.describe("scales",{_fallback:"scale"});An.describe("scale.ticks",{_scriptable:a=>a!=="backdropPadding"&&a!=="callback",_indexable:a=>a!=="backdropPadding"});function get(a,r){let l=a.options.ticks,n=l.maxTicksLimit||_et(a),s=l.major.enabled?yet(r):[],d=s.length,m=s[0],_=s[d-1],w=[];if(d>n)return bet(r,w,s,d/n),w;let S=vet(s,r,n);if(d>0){let I,L,H=d>1?Math.round((_-m)/(d-1)):null;for(mb(r,w,S,zn(H)?0:m-H,m),I=0,L=d-1;I<L;I++)mb(r,w,S,s[I],s[I+1]);return mb(r,w,S,_,zn(H)?r.length:_+H),w}return mb(r,w,S),w}function _et(a){let r=a.options.offset,l=a._tickSize(),n=a._length/l+(r?0:1),s=a._maxLength/l;return Math.floor(Math.min(n,s))}function vet(a,r,l){let n=xet(a),s=r.length/l;if(!n)return Math.max(s,1);let d=dB(n);for(let m=0,_=d.length-1;m<_;m++){let w=d[m];if(w>s)return w}return Math.max(s,1)}function yet(a){let r=[],l,n;for(l=0,n=a.length;l<n;l++)a[l].major&&r.push(l);return r}function bet(a,r,l,n){let s=0,d=l[0],m;for(n=Math.ceil(n),m=0;m<a.length;m++)m===d&&(r.push(a[m]),s++,d=l[s*n])}function mb(a,r,l,n,s){let d=nn(n,0),m=Math.min(nn(s,a.length),a.length),_=0,w,S,I;for(l=Math.ceil(l),s&&(w=s-n,l=w/Math.floor(w/l)),I=d;I<0;)_++,I=Math.round(d+_*l);for(S=Math.max(d,0);S<m;S++)S===I&&(r.push(a[S]),_++,I=Math.round(d+_*l))}function xet(a){let r=a.length,l,n;if(r<2)return!1;for(n=a[0],l=1;l<r;++l)if(a[l]-a[l-1]!==n)return!1;return n}var wet=a=>a==="left"?"right":a==="right"?"left":a,ZB=(a,r,l)=>r==="top"||r==="left"?a[r]+l:a[r]-l;function XB(a,r){let l=[],n=a.length/r,s=a.length,d=0;for(;d<s;d+=n)l.push(a[Math.floor(d)]);return l}function Cet(a,r,l){let n=a.ticks.length,s=Math.min(r,n-1),d=a._startPixel,m=a._endPixel,_=1e-6,w=a.getPixelForTick(s),S;if(!(l&&(n===1?S=Math.max(w-d,m-w):r===0?S=(a.getPixelForTick(1)-w)/2:S=(w-a.getPixelForTick(s-1))/2,w+=s<r?S:-S,w<d-_||w>m+_)))return w}function Eet(a,r){lr(a,l=>{let n=l.gc,s=n.length/2,d;if(s>r){for(d=0;d<s;++d)delete l.data[n[d]];n.splice(0,s)}})}function kg(a){return a.drawTicks?a.tickLength:0}function KB(a,r){if(!a.display)return 0;let l=No(a.font,r),n=ts(a.padding);return(Rr(a.text)?a.text.length:1)*l.lineHeight+n.height}function Met(a,r){return Fc(a,{scale:r,type:"scale"})}function Det(a,r,l){return Fc(a,{tick:l,index:r,type:"tick"})}function Tet(a,r,l){let n=sb(a);return(l&&r!=="right"||!l&&r==="right")&&(n=wet(n)),n}function Iet(a,r,l,n){let{top:s,left:d,bottom:m,right:_,chart:w}=a,{chartArea:S,scales:I}=w,L=0,H,q,X,it=m-s,at=_-d;if(a.isHorizontal()){if(q=Jo(n,d,_),In(l)){let mt=Object.keys(l)[0],Mt=l[mt];X=I[mt].getPixelForValue(Mt)+it-r}else l==="center"?X=(S.bottom+S.top)/2+it-r:X=ZB(a,l,r);H=_-d}else{if(In(l)){let mt=Object.keys(l)[0],Mt=l[mt];q=I[mt].getPixelForValue(Mt)-at+r}else l==="center"?q=(S.left+S.right)/2-at+r:q=ZB(a,l,r);X=Jo(n,m,s),L=l==="left"?-co:co}return{titleX:q,titleY:X,maxWidth:H,rotation:L}}var Uu=class a extends oa{constructor(r){super(),this.id=r.id,this.type=r.type,this.options=void 0,this.ctx=r.ctx,this.chart=r.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(r){this.options=r.setContext(this.getContext()),this.axis=r.axis,this._userMin=this.parse(r.min),this._userMax=this.parse(r.max),this._suggestedMin=this.parse(r.suggestedMin),this._suggestedMax=this.parse(r.suggestedMax)}parse(r,l){return r}getUserBounds(){let{_userMin:r,_userMax:l,_suggestedMin:n,_suggestedMax:s}=this;return r=na(r,Number.POSITIVE_INFINITY),l=na(l,Number.NEGATIVE_INFINITY),n=na(n,Number.POSITIVE_INFINITY),s=na(s,Number.NEGATIVE_INFINITY),{min:na(r,n),max:na(l,s),minDefined:_o(r),maxDefined:_o(l)}}getMinMax(r){let{min:l,max:n,minDefined:s,maxDefined:d}=this.getUserBounds(),m;if(s&&d)return{min:l,max:n};let _=this.getMatchingVisibleMetas();for(let w=0,S=_.length;w<S;++w)m=_[w].controller.getMinMax(this,r),s||(l=Math.min(l,m.min)),d||(n=Math.max(n,m.max));return l=d&&l>n?n:l,n=s&&l>n?l:n,{min:na(l,na(n,l)),max:na(n,na(l,n))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){let r=this.chart.data;return this.options.labels||(this.isHorizontal()?r.xLabels:r.yLabels)||r.labels||[]}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Pr(this.options.beforeUpdate,[this])}update(r,l,n){let{beginAtZero:s,grace:d,ticks:m}=this.options,_=m.sampleSize;this.beforeUpdate(),this.maxWidth=r,this.maxHeight=l,this._margins=n=Object.assign({left:0,right:0,top:0,bottom:0},n),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+n.left+n.right:this.height+n.top+n.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=DB(this,d,s),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();let w=_<this.ticks.length;this._convertTicksToLabels(w?XB(this.ticks,_):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),m.display&&(m.autoSkip||m.source==="auto")&&(this.ticks=get(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),w&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let r=this.options.reverse,l,n;this.isHorizontal()?(l=this.left,n=this.right):(l=this.top,n=this.bottom,r=!r),this._startPixel=l,this._endPixel=n,this._reversePixels=r,this._length=n-l,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Pr(this.options.afterUpdate,[this])}beforeSetDimensions(){Pr(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Pr(this.options.afterSetDimensions,[this])}_callHooks(r){this.chart.notifyPlugins(r,this.getContext()),Pr(this.options[r],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Pr(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(r){let l=this.options.ticks,n,s,d;for(n=0,s=r.length;n<s;n++)d=r[n],d.label=Pr(l.callback,[d.value,n,r],this)}afterTickToLabelConversion(){Pr(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Pr(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){let r=this.options,l=r.ticks,n=this.ticks.length,s=l.minRotation||0,d=l.maxRotation,m=s,_,w,S;if(!this._isVisible()||!l.display||s>=d||n<=1||!this.isHorizontal()){this.labelRotation=s;return}let I=this._getLabelSizes(),L=I.widest.width,H=I.highest.height,q=Ho(this.chart.width-L,0,this.maxWidth);_=r.offset?this.maxWidth/n:q/(n-1),L+6>_&&(_=q/(n-(r.offset?.5:1)),w=this.maxHeight-kg(r.grid)-l.padding-KB(r.title,this.chart.options.font),S=Math.sqrt(L*L+H*H),m=rb(Math.min(Math.asin(Ho((I.highest.height+6)/_,-1,1)),Math.asin(Ho(w/S,-1,1))-Math.asin(Ho(H/S,-1,1)))),m=Math.max(s,Math.min(d,m))),this.labelRotation=m}afterCalculateLabelRotation(){Pr(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Pr(this.options.beforeFit,[this])}fit(){let r={width:0,height:0},{chart:l,options:{ticks:n,title:s,grid:d}}=this,m=this._isVisible(),_=this.isHorizontal();if(m){let w=KB(s,l.options.font);if(_?(r.width=this.maxWidth,r.height=kg(d)+w):(r.height=this.maxHeight,r.width=kg(d)+w),n.display&&this.ticks.length){let{first:S,last:I,widest:L,highest:H}=this._getLabelSizes(),q=n.padding*2,X=Aa(this.labelRotation),it=Math.cos(X),at=Math.sin(X);if(_){let mt=n.mirror?0:at*L.width+it*H.height;r.height=Math.min(this.maxHeight,r.height+mt+q)}else{let mt=n.mirror?0:it*L.width+at*H.height;r.width=Math.min(this.maxWidth,r.width+mt+q)}this._calculatePadding(S,I,at,it)}}this._handleMargins(),_?(this.width=this._length=l.width-this._margins.left-this._margins.right,this.height=r.height):(this.width=r.width,this.height=this._length=l.height-this._margins.top-this._margins.bottom)}_calculatePadding(r,l,n,s){let{ticks:{align:d,padding:m},position:_}=this.options,w=this.labelRotation!==0,S=_!=="top"&&this.axis==="x";if(this.isHorizontal()){let I=this.getPixelForTick(0)-this.left,L=this.right-this.getPixelForTick(this.ticks.length-1),H=0,q=0;w?S?(H=s*r.width,q=n*l.height):(H=n*r.height,q=s*l.width):d==="start"?q=l.width:d==="end"?H=r.width:d!=="inner"&&(H=r.width/2,q=l.width/2),this.paddingLeft=Math.max((H-I+m)*this.width/(this.width-I),0),this.paddingRight=Math.max((q-L+m)*this.width/(this.width-L),0)}else{let I=l.height/2,L=r.height/2;d==="start"?(I=0,L=r.height):d==="end"&&(I=l.height,L=0),this.paddingTop=I+m,this.paddingBottom=L+m}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Pr(this.options.afterFit,[this])}isHorizontal(){let{axis:r,position:l}=this.options;return l==="top"||l==="bottom"||r==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(r){this.beforeTickToLabelConversion(),this.generateTickLabels(r);let l,n;for(l=0,n=r.length;l<n;l++)zn(r[l].label)&&(r.splice(l,1),n--,l--);this.afterTickToLabelConversion()}_getLabelSizes(){let r=this._labelSizes;if(!r){let l=this.options.ticks.sampleSize,n=this.ticks;l<n.length&&(n=XB(n,l)),this._labelSizes=r=this._computeLabelSizes(n,n.length)}return r}_computeLabelSizes(r,l){let{ctx:n,_longestTextCache:s}=this,d=[],m=[],_=0,w=0,S,I,L,H,q,X,it,at,mt,Mt,Lt;for(S=0;S<l;++S){if(H=r[S].label,q=this._resolveTickFontOptions(S),n.font=X=q.string,it=s[X]=s[X]||{data:{},gc:[]},at=q.lineHeight,mt=Mt=0,!zn(H)&&!Rr(H))mt=Eg(n,it.data,it.gc,mt,H),Mt=at;else if(Rr(H))for(I=0,L=H.length;I<L;++I)Lt=H[I],!zn(Lt)&&!Rr(Lt)&&(mt=Eg(n,it.data,it.gc,mt,Lt),Mt+=at);d.push(mt),m.push(Mt),_=Math.max(mt,_),w=Math.max(Mt,w)}Eet(s,l);let Pt=d.indexOf(_),Nt=m.indexOf(w),ue=Q=>({width:d[Q]||0,height:m[Q]||0});return{first:ue(0),last:ue(l-1),widest:ue(Pt),highest:ue(Nt),widths:d,heights:m}}getLabelForValue(r){return r}getPixelForValue(r,l){return NaN}getValueForPixel(r){}getPixelForTick(r){let l=this.ticks;return r<0||r>l.length-1?null:this.getPixelForValue(l[r].value)}getPixelForDecimal(r){this._reversePixels&&(r=1-r);let l=this._startPixel+r*this._length;return hB(this._alignToPixels?Ad(this.chart,l,0):l)}getDecimalForPixel(r){let l=(r-this._startPixel)/this._length;return this._reversePixels?1-l:l}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){let{min:r,max:l}=this;return r<0&&l<0?l:r>0&&l>0?r:0}getContext(r){let l=this.ticks||[];if(r>=0&&r<l.length){let n=l[r];return n.$context||(n.$context=Det(this.getContext(),r,n))}return this.$context||(this.$context=Met(this.chart.getContext(),this))}_tickSize(){let r=this.options.ticks,l=Aa(this.labelRotation),n=Math.abs(Math.cos(l)),s=Math.abs(Math.sin(l)),d=this._getLabelSizes(),m=r.autoSkipPadding||0,_=d?d.widest.width+m:0,w=d?d.highest.height+m:0;return this.isHorizontal()?w*n>_*s?_/n:w/s:w*s<_*n?w/n:_/s}_isVisible(){let r=this.options.display;return r!=="auto"?!!r:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(r){let l=this.axis,n=this.chart,s=this.options,{grid:d,position:m}=s,_=d.offset,w=this.isHorizontal(),I=this.ticks.length+(_?1:0),L=kg(d),H=[],q=d.setContext(this.getContext()),X=q.drawBorder?q.borderWidth:0,it=X/2,at=function(Ri){return Ad(n,Ri,X)},mt,Mt,Lt,Pt,Nt,ue,Q,$t,Ue,ki,fe,ei;if(m==="top")mt=at(this.bottom),ue=this.bottom-L,$t=mt-it,ki=at(r.top)+it,ei=r.bottom;else if(m==="bottom")mt=at(this.top),ki=r.top,ei=at(r.bottom)-it,ue=mt+it,$t=this.top+L;else if(m==="left")mt=at(this.right),Nt=this.right-L,Q=mt-it,Ue=at(r.left)+it,fe=r.right;else if(m==="right")mt=at(this.left),Ue=r.left,fe=at(r.right)-it,Nt=mt+it,Q=this.left+L;else if(l==="x"){if(m==="center")mt=at((r.top+r.bottom)/2+.5);else if(In(m)){let Ri=Object.keys(m)[0],Gn=m[Ri];mt=at(this.chart.scales[Ri].getPixelForValue(Gn))}ki=r.top,ei=r.bottom,ue=mt+it,$t=ue+L}else if(l==="y"){if(m==="center")mt=at((r.left+r.right)/2);else if(In(m)){let Ri=Object.keys(m)[0],Gn=m[Ri];mt=at(this.chart.scales[Ri].getPixelForValue(Gn))}Nt=mt-it,Q=Nt-L,Ue=r.left,fe=r.right}let Oi=nn(s.ticks.maxTicksLimit,I),Dr=Math.max(1,Math.ceil(I/Oi));for(Mt=0;Mt<I;Mt+=Dr){let Ri=d.setContext(this.getContext(Mt)),Gn=Ri.lineWidth,_n=Ri.color,fr=Ri.borderDash||[],ve=Ri.borderDashOffset,Wo=Ri.tickWidth,ss=Ri.tickColor,_s=Ri.tickBorderDash||[],qs=Ri.tickBorderDashOffset;Lt=Cet(this,Mt,_),Lt!==void 0&&(Pt=Ad(n,Lt,Gn),w?Nt=Q=Ue=fe=Pt:ue=$t=ki=ei=Pt,H.push({tx1:Nt,ty1:ue,tx2:Q,ty2:$t,x1:Ue,y1:ki,x2:fe,y2:ei,width:Gn,color:_n,borderDash:fr,borderDashOffset:ve,tickWidth:Wo,tickColor:ss,tickBorderDash:_s,tickBorderDashOffset:qs}))}return this._ticksLength=I,this._borderValue=mt,H}_computeLabelItems(r){let l=this.axis,n=this.options,{position:s,ticks:d}=n,m=this.isHorizontal(),_=this.ticks,{align:w,crossAlign:S,padding:I,mirror:L}=d,H=kg(n.grid),q=H+I,X=L?-I:q,it=-Aa(this.labelRotation),at=[],mt,Mt,Lt,Pt,Nt,ue,Q,$t,Ue,ki,fe,ei,Oi="middle";if(s==="top")ue=this.bottom-X,Q=this._getXAxisLabelAlignment();else if(s==="bottom")ue=this.top+X,Q=this._getXAxisLabelAlignment();else if(s==="left"){let Ri=this._getYAxisLabelAlignment(H);Q=Ri.textAlign,Nt=Ri.x}else if(s==="right"){let Ri=this._getYAxisLabelAlignment(H);Q=Ri.textAlign,Nt=Ri.x}else if(l==="x"){if(s==="center")ue=(r.top+r.bottom)/2+q;else if(In(s)){let Ri=Object.keys(s)[0],Gn=s[Ri];ue=this.chart.scales[Ri].getPixelForValue(Gn)+q}Q=this._getXAxisLabelAlignment()}else if(l==="y"){if(s==="center")Nt=(r.left+r.right)/2-q;else if(In(s)){let Ri=Object.keys(s)[0],Gn=s[Ri];Nt=this.chart.scales[Ri].getPixelForValue(Gn)}Q=this._getYAxisLabelAlignment(H).textAlign}l==="y"&&(w==="start"?Oi="top":w==="end"&&(Oi="bottom"));let Dr=this._getLabelSizes();for(mt=0,Mt=_.length;mt<Mt;++mt){Lt=_[mt],Pt=Lt.label;let Ri=d.setContext(this.getContext(mt));$t=this.getPixelForTick(mt)+d.labelOffset,Ue=this._resolveTickFontOptions(mt),ki=Ue.lineHeight,fe=Rr(Pt)?Pt.length:1;let Gn=fe/2,_n=Ri.color,fr=Ri.textStrokeColor,ve=Ri.textStrokeWidth,Wo=Q;m?(Nt=$t,Q==="inner"&&(mt===Mt-1?Wo=this.options.reverse?"left":"right":mt===0?Wo=this.options.reverse?"right":"left":Wo="center"),s==="top"?S==="near"||it!==0?ei=-fe*ki+ki/2:S==="center"?ei=-Dr.highest.height/2-Gn*ki+ki:ei=-Dr.highest.height+ki/2:S==="near"||it!==0?ei=ki/2:S==="center"?ei=Dr.highest.height/2-Gn*ki:ei=Dr.highest.height-fe*ki,L&&(ei*=-1)):(ue=$t,ei=(1-fe)*ki/2);let ss;if(Ri.showLabelBackdrop){let _s=ts(Ri.backdropPadding),qs=Dr.heights[mt],ge=Dr.widths[mt],Go=ue+ei-_s.top,Hd=Nt-_s.left;switch(Oi){case"middle":Go-=qs/2;break;case"bottom":Go-=qs;break}switch(Q){case"center":Hd-=ge/2;break;case"right":Hd-=ge;break}ss={left:Hd,top:Go,width:ge+_s.width,height:qs+_s.height,color:Ri.backdropColor}}at.push({rotation:it,label:Pt,font:Ue,color:_n,strokeColor:fr,strokeWidth:ve,textOffset:ei,textAlign:Wo,textBaseline:Oi,translation:[Nt,ue],backdrop:ss})}return at}_getXAxisLabelAlignment(){let{position:r,ticks:l}=this.options;if(-Aa(this.labelRotation))return r==="top"?"left":"right";let s="center";return l.align==="start"?s="left":l.align==="end"?s="right":l.align==="inner"&&(s="inner"),s}_getYAxisLabelAlignment(r){let{position:l,ticks:{crossAlign:n,mirror:s,padding:d}}=this.options,m=this._getLabelSizes(),_=r+d,w=m.widest.width,S,I;return l==="left"?s?(I=this.right+d,n==="near"?S="left":n==="center"?(S="center",I+=w/2):(S="right",I+=w)):(I=this.right-_,n==="near"?S="right":n==="center"?(S="center",I-=w/2):(S="left",I=this.left)):l==="right"?s?(I=this.left+d,n==="near"?S="right":n==="center"?(S="center",I-=w/2):(S="left",I-=w)):(I=this.left+_,n==="near"?S="left":n==="center"?(S="center",I+=w/2):(S="right",I=this.right)):S="right",{textAlign:S,x:I}}_computeLabelArea(){if(this.options.ticks.mirror)return;let r=this.chart,l=this.options.position;if(l==="left"||l==="right")return{top:0,left:this.left,bottom:r.height,right:this.right};if(l==="top"||l==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:r.width}}drawBackground(){let{ctx:r,options:{backgroundColor:l},left:n,top:s,width:d,height:m}=this;l&&(r.save(),r.fillStyle=l,r.fillRect(n,s,d,m),r.restore())}getLineWidthForValue(r){let l=this.options.grid;if(!this._isVisible()||!l.display)return 0;let s=this.ticks.findIndex(d=>d.value===r);return s>=0?l.setContext(this.getContext(s)).lineWidth:0}drawGrid(r){let l=this.options.grid,n=this.ctx,s=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(r)),d,m,_=(w,S,I)=>{!I.width||!I.color||(n.save(),n.lineWidth=I.width,n.strokeStyle=I.color,n.setLineDash(I.borderDash||[]),n.lineDashOffset=I.borderDashOffset,n.beginPath(),n.moveTo(w.x,w.y),n.lineTo(S.x,S.y),n.stroke(),n.restore())};if(l.display)for(d=0,m=s.length;d<m;++d){let w=s[d];l.drawOnChartArea&&_({x:w.x1,y:w.y1},{x:w.x2,y:w.y2},w),l.drawTicks&&_({x:w.tx1,y:w.ty1},{x:w.tx2,y:w.ty2},{color:w.tickColor,width:w.tickWidth,borderDash:w.tickBorderDash,borderDashOffset:w.tickBorderDashOffset})}}drawBorder(){let{chart:r,ctx:l,options:{grid:n}}=this,s=n.setContext(this.getContext()),d=n.drawBorder?s.borderWidth:0;if(!d)return;let m=n.setContext(this.getContext(0)).lineWidth,_=this._borderValue,w,S,I,L;this.isHorizontal()?(w=Ad(r,this.left,d)-d/2,S=Ad(r,this.right,m)+m/2,I=L=_):(I=Ad(r,this.top,d)-d/2,L=Ad(r,this.bottom,m)+m/2,w=S=_),l.save(),l.lineWidth=s.borderWidth,l.strokeStyle=s.borderColor,l.beginPath(),l.moveTo(w,I),l.lineTo(S,L),l.stroke(),l.restore()}drawLabels(r){if(!this.options.ticks.display)return;let n=this.ctx,s=this._computeLabelArea();s&&Tg(n,s);let d=this._labelItems||(this._labelItems=this._computeLabelItems(r)),m,_;for(m=0,_=d.length;m<_;++m){let w=d[m],S=w.font,I=w.label;w.backdrop&&(n.fillStyle=w.backdrop.color,n.fillRect(w.backdrop.left,w.backdrop.top,w.backdrop.width,w.backdrop.height));let L=w.textOffset;kd(n,I,0,L,S,w)}s&&Ig(n)}drawTitle(){let{ctx:r,options:{position:l,title:n,reverse:s}}=this;if(!n.display)return;let d=No(n.font),m=ts(n.padding),_=n.align,w=d.lineHeight/2;l==="bottom"||l==="center"||In(l)?(w+=m.bottom,Rr(n.text)&&(w+=d.lineHeight*(n.text.length-1))):w+=m.top;let{titleX:S,titleY:I,maxWidth:L,rotation:H}=Iet(this,w,l,_);kd(r,n.text,0,0,d,{color:n.color,maxWidth:L,rotation:H,textAlign:Tet(_,l,s),textBaseline:"middle",translation:[S,I]})}draw(r){this._isVisible()&&(this.drawBackground(),this.drawGrid(r),this.drawBorder(),this.drawTitle(),this.drawLabels(r))}_layers(){let r=this.options,l=r.ticks&&r.ticks.z||0,n=nn(r.grid&&r.grid.z,-1);return!this._isVisible()||this.draw!==a.prototype.draw?[{z:l,draw:s=>{this.draw(s)}}]:[{z:n,draw:s=>{this.drawBackground(),this.drawGrid(s),this.drawTitle()}},{z:n+1,draw:()=>{this.drawBorder()}},{z:l,draw:s=>{this.drawLabels(s)}}]}getMatchingVisibleMetas(r){let l=this.chart.getSortedVisibleDatasetMetas(),n=this.axis+"AxisID",s=[],d,m;for(d=0,m=l.length;d<m;++d){let _=l[d];_[n]===this.id&&(!r||_.type===r)&&s.push(_)}return s}_resolveTickFontOptions(r){let l=this.options.ticks.setContext(this.getContext(r));return No(l.font)}_maxDigits(){let r=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/r}},Hm=class{constructor(r,l,n){this.type=r,this.scope=l,this.override=n,this.items=Object.create(null)}isForType(r){return Object.prototype.isPrototypeOf.call(this.type.prototype,r.prototype)}register(r){let l=Object.getPrototypeOf(r),n;Ret(l)&&(n=this.register(l));let s=this.items,d=r.id,m=this.scope+"."+d;if(!d)throw new Error("class does not have id: "+r);return d in s||(s[d]=r,Aet(r,m,n),this.override&&An.override(r.id,r.overrides)),m}get(r){return this.items[r]}unregister(r){let l=this.items,n=r.id,s=this.scope;n in l&&delete l[n],s&&n in An[s]&&(delete An[s][n],this.override&&delete Id[n])}};function Aet(a,r,l){let n=Pm(Object.create(null),[l?An.get(l):{},An.get(r),a.defaults]);An.set(r,n),a.defaultRoutes&&ket(r,a.defaultRoutes),a.descriptors&&An.describe(r,a.descriptors)}function ket(a,r){Object.keys(r).forEach(l=>{let n=l.split("."),s=n.pop(),d=[a].concat(n).join("."),m=r[l].split("."),_=m.pop(),w=m.join(".");An.route(d,s,w,_)})}function Ret(a){return"id"in a&&"defaults"in a}var SD=class{constructor(){this.controllers=new Hm(Ql,"datasets",!0),this.elements=new Hm(oa,"elements"),this.plugins=new Hm(Object,"plugins"),this.scales=new Hm(Uu,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...r){this._each("register",r)}remove(...r){this._each("unregister",r)}addControllers(...r){this._each("register",r,this.controllers)}addElements(...r){this._each("register",r,this.elements)}addPlugins(...r){this._each("register",r,this.plugins)}addScales(...r){this._each("register",r,this.scales)}getController(r){return this._get(r,this.controllers,"controller")}getElement(r){return this._get(r,this.elements,"element")}getPlugin(r){return this._get(r,this.plugins,"plugin")}getScale(r){return this._get(r,this.scales,"scale")}removeControllers(...r){this._each("unregister",r,this.controllers)}removeElements(...r){this._each("unregister",r,this.elements)}removePlugins(...r){this._each("unregister",r,this.plugins)}removeScales(...r){this._each("unregister",r,this.scales)}_each(r,l,n){[...l].forEach(s=>{let d=n||this._getRegistryForType(s);n||d.isForType(s)||d===this.plugins&&s.id?this._exec(r,d,s):lr(s,m=>{let _=n||this._getRegistryForType(m);this._exec(r,_,m)})})}_exec(r,l,n){let s=nb(r);Pr(n["before"+s],[],n),l[r](n),Pr(n["after"+s],[],n)}_getRegistryForType(r){for(let l=0;l<this._typedRegistries.length;l++){let n=this._typedRegistries[l];if(n.isForType(r))return n}return this.plugins}_get(r,l,n){let s=l.get(r);if(s===void 0)throw new Error('"'+r+'" is not a registered '+n+".");return s}},Xl=new SD,Pet=(()=>{class a extends Ql{update(l){let n=this._cachedMeta,{data:s=[]}=n,d=this.chart._animationsDisabled,{start:m,count:_}=$M(n,s,d);if(this._drawStart=m,this._drawCount=_,YM(n)&&(m=0,_=s.length),this.options.showLine){let{dataset:w,_dataset:S}=n;w._chart=this.chart,w._datasetIndex=this.index,w._decimated=!!S._decimated,w.points=s;let I=this.resolveDatasetElementOptions(l);I.segment=this.options.segment,this.updateElement(w,void 0,{animated:!d,options:I},l)}this.updateElements(s,m,_,l)}addElements(){let{showLine:l}=this.options;!this.datasetElementType&&l&&(this.datasetElementType=Xl.getElement("line")),super.addElements()}updateElements(l,n,s,d){let m=d==="reset",{iScale:_,vScale:w,_stacked:S,_dataset:I}=this._cachedMeta,L=this.resolveDataElementOptions(n,d),H=this.getSharedOptions(L),q=this.includeOptions(d,H),X=_.axis,it=w.axis,{spanGaps:at,segment:mt}=this.options,Mt=Bu(at)?at:Number.POSITIVE_INFINITY,Lt=this.chart._animationsDisabled||m||d==="none",Pt=n>0&&this.getParsed(n-1);for(let Nt=n;Nt<n+s;++Nt){let ue=l[Nt],Q=this.getParsed(Nt),$t=Lt?ue:{},Ue=zn(Q[it]),ki=$t[X]=_.getPixelForValue(Q[X],Nt),fe=$t[it]=m||Ue?w.getBasePixel():w.getPixelForValue(S?this.applyStack(w,Q,S):Q[it],Nt);$t.skip=isNaN(ki)||isNaN(fe)||Ue,$t.stop=Nt>0&&Math.abs(Q[X]-Pt[X])>Mt,mt&&($t.parsed=Q,$t.raw=I.data[Nt]),q&&($t.options=H||this.resolveDataElementOptions(Nt,ue.active?"active":d)),Lt||this.updateElement(ue,Nt,$t,d),Pt=Q}this.updateSharedOptions(H,d,L)}getMaxOverflow(){let l=this._cachedMeta,n=l.data||[];if(!this.options.showLine){let w=0;for(let S=n.length-1;S>=0;--S)w=Math.max(w,n[S].size(this.resolveDataElementOptions(S))/2);return w>0&&w}let s=l.dataset,d=s.options&&s.options.borderWidth||0;if(!n.length)return d;let m=n[0].size(this.resolveDataElementOptions(0)),_=n[n.length-1].size(this.resolveDataElementOptions(n.length-1));return Math.max(d,m,_)/2}}return a.id="scatter",a.defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1},a.overrides={interaction:{mode:"point"},plugins:{tooltip:{callbacks:{title(){return""},label(r){return"("+r.label+", "+r.formattedValue+")"}}}},scales:{x:{type:"linear"},y:{type:"linear"}}},a})(),Oet=Object.freeze({__proto__:null,BarController:aet,BubbleController:cet,DoughnutController:P4,LineController:uet,PolarAreaController:het,PieController:met,RadarController:pet,ScatterController:Pet});function ju(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}var Fet=(()=>{class a{constructor(l){this.options=l||{}}init(l){}formats(){return ju()}parse(l,n){return ju()}format(l,n){return ju()}add(l,n,s){return ju()}diff(l,n,s){return ju()}startOf(l,n,s){return ju()}endOf(l,n){return ju()}}return a.override=function(r){Object.assign(a.prototype,r)},a})(),Let={_date:Fet};function zet(a,r,l,n){let{controller:s,data:d,_sorted:m}=a,_=s._cachedMeta.iScale;if(_&&r===_.axis&&r!=="r"&&m&&d.length){let w=_._reversePixels?mB:Wl;if(n){if(s._sharedOptions){let S=d[0],I=typeof S.getRange=="function"&&S.getRange(r);if(I){let L=w(d,r,l-I),H=w(d,r,l+I);return{lo:L.lo,hi:H.hi}}}}else return w(d,r,l)}return{lo:0,hi:d.length-1}}function Ug(a,r,l,n,s){let d=a.getSortedVisibleDatasetMetas(),m=l[r];for(let _=0,w=d.length;_<w;++_){let{index:S,data:I}=d[_],{lo:L,hi:H}=zet(d[_],r,m,s);for(let q=L;q<=H;++q){let X=I[q];X.skip||n(X,S,q)}}}function Net(a){let r=a.indexOf("x")!==-1,l=a.indexOf("y")!==-1;return function(n,s){let d=r?Math.abs(n.x-s.x):0,m=l?Math.abs(n.y-s.y):0;return Math.sqrt(Math.pow(d,2)+Math.pow(m,2))}}function gD(a,r,l,n,s){let d=[];return!s&&!a.isPointInArea(r)||Ug(a,l,r,function(_,w,S){!s&&!Om(_,a.chartArea,0)||_.inRange(r.x,r.y,n)&&d.push({element:_,datasetIndex:w,index:S})},!0),d}function Bet(a,r,l,n){let s=[];function d(m,_,w){let{startAngle:S,endAngle:I}=m.getProps(["startAngle","endAngle"],n),{angle:L}=UM(m,{x:r.x,y:r.y});Nm(L,S,I)&&s.push({element:m,datasetIndex:_,index:w})}return Ug(a,l,r,d),s}function Vet(a,r,l,n,s,d){let m=[],_=Net(l),w=Number.POSITIVE_INFINITY;function S(I,L,H){let q=I.inRange(r.x,r.y,s);if(n&&!q)return;let X=I.getCenterPoint(s);if(!(!!d||a.isPointInArea(X))&&!q)return;let at=_(r,X);at<w?(m=[{element:I,datasetIndex:L,index:H}],w=at):at===w&&m.push({element:I,datasetIndex:L,index:H})}return Ug(a,l,r,S),m}function _D(a,r,l,n,s,d){return!d&&!a.isPointInArea(r)?[]:l==="r"&&!n?Bet(a,r,l,s):Vet(a,r,l,n,s,d)}function QB(a,r,l,n,s){let d=[],m=l==="x"?"inXRange":"inYRange",_=!1;return Ug(a,l,r,(w,S,I)=>{w[m](r[l],s)&&(d.push({element:w,datasetIndex:S,index:I}),_=_||w.inRange(r.x,r.y,s))}),n&&!_?[]:d}var jet={evaluateInteractionItems:Ug,modes:{index(a,r,l,n){let s=Pd(r,a),d=l.axis||"x",m=l.includeInvisible||!1,_=l.intersect?gD(a,s,d,n,m):_D(a,s,d,!1,n,m),w=[];return _.length?(a.getSortedVisibleDatasetMetas().forEach(S=>{let I=_[0].index,L=S.data[I];L&&!L.skip&&w.push({element:L,datasetIndex:S.index,index:I})}),w):[]},dataset(a,r,l,n){let s=Pd(r,a),d=l.axis||"xy",m=l.includeInvisible||!1,_=l.intersect?gD(a,s,d,n,m):_D(a,s,d,!1,n,m);if(_.length>0){let w=_[0].datasetIndex,S=a.getDatasetMeta(w).data;_=[];for(let I=0;I<S.length;++I)_.push({element:S[I],datasetIndex:w,index:I})}return _},point(a,r,l,n){let s=Pd(r,a),d=l.axis||"xy",m=l.includeInvisible||!1;return gD(a,s,d,n,m)},nearest(a,r,l,n){let s=Pd(r,a),d=l.axis||"xy",m=l.includeInvisible||!1;return _D(a,s,d,l.intersect,n,m)},x(a,r,l,n){let s=Pd(r,a);return QB(a,s,"x",l.intersect,n)},y(a,r,l,n){let s=Pd(r,a);return QB(a,s,"y",l.intersect,n)}}},F4=["left","top","right","bottom"];function Rg(a,r){return a.filter(l=>l.pos===r)}function JB(a,r){return a.filter(l=>F4.indexOf(l.pos)===-1&&l.box.axis===r)}function Pg(a,r){return a.sort((l,n)=>{let s=r?n:l,d=r?l:n;return s.weight===d.weight?s.index-d.index:s.weight-d.weight})}function Uet(a){let r=[],l,n,s,d,m,_;for(l=0,n=(a||[]).length;l<n;++l)s=a[l],{position:d,options:{stack:m,stackWeight:_=1}}=s,r.push({index:l,box:s,pos:d,horizontal:s.isHorizontal(),weight:s.weight,stack:m&&d+m,stackWeight:_});return r}function Het(a){let r={};for(let l of a){let{stack:n,pos:s,stackWeight:d}=l;if(!n||!F4.includes(s))continue;let m=r[n]||(r[n]={count:0,placed:0,weight:0,size:0});m.count++,m.weight+=d}return r}function Get(a,r){let l=Het(a),{vBoxMaxWidth:n,hBoxMaxHeight:s}=r,d,m,_;for(d=0,m=a.length;d<m;++d){_=a[d];let{fullSize:w}=_.box,S=l[_.stack],I=S&&_.stackWeight/S.weight;_.horizontal?(_.width=I?I*n:w&&r.availableWidth,_.height=s):(_.width=n,_.height=I?I*s:w&&r.availableHeight)}return l}function qet(a){let r=Uet(a),l=Pg(r.filter(S=>S.box.fullSize),!0),n=Pg(Rg(r,"left"),!0),s=Pg(Rg(r,"right")),d=Pg(Rg(r,"top"),!0),m=Pg(Rg(r,"bottom")),_=JB(r,"x"),w=JB(r,"y");return{fullSize:l,leftAndTop:n.concat(d),rightAndBottom:s.concat(w).concat(m).concat(_),chartArea:Rg(r,"chartArea"),vertical:n.concat(s).concat(w),horizontal:d.concat(m).concat(_)}}function t4(a,r,l,n){return Math.max(a[l],r[l])+Math.max(a[n],r[n])}function L4(a,r){a.top=Math.max(a.top,r.top),a.left=Math.max(a.left,r.left),a.bottom=Math.max(a.bottom,r.bottom),a.right=Math.max(a.right,r.right)}function Wet(a,r,l,n){let{pos:s,box:d}=l,m=a.maxPadding;if(!In(s)){l.size&&(a[s]-=l.size);let L=n[l.stack]||{size:0,count:1};L.size=Math.max(L.size,l.horizontal?d.height:d.width),l.size=L.size/L.count,a[s]+=l.size}d.getPadding&&L4(m,d.getPadding());let _=Math.max(0,r.outerWidth-t4(m,a,"left","right")),w=Math.max(0,r.outerHeight-t4(m,a,"top","bottom")),S=_!==a.w,I=w!==a.h;return a.w=_,a.h=w,l.horizontal?{same:S,other:I}:{same:I,other:S}}function $et(a){let r=a.maxPadding;function l(n){let s=Math.max(r[n]-a[n],0);return a[n]+=s,s}a.y+=l("top"),a.x+=l("left"),l("right"),l("bottom")}function Yet(a,r){let l=r.maxPadding;function n(s){let d={left:0,top:0,right:0,bottom:0};return s.forEach(m=>{d[m]=Math.max(r[m],l[m])}),d}return n(a?["left","right"]:["top","bottom"])}function Fg(a,r,l,n){let s=[],d,m,_,w,S,I;for(d=0,m=a.length,S=0;d<m;++d){_=a[d],w=_.box,w.update(_.width||r.w,_.height||r.h,Yet(_.horizontal,r));let{same:L,other:H}=Wet(r,l,_,n);S|=L&&s.length,I=I||H,w.fullSize||s.push(_)}return S&&Fg(s,r,l,n)||I}function pb(a,r,l,n,s){a.top=l,a.left=r,a.right=r+n,a.bottom=l+s,a.width=n,a.height=s}function e4(a,r,l,n){let s=l.padding,{x:d,y:m}=r;for(let _ of a){let w=_.box,S=n[_.stack]||{count:1,placed:0,weight:1},I=_.stackWeight/S.weight||1;if(_.horizontal){let L=r.w*I,H=S.size||w.height;ia(S.start)&&(m=S.start),w.fullSize?pb(w,s.left,m,l.outerWidth-s.right-s.left,H):pb(w,r.left+S.placed,m,L,H),S.start=m,S.placed+=L,m=w.bottom}else{let L=r.h*I,H=S.size||w.width;ia(S.start)&&(d=S.start),w.fullSize?pb(w,d,s.top,H,l.outerHeight-s.bottom-s.top):pb(w,d,r.top+S.placed,H,L),S.start=d,S.placed+=L,d=w.right}}r.x=d,r.y=m}An.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}});var os={addBox(a,r){a.boxes||(a.boxes=[]),r.fullSize=r.fullSize||!1,r.position=r.position||"top",r.weight=r.weight||0,r._layers=r._layers||function(){return[{z:0,draw(l){r.draw(l)}}]},a.boxes.push(r)},removeBox(a,r){let l=a.boxes?a.boxes.indexOf(r):-1;l!==-1&&a.boxes.splice(l,1)},configure(a,r,l){r.fullSize=l.fullSize,r.position=l.position,r.weight=l.weight},update(a,r,l,n){if(!a)return;let s=ts(a.options.layout.padding),d=Math.max(r-s.width,0),m=Math.max(l-s.height,0),_=qet(a.boxes),w=_.vertical,S=_.horizontal;lr(a.boxes,it=>{typeof it.beforeLayout=="function"&&it.beforeLayout()});let I=w.reduce((it,at)=>at.box.options&&at.box.options.display===!1?it:it+1,0)||1,L=Object.freeze({outerWidth:r,outerHeight:l,padding:s,availableWidth:d,availableHeight:m,vBoxMaxWidth:d/2/I,hBoxMaxHeight:m/2}),H=Object.assign({},s);L4(H,ts(n));let q=Object.assign({maxPadding:H,w:d,h:m,x:s.left,y:s.top},s),X=Get(w.concat(S),L);Fg(_.fullSize,q,L,X),Fg(w,q,L,X),Fg(S,q,L,X)&&Fg(w,q,L,X),$et(q),e4(_.leftAndTop,q,L,X),q.x+=q.w,q.y+=q.h,e4(_.rightAndBottom,q,L,X),a.chartArea={left:q.left,top:q.top,right:q.left+q.w,bottom:q.top+q.h,height:q.h,width:q.w},lr(_.chartArea,it=>{let at=it.box;Object.assign(at,a.chartArea),at.update(q.w,q.h,{left:0,top:0,right:0,bottom:0})})}},xb=class{acquireContext(r,l){}releaseContext(r){return!1}addEventListener(r,l,n){}removeEventListener(r,l,n){}getDevicePixelRatio(){return 1}getMaximumSize(r,l,n,s){return l=Math.max(0,l||r.width),n=n||r.height,{width:l,height:Math.max(0,s?Math.floor(l/s):n)}}isAttached(r){return!0}updateConfig(r){}},ED=class extends xb{acquireContext(r){return r&&r.getContext&&r.getContext("2d")||null}updateConfig(r){r.options.animation=!1}},yb="$chartjs",Zet={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},i4=a=>a===null||a==="";function Xet(a,r){let l=a.style,n=a.getAttribute("height"),s=a.getAttribute("width");if(a[yb]={initial:{height:n,width:s,style:{display:l.display,height:l.height,width:l.width}}},l.display=l.display||"block",l.boxSizing=l.boxSizing||"border-box",i4(s)){let d=lD(a,"width");d!==void 0&&(a.width=d)}if(i4(n))if(a.style.height==="")a.height=a.width/(r||2);else{let d=lD(a,"height");d!==void 0&&(a.height=d)}return a}var z4=OB?{passive:!0}:!1;function Ket(a,r,l){a.addEventListener(r,l,z4)}function Qet(a,r,l){a.canvas.removeEventListener(r,l,z4)}function Jet(a,r){let l=Zet[a.type]||a.type,{x:n,y:s}=Pd(a,r);return{type:l,chart:r,native:a,x:n!==void 0?n:null,y:s!==void 0?s:null}}function wb(a,r){for(let l of a)if(l===r||l.contains(r))return!0}function tit(a,r,l){let n=a.canvas,s=new MutationObserver(d=>{let m=!1;for(let _ of d)m=m||wb(_.addedNodes,n),m=m&&!wb(_.removedNodes,n);m&&l()});return s.observe(document,{childList:!0,subtree:!0}),s}function eit(a,r,l){let n=a.canvas,s=new MutationObserver(d=>{let m=!1;for(let _ of d)m=m||wb(_.removedNodes,n),m=m&&!wb(_.addedNodes,n);m&&l()});return s.observe(document,{childList:!0,subtree:!0}),s}var zg=new Map,n4=0;function N4(){let a=window.devicePixelRatio;a!==n4&&(n4=a,zg.forEach((r,l)=>{l.currentDevicePixelRatio!==a&&r()}))}function iit(a,r){zg.size||window.addEventListener("resize",N4),zg.set(a,r)}function nit(a){zg.delete(a),zg.size||window.removeEventListener("resize",N4)}function rit(a,r,l){let n=a.canvas,s=n&&ub(n);if(!s)return;let d=WM((_,w)=>{let S=s.clientWidth;l(_,w),S<s.clientWidth&&l()},window),m=new ResizeObserver(_=>{let w=_[0],S=w.contentRect.width,I=w.contentRect.height;S===0&&I===0||d(S,I)});return m.observe(s),iit(a,d),m}function vD(a,r,l){l&&l.disconnect(),r==="resize"&&nit(a)}function oit(a,r,l){let n=a.canvas,s=WM(d=>{a.ctx!==null&&l(Jet(d,a))},a,d=>{let m=d[0];return[m,m.offsetX,m.offsetY]});return Ket(n,r,s),s}var MD=class extends xb{acquireContext(r,l){let n=r&&r.getContext&&r.getContext("2d");return n&&n.canvas===r?(Xet(r,l),n):null}releaseContext(r){let l=r.canvas;if(!l[yb])return!1;let n=l[yb].initial;["height","width"].forEach(d=>{let m=n[d];zn(m)?l.removeAttribute(d):l.setAttribute(d,m)});let s=n.style||{};return Object.keys(s).forEach(d=>{l.style[d]=s[d]}),l.width=l.width,delete l[yb],!0}addEventListener(r,l,n){this.removeEventListener(r,l);let s=r.$proxies||(r.$proxies={}),m={attach:tit,detach:eit,resize:rit}[l]||oit;s[l]=m(r,l,n)}removeEventListener(r,l){let n=r.$proxies||(r.$proxies={}),s=n[l];if(!s)return;({attach:vD,detach:vD,resize:vD}[l]||Qet)(r,l,s),n[l]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(r,l,n,s){return PB(r,l,n,s)}isAttached(r){let l=ub(r);return!!(l&&l.isConnected)}};function sit(a){return!sD()||typeof OffscreenCanvas<"u"&&a instanceof OffscreenCanvas?ED:MD}var DD=class{constructor(){this._init=[]}notify(r,l,n,s){l==="beforeInit"&&(this._init=this._createDescriptors(r,!0),this._notify(this._init,r,"install"));let d=s?this._descriptors(r).filter(s):this._descriptors(r),m=this._notify(d,r,l,n);return l==="afterDestroy"&&(this._notify(d,r,"stop"),this._notify(this._init,r,"uninstall")),m}_notify(r,l,n,s){s=s||{};for(let d of r){let m=d.plugin,_=m[n],w=[l,s,d.options];if(Pr(_,w,m)===!1&&s.cancelable)return!1}return!0}invalidate(){zn(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(r){if(this._cache)return this._cache;let l=this._cache=this._createDescriptors(r);return this._notifyStateChanges(r),l}_createDescriptors(r,l){let n=r&&r.config,s=nn(n.options&&n.options.plugins,{}),d=ait(n);return s===!1&&!l?[]:cit(r,d,s,l)}_notifyStateChanges(r){let l=this._oldCache||[],n=this._cache,s=(d,m)=>d.filter(_=>!m.some(w=>_.plugin.id===w.plugin.id));this._notify(s(l,n),r,"stop"),this._notify(s(n,l),r,"start")}};function ait(a){let r={},l=[],n=Object.keys(Xl.plugins.items);for(let d=0;d<n.length;d++)l.push(Xl.getPlugin(n[d]));let s=a.plugins||[];for(let d=0;d<s.length;d++){let m=s[d];l.indexOf(m)===-1&&(l.push(m),r[m.id]=!0)}return{plugins:l,localIds:r}}function lit(a,r){return!r&&a===!1?null:a===!0?{}:a}function cit(a,{plugins:r,localIds:l},n,s){let d=[],m=a.getContext();for(let _ of r){let w=_.id,S=lit(n[w],s);S!==null&&d.push({plugin:_,options:dit(a.config,{plugin:_,local:l[w]},S,m)})}return d}function dit(a,{plugin:r,local:l},n,s){let d=a.pluginScopeKeys(r),m=a.getOptionScopes(n,d);return l&&r.defaults&&m.push(r.defaults),a.createResolver(m,s,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function TD(a,r){let l=An.datasets[a]||{};return((r.datasets||{})[a]||{}).indexAxis||r.indexAxis||l.indexAxis||"x"}function uit(a,r){let l=a;return a==="_index_"?l=r:a==="_value_"&&(l=r==="x"?"y":"x"),l}function hit(a,r){return a===r?"_index_":"_value_"}function mit(a){if(a==="top"||a==="bottom")return"x";if(a==="left"||a==="right")return"y"}function ID(a,r){return a==="x"||a==="y"?a:r.axis||mit(r.position)||a.charAt(0).toLowerCase()}function pit(a,r){let l=Id[a.type]||{scales:{}},n=r.scales||{},s=TD(a.type,r),d=Object.create(null),m=Object.create(null);return Object.keys(n).forEach(_=>{let w=n[_];if(!In(w))return console.error(`Invalid scale configuration for scale: ${_}`);if(w._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${_}`);let S=ID(_,w),I=hit(S,s),L=l.scales||{};d[S]=d[S]||_,m[_]=Lm(Object.create(null),[{axis:S},w,L[S],L[I]])}),a.data.datasets.forEach(_=>{let w=_.type||a.type,S=_.indexAxis||TD(w,r),L=(Id[w]||{}).scales||{};Object.keys(L).forEach(H=>{let q=uit(H,S),X=_[q+"AxisID"]||d[q]||q;m[X]=m[X]||Object.create(null),Lm(m[X],[{axis:q},n[X],L[H]])})}),Object.keys(m).forEach(_=>{let w=m[_];Lm(w,[An.scales[w.type],An.scale])}),m}function B4(a){let r=a.options||(a.options={});r.plugins=nn(r.plugins,{}),r.scales=pit(a,r)}function V4(a){return a=a||{},a.datasets=a.datasets||[],a.labels=a.labels||[],a}function fit(a){return a=a||{},a.data=V4(a.data),B4(a),a}var r4=new Map,j4=new Set;function fb(a,r){let l=r4.get(a);return l||(l=r(),r4.set(a,l),j4.add(l)),l}var Og=(a,r,l)=>{let n=Oc(r,l);n!==void 0&&a.add(n)},AD=class{constructor(r){this._config=fit(r),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(r){this._config.type=r}get data(){return this._config.data}set data(r){this._config.data=V4(r)}get options(){return this._config.options}set options(r){this._config.options=r}get plugins(){return this._config.plugins}update(){let r=this._config;this.clearCache(),B4(r)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(r){return fb(r,()=>[[`datasets.${r}`,""]])}datasetAnimationScopeKeys(r,l){return fb(`${r}.transition.${l}`,()=>[[`datasets.${r}.transitions.${l}`,`transitions.${l}`],[`datasets.${r}`,""]])}datasetElementScopeKeys(r,l){return fb(`${r}-${l}`,()=>[[`datasets.${r}.elements.${l}`,`datasets.${r}`,`elements.${l}`,""]])}pluginScopeKeys(r){let l=r.id,n=this.type;return fb(`${n}-plugin-${l}`,()=>[[`plugins.${l}`,...r.additionalOptionScopes||[]]])}_cachedScopes(r,l){let n=this._scopeCache,s=n.get(r);return(!s||l)&&(s=new Map,n.set(r,s)),s}getOptionScopes(r,l,n){let{options:s,type:d}=this,m=this._cachedScopes(r,n),_=m.get(l);if(_)return _;let w=new Set;l.forEach(I=>{r&&(w.add(r),I.forEach(L=>Og(w,r,L))),I.forEach(L=>Og(w,s,L)),I.forEach(L=>Og(w,Id[d]||{},L)),I.forEach(L=>Og(w,An,L)),I.forEach(L=>Og(w,ab,L))});let S=Array.from(w);return S.length===0&&S.push(Object.create(null)),j4.has(l)&&m.set(l,S),S}chartOptionScopes(){let{options:r,type:l}=this;return[r,Id[l]||{},An.datasets[l]||{},{type:l},An,ab]}resolveNamedOptions(r,l,n,s=[""]){let d={$shared:!0},{resolver:m,subPrefixes:_}=o4(this._resolverCache,r,s),w=m;if(_it(m,l)){d.$shared=!1,n=Pc(n)?n():n;let S=this.createResolver(r,n,_);w=Nu(m,n,S)}for(let S of l)d[S]=w[S];return d}createResolver(r,l,n=[""],s){let{resolver:d}=o4(this._resolverCache,r,n);return In(l)?Nu(d,l,void 0,s):d}};function o4(a,r,l){let n=a.get(r);n||(n=new Map,a.set(r,n));let s=l.join(),d=n.get(s);return d||(d={resolver:db(r,l),subPrefixes:l.filter(_=>!_.toLowerCase().includes("hover"))},n.set(s,d)),d}var git=a=>In(a)&&Object.getOwnPropertyNames(a).reduce((r,l)=>r||Pc(a[l]),!1);function _it(a,r){let{isScriptable:l,isIndexable:n}=iD(a);for(let s of r){let d=l(s),m=n(s),_=(m||d)&&a[s];if(d&&(Pc(_)||git(_))||m&&Rr(_))return!0}return!1}var vit="3.9.1",yit=["top","bottom","left","right","chartArea"];function s4(a,r){return a==="top"||a==="bottom"||yit.indexOf(a)===-1&&r==="x"}function a4(a,r){return function(l,n){return l[a]===n[a]?l[r]-n[r]:l[a]-n[a]}}function l4(a){let r=a.chart,l=r.options.animation;r.notifyPlugins("afterRender"),Pr(l&&l.onComplete,[a],r)}function bit(a){let r=a.chart,l=r.options.animation;Pr(l&&l.onProgress,[a],r)}function U4(a){return sD()&&typeof a=="string"?a=document.getElementById(a):a&&a.length&&(a=a[0]),a&&a.canvas&&(a=a.canvas),a}var Cb={},H4=a=>{let r=U4(a);return Object.values(Cb).filter(l=>l.canvas===r).pop()};function xit(a,r,l){let n=Object.keys(a);for(let s of n){let d=+s;if(d>=r){let m=a[s];delete a[s],(l>0||d>r)&&(a[d+l]=m)}}}function wit(a,r,l,n){return!l||a.type==="mouseout"?null:n?r:a}var Kl=class{constructor(r,l){let n=this.config=new AD(l),s=U4(r),d=H4(s);if(d)throw new Error("Canvas is already in use. Chart with ID '"+d.id+"' must be destroyed before the canvas with ID '"+d.canvas.id+"' can be reused.");let m=n.createResolver(n.chartOptionScopes(),this.getContext());this.platform=new(n.platform||sit(s)),this.platform.updateConfig(n);let _=this.platform.acquireContext(s,m.aspectRatio),w=_&&_.canvas,S=w&&w.height,I=w&&w.width;if(this.id=sB(),this.ctx=_,this.canvas=w,this.width=I,this.height=S,this._options=m,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new DD,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=_B(L=>this.update(L),m.resizeDelay||0),this._dataChanges=[],Cb[this.id]=this,!_||!w){console.error("Failed to create chart: can't acquire context from the given item");return}Lc.listen(this,"complete",l4),Lc.listen(this,"progress",bit),this._initialize(),this.attached&&this.update()}get aspectRatio(){let{options:{aspectRatio:r,maintainAspectRatio:l},width:n,height:s,_aspectRatio:d}=this;return zn(r)?l&&d?d:s?n/s:null:r}get data(){return this.config.data}set data(r){this.config.data=r}get options(){return this._options}set options(r){this.config.options=r}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():aD(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return JM(this.canvas,this.ctx),this}stop(){return Lc.stop(this),this}resize(r,l){Lc.running(this)?this._resizeBeforeDraw={width:r,height:l}:this._resize(r,l)}_resize(r,l){let n=this.options,s=this.canvas,d=n.maintainAspectRatio&&this.aspectRatio,m=this.platform.getMaximumSize(s,r,l,d),_=n.devicePixelRatio||this.platform.getDevicePixelRatio(),w=this.width?"resize":"attach";this.width=m.width,this.height=m.height,this._aspectRatio=this.aspectRatio,aD(this,_,!0)&&(this.notifyPlugins("resize",{size:m}),Pr(n.onResize,[this,m],this),this.attached&&this._doResize(w)&&this.render())}ensureScalesHaveIDs(){let l=this.options.scales||{};lr(l,(n,s)=>{n.id=s})}buildOrUpdateScales(){let r=this.options,l=r.scales,n=this.scales,s=Object.keys(n).reduce((m,_)=>(m[_]=!1,m),{}),d=[];l&&(d=d.concat(Object.keys(l).map(m=>{let _=l[m],w=ID(m,_),S=w==="r",I=w==="x";return{options:_,dposition:S?"chartArea":I?"bottom":"left",dtype:S?"radialLinear":I?"category":"linear"}}))),lr(d,m=>{let _=m.options,w=_.id,S=ID(w,_),I=nn(_.type,m.dtype);(_.position===void 0||s4(_.position,S)!==s4(m.dposition))&&(_.position=m.dposition),s[w]=!0;let L=null;if(w in n&&n[w].type===I)L=n[w];else{let H=Xl.getScale(I);L=new H({id:w,type:I,ctx:this.ctx,chart:this}),n[L.id]=L}L.init(_,r)}),lr(s,(m,_)=>{m||delete n[_]}),lr(n,m=>{os.configure(this,m,m.options),os.addBox(this,m)})}_updateMetasets(){let r=this._metasets,l=this.data.datasets.length,n=r.length;if(r.sort((s,d)=>s.index-d.index),n>l){for(let s=l;s<n;++s)this._destroyDatasetMeta(s);r.splice(l,n-l)}this._sortedMetasets=r.slice(0).sort(a4("order","index"))}_removeUnreferencedMetasets(){let{_metasets:r,data:{datasets:l}}=this;r.length>l.length&&delete this._stacks,r.forEach((n,s)=>{l.filter(d=>d===n._dataset).length===0&&this._destroyDatasetMeta(s)})}buildOrUpdateControllers(){let r=[],l=this.data.datasets,n,s;for(this._removeUnreferencedMetasets(),n=0,s=l.length;n<s;n++){let d=l[n],m=this.getDatasetMeta(n),_=d.type||this.config.type;if(m.type&&m.type!==_&&(this._destroyDatasetMeta(n),m=this.getDatasetMeta(n)),m.type=_,m.indexAxis=d.indexAxis||TD(_,this.options),m.order=d.order||0,m.index=n,m.label=""+d.label,m.visible=this.isDatasetVisible(n),m.controller)m.controller.updateIndex(n),m.controller.linkScales();else{let w=Xl.getController(_),{datasetElementType:S,dataElementType:I}=An.datasets[_];Object.assign(w.prototype,{dataElementType:Xl.getElement(I),datasetElementType:S&&Xl.getElement(S)}),m.controller=new w(this,n),r.push(m.controller)}}return this._updateMetasets(),r}_resetElements(){lr(this.data.datasets,(r,l)=>{this.getDatasetMeta(l).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(r){let l=this.config;l.update();let n=this._options=l.createResolver(l.chartOptionScopes(),this.getContext()),s=this._animationsDisabled=!n.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:r,cancelable:!0})===!1)return;let d=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let m=0;for(let S=0,I=this.data.datasets.length;S<I;S++){let{controller:L}=this.getDatasetMeta(S),H=!s&&d.indexOf(L)===-1;L.buildOrUpdateElements(H),m=Math.max(+L.getMaxOverflow(),m)}m=this._minPadding=n.layout.autoPadding?m:0,this._updateLayout(m),s||lr(d,S=>{S.reset()}),this._updateDatasets(r),this.notifyPlugins("afterUpdate",{mode:r}),this._layers.sort(a4("z","_idx"));let{_active:_,_lastEvent:w}=this;w?this._eventHandler(w,!0):_.length&&this._updateHoverStyles(_,_,!0),this.render()}_updateScales(){lr(this.scales,r=>{os.removeBox(this,r)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){let r=this.options,l=new Set(Object.keys(this._listeners)),n=new Set(r.events);(!NM(l,n)||!!this._responsiveListeners!==r.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){let{_hiddenIndices:r}=this,l=this._getUniformDataChanges()||[];for(let{method:n,start:s,count:d}of l){let m=n==="_removeElements"?-d:d;xit(r,s,m)}}_getUniformDataChanges(){let r=this._dataChanges;if(!r||!r.length)return;this._dataChanges=[];let l=this.data.datasets.length,n=d=>new Set(r.filter(m=>m[0]===d).map((m,_)=>_+","+m.splice(1).join(","))),s=n(0);for(let d=1;d<l;d++)if(!NM(s,n(d)))return;return Array.from(s).map(d=>d.split(",")).map(d=>({method:d[1],start:+d[2],count:+d[3]}))}_updateLayout(r){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;os.update(this,this.width,this.height,r);let l=this.chartArea,n=l.width<=0||l.height<=0;this._layers=[],lr(this.boxes,s=>{n&&s.position==="chartArea"||(s.configure&&s.configure(),this._layers.push(...s._layers()))},this),this._layers.forEach((s,d)=>{s._idx=d}),this.notifyPlugins("afterLayout")}_updateDatasets(r){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:r,cancelable:!0})!==!1){for(let l=0,n=this.data.datasets.length;l<n;++l)this.getDatasetMeta(l).controller.configure();for(let l=0,n=this.data.datasets.length;l<n;++l)this._updateDataset(l,Pc(r)?r({datasetIndex:l}):r);this.notifyPlugins("afterDatasetsUpdate",{mode:r})}}_updateDataset(r,l){let n=this.getDatasetMeta(r),s={meta:n,index:r,mode:l,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",s)!==!1&&(n.controller._update(l),s.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",s))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Lc.has(this)?this.attached&&!Lc.running(this)&&Lc.start(this):(this.draw(),l4({chart:this})))}draw(){let r;if(this._resizeBeforeDraw){let{width:n,height:s}=this._resizeBeforeDraw;this._resize(n,s),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;let l=this._layers;for(r=0;r<l.length&&l[r].z<=0;++r)l[r].draw(this.chartArea);for(this._drawDatasets();r<l.length;++r)l[r].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(r){let l=this._sortedMetasets,n=[],s,d;for(s=0,d=l.length;s<d;++s){let m=l[s];(!r||m.visible)&&n.push(m)}return n}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;let r=this.getSortedVisibleDatasetMetas();for(let l=r.length-1;l>=0;--l)this._drawDataset(r[l]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(r){let l=this.ctx,n=r._clip,s=!n.disabled,d=this.chartArea,m={meta:r,index:r.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",m)!==!1&&(s&&Tg(l,{left:n.left===!1?0:d.left-n.left,right:n.right===!1?this.width:d.right+n.right,top:n.top===!1?0:d.top-n.top,bottom:n.bottom===!1?this.height:d.bottom+n.bottom}),r.controller.draw(),s&&Ig(l),m.cancelable=!1,this.notifyPlugins("afterDatasetDraw",m))}isPointInArea(r){return Om(r,this.chartArea,this._minPadding)}getElementsAtEventForMode(r,l,n,s){let d=jet.modes[l];return typeof d=="function"?d(this,r,n,s):[]}getDatasetMeta(r){let l=this.data.datasets[r],n=this._metasets,s=n.filter(d=>d&&d._dataset===l).pop();return s||(s={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:l&&l.order||0,index:r,_dataset:l,_parsed:[],_sorted:!1},n.push(s)),s}getContext(){return this.$context||(this.$context=Fc(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(r){let l=this.data.datasets[r];if(!l)return!1;let n=this.getDatasetMeta(r);return typeof n.hidden=="boolean"?!n.hidden:!l.hidden}setDatasetVisibility(r,l){let n=this.getDatasetMeta(r);n.hidden=!l}toggleDataVisibility(r){this._hiddenIndices[r]=!this._hiddenIndices[r]}getDataVisibility(r){return!this._hiddenIndices[r]}_updateVisibility(r,l,n){let s=n?"show":"hide",d=this.getDatasetMeta(r),m=d.controller._resolveAnimations(void 0,s);ia(l)?(d.data[l].hidden=!n,this.update()):(this.setDatasetVisibility(r,n),m.update(d,{visible:n}),this.update(_=>_.datasetIndex===r?s:void 0))}hide(r,l){this._updateVisibility(r,l,!1)}show(r,l){this._updateVisibility(r,l,!0)}_destroyDatasetMeta(r){let l=this._metasets[r];l&&l.controller&&l.controller._destroy(),delete this._metasets[r]}_stop(){let r,l;for(this.stop(),Lc.remove(this),r=0,l=this.data.datasets.length;r<l;++r)this._destroyDatasetMeta(r)}destroy(){this.notifyPlugins("beforeDestroy");let{canvas:r,ctx:l}=this;this._stop(),this.config.clearCache(),r&&(this.unbindEvents(),JM(r,l),this.platform.releaseContext(l),this.canvas=null,this.ctx=null),this.notifyPlugins("destroy"),delete Cb[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...r){return this.canvas.toDataURL(...r)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){let r=this._listeners,l=this.platform,n=(d,m)=>{l.addEventListener(this,d,m),r[d]=m},s=(d,m,_)=>{d.offsetX=m,d.offsetY=_,this._eventHandler(d)};lr(this.options.events,d=>n(d,s))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});let r=this._responsiveListeners,l=this.platform,n=(w,S)=>{l.addEventListener(this,w,S),r[w]=S},s=(w,S)=>{r[w]&&(l.removeEventListener(this,w,S),delete r[w])},d=(w,S)=>{this.canvas&&this.resize(w,S)},m,_=()=>{s("attach",_),this.attached=!0,this.resize(),n("resize",d),n("detach",m)};m=()=>{this.attached=!1,s("resize",d),this._stop(),this._resize(0,0),n("attach",_)},l.isAttached(this.canvas)?_():m()}unbindEvents(){lr(this._listeners,(r,l)=>{this.platform.removeEventListener(this,l,r)}),this._listeners={},lr(this._responsiveListeners,(r,l)=>{this.platform.removeEventListener(this,l,r)}),this._responsiveListeners=void 0}updateHoverStyle(r,l,n){let s=n?"set":"remove",d,m,_,w;for(l==="dataset"&&(d=this.getDatasetMeta(r[0].datasetIndex),d.controller["_"+s+"DatasetHoverStyle"]()),_=0,w=r.length;_<w;++_){m=r[_];let S=m&&this.getDatasetMeta(m.datasetIndex).controller;S&&S[s+"HoverStyle"](m.element,m.datasetIndex,m.index)}}getActiveElements(){return this._active||[]}setActiveElements(r){let l=this._active||[],n=r.map(({datasetIndex:d,index:m})=>{let _=this.getDatasetMeta(d);if(!_)throw new Error("No dataset found at index "+d);return{datasetIndex:d,element:_.data[m],index:m}});!Mg(n,l)&&(this._active=n,this._lastEvent=null,this._updateHoverStyles(n,l))}notifyPlugins(r,l,n){return this._plugins.notify(this,r,l,n)}_updateHoverStyles(r,l,n){let s=this.options.hover,d=(w,S)=>w.filter(I=>!S.some(L=>I.datasetIndex===L.datasetIndex&&I.index===L.index)),m=d(l,r),_=n?r:d(r,l);m.length&&this.updateHoverStyle(m,s.mode,!1),_.length&&s.mode&&this.updateHoverStyle(_,s.mode,!0)}_eventHandler(r,l){let n={event:r,replay:l,cancelable:!0,inChartArea:this.isPointInArea(r)},s=m=>(m.options.events||this.options.events).includes(r.native.type);if(this.notifyPlugins("beforeEvent",n,s)===!1)return;let d=this._handleEvent(r,l,n.inChartArea);return n.cancelable=!1,this.notifyPlugins("afterEvent",n,s),(d||n.changed)&&this.render(),this}_handleEvent(r,l,n){let{_active:s=[],options:d}=this,m=l,_=this._getActiveElements(r,s,n,m),w=cB(r),S=wit(r,this._lastEvent,n,w);n&&(this._lastEvent=null,Pr(d.onHover,[r,_,this],this),w&&Pr(d.onClick,[r,_,this],this));let I=!Mg(_,s);return(I||l)&&(this._active=_,this._updateHoverStyles(_,s,l)),this._lastEvent=S,I}_getActiveElements(r,l,n,s){if(r.type==="mouseout")return[];if(!n)return l;let d=this.options.hover;return this.getElementsAtEventForMode(r,d.mode,d,s)}},c4=()=>lr(Kl.instances,a=>a._plugins.invalidate()),Od=!0;Object.defineProperties(Kl,{defaults:{enumerable:Od,value:An},instances:{enumerable:Od,value:Cb},overrides:{enumerable:Od,value:Id},registry:{enumerable:Od,value:Xl},version:{enumerable:Od,value:vit},getChart:{enumerable:Od,value:H4},register:{enumerable:Od,value:(...a)=>{Xl.add(...a),c4()}},unregister:{enumerable:Od,value:(...a)=>{Xl.remove(...a),c4()}}});function G4(a,r,l){let{startAngle:n,pixelMargin:s,x:d,y:m,outerRadius:_,innerRadius:w}=r,S=s/_;a.beginPath(),a.arc(d,m,_,n-S,l+S),w>s?(S=s/w,a.arc(d,m,w,l+S,n-S,!0)):a.arc(d,m,s,l+co,n-co),a.closePath(),a.clip()}function Cit(a){return cb(a,["outerStart","outerEnd","innerStart","innerEnd"])}function Sit(a,r,l,n){let s=Cit(a.options.borderRadius),d=(l-r)/2,m=Math.min(d,n*r/2),_=w=>{let S=(l-Math.min(d,w))*n/2;return Ho(w,0,Math.min(d,S))};return{outerStart:_(s.outerStart),outerEnd:_(s.outerEnd),innerStart:Ho(s.innerStart,0,m),innerEnd:Ho(s.innerEnd,0,m)}}function Um(a,r,l,n){return{x:l+a*Math.cos(r),y:n+a*Math.sin(r)}}function kD(a,r,l,n,s,d){let{x:m,y:_,startAngle:w,pixelMargin:S,innerRadius:I}=r,L=Math.max(r.outerRadius+n+l-S,0),H=I>0?I+n+l+S:0,q=0,X=s-w;if(n){let Ri=I>0?I-n:0,Gn=L>0?L-n:0,_n=(Ri+Gn)/2,fr=_n!==0?X*_n/(_n+n):X;q=(X-fr)/2}let it=Math.max(.001,X*L-l/Ur)/L,at=(X-it)/2,mt=w+at+q,Mt=s-at-q,{outerStart:Lt,outerEnd:Pt,innerStart:Nt,innerEnd:ue}=Sit(r,H,L,Mt-mt),Q=L-Lt,$t=L-Pt,Ue=mt+Lt/Q,ki=Mt-Pt/$t,fe=H+Nt,ei=H+ue,Oi=mt+Nt/fe,Dr=Mt-ue/ei;if(a.beginPath(),d){if(a.arc(m,_,L,Ue,ki),Pt>0){let _n=Um($t,ki,m,_);a.arc(_n.x,_n.y,Pt,ki,Mt+co)}let Ri=Um(ei,Mt,m,_);if(a.lineTo(Ri.x,Ri.y),ue>0){let _n=Um(ei,Dr,m,_);a.arc(_n.x,_n.y,ue,Mt+co,Dr+Math.PI)}if(a.arc(m,_,H,Mt-ue/H,mt+Nt/H,!0),Nt>0){let _n=Um(fe,Oi,m,_);a.arc(_n.x,_n.y,Nt,Oi+Math.PI,mt-co)}let Gn=Um(Q,mt,m,_);if(a.lineTo(Gn.x,Gn.y),Lt>0){let _n=Um(Q,Ue,m,_);a.arc(_n.x,_n.y,Lt,mt-co,Ue)}}else{a.moveTo(m,_);let Ri=Math.cos(Ue)*L+m,Gn=Math.sin(Ue)*L+_;a.lineTo(Ri,Gn);let _n=Math.cos(ki)*L+m,fr=Math.sin(ki)*L+_;a.lineTo(_n,fr)}a.closePath()}function Eit(a,r,l,n,s){let{fullCircles:d,startAngle:m,circumference:_}=r,w=r.endAngle;if(d){kD(a,r,l,n,m+mr,s);for(let S=0;S<d;++S)a.fill();isNaN(_)||(w=m+_%mr,_%mr===0&&(w+=mr))}return kD(a,r,l,n,w,s),a.fill(),w}function Mit(a,r,l){let{x:n,y:s,startAngle:d,pixelMargin:m,fullCircles:_}=r,w=Math.max(r.outerRadius-m,0),S=r.innerRadius+m,I;for(l&&G4(a,r,d+mr),a.beginPath(),a.arc(n,s,S,d+mr,d,!0),I=0;I<_;++I)a.stroke();for(a.beginPath(),a.arc(n,s,w,d,d+mr),I=0;I<_;++I)a.stroke()}function Dit(a,r,l,n,s,d){let{options:m}=r,{borderWidth:_,borderJoinStyle:w}=m,S=m.borderAlign==="inner";_&&(S?(a.lineWidth=_*2,a.lineJoin=w||"round"):(a.lineWidth=_,a.lineJoin=w||"bevel"),r.fullCircles&&Mit(a,r,S),S&&G4(a,r,s),kD(a,r,l,n,s,d),a.stroke())}var Gm=class extends oa{constructor(r){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,r&&Object.assign(this,r)}inRange(r,l,n){let s=this.getProps(["x","y"],n),{angle:d,distance:m}=UM(s,{x:r,y:l}),{startAngle:_,endAngle:w,innerRadius:S,outerRadius:I,circumference:L}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],n),H=this.options.spacing/2,X=nn(L,w-_)>=mr||Nm(d,_,w),it=Yl(m,S+H,I+H);return X&&it}getCenterPoint(r){let{x:l,y:n,startAngle:s,endAngle:d,innerRadius:m,outerRadius:_}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius","circumference"],r),{offset:w,spacing:S}=this.options,I=(s+d)/2,L=(m+_+S+w)/2;return{x:l+Math.cos(I)*L,y:n+Math.sin(I)*L}}tooltipPosition(r){return this.getCenterPoint(r)}draw(r){let{options:l,circumference:n}=this,s=(l.offset||0)/2,d=(l.spacing||0)/2,m=l.circular;if(this.pixelMargin=l.borderAlign==="inner"?.33:0,this.fullCircles=n>mr?Math.floor(n/mr):0,n===0||this.innerRadius<0||this.outerRadius<0)return;r.save();let _=0;if(s){_=s/2;let S=(this.startAngle+this.endAngle)/2;r.translate(Math.cos(S)*_,Math.sin(S)*_),this.circumference>=Ur&&(_=s)}r.fillStyle=l.backgroundColor,r.strokeStyle=l.borderColor;let w=Eit(r,this,_,d,m);Dit(r,this,_,d,w,m),r.restore()}};Gm.id="arc";Gm.defaults={borderAlign:"center",borderColor:"#fff",borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0};Gm.defaultRoutes={backgroundColor:"backgroundColor"};function q4(a,r,l=r){a.lineCap=nn(l.borderCapStyle,r.borderCapStyle),a.setLineDash(nn(l.borderDash,r.borderDash)),a.lineDashOffset=nn(l.borderDashOffset,r.borderDashOffset),a.lineJoin=nn(l.borderJoinStyle,r.borderJoinStyle),a.lineWidth=nn(l.borderWidth,r.borderWidth),a.strokeStyle=nn(l.borderColor,r.borderColor)}function Tit(a,r,l){a.lineTo(l.x,l.y)}function Iit(a){return a.stepped?EB:a.tension||a.cubicInterpolationMode==="monotone"?MB:Tit}function W4(a,r,l={}){let n=a.length,{start:s=0,end:d=n-1}=l,{start:m,end:_}=r,w=Math.max(s,m),S=Math.min(d,_),I=s<m&&d<m||s>_&&d>_;return{count:n,start:w,loop:r.loop,ilen:S<w&&!I?n+S-w:S-w}}function Ait(a,r,l,n){let{points:s,options:d}=r,{count:m,start:_,loop:w,ilen:S}=W4(s,l,n),I=Iit(d),{move:L=!0,reverse:H}=n||{},q,X,it;for(q=0;q<=S;++q)X=s[(_+(H?S-q:q))%m],!X.skip&&(L?(a.moveTo(X.x,X.y),L=!1):I(a,it,X,H,d.stepped),it=X);return w&&(X=s[(_+(H?S:0))%m],I(a,it,X,H,d.stepped)),!!w}function kit(a,r,l,n){let s=r.points,{count:d,start:m,ilen:_}=W4(s,l,n),{move:w=!0,reverse:S}=n||{},I=0,L=0,H,q,X,it,at,mt,Mt=Pt=>(m+(S?_-Pt:Pt))%d,Lt=()=>{it!==at&&(a.lineTo(I,at),a.lineTo(I,it),a.lineTo(I,mt))};for(w&&(q=s[Mt(0)],a.moveTo(q.x,q.y)),H=0;H<=_;++H){if(q=s[Mt(H)],q.skip)continue;let Pt=q.x,Nt=q.y,ue=Pt|0;ue===X?(Nt<it?it=Nt:Nt>at&&(at=Nt),I=(L*I+Pt)/++L):(Lt(),a.lineTo(Pt,Nt),X=ue,L=0,it=at=Nt),mt=Nt}Lt()}function RD(a){let r=a.options,l=r.borderDash&&r.borderDash.length;return!a._decimated&&!a._loop&&!r.tension&&r.cubicInterpolationMode!=="monotone"&&!r.stepped&&!l?kit:Ait}function Rit(a){return a.stepped?FB:a.tension||a.cubicInterpolationMode==="monotone"?LB:Md}function Pit(a,r,l,n){let s=r._path;s||(s=r._path=new Path2D,r.path(s,l,n)&&s.closePath()),q4(a,r.options),a.stroke(s)}function Oit(a,r,l,n){let{segments:s,options:d}=r,m=RD(r);for(let _ of s)q4(a,d,_.style),a.beginPath(),m(a,r,_,{start:l,end:l+n-1})&&a.closePath(),a.stroke()}var Fit=typeof Path2D=="function";function Lit(a,r,l,n){Fit&&!r.options.segment?Pit(a,r,l,n):Oit(a,r,l,n)}var Db=(()=>{class a extends oa{constructor(l){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,l&&Object.assign(this,l)}updateControlPoints(l,n){let s=this.options;if((s.tension||s.cubicInterpolationMode==="monotone")&&!s.stepped&&!this._pointsUpdated){let d=s.spanGaps?this._loop:this._fullLoop;RB(this._points,s,l,d,n),this._pointsUpdated=!0}}set points(l){this._points=l,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=NB(this,this.options.segment))}first(){let l=this.segments,n=this.points;return l.length&&n[l[0].start]}last(){let l=this.segments,n=this.points,s=l.length;return s&&n[l[s-1].end]}interpolate(l,n){let s=this.options,d=l[n],m=this.points,_=hD(this,{property:n,start:d,end:d});if(!_.length)return;let w=[],S=Rit(s),I,L;for(I=0,L=_.length;I<L;++I){let{start:H,end:q}=_[I],X=m[H],it=m[q];if(X===it){w.push(X);continue}let at=Math.abs((d-X[n])/(it[n]-X[n])),mt=S(X,it,at,s.stepped);mt[n]=l[n],w.push(mt)}return w.length===1?w[0]:w}pathSegment(l,n,s){return RD(this)(l,this,n,s)}path(l,n,s){let d=this.segments,m=RD(this),_=this._loop;n=n||0,s=s||this.points.length-n;for(let w of d)_&=m(l,this,w,{start:n,end:n+s-1});return!!_}draw(l,n,s,d){let m=this.options||{};(this.points||[]).length&&m.borderWidth&&(l.save(),Lit(l,this,s,d),l.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}return a.id="line",a.defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0},a.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"},a.descriptors={_scriptable:!0,_indexable:r=>r!=="borderDash"&&r!=="fill"},a})();function d4(a,r,l,n){let s=a.options,{[l]:d}=a.getProps([l],n);return Math.abs(r-d)<s.radius+s.hitRadius}var zit=(()=>{class a extends oa{constructor(l){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,l&&Object.assign(this,l)}inRange(l,n,s){let d=this.options,{x:m,y:_}=this.getProps(["x","y"],s);return Math.pow(l-m,2)+Math.pow(n-_,2)<Math.pow(d.hitRadius+d.radius,2)}inXRange(l,n){return d4(this,l,"x",n)}inYRange(l,n){return d4(this,l,"y",n)}getCenterPoint(l){let{x:n,y:s}=this.getProps(["x","y"],l);return{x:n,y:s}}size(l){l=l||this.options||{};let n=l.radius||0;n=Math.max(n,n&&l.hoverRadius||0);let s=n&&l.borderWidth||0;return(n+s)*2}draw(l,n){let s=this.options;this.skip||s.radius<.1||!Om(this,n,this.size(s)/2)||(l.strokeStyle=s.borderColor,l.lineWidth=s.borderWidth,l.fillStyle=s.backgroundColor,lb(l,s,this.x,this.y))}getRange(){let l=this.options||{};return l.radius+l.hitRadius}}return a.id="point",a.defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0},a.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"},a})();function $4(a,r){let{x:l,y:n,base:s,width:d,height:m}=a.getProps(["x","y","base","width","height"],r),_,w,S,I,L;return a.horizontal?(L=m/2,_=Math.min(l,s),w=Math.max(l,s),S=n-L,I=n+L):(L=d/2,_=l-L,w=l+L,S=Math.min(n,s),I=Math.max(n,s)),{left:_,top:S,right:w,bottom:I}}function Fd(a,r,l,n){return a?0:Ho(r,l,n)}function Nit(a,r,l){let n=a.options.borderWidth,s=a.borderSkipped,d=eD(n);return{t:Fd(s.top,d.top,0,l),r:Fd(s.right,d.right,0,r),b:Fd(s.bottom,d.bottom,0,l),l:Fd(s.left,d.left,0,r)}}function Bit(a,r,l){let{enableBorderRadius:n}=a.getProps(["enableBorderRadius"]),s=a.options.borderRadius,d=Rd(s),m=Math.min(r,l),_=a.borderSkipped,w=n||In(s);return{topLeft:Fd(!w||_.top||_.left,d.topLeft,0,m),topRight:Fd(!w||_.top||_.right,d.topRight,0,m),bottomLeft:Fd(!w||_.bottom||_.left,d.bottomLeft,0,m),bottomRight:Fd(!w||_.bottom||_.right,d.bottomRight,0,m)}}function Vit(a){let r=$4(a),l=r.right-r.left,n=r.bottom-r.top,s=Nit(a,l/2,n/2),d=Bit(a,l/2,n/2);return{outer:{x:r.left,y:r.top,w:l,h:n,radius:d},inner:{x:r.left+s.l,y:r.top+s.t,w:l-s.l-s.r,h:n-s.t-s.b,radius:{topLeft:Math.max(0,d.topLeft-Math.max(s.t,s.l)),topRight:Math.max(0,d.topRight-Math.max(s.t,s.r)),bottomLeft:Math.max(0,d.bottomLeft-Math.max(s.b,s.l)),bottomRight:Math.max(0,d.bottomRight-Math.max(s.b,s.r))}}}}function yD(a,r,l,n){let s=r===null,d=l===null,_=a&&!(s&&d)&&$4(a,n);return _&&(s||Yl(r,_.left,_.right))&&(d||Yl(l,_.top,_.bottom))}function jit(a){return a.topLeft||a.topRight||a.bottomLeft||a.bottomRight}function Uit(a,r){a.rect(r.x,r.y,r.w,r.h)}function bD(a,r,l={}){let n=a.x!==l.x?-r:0,s=a.y!==l.y?-r:0,d=(a.x+a.w!==l.x+l.w?r:0)-n,m=(a.y+a.h!==l.y+l.h?r:0)-s;return{x:a.x+n,y:a.y+s,w:a.w+d,h:a.h+m,radius:a.radius}}var qm=class extends oa{constructor(r){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,r&&Object.assign(this,r)}draw(r){let{inflateAmount:l,options:{borderColor:n,backgroundColor:s}}=this,{inner:d,outer:m}=Vit(this),_=jit(m.radius)?Bm:Uit;r.save(),(m.w!==d.w||m.h!==d.h)&&(r.beginPath(),_(r,bD(m,l,d)),r.clip(),_(r,bD(d,-l,m)),r.fillStyle=n,r.fill("evenodd")),r.beginPath(),_(r,bD(d,l)),r.fillStyle=s,r.fill(),r.restore()}inRange(r,l,n){return yD(this,r,l,n)}inXRange(r,l){return yD(this,r,null,l)}inYRange(r,l){return yD(this,null,r,l)}getCenterPoint(r){let{x:l,y:n,base:s,horizontal:d}=this.getProps(["x","y","base","horizontal"],r);return{x:d?(l+s)/2:l,y:d?n:(n+s)/2}}getRange(r){return r==="x"?this.width/2:this.height/2}};qm.id="bar";qm.defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};qm.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};var Hit=Object.freeze({__proto__:null,ArcElement:Gm,LineElement:Db,PointElement:zit,BarElement:qm});function Git(a,r,l,n,s){let d=s.samples||n;if(d>=l)return a.slice(r,r+l);let m=[],_=(l-2)/(d-2),w=0,S=r+l-1,I=r,L,H,q,X,it;for(m[w++]=a[I],L=0;L<d-2;L++){let at=0,mt=0,Mt,Lt=Math.floor((L+1)*_)+1+r,Pt=Math.min(Math.floor((L+2)*_)+1,l)+r,Nt=Pt-Lt;for(Mt=Lt;Mt<Pt;Mt++)at+=a[Mt].x,mt+=a[Mt].y;at/=Nt,mt/=Nt;let ue=Math.floor(L*_)+1+r,Q=Math.min(Math.floor((L+1)*_)+1,l)+r,{x:$t,y:Ue}=a[I];for(q=X=-1,Mt=ue;Mt<Q;Mt++)X=.5*Math.abs(($t-at)*(a[Mt].y-Ue)-($t-a[Mt].x)*(mt-Ue)),X>q&&(q=X,H=a[Mt],it=Mt);m[w++]=H,I=it}return m[w++]=a[S],m}function qit(a,r,l,n){let s=0,d=0,m,_,w,S,I,L,H,q,X,it,at=[],mt=r+l-1,Mt=a[r].x,Pt=a[mt].x-Mt;for(m=r;m<r+l;++m){_=a[m],w=(_.x-Mt)/Pt*n,S=_.y;let Nt=w|0;if(Nt===I)S<X?(X=S,L=m):S>it&&(it=S,H=m),s=(d*s+_.x)/++d;else{let ue=m-1;if(!zn(L)&&!zn(H)){let Q=Math.min(L,H),$t=Math.max(L,H);Q!==q&&Q!==ue&&at.push(Pi(qt({},a[Q]),{x:s})),$t!==q&&$t!==ue&&at.push(Pi(qt({},a[$t]),{x:s}))}m>0&&ue!==q&&at.push(a[ue]),at.push(_),I=Nt,d=0,X=it=S,L=H=q=m}}return at}function Y4(a){if(a._decimated){let r=a._data;delete a._decimated,delete a._data,Object.defineProperty(a,"data",{value:r})}}function u4(a){a.data.datasets.forEach(r=>{Y4(r)})}function Wit(a,r){let l=r.length,n=0,s,{iScale:d}=a,{min:m,max:_,minDefined:w,maxDefined:S}=d.getUserBounds();return w&&(n=Ho(Wl(r,d.axis,m).lo,0,l-1)),S?s=Ho(Wl(r,d.axis,_).hi+1,n,l)-n:s=l-n,{start:n,count:s}}var $it={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(a,r,l)=>{if(!l.enabled){u4(a);return}let n=a.width;a.data.datasets.forEach((s,d)=>{let{_data:m,indexAxis:_}=s,w=a.getDatasetMeta(d),S=m||s.data;if(Vm([_,a.options.indexAxis])==="y"||!w.controller.supportsDecimation)return;let I=a.scales[w.xAxisID];if(I.type!=="linear"&&I.type!=="time"||a.options.parsing)return;let{start:L,count:H}=Wit(w,S),q=l.threshold||4*n;if(H<=q){Y4(s);return}zn(m)&&(s._data=S,delete s.data,Object.defineProperty(s,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(it){this._data=it}}));let X;switch(l.algorithm){case"lttb":X=Git(S,L,H,n,l);break;case"min-max":X=qit(S,L,H,n);break;default:throw new Error(`Unsupported decimation algorithm '${l.algorithm}'`)}s._decimated=X})},destroy(a){u4(a)}};function Yit(a,r,l){let n=a.segments,s=a.points,d=r.points,m=[];for(let _ of n){let{start:w,end:S}=_;S=FD(w,S,s);let I=PD(l,s[w],s[S],_.loop);if(!r.segments){m.push({source:_,target:I,start:s[w],end:s[S]});continue}let L=hD(r,I);for(let H of L){let q=PD(l,d[H.start],d[H.end],H.loop),X=uD(_,s,q);for(let it of X)m.push({source:it,target:H,start:{[l]:h4(I,q,"start",Math.max)},end:{[l]:h4(I,q,"end",Math.min)}})}}return m}function PD(a,r,l,n){if(n)return;let s=r[a],d=l[a];return a==="angle"&&(s=Us(s),d=Us(d)),{property:a,start:s,end:d}}function Zit(a,r){let{x:l=null,y:n=null}=a||{},s=r.points,d=[];return r.segments.forEach(({start:m,end:_})=>{_=FD(m,_,s);let w=s[m],S=s[_];n!==null?(d.push({x:w.x,y:n}),d.push({x:S.x,y:n})):l!==null&&(d.push({x:l,y:w.y}),d.push({x:l,y:S.y}))}),d}function FD(a,r,l){for(;r>a;r--){let n=l[r];if(!isNaN(n.x)&&!isNaN(n.y))break}return r}function h4(a,r,l,n){return a&&r?n(a[l],r[l]):a?a[l]:r?r[l]:0}function Z4(a,r){let l=[],n=!1;return Rr(a)?(n=!0,l=a):l=Zit(a,r),l.length?new Db({points:l,options:{tension:0},_loop:n,_fullLoop:n}):null}function m4(a){return a&&a.fill!==!1}function Xit(a,r,l){let s=a[r].fill,d=[r],m;if(!l)return s;for(;s!==!1&&d.indexOf(s)===-1;){if(!_o(s))return s;if(m=a[s],!m)return!1;if(m.visible)return s;d.push(s),s=m.fill}return!1}function Kit(a,r,l){let n=ent(a);if(In(n))return isNaN(n.value)?!1:n;let s=parseFloat(n);return _o(s)&&Math.floor(s)===s?Qit(n[0],r,s,l):["origin","start","end","stack","shape"].indexOf(n)>=0&&n}function Qit(a,r,l,n){return(a==="-"||a==="+")&&(l=r+l),l===r||l<0||l>=n?!1:l}function Jit(a,r){let l=null;return a==="start"?l=r.bottom:a==="end"?l=r.top:In(a)?l=r.getPixelForValue(a.value):r.getBasePixel&&(l=r.getBasePixel()),l}function tnt(a,r,l){let n;return a==="start"?n=l:a==="end"?n=r.options.reverse?r.min:r.max:In(a)?n=a.value:n=r.getBaseValue(),n}function ent(a){let r=a.options,l=r.fill,n=nn(l&&l.target,l);return n===void 0&&(n=!!r.backgroundColor),n===!1||n===null?!1:n===!0?"origin":n}function int(a){let{scale:r,index:l,line:n}=a,s=[],d=n.segments,m=n.points,_=nnt(r,l);_.push(Z4({x:null,y:r.bottom},n));for(let w=0;w<d.length;w++){let S=d[w];for(let I=S.start;I<=S.end;I++)rnt(s,m[I],_)}return new Db({points:s,options:{}})}function nnt(a,r){let l=[],n=a.getMatchingVisibleMetas("line");for(let s=0;s<n.length;s++){let d=n[s];if(d.index===r)break;d.hidden||l.unshift(d.dataset)}return l}function rnt(a,r,l){let n=[];for(let s=0;s<l.length;s++){let d=l[s],{first:m,last:_,point:w}=ont(d,r,"x");if(!(!w||m&&_)){if(m)n.unshift(w);else if(a.push(w),!_)break}}a.push(...n)}function ont(a,r,l){let n=a.interpolate(r,l);if(!n)return{};let s=n[l],d=a.segments,m=a.points,_=!1,w=!1;for(let S=0;S<d.length;S++){let I=d[S],L=m[I.start][l],H=m[I.end][l];if(Yl(s,L,H)){_=s===L,w=s===H;break}}return{first:_,last:w,point:n}}var Sb=class{constructor(r){this.x=r.x,this.y=r.y,this.radius=r.radius}pathSegment(r,l,n){let{x:s,y:d,radius:m}=this;return l=l||{start:0,end:mr},r.arc(s,d,m,l.end,l.start,!0),!n.bounds}interpolate(r){let{x:l,y:n,radius:s}=this,d=r.angle;return{x:l+Math.cos(d)*s,y:n+Math.sin(d)*s,angle:d}}};function snt(a){let{chart:r,fill:l,line:n}=a;if(_o(l))return ant(r,l);if(l==="stack")return int(a);if(l==="shape")return!0;let s=lnt(a);return s instanceof Sb?s:Z4(s,n)}function ant(a,r){let l=a.getDatasetMeta(r);return l&&a.isDatasetVisible(r)?l.dataset:null}function lnt(a){return(a.scale||{}).getPointPositionForValue?dnt(a):cnt(a)}function cnt(a){let{scale:r={},fill:l}=a,n=Jit(l,r);if(_o(n)){let s=r.isHorizontal();return{x:s?n:null,y:s?null:n}}return null}function dnt(a){let{scale:r,fill:l}=a,n=r.options,s=r.getLabels().length,d=n.reverse?r.max:r.min,m=tnt(l,r,d),_=[];if(n.grid.circular){let w=r.getPointPositionForValue(0,d);return new Sb({x:w.x,y:w.y,radius:r.getDistanceFromCenterForValue(m)})}for(let w=0;w<s;++w)_.push(r.getPointPositionForValue(w,m));return _}function xD(a,r,l){let n=snt(r),{line:s,scale:d,axis:m}=r,_=s.options,w=_.fill,S=_.backgroundColor,{above:I=S,below:L=S}=w||{};n&&s.points.length&&(Tg(a,l),unt(a,{line:s,target:n,above:I,below:L,area:l,scale:d,axis:m}),Ig(a))}function unt(a,r){let{line:l,target:n,above:s,below:d,area:m,scale:_}=r,w=l._loop?"angle":r.axis;a.save(),w==="x"&&d!==s&&(p4(a,n,m.top),f4(a,{line:l,target:n,color:s,scale:_,property:w}),a.restore(),a.save(),p4(a,n,m.bottom)),f4(a,{line:l,target:n,color:d,scale:_,property:w}),a.restore()}function p4(a,r,l){let{segments:n,points:s}=r,d=!0,m=!1;a.beginPath();for(let _ of n){let{start:w,end:S}=_,I=s[w],L=s[FD(w,S,s)];d?(a.moveTo(I.x,I.y),d=!1):(a.lineTo(I.x,l),a.lineTo(I.x,I.y)),m=!!r.pathSegment(a,_,{move:m}),m?a.closePath():a.lineTo(L.x,l)}a.lineTo(r.first().x,l),a.closePath(),a.clip()}function f4(a,r){let{line:l,target:n,property:s,color:d,scale:m}=r,_=Yit(l,n,s);for(let{source:w,target:S,start:I,end:L}of _){let{style:{backgroundColor:H=d}={}}=w,q=n!==!0;a.save(),a.fillStyle=H,hnt(a,m,q&&PD(s,I,L)),a.beginPath();let X=!!l.pathSegment(a,w),it;if(q){X?a.closePath():g4(a,n,L,s);let at=!!n.pathSegment(a,S,{move:X,reverse:!0});it=X&&at,it||g4(a,n,I,s)}a.closePath(),a.fill(it?"evenodd":"nonzero"),a.restore()}}function hnt(a,r,l){let{top:n,bottom:s}=r.chart.chartArea,{property:d,start:m,end:_}=l||{};d==="x"&&(a.beginPath(),a.rect(m,n,_-m,s-n),a.clip())}function g4(a,r,l,n){let s=r.interpolate(l,n);s&&a.lineTo(s.x,s.y)}var mnt={id:"filler",afterDatasetsUpdate(a,r,l){let n=(a.data.datasets||[]).length,s=[],d,m,_,w;for(m=0;m<n;++m)d=a.getDatasetMeta(m),_=d.dataset,w=null,_&&_.options&&_ instanceof Db&&(w={visible:a.isDatasetVisible(m),index:m,fill:Kit(_,m,n),chart:a,axis:d.controller.options.indexAxis,scale:d.vScale,line:_}),d.$filler=w,s.push(w);for(m=0;m<n;++m)w=s[m],!(!w||w.fill===!1)&&(w.fill=Xit(s,m,l.propagate))},beforeDraw(a,r,l){let n=l.drawTime==="beforeDraw",s=a.getSortedVisibleDatasetMetas(),d=a.chartArea;for(let m=s.length-1;m>=0;--m){let _=s[m].$filler;_&&(_.line.updateControlPoints(d,_.axis),n&&_.fill&&xD(a.ctx,_,d))}},beforeDatasetsDraw(a,r,l){if(l.drawTime!=="beforeDatasetsDraw")return;let n=a.getSortedVisibleDatasetMetas();for(let s=n.length-1;s>=0;--s){let d=n[s].$filler;m4(d)&&xD(a.ctx,d,a.chartArea)}},beforeDatasetDraw(a,r,l){let n=r.meta.$filler;!m4(n)||l.drawTime!=="beforeDatasetDraw"||xD(a.ctx,n,a.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}},_4=(a,r)=>{let{boxHeight:l=r,boxWidth:n=r}=a;return a.usePointStyle&&(l=Math.min(l,r),n=a.pointStyleWidth||Math.min(n,r)),{boxWidth:n,boxHeight:l,itemHeight:Math.max(r,l)}},pnt=(a,r)=>a!==null&&r!==null&&a.datasetIndex===r.datasetIndex&&a.index===r.index,Eb=class extends oa{constructor(r){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=r.chart,this.options=r.options,this.ctx=r.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(r,l,n){this.maxWidth=r,this.maxHeight=l,this._margins=n,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){let r=this.options.labels||{},l=Pr(r.generateLabels,[this.chart],this)||[];r.filter&&(l=l.filter(n=>r.filter(n,this.chart.data))),r.sort&&(l=l.sort((n,s)=>r.sort(n,s,this.chart.data))),this.options.reverse&&l.reverse(),this.legendItems=l}fit(){let{options:r,ctx:l}=this;if(!r.display){this.width=this.height=0;return}let n=r.labels,s=No(n.font),d=s.size,m=this._computeTitleHeight(),{boxWidth:_,itemHeight:w}=_4(n,d),S,I;l.font=s.string,this.isHorizontal()?(S=this.maxWidth,I=this._fitRows(m,d,_,w)+10):(I=this.maxHeight,S=this._fitCols(m,d,_,w)+10),this.width=Math.min(S,r.maxWidth||this.maxWidth),this.height=Math.min(I,r.maxHeight||this.maxHeight)}_fitRows(r,l,n,s){let{ctx:d,maxWidth:m,options:{labels:{padding:_}}}=this,w=this.legendHitBoxes=[],S=this.lineWidths=[0],I=s+_,L=r;d.textAlign="left",d.textBaseline="middle";let H=-1,q=-I;return this.legendItems.forEach((X,it)=>{let at=n+l/2+d.measureText(X.text).width;(it===0||S[S.length-1]+at+2*_>m)&&(L+=I,S[S.length-(it>0?0:1)]=0,q+=I,H++),w[it]={left:0,top:q,row:H,width:at,height:s},S[S.length-1]+=at+_}),L}_fitCols(r,l,n,s){let{ctx:d,maxHeight:m,options:{labels:{padding:_}}}=this,w=this.legendHitBoxes=[],S=this.columnSizes=[],I=m-r,L=_,H=0,q=0,X=0,it=0;return this.legendItems.forEach((at,mt)=>{let Mt=n+l/2+d.measureText(at.text).width;mt>0&&q+s+2*_>I&&(L+=H+_,S.push({width:H,height:q}),X+=H+_,it++,H=q=0),w[mt]={left:X,top:q,col:it,width:Mt,height:s},H=Math.max(H,Mt),q+=s+_}),L+=H,S.push({width:H,height:q}),L}adjustHitBoxes(){if(!this.options.display)return;let r=this._computeTitleHeight(),{legendHitBoxes:l,options:{align:n,labels:{padding:s},rtl:d}}=this,m=Vu(d,this.left,this.width);if(this.isHorizontal()){let _=0,w=Jo(n,this.left+s,this.right-this.lineWidths[_]);for(let S of l)_!==S.row&&(_=S.row,w=Jo(n,this.left+s,this.right-this.lineWidths[_])),S.top+=this.top+r+s,S.left=m.leftForLtr(m.x(w),S.width),w+=S.width+s}else{let _=0,w=Jo(n,this.top+r+s,this.bottom-this.columnSizes[_].height);for(let S of l)S.col!==_&&(_=S.col,w=Jo(n,this.top+r+s,this.bottom-this.columnSizes[_].height)),S.top=w,S.left+=this.left+s,S.left=m.leftForLtr(m.x(S.left),S.width),w+=S.height+s}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){let r=this.ctx;Tg(r,this),this._draw(),Ig(r)}}_draw(){let{options:r,columnSizes:l,lineWidths:n,ctx:s}=this,{align:d,labels:m}=r,_=An.color,w=Vu(r.rtl,this.left,this.width),S=No(m.font),{color:I,padding:L}=m,H=S.size,q=H/2,X;this.drawTitle(),s.textAlign=w.textAlign("left"),s.textBaseline="middle",s.lineWidth=.5,s.font=S.string;let{boxWidth:it,boxHeight:at,itemHeight:mt}=_4(m,H),Mt=function(Q,$t,Ue){if(isNaN(it)||it<=0||isNaN(at)||at<0)return;s.save();let ki=nn(Ue.lineWidth,1);if(s.fillStyle=nn(Ue.fillStyle,_),s.lineCap=nn(Ue.lineCap,"butt"),s.lineDashOffset=nn(Ue.lineDashOffset,0),s.lineJoin=nn(Ue.lineJoin,"miter"),s.lineWidth=ki,s.strokeStyle=nn(Ue.strokeStyle,_),s.setLineDash(nn(Ue.lineDash,[])),m.usePointStyle){let fe={radius:at*Math.SQRT2/2,pointStyle:Ue.pointStyle,rotation:Ue.rotation,borderWidth:ki},ei=w.xPlus(Q,it/2),Oi=$t+q;tD(s,fe,ei,Oi,m.pointStyleWidth&&it)}else{let fe=$t+Math.max((H-at)/2,0),ei=w.leftForLtr(Q,it),Oi=Rd(Ue.borderRadius);s.beginPath(),Object.values(Oi).some(Dr=>Dr!==0)?Bm(s,{x:ei,y:fe,w:it,h:at,radius:Oi}):s.rect(ei,fe,it,at),s.fill(),ki!==0&&s.stroke()}s.restore()},Lt=function(Q,$t,Ue){kd(s,Ue.text,Q,$t+mt/2,S,{strikethrough:Ue.hidden,textAlign:w.textAlign(Ue.textAlign)})},Pt=this.isHorizontal(),Nt=this._computeTitleHeight();Pt?X={x:Jo(d,this.left+L,this.right-n[0]),y:this.top+L+Nt,line:0}:X={x:this.left+L,y:Jo(d,this.top+Nt+L,this.bottom-l[0].height),line:0},cD(this.ctx,r.textDirection);let ue=mt+L;this.legendItems.forEach((Q,$t)=>{s.strokeStyle=Q.fontColor||I,s.fillStyle=Q.fontColor||I;let Ue=s.measureText(Q.text).width,ki=w.textAlign(Q.textAlign||(Q.textAlign=m.textAlign)),fe=it+q+Ue,ei=X.x,Oi=X.y;w.setWidth(this.width),Pt?$t>0&&ei+fe+L>this.right&&(Oi=X.y+=ue,X.line++,ei=X.x=Jo(d,this.left+L,this.right-n[X.line])):$t>0&&Oi+ue>this.bottom&&(ei=X.x=ei+l[X.line].width+L,X.line++,Oi=X.y=Jo(d,this.top+Nt+L,this.bottom-l[X.line].height));let Dr=w.x(ei);Mt(Dr,Oi,Q),ei=vB(ki,ei+it+q,Pt?ei+fe:this.right,r.rtl),Lt(w.x(ei),Oi,Q),Pt?X.x+=fe+L:X.y+=ue}),dD(this.ctx,r.textDirection)}drawTitle(){let r=this.options,l=r.title,n=No(l.font),s=ts(l.padding);if(!l.display)return;let d=Vu(r.rtl,this.left,this.width),m=this.ctx,_=l.position,w=n.size/2,S=s.top+w,I,L=this.left,H=this.width;if(this.isHorizontal())H=Math.max(...this.lineWidths),I=this.top+S,L=Jo(r.align,L,this.right-H);else{let X=this.columnSizes.reduce((it,at)=>Math.max(it,at.height),0);I=S+Jo(r.align,this.top,this.bottom-X-r.labels.padding-this._computeTitleHeight())}let q=Jo(_,L,L+H);m.textAlign=d.textAlign(sb(_)),m.textBaseline="middle",m.strokeStyle=l.color,m.fillStyle=l.color,m.font=n.string,kd(m,l.text,q,I,n)}_computeTitleHeight(){let r=this.options.title,l=No(r.font),n=ts(r.padding);return r.display?l.lineHeight+n.height:0}_getLegendItemAt(r,l){let n,s,d;if(Yl(r,this.left,this.right)&&Yl(l,this.top,this.bottom)){for(d=this.legendHitBoxes,n=0;n<d.length;++n)if(s=d[n],Yl(r,s.left,s.left+s.width)&&Yl(l,s.top,s.top+s.height))return this.legendItems[n]}return null}handleEvent(r){let l=this.options;if(!fnt(r.type,l))return;let n=this._getLegendItemAt(r.x,r.y);if(r.type==="mousemove"||r.type==="mouseout"){let s=this._hoveredItem,d=pnt(s,n);s&&!d&&Pr(l.onLeave,[r,s,this],this),this._hoveredItem=n,n&&!d&&Pr(l.onHover,[r,n,this],this)}else n&&Pr(l.onClick,[r,n,this],this)}};function fnt(a,r){return!!((a==="mousemove"||a==="mouseout")&&(r.onHover||r.onLeave)||r.onClick&&(a==="click"||a==="mouseup"))}var gnt={id:"legend",_element:Eb,start(a,r,l){let n=a.legend=new Eb({ctx:a.ctx,options:l,chart:a});os.configure(a,n,l),os.addBox(a,n)},stop(a){os.removeBox(a,a.legend),delete a.legend},beforeUpdate(a,r,l){let n=a.legend;os.configure(a,n,l),n.options=l},afterUpdate(a){let r=a.legend;r.buildLabels(),r.adjustHitBoxes()},afterEvent(a,r){r.replay||a.legend.handleEvent(r.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(a,r,l){let n=r.datasetIndex,s=l.chart;s.isDatasetVisible(n)?(s.hide(n),r.hidden=!0):(s.show(n),r.hidden=!1)},onHover:null,onLeave:null,labels:{color:a=>a.chart.options.color,boxWidth:40,padding:10,generateLabels(a){let r=a.data.datasets,{labels:{usePointStyle:l,pointStyle:n,textAlign:s,color:d}}=a.legend.options;return a._getSortedDatasetMetas().map(m=>{let _=m.controller.getStyle(l?0:void 0),w=ts(_.borderWidth);return{text:r[m.index].label,fillStyle:_.backgroundColor,fontColor:d,hidden:!m.visible,lineCap:_.borderCapStyle,lineDash:_.borderDash,lineDashOffset:_.borderDashOffset,lineJoin:_.borderJoinStyle,lineWidth:(w.width+w.height)/4,strokeStyle:_.borderColor,pointStyle:n||_.pointStyle,rotation:_.rotation,textAlign:s||_.textAlign,borderRadius:0,datasetIndex:m.index}},this)}},title:{color:a=>a.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:a=>!a.startsWith("on"),labels:{_scriptable:a=>!["generateLabels","filter","sort"].includes(a)}}},Ng=class extends oa{constructor(r){super(),this.chart=r.chart,this.options=r.options,this.ctx=r.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(r,l){let n=this.options;if(this.left=0,this.top=0,!n.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=r,this.height=this.bottom=l;let s=Rr(n.text)?n.text.length:1;this._padding=ts(n.padding);let d=s*No(n.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=d:this.width=d}isHorizontal(){let r=this.options.position;return r==="top"||r==="bottom"}_drawArgs(r){let{top:l,left:n,bottom:s,right:d,options:m}=this,_=m.align,w=0,S,I,L;return this.isHorizontal()?(I=Jo(_,n,d),L=l+r,S=d-n):(m.position==="left"?(I=n+r,L=Jo(_,s,l),w=Ur*-.5):(I=d-r,L=Jo(_,l,s),w=Ur*.5),S=s-l),{titleX:I,titleY:L,maxWidth:S,rotation:w}}draw(){let r=this.ctx,l=this.options;if(!l.display)return;let n=No(l.font),d=n.lineHeight/2+this._padding.top,{titleX:m,titleY:_,maxWidth:w,rotation:S}=this._drawArgs(d);kd(r,l.text,0,0,n,{color:l.color,maxWidth:w,rotation:S,textAlign:sb(l.align),textBaseline:"middle",translation:[m,_]})}};function _nt(a,r){let l=new Ng({ctx:a.ctx,options:r,chart:a});os.configure(a,l,r),os.addBox(a,l),a.titleBlock=l}var vnt={id:"title",_element:Ng,start(a,r,l){_nt(a,l)},stop(a){let r=a.titleBlock;os.removeBox(a,r),delete a.titleBlock},beforeUpdate(a,r,l){let n=a.titleBlock;os.configure(a,n,l),n.options=l},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}},gb=new WeakMap,ynt={id:"subtitle",start(a,r,l){let n=new Ng({ctx:a.ctx,options:l,chart:a});os.configure(a,n,l),os.addBox(a,n),gb.set(a,n)},stop(a){os.removeBox(a,gb.get(a)),gb.delete(a)},beforeUpdate(a,r,l){let n=gb.get(a);os.configure(a,n,l),n.options=l},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}},Lg={average(a){if(!a.length)return!1;let r,l,n=0,s=0,d=0;for(r=0,l=a.length;r<l;++r){let m=a[r].element;if(m&&m.hasValue()){let _=m.tooltipPosition();n+=_.x,s+=_.y,++d}}return{x:n/d,y:s/d}},nearest(a,r){if(!a.length)return!1;let l=r.x,n=r.y,s=Number.POSITIVE_INFINITY,d,m,_;for(d=0,m=a.length;d<m;++d){let w=a[d].element;if(w&&w.hasValue()){let S=w.getCenterPoint(),I=eb(r,S);I<s&&(s=I,_=w)}}if(_){let w=_.tooltipPosition();l=w.x,n=w.y}return{x:l,y:n}}};function Zl(a,r){return r&&(Rr(r)?Array.prototype.push.apply(a,r):a.push(r)),a}function zc(a){return(typeof a=="string"||a instanceof String)&&a.indexOf(`
`)>-1?a.split(`
`):a}function bnt(a,r){let{element:l,datasetIndex:n,index:s}=r,d=a.getDatasetMeta(n).controller,{label:m,value:_}=d.getLabelAndValue(s);return{chart:a,label:m,parsed:d.getParsed(s),raw:a.data.datasets[n].data[s],formattedValue:_,dataset:d.getDataset(),dataIndex:s,datasetIndex:n,element:l}}function v4(a,r){let l=a.chart.ctx,{body:n,footer:s,title:d}=a,{boxWidth:m,boxHeight:_}=r,w=No(r.bodyFont),S=No(r.titleFont),I=No(r.footerFont),L=d.length,H=s.length,q=n.length,X=ts(r.padding),it=X.height,at=0,mt=n.reduce((Pt,Nt)=>Pt+Nt.before.length+Nt.lines.length+Nt.after.length,0);if(mt+=a.beforeBody.length+a.afterBody.length,L&&(it+=L*S.lineHeight+(L-1)*r.titleSpacing+r.titleMarginBottom),mt){let Pt=r.displayColors?Math.max(_,w.lineHeight):w.lineHeight;it+=q*Pt+(mt-q)*w.lineHeight+(mt-1)*r.bodySpacing}H&&(it+=r.footerMarginTop+H*I.lineHeight+(H-1)*r.footerSpacing);let Mt=0,Lt=function(Pt){at=Math.max(at,l.measureText(Pt).width+Mt)};return l.save(),l.font=S.string,lr(a.title,Lt),l.font=w.string,lr(a.beforeBody.concat(a.afterBody),Lt),Mt=r.displayColors?m+2+r.boxPadding:0,lr(n,Pt=>{lr(Pt.before,Lt),lr(Pt.lines,Lt),lr(Pt.after,Lt)}),Mt=0,l.font=I.string,lr(a.footer,Lt),l.restore(),at+=X.width,{width:at,height:it}}function xnt(a,r){let{y:l,height:n}=r;return l<n/2?"top":l>a.height-n/2?"bottom":"center"}function wnt(a,r,l,n){let{x:s,width:d}=n,m=l.caretSize+l.caretPadding;if(a==="left"&&s+d+m>r.width||a==="right"&&s-d-m<0)return!0}function Cnt(a,r,l,n){let{x:s,width:d}=l,{width:m,chartArea:{left:_,right:w}}=a,S="center";return n==="center"?S=s<=(_+w)/2?"left":"right":s<=d/2?S="left":s>=m-d/2&&(S="right"),wnt(S,a,r,l)&&(S="center"),S}function y4(a,r,l){let n=l.yAlign||r.yAlign||xnt(a,l);return{xAlign:l.xAlign||r.xAlign||Cnt(a,r,l,n),yAlign:n}}function Snt(a,r){let{x:l,width:n}=a;return r==="right"?l-=n:r==="center"&&(l-=n/2),l}function Ent(a,r,l){let{y:n,height:s}=a;return r==="top"?n+=l:r==="bottom"?n-=s+l:n-=s/2,n}function b4(a,r,l,n){let{caretSize:s,caretPadding:d,cornerRadius:m}=a,{xAlign:_,yAlign:w}=l,S=s+d,{topLeft:I,topRight:L,bottomLeft:H,bottomRight:q}=Rd(m),X=Snt(r,_),it=Ent(r,w,S);return w==="center"?_==="left"?X+=S:_==="right"&&(X-=S):_==="left"?X-=Math.max(I,H)+s:_==="right"&&(X+=Math.max(L,q)+s),{x:Ho(X,0,n.width-r.width),y:Ho(it,0,n.height-r.height)}}function _b(a,r,l){let n=ts(l.padding);return r==="center"?a.x+a.width/2:r==="right"?a.x+a.width-n.right:a.x+n.left}function x4(a){return Zl([],zc(a))}function Mnt(a,r,l){return Fc(a,{tooltip:r,tooltipItems:l,type:"tooltip"})}function w4(a,r){let l=r&&r.dataset&&r.dataset.tooltip&&r.dataset.tooltip.callbacks;return l?a.override(l):a}var C4=(()=>{class a extends oa{constructor(l){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=l.chart||l._chart,this._chart=this.chart,this.options=l.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(l){this.options=l,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){let l=this._cachedAnimations;if(l)return l;let n=this.chart,s=this.options.setContext(this.getContext()),d=s.enabled&&n.options.animation&&s.animations,m=new bb(this.chart,d);return d._cacheable&&(this._cachedAnimations=Object.freeze(m)),m}getContext(){return this.$context||(this.$context=Mnt(this.chart.getContext(),this,this._tooltipItems))}getTitle(l,n){let{callbacks:s}=n,d=s.beforeTitle.apply(this,[l]),m=s.title.apply(this,[l]),_=s.afterTitle.apply(this,[l]),w=[];return w=Zl(w,zc(d)),w=Zl(w,zc(m)),w=Zl(w,zc(_)),w}getBeforeBody(l,n){return x4(n.callbacks.beforeBody.apply(this,[l]))}getBody(l,n){let{callbacks:s}=n,d=[];return lr(l,m=>{let _={before:[],lines:[],after:[]},w=w4(s,m);Zl(_.before,zc(w.beforeLabel.call(this,m))),Zl(_.lines,w.label.call(this,m)),Zl(_.after,zc(w.afterLabel.call(this,m))),d.push(_)}),d}getAfterBody(l,n){return x4(n.callbacks.afterBody.apply(this,[l]))}getFooter(l,n){let{callbacks:s}=n,d=s.beforeFooter.apply(this,[l]),m=s.footer.apply(this,[l]),_=s.afterFooter.apply(this,[l]),w=[];return w=Zl(w,zc(d)),w=Zl(w,zc(m)),w=Zl(w,zc(_)),w}_createItems(l){let n=this._active,s=this.chart.data,d=[],m=[],_=[],w=[],S,I;for(S=0,I=n.length;S<I;++S)w.push(bnt(this.chart,n[S]));return l.filter&&(w=w.filter((L,H,q)=>l.filter(L,H,q,s))),l.itemSort&&(w=w.sort((L,H)=>l.itemSort(L,H,s))),lr(w,L=>{let H=w4(l.callbacks,L);d.push(H.labelColor.call(this,L)),m.push(H.labelPointStyle.call(this,L)),_.push(H.labelTextColor.call(this,L))}),this.labelColors=d,this.labelPointStyles=m,this.labelTextColors=_,this.dataPoints=w,w}update(l,n){let s=this.options.setContext(this.getContext()),d=this._active,m,_=[];if(!d.length)this.opacity!==0&&(m={opacity:0});else{let w=Lg[s.position].call(this,d,this._eventPosition);_=this._createItems(s),this.title=this.getTitle(_,s),this.beforeBody=this.getBeforeBody(_,s),this.body=this.getBody(_,s),this.afterBody=this.getAfterBody(_,s),this.footer=this.getFooter(_,s);let S=this._size=v4(this,s),I=Object.assign({},w,S),L=y4(this.chart,s,I),H=b4(s,I,L,this.chart);this.xAlign=L.xAlign,this.yAlign=L.yAlign,m={opacity:1,x:H.x,y:H.y,width:S.width,height:S.height,caretX:w.x,caretY:w.y}}this._tooltipItems=_,this.$context=void 0,m&&this._resolveAnimations().update(this,m),l&&s.external&&s.external.call(this,{chart:this.chart,tooltip:this,replay:n})}drawCaret(l,n,s,d){let m=this.getCaretPosition(l,s,d);n.lineTo(m.x1,m.y1),n.lineTo(m.x2,m.y2),n.lineTo(m.x3,m.y3)}getCaretPosition(l,n,s){let{xAlign:d,yAlign:m}=this,{caretSize:_,cornerRadius:w}=s,{topLeft:S,topRight:I,bottomLeft:L,bottomRight:H}=Rd(w),{x:q,y:X}=l,{width:it,height:at}=n,mt,Mt,Lt,Pt,Nt,ue;return m==="center"?(Nt=X+at/2,d==="left"?(mt=q,Mt=mt-_,Pt=Nt+_,ue=Nt-_):(mt=q+it,Mt=mt+_,Pt=Nt-_,ue=Nt+_),Lt=mt):(d==="left"?Mt=q+Math.max(S,L)+_:d==="right"?Mt=q+it-Math.max(I,H)-_:Mt=this.caretX,m==="top"?(Pt=X,Nt=Pt-_,mt=Mt-_,Lt=Mt+_):(Pt=X+at,Nt=Pt+_,mt=Mt+_,Lt=Mt-_),ue=Pt),{x1:mt,x2:Mt,x3:Lt,y1:Pt,y2:Nt,y3:ue}}drawTitle(l,n,s){let d=this.title,m=d.length,_,w,S;if(m){let I=Vu(s.rtl,this.x,this.width);for(l.x=_b(this,s.titleAlign,s),n.textAlign=I.textAlign(s.titleAlign),n.textBaseline="middle",_=No(s.titleFont),w=s.titleSpacing,n.fillStyle=s.titleColor,n.font=_.string,S=0;S<m;++S)n.fillText(d[S],I.x(l.x),l.y+_.lineHeight/2),l.y+=_.lineHeight+w,S+1===m&&(l.y+=s.titleMarginBottom-w)}}_drawColorBox(l,n,s,d,m){let _=this.labelColors[s],w=this.labelPointStyles[s],{boxHeight:S,boxWidth:I,boxPadding:L}=m,H=No(m.bodyFont),q=_b(this,"left",m),X=d.x(q),it=S<H.lineHeight?(H.lineHeight-S)/2:0,at=n.y+it;if(m.usePointStyle){let mt={radius:Math.min(I,S)/2,pointStyle:w.pointStyle,rotation:w.rotation,borderWidth:1},Mt=d.leftForLtr(X,I)+I/2,Lt=at+S/2;l.strokeStyle=m.multiKeyBackground,l.fillStyle=m.multiKeyBackground,lb(l,mt,Mt,Lt),l.strokeStyle=_.borderColor,l.fillStyle=_.backgroundColor,lb(l,mt,Mt,Lt)}else{l.lineWidth=In(_.borderWidth)?Math.max(...Object.values(_.borderWidth)):_.borderWidth||1,l.strokeStyle=_.borderColor,l.setLineDash(_.borderDash||[]),l.lineDashOffset=_.borderDashOffset||0;let mt=d.leftForLtr(X,I-L),Mt=d.leftForLtr(d.xPlus(X,1),I-L-2),Lt=Rd(_.borderRadius);Object.values(Lt).some(Pt=>Pt!==0)?(l.beginPath(),l.fillStyle=m.multiKeyBackground,Bm(l,{x:mt,y:at,w:I,h:S,radius:Lt}),l.fill(),l.stroke(),l.fillStyle=_.backgroundColor,l.beginPath(),Bm(l,{x:Mt,y:at+1,w:I-2,h:S-2,radius:Lt}),l.fill()):(l.fillStyle=m.multiKeyBackground,l.fillRect(mt,at,I,S),l.strokeRect(mt,at,I,S),l.fillStyle=_.backgroundColor,l.fillRect(Mt,at+1,I-2,S-2))}l.fillStyle=this.labelTextColors[s]}drawBody(l,n,s){let{body:d}=this,{bodySpacing:m,bodyAlign:_,displayColors:w,boxHeight:S,boxWidth:I,boxPadding:L}=s,H=No(s.bodyFont),q=H.lineHeight,X=0,it=Vu(s.rtl,this.x,this.width),at=function(Ue){n.fillText(Ue,it.x(l.x+X),l.y+q/2),l.y+=q+m},mt=it.textAlign(_),Mt,Lt,Pt,Nt,ue,Q,$t;for(n.textAlign=_,n.textBaseline="middle",n.font=H.string,l.x=_b(this,mt,s),n.fillStyle=s.bodyColor,lr(this.beforeBody,at),X=w&&mt!=="right"?_==="center"?I/2+L:I+2+L:0,Nt=0,Q=d.length;Nt<Q;++Nt){for(Mt=d[Nt],Lt=this.labelTextColors[Nt],n.fillStyle=Lt,lr(Mt.before,at),Pt=Mt.lines,w&&Pt.length&&(this._drawColorBox(n,l,Nt,it,s),q=Math.max(H.lineHeight,S)),ue=0,$t=Pt.length;ue<$t;++ue)at(Pt[ue]),q=H.lineHeight;lr(Mt.after,at)}X=0,q=H.lineHeight,lr(this.afterBody,at),l.y-=m}drawFooter(l,n,s){let d=this.footer,m=d.length,_,w;if(m){let S=Vu(s.rtl,this.x,this.width);for(l.x=_b(this,s.footerAlign,s),l.y+=s.footerMarginTop,n.textAlign=S.textAlign(s.footerAlign),n.textBaseline="middle",_=No(s.footerFont),n.fillStyle=s.footerColor,n.font=_.string,w=0;w<m;++w)n.fillText(d[w],S.x(l.x),l.y+_.lineHeight/2),l.y+=_.lineHeight+s.footerSpacing}}drawBackground(l,n,s,d){let{xAlign:m,yAlign:_}=this,{x:w,y:S}=l,{width:I,height:L}=s,{topLeft:H,topRight:q,bottomLeft:X,bottomRight:it}=Rd(d.cornerRadius);n.fillStyle=d.backgroundColor,n.strokeStyle=d.borderColor,n.lineWidth=d.borderWidth,n.beginPath(),n.moveTo(w+H,S),_==="top"&&this.drawCaret(l,n,s,d),n.lineTo(w+I-q,S),n.quadraticCurveTo(w+I,S,w+I,S+q),_==="center"&&m==="right"&&this.drawCaret(l,n,s,d),n.lineTo(w+I,S+L-it),n.quadraticCurveTo(w+I,S+L,w+I-it,S+L),_==="bottom"&&this.drawCaret(l,n,s,d),n.lineTo(w+X,S+L),n.quadraticCurveTo(w,S+L,w,S+L-X),_==="center"&&m==="left"&&this.drawCaret(l,n,s,d),n.lineTo(w,S+H),n.quadraticCurveTo(w,S,w+H,S),n.closePath(),n.fill(),d.borderWidth>0&&n.stroke()}_updateAnimationTarget(l){let n=this.chart,s=this.$animations,d=s&&s.x,m=s&&s.y;if(d||m){let _=Lg[l.position].call(this,this._active,this._eventPosition);if(!_)return;let w=this._size=v4(this,l),S=Object.assign({},_,this._size),I=y4(n,l,S),L=b4(l,S,I,n);(d._to!==L.x||m._to!==L.y)&&(this.xAlign=I.xAlign,this.yAlign=I.yAlign,this.width=w.width,this.height=w.height,this.caretX=_.x,this.caretY=_.y,this._resolveAnimations().update(this,L))}}_willRender(){return!!this.opacity}draw(l){let n=this.options.setContext(this.getContext()),s=this.opacity;if(!s)return;this._updateAnimationTarget(n);let d={width:this.width,height:this.height},m={x:this.x,y:this.y};s=Math.abs(s)<.001?0:s;let _=ts(n.padding),w=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;n.enabled&&w&&(l.save(),l.globalAlpha=s,this.drawBackground(m,l,d,n),cD(l,n.textDirection),m.y+=_.top,this.drawTitle(m,l,n),this.drawBody(m,l,n),this.drawFooter(m,l,n),dD(l,n.textDirection),l.restore())}getActiveElements(){return this._active||[]}setActiveElements(l,n){let s=this._active,d=l.map(({datasetIndex:w,index:S})=>{let I=this.chart.getDatasetMeta(w);if(!I)throw new Error("Cannot find a dataset at index "+w);return{datasetIndex:w,element:I.data[S],index:S}}),m=!Mg(s,d),_=this._positionChanged(d,n);(m||_)&&(this._active=d,this._eventPosition=n,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(l,n,s=!0){if(n&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;let d=this.options,m=this._active||[],_=this._getActiveElements(l,m,n,s),w=this._positionChanged(_,l),S=n||!Mg(_,m)||w;return S&&(this._active=_,(d.enabled||d.external)&&(this._eventPosition={x:l.x,y:l.y},this.update(!0,n))),S}_getActiveElements(l,n,s,d){let m=this.options;if(l.type==="mouseout")return[];if(!d)return n;let _=this.chart.getElementsAtEventForMode(l,m.mode,m,s);return m.reverse&&_.reverse(),_}_positionChanged(l,n){let{caretX:s,caretY:d,options:m}=this,_=Lg[m.position].call(this,l,n);return _!==!1&&(s!==_.x||d!==_.y)}}return a.positioners=Lg,a})(),Dnt={id:"tooltip",_element:C4,positioners:Lg,afterInit(a,r,l){l&&(a.tooltip=new C4({chart:a,options:l}))},beforeUpdate(a,r,l){a.tooltip&&a.tooltip.initialize(l)},reset(a,r,l){a.tooltip&&a.tooltip.initialize(l)},afterDraw(a){let r=a.tooltip;if(r&&r._willRender()){let l={tooltip:r};if(a.notifyPlugins("beforeTooltipDraw",l)===!1)return;r.draw(a.ctx),a.notifyPlugins("afterTooltipDraw",l)}},afterEvent(a,r){if(a.tooltip){let l=r.replay;a.tooltip.handleEvent(r.event,l,r.inChartArea)&&(r.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(a,r)=>r.bodyFont.size,boxWidth:(a,r)=>r.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:{beforeTitle:$l,title(a){if(a.length>0){let r=a[0],l=r.chart.data.labels,n=l?l.length:0;if(this&&this.options&&this.options.mode==="dataset")return r.dataset.label||"";if(r.label)return r.label;if(n>0&&r.dataIndex<n)return l[r.dataIndex]}return""},afterTitle:$l,beforeBody:$l,beforeLabel:$l,label(a){if(this&&this.options&&this.options.mode==="dataset")return a.label+": "+a.formattedValue||a.formattedValue;let r=a.dataset.label||"";r&&(r+=": ");let l=a.formattedValue;return zn(l)||(r+=l),r},labelColor(a){let l=a.chart.getDatasetMeta(a.datasetIndex).controller.getStyle(a.dataIndex);return{borderColor:l.borderColor,backgroundColor:l.backgroundColor,borderWidth:l.borderWidth,borderDash:l.borderDash,borderDashOffset:l.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(a){let l=a.chart.getDatasetMeta(a.datasetIndex).controller.getStyle(a.dataIndex);return{pointStyle:l.pointStyle,rotation:l.rotation}},afterLabel:$l,afterBody:$l,beforeFooter:$l,footer:$l,afterFooter:$l}},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:a=>a!=="filter"&&a!=="itemSort"&&a!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},Tnt=Object.freeze({__proto__:null,Decimation:$it,Filler:mnt,Legend:gnt,SubTitle:ynt,Title:vnt,Tooltip:Dnt}),Int=(a,r,l,n)=>(typeof r=="string"?(l=a.push(r)-1,n.unshift({index:l,label:r})):isNaN(r)&&(l=null),l);function Ant(a,r,l,n){let s=a.indexOf(r);if(s===-1)return Int(a,r,l,n);let d=a.lastIndexOf(r);return s!==d?l:s}var knt=(a,r)=>a===null?null:Ho(Math.round(a),0,r),Wm=class extends Uu{constructor(r){super(r),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(r){let l=this._addedLabels;if(l.length){let n=this.getLabels();for(let{index:s,label:d}of l)n[s]===d&&n.splice(s,1);this._addedLabels=[]}super.init(r)}parse(r,l){if(zn(r))return null;let n=this.getLabels();return l=isFinite(l)&&n[l]===r?l:Ant(n,r,nn(l,r),this._addedLabels),knt(l,n.length-1)}determineDataLimits(){let{minDefined:r,maxDefined:l}=this.getUserBounds(),{min:n,max:s}=this.getMinMax(!0);this.options.bounds==="ticks"&&(r||(n=0),l||(s=this.getLabels().length-1)),this.min=n,this.max=s}buildTicks(){let r=this.min,l=this.max,n=this.options.offset,s=[],d=this.getLabels();d=r===0&&l===d.length-1?d:d.slice(r,l+1),this._valueRange=Math.max(d.length-(n?0:1),1),this._startValue=this.min-(n?.5:0);for(let m=r;m<=l;m++)s.push({value:m});return s}getLabelForValue(r){let l=this.getLabels();return r>=0&&r<l.length?l[r]:r}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(r){return typeof r!="number"&&(r=this.parse(r)),r===null?NaN:this.getPixelForDecimal((r-this._startValue)/this._valueRange)}getPixelForTick(r){let l=this.ticks;return r<0||r>l.length-1?null:this.getPixelForValue(l[r].value)}getValueForPixel(r){return Math.round(this._startValue+this.getDecimalForPixel(r)*this._valueRange)}getBasePixel(){return this.bottom}};Wm.id="category";Wm.defaults={ticks:{callback:Wm.prototype.getLabelForValue}};function Rnt(a,r){let l=[],{bounds:s,step:d,min:m,max:_,precision:w,count:S,maxTicks:I,maxDigits:L,includeBounds:H}=a,q=d||1,X=I-1,{min:it,max:at}=r,mt=!zn(m),Mt=!zn(_),Lt=!zn(S),Pt=(at-it)/(L+1),Nt=BM((at-it)/X/q)*q,ue,Q,$t,Ue;if(Nt<1e-14&&!mt&&!Mt)return[{value:it},{value:at}];Ue=Math.ceil(at/Nt)-Math.floor(it/Nt),Ue>X&&(Nt=BM(Ue*Nt/X/q)*q),zn(w)||(ue=Math.pow(10,w),Nt=Math.ceil(Nt*ue)/ue),s==="ticks"?(Q=Math.floor(it/Nt)*Nt,$t=Math.ceil(at/Nt)*Nt):(Q=it,$t=at),mt&&Mt&&d&&uB((_-m)/d,Nt/1e3)?(Ue=Math.round(Math.min((_-m)/Nt,I)),Nt=(_-m)/Ue,Q=m,$t=_):Lt?(Q=mt?m:Q,$t=Mt?_:$t,Ue=S-1,Nt=($t-Q)/Ue):(Ue=($t-Q)/Nt,zm(Ue,Math.round(Ue),Nt/1e3)?Ue=Math.round(Ue):Ue=Math.ceil(Ue));let ki=Math.max(jM(Nt),jM(Q));ue=Math.pow(10,zn(w)?ki:w),Q=Math.round(Q*ue)/ue,$t=Math.round($t*ue)/ue;let fe=0;for(mt&&(H&&Q!==m?(l.push({value:m}),Q<m&&fe++,zm(Math.round((Q+fe*Nt)*ue)/ue,m,S4(m,Pt,a))&&fe++):Q<m&&fe++);fe<Ue;++fe)l.push({value:Math.round((Q+fe*Nt)*ue)/ue});return Mt&&H&&$t!==_?l.length&&zm(l[l.length-1].value,_,S4(_,Pt,a))?l[l.length-1].value=_:l.push({value:_}):(!Mt||$t===_)&&l.push({value:$t}),l}function S4(a,r,{horizontal:l,minRotation:n}){let s=Aa(n),d=(l?Math.sin(s):Math.cos(s))||.001,m=.75*r*(""+a).length;return Math.min(r/d,m)}var $m=class extends Uu{constructor(r){super(r),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(r,l){return zn(r)||(typeof r=="number"||r instanceof Number)&&!isFinite(+r)?null:+r}handleTickRangeOptions(){let{beginAtZero:r}=this.options,{minDefined:l,maxDefined:n}=this.getUserBounds(),{min:s,max:d}=this,m=w=>s=l?s:w,_=w=>d=n?d:w;if(r){let w=_l(s),S=_l(d);w<0&&S<0?_(0):w>0&&S>0&&m(0)}if(s===d){let w=1;(d>=Number.MAX_SAFE_INTEGER||s<=Number.MIN_SAFE_INTEGER)&&(w=Math.abs(d*.05)),_(d+w),r||m(s-w)}this.min=s,this.max=d}getTickLimit(){let r=this.options.ticks,{maxTicksLimit:l,stepSize:n}=r,s;return n?(s=Math.ceil(this.max/n)-Math.floor(this.min/n)+1,s>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${n} would result generating up to ${s} ticks. Limiting to 1000.`),s=1e3)):(s=this.computeTickLimit(),l=l||11),l&&(s=Math.min(l,s)),s}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){let r=this.options,l=r.ticks,n=this.getTickLimit();n=Math.max(2,n);let s={maxTicks:n,bounds:r.bounds,min:r.min,max:r.max,precision:l.precision,step:l.stepSize,count:l.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:l.minRotation||0,includeBounds:l.includeBounds!==!1},d=this._range||this,m=Rnt(s,d);return r.bounds==="ticks"&&VM(m,this,"value"),r.reverse?(m.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),m}configure(){let r=this.ticks,l=this.min,n=this.max;if(super.configure(),this.options.offset&&r.length){let s=(n-l)/Math.max(r.length-1,1)/2;l-=s,n+=s}this._startValue=l,this._endValue=n,this._valueRange=n-l}getLabelForValue(r){return jm(r,this.chart.options.locale,this.options.ticks.format)}},Bg=class extends $m{determineDataLimits(){let{min:r,max:l}=this.getMinMax(!0);this.min=_o(r)?r:0,this.max=_o(l)?l:1,this.handleTickRangeOptions()}computeTickLimit(){let r=this.isHorizontal(),l=r?this.width:this.height,n=Aa(this.options.ticks.minRotation),s=(r?Math.sin(n):Math.cos(n))||.001,d=this._resolveTickFontOptions(0);return Math.ceil(l/Math.min(40,d.lineHeight/s))}getPixelForValue(r){return r===null?NaN:this.getPixelForDecimal((r-this._startValue)/this._valueRange)}getValueForPixel(r){return this._startValue+this.getDecimalForPixel(r)*this._valueRange}};Bg.id="linear";Bg.defaults={ticks:{callback:Mb.formatters.numeric}};function E4(a){return a/Math.pow(10,Math.floor(ra(a)))===1}function Pnt(a,r){let l=Math.floor(ra(r.max)),n=Math.ceil(r.max/Math.pow(10,l)),s=[],d=na(a.min,Math.pow(10,Math.floor(ra(r.min)))),m=Math.floor(ra(d)),_=Math.floor(d/Math.pow(10,m)),w=m<0?Math.pow(10,Math.abs(m)):1;do s.push({value:d,major:E4(d)}),++_,_===10&&(_=1,++m,w=m>=0?1:w),d=Math.round(_*Math.pow(10,m)*w)/w;while(m<l||m===l&&_<n);let S=na(a.max,d);return s.push({value:S,major:E4(d)}),s}var Vg=class extends Uu{constructor(r){super(r),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(r,l){let n=$m.prototype.parse.apply(this,[r,l]);if(n===0){this._zero=!0;return}return _o(n)&&n>0?n:null}determineDataLimits(){let{min:r,max:l}=this.getMinMax(!0);this.min=_o(r)?Math.max(0,r):null,this.max=_o(l)?Math.max(0,l):null,this.options.beginAtZero&&(this._zero=!0),this.handleTickRangeOptions()}handleTickRangeOptions(){let{minDefined:r,maxDefined:l}=this.getUserBounds(),n=this.min,s=this.max,d=w=>n=r?n:w,m=w=>s=l?s:w,_=(w,S)=>Math.pow(10,Math.floor(ra(w))+S);n===s&&(n<=0?(d(1),m(10)):(d(_(n,-1)),m(_(s,1)))),n<=0&&d(_(s,-1)),s<=0&&m(_(n,1)),this._zero&&this.min!==this._suggestedMin&&n===_(this.min,0)&&d(_(n,-1)),this.min=n,this.max=s}buildTicks(){let r=this.options,l={min:this._userMin,max:this._userMax},n=Pnt(l,this);return r.bounds==="ticks"&&VM(n,this,"value"),r.reverse?(n.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),n}getLabelForValue(r){return r===void 0?"0":jm(r,this.chart.options.locale,this.options.ticks.format)}configure(){let r=this.min;super.configure(),this._startValue=ra(r),this._valueRange=ra(this.max)-ra(r)}getPixelForValue(r){return(r===void 0||r===0)&&(r=this.min),r===null||isNaN(r)?NaN:this.getPixelForDecimal(r===this.min?0:(ra(r)-this._startValue)/this._valueRange)}getValueForPixel(r){let l=this.getDecimalForPixel(r);return Math.pow(10,this._startValue+l*this._valueRange)}};Vg.id="logarithmic";Vg.defaults={ticks:{callback:Mb.formatters.logarithmic,major:{enabled:!0}}};function OD(a){let r=a.ticks;if(r.display&&a.display){let l=ts(r.backdropPadding);return nn(r.font&&r.font.size,An.font.size)+l.height}return 0}function Ont(a,r,l){return l=Rr(l)?l:[l],{w:SB(a,r.string,l),h:l.length*r.lineHeight}}function M4(a,r,l,n,s){return a===n||a===s?{start:r-l/2,end:r+l/2}:a<n||a>s?{start:r-l,end:r}:{start:r,end:r+l}}function Fnt(a){let r={l:a.left+a._padding.left,r:a.right-a._padding.right,t:a.top+a._padding.top,b:a.bottom-a._padding.bottom},l=Object.assign({},r),n=[],s=[],d=a._pointLabels.length,m=a.options.pointLabels,_=m.centerPointLabels?Ur/d:0;for(let w=0;w<d;w++){let S=m.setContext(a.getPointLabelContext(w));s[w]=S.padding;let I=a.getPointPosition(w,a.drawingArea+s[w],_),L=No(S.font),H=Ont(a.ctx,L,a._pointLabels[w]);n[w]=H;let q=Us(a.getIndexAngle(w)+_),X=Math.round(rb(q)),it=M4(X,I.x,H.w,0,180),at=M4(X,I.y,H.h,90,270);Lnt(l,r,q,it,at)}a.setCenterPoint(r.l-l.l,l.r-r.r,r.t-l.t,l.b-r.b),a._pointLabelItems=znt(a,n,s)}function Lnt(a,r,l,n,s){let d=Math.abs(Math.sin(l)),m=Math.abs(Math.cos(l)),_=0,w=0;n.start<r.l?(_=(r.l-n.start)/d,a.l=Math.min(a.l,r.l-_)):n.end>r.r&&(_=(n.end-r.r)/d,a.r=Math.max(a.r,r.r+_)),s.start<r.t?(w=(r.t-s.start)/m,a.t=Math.min(a.t,r.t-w)):s.end>r.b&&(w=(s.end-r.b)/m,a.b=Math.max(a.b,r.b+w))}function znt(a,r,l){let n=[],s=a._pointLabels.length,d=a.options,m=OD(d)/2,_=a.drawingArea,w=d.pointLabels.centerPointLabels?Ur/s:0;for(let S=0;S<s;S++){let I=a.getPointPosition(S,_+m+l[S],w),L=Math.round(rb(Us(I.angle+co))),H=r[S],q=Vnt(I.y,H.h,L),X=Nnt(L),it=Bnt(I.x,H.w,X);n.push({x:I.x,y:q,textAlign:X,left:it,top:q,right:it+H.w,bottom:q+H.h})}return n}function Nnt(a){return a===0||a===180?"center":a<180?"left":"right"}function Bnt(a,r,l){return l==="right"?a-=r:l==="center"&&(a-=r/2),a}function Vnt(a,r,l){return l===90||l===270?a-=r/2:(l>270||l<90)&&(a-=r),a}function jnt(a,r){let{ctx:l,options:{pointLabels:n}}=a;for(let s=r-1;s>=0;s--){let d=n.setContext(a.getPointLabelContext(s)),m=No(d.font),{x:_,y:w,textAlign:S,left:I,top:L,right:H,bottom:q}=a._pointLabelItems[s],{backdropColor:X}=d;if(!zn(X)){let it=Rd(d.borderRadius),at=ts(d.backdropPadding);l.fillStyle=X;let mt=I-at.left,Mt=L-at.top,Lt=H-I+at.width,Pt=q-L+at.height;Object.values(it).some(Nt=>Nt!==0)?(l.beginPath(),Bm(l,{x:mt,y:Mt,w:Lt,h:Pt,radius:it}),l.fill()):l.fillRect(mt,Mt,Lt,Pt)}kd(l,a._pointLabels[s],_,w+m.lineHeight/2,m,{color:d.color,textAlign:S,textBaseline:"middle"})}}function X4(a,r,l,n){let{ctx:s}=a;if(l)s.arc(a.xCenter,a.yCenter,r,0,mr);else{let d=a.getPointPosition(0,r);s.moveTo(d.x,d.y);for(let m=1;m<n;m++)d=a.getPointPosition(m,r),s.lineTo(d.x,d.y)}}function Unt(a,r,l,n){let s=a.ctx,d=r.circular,{color:m,lineWidth:_}=r;!d&&!n||!m||!_||l<0||(s.save(),s.strokeStyle=m,s.lineWidth=_,s.setLineDash(r.borderDash),s.lineDashOffset=r.borderDashOffset,s.beginPath(),X4(a,l,d,n),s.closePath(),s.stroke(),s.restore())}function Hnt(a,r,l){return Fc(a,{label:l,index:r,type:"pointLabel"})}var Hu=class extends $m{constructor(r){super(r),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){let r=this._padding=ts(OD(this.options)/2),l=this.width=this.maxWidth-r.width,n=this.height=this.maxHeight-r.height;this.xCenter=Math.floor(this.left+l/2+r.left),this.yCenter=Math.floor(this.top+n/2+r.top),this.drawingArea=Math.floor(Math.min(l,n)/2)}determineDataLimits(){let{min:r,max:l}=this.getMinMax(!1);this.min=_o(r)&&!isNaN(r)?r:0,this.max=_o(l)&&!isNaN(l)?l:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/OD(this.options))}generateTickLabels(r){$m.prototype.generateTickLabels.call(this,r),this._pointLabels=this.getLabels().map((l,n)=>{let s=Pr(this.options.pointLabels.callback,[l,n],this);return s||s===0?s:""}).filter((l,n)=>this.chart.getDataVisibility(n))}fit(){let r=this.options;r.display&&r.pointLabels.display?Fnt(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(r,l,n,s){this.xCenter+=Math.floor((r-l)/2),this.yCenter+=Math.floor((n-s)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(r,l,n,s))}getIndexAngle(r){let l=mr/(this._pointLabels.length||1),n=this.options.startAngle||0;return Us(r*l+Aa(n))}getDistanceFromCenterForValue(r){if(zn(r))return NaN;let l=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-r)*l:(r-this.min)*l}getValueForDistanceFromCenter(r){if(zn(r))return NaN;let l=r/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-l:this.min+l}getPointLabelContext(r){let l=this._pointLabels||[];if(r>=0&&r<l.length){let n=l[r];return Hnt(this.getContext(),r,n)}}getPointPosition(r,l,n=0){let s=this.getIndexAngle(r)-co+n;return{x:Math.cos(s)*l+this.xCenter,y:Math.sin(s)*l+this.yCenter,angle:s}}getPointPositionForValue(r,l){return this.getPointPosition(r,this.getDistanceFromCenterForValue(l))}getBasePosition(r){return this.getPointPositionForValue(r||0,this.getBaseValue())}getPointLabelPosition(r){let{left:l,top:n,right:s,bottom:d}=this._pointLabelItems[r];return{left:l,top:n,right:s,bottom:d}}drawBackground(){let{backgroundColor:r,grid:{circular:l}}=this.options;if(r){let n=this.ctx;n.save(),n.beginPath(),X4(this,this.getDistanceFromCenterForValue(this._endValue),l,this._pointLabels.length),n.closePath(),n.fillStyle=r,n.fill(),n.restore()}}drawGrid(){let r=this.ctx,l=this.options,{angleLines:n,grid:s}=l,d=this._pointLabels.length,m,_,w;if(l.pointLabels.display&&jnt(this,d),s.display&&this.ticks.forEach((S,I)=>{if(I!==0){_=this.getDistanceFromCenterForValue(S.value);let L=s.setContext(this.getContext(I-1));Unt(this,L,_,d)}}),n.display){for(r.save(),m=d-1;m>=0;m--){let S=n.setContext(this.getPointLabelContext(m)),{color:I,lineWidth:L}=S;!L||!I||(r.lineWidth=L,r.strokeStyle=I,r.setLineDash(S.borderDash),r.lineDashOffset=S.borderDashOffset,_=this.getDistanceFromCenterForValue(l.ticks.reverse?this.min:this.max),w=this.getPointPosition(m,_),r.beginPath(),r.moveTo(this.xCenter,this.yCenter),r.lineTo(w.x,w.y),r.stroke())}r.restore()}}drawBorder(){}drawLabels(){let r=this.ctx,l=this.options,n=l.ticks;if(!n.display)return;let s=this.getIndexAngle(0),d,m;r.save(),r.translate(this.xCenter,this.yCenter),r.rotate(s),r.textAlign="center",r.textBaseline="middle",this.ticks.forEach((_,w)=>{if(w===0&&!l.reverse)return;let S=n.setContext(this.getContext(w)),I=No(S.font);if(d=this.getDistanceFromCenterForValue(this.ticks[w].value),S.showLabelBackdrop){r.font=I.string,m=r.measureText(_.label).width,r.fillStyle=S.backdropColor;let L=ts(S.backdropPadding);r.fillRect(-m/2-L.left,-d-I.size/2-L.top,m+L.width,I.size+L.height)}kd(r,_.label,0,-d,I,{color:S.color})}),r.restore()}drawTitle(){}};Hu.id="radialLinear";Hu.defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Mb.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(a){return a},padding:5,centerPointLabels:!1}};Hu.defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};Hu.descriptors={angleLines:{_fallback:"grid"}};var Tb={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Hs=Object.keys(Tb);function Gnt(a,r){return a-r}function D4(a,r){if(zn(r))return null;let l=a._adapter,{parser:n,round:s,isoWeekday:d}=a._parseOpts,m=r;return typeof n=="function"&&(m=n(m)),_o(m)||(m=typeof n=="string"?l.parse(m,n):l.parse(m)),m===null?null:(s&&(m=s==="week"&&(Bu(d)||d===!0)?l.startOf(m,"isoWeek",d):l.startOf(m,s)),+m)}function T4(a,r,l,n){let s=Hs.length;for(let d=Hs.indexOf(a);d<s-1;++d){let m=Tb[Hs[d]],_=m.steps?m.steps:Number.MAX_SAFE_INTEGER;if(m.common&&Math.ceil((l-r)/(_*m.size))<=n)return Hs[d]}return Hs[s-1]}function qnt(a,r,l,n,s){for(let d=Hs.length-1;d>=Hs.indexOf(l);d--){let m=Hs[d];if(Tb[m].common&&a._adapter.diff(s,n,m)>=r-1)return m}return Hs[l?Hs.indexOf(l):0]}function Wnt(a){for(let r=Hs.indexOf(a)+1,l=Hs.length;r<l;++r)if(Tb[Hs[r]].common)return Hs[r]}function I4(a,r,l){if(!l)a[r]=!0;else if(l.length){let{lo:n,hi:s}=ob(l,r),d=l[n]>=r?l[n]:l[s];a[d]=!0}}function $nt(a,r,l,n){let s=a._adapter,d=+s.startOf(r[0].value,n),m=r[r.length-1].value,_,w;for(_=d;_<=m;_=+s.add(_,1,n))w=l[_],w>=0&&(r[w].major=!0);return r}function A4(a,r,l){let n=[],s={},d=r.length,m,_;for(m=0;m<d;++m)_=r[m],s[_]=m,n.push({value:_,major:!1});return d===0||!l?n:$nt(a,n,s,l)}var LD=(()=>{class a extends Uu{constructor(l){super(l),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(l,n){let s=l.time||(l.time={}),d=this._adapter=new Let._date(l.adapters.date);d.init(n),Lm(s.displayFormats,d.formats()),this._parseOpts={parser:s.parser,round:s.round,isoWeekday:s.isoWeekday},super.init(l),this._normalized=n.normalized}parse(l,n){return l===void 0?null:D4(this,l)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){let l=this.options,n=this._adapter,s=l.time.unit||"day",{min:d,max:m,minDefined:_,maxDefined:w}=this.getUserBounds();function S(I){!_&&!isNaN(I.min)&&(d=Math.min(d,I.min)),!w&&!isNaN(I.max)&&(m=Math.max(m,I.max))}(!_||!w)&&(S(this._getLabelBounds()),(l.bounds!=="ticks"||l.ticks.source!=="labels")&&S(this.getMinMax(!1))),d=_o(d)&&!isNaN(d)?d:+n.startOf(Date.now(),s),m=_o(m)&&!isNaN(m)?m:+n.endOf(Date.now(),s)+1,this.min=Math.min(d,m-1),this.max=Math.max(d+1,m)}_getLabelBounds(){let l=this.getLabelTimestamps(),n=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;return l.length&&(n=l[0],s=l[l.length-1]),{min:n,max:s}}buildTicks(){let l=this.options,n=l.time,s=l.ticks,d=s.source==="labels"?this.getLabelTimestamps():this._generate();l.bounds==="ticks"&&d.length&&(this.min=this._userMin||d[0],this.max=this._userMax||d[d.length-1]);let m=this.min,_=this.max,w=pB(d,m,_);return this._unit=n.unit||(s.autoSkip?T4(n.minUnit,this.min,this.max,this._getLabelCapacity(m)):qnt(this,w.length,n.minUnit,this.min,this.max)),this._majorUnit=!s.major.enabled||this._unit==="year"?void 0:Wnt(this._unit),this.initOffsets(d),l.reverse&&w.reverse(),A4(this,w,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(l=>+l.value))}initOffsets(l){let n=0,s=0,d,m;this.options.offset&&l.length&&(d=this.getDecimalForValue(l[0]),l.length===1?n=1-d:n=(this.getDecimalForValue(l[1])-d)/2,m=this.getDecimalForValue(l[l.length-1]),l.length===1?s=m:s=(m-this.getDecimalForValue(l[l.length-2]))/2);let _=l.length<3?.5:.25;n=Ho(n,0,_),s=Ho(s,0,_),this._offsets={start:n,end:s,factor:1/(n+1+s)}}_generate(){let l=this._adapter,n=this.min,s=this.max,d=this.options,m=d.time,_=m.unit||T4(m.minUnit,n,s,this._getLabelCapacity(n)),w=nn(m.stepSize,1),S=_==="week"?m.isoWeekday:!1,I=Bu(S)||S===!0,L={},H=n,q,X;if(I&&(H=+l.startOf(H,"isoWeek",S)),H=+l.startOf(H,I?"day":_),l.diff(s,n,_)>1e5*w)throw new Error(n+" and "+s+" are too far apart with stepSize of "+w+" "+_);let it=d.ticks.source==="data"&&this.getDataTimestamps();for(q=H,X=0;q<s;q=+l.add(q,w,_),X++)I4(L,q,it);return(q===s||d.bounds==="ticks"||X===1)&&I4(L,q,it),Object.keys(L).sort((at,mt)=>at-mt).map(at=>+at)}getLabelForValue(l){let n=this._adapter,s=this.options.time;return s.tooltipFormat?n.format(l,s.tooltipFormat):n.format(l,s.displayFormats.datetime)}_tickFormatFunction(l,n,s,d){let m=this.options,_=m.time.displayFormats,w=this._unit,S=this._majorUnit,I=w&&_[w],L=S&&_[S],H=s[n],q=S&&L&&H&&H.major,X=this._adapter.format(l,d||(q?L:I)),it=m.ticks.callback;return it?Pr(it,[X,n,s],this):X}generateTickLabels(l){let n,s,d;for(n=0,s=l.length;n<s;++n)d=l[n],d.label=this._tickFormatFunction(d.value,n,l)}getDecimalForValue(l){return l===null?NaN:(l-this.min)/(this.max-this.min)}getPixelForValue(l){let n=this._offsets,s=this.getDecimalForValue(l);return this.getPixelForDecimal((n.start+s)*n.factor)}getValueForPixel(l){let n=this._offsets,s=this.getDecimalForPixel(l)/n.factor-n.end;return this.min+s*(this.max-this.min)}_getLabelSize(l){let n=this.options.ticks,s=this.ctx.measureText(l).width,d=Aa(this.isHorizontal()?n.maxRotation:n.minRotation),m=Math.cos(d),_=Math.sin(d),w=this._resolveTickFontOptions(0).size;return{w:s*m+w*_,h:s*_+w*m}}_getLabelCapacity(l){let n=this.options.time,s=n.displayFormats,d=s[n.unit]||s.millisecond,m=this._tickFormatFunction(l,0,A4(this,[l],this._majorUnit),d),_=this._getLabelSize(m),w=Math.floor(this.isHorizontal()?this.width/_.w:this.height/_.h)-1;return w>0?w:1}getDataTimestamps(){let l=this._cache.data||[],n,s;if(l.length)return l;let d=this.getMatchingVisibleMetas();if(this._normalized&&d.length)return this._cache.data=d[0].controller.getAllParsedValues(this);for(n=0,s=d.length;n<s;++n)l=l.concat(d[n].controller.getAllParsedValues(this));return this._cache.data=this.normalize(l)}getLabelTimestamps(){let l=this._cache.labels||[],n,s;if(l.length)return l;let d=this.getLabels();for(n=0,s=d.length;n<s;++n)l.push(D4(this,d[n]));return this._cache.labels=this._normalized?l:this.normalize(l)}normalize(l){return GM(l.sort(Gnt))}}return a.id="time",a.defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",major:{enabled:!1}}},a})();function vb(a,r,l){let n=0,s=a.length-1,d,m,_,w;l?(r>=a[n].pos&&r<=a[s].pos&&({lo:n,hi:s}=Wl(a,"pos",r)),{pos:d,time:_}=a[n],{pos:m,time:w}=a[s]):(r>=a[n].time&&r<=a[s].time&&({lo:n,hi:s}=Wl(a,"time",r)),{time:d,pos:_}=a[n],{time:m,pos:w}=a[s]);let S=m-d;return S?_+(w-_)*(r-d)/S:_}var jg=class extends LD{constructor(r){super(r),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){let r=this._getTimestampsForTable(),l=this._table=this.buildLookupTable(r);this._minPos=vb(l,this.min),this._tableRange=vb(l,this.max)-this._minPos,super.initOffsets(r)}buildLookupTable(r){let{min:l,max:n}=this,s=[],d=[],m,_,w,S,I;for(m=0,_=r.length;m<_;++m)S=r[m],S>=l&&S<=n&&s.push(S);if(s.length<2)return[{time:l,pos:0},{time:n,pos:1}];for(m=0,_=s.length;m<_;++m)I=s[m+1],w=s[m-1],S=s[m],Math.round((I+w)/2)!==S&&d.push({time:S,pos:m/(_-1)});return d}_getTimestampsForTable(){let r=this._cache.all||[];if(r.length)return r;let l=this.getDataTimestamps(),n=this.getLabelTimestamps();return l.length&&n.length?r=this.normalize(l.concat(n)):r=l.length?l:n,r=this._cache.all=r,r}getDecimalForValue(r){return(vb(this._table,r)-this._minPos)/this._tableRange}getValueForPixel(r){let l=this._offsets,n=this.getDecimalForPixel(r)/l.factor-l.end;return vb(this._table,n*this._tableRange+this._minPos,!0)}};jg.id="timeseries";jg.defaults=LD.defaults;var Ynt=Object.freeze({__proto__:null,CategoryScale:Wm,LinearScale:Bg,LogarithmicScale:Vg,RadialLinearScale:Hu,TimeScale:LD,TimeSeriesScale:jg}),K4=[Oet,Hit,Tnt,Ynt];var Q4=(()=>{let r=class r{constructor(n,s){this.http=n,this.jwtHandler=s}fetchStatistics(n){return this.http.get(be+"/statistics/"+n,{headers:{Authorization:"Bearer "+this.jwtHandler.getToken()}})}};r.\u0275fac=function(s){return new(s||r)(ht(Hi),ht(yy))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function Xnt(a,r){if(a&1&&(T(0,"div",22)(1,"div",23)(2,"div",24)(3,"strong"),B(4),k()(),T(5,"div",25)(6,"strong"),B(7),k()()()()),a&2){let l=r.$implicit;z(4),Te(l.title),z(3),Te(l.value)}}Kl.register(...K4);var J4=(()=>{let r=class r{constructor(n){this.statisticsService=n,this.filter="all",this.statistics={},this.predefinedColors=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf","#aec7e8","#ffbb78","#98df8a","#ff9896","#c5b0d5","#c49c94","#f7b6d2","#c7c7c7","#dbdb8d","#9edae5"],this.locationsColors=[],this.cardStatistics=[]}ngOnInit(){this.statisticsService.fetchStatistics(this.filter).subscribe(n=>{this.statistics=n,this.locationsColors=this.statistics.locationsWithAllEventsCount.map(s=>({[s.location.name]:this.predefinedColors.pop()})),this.setCardStatistics(),this.locationWithAllEventsChart=this.drawLocationsChart(this.statistics.locationsWithAllEventsCount,"location-with-all-events-chart"),this.locationWithAvailableEventsChart=this.drawLocationsChart(this.statistics.locationsWithAvailableEventsCount,"location-with-available-events-chart"),this.eventsWithTicketsSoldChart=this.drawEventsChart(this.statistics.eventsWithTicketsSoldCount,"events-with-most-tickets-sold-chart")})}setCardStatistics(){this.cardStatistics=[{title:"Numarul total de utilizatori adaugati",value:this.statistics.totalNumberOfUsers},{title:"Numarul total de comenzi confirmate efectuate",value:this.statistics.totalNumberOfConfirmedOrders},{title:"Numarul total de bilete vandute",value:this.statistics.totalNumberOfConfirmedTicketsSold},{title:"Incasari",value:this.statistics.totalRevenue+" RON"},{title:"Numarul total de locatii adaugate",value:this.statistics.totalNumberOfLocations},{title:"Numarul total de evenimente adaugate",value:this.statistics.totalNumberOfEvents},{title:"Numarul total de evenimente adaugate disponibile",value:this.statistics.totalNumberOfAvailableEvents}]}drawLocationsChart(n,s){return new Kl(s,{type:"bar",data:{labels:n.map(d=>d.location.name),datasets:[{data:n.map(d=>d.eventsCount),borderWidth:1,backgroundColor:n.map(d=>{let m=this.locationsColors.find(_=>_.hasOwnProperty(d.location.name));return m?m[d.location.name]:""})}]},options:{scales:{y:{beginAtZero:!0}},plugins:{legend:{display:!1}}}})}drawEventsChart(n,s){return new Kl(s,{type:"bar",data:{labels:n.map(d=>d.event.title),datasets:[{data:n.map(d=>d.ticketsSoldCount),borderWidth:1,backgroundColor:this.predefinedColors}]},options:{scales:{y:{beginAtZero:!0}},plugins:{legend:{display:!1}}}})}refreshStatistics(){this.statisticsService.fetchStatistics(this.filter).subscribe(n=>{this.statistics=n,console.log(this.statistics),this.setCardStatistics(),this.updateLocationsChart(this.locationWithAllEventsChart,this.statistics.locationsWithAllEventsCount),this.updateLocationsChart(this.locationWithAvailableEventsChart,this.statistics.locationsWithAvailableEventsCount),this.updateEventsChart(this.eventsWithTicketsSoldChart,this.statistics.eventsWithTicketsSoldCount)})}updateLocationsChart(n,s){n.data.labels=s.map(d=>d.location.name),n.data.datasets[0].data=s.map(d=>d.eventsCount),n.update()}updateEventsChart(n,s){n.data.labels=s.map(d=>d.event.title),n.data.datasets[0].data=s.map(d=>d.ticketsSoldCount),n.update()}};r.\u0275fac=function(s){return new(s||r)(V(Q4))},r.\u0275cmp=St({type:r,selectors:[["app-statistics"]],standalone:!0,features:[At],decls:38,vars:2,consts:[[1,"container-fluid"],[1,"text-center","pt-2","pb-4"],[1,"mb-3"],["for","filter",1,"form-label"],["id","filter","name","filter",1,"form-select",3,"ngModel","ngModelChange","change"],["value","all"],["value","last-day"],["value","last-week"],["value","last-month"],["value","last-3months"],["value","last-year"],[1,"d-flex","justify-content-center","align-items-center"],[1,"row","row-cols-1","row-cols-sm-2","row-cols-md-3","row-cols-lg-4"],["class","col-lg-4",4,"ngFor","ngForOf"],[1,"pt-3","pb-3"],[1,"charts-container"],[1,"row"],[1,"col-md-6","stat"],[1,"text-center"],["id","location-with-all-events-chart","width","400","height","250"],["id","location-with-available-events-chart","width","400","height","250"],["id","events-with-most-tickets-sold-chart","width","400","height","250"],[1,"col-lg-4"],[1,"card","mb-4","stat"],[1,"card-header","d-flex","text-center","justify-content-center","align-items-center"],[1,"card-text","d-flex","justify-content-center","align-items-center"]],template:function(s,d){s&1&&(T(0,"div",0)(1,"h1",1),B(2,"Statistici"),k(),T(3,"div",2)(4,"label",3),B(5,"Filter"),k(),T(6,"select",4),Cn("ngModelChange",function(_){return wn(d.filter,_)||(d.filter=_),_}),ct("change",function(){return d.refreshStatistics()}),T(7,"option",5),B(8,"Toate"),k(),T(9,"option",6),B(10,"Ultima zi"),k(),T(11,"option",7),B(12,"Ultima saptamana"),k(),T(13,"option",8),B(14,"Ultima luna"),k(),T(15,"option",9),B(16,"Ultimele 3 luni"),k(),T(17,"option",10),B(18,"Ultimul an"),k()()(),T(19,"div",11)(20,"div",12),ut(21,Xnt,8,2,"div",13),k()(),dt(22,"hr",14),T(23,"div",15)(24,"div",16)(25,"div",17)(26,"h3",18),B(27,"Locatii si numarul total de evenimente adaugate"),k(),dt(28,"canvas",19),k(),T(29,"div",17)(30,"h3",18),B(31,"Locatii si numarul de evenimente adaugate disponibile"),k(),dt(32,"canvas",20),k()(),T(33,"div",16)(34,"div",17)(35,"h3",18),B(36,"Evenimente cu cele mai multe bilete vandute"),k(),dt(37,"canvas",21),k()()()()),s&2&&(z(6),xn("ngModel",d.filter),z(15),W("ngForOf",d.cardStatistics))},dependencies:[pi,Mn,Fs,Ls,Ca,qi,Ni,To],styles:[".container-fluid[_ngcontent-%COMP%]{padding-bottom:20px;padding-right:20px}.card[_ngcontent-%COMP%]{max-width:500px;height:150px}.card-header[_ngcontent-%COMP%]{position:relative;font-size:20px}.card-text[_ngcontent-%COMP%]{height:200px;position:relative}.stat[_ngcontent-%COMP%]{padding:5px}.stat[_ngcontent-%COMP%]:hover{box-shadow:0 0 10px #0003;transition:.3s}select[_ngcontent-%COMP%]{width:200px}"]});let a=r;return a})();function Qnt(a,r){a&1&&Ai(0,2)}function Jnt(a,r){a&1&&(T(0,"thead",0),Ps(1,1),k(),T(2,"tbody",0),Ps(3,2)(4,3),k(),T(5,"tfoot",0),Ps(6,4),k())}function trt(a,r){a&1&&Ps(0,1)(1,2)(2,3)(3,4)}var ert=[[["caption"]],[["colgroup"],["col"]],"*"],irt=["caption","colgroup, col","*"];function jD(a){return class extends a{get sticky(){return this._sticky}set sticky(r){let l=this._sticky;this._sticky=ao(r),this._hasStickyChanged=l!==this._sticky}hasStickyChanged(){let r=this._hasStickyChanged;return this._hasStickyChanged=!1,r}resetStickyChanged(){this._hasStickyChanged=!1}constructor(...r){super(...r),this._sticky=!1,this._hasStickyChanged=!1}}}var vl=new Se("CDK_TABLE");var Ob=(()=>{let r=class r{constructor(n){this.template=n}};r.\u0275fac=function(s){return new(s||r)(V(Mo))},r.\u0275dir=oe({type:r,selectors:[["","cdkCellDef",""]],standalone:!0});let a=r;return a})(),Fb=(()=>{let r=class r{constructor(n){this.template=n}};r.\u0275fac=function(s){return new(s||r)(V(Mo))},r.\u0275dir=oe({type:r,selectors:[["","cdkHeaderCellDef",""]],standalone:!0});let a=r;return a})(),i5=(()=>{let r=class r{constructor(n){this.template=n}};r.\u0275fac=function(s){return new(s||r)(V(Mo))},r.\u0275dir=oe({type:r,selectors:[["","cdkFooterCellDef",""]],standalone:!0});let a=r;return a})(),zD=class{},nrt=jD(zD),Ym=(()=>{let r=class r extends nrt{get name(){return this._name}set name(n){this._setNameInput(n)}get stickyEnd(){return this._stickyEnd}set stickyEnd(n){n!==this._stickyEnd&&(this._stickyEnd=n,this._hasStickyChanged=!0)}constructor(n){super(),this._table=n,this._stickyEnd=!1}_updateColumnCssClassName(){this._columnCssClassName=[`cdk-column-${this.cssClassFriendlyName}`]}_setNameInput(n){n&&(this._name=n,this.cssClassFriendlyName=n.replace(/[^a-z0-9_-]/gi,"-"),this._updateColumnCssClassName())}};r.\u0275fac=function(s){return new(s||r)(V(vl,8))},r.\u0275dir=oe({type:r,selectors:[["","cdkColumnDef",""]],contentQueries:function(s,d,m){if(s&1&&(fn(m,Ob,5),fn(m,Fb,5),fn(m,i5,5)),s&2){let _;se(_=ae())&&(d.cell=_.first),se(_=ae())&&(d.headerCell=_.first),se(_=ae())&&(d.footerCell=_.first)}},inputs:{sticky:"sticky",name:[Rt.None,"cdkColumnDef","name"],stickyEnd:[Rt.HasDecoratorInputTransform,"stickyEnd","stickyEnd",Qe]},standalone:!0,features:[ji([{provide:"MAT_SORT_HEADER_COLUMN_DEF",useExisting:r}]),Fn,Di]});let a=r;return a})(),Ab=class{constructor(r,l){l.nativeElement.classList.add(...r._columnCssClassName)}},n5=(()=>{let r=class r extends Ab{constructor(n,s){super(n,s)}};r.\u0275fac=function(s){return new(s||r)(V(Ym),V(Ee))},r.\u0275dir=oe({type:r,selectors:[["cdk-header-cell"],["th","cdk-header-cell",""]],hostAttrs:["role","columnheader",1,"cdk-header-cell"],standalone:!0,features:[Di]});let a=r;return a})();var r5=(()=>{let r=class r extends Ab{constructor(n,s){super(n,s);let d=n._table?._getCellRole();d&&s.nativeElement.setAttribute("role",d)}};r.\u0275fac=function(s){return new(s||r)(V(Ym),V(Ee))},r.\u0275dir=oe({type:r,selectors:[["cdk-cell"],["td","cdk-cell",""]],hostAttrs:[1,"cdk-cell"],standalone:!0,features:[Di]});let a=r;return a})(),kb=class{constructor(){this.tasks=[],this.endTasks=[]}},Rb=new Se("_COALESCED_STYLE_SCHEDULER"),UD=(()=>{let r=class r{constructor(n){this._ngZone=n,this._currentSchedule=null,this._destroyed=new pe}schedule(n){this._createScheduleIfNeeded(),this._currentSchedule.tasks.push(n)}scheduleEnd(n){this._createScheduleIfNeeded(),this._currentSchedule.endTasks.push(n)}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}_createScheduleIfNeeded(){this._currentSchedule||(this._currentSchedule=new kb,this._getScheduleObservable().pipe(ni(this._destroyed)).subscribe(()=>{for(;this._currentSchedule.tasks.length||this._currentSchedule.endTasks.length;){let n=this._currentSchedule;this._currentSchedule=new kb;for(let s of n.tasks)s();for(let s of n.endTasks)s()}this._currentSchedule=null}))}_getScheduleObservable(){return this._ngZone.isStable?Oo(Promise.resolve(void 0)):this._ngZone.onStable.pipe(tn(1))}};r.\u0275fac=function(s){return new(s||r)(ht(Be))},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})();var HD=(()=>{let r=class r{constructor(n,s){this.template=n,this._differs=s}ngOnChanges(n){if(!this._columnsDiffer){let s=n.columns&&n.columns.currentValue||[];this._columnsDiffer=this._differs.find(s).create(),this._columnsDiffer.diff(s)}}getColumnsDiff(){return this._columnsDiffer.diff(this.columns)}extractCellTemplate(n){return this instanceof Hg?n.headerCell.template:this instanceof GD?n.footerCell.template:n.cell.template}};r.\u0275fac=function(s){return new(s||r)(V(Mo),V(wu))},r.\u0275dir=oe({type:r,features:[Yn]});let a=r;return a})(),ND=class extends HD{},rrt=jD(ND),Hg=(()=>{let r=class r extends rrt{constructor(n,s,d){super(n,s),this._table=d}ngOnChanges(n){super.ngOnChanges(n)}};r.\u0275fac=function(s){return new(s||r)(V(Mo),V(wu),V(vl,8))},r.\u0275dir=oe({type:r,selectors:[["","cdkHeaderRowDef",""]],inputs:{columns:[Rt.None,"cdkHeaderRowDef","columns"],sticky:[Rt.None,"cdkHeaderRowDefSticky","sticky"]},standalone:!0,features:[Di,Yn]});let a=r;return a})(),BD=class extends HD{},ort=jD(BD),GD=(()=>{let r=class r extends ort{constructor(n,s,d){super(n,s),this._table=d}ngOnChanges(n){super.ngOnChanges(n)}};r.\u0275fac=function(s){return new(s||r)(V(Mo),V(wu),V(vl,8))},r.\u0275dir=oe({type:r,selectors:[["","cdkFooterRowDef",""]],inputs:{columns:[Rt.None,"cdkFooterRowDef","columns"],sticky:[Rt.None,"cdkFooterRowDefSticky","sticky"]},standalone:!0,features:[Di,Yn]});let a=r;return a})(),Lb=(()=>{let r=class r extends HD{constructor(n,s,d){super(n,s),this._table=d}};r.\u0275fac=function(s){return new(s||r)(V(Mo),V(wu),V(vl,8))},r.\u0275dir=oe({type:r,selectors:[["","cdkRowDef",""]],inputs:{columns:[Rt.None,"cdkRowDefColumns","columns"],when:[Rt.None,"cdkRowDefWhen","when"]},standalone:!0,features:[Di]});let a=r;return a})(),Gu=(()=>{let r=class r{constructor(n){this._viewContainer=n,r.mostRecentCellOutlet=this}ngOnDestroy(){r.mostRecentCellOutlet===this&&(r.mostRecentCellOutlet=null)}};r.mostRecentCellOutlet=null,r.\u0275fac=function(s){return new(s||r)(V(Do))},r.\u0275dir=oe({type:r,selectors:[["","cdkCellOutlet",""]],standalone:!0});let a=r;return a})(),qD=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=St({type:r,selectors:[["cdk-header-row"],["tr","cdk-header-row",""]],hostAttrs:["role","row",1,"cdk-header-row"],standalone:!0,features:[At],decls:1,vars:0,consts:[["cdkCellOutlet",""]],template:function(s,d){s&1&&Ps(0,0)},dependencies:[Gu],encapsulation:2});let a=r;return a})();var WD=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=St({type:r,selectors:[["cdk-row"],["tr","cdk-row",""]],hostAttrs:["role","row",1,"cdk-row"],standalone:!0,features:[At],decls:1,vars:0,consts:[["cdkCellOutlet",""]],template:function(s,d){s&1&&Ps(0,0)},dependencies:[Gu],encapsulation:2});let a=r;return a})(),o5=(()=>{let r=class r{constructor(n){this.templateRef=n,this._contentClassName="cdk-no-data-row"}};r.\u0275fac=function(s){return new(s||r)(V(Mo))},r.\u0275dir=oe({type:r,selectors:[["ng-template","cdkNoDataRow",""]],standalone:!0});let a=r;return a})(),t5=["top","bottom","left","right"],VD=class{constructor(r,l,n,s,d=!0,m=!0,_){this._isNativeHtmlTable=r,this._stickCellCss=l,this.direction=n,this._coalescedStyleScheduler=s,this._isBrowser=d,this._needsPositionStickyOnElement=m,this._positionListener=_,this._cachedCellWidths=[],this._borderCellCss={top:`${l}-border-elem-top`,bottom:`${l}-border-elem-bottom`,left:`${l}-border-elem-left`,right:`${l}-border-elem-right`}}clearStickyPositioning(r,l){let n=[];for(let s of r)if(s.nodeType===s.ELEMENT_NODE){n.push(s);for(let d=0;d<s.children.length;d++)n.push(s.children[d])}this._coalescedStyleScheduler.schedule(()=>{for(let s of n)this._removeStickyStyle(s,l)})}updateStickyColumns(r,l,n,s=!0){if(!r.length||!this._isBrowser||!(l.some(d=>d)||n.some(d=>d))){this._positionListener&&(this._positionListener.stickyColumnsUpdated({sizes:[]}),this._positionListener.stickyEndColumnsUpdated({sizes:[]}));return}this._coalescedStyleScheduler.schedule(()=>{let d=r[0],m=d.children.length,_=this._getCellWidths(d,s),w=this._getStickyStartColumnPositions(_,l),S=this._getStickyEndColumnPositions(_,n),I=l.lastIndexOf(!0),L=n.indexOf(!0),H=this.direction==="rtl",q=H?"right":"left",X=H?"left":"right";for(let it of r)for(let at=0;at<m;at++){let mt=it.children[at];l[at]&&this._addStickyStyle(mt,q,w[at],at===I),n[at]&&this._addStickyStyle(mt,X,S[at],at===L)}this._positionListener&&(this._positionListener.stickyColumnsUpdated({sizes:I===-1?[]:_.slice(0,I+1).map((it,at)=>l[at]?it:null)}),this._positionListener.stickyEndColumnsUpdated({sizes:L===-1?[]:_.slice(L).map((it,at)=>n[at+L]?it:null).reverse()}))})}stickRows(r,l,n){this._isBrowser&&this._coalescedStyleScheduler.schedule(()=>{let s=n==="bottom"?r.slice().reverse():r,d=n==="bottom"?l.slice().reverse():l,m=[],_=[],w=[];for(let I=0,L=0;I<s.length;I++){if(!d[I])continue;m[I]=L;let H=s[I];w[I]=this._isNativeHtmlTable?Array.from(H.children):[H];let q=H.getBoundingClientRect().height;L+=q,_[I]=q}let S=d.lastIndexOf(!0);for(let I=0;I<s.length;I++){if(!d[I])continue;let L=m[I],H=I===S;for(let q of w[I])this._addStickyStyle(q,n,L,H)}n==="top"?this._positionListener?.stickyHeaderRowsUpdated({sizes:_,offsets:m,elements:w}):this._positionListener?.stickyFooterRowsUpdated({sizes:_,offsets:m,elements:w})})}updateStickyFooterContainer(r,l){this._isNativeHtmlTable&&this._coalescedStyleScheduler.schedule(()=>{let n=r.querySelector("tfoot");n&&(l.some(s=>!s)?this._removeStickyStyle(n,["bottom"]):this._addStickyStyle(n,"bottom",0,!1))})}_removeStickyStyle(r,l){for(let s of l)r.style[s]="",r.classList.remove(this._borderCellCss[s]);t5.some(s=>l.indexOf(s)===-1&&r.style[s])?r.style.zIndex=this._getCalculatedZIndex(r):(r.style.zIndex="",this._needsPositionStickyOnElement&&(r.style.position=""),r.classList.remove(this._stickCellCss))}_addStickyStyle(r,l,n,s){r.classList.add(this._stickCellCss),s&&r.classList.add(this._borderCellCss[l]),r.style[l]=`${n}px`,r.style.zIndex=this._getCalculatedZIndex(r),this._needsPositionStickyOnElement&&(r.style.cssText+="position: -webkit-sticky; position: sticky; ")}_getCalculatedZIndex(r){let l={top:100,bottom:10,left:1,right:1},n=0;for(let s of t5)r.style[s]&&(n+=l[s]);return n?`${n}`:""}_getCellWidths(r,l=!0){if(!l&&this._cachedCellWidths.length)return this._cachedCellWidths;let n=[],s=r.children;for(let d=0;d<s.length;d++){let m=s[d];n.push(m.getBoundingClientRect().width)}return this._cachedCellWidths=n,n}_getStickyStartColumnPositions(r,l){let n=[],s=0;for(let d=0;d<r.length;d++)l[d]&&(n[d]=s,s+=r[d]);return n}_getStickyEndColumnPositions(r,l){let n=[],s=0;for(let d=r.length;d>0;d--)l[d]&&(n[d]=s,s+=r[d]);return n}};var Pb=new Se("CDK_SPL");var $D=(()=>{let r=class r{constructor(n,s){this.viewContainer=n,this.elementRef=s;let d=le(vl);d._rowOutlet=this,d._outletAssigned()}};r.\u0275fac=function(s){return new(s||r)(V(Do),V(Ee))},r.\u0275dir=oe({type:r,selectors:[["","rowOutlet",""]],standalone:!0});let a=r;return a})(),YD=(()=>{let r=class r{constructor(n,s){this.viewContainer=n,this.elementRef=s;let d=le(vl);d._headerRowOutlet=this,d._outletAssigned()}};r.\u0275fac=function(s){return new(s||r)(V(Do),V(Ee))},r.\u0275dir=oe({type:r,selectors:[["","headerRowOutlet",""]],standalone:!0});let a=r;return a})(),ZD=(()=>{let r=class r{constructor(n,s){this.viewContainer=n,this.elementRef=s;let d=le(vl);d._footerRowOutlet=this,d._outletAssigned()}};r.\u0275fac=function(s){return new(s||r)(V(Do),V(Ee))},r.\u0275dir=oe({type:r,selectors:[["","footerRowOutlet",""]],standalone:!0});let a=r;return a})(),XD=(()=>{let r=class r{constructor(n,s){this.viewContainer=n,this.elementRef=s;let d=le(vl);d._noDataRowOutlet=this,d._outletAssigned()}};r.\u0275fac=function(s){return new(s||r)(V(Do),V(Ee))},r.\u0275dir=oe({type:r,selectors:[["","noDataRowOutlet",""]],standalone:!0});let a=r;return a})();var KD=(()=>{let r=class r{_getCellRole(){if(this._cellRoleInternal===void 0){let n=this._elementRef.nativeElement.getAttribute("role"),s=n==="grid"||n==="treegrid"?"gridcell":"cell";this._cellRoleInternal=this._isNativeHtmlTable&&s==="cell"?null:s}return this._cellRoleInternal}get trackBy(){return this._trackByFn}set trackBy(n){this._trackByFn=n}get dataSource(){return this._dataSource}set dataSource(n){this._dataSource!==n&&this._switchDataSource(n)}get multiTemplateDataRows(){return this._multiTemplateDataRows}set multiTemplateDataRows(n){this._multiTemplateDataRows=n,this._rowOutlet&&this._rowOutlet.viewContainer.length&&(this._forceRenderDataRows(),this.updateStickyColumnStyles())}get fixedLayout(){return this._fixedLayout}set fixedLayout(n){this._fixedLayout=n,this._forceRecalculateCellWidths=!0,this._stickyColumnStylesNeedReset=!0}constructor(n,s,d,m,_,w,S,I,L,H,q,X){this._differs=n,this._changeDetectorRef=s,this._elementRef=d,this._dir=_,this._platform=S,this._viewRepeater=I,this._coalescedStyleScheduler=L,this._viewportRuler=H,this._stickyPositioningListener=q,this._ngZone=X,this._onDestroy=new pe,this._columnDefsByName=new Map,this._customColumnDefs=new Set,this._customRowDefs=new Set,this._customHeaderRowDefs=new Set,this._customFooterRowDefs=new Set,this._headerRowDefChanged=!0,this._footerRowDefChanged=!0,this._stickyColumnStylesNeedReset=!0,this._forceRecalculateCellWidths=!0,this._cachedRenderRowsMap=new Map,this.stickyCssClass="cdk-table-sticky",this.needsPositionStickyOnElement=!0,this._isShowingNoDataRow=!1,this._hasAllOutlets=!1,this._hasInitialized=!1,this._cellRoleInternal=void 0,this._multiTemplateDataRows=!1,this._fixedLayout=!1,this.contentChanged=new ye,this.viewChange=new We({start:0,end:Number.MAX_VALUE}),m||d.nativeElement.setAttribute("role","table"),this._document=w,this._isServer=!S.isBrowser,this._isNativeHtmlTable=d.nativeElement.nodeName==="TABLE"}ngOnInit(){this._setupStickyStyler(),this._dataDiffer=this._differs.find([]).create((n,s)=>this.trackBy?this.trackBy(s.dataIndex,s.data):s),this._viewportRuler.change().pipe(ni(this._onDestroy)).subscribe(()=>{this._forceRecalculateCellWidths=!0})}ngAfterContentInit(){this._hasInitialized=!0}ngAfterContentChecked(){this._canRender()&&this._render()}ngOnDestroy(){[this._rowOutlet?.viewContainer,this._headerRowOutlet?.viewContainer,this._footerRowOutlet?.viewContainer,this._cachedRenderRowsMap,this._customColumnDefs,this._customRowDefs,this._customHeaderRowDefs,this._customFooterRowDefs,this._columnDefsByName].forEach(n=>{n?.clear()}),this._headerRowDefs=[],this._footerRowDefs=[],this._defaultRowDef=null,this._onDestroy.next(),this._onDestroy.complete(),gy(this.dataSource)&&this.dataSource.disconnect(this)}renderRows(){this._renderRows=this._getAllRenderRows();let n=this._dataDiffer.diff(this._renderRows);if(!n){this._updateNoDataRow(),this.contentChanged.next();return}let s=this._rowOutlet.viewContainer;this._viewRepeater.applyChanges(n,s,(d,m,_)=>this._getEmbeddedViewArgs(d.item,_),d=>d.item.data,d=>{d.operation===ym.INSERTED&&d.context&&this._renderCellTemplateForItem(d.record.item.rowDef,d.context)}),this._updateRowIndexContext(),n.forEachIdentityChange(d=>{let m=s.get(d.currentIndex);m.context.$implicit=d.item.data}),this._updateNoDataRow(),this._ngZone&&Be.isInAngularZone()?this._ngZone.onStable.pipe(tn(1),ni(this._onDestroy)).subscribe(()=>{this.updateStickyColumnStyles()}):this.updateStickyColumnStyles(),this.contentChanged.next()}addColumnDef(n){this._customColumnDefs.add(n)}removeColumnDef(n){this._customColumnDefs.delete(n)}addRowDef(n){this._customRowDefs.add(n)}removeRowDef(n){this._customRowDefs.delete(n)}addHeaderRowDef(n){this._customHeaderRowDefs.add(n),this._headerRowDefChanged=!0}removeHeaderRowDef(n){this._customHeaderRowDefs.delete(n),this._headerRowDefChanged=!0}addFooterRowDef(n){this._customFooterRowDefs.add(n),this._footerRowDefChanged=!0}removeFooterRowDef(n){this._customFooterRowDefs.delete(n),this._footerRowDefChanged=!0}setNoDataRow(n){this._customNoDataRow=n}updateStickyHeaderRowStyles(){let n=this._getRenderedRows(this._headerRowOutlet);if(this._isNativeHtmlTable){let d=e5(this._headerRowOutlet,"thead");d&&(d.style.display=n.length?"":"none")}let s=this._headerRowDefs.map(d=>d.sticky);this._stickyStyler.clearStickyPositioning(n,["top"]),this._stickyStyler.stickRows(n,s,"top"),this._headerRowDefs.forEach(d=>d.resetStickyChanged())}updateStickyFooterRowStyles(){let n=this._getRenderedRows(this._footerRowOutlet);if(this._isNativeHtmlTable){let d=e5(this._footerRowOutlet,"tfoot");d&&(d.style.display=n.length?"":"none")}let s=this._footerRowDefs.map(d=>d.sticky);this._stickyStyler.clearStickyPositioning(n,["bottom"]),this._stickyStyler.stickRows(n,s,"bottom"),this._stickyStyler.updateStickyFooterContainer(this._elementRef.nativeElement,s),this._footerRowDefs.forEach(d=>d.resetStickyChanged())}updateStickyColumnStyles(){let n=this._getRenderedRows(this._headerRowOutlet),s=this._getRenderedRows(this._rowOutlet),d=this._getRenderedRows(this._footerRowOutlet);(this._isNativeHtmlTable&&!this._fixedLayout||this._stickyColumnStylesNeedReset)&&(this._stickyStyler.clearStickyPositioning([...n,...s,...d],["left","right"]),this._stickyColumnStylesNeedReset=!1),n.forEach((m,_)=>{this._addStickyColumnStyles([m],this._headerRowDefs[_])}),this._rowDefs.forEach(m=>{let _=[];for(let w=0;w<s.length;w++)this._renderRows[w].rowDef===m&&_.push(s[w]);this._addStickyColumnStyles(_,m)}),d.forEach((m,_)=>{this._addStickyColumnStyles([m],this._footerRowDefs[_])}),Array.from(this._columnDefsByName.values()).forEach(m=>m.resetStickyChanged())}_outletAssigned(){!this._hasAllOutlets&&this._rowOutlet&&this._headerRowOutlet&&this._footerRowOutlet&&this._noDataRowOutlet&&(this._hasAllOutlets=!0,this._canRender()&&this._render())}_canRender(){return this._hasAllOutlets&&this._hasInitialized}_render(){this._cacheRowDefs(),this._cacheColumnDefs(),!this._headerRowDefs.length&&!this._footerRowDefs.length&&this._rowDefs.length;let s=this._renderUpdatedColumns()||this._headerRowDefChanged||this._footerRowDefChanged;this._stickyColumnStylesNeedReset=this._stickyColumnStylesNeedReset||s,this._forceRecalculateCellWidths=s,this._headerRowDefChanged&&(this._forceRenderHeaderRows(),this._headerRowDefChanged=!1),this._footerRowDefChanged&&(this._forceRenderFooterRows(),this._footerRowDefChanged=!1),this.dataSource&&this._rowDefs.length>0&&!this._renderChangeSubscription?this._observeRenderChanges():this._stickyColumnStylesNeedReset&&this.updateStickyColumnStyles(),this._checkStickyStates()}_getAllRenderRows(){let n=[],s=this._cachedRenderRowsMap;this._cachedRenderRowsMap=new Map;for(let d=0;d<this._data.length;d++){let m=this._data[d],_=this._getRenderRowsForData(m,d,s.get(m));this._cachedRenderRowsMap.has(m)||this._cachedRenderRowsMap.set(m,new WeakMap);for(let w=0;w<_.length;w++){let S=_[w],I=this._cachedRenderRowsMap.get(S.data);I.has(S.rowDef)?I.get(S.rowDef).push(S):I.set(S.rowDef,[S]),n.push(S)}}return n}_getRenderRowsForData(n,s,d){return this._getRowDefs(n,s).map(_=>{let w=d&&d.has(_)?d.get(_):[];if(w.length){let S=w.shift();return S.dataIndex=s,S}else return{data:n,rowDef:_,dataIndex:s}})}_cacheColumnDefs(){this._columnDefsByName.clear(),Ib(this._getOwnDefs(this._contentColumnDefs),this._customColumnDefs).forEach(s=>{this._columnDefsByName.has(s.name),this._columnDefsByName.set(s.name,s)})}_cacheRowDefs(){this._headerRowDefs=Ib(this._getOwnDefs(this._contentHeaderRowDefs),this._customHeaderRowDefs),this._footerRowDefs=Ib(this._getOwnDefs(this._contentFooterRowDefs),this._customFooterRowDefs),this._rowDefs=Ib(this._getOwnDefs(this._contentRowDefs),this._customRowDefs);let n=this._rowDefs.filter(s=>!s.when);!this.multiTemplateDataRows&&n.length>1,this._defaultRowDef=n[0]}_renderUpdatedColumns(){let n=(_,w)=>_||!!w.getColumnsDiff(),s=this._rowDefs.reduce(n,!1);s&&this._forceRenderDataRows();let d=this._headerRowDefs.reduce(n,!1);d&&this._forceRenderHeaderRows();let m=this._footerRowDefs.reduce(n,!1);return m&&this._forceRenderFooterRows(),s||d||m}_switchDataSource(n){this._data=[],gy(this.dataSource)&&this.dataSource.disconnect(this),this._renderChangeSubscription&&(this._renderChangeSubscription.unsubscribe(),this._renderChangeSubscription=null),n||(this._dataDiffer&&this._dataDiffer.diff([]),this._rowOutlet&&this._rowOutlet.viewContainer.clear()),this._dataSource=n}_observeRenderChanges(){if(!this.dataSource)return;let n;gy(this.dataSource)?n=this.dataSource.connect(this):Hh(this.dataSource)?n=this.dataSource:Array.isArray(this.dataSource)&&(n=Fe(this.dataSource)),this._renderChangeSubscription=n.pipe(ni(this._onDestroy)).subscribe(s=>{this._data=s||[],this.renderRows()})}_forceRenderHeaderRows(){this._headerRowOutlet.viewContainer.length>0&&this._headerRowOutlet.viewContainer.clear(),this._headerRowDefs.forEach((n,s)=>this._renderRow(this._headerRowOutlet,n,s)),this.updateStickyHeaderRowStyles()}_forceRenderFooterRows(){this._footerRowOutlet.viewContainer.length>0&&this._footerRowOutlet.viewContainer.clear(),this._footerRowDefs.forEach((n,s)=>this._renderRow(this._footerRowOutlet,n,s)),this.updateStickyFooterRowStyles()}_addStickyColumnStyles(n,s){let d=Array.from(s.columns||[]).map(w=>{let S=this._columnDefsByName.get(w);return S}),m=d.map(w=>w.sticky),_=d.map(w=>w.stickyEnd);this._stickyStyler.updateStickyColumns(n,m,_,!this._fixedLayout||this._forceRecalculateCellWidths)}_getRenderedRows(n){let s=[];for(let d=0;d<n.viewContainer.length;d++){let m=n.viewContainer.get(d);s.push(m.rootNodes[0])}return s}_getRowDefs(n,s){if(this._rowDefs.length==1)return[this._rowDefs[0]];let d=[];if(this.multiTemplateDataRows)d=this._rowDefs.filter(m=>!m.when||m.when(s,n));else{let m=this._rowDefs.find(_=>_.when&&_.when(s,n))||this._defaultRowDef;m&&d.push(m)}return d.length,d}_getEmbeddedViewArgs(n,s){let d=n.rowDef,m={$implicit:n.data};return{templateRef:d.template,context:m,index:s}}_renderRow(n,s,d,m={}){let _=n.viewContainer.createEmbeddedView(s.template,m,d);return this._renderCellTemplateForItem(s,m),_}_renderCellTemplateForItem(n,s){for(let d of this._getCellTemplates(n))Gu.mostRecentCellOutlet&&Gu.mostRecentCellOutlet._viewContainer.createEmbeddedView(d,s);this._changeDetectorRef.markForCheck()}_updateRowIndexContext(){let n=this._rowOutlet.viewContainer;for(let s=0,d=n.length;s<d;s++){let _=n.get(s).context;_.count=d,_.first=s===0,_.last=s===d-1,_.even=s%2===0,_.odd=!_.even,this.multiTemplateDataRows?(_.dataIndex=this._renderRows[s].dataIndex,_.renderIndex=s):_.index=this._renderRows[s].dataIndex}}_getCellTemplates(n){return!n||!n.columns?[]:Array.from(n.columns,s=>{let d=this._columnDefsByName.get(s);return n.extractCellTemplate(d)})}_forceRenderDataRows(){this._dataDiffer.diff([]),this._rowOutlet.viewContainer.clear(),this.renderRows()}_checkStickyStates(){let n=(s,d)=>s||d.hasStickyChanged();this._headerRowDefs.reduce(n,!1)&&this.updateStickyHeaderRowStyles(),this._footerRowDefs.reduce(n,!1)&&this.updateStickyFooterRowStyles(),Array.from(this._columnDefsByName.values()).reduce(n,!1)&&(this._stickyColumnStylesNeedReset=!0,this.updateStickyColumnStyles())}_setupStickyStyler(){let n=this._dir?this._dir.value:"ltr";this._stickyStyler=new VD(this._isNativeHtmlTable,this.stickyCssClass,n,this._coalescedStyleScheduler,this._platform.isBrowser,this.needsPositionStickyOnElement,this._stickyPositioningListener),(this._dir?this._dir.change:Fe()).pipe(ni(this._onDestroy)).subscribe(s=>{this._stickyStyler.direction=s,this.updateStickyColumnStyles()})}_getOwnDefs(n){return n.filter(s=>!s._table||s._table===this)}_updateNoDataRow(){let n=this._customNoDataRow||this._noDataRow;if(!n)return;let s=this._rowOutlet.viewContainer.length===0;if(s===this._isShowingNoDataRow)return;let d=this._noDataRowOutlet.viewContainer;if(s){let m=d.createEmbeddedView(n.templateRef),_=m.rootNodes[0];m.rootNodes.length===1&&_?.nodeType===this._document.ELEMENT_NODE&&(_.setAttribute("role","row"),_.classList.add(n._contentClassName))}else d.clear();this._isShowingNoDataRow=s,this._changeDetectorRef.markForCheck()}};r.\u0275fac=function(s){return new(s||r)(V(wu),V(Zi),V(Ee),ol("role"),V(Ao,8),V(ci),V(gn),V(ig),V(Rb),V(wd),V(Pb,12),V(Be,8))},r.\u0275cmp=St({type:r,selectors:[["cdk-table"],["table","cdk-table",""]],contentQueries:function(s,d,m){if(s&1&&(fn(m,o5,5),fn(m,Ym,5),fn(m,Lb,5),fn(m,Hg,5),fn(m,GD,5)),s&2){let _;se(_=ae())&&(d._noDataRow=_.first),se(_=ae())&&(d._contentColumnDefs=_),se(_=ae())&&(d._contentRowDefs=_),se(_=ae())&&(d._contentHeaderRowDefs=_),se(_=ae())&&(d._contentFooterRowDefs=_)}},hostAttrs:[1,"cdk-table"],hostVars:2,hostBindings:function(s,d){s&2&&li("cdk-table-fixed-layout",d.fixedLayout)},inputs:{trackBy:"trackBy",dataSource:"dataSource",multiTemplateDataRows:[Rt.HasDecoratorInputTransform,"multiTemplateDataRows","multiTemplateDataRows",Qe],fixedLayout:[Rt.HasDecoratorInputTransform,"fixedLayout","fixedLayout",Qe]},outputs:{contentChanged:"contentChanged"},exportAs:["cdkTable"],standalone:!0,features:[ji([{provide:vl,useExisting:r},{provide:ig,useClass:bm},{provide:Rb,useClass:UD},{provide:Pb,useValue:null}]),Fn,At],ngContentSelectors:irt,decls:5,vars:2,consts:[["role","rowgroup"],["headerRowOutlet",""],["rowOutlet",""],["noDataRowOutlet",""],["footerRowOutlet",""]],template:function(s,d){s&1&&(Un(ert),Ai(0),Ai(1,1),ut(2,Qnt,1,0)(3,Jnt,7,0)(4,trt,4,0)),s&2&&(z(2),Xi(2,d._isServer?2:-1),z(),Xi(3,d._isNativeHtmlTable?3:4))},dependencies:[YD,$D,XD,ZD],styles:[".cdk-table-fixed-layout{table-layout:fixed}"],encapsulation:2});let a=r;return a})();function Ib(a,r){return a.concat(Array.from(r))}function e5(a,r){let l=r.toUpperCase(),n=a.viewContainer.element.nativeElement;for(;n;){let s=n.nodeType===1?n.nodeName:null;if(s===l)return n;if(s==="TABLE")break;n=n.parentNode}return null}function srt(a,r){a&1&&Ai(0,2)}function art(a,r){a&1&&(T(0,"thead",0),Ps(1,1),k(),T(2,"tbody",2),Ps(3,3)(4,4),k(),T(5,"tfoot",0),Ps(6,5),k())}function lrt(a,r){a&1&&Ps(0,1)(1,3)(2,4)(3,5)}var crt=[[["caption"]],[["colgroup"],["col"]],"*"],drt=["caption","colgroup, col","*"];var ka=(()=>{let r=class r extends KD{constructor(){super(...arguments),this.stickyCssClass="mat-mdc-table-sticky",this.needsPositionStickyOnElement=!1}};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=Nr(r)))(d||r)}})(),r.\u0275cmp=St({type:r,selectors:[["mat-table"],["table","mat-table",""]],hostAttrs:[1,"mat-mdc-table","mdc-data-table__table"],hostVars:2,hostBindings:function(s,d){s&2&&li("mdc-table-fixed-layout",d.fixedLayout)},exportAs:["matTable"],standalone:!0,features:[ji([{provide:KD,useExisting:r},{provide:vl,useExisting:r},{provide:Rb,useClass:UD},{provide:ig,useClass:bm},{provide:Pb,useValue:null}]),Di,At],ngContentSelectors:drt,decls:5,vars:2,consts:[["role","rowgroup"],["headerRowOutlet",""],["role","rowgroup",1,"mdc-data-table__content"],["rowOutlet",""],["noDataRowOutlet",""],["footerRowOutlet",""]],template:function(s,d){s&1&&(Un(crt),Ai(0),Ai(1,1),ut(2,srt,1,0)(3,art,7,0)(4,lrt,4,0)),s&2&&(z(2),Xi(2,d._isServer?2:-1),z(),Xi(3,d._isNativeHtmlTable?3:4))},dependencies:[YD,$D,XD,ZD],styles:[".mat-mdc-table-sticky{position:sticky !important}.mdc-data-table{-webkit-overflow-scrolling:touch;display:inline-flex;flex-direction:column;box-sizing:border-box;position:relative}.mdc-data-table__table-container{-webkit-overflow-scrolling:touch;overflow-x:auto;width:100%}.mdc-data-table__table{min-width:100%;border:0;white-space:nowrap;border-spacing:0;table-layout:fixed}.mdc-data-table__cell{box-sizing:border-box;overflow:hidden;text-align:left;text-overflow:ellipsis}[dir=rtl] .mdc-data-table__cell,.mdc-data-table__cell[dir=rtl]{text-align:right}.mdc-data-table__cell--numeric{text-align:right}[dir=rtl] .mdc-data-table__cell--numeric,.mdc-data-table__cell--numeric[dir=rtl]{text-align:left}.mdc-data-table__header-cell{box-sizing:border-box;text-overflow:ellipsis;overflow:hidden;outline:none;text-align:left}[dir=rtl] .mdc-data-table__header-cell,.mdc-data-table__header-cell[dir=rtl]{text-align:right}.mdc-data-table__header-cell--numeric{text-align:right}[dir=rtl] .mdc-data-table__header-cell--numeric,.mdc-data-table__header-cell--numeric[dir=rtl]{text-align:left}.mdc-data-table__header-cell-wrapper{align-items:center;display:inline-flex;vertical-align:middle}.mdc-data-table__cell,.mdc-data-table__header-cell{padding:0 16px 0 16px}.mdc-data-table__header-cell--checkbox,.mdc-data-table__cell--checkbox{padding-left:4px;padding-right:0}[dir=rtl] .mdc-data-table__header-cell--checkbox,[dir=rtl] .mdc-data-table__cell--checkbox,.mdc-data-table__header-cell--checkbox[dir=rtl],.mdc-data-table__cell--checkbox[dir=rtl]{padding-left:0;padding-right:4px}mat-table{display:block}mat-header-row{min-height:56px}mat-row,mat-footer-row{min-height:48px}mat-row,mat-header-row,mat-footer-row{display:flex;border-width:0;border-bottom-width:1px;border-style:solid;align-items:center;box-sizing:border-box}mat-cell:first-of-type,mat-header-cell:first-of-type,mat-footer-cell:first-of-type{padding-left:24px}[dir=rtl] mat-cell:first-of-type:not(:only-of-type),[dir=rtl] mat-header-cell:first-of-type:not(:only-of-type),[dir=rtl] mat-footer-cell:first-of-type:not(:only-of-type){padding-left:0;padding-right:24px}mat-cell:last-of-type,mat-header-cell:last-of-type,mat-footer-cell:last-of-type{padding-right:24px}[dir=rtl] mat-cell:last-of-type:not(:only-of-type),[dir=rtl] mat-header-cell:last-of-type:not(:only-of-type),[dir=rtl] mat-footer-cell:last-of-type:not(:only-of-type){padding-right:0;padding-left:24px}mat-cell,mat-header-cell,mat-footer-cell{flex:1;display:flex;align-items:center;overflow:hidden;word-wrap:break-word;min-height:inherit}.mat-mdc-table{table-layout:auto;white-space:normal;background-color:var(--mat-table-background-color)}.mat-mdc-header-row{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;height:var(--mat-table-header-container-height, 56px);color:var(--mat-table-header-headline-color, rgba(0, 0, 0, 0.87));font-family:var(--mat-table-header-headline-font, Roboto, sans-serif);line-height:var(--mat-table-header-headline-line-height);font-size:var(--mat-table-header-headline-size, 14px);font-weight:var(--mat-table-header-headline-weight, 500)}.mat-mdc-row{height:var(--mat-table-row-item-container-height, 52px);color:var(--mat-table-row-item-label-text-color, rgba(0, 0, 0, 0.87))}.mat-mdc-row,.mdc-data-table__content{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-table-row-item-label-text-font, Roboto, sans-serif);line-height:var(--mat-table-row-item-label-text-line-height);font-size:var(--mat-table-row-item-label-text-size, 14px);font-weight:var(--mat-table-row-item-label-text-weight)}.mat-mdc-footer-row{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;height:var(--mat-table-footer-container-height, 52px);color:var(--mat-table-row-item-label-text-color, rgba(0, 0, 0, 0.87));font-family:var(--mat-table-footer-supporting-text-font, Roboto, sans-serif);line-height:var(--mat-table-footer-supporting-text-line-height);font-size:var(--mat-table-footer-supporting-text-size, 14px);font-weight:var(--mat-table-footer-supporting-text-weight);letter-spacing:var(--mat-table-footer-supporting-text-tracking)}.mat-mdc-header-cell{border-bottom-color:var(--mat-table-row-item-outline-color, rgba(0, 0, 0, 0.12));border-bottom-width:var(--mat-table-row-item-outline-width, 1px);border-bottom-style:solid;letter-spacing:var(--mat-table-header-headline-tracking);font-weight:inherit;line-height:inherit}.mat-mdc-cell{border-bottom-color:var(--mat-table-row-item-outline-color, rgba(0, 0, 0, 0.12));border-bottom-width:var(--mat-table-row-item-outline-width, 1px);border-bottom-style:solid;letter-spacing:var(--mat-table-row-item-label-text-tracking);line-height:inherit}.mdc-data-table__row:last-child .mat-mdc-cell{border-bottom:none}.mat-mdc-footer-cell{letter-spacing:var(--mat-table-row-item-label-text-tracking)}mat-row.mat-mdc-row,mat-header-row.mat-mdc-header-row,mat-footer-row.mat-mdc-footer-row{border-bottom:none}.mat-mdc-table tbody,.mat-mdc-table tfoot,.mat-mdc-table thead,.mat-mdc-cell,.mat-mdc-footer-cell,.mat-mdc-header-row,.mat-mdc-row,.mat-mdc-footer-row,.mat-mdc-table .mat-mdc-header-cell{background:inherit}.mat-mdc-table mat-header-row.mat-mdc-header-row,.mat-mdc-table mat-row.mat-mdc-row,.mat-mdc-table mat-footer-row.mat-mdc-footer-cell{height:unset}mat-header-cell.mat-mdc-header-cell,mat-cell.mat-mdc-cell,mat-footer-cell.mat-mdc-footer-cell{align-self:stretch}"],encapsulation:2});let a=r;return a})(),Ra=(()=>{let r=class r extends Ob{};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=Nr(r)))(d||r)}})(),r.\u0275dir=oe({type:r,selectors:[["","matCellDef",""]],standalone:!0,features:[ji([{provide:Ob,useExisting:r}]),Di]});let a=r;return a})(),Pa=(()=>{let r=class r extends Fb{};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=Nr(r)))(d||r)}})(),r.\u0275dir=oe({type:r,selectors:[["","matHeaderCellDef",""]],standalone:!0,features:[ji([{provide:Fb,useExisting:r}]),Di]});let a=r;return a})();var Oa=(()=>{let r=class r extends Ym{get name(){return this._name}set name(n){this._setNameInput(n)}_updateColumnCssClassName(){super._updateColumnCssClassName(),this._columnCssClassName.push(`mat-column-${this.cssClassFriendlyName}`)}};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=Nr(r)))(d||r)}})(),r.\u0275dir=oe({type:r,selectors:[["","matColumnDef",""]],inputs:{sticky:"sticky",name:[Rt.None,"matColumnDef","name"]},standalone:!0,features:[ji([{provide:Ym,useExisting:r},{provide:"MAT_SORT_HEADER_COLUMN_DEF",useExisting:r}]),Di]});let a=r;return a})(),Fa=(()=>{let r=class r extends n5{};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=Nr(r)))(d||r)}})(),r.\u0275dir=oe({type:r,selectors:[["mat-header-cell"],["th","mat-header-cell",""]],hostAttrs:["role","columnheader",1,"mat-mdc-header-cell","mdc-data-table__header-cell"],standalone:!0,features:[Di]});let a=r;return a})();var La=(()=>{let r=class r extends r5{};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=Nr(r)))(d||r)}})(),r.\u0275dir=oe({type:r,selectors:[["mat-cell"],["td","mat-cell",""]],hostAttrs:[1,"mat-mdc-cell","mdc-data-table__cell"],standalone:!0,features:[Di]});let a=r;return a})();var za=(()=>{let r=class r extends Hg{};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=Nr(r)))(d||r)}})(),r.\u0275dir=oe({type:r,selectors:[["","matHeaderRowDef",""]],inputs:{columns:[Rt.None,"matHeaderRowDef","columns"],sticky:[Rt.None,"matHeaderRowDefSticky","sticky"]},standalone:!0,features:[ji([{provide:Hg,useExisting:r}]),Di]});let a=r;return a})();var Na=(()=>{let r=class r extends Lb{};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=Nr(r)))(d||r)}})(),r.\u0275dir=oe({type:r,selectors:[["","matRowDef",""]],inputs:{columns:[Rt.None,"matRowDefColumns","columns"],when:[Rt.None,"matRowDefWhen","when"]},standalone:!0,features:[ji([{provide:Lb,useExisting:r}]),Di]});let a=r;return a})(),Ba=(()=>{let r=class r extends qD{};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=Nr(r)))(d||r)}})(),r.\u0275cmp=St({type:r,selectors:[["mat-header-row"],["tr","mat-header-row",""]],hostAttrs:["role","row",1,"mat-mdc-header-row","mdc-data-table__header-row"],exportAs:["matHeaderRow"],standalone:!0,features:[ji([{provide:qD,useExisting:r}]),Di,At],decls:1,vars:0,consts:[["cdkCellOutlet",""]],template:function(s,d){s&1&&Ps(0,0)},dependencies:[Gu],encapsulation:2});let a=r;return a})();var Va=(()=>{let r=class r extends WD{};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=Nr(r)))(d||r)}})(),r.\u0275cmp=St({type:r,selectors:[["mat-row"],["tr","mat-row",""]],hostAttrs:["role","row",1,"mat-mdc-row","mdc-data-table__row"],exportAs:["matRow"],standalone:!0,features:[ji([{provide:WD,useExisting:r}]),Di,At],decls:1,vars:0,consts:[["cdkCellOutlet",""]],template:function(s,d){s&1&&Ps(0,0)},dependencies:[Gu],encapsulation:2});let a=r;return a})();var urt=9007199254740991,gs=class extends py{get data(){return this._data.value}set data(r){r=Array.isArray(r)?r:[],this._data.next(r),this._renderChangesSubscription||this._filterData(r)}get filter(){return this._filter.value}set filter(r){this._filter.next(r),this._renderChangesSubscription||this._filterData(this.data)}get sort(){return this._sort}set sort(r){this._sort=r,this._updateChangeSubscription()}get paginator(){return this._paginator}set paginator(r){this._paginator=r,this._updateChangeSubscription()}constructor(r=[]){super(),this._renderData=new We([]),this._filter=new We(""),this._internalPageChanges=new pe,this._renderChangesSubscription=null,this.sortingDataAccessor=(l,n)=>{let s=l[n];if(WE(s)){let d=Number(s);return d<urt?d:s}return s},this.sortData=(l,n)=>{let s=n.active,d=n.direction;return!s||d==""?l:l.sort((m,_)=>{let w=this.sortingDataAccessor(m,s),S=this.sortingDataAccessor(_,s),I=typeof w,L=typeof S;I!==L&&(I==="number"&&(w+=""),L==="number"&&(S+=""));let H=0;return w!=null&&S!=null?w>S?H=1:w<S&&(H=-1):w!=null?H=1:S!=null&&(H=-1),H*(d=="asc"?1:-1)})},this.filterPredicate=(l,n)=>{let s=Object.keys(l).reduce((m,_)=>m+l[_]+"\u25EC","").toLowerCase(),d=n.trim().toLowerCase();return s.indexOf(d)!=-1},this._data=new We(r),this._updateChangeSubscription()}_updateChangeSubscription(){let r=this._sort?no(this._sort.sortChange,this._sort.initialized):Fe(null),l=this._paginator?no(this._paginator.page,this._internalPageChanges,this._paginator.initialized):Fe(null),n=this._data,s=xc([n,this._filter]).pipe(Li(([_])=>this._filterData(_))),d=xc([s,r]).pipe(Li(([_])=>this._orderData(_))),m=xc([d,l]).pipe(Li(([_])=>this._pageData(_)));this._renderChangesSubscription?.unsubscribe(),this._renderChangesSubscription=m.subscribe(_=>this._renderData.next(_))}_filterData(r){return this.filteredData=this.filter==null||this.filter===""?r:r.filter(l=>this.filterPredicate(l,this.filter)),this.paginator&&this._updatePaginator(this.filteredData.length),this.filteredData}_orderData(r){return this.sort?this.sortData(r.slice(),this.sort):r}_pageData(r){if(!this.paginator)return r;let l=this.paginator.pageIndex*this.paginator.pageSize;return r.slice(l,l+this.paginator.pageSize)}_updatePaginator(r){Promise.resolve().then(()=>{let l=this.paginator;if(l&&(l.length=r,l.pageIndex>0)){let n=Math.ceil(l.length/l.pageSize)-1||0,s=Math.min(l.pageIndex,n);s!==l.pageIndex&&(l.pageIndex=s,this._internalPageChanges.next())}})}connect(){return this._renderChangesSubscription||this._updateChangeSubscription(),this._renderData}disconnect(){this._renderChangesSubscription?.unsubscribe(),this._renderChangesSubscription=null}};var hrt=["mat-menu-item",""];function mrt(a,r){a&1&&(Rs(),T(0,"svg",3),dt(1,"polygon",4),k())}var prt=[[["mat-icon"],["","matMenuItemIcon",""]],"*"],frt=["mat-icon, [matMenuItemIcon]","*"];function grt(a,r){if(a&1){let l=we();T(0,"div",0),ct("keydown",function(s){Kt(l);let d=gt();return Qt(d._handleKeydown(s))})("click",function(){Kt(l);let s=gt();return Qt(s.closed.emit("click"))})("@transformMenu.start",function(s){Kt(l);let d=gt();return Qt(d._onAnimationStart(s))})("@transformMenu.done",function(s){Kt(l);let d=gt();return Qt(d._onAnimationDone(s))}),T(1,"div",1),Ai(2),k()()}if(a&2){let l=gt();W("id",l.panelId)("ngClass",l._classList)("@transformMenu",l._panelAnimationState),ri("aria-label",l.ariaLabel||null)("aria-labelledby",l.ariaLabelledby||null)("aria-describedby",l.ariaDescribedby||null)}}var _rt=["*"],QD=new Se("MAT_MENU_PANEL"),yl=(()=>{let r=class r{constructor(n,s,d,m,_){this._elementRef=n,this._document=s,this._focusMonitor=d,this._parentMenu=m,this._changeDetectorRef=_,this.role="menuitem",this.disabled=!1,this.disableRipple=!1,this._hovered=new pe,this._focused=new pe,this._highlighted=!1,this._triggersSubmenu=!1,m?.addItem?.(this)}focus(n,s){this._focusMonitor&&n?this._focusMonitor.focusVia(this._getHostElement(),n,s):this._getHostElement().focus(s),this._focused.next(this)}ngAfterViewInit(){this._focusMonitor&&this._focusMonitor.monitor(this._elementRef,!1)}ngOnDestroy(){this._focusMonitor&&this._focusMonitor.stopMonitoring(this._elementRef),this._parentMenu&&this._parentMenu.removeItem&&this._parentMenu.removeItem(this),this._hovered.complete(),this._focused.complete()}_getTabIndex(){return this.disabled?"-1":"0"}_getHostElement(){return this._elementRef.nativeElement}_checkDisabled(n){this.disabled&&(n.preventDefault(),n.stopPropagation())}_handleMouseEnter(){this._hovered.next(this)}getLabel(){let n=this._elementRef.nativeElement.cloneNode(!0),s=n.querySelectorAll("mat-icon, .material-icons");for(let d=0;d<s.length;d++)s[d].remove();return n.textContent?.trim()||""}_setHighlighted(n){this._highlighted=n,this._changeDetectorRef?.markForCheck()}_setTriggersSubmenu(n){this._triggersSubmenu=n,this._changeDetectorRef?.markForCheck()}_hasFocus(){return this._document&&this._document.activeElement===this._getHostElement()}};r.\u0275fac=function(s){return new(s||r)(V(Ee),V(ci),V(Bs),V(QD,8),V(Zi))},r.\u0275cmp=St({type:r,selectors:[["","mat-menu-item",""]],hostAttrs:[1,"mat-mdc-menu-item","mat-mdc-focus-indicator"],hostVars:8,hostBindings:function(s,d){s&1&&ct("click",function(_){return d._checkDisabled(_)})("mouseenter",function(){return d._handleMouseEnter()}),s&2&&(ri("role",d.role)("tabindex",d._getTabIndex())("aria-disabled",d.disabled)("disabled",d.disabled||null),li("mat-mdc-menu-item-highlighted",d._highlighted)("mat-mdc-menu-item-submenu-trigger",d._triggersSubmenu))},inputs:{role:"role",disabled:[Rt.HasDecoratorInputTransform,"disabled","disabled",Qe],disableRipple:[Rt.HasDecoratorInputTransform,"disableRipple","disableRipple",Qe]},exportAs:["matMenuItem"],standalone:!0,features:[Fn,At],attrs:hrt,ngContentSelectors:frt,decls:5,vars:3,consts:[[1,"mat-mdc-menu-item-text"],["matRipple","",1,"mat-mdc-menu-ripple",3,"matRippleDisabled","matRippleTrigger"],["class","mat-mdc-menu-submenu-icon","viewBox","0 0 5 10","focusable","false","aria-hidden","true"],["viewBox","0 0 5 10","focusable","false","aria-hidden","true",1,"mat-mdc-menu-submenu-icon"],["points","0,0 5,5 0,10"]],template:function(s,d){s&1&&(Un(prt),Ai(0),T(1,"span",0),Ai(2,1),k(),dt(3,"div",1),ut(4,mrt,2,0,":svg:svg",2)),s&2&&(z(3),W("matRippleDisabled",d.disableRipple||d.disabled)("matRippleTrigger",d._getHostElement()),z(),Xi(4,d._triggersSubmenu?4:-1))},dependencies:[Oy],encapsulation:2,changeDetection:0});let a=r;return a})();var vrt=new Se("MatMenuContent");var zb={transformMenu:wr("transformMenu",[En("void",hi({opacity:0,transform:"scale(0.8)"})),ln("void => enter",Sn("120ms cubic-bezier(0, 0, 0.2, 1)",hi({opacity:1,transform:"scale(1)"}))),ln("* => void",Sn("100ms 25ms linear",hi({opacity:0})))]),fadeInItems:wr("fadeInItems",[En("showing",hi({opacity:1})),ln("void => *",[hi({opacity:0}),Sn("400ms 100ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])},Ryt=zb.fadeInItems,Pyt=zb.transformMenu,yrt=0,brt=new Se("mat-menu-default-options",{providedIn:"root",factory:xrt});function xrt(){return{overlapTrigger:!1,xPosition:"after",yPosition:"below",backdropClass:"cdk-overlay-transparent-backdrop"}}var ja=(()=>{let r=class r{get xPosition(){return this._xPosition}set xPosition(n){this._xPosition=n,this.setPositionClasses()}get yPosition(){return this._yPosition}set yPosition(n){this._yPosition=n,this.setPositionClasses()}set panelClass(n){let s=this._previousPanelClass;s&&s.length&&s.split(" ").forEach(d=>{this._classList[d]=!1}),this._previousPanelClass=n,n&&n.length&&(n.split(" ").forEach(d=>{this._classList[d]=!0}),this._elementRef.nativeElement.className="")}get classList(){return this.panelClass}set classList(n){this.panelClass=n}constructor(n,s,d,m){this._elementRef=n,this._ngZone=s,this._changeDetectorRef=m,this._elevationPrefix="mat-elevation-z",this._baseElevation=8,this._directDescendantItems=new vf,this._classList={},this._panelAnimationState="void",this._animationDone=new pe,this.closed=new ye,this.close=this.closed,this.panelId=`mat-menu-panel-${yrt++}`,this.overlayPanelClass=d.overlayPanelClass||"",this._xPosition=d.xPosition,this._yPosition=d.yPosition,this.backdropClass=d.backdropClass,this.overlapTrigger=d.overlapTrigger,this.hasBackdrop=d.hasBackdrop}ngOnInit(){this.setPositionClasses()}ngAfterContentInit(){this._updateDirectDescendants(),this._keyManager=new Dy(this._directDescendantItems).withWrap().withTypeAhead().withHomeAndEnd(),this._keyManager.tabOut.subscribe(()=>this.closed.emit("tab")),this._directDescendantItems.changes.pipe(ho(this._directDescendantItems),ro(n=>no(...n.map(s=>s._focused)))).subscribe(n=>this._keyManager.updateActiveItem(n)),this._directDescendantItems.changes.subscribe(n=>{let s=this._keyManager;if(this._panelAnimationState==="enter"&&s.activeItem?._hasFocus()){let d=n.toArray(),m=Math.max(0,Math.min(d.length-1,s.activeItemIndex||0));d[m]&&!d[m].disabled?s.setActiveItem(m):s.setNextItemActive()}})}ngOnDestroy(){this._keyManager?.destroy(),this._directDescendantItems.destroy(),this.closed.complete(),this._firstItemFocusSubscription?.unsubscribe()}_hovered(){return this._directDescendantItems.changes.pipe(ho(this._directDescendantItems),ro(s=>no(...s.map(d=>d._hovered))))}addItem(n){}removeItem(n){}_handleKeydown(n){let s=n.keyCode,d=this._keyManager;switch(s){case 27:Zr(n)||(n.preventDefault(),this.closed.emit("keydown"));break;case 37:this.parentMenu&&this.direction==="ltr"&&this.closed.emit("keydown");break;case 39:this.parentMenu&&this.direction==="rtl"&&this.closed.emit("keydown");break;default:(s===38||s===40)&&d.setFocusOrigin("keyboard"),d.onKeydown(n);return}n.stopPropagation()}focusFirstItem(n="program"){this._firstItemFocusSubscription?.unsubscribe(),this._firstItemFocusSubscription=this._ngZone.onStable.pipe(tn(1)).subscribe(()=>{let s=null;if(this._directDescendantItems.length&&(s=this._directDescendantItems.first._getHostElement().closest('[role="menu"]')),!s||!s.contains(document.activeElement)){let d=this._keyManager;d.setFocusOrigin(n).setFirstItemActive(),!d.activeItem&&s&&s.focus()}})}resetActiveItem(){this._keyManager.setActiveItem(-1)}setElevation(n){let s=Math.min(this._baseElevation+n,24),d=`${this._elevationPrefix}${s}`,m=Object.keys(this._classList).find(_=>_.startsWith(this._elevationPrefix));(!m||m===this._previousElevation)&&(this._previousElevation&&(this._classList[this._previousElevation]=!1),this._classList[d]=!0,this._previousElevation=d)}setPositionClasses(n=this.xPosition,s=this.yPosition){let d=this._classList;d["mat-menu-before"]=n==="before",d["mat-menu-after"]=n==="after",d["mat-menu-above"]=s==="above",d["mat-menu-below"]=s==="below",this._changeDetectorRef?.markForCheck()}_startAnimation(){this._panelAnimationState="enter"}_resetAnimation(){this._panelAnimationState="void"}_onAnimationDone(n){this._animationDone.next(n),this._isAnimating=!1}_onAnimationStart(n){this._isAnimating=!0,n.toState==="enter"&&this._keyManager.activeItemIndex===0&&(n.element.scrollTop=0)}_updateDirectDescendants(){this._allItems.changes.pipe(ho(this._allItems)).subscribe(n=>{this._directDescendantItems.reset(n.filter(s=>s._parentMenu===this)),this._directDescendantItems.notifyOnChanges()})}};r.\u0275fac=function(s){return new(s||r)(V(Ee),V(Be),V(brt),V(Zi))},r.\u0275cmp=St({type:r,selectors:[["mat-menu"]],contentQueries:function(s,d,m){if(s&1&&(fn(m,vrt,5),fn(m,yl,5),fn(m,yl,4)),s&2){let _;se(_=ae())&&(d.lazyContent=_.first),se(_=ae())&&(d._allItems=_),se(_=ae())&&(d.items=_)}},viewQuery:function(s,d){if(s&1&&ze(Mo,5),s&2){let m;se(m=ae())&&(d.templateRef=m.first)}},hostVars:3,hostBindings:function(s,d){s&2&&ri("aria-label",null)("aria-labelledby",null)("aria-describedby",null)},inputs:{backdropClass:"backdropClass",ariaLabel:[Rt.None,"aria-label","ariaLabel"],ariaLabelledby:[Rt.None,"aria-labelledby","ariaLabelledby"],ariaDescribedby:[Rt.None,"aria-describedby","ariaDescribedby"],xPosition:"xPosition",yPosition:"yPosition",overlapTrigger:[Rt.HasDecoratorInputTransform,"overlapTrigger","overlapTrigger",Qe],hasBackdrop:[Rt.HasDecoratorInputTransform,"hasBackdrop","hasBackdrop",n=>n==null?null:Qe(n)],panelClass:[Rt.None,"class","panelClass"],classList:"classList"},outputs:{closed:"closed",close:"close"},exportAs:["matMenu"],standalone:!0,features:[ji([{provide:QD,useExisting:r}]),Fn,At],ngContentSelectors:_rt,decls:1,vars:0,consts:[["tabindex","-1","role","menu",1,"mat-mdc-menu-panel","mat-mdc-elevation-specific",3,"id","ngClass","keydown","click"],[1,"mat-mdc-menu-content"]],template:function(s,d){s&1&&(Un(),ut(0,grt,3,6,"ng-template"))},dependencies:[Uo],styles:['mat-menu{display:none}.mat-mdc-menu-content{margin:0;padding:8px 0;list-style-type:none}.mat-mdc-menu-content:focus{outline:none}.mat-mdc-menu-content,.mat-mdc-menu-content .mat-mdc-menu-item .mat-mdc-menu-item-text{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;flex:1;white-space:normal;font-family:var(--mat-menu-item-label-text-font);line-height:var(--mat-menu-item-label-text-line-height);font-size:var(--mat-menu-item-label-text-size);letter-spacing:var(--mat-menu-item-label-text-tracking);font-weight:var(--mat-menu-item-label-text-weight)}.mat-mdc-menu-panel{min-width:112px;max-width:280px;overflow:auto;-webkit-overflow-scrolling:touch;box-sizing:border-box;outline:0;border-radius:var(--mat-menu-container-shape);background-color:var(--mat-menu-container-color);will-change:transform,opacity}.mat-mdc-menu-panel.ng-animating{pointer-events:none}.cdk-high-contrast-active .mat-mdc-menu-panel{outline:solid 1px}.mat-divider{color:var(--mat-menu-divider-color);margin-bottom:var(--mat-menu-divider-bottom-spacing);margin-top:var(--mat-menu-divider-top-spacing)}.mat-mdc-menu-item{display:flex;position:relative;align-items:center;justify-content:flex-start;overflow:hidden;padding:0;padding-left:var(--mat-menu-item-leading-spacing);padding-right:var(--mat-menu-item-trailing-spacing);-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0);cursor:pointer;width:100%;text-align:left;box-sizing:border-box;color:inherit;font-size:inherit;background:none;text-decoration:none;margin:0;align-items:center;min-height:48px}.mat-mdc-menu-item:focus{outline:none}[dir=rtl] .mat-mdc-menu-item,.mat-mdc-menu-item[dir=rtl]{padding-left:var(--mat-menu-item-trailing-spacing);padding-right:var(--mat-menu-item-leading-spacing)}.mat-mdc-menu-item:has(.material-icons,mat-icon,[matButtonIcon]){padding-left:var(--mat-menu-item-with-icon-leading-spacing);padding-right:var(--mat-menu-item-with-icon-trailing-spacing)}[dir=rtl] .mat-mdc-menu-item:has(.material-icons,mat-icon,[matButtonIcon]),.mat-mdc-menu-item:has(.material-icons,mat-icon,[matButtonIcon])[dir=rtl]{padding-left:var(--mat-menu-item-with-icon-trailing-spacing);padding-right:var(--mat-menu-item-with-icon-leading-spacing)}.mat-mdc-menu-item::-moz-focus-inner{border:0}.mat-mdc-menu-item,.mat-mdc-menu-item:visited,.mat-mdc-menu-item:link{color:var(--mat-menu-item-label-text-color)}.mat-mdc-menu-item .mat-icon-no-color,.mat-mdc-menu-item .mat-mdc-menu-submenu-icon{color:var(--mat-menu-item-icon-color)}.mat-mdc-menu-item[disabled]{cursor:default;opacity:.38}.mat-mdc-menu-item[disabled]::after{display:block;position:absolute;content:"";top:0;left:0;bottom:0;right:0}.mat-mdc-menu-item .mat-icon{flex-shrink:0;margin-right:var(--mat-menu-item-spacing);height:var(--mat-menu-item-icon-size);width:var(--mat-menu-item-icon-size)}[dir=rtl] .mat-mdc-menu-item{text-align:right}[dir=rtl] .mat-mdc-menu-item .mat-icon{margin-right:0;margin-left:var(--mat-menu-item-spacing)}.mat-mdc-menu-item:not([disabled]):hover{background-color:var(--mat-menu-item-hover-state-layer-color)}.mat-mdc-menu-item:not([disabled]).cdk-program-focused,.mat-mdc-menu-item:not([disabled]).cdk-keyboard-focused,.mat-mdc-menu-item:not([disabled]).mat-mdc-menu-item-highlighted{background-color:var(--mat-menu-item-focus-state-layer-color)}.cdk-high-contrast-active .mat-mdc-menu-item{margin-top:1px}.mat-mdc-menu-submenu-icon{width:var(--mat-menu-item-icon-size);height:10px;fill:currentColor;padding-left:var(--mat-menu-item-spacing)}[dir=rtl] .mat-mdc-menu-submenu-icon{right:auto;padding-right:var(--mat-menu-item-spacing);padding-left:0}.cdk-high-contrast-active .mat-mdc-menu-submenu-icon{fill:CanvasText}.mat-mdc-menu-item .mat-mdc-menu-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}'],encapsulation:2,data:{animation:[zb.transformMenu,zb.fadeInItems]},changeDetection:0});let a=r;return a})(),wrt=new Se("mat-menu-scroll-strategy",{providedIn:"root",factory:()=>{let a=le(Zn);return()=>a.scrollStrategies.reposition()}});var s5=is({passive:!0});var Ld=(()=>{let r=class r{get _deprecatedMatMenuTriggerFor(){return this.menu}set _deprecatedMatMenuTriggerFor(n){this.menu=n}get menu(){return this._menu}set menu(n){n!==this._menu&&(this._menu=n,this._menuCloseSubscription.unsubscribe(),n&&(this._parentMaterialMenu,this._menuCloseSubscription=n.close.subscribe(s=>{this._destroyMenu(s),(s==="click"||s==="tab")&&this._parentMaterialMenu&&this._parentMaterialMenu.closed.emit(s)})),this._menuItemInstance?._setTriggersSubmenu(this.triggersSubmenu()))}constructor(n,s,d,m,_,w,S,I,L){this._overlay=n,this._element=s,this._viewContainerRef=d,this._menuItemInstance=w,this._dir=S,this._focusMonitor=I,this._ngZone=L,this._overlayRef=null,this._menuOpen=!1,this._closingActionsSubscription=sr.EMPTY,this._hoverSubscription=sr.EMPTY,this._menuCloseSubscription=sr.EMPTY,this._changeDetectorRef=le(Zi),this._handleTouchStart=H=>{mg(H)||(this._openedBy="touch")},this._openedBy=void 0,this.restoreFocus=!0,this.menuOpened=new ye,this.onMenuOpen=this.menuOpened,this.menuClosed=new ye,this.onMenuClose=this.menuClosed,this._scrollStrategy=m,this._parentMaterialMenu=_ instanceof ja?_:void 0,s.nativeElement.addEventListener("touchstart",this._handleTouchStart,s5)}ngAfterContentInit(){this._handleHover()}ngOnDestroy(){this._overlayRef&&(this._overlayRef.dispose(),this._overlayRef=null),this._element.nativeElement.removeEventListener("touchstart",this._handleTouchStart,s5),this._menuCloseSubscription.unsubscribe(),this._closingActionsSubscription.unsubscribe(),this._hoverSubscription.unsubscribe()}get menuOpen(){return this._menuOpen}get dir(){return this._dir&&this._dir.value==="rtl"?"rtl":"ltr"}triggersSubmenu(){return!!(this._menuItemInstance&&this._parentMaterialMenu&&this.menu)}toggleMenu(){return this._menuOpen?this.closeMenu():this.openMenu()}openMenu(){let n=this.menu;if(this._menuOpen||!n)return;let s=this._createOverlay(n),d=s.getConfig(),m=d.positionStrategy;this._setPosition(n,m),d.hasBackdrop=n.hasBackdrop==null?!this.triggersSubmenu():n.hasBackdrop,s.attach(this._getPortal(n)),n.lazyContent&&n.lazyContent.attach(this.menuData),this._closingActionsSubscription=this._menuClosingActions().subscribe(()=>this.closeMenu()),this._initMenu(n),n instanceof ja&&(n._startAnimation(),n._directDescendantItems.changes.pipe(ni(n.close)).subscribe(()=>{m.withLockedPosition(!1).reapplyLastPosition(),m.withLockedPosition(!0)}))}closeMenu(){this.menu?.close.emit()}focus(n,s){this._focusMonitor&&n?this._focusMonitor.focusVia(this._element,n,s):this._element.nativeElement.focus(s)}updatePosition(){this._overlayRef?.updatePosition()}_destroyMenu(n){if(!this._overlayRef||!this.menuOpen)return;let s=this.menu;this._closingActionsSubscription.unsubscribe(),this._overlayRef.detach(),this.restoreFocus&&(n==="keydown"||!this._openedBy||!this.triggersSubmenu())&&this.focus(this._openedBy),this._openedBy=void 0,s instanceof ja?(s._resetAnimation(),s.lazyContent?s._animationDone.pipe(pn(d=>d.toState==="void"),tn(1),ni(s.lazyContent._attached)).subscribe({next:()=>s.lazyContent.detach(),complete:()=>this._setIsMenuOpen(!1)}):this._setIsMenuOpen(!1)):(this._setIsMenuOpen(!1),s?.lazyContent?.detach())}_initMenu(n){n.parentMenu=this.triggersSubmenu()?this._parentMaterialMenu:void 0,n.direction=this.dir,this._setMenuElevation(n),n.focusFirstItem(this._openedBy||"program"),this._setIsMenuOpen(!0)}_setMenuElevation(n){if(n.setElevation){let s=0,d=n.parentMenu;for(;d;)s++,d=d.parentMenu;n.setElevation(s)}}_setIsMenuOpen(n){n!==this._menuOpen&&(this._menuOpen=n,this._menuOpen?this.menuOpened.emit():this.menuClosed.emit(),this.triggersSubmenu()&&this._menuItemInstance._setHighlighted(n),this._changeDetectorRef.markForCheck())}_createOverlay(n){if(!this._overlayRef){let s=this._getOverlayConfig(n);this._subscribeToPositions(n,s.positionStrategy),this._overlayRef=this._overlay.create(s),this._overlayRef.keydownEvents().subscribe()}return this._overlayRef}_getOverlayConfig(n){return new rs({positionStrategy:this._overlay.position().flexibleConnectedTo(this._element).withLockedPosition().withGrowAfterOpen().withTransformOriginOn(".mat-menu-panel, .mat-mdc-menu-panel"),backdropClass:n.backdropClass||"cdk-overlay-transparent-backdrop",panelClass:n.overlayPanelClass,scrollStrategy:this._scrollStrategy(),direction:this._dir})}_subscribeToPositions(n,s){n.setPositionClasses&&s.positionChanges.subscribe(d=>{let m=d.connectionPair.overlayX==="start"?"after":"before",_=d.connectionPair.overlayY==="top"?"below":"above";this._ngZone?this._ngZone.run(()=>n.setPositionClasses(m,_)):n.setPositionClasses(m,_)})}_setPosition(n,s){let[d,m]=n.xPosition==="before"?["end","start"]:["start","end"],[_,w]=n.yPosition==="above"?["bottom","top"]:["top","bottom"],[S,I]=[_,w],[L,H]=[d,m],q=0;if(this.triggersSubmenu()){if(H=d=n.xPosition==="before"?"start":"end",m=L=d==="end"?"start":"end",this._parentMaterialMenu){if(this._parentInnerPadding==null){let X=this._parentMaterialMenu.items.first;this._parentInnerPadding=X?X._getHostElement().offsetTop:0}q=_==="bottom"?this._parentInnerPadding:-this._parentInnerPadding}}else n.overlapTrigger||(S=_==="top"?"bottom":"top",I=w==="top"?"bottom":"top");s.withPositions([{originX:d,originY:S,overlayX:L,overlayY:_,offsetY:q},{originX:m,originY:S,overlayX:H,overlayY:_,offsetY:q},{originX:d,originY:I,overlayX:L,overlayY:w,offsetY:-q},{originX:m,originY:I,overlayX:H,overlayY:w,offsetY:-q}])}_menuClosingActions(){let n=this._overlayRef.backdropClick(),s=this._overlayRef.detachments(),d=this._parentMaterialMenu?this._parentMaterialMenu.closed:Fe(),m=this._parentMaterialMenu?this._parentMaterialMenu._hovered().pipe(pn(_=>_!==this._menuItemInstance),pn(()=>this._menuOpen)):Fe();return no(n,d,m,s)}_handleMousedown(n){hg(n)||(this._openedBy=n.button===0?"mouse":void 0,this.triggersSubmenu()&&n.preventDefault())}_handleKeydown(n){let s=n.keyCode;(s===13||s===32)&&(this._openedBy="keyboard"),this.triggersSubmenu()&&(s===39&&this.dir==="ltr"||s===37&&this.dir==="rtl")&&(this._openedBy="keyboard",this.openMenu())}_handleClick(n){this.triggersSubmenu()?(n.stopPropagation(),this.openMenu()):this.toggleMenu()}_handleHover(){!this.triggersSubmenu()||!this._parentMaterialMenu||(this._hoverSubscription=this._parentMaterialMenu._hovered().pipe(pn(n=>n===this._menuItemInstance&&!n.disabled),ff(0,mv)).subscribe(()=>{this._openedBy="mouse",this.menu instanceof ja&&this.menu._isAnimating?this.menu._animationDone.pipe(tn(1),ff(0,mv),ni(this._parentMaterialMenu._hovered())).subscribe(()=>this.openMenu()):this.openMenu()}))}_getPortal(n){return(!this._portal||this._portal.templateRef!==n.templateRef)&&(this._portal=new Ns(n.templateRef,this._viewContainerRef)),this._portal}};r.\u0275fac=function(s){return new(s||r)(V(Zn),V(Ee),V(Do),V(wrt),V(QD,8),V(yl,10),V(Ao,8),V(Bs),V(Be))},r.\u0275dir=oe({type:r,selectors:[["","mat-menu-trigger-for",""],["","matMenuTriggerFor",""]],hostAttrs:[1,"mat-mdc-menu-trigger"],hostVars:3,hostBindings:function(s,d){s&1&&ct("click",function(_){return d._handleClick(_)})("mousedown",function(_){return d._handleMousedown(_)})("keydown",function(_){return d._handleKeydown(_)}),s&2&&ri("aria-haspopup",d.menu?"menu":null)("aria-expanded",d.menuOpen)("aria-controls",d.menuOpen?d.menu.panelId:null)},inputs:{_deprecatedMatMenuTriggerFor:[Rt.None,"mat-menu-trigger-for","_deprecatedMatMenuTriggerFor"],menu:[Rt.None,"matMenuTriggerFor","menu"],menuData:[Rt.None,"matMenuTriggerData","menuData"],restoreFocus:[Rt.None,"matMenuTriggerRestoreFocus","restoreFocus"]},outputs:{menuOpened:"menuOpened",onMenuOpen:"onMenuOpen",menuClosed:"menuClosed",onMenuClose:"onMenuClose"},exportAs:["matMenuTrigger"],standalone:!0});let a=r;return a})();var Crt=["trigger"],Srt=["panel"];function Ert(a,r){if(a&1&&(T(0,"span",9),B(1),k()),a&2){let l=gt();z(),Te(l.placeholder)}}function Mrt(a,r){a&1&&Ai(0)}function Drt(a,r){if(a&1&&(T(0,"span",11),B(1),k()),a&2){let l=gt(2);z(),Te(l.triggerValue)}}function Trt(a,r){if(a&1&&(T(0,"span",10),ut(1,Mrt,1,0)(2,Drt,2,1),k()),a&2){let l=gt();z(),Xi(1,l.customTrigger?1:2)}}function Irt(a,r){if(a&1){let l=we();Rs(),_u(),T(0,"div",12,13),ct("@transformPanel.done",function(s){Kt(l);let d=gt();return Qt(d._panelDoneAnimatingStream.next(s.toState))})("keydown",function(s){Kt(l);let d=gt();return Qt(d._handleKeydown(s))}),Ai(2,1),k()}if(a&2){let l=gt();JF("mat-mdc-select-panel mdc-menu-surface mdc-menu-surface--open ",l._getPanelTheme(),""),W("ngClass",l.panelClass)("@transformPanel","showing"),ri("id",l.id+"-panel")("aria-multiselectable",l.multiple)("aria-label",l.ariaLabel||null)("aria-labelledby",l._getPanelAriaLabelledby())}}var Art=[[["mat-select-trigger"]],"*"],krt=["mat-select-trigger","*"],Rrt={transformPanelWrap:wr("transformPanelWrap",[ln("* => void",Av("@transformPanel",[Iv()],{optional:!0}))]),transformPanel:wr("transformPanel",[En("void",hi({opacity:0,transform:"scale(1, 0.8)"})),ln("void => showing",Sn("120ms cubic-bezier(0, 0, 0.2, 1)",hi({opacity:1,transform:"scale(1, 1)"}))),ln("* => void",Sn("100ms linear",hi({opacity:0})))])};var a5=0,Prt=new Se("mat-select-scroll-strategy",{providedIn:"root",factory:()=>{let a=le(Zn);return()=>a.scrollStrategies.reposition()}});var Ort=new Se("MAT_SELECT_CONFIG");var Frt=new Se("MatSelectTrigger"),JD=class{constructor(r,l){this.source=r,this.value=l}},l5=(()=>{let r=class r{_scrollOptionIntoView(n){let s=this.options.toArray()[n];if(s){let d=this.panel.nativeElement,m=Nz(n,this.options,this.optionGroups),_=s._getHostElement();n===0&&m===1?d.scrollTop=0:d.scrollTop=Bz(_.offsetTop,_.offsetHeight,d.scrollTop,d.offsetHeight)}}_positioningSettled(){this._scrollOptionIntoView(this._keyManager.activeItemIndex||0)}_getChangeEvent(n){return new JD(this,n)}get focused(){return this._focused||this._panelOpen}get hideSingleSelectionIndicator(){return this._hideSingleSelectionIndicator}set hideSingleSelectionIndicator(n){this._hideSingleSelectionIndicator=n,this._syncParentProperties()}get placeholder(){return this._placeholder}set placeholder(n){this._placeholder=n,this.stateChanges.next()}get required(){return this._required??this.ngControl?.control?.hasValidator(Le.required)??!1}set required(n){this._required=n,this.stateChanges.next()}get multiple(){return this._multiple}set multiple(n){this._selectionModel,this._multiple=n}get compareWith(){return this._compareWith}set compareWith(n){this._compareWith=n,this._selectionModel&&this._initializeSelection()}get value(){return this._value}set value(n){this._assignValue(n)&&this._onChange(n)}get errorStateMatcher(){return this._errorStateTracker.matcher}set errorStateMatcher(n){this._errorStateTracker.matcher=n}get id(){return this._id}set id(n){this._id=n||this._uid,this.stateChanges.next()}get errorState(){return this._errorStateTracker.errorState}set errorState(n){this._errorStateTracker.errorState=n}constructor(n,s,d,m,_,w,S,I,L,H,q,X,it,at){this._viewportRuler=n,this._changeDetectorRef=s,this._ngZone=d,this._elementRef=_,this._dir=w,this._parentFormField=L,this.ngControl=H,this._liveAnnouncer=it,this._defaultOptions=at,this._positions=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:"mat-mdc-select-panel-above"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:"mat-mdc-select-panel-above"}],this._panelOpen=!1,this._compareWith=(mt,Mt)=>mt===Mt,this._uid=`mat-select-${a5++}`,this._triggerAriaLabelledBy=null,this._destroy=new pe,this.stateChanges=new pe,this._onChange=()=>{},this._onTouched=()=>{},this._valueId=`mat-select-value-${a5++}`,this._panelDoneAnimatingStream=new pe,this._overlayPanelClass=this._defaultOptions?.overlayPanelClass||"",this._focused=!1,this.controlType="mat-select",this.disabled=!1,this.disableRipple=!1,this.tabIndex=0,this._hideSingleSelectionIndicator=this._defaultOptions?.hideSingleSelectionIndicator??!1,this._multiple=!1,this.disableOptionCentering=this._defaultOptions?.disableOptionCentering??!1,this.ariaLabel="",this.panelWidth=this._defaultOptions&&typeof this._defaultOptions.panelWidth<"u"?this._defaultOptions.panelWidth:"auto",this.optionSelectionChanges=wc(()=>{let mt=this.options;return mt?mt.changes.pipe(ho(mt),ro(()=>no(...mt.map(Mt=>Mt.onSelectionChange)))):this._ngZone.onStable.pipe(tn(1),ro(()=>this.optionSelectionChanges))}),this.openedChange=new ye,this._openedStream=this.openedChange.pipe(pn(mt=>mt),Li(()=>{})),this._closedStream=this.openedChange.pipe(pn(mt=>!mt),Li(()=>{})),this.selectionChange=new ye,this.valueChange=new ye,this._trackedModal=null,this._skipPredicate=mt=>this.panelOpen?!1:mt.disabled,this.ngControl&&(this.ngControl.valueAccessor=this),at?.typeaheadDebounceInterval!=null&&(this.typeaheadDebounceInterval=at.typeaheadDebounceInterval),this._errorStateTracker=new Ou(m,H,I,S,this.stateChanges),this._scrollStrategyFactory=X,this._scrollStrategy=this._scrollStrategyFactory(),this.tabIndex=parseInt(q)||0,this.id=this.id}ngOnInit(){this._selectionModel=new fy(this.multiple),this.stateChanges.next(),this._panelDoneAnimatingStream.pipe(gf(),ni(this._destroy)).subscribe(()=>this._panelDoneAnimating(this.panelOpen)),this._viewportRuler.change().pipe(ni(this._destroy)).subscribe(()=>{this.panelOpen&&(this._overlayWidth=this._getOverlayWidth(this._preferredOverlayOrigin),this._changeDetectorRef.detectChanges())})}ngAfterContentInit(){this._initKeyManager(),this._selectionModel.changed.pipe(ni(this._destroy)).subscribe(n=>{n.added.forEach(s=>s.select()),n.removed.forEach(s=>s.deselect())}),this.options.changes.pipe(ho(null),ni(this._destroy)).subscribe(()=>{this._resetOptions(),this._initializeSelection()})}ngDoCheck(){let n=this._getTriggerAriaLabelledby(),s=this.ngControl;if(n!==this._triggerAriaLabelledBy){let d=this._elementRef.nativeElement;this._triggerAriaLabelledBy=n,n?d.setAttribute("aria-labelledby",n):d.removeAttribute("aria-labelledby")}s&&(this._previousControl!==s.control&&(this._previousControl!==void 0&&s.disabled!==null&&s.disabled!==this.disabled&&(this.disabled=s.disabled),this._previousControl=s.control),this.updateErrorState())}ngOnChanges(n){(n.disabled||n.userAriaDescribedBy)&&this.stateChanges.next(),n.typeaheadDebounceInterval&&this._keyManager&&this._keyManager.withTypeAhead(this.typeaheadDebounceInterval)}ngOnDestroy(){this._keyManager?.destroy(),this._destroy.next(),this._destroy.complete(),this.stateChanges.complete(),this._clearFromModal()}toggle(){this.panelOpen?this.close():this.open()}open(){this._canOpen()&&(this._parentFormField&&(this._preferredOverlayOrigin=this._parentFormField.getConnectedOverlayOrigin()),this._overlayWidth=this._getOverlayWidth(this._preferredOverlayOrigin),this._applyModalPanelOwnership(),this._panelOpen=!0,this._keyManager.withHorizontalOrientation(null),this._highlightCorrectOption(),this._changeDetectorRef.markForCheck(),this.stateChanges.next())}_applyModalPanelOwnership(){let n=this._elementRef.nativeElement.closest('body > .cdk-overlay-container [aria-modal="true"]');if(!n)return;let s=`${this.id}-panel`;this._trackedModal&&Ty(this._trackedModal,"aria-owns",s),dM(n,"aria-owns",s),this._trackedModal=n}_clearFromModal(){if(!this._trackedModal)return;let n=`${this.id}-panel`;Ty(this._trackedModal,"aria-owns",n),this._trackedModal=null}close(){this._panelOpen&&(this._panelOpen=!1,this._keyManager.withHorizontalOrientation(this._isRtl()?"rtl":"ltr"),this._changeDetectorRef.markForCheck(),this._onTouched(),this.stateChanges.next())}writeValue(n){this._assignValue(n)}registerOnChange(n){this._onChange=n}registerOnTouched(n){this._onTouched=n}setDisabledState(n){this.disabled=n,this._changeDetectorRef.markForCheck(),this.stateChanges.next()}get panelOpen(){return this._panelOpen}get selected(){return this.multiple?this._selectionModel?.selected||[]:this._selectionModel?.selected[0]}get triggerValue(){if(this.empty)return"";if(this._multiple){let n=this._selectionModel.selected.map(s=>s.viewValue);return this._isRtl()&&n.reverse(),n.join(", ")}return this._selectionModel.selected[0].viewValue}updateErrorState(){this._errorStateTracker.updateErrorState()}_isRtl(){return this._dir?this._dir.value==="rtl":!1}_handleKeydown(n){this.disabled||(this.panelOpen?this._handleOpenKeydown(n):this._handleClosedKeydown(n))}_handleClosedKeydown(n){let s=n.keyCode,d=s===40||s===38||s===37||s===39,m=s===13||s===32,_=this._keyManager;if(!_.isTyping()&&m&&!Zr(n)||(this.multiple||n.altKey)&&d)n.preventDefault(),this.open();else if(!this.multiple){let w=this.selected;_.onKeydown(n);let S=this.selected;S&&w!==S&&this._liveAnnouncer.announce(S.viewValue,1e4)}}_handleOpenKeydown(n){let s=this._keyManager,d=n.keyCode,m=d===40||d===38,_=s.isTyping();if(m&&n.altKey)n.preventDefault(),this.close();else if(!_&&(d===13||d===32)&&s.activeItem&&!Zr(n))n.preventDefault(),s.activeItem._selectViaInteraction();else if(!_&&this._multiple&&d===65&&n.ctrlKey){n.preventDefault();let w=this.options.some(S=>!S.disabled&&!S.selected);this.options.forEach(S=>{S.disabled||(w?S.select():S.deselect())})}else{let w=s.activeItemIndex;s.onKeydown(n),this._multiple&&m&&n.shiftKey&&s.activeItem&&s.activeItemIndex!==w&&s.activeItem._selectViaInteraction()}}_onFocus(){this.disabled||(this._focused=!0,this.stateChanges.next())}_onBlur(){this._focused=!1,this._keyManager?.cancelTypeahead(),!this.disabled&&!this.panelOpen&&(this._onTouched(),this._changeDetectorRef.markForCheck(),this.stateChanges.next())}_onAttached(){this._overlayDir.positionChange.pipe(tn(1)).subscribe(()=>{this._changeDetectorRef.detectChanges(),this._positioningSettled()})}_getPanelTheme(){return this._parentFormField?`mat-${this._parentFormField.color}`:""}get empty(){return!this._selectionModel||this._selectionModel.isEmpty()}_initializeSelection(){Promise.resolve().then(()=>{this.ngControl&&(this._value=this.ngControl.value),this._setSelectionByValue(this._value),this.stateChanges.next()})}_setSelectionByValue(n){if(this.options.forEach(s=>s.setInactiveStyles()),this._selectionModel.clear(),this.multiple&&n)Array.isArray(n),n.forEach(s=>this._selectOptionByValue(s)),this._sortValues();else{let s=this._selectOptionByValue(n);s?this._keyManager.updateActiveItem(s):this.panelOpen||this._keyManager.updateActiveItem(-1)}this._changeDetectorRef.markForCheck()}_selectOptionByValue(n){let s=this.options.find(d=>{if(this._selectionModel.isSelected(d))return!1;try{return d.value!=null&&this._compareWith(d.value,n)}catch{return!1}});return s&&this._selectionModel.select(s),s}_assignValue(n){return n!==this._value||this._multiple&&Array.isArray(n)?(this.options&&this._setSelectionByValue(n),this._value=n,!0):!1}_getOverlayWidth(n){return this.panelWidth==="auto"?(n instanceof vy?n.elementRef:n||this._elementRef).nativeElement.getBoundingClientRect().width:this.panelWidth===null?"":this.panelWidth}_syncParentProperties(){if(this.options)for(let n of this.options)n._changeDetectorRef.markForCheck()}_initKeyManager(){this._keyManager=new My(this.options).withTypeAhead(this.typeaheadDebounceInterval).withVerticalOrientation().withHorizontalOrientation(this._isRtl()?"rtl":"ltr").withHomeAndEnd().withPageUpDown().withAllowedModifierKeys(["shiftKey"]).skipPredicate(this._skipPredicate),this._keyManager.tabOut.subscribe(()=>{this.panelOpen&&(!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction(),this.focus(),this.close())}),this._keyManager.change.subscribe(()=>{this._panelOpen&&this.panel?this._scrollOptionIntoView(this._keyManager.activeItemIndex||0):!this._panelOpen&&!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction()})}_resetOptions(){let n=no(this.options.changes,this._destroy);this.optionSelectionChanges.pipe(ni(n)).subscribe(s=>{this._onSelect(s.source,s.isUserInput),s.isUserInput&&!this.multiple&&this._panelOpen&&(this.close(),this.focus())}),no(...this.options.map(s=>s._stateChanges)).pipe(ni(n)).subscribe(()=>{this._changeDetectorRef.detectChanges(),this.stateChanges.next()})}_onSelect(n,s){let d=this._selectionModel.isSelected(n);n.value==null&&!this._multiple?(n.deselect(),this._selectionModel.clear(),this.value!=null&&this._propagateChanges(n.value)):(d!==n.selected&&(n.selected?this._selectionModel.select(n):this._selectionModel.deselect(n)),s&&this._keyManager.setActiveItem(n),this.multiple&&(this._sortValues(),s&&this.focus())),d!==this._selectionModel.isSelected(n)&&this._propagateChanges(),this.stateChanges.next()}_sortValues(){if(this.multiple){let n=this.options.toArray();this._selectionModel.sort((s,d)=>this.sortComparator?this.sortComparator(s,d,n):n.indexOf(s)-n.indexOf(d)),this.stateChanges.next()}}_propagateChanges(n){let s;this.multiple?s=this.selected.map(d=>d.value):s=this.selected?this.selected.value:n,this._value=s,this.valueChange.emit(s),this._onChange(s),this.selectionChange.emit(this._getChangeEvent(s)),this._changeDetectorRef.markForCheck()}_highlightCorrectOption(){if(this._keyManager)if(this.empty){let n=-1;for(let s=0;s<this.options.length;s++)if(!this.options.get(s).disabled){n=s;break}this._keyManager.setActiveItem(n)}else this._keyManager.setActiveItem(this._selectionModel.selected[0])}_canOpen(){return!this._panelOpen&&!this.disabled&&this.options?.length>0}focus(n){this._elementRef.nativeElement.focus(n)}_getPanelAriaLabelledby(){if(this.ariaLabel)return null;let n=this._parentFormField?.getLabelId(),s=n?n+" ":"";return this.ariaLabelledby?s+this.ariaLabelledby:n}_getAriaActiveDescendant(){return this.panelOpen&&this._keyManager&&this._keyManager.activeItem?this._keyManager.activeItem.id:null}_getTriggerAriaLabelledby(){if(this.ariaLabel)return null;let n=this._parentFormField?.getLabelId(),s=(n?n+" ":"")+this._valueId;return this.ariaLabelledby&&(s+=" "+this.ariaLabelledby),s}_panelDoneAnimating(n){this.openedChange.emit(n)}setDescribedByIds(n){n.length?this._elementRef.nativeElement.setAttribute("aria-describedby",n.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focus(),this.open()}get shouldLabelFloat(){return this.panelOpen||!this.empty||this.focused&&!!this.placeholder}};r.\u0275fac=function(s){return new(s||r)(V(wd),V(Zi),V(Be),V(fg),V(Ee),V(Ao,8),V(Jf,8),V(Hn,8),V(Fu,8),V(fs,10),ol("tabindex"),V(Prt),V(Ay),V(Ort,8))},r.\u0275cmp=St({type:r,selectors:[["mat-select"]],contentQueries:function(s,d,m){if(s&1&&(fn(m,Frt,5),fn(m,Fy,5),fn(m,yM,5)),s&2){let _;se(_=ae())&&(d.customTrigger=_.first),se(_=ae())&&(d.options=_),se(_=ae())&&(d.optionGroups=_)}},viewQuery:function(s,d){if(s&1&&(ze(Crt,5),ze(Srt,5),ze(oM,5)),s&2){let m;se(m=ae())&&(d.trigger=m.first),se(m=ae())&&(d.panel=m.first),se(m=ae())&&(d._overlayDir=m.first)}},hostAttrs:["role","combobox","aria-autocomplete","none","aria-haspopup","listbox",1,"mat-mdc-select"],hostVars:19,hostBindings:function(s,d){s&1&&ct("keydown",function(_){return d._handleKeydown(_)})("focus",function(){return d._onFocus()})("blur",function(){return d._onBlur()}),s&2&&(ri("id",d.id)("tabindex",d.disabled?-1:d.tabIndex)("aria-controls",d.panelOpen?d.id+"-panel":null)("aria-expanded",d.panelOpen)("aria-label",d.ariaLabel||null)("aria-required",d.required.toString())("aria-disabled",d.disabled.toString())("aria-invalid",d.errorState)("aria-activedescendant",d._getAriaActiveDescendant()),li("mat-mdc-select-disabled",d.disabled)("mat-mdc-select-invalid",d.errorState)("mat-mdc-select-required",d.required)("mat-mdc-select-empty",d.empty)("mat-mdc-select-multiple",d.multiple))},inputs:{userAriaDescribedBy:[Rt.None,"aria-describedby","userAriaDescribedBy"],panelClass:"panelClass",disabled:[Rt.HasDecoratorInputTransform,"disabled","disabled",Qe],disableRipple:[Rt.HasDecoratorInputTransform,"disableRipple","disableRipple",Qe],tabIndex:[Rt.HasDecoratorInputTransform,"tabIndex","tabIndex",n=>n==null?0:ll(n)],hideSingleSelectionIndicator:[Rt.HasDecoratorInputTransform,"hideSingleSelectionIndicator","hideSingleSelectionIndicator",Qe],placeholder:"placeholder",required:[Rt.HasDecoratorInputTransform,"required","required",Qe],multiple:[Rt.HasDecoratorInputTransform,"multiple","multiple",Qe],disableOptionCentering:[Rt.HasDecoratorInputTransform,"disableOptionCentering","disableOptionCentering",Qe],compareWith:"compareWith",value:"value",ariaLabel:[Rt.None,"aria-label","ariaLabel"],ariaLabelledby:[Rt.None,"aria-labelledby","ariaLabelledby"],errorStateMatcher:"errorStateMatcher",typeaheadDebounceInterval:[Rt.HasDecoratorInputTransform,"typeaheadDebounceInterval","typeaheadDebounceInterval",ll],sortComparator:"sortComparator",id:"id",panelWidth:"panelWidth"},outputs:{openedChange:"openedChange",_openedStream:"opened",_closedStream:"closed",selectionChange:"selectionChange",valueChange:"valueChange"},exportAs:["matSelect"],standalone:!0,features:[ji([{provide:Tm,useExisting:r},{provide:vM,useExisting:r}]),Fn,Yn,At],ngContentSelectors:krt,decls:11,vars:8,consts:[["cdk-overlay-origin","",1,"mat-mdc-select-trigger",3,"click"],["fallbackOverlayOrigin","cdkOverlayOrigin","trigger",""],[1,"mat-mdc-select-value"],["class","mat-mdc-select-placeholder mat-mdc-select-min-line"],[1,"mat-mdc-select-arrow-wrapper"],[1,"mat-mdc-select-arrow"],["viewBox","0 0 24 24","width","24px","height","24px","focusable","false","aria-hidden","true"],["d","M7 10l5 5 5-5z"],["cdk-connected-overlay","","cdkConnectedOverlayLockPosition","","cdkConnectedOverlayHasBackdrop","","cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop",3,"cdkConnectedOverlayPanelClass","cdkConnectedOverlayScrollStrategy","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayPositions","cdkConnectedOverlayWidth","backdropClick","attach","detach"],[1,"mat-mdc-select-placeholder","mat-mdc-select-min-line"],[1,"mat-mdc-select-value-text"],[1,"mat-mdc-select-min-line"],["role","listbox","tabindex","-1",3,"ngClass","keydown"],["panel",""]],template:function(s,d){if(s&1&&(Un(Art),T(0,"div",0,1),ct("click",function(){return d.open()}),T(3,"div",2),ut(4,Ert,2,1,"span",3)(5,Trt,3,1),k(),T(6,"div",4)(7,"div",5),Rs(),T(8,"svg",6),dt(9,"path",7),k()()()(),ut(10,Irt,3,9,"ng-template",8),ct("backdropClick",function(){return d.close()})("attach",function(){return d._onAttached()})("detach",function(){return d.close()})),s&2){let m=oo(1);z(3),ri("id",d._valueId),z(),Xi(4,d.empty?4:5),z(6),W("cdkConnectedOverlayPanelClass",d._overlayPanelClass)("cdkConnectedOverlayScrollStrategy",d._scrollStrategy)("cdkConnectedOverlayOrigin",d._preferredOverlayOrigin||m)("cdkConnectedOverlayOpen",d.panelOpen)("cdkConnectedOverlayPositions",d._positions)("cdkConnectedOverlayWidth",d._overlayWidth)}},dependencies:[vy,oM,Uo],styles:['.mat-mdc-select{display:inline-block;width:100%;outline:none;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;color:var(--mat-select-enabled-trigger-text-color);font-family:var(--mat-select-trigger-text-font);line-height:var(--mat-select-trigger-text-line-height);font-size:var(--mat-select-trigger-text-size);font-weight:var(--mat-select-trigger-text-weight);letter-spacing:var(--mat-select-trigger-text-tracking)}div.mat-mdc-select-panel{box-shadow:var(--mat-select-container-elevation-shadow)}.mat-mdc-select-disabled{color:var(--mat-select-disabled-trigger-text-color)}.mat-mdc-select-trigger{display:inline-flex;align-items:center;cursor:pointer;position:relative;box-sizing:border-box;width:100%}.mat-mdc-select-disabled .mat-mdc-select-trigger{-webkit-user-select:none;user-select:none;cursor:default}.mat-mdc-select-value{width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.mat-mdc-select-value-text{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.mat-mdc-select-arrow-wrapper{height:24px;flex-shrink:0;display:inline-flex;align-items:center}.mat-form-field-appearance-fill .mdc-text-field--no-label .mat-mdc-select-arrow-wrapper{transform:none}.mat-mdc-form-field .mat-mdc-select.mat-mdc-select-invalid .mat-mdc-select-arrow,.mat-form-field-invalid:not(.mat-form-field-disabled) .mat-mdc-form-field-infix::after{color:var(--mat-select-invalid-arrow-color)}.mat-mdc-select-arrow{width:10px;height:5px;position:relative;color:var(--mat-select-enabled-arrow-color)}.mat-mdc-form-field.mat-focused .mat-mdc-select-arrow{color:var(--mat-select-focused-arrow-color)}.mat-mdc-form-field .mat-mdc-select.mat-mdc-select-disabled .mat-mdc-select-arrow{color:var(--mat-select-disabled-arrow-color)}.mat-mdc-select-arrow svg{fill:currentColor;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%)}.cdk-high-contrast-active .mat-mdc-select-arrow svg{fill:CanvasText}.mat-mdc-select-disabled .cdk-high-contrast-active .mat-mdc-select-arrow svg{fill:GrayText}div.mat-mdc-select-panel{width:100%;max-height:275px;outline:0;overflow:auto;padding:8px 0;border-radius:4px;box-sizing:border-box;position:static;background-color:var(--mat-select-panel-background-color)}.cdk-high-contrast-active div.mat-mdc-select-panel{outline:solid 1px}.cdk-overlay-pane:not(.mat-mdc-select-panel-above) div.mat-mdc-select-panel{border-top-left-radius:0;border-top-right-radius:0;transform-origin:top center}.mat-mdc-select-panel-above div.mat-mdc-select-panel{border-bottom-left-radius:0;border-bottom-right-radius:0;transform-origin:bottom center}div.mat-mdc-select-panel .mat-mdc-option{--mdc-list-list-item-container-color: var(--mat-select-panel-background-color)}.mat-mdc-select-placeholder{transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1);color:var(--mat-select-placeholder-text-color)}._mat-animation-noopable .mat-mdc-select-placeholder{transition:none}.mat-form-field-hide-placeholder .mat-mdc-select-placeholder{color:rgba(0,0,0,0);-webkit-text-fill-color:rgba(0,0,0,0);transition:none;display:block}.mat-mdc-form-field-type-mat-select:not(.mat-form-field-disabled) .mat-mdc-text-field-wrapper{cursor:pointer}.mat-mdc-form-field-type-mat-select.mat-form-field-appearance-fill .mat-mdc-floating-label{max-width:calc(100% - 18px)}.mat-mdc-form-field-type-mat-select.mat-form-field-appearance-fill .mdc-floating-label--float-above{max-width:calc(100%/0.75 - 24px)}.mat-mdc-form-field-type-mat-select.mat-form-field-appearance-outline .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mat-mdc-form-field-type-mat-select.mat-form-field-appearance-outline .mdc-text-field--label-floating .mdc-notched-outline__notch{max-width:calc(100% - 24px)}.mat-mdc-select-min-line:empty::before{content:" ";white-space:pre;width:1px;display:inline-block;visibility:hidden}.mat-form-field-appearance-fill .mat-mdc-select-arrow-wrapper{transform:var(--mat-select-arrow-transform)}'],encapsulation:2,data:{animation:[Rrt.transformPanel]},changeDetection:0});let a=r;return a})();var Lrt=["tooltip"],zrt=20;var Nrt=new Se("mat-tooltip-scroll-strategy",{providedIn:"root",factory:()=>{let a=le(Zn);return()=>a.scrollStrategies.reposition({scrollThrottle:zrt})}});function Brt(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500}}var Vrt=new Se("mat-tooltip-default-options",{providedIn:"root",factory:Brt});var c5="tooltip-panel",d5=is({passive:!0}),jrt=500,Urt=8,Hrt=8,Grt=24,qrt=200,u5=(()=>{let r=class r{get position(){return this._position}set position(n){n!==this._position&&(this._position=n,this._overlayRef&&(this._updatePosition(this._overlayRef),this._tooltipInstance?.show(0),this._overlayRef.updatePosition()))}get positionAtOrigin(){return this._positionAtOrigin}set positionAtOrigin(n){this._positionAtOrigin=ao(n),this._detach(),this._overlayRef=null}get disabled(){return this._disabled}set disabled(n){this._disabled=ao(n),this._disabled?this.hide(0):this._setupPointerEnterEventsIfNeeded()}get showDelay(){return this._showDelay}set showDelay(n){this._showDelay=Hl(n)}get hideDelay(){return this._hideDelay}set hideDelay(n){this._hideDelay=Hl(n),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}get message(){return this._message}set message(n){this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._message,"tooltip"),this._message=n!=null?String(n).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage(),this._ngZone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._ariaDescriber.describe(this._elementRef.nativeElement,this.message,"tooltip")})}))}get tooltipClass(){return this._tooltipClass}set tooltipClass(n){this._tooltipClass=n,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}constructor(n,s,d,m,_,w,S,I,L,H,q,X){this._overlay=n,this._elementRef=s,this._scrollDispatcher=d,this._viewContainerRef=m,this._ngZone=_,this._platform=w,this._ariaDescriber=S,this._focusMonitor=I,this._dir=H,this._defaultOptions=q,this._position="below",this._positionAtOrigin=!1,this._disabled=!1,this._viewInitialized=!1,this._pointerExitEventsInitialized=!1,this._tooltipComponent=Wrt,this._viewportMargin=8,this._cssClassPrefix="mat-mdc",this.touchGestures="auto",this._message="",this._passiveListeners=[],this._destroyed=new pe,this._scrollStrategy=L,this._document=X,q&&(this._showDelay=q.showDelay,this._hideDelay=q.hideDelay,q.position&&(this.position=q.position),q.positionAtOrigin&&(this.positionAtOrigin=q.positionAtOrigin),q.touchGestures&&(this.touchGestures=q.touchGestures)),H.change.pipe(ni(this._destroyed)).subscribe(()=>{this._overlayRef&&this._updatePosition(this._overlayRef)}),this._viewportMargin=Urt}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(ni(this._destroyed)).subscribe(n=>{n?n==="keyboard"&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){let n=this._elementRef.nativeElement;clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([s,d])=>{n.removeEventListener(s,d,d5)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),this._ariaDescriber.removeDescription(n,this.message,"tooltip"),this._focusMonitor.stopMonitoring(n)}show(n=this.showDelay,s){if(this.disabled||!this.message||this._isTooltipVisible()){this._tooltipInstance?._cancelPendingAnimations();return}let d=this._createOverlay(s);this._detach(),this._portal=this._portal||new ns(this._tooltipComponent,this._viewContainerRef);let m=this._tooltipInstance=d.attach(this._portal).instance;m._triggerElement=this._elementRef.nativeElement,m._mouseLeaveHideDelay=this._hideDelay,m.afterHidden().pipe(ni(this._destroyed)).subscribe(()=>this._detach()),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),m.show(n)}hide(n=this.hideDelay){let s=this._tooltipInstance;s&&(s.isVisible()?s.hide(n):(s._cancelPendingAnimations(),this._detach()))}toggle(n){this._isTooltipVisible()?this.hide():this.show(void 0,n)}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(n){if(this._overlayRef){let m=this._overlayRef.getConfig().positionStrategy;if((!this.positionAtOrigin||!n)&&m._origin instanceof Ee)return this._overlayRef;this._detach()}let s=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),d=this._overlay.position().flexibleConnectedTo(this.positionAtOrigin?n||this._elementRef:this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(s);return d.positionChanges.pipe(ni(this._destroyed)).subscribe(m=>{this._updateCurrentPositionClass(m.connectionPair),this._tooltipInstance&&m.scrollableViewProperties.isOverlayClipped&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({direction:this._dir,positionStrategy:d,panelClass:`${this._cssClassPrefix}-${c5}`,scrollStrategy:this._scrollStrategy()}),this._updatePosition(this._overlayRef),this._overlayRef.detachments().pipe(ni(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.outsidePointerEvents().pipe(ni(this._destroyed)).subscribe(()=>this._tooltipInstance?._handleBodyInteraction()),this._overlayRef.keydownEvents().pipe(ni(this._destroyed)).subscribe(m=>{this._isTooltipVisible()&&m.keyCode===27&&!Zr(m)&&(m.preventDefault(),m.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._defaultOptions?.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&this._overlayRef.detach(),this._tooltipInstance=null}_updatePosition(n){let s=n.getConfig().positionStrategy,d=this._getOrigin(),m=this._getOverlayPosition();s.withPositions([this._addOffset(qt(qt({},d.main),m.main)),this._addOffset(qt(qt({},d.fallback),m.fallback))])}_addOffset(n){let s=Hrt,d=!this._dir||this._dir.value=="ltr";return n.originY==="top"?n.offsetY=-s:n.originY==="bottom"?n.offsetY=s:n.originX==="start"?n.offsetX=d?-s:s:n.originX==="end"&&(n.offsetX=d?s:-s),n}_getOrigin(){let n=!this._dir||this._dir.value=="ltr",s=this.position,d;s=="above"||s=="below"?d={originX:"center",originY:s=="above"?"top":"bottom"}:s=="before"||s=="left"&&n||s=="right"&&!n?d={originX:"start",originY:"center"}:(s=="after"||s=="right"&&n||s=="left"&&!n)&&(d={originX:"end",originY:"center"});let{x:m,y:_}=this._invertPosition(d.originX,d.originY);return{main:d,fallback:{originX:m,originY:_}}}_getOverlayPosition(){let n=!this._dir||this._dir.value=="ltr",s=this.position,d;s=="above"?d={overlayX:"center",overlayY:"bottom"}:s=="below"?d={overlayX:"center",overlayY:"top"}:s=="before"||s=="left"&&n||s=="right"&&!n?d={overlayX:"end",overlayY:"center"}:(s=="after"||s=="right"&&n||s=="left"&&!n)&&(d={overlayX:"start",overlayY:"center"});let{x:m,y:_}=this._invertPosition(d.overlayX,d.overlayY);return{main:d,fallback:{overlayX:m,overlayY:_}}}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),this._ngZone.onMicrotaskEmpty.pipe(tn(1),ni(this._destroyed)).subscribe(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()}))}_setTooltipClass(n){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=n,this._tooltipInstance._markForCheck())}_invertPosition(n,s){return this.position==="above"||this.position==="below"?s==="top"?s="bottom":s==="bottom"&&(s="top"):n==="end"?n="start":n==="start"&&(n="end"),{x:n,y:s}}_updateCurrentPositionClass(n){let{overlayY:s,originX:d,originY:m}=n,_;if(s==="center"?this._dir&&this._dir.value==="rtl"?_=d==="end"?"left":"right":_=d==="start"?"left":"right":_=s==="bottom"&&m==="top"?"above":"below",_!==this._currentPosition){let w=this._overlayRef;if(w){let S=`${this._cssClassPrefix}-${c5}-`;w.removePanelClass(S+this._currentPosition),w.addPanelClass(S+_)}this._currentPosition=_}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||(this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",n=>{this._setupPointerExitEventsIfNeeded();let s;n.x!==void 0&&n.y!==void 0&&(s=n),this.show(void 0,s)}]):this.touchGestures!=="off"&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",n=>{let s=n.targetTouches?.[0],d=s?{x:s.clientX,y:s.clientY}:void 0;this._setupPointerExitEventsIfNeeded(),clearTimeout(this._touchstartTimeout),this._touchstartTimeout=setTimeout(()=>this.show(void 0,d),jrt)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;let n=[];if(this._platformSupportsMouseEvents())n.push(["mouseleave",s=>{let d=s.relatedTarget;(!d||!this._overlayRef?.overlayElement.contains(d))&&this.hide()}],["wheel",s=>this._wheelListener(s)]);else if(this.touchGestures!=="off"){this._disableNativeGesturesIfNecessary();let s=()=>{clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions.touchendHideDelay)};n.push(["touchend",s],["touchcancel",s])}this._addListeners(n),this._passiveListeners.push(...n)}_addListeners(n){n.forEach(([s,d])=>{this._elementRef.nativeElement.addEventListener(s,d,d5)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(n){if(this._isTooltipVisible()){let s=this._document.elementFromPoint(n.clientX,n.clientY),d=this._elementRef.nativeElement;s!==d&&!d.contains(s)&&this.hide()}}_disableNativeGesturesIfNecessary(){let n=this.touchGestures;if(n!=="off"){let s=this._elementRef.nativeElement,d=s.style;(n==="on"||s.nodeName!=="INPUT"&&s.nodeName!=="TEXTAREA")&&(d.userSelect=d.msUserSelect=d.webkitUserSelect=d.MozUserSelect="none"),(n==="on"||!s.draggable)&&(d.webkitUserDrag="none"),d.touchAction="none",d.webkitTapHighlightColor="transparent"}}};r.\u0275fac=function(s){return new(s||r)(V(Zn),V(Ee),V(ng),V(Do),V(Be),V(gn),V(Iy),V(Bs),V(Nrt),V(Ao),V(Vrt,8),V(ci))},r.\u0275dir=oe({type:r,selectors:[["","matTooltip",""]],hostAttrs:[1,"mat-mdc-tooltip-trigger"],hostVars:2,hostBindings:function(s,d){s&2&&li("mat-mdc-tooltip-disabled",d.disabled)},inputs:{position:[Rt.None,"matTooltipPosition","position"],positionAtOrigin:[Rt.None,"matTooltipPositionAtOrigin","positionAtOrigin"],disabled:[Rt.None,"matTooltipDisabled","disabled"],showDelay:[Rt.None,"matTooltipShowDelay","showDelay"],hideDelay:[Rt.None,"matTooltipHideDelay","hideDelay"],touchGestures:[Rt.None,"matTooltipTouchGestures","touchGestures"],message:[Rt.None,"matTooltip","message"],tooltipClass:[Rt.None,"matTooltipClass","tooltipClass"]},exportAs:["matTooltip"],standalone:!0});let a=r;return a})(),Wrt=(()=>{let r=class r{constructor(n,s,d){this._changeDetectorRef=n,this._elementRef=s,this._isMultiline=!1,this._closeOnInteraction=!1,this._isVisible=!1,this._onHide=new pe,this._showAnimation="mat-mdc-tooltip-show",this._hideAnimation="mat-mdc-tooltip-hide",this._animationsDisabled=d==="NoopAnimations"}show(n){this._hideTimeoutId!=null&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=setTimeout(()=>{this._toggleVisibility(!0),this._showTimeoutId=void 0},n)}hide(n){this._showTimeoutId!=null&&clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0},n)}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){this._cancelPendingAnimations(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:n}){(!n||!this._triggerElement.contains(n))&&(this.isVisible()?this.hide(this._mouseLeaveHideDelay):this._finalizeAnimation(!1))}_onShow(){this._isMultiline=this._isTooltipMultiline(),this._markForCheck()}_isTooltipMultiline(){let n=this._elementRef.nativeElement.getBoundingClientRect();return n.height>Grt&&n.width>=qrt}_handleAnimationEnd({animationName:n}){(n===this._showAnimation||n===this._hideAnimation)&&this._finalizeAnimation(n===this._showAnimation)}_cancelPendingAnimations(){this._showTimeoutId!=null&&clearTimeout(this._showTimeoutId),this._hideTimeoutId!=null&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=this._hideTimeoutId=void 0}_finalizeAnimation(n){n?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next()}_toggleVisibility(n){let s=this._tooltip.nativeElement,d=this._showAnimation,m=this._hideAnimation;if(s.classList.remove(n?m:d),s.classList.add(n?d:m),this._isVisible=n,n&&!this._animationsDisabled&&typeof getComputedStyle=="function"){let _=getComputedStyle(s);(_.getPropertyValue("animation-duration")==="0s"||_.getPropertyValue("animation-name")==="none")&&(this._animationsDisabled=!0)}n&&this._onShow(),this._animationsDisabled&&(s.classList.add("_mat-animation-noopable"),this._finalizeAnimation(n))}};r.\u0275fac=function(s){return new(s||r)(V(Zi),V(Ee),V(Eo,8))},r.\u0275cmp=St({type:r,selectors:[["mat-tooltip-component"]],viewQuery:function(s,d){if(s&1&&ze(Lrt,7),s&2){let m;se(m=ae())&&(d._tooltip=m.first)}},hostAttrs:["aria-hidden","true"],hostVars:2,hostBindings:function(s,d){s&1&&ct("mouseleave",function(_){return d._handleMouseLeave(_)}),s&2&&Ec("zoom",d.isVisible()?1:null)},standalone:!0,features:[At],decls:4,vars:4,consts:[[1,"mdc-tooltip","mdc-tooltip--shown","mat-mdc-tooltip",3,"ngClass","animationend"],["tooltip",""],[1,"mdc-tooltip__surface","mdc-tooltip__surface-animation"]],template:function(s,d){s&1&&(T(0,"div",0,1),ct("animationend",function(_){return d._handleAnimationEnd(_)}),T(2,"div",2),B(3),k()()),s&2&&(li("mdc-tooltip--multiline",d._isMultiline),W("ngClass",d.tooltipClass),z(3),Te(d.message))},dependencies:[Uo],styles:['.mdc-tooltip__surface{word-break:break-all;word-break:var(--mdc-tooltip-word-break, normal);overflow-wrap:anywhere}.mdc-tooltip--showing-transition .mdc-tooltip__surface-animation{transition:opacity 150ms 0ms cubic-bezier(0, 0, 0.2, 1),transform 150ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-tooltip--hide-transition .mdc-tooltip__surface-animation{transition:opacity 75ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-tooltip{position:fixed;display:none;z-index:9}.mdc-tooltip-wrapper--rich{position:relative}.mdc-tooltip--shown,.mdc-tooltip--showing,.mdc-tooltip--hide{display:inline-flex}.mdc-tooltip--shown.mdc-tooltip--rich,.mdc-tooltip--showing.mdc-tooltip--rich,.mdc-tooltip--hide.mdc-tooltip--rich{display:inline-block;left:-320px;position:absolute}.mdc-tooltip__surface{line-height:16px;padding:4px 8px;min-width:40px;max-width:200px;min-height:24px;max-height:40vh;box-sizing:border-box;overflow:hidden;text-align:center}.mdc-tooltip__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-tooltip__surface::before{border-color:CanvasText}}.mdc-tooltip--rich .mdc-tooltip__surface{align-items:flex-start;display:flex;flex-direction:column;min-height:24px;min-width:40px;max-width:320px;position:relative}.mdc-tooltip--multiline .mdc-tooltip__surface{text-align:left}[dir=rtl] .mdc-tooltip--multiline .mdc-tooltip__surface,.mdc-tooltip--multiline .mdc-tooltip__surface[dir=rtl]{text-align:right}.mdc-tooltip__surface .mdc-tooltip__title{margin:0 8px}.mdc-tooltip__surface .mdc-tooltip__content{max-width:calc(200px - 2*8px);margin:8px;text-align:left}[dir=rtl] .mdc-tooltip__surface .mdc-tooltip__content,.mdc-tooltip__surface .mdc-tooltip__content[dir=rtl]{text-align:right}.mdc-tooltip--rich .mdc-tooltip__surface .mdc-tooltip__content{max-width:calc(320px - 2*8px);align-self:stretch}.mdc-tooltip__surface .mdc-tooltip__content-link{text-decoration:none}.mdc-tooltip--rich-actions,.mdc-tooltip__content,.mdc-tooltip__title{z-index:1}.mdc-tooltip__surface-animation{opacity:0;transform:scale(0.8);will-change:transform,opacity}.mdc-tooltip--shown .mdc-tooltip__surface-animation{transform:scale(1);opacity:1}.mdc-tooltip--hide .mdc-tooltip__surface-animation{transform:scale(1)}.mdc-tooltip__caret-surface-top,.mdc-tooltip__caret-surface-bottom{position:absolute;height:24px;width:24px;transform:rotate(35deg) skewY(20deg) scaleX(0.9396926208)}.mdc-tooltip__caret-surface-top .mdc-elevation-overlay,.mdc-tooltip__caret-surface-bottom .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-tooltip__caret-surface-bottom{box-shadow:0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12);outline:1px solid rgba(0,0,0,0);z-index:-1}@media screen and (forced-colors: active){.mdc-tooltip__caret-surface-bottom{outline-color:CanvasText}}.mat-mdc-tooltip .mdc-tooltip__surface{background-color:var(--mdc-plain-tooltip-container-color)}.mat-mdc-tooltip .mdc-tooltip__surface{border-radius:var(--mdc-plain-tooltip-container-shape)}.mat-mdc-tooltip .mdc-tooltip__caret-surface-top,.mat-mdc-tooltip .mdc-tooltip__caret-surface-bottom{border-radius:var(--mdc-plain-tooltip-container-shape)}.mat-mdc-tooltip .mdc-tooltip__surface{color:var(--mdc-plain-tooltip-supporting-text-color)}.mat-mdc-tooltip .mdc-tooltip__surface{font-family:var(--mdc-plain-tooltip-supporting-text-font);line-height:var(--mdc-plain-tooltip-supporting-text-line-height);font-size:var(--mdc-plain-tooltip-supporting-text-size);font-weight:var(--mdc-plain-tooltip-supporting-text-weight);letter-spacing:var(--mdc-plain-tooltip-supporting-text-tracking)}.mat-mdc-tooltip{position:relative;transform:scale(0)}.mat-mdc-tooltip::before{content:"";top:0;right:0;bottom:0;left:0;z-index:-1;position:absolute}.mat-mdc-tooltip-panel-below .mat-mdc-tooltip::before{top:-8px}.mat-mdc-tooltip-panel-above .mat-mdc-tooltip::before{bottom:-8px}.mat-mdc-tooltip-panel-right .mat-mdc-tooltip::before{left:-8px}.mat-mdc-tooltip-panel-left .mat-mdc-tooltip::before{right:-8px}.mat-mdc-tooltip._mat-animation-noopable{animation:none;transform:scale(1)}.mat-mdc-tooltip-panel.mat-mdc-tooltip-panel-non-interactive{pointer-events:none}@keyframes mat-mdc-tooltip-show{0%{opacity:0;transform:scale(0.8)}100%{opacity:1;transform:scale(1)}}@keyframes mat-mdc-tooltip-hide{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(0.8)}}.mat-mdc-tooltip-show{animation:mat-mdc-tooltip-show 150ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-mdc-tooltip-hide{animation:mat-mdc-tooltip-hide 75ms cubic-bezier(0.4, 0, 1, 1) forwards}'],encapsulation:2,changeDetection:0});let a=r;return a})();function $rt(a,r){if(a&1&&(T(0,"mat-option",18),B(1),k()),a&2){let l=r.$implicit;W("value",l),z(),ie(" ",l," ")}}function Yrt(a,r){if(a&1){let l=we();T(0,"mat-form-field",16)(1,"mat-select",17),ct("selectionChange",function(s){Kt(l);let d=gt(2);return Qt(d._changePageSize(s.value))}),Xh(2,$rt,2,2,"mat-option",18,Zh),k()()}if(a&2){let l=gt(2);W("appearance",l._formFieldAppearance)("color",l.color),z(),W("value",l.pageSize)("disabled",l.disabled)("aria-labelledby",l._pageSizeLabelId)("panelClass",l.selectConfig.panelClass||"")("disableOptionCentering",l.selectConfig.disableOptionCentering),z(),Kh(l._displayedPageSizeOptions)}}function Zrt(a,r){if(a&1&&(T(0,"div",19),B(1),k()),a&2){let l=gt(2);z(),Te(l.pageSize)}}function Xrt(a,r){if(a&1&&(T(0,"div",12)(1,"div",13),B(2),k(),ut(3,Yrt,4,7,"mat-form-field",14)(4,Zrt,2,1,"div",15),k()),a&2){let l=gt();z(),ri("id",l._pageSizeLabelId),z(),ie(" ",l._intl.itemsPerPageLabel," "),z(),Xi(3,l._displayedPageSizeOptions.length>1?3:-1),z(),Xi(4,l._displayedPageSizeOptions.length<=1?4:-1)}}function Krt(a,r){if(a&1){let l=we();T(0,"button",20),ct("click",function(){Kt(l);let s=gt();return Qt(s.firstPage())}),Rs(),T(1,"svg",7),dt(2,"path",21),k()()}if(a&2){let l=gt();W("matTooltip",l._intl.firstPageLabel)("matTooltipDisabled",l._previousButtonsDisabled())("matTooltipPosition","above")("disabled",l._previousButtonsDisabled()),ri("aria-label",l._intl.firstPageLabel)}}function Qrt(a,r){if(a&1){let l=we();Rs(),_u(),T(0,"button",22),ct("click",function(){Kt(l);let s=gt();return Qt(s.lastPage())}),Rs(),T(1,"svg",7),dt(2,"path",23),k()()}if(a&2){let l=gt();W("matTooltip",l._intl.lastPageLabel)("matTooltipDisabled",l._nextButtonsDisabled())("matTooltipPosition","above")("disabled",l._nextButtonsDisabled()),ri("aria-label",l._intl.lastPageLabel)}}var Jrt=(()=>{let r=class r{constructor(){this.changes=new pe,this.itemsPerPageLabel="Items per page:",this.nextPageLabel="Next page",this.previousPageLabel="Previous page",this.firstPageLabel="First page",this.lastPageLabel="Last page",this.getRangeLabel=(n,s,d)=>{if(d==0||s==0)return`0 of ${d}`;d=Math.max(d,0);let m=n*s,_=m<d?Math.min(m+s,d):m+s;return`${m+1} \u2013 ${_} of ${d}`}}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var tot=50;var eot=new Se("MAT_PAGINATOR_DEFAULT_OPTIONS"),iot=Ry(class{}),not=0,Ua=(()=>{let r=class r extends iot{get pageIndex(){return this._pageIndex}set pageIndex(n){this._pageIndex=Math.max(n||0,0),this._changeDetectorRef.markForCheck()}get length(){return this._length}set length(n){this._length=n||0,this._changeDetectorRef.markForCheck()}get pageSize(){return this._pageSize}set pageSize(n){this._pageSize=Math.max(n||0,0),this._updateDisplayedPageSizeOptions()}get pageSizeOptions(){return this._pageSizeOptions}set pageSizeOptions(n){this._pageSizeOptions=(n||[]).map(s=>ll(s,0)),this._updateDisplayedPageSizeOptions()}constructor(n,s,d){if(super(),this._intl=n,this._changeDetectorRef=s,this._pageSizeLabelId=`mat-paginator-page-size-label-${not++}`,this._pageIndex=0,this._length=0,this._pageSizeOptions=[],this.hidePageSize=!1,this.showFirstLastButtons=!1,this.selectConfig={},this.disabled=!1,this.page=new ye,this._intlChanges=n.changes.subscribe(()=>this._changeDetectorRef.markForCheck()),d){let{pageSize:m,pageSizeOptions:_,hidePageSize:w,showFirstLastButtons:S}=d;m!=null&&(this._pageSize=m),_!=null&&(this._pageSizeOptions=_),w!=null&&(this.hidePageSize=w),S!=null&&(this.showFirstLastButtons=S)}this._formFieldAppearance=d?.formFieldAppearance||"outline"}ngOnInit(){this._initialized=!0,this._updateDisplayedPageSizeOptions(),this._markInitialized()}ngOnDestroy(){this._intlChanges.unsubscribe()}nextPage(){if(!this.hasNextPage())return;let n=this.pageIndex;this.pageIndex=this.pageIndex+1,this._emitPageEvent(n)}previousPage(){if(!this.hasPreviousPage())return;let n=this.pageIndex;this.pageIndex=this.pageIndex-1,this._emitPageEvent(n)}firstPage(){if(!this.hasPreviousPage())return;let n=this.pageIndex;this.pageIndex=0,this._emitPageEvent(n)}lastPage(){if(!this.hasNextPage())return;let n=this.pageIndex;this.pageIndex=this.getNumberOfPages()-1,this._emitPageEvent(n)}hasPreviousPage(){return this.pageIndex>=1&&this.pageSize!=0}hasNextPage(){let n=this.getNumberOfPages()-1;return this.pageIndex<n&&this.pageSize!=0}getNumberOfPages(){return this.pageSize?Math.ceil(this.length/this.pageSize):0}_changePageSize(n){let s=this.pageIndex*this.pageSize,d=this.pageIndex;this.pageIndex=Math.floor(s/n)||0,this.pageSize=n,this._emitPageEvent(d)}_nextButtonsDisabled(){return this.disabled||!this.hasNextPage()}_previousButtonsDisabled(){return this.disabled||!this.hasPreviousPage()}_updateDisplayedPageSizeOptions(){this._initialized&&(this.pageSize||(this._pageSize=this.pageSizeOptions.length!=0?this.pageSizeOptions[0]:tot),this._displayedPageSizeOptions=this.pageSizeOptions.slice(),this._displayedPageSizeOptions.indexOf(this.pageSize)===-1&&this._displayedPageSizeOptions.push(this.pageSize),this._displayedPageSizeOptions.sort((n,s)=>n-s),this._changeDetectorRef.markForCheck())}_emitPageEvent(n){this.page.emit({previousPageIndex:n,pageIndex:this.pageIndex,pageSize:this.pageSize,length:this.length})}};r.\u0275fac=function(s){return new(s||r)(V(Jrt),V(Zi),V(eot,8))},r.\u0275cmp=St({type:r,selectors:[["mat-paginator"]],hostAttrs:["role","group",1,"mat-mdc-paginator"],inputs:{color:"color",pageIndex:[Rt.HasDecoratorInputTransform,"pageIndex","pageIndex",ll],length:[Rt.HasDecoratorInputTransform,"length","length",ll],pageSize:[Rt.HasDecoratorInputTransform,"pageSize","pageSize",ll],pageSizeOptions:"pageSizeOptions",hidePageSize:[Rt.HasDecoratorInputTransform,"hidePageSize","hidePageSize",Qe],showFirstLastButtons:[Rt.HasDecoratorInputTransform,"showFirstLastButtons","showFirstLastButtons",Qe],selectConfig:"selectConfig",disabled:[Rt.HasDecoratorInputTransform,"disabled","disabled",Qe]},outputs:{page:"page"},exportAs:["matPaginator"],standalone:!0,features:[Fn,Di,At],decls:14,vars:14,consts:[[1,"mat-mdc-paginator-outer-container"],[1,"mat-mdc-paginator-container"],["class","mat-mdc-paginator-page-size"],[1,"mat-mdc-paginator-range-actions"],["aria-live","polite",1,"mat-mdc-paginator-range-label"],["mat-icon-button","","type","button","class","mat-mdc-paginator-navigation-first",3,"matTooltip","matTooltipDisabled","matTooltipPosition","disabled"],["mat-icon-button","","type","button",1,"mat-mdc-paginator-navigation-previous",3,"matTooltip","matTooltipDisabled","matTooltipPosition","disabled","click"],["viewBox","0 0 24 24","focusable","false","aria-hidden","true",1,"mat-mdc-paginator-icon"],["d","M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"],["mat-icon-button","","type","button",1,"mat-mdc-paginator-navigation-next",3,"matTooltip","matTooltipDisabled","matTooltipPosition","disabled","click"],["d","M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"],["mat-icon-button","","type","button","class","mat-mdc-paginator-navigation-last",3,"matTooltip","matTooltipDisabled","matTooltipPosition","disabled"],[1,"mat-mdc-paginator-page-size"],[1,"mat-mdc-paginator-page-size-label"],["class","mat-mdc-paginator-page-size-select",3,"appearance","color"],["class","mat-mdc-paginator-page-size-value"],[1,"mat-mdc-paginator-page-size-select",3,"appearance","color"],["hideSingleSelectionIndicator","",3,"value","disabled","aria-labelledby","panelClass","disableOptionCentering","selectionChange"],[3,"value"],[1,"mat-mdc-paginator-page-size-value"],["mat-icon-button","","type","button",1,"mat-mdc-paginator-navigation-first",3,"matTooltip","matTooltipDisabled","matTooltipPosition","disabled","click"],["d","M18.41 16.59L13.82 12l4.59-4.59L17 6l-6 6 6 6zM6 6h2v12H6z"],["mat-icon-button","","type","button",1,"mat-mdc-paginator-navigation-last",3,"matTooltip","matTooltipDisabled","matTooltipPosition","disabled","click"],["d","M5.59 7.41L10.18 12l-4.59 4.59L7 18l6-6-6-6zM16 6h2v12h-2z"]],template:function(s,d){s&1&&(T(0,"div",0)(1,"div",1),ut(2,Xrt,5,4,"div",2),T(3,"div",3)(4,"div",4),B(5),k(),ut(6,Krt,3,5,"button",5),T(7,"button",6),ct("click",function(){return d.previousPage()}),Rs(),T(8,"svg",7),dt(9,"path",8),k()(),_u(),T(10,"button",9),ct("click",function(){return d.nextPage()}),Rs(),T(11,"svg",7),dt(12,"path",10),k()(),ut(13,Qrt,3,5,"button",11),k()()()),s&2&&(z(2),Xi(2,d.hidePageSize?-1:2),z(3),ie(" ",d._intl.getRangeLabel(d.pageIndex,d.pageSize,d.length)," "),z(),Xi(6,d.showFirstLastButtons?6:-1),z(),W("matTooltip",d._intl.previousPageLabel)("matTooltipDisabled",d._previousButtonsDisabled())("matTooltipPosition","above")("disabled",d._previousButtonsDisabled()),ri("aria-label",d._intl.previousPageLabel),z(3),W("matTooltip",d._intl.nextPageLabel)("matTooltipDisabled",d._nextButtonsDisabled())("matTooltipPosition","above")("disabled",d._nextButtonsDisabled()),ri("aria-label",d._intl.nextPageLabel),z(3),Xi(13,d.showFirstLastButtons?13:-1))},dependencies:[By,l5,Fy,Ac,u5],styles:[".mat-mdc-paginator{display:block;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;color:var(--mat-paginator-container-text-color);background-color:var(--mat-paginator-container-background-color);font-family:var(--mat-paginator-container-text-font);line-height:var(--mat-paginator-container-text-line-height);font-size:var(--mat-paginator-container-text-size);font-weight:var(--mat-paginator-container-text-weight);letter-spacing:var(--mat-paginator-container-text-tracking);--mat-form-field-container-height:var(--mat-paginator-form-field-container-height);--mat-form-field-container-vertical-padding:var(--mat-paginator-form-field-container-vertical-padding)}.mat-mdc-paginator .mat-mdc-select-value{font-size:var(--mat-paginator-select-trigger-text-size)}.mat-mdc-paginator .mat-mdc-form-field-subscript-wrapper{display:none}.mat-mdc-paginator .mat-mdc-select{line-height:1.5}.mat-mdc-paginator-outer-container{display:flex}.mat-mdc-paginator-container{display:flex;align-items:center;justify-content:flex-end;padding:0 8px;flex-wrap:wrap;width:100%;min-height:var(--mat-paginator-container-size)}.mat-mdc-paginator-page-size{display:flex;align-items:baseline;margin-right:8px}[dir=rtl] .mat-mdc-paginator-page-size{margin-right:0;margin-left:8px}.mat-mdc-paginator-page-size-label{margin:0 4px}.mat-mdc-paginator-page-size-select{margin:0 4px;width:84px}.mat-mdc-paginator-range-label{margin:0 32px 0 24px}.mat-mdc-paginator-range-actions{display:flex;align-items:center}.mat-mdc-paginator-icon{display:inline-block;width:28px;fill:var(--mat-paginator-enabled-icon-color)}.mat-mdc-icon-button[disabled] .mat-mdc-paginator-icon{fill:var(--mat-paginator-disabled-icon-color)}[dir=rtl] .mat-mdc-paginator-icon{transform:rotate(180deg)}.cdk-high-contrast-active .mat-mdc-icon-button[disabled] .mat-mdc-paginator-icon,.cdk-high-contrast-active .mat-mdc-paginator-icon{fill:currentColor;fill:CanvasText}.cdk-high-contrast-active .mat-mdc-paginator-range-actions .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0});let a=r;return a})();var rot=["mat-sort-header",""];function oot(a,r){if(a&1){let l=we();T(0,"div",3),ct("@arrowPosition.start",function(){Kt(l);let s=gt();return Qt(s._disableViewStateAnimation=!0)})("@arrowPosition.done",function(){Kt(l);let s=gt();return Qt(s._disableViewStateAnimation=!1)}),dt(1,"div",4),T(2,"div",5),dt(3,"div",6)(4,"div",7)(5,"div",8),k()()}if(a&2){let l=gt();W("@arrowOpacity",l._getArrowViewState())("@arrowPosition",l._getArrowViewState())("@allowChildren",l._getArrowDirectionState()),z(2),W("@indicator",l._getArrowDirectionState()),z(),W("@leftPointer",l._getArrowDirectionState()),z(),W("@rightPointer",l._getArrowDirectionState())}}var sot=["*"];var h5=new Se("MAT_SORT_DEFAULT_OPTIONS"),aot=Ry(class{}),sa=(()=>{let r=class r extends aot{get direction(){return this._direction}set direction(n){this._direction=n}constructor(n){super(),this._defaultOptions=n,this.sortables=new Map,this._stateChanges=new pe,this.start="asc",this._direction="",this.disabled=!1,this.sortChange=new ye}register(n){this.sortables.set(n.id,n)}deregister(n){this.sortables.delete(n.id)}sort(n){this.active!=n.id?(this.active=n.id,this.direction=n.start?n.start:this.start):this.direction=this.getNextSortDirection(n),this.sortChange.emit({active:this.active,direction:this.direction})}getNextSortDirection(n){if(!n)return"";let s=n?.disableClear??this.disableClear??!!this._defaultOptions?.disableClear,d=lot(n.start||this.start,s),m=d.indexOf(this.direction)+1;return m>=d.length&&(m=0),d[m]}ngOnInit(){this._markInitialized()}ngOnChanges(){this._stateChanges.next()}ngOnDestroy(){this._stateChanges.complete()}};r.\u0275fac=function(s){return new(s||r)(V(h5,8))},r.\u0275dir=oe({type:r,selectors:[["","matSort",""]],hostAttrs:[1,"mat-sort"],inputs:{active:[Rt.None,"matSortActive","active"],start:[Rt.None,"matSortStart","start"],direction:[Rt.None,"matSortDirection","direction"],disableClear:[Rt.HasDecoratorInputTransform,"matSortDisableClear","disableClear",Qe],disabled:[Rt.HasDecoratorInputTransform,"matSortDisabled","disabled",Qe]},outputs:{sortChange:"matSortChange"},exportAs:["matSort"],standalone:!0,features:[Fn,Di,Yn]});let a=r;return a})();function lot(a,r){let l=["asc","desc"];return a=="desc"&&l.reverse(),r||l.push(""),l}var zd=Lz.ENTERING+" "+Fz.STANDARD_CURVE,Zm={indicator:wr("indicator",[En("active-asc, asc",hi({transform:"translateY(0px)"})),En("active-desc, desc",hi({transform:"translateY(10px)"})),ln("active-asc <=> active-desc",Sn(zd))]),leftPointer:wr("leftPointer",[En("active-asc, asc",hi({transform:"rotate(-45deg)"})),En("active-desc, desc",hi({transform:"rotate(45deg)"})),ln("active-asc <=> active-desc",Sn(zd))]),rightPointer:wr("rightPointer",[En("active-asc, asc",hi({transform:"rotate(45deg)"})),En("active-desc, desc",hi({transform:"rotate(-45deg)"})),ln("active-asc <=> active-desc",Sn(zd))]),arrowOpacity:wr("arrowOpacity",[En("desc-to-active, asc-to-active, active",hi({opacity:1})),En("desc-to-hint, asc-to-hint, hint",hi({opacity:.54})),En("hint-to-desc, active-to-desc, desc, hint-to-asc, active-to-asc, asc, void",hi({opacity:0})),ln("* => asc, * => desc, * => active, * => hint, * => void",Sn("0ms")),ln("* <=> *",Sn(zd))]),arrowPosition:wr("arrowPosition",[ln("* => desc-to-hint, * => desc-to-active",Sn(zd,fd([hi({transform:"translateY(-25%)"}),hi({transform:"translateY(0)"})]))),ln("* => hint-to-desc, * => active-to-desc",Sn(zd,fd([hi({transform:"translateY(0)"}),hi({transform:"translateY(25%)"})]))),ln("* => asc-to-hint, * => asc-to-active",Sn(zd,fd([hi({transform:"translateY(25%)"}),hi({transform:"translateY(0)"})]))),ln("* => hint-to-asc, * => active-to-asc",Sn(zd,fd([hi({transform:"translateY(0)"}),hi({transform:"translateY(-25%)"})]))),En("desc-to-hint, asc-to-hint, hint, desc-to-active, asc-to-active, active",hi({transform:"translateY(0)"})),En("hint-to-desc, active-to-desc, desc",hi({transform:"translateY(-25%)"})),En("hint-to-asc, active-to-asc, asc",hi({transform:"translateY(25%)"}))]),allowChildren:wr("allowChildren",[ln("* <=> *",[Av("@*",Iv(),{optional:!0})])])},cot=(()=>{let r=class r{constructor(){this.changes=new pe}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var Nd=(()=>{let r=class r{get sortActionDescription(){return this._sortActionDescription}set sortActionDescription(n){this._updateSortActionDescription(n)}constructor(n,s,d,m,_,w,S,I){this._intl=n,this._changeDetectorRef=s,this._sort=d,this._columnDef=m,this._focusMonitor=_,this._elementRef=w,this._ariaDescriber=S,this._showIndicatorHint=!1,this._viewState={},this._arrowDirection="",this._disableViewStateAnimation=!1,this.arrowPosition="after",this.disabled=!1,this._sortActionDescription="Sort",I?.arrowPosition&&(this.arrowPosition=I?.arrowPosition),this._handleStateChanges()}ngOnInit(){!this.id&&this._columnDef&&(this.id=this._columnDef.name),this._updateArrowDirection(),this._setAnimationTransitionState({toState:this._isSorted()?"active":this._arrowDirection}),this._sort.register(this),this._sortButton=this._elementRef.nativeElement.querySelector(".mat-sort-header-container"),this._updateSortActionDescription(this._sortActionDescription)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(n=>{let s=!!n;s!==this._showIndicatorHint&&(this._setIndicatorHintVisible(s),this._changeDetectorRef.markForCheck())})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._sort.deregister(this),this._rerenderSubscription.unsubscribe()}_setIndicatorHintVisible(n){this._isDisabled()&&n||(this._showIndicatorHint=n,this._isSorted()||(this._updateArrowDirection(),this._showIndicatorHint?this._setAnimationTransitionState({fromState:this._arrowDirection,toState:"hint"}):this._setAnimationTransitionState({fromState:"hint",toState:this._arrowDirection})))}_setAnimationTransitionState(n){this._viewState=n||{},this._disableViewStateAnimation&&(this._viewState={toState:n.toState})}_toggleOnInteraction(){this._sort.sort(this),(this._viewState.toState==="hint"||this._viewState.toState==="active")&&(this._disableViewStateAnimation=!0)}_handleClick(){this._isDisabled()||this._sort.sort(this)}_handleKeydown(n){!this._isDisabled()&&(n.keyCode===32||n.keyCode===13)&&(n.preventDefault(),this._toggleOnInteraction())}_isSorted(){return this._sort.active==this.id&&(this._sort.direction==="asc"||this._sort.direction==="desc")}_getArrowDirectionState(){return`${this._isSorted()?"active-":""}${this._arrowDirection}`}_getArrowViewState(){let n=this._viewState.fromState;return(n?`${n}-to-`:"")+this._viewState.toState}_updateArrowDirection(){this._arrowDirection=this._isSorted()?this._sort.direction:this.start||this._sort.start}_isDisabled(){return this._sort.disabled||this.disabled}_getAriaSortAttribute(){return this._isSorted()?this._sort.direction=="asc"?"ascending":"descending":"none"}_renderArrow(){return!this._isDisabled()||this._isSorted()}_updateSortActionDescription(n){this._sortButton&&(this._ariaDescriber?.removeDescription(this._sortButton,this._sortActionDescription),this._ariaDescriber?.describe(this._sortButton,n)),this._sortActionDescription=n}_handleStateChanges(){this._rerenderSubscription=no(this._sort.sortChange,this._sort._stateChanges,this._intl.changes).subscribe(()=>{this._isSorted()&&(this._updateArrowDirection(),(this._viewState.toState==="hint"||this._viewState.toState==="active")&&(this._disableViewStateAnimation=!0),this._setAnimationTransitionState({fromState:this._arrowDirection,toState:"active"}),this._showIndicatorHint=!1),!this._isSorted()&&this._viewState&&this._viewState.toState==="active"&&(this._disableViewStateAnimation=!1,this._setAnimationTransitionState({fromState:"active",toState:this._arrowDirection})),this._changeDetectorRef.markForCheck()})}};r.\u0275fac=function(s){return new(s||r)(V(cot),V(Zi),V(sa,8),V("MAT_SORT_HEADER_COLUMN_DEF",8),V(Bs),V(Ee),V(Iy,8),V(h5,8))},r.\u0275cmp=St({type:r,selectors:[["","mat-sort-header",""]],hostAttrs:[1,"mat-sort-header"],hostVars:3,hostBindings:function(s,d){s&1&&ct("click",function(){return d._handleClick()})("keydown",function(_){return d._handleKeydown(_)})("mouseenter",function(){return d._setIndicatorHintVisible(!0)})("mouseleave",function(){return d._setIndicatorHintVisible(!1)}),s&2&&(ri("aria-sort",d._getAriaSortAttribute()),li("mat-sort-header-disabled",d._isDisabled()))},inputs:{id:[Rt.None,"mat-sort-header","id"],arrowPosition:"arrowPosition",start:"start",disabled:[Rt.HasDecoratorInputTransform,"disabled","disabled",Qe],sortActionDescription:"sortActionDescription",disableClear:[Rt.HasDecoratorInputTransform,"disableClear","disableClear",Qe]},exportAs:["matSortHeader"],standalone:!0,features:[Fn,At],attrs:rot,ngContentSelectors:sot,decls:4,vars:7,consts:[[1,"mat-sort-header-container","mat-focus-indicator"],[1,"mat-sort-header-content"],["class","mat-sort-header-arrow"],[1,"mat-sort-header-arrow"],[1,"mat-sort-header-stem"],[1,"mat-sort-header-indicator"],[1,"mat-sort-header-pointer-left"],[1,"mat-sort-header-pointer-right"],[1,"mat-sort-header-pointer-middle"]],template:function(s,d){s&1&&(Un(),T(0,"div",0)(1,"div",1),Ai(2),k(),ut(3,oot,6,6,"div",2),k()),s&2&&(li("mat-sort-header-sorted",d._isSorted())("mat-sort-header-position-before",d.arrowPosition==="before"),ri("tabindex",d._isDisabled()?null:0)("role",d._isDisabled()?null:"button"),z(3),Xi(3,d._renderArrow()?3:-1))},styles:[".mat-sort-header-container{display:flex;cursor:pointer;align-items:center;letter-spacing:normal;outline:0}[mat-sort-header].cdk-keyboard-focused .mat-sort-header-container,[mat-sort-header].cdk-program-focused .mat-sort-header-container{border-bottom:solid 1px currentColor}.mat-sort-header-disabled .mat-sort-header-container{cursor:default}.mat-sort-header-container::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-sort-header-content{text-align:center;display:flex;align-items:center}.mat-sort-header-position-before{flex-direction:row-reverse}.mat-sort-header-arrow{height:12px;width:12px;min-width:12px;position:relative;display:flex;color:var(--mat-sort-arrow-color);opacity:0}.mat-sort-header-arrow,[dir=rtl] .mat-sort-header-position-before .mat-sort-header-arrow{margin:0 0 0 6px}.mat-sort-header-position-before .mat-sort-header-arrow,[dir=rtl] .mat-sort-header-arrow{margin:0 6px 0 0}.mat-sort-header-stem{background:currentColor;height:10px;width:2px;margin:auto;display:flex;align-items:center}.cdk-high-contrast-active .mat-sort-header-stem{width:0;border-left:solid 2px}.mat-sort-header-indicator{width:100%;height:2px;display:flex;align-items:center;position:absolute;top:0;left:0}.mat-sort-header-pointer-middle{margin:auto;height:2px;width:2px;background:currentColor;transform:rotate(45deg)}.cdk-high-contrast-active .mat-sort-header-pointer-middle{width:0;height:0;border-top:solid 2px;border-left:solid 2px}.mat-sort-header-pointer-left,.mat-sort-header-pointer-right{background:currentColor;width:6px;height:2px;position:absolute;top:0}.cdk-high-contrast-active .mat-sort-header-pointer-left,.cdk-high-contrast-active .mat-sort-header-pointer-right{width:0;height:0;border-left:solid 6px;border-top:solid 2px}.mat-sort-header-pointer-left{transform-origin:right;left:0}.mat-sort-header-pointer-right{transform-origin:left;right:0}"],encapsulation:2,data:{animation:[Zm.indicator,Zm.leftPointer,Zm.rightPointer,Zm.arrowOpacity,Zm.arrowPosition,Zm.allowChildren]},changeDetection:0});let a=r;return a})();var m5=(()=>{let r=class r{transform(n){return typeof n=="object"&&n!==null&&"name"in n?n.name:n}};r.\u0275fac=function(s){return new(s||r)},r.\u0275pipe=vv({name:"locationName",type:r,pure:!0,standalone:!0});let a=r;return a})();function dot(a,r){a&1&&(T(0,"div",30),B(1," First name is required "),k())}function uot(a,r){a&1&&(T(0,"div",30),B(1," Last name is required "),k())}function hot(a,r){a&1&&(T(0,"div",30),B(1," Username is required "),k())}function mot(a,r){a&1&&(T(0,"div",30),B(1," Email is required "),k())}function pot(a,r){a&1&&(T(0,"div",30),B(1," Invalid email format "),k())}function fot(a,r){a&1&&(T(0,"div",30),B(1," Password is required "),k())}function got(a,r){a&1&&(T(0,"div",30),B(1," Password must be at least 6 characters long "),k())}function _ot(a,r){if(a&1&&(T(0,"div")(1,"mdb-form-control",11),dt(2,"input",31,32),T(4,"label",33),B(5,"Password"),k()(),ut(6,fot,2,0,"div",10)(7,got,2,0,"div",10),k()),a&2){let l=gt(),n,s;z(6),W("ngIf",((n=l.registrationForm.get("password"))==null||n.errors==null?null:n.errors.required)&&((n=l.registrationForm.get("password"))==null?null:n.touched)),z(),W("ngIf",((s=l.registrationForm.get("password"))==null||s.errors==null?null:s.errors.minlength)&&((s=l.registrationForm.get("password"))==null?null:s.touched))}}function vot(a,r){a&1&&(T(0,"div",30),B(1," Role is required "),k())}var tT=(()=>{let r=class r{constructor(n,s,d){this.dialogRef=n,this.data=s,this.fb=d,s.title=="Adauga user"?this.registrationForm=this.fb.group({firstName:[this.data.user.firstName,Le.required],lastName:[this.data.user.lastName,Le.required],username:[this.data.user.username,Le.required],email:[this.data.user.email,[Le.required,Le.email]],password:["",[Le.required,Le.minLength(6)]],role:[this.data.user.role,Le.required]}):this.registrationForm=this.fb.group({firstName:[this.data.user.firstName,Le.required],lastName:[this.data.user.lastName,Le.required],username:[this.data.user.username,Le.required],email:[this.data.user.email,[Le.required,Le.email]],role:[this.data.user.role,Le.required]})}onCloseClick(){this.dialogRef.close()}onConfirmClick(){if(this.registrationForm.markAllAsTouched(),this.registrationForm.valid){let n=Pi(qt({},this.registrationForm.value),{id:this.data.user.id});this.dialogRef.close(n)}}};r.\u0275fac=function(s){return new(s||r)(V(er),V(jr),V(Er))},r.\u0275cmp=St({type:r,selectors:[["app-edit-user"]],standalone:!0,features:[At],decls:49,vars:9,consts:[[1,"modal-content"],[1,"modal-header","mb-5"],["id","exampleModalLabel",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body","mb-3"],[3,"formGroup"],[1,"mb-3"],["mdbInput","","type","text","id","firstName","formControlName","firstName",1,"form-control"],["firstName",""],["mdbLabel","","for","firstName",1,"form-label"],["class","text-danger mb-4",4,"ngIf"],[1,"mb-4"],["mdbInput","","type","text","id","lastName","formControlName","lastName","required","",1,"form-control"],["lastName",""],["mdbLabel","","for","lastName",1,"form-label"],["mdbInput","","type","text","id","username","formControlName","username","required","",1,"form-control"],["username",""],["mdbLabel","","for","username",1,"form-label"],["mdbInput","","type","text","id","email","formControlName","email","required","",1,"form-control"],["email",""],["mdbLabel","","for","email",1,"form-label"],[4,"ngIf"],["for","role",1,"form-label"],["id","role","name","role","formControlName","role","required","",1,"form-select"],["value","ADMIN"],["value","USER"],["value","TICKET_VALIDATOR"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary","me-1",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"text-danger","mb-4"],["mdbInput","","type","password","id","password","formControlName","password","required","",1,"form-control"],["password",""],["mdbLabel","","for","password",1,"form-label"]],template:function(s,d){if(s&1&&(T(0,"div",0)(1,"div",1)(2,"h5",2),B(3),k(),T(4,"button",3),ct("click",function(){return d.onCloseClick()}),k()(),T(5,"div",4)(6,"form",5)(7,"mdb-form-control",6),dt(8,"input",7,8),T(10,"label",9),B(11,"First name"),k()(),ut(12,dot,2,0,"div",10),T(13,"mdb-form-control",11),dt(14,"input",12,13),T(16,"label",14),B(17,"Last name"),k()(),ut(18,uot,2,0,"div",10),T(19,"mdb-form-control",11),dt(20,"input",15,16),T(22,"label",17),B(23,"Username"),k()(),ut(24,hot,2,0,"div",10),T(25,"mdb-form-control",11),dt(26,"input",18,19),T(28,"label",20),B(29,"Email address"),k()(),ut(30,mot,2,0,"div",10)(31,pot,2,0,"div",10)(32,_ot,8,2,"div",21),T(33,"div",6)(34,"label",22),B(35,"Role"),k(),T(36,"select",23)(37,"option",24),B(38,"ADMIN"),k(),T(39,"option",25),B(40,"USER"),k(),T(41,"option",26),B(42,"TICKET VALIDATOR"),k()()(),ut(43,vot,2,0,"div",10),k()(),T(44,"div",27)(45,"button",28),ct("click",function(){return d.onCloseClick()}),B(46," Cancel "),k(),T(47,"button",29),ct("click",function(){return d.onConfirmClick()}),B(48,"Save changes"),k()()()),s&2){let m,_,w,S,I,L;z(3),Te(d.data.title),z(3),W("formGroup",d.registrationForm),z(6),W("ngIf",((m=d.registrationForm.get("firstName"))==null?null:m.invalid)&&((m=d.registrationForm.get("firstName"))==null?null:m.touched)),z(6),W("ngIf",((_=d.registrationForm.get("lastName"))==null?null:_.invalid)&&((_=d.registrationForm.get("lastName"))==null?null:_.touched)),z(6),W("ngIf",((w=d.registrationForm.get("username"))==null?null:w.invalid)&&((w=d.registrationForm.get("username"))==null?null:w.touched)),z(6),W("ngIf",((S=d.registrationForm.get("email"))==null||S.errors==null?null:S.errors.required)&&((S=d.registrationForm.get("email"))==null?null:S.touched)),z(),W("ngIf",((I=d.registrationForm.get("email"))==null||I.errors==null?null:I.errors.email)&&((I=d.registrationForm.get("email"))==null?null:I.touched)),z(),W("ngIf",d.data.title==="Adauga user"),z(11),W("ngIf",((L=d.registrationForm.get("role"))==null||L.errors==null?null:L.errors.required)&&((L=d.registrationForm.get("role"))==null?null:L.touched))}},dependencies:[Ni,Sr,Fs,Ls,en,Ca,qi,Cr,Yr,Mn,Hn,hr,Ve,Xr,fo,go,lo],styles:[".modal-content[_ngcontent-%COMP%]{padding:20px}"]});let a=r;return a})();var Bd=(()=>{let r=class r{constructor(n){this.dialogRef=n}onCloseClick(){this.dialogRef.close(!1)}onConfirmClick(){this.dialogRef.close(!0)}};r.\u0275fac=function(s){return new(s||r)(V(er))},r.\u0275cmp=St({type:r,selectors:[["app-delete"]],standalone:!0,features:[At],decls:13,vars:0,consts:[[1,"modal-content"],[1,"modal-header","mb-5"],["id","exampleModalLabel",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body","mb-3"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(s,d){s&1&&(T(0,"div",0)(1,"div",1)(2,"h5",2),B(3,"Delete"),k(),T(4,"button",3),ct("click",function(){return d.onCloseClick()}),k()(),T(5,"div",4)(6,"p"),B(7,"Are you sure you want to delete this item?"),k()(),T(8,"div",5)(9,"button",6),ct("click",function(){return d.onCloseClick()}),B(10," Cancel "),k(),T(11,"button",7),ct("click",function(){return d.onConfirmClick()}),B(12,"Confirm"),k()()())},styles:[".modal-content[_ngcontent-%COMP%]{padding:20px}"]});let a=r;return a})();var yot=(()=>{class a{get name(){return this._name}set name(l){this._name=l}_name;get checked(){return this._checked}set checked(l){this._checked=ao(l)}_checked=!1;get value(){return this._value}set value(l){this._value=l}_value=null;get disabled(){return this._disabled}set disabled(l){this._disabled=ao(l)}_disabled=!1;get isDisabled(){return this._disabled}get isChecked(){return this._checked}get nameAttr(){return this.name}constructor(){}_updateName(l){this._name=l}_updateChecked(l){this._checked=l}_updateDisabledState(l){this._disabled=l}static ngAcceptInputType_checked;static ngAcceptInputType_disabled;static \u0275fac=function(n){return new(n||a)};static \u0275dir=oe({type:a,selectors:[["","mdbRadio",""]],hostVars:3,hostBindings:function(n,s){n&2&&(Os("disabled",s.isDisabled)("checked",s.isChecked),ri("name",s.nameAttr))},inputs:{name:"name",checked:"checked",value:"value",disabled:"disabled"}})}return a})(),bot={provide:wa,useExisting:jo(()=>xot),multi:!0},xot=(()=>{class a{radios;get value(){return this._value}set value(l){this._value=l,this.radios&&this._updateChecked()}_value;get name(){return this._name}set name(l){this._name=l,this.radios&&this._updateNames()}_name;get disabled(){return this._disabled}set disabled(l){this._disabled=l,this.radios&&this._updateDisabled()}_disabled=!1;_destroy$=new pe;onChange=l=>{};onTouched=()=>{};ngAfterContentInit(){this._updateNames(),this._updateDisabled(),this.radios.changes.pipe(ho(this.radios),ro(l=>Oo(Promise.resolve(l))),ni(this._destroy$)).subscribe(()=>this._updateRadiosState())}ngOnDestroy(){this._destroy$.next(),this._destroy$.complete()}_updateRadiosState(){this._updateNames(),this._updateChecked(),this._updateDisabled()}_updateNames(){this.radios.forEach(l=>l._updateName(this.name))}_updateChecked(){this.radios.forEach(l=>{let n=l.value===this._value;l._updateChecked(n)})}_updateDisabled(){this.radios.forEach(l=>l._updateDisabledState(this._disabled))}registerOnChange(l){this.onChange=l}registerOnTouched(l){this.onTouched=l}setDisabledState(l){this._disabled=l,this._updateDisabled()}writeValue(l){this.value=l}static \u0275fac=function(n){return new(n||a)};static \u0275dir=oe({type:a,selectors:[["","mdbRadioGroup",""]],contentQueries:function(n,s,d){if(n&1&&fn(d,yot,5),n&2){let m;se(m=ae())&&(s.radios=m)}},inputs:{value:"value",name:"name",disabled:"disabled"},features:[ji([bot])]})}return a})(),p5=(()=>{class a{static \u0275fac=function(n){return new(n||a)};static \u0275mod=Si({type:a});static \u0275inj=Ei({imports:[zo,Ni]})}return a})();function Ha(a){let r=new FormData;for(let l in a)Array.isArray(a[l])?r.append(l,JSON.stringify(a[l])):r.append(l,a[l]);return r}var f5=(()=>{let r=class r{constructor(n,s,d){this.http=n,this.identityService=s,this.snackBar=d,this.userListSubject=new We({})}setUsersListSubject(n){this.userListSubject.next(n)}getUsersListSubject(){return this.userListSubject}fetchPaginatedUsers(n,s){return Tt(this,null,function*(){try{let d=yield Ne(this.http.get(be+"/users",{params:{page:n.toString(),size:s.toString()},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setUsersListSubject(d)}catch{this.snackBar.open("Failed to fetch users","Close",{duration:3e3})}})}fetchPaginatedUsersFiltered(n,s,d,m){return Tt(this,null,function*(){try{let _=yield Ne(this.http.get(be+"/users/filtered",{params:{page:n.toString(),size:s.toString(),filter:d,search:m},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setUsersListSubject(_)}catch{this.snackBar.open("Failed to fetch users","Close",{duration:3e3})}})}addUser(n,s,d){return Tt(this,null,function*(){try{let m=yield Ne(this.http.post(be+"/users",Ha(n),{params:{page:s.toString(),size:d.toString()},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setUsersListSubject(m)}catch{this.snackBar.open("Failed to add user","Close",{duration:3e3})}})}updateUser(n){return Tt(this,null,function*(){try{let s=yield Ne(this.http.patch(be+"/users",Ha(n),{headers:{Authorization:"Bearer "+this.identityService.getToken()}})),d=this.userListSubject.getValue();d.userPage.content.map(m=>m.id===n.id?n:m),this.setUsersListSubject(d)}catch{this.snackBar.open("Failed to update user","Close",{duration:3e3})}})}deleteUser(n,s,d){return Tt(this,null,function*(){try{let m=yield Ne(this.http.delete(be+`/users/${n}`,{params:{page:s.toString(),size:d.toString()},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setUsersListSubject(m)}catch{this.snackBar.open("Failed to delete user","Close",{duration:3e3})}})}};r.\u0275fac=function(s){return new(s||r)(ht(Hi),ht(oi),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function Cot(a,r){if(a&1){let l=we();T(0,"div",26)(1,"button",27),ct("click",function(){Kt(l);let s=gt();return Qt(s.removeFilter())}),B(2,"Sterge filtrul"),k()()}}function Sot(a,r){if(a&1&&(T(0,"th",30),B(1),k()),a&2){let l=gt().$implicit,n=gt();z(),ie(" ",n.columnMap[l]," ")}}function Eot(a,r){if(a&1&&(T(0,"td",31),B(1),k()),a&2){let l=r.$implicit,n=gt().$implicit;z(),ie(" ",l[n]," ")}}function Mot(a,r){if(a&1&&(br(0,28),ut(1,Sot,2,1,"th",29)(2,Eot,2,1,"td",20),xr()),a&2){let l=r.$implicit;W("matColumnDef",l)}}function Dot(a,r){a&1&&(T(0,"th",32),B(1," Actiuni "),k())}function Tot(a,r){if(a&1){let l=we();T(0,"td",31)(1,"button",33),ct("click",function(){let d=Kt(l).$implicit,m=gt();return Qt(m.rowData=d)}),dt(2,"i",34),k()()}if(a&2){gt();let l=oo(33);z(),W("matMenuTriggerFor",l)}}function Iot(a,r){a&1&&dt(0,"tr",35)}function Aot(a,r){a&1&&dt(0,"tr",36)}var kot=()=>[5,10,20,50],g5=(()=>{let r=class r{constructor(n,s,d,m,_){this.dialog=n,this.snackBar=s,this.manageUsersService=d,this.route=m,this.router=_,this.dataSource=new gs,this.itemsCount=0,this.displayedColumns=["firstName","lastName","username","email","role"],this.searchValue="",this.selectedFilterOption="firstName",this.shouldDisplayRemoveFilterButton=!1,this.pageIndex=0,this.pageSize=5,this.columnMap={firstName:"Prenume",lastName:"Nume",username:"Username",email:"Email",role:"Rol"}}ngOnInit(){this.route.queryParams.subscribe(n=>Tt(this,null,function*(){this.pageIndex=n.page||0,this.pageSize=n.size||5,this.searchValue=n.search||"",this.selectedFilterOption=n.filter||"firstName",this.shouldDisplayRemoveFilterButton=!!(n.filter&&n.search),this.searchValue===""&&this.selectedFilterOption==="firstName"?yield this.fetchUsers():yield this.fetchFilteredUsers(),this.userListSubscription=this.manageUsersService.getUsersListSubject().subscribe({next:s=>{this.dataSource.data=s.userPage.content,this.itemsCount=s.count}})}))}fetchUsers(){return Tt(this,null,function*(){yield this.manageUsersService.fetchPaginatedUsers(this.pageIndex,this.pageSize)})}fetchFilteredUsers(){return Tt(this,null,function*(){yield this.manageUsersService.fetchPaginatedUsersFiltered(this.pageIndex,this.pageSize,this.selectedFilterOption,this.searchValue)})}ngOnDestroy(){this.userListSubscription?.unsubscribe()}ngAfterViewInit(){this.paginator.length=this.itemsCount,this.paginator.pageIndex=this.pageIndex,this.paginator.pageSize=this.pageSize,this.dataSource.sort=this.sort}onPageChange(n){this.router.navigate([],{relativeTo:this.route,queryParams:{page:n.pageIndex,size:n.pageSize},queryParamsHandling:"merge"})}filterData(){this.searchValue!==""&&this.router.navigate([],{relativeTo:this.route,queryParams:{search:this.searchValue,filter:this.selectedFilterOption,page:0,size:this.pageSize},queryParamsHandling:"merge"})}handleDeleteKeyboardEvent(n){n.key==="Enter"&&this.filterData()}removeFilter(){this.router.navigate([],{relativeTo:this.route,queryParams:{filter:null,search:null,page:0,size:this.pageSize},queryParamsHandling:"merge"})}onAddClick(){this.dialog.open(tT,{width:"60%",data:{user:{id:"",firstName:"",lastName:"",username:"",email:"",role:""},title:"Adauga user"}}).afterClosed().subscribe(s=>Tt(this,null,function*(){s&&(yield this.manageUsersService.addUser(s,this.pageIndex,this.pageSize))}))}onEditClick(){this.dialog.open(tT,{width:"60%",data:{user:this.rowData,title:"Modifica user"}}).afterClosed().subscribe(s=>Tt(this,null,function*(){s&&(yield this.manageUsersService.updateUser(s))}))}onDeleteClick(){this.dialog.open(Bd,{width:"30%"}).afterClosed().subscribe(s=>Tt(this,null,function*(){s&&(yield this.manageUsersService.deleteUser(this.rowData.id,this.pageIndex,this.pageSize),this.dataSource.data.length===0&&this.pageIndex>0&&(this.searchValue===""&&this.selectedFilterOption==="firstName"?yield this.router.navigate([],{relativeTo:this.route,queryParams:{page:this.pageIndex-1,size:this.pageSize,search:null,filter:null},queryParamsHandling:"merge"}):yield this.router.navigate([],{relativeTo:this.route,queryParams:{page:this.pageIndex-1,size:this.pageSize,search:this.searchValue,filter:this.selectedFilterOption},queryParamsHandling:"merge"})))}))}};r.\u0275fac=function(s){return new(s||r)(V(Kr),V(Je),V(f5),V(Tn),V(zi))},r.\u0275cmp=St({type:r,selectors:[["app-manage-users"]],viewQuery:function(s,d){if(s&1&&(ze(Ua,5),ze(sa,5)),s&2){let m;se(m=ae())&&(d.paginator=m.first),se(m=ae())&&(d.sort=m.first)}},hostBindings:function(s,d){s&1&&ct("keydown",function(_){return d.handleDeleteKeyboardEvent(_)},!1,sl)},standalone:!0,features:[At],decls:38,vars:15,consts:[[1,"input-group","rounded","pt-2"],["type","search","placeholder","Cauta","aria-label","Search","aria-describedby","search-addon",1,"form-control","rounded",3,"ngModel","ngModelChange"],["id","search-addon",1,"input-group-text","border-0"],["role","button",1,"bg-primary","text-white","fas","fa-search","search-button",3,"click"],[1,"btn","btn-primary","ms-5","me-2",3,"click"],[1,"radio-group","mt-2"],[1,"form-check","form-check-inline"],["type","radio","name","radioGroup","id","firstNameRadio","value","firstName",1,"form-check-input",3,"ngModel","ngModelChange"],["for","firstNameRadio",1,"form-check-label"],["type","radio","name","radioGroup","id","lastNameRadio","value","lastName",1,"form-check-input",3,"ngModel","ngModelChange"],["for","lastNameRadio",1,"form-check-label"],["type","radio","name","radioGroup","id","usernameRadio","value","username",1,"form-check-input",3,"ngModel","ngModelChange"],["for","usernameRadio",1,"form-check-label"],["type","radio","name","radioGroup","id","emailRadio","value","email",1,"form-check-input",3,"ngModel","ngModelChange"],["for","emailRadio",1,"form-check-label"],["class","form-check-inline",4,"ngIf"],["mat-table","","matSort","",3,"dataSource"],[3,"matColumnDef",4,"ngFor","ngForOf"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","","aria-label","Select page",3,"length","pageSize","pageIndex","pageSizeOptions","page"],["contextMenu","matMenu"],["mat-menu-item","",3,"click"],[1,"form-check-inline"],[1,"btn",3,"click"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-button","",3,"matMenuTriggerFor","click"],[1,"fa-solid","fa-pen-to-square"],["mat-header-row",""],["mat-row",""]],template:function(s,d){s&1&&(T(0,"div",0)(1,"input",1),Cn("ngModelChange",function(_){return wn(d.searchValue,_)||(d.searchValue=_),_}),k(),T(2,"span",2)(3,"i",3),ct("click",function(){return d.filterData()}),k(),T(4,"button",4),ct("click",function(){return d.onAddClick()}),B(5," Adauga "),k()()(),T(6,"div",5)(7,"div",6)(8,"input",7),Cn("ngModelChange",function(_){return wn(d.selectedFilterOption,_)||(d.selectedFilterOption=_),_}),k(),T(9,"label",8),B(10,"Prenume"),k()(),T(11,"div",6)(12,"input",9),Cn("ngModelChange",function(_){return wn(d.selectedFilterOption,_)||(d.selectedFilterOption=_),_}),k(),T(13,"label",10),B(14,"Nume"),k()(),T(15,"div",6)(16,"input",11),Cn("ngModelChange",function(_){return wn(d.selectedFilterOption,_)||(d.selectedFilterOption=_),_}),k(),T(17,"label",12),B(18,"Username"),k()(),T(19,"div",6)(20,"input",13),Cn("ngModelChange",function(_){return wn(d.selectedFilterOption,_)||(d.selectedFilterOption=_),_}),k(),T(21,"label",14),B(22,"Email"),k()(),ut(23,Cot,3,0,"div",15),k(),T(24,"table",16),ut(25,Mot,3,1,"ng-container",17),br(26,18),ut(27,Dot,2,0,"th",19)(28,Tot,3,1,"td",20),xr(),ut(29,Iot,1,0,"tr",21)(30,Aot,1,0,"tr",22),k(),T(31,"mat-paginator",23),ct("page",function(_){return d.onPageChange(_)}),k(),T(32,"mat-menu",null,24)(34,"button",25),ct("click",function(){return d.onEditClick()}),B(35," Modifica "),k(),T(36,"button",25),ct("click",function(){return d.onDeleteClick()}),B(37," Sterge "),k()()),s&2&&(z(),xn("ngModel",d.searchValue),z(7),xn("ngModel",d.selectedFilterOption),z(4),xn("ngModel",d.selectedFilterOption),z(4),xn("ngModel",d.selectedFilterOption),z(4),xn("ngModel",d.selectedFilterOption),z(3),W("ngIf",d.shouldDisplayRemoveFilterButton),z(),W("dataSource",d.dataSource),z(),W("ngForOf",d.displayedColumns),z(4),W("matHeaderRowDef",d.displayedColumns.concat("actions")),z(),W("matRowDefColumns",d.displayedColumns.concat("actions")),z(),W("length",d.itemsCount)("pageSize",d.pageSize)("pageIndex",d.pageIndex)("pageSizeOptions",Ln(14,kot)))},dependencies:[ka,Fa,La,Pa,Oa,Ra,Ld,Ua,Ve,pi,sa,Nd,Ba,za,Va,Na,ja,yl,ea,p5,Ni,en,Tc,qi,To],styles:["th[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.search-button[_ngcontent-%COMP%]{margin-left:5px;padding:.5rem 1rem;border-radius:.3rem}.search-button[_ngcontent-%COMP%]:hover{cursor:pointer;box-shadow:2px 4px 5px #0006}.input-group-text[_ngcontent-%COMP%]{padding-left:0}"]});let a=r;return a})();var Rot=["fileInput"];function Pot(a,r){a&1&&(T(0,"div",21),B(1," Name is required "),k())}function Oot(a,r){a&1&&(T(0,"div",21),B(1," Address is required "),k())}function Fot(a,r){if(a&1){let l=we();T(0,"div",22),dt(1,"img",23),T(2,"button",24),ct("click",function(){Kt(l);let s=gt();return Qt(s.removeImage())}),dt(3,"i",25),k()()}if(a&2){let l=gt();z(),W("src",l.imageSrc,Vr)}}function Lot(a,r){a&1&&(T(0,"div",21),B(1," Image is required "),k())}var eT=(()=>{let r=class r{constructor(n,s,d){this.dialogRef=n,this.data=s,this.fb=d,this.imageSrc=null,this.imageFile=null,this.isImageNull=!1,this.registrationForm=this.fb.group({name:[this.data.location.name,Le.required],address:[this.data.location.address,Le.required]})}ngOnInit(){this.imageSrc=this.data.location.imageUrl,this.isImageNull=this.imageSrc===null}onCloseClick(){this.dialogRef.close()}onConfirmClick(){if(this.registrationForm.markAllAsTouched(),this.registrationForm.valid){let n=Pi(qt({},this.registrationForm.value),{id:this.data.location.id,imageUrl:this.imageSrc});this.imageFile===null&&this.imageSrc!==""?this.dialogRef.close(n):this.imageFile!==null?(n=Pi(qt({},n),{image:this.imageFile}),this.dialogRef.close(n)):(this.isImageNull=!0,setTimeout(()=>{this.isImageNull=!1},2e3))}}onFileSelected(n){if(this.imageFile=n.target.files[0],this.imageFile){let s=new FileReader;s.onload=()=>{this.imageSrc=s.result},s.readAsDataURL(this.imageFile)}}removeImage(){this.imageSrc="",this.imageFile=null,this.fileInput.nativeElement.value=""}};r.\u0275fac=function(s){return new(s||r)(V(er),V(jr),V(Er))},r.\u0275cmp=St({type:r,selectors:[["app-add-edit-location"]],viewQuery:function(s,d){if(s&1&&ze(Rot,5),s&2){let m;se(m=ae())&&(d.fileInput=m.first)}},standalone:!0,features:[At],decls:28,vars:6,consts:[[1,"modal-content"],[1,"modal-header","mb-5"],["id","exampleModalLabel",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body","mb-3"],[3,"formGroup"],[1,"mb-3"],["mdbInput","","type","text","id","name","formControlName","name",1,"form-control"],["name",""],["mdbLabel","","for","name",1,"form-label"],["class","text-danger mb-4",4,"ngIf"],[1,"mb-4"],["mdbInput","","type","text","id","address","formControlName","address","required","",1,"form-control"],["address",""],["mdbLabel","","for","address",1,"form-label"],["type","file","id","image","accept",".jpg, .jpeg, .png, .bmp",1,"form-control",3,"change"],["fileInput",""],["class","mt-2 ms-1",4,"ngIf"],[1,"modal-footer","mt-2"],["type","button",1,"btn","btn-secondary","me-1",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"text-danger","mb-4"],[1,"mt-2","ms-1"],["alt","image",1,"img-fluid",2,"max-height","200px","max-width","200px",3,"src"],[1,"btn","btn-tertiary","ms-2",3,"click"],[1,"fa-solid","fa-x"]],template:function(s,d){if(s&1&&(T(0,"div",0)(1,"div",1)(2,"h5",2),B(3),k(),T(4,"button",3),ct("click",function(){return d.onCloseClick()}),k()(),T(5,"div",4)(6,"form",5)(7,"mdb-form-control",6),dt(8,"input",7,8),T(10,"label",9),B(11,"Nume"),k()(),ut(12,Pot,2,0,"div",10),T(13,"mdb-form-control",11),dt(14,"input",12,13),T(16,"label",14),B(17,"Adresa"),k()(),ut(18,Oot,2,0,"div",10),k()(),T(19,"input",15,16),ct("change",function(_){return d.onFileSelected(_)}),k(),ut(21,Fot,4,1,"div",17)(22,Lot,2,0,"div",10),T(23,"div",18)(24,"button",19),ct("click",function(){return d.onCloseClick()}),B(25," Cancel "),k(),T(26,"button",20),ct("click",function(){return d.onConfirmClick()}),B(27,"Save changes"),k()()()),s&2){let m,_;z(3),Te(d.data.title),z(3),W("formGroup",d.registrationForm),z(6),W("ngIf",((m=d.registrationForm.get("name"))==null?null:m.invalid)&&((m=d.registrationForm.get("name"))==null?null:m.touched)),z(6),W("ngIf",((_=d.registrationForm.get("address"))==null?null:_.invalid)&&((_=d.registrationForm.get("address"))==null?null:_.touched)),z(3),W("ngIf",d.imageSrc!==""),z(),W("ngIf",d.isImageNull)}},dependencies:[Xr,fo,go,lo,Ve,Mn,Sr,en,qi,Cr,Yr,Hn,hr],styles:[".modal-content[_ngcontent-%COMP%]{padding:20px}"]});let a=r;return a})();var Xm=(()=>{let r=class r{constructor(n,s,d){this.http=n,this.identityService=s,this.snackBar=d,this.locationListSubject=new We({})}setLocationsListSubject(n){this.locationListSubject.next(n)}getLocationsListSubject(){return this.locationListSubject.asObservable()}fetchPaginatedLocations(n,s){return Tt(this,null,function*(){try{let d=yield Ne(this.http.get(be+"/locations",{params:{page:n.toString(),size:s.toString()},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setLocationsListSubject(d)}catch{this.snackBar.open("Error fetching locations","Close",{duration:3e3})}})}fetchPaginatedLocationsFiltered(n,s,d,m){return Tt(this,null,function*(){try{let _=yield Ne(this.http.get(be+"/locations/filtered",{params:{page:n.toString(),size:s.toString(),filter:d,search:m},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setLocationsListSubject(_)}catch{this.snackBar.open("Error fetching locations","Close",{duration:3e3})}})}addLocation(n,s,d){return Tt(this,null,function*(){try{let m=yield Ne(this.http.post(be+"/locations",Ha(n),{params:{page:s.toString(),size:d.toString()},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setLocationsListSubject(m)}catch{this.snackBar.open("Error adding location","Close",{duration:3e3})}})}editLocation(n){return Tt(this,null,function*(){try{let s=yield Ne(this.http.patch(be+"/locations",Ha(n),{headers:{Authorization:"Bearer "+this.identityService.getToken()}})),d=this.locationListSubject.getValue();d.locationPage.content=d.locationPage.content.map(m=>m.id===n.id?n:m),this.setLocationsListSubject(d)}catch{this.snackBar.open("Error editing location","Close",{duration:3e3})}})}deleteLocation(n,s,d){return Tt(this,null,function*(){try{let m=yield Ne(this.http.delete(be+`/locations/${n}`,{params:{page:s.toString(),size:d.toString()},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setLocationsListSubject(m)}catch{this.snackBar.open("Error deleting location","Close",{duration:3e3})}})}fetchAllLocations(){return Tt(this,null,function*(){return yield Ne(this.http.get(be+"/locations/all",{headers:{Authorization:"Bearer "+this.identityService.getToken()}}))})}};r.\u0275fac=function(s){return new(s||r)(ht(Hi),ht(oi),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function zot(a,r){if(a&1){let l=we();T(0,"div",22)(1,"button",23),ct("click",function(){Kt(l);let s=gt();return Qt(s.removeFilter())}),B(2,"Sterge filtrul"),k()()}}function Not(a,r){if(a&1&&(T(0,"th",26),B(1),k()),a&2){let l=gt().$implicit,n=gt();z(),ie(" ",n.columnMap[l]," ")}}function Bot(a,r){if(a&1&&(T(0,"td",27),B(1),k()),a&2){let l=r.$implicit,n=gt().$implicit;z(),ie(" ",l[n]," ")}}function Vot(a,r){if(a&1&&(br(0,24),ut(1,Not,2,1,"th",25)(2,Bot,2,1,"td",16),xr()),a&2){let l=r.$implicit;W("matColumnDef",l)}}function jot(a,r){a&1&&(T(0,"th",28),B(1," Actiuni "),k())}function Uot(a,r){if(a&1){let l=we();T(0,"td",27)(1,"button",29),ct("click",function(){let d=Kt(l).$implicit,m=gt();return Qt(m.rowData=d)}),dt(2,"i",30),k()()}if(a&2){gt();let l=oo(25);z(),W("matMenuTriggerFor",l)}}function Hot(a,r){a&1&&dt(0,"tr",31)}function Got(a,r){a&1&&dt(0,"tr",32)}var qot=()=>[5,10,20,50],_5=(()=>{let r=class r{constructor(n,s,d,m,_){this.dialog=n,this.snackBar=s,this.manageLocationsService=d,this.route=m,this.router=_,this.dataSource=new gs,this.itemsCount=0,this.displayedColumns=["name","address"],this.searchValue="",this.selectedFilterOption="name",this.shouldDisplayRemoveFilterButton=!1,this.pageIndex=0,this.pageSize=5,this.columnMap={name:"Nume",address:"Adresa"}}ngOnInit(){this.route.queryParams.subscribe(n=>Tt(this,null,function*(){this.pageIndex=n.page||0,this.pageSize=n.size||5,this.searchValue=n.search||"",this.selectedFilterOption=n.filter||"name",this.shouldDisplayRemoveFilterButton=!!(n.filter&&n.search),this.searchValue===""&&this.selectedFilterOption==="name"?yield this.fetchLocations():yield this.fetchFilteredLocations(),this.locationListSubscription=this.manageLocationsService.getLocationsListSubject().subscribe(s=>{s&&(this.dataSource.data=s.locationPage.content,this.itemsCount=s.count)})}))}fetchLocations(){return Tt(this,null,function*(){yield this.manageLocationsService.fetchPaginatedLocations(this.pageIndex,this.pageSize)})}fetchFilteredLocations(){return Tt(this,null,function*(){yield this.manageLocationsService.fetchPaginatedLocationsFiltered(this.pageIndex,this.pageSize,this.selectedFilterOption,this.searchValue)})}ngOnDestroy(){this.locationListSubscription?.unsubscribe()}ngAfterViewInit(){this.paginator.length=this.itemsCount,this.paginator.pageIndex=this.pageIndex,this.paginator.pageSize=this.pageSize,this.dataSource.sort=this.sort}onPageChange(n){this.router.navigate([],{relativeTo:this.route,queryParams:{page:n.pageIndex,size:n.pageSize},queryParamsHandling:"merge"})}filterData(){this.searchValue!==""&&this.router.navigate([],{relativeTo:this.route,queryParams:{search:this.searchValue,filter:this.selectedFilterOption,page:0,size:this.pageSize},queryParamsHandling:"merge"})}handleDeleteKeyboardEvent(n){n.key==="Enter"&&this.filterData()}removeFilter(){this.router.navigate([],{relativeTo:this.route,queryParams:{filter:null,search:null,page:0,size:this.pageSize},queryParamsHandling:"merge"})}onAddClick(){this.dialog.open(eT,{width:"60%",data:{location:{name:"",address:"",imageUrl:""},title:"Adauga locatie"}}).afterClosed().subscribe(s=>Tt(this,null,function*(){s&&(yield this.manageLocationsService.addLocation(s,this.pageIndex,this.pageSize))}))}onEditClick(){this.dialog.open(eT,{width:"60%",data:{location:this.rowData,title:"Modifica locatia"}}).afterClosed().subscribe(s=>Tt(this,null,function*(){s&&(yield this.manageLocationsService.editLocation(s))}))}onDeleteClick(){this.dialog.open(Bd,{width:"30%"}).afterClosed().subscribe(s=>Tt(this,null,function*(){s&&(yield this.manageLocationsService.deleteLocation(this.rowData.id,this.pageIndex,this.pageSize),this.dataSource.data.length===0&&this.pageIndex>0&&(this.searchValue===""&&this.selectedFilterOption==="name"?yield this.router.navigate([],{relativeTo:this.route,queryParams:{page:this.pageIndex-1,size:this.pageSize,search:null,filter:null},queryParamsHandling:"merge"}):yield this.router.navigate([],{relativeTo:this.route,queryParams:{page:this.pageIndex-1,size:this.pageSize,search:this.searchValue,filter:this.selectedFilterOption},queryParamsHandling:"merge"})))}))}};r.\u0275fac=function(s){return new(s||r)(V(Kr),V(Je),V(Xm),V(Tn),V(zi))},r.\u0275cmp=St({type:r,selectors:[["app-manage-locations"]],viewQuery:function(s,d){if(s&1&&(ze(Ua,5),ze(sa,5)),s&2){let m;se(m=ae())&&(d.paginator=m.first),se(m=ae())&&(d.sort=m.first)}},hostBindings:function(s,d){s&1&&ct("keydown",function(_){return d.handleDeleteKeyboardEvent(_)},!1,sl)},standalone:!0,features:[At],decls:30,vars:13,consts:[[1,"input-group","rounded","pt-2"],["type","search","placeholder","Cauta","aria-label","Search","aria-describedby","search-addon",1,"form-control","rounded",3,"ngModel","ngModelChange"],["id","search-addon",1,"input-group-text","border-0"],["role","button",1,"bg-primary","text-white","fas","fa-search","search-button",3,"click"],[1,"btn","btn-primary","ms-5","me-2",3,"click"],[1,"radio-group","mt-2"],[1,"form-check","form-check-inline"],["type","radio","name","radioGroup","id","name","value","name",1,"form-check-input",3,"ngModel","ngModelChange"],["for","name",1,"form-check-label"],["type","radio","name","radioGroup","id","address","value","address",1,"form-check-input",3,"ngModel","ngModelChange"],["for","address",1,"form-check-label"],["class","form-check-inline",4,"ngIf"],["mat-table","","matSort","",3,"dataSource"],[3,"matColumnDef",4,"ngFor","ngForOf"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","","aria-label","Select page",3,"length","pageSize","pageIndex","pageSizeOptions","page"],["contextMenu","matMenu"],["mat-menu-item","",3,"click"],[1,"form-check-inline"],[1,"btn",3,"click"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-button","",3,"matMenuTriggerFor","click"],[1,"fa-solid","fa-pen-to-square"],["mat-header-row",""],["mat-row",""]],template:function(s,d){s&1&&(T(0,"div",0)(1,"input",1),Cn("ngModelChange",function(_){return wn(d.searchValue,_)||(d.searchValue=_),_}),k(),T(2,"span",2)(3,"i",3),ct("click",function(){return d.filterData()}),k(),T(4,"button",4),ct("click",function(){return d.onAddClick()}),B(5," Adauga "),k()()(),T(6,"div",5)(7,"div",6)(8,"input",7),Cn("ngModelChange",function(_){return wn(d.selectedFilterOption,_)||(d.selectedFilterOption=_),_}),k(),T(9,"label",8),B(10,"Nume"),k()(),T(11,"div",6)(12,"input",9),Cn("ngModelChange",function(_){return wn(d.selectedFilterOption,_)||(d.selectedFilterOption=_),_}),k(),T(13,"label",10),B(14,"Adresa"),k()(),ut(15,zot,3,0,"div",11),k(),T(16,"table",12),ut(17,Vot,3,1,"ng-container",13),br(18,14),ut(19,jot,2,0,"th",15)(20,Uot,3,1,"td",16),xr(),ut(21,Hot,1,0,"tr",17)(22,Got,1,0,"tr",18),k(),T(23,"mat-paginator",19),ct("page",function(_){return d.onPageChange(_)}),k(),T(24,"mat-menu",null,20)(26,"button",21),ct("click",function(){return d.onEditClick()}),B(27," Modifica "),k(),T(28,"button",21),ct("click",function(){return d.onDeleteClick()}),B(29," Sterge "),k()()),s&2&&(z(),xn("ngModel",d.searchValue),z(7),xn("ngModel",d.selectedFilterOption),z(4),xn("ngModel",d.selectedFilterOption),z(3),W("ngIf",d.shouldDisplayRemoveFilterButton),z(),W("dataSource",d.dataSource),z(),W("ngForOf",d.displayedColumns),z(4),W("matHeaderRowDef",d.displayedColumns.concat("actions")),z(),W("matRowDefColumns",d.displayedColumns.concat("actions")),z(),W("length",d.itemsCount)("pageSize",d.pageSize)("pageIndex",d.pageIndex)("pageSizeOptions",Ln(12,qot)))},dependencies:[ea,La,Ra,Oa,Fa,Ba,za,ja,yl,Ua,Va,Na,sa,Nd,ka,pi,Mn,en,Tc,qi,Ni,To,Pa,Ld,Ve],styles:["th[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.search-button[_ngcontent-%COMP%]{margin-left:5px;padding:.5rem 1rem;border-radius:.3rem}.search-button[_ngcontent-%COMP%]:hover{cursor:pointer;box-shadow:2px 4px 5px #0006}.input-group-text[_ngcontent-%COMP%]{padding-left:0}"]});let a=r;return a})();function Wot(a,r){a&1&&(T(0,"div",20),B(1," Title is required "),k())}function $ot(a,r){a&1&&(T(0,"div",20),B(1," Price is invalid "),k())}function Yot(a,r){a&1&&(T(0,"div",20),B(1," Quantity is invalid "),k())}var v5=(()=>{let r=class r{constructor(n,s,d){this.dialogRef=n,this.data=s,this.fb=d,this.registrationForm=this.fb.group({name:["",Le.required],price:["",[Le.required,Le.pattern("^[0-9]*$")]],remainingQuantity:["",[Le.required,Le.pattern("^[0-9]*$")]]})}onCloseClick(){this.dialogRef.close()}onConfirmClick(){this.registrationForm.markAllAsTouched(),this.registrationForm.valid&&this.dialogRef.close(this.registrationForm.value)}};r.\u0275fac=function(s){return new(s||r)(V(er),V(jr),V(Er))},r.\u0275cmp=St({type:r,selectors:[["app-add-ticket-type"]],standalone:!0,features:[At],decls:30,vars:4,consts:[[1,"modal-content"],[1,"modal-header","mb-5"],["id","exampleModalLabel",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body","mb-3"],[3,"formGroup"],[1,"mb-3"],["mdbInput","","type","text","id","name","formControlName","name",1,"form-control"],["name",""],["mdbLabel","","for","name",1,"form-label"],["class","text-danger mb-4",4,"ngIf"],["mdbInput","","type","text","id","price","formControlName","price",1,"form-control"],["price",""],["mdbLabel","","for","price",1,"form-label"],["mdbInput","","type","text","id","quantity","formControlName","remainingQuantity",1,"form-control"],["quantity",""],["mdbLabel","","for","quantity",1,"form-label"],[1,"modal-footer","mt-2"],["type","button",1,"btn","btn-secondary","me-1",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"text-danger","mb-4"]],template:function(s,d){if(s&1&&(T(0,"div",0)(1,"div",1)(2,"h5",2),B(3,"Add ticket"),k(),T(4,"button",3),ct("click",function(){return d.onCloseClick()}),k()(),T(5,"div",4)(6,"form",5)(7,"mdb-form-control",6),dt(8,"input",7,8),T(10,"label",9),B(11,"Name"),k()(),ut(12,Wot,2,0,"div",10),T(13,"mdb-form-control",6),dt(14,"input",11,12),T(16,"label",13),B(17,"Price"),k()(),ut(18,$ot,2,0,"div",10),T(19,"mdb-form-control",6),dt(20,"input",14,15),T(22,"label",16),B(23,"Quantity"),k()(),ut(24,Yot,2,0,"div",10),k(),T(25,"div",17)(26,"button",18),ct("click",function(){return d.onCloseClick()}),B(27,"Cancel"),k(),T(28,"button",19),ct("click",function(){return d.onConfirmClick()}),B(29,"Save changes"),k()()()()),s&2){let m,_,w;z(6),W("formGroup",d.registrationForm),z(6),W("ngIf",((m=d.registrationForm.get("name"))==null?null:m.invalid)&&((m=d.registrationForm.get("name"))==null?null:m.touched)),z(6),W("ngIf",((_=d.registrationForm.get("price"))==null?null:_.invalid)&&((_=d.registrationForm.get("price"))==null?null:_.touched)),z(6),W("ngIf",((w=d.registrationForm.get("quantity"))==null?null:w.invalid)&&((w=d.registrationForm.get("quantity"))==null?null:w.touched))}},dependencies:[Mn,Sr,en,qi,Cr,Hn,hr,Xr,fo,go,lo,Ve],styles:[".modal-content[_ngcontent-%COMP%]{padding:20px}"]});let a=r;return a})();var Nb=(()=>{let r=class r{constructor(n,s,d){this.http=n,this.identityService=s,this.snackBar=d,this.artistListSubject=new We({})}setArtistListSubject(n){this.artistListSubject.next(n)}getArtistListSubject(){return this.artistListSubject}fetchPaginatedArtists(n,s){return Tt(this,null,function*(){try{let d=yield Ne(this.http.get(be+"/artists",{params:{page:n.toString(),size:s.toString()},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setArtistListSubject(d)}catch{this.snackBar.open("Failed to fetch artists","Close",{duration:3e3})}})}fetchPaginatedArtistsFiltered(n,s,d,m){return Tt(this,null,function*(){try{let _=yield Ne(this.http.get(be+"/artists/filtered",{params:{page:n.toString(),size:s.toString(),search:d,filter:m},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setArtistListSubject(_)}catch{this.snackBar.open("Failed to fetch artists","Close",{duration:3e3})}})}fetchArtistsWithoutEventGenre(){return Tt(this,null,function*(){try{let n=this.http.get(be+"/artists/without-event-genre");this.setArtistListSubject(n)}catch{this.snackBar.open("Failed to fetch artists","Close",{duration:3e3})}})}addArtist(n,s,d){return Tt(this,null,function*(){try{let m=yield Ne(this.http.post(be+"/artists",Ha(n),{params:{page:s.toString(),size:d.toString()},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setArtistListSubject(m)}catch{this.snackBar.open("Failed to add artist","Close",{duration:3e3})}})}updateArtist(n){return Tt(this,null,function*(){try{let s=yield Ne(this.http.put(be+"/artists",Ha(n),{headers:{Authorization:"Bearer "+this.identityService.getToken()}})),d=this.artistListSubject.value;d.artistPage.content=d.artistPage.content.map(m=>m.id===n.id?n:m),this.setArtistListSubject(d)}catch{this.snackBar.open("Failed to update artist","Close",{duration:3e3})}})}deleteArtist(n,s,d){return Tt(this,null,function*(){try{let m=yield Ne(this.http.delete(be+"/artists/"+n,{params:{page:s.toString(),size:d.toString()},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setArtistListSubject(m)}catch{this.snackBar.open("Failed to delete artist","Close",{duration:3e3})}})}};r.\u0275fac=function(s){return new(s||r)(ht(Hi),ht(oi),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function Zot(a,r){if(a&1&&(T(0,"option",14),B(1),k()),a&2){let l=r.$implicit;W("ngValue",l),z(),Te(l.name)}}function Xot(a,r){a&1&&(T(0,"div",15),B(1," Name is required "),k())}var b5=(()=>{let r=class r{constructor(n,s,d,m){this.dialogRef=n,this.data=s,this.fb=d,this.manageArtistsService=m,this.artistList=[],this.registrationForm=this.fb.group({name:["",Le.required]})}ngOnInit(){return Tt(this,null,function*(){yield this.manageArtistsService.fetchArtistsWithoutEventGenre()})}onCloseClick(){this.dialogRef.close()}onConfirmClick(){this.registrationForm.markAllAsTouched(),this.registrationForm.valid&&this.dialogRef.close(this.registrationForm.value.name)}};r.\u0275fac=function(s){return new(s||r)(V(er),V(jr),V(Er),V(Nb))},r.\u0275cmp=St({type:r,selectors:[["app-add-artist"]],standalone:!0,features:[At],decls:18,vars:3,consts:[[1,"modal-content"],[1,"modal-header","mb-5"],["id","exampleModalLabel",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body","mb-3"],[3,"formGroup"],[1,"mb-3"],["for","name",1,"form-label"],["id","name","name","name","formControlName","name","required","",1,"form-select"],[3,"ngValue",4,"ngFor","ngForOf"],["class","text-danger mb-4",4,"ngIf"],[1,"modal-footer","mt-2"],["type","button",1,"btn","btn-secondary","me-1",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[3,"ngValue"],[1,"text-danger","mb-4"]],template:function(s,d){if(s&1&&(T(0,"div",0)(1,"div",1)(2,"h5",2),B(3,"Add artist"),k(),T(4,"button",3),ct("click",function(){return d.onCloseClick()}),k()(),T(5,"div",4)(6,"form",5)(7,"div",6)(8,"label",7),B(9,"Artist"),k(),T(10,"select",8),ut(11,Zot,2,2,"option",9),k()(),ut(12,Xot,2,0,"div",10),k(),T(13,"div",11)(14,"button",12),ct("click",function(){return d.onCloseClick()}),B(15,"Cancel"),k(),T(16,"button",13),ct("click",function(){return d.onConfirmClick()}),B(17,"Save changes"),k()()()()),s&2){let m;z(6),W("formGroup",d.registrationForm),z(5),W("ngForOf",d.artistList),z(),W("ngIf",((m=d.registrationForm.get("name"))==null||m.errors==null?null:m.errors.required)&&((m=d.registrationForm.get("name"))==null?null:m.touched))}},dependencies:[Ni,Sr,Fs,Ls,Ca,qi,Cr,Yr,pi,Ve,Mn,Hn,hr],styles:[".modal-content[_ngcontent-%COMP%]{padding:20px}"]});let a=r;return a})();var Bb=(()=>{let r=class r{constructor(n,s,d){this.http=n,this.identityService=s,this.snackBar=d,this.eventListSubject=new We({})}setEventsListSubject(n){this.eventListSubject.next(n)}getEventsListSubject(){return this.eventListSubject}fetchPaginatedEvents(n,s){return Tt(this,null,function*(){try{let d=yield Ne(this.http.get(be+"/events",{params:{page:n.toString(),size:s.toString()},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setEventsListSubject(d)}catch{this.snackBar.open("Failed to fetch events","Close",{duration:3e3})}})}fetchPaginatedEventsFiltered(n,s,d,m){return Tt(this,null,function*(){try{let _=yield Ne(this.http.get(be+"/events/filtered",{params:{page:n.toString(),size:s.toString(),filter:d,search:m},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setEventsListSubject(_)}catch{this.snackBar.open("Failed to fetch events","Close",{duration:3e3})}})}addEvent(n,s,d){return Tt(this,null,function*(){try{let m=yield Ne(this.http.post(be+"/events",Ha(n),{params:{page:s.toString(),size:d.toString()},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setEventsListSubject(m)}catch{this.snackBar.open("Failed to add event","Close",{duration:3e3})}})}updateEvent(n){return Tt(this,null,function*(){try{let s=yield Ne(this.http.put(be+"/events",Ha(n),{headers:{Authorization:"Bearer "+this.identityService.getToken()}})),d=this.eventListSubject.getValue();d.eventPage.content=d.eventPage.content.map(m=>m.id===n.id?n:m),this.setEventsListSubject(d)}catch{this.snackBar.open("Failed to update event","Close",{duration:3e3})}})}deleteEvent(n,s,d){return Tt(this,null,function*(){try{let m=yield Ne(this.http.delete(be+`/events/${n}`,{params:{page:s.toString(),size:d.toString()},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setEventsListSubject(m)}catch{this.snackBar.open("Failed to delete event","Close",{duration:3e3})}})}fetchEventById(n){return Tt(this,null,function*(){return yield Ne(this.http.get(be+"/events/"+n,{headers:{Authorization:"Bearer "+this.identityService.getToken()}}))})}fetchAllBroadGenres(){return Tt(this,null,function*(){return yield Ne(this.http.get(be+"/broad-genres",{headers:{Authorization:"Bearer "+this.identityService.getToken()}}))})}};r.\u0275fac=function(s){return new(s||r)(ht(Hi),ht(oi),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var Kot=["fileInput"];function Qot(a,r){a&1&&(T(0,"div",43),B(1," Title is required "),k())}function Jot(a,r){a&1&&(T(0,"div",43),B(1," Date is required "),k())}function tst(a,r){if(a&1&&(T(0,"option",44),B(1),k()),a&2){let l=r.$implicit,n=gt();W("ngValue",l.name)("selected",l.name===(n.event==null?null:n.event.location.name)),z(),ie(" ",l.name," ")}}function est(a,r){a&1&&(T(0,"div",43),B(1," Location is required "),k())}function ist(a,r){if(a&1&&(T(0,"option",44),B(1),k()),a&2){let l=r.$implicit,n=gt();W("ngValue",l.name)("selected",l.name===(n.event==null?null:n.event.broadGenre.name)),z(),ie(" ",l.name," ")}}function nst(a,r){a&1&&(T(0,"div",43),B(1," Genre is required "),k())}function rst(a,r){a&1&&(T(0,"div",43),B(1," Short description is required "),k())}function ost(a,r){a&1&&(T(0,"div",43),B(1," Description is required "),k())}function sst(a,r){if(a&1){let l=we();T(0,"div",45),dt(1,"img",46),T(2,"button",47),ct("click",function(){Kt(l);let s=gt();return Qt(s.removeImage())}),dt(3,"i",48),k()()}if(a&2){let l=gt();z(),W("src",l.imageSrc,Vr)}}function ast(a,r){a&1&&(T(0,"div",43),B(1," Image is required "),k())}function lst(a,r){a&1&&(T(0,"th",49),B(1," Name "),k())}function cst(a,r){if(a&1&&(T(0,"td",50),B(1),k()),a&2){let l=r.$implicit;z(),ie(" ",l.name," ")}}function dst(a,r){a&1&&(T(0,"th",49),B(1," Price "),k())}function ust(a,r){if(a&1&&(T(0,"td",50),B(1),k()),a&2){let l=r.$implicit;z(),ie(" ",l.price," ")}}function hst(a,r){a&1&&(T(0,"th",49),B(1," Quantity "),k())}function mst(a,r){if(a&1&&(T(0,"td",50),B(1),k()),a&2){let l=r.$implicit;z(),ie(" ",l.remainingQuantity," ")}}function pst(a,r){a&1&&(T(0,"th",49),B(1," Action "),k())}function fst(a,r){if(a&1){let l=we();T(0,"td",50)(1,"button",51),ct("click",function(){let d=Kt(l).$implicit,m=gt();return Qt(m.onDeleteTicketTypeClick(d))}),T(2,"mat-icon"),B(3,"delete"),k()()()}}function gst(a,r){a&1&&dt(0,"tr",52)}function _st(a,r){a&1&&dt(0,"tr",53)}function vst(a,r){a&1&&(T(0,"th",49),B(1," Name "),k())}function yst(a,r){if(a&1&&(T(0,"td",50),B(1),k()),a&2){let l=r.$implicit;z(),ie(" ",l.name," ")}}function bst(a,r){a&1&&(T(0,"th",49),B(1," Action "),k())}function xst(a,r){if(a&1){let l=we();T(0,"td",50)(1,"button",51),ct("click",function(){let d=Kt(l).$implicit,m=gt();return Qt(m.onDeleteArtistClick(d))}),T(2,"mat-icon"),B(3,"delete"),k()()()}}function wst(a,r){a&1&&dt(0,"tr",52)}function Cst(a,r){a&1&&dt(0,"tr",53)}var w5=()=>["name","price","remainingQuantity","action"],C5=()=>["name","action"],nT=(()=>{let r=class r{constructor(n,s,d,m,_,w){this.dialogRef=n,this.data=s,this.fb=d,this.manageLocationsService=m,this.manageEventsService=_,this.dialog=w,this.imageSrc=null,this.imageFile=null,this.isImageNull=!1,this.ticketsDataSource=new gs,this.artistsDataSource=new gs}ngOnInit(){return Tt(this,null,function*(){this.registrationForm=this.fb.group({title:["",Le.required],date:["",Le.required],location:["",Le.required],broadGenre:["",Le.required],shortDescription:["",Le.required],description:["",Le.required]}),this.today=new Date().toISOString().split("T")[0],this.locations=yield this.manageLocationsService.fetchAllLocations(),this.broadGenres=yield this.manageEventsService.fetchAllBroadGenres(),this.data.eventId!==void 0&&(this.event=yield this.manageEventsService.fetchEventById(this.data.eventId),this.ticketsDataSource.data=this.event.ticketTypeList,this.artistsDataSource.data=this.event.artistList,this.imageSrc=this.event.imageUrl,this.isImageNull=this.imageSrc===null,this.registrationForm.patchValue({title:this.event.title,date:this.event.date,location:this.event.location.name,broadGenre:this.event.broadGenre,shortDescription:this.event.shortDescription,description:this.event.description}))})}onCloseClick(){this.dialogRef.close()}onConfirmClick(){if(this.registrationForm.markAllAsTouched(),this.registrationForm.valid){let n=Pi(qt({},this.registrationForm.value),{id:this.data.eventId,imageUrl:this.imageSrc,ticketTypesList:this.ticketsDataSource.data.map(s=>({id:s.id,name:s.name,price:s.price,quantity:s.remainingQuantity})),artistIdList:this.artistsDataSource.data.map(s=>s.id)});n.locationId=this.locations.find(s=>s.name===n.location).id,n.broadGenreId=this.broadGenres.find(s=>s.name===n.broadGenre).id,this.imageFile===null&&this.imageSrc!=""?this.dialogRef.close(n):this.imageFile!==null?(n=Pi(qt({},n),{image:this.imageFile}),this.dialogRef.close(n)):(this.isImageNull=!0,setTimeout(()=>{this.isImageNull=!1},2e3))}}onFileSelected(n){if(this.imageFile=n.target.files[0],this.imageFile){let s=new FileReader;s.onload=()=>{this.imageSrc=s.result},s.readAsDataURL(this.imageFile)}}removeImage(){this.imageSrc="",this.imageFile=null,this.fileInput.nativeElement.value=""}onAddTicketTypeClick(){this.dialog.open(v5,{width:"40%",disableClose:!0}).afterClosed().subscribe(s=>{s&&(this.ticketsDataSource.data=[...this.ticketsDataSource.data,s])})}onDeleteTicketTypeClick(n){this.ticketsDataSource.data=this.ticketsDataSource.data.filter(s=>s!==n)}onAddArtistClick(){this.dialog.open(b5).afterClosed().subscribe(s=>{s&&(this.artistsDataSource.data=[...this.artistsDataSource.data,s])})}onDeleteArtistClick(n){this.artistsDataSource.data=this.artistsDataSource.data.filter(s=>s!==n)}};r.\u0275fac=function(s){return new(s||r)(V(er),V(jr),V(Er),V(Xm),V(Bb),V(Kr))},r.\u0275cmp=St({type:r,selectors:[["app-add-edit-event"]],viewQuery:function(s,d){if(s&1&&ze(Kot,5),s&2){let m;se(m=ae())&&(d.fileInput=m.first)}},standalone:!0,features:[At],decls:86,vars:23,consts:[[1,"modal-content"],[1,"modal-header","mb-5"],["id","exampleModalLabel",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body","mb-3"],[3,"formGroup"],[1,"mb-3"],["mdbInput","","type","text","id","title","formControlName","title",1,"form-control"],["title",""],["mdbLabel","","for","title",1,"form-label"],["class","text-danger mb-4",4,"ngIf"],[1,"mb-4"],["mdbInput","","type","date","id","date","formControlName","date","required","",1,"form-control",3,"min"],["date",""],["mdbLabel","","for","date",1,"form-label"],["for","location",1,"form-label"],["id","location","name","location","formControlName","location","required","",1,"form-select"],[3,"ngValue","selected",4,"ngFor","ngForOf"],["for","broadGenre",1,"form-label"],["id","broadGenre","name","broadGenre","formControlName","broadGenre","required","",1,"form-select"],["mdbInput","","type","text","id","shortDescription","formControlName","shortDescription",1,"form-control"],["shortDescription",""],["mdbLabel","","for","shortDescription",1,"form-label"],["mdbInput","","type","text","id","description","formControlName","description",1,"form-control"],["description",""],["mdbLabel","","for","description",1,"form-label"],["type","file","id","image","accept",".jpg, .jpeg, .png, .bmp",1,"form-control",3,"change"],["fileInput",""],["class","mt-2 ms-1",4,"ngIf"],[1,"mt-4"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","price"],["matColumnDef","remainingQuantity"],["matColumnDef","action"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"btn","btn-primary",3,"click"],[1,"modal-footer","mt-2"],["type","button",1,"btn","btn-secondary","me-1",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"text-danger","mb-4"],[3,"ngValue","selected"],[1,"mt-2","ms-1"],["alt","image",1,"img-fluid",2,"max-height","200px","max-width","200px",3,"src"],[1,"btn","btn-tertiary","ms-2",3,"click"],[1,"fa-solid","fa-x"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(s,d){if(s&1&&(T(0,"div",0)(1,"div",1)(2,"h5",2),B(3),k(),T(4,"button",3),ct("click",function(){return d.onCloseClick()}),k()(),T(5,"div",4)(6,"form",5)(7,"mdb-form-control",6),dt(8,"input",7,8),T(10,"label",9),B(11,"Title"),k()(),ut(12,Qot,2,0,"div",10),T(13,"mdb-form-control",11),dt(14,"input",12,13),T(16,"label",14),B(17,"Date"),k()(),ut(18,Jot,2,0,"div",10),T(19,"div",6)(20,"label",15),B(21,"Location"),k(),T(22,"select",16),ut(23,tst,2,3,"option",17),k()(),ut(24,est,2,0,"div",10),T(25,"div",11)(26,"label",18),B(27,"Genre"),k(),T(28,"select",19),ut(29,ist,2,3,"option",17),k()(),ut(30,nst,2,0,"div",10),T(31,"mdb-form-control",6),dt(32,"textarea",20,21),T(34,"label",22),B(35,"Short description"),k()(),ut(36,rst,2,0,"div",10),T(37,"mdb-form-control",6),dt(38,"textarea",23,24),T(40,"label",25),B(41,"Description"),k()(),ut(42,ost,2,0,"div",10),k()(),T(43,"input",26,27),ct("change",function(_){return d.onFileSelected(_)}),k(),ut(45,sst,4,1,"div",28)(46,ast,2,0,"div",10),T(47,"div",29)(48,"h6"),B(49,"Tickets"),k(),T(50,"table",30),br(51,31),ut(52,lst,2,0,"th",32)(53,cst,2,1,"td",33),xr(),br(54,34),ut(55,dst,2,0,"th",32)(56,ust,2,1,"td",33),xr(),br(57,35),ut(58,hst,2,0,"th",32)(59,mst,2,1,"td",33),xr(),br(60,36),ut(61,pst,2,0,"th",32)(62,fst,4,0,"td",33),xr(),ut(63,gst,1,0,"tr",37)(64,_st,1,0,"tr",38),k(),T(65,"button",39),ct("click",function(){return d.onAddTicketTypeClick()}),B(66," Add Ticket "),k()(),T(67,"div",29)(68,"h6"),B(69,"Artisti"),k(),T(70,"table",30),br(71,31),ut(72,vst,2,0,"th",32)(73,yst,2,1,"td",33),xr(),br(74,36),ut(75,bst,2,0,"th",32)(76,xst,4,0,"td",33),xr(),ut(77,wst,1,0,"tr",37)(78,Cst,1,0,"tr",38),k(),T(79,"button",39),ct("click",function(){return d.onAddArtistClick()}),B(80," Adauga Artist "),k()(),T(81,"div",40)(82,"button",41),ct("click",function(){return d.onCloseClick()}),B(83," Cancel "),k(),T(84,"button",42),ct("click",function(){return d.onConfirmClick()}),B(85,"Save changes"),k()()()),s&2){let m,_,w,S,I,L;z(3),Te(d.data.title),z(3),W("formGroup",d.registrationForm),z(6),W("ngIf",((m=d.registrationForm.get("title"))==null?null:m.invalid)&&((m=d.registrationForm.get("title"))==null?null:m.touched)),z(2),W("min",d.today),z(4),W("ngIf",((_=d.registrationForm.get("date"))==null?null:_.invalid)&&((_=d.registrationForm.get("date"))==null?null:_.touched)),z(5),W("ngForOf",d.locations),z(),W("ngIf",((w=d.registrationForm.get("location"))==null||w.errors==null?null:w.errors.required)&&((w=d.registrationForm.get("location"))==null?null:w.touched)),z(5),W("ngForOf",d.broadGenres),z(),W("ngIf",((S=d.registrationForm.get("broadGenre"))==null||S.errors==null?null:S.errors.required)&&((S=d.registrationForm.get("broadGenre"))==null?null:S.touched)),z(6),W("ngIf",((I=d.registrationForm.get("shortDescription"))==null?null:I.invalid)&&((I=d.registrationForm.get("shortDescription"))==null?null:I.touched)),z(6),W("ngIf",((L=d.registrationForm.get("description"))==null?null:L.invalid)&&((L=d.registrationForm.get("description"))==null?null:L.touched)),z(3),W("ngIf",d.imageSrc!==null),z(),W("ngIf",d.isImageNull),z(4),W("dataSource",d.ticketsDataSource),z(13),W("matHeaderRowDef",Ln(19,w5)),z(),W("matRowDefColumns",Ln(20,w5)),z(6),W("dataSource",d.artistsDataSource),z(7),W("matHeaderRowDef",Ln(21,C5)),z(),W("matRowDefColumns",Ln(22,C5))}},dependencies:[Ni,Sr,Fs,Ls,en,Ca,qi,Cr,Yr,Xr,fo,go,lo,Ve,Mn,Hn,hr,pi,ka,Oa,Pa,Fa,La,Ra,Ac,Hy,za,Ba,Va,Na],styles:[".modal-content[_ngcontent-%COMP%]{padding:20px}"]});let a=r;return a})();function Or(a){let r=Object.prototype.toString.call(a);return a instanceof Date||typeof a=="object"&&r==="[object Date]"?new a.constructor(+a):typeof a=="number"||r==="[object Number]"||typeof a=="string"||r==="[object String]"?new Date(a):new Date(NaN)}function Nn(a,r){return a instanceof Date?new a.constructor(r):new Date(r)}function Vb(a,r){let l=Or(a);return isNaN(r)?Nn(a,NaN):(r&&l.setDate(l.getDate()+r),l)}var Sst=Math.pow(10,8)*24*60*60*1e3,rwt=-Sst,jb=6048e5;var S5=6e4,E5=36e5,M5=1e3;var Est=3600;var D5=Est*24,owt=D5*7,Mst=D5*365.2425,Dst=Mst/12,swt=Dst*3;var Tst={};function Jl(){return Tst}function Gs(a,r){let l=Jl(),n=r?.weekStartsOn??r?.locale?.options?.weekStartsOn??l.weekStartsOn??l.locale?.options?.weekStartsOn??0,s=Or(a),d=s.getDay(),m=(d<n?7:0)+d-n;return s.setDate(s.getDate()-m),s.setHours(0,0,0,0),s}function bl(a){return Gs(a,{weekStartsOn:1})}function T5(a){let r=Or(a),l=r.getFullYear(),n=Nn(a,0);n.setFullYear(l+1,0,4),n.setHours(0,0,0,0);let s=bl(n),d=Nn(a,0);d.setFullYear(l,0,4),d.setHours(0,0,0,0);let m=bl(d);return r.getTime()>=s.getTime()?l+1:r.getTime()>=m.getTime()?l:l-1}function Ub(a){let r=Or(a),l=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return l.setUTCFullYear(r.getFullYear()),+a-+l}function I5(a){let r=T5(a),l=Nn(a,0);return l.setFullYear(r,0,4),l.setHours(0,0,0,0),bl(l)}var Ist={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},A5=(a,r,l)=>{let n,s=Ist[a];return typeof s=="string"?n=s:r===1?n=s.one:n=s.other.replace("{{count}}",r.toString()),l?.addSuffix?l.comparison&&l.comparison>0?"in "+n:n+" ago":n};function Hb(a){return(r={})=>{let l=r.width?String(r.width):a.defaultWidth;return a.formats[l]||a.formats[a.defaultWidth]}}var Ast={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},kst={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Rst={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},k5={date:Hb({formats:Ast,defaultWidth:"full"}),time:Hb({formats:kst,defaultWidth:"full"}),dateTime:Hb({formats:Rst,defaultWidth:"full"})};var Pst={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},R5=(a,r,l,n)=>Pst[a];function Km(a){return(r,l)=>{let n=l?.context?String(l.context):"standalone",s;if(n==="formatting"&&a.formattingValues){let m=a.defaultFormattingWidth||a.defaultWidth,_=l?.width?String(l.width):m;s=a.formattingValues[_]||a.formattingValues[m]}else{let m=a.defaultWidth,_=l?.width?String(l.width):a.defaultWidth;s=a.values[_]||a.values[m]}let d=a.argumentCallback?a.argumentCallback(r):r;return s[d]}}var Ost={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Fst={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Lst={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},zst={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Nst={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Bst={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Vst=(a,r)=>{let l=Number(a),n=l%100;if(n>20||n<10)switch(n%10){case 1:return l+"st";case 2:return l+"nd";case 3:return l+"rd"}return l+"th"},P5={ordinalNumber:Vst,era:Km({values:Ost,defaultWidth:"wide"}),quarter:Km({values:Fst,defaultWidth:"wide",argumentCallback:a=>a-1}),month:Km({values:Lst,defaultWidth:"wide"}),day:Km({values:zst,defaultWidth:"wide"}),dayPeriod:Km({values:Nst,defaultWidth:"wide",formattingValues:Bst,defaultFormattingWidth:"wide"})};function Qm(a){return(r,l={})=>{let n=l.width,s=n&&a.matchPatterns[n]||a.matchPatterns[a.defaultMatchWidth],d=r.match(s);if(!d)return null;let m=d[0],_=n&&a.parsePatterns[n]||a.parsePatterns[a.defaultParseWidth],w=Array.isArray(_)?Ust(_,L=>L.test(m)):jst(_,L=>L.test(m)),S;S=a.valueCallback?a.valueCallback(w):w,S=l.valueCallback?l.valueCallback(S):S;let I=r.slice(m.length);return{value:S,rest:I}}}function jst(a,r){for(let l in a)if(Object.prototype.hasOwnProperty.call(a,l)&&r(a[l]))return l}function Ust(a,r){for(let l=0;l<a.length;l++)if(r(a[l]))return l}function O5(a){return(r,l={})=>{let n=r.match(a.matchPattern);if(!n)return null;let s=n[0],d=r.match(a.parsePattern);if(!d)return null;let m=a.valueCallback?a.valueCallback(d[0]):d[0];m=l.valueCallback?l.valueCallback(m):m;let _=r.slice(s.length);return{value:m,rest:_}}}var Hst=/^(\d+)(th|st|nd|rd)?/i,Gst=/\d+/i,qst={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Wst={any:[/^b/i,/^(a|c)/i]},$st={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Yst={any:[/1/i,/2/i,/3/i,/4/i]},Zst={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Xst={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Kst={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Qst={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Jst={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},tat={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},F5={ordinalNumber:O5({matchPattern:Hst,parsePattern:Gst,valueCallback:a=>parseInt(a,10)}),era:Qm({matchPatterns:qst,defaultMatchWidth:"wide",parsePatterns:Wst,defaultParseWidth:"any"}),quarter:Qm({matchPatterns:$st,defaultMatchWidth:"wide",parsePatterns:Yst,defaultParseWidth:"any",valueCallback:a=>a+1}),month:Qm({matchPatterns:Zst,defaultMatchWidth:"wide",parsePatterns:Xst,defaultParseWidth:"any"}),day:Qm({matchPatterns:Kst,defaultMatchWidth:"wide",parsePatterns:Qst,defaultParseWidth:"any"}),dayPeriod:Qm({matchPatterns:Jst,defaultMatchWidth:"any",parsePatterns:tat,defaultParseWidth:"any"})};var rT={code:"en-US",formatDistance:A5,formatLong:k5,formatRelative:R5,localize:P5,match:F5,options:{weekStartsOn:0,firstWeekContainsDate:1}};function L5(a){let r=Or(a),l=+bl(r)-+I5(r);return Math.round(l/jb)+1}function Gb(a,r){let l=Or(a),n=l.getFullYear(),s=Jl(),d=r?.firstWeekContainsDate??r?.locale?.options?.firstWeekContainsDate??s.firstWeekContainsDate??s.locale?.options?.firstWeekContainsDate??1,m=Nn(a,0);m.setFullYear(n+1,0,d),m.setHours(0,0,0,0);let _=Gs(m,r),w=Nn(a,0);w.setFullYear(n,0,d),w.setHours(0,0,0,0);let S=Gs(w,r);return l.getTime()>=_.getTime()?n+1:l.getTime()>=S.getTime()?n:n-1}function z5(a,r){let l=Jl(),n=r?.firstWeekContainsDate??r?.locale?.options?.firstWeekContainsDate??l.firstWeekContainsDate??l.locale?.options?.firstWeekContainsDate??1,s=Gb(a,r),d=Nn(a,0);return d.setFullYear(s,0,n),d.setHours(0,0,0,0),Gs(d,r)}function N5(a,r){let l=Or(a),n=+Gs(l,r)-+z5(l,r);return Math.round(n/jb)+1}var B5=(a,r)=>{switch(a){case"P":return r.date({width:"short"});case"PP":return r.date({width:"medium"});case"PPP":return r.date({width:"long"});case"PPPP":default:return r.date({width:"full"})}},V5=(a,r)=>{switch(a){case"p":return r.time({width:"short"});case"pp":return r.time({width:"medium"});case"ppp":return r.time({width:"long"});case"pppp":default:return r.time({width:"full"})}},eat=(a,r)=>{let l=a.match(/(P+)(p+)?/)||[],n=l[1],s=l[2];if(!s)return B5(a,r);let d;switch(n){case"P":d=r.dateTime({width:"short"});break;case"PP":d=r.dateTime({width:"medium"});break;case"PPP":d=r.dateTime({width:"long"});break;case"PPPP":default:d=r.dateTime({width:"full"});break}return d.replace("{{date}}",B5(n,r)).replace("{{time}}",V5(s,r))},oT={p:V5,P:eat};var iat=/^D+$/,nat=/^Y+$/,rat=["D","DD","YY","YYYY"];function j5(a){return iat.test(a)}function U5(a){return nat.test(a)}function sT(a,r,l){let n=oat(a,r,l);if(console.warn(n),rat.includes(a))throw new RangeError(n)}function oat(a,r,l){let n=a[0]==="Y"?"years":"days of the month";return`Use \`${a.toLowerCase()}\` instead of \`${a}\` (in \`${r}\`) for formatting ${n} to the input \`${l}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}function H5(){return Object.assign({},Jl())}function G5(a){let l=Or(a).getDay();return l===0&&(l=7),l}function q5(a,r){let l=r instanceof Date?Nn(r,0):new r(0);return l.setFullYear(a.getFullYear(),a.getMonth(),a.getDate()),l.setHours(a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()),l}var sat=10,qb=class{subPriority=0;validate(r,l){return!0}},Wb=class extends qb{constructor(r,l,n,s,d){super(),this.value=r,this.validateValue=l,this.setValue=n,this.priority=s,d&&(this.subPriority=d)}validate(r,l){return this.validateValue(r,this.value,l)}set(r,l,n){return this.setValue(r,l,this.value,n)}},$b=class extends qb{priority=sat;subPriority=-1;set(r,l){return l.timestampIsSet?r:Nn(r,q5(r,Date))}};var ti=class{run(r,l,n,s){let d=this.parse(r,l,n,s);return d?{setter:new Wb(d.value,this.validate,this.set,this.priority,this.subPriority),rest:d.rest}:null}validate(r,l,n){return!0}};var Yb=class extends ti{priority=140;parse(r,l,n){switch(l){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"})||n.era(r,{width:"narrow"});case"GGGGG":return n.era(r,{width:"narrow"});case"GGGG":default:return n.era(r,{width:"wide"})||n.era(r,{width:"abbreviated"})||n.era(r,{width:"narrow"})}}set(r,l,n){return l.era=n,r.setFullYear(n,0,1),r.setHours(0,0,0,0),r}incompatibleTokens=["R","u","t","T"]};var Bn={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},Ga={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function pr(a,r){return a&&{value:r(a.value),rest:a.rest}}function Pn(a,r){let l=r.match(a);return l?{value:parseInt(l[0],10),rest:r.slice(l[0].length)}:null}function qa(a,r){let l=r.match(a);if(!l)return null;if(l[0]==="Z")return{value:0,rest:r.slice(1)};let n=l[1]==="+"?1:-1,s=l[2]?parseInt(l[2],10):0,d=l[3]?parseInt(l[3],10):0,m=l[5]?parseInt(l[5],10):0;return{value:n*(s*E5+d*S5+m*M5),rest:r.slice(l[0].length)}}function Zb(a){return Pn(Bn.anyDigitsSigned,a)}function rn(a,r){switch(a){case 1:return Pn(Bn.singleDigit,r);case 2:return Pn(Bn.twoDigits,r);case 3:return Pn(Bn.threeDigits,r);case 4:return Pn(Bn.fourDigits,r);default:return Pn(new RegExp("^\\d{1,"+a+"}"),r)}}function Jm(a,r){switch(a){case 1:return Pn(Bn.singleDigitSigned,r);case 2:return Pn(Bn.twoDigitsSigned,r);case 3:return Pn(Bn.threeDigitsSigned,r);case 4:return Pn(Bn.fourDigitsSigned,r);default:return Pn(new RegExp("^-?\\d{1,"+a+"}"),r)}}function tp(a){switch(a){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function Xb(a,r){let l=r>0,n=l?r:1-r,s;if(n<=50)s=a||100;else{let d=n+50,m=Math.trunc(d/100)*100,_=a>=d%100;s=a+m-(_?100:0)}return l?s:1-s}function Kb(a){return a%400===0||a%4===0&&a%100!==0}var Qb=class extends ti{priority=130;incompatibleTokens=["Y","R","u","w","I","i","e","c","t","T"];parse(r,l,n){let s=d=>({year:d,isTwoDigitYear:l==="yy"});switch(l){case"y":return pr(rn(4,r),s);case"yo":return pr(n.ordinalNumber(r,{unit:"year"}),s);default:return pr(rn(l.length,r),s)}}validate(r,l){return l.isTwoDigitYear||l.year>0}set(r,l,n){let s=r.getFullYear();if(n.isTwoDigitYear){let m=Xb(n.year,s);return r.setFullYear(m,0,1),r.setHours(0,0,0,0),r}let d=!("era"in l)||l.era===1?n.year:1-n.year;return r.setFullYear(d,0,1),r.setHours(0,0,0,0),r}};var Jb=class extends ti{priority=130;parse(r,l,n){let s=d=>({year:d,isTwoDigitYear:l==="YY"});switch(l){case"Y":return pr(rn(4,r),s);case"Yo":return pr(n.ordinalNumber(r,{unit:"year"}),s);default:return pr(rn(l.length,r),s)}}validate(r,l){return l.isTwoDigitYear||l.year>0}set(r,l,n,s){let d=Gb(r,s);if(n.isTwoDigitYear){let _=Xb(n.year,d);return r.setFullYear(_,0,s.firstWeekContainsDate),r.setHours(0,0,0,0),Gs(r,s)}let m=!("era"in l)||l.era===1?n.year:1-n.year;return r.setFullYear(m,0,s.firstWeekContainsDate),r.setHours(0,0,0,0),Gs(r,s)}incompatibleTokens=["y","R","u","Q","q","M","L","I","d","D","i","t","T"]};var tx=class extends ti{priority=130;parse(r,l){return l==="R"?Jm(4,r):Jm(l.length,r)}set(r,l,n){let s=Nn(r,0);return s.setFullYear(n,0,4),s.setHours(0,0,0,0),bl(s)}incompatibleTokens=["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"]};var ex=class extends ti{priority=130;parse(r,l){return l==="u"?Jm(4,r):Jm(l.length,r)}set(r,l,n){return r.setFullYear(n,0,1),r.setHours(0,0,0,0),r}incompatibleTokens=["G","y","Y","R","w","I","i","e","c","t","T"]};var ix=class extends ti{priority=120;parse(r,l,n){switch(l){case"Q":case"QQ":return rn(l.length,r);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"})||n.quarter(r,{width:"narrow",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(r,{width:"wide",context:"formatting"})||n.quarter(r,{width:"abbreviated",context:"formatting"})||n.quarter(r,{width:"narrow",context:"formatting"})}}validate(r,l){return l>=1&&l<=4}set(r,l,n){return r.setMonth((n-1)*3,1),r.setHours(0,0,0,0),r}incompatibleTokens=["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"]};var nx=class extends ti{priority=120;parse(r,l,n){switch(l){case"q":case"qq":return rn(l.length,r);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"})||n.quarter(r,{width:"narrow",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(r,{width:"wide",context:"standalone"})||n.quarter(r,{width:"abbreviated",context:"standalone"})||n.quarter(r,{width:"narrow",context:"standalone"})}}validate(r,l){return l>=1&&l<=4}set(r,l,n){return r.setMonth((n-1)*3,1),r.setHours(0,0,0,0),r}incompatibleTokens=["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"]};var rx=class extends ti{incompatibleTokens=["Y","R","q","Q","L","w","I","D","i","e","c","t","T"];priority=110;parse(r,l,n){let s=d=>d-1;switch(l){case"M":return pr(Pn(Bn.month,r),s);case"MM":return pr(rn(2,r),s);case"Mo":return pr(n.ordinalNumber(r,{unit:"month"}),s);case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"})||n.month(r,{width:"narrow",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(r,{width:"wide",context:"formatting"})||n.month(r,{width:"abbreviated",context:"formatting"})||n.month(r,{width:"narrow",context:"formatting"})}}validate(r,l){return l>=0&&l<=11}set(r,l,n){return r.setMonth(n,1),r.setHours(0,0,0,0),r}};var ox=class extends ti{priority=110;parse(r,l,n){let s=d=>d-1;switch(l){case"L":return pr(Pn(Bn.month,r),s);case"LL":return pr(rn(2,r),s);case"Lo":return pr(n.ordinalNumber(r,{unit:"month"}),s);case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"})||n.month(r,{width:"narrow",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(r,{width:"wide",context:"standalone"})||n.month(r,{width:"abbreviated",context:"standalone"})||n.month(r,{width:"narrow",context:"standalone"})}}validate(r,l){return l>=0&&l<=11}set(r,l,n){return r.setMonth(n,1),r.setHours(0,0,0,0),r}incompatibleTokens=["Y","R","q","Q","M","w","I","D","i","e","c","t","T"]};function W5(a,r,l){let n=Or(a),s=N5(n,l)-r;return n.setDate(n.getDate()-s*7),n}var sx=class extends ti{priority=100;parse(r,l,n){switch(l){case"w":return Pn(Bn.week,r);case"wo":return n.ordinalNumber(r,{unit:"week"});default:return rn(l.length,r)}}validate(r,l){return l>=1&&l<=53}set(r,l,n,s){return Gs(W5(r,n,s),s)}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","i","t","T"]};function $5(a,r){let l=Or(a),n=L5(l)-r;return l.setDate(l.getDate()-n*7),l}var ax=class extends ti{priority=100;parse(r,l,n){switch(l){case"I":return Pn(Bn.week,r);case"Io":return n.ordinalNumber(r,{unit:"week"});default:return rn(l.length,r)}}validate(r,l){return l>=1&&l<=53}set(r,l,n){return bl($5(r,n))}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"]};var aat=[31,28,31,30,31,30,31,31,30,31,30,31],lat=[31,29,31,30,31,30,31,31,30,31,30,31],lx=class extends ti{priority=90;subPriority=1;parse(r,l,n){switch(l){case"d":return Pn(Bn.date,r);case"do":return n.ordinalNumber(r,{unit:"date"});default:return rn(l.length,r)}}validate(r,l){let n=r.getFullYear(),s=Kb(n),d=r.getMonth();return s?l>=1&&l<=lat[d]:l>=1&&l<=aat[d]}set(r,l,n){return r.setDate(n),r.setHours(0,0,0,0),r}incompatibleTokens=["Y","R","q","Q","w","I","D","i","e","c","t","T"]};var cx=class extends ti{priority=90;subpriority=1;parse(r,l,n){switch(l){case"D":case"DD":return Pn(Bn.dayOfYear,r);case"Do":return n.ordinalNumber(r,{unit:"date"});default:return rn(l.length,r)}}validate(r,l){let n=r.getFullYear();return Kb(n)?l>=1&&l<=366:l>=1&&l<=365}set(r,l,n){return r.setMonth(0,n),r.setHours(0,0,0,0),r}incompatibleTokens=["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"]};function ep(a,r,l){let n=Jl(),s=l?.weekStartsOn??l?.locale?.options?.weekStartsOn??n.weekStartsOn??n.locale?.options?.weekStartsOn??0,d=Or(a),m=d.getDay(),w=(r%7+7)%7,S=7-s,I=r<0||r>6?r-(m+S)%7:(w+S)%7-(m+S)%7;return Vb(d,I)}var dx=class extends ti{priority=90;parse(r,l,n){switch(l){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"})||n.day(r,{width:"short",context:"formatting"})||n.day(r,{width:"narrow",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"})||n.day(r,{width:"narrow",context:"formatting"});case"EEEE":default:return n.day(r,{width:"wide",context:"formatting"})||n.day(r,{width:"abbreviated",context:"formatting"})||n.day(r,{width:"short",context:"formatting"})||n.day(r,{width:"narrow",context:"formatting"})}}validate(r,l){return l>=0&&l<=6}set(r,l,n,s){return r=ep(r,n,s),r.setHours(0,0,0,0),r}incompatibleTokens=["D","i","e","c","t","T"]};var ux=class extends ti{priority=90;parse(r,l,n,s){let d=m=>{let _=Math.floor((m-1)/7)*7;return(m+s.weekStartsOn+6)%7+_};switch(l){case"e":case"ee":return pr(rn(l.length,r),d);case"eo":return pr(n.ordinalNumber(r,{unit:"day"}),d);case"eee":return n.day(r,{width:"abbreviated",context:"formatting"})||n.day(r,{width:"short",context:"formatting"})||n.day(r,{width:"narrow",context:"formatting"});case"eeeee":return n.day(r,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(r,{width:"short",context:"formatting"})||n.day(r,{width:"narrow",context:"formatting"});case"eeee":default:return n.day(r,{width:"wide",context:"formatting"})||n.day(r,{width:"abbreviated",context:"formatting"})||n.day(r,{width:"short",context:"formatting"})||n.day(r,{width:"narrow",context:"formatting"})}}validate(r,l){return l>=0&&l<=6}set(r,l,n,s){return r=ep(r,n,s),r.setHours(0,0,0,0),r}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"]};var hx=class extends ti{priority=90;parse(r,l,n,s){let d=m=>{let _=Math.floor((m-1)/7)*7;return(m+s.weekStartsOn+6)%7+_};switch(l){case"c":case"cc":return pr(rn(l.length,r),d);case"co":return pr(n.ordinalNumber(r,{unit:"day"}),d);case"ccc":return n.day(r,{width:"abbreviated",context:"standalone"})||n.day(r,{width:"short",context:"standalone"})||n.day(r,{width:"narrow",context:"standalone"});case"ccccc":return n.day(r,{width:"narrow",context:"standalone"});case"cccccc":return n.day(r,{width:"short",context:"standalone"})||n.day(r,{width:"narrow",context:"standalone"});case"cccc":default:return n.day(r,{width:"wide",context:"standalone"})||n.day(r,{width:"abbreviated",context:"standalone"})||n.day(r,{width:"short",context:"standalone"})||n.day(r,{width:"narrow",context:"standalone"})}}validate(r,l){return l>=0&&l<=6}set(r,l,n,s){return r=ep(r,n,s),r.setHours(0,0,0,0),r}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"]};function Y5(a,r){let l=Or(a),n=G5(l),s=r-n;return Vb(l,s)}var mx=class extends ti{priority=90;parse(r,l,n){let s=d=>d===0?7:d;switch(l){case"i":case"ii":return rn(l.length,r);case"io":return n.ordinalNumber(r,{unit:"day"});case"iii":return pr(n.day(r,{width:"abbreviated",context:"formatting"})||n.day(r,{width:"short",context:"formatting"})||n.day(r,{width:"narrow",context:"formatting"}),s);case"iiiii":return pr(n.day(r,{width:"narrow",context:"formatting"}),s);case"iiiiii":return pr(n.day(r,{width:"short",context:"formatting"})||n.day(r,{width:"narrow",context:"formatting"}),s);case"iiii":default:return pr(n.day(r,{width:"wide",context:"formatting"})||n.day(r,{width:"abbreviated",context:"formatting"})||n.day(r,{width:"short",context:"formatting"})||n.day(r,{width:"narrow",context:"formatting"}),s)}}validate(r,l){return l>=1&&l<=7}set(r,l,n){return r=Y5(r,n),r.setHours(0,0,0,0),r}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"]};var px=class extends ti{priority=80;parse(r,l,n){switch(l){case"a":case"aa":case"aaa":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"})||n.dayPeriod(r,{width:"narrow",context:"formatting"});case"aaaaa":return n.dayPeriod(r,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(r,{width:"wide",context:"formatting"})||n.dayPeriod(r,{width:"abbreviated",context:"formatting"})||n.dayPeriod(r,{width:"narrow",context:"formatting"})}}set(r,l,n){return r.setHours(tp(n),0,0,0),r}incompatibleTokens=["b","B","H","k","t","T"]};var fx=class extends ti{priority=80;parse(r,l,n){switch(l){case"b":case"bb":case"bbb":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"})||n.dayPeriod(r,{width:"narrow",context:"formatting"});case"bbbbb":return n.dayPeriod(r,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(r,{width:"wide",context:"formatting"})||n.dayPeriod(r,{width:"abbreviated",context:"formatting"})||n.dayPeriod(r,{width:"narrow",context:"formatting"})}}set(r,l,n){return r.setHours(tp(n),0,0,0),r}incompatibleTokens=["a","B","H","k","t","T"]};var gx=class extends ti{priority=80;parse(r,l,n){switch(l){case"B":case"BB":case"BBB":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"})||n.dayPeriod(r,{width:"narrow",context:"formatting"});case"BBBBB":return n.dayPeriod(r,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(r,{width:"wide",context:"formatting"})||n.dayPeriod(r,{width:"abbreviated",context:"formatting"})||n.dayPeriod(r,{width:"narrow",context:"formatting"})}}set(r,l,n){return r.setHours(tp(n),0,0,0),r}incompatibleTokens=["a","b","t","T"]};var _x=class extends ti{priority=70;parse(r,l,n){switch(l){case"h":return Pn(Bn.hour12h,r);case"ho":return n.ordinalNumber(r,{unit:"hour"});default:return rn(l.length,r)}}validate(r,l){return l>=1&&l<=12}set(r,l,n){let s=r.getHours()>=12;return s&&n<12?r.setHours(n+12,0,0,0):!s&&n===12?r.setHours(0,0,0,0):r.setHours(n,0,0,0),r}incompatibleTokens=["H","K","k","t","T"]};var vx=class extends ti{priority=70;parse(r,l,n){switch(l){case"H":return Pn(Bn.hour23h,r);case"Ho":return n.ordinalNumber(r,{unit:"hour"});default:return rn(l.length,r)}}validate(r,l){return l>=0&&l<=23}set(r,l,n){return r.setHours(n,0,0,0),r}incompatibleTokens=["a","b","h","K","k","t","T"]};var yx=class extends ti{priority=70;parse(r,l,n){switch(l){case"K":return Pn(Bn.hour11h,r);case"Ko":return n.ordinalNumber(r,{unit:"hour"});default:return rn(l.length,r)}}validate(r,l){return l>=0&&l<=11}set(r,l,n){return r.getHours()>=12&&n<12?r.setHours(n+12,0,0,0):r.setHours(n,0,0,0),r}incompatibleTokens=["h","H","k","t","T"]};var bx=class extends ti{priority=70;parse(r,l,n){switch(l){case"k":return Pn(Bn.hour24h,r);case"ko":return n.ordinalNumber(r,{unit:"hour"});default:return rn(l.length,r)}}validate(r,l){return l>=1&&l<=24}set(r,l,n){let s=n<=24?n%24:n;return r.setHours(s,0,0,0),r}incompatibleTokens=["a","b","h","H","K","t","T"]};var xx=class extends ti{priority=60;parse(r,l,n){switch(l){case"m":return Pn(Bn.minute,r);case"mo":return n.ordinalNumber(r,{unit:"minute"});default:return rn(l.length,r)}}validate(r,l){return l>=0&&l<=59}set(r,l,n){return r.setMinutes(n,0,0),r}incompatibleTokens=["t","T"]};var wx=class extends ti{priority=50;parse(r,l,n){switch(l){case"s":return Pn(Bn.second,r);case"so":return n.ordinalNumber(r,{unit:"second"});default:return rn(l.length,r)}}validate(r,l){return l>=0&&l<=59}set(r,l,n){return r.setSeconds(n,0),r}incompatibleTokens=["t","T"]};var Cx=class extends ti{priority=30;parse(r,l){let n=s=>Math.trunc(s*Math.pow(10,-l.length+3));return pr(rn(l.length,r),n)}set(r,l,n){return r.setMilliseconds(n),r}incompatibleTokens=["t","T"]};var Sx=class extends ti{priority=10;parse(r,l){switch(l){case"X":return qa(Ga.basicOptionalMinutes,r);case"XX":return qa(Ga.basic,r);case"XXXX":return qa(Ga.basicOptionalSeconds,r);case"XXXXX":return qa(Ga.extendedOptionalSeconds,r);case"XXX":default:return qa(Ga.extended,r)}}set(r,l,n){return l.timestampIsSet?r:Nn(r,r.getTime()-Ub(r)-n)}incompatibleTokens=["t","T","x"]};var Ex=class extends ti{priority=10;parse(r,l){switch(l){case"x":return qa(Ga.basicOptionalMinutes,r);case"xx":return qa(Ga.basic,r);case"xxxx":return qa(Ga.basicOptionalSeconds,r);case"xxxxx":return qa(Ga.extendedOptionalSeconds,r);case"xxx":default:return qa(Ga.extended,r)}}set(r,l,n){return l.timestampIsSet?r:Nn(r,r.getTime()-Ub(r)-n)}incompatibleTokens=["t","T","X"]};var Mx=class extends ti{priority=40;parse(r){return Zb(r)}set(r,l,n){return[Nn(r,n*1e3),{timestampIsSet:!0}]}incompatibleTokens="*"};var Dx=class extends ti{priority=20;parse(r){return Zb(r)}set(r,l,n){return[Nn(r,n),{timestampIsSet:!0}]}incompatibleTokens="*"};var Z5={G:new Yb,y:new Qb,Y:new Jb,R:new tx,u:new ex,Q:new ix,q:new nx,M:new rx,L:new ox,w:new sx,I:new ax,d:new lx,D:new cx,E:new dx,e:new ux,c:new hx,i:new mx,a:new px,b:new fx,B:new gx,h:new _x,H:new vx,K:new yx,k:new bx,m:new xx,s:new wx,S:new Cx,X:new Sx,x:new Ex,t:new Mx,T:new Dx};var cat=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,dat=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,uat=/^'([^]*?)'?$/,hat=/''/g,mat=/\S/,pat=/[a-zA-Z]/;function X5(a,r,l,n){let s=H5(),d=n?.locale??s.locale??rT,m=n?.firstWeekContainsDate??n?.locale?.options?.firstWeekContainsDate??s.firstWeekContainsDate??s.locale?.options?.firstWeekContainsDate??1,_=n?.weekStartsOn??n?.locale?.options?.weekStartsOn??s.weekStartsOn??s.locale?.options?.weekStartsOn??0;if(r==="")return a===""?Or(l):Nn(l,NaN);let w={firstWeekContainsDate:m,weekStartsOn:_,locale:d},S=[new $b],I=r.match(dat).map(it=>{let at=it[0];if(at in oT){let mt=oT[at];return mt(it,d.formatLong)}return it}).join("").match(cat),L=[];for(let it of I){!n?.useAdditionalWeekYearTokens&&U5(it)&&sT(it,r,a),!n?.useAdditionalDayOfYearTokens&&j5(it)&&sT(it,r,a);let at=it[0],mt=Z5[at];if(mt){let{incompatibleTokens:Mt}=mt;if(Array.isArray(Mt)){let Pt=L.find(Nt=>Mt.includes(Nt.token)||Nt.token===at);if(Pt)throw new RangeError(`The format string mustn't contain \`${Pt.fullToken}\` and \`${it}\` at the same time`)}else if(mt.incompatibleTokens==="*"&&L.length>0)throw new RangeError(`The format string mustn't contain \`${it}\` and any other token at the same time`);L.push({token:at,fullToken:it});let Lt=mt.run(a,it,d.match,w);if(!Lt)return Nn(l,NaN);S.push(Lt.setter),a=Lt.rest}else{if(at.match(pat))throw new RangeError("Format string contains an unescaped latin alphabet character `"+at+"`");if(it==="''"?it="'":at==="'"&&(it=fat(it)),a.indexOf(it)===0)a=a.slice(it.length);else return Nn(l,NaN)}}if(a.length>0&&mat.test(a))return Nn(l,NaN);let H=S.map(it=>it.priority).sort((it,at)=>at-it).filter((it,at,mt)=>mt.indexOf(it)===at).map(it=>S.filter(at=>at.priority===it).sort((at,mt)=>mt.subPriority-at.subPriority)).map(it=>it[0]),q=Or(l);if(isNaN(q.getTime()))return Nn(l,NaN);let X={};for(let it of H){if(!it.validate(q,w))return Nn(l,NaN);let at=it.set(q,X,w);Array.isArray(at)?(q=at[0],Object.assign(X,at[1])):q=at}return Nn(l,q)}function fat(a){return a.match(uat)[1].replace(hat,"'")}function gat(a,r){if(a&1){let l=we();T(0,"div",24)(1,"button",25),ct("click",function(){Kt(l);let s=gt();return Qt(s.removeFilter())}),B(2,"Sterge filtrul"),k()()}}function _at(a,r){if(a&1&&(T(0,"th",28),B(1),k()),a&2){let l=gt().$implicit,n=gt();z(),ie(" ",n.columnMap[l]," ")}}function vat(a,r){if(a&1&&(T(0,"td",29),B(1),qo(2,"locationName"),k()),a&2){let l=r.$implicit,n=gt().$implicit;z(),ie(" ",ms(2,1,l[n])," ")}}function yat(a,r){if(a&1&&(br(0,26),ut(1,_at,2,1,"th",27)(2,vat,3,3,"td",18),xr()),a&2){let l=r.$implicit;W("matColumnDef",l)}}function bat(a,r){a&1&&(T(0,"th",30),B(1," Actiuni "),k())}function xat(a,r){if(a&1){let l=we();T(0,"td",29)(1,"button",31),ct("click",function(){let d=Kt(l).$implicit,m=gt();return Qt(m.rowData=d)}),dt(2,"i",32),k()()}if(a&2){gt();let l=oo(29);z(),W("matMenuTriggerFor",l)}}function wat(a,r){a&1&&dt(0,"tr",33)}function Cat(a,r){a&1&&dt(0,"tr",34)}var Sat=()=>[5,10,20,50],K5=(()=>{let r=class r{constructor(n,s,d,m){this.dialog=n,this.manageEventsService=s,this.route=d,this.router=m,this.dataSource=new gs,this.itemsCount=0,this.displayedColumns=["title","date","location","broadGenre"],this.searchValue="",this.selectedFilterOption="title",this.shouldDisplayRemoveFilterButton=!1,this.pageIndex=0,this.pageSize=5,this.columnMap={title:"Titlu",date:"Data",location:"Locatie",broadGenre:"Gen"}}ngOnInit(){this.route.queryParams.subscribe(n=>Tt(this,null,function*(){this.pageIndex=n.page||0,this.pageSize=n.size||5,this.searchValue=n.search||"",this.selectedFilterOption=n.filter||"title",this.shouldDisplayRemoveFilterButton=!!(n.filter&&n.search),this.searchValue===""&&this.selectedFilterOption==="title"?yield this.fetchEvents():yield this.fetchFilteredEvents(),this.eventListSubscription=this.manageEventsService.getEventsListSubject().subscribe(s=>{this.dataSource.data=s.eventPage.content,this.itemsCount=s.count})}))}fetchEvents(){return Tt(this,null,function*(){yield this.manageEventsService.fetchPaginatedEvents(this.pageIndex,this.pageSize)})}fetchFilteredEvents(){return Tt(this,null,function*(){yield this.manageEventsService.fetchPaginatedEventsFiltered(this.pageIndex,this.pageSize,this.selectedFilterOption,this.searchValue)})}ngOnDestroy(){this.eventListSubscription?.unsubscribe()}ngAfterViewInit(){this.paginator.length=this.itemsCount,this.paginator.pageIndex=this.pageIndex,this.paginator.pageSize=this.pageSize,this.dataSource.sort=this.sort}onPageChange(n){this.router.navigate([],{relativeTo:this.route,queryParams:{page:n.pageIndex,size:n.pageSize},queryParamsHandling:"merge"})}filterData(){if(this.searchValue!==""){if(this.selectedFilterOption==="date"){let n=["yyyy-MM-dd","dd/MM/yyyy","dd.MM.yyyy","yyyy.MM.dd"];for(let s of n){let d=X5(this.searchValue,s,new Date)}}this.router.navigate([],{relativeTo:this.route,queryParams:{search:this.searchValue,filter:this.selectedFilterOption,page:0,size:this.pageSize},queryParamsHandling:"merge"})}}handleDeleteKeyboardEvent(n){n.key==="Enter"&&this.filterData()}removeFilter(){this.router.navigate([],{relativeTo:this.route,queryParams:{filter:null,search:null,page:0,size:this.pageSize},queryParamsHandling:"merge"})}onAddClick(){this.dialog.open(nT,{height:"80%",width:"60%",data:{title:"Adauga eveniment"},disableClose:!0}).afterClosed().subscribe(s=>Tt(this,null,function*(){s&&(s.ticketTypesList=JSON.stringify(s.ticketTypesList),yield this.manageEventsService.addEvent(s,this.pageIndex,this.pageSize))}))}onEditClick(){this.dialog.open(nT,{height:"80%",width:"60%",data:{eventId:this.rowData.id,title:"Modifica eveniment"},disableClose:!0}).afterClosed().subscribe(s=>Tt(this,null,function*(){s&&(yield this.manageEventsService.updateEvent(s))}))}onDeleteClick(){this.dialog.open(Bd,{width:"30%"}).afterClosed().subscribe(s=>Tt(this,null,function*(){s&&(yield this.manageEventsService.deleteEvent(this.rowData.id,this.pageIndex,this.pageSize),this.dataSource.data.length===0&&this.pageIndex>0&&(this.searchValue===""&&this.selectedFilterOption==="title"?yield this.router.navigate([],{relativeTo:this.route,queryParams:{page:this.pageIndex-1,size:this.pageSize,search:null,filter:null},queryParamsHandling:"merge"}):yield this.router.navigate([],{relativeTo:this.route,queryParams:{page:this.pageIndex-1,size:this.pageSize,search:this.searchValue,filter:this.selectedFilterOption},queryParamsHandling:"merge"})))}))}};r.\u0275fac=function(s){return new(s||r)(V(Kr),V(Bb),V(Tn),V(zi))},r.\u0275cmp=St({type:r,selectors:[["app-manage-events"]],viewQuery:function(s,d){if(s&1&&(ze(Ua,5),ze(sa,5)),s&2){let m;se(m=ae())&&(d.paginator=m.first),se(m=ae())&&(d.sort=m.first)}},hostBindings:function(s,d){s&1&&ct("keydown",function(_){return d.handleDeleteKeyboardEvent(_)},!1,sl)},standalone:!0,features:[At],decls:34,vars:14,consts:[[1,"input-group","rounded","pt-2"],["type","search","placeholder","Cauta","aria-label","Search","aria-describedby","search-addon",1,"form-control","rounded",3,"ngModel","ngModelChange"],["id","search-addon",1,"input-group-text","border-0"],["role","button",1,"bg-primary","text-white","fas","fa-search","search-button",3,"click"],[1,"btn","btn-primary","ms-5","me-2",3,"click"],[1,"radio-group","mt-2"],[1,"form-check","form-check-inline"],["type","radio","name","radioGroup","id","title","value","title",1,"form-check-input",3,"ngModel","ngModelChange"],["for","title",1,"form-check-label"],["type","radio","name","radioGroup","id","date","value","date",1,"form-check-input",3,"ngModel","ngModelChange"],["for","date",1,"form-check-label"],["type","radio","name","radioGroup","id","location","value","location",1,"form-check-input",3,"ngModel","ngModelChange"],["for","location",1,"form-check-label"],["class","form-check-inline",4,"ngIf"],["mat-table","","matSort","",3,"dataSource"],[3,"matColumnDef",4,"ngFor","ngForOf"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","","aria-label","Select page",3,"length","pageSize","pageIndex","pageSizeOptions","page"],["contextMenu","matMenu"],["mat-menu-item","",3,"click"],[1,"form-check-inline"],[1,"btn",3,"click"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-button","",3,"matMenuTriggerFor","click"],[1,"fa-solid","fa-pen-to-square"],["mat-header-row",""],["mat-row",""]],template:function(s,d){s&1&&(T(0,"div",0)(1,"input",1),Cn("ngModelChange",function(_){return wn(d.searchValue,_)||(d.searchValue=_),_}),k(),T(2,"span",2)(3,"i",3),ct("click",function(){return d.filterData()}),k(),T(4,"button",4),ct("click",function(){return d.onAddClick()}),B(5," Adauga "),k()()(),T(6,"div",5)(7,"div",6)(8,"input",7),Cn("ngModelChange",function(_){return wn(d.selectedFilterOption,_)||(d.selectedFilterOption=_),_}),k(),T(9,"label",8),B(10,"Titlu"),k()(),T(11,"div",6)(12,"input",9),Cn("ngModelChange",function(_){return wn(d.selectedFilterOption,_)||(d.selectedFilterOption=_),_}),k(),T(13,"label",10),B(14,"Data"),k()(),T(15,"div",6)(16,"input",11),Cn("ngModelChange",function(_){return wn(d.selectedFilterOption,_)||(d.selectedFilterOption=_),_}),k(),T(17,"label",12),B(18,"Locatie"),k()(),ut(19,gat,3,0,"div",13),k(),T(20,"table",14),ut(21,yat,3,1,"ng-container",15),br(22,16),ut(23,bat,2,0,"th",17)(24,xat,3,1,"td",18),xr(),ut(25,wat,1,0,"tr",19)(26,Cat,1,0,"tr",20),k(),T(27,"mat-paginator",21),ct("page",function(_){return d.onPageChange(_)}),k(),T(28,"mat-menu",null,22)(30,"button",23),ct("click",function(){return d.onEditClick()}),B(31," Modifica "),k(),T(32,"button",23),ct("click",function(){return d.onDeleteClick()}),B(33," Sterge "),k()()),s&2&&(z(),xn("ngModel",d.searchValue),z(7),xn("ngModel",d.selectedFilterOption),z(4),xn("ngModel",d.selectedFilterOption),z(4),xn("ngModel",d.selectedFilterOption),z(3),W("ngIf",d.shouldDisplayRemoveFilterButton),z(),W("dataSource",d.dataSource),z(),W("ngForOf",d.displayedColumns),z(4),W("matHeaderRowDef",d.displayedColumns.concat("actions")),z(),W("matRowDefColumns",d.displayedColumns.concat("actions")),z(),W("length",d.itemsCount)("pageSize",d.pageSize)("pageIndex",d.pageIndex)("pageSizeOptions",Ln(13,Sat)))},dependencies:[Ni,en,Tc,qi,To,ea,La,Ra,Oa,Fa,Ba,za,ja,yl,Ua,Va,Na,sa,Nd,ka,pi,Pa,Ld,m5,Ve],styles:["th[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.search-button[_ngcontent-%COMP%]{margin-left:5px;padding:.5rem 1rem;border-radius:.3rem}.search-button[_ngcontent-%COMP%]:hover{cursor:pointer;box-shadow:2px 4px 5px #0006}.input-group-text[_ngcontent-%COMP%]{padding-left:0}"]});let a=r;return a})();var Q5=(()=>{let r=class r{constructor(n,s,d){this.http=n,this.identityService=s,this.snackBar=d,this.orderSubject=new We({})}setOrderSubject(n){this.orderSubject.next(n)}getOrderSubject(){return this.orderSubject.asObservable()}fetchOrders(){return Tt(this,null,function*(){try{let n=yield Ne(this.http.get(be+"/orders",{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setOrderSubject(n)}catch{this.snackBar.open("Error fetching orders","Close",{duration:3e3})}})}fetchOrderByNumber(n){return Tt(this,null,function*(){try{return yield Ne(this.http.get(be+"/orders/"+n,{headers:{Authorization:"Bearer "+this.identityService.getToken()}}))}catch{this.snackBar.open("Error fetching order","Close",{duration:3e3});return}})}fetchOrdersByUserId(n){return Tt(this,null,function*(){try{return yield Ne(this.http.get(be+"/orders/user/"+n,{headers:{Authorization:"Bearer "+this.identityService.getToken()}}))}catch{this.snackBar.open("Error fetching orders","Close",{duration:3e3});return}})}cancelOrder(n){return Tt(this,null,function*(){try{return yield Ne(this.http.put(be+"/orders/"+n.orderNumber+"/admin/cancel",null,{headers:{Authorization:"Bearer "+this.identityService.getToken()}})),n.status="CANCELED",n.ticketList.forEach(s=>{s.status="CANCELED"}),n}catch{this.snackBar.open("Error canceling order","Close",{duration:3e3})}})}cancelTicket(n){return Tt(this,null,function*(){try{return yield Ne(this.http.put(be+"/tickets/"+n.id+"/admin/cancel",null,{headers:{Authorization:"Bearer "+this.identityService.getToken()}})),n.status="CANCELED",n}catch{this.snackBar.open("Error canceling ticket","Close",{duration:3e3})}})}};r.\u0275fac=function(s){return new(s||r)(ht(Hi),ht(oi),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function Mat(a,r){if(a&1){let l=we();T(0,"button",18),ct("click",function(){Kt(l);let s=gt().$implicit,d=gt(2);return Qt(d.cancelTicket(s))}),B(1,"Anuleaza"),k()}}function Dat(a,r){if(a&1&&(T(0,"div",17)(1,"div",11)(2,"h5",12),B(3),k(),T(4,"p",14),B(5),k(),T(6,"p",14),B(7),k(),T(8,"p",14),B(9),k(),T(10,"p",14),B(11),k(),ut(12,Mat,2,0,"button",16),k()()),a&2){let l=r.$implicit;z(3),ie("Eveniment: ",l.ticketType.event.title,""),z(2),ie("Data: ",l.ticketType.event.date,""),z(2),ie("Categoria: ",l.ticketType.name,""),z(2),ie("Pret: ",l.ticketType.price,""),z(2),ie("Status: ",l.status,""),z(),W("ngIf",l.status==="CONFIRMED")}}function Tat(a,r){if(a&1){let l=we();T(0,"button",18),ct("click",function(){Kt(l);let s=gt().$implicit,d=gt();return Qt(d.cancelOrder(s))}),B(1,"Anuleaza comanda"),k()}}function Iat(a,r){if(a&1&&(T(0,"div",10)(1,"div",11)(2,"h5",12),B(3),k()(),T(4,"div",13)(5,"p",14),B(6),k(),T(7,"p",14),B(8),k(),T(9,"p",14),B(10),k(),T(11,"p",14),B(12),k(),T(13,"div")(14,"h3"),B(15,"Tickets"),k(),ut(16,Dat,13,6,"div",15),k()(),ut(17,Tat,2,0,"button",16),k()),a&2){let l=r.$implicit;z(3),ie("Comanda numarul ",l.orderNumber,""),z(3),ie("Id-ul utilizatorului: ",l.user.id,""),z(2),ie("Data comenzii: ",l.createdAt,""),z(2),ie("Status: ",l.status,""),z(2),ie("Total: ",l.price,""),z(4),W("ngForOf",l.ticketList),z(),W("ngIf",l.status==="CONFIRMED")}}var J5=(()=>{let r=class r{constructor(n){this.manageOrdersService=n,this.orderNumber="",this.userId=""}ngOnInit(){this.orders=[]}ngOnDestroy(){}handleNullEvent(n){if(n.ticketList!=null)return n.ticketList.forEach(s=>{s.ticketType.event==null&&(s.ticketType.event={title:"Evenimentul a fost sters"})}),n}fetchOrderByNumber(){return Tt(this,null,function*(){this.orderNumber!==""&&(this.orders=[],this.orders.push(this.handleNullEvent(yield this.manageOrdersService.fetchOrderByNumber(this.orderNumber))))})}fetchOrderByUserId(){return Tt(this,null,function*(){if(this.userId==="")return;this.orders=[];let n=yield this.manageOrdersService.fetchOrdersByUserId(this.userId);n&&(this.orders=n.map(s=>this.handleNullEvent(s)))})}cancelOrder(n){return Tt(this,null,function*(){n=yield this.manageOrdersService.cancelOrder(n)})}cancelTicket(n){return Tt(this,null,function*(){n=yield this.manageOrdersService.cancelTicket(n)})}};r.\u0275fac=function(s){return new(s||r)(V(Q5))},r.\u0275cmp=St({type:r,selectors:[["app-manage-orders"]],standalone:!0,features:[At],decls:13,vars:3,consts:[[1,"container-fluid"],[1,"input-group","rounded","pt-2"],["type","search","placeholder","Cauta numarul comenzii","aria-label","Search","aria-describedby","search-addon",1,"form-control","rounded",3,"ngModel","ngModelChange"],["id","search-order",1,"input-group-text","border-0","spacer"],["type","button","data-mdb-ripple-init","",1,"btn","btn-primary","btn-search",3,"click"],[1,"fas","fa-search"],[1,"input-group","rounded","pt-2","mt-4"],["type","search","placeholder","Cauta id-ul utilizatorului","aria-label","Search","aria-describedby","search-addon",1,"form-control","rounded",3,"ngModel","ngModelChange"],["id","search-user",1,"input-group-text","border-0","spacer"],["class","card mt-3",4,"ngFor","ngForOf"],[1,"card","mt-3"],[1,"card-header"],[1,"card-title"],[1,"card-body"],[1,"card-text"],["class","card ticket-card mt-1 mb-3",4,"ngFor","ngForOf"],["class","btn btn-danger",3,"click",4,"ngIf"],[1,"card","ticket-card","mt-1","mb-3"],[1,"btn","btn-danger",3,"click"]],template:function(s,d){s&1&&(T(0,"div",0)(1,"div",1)(2,"input",2),Cn("ngModelChange",function(_){return wn(d.orderNumber,_)||(d.orderNumber=_),_}),k(),T(3,"span",3)(4,"button",4),ct("click",function(){return d.fetchOrderByNumber()}),dt(5,"i",5),k()()(),T(6,"div",6)(7,"input",7),Cn("ngModelChange",function(_){return wn(d.userId,_)||(d.userId=_),_}),k(),T(8,"span",8)(9,"button",4),ct("click",function(){return d.fetchOrderByUserId()}),dt(10,"i",5),k()()(),T(11,"div"),ut(12,Iat,18,7,"div",9),k()()),s&2&&(z(2),xn("ngModel",d.orderNumber),z(5),xn("ngModel",d.userId),z(5),W("ngForOf",d.orders))},dependencies:[Ni,en,qi,To,pi,Ve],styles:[".spacer[_ngcontent-%COMP%]{padding-left:0}.btn-search[_ngcontent-%COMP%]{height:36px;border-radius:0 10px 10px 0}"]});let a=r;return a})();var tV=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=St({type:r,selectors:[["app-page-not-found"]],standalone:!0,features:[At],decls:5,vars:0,template:function(s,d){s&1&&(T(0,"div")(1,"h1"),B(2,"Error 404"),k(),T(3,"p"),B(4,"Page not found"),k()())}});let a=r;return a})();var Gg=(()=>{let r=class r{constructor(n,s){this.router=n,this.identityService=s}canActivate(n,s){if(this.identityService.isLoggedIn()){if(this.identityService.isAdmin())return this.router.navigate(["admin-dashboard"]),!1;if(this.identityService.isValidator())return this.router.navigate(["validator-dashboard"]),!1}else return this.router.navigate([""]),!1;return!0}};r.\u0275fac=function(s){return new(s||r)(ht(zi),ht(oi))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var Aat=["dropdownTemplate"],kat=["mdbDropdown",""];function Rat(a,r){if(a&1){let l=we();T(0,"div"),ct("@fade.done",function(s){Kt(l);let d=gt();return Qt(d.onAnimationEnd(s))}),Ai(1,2),k()}if(a&2){let l=gt();W("@fade",l._animationState)("@.disabled",!l.animation)}}var Pat=["*",[["",8,"dropdown-toggle"]],[["",8,"dropdown-menu"]]],Oat=["*",".dropdown-toggle",".dropdown-menu"],aT=(()=>{class a{constructor(){}static \u0275fac=function(n){return new(n||a)};static \u0275dir=oe({type:a,selectors:[["","mdbDropdownToggle",""]],exportAs:["mdbDropdownToggle"]})}return a})(),lT=(()=>{class a{elementRef;_renderer;constructor(l,n){this.elementRef=l,this._renderer=n}menuPositionClassChanged=new ye;get menuPositionClass(){return this._menuPositionClass}set menuPositionClass(l){let n=this.elementRef.nativeElement,s=n.classList.contains(l);this._menuPositionClass!==l&&!s&&(["dropdown-menu-start","dropdown-menu-sm-start","dropdown-menu-md-start","dropdown-menu-lg-start","dropdown-menu-xl-start","dropdown-menu-xxl-start","dropdown-menu-xxl-start","dropdown-menu-xxl-start","dropdown-menu-end","dropdown-menu-sm-end","dropdown-menu-md-end","dropdown-menu-lg-end","dropdown-menu-xl-end","dropdown-menu-xxl-end","dropdown-menu-xxl-end","dropdown-menu-xxl-end"].forEach(m=>{this._renderer.removeClass(n,m)}),this._renderer.addClass(n,l),this.menuPositionClassChanged.emit(this.menuPositionClass))}_menuPositionClass;static \u0275fac=function(n){return new(n||a)(V(Ee),V(Lo))};static \u0275dir=oe({type:a,selectors:[["","mdbDropdownMenu",""]],inputs:{menuPositionClass:"menuPositionClass"},outputs:{menuPositionClassChanged:"menuPositionClassChanged"},exportAs:["mdbDropdownMenu"]})}return a})(),eV=(()=>{class a{_overlay;_overlayPositionBuilder;_elementRef;_vcr;_breakpointObserver;_cdRef;_renderer;_template;_dropdownToggle;_dropdownMenu;animation=!0;closeOnEsc=!0;closeOnItemClick=!0;closeOnOutsideClick=!0;offset=0;get positionClass(){return this._positionClass}set positionClass(l){let n=this.host.classList.contains(l);this._positionClass!==l&&!n&&(["dropdown","dropup","dropstart","dropend"].forEach(d=>{this._renderer.removeClass(this.host,d)}),this._renderer.addClass(this.host,l)),this._updateOverlay()}_positionClass;withPush=!1;dropdownShow=new ye;dropdownShown=new ye;dropdownHide=new ye;dropdownHidden=new ye;_overlayRef;_portal;_open=!1;_isDropUp;_isDropStart;_isDropEnd;_isDropdownMenuEnd;_xPosition;_breakpoints;_destroy$=new pe;get host(){return this._elementRef.nativeElement}_breakpointSubscription;_animationState="hidden";constructor(l,n,s,d,m,_,w){this._overlay=l,this._overlayPositionBuilder=n,this._elementRef=s,this._vcr=d,this._breakpointObserver=m,this._cdRef=_,this._renderer=w,this._breakpoints={isSm:this._breakpointObserver.isMatched("(min-width: 576px)"),isMd:this._breakpointObserver.isMatched("(min-width: 768px)"),isLg:this._breakpointObserver.isMatched("(min-width: 992px)"),isXl:this._breakpointObserver.isMatched("(min-width: 1200px)"),isXxl:this._breakpointObserver.isMatched("(min-width: 1400px)")}}ngAfterContentInit(){this._bindDropdownToggleClick(),this._listenToMenuPositionClassChange()}ngOnDestroy(){this._overlayRef&&(this._overlayRef.detach(),this._overlayRef.dispose()),this._destroy$.next(),this._destroy$.complete()}_bindDropdownToggleClick(){Fo(this._dropdownToggle.nativeElement,"click").pipe(ni(this._destroy$)).subscribe(()=>this.toggle())}_listenToMenuPositionClassChange(){this._dropdownMenu.menuPositionClassChanged.pipe(ni(this._destroy$)).subscribe(()=>this._updateOverlay())}_updateOverlay(){this._overlayRef?.updatePositionStrategy(this._createPositionStrategy())}_createOverlayConfig(){return new rs({hasBackdrop:!1,scrollStrategy:this._overlay.scrollStrategies.reposition(),positionStrategy:this._createPositionStrategy()})}_createOverlay(){this._overlayRef=this._overlay.create(this._createOverlayConfig())}_createPositionStrategy(){return this._overlayPositionBuilder.flexibleConnectedTo(this._dropdownToggle).withPositions(this._getPosition()).withFlexibleDimensions(!1).withPush(this.withPush)}_getPosition(){this._isDropUp=this.host.classList.contains("dropup"),this._isDropStart=this.host.classList.contains("dropstart"),this._isDropEnd=this.host.classList.contains("dropend"),this._isDropdownMenuEnd=this._dropdownMenu.elementRef.nativeElement.classList.contains("dropdown-menu-end"),this._xPosition=this._isDropdownMenuEnd?"end":"start";let l=new RegExp(/dropdown-menu-(sm|md|lg|xl|xxl)-(start|end)/,"g"),n=this._dropdownMenu.elementRef.nativeElement.className.match(l);if(n){this._subscribeBrakpoints();let S=new RegExp(/start|end/,"g"),I=new RegExp(/(sm|md|lg|xl|xxl)/,"g"),L=S.exec(n)[0],H=I.exec(n)[0];switch(!0){case(H==="xxl"&&this._breakpoints.isXxl):this._xPosition=L;break;case(H==="xl"&&this._breakpoints.isXl):this._xPosition=L;break;case(H==="lg"&&this._breakpoints.isLg):this._xPosition=L;break;case(H==="md"&&this._breakpoints.isMd):this._xPosition=L;break;case(H==="sm"&&this._breakpoints.isSm):this._xPosition=L;break;default:break}}let s,d={originX:this._xPosition,originY:"top",overlayX:this._xPosition,overlayY:"bottom",offsetY:-this.offset},m={originX:this._xPosition,originY:"bottom",overlayX:this._xPosition,overlayY:"top",offsetY:this.offset},_={originX:"start",originY:"top",overlayX:"end",overlayY:"top",offsetX:this.offset},w={originX:"end",originY:"top",overlayX:"start",overlayY:"top",offsetX:-this.offset};switch(!0){case this._isDropEnd:s=[w,_];break;case this._isDropStart:s=[_,w];break;case this._isDropUp:s=[d,m];break;default:s=[m,d];break}return s}_listenToEscKeyup(l){return Fo(document,"keyup").pipe(pn(n=>n.key==="Escape"),ni(l.detachments()))}_listenToClick(l,n){return Fo(document,"click").pipe(pn(s=>{let d=s.target,m=this._dropdownMenu.elementRef.nativeElement.contains(d),_=!this._dropdownToggle.nativeElement.contains(d),w=!m||d.classList&&d.classList.contains("dropdown-item");return d!==n&&_&&w}),ni(l.detachments()))}onAnimationEnd(l){l.fromState==="visible"&&l.toState==="hidden"&&(this._overlayRef.detach(),this._open=!1,this.dropdownHidden.emit(this)),l.fromState==="hidden"&&l.toState==="visible"&&this.dropdownShown.emit(this)}_subscribeBrakpoints(){let l=["(min-width: 576px)","(min-width: 768px)","(min-width: 992px)","(min-width: 1200px)","(min-width: 1400px)"];this._breakpointSubscription=this._breakpointObserver.observe(l).pipe(ni(this._destroy$)).subscribe(n=>{Object.keys(this._breakpoints).forEach((s,d)=>{let m=l[d],_=n.breakpoints[m];_!==this._breakpoints[s]&&(this._breakpoints[s]=_,this._open&&this._updateOverlay())})})}show(){this._cdRef.markForCheck(),!this._open&&(this._overlayRef||this._createOverlay(),this._portal=new Ns(this._template,this._vcr),this.dropdownShow.emit(this),this._open=!0,this._overlayRef.attach(this._portal),this._listenToEscKeyup(this._overlayRef).subscribe(l=>{l&&this.closeOnEsc&&this.hide()}),this._overlayRef.keydownEvents().pipe(ni(this._overlayRef.detachments())).subscribe(l=>{this._handleKeyboardNavigation(l)}),this._listenToClick(this._overlayRef,this._dropdownToggle.nativeElement).subscribe(l=>{let n=l.target,s=n.classList&&n.classList.contains("dropdown-item");if(this.closeOnItemClick&&s){this.hide();return}if(this.closeOnOutsideClick&&!s){this.hide();return}}),this._animationState="visible")}_handleKeyboardNavigation(l){let n=Array.from(this._dropdownMenu.elementRef.nativeElement.querySelectorAll(".dropdown-item")),s=l.key,d=this._dropdownMenu.elementRef.nativeElement.ownerDocument.activeElement;if(n.length===0)return;let m=n.indexOf(d);switch(s){case"ArrowDown":l.preventDefault(),m=Math.min(m+1,n.length-1);break;case"ArrowUp":if(l.preventDefault(),m===-1){m=n.length-1;break}m=Math.max(m-1,0);break}let _=n[m];_&&_.focus()}hide(){this._cdRef.markForCheck(),this._open&&(this.dropdownHide.emit(this),this._animationState="hidden")}toggle(){this._cdRef.markForCheck(),this._open?this.hide():this.show()}static \u0275fac=function(n){return new(n||a)(V(Zn),V(ag),V(Ee),V(Do),V(by),V(Zi),V(Lo))};static \u0275cmp=St({type:a,selectors:[["","mdbDropdown",""]],contentQueries:function(n,s,d){if(n&1&&(fn(d,aT,5,Ee),fn(d,lT,5)),n&2){let m;se(m=ae())&&(s._dropdownToggle=m.first),se(m=ae())&&(s._dropdownMenu=m.first)}},viewQuery:function(n,s){if(n&1&&ze(Aat,5),n&2){let d;se(d=ae())&&(s._template=d.first)}},inputs:{animation:[Rt.HasDecoratorInputTransform,"animation","animation",Qe],closeOnEsc:[Rt.HasDecoratorInputTransform,"closeOnEsc","closeOnEsc",Qe],closeOnItemClick:[Rt.HasDecoratorInputTransform,"closeOnItemClick","closeOnItemClick",Qe],closeOnOutsideClick:[Rt.HasDecoratorInputTransform,"closeOnOutsideClick","closeOnOutsideClick",Qe],offset:[Rt.HasDecoratorInputTransform,"offset","offset",ll],positionClass:"positionClass",withPush:[Rt.HasDecoratorInputTransform,"withPush","withPush",Qe]},outputs:{dropdownShow:"dropdownShow",dropdownShown:"dropdownShown",dropdownHide:"dropdownHide",dropdownHidden:"dropdownHidden"},features:[Fn],attrs:kat,ngContentSelectors:Oat,decls:4,vars:0,consts:[["dropdownTemplate",""]],template:function(n,s){n&1&&(Un(Pat),Ai(0),Ai(1,1),ut(2,Rat,2,2,"ng-template",null,0,Cv))},encapsulation:2,data:{animation:[wr("fade",[En("visible",hi({opacity:1})),En("hidden",hi({opacity:0})),ln("visible => hidden",Sn("150ms linear")),ln("hidden => visible",[hi({opacity:0}),Sn("150ms linear")])])]},changeDetection:0})}return a})(),iV=(()=>{class a{static \u0275fac=function(n){return new(n||a)};static \u0275mod=Si({type:a});static \u0275inj=Ei({imports:[zo,hl]})}return a})();var Tx=(()=>{let r=class r{constructor(n,s,d){this.http=n,this.identityService=s,this.snackBar=d,this.orderPageSubject=new We([]),this.orderSubject=new We({})}setOrderPage(n){this.orderPageSubject.next(n)}getOrderPage(){return this.orderPageSubject.asObservable()}setOrder(n){this.orderSubject.next(n)}getOrder(){return this.orderSubject.asObservable()}fetchOrders(n,s,d){return Tt(this,null,function*(){try{let m=yield Ne(this.http.get(be+"/orders",{params:{page:n.toString(),size:s.toString(),filter:d},headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setOrderPage(m)}catch{this.snackBar.open("Nu s-au putut incarca comenzile","Close",{duration:3e3})}})}fetchOrderByOrderNumber(n){return Tt(this,null,function*(){try{let s=yield Ne(this.http.get(be+"/orders/"+n,{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));s.ticketList.forEach(d=>{d.ticketType.event===null&&(d.ticketType.event={title:"Evenimentul a fost sters",date:"",location:{name:""}})}),this.setOrder(s)}catch{this.snackBar.open("Comanda nu a fost gasita","Close",{duration:3e3})}})}cancelTicket(n){return Tt(this,null,function*(){this.http.put(be+"/tickets/"+n.id+"/cancel",null,{headers:{Authorization:"Bearer "+this.identityService.getToken()}}).subscribe({next:()=>{n.status="CANCELED",this.snackBar.open("Biletul a fost anulat cu succes!","Close",{duration:3e3})},error:s=>{this.snackBar.open(s.error,"Close",{duration:3e3})}})})}cancelOrder(n){return Tt(this,null,function*(){this.http.put(be+"/orders/"+Number(n.orderNumber)+"/cancel",null,{headers:{Authorization:"Bearer "+this.identityService.getToken()}}).subscribe({next:()=>{n.status="CANCELED",this.snackBar.open("Comanda a fost anulata cu succes","Close",{duration:3e3})},error:s=>{this.snackBar.open(s.error,"Close",{duration:3e3})}})})}};r.\u0275fac=function(s){return new(s||r)(ht(Hi),ht(oi),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function Lat(a,r){if(a&1){let l=we();T(0,"button",14),ct("click",function(){let d=Kt(l).$implicit,m=gt();return m.selectedFilter=d.value,Qt(m.onFilterChange())}),B(1),k()}if(a&2){let l=r.$implicit;z(),Te(l.label)}}function zat(a,r){a&1&&(T(0,"div")(1,"div",21)(2,"h5",22),B(3,"Comanda a fost anulata"),k()()())}var Nat=a=>["/account/orders",a];function Bat(a,r){if(a&1&&(T(0,"div",15)(1,"div",16)(2,"div")(3,"h2"),B(4),k(),T(5,"p"),B(6),qo(7,"date"),T(8,"span"),dt(9,"i",17),k(),B(10),k()(),T(11,"div",18)(12,"a",19),B(13,"Vezi comanda"),k()()(),ut(14,zat,4,0,"div",20),k()),a&2){let l=r.$implicit;z(4),ie("Comanda numarul ",l.orderNumber,""),z(2),ie("",ms(7,5,l.createdAt)," "),z(4),ie(" ",l.price," RON"),z(2),W("routerLink",xi(7,Nat,l.orderNumber)),z(2),W("ngIf",l.status==="CANCELED")}}var Vat=a=>({active:a});function jat(a,r){if(a&1){let l=we();T(0,"li",9)(1,"button",23),ct("click",function(){let d=Kt(l).$implicit,m=gt();return Qt(m.onPageChange(d))}),B(2),k()()}if(a&2){let l=r.$implicit,n=gt();W("ngClass",xi(2,Vat,l===n.currentPage+1)),z(2),Te(l)}}var rV=a=>({disabled:a}),oV=(()=>{let r=class r{constructor(n,s,d){this.accountOrderService=n,this.route=s,this.router=d,this.orders=[],this.pageCount=0,this.currentPage=0,this.size=5,this.selectedFilter="last3Months",this.filterOptions=[{value:"last3Months",label:"Ultimele 3 luni"},{value:"last6Months",label:"Ultimele 6 luni"},{value:"lastYear",label:"Ultimul an"},{value:"all",label:"Toate"}]}ngOnInit(){this.route.queryParams.subscribe(n=>Tt(this,null,function*(){this.currentPage=n.page||0,this.selectedFilter=n.filter||"last3Months",yield this.accountOrderService.fetchOrders(this.currentPage,this.size,this.selectedFilter),this.orderListSubscription=this.accountOrderService.getOrderPage().subscribe(s=>{this.orders=s.orderPage.content,this.pageCount=Math.ceil(s.count/this.size)})}))}getPageRange(n){return Array.from({length:n},(s,d)=>d+1)}ngOnDestroy(){this.orderListSubscription?.unsubscribe()}getSelectedFilterLabel(){let n=this.filterOptions.find(s=>s.value===this.selectedFilter);return n?n.label:"All Time"}onFilterChange(){this.router.navigate([],{queryParams:{page:this.currentPage,filter:this.selectedFilter},queryParamsHandling:"merge"})}onPageChange(n){this.router.navigate([],{queryParams:{page:n-1,filter:this.selectedFilter},queryParamsHandling:"merge"})}};r.\u0275fac=function(s){return new(s||r)(V(Tx),V(Tn),V(zi))},r.\u0275cmp=St({type:r,selectors:[["app-account-orders"]],standalone:!0,features:[At],decls:24,vars:10,consts:[[1,"container-fluid"],[1,"d-flex"],["mdbDropdown","",1,"dropend","btn-filter"],["type","button","mdbDropdownToggle","","aria-expanded","false",1,"dropdown-toggle"],["mdbDropdownMenu","",1,"dropdown-menu"],["class","dropdown-item",3,"click",4,"ngFor","ngForOf"],["class","card mt-4",4,"ngFor","ngForOf"],["aria-label","Page navigation example"],[1,"pagination"],[1,"page-item",3,"ngClass"],["aria-label","Previous",1,"page-link",3,"click"],["aria-hidden","true"],["class","page-item",3,"ngClass",4,"ngFor","ngForOf"],["aria-label","Next",1,"page-link",3,"click"],[1,"dropdown-item",3,"click"],[1,"card","mt-4"],[1,"card-header","d-flex","flex-row"],[1,"fa-solid","fa-ticket","fa-fw","ms-1","me-1"],[1,"view-details-container"],[1,"ps-4",3,"routerLink"],[4,"ngIf"],[1,"card-body"],[1,"card-title","text-danger"],[1,"page-link",3,"click"]],template:function(s,d){s&1&&(T(0,"div",0)(1,"div",1)(2,"h1"),B(3,"Comenzi"),k(),dt(4,"hr"),T(5,"div",2)(6,"a",3),B(7),k(),T(8,"ul",4)(9,"li"),ut(10,Lat,2,1,"button",5),k()()()(),T(11,"div"),ut(12,Bat,15,9,"div",6),k(),T(13,"nav",7)(14,"ul",8)(15,"li",9)(16,"button",10),ct("click",function(){return d.onPageChange(d.currentPage)}),T(17,"span",11),B(18,"\xAB"),k()()(),ut(19,jat,3,4,"li",12),T(20,"li",9)(21,"button",13),ct("click",function(){return d.onPageChange(d.currentPage+1)}),T(22,"span",11),B(23,"\xBB"),k()()()()()()),s&2&&(z(7),ie(" ",d.getSelectedFilterLabel()," "),z(3),W("ngForOf",d.filterOptions),z(2),W("ngForOf",d.orders),z(3),W("ngClass",xi(6,rV,d.currentPage==0)),z(4),W("ngForOf",d.getPageRange(d.pageCount)),z(),W("ngClass",xi(8,rV,d.currentPage==d.pageCount-1)))},dependencies:[pi,pd,kn,Ve,Gl,iV,eV,aT,lT,Uo],styles:[".container-fluid[_ngcontent-%COMP%]{padding:20px;display:flex;flex-direction:column;justify-content:center;align-items:center}.btn-filter[_ngcontent-%COMP%]{padding:0;margin-left:50px;display:flex;align-items:center}.card[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:row;justify-content:space-between;align-items:center}.view-details-container[_ngcontent-%COMP%]{display:flex;justify-content:right}nav[_ngcontent-%COMP%]{margin-top:15px}"]});let a=r;return a})();function Uat(a,r){a&1&&(T(0,"div",20),B(1," Prenumele este obligatoriu "),k())}function Hat(a,r){a&1&&(T(0,"div",20),B(1," Numele este obligatoriu "),k())}function Gat(a,r){a&1&&(T(0,"div",20),B(1," Email-ul este obligatoriu "),k())}function qat(a,r){a&1&&(T(0,"div",20),B(1," Email-ul are un format invalid "),k())}var sV=(()=>{let r=class r{constructor(n,s,d){this.dialogRef=n,this.data=s,this.fb=d,this.user={},this.form=this.fb.group({firstName:[s.firstName,Le.required],lastName:[s.lastName,Le.required],email:[s.email,[Le.required,Le.email]]})}onCloseClick(){this.dialogRef.close()}onConfirmClick(){if(this.form.markAllAsTouched(),this.form.valid){let n=Pi(qt({},this.form.value),{id:this.data.id,username:this.data.username,role:this.data.role});this.dialogRef.close(n)}}};r.\u0275fac=function(s){return new(s||r)(V(er),V(jr),V(Er))},r.\u0275cmp=St({type:r,selectors:[["app-edit-account-details"]],standalone:!0,features:[At],decls:31,vars:5,consts:[[1,"modal-content"],[1,"modal-header","mb-5"],["id","exampleModalLabel",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body","mb-3"],[3,"formGroup"],[1,"mb-4"],["mdbInput","","type","text","id","firstName","formControlName","firstName","required","",1,"form-control"],["firstName",""],["mdbLabel","","for","firstName",1,"form-label"],["class","text-danger mb-4",4,"ngIf"],["mdbInput","","type","text","id","lastName","formControlName","lastName","required","",1,"form-control"],["lastName",""],["mdbLabel","","for","lastName",1,"form-label"],["mdbInput","","type","text","id","email","formControlName","email","required","",1,"form-control"],["email",""],["mdbLabel","","for","email",1,"form-label"],[1,"modal-footer","mt-2"],["type","button",1,"btn","btn-secondary","me-1",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"text-danger","mb-4"]],template:function(s,d){if(s&1&&(T(0,"div",0)(1,"div",1)(2,"h5",2),B(3,"Modifica datele"),k(),T(4,"button",3),ct("click",function(){return d.onCloseClick()}),k()(),T(5,"div",4)(6,"form",5)(7,"mdb-form-control",6),dt(8,"input",7,8),T(10,"label",9),B(11,"Prenume"),k()(),ut(12,Uat,2,0,"div",10),T(13,"mdb-form-control",6),dt(14,"input",11,12),T(16,"label",13),B(17,"Nume"),k()(),ut(18,Hat,2,0,"div",10),T(19,"mdb-form-control",6),dt(20,"input",14,15),T(22,"label",16),B(23,"Email"),k()(),ut(24,Gat,2,0,"div",10)(25,qat,2,0,"div",10),k()(),T(26,"div",17)(27,"button",18),ct("click",function(){return d.onCloseClick()}),B(28," Anuleaza "),k(),T(29,"button",19),ct("click",function(){return d.onConfirmClick()}),B(30,"Salveaza"),k()()()),s&2){let m,_,w,S;z(6),W("formGroup",d.form),z(6),W("ngIf",((m=d.form.get("firstName"))==null?null:m.invalid)&&((m=d.form.get("firstName"))==null?null:m.touched)),z(6),W("ngIf",((_=d.form.get("lastName"))==null?null:_.invalid)&&((_=d.form.get("lastName"))==null?null:_.touched)),z(6),W("ngIf",((w=d.form.get("email"))==null||w.errors==null?null:w.errors.required)&&((w=d.form.get("email"))==null?null:w.touched)),z(),W("ngIf",((S=d.form.get("email"))==null||S.errors==null?null:S.errors.email)&&((S=d.form.get("email"))==null?null:S.touched))}},dependencies:[Ni,Sr,en,qi,Cr,Yr,Xr,fo,go,lo,Ve,Mn,Hn,hr],styles:[".modal-content[_ngcontent-%COMP%]{padding:20px}"]});let a=r;return a})();function Wat(a,r){a&1&&(T(0,"div",20),B(1," Parola veche este obligatorie "),k())}function $at(a,r){a&1&&(T(0,"div",20),B(1," Parola noua este obligatorie "),k())}function Yat(a,r){a&1&&(T(0,"div",20),B(1," Parola noua trebuie sa aiba minim 6 caractere "),k())}function Zat(a,r){a&1&&(T(0,"div",20),B(1," Parolele nu coincid "),k())}var aV=(()=>{let r=class r{constructor(n,s,d){this.dialogRef=n,this.fb=d,this.form=this.fb.group({oldPassword:["",Le.required],password:["",Le.required],confirmPassword:["",Le.required]},{validators:Im})}onCloseClick(){this.dialogRef.close()}onConfirmClick(){if(this.form.markAllAsTouched(),this.form.valid){let n={oldPassword:this.form.value.oldPassword,newPassword:this.form.value.password,confirmPassword:this.form.value.confirmPassword};this.dialogRef.close(n)}}};r.\u0275fac=function(s){return new(s||r)(V(er),V(jr),V(Er))},r.\u0275cmp=St({type:r,selectors:[["app-change-password-account-details"]],standalone:!0,features:[At],decls:31,vars:5,consts:[[1,"modal-content"],[1,"modal-header","mb-5"],["id","exampleModalLabel",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body","mb-3"],[3,"formGroup"],[1,"mb-4"],["mdbInput","","type","password","id","oldPassword","formControlName","oldPassword","required","",1,"form-control"],["oldPassword",""],["mdbLabel","","for","oldPassword",1,"form-label"],["class","text-danger mb-4",4,"ngIf"],["mdbInput","","type","password","id","password","formControlName","password","required","",1,"form-control"],["password",""],["mdbLabel","","for","password",1,"form-label"],["mdbInput","","type","password","id","confirmPassword","formControlName","confirmPassword","required","",1,"form-control"],["confirmPassword",""],["mdbLabel","","for","confirmPassword",1,"form-label"],[1,"modal-footer","mt-2"],["type","button",1,"btn","btn-secondary","me-1",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"text-danger","mb-4"]],template:function(s,d){if(s&1&&(T(0,"div",0)(1,"div",1)(2,"h5",2),B(3,"Schimba parola"),k(),T(4,"button",3),ct("click",function(){return d.onCloseClick()}),k()(),T(5,"div",4)(6,"form",5)(7,"mdb-form-control",6),dt(8,"input",7,8),T(10,"label",9),B(11,"Parola veche"),k()(),ut(12,Wat,2,0,"div",10),T(13,"mdb-form-control",6),dt(14,"input",11,12),T(16,"label",13),B(17,"Parola noua"),k()(),ut(18,$at,2,0,"div",10)(19,Yat,2,0,"div",10),T(20,"mdb-form-control",6),dt(21,"input",14,15),T(23,"label",16),B(24,"Confirm password"),k()(),ut(25,Zat,2,0,"div",10),k()(),T(26,"div",17)(27,"button",18),ct("click",function(){return d.onCloseClick()}),B(28," Anuleaza "),k(),T(29,"button",19),ct("click",function(){return d.onConfirmClick()}),B(30,"Salveaza"),k()()()),s&2){let m,_,w,S;z(6),W("formGroup",d.form),z(6),W("ngIf",((m=d.form.get("password"))==null||m.errors==null?null:m.errors.required)&&((m=d.form.get("password"))==null?null:m.touched)),z(6),W("ngIf",((_=d.form.get("password"))==null||_.errors==null?null:_.errors.required)&&((_=d.form.get("password"))==null?null:_.touched)),z(),W("ngIf",((w=d.form.get("password"))==null||w.errors==null?null:w.errors.minlength)&&((w=d.form.get("password"))==null?null:w.touched)),z(6),W("ngIf",((S=d.form.get("password"))==null?null:S.touched)&&((S=d.form.get("confirmPassword"))==null?null:S.touched)&&(d.form.errors==null?null:d.form.errors.passwordMismatch)&&!((S=d.form.get("password"))!=null&&S.errors))}},dependencies:[Ni,Sr,en,qi,Cr,Yr,Xr,fo,go,lo,Ve,Mn,Hn,hr],styles:[".modal-content[_ngcontent-%COMP%]{padding:20px}"]});let a=r;return a})();var lV=(()=>{let r=class r{constructor(n,s,d){this.http=n,this.identityService=s,this.snackBar=d,this.userSubject=new We({})}setUser(n){this.userSubject.next(n)}getUser(){return this.userSubject.asObservable()}fetchUser(){return Tt(this,null,function*(){let n=yield Ne(this.http.get(be+"/users/me/details",{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setUser(n)})}editUser(n){return Tt(this,null,function*(){try{let s=yield Ne(this.http.patch(be+"/users/me",n,{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setUser(s),this.snackBar.open("Detaliile au fost actualizate cu succes!","Close",{duration:3e3})}catch{this.snackBar.open("A ap\u0103rut o eroare la actualizarea detaliilor!","Close",{duration:3e3})}})}changePassword(n){return Tt(this,null,function*(){try{yield Ne(this.http.patch(be+"/users/me/change-password",{oldPassword:n.oldPassword,newPassword:n.newPassword,confirmPassword:n.confirmPassword},{headers:{Authorization:"Bearer "+this.identityService.getToken()}})),this.snackBar.open("Parola a fost schimbat\u0103 cu succes!","Close",{duration:3e3})}catch{this.snackBar.open("A ap\u0103rut o eroare la schimbarea parolei!","Close",{duration:3e3})}})}};r.\u0275fac=function(s){return new(s||r)(ht(Hi),ht(oi),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var Ix=(()=>{let r=class r{constructor(n,s){this.accountSettingsService=n,this.dialog=s,this.user={}}ngOnInit(){return Tt(this,null,function*(){yield this.accountSettingsService.fetchUser(),this.userSubscription=this.accountSettingsService.getUser().subscribe(n=>{this.user=n})})}ngOnDestroy(){this.userSubscription?.unsubscribe()}onEditClick(){this.dialog.open(sV,{width:"60%",data:this.user}).afterClosed().subscribe(s=>Tt(this,null,function*(){s&&(yield this.accountSettingsService.editUser(s))}))}onChangePasswordClick(){this.dialog.open(aV,{width:"60%"}).afterClosed().subscribe(s=>Tt(this,null,function*(){s&&(yield this.accountSettingsService.changePassword(s))}))}};r.\u0275fac=function(s){return new(s||r)(V(lV),V(Kr))},r.\u0275cmp=St({type:r,selectors:[["app-account-settings"]],standalone:!0,features:[At],decls:14,vars:3,consts:[[1,"personal-info"],[1,"text-center"],[1,"card"],[1,"card-body"],[1,"card-title"],[1,"card-subtitle","mb-2","text-muted"],[1,"card-footer"],[1,"btn","btn-primary","me-2",3,"click"],[1,"btn","btn-primary",3,"click"]],template:function(s,d){s&1&&(T(0,"div",0)(1,"h1",1),B(2,"Informatii personale"),k(),T(3,"div",2)(4,"div",3)(5,"h5",4),B(6),k(),T(7,"h6",5),B(8),k()(),T(9,"div",6)(10,"button",7),ct("click",function(){return d.onEditClick()}),B(11,"Modifica datele"),k(),T(12,"button",8),ct("click",function(){return d.onChangePasswordClick()}),B(13,"Schimba parola"),k()()()()),s&2&&(z(6),po("Nume: ",d.user.firstName," ",d.user.lastName,""),z(2),ie("Email: ",d.user.email,""))}});let a=r;return a})();function Kat(a,r){a&1&&(T(0,"div",14),B(1," Parola este obligatorie "),k())}function Qat(a,r){a&1&&(T(0,"div",14),B(1," Parola trebuie sa aiba minim 6 caractere "),k())}function Jat(a,r){a&1&&(T(0,"div",14),B(1," Parolele nu coincid "),k())}var cV=(()=>{let r=class r{constructor(n,s,d,m,_){this.router=n,this.identityService=s,this.fb=d,this.snackBar=m,this.route=_,this.form=this.fb.group({password:["",[Le.required,Le.minLength(6)]],confirmPassword:["",Le.required]},{validators:[Im]})}onClickConfirm(){if(this.form.markAllAsTouched(),this.form.valid){let n=this.route.snapshot.url[this.route.snapshot.url.length-1].path;this.identityService.resetPassword(n,this.form.value.password)}}};r.\u0275fac=function(s){return new(s||r)(V(zi),V(oi),V(Er),V(Je),V(Tn))},r.\u0275cmp=St({type:r,selectors:[["app-reset-password"]],standalone:!0,features:[At],decls:21,vars:4,consts:[[1,"container-fluid"],[1,"card","text-center",2,"width","300px"],[1,"card-header","h5","text-white","bg-primary"],[1,"card-body","px-5"],[3,"formGroup"],[1,"mb-4"],["mdbInput","","type","password","id","password","formControlName","password","required","",1,"form-control"],["password",""],["mdbLabel","","for","password",1,"form-label"],["class","text-danger mb-4",4,"ngIf"],["mdbInput","","type","password","id","confirmPassword","formControlName","confirmPassword","required","",1,"form-control"],["confirmPassword",""],["mdbLabel","","for","confirmPassword",1,"form-label"],[1,"btn","btn-primary",3,"click"],[1,"text-danger","mb-4"]],template:function(s,d){if(s&1&&(T(0,"div",0)(1,"div",1)(2,"div",2),B(3,"Resetare parola"),k(),T(4,"div",3)(5,"form",4)(6,"mdb-form-control",5),dt(7,"input",6,7),T(9,"label",8),B(10,"Password"),k()(),ut(11,Kat,2,0,"div",9)(12,Qat,2,0,"div",9),T(13,"mdb-form-control",5),dt(14,"input",10,11),T(16,"label",12),B(17,"Confirm password"),k()(),ut(18,Jat,2,0,"div",9),T(19,"button",13),ct("click",function(){return d.onClickConfirm()}),B(20,"Reseteaza parola"),k()()()()()),s&2){let m,_,w;z(5),W("formGroup",d.form),z(6),W("ngIf",((m=d.form.get("password"))==null||m.errors==null?null:m.errors.required)&&((m=d.form.get("password"))==null?null:m.touched)),z(),W("ngIf",((_=d.form.get("password"))==null||_.errors==null?null:_.errors.minlength)&&((_=d.form.get("password"))==null?null:_.touched)),z(6),W("ngIf",((w=d.form.get("password"))==null?null:w.touched)&&((w=d.form.get("confirmPassword"))==null?null:w.touched)&&(d.form.errors==null?null:d.form.errors.passwordMismatch)&&!((w=d.form.get("password"))!=null&&w.errors))}},dependencies:[Mn,Sr,en,qi,Cr,Yr,Hn,hr,Xr,fo,go,lo,Ve],styles:[".container-fluid[_ngcontent-%COMP%]{background:#f5f5f5;height:100vh;display:flex;justify-content:center;align-items:center;-webkit-user-select:none;user-select:none}"]});let a=r;return a})();var uV=a=>({disabled:a});function tlt(a,r){if(a&1){let l=we();T(0,"button",10),ct("click",function(){Kt(l);let s=gt().$implicit,d=gt();return Qt(d.cancelTicket(s))}),B(1),k()}if(a&2){let l=gt().$implicit;W("ngClass",xi(2,uV,l.status=="CANCELED")),z(),ie(" ",l.status=="CANCELED"?"Anulat":"Anuleaza","")}}var elt=(a,r)=>[a,r],dV=a=>({id:a}),ilt=a=>["/event-details",a];function nlt(a,r){if(a&1&&(T(0,"div",3)(1,"div",4)(2,"h5",5)(3,"a",6),B(4),k()(),T(5,"a",6),B(6,"Vezi biletele"),k()(),T(7,"div",7)(8,"p",8),B(9),qo(10,"date"),k(),T(11,"p",8),B(12),k(),T(13,"p",8),B(14),k(),T(15,"p",8),B(16),k(),T(17,"p",8),B(18),k(),ut(19,tlt,2,4,"button",9),k()()),a&2){let l=r.$implicit,n=gt();z(3),W("routerLink",Jh(13,elt,"/"+l.ticketType.event.location.name,l.ticketType.event.title))("queryParams",xi(16,dV,l.ticketType.event.id)),z(),ie(" ",l.ticketType.event.title," "),z(),W("routerLink",xi(18,ilt,l.ticketType.event.title))("queryParams",xi(20,dV,l.ticketType.event.id)),z(4),ie("Data: ",ms(10,11,l.ticketType.event.date),""),z(3),ie("Locatie: ",l.ticketType.event.location.name,""),z(2),ie("Categoria: ",l.ticketType.name,""),z(2),ie("Pret: ",l.ticketType.price," RON"),z(2),ie("Status: ",l.status,""),z(),W("ngIf",n.order.ticketList.length>1)}}var hV=(()=>{let r=class r{constructor(n,s,d){this.accountOrderService=n,this.snackBar=s,this.route=d,this.order={}}ngOnInit(){return Tt(this,null,function*(){let n=Number(this.route.snapshot.url[this.route.snapshot.url.length-1].path);yield this.accountOrderService.fetchOrderByOrderNumber(n),this.orderSubscription=this.accountOrderService.getOrder().subscribe(s=>{this.order=s})})}ngOnDestroy(){this.orderSubscription?.unsubscribe()}cancelTicket(n){return Tt(this,null,function*(){yield this.accountOrderService.cancelTicket(n)})}cancelOrder(){return Tt(this,null,function*(){yield this.accountOrderService.cancelOrder(this.order)})}};r.\u0275fac=function(s){return new(s||r)(V(Tx),V(Je),V(Tn))},r.\u0275cmp=St({type:r,selectors:[["app-account-order-details"]],standalone:!0,features:[At],decls:18,vars:11,consts:[[1,"container-fluid"],["class","card",4,"ngFor","ngForOf"],[1,"btn","btn-danger","mb-5","mt-1",3,"ngClass","click"],[1,"card"],[1,"card-header"],[1,"card-title"],[3,"routerLink","queryParams"],[1,"card-body"],[1,"card-text"],["class","btn btn-danger",3,"ngClass","click",4,"ngIf"],[1,"btn","btn-danger",3,"ngClass","click"]],template:function(s,d){s&1&&(T(0,"div",0)(1,"h1"),B(2),k(),T(3,"h4"),B(4),qo(5,"date"),k(),T(6,"h4"),B(7),k(),dt(8,"hr"),T(9,"h3"),B(10,"Bilete"),k(),T(11,"div"),ut(12,nlt,20,22,"div",1),k(),dt(13,"hr"),T(14,"h4"),B(15),k(),T(16,"button",2),ct("click",function(){return d.cancelOrder()}),B(17),k()()),s&2&&(z(2),ie("Comanda numarul ",d.order.orderNumber,""),z(2),ie("Data: ",ms(5,7,d.order.createdAt),""),z(3),ie("Status: ",d.order.status,""),z(5),W("ngForOf",d.order.ticketList),z(3),ie("Total: ",d.order.price," RON"),z(),W("ngClass",xi(9,uV,d.order.status=="CANCELED")),z(),Te(d.order.status=="CANCELED"?"Anulata":"Anuleaza comanda"))},dependencies:[pd,pi,Ve,Uo,kn]});let a=r;return a})();var mV=(()=>{let r=class r{constructor(n,s,d){this.http=n,this.identityService=s,this.snackBar=d,this.userSubject=new We({})}setUser(n){this.userSubject.next(n)}getUser(){return this.userSubject.asObservable()}fetchUser(){return Tt(this,null,function*(){try{let n=yield Ne(this.http.get(be+"/users/me/orders",{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setUser(n)}catch{this.snackBar.open("Error fetching user data","Close",{duration:3e3})}})}editUser(n){return Tt(this,null,function*(){try{let s=yield Ne(this.http.patch(be+"/users/me",n,{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setUser(s)}catch{this.snackBar.open("Error editing user data","Close",{duration:3e3})}})}changePassword(n){return Tt(this,null,function*(){this.http.patch(be+"/users/me/change-password",{oldPassword:n.oldPassword,newPassword:n.newPassword,confirmPassword:n.confirmPassword},{headers:{Authorization:"Bearer "+this.identityService.getToken()}}).subscribe({next:()=>{this.snackBar.open("Password changed","Close",{duration:3e3})},error:s=>{this.snackBar.open(s.error,"Close",{duration:3e3})}})})}};r.\u0275fac=function(s){return new(s||r)(ht(Hi),ht(oi),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var olt=a=>["orders",a];function slt(a,r){if(a&1&&(T(0,"div",7)(1,"div",8)(2,"h5",9)(3,"a",10),B(4),k()(),T(5,"h6",11),B(6),qo(7,"date"),k(),T(8,"p",12),B(9),k(),T(10,"p",12),B(11),k()()()),a&2){let l=r.$implicit;z(3),W("routerLink",xi(7,olt,l.orderNumber)),z(),ie("Comanda #",l.orderNumber,""),z(2),ie("Data: ",ms(7,5,l.createdAt),""),z(3),ie("Status: ",l.status,""),z(2),ie("Total: ",l.price," RON")}}var pV=(()=>{let r=class r{constructor(n,s,d){this.accountDetailsService=n,this.snackBar=s,this.dialog=d,this.user={},this.orderList=[]}ngOnInit(){return Tt(this,null,function*(){yield this.accountDetailsService.fetchUser(),this.userSubscription=this.accountDetailsService.getUser().subscribe(n=>{this.user=n,this.orderList=this.user.orderList,this.createPieChart()})})}ngOnDestroy(){this.userSubscription?.unsubscribe()}createPieChart(){let s={type:"pie",data:{labels:this.user.genrePreferences.map(_=>_.broadGenre),datasets:[{data:this.user.genrePreferences.map(_=>_.percentage.toFixed(2)),backgroundColor:["rgba(255, 99, 132, 0.6)","rgba(54, 162, 235, 0.6)","rgba(255, 206, 86, 0.6)","rgba(75, 192, 192, 0.6)","rgba(153, 102, 255, 0.6)","rgba(255, 159, 64, 0.6)","rgba(201, 203, 207, 0.6)","rgba(34, 43, 243, 0.6)","rgba(120, 221, 45, 0.6)","rgba(255, 140, 0, 0.6)","rgba(0, 128, 128, 0.6)","rgba(128, 0, 128, 0.6)","rgba(255, 215, 0, 0.6)","rgba(255, 192, 203, 0.6)","rgba(0, 0, 255, 0.6)","rgba(128, 128, 0, 0.6)","rgba(0, 128, 0, 0.6)","rgba(255, 0, 0, 0.6)","rgba(0, 255, 0, 0.6)","rgba(0, 0, 128, 0.6)"],borderColor:["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)","rgba(201, 203, 207, 1)","rgba(34, 43, 243, 1)","rgba(120, 221, 45, 1)","rgba(255, 140, 0, 1)","rgba(0, 128, 128, 1)","rgba(128, 0, 128, 1)","rgba(255, 215, 0, 1)","rgba(255, 192, 203, 1)","rgba(0, 0, 255, 1)","rgba(128, 128, 0, 1)","rgba(0, 128, 0, 1)","rgba(255, 0, 0, 1)","rgba(0, 255, 0, 1)","rgba(0, 0, 128, 1)"],borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right"}}}},d=document.getElementById("genrePieChart"),m=new Kl(d,s)}};r.\u0275fac=function(s){return new(s||r)(V(mV),V(Je),V(Kr))},r.\u0275cmp=St({type:r,selectors:[["app-account-details"]],standalone:!0,features:[At],decls:10,vars:1,consts:[[1,"container-fluid"],[1,"genre-preferences"],[1,"text-center"],[1,"chart-container"],["id","genrePieChart"],[1,"recent-orders"],["class","card",4,"ngFor","ngForOf"],[1,"card"],[1,"card-body"],["role","tab",1,"card-title","mb-3"],[3,"routerLink"],[1,"card-subtitle","mb-2","text-muted"],[1,"card-text"]],template:function(s,d){s&1&&(T(0,"div",0)(1,"div",1)(2,"h1",2),B(3,"Preferinte genuri"),k(),T(4,"div",3),dt(5,"canvas",4),k()(),T(6,"div",5)(7,"h1"),B(8,"Comenzile recente"),k(),ut(9,slt,12,9,"div",6),k()()),s&2&&(z(9),W("ngForOf",d.orderList))},dependencies:[pi,pd,kn],styles:[".chart-container[_ngcontent-%COMP%]{position:relative;width:500px;height:500px;overflow:hidden}.genre-preferences[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center}@media screen and (max-width: 1150px){.chart-container[_ngcontent-%COMP%]{width:400px;height:400px}}"]});let a=r;return a})();var Vd=TF(uT());var Ax=(()=>{let r=class r{constructor(n,s,d){this.http=n,this.identityService=s,this.snackBar=d,this.bookedEventsSubject=new We([]),this.ticketsSubject=new We([])}setBookedEvents(n){this.bookedEventsSubject.next(n)}getBookedEvents(){return this.bookedEventsSubject.asObservable()}setTickets(n){this.ticketsSubject.next(n)}getTickets(){return this.ticketsSubject.asObservable()}fetchBookedEvents(){return Tt(this,null,function*(){try{let n=yield Ne(this.http.get(be+"/events/me",{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setBookedEvents(n)}catch{this.snackBar.open("Error fetching booked events","Close",{duration:3e3})}})}fetchTicketsByEventId(n){return Tt(this,null,function*(){try{let s=yield Ne(this.http.get(be+"/tickets/"+n,{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setTickets(s)}catch{this.snackBar.open("Error fetching tickets","Close",{duration:3e3})}})}};r.\u0275fac=function(s){return new(s||r)(ht(Hi),ht(oi),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var _V=(()=>{let r=class r{constructor(n,s){this.trackEventService=n,this.router=s,this.style="mapbox://styles/mapbox/streets-v11",this.lat=0,this.lng=0,this.events=[]}ngOnInit(){return Tt(this,null,function*(){yield this.fetchBookedEvents(),this.initMap()})}fetchBookedEvents(){return Tt(this,null,function*(){yield this.trackEventService.fetchBookedEvents(),this.trackEventService.getBookedEvents().subscribe({next:n=>{this.events=n}})})}initMap(){Vd.default.accessToken=kx,navigator.geolocation.getCurrentPosition(n=>{this.lat=n.coords.latitude,this.lng=n.coords.longitude,this.map=new Vd.default.Map({container:"map",style:this.style,zoom:9,hash:!0,center:[this.lng,this.lat]}),this.map.addControl(new Vd.default.NavigationControl),this.map.addControl(new Vd.default.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0})),this.events.forEach(s=>{this.addMarker(s)})},n=>{console.error(n)})}addMarker(n){if(this.map instanceof Vd.default.Map){let s=[n.location.longitude,n.location.latitude],d=new Vd.default.Marker().setLngLat(s).setPopup(new Vd.default.Popup().setHTML(`<div class="popup-content">
            <h5 style="user-select: none; cursor: pointer;">${n.title}</h5>
            <p style="user-select: none; cursor: pointer;">${n.location.name} | ${n.date}</p>
            <button class="btn btn-primary view-details">View details</button>
          </div>`)).addTo(this.map);d.getPopup().on("open",()=>{let m=d.getPopup().getElement(),_=m?.querySelector(".view-details"),w=m?.querySelector("h5"),S=m?.querySelector("p");w&&w.addEventListener("click",I=>this.handleButtonClick([n.location.name,n.title,n.id])),S&&S.addEventListener("click",I=>this.handleButtonClick([n.location.name,n.location.id])),_&&_.addEventListener("click",I=>this.handleButtonClick(["track",n.title,n.id]))}),d.getPopup().on("close",()=>{let m=d.getPopup().getElement(),_=m?.querySelector(".view-details"),w=m?.querySelector("h5"),S=m?.querySelector("p");w&&w.removeEventListener("click",I=>this.handleButtonClick(n)),S&&S.removeEventListener("click",I=>this.handleButtonClick(n)),_&&_.removeEventListener("click",I=>this.handleButtonClick(n))})}}handleButtonClick(n){let s={id:n[n.length-1]},d=n.slice(0,-1);d=d.map(m=>m==="track"?"event-details":m),this.router.navigate(["/",...d],{queryParams:s})}};r.\u0275fac=function(s){return new(s||r)(V(Ax),V(zi))},r.\u0275cmp=St({type:r,selectors:[["app-track-event"]],standalone:!0,features:[At],decls:2,vars:0,consts:[["id","map",1,"match-parent"]],template:function(s,d){s&1&&(T(0,"div"),dt(1,"div",0),k())},styles:[".match-parent[_ngcontent-%COMP%]{width:100%;height:700px}"]});let a=r;return a})();var jd=TF(uT());var vV=(()=>{let r=class r{constructor(n,s){this.dialogRef=n,this.data=s,this.style="mapbox://styles/mapbox/streets-v11",this.destination=[0,0],this.userLocation=[0,0]}ngOnInit(){jd.default.accessToken=kx,this.destination=this.data.destination,this.map=new jd.default.Map({container:"map",style:this.style,zoom:11,center:[this.destination[0],this.destination[1]]}),this.map.addControl(new jd.default.NavigationControl),navigator.geolocation.getCurrentPosition(n=>{this.userLocation=[n.coords.longitude,n.coords.latitude],this.addMarker([n.coords.longitude,n.coords.latitude]),this.calculateRoute()}),this.addMarker([this.destination[0],this.destination[1]])}addMarker(n){if(this.map instanceof jd.default.Map){let s=new jd.default.Marker().setLngLat(n).setPopup(new jd.default.Popup().setHTML(`<div class="popup-content">

          </div>`)).addTo(this.map)}}calculateRoute(){let n=`https://api.mapbox.com/directions/v5/mapbox/driving/${this.userLocation[0]},${this.userLocation[1]};
    ${this.destination[0]},${this.destination[1]}?steps=true&geometries=geojson&access_token=${jd.default.accessToken}`;fetch(n).then(s=>s.json()).then(s=>{let d=s.routes[0].geometry;this.map?.addLayer({id:"route",type:"line",source:{type:"geojson",data:{type:"Feature",properties:{},geometry:d}},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#888","line-width":8}})})}};r.\u0275fac=function(s){return new(s||r)(V(er),V(jr))},r.\u0275cmp=St({type:r,selectors:[["app-map"]],standalone:!0,features:[At],decls:1,vars:0,consts:[["id","map",2,"width","100%","height","100%"]],template:function(s,d){s&1&&dt(0,"div",0)}});let a=r;return a})();function alt(a,r){if(a&1&&(T(0,"div")(1,"p"),B(2),k(),dt(3,"br"),T(4,"div",5),dt(5,"img",6),k(),dt(6,"hr"),k()),a&2){let l=r.$implicit;z(2),po("",l.ticketType.name," | ",l.ticketType.price," RON"),z(3),Qh("src","data:image/png;base64, ",l.image,"",Vr)}}var llt=a=>["/","event",a],clt=a=>({id:a}),yV=(()=>{let r=class r{constructor(n,s,d){this.route=n,this.trackEventService=s,this.mapDialog=d,this.tickets=[],this.event={}}ngOnInit(){return Tt(this,null,function*(){yield this.trackEventService.fetchTicketsByEventId(this.route.snapshot.queryParams.id),this.trackEventService.getTickets().subscribe({next:n=>{this.tickets=n,this.event=n[0].ticketType.event}})})}showMap(){let n=[this.event.location.longitude,this.event.location.latitude];this.mapDialog.open(vV,{width:"80%",height:"80%",data:{destination:n}}).afterClosed()}};r.\u0275fac=function(s){return new(s||r)(V(Tn),V(Ax),V(Kr))},r.\u0275cmp=St({type:r,selectors:[["app-track-event-details"]],standalone:!0,features:[At],decls:12,vars:10,consts:[[1,"container-fluid"],["role","button",3,"routerLink","queryParams"],[1,"btn","btn-primary","map-button",3,"click"],[1,"tickets"],[4,"ngFor","ngForOf"],[1,"image"],["alt","",3,"src"]],template:function(s,d){s&1&&(T(0,"div",0)(1,"h1",1),B(2),k(),T(3,"p"),B(4),k(),T(5,"button",2),ct("click",function(){return d.showMap()}),B(6,"Show map"),k(),dt(7,"hr"),T(8,"div",3)(9,"h2"),B(10,"Tickets"),k(),ut(11,alt,7,3,"div",4),k()()),s&2&&(z(),W("routerLink",xi(6,llt,d.event.title))("queryParams",xi(8,clt,d.event.id)),z(),Te(d.event.title),z(2),po("",d.event.location==null?null:d.event.location.name," | ",d.event.date,""),z(7),W("ngForOf",d.tickets))},dependencies:[pi,kn],styles:[".container-fluid[_ngcontent-%COMP%]{width:65%;margin:0 auto;border:2px solid #ccc;padding:20px;border-radius:8px}.image[_ngcontent-%COMP%]{display:flex;justify-content:center}"]});let a=r;return a})();var bV=(()=>{let r=class r{constructor(){this.menuItems=[{label:"Acasa",route:"validator-dashboard",icon:"fa-solid fa-home fa-fw me-3"},{label:"Validare",route:"validator-dashboard/scanner",icon:"fa-solid fa-qrcode fa-fw me-3"},{label:"Setari",route:"validator-dashboard/settings",icon:"fa-solid fa-cog fa-fw me-3"}]}};r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=St({type:r,selectors:[["app-validator-dashboard"]],standalone:!0,features:[At],decls:3,vars:2,consts:[[3,"menuItems","brand"]],template:function(s,d){s&1&&(dt(0,"app-sidebar",0),T(1,"main"),dt(2,"router-outlet"),k()),s&2&&W("menuItems",d.menuItems)("brand","Validator dashboard")},dependencies:[Am,cl],styles:["@media (min-width: 991.98px){main[_ngcontent-%COMP%]{padding-left:240px}}main[_ngcontent-%COMP%]{margin-top:70px;margin-left:15px}"]});let a=r;return a})();var xV=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=St({type:r,selectors:[["app-home-validator"]],standalone:!0,features:[At],decls:2,vars:0,template:function(s,d){s&1&&(T(0,"p"),B(1,"home-validator works!"),k())}});let a=r;return a})();var wV=(()=>{let r=class r{constructor(n,s){this.identityService=n,this.router=s}canActivate(n){return this.identityService.isUser()||!this.identityService.isLoggedIn()?(this.router.navigate([""]),!1):this.identityService.isAdmin()?(this.router.navigate(["admin-dashboard"]),!1):!0}};r.\u0275fac=function(s){return new(s||r)(ht(oi),ht(zi))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var dlt=["video"],ult=["canvas"],hlt=["resultsPanel"],qg="assets/wasm/index.js",Wg="https://cdn.jsdelivr.net/npm/ngx-scanner-qrcode@1.6.9/wasm/index.js",mlt="https://cdn.jsdelivr.net/npm/ngx-scanner-qrcode@latest/wasm/index.js",plt="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",MV={audio:!1,video:!0},pT={lineWidth:1,strokeStyle:"green",fillStyle:"#55f02880"},fT={font:"15px serif",strokeStyle:"#fff0",fillStyle:"#ff0000"},Nc={src:"",fps:30,vibrate:300,decode:"utf-8",isBeep:!0,constraints:MV,canvasStyles:[pT,fT]},Rx=()=>"zbarWasm"in window,flt=(a,r,l)=>{if(r&&Object.keys(r[a]).length){for(let n in l){let s=JSON.parse(JSON.stringify(Pi(qt({},r[a]),{[n]:l[n]})));r[a]=r[a].hasOwnProperty(n)?r[a]:s}return r[a]}else return l},Kn=(a,r,l)=>{l?a.error(l):a.next(r),a.complete()},mT=(a=!1)=>{if(a===!1)return;let r=new Audio(plt);r.oncanplaythrough=()=>{let l=r.play();l&&l.catch(n=>{n.name==="NotAllowedError"||n.name})}},CV=(a,r,l,n)=>{let s,d,m=r.width,_=r.height,w=m/_,S=parseInt(getComputedStyle(r).width),I=parseInt(getComputedStyle(r).height),L=S/I;l.innerHTML="",w>L?(s=S/m,d=S/w/_):(d=I/_,s=I*w/m);for(let H=0;H<a.length;H++){let q=a[H],X=document.createElement("canvas"),it=X.getContext("2d",{willReadFrequently:!0}),at={},mt=[],Mt=[],Lt=0,Pt=0,Nt=n.length===2&&n[1]?.font?.replace(/[^0-9]/g,"");Nt&&/[0-9]/g.test(Nt)&&(Lt=parseFloat(Nt),Pt=(s||1)*Lt,Number.isNaN(Pt)&&(Pt=Lt));let ue=q.points;for(let Oi=0;Oi<ue.length;Oi++){let Dr=ue?.[Oi]?.x??0,Ri=ue?.[Oi]?.y??0;at[`x${Oi+1}`]=Dr,at[`y${Oi+1}`]=Ri,mt.push(Dr),Mt.push(Ri)}let Q=Math.max(...mt),$t=Math.min(...mt),Ue=Math.max(...Mt),ki=Math.min(...Mt);X.setAttribute("class","qrcode-polygon"),w>L?(X.style.top=ki*d+(I-S/w)*.5+"px",X.style.left=$t*s+"px",X.width=(Q-$t)*s,X.height=(Ue-ki)*s):(X.style.top=ki*d+"px",X.style.left=$t*s+(S-I*w)*.5+"px",X.width=(Q-$t)*d,X.height=(Ue-ki)*d);for(let Oi in n[0])it[Oi]=n[0][Oi];let fe=[];for(let Oi=0;Oi<mt.length;Oi++)fe.push((at[`x${Oi+1}`]-$t)*d),fe.push((at[`y${Oi+1}`]-ki)*s);let ei=fe.slice(0);for(it.beginPath(),it.moveTo(ei.shift(),ei.shift());ei.length;)it.lineTo(ei.shift(),ei.shift());if(it.closePath(),it.fill(),it.stroke(),Lt){let Oi=document.createElement("div");Oi.setAttribute("class","qrcode-tooltip-temp"),Oi.innerText=q.value,Oi.style.maxWidth=(m>window.innerWidth?window.innerWidth*.9:m)+"px",Oi.style.borderRadius=`clamp(1px, ${s*Lt-10}px, 3px)`,Oi.style.paddingBlock=`clamp(1px, ${s*Lt-10}px, 3px)`,Oi.style.paddingInline=`clamp(2.5px, ${s*Lt-6}px, 10px)`;let Dr=`<svg xmlns="http://www.w3.org/2000/svg" width="${Pt}" height="${Pt}" viewBox="0 0 512 512"><rect x="128" y="128" width="336" height="336" rx="57" ry="57"></rect><path d="M383.5,128l.5-24a56.16,56.16,0,0,0-56-56H112a64.19,64.19,0,0,0-64,64V328a56.16,56.16,0,0,0,56,56h24"></path></svg>`,Ri=new DOMParser().parseFromString(Dr,"application/xml"),Gn=Oi.ownerDocument.importNode(Ri.documentElement,!0);Gn.style.marginLeft=`clamp(1px, ${s*Lt-10}px, 3px)`,Oi.appendChild(Gn),Gn.addEventListener("click",()=>window.navigator.clipboard.writeText(q.value)),Oi.addEventListener("click",()=>window.navigator.clipboard.writeText(q.value));let _n=document.createElement("div");_n.setAttribute("class","qrcode-tooltip"),_n.appendChild(Oi),d=I/_,s=I*w/m,_n.style.fontSize=s*Lt+"px",_n.style.top=ki*d+"px",_n.style.left=$t*s+(S-I*w)*.5+"px",_n.style.width=(Q-$t)*d+"px",_n.style.height=(Ue-ki)*d+"px";let fr=document.createElement("span");fr.innerText=q.value,fr.style.top=ki*d+-20*d+"px",fr.style.left=$t*s+(S-I*w)*.5+"px";let ve=n[1]?.font?.split(" ")?.[1];fr.style.fontFamily=ve,fr.style.fontSize=s*Lt+"px",fr.style.color=n?.[1]?.fillStyle,l?.appendChild(_n),l?.appendChild(fr)}l?.appendChild(X)}},glt=(a,r,l)=>{let n=r.getContext("2d",{willReadFrequently:!0});for(let s=0;s<a.length;s++){let d=a[s],m={},_=[],w=[],S=0,L=l[1]?.font?.split(" ")?.[0]?.replace(/[^0-9]/g,"");L&&/[0-9]/g.test(L)&&(S=parseFloat(L));let H=d.points;for(let Mt=0;Mt<H.length;Mt++){let Lt=H?.[Mt]?.x??0,Pt=H?.[Mt]?.y??0;m[`x${Mt+1}`]=Lt,m[`y${Mt+1}`]=Pt,_.push(Lt),w.push(Pt)}let q=Math.min(..._),X=Math.min(...w),it=()=>{for(let Pt in l[0])n[Pt]=l[0][Pt];let Mt=[];for(let Pt=0;Pt<_.length;Pt++)Mt.push(m[`x${Pt+1}`]),Mt.push(m[`y${Pt+1}`]);let Lt=Mt.slice(0);for(n.beginPath(),n.moveTo(Lt.shift(),Lt.shift());Lt.length;)n.lineTo(Lt.shift(),Lt.shift());n.closePath(),n.fill(),n.stroke()},at=document.createElement("canvas"),mt=()=>{let Mt=l[1]?.font?.split(" ")?.[1];at.height=r.height,at.width=r.width;let Lt=at.getContext("2d",{willReadFrequently:!0});Lt.font=S+"px "+Mt;for(let Pt in l[1])Lt[Pt]=l[1][Pt];ylt(Lt,d.value,q,X-5)};it(),mt(),n.drawImage(at,0,0)}},_lt=(a,r)=>{let l=r?.decode??Nc.decode,n=r?.canvasStyles?.length===2?r?.canvasStyles:[pT,fT],s=r?.isBeep??Nc.isBeep;return new Promise((d,m)=>{let _=new FileReader;_.onload=()=>{let w={name:a.name,file:a,url:URL.createObjectURL(a)},S=new Image;S.setAttribute("crossOrigin","anonymous"),S.onload=()=>Tt(void 0,null,function*(){let I=document.createElement("canvas");I.width=S.naturalWidth||S.width,I.height=S.naturalHeight||S.height;let L=I.getContext("2d");L.drawImage(S,0,0,I.width,I.height);let H=L.getImageData(0,0,I.width,I.height);if(Rx()){let q=yield zbarWasm.scanImageData(H);if(q?.length){q.forEach(mt=>mt.value=mt.decode(l?.toLocaleLowerCase())),glt(q,I,n);let X=yield DV(I),it=URL.createObjectURL(X);d(Object.assign({},w,{data:q,url:it,canvas:I,file:((mt,Mt)=>new File([mt],Mt,{lastModified:new Date().getTime(),type:mt.type}))(X,w.name)})),mT(s)}else d(Object.assign({},w,{data:q,canvas:I}))}}),S.src=w.url},_.onerror=w=>m(w),_.readAsDataURL(a)})},DV=(a,r)=>new Promise((l,n)=>a.toBlob(s=>l(s),r)),vlt=(a,r)=>new File([a],r,{lastModified:new Date().getTime(),type:a.type}),TV=(a=[],r,l,n,s=new Ks)=>(IV(a,l,n).then(d=>{Promise.all(Object.assign([],d).map(m=>_lt(m,r))).then(m=>{Kn(s,m)}).catch(m=>Kn(s,null,m))}),s),ylt=(a,r,l,n)=>{let s=a.measureText("M").width*1.2,d=r.split(`
`);for(var m=0;m<d.length;++m)a.fillText(d[m],l,n),a.strokeText(d[m],l,n),n+=s},IV=(a=[],r=100,l=100)=>{if(a.length&&(r<100||l<100)){let n=[];return new Promise((s,d)=>{for(let m of a){let _=new Image,w=new FileReader;w.onload=function(S){_.onload=function(){let I=document.createElement("canvas"),L=I.getContext("2d"),H=Math.round(_.width*(r/100)),q=Math.round(_.height*(r/100));I.width=H,I.height=q,L.drawImage(_,0,0,H,q),I.toBlob(X=>{let it=new File([X],m.name,{type:m.type});n.push(it),a.length===n.length&&s(n)},m.type,l/100)},_.src=S.target.result},w.onerror=S=>d(S),w.readAsDataURL(m)}})}else return Promise.resolve(a)},SV=a=>{Object.assign([],a.childNodes).forEach(r=>a.removeChild(r))},blt=a=>{a.getContext("2d",{willReadFrequently:!0}).clearRect(0,0,a.width,a.height)},hT=(a,r)=>{a.style.width=r.offsetWidth+"px",a.style.height=r.offsetHeight+"px"},EV=(a=300)=>{a&&xlt()&&window?.navigator?.vibrate(a)},xlt=()=>{let a=navigator.userAgent||navigator.vendor||window.opera,r=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i,l=/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i,n=/^((?!chrome|android).)*safari/i;return!!(r.test(a)||l.test(a.substr(0,4)))&&!n.test(a)},wlt=(()=>{let r=class r{loadFiles(n=[],s,d){let m=new Ks;return IV(n,s,d).then(_=>{Promise.all(Object.assign([],_).map(w=>this.readAsDataURL(w))).then(w=>Kn(m,w)).catch(w=>Kn(m,null,w))}),m}loadFilesToScan(n=[],s,d,m){return TV(n,s,d,m)}readAsDataURL(n){return new Promise((s,d)=>{let m=new FileReader;m.onload=()=>{let _={name:n.name,file:n,url:URL.createObjectURL(n)};s(_)},m.onerror=_=>d(_),m.readAsDataURL(n)})}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),Clt=(a=new Ks,r)=>{let l=0,n=(s=!1)=>{let d=()=>{let w;try{let S=()=>{clearTimeout(w),Rx()?setTimeout(()=>Kn(a,!0)):w=setTimeout(()=>S())};setTimeout(()=>S()),setTimeout(()=>clearTimeout(w),3e3)}catch{clearTimeout(w)}},m=document.querySelectorAll(`script[src="${Wg}"]`),_=document.querySelectorAll(`script[src="${mlt}"]`);if(m.length||_.length)d();else{let w=document.querySelectorAll(`script[src="${qg}"]`);if(w.length===1)d();else if(w.forEach(S=>S.remove()),r){let S=r.createElement("script");r.setAttribute(S,"src",s?Wg:qg),r.setAttribute(S,"type","text/javascript"),r.setAttribute(S,"async",""),r.appendChild(document.head,S),S.onload=()=>d(),S.onerror=()=>{l<2?(document.head.removeChild(S),n(!0)):Kn(a,!1,"Could not load script "+s?Wg:qg)},l+=1}else{let S=document.createElement("script");S.setAttribute("src",s?Wg:qg),S.setAttribute("type","text/javascript"),S.setAttribute("async",""),document.head.appendChild(S),S.onload=()=>d(),S.onerror=()=>{l<2?(document.head.removeChild(S),n(!0)):Kn(a,!1,"Could not load script "+s?Wg:qg)},l+=1}}};return n(),a},AV=(()=>{let r=class r{constructor(n,s){this.renderer=n,this.elementRef=s,this.event=new ye,this.src=Nc.src,this.fps=Nc.fps,this.vibrate=Nc.vibrate,this.decode=Nc.decode,this.isBeep=Nc.isBeep,this.config=Nc,this.constraints=Nc.constraints,this.canvasStyles=[pT,fT],this.isStart=!1,this.isPause=!1,this.isLoading=!1,this.isTorch=!1,this.data=new We([]),this.devices=new We([]),this.deviceIndexActive=0,this.dataForResize=[],this.ready=new Ks,this.STATUS={startON:()=>this.isStart=!0,pauseON:()=>this.isPause=!0,loadingON:()=>this.isLoading=!0,startOFF:()=>this.isStart=!1,pauseOFF:()=>this.isPause=!1,loadingOFF:()=>this.isLoading=!1,torchOFF:()=>this.isTorch=!1}}ngOnInit(){this.overrideConfig(),Clt(this.ready,this.renderer).subscribe(()=>{this.src&&this.loadImage(this.src),this.resize()})}start(n){let s=new Ks;return this.isStart?Kn(s,!1):this.safariWebRTC(s,n),s}stop(){this.STATUS.pauseOFF(),this.STATUS.startOFF(),this.STATUS.torchOFF(),this.STATUS.loadingOFF();let n=new Ks;try{clearTimeout(this.rAF_ID),this.video.nativeElement.srcObject.getTracks().forEach(s=>{s.stop(),Kn(n,!0)}),this.dataForResize=[],blt(this.canvas.nativeElement),SV(this.resultsPanel.nativeElement)}catch(s){Kn(n,!1,s)}return n}play(){let n=new Ks;return this.isPause?(this.video.nativeElement.play(),this.STATUS.pauseOFF(),this.requestAnimationFrame(),Kn(n,!0)):Kn(n,!1),n}pause(){let n=new Ks;return this.isStart?(clearTimeout(this.rAF_ID),this.video.nativeElement.pause(),this.STATUS.pauseON(),Kn(n,!0)):Kn(n,!1),n}playDevice(n,s=new Ks){let d=this.getConstraints(),m=this.isStart&&d?d.deviceId!==n:!0;switch(!0){case(n==="null"||n==="undefined"||!n):stop(),this.stop(),Kn(s,!1);break;case(n&&m):stop(),this.stop(),this.STATUS.loadingON(),this.deviceIndexActive=this.devices.value.findIndex(w=>w.deviceId===n);let _=Pi(qt({},this.constraints),{audio:!1,video:qt({deviceId:n},this.constraints.video)});navigator.mediaDevices.getUserMedia(_).then(w=>{this.video.nativeElement.srcObject=w,this.video.nativeElement.onloadedmetadata=()=>{this.video.nativeElement.play(),this.requestAnimationFrame(),Kn(s,!0),this.STATUS.startON(),this.STATUS.loadingOFF()}}).catch(w=>{this.eventEmit(!1),Kn(s,!1,w),this.STATUS.startOFF(),this.STATUS.loadingOFF()});break;default:Kn(s,!1),this.STATUS.loadingOFF();break}return s}loadImage(n){let s=new Ks;this.STATUS.startOFF(),this.STATUS.loadingON();let d=new Image;return d.setAttribute("crossOrigin","anonymous"),d.onload=()=>{Rx()&&this.drawImage(d,m=>{Kn(s,m),this.STATUS.startOFF(),this.STATUS.loadingOFF()})},d.src=n,s}torcher(){let n=this.applyConstraints({advanced:[{torch:this.isTorch}]});return n.subscribe(()=>!1,()=>this.isTorch=!this.isTorch),n}applyConstraints(n,s=0){let d=new Ks;if(this.isStart){let m=this.video.nativeElement.srcObject;if(s!==null||s!==void 0||!Number.isNaN(s)){let _=m.getVideoTracks()[s];new window.ImageCapture(_).getPhotoCapabilities().then(()=>Tt(this,null,function*(){yield _.applyConstraints(n),hT(this.video.nativeElement,this.canvas.nativeElement),Kn(d,!0)})).catch(S=>{switch(S?.name){case"NotFoundError":case"DevicesNotFoundError":Kn(d,!1,"Required track is missing");break;case"NotReadableError":case"TrackStartError":Kn(d,!1,"Webcam or mic are already in use");break;case"OverconstrainedError":case"ConstraintNotSatisfiedError":Kn(d,!1,"Constraints can not be satisfied by avb. devices");break;case"NotAllowedError":case"PermissionDeniedError":Kn(d,!1,"Permission denied in browser");break;case"TypeError":Kn(d,!1,"Empty constraints object");break;default:Kn(d,!1,S);break}})}else Kn(d,!1,"Please check again deviceIndex")}else Kn(d,!1,"Please start the scanner");return d}getConstraints(n=0){return this.video.nativeElement.srcObject?.getVideoTracks()[n]?.getConstraints()}download(n=`ngx_scanner_qrcode_${Date.now()}.png`,s,d){let m=new Ks;return Tt(this,null,function*(){let _=yield DV(this.canvas.nativeElement),w=vlt(_,n);TV([w],this.config,s,d,m).subscribe(S=>{S.forEach(I=>{if(I?.data?.length){let L=document.createElement("a");L.href=I.url,L.download=I.name,L.click(),L.remove()}})})}),m}resize(){window.addEventListener("resize",()=>{CV(this.dataForResize,this.canvas.nativeElement,this.resultsPanel.nativeElement,this.canvasStyles),hT(this.video.nativeElement,this.canvas.nativeElement)})}overrideConfig(){"src"in this.config&&(this.src=this.config.src),"fps"in this.config&&(this.fps=this.config.fps),"vibrate"in this.config&&(this.vibrate=this.config.vibrate),"decode"in this.config&&(this.decode=this.config.decode),"isBeep"in this.config&&(this.isBeep=this.config.isBeep),"constraints"in this.config&&(this.constraints=flt("constraints",this.config,MV)),"canvasStyles"in this.config&&this.config?.canvasStyles?.length===2&&(this.canvasStyles=this.config.canvasStyles)}safariWebRTC(n,s){this.STATUS.startOFF(),this.STATUS.loadingON(),navigator.mediaDevices.getUserMedia(this.constraints).then(d=>{d.getTracks().forEach(m=>m.stop()),this.loadAllDevices(n,s)}).catch(d=>{Kn(n,!1,d),this.STATUS.startOFF(),this.STATUS.loadingOFF()})}loadAllDevices(n,s){navigator.mediaDevices.enumerateDevices().then(d=>{let m=d.filter(_=>_.kind=="videoinput");this.devices.next(m),m?.length>0?(Kn(n,m),s?s(m):this.playDevice(m[0].deviceId)):(Kn(n,!1,"No camera detected."),this.STATUS.startOFF(),this.STATUS.loadingOFF())}).catch(d=>{Kn(n,!1,d),this.STATUS.startOFF(),this.STATUS.loadingOFF()})}drawImage(n,s=()=>{}){return Tt(this,null,function*(){let d=this.canvas.nativeElement,m=d.getContext("2d",{willReadFrequently:!0});n instanceof HTMLImageElement&&(d.width=n.naturalWidth,d.height=n.naturalHeight,n.style.visibility="",this.video.nativeElement.style.visibility="hidden",this.renderer.setStyle(this.elementRef.nativeElement,"width",d.width+"px"),this.renderer.setStyle(this.elementRef.nativeElement,"maxWidth","100%"),this.renderer.setStyle(this.elementRef.nativeElement,"display","inline-block")),n instanceof HTMLVideoElement&&(d.width=n.videoWidth,d.height=n.videoHeight,n.style.visibility="",this.canvas.nativeElement.style.visibility="hidden"),hT(this.video.nativeElement,d),m.clearRect(0,0,d.width,d.height),m.drawImage(n,0,0,d.width,d.height);let _=m.getImageData(0,0,d.width,d.height),w=yield zbarWasm.scanImageData(_);if(w?.length){w.forEach(I=>I.value=I.decode(this.decode?.toLocaleLowerCase())),CV(w,Object.freeze(this.canvas.nativeElement),this.resultsPanel.nativeElement,this.canvasStyles);let S=()=>{this.eventEmit(w),this.dataForResize=w};n instanceof HTMLImageElement&&(s(!0),S(),EV(this.vibrate),mT(this.isBeep)),n instanceof HTMLVideoElement&&(S(),EV(this.vibrate),mT(this.isBeep))}else s(!1),SV(this.resultsPanel.nativeElement),this.dataForResize=[]})}eventEmit(n=!1){n!==!1&&this.data.next(n||[]),n!==!1&&this.event.emit(n||[])}requestAnimationFrame(n=100){try{clearTimeout(this.rAF_ID),this.rAF_ID=setTimeout(()=>{this.video.nativeElement.readyState===this.video.nativeElement.HAVE_ENOUGH_DATA&&(n=0,Rx()&&this.drawImage(this.video.nativeElement),this.isStart&&!this.isPause&&this.requestAnimationFrame(n))},n||this.fps)}catch{clearTimeout(this.rAF_ID)}}get isReady(){return this.ready}ngOnDestroy(){this.pause()}};r.\u0275fac=function(s){return new(s||r)(V(Lo),V(Ee))},r.\u0275cmp=St({type:r,selectors:[["ngx-scanner-qrcode"]],viewQuery:function(s,d){if(s&1&&(ze(dlt,5),ze(ult,5),ze(hlt,5)),s&2){let m;se(m=ae())&&(d.video=m.first),se(m=ae())&&(d.canvas=m.first),se(m=ae())&&(d.resultsPanel=m.first)}},hostAttrs:[1,"ngx-scanner-qrcode"],inputs:{src:"src",fps:"fps",vibrate:"vibrate",decode:"decode",isBeep:"isBeep",config:"config",constraints:"constraints",canvasStyles:"canvasStyles"},outputs:{event:"event"},exportAs:["scanner"],decls:6,vars:0,consts:[[1,"origin-overlay"],["resultsPanel",""],[1,"origin-canvas"],["canvas",""],["playsinline","",1,"origin-video"],["video",""]],template:function(s,d){s&1&&dt(0,"div",0,1)(2,"canvas",2,3)(4,"video",4,5)},styles:[`.ngx-scanner-qrcode{display:block;position:relative}.origin-overlay{width:100%;position:absolute}.origin-overlay span{z-index:2;text-align:left;position:absolute}.origin-overlay .qrcode-polygon{z-index:1;position:absolute}.origin-canvas{width:100%;position:absolute}.origin-video{width:100%;background-color:#262626}.qrcode-tooltip{z-index:3;position:absolute}.qrcode-tooltip:hover .qrcode-tooltip-temp{display:block;position:absolute;cursor:copy}.qrcode-tooltip:hover .qrcode-tooltip-temp:active{color:#afafaf}.qrcode-tooltip .qrcode-tooltip-temp{bottom:0;left:50%;color:#fff;text-align:left;display:none;width:max-content;word-wrap:break-word;transform:translate(-50%);transform-style:preserve-3d;background-color:#000000d0;box-shadow:1px 1px 20px #000000e0}.qrcode-tooltip .qrcode-tooltip-temp svg{cursor:pointer}.qrcode-tooltip .qrcode-tooltip-temp svg rect{fill:none;stroke:#fff;stroke-linejoin:round;stroke-width:32px}.qrcode-tooltip .qrcode-tooltip-temp svg path{fill:none;stroke:#fff;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px}.qrcode-tooltip .qrcode-tooltip-temp svg:active rect{stroke:#afafaf}.qrcode-tooltip .qrcode-tooltip-temp svg:active path{stroke:#afafaf}
`],encapsulation:2});let a=r;return a})();var kV=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275mod=Si({type:r}),r.\u0275inj=Ei({providers:[wlt]});let a=r;return a})();var RV=(()=>{let r=class r{constructor(n,s,d){this.http=n,this.identityService=s,this.snackBar=d,this.ticketSubject=new We({})}setTicket(n){this.ticketSubject.next(n)}getTicket(){return this.ticketSubject.asObservable()}validateTicket(n){return Tt(this,null,function*(){try{let s=yield Ne(this.http.get(be+"/tickets/validate/"+n,{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setTicket(s)}catch{this.snackBar.open("Ticket not found","Close",{duration:3e3})}})}};r.\u0275fac=function(s){return new(s||r)(ht(Hi),ht(oi),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function Mlt(a,r){if(a&1&&(T(0,"div",9)(1,"p"),B(2,"Biletul a fost scanat cu succes!"),k(),T(3,"p"),B(4),qo(5,"date"),k()()),a&2){let l=gt();z(4),ie("Data scanarii: ",AS(5,1,l.ticket.scannedAt,"dd/MM/yyyy HH:mm"),"")}}function Dlt(a,r){if(a&1&&(T(0,"div",10)(1,"p"),B(2,"Biletul a fost deja scanat!"),k(),T(3,"p"),B(4),qo(5,"date"),k()()),a&2){let l=gt();z(4),ie("Data scanarii: ",AS(5,1,l.ticket.scannedAt,"dd/MM/yyyy HH:mm"),"")}}function Tlt(a,r){a&1&&(T(0,"p",10),B(1,"Biletul a fost anulat!"),k())}var PV=(()=>{let r=class r{constructor(n,s,d,m){this.validateService=n,this.dialogRef=s,this.data=d,this.snackBar=m,this.ticket={}}ngOnInit(){return Tt(this,null,function*(){yield this.validateService.validateTicket(this.data),this.ticketSubscription=this.validateService.getTicket().subscribe(n=>{this.ticket=n})})}ngOnDestroy(){this.ticketSubscription?.unsubscribe()}onCloseClick(){this.dialogRef.close()}};r.\u0275fac=function(s){return new(s||r)(V(RV),V(er),V(jr),V(Je))},r.\u0275cmp=St({type:r,selectors:[["app-validate"]],standalone:!0,features:[At],decls:24,vars:9,consts:[[1,"modal-content"],[1,"modal-header","mb-4"],["id","exampleModalLabel",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],["class","text-success",4,"ngIf"],["class","text-danger",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"text-success"],[1,"text-danger"]],template:function(s,d){s&1&&(T(0,"div",0)(1,"div",1)(2,"h4",2),B(3,"Detalii bilet"),k(),T(4,"button",3),ct("click",function(){return d.onCloseClick()}),k()(),T(5,"div",4)(6,"h6"),B(7),k(),T(8,"p"),B(9),k(),ut(10,Mlt,6,4,"div",5)(11,Dlt,6,4,"div",6)(12,Tlt,2,0,"p",6),T(13,"h6"),B(14,"Detalii cumparator"),k(),T(15,"p"),B(16),k(),T(17,"p"),B(18),k(),T(19,"p"),B(20),k()(),T(21,"div",7)(22,"button",8),ct("click",function(){return d.onCloseClick()}),B(23,"Inchide"),k()()()),s&2&&(z(7),Te(d.ticket.ticketType==null?null:d.ticket.ticketType.event.title),z(2),ie("Categorie bilet: ",d.ticket.ticketType==null?null:d.ticket.ticketType.name,""),z(),W("ngIf",d.ticket.alreadyScanned==!1&&d.ticket.status=="CONFIRMED"),z(),W("ngIf",d.ticket.alreadyScanned==!0&&d.ticket.status=="CONFIRMED"),z(),W("ngIf",d.ticket.status=="CANCELED"),z(4),po("Nume: ",d.ticket.userFirstName," ",d.ticket.userLastName,""),z(2),ie("Username: ",d.ticket.username,""),z(2),ie("Email: ",d.ticket.userEmail,""))},dependencies:[Ve,pd],styles:[".modal-content[_ngcontent-%COMP%]{padding:20px}"]});let a=r;return a})();var Ilt=["action"];function Alt(a,r){if(a&1&&(T(0,"option",6),B(1),k()),a&2){let l=r.$implicit;W("value",l.deviceId),z(),po(" ",l.kind," | ",l.label," ")}}function klt(a,r){a&1&&dt(0,"app-loading")}var Rlt=()=>({isBeep:!1}),OV=(()=>{let r=class r{constructor(n){this.dialog=n,this.dialogRef=null}ngAfterViewInit(){setTimeout(()=>{this.action.start(),this.action.data.subscribe(n=>{let s=n[0];if(s?.value){this.action.stop();let d=s.value;this.dialogRef=this.dialog.open(PV,{data:d}),this.dialogRef.afterClosed().subscribe(()=>{this.dialogRef=null,this.action.start()})}})},0)}ngOnDestroy(){this.action.data.unsubscribe(),this.dialogRef&&this.dialogRef.close(),this.action.isStart&&this.action.stop()}onDeviceChange(n){this.action.playDevice(n.value)}};r.\u0275fac=function(s){return new(s||r)(V(Kr))},r.\u0275cmp=St({type:r,selectors:[["app-validate"]],viewQuery:function(s,d){if(s&1&&ze(Ilt,5),s&2){let m;se(m=ae())&&(d.action=m.first)}},standalone:!0,features:[At],decls:6,vars:4,consts:[[1,"form-select",3,"change"],[3,"value",4,"ngFor","ngForOf"],[1,"camera"],[1,"video",3,"config"],["action","scanner"],[4,"ngIf"],[3,"value"]],template:function(s,d){if(s&1&&(T(0,"select",0),ct("change",function(_){return d.onDeviceChange(_.target)}),ut(1,Alt,2,3,"option",1),k(),T(2,"div",2),dt(3,"ngx-scanner-qrcode",3,4),k(),ut(5,klt,1,0,"app-loading",5)),s&2){let m=oo(4);z(),W("ngForOf",m.devices.value),z(2),W("config",Ln(3,Rlt)),z(2),W("ngIf",m.isLoading)}},dependencies:[Ve,iy,kV,AV,pi,Ni,Fs,Ls],styles:[".form-select[_ngcontent-%COMP%]{margin-bottom:1rem}.camera[_ngcontent-%COMP%]{margin:0 auto;width:90%;height:auto;position:relative;display:flex;justify-content:center;align-items:center}.video[_ngcontent-%COMP%]{width:100%;height:auto;position:absolute;top:0;left:0}"]});let a=r;return a})();var FV=(()=>{let r=class r{constructor(n,s,d){this.route=n,this.identityService=s,this.snackBar=d,this.verified=!1}ngOnInit(){let n=this.route.snapshot.params.token;this.identityService.verifyAccount(n).subscribe({next:()=>{this.verified=!0},error:s=>{this.verified=!1,this.snackBar.open(s.error.message,"Close",{duration:5e3})}})}};r.\u0275fac=function(s){return new(s||r)(V(Tn),V(oi),V(Je))},r.\u0275cmp=St({type:r,selectors:[["app-verify-account"]],standalone:!0,features:[At],decls:3,vars:0,consts:[[1,"container-fluid"]],template:function(s,d){s&1&&(T(0,"div",0)(1,"h1"),B(2,"Contul a fost verificat!"),k()())}});let a=r;return a})();var LV=(()=>{let r=class r{constructor(n,s,d){this.route=n,this.identityService=s,this.snackBar=d}ngOnInit(){let n=this.route.snapshot.params.email;this.identityService.resendVerifyAccountEmail(n).subscribe({next:()=>{},error:s=>{this.snackBar.open("Error sending email: "+s.error,"Close",{duration:5e3})}})}};r.\u0275fac=function(s){return new(s||r)(V(Tn),V(oi),V(Je))},r.\u0275cmp=St({type:r,selectors:[["app-resend-verify-account-email"]],standalone:!0,features:[At],decls:3,vars:0,consts:[[1,"container-fluid"]],template:function(s,d){s&1&&(T(0,"div",0)(1,"h1"),B(2,"A fost retrimis emailul de verificare."),k()())}});let a=r;return a})();var qu=(()=>{let r=class r{constructor(n,s){this.router=n,this.identityService=s}canActivate(n,s){return this.identityService.isLoggedIn()?(this.router.navigate(["/"]),!1):!0}};r.\u0275fac=function(s){return new(s||r)(ht(zi),ht(oi))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var Px=(()=>{let r=class r{constructor(n,s){this.http=n,this.snackBar=s,this.artistListSubject=new We([]),this.artistSubject=new We({})}setArtistList(n){this.artistListSubject.next(n)}getArtistList(){return this.artistListSubject.asObservable()}setArtist(n){this.artistSubject.next(n)}getArtist(){return this.artistSubject.asObservable()}fetchArtists(n){return Tt(this,null,function*(){try{let s=yield Ne(this.http.get(be+"/artists/first-letter/"+n));this.setArtistList(s)}catch{this.snackBar.open("Failed to fetch artists","Close",{duration:3e3})}})}fetchArtistById(n){return Tt(this,null,function*(){try{let s=yield Ne(this.http.get(be+"/artists/"+n));this.setArtist(s)}catch{this.snackBar.open("Failed to fetch artist","Close",{duration:3e3})}})}};r.\u0275fac=function(s){return new(s||r)(ht(Hi),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var Plt=a=>["/artists",a];function Olt(a,r){if(a&1&&(T(0,"a",6),B(1),k()),a&2){let l=r.$implicit;W("routerLink",xi(2,Plt,l)),z(),Te(l)}}function Flt(a,r){if(a&1&&(T(0,"span",14),B(1),k()),a&2){let l=r.$implicit;z(),Te(l.name)}}var Llt=()=>["/events"],zlt=a=>({artist:a});function Nlt(a,r){if(a&1&&(T(0,"div",7),dt(1,"img",8),T(2,"div",9)(3,"h5",10),B(4),k()(),T(5,"div",11)(6,"p",12),ut(7,Flt,2,1,"span",13),k()()()),a&2){let l=r.$implicit;W("routerLink",Ln(6,Llt))("queryParams",xi(7,zlt,l.name)),z(),Qh("alt","",l.name," image"),W("src",l.imageUrl,Vr),z(3),Te(l.name),z(3),W("ngForOf",l.genreList)}}var NV=(()=>{let r=class r{constructor(n,s){this.route=n,this.artistsService=s,this.letters=[],this.artists=[]}ngOnInit(){for(let n=65;n<=90;n++)this.letters.push(String.fromCharCode(n));this.route.params.subscribe(n=>Tt(this,null,function*(){yield this.artistsService.fetchArtists(n.letter),this.artistSubscription=this.artistsService.getArtistList().subscribe(s=>{this.artists=s})}))}ngOnDestroy(){this.artistSubscription?.unsubscribe()}};r.\u0275fac=function(s){return new(s||r)(V(Tn),V(Px))},r.\u0275cmp=St({type:r,selectors:[["app-artists-list"]],standalone:!0,features:[At],decls:8,vars:2,consts:[[1,"container-fluid"],[1,"h3","mb-4","text-gray-800"],[1,"links-container"],["routerLinkActive","active","class","letter-link",3,"routerLink",4,"ngFor","ngForOf"],[1,"artist-list-container"],["class","artist-list-item card",3,"routerLink","queryParams",4,"ngFor","ngForOf"],["routerLinkActive","active",1,"letter-link",3,"routerLink"],[1,"artist-list-item","card",3,"routerLink","queryParams"],[1,"card-img-top",3,"src","alt"],[1,"card-header"],[1,"card-title"],[1,"card-body"],[1,"card-text"],["class","badge badge-primary",4,"ngFor","ngForOf"],[1,"badge","badge-primary"]],template:function(s,d){s&1&&(T(0,"div",0)(1,"h1",1),B(2,"Artisti"),k(),T(3,"div",2),ut(4,Olt,2,4,"a",3),k(),dt(5,"hr"),T(6,"div",4),ut(7,Nlt,8,9,"div",5),k()()),s&2&&(z(4),W("ngForOf",d.letters),z(3),W("ngForOf",d.artists))},dependencies:[pi,kn,m3],styles:[".links-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;flex-direction:row;gap:10px}h1[_ngcontent-%COMP%]{text-align:center;margin:20px 0}.letter-link[_ngcontent-%COMP%]{font-size:1.2rem;transition:all .3s}.artist-list-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;flex-direction:row;flex-wrap:wrap;gap:20px}.card[_ngcontent-%COMP%]{width:350px;height:500px;margin-bottom:20px;box-shadow:0 4px 8px #0003;transition:.3s;border-radius:5px;background-color:#f8f9fa;color:#000;text-align:center;cursor:pointer}img[_ngcontent-%COMP%]{width:100%;height:300px;object-fit:cover;border-radius:5px}.active[_ngcontent-%COMP%]{font-weight:700}"]});let a=r;return a})();var Blt=(a,r)=>["/",a,r],Vlt=a=>({id:a});function jlt(a,r){if(a&1&&(T(0,"div",6)(1,"div",7),dt(2,"img",8),k(),T(3,"div",9)(4,"h5",10),B(5),k(),T(6,"p",11),B(7),k(),T(8,"p",12),B(9),k()()()),a&2){let l=r.$implicit;W("routerLink",Jh(6,Blt,l.location.name,l.title))("queryParams",xi(9,Vlt,l.id)),z(2),Js("src",l.imageUrl,Vr),z(3),Te(l.title),z(2),Te(l.date),z(2),ie("",l.shortDescription.substring(0,600)," ...")}}function Ult(a,r){if(a&1&&(T(0,"div",1)(1,"h1"),B(2),k(),dt(3,"img",2),T(4,"div",3)(5,"div",4),ut(6,jlt,10,11,"div",5),k()()()),a&2){let l=gt();z(2),Te(l.artist.name),z(),Js("src",l.artist.imageUrl,Vr),z(3),W("ngForOf",l.artist.eventList)}}var BV=(()=>{let r=class r{constructor(n,s){this.route=n,this.artistsService=s}ngOnInit(){this.route.queryParams.subscribe(n=>Tt(this,null,function*(){yield this.artistsService.fetchArtistById(n.id),this.artistSubscription=this.artistsService.getArtist().subscribe({next:s=>{this.artist=s}})}))}ngOnDestroy(){this.artistSubscription?.unsubscribe()}};r.\u0275fac=function(s){return new(s||r)(V(Tn),V(Px))},r.\u0275cmp=St({type:r,selectors:[["app-artist"]],standalone:!0,features:[At],decls:1,vars:1,consts:[["class","container-fluid",4,"ngIf"],[1,"container-fluid"],["alt","",1,"img-fluid","artist-image","d-none","d-sm-block",3,"src"],[1,"row"],[1,"col-12"],["role","button","class","card event-card rounded mb-3 mt-3",3,"routerLink","queryParams",4,"ngFor","ngForOf"],["role","button",1,"card","event-card","rounded","mb-3","mt-3",3,"routerLink","queryParams"],[1,"d-flex","justify-content-center","align-items-center"],["alt","",1,"img-fluid","event-image",3,"src"],[1,"card-body"],[1,"card-title"],[1,"card-text","card-date"],[1,"card-text"]],template:function(s,d){s&1&&ut(0,Ult,7,3,"div",0),s&2&&W("ngIf",d.artist)},dependencies:[Ve,pi,kn],styles:[".container-fluid[_ngcontent-%COMP%]{width:90%}.event-card[_ngcontent-%COMP%]{display:flex;flex-direction:row;width:calc(100% - 20px);max-width:100%}.event-card[_ngcontent-%COMP%]:hover{box-shadow:0 0 10px #0003;opacity:.8}.event-image[_ngcontent-%COMP%]{max-height:300px;max-width:200px;height:auto;width:auto}.card-body[_ngcontent-%COMP%]{overflow:hidden}.artist-image[_ngcontent-%COMP%]{max-height:300px;width:100%;object-fit:cover}.card-text[_ngcontent-%COMP%]{font-size:16px}@media (max-width: 768px){.card-title[_ngcontent-%COMP%], .card-text[_ngcontent-%COMP%]{font-size:13px}}@media (max-width: 576px){.event-card[_ngcontent-%COMP%]{flex-direction:column;padding-top:10px}.card-title[_ngcontent-%COMP%], .card-text[_ngcontent-%COMP%]{font-size:12px}.image-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.card-title[_ngcontent-%COMP%], .card-date[_ngcontent-%COMP%]{text-align:end}}"]});let a=r;return a})();var VV=(()=>{let r=class r{constructor(n,s,d){this.http=n,this.identityService=s,this.snackBar=d,this.genreListSubject=new We({})}setGenreList(n){this.genreListSubject.next(n)}getGenreList(){return this.genreListSubject.asObservable()}fetchGenres(){return Tt(this,null,function*(){try{let n=yield Ne(this.http.get(be+"/genres",{headers:{Authorization:"Bearer "+this.identityService.getToken()}}));this.setGenreList(n)}catch{this.snackBar.open("Failed to fetch genres","Dismiss",{duration:3e3})}})}};r.\u0275fac=function(s){return new(s||r)(ht(Hi),ht(oi),ht(Je))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function Glt(a,r){if(a&1&&(T(0,"option",14),B(1),k()),a&2){let l=r.$implicit;W("ngValue",l),z(),Te(l.name)}}function qlt(a,r){a&1&&(T(0,"div",15),B(1," Name is required "),k())}var jV=(()=>{let r=class r{constructor(n,s,d,m){this.dialogRef=n,this.data=s,this.fb=d,this.manageGenresService=m,this.genreList=[],this.registrationForm=this.fb.group({name:["",Le.required]})}ngOnInit(){return Tt(this,null,function*(){yield this.manageGenresService.fetchGenres(),this.genreListSubscription=this.manageGenresService.getGenreList().subscribe(n=>{this.genreList=n})})}ngOnDestroy(){this.genreListSubscription?.unsubscribe()}onCloseClick(){this.dialogRef.close()}onConfirmClick(){this.registrationForm.markAllAsTouched(),this.registrationForm.valid&&this.dialogRef.close(this.registrationForm.value.name)}};r.\u0275fac=function(s){return new(s||r)(V(er),V(jr),V(Er),V(VV))},r.\u0275cmp=St({type:r,selectors:[["app-add-genre"]],standalone:!0,features:[At],decls:18,vars:3,consts:[[1,"modal-content"],[1,"modal-header","mb-5"],["id","exampleModalLabel",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body","mb-3"],[3,"formGroup"],[1,"mb-3"],["for","name",1,"form-label"],["id","name","name","name","formControlName","name","required","",1,"form-select"],[3,"ngValue",4,"ngFor","ngForOf"],["class","text-danger mb-4",4,"ngIf"],[1,"modal-footer","mt-2"],["type","button",1,"btn","btn-secondary","me-1",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[3,"ngValue"],[1,"text-danger","mb-4"]],template:function(s,d){if(s&1&&(T(0,"div",0)(1,"div",1)(2,"h5",2),B(3,"Add genre"),k(),T(4,"button",3),ct("click",function(){return d.onCloseClick()}),k()(),T(5,"div",4)(6,"form",5)(7,"div",6)(8,"label",7),B(9,"Genre"),k(),T(10,"select",8),ut(11,Glt,2,2,"option",9),k()(),ut(12,qlt,2,0,"div",10),k(),T(13,"div",11)(14,"button",12),ct("click",function(){return d.onCloseClick()}),B(15,"Cancel"),k(),T(16,"button",13),ct("click",function(){return d.onConfirmClick()}),B(17,"Save changes"),k()()()()),s&2){let m;z(6),W("formGroup",d.registrationForm),z(5),W("ngForOf",d.genreList),z(),W("ngIf",((m=d.registrationForm.get("name"))==null||m.errors==null?null:m.errors.required)&&((m=d.registrationForm.get("name"))==null?null:m.touched))}},dependencies:[Ni,Sr,Fs,Ls,Ca,qi,Cr,Yr,Xr,Ve,Mn,Hn,hr,pi],styles:[".modal-content[_ngcontent-%COMP%]{padding:20px}"]});let a=r;return a})();var Wlt=["fileInput"];function $lt(a,r){a&1&&(T(0,"div",26),B(1," Name is required "),k())}function Ylt(a,r){if(a&1){let l=we();T(0,"div",27),dt(1,"img",28),T(2,"button",29),ct("click",function(){Kt(l);let s=gt();return Qt(s.removeImage())}),dt(3,"i",30),k()()}if(a&2){let l=gt();z(),W("src",l.imageSrc,Vr)}}function Zlt(a,r){a&1&&(T(0,"div",26),B(1," Image is required "),k())}function Xlt(a,r){a&1&&(T(0,"th",31),B(1," Name "),k())}function Klt(a,r){if(a&1&&(T(0,"td",32),B(1),k()),a&2){let l=r.$implicit;z(),ie(" ",l.name," ")}}function Qlt(a,r){a&1&&(T(0,"th",31),B(1," Action "),k())}function Jlt(a,r){if(a&1){let l=we();T(0,"td",32)(1,"button",33),ct("click",function(){let d=Kt(l).$implicit,m=gt();return Qt(m.onDeleteGenre(d))}),T(2,"mat-icon"),B(3,"delete"),k()()()}}function tct(a,r){a&1&&dt(0,"tr",34)}function ect(a,r){a&1&&dt(0,"tr",35)}var UV=()=>["name","action"],gT=(()=>{let r=class r{constructor(n,s,d,m,_,w){this.dialogRef=n,this.data=s,this.fb=d,this.manageLocationsService=m,this.snackBar=_,this.dialog=w,this.imageSrc=null,this.imageFile=null,this.isImageNull=!1,this.dataSource=new gs,this.registrationForm=this.fb.group({name:[this.data.artist.name,[Le.required,Le.maxLength(50)]]})}ngOnInit(){this.dataSource.data=this.data.artist.genreList,this.imageSrc=this.data.artist.imageUrl,this.isImageNull=this.imageSrc===null}onCloseClick(){this.dialogRef.close()}onConfirmClick(){if(this.registrationForm.markAllAsTouched(),this.registrationForm.valid){let n=Pi(qt({},this.registrationForm.value),{id:this.data.artist.id,imageUrl:this.imageSrc,genreList:this.dataSource.data});this.imageFile===null&&this.imageSrc!=""?this.dialogRef.close(n):this.imageFile!==null?(n=Pi(qt({},n),{image:this.imageFile}),this.dialogRef.close(n)):(this.isImageNull=!0,setTimeout(()=>{this.isImageNull=!1},2e3))}}onFileSelected(n){if(this.imageFile=n.target.files[0],this.imageFile){let s=new FileReader;s.onload=()=>{this.imageSrc=s.result},s.readAsDataURL(this.imageFile)}}removeImage(){this.imageSrc="",this.imageFile=null,this.fileInput.nativeElement.value=""}onAddGenre(){this.dialog.open(jV).afterClosed().subscribe(s=>{s&&(this.dataSource.data=[...this.dataSource.data,s])})}onDeleteGenre(n){this.dataSource.data=this.dataSource.data.filter(s=>s!==n)}};r.\u0275fac=function(s){return new(s||r)(V(er),V(jr),V(Er),V(Xm),V(Je),V(Kr))},r.\u0275cmp=St({type:r,selectors:[["app-add-edit-artist"]],viewQuery:function(s,d){if(s&1&&ze(Wlt,5),s&2){let m;se(m=ae())&&(d.fileInput=m.first)}},standalone:!0,features:[At],decls:36,vars:10,consts:[[1,"modal-content"],[1,"modal-header","mb-5"],["id","exampleModalLabel",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body","mb-3"],[3,"formGroup"],[1,"mb-3"],["mdbInput","","type","text","id","name","formControlName","name",1,"form-control"],["title",""],["mdbLabel","","for","name",1,"form-label"],["class","text-danger mb-4",4,"ngIf"],["type","file","id","image","accept",".jpg, .jpeg, .png, .bmp",1,"form-control",3,"change"],["fileInput",""],["class","mt-2 ms-1",4,"ngIf"],[1,"mt-4"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","action"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"btn","btn-primary",3,"click"],[1,"modal-footer","mt-2"],["type","button",1,"btn","btn-secondary","me-1",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"text-danger","mb-4"],[1,"mt-2","ms-1"],["alt","image",1,"img-fluid",2,"max-height","200px","max-width","200px",3,"src"],[1,"btn","btn-tertiary","ms-2",3,"click"],[1,"fa-solid","fa-x"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(s,d){if(s&1&&(T(0,"div",0)(1,"div",1)(2,"h5",2),B(3),k(),T(4,"button",3),ct("click",function(){return d.onCloseClick()}),k()(),T(5,"div",4)(6,"form",5)(7,"mdb-form-control",6),dt(8,"input",7,8),T(10,"label",9),B(11,"Nume"),k()(),ut(12,$lt,2,0,"div",10),k()(),T(13,"input",11,12),ct("change",function(_){return d.onFileSelected(_)}),k(),ut(15,Ylt,4,1,"div",13)(16,Zlt,2,0,"div",10),T(17,"div",14)(18,"h6"),B(19,"Genuri"),k(),T(20,"table",15),br(21,16),ut(22,Xlt,2,0,"th",17)(23,Klt,2,1,"td",18),xr(),br(24,19),ut(25,Qlt,2,0,"th",17)(26,Jlt,4,0,"td",18),xr(),ut(27,tct,1,0,"tr",20)(28,ect,1,0,"tr",21),k(),T(29,"button",22),ct("click",function(){return d.onAddGenre()}),B(30," Adauga Gen "),k()(),T(31,"div",23)(32,"button",24),ct("click",function(){return d.onCloseClick()}),B(33," Cancel "),k(),T(34,"button",25),ct("click",function(){return d.onConfirmClick()}),B(35,"Save changes"),k()()()),s&2){let m;z(3),Te(d.data.title),z(3),W("formGroup",d.registrationForm),z(6),W("ngIf",((m=d.registrationForm.get("name"))==null?null:m.invalid)&&((m=d.registrationForm.get("name"))==null?null:m.touched)),z(3),W("ngIf",d.imageSrc!==""),z(),W("ngIf",d.isImageNull),z(4),W("dataSource",d.dataSource),z(7),W("matHeaderRowDef",Ln(8,UV)),z(),W("matRowDefColumns",Ln(9,UV))}},dependencies:[Ni,Sr,en,qi,Cr,La,Ra,Oa,Fa,Ba,za,Hy,Ac,Va,Na,ka,Xr,fo,go,lo,Ve,Mn,Hn,hr,Pa],styles:[".modal-content[_ngcontent-%COMP%]{padding:20px}"]});let a=r;return a})();var HV=(()=>{let r=class r{transform(n,...s){return Array.isArray(n)?n.map(d=>d.name).join(", "):n}};r.\u0275fac=function(s){return new(s||r)},r.\u0275pipe=vv({name:"genreListNames",type:r,pure:!0,standalone:!0});let a=r;return a})();function ict(a,r){if(a&1){let l=we();T(0,"div",22)(1,"button",23),ct("click",function(){Kt(l);let s=gt();return Qt(s.removeFilter())}),B(2,"Sterge filtrul"),k()()}}function nct(a,r){if(a&1&&(T(0,"th",26),B(1),k()),a&2){let l=gt().$implicit,n=gt();z(),ie(" ",n.columnMap[l]," ")}}function rct(a,r){if(a&1&&(T(0,"td",27),B(1),qo(2,"genreListNames"),k()),a&2){let l=r.$implicit,n=gt().$implicit;z(),ie(" ",ms(2,1,l[n])," ")}}function oct(a,r){if(a&1&&(br(0,24),ut(1,nct,2,1,"th",25)(2,rct,3,3,"td",16),xr()),a&2){let l=r.$implicit;W("matColumnDef",l)}}function sct(a,r){a&1&&(T(0,"th",28),B(1," Actiuni "),k())}function act(a,r){if(a&1){let l=we();T(0,"td",27)(1,"button",29),ct("click",function(){let d=Kt(l).$implicit,m=gt();return Qt(m.rowData=d)}),dt(2,"i",30),k()()}if(a&2){gt();let l=oo(25);z(),W("matMenuTriggerFor",l)}}function lct(a,r){a&1&&dt(0,"tr",31)}function cct(a,r){a&1&&dt(0,"tr",32)}var dct=()=>[5,10,20,50],GV=(()=>{let r=class r{constructor(n,s,d,m){this.dialog=n,this.manageArtistsService=s,this.route=d,this.router=m,this.dataSource=new gs,this.itemsCount=0,this.displayedColumns=["name","genreList"],this.searchValue="",this.selectedFilterOption="name",this.shouldDisplayRemoveFilterButton=!1,this.pageIndex=0,this.pageSize=5,this.columnMap={name:"Nume",genreList:"Gen"}}ngOnInit(){this.route.queryParams.subscribe(n=>Tt(this,null,function*(){this.pageIndex=n.page||0,this.pageSize=n.size||5,this.searchValue=n.search||"",this.selectedFilterOption=n.filter||"name",this.shouldDisplayRemoveFilterButton=!!(n.filter&&n.search),this.searchValue===""&&this.selectedFilterOption==="name"?yield this.fetchArtists():yield this.fetchFilteredArtists(),this.artistSubscription=this.manageArtistsService.getArtistListSubject().subscribe({next:s=>{this.dataSource.data=s.artistPage.content,this.itemsCount=s.count}})}))}fetchArtists(){return Tt(this,null,function*(){yield this.manageArtistsService.fetchPaginatedArtists(this.pageIndex,this.pageSize)})}fetchFilteredArtists(){return Tt(this,null,function*(){yield this.manageArtistsService.fetchPaginatedArtistsFiltered(this.pageIndex,this.pageSize,this.searchValue,this.selectedFilterOption)})}ngOnDestroy(){this.artistSubscription?.unsubscribe()}ngAfterViewInit(){this.paginator.length=this.itemsCount,this.paginator.pageIndex=this.pageIndex,this.paginator.pageSize=this.pageSize,this.dataSource.sort=this.sort}onPageChange(n){this.router.navigate([],{relativeTo:this.route,queryParams:{page:n.pageIndex,size:n.pageSize},queryParamsHandling:"merge"})}filterData(){this.searchValue!==""&&this.router.navigate([],{relativeTo:this.route,queryParams:{search:this.searchValue,filter:this.selectedFilterOption,page:0,size:this.pageSize},queryParamsHandling:"merge"})}handleDeleteKeyboardEvent(n){n.key==="Enter"&&this.filterData()}removeFilter(){this.router.navigate([],{relativeTo:this.route,queryParams:{filter:null,search:null,page:0,size:this.pageSize},queryParamsHandling:"merge"})}onAddClick(){this.dialog.open(gT,{width:"60%",data:{artist:{name:"",imageUrl:"",genreList:[]},title:"Adauga artist"},disableClose:!0}).afterClosed().subscribe(s=>Tt(this,null,function*(){s&&(s.genreList=JSON.stringify(s.genreList),yield this.manageArtistsService.addArtist(s,this.pageIndex,this.pageSize))}))}onEditClick(){this.dialog.open(gT,{width:"60%",data:{artist:this.rowData,title:"Modifica artist"},disableClose:!0}).afterClosed().subscribe(s=>Tt(this,null,function*(){s&&(yield this.manageArtistsService.updateArtist(s))}))}onDeleteClick(){this.dialog.open(Bd,{width:"30%"}).afterClosed().subscribe(s=>Tt(this,null,function*(){s&&(yield this.manageArtistsService.deleteArtist(this.rowData.id,this.pageIndex,this.pageSize),this.dataSource.data.length===0&&this.pageIndex>0&&(this.searchValue===""&&this.selectedFilterOption==="name"?yield this.router.navigate([],{relativeTo:this.route,queryParams:{page:this.pageIndex-1,size:this.pageSize,search:null,filter:null},queryParamsHandling:"merge"}):yield this.router.navigate([],{relativeTo:this.route,queryParams:{page:this.pageIndex-1,size:this.pageSize,search:this.searchValue,filter:this.selectedFilterOption},queryParamsHandling:"merge"})))}))}};r.\u0275fac=function(s){return new(s||r)(V(Kr),V(Nb),V(Tn),V(zi))},r.\u0275cmp=St({type:r,selectors:[["app-manage-artists"]],viewQuery:function(s,d){if(s&1&&(ze(Ua,5),ze(sa,5)),s&2){let m;se(m=ae())&&(d.paginator=m.first),se(m=ae())&&(d.sort=m.first)}},hostBindings:function(s,d){s&1&&ct("keydown",function(_){return d.handleDeleteKeyboardEvent(_)},!1,sl)},standalone:!0,features:[At],decls:30,vars:13,consts:[[1,"input-group","rounded","pt-2"],["type","search","placeholder","Cauta","aria-label","Search","aria-describedby","search-addon",1,"form-control","rounded",3,"ngModel","ngModelChange"],["id","search-addon",1,"input-group-text","border-0"],["role","button",1,"bg-primary","text-white","fas","fa-search","search-button",3,"click"],[1,"btn","btn-primary","ms-5","me-2",3,"click"],[1,"radio-group","mt-2"],[1,"form-check","form-check-inline"],["type","radio","name","radioGroup","id","name","value","name",1,"form-check-input",3,"ngModel","ngModelChange"],["for","name",1,"form-check-label"],["type","radio","name","radioGroup","id","genre","value","genre",1,"form-check-input",3,"ngModel","ngModelChange"],["for","genre",1,"form-check-label"],["class","form-check-inline",4,"ngIf"],["mat-table","","matSort","",3,"dataSource"],[3,"matColumnDef",4,"ngFor","ngForOf"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","","aria-label","Select page",3,"length","pageSize","pageIndex","pageSizeOptions","page"],["contextMenu","matMenu"],["mat-menu-item","",3,"click"],[1,"form-check-inline"],[1,"btn",3,"click"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-button","",3,"matMenuTriggerFor","click"],[1,"fa-solid","fa-pen-to-square"],["mat-header-row",""],["mat-row",""]],template:function(s,d){s&1&&(T(0,"div",0)(1,"input",1),Cn("ngModelChange",function(_){return wn(d.searchValue,_)||(d.searchValue=_),_}),k(),T(2,"span",2)(3,"i",3),ct("click",function(){return d.filterData()}),k(),T(4,"button",4),ct("click",function(){return d.onAddClick()}),B(5," Adauga "),k()()(),T(6,"div",5)(7,"div",6)(8,"input",7),Cn("ngModelChange",function(_){return wn(d.selectedFilterOption,_)||(d.selectedFilterOption=_),_}),k(),T(9,"label",8),B(10,"Nume"),k()(),T(11,"div",6)(12,"input",9),Cn("ngModelChange",function(_){return wn(d.selectedFilterOption,_)||(d.selectedFilterOption=_),_}),k(),T(13,"label",10),B(14,"Gen"),k()(),ut(15,ict,3,0,"div",11),k(),T(16,"table",12),ut(17,oct,3,1,"ng-container",13),br(18,14),ut(19,sct,2,0,"th",15)(20,act,3,1,"td",16),xr(),ut(21,lct,1,0,"tr",17)(22,cct,1,0,"tr",18),k(),T(23,"mat-paginator",19),ct("page",function(_){return d.onPageChange(_)}),k(),T(24,"mat-menu",null,20)(26,"button",21),ct("click",function(){return d.onEditClick()}),B(27," Modifica "),k(),T(28,"button",21),ct("click",function(){return d.onDeleteClick()}),B(29," Sterge "),k()()),s&2&&(z(),xn("ngModel",d.searchValue),z(7),xn("ngModel",d.selectedFilterOption),z(4),xn("ngModel",d.selectedFilterOption),z(3),W("ngIf",d.shouldDisplayRemoveFilterButton),z(),W("dataSource",d.dataSource),z(),W("ngForOf",d.displayedColumns),z(4),W("matHeaderRowDef",d.displayedColumns.concat("actions")),z(),W("matRowDefColumns",d.displayedColumns.concat("actions")),z(),W("length",d.itemsCount)("pageSize",d.pageSize)("pageIndex",d.pageIndex)("pageSizeOptions",Ln(12,dct)))},dependencies:[Ni,en,Tc,qi,To,ea,La,Ra,Oa,Fa,Ba,za,ja,yl,Ua,Va,Na,sa,Nd,ka,pi,Ve,Ld,Pa,HV],styles:["th[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.search-button[_ngcontent-%COMP%]{margin-left:5px;padding:.5rem 1rem;border-radius:.3rem}.search-button[_ngcontent-%COMP%]:hover{cursor:pointer;box-shadow:2px 4px 5px #0006}.input-group-text[_ngcontent-%COMP%]{padding-left:0}"]});let a=r;return a})();var uct=["mat-calendar-body",""];function hct(a,r){if(a&1&&(T(0,"tr",0)(1,"td",2),B(2),k()()),a&2){let l=gt();z(),Ec("padding-top",l._cellPadding)("padding-bottom",l._cellPadding),ri("colspan",l.numCols),z(),ie(" ",l.label," ")}}function mct(a,r){if(a&1&&(T(0,"td",2),B(1),k()),a&2){let l=gt(2);Ec("padding-top",l._cellPadding)("padding-bottom",l._cellPadding),ri("colspan",l._firstRowOffset),z(),ie(" ",l._firstRowOffset>=l.labelMinRequiredCells?l.label:""," ")}}function pct(a,r){if(a&1){let l=we();T(0,"td",5)(1,"button",6),ct("click",function(s){let m=Kt(l).$implicit,_=gt(2);return Qt(_._cellClicked(m,s))})("focus",function(s){let m=Kt(l).$implicit,_=gt(2);return Qt(_._emitActiveDateChange(m,s))}),T(2,"span",7),B(3),k(),dt(4,"span",8),k()()}if(a&2){let l=r.$implicit,n=r.$index,s=gt().$index,d=gt();Ec("width",d._cellWidth)("padding-top",d._cellPadding)("padding-bottom",d._cellPadding),ri("data-mat-row",s)("data-mat-col",n),z(),li("mat-calendar-body-disabled",!l.enabled)("mat-calendar-body-active",d._isActiveCell(s,n))("mat-calendar-body-range-start",d._isRangeStart(l.compareValue))("mat-calendar-body-range-end",d._isRangeEnd(l.compareValue))("mat-calendar-body-in-range",d._isInRange(l.compareValue))("mat-calendar-body-comparison-bridge-start",d._isComparisonBridgeStart(l.compareValue,s,n))("mat-calendar-body-comparison-bridge-end",d._isComparisonBridgeEnd(l.compareValue,s,n))("mat-calendar-body-comparison-start",d._isComparisonStart(l.compareValue))("mat-calendar-body-comparison-end",d._isComparisonEnd(l.compareValue))("mat-calendar-body-in-comparison-range",d._isInComparisonRange(l.compareValue))("mat-calendar-body-preview-start",d._isPreviewStart(l.compareValue))("mat-calendar-body-preview-end",d._isPreviewEnd(l.compareValue))("mat-calendar-body-in-preview",d._isInPreview(l.compareValue)),W("ngClass",l.cssClasses)("tabindex",d._isActiveCell(s,n)?0:-1),ri("aria-label",l.ariaLabel)("aria-disabled",!l.enabled||null)("aria-pressed",d._isSelected(l.compareValue))("aria-current",d.todayValue===l.compareValue?"date":null)("aria-describedby",d._getDescribedby(l.compareValue)),z(),li("mat-calendar-body-selected",d._isSelected(l.compareValue))("mat-calendar-body-comparison-identical",d._isComparisonIdentical(l.compareValue))("mat-calendar-body-today",d.todayValue===l.compareValue),z(),ie(" ",l.displayValue," ")}}function fct(a,r){if(a&1&&(T(0,"tr",3),ut(1,mct,2,6,"td",4),Xh(2,pct,5,48,"td",9,Zh),k()),a&2){let l=r.$implicit,n=r.$index,s=gt();z(),Xi(1,n===0&&s._firstRowOffset?1:-1),z(),Kh(l)}}function gct(a,r){if(a&1&&(T(0,"th",4)(1,"span",5),B(2),k(),T(3,"span",6),B(4),k()()),a&2){let l=r.$implicit;z(2),Te(l.long),z(2),Te(l.narrow)}}var _ct=["*"];function vct(a,r){}function yct(a,r){if(a&1){let l=we();T(0,"mat-month-view",2),Cn("activeDateChange",function(s){Kt(l);let d=gt();return wn(d.activeDate,s)||(d.activeDate=s),Qt(s)}),ct("_userSelection",function(s){Kt(l);let d=gt();return Qt(d._dateSelected(s))})("dragStarted",function(s){Kt(l);let d=gt();return Qt(d._dragStarted(s))})("dragEnded",function(s){Kt(l);let d=gt();return Qt(d._dragEnded(s))}),k()}if(a&2){let l=gt();xn("activeDate",l.activeDate),W("selected",l.selected)("dateFilter",l.dateFilter)("maxDate",l.maxDate)("minDate",l.minDate)("dateClass",l.dateClass)("comparisonStart",l.comparisonStart)("comparisonEnd",l.comparisonEnd)("startDateAccessibleName",l.startDateAccessibleName)("endDateAccessibleName",l.endDateAccessibleName)("activeDrag",l._activeDrag)}}function bct(a,r){if(a&1){let l=we();T(0,"mat-year-view",3),Cn("activeDateChange",function(s){Kt(l);let d=gt();return wn(d.activeDate,s)||(d.activeDate=s),Qt(s)}),ct("monthSelected",function(s){Kt(l);let d=gt();return Qt(d._monthSelectedInYearView(s))})("selectedChange",function(s){Kt(l);let d=gt();return Qt(d._goToDateInView(s,"month"))}),k()}if(a&2){let l=gt();xn("activeDate",l.activeDate),W("selected",l.selected)("dateFilter",l.dateFilter)("maxDate",l.maxDate)("minDate",l.minDate)("dateClass",l.dateClass)}}function xct(a,r){if(a&1){let l=we();T(0,"mat-multi-year-view",4),Cn("activeDateChange",function(s){Kt(l);let d=gt();return wn(d.activeDate,s)||(d.activeDate=s),Qt(s)}),ct("yearSelected",function(s){Kt(l);let d=gt();return Qt(d._yearSelectedInMultiYearView(s))})("selectedChange",function(s){Kt(l);let d=gt();return Qt(d._goToDateInView(s,"year"))}),k()}if(a&2){let l=gt();xn("activeDate",l.activeDate),W("selected",l.selected)("dateFilter",l.dateFilter)("maxDate",l.maxDate)("minDate",l.minDate)("dateClass",l.dateClass)}}function wct(a,r){}var Cct=["button"];function Sct(a,r){a&1&&(Rs(),T(0,"svg",3),dt(1,"path",4),k())}var Ect=[[["","matDatepickerToggleIcon",""]]],Mct=["[matDatepickerToggleIcon]"];var Fx=(()=>{let r=class r{constructor(){this.changes=new pe,this.calendarLabel="Calendar",this.openCalendarLabel="Open calendar",this.closeCalendarLabel="Close calendar",this.prevMonthLabel="Previous month",this.nextMonthLabel="Next month",this.prevYearLabel="Previous year",this.nextYearLabel="Next year",this.prevMultiYearLabel="Previous 24 years",this.nextMultiYearLabel="Next 24 years",this.switchToMonthViewLabel="Choose date",this.switchToMultiYearViewLabel="Choose month and year",this.startDateLabel="Start date",this.endDateLabel="End date"}formatYearRange(n,s){return`${n} \u2013 ${s}`}formatYearRangeLabel(n,s){return`${n} to ${s}`}};r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})(),Yg=class{constructor(r,l,n,s,d={},m=r,_){this.value=r,this.displayValue=l,this.ariaLabel=n,this.enabled=s,this.cssClasses=d,this.compareValue=m,this.rawValue=_}},Dct=1,qV=is({passive:!1,capture:!0}),Ud=is({passive:!0,capture:!0}),Ox=is({passive:!0}),np=(()=>{let r=class r{ngAfterViewChecked(){this._focusActiveCellAfterViewChecked&&(this._focusActiveCell(),this._focusActiveCellAfterViewChecked=!1)}constructor(n,s){this._elementRef=n,this._ngZone=s,this._platform=le(gn),this._focusActiveCellAfterViewChecked=!1,this.numCols=7,this.activeCell=0,this.isRange=!1,this.cellAspectRatio=1,this.previewStart=null,this.previewEnd=null,this.selectedValueChange=new ye,this.previewChange=new ye,this.activeDateChange=new ye,this.dragStarted=new ye,this.dragEnded=new ye,this._didDragSinceMouseDown=!1,this._enterHandler=d=>{if(this._skipNextFocus&&d.type==="focus"){this._skipNextFocus=!1;return}if(d.target&&this.isRange){let m=this._getCellFromElement(d.target);m&&this._ngZone.run(()=>this.previewChange.emit({value:m.enabled?m:null,event:d}))}},this._touchmoveHandler=d=>{if(!this.isRange)return;let m=WV(d),_=m?this._getCellFromElement(m):null;m!==d.target&&(this._didDragSinceMouseDown=!0),vT(d.target)&&d.preventDefault(),this._ngZone.run(()=>this.previewChange.emit({value:_?.enabled?_:null,event:d}))},this._leaveHandler=d=>{this.previewEnd!==null&&this.isRange&&(d.type!=="blur"&&(this._didDragSinceMouseDown=!0),d.target&&this._getCellFromElement(d.target)&&!(d.relatedTarget&&this._getCellFromElement(d.relatedTarget))&&this._ngZone.run(()=>this.previewChange.emit({value:null,event:d})))},this._mousedownHandler=d=>{if(!this.isRange)return;this._didDragSinceMouseDown=!1;let m=d.target&&this._getCellFromElement(d.target);!m||!this._isInRange(m.compareValue)||this._ngZone.run(()=>{this.dragStarted.emit({value:m.rawValue,event:d})})},this._mouseupHandler=d=>{if(!this.isRange)return;let m=vT(d.target);if(!m){this._ngZone.run(()=>{this.dragEnded.emit({value:null,event:d})});return}m.closest(".mat-calendar-body")===this._elementRef.nativeElement&&this._ngZone.run(()=>{let _=this._getCellFromElement(m);this.dragEnded.emit({value:_?.rawValue??null,event:d})})},this._touchendHandler=d=>{let m=WV(d);m&&this._mouseupHandler({target:m})},this._id=`mat-calendar-body-${Dct++}`,this._startDateLabelId=`${this._id}-start-date`,this._endDateLabelId=`${this._id}-end-date`,s.runOutsideAngular(()=>{let d=n.nativeElement;d.addEventListener("touchmove",this._touchmoveHandler,qV),d.addEventListener("mouseenter",this._enterHandler,Ud),d.addEventListener("focus",this._enterHandler,Ud),d.addEventListener("mouseleave",this._leaveHandler,Ud),d.addEventListener("blur",this._leaveHandler,Ud),d.addEventListener("mousedown",this._mousedownHandler,Ox),d.addEventListener("touchstart",this._mousedownHandler,Ox),this._platform.isBrowser&&(window.addEventListener("mouseup",this._mouseupHandler),window.addEventListener("touchend",this._touchendHandler))})}_cellClicked(n,s){this._didDragSinceMouseDown||n.enabled&&this.selectedValueChange.emit({value:n.value,event:s})}_emitActiveDateChange(n,s){n.enabled&&this.activeDateChange.emit({value:n.value,event:s})}_isSelected(n){return this.startValue===n||this.endValue===n}ngOnChanges(n){let s=n.numCols,{rows:d,numCols:m}=this;(n.rows||s)&&(this._firstRowOffset=d&&d.length&&d[0].length?m-d[0].length:0),(n.cellAspectRatio||s||!this._cellPadding)&&(this._cellPadding=`${50*this.cellAspectRatio/m}%`),(s||!this._cellWidth)&&(this._cellWidth=`${100/m}%`)}ngOnDestroy(){let n=this._elementRef.nativeElement;n.removeEventListener("touchmove",this._touchmoveHandler,qV),n.removeEventListener("mouseenter",this._enterHandler,Ud),n.removeEventListener("focus",this._enterHandler,Ud),n.removeEventListener("mouseleave",this._leaveHandler,Ud),n.removeEventListener("blur",this._leaveHandler,Ud),n.removeEventListener("mousedown",this._mousedownHandler,Ox),n.removeEventListener("touchstart",this._mousedownHandler,Ox),this._platform.isBrowser&&(window.removeEventListener("mouseup",this._mouseupHandler),window.removeEventListener("touchend",this._touchendHandler))}_isActiveCell(n,s){let d=n*this.numCols+s;return n&&(d-=this._firstRowOffset),d==this.activeCell}_focusActiveCell(n=!0){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(tn(1)).subscribe(()=>{setTimeout(()=>{let s=this._elementRef.nativeElement.querySelector(".mat-calendar-body-active");s&&(n||(this._skipNextFocus=!0),s.focus())})})})}_scheduleFocusActiveCellAfterViewChecked(){this._focusActiveCellAfterViewChecked=!0}_isRangeStart(n){return yT(n,this.startValue,this.endValue)}_isRangeEnd(n){return bT(n,this.startValue,this.endValue)}_isInRange(n){return xT(n,this.startValue,this.endValue,this.isRange)}_isComparisonStart(n){return yT(n,this.comparisonStart,this.comparisonEnd)}_isComparisonBridgeStart(n,s,d){if(!this._isComparisonStart(n)||this._isRangeStart(n)||!this._isInRange(n))return!1;let m=this.rows[s][d-1];if(!m){let _=this.rows[s-1];m=_&&_[_.length-1]}return m&&!this._isRangeEnd(m.compareValue)}_isComparisonBridgeEnd(n,s,d){if(!this._isComparisonEnd(n)||this._isRangeEnd(n)||!this._isInRange(n))return!1;let m=this.rows[s][d+1];if(!m){let _=this.rows[s+1];m=_&&_[0]}return m&&!this._isRangeStart(m.compareValue)}_isComparisonEnd(n){return bT(n,this.comparisonStart,this.comparisonEnd)}_isInComparisonRange(n){return xT(n,this.comparisonStart,this.comparisonEnd,this.isRange)}_isComparisonIdentical(n){return this.comparisonStart===this.comparisonEnd&&n===this.comparisonStart}_isPreviewStart(n){return yT(n,this.previewStart,this.previewEnd)}_isPreviewEnd(n){return bT(n,this.previewStart,this.previewEnd)}_isInPreview(n){return xT(n,this.previewStart,this.previewEnd,this.isRange)}_getDescribedby(n){return this.isRange?this.startValue===n&&this.endValue===n?`${this._startDateLabelId} ${this._endDateLabelId}`:this.startValue===n?this._startDateLabelId:this.endValue===n?this._endDateLabelId:null:null}_getCellFromElement(n){let s=vT(n);if(s){let d=s.getAttribute("data-mat-row"),m=s.getAttribute("data-mat-col");if(d&&m)return this.rows[parseInt(d)][parseInt(m)]}return null}};r.\u0275fac=function(s){return new(s||r)(V(Ee),V(Be))},r.\u0275cmp=St({type:r,selectors:[["","mat-calendar-body",""]],hostAttrs:[1,"mat-calendar-body"],inputs:{label:"label",rows:"rows",todayValue:"todayValue",startValue:"startValue",endValue:"endValue",labelMinRequiredCells:"labelMinRequiredCells",numCols:"numCols",activeCell:"activeCell",isRange:"isRange",cellAspectRatio:"cellAspectRatio",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",previewStart:"previewStart",previewEnd:"previewEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName"},outputs:{selectedValueChange:"selectedValueChange",previewChange:"previewChange",activeDateChange:"activeDateChange",dragStarted:"dragStarted",dragEnded:"dragEnded"},exportAs:["matCalendarBody"],standalone:!0,features:[Yn,At],attrs:uct,decls:7,vars:5,consts:[["aria-hidden","true"],[1,"mat-calendar-body-hidden-label",3,"id"],[1,"mat-calendar-body-label"],["role","row"],["class","mat-calendar-body-label",3,"paddingTop","paddingBottom"],["role","gridcell",1,"mat-calendar-body-cell-container"],["type","button",1,"mat-calendar-body-cell",3,"ngClass","tabindex","click","focus"],[1,"mat-calendar-body-cell-content","mat-focus-indicator"],["aria-hidden","true",1,"mat-calendar-body-cell-preview"],["role","gridcell","class","mat-calendar-body-cell-container",3,"width","paddingTop","paddingBottom"]],template:function(s,d){s&1&&(ut(0,hct,3,6,"tr",0),Xh(1,fct,4,1,"tr",3,Zh),T(3,"label",1),B(4),k(),T(5,"label",1),B(6),k()),s&2&&(Xi(0,d._firstRowOffset<d.labelMinRequiredCells?0:-1),z(),Kh(d.rows),z(2),W("id",d._startDateLabelId),z(),ie(" ",d.startDateAccessibleName,`
`),z(),W("id",d._endDateLabelId),z(),ie(" ",d.endDateAccessibleName,`
`))},dependencies:[Uo],styles:['.mat-calendar-body{min-width:224px}.mat-calendar-body-today:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){border-color:var(--mat-datepicker-calendar-date-today-outline-color)}.mat-calendar-body-label{height:0;line-height:0;text-align:start;padding-left:4.7142857143%;padding-right:4.7142857143%;font-size:var(--mat-datepicker-calendar-body-label-text-size);font-weight:var(--mat-datepicker-calendar-body-label-text-weight);color:var(--mat-datepicker-calendar-body-label-text-color)}.mat-calendar-body-hidden-label{display:none}.mat-calendar-body-cell-container{position:relative;height:0;line-height:0}.mat-calendar-body-cell{-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0);position:absolute;top:0;left:0;width:100%;height:100%;background:none;text-align:center;outline:none;font-family:inherit;margin:0}.mat-calendar-body-cell::-moz-focus-inner{border:0}.mat-calendar-body-cell::before,.mat-calendar-body-cell::after,.mat-calendar-body-cell-preview{content:"";position:absolute;top:5%;left:0;z-index:0;box-sizing:border-box;display:block;height:90%;width:100%}.mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-start::after,.mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,.mat-calendar-body-comparison-start::after,.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:5%;width:95%;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,[dir=rtl] .mat-calendar-body-comparison-start::after,[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:0;border-radius:0;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,.mat-calendar-body-comparison-end::after,.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}[dir=rtl] .mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,[dir=rtl] .mat-calendar-body-comparison-end::after,[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{left:5%;border-radius:0;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-comparison-bridge-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-bridge-end.mat-calendar-body-range-start::after{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end.mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-end.mat-calendar-body-range-start::after{width:90%}.mat-calendar-body-in-preview{color:var(--mat-datepicker-calendar-date-preview-state-outline-color)}.mat-calendar-body-in-preview .mat-calendar-body-cell-preview{border-top:dashed 1px;border-bottom:dashed 1px}.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:dashed 1px}[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:0;border-right:dashed 1px}.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:dashed 1px}[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:0;border-left:dashed 1px}.mat-calendar-body-disabled{cursor:default}.mat-calendar-body-disabled>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){color:var(--mat-datepicker-calendar-date-disabled-state-text-color)}.mat-calendar-body-disabled>.mat-calendar-body-today:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){border-color:var(--mat-datepicker-calendar-date-today-disabled-state-outline-color)}.cdk-high-contrast-active .mat-calendar-body-disabled{opacity:.5}.mat-calendar-body-cell-content{top:5%;left:5%;z-index:1;display:flex;align-items:center;justify-content:center;box-sizing:border-box;width:90%;height:90%;line-height:1;border-width:1px;border-style:solid;border-radius:999px;color:var(--mat-datepicker-calendar-date-text-color);border-color:var(--mat-datepicker-calendar-date-outline-color)}.mat-calendar-body-cell-content.mat-focus-indicator{position:absolute}.cdk-high-contrast-active .mat-calendar-body-cell-content{border:none}.cdk-keyboard-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical),.cdk-program-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){background-color:var(--mat-datepicker-calendar-date-focus-state-background-color)}@media(hover: hover){.mat-calendar-body-cell:not(.mat-calendar-body-disabled):hover>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){background-color:var(--mat-datepicker-calendar-date-hover-state-background-color)}}.mat-calendar-body-selected{background-color:var(--mat-datepicker-calendar-date-selected-state-background-color);color:var(--mat-datepicker-calendar-date-selected-state-text-color)}.mat-calendar-body-disabled>.mat-calendar-body-selected{background-color:var(--mat-datepicker-calendar-date-selected-disabled-state-background-color)}.mat-calendar-body-selected.mat-calendar-body-today{box-shadow:inset 0 0 0 1px var(--mat-datepicker-calendar-date-today-selected-state-outline-color)}.mat-calendar-body-in-range::before{background:var(--mat-datepicker-calendar-date-in-range-state-background-color)}.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range::before{background:var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color)}.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range::before{background:var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color)}.mat-calendar-body-comparison-bridge-start::before,[dir=rtl] .mat-calendar-body-comparison-bridge-end::before{background:linear-gradient(to right, var(--mat-datepicker-calendar-date-in-range-state-background-color) 50%, var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color) 50%)}.mat-calendar-body-comparison-bridge-end::before,[dir=rtl] .mat-calendar-body-comparison-bridge-start::before{background:linear-gradient(to left, var(--mat-datepicker-calendar-date-in-range-state-background-color) 50%, var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color) 50%)}.mat-calendar-body-in-range>.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range.mat-calendar-body-in-range::after{background:var(--mat-datepicker-calendar-date-in-overlap-range-state-background-color)}.mat-calendar-body-comparison-identical.mat-calendar-body-selected,.mat-calendar-body-in-comparison-range>.mat-calendar-body-selected{background:var(--mat-datepicker-calendar-date-in-overlap-range-selected-state-background-color)}.cdk-high-contrast-active .mat-datepicker-popup:not(:empty),.cdk-high-contrast-active .mat-calendar-body-cell:not(.mat-calendar-body-in-range) .mat-calendar-body-selected{outline:solid 1px}.cdk-high-contrast-active .mat-calendar-body-today{outline:dotted 1px}.cdk-high-contrast-active .mat-calendar-body-cell::before,.cdk-high-contrast-active .mat-calendar-body-cell::after,.cdk-high-contrast-active .mat-calendar-body-selected{background:none}.cdk-high-contrast-active .mat-calendar-body-in-range::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-start::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-end::before{border-top:solid 1px;border-bottom:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:0;border-right:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:0;border-left:solid 1px}.cdk-high-contrast-active .mat-calendar-body-in-comparison-range::before{border-top:dashed 1px;border-bottom:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:0;border-right:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:0;border-left:dashed 1px}'],encapsulation:2,changeDetection:0});let a=r;return a})();function _T(a){return a?.nodeName==="TD"}function vT(a){let r;return _T(a)?r=a:_T(a.parentNode)?r=a.parentNode:_T(a.parentNode?.parentNode)&&(r=a.parentNode.parentNode),r?.getAttribute("data-mat-row")!=null?r:null}function yT(a,r,l){return l!==null&&r!==l&&a<l&&a===r}function bT(a,r,l){return r!==null&&r!==l&&a>=r&&a===l}function xT(a,r,l,n){return n&&r!==null&&l!==null&&r!==l&&a>=r&&a<=l}function WV(a){let r=a.changedTouches[0];return document.elementFromPoint(r.clientX,r.clientY)}var Wa=class{constructor(r,l){this.start=r,this.end=l}},Zg=(()=>{let r=class r{constructor(n,s){this.selection=n,this._adapter=s,this._selectionChanged=new pe,this.selectionChanged=this._selectionChanged,this.selection=n}updateSelection(n,s){let d=this.selection;this.selection=n,this._selectionChanged.next({selection:n,source:s,oldValue:d})}ngOnDestroy(){this._selectionChanged.complete()}_isValidDateInstance(n){return this._adapter.isDateInstance(n)&&this._adapter.isValid(n)}};r.\u0275fac=function(s){xu()},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})(),Tct=(()=>{let r=class r extends Zg{constructor(n){super(null,n)}add(n){super.updateSelection(n,this)}isValid(){return this.selection!=null&&this._isValidDateInstance(this.selection)}isComplete(){return this.selection!=null}clone(){let n=new r(this._adapter);return n.updateSelection(this.selection,this),n}};r.\u0275fac=function(s){return new(s||r)(ht(Qo))},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})();function Ict(a,r){return a||new Tct(r)}var QV={provide:Zg,deps:[[new vu,new Gh,Zg],Qo],useFactory:Ict};var JV=new Se("MAT_DATE_RANGE_SELECTION_STRATEGY");var wT=7,$V=(()=>{let r=class r{get activeDate(){return this._activeDate}set activeDate(n){let s=this._activeDate,d=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(d,this.minDate,this.maxDate),this._hasSameMonthAndYear(s,this._activeDate)||this._init()}get selected(){return this._selected}set selected(n){n instanceof Wa?this._selected=n:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n)),this._setRanges(this._selected)}get minDate(){return this._minDate}set minDate(n){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get maxDate(){return this._maxDate}set maxDate(n){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}constructor(n,s,d,m,_){this._changeDetectorRef=n,this._dateFormats=s,this._dateAdapter=d,this._dir=m,this._rangeStrategy=_,this._rerenderSubscription=sr.EMPTY,this.activeDrag=null,this.selectedChange=new ye,this._userSelection=new ye,this.dragStarted=new ye,this.dragEnded=new ye,this.activeDateChange=new ye,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(ho(null)).subscribe(()=>this._init())}ngOnChanges(n){let s=n.comparisonStart||n.comparisonEnd;s&&!s.firstChange&&this._setRanges(this.selected),n.activeDrag&&!this.activeDrag&&this._clearPreview()}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_dateSelected(n){let s=n.value,d=this._getDateFromDayOfMonth(s),m,_;this._selected instanceof Wa?(m=this._getDateInCurrentMonth(this._selected.start),_=this._getDateInCurrentMonth(this._selected.end)):m=_=this._getDateInCurrentMonth(this._selected),(m!==s||_!==s)&&this.selectedChange.emit(d),this._userSelection.emit({value:d,event:n.event}),this._clearPreview(),this._changeDetectorRef.markForCheck()}_updateActiveDate(n){let s=n.value,d=this._activeDate;this.activeDate=this._getDateFromDayOfMonth(s),this._dateAdapter.compareDate(d,this.activeDate)&&this.activeDateChange.emit(this._activeDate)}_handleCalendarBodyKeydown(n){let s=this._activeDate,d=this._isRtl();switch(n.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,d?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,d?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-7);break;case 40:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,7);break;case 36:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1-this._dateAdapter.getDate(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,this._dateAdapter.getNumDaysInMonth(this._activeDate)-this._dateAdapter.getDate(this._activeDate));break;case 33:this.activeDate=n.altKey?this._dateAdapter.addCalendarYears(this._activeDate,-1):this._dateAdapter.addCalendarMonths(this._activeDate,-1);break;case 34:this.activeDate=n.altKey?this._dateAdapter.addCalendarYears(this._activeDate,1):this._dateAdapter.addCalendarMonths(this._activeDate,1);break;case 13:case 32:this._selectionKeyPressed=!0,this._canSelect(this._activeDate)&&n.preventDefault();return;case 27:this._previewEnd!=null&&!Zr(n)&&(this._clearPreview(),this.activeDrag?this.dragEnded.emit({value:null,event:n}):(this.selectedChange.emit(null),this._userSelection.emit({value:null,event:n})),n.preventDefault(),n.stopPropagation());return;default:return}this._dateAdapter.compareDate(s,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),n.preventDefault()}_handleCalendarBodyKeyup(n){(n.keyCode===32||n.keyCode===13)&&(this._selectionKeyPressed&&this._canSelect(this._activeDate)&&this._dateSelected({value:this._dateAdapter.getDate(this._activeDate),event:n}),this._selectionKeyPressed=!1)}_init(){this._setRanges(this.selected),this._todayDate=this._getCellCompareValue(this._dateAdapter.today()),this._monthLabel=this._dateFormats.display.monthLabel?this._dateAdapter.format(this.activeDate,this._dateFormats.display.monthLabel):this._dateAdapter.getMonthNames("short")[this._dateAdapter.getMonth(this.activeDate)].toLocaleUpperCase();let n=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),1);this._firstWeekOffset=(wT+this._dateAdapter.getDayOfWeek(n)-this._dateAdapter.getFirstDayOfWeek())%wT,this._initWeekdays(),this._createWeekCells(),this._changeDetectorRef.markForCheck()}_focusActiveCell(n){this._matCalendarBody._focusActiveCell(n)}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_previewChanged({event:n,value:s}){if(this._rangeStrategy){let d=s?s.rawValue:null,m=this._rangeStrategy.createPreview(d,this.selected,n);if(this._previewStart=this._getCellCompareValue(m.start),this._previewEnd=this._getCellCompareValue(m.end),this.activeDrag&&d){let _=this._rangeStrategy.createDrag?.(this.activeDrag.value,this.selected,d,n);_&&(this._previewStart=this._getCellCompareValue(_.start),this._previewEnd=this._getCellCompareValue(_.end))}this._changeDetectorRef.detectChanges()}}_dragEnded(n){if(this.activeDrag)if(n.value){let s=this._rangeStrategy?.createDrag?.(this.activeDrag.value,this.selected,n.value,n.event);this.dragEnded.emit({value:s??null,event:n.event})}else this.dragEnded.emit({value:null,event:n.event})}_getDateFromDayOfMonth(n){return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),n)}_initWeekdays(){let n=this._dateAdapter.getFirstDayOfWeek(),s=this._dateAdapter.getDayOfWeekNames("narrow"),m=this._dateAdapter.getDayOfWeekNames("long").map((_,w)=>({long:_,narrow:s[w]}));this._weekdays=m.slice(n).concat(m.slice(0,n))}_createWeekCells(){let n=this._dateAdapter.getNumDaysInMonth(this.activeDate),s=this._dateAdapter.getDateNames();this._weeks=[[]];for(let d=0,m=this._firstWeekOffset;d<n;d++,m++){m==wT&&(this._weeks.push([]),m=0);let _=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),d+1),w=this._shouldEnableDate(_),S=this._dateAdapter.format(_,this._dateFormats.display.dateA11yLabel),I=this.dateClass?this.dateClass(_,"month"):void 0;this._weeks[this._weeks.length-1].push(new Yg(d+1,s[d],S,w,I,this._getCellCompareValue(_),_))}}_shouldEnableDate(n){return!!n&&(!this.minDate||this._dateAdapter.compareDate(n,this.minDate)>=0)&&(!this.maxDate||this._dateAdapter.compareDate(n,this.maxDate)<=0)&&(!this.dateFilter||this.dateFilter(n))}_getDateInCurrentMonth(n){return n&&this._hasSameMonthAndYear(n,this.activeDate)?this._dateAdapter.getDate(n):null}_hasSameMonthAndYear(n,s){return!!(n&&s&&this._dateAdapter.getMonth(n)==this._dateAdapter.getMonth(s)&&this._dateAdapter.getYear(n)==this._dateAdapter.getYear(s))}_getCellCompareValue(n){if(n){let s=this._dateAdapter.getYear(n),d=this._dateAdapter.getMonth(n),m=this._dateAdapter.getDate(n);return new Date(s,d,m).getTime()}return null}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setRanges(n){n instanceof Wa?(this._rangeStart=this._getCellCompareValue(n.start),this._rangeEnd=this._getCellCompareValue(n.end),this._isRange=!0):(this._rangeStart=this._rangeEnd=this._getCellCompareValue(n),this._isRange=!1),this._comparisonRangeStart=this._getCellCompareValue(this.comparisonStart),this._comparisonRangeEnd=this._getCellCompareValue(this.comparisonEnd)}_canSelect(n){return!this.dateFilter||this.dateFilter(n)}_clearPreview(){this._previewStart=this._previewEnd=null}};r.\u0275fac=function(s){return new(s||r)(V(Zi),V(Ed,8),V(Qo,8),V(Ao,8),V(JV,8))},r.\u0275cmp=St({type:r,selectors:[["mat-month-view"]],viewQuery:function(s,d){if(s&1&&ze(np,5),s&2){let m;se(m=ae())&&(d._matCalendarBody=m.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName",activeDrag:"activeDrag"},outputs:{selectedChange:"selectedChange",_userSelection:"_userSelection",dragStarted:"dragStarted",dragEnded:"dragEnded",activeDateChange:"activeDateChange"},exportAs:["matMonthView"],standalone:!0,features:[Yn,At],decls:8,vars:14,consts:[["role","grid",1,"mat-calendar-table"],[1,"mat-calendar-table-header"],["aria-hidden","true","colspan","7",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"label","rows","todayValue","startValue","endValue","comparisonStart","comparisonEnd","previewStart","previewEnd","isRange","labelMinRequiredCells","activeCell","startDateAccessibleName","endDateAccessibleName","selectedValueChange","activeDateChange","previewChange","dragStarted","dragEnded","keyup","keydown"],["scope","col"],[1,"cdk-visually-hidden"],["aria-hidden","true"]],template:function(s,d){s&1&&(T(0,"table",0)(1,"thead",1)(2,"tr"),Xh(3,gct,5,2,"th",4,Zh),k(),T(5,"tr"),dt(6,"th",2),k()(),T(7,"tbody",3),ct("selectedValueChange",function(_){return d._dateSelected(_)})("activeDateChange",function(_){return d._updateActiveDate(_)})("previewChange",function(_){return d._previewChanged(_)})("dragStarted",function(_){return d.dragStarted.emit(_)})("dragEnded",function(_){return d._dragEnded(_)})("keyup",function(_){return d._handleCalendarBodyKeyup(_)})("keydown",function(_){return d._handleCalendarBodyKeydown(_)}),k()()),s&2&&(z(3),Kh(d._weekdays),z(4),W("label",d._monthLabel)("rows",d._weeks)("todayValue",d._todayDate)("startValue",d._rangeStart)("endValue",d._rangeEnd)("comparisonStart",d._comparisonRangeStart)("comparisonEnd",d._comparisonRangeEnd)("previewStart",d._previewStart)("previewEnd",d._previewEnd)("isRange",d._isRange)("labelMinRequiredCells",3)("activeCell",d._dateAdapter.getDate(d.activeDate)-1)("startDateAccessibleName",d.startDateAccessibleName)("endDateAccessibleName",d.endDateAccessibleName))},dependencies:[np],encapsulation:2,changeDetection:0});let a=r;return a})(),aa=24,CT=4,YV=(()=>{let r=class r{get activeDate(){return this._activeDate}set activeDate(n){let s=this._activeDate,d=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(d,this.minDate,this.maxDate),tj(this._dateAdapter,s,this._activeDate,this.minDate,this.maxDate)||this._init()}get selected(){return this._selected}set selected(n){n instanceof Wa?this._selected=n:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n)),this._setSelectedYear(n)}get minDate(){return this._minDate}set minDate(n){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get maxDate(){return this._maxDate}set maxDate(n){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}constructor(n,s,d){this._changeDetectorRef=n,this._dateAdapter=s,this._dir=d,this._rerenderSubscription=sr.EMPTY,this.selectedChange=new ye,this.yearSelected=new ye,this.activeDateChange=new ye,this._dateAdapter,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(ho(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_init(){this._todayYear=this._dateAdapter.getYear(this._dateAdapter.today());let s=this._dateAdapter.getYear(this._activeDate)-$g(this._dateAdapter,this.activeDate,this.minDate,this.maxDate);this._years=[];for(let d=0,m=[];d<aa;d++)m.push(s+d),m.length==CT&&(this._years.push(m.map(_=>this._createCellForYear(_))),m=[]);this._changeDetectorRef.markForCheck()}_yearSelected(n){let s=n.value,d=this._dateAdapter.createDate(s,0,1),m=this._getDateFromYear(s);this.yearSelected.emit(d),this.selectedChange.emit(m)}_updateActiveDate(n){let s=n.value,d=this._activeDate;this.activeDate=this._getDateFromYear(s),this._dateAdapter.compareDate(d,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(n){let s=this._activeDate,d=this._isRtl();switch(n.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,d?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,d?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-CT);break;case 40:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,CT);break;case 36:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-$g(this._dateAdapter,this.activeDate,this.minDate,this.maxDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,aa-$g(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)-1);break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,n.altKey?-aa*10:-aa);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,n.altKey?aa*10:aa);break;case 13:case 32:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(s,this.activeDate)&&this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked(),n.preventDefault()}_handleCalendarBodyKeyup(n){(n.keyCode===32||n.keyCode===13)&&(this._selectionKeyPressed&&this._yearSelected({value:this._dateAdapter.getYear(this._activeDate),event:n}),this._selectionKeyPressed=!1)}_getActiveCell(){return $g(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getDateFromYear(n){let s=this._dateAdapter.getMonth(this.activeDate),d=this._dateAdapter.getNumDaysInMonth(this._dateAdapter.createDate(n,s,1));return this._dateAdapter.createDate(n,s,Math.min(this._dateAdapter.getDate(this.activeDate),d))}_createCellForYear(n){let s=this._dateAdapter.createDate(n,0,1),d=this._dateAdapter.getYearName(s),m=this.dateClass?this.dateClass(s,"multi-year"):void 0;return new Yg(n,d,d,this._shouldEnableYear(n),m)}_shouldEnableYear(n){if(n==null||this.maxDate&&n>this._dateAdapter.getYear(this.maxDate)||this.minDate&&n<this._dateAdapter.getYear(this.minDate))return!1;if(!this.dateFilter)return!0;let s=this._dateAdapter.createDate(n,0,1);for(let d=s;this._dateAdapter.getYear(d)==n;d=this._dateAdapter.addCalendarDays(d,1))if(this.dateFilter(d))return!0;return!1}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setSelectedYear(n){if(this._selectedYear=null,n instanceof Wa){let s=n.start||n.end;s&&(this._selectedYear=this._dateAdapter.getYear(s))}else n&&(this._selectedYear=this._dateAdapter.getYear(n))}};r.\u0275fac=function(s){return new(s||r)(V(Zi),V(Qo,8),V(Ao,8))},r.\u0275cmp=St({type:r,selectors:[["mat-multi-year-view"]],viewQuery:function(s,d){if(s&1&&ze(np,5),s&2){let m;se(m=ae())&&(d._matCalendarBody=m.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",activeDateChange:"activeDateChange"},exportAs:["matMultiYearView"],standalone:!0,features:[At],decls:5,vars:7,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"rows","todayValue","startValue","endValue","numCols","cellAspectRatio","activeCell","selectedValueChange","activeDateChange","keyup","keydown"]],template:function(s,d){s&1&&(T(0,"table",0)(1,"thead",1)(2,"tr"),dt(3,"th",2),k()(),T(4,"tbody",3),ct("selectedValueChange",function(_){return d._yearSelected(_)})("activeDateChange",function(_){return d._updateActiveDate(_)})("keyup",function(_){return d._handleCalendarBodyKeyup(_)})("keydown",function(_){return d._handleCalendarBodyKeydown(_)}),k()()),s&2&&(z(4),W("rows",d._years)("todayValue",d._todayYear)("startValue",d._selectedYear)("endValue",d._selectedYear)("numCols",4)("cellAspectRatio",4/7)("activeCell",d._getActiveCell()))},dependencies:[np],encapsulation:2,changeDetection:0});let a=r;return a})();function tj(a,r,l,n,s){let d=a.getYear(r),m=a.getYear(l),_=ej(a,n,s);return Math.floor((d-_)/aa)===Math.floor((m-_)/aa)}function $g(a,r,l,n){let s=a.getYear(r);return Act(s-ej(a,l,n),aa)}function ej(a,r,l){let n=0;return l?n=a.getYear(l)-aa+1:r&&(n=a.getYear(r)),n}function Act(a,r){return(a%r+r)%r}var ZV=(()=>{let r=class r{get activeDate(){return this._activeDate}set activeDate(n){let s=this._activeDate,d=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(d,this.minDate,this.maxDate),this._dateAdapter.getYear(s)!==this._dateAdapter.getYear(this._activeDate)&&this._init()}get selected(){return this._selected}set selected(n){n instanceof Wa?this._selected=n:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n)),this._setSelectedMonth(n)}get minDate(){return this._minDate}set minDate(n){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get maxDate(){return this._maxDate}set maxDate(n){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}constructor(n,s,d,m){this._changeDetectorRef=n,this._dateFormats=s,this._dateAdapter=d,this._dir=m,this._rerenderSubscription=sr.EMPTY,this.selectedChange=new ye,this.monthSelected=new ye,this.activeDateChange=new ye,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(ho(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_monthSelected(n){let s=n.value,d=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),s,1);this.monthSelected.emit(d);let m=this._getDateFromMonth(s);this.selectedChange.emit(m)}_updateActiveDate(n){let s=n.value,d=this._activeDate;this.activeDate=this._getDateFromMonth(s),this._dateAdapter.compareDate(d,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(n){let s=this._activeDate,d=this._isRtl();switch(n.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,d?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,d?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-4);break;case 40:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,4);break;case 36:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-this._dateAdapter.getMonth(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,11-this._dateAdapter.getMonth(this._activeDate));break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,n.altKey?-10:-1);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,n.altKey?10:1);break;case 13:case 32:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(s,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),n.preventDefault()}_handleCalendarBodyKeyup(n){(n.keyCode===32||n.keyCode===13)&&(this._selectionKeyPressed&&this._monthSelected({value:this._dateAdapter.getMonth(this._activeDate),event:n}),this._selectionKeyPressed=!1)}_init(){this._setSelectedMonth(this.selected),this._todayMonth=this._getMonthInCurrentYear(this._dateAdapter.today()),this._yearLabel=this._dateAdapter.getYearName(this.activeDate);let n=this._dateAdapter.getMonthNames("short");this._months=[[0,1,2,3],[4,5,6,7],[8,9,10,11]].map(s=>s.map(d=>this._createCellForMonth(d,n[d]))),this._changeDetectorRef.markForCheck()}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getMonthInCurrentYear(n){return n&&this._dateAdapter.getYear(n)==this._dateAdapter.getYear(this.activeDate)?this._dateAdapter.getMonth(n):null}_getDateFromMonth(n){let s=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),n,1),d=this._dateAdapter.getNumDaysInMonth(s);return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),n,Math.min(this._dateAdapter.getDate(this.activeDate),d))}_createCellForMonth(n,s){let d=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),n,1),m=this._dateAdapter.format(d,this._dateFormats.display.monthYearA11yLabel),_=this.dateClass?this.dateClass(d,"year"):void 0;return new Yg(n,s.toLocaleUpperCase(),m,this._shouldEnableMonth(n),_)}_shouldEnableMonth(n){let s=this._dateAdapter.getYear(this.activeDate);if(n==null||this._isYearAndMonthAfterMaxDate(s,n)||this._isYearAndMonthBeforeMinDate(s,n))return!1;if(!this.dateFilter)return!0;let d=this._dateAdapter.createDate(s,n,1);for(let m=d;this._dateAdapter.getMonth(m)==n;m=this._dateAdapter.addCalendarDays(m,1))if(this.dateFilter(m))return!0;return!1}_isYearAndMonthAfterMaxDate(n,s){if(this.maxDate){let d=this._dateAdapter.getYear(this.maxDate),m=this._dateAdapter.getMonth(this.maxDate);return n>d||n===d&&s>m}return!1}_isYearAndMonthBeforeMinDate(n,s){if(this.minDate){let d=this._dateAdapter.getYear(this.minDate),m=this._dateAdapter.getMonth(this.minDate);return n<d||n===d&&s<m}return!1}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setSelectedMonth(n){n instanceof Wa?this._selectedMonth=this._getMonthInCurrentYear(n.start)||this._getMonthInCurrentYear(n.end):this._selectedMonth=this._getMonthInCurrentYear(n)}};r.\u0275fac=function(s){return new(s||r)(V(Zi),V(Ed,8),V(Qo,8),V(Ao,8))},r.\u0275cmp=St({type:r,selectors:[["mat-year-view"]],viewQuery:function(s,d){if(s&1&&ze(np,5),s&2){let m;se(m=ae())&&(d._matCalendarBody=m.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",monthSelected:"monthSelected",activeDateChange:"activeDateChange"},exportAs:["matYearView"],standalone:!0,features:[At],decls:5,vars:9,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"label","rows","todayValue","startValue","endValue","labelMinRequiredCells","numCols","cellAspectRatio","activeCell","selectedValueChange","activeDateChange","keyup","keydown"]],template:function(s,d){s&1&&(T(0,"table",0)(1,"thead",1)(2,"tr"),dt(3,"th",2),k()(),T(4,"tbody",3),ct("selectedValueChange",function(_){return d._monthSelected(_)})("activeDateChange",function(_){return d._updateActiveDate(_)})("keyup",function(_){return d._handleCalendarBodyKeyup(_)})("keydown",function(_){return d._handleCalendarBodyKeydown(_)}),k()()),s&2&&(z(4),W("label",d._yearLabel)("rows",d._months)("todayValue",d._todayMonth)("startValue",d._selectedMonth)("endValue",d._selectedMonth)("labelMinRequiredCells",2)("numCols",4)("cellAspectRatio",4/7)("activeCell",d._dateAdapter.getMonth(d.activeDate)))},dependencies:[np],encapsulation:2,changeDetection:0});let a=r;return a})(),kct=1,Rct=(()=>{let r=class r{constructor(n,s,d,m,_){this._intl=n,this.calendar=s,this._dateAdapter=d,this._dateFormats=m,this._id=`mat-calendar-header-${kct++}`,this._periodButtonLabelId=`${this._id}-period-label`,this.calendar.stateChanges.subscribe(()=>_.markForCheck())}get periodButtonText(){return this.calendar.currentView=="month"?this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase():this.calendar.currentView=="year"?this._dateAdapter.getYearName(this.calendar.activeDate):this._intl.formatYearRange(...this._formatMinAndMaxYearLabels())}get periodButtonDescription(){return this.calendar.currentView=="month"?this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase():this.calendar.currentView=="year"?this._dateAdapter.getYearName(this.calendar.activeDate):this._intl.formatYearRangeLabel(...this._formatMinAndMaxYearLabels())}get periodButtonLabel(){return this.calendar.currentView=="month"?this._intl.switchToMultiYearViewLabel:this._intl.switchToMonthViewLabel}get prevButtonLabel(){return{month:this._intl.prevMonthLabel,year:this._intl.prevYearLabel,"multi-year":this._intl.prevMultiYearLabel}[this.calendar.currentView]}get nextButtonLabel(){return{month:this._intl.nextMonthLabel,year:this._intl.nextYearLabel,"multi-year":this._intl.nextMultiYearLabel}[this.calendar.currentView]}currentPeriodClicked(){this.calendar.currentView=this.calendar.currentView=="month"?"multi-year":"month"}previousClicked(){this.calendar.activeDate=this.calendar.currentView=="month"?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,-1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,this.calendar.currentView=="year"?-1:-aa)}nextClicked(){this.calendar.activeDate=this.calendar.currentView=="month"?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,this.calendar.currentView=="year"?1:aa)}previousEnabled(){return this.calendar.minDate?!this.calendar.minDate||!this._isSameView(this.calendar.activeDate,this.calendar.minDate):!0}nextEnabled(){return!this.calendar.maxDate||!this._isSameView(this.calendar.activeDate,this.calendar.maxDate)}_isSameView(n,s){return this.calendar.currentView=="month"?this._dateAdapter.getYear(n)==this._dateAdapter.getYear(s)&&this._dateAdapter.getMonth(n)==this._dateAdapter.getMonth(s):this.calendar.currentView=="year"?this._dateAdapter.getYear(n)==this._dateAdapter.getYear(s):tj(this._dateAdapter,n,s,this.calendar.minDate,this.calendar.maxDate)}_formatMinAndMaxYearLabels(){let s=this._dateAdapter.getYear(this.calendar.activeDate)-$g(this._dateAdapter,this.calendar.activeDate,this.calendar.minDate,this.calendar.maxDate),d=s+aa-1,m=this._dateAdapter.getYearName(this._dateAdapter.createDate(s,0,1)),_=this._dateAdapter.getYearName(this._dateAdapter.createDate(d,0,1));return[m,_]}};r.\u0275fac=function(s){return new(s||r)(V(Fx),V(jo(()=>ST)),V(Qo,8),V(Ed,8),V(Zi))},r.\u0275cmp=St({type:r,selectors:[["mat-calendar-header"]],exportAs:["matCalendarHeader"],standalone:!0,features:[At],ngContentSelectors:_ct,decls:13,vars:11,consts:[[1,"mat-calendar-header"],[1,"mat-calendar-controls"],["mat-button","","type","button","aria-live","polite",1,"mat-calendar-period-button",3,"click"],["aria-hidden","true"],["viewBox","0 0 10 5","focusable","false","aria-hidden","true",1,"mat-calendar-arrow"],["points","0,0 5,5 10,0"],[1,"mat-calendar-spacer"],["mat-icon-button","","type","button",1,"mat-calendar-previous-button",3,"disabled","click"],["mat-icon-button","","type","button",1,"mat-calendar-next-button",3,"disabled","click"],[1,"mat-calendar-hidden-label",3,"id"]],template:function(s,d){s&1&&(Un(),T(0,"div",0)(1,"div",1)(2,"button",2),ct("click",function(){return d.currentPeriodClicked()}),T(3,"span",3),B(4),k(),Rs(),T(5,"svg",4),dt(6,"polygon",5),k()(),_u(),dt(7,"div",6),Ai(8),T(9,"button",7),ct("click",function(){return d.previousClicked()}),k(),T(10,"button",8),ct("click",function(){return d.nextClicked()}),k()()(),T(11,"label",9),B(12),k()),s&2&&(z(2),ri("aria-label",d.periodButtonLabel)("aria-describedby",d._periodButtonLabelId),z(2),Te(d.periodButtonText),z(),li("mat-calendar-invert",d.calendar.currentView!=="month"),z(4),W("disabled",!d.previousEnabled()),ri("aria-label",d.prevButtonLabel),z(),W("disabled",!d.nextEnabled()),ri("aria-label",d.nextButtonLabel),z(),W("id",d._periodButtonLabelId),z(),Te(d.periodButtonDescription))},dependencies:[ea,Ac],encapsulation:2,changeDetection:0});let a=r;return a})(),ST=(()=>{let r=class r{get startAt(){return this._startAt}set startAt(n){this._startAt=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get selected(){return this._selected}set selected(n){n instanceof Wa?this._selected=n:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get minDate(){return this._minDate}set minDate(n){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get maxDate(){return this._maxDate}set maxDate(n){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get activeDate(){return this._clampedActiveDate}set activeDate(n){this._clampedActiveDate=this._dateAdapter.clampDate(n,this.minDate,this.maxDate),this.stateChanges.next(),this._changeDetectorRef.markForCheck()}get currentView(){return this._currentView}set currentView(n){let s=this._currentView!==n?n:null;this._currentView=n,this._moveFocusOnNextTick=!0,this._changeDetectorRef.markForCheck(),s&&this.viewChanged.emit(s)}constructor(n,s,d,m){this._dateAdapter=s,this._dateFormats=d,this._changeDetectorRef=m,this._moveFocusOnNextTick=!1,this.startView="month",this.selectedChange=new ye,this.yearSelected=new ye,this.monthSelected=new ye,this.viewChanged=new ye(!0),this._userSelection=new ye,this._userDragDrop=new ye,this._activeDrag=null,this.stateChanges=new pe,this._intlChanges=n.changes.subscribe(()=>{m.markForCheck(),this.stateChanges.next()})}ngAfterContentInit(){this._calendarHeaderPortal=new ns(this.headerComponent||Rct),this.activeDate=this.startAt||this._dateAdapter.today(),this._currentView=this.startView}ngAfterViewChecked(){this._moveFocusOnNextTick&&(this._moveFocusOnNextTick=!1,this.focusActiveCell())}ngOnDestroy(){this._intlChanges.unsubscribe(),this.stateChanges.complete()}ngOnChanges(n){let s=n.minDate&&!this._dateAdapter.sameDate(n.minDate.previousValue,n.minDate.currentValue)?n.minDate:void 0,d=n.maxDate&&!this._dateAdapter.sameDate(n.maxDate.previousValue,n.maxDate.currentValue)?n.maxDate:void 0,m=s||d||n.dateFilter;if(m&&!m.firstChange){let _=this._getCurrentViewComponent();_&&(this._changeDetectorRef.detectChanges(),_._init())}this.stateChanges.next()}focusActiveCell(){this._getCurrentViewComponent()._focusActiveCell(!1)}updateTodaysDate(){this._getCurrentViewComponent()._init()}_dateSelected(n){let s=n.value;(this.selected instanceof Wa||s&&!this._dateAdapter.sameDate(s,this.selected))&&this.selectedChange.emit(s),this._userSelection.emit(n)}_yearSelectedInMultiYearView(n){this.yearSelected.emit(n)}_monthSelectedInYearView(n){this.monthSelected.emit(n)}_goToDateInView(n,s){this.activeDate=n,this.currentView=s}_dragStarted(n){this._activeDrag=n}_dragEnded(n){this._activeDrag&&(n.value&&this._userDragDrop.emit(n),this._activeDrag=null)}_getCurrentViewComponent(){return this.monthView||this.yearView||this.multiYearView}};r.\u0275fac=function(s){return new(s||r)(V(Fx),V(Qo,8),V(Ed,8),V(Zi))},r.\u0275cmp=St({type:r,selectors:[["mat-calendar"]],viewQuery:function(s,d){if(s&1&&(ze($V,5),ze(ZV,5),ze(YV,5)),s&2){let m;se(m=ae())&&(d.monthView=m.first),se(m=ae())&&(d.yearView=m.first),se(m=ae())&&(d.multiYearView=m.first)}},hostAttrs:[1,"mat-calendar"],inputs:{headerComponent:"headerComponent",startAt:"startAt",startView:"startView",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",monthSelected:"monthSelected",viewChanged:"viewChanged",_userSelection:"_userSelection",_userDragDrop:"_userDragDrop"},exportAs:["matCalendar"],standalone:!0,features:[ji([QV]),Yn,At],decls:5,vars:2,consts:[[3,"cdkPortalOutlet"],["cdkMonitorSubtreeFocus","","tabindex","-1",1,"mat-calendar-content"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName","activeDrag","activeDateChange","_userSelection","dragStarted","dragEnded"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","activeDateChange","monthSelected","selectedChange"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","activeDateChange","yearSelected","selectedChange"]],template:function(s,d){if(s&1&&(ut(0,vct,0,0,"ng-template",0),T(1,"div",1),ut(2,yct,1,11)(3,bct,1,6)(4,xct,1,6),k()),s&2){let m;W("cdkPortalOutlet",d._calendarHeaderPortal),z(2),Xi(2,(m=d.currentView)==="month"?2:m==="year"?3:m==="multi-year"?4:-1)}},dependencies:[ul,Ez,$V,ZV,YV],styles:['.mat-calendar{display:block;font-family:var(--mat-datepicker-calendar-text-font);font-size:var(--mat-datepicker-calendar-text-size)}.mat-calendar-header{padding:8px 8px 0 8px}.mat-calendar-content{padding:0 8px 8px 8px;outline:none}.mat-calendar-controls{display:flex;align-items:center;margin:5% calc(4.7142857143% - 16px)}.mat-calendar-spacer{flex:1 1 auto}.mat-calendar-period-button{min-width:0;margin:0 8px;font-size:var(--mat-datepicker-calendar-period-button-text-size);font-weight:var(--mat-datepicker-calendar-period-button-text-weight);--mdc-text-button-label-text-color:var(--mat-datepicker-calendar-period-button-text-color)}.mat-calendar-arrow{display:inline-block;width:10px;height:5px;margin:0 0 0 5px;vertical-align:middle;fill:var(--mat-datepicker-calendar-period-button-icon-color)}.mat-calendar-arrow.mat-calendar-invert{transform:rotate(180deg)}[dir=rtl] .mat-calendar-arrow{margin:0 5px 0 0}.cdk-high-contrast-active .mat-calendar-arrow{fill:CanvasText}.mat-calendar-previous-button,.mat-calendar-next-button{position:relative}.mat-datepicker-content .mat-calendar-previous-button:not(.mat-mdc-button-disabled),.mat-datepicker-content .mat-calendar-next-button:not(.mat-mdc-button-disabled){color:var(--mat-datepicker-calendar-navigation-button-icon-color)}.mat-calendar-previous-button::after,.mat-calendar-next-button::after{top:0;left:0;right:0;bottom:0;position:absolute;content:"";margin:15.5px;border:0 solid currentColor;border-top-width:2px}[dir=rtl] .mat-calendar-previous-button,[dir=rtl] .mat-calendar-next-button{transform:rotate(180deg)}.mat-calendar-previous-button::after{border-left-width:2px;transform:translateX(2px) rotate(-45deg)}.mat-calendar-next-button::after{border-right-width:2px;transform:translateX(-2px) rotate(45deg)}.mat-calendar-table{border-spacing:0;border-collapse:collapse;width:100%}.mat-calendar-table-header th{text-align:center;padding:0 0 8px 0;color:var(--mat-datepicker-calendar-header-text-color);font-size:var(--mat-datepicker-calendar-header-text-size);font-weight:var(--mat-datepicker-calendar-header-text-weight)}.mat-calendar-table-header-divider{position:relative;height:1px}.mat-calendar-table-header-divider::after{content:"";position:absolute;top:0;left:-8px;right:-8px;height:1px;background:var(--mat-datepicker-calendar-header-divider-color)}.mat-calendar-body-cell-content::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 3px)*-1)}.mat-calendar-body-cell:focus .mat-focus-indicator::before{content:""}.mat-calendar-hidden-label{display:none}'],encapsulation:2,changeDetection:0});let a=r;return a})(),XV={transformPanel:wr("transformPanel",[ln("void => enter-dropdown",Sn("120ms cubic-bezier(0, 0, 0.2, 1)",fd([hi({opacity:0,transform:"scale(1, 0.8)"}),hi({opacity:1,transform:"scale(1, 1)"})]))),ln("void => enter-dialog",Sn("150ms cubic-bezier(0, 0, 0.2, 1)",fd([hi({opacity:0,transform:"scale(0.7)"}),hi({transform:"none",opacity:1})]))),ln("* => void",Sn("100ms linear",hi({opacity:0})))]),fadeInCalendar:wr("fadeInCalendar",[En("void",hi({opacity:0})),En("enter",hi({opacity:1})),ln("void => *",Sn("120ms 100ms cubic-bezier(0.55, 0, 0.55, 0.2)"))])},Pct=0,Oct=new Se("mat-datepicker-scroll-strategy",{providedIn:"root",factory:()=>{let a=le(Zn);return()=>a.scrollStrategies.reposition()}});var Fct=(()=>{let r=class r{constructor(n,s,d,m,_,w){this._elementRef=n,this._changeDetectorRef=s,this._globalModel=d,this._dateAdapter=m,this._rangeSelectionStrategy=_,this._subscriptions=new sr,this._animationDone=new pe,this._isAnimating=!1,this._actionsPortal=null,this._closeButtonText=w.closeCalendarLabel}ngOnInit(){this._animationState=this.datepicker.touchUi?"enter-dialog":"enter-dropdown"}ngAfterViewInit(){this._subscriptions.add(this.datepicker.stateChanges.subscribe(()=>{this._changeDetectorRef.markForCheck()})),this._calendar.focusActiveCell()}ngOnDestroy(){this._subscriptions.unsubscribe(),this._animationDone.complete()}_handleUserSelection(n){let s=this._model.selection,d=n.value,m=s instanceof Wa;if(m&&this._rangeSelectionStrategy){let _=this._rangeSelectionStrategy.selectionFinished(d,s,n.event);this._model.updateSelection(_,this)}else d&&(m||!this._dateAdapter.sameDate(d,s))&&this._model.add(d);(!this._model||this._model.isComplete())&&!this._actionsPortal&&this.datepicker.close()}_handleUserDragDrop(n){this._model.updateSelection(n.value,this)}_startExitAnimation(){this._animationState="void",this._changeDetectorRef.markForCheck()}_handleAnimationEvent(n){this._isAnimating=n.phaseName==="start",this._isAnimating||this._animationDone.next()}_getSelected(){return this._model.selection}_applyPendingSelection(){this._model!==this._globalModel&&this._globalModel.updateSelection(this._model.selection,this)}_assignActions(n,s){this._model=n?this._globalModel.clone():this._globalModel,this._actionsPortal=n,s&&this._changeDetectorRef.detectChanges()}};r.\u0275fac=function(s){return new(s||r)(V(Ee),V(Zi),V(Zg),V(Qo),V(JV,8),V(Fx))},r.\u0275cmp=St({type:r,selectors:[["mat-datepicker-content"]],viewQuery:function(s,d){if(s&1&&ze(ST,5),s&2){let m;se(m=ae())&&(d._calendar=m.first)}},hostAttrs:[1,"mat-datepicker-content"],hostVars:5,hostBindings:function(s,d){s&1&&wv("@transformPanel.start",function(_){return d._handleAnimationEvent(_)})("@transformPanel.done",function(_){return d._handleAnimationEvent(_)}),s&2&&(xv("@transformPanel",d._animationState),al(d.color?"mat-"+d.color:""),li("mat-datepicker-content-touch",d.datepicker.touchUi))},inputs:{color:"color"},exportAs:["matDatepickerContent"],standalone:!0,features:[At],decls:5,vars:26,consts:[["cdkTrapFocus","","role","dialog",1,"mat-datepicker-content-container"],[3,"id","ngClass","startAt","startView","minDate","maxDate","dateFilter","headerComponent","selected","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName","yearSelected","monthSelected","viewChanged","_userSelection","_userDragDrop"],[3,"cdkPortalOutlet"],["type","button","mat-raised-button","",1,"mat-datepicker-close-button",3,"color","focus","blur","click"]],template:function(s,d){if(s&1&&(T(0,"div",0)(1,"mat-calendar",1),ct("yearSelected",function(_){return d.datepicker._selectYear(_)})("monthSelected",function(_){return d.datepicker._selectMonth(_)})("viewChanged",function(_){return d.datepicker._viewChanged(_)})("_userSelection",function(_){return d._handleUserSelection(_)})("_userDragDrop",function(_){return d._handleUserDragDrop(_)}),k(),ut(2,wct,0,0,"ng-template",2),T(3,"button",3),ct("focus",function(){return d._closeButtonFocused=!0})("blur",function(){return d._closeButtonFocused=!1})("click",function(){return d.datepicker.close()}),B(4),k()()),s&2){let m;li("mat-datepicker-content-container-with-custom-header",d.datepicker.calendarHeaderComponent)("mat-datepicker-content-container-with-actions",d._actionsPortal),ri("aria-modal",!0)("aria-labelledby",(m=d._dialogLabelId)!==null&&m!==void 0?m:void 0),z(),W("id",d.datepicker.id)("ngClass",d.datepicker.panelClass)("startAt",d.datepicker.startAt)("startView",d.datepicker.startView)("minDate",d.datepicker._getMinDate())("maxDate",d.datepicker._getMaxDate())("dateFilter",d.datepicker._getDateFilter())("headerComponent",d.datepicker.calendarHeaderComponent)("selected",d._getSelected())("dateClass",d.datepicker.dateClass)("comparisonStart",d.comparisonStart)("comparisonEnd",d.comparisonEnd)("@fadeInCalendar","enter")("startDateAccessibleName",d.startDateAccessibleName)("endDateAccessibleName",d.endDateAccessibleName),z(),W("cdkPortalOutlet",d._actionsPortal),z(),li("cdk-visually-hidden",!d._closeButtonFocused),W("color",d.color||"primary"),z(),Te(d._closeButtonText)}},dependencies:[Cz,ST,Uo,ul,ea],styles:[".mat-datepicker-content{display:block;border-radius:4px;background-color:var(--mat-datepicker-calendar-container-background-color);color:var(--mat-datepicker-calendar-container-text-color);box-shadow:var(--mat-datepicker-calendar-container-elevation-shadow);border-radius:var(--mat-datepicker-calendar-container-shape)}.mat-datepicker-content .mat-calendar{width:296px;height:354px}.mat-datepicker-content .mat-datepicker-content-container-with-custom-header .mat-calendar{height:auto}.mat-datepicker-content .mat-datepicker-close-button{position:absolute;top:100%;left:0;margin-top:8px}.ng-animating .mat-datepicker-content .mat-datepicker-close-button{display:none}.mat-datepicker-content-container{display:flex;flex-direction:column;justify-content:space-between}.mat-datepicker-content-touch{display:block;max-height:80vh;box-shadow:var(--mat-datepicker-calendar-container-touch-elevation-shadow);border-radius:var(--mat-datepicker-calendar-container-touch-shape);position:relative;overflow:visible}.mat-datepicker-content-touch .mat-datepicker-content-container{min-height:312px;max-height:788px;min-width:250px;max-width:750px}.mat-datepicker-content-touch .mat-calendar{width:100%;height:auto}@media all and (orientation: landscape){.mat-datepicker-content-touch .mat-datepicker-content-container{width:64vh;height:80vh}}@media all and (orientation: portrait){.mat-datepicker-content-touch .mat-datepicker-content-container{width:80vw;height:100vw}.mat-datepicker-content-touch .mat-datepicker-content-container-with-actions{height:115vw}}"],encapsulation:2,data:{animation:[XV.transformPanel,XV.fadeInCalendar]},changeDetection:0});let a=r;return a})(),KV=(()=>{let r=class r{get startAt(){return this._startAt||(this.datepickerInput?this.datepickerInput.getStartValue():null)}set startAt(n){this._startAt=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get color(){return this._color||(this.datepickerInput?this.datepickerInput.getThemePalette():void 0)}set color(n){this._color=n}get disabled(){return this._disabled===void 0&&this.datepickerInput?this.datepickerInput.disabled:!!this._disabled}set disabled(n){n!==this._disabled&&(this._disabled=n,this.stateChanges.next(void 0))}get panelClass(){return this._panelClass}set panelClass(n){this._panelClass=Z3(n)}get opened(){return this._opened}set opened(n){n?this.open():this.close()}_getMinDate(){return this.datepickerInput&&this.datepickerInput.min}_getMaxDate(){return this.datepickerInput&&this.datepickerInput.max}_getDateFilter(){return this.datepickerInput&&this.datepickerInput.dateFilter}constructor(n,s,d,m,_,w,S){this._overlay=n,this._ngZone=s,this._viewContainerRef=d,this._dateAdapter=_,this._dir=w,this._model=S,this._inputStateChanges=sr.EMPTY,this._document=le(ci),this.startView="month",this.touchUi=!1,this.xPosition="start",this.yPosition="below",this.restoreFocus=!0,this.yearSelected=new ye,this.monthSelected=new ye,this.viewChanged=new ye(!0),this.openedStream=new ye,this.closedStream=new ye,this._opened=!1,this.id=`mat-datepicker-${Pct++}`,this._focusedElementBeforeOpen=null,this._backdropHarnessClass=`${this.id}-backdrop`,this.stateChanges=new pe,this._dateAdapter,this._scrollStrategy=m}ngOnChanges(n){let s=n.xPosition||n.yPosition;if(s&&!s.firstChange&&this._overlayRef){let d=this._overlayRef.getConfig().positionStrategy;d instanceof sg&&(this._setConnectedPositions(d),this.opened&&this._overlayRef.updatePosition())}this.stateChanges.next(void 0)}ngOnDestroy(){this._destroyOverlay(),this.close(),this._inputStateChanges.unsubscribe(),this.stateChanges.complete()}select(n){this._model.add(n)}_selectYear(n){this.yearSelected.emit(n)}_selectMonth(n){this.monthSelected.emit(n)}_viewChanged(n){this.viewChanged.emit(n)}registerInput(n){return this.datepickerInput,this._inputStateChanges.unsubscribe(),this.datepickerInput=n,this._inputStateChanges=n.stateChanges.subscribe(()=>this.stateChanges.next(void 0)),this._model}registerActions(n){this._actionsPortal,this._actionsPortal=n,this._componentRef?.instance._assignActions(n,!0)}removeActions(n){n===this._actionsPortal&&(this._actionsPortal=null,this._componentRef?.instance._assignActions(null,!0))}open(){this._opened||this.disabled||this._componentRef?.instance._isAnimating||(this.datepickerInput,this._focusedElementBeforeOpen=xd(),this._openOverlay(),this._opened=!0,this.openedStream.emit())}close(){if(!this._opened||this._componentRef?.instance._isAnimating)return;let n=this.restoreFocus&&this._focusedElementBeforeOpen&&typeof this._focusedElementBeforeOpen.focus=="function",s=()=>{this._opened&&(this._opened=!1,this.closedStream.emit())};if(this._componentRef){let{instance:d,location:m}=this._componentRef;d._startExitAnimation(),d._animationDone.pipe(tn(1)).subscribe(()=>{let _=this._document.activeElement;n&&(!_||_===this._document.activeElement||m.nativeElement.contains(_))&&this._focusedElementBeforeOpen.focus(),this._focusedElementBeforeOpen=null,this._destroyOverlay()})}n?setTimeout(s):s()}_applyPendingSelection(){this._componentRef?.instance?._applyPendingSelection()}_forwardContentValues(n){n.datepicker=this,n.color=this.color,n._dialogLabelId=this.datepickerInput.getOverlayLabelId(),n._assignActions(this._actionsPortal,!1)}_openOverlay(){this._destroyOverlay();let n=this.touchUi,s=new ns(Fct,this._viewContainerRef),d=this._overlayRef=this._overlay.create(new rs({positionStrategy:n?this._getDialogStrategy():this._getDropdownStrategy(),hasBackdrop:!0,backdropClass:[n?"cdk-overlay-dark-backdrop":"mat-overlay-transparent-backdrop",this._backdropHarnessClass],direction:this._dir,scrollStrategy:n?this._overlay.scrollStrategies.block():this._scrollStrategy(),panelClass:`mat-datepicker-${n?"dialog":"popup"}`}));this._getCloseStream(d).subscribe(m=>{m&&m.preventDefault(),this.close()}),d.keydownEvents().subscribe(m=>{let _=m.keyCode;(_===38||_===40||_===37||_===39||_===33||_===34)&&m.preventDefault()}),this._componentRef=d.attach(s),this._forwardContentValues(this._componentRef.instance),n||this._ngZone.onStable.pipe(tn(1)).subscribe(()=>d.updatePosition())}_destroyOverlay(){this._overlayRef&&(this._overlayRef.dispose(),this._overlayRef=this._componentRef=null)}_getDialogStrategy(){return this._overlay.position().global().centerHorizontally().centerVertically()}_getDropdownStrategy(){let n=this._overlay.position().flexibleConnectedTo(this.datepickerInput.getConnectedOverlayOrigin()).withTransformOriginOn(".mat-datepicker-content").withFlexibleDimensions(!1).withViewportMargin(8).withLockedPosition();return this._setConnectedPositions(n)}_setConnectedPositions(n){let s=this.xPosition==="end"?"end":"start",d=s==="start"?"end":"start",m=this.yPosition==="above"?"bottom":"top",_=m==="top"?"bottom":"top";return n.withPositions([{originX:s,originY:_,overlayX:s,overlayY:m},{originX:s,originY:m,overlayX:s,overlayY:_},{originX:d,originY:_,overlayX:d,overlayY:m},{originX:d,originY:m,overlayX:d,overlayY:_}])}_getCloseStream(n){let s=["ctrlKey","shiftKey","metaKey"];return no(n.backdropClick(),n.detachments(),n.keydownEvents().pipe(pn(d=>d.keyCode===27&&!Zr(d)||this.datepickerInput&&Zr(d,"altKey")&&d.keyCode===38&&s.every(m=>!Zr(d,m)))))}};r.\u0275fac=function(s){return new(s||r)(V(Zn),V(Be),V(Do),V(Oct),V(Qo,8),V(Ao,8),V(Zg))},r.\u0275dir=oe({type:r,inputs:{calendarHeaderComponent:"calendarHeaderComponent",startAt:"startAt",startView:"startView",color:"color",touchUi:[Rt.HasDecoratorInputTransform,"touchUi","touchUi",Qe],disabled:[Rt.HasDecoratorInputTransform,"disabled","disabled",Qe],xPosition:"xPosition",yPosition:"yPosition",restoreFocus:[Rt.HasDecoratorInputTransform,"restoreFocus","restoreFocus",Qe],dateClass:"dateClass",panelClass:"panelClass",opened:[Rt.HasDecoratorInputTransform,"opened","opened",Qe]},outputs:{yearSelected:"yearSelected",monthSelected:"monthSelected",viewChanged:"viewChanged",openedStream:"opened",closedStream:"closed"},features:[Fn,Yn]});let a=r;return a})(),ij=(()=>{let r=class r extends KV{};r.\u0275fac=(()=>{let n;return function(d){return(n||(n=Nr(r)))(d||r)}})(),r.\u0275cmp=St({type:r,selectors:[["mat-datepicker"]],exportAs:["matDatepicker"],standalone:!0,features:[ji([QV,{provide:KV,useExisting:r}]),Di,At],decls:0,vars:0,template:function(s,d){},encapsulation:2,changeDetection:0});let a=r;return a})(),ip=class{constructor(r,l){this.target=r,this.targetElement=l,this.value=this.target.value}},Lct=(()=>{let r=class r{get value(){return this._model?this._getValueFromModel(this._model.selection):this._pendingValue}set value(n){this._assignValueProgrammatically(n)}get disabled(){return!!this._disabled||this._parentDisabled()}set disabled(n){let s=n,d=this._elementRef.nativeElement;this._disabled!==s&&(this._disabled=s,this.stateChanges.next(void 0)),s&&this._isInitialized&&d.blur&&d.blur()}_getValidators(){return[this._parseValidator,this._minValidator,this._maxValidator,this._filterValidator]}_registerModel(n){this._model=n,this._valueChangesSubscription.unsubscribe(),this._pendingValue&&this._assignValue(this._pendingValue),this._valueChangesSubscription=this._model.selectionChanged.subscribe(s=>{if(this._shouldHandleChangeEvent(s)){let d=this._getValueFromModel(s.selection);this._lastValueValid=this._isValidValue(d),this._cvaOnChange(d),this._onTouched(),this._formatValue(d),this.dateInput.emit(new ip(this,this._elementRef.nativeElement)),this.dateChange.emit(new ip(this,this._elementRef.nativeElement))}})}constructor(n,s,d){this._elementRef=n,this._dateAdapter=s,this._dateFormats=d,this.dateChange=new ye,this.dateInput=new ye,this.stateChanges=new pe,this._onTouched=()=>{},this._validatorOnChange=()=>{},this._cvaOnChange=()=>{},this._valueChangesSubscription=sr.EMPTY,this._localeSubscription=sr.EMPTY,this._parseValidator=()=>this._lastValueValid?null:{matDatepickerParse:{text:this._elementRef.nativeElement.value}},this._filterValidator=m=>{let _=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(m.value));return!_||this._matchesFilter(_)?null:{matDatepickerFilter:!0}},this._minValidator=m=>{let _=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(m.value)),w=this._getMinDate();return!w||!_||this._dateAdapter.compareDate(w,_)<=0?null:{matDatepickerMin:{min:w,actual:_}}},this._maxValidator=m=>{let _=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(m.value)),w=this._getMaxDate();return!w||!_||this._dateAdapter.compareDate(w,_)>=0?null:{matDatepickerMax:{max:w,actual:_}}},this._lastValueValid=!1,this._localeSubscription=s.localeChanges.subscribe(()=>{this._assignValueProgrammatically(this.value)})}ngAfterViewInit(){this._isInitialized=!0}ngOnChanges(n){zct(n,this._dateAdapter)&&this.stateChanges.next(void 0)}ngOnDestroy(){this._valueChangesSubscription.unsubscribe(),this._localeSubscription.unsubscribe(),this.stateChanges.complete()}registerOnValidatorChange(n){this._validatorOnChange=n}validate(n){return this._validator?this._validator(n):null}writeValue(n){this._assignValueProgrammatically(n)}registerOnChange(n){this._cvaOnChange=n}registerOnTouched(n){this._onTouched=n}setDisabledState(n){this.disabled=n}_onKeydown(n){let s=["ctrlKey","shiftKey","metaKey"];Zr(n,"altKey")&&n.keyCode===40&&s.every(m=>!Zr(n,m))&&!this._elementRef.nativeElement.readOnly&&(this._openPopup(),n.preventDefault())}_onInput(n){let s=this._lastValueValid,d=this._dateAdapter.parse(n,this._dateFormats.parse.dateInput);this._lastValueValid=this._isValidValue(d),d=this._dateAdapter.getValidDateOrNull(d);let m=!this._dateAdapter.sameDate(d,this.value);!d||m?this._cvaOnChange(d):(n&&!this.value&&this._cvaOnChange(d),s!==this._lastValueValid&&this._validatorOnChange()),m&&(this._assignValue(d),this.dateInput.emit(new ip(this,this._elementRef.nativeElement)))}_onChange(){this.dateChange.emit(new ip(this,this._elementRef.nativeElement))}_onBlur(){this.value&&this._formatValue(this.value),this._onTouched()}_formatValue(n){this._elementRef.nativeElement.value=n!=null?this._dateAdapter.format(n,this._dateFormats.display.dateInput):""}_assignValue(n){this._model?(this._assignValueToModel(n),this._pendingValue=null):this._pendingValue=n}_isValidValue(n){return!n||this._dateAdapter.isValid(n)}_parentDisabled(){return!1}_assignValueProgrammatically(n){n=this._dateAdapter.deserialize(n),this._lastValueValid=this._isValidValue(n),n=this._dateAdapter.getValidDateOrNull(n),this._assignValue(n),this._formatValue(n)}_matchesFilter(n){let s=this._getDateFilter();return!s||s(n)}};r.\u0275fac=function(s){return new(s||r)(V(Ee),V(Qo,8),V(Ed,8))},r.\u0275dir=oe({type:r,inputs:{value:"value",disabled:[Rt.HasDecoratorInputTransform,"disabled","disabled",Qe]},outputs:{dateChange:"dateChange",dateInput:"dateInput"},standalone:!0,features:[Fn,Yn]});let a=r;return a})();function zct(a,r){let l=Object.keys(a);for(let n of l){let{previousValue:s,currentValue:d}=a[n];if(r.isDateInstance(s)&&r.isDateInstance(d)){if(!r.sameDate(s,d))return!0}else return!0}return!1}var Nct={provide:wa,useExisting:jo(()=>Lx),multi:!0},Bct={provide:bd,useExisting:jo(()=>Lx),multi:!0},Lx=(()=>{let r=class r extends Lct{set matDatepicker(n){n&&(this._datepicker=n,this._closedSubscription=n.closedStream.subscribe(()=>this._onTouched()),this._registerModel(n.registerInput(this)))}get min(){return this._min}set min(n){let s=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n));this._dateAdapter.sameDate(s,this._min)||(this._min=s,this._validatorOnChange())}get max(){return this._max}set max(n){let s=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n));this._dateAdapter.sameDate(s,this._max)||(this._max=s,this._validatorOnChange())}get dateFilter(){return this._dateFilter}set dateFilter(n){let s=this._matchesFilter(this.value);this._dateFilter=n,this._matchesFilter(this.value)!==s&&this._validatorOnChange()}constructor(n,s,d,m){super(n,s,d),this._formField=m,this._closedSubscription=sr.EMPTY,this._validator=Le.compose(super._getValidators())}getConnectedOverlayOrigin(){return this._formField?this._formField.getConnectedOverlayOrigin():this._elementRef}getOverlayLabelId(){return this._formField?this._formField.getLabelId():this._elementRef.nativeElement.getAttribute("aria-labelledby")}getThemePalette(){return this._formField?this._formField.color:void 0}getStartValue(){return this.value}ngOnDestroy(){super.ngOnDestroy(),this._closedSubscription.unsubscribe()}_openPopup(){this._datepicker&&this._datepicker.open()}_getValueFromModel(n){return n}_assignValueToModel(n){this._model&&this._model.updateSelection(n,this)}_getMinDate(){return this._min}_getMaxDate(){return this._max}_getDateFilter(){return this._dateFilter}_shouldHandleChangeEvent(n){return n.source!==this}};r.\u0275fac=function(s){return new(s||r)(V(Ee),V(Qo,8),V(Ed,8),V(Fu,8))},r.\u0275dir=oe({type:r,selectors:[["input","matDatepicker",""]],hostAttrs:[1,"mat-datepicker-input"],hostVars:6,hostBindings:function(s,d){s&1&&ct("input",function(_){return d._onInput(_.target.value)})("change",function(){return d._onChange()})("blur",function(){return d._onBlur()})("keydown",function(_){return d._onKeydown(_)}),s&2&&(Os("disabled",d.disabled),ri("aria-haspopup",d._datepicker?"dialog":null)("aria-owns",(d._datepicker==null?null:d._datepicker.opened)&&d._datepicker.id||null)("min",d.min?d._dateAdapter.toIso8601(d.min):null)("max",d.max?d._dateAdapter.toIso8601(d.max):null)("data-mat-calendar",d._datepicker?d._datepicker.id:null))},inputs:{matDatepicker:"matDatepicker",min:"min",max:"max",dateFilter:[Rt.None,"matDatepickerFilter","dateFilter"]},exportAs:["matDatepickerInput"],standalone:!0,features:[ji([Nct,Bct,{provide:EM,useExisting:r}]),Di]});let a=r;return a})(),Vct=(()=>{let r=class r{};r.\u0275fac=function(s){return new(s||r)},r.\u0275dir=oe({type:r,selectors:[["","matDatepickerToggleIcon",""]],standalone:!0});let a=r;return a})(),nj=(()=>{let r=class r{get disabled(){return this._disabled===void 0&&this.datepicker?this.datepicker.disabled:!!this._disabled}set disabled(n){this._disabled=n}constructor(n,s,d){this._intl=n,this._changeDetectorRef=s,this._stateChanges=sr.EMPTY;let m=Number(d);this.tabIndex=m||m===0?m:null}ngOnChanges(n){n.datepicker&&this._watchStateChanges()}ngOnDestroy(){this._stateChanges.unsubscribe()}ngAfterContentInit(){this._watchStateChanges()}_open(n){this.datepicker&&!this.disabled&&(this.datepicker.open(),n.stopPropagation())}_watchStateChanges(){let n=this.datepicker?this.datepicker.stateChanges:Fe(),s=this.datepicker&&this.datepicker.datepickerInput?this.datepicker.datepickerInput.stateChanges:Fe(),d=this.datepicker?no(this.datepicker.openedStream,this.datepicker.closedStream):Fe();this._stateChanges.unsubscribe(),this._stateChanges=no(this._intl.changes,n,s,d).subscribe(()=>this._changeDetectorRef.markForCheck())}};r.\u0275fac=function(s){return new(s||r)(V(Fx),V(Zi),ol("tabindex"))},r.\u0275cmp=St({type:r,selectors:[["mat-datepicker-toggle"]],contentQueries:function(s,d,m){if(s&1&&fn(m,Vct,5),s&2){let _;se(_=ae())&&(d._customIcon=_.first)}},viewQuery:function(s,d){if(s&1&&ze(Cct,5),s&2){let m;se(m=ae())&&(d._button=m.first)}},hostAttrs:[1,"mat-datepicker-toggle"],hostVars:8,hostBindings:function(s,d){s&1&&ct("click",function(_){return d._open(_)}),s&2&&(ri("tabindex",null)("data-mat-calendar",d.datepicker?d.datepicker.id:null),li("mat-datepicker-toggle-active",d.datepicker&&d.datepicker.opened)("mat-accent",d.datepicker&&d.datepicker.color==="accent")("mat-warn",d.datepicker&&d.datepicker.color==="warn"))},inputs:{datepicker:[Rt.None,"for","datepicker"],tabIndex:"tabIndex",ariaLabel:[Rt.None,"aria-label","ariaLabel"],disabled:[Rt.HasDecoratorInputTransform,"disabled","disabled",Qe],disableRipple:"disableRipple"},exportAs:["matDatepickerToggle"],standalone:!0,features:[Fn,Yn,At],ngContentSelectors:Mct,decls:4,vars:6,consts:[["mat-icon-button","","type","button",3,"disabled","disableRipple"],["button",""],["class","mat-datepicker-toggle-default-icon","viewBox","0 0 24 24","width","24px","height","24px","fill","currentColor","focusable","false","aria-hidden","true"],["viewBox","0 0 24 24","width","24px","height","24px","fill","currentColor","focusable","false","aria-hidden","true",1,"mat-datepicker-toggle-default-icon"],["d","M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"]],template:function(s,d){s&1&&(Un(Ect),T(0,"button",0,1),ut(2,Sct,2,0,":svg:svg",2),Ai(3),k()),s&2&&(W("disabled",d.disabled)("disableRipple",d.disableRipple),ri("aria-haspopup",d.datepicker?"dialog":null)("aria-label",d.ariaLabel||d._intl.openCalendarLabel)("tabindex",d.disabled?-1:d.tabIndex),z(2),Xi(2,d._customIcon?-1:2))},dependencies:[Ac],styles:[".mat-datepicker-toggle{pointer-events:auto;color:var(--mat-datepicker-toggle-icon-color)}.mat-datepicker-toggle-active{color:var(--mat-datepicker-toggle-active-state-icon-color)}.cdk-high-contrast-active .mat-datepicker-toggle-default-icon{color:CanvasText}"],encapsulation:2,changeDetection:0});let a=r;return a})();var rj=(()=>{let r=class r{constructor(n){this.http=n}getLocations(){return this.http.get(be+"/locations/names")}getArtists(){return this.http.get(be+"/artists/names")}getGenres(){return this.http.get(be+"/broad-genres/names")}};r.\u0275fac=function(s){return new(s||r)(ht(Hi))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var Uct=a=>({selected:a});function Hct(a,r){if(a&1){let l=we();T(0,"div",14),ct("click",function(){let d=Kt(l).$implicit,m=gt();return Qt(m.selectedItem=d)}),T(1,"b"),B(2),k()()}if(a&2){let l=r.$implicit,n=gt();W("ngClass",xi(2,Uct,n.selectedItem===l)),z(2),Te(l)}}function Gct(a,r){if(a&1){let l=we();T(0,"div",19)(1,"div",20)(2,"input",21),ct("change",function(){let d=Kt(l).$implicit,m=gt(2);return Qt(m.toggleSelection("location",d))}),k(),T(3,"label",22),B(4),k()()()}if(a&2){let l=r.$implicit,n=gt(2);z(2),W("id","location_"+l)("checked",n.selectedLocations.includes(l)),z(),W("for","location_"+l),z(),ie(" ",l," ")}}function qct(a,r){if(a&1){let l=we();T(0,"div")(1,"h3"),B(2,"Locatii"),k(),T(3,"div",15)(4,"input",16),Cn("ngModelChange",function(s){Kt(l);let d=gt();return wn(d.searchLocation,s)||(d.searchLocation=s),Qt(s)}),ct("ngModelChange",function(){Kt(l);let s=gt();return Qt(s.filter("locations"))}),k()(),T(5,"div",17),ut(6,Gct,5,4,"div",18),k()()}if(a&2){let l=gt();z(4),xn("ngModel",l.searchLocation),z(2),W("ngForOf",l.filteredLocations)}}function Wct(a,r){if(a&1){let l=we();T(0,"div",25)(1,"div",20)(2,"input",21),ct("change",function(){let d=Kt(l).$implicit,m=gt(2);return Qt(m.toggleSelection("artist",d))}),k(),T(3,"label",22),B(4),k()()()}if(a&2){let l=r.$implicit,n=gt(2);z(2),W("id","artist_"+l)("checked",n.selectedArtists.includes(l)),z(),W("for","artist_"+l),z(),ie(" ",l," ")}}function $ct(a,r){if(a&1){let l=we();T(0,"div")(1,"h3"),B(2,"Artisti"),k(),T(3,"div",15)(4,"input",23),Cn("ngModelChange",function(s){Kt(l);let d=gt();return wn(d.searchArtist,s)||(d.searchArtist=s),Qt(s)}),ct("ngModelChange",function(){Kt(l);let s=gt();return Qt(s.filter("artists"))}),k()(),T(5,"div",17),ut(6,Wct,5,4,"div",24),k()()}if(a&2){let l=gt();z(4),xn("ngModel",l.searchArtist),z(2),W("ngForOf",l.filteredArtists)}}function Yct(a,r){if(a&1){let l=we();T(0,"div",25)(1,"div",20)(2,"input",21),ct("change",function(){let d=Kt(l).$implicit,m=gt(2);return Qt(m.toggleSelection("genre",d))}),k(),T(3,"label",22),B(4),k()()()}if(a&2){let l=r.$implicit,n=gt(2);z(2),W("id","genre_"+l)("checked",n.selectedGenres.includes(l)),z(),W("for","genre_"+l),z(),ie(" ",l," ")}}function Zct(a,r){if(a&1){let l=we();T(0,"div")(1,"h3"),B(2,"Genuri"),k(),T(3,"div",15)(4,"input",26),Cn("ngModelChange",function(s){Kt(l);let d=gt();return wn(d.searchGenre,s)||(d.searchGenre=s),Qt(s)}),ct("ngModelChange",function(){Kt(l);let s=gt();return Qt(s.filter("genres"))}),k()(),T(5,"div",17),ut(6,Yct,5,4,"div",24),k()()}if(a&2){let l=gt();z(4),xn("ngModel",l.searchGenre),z(2),W("ngForOf",l.filteredGenres)}}function Xct(a,r){if(a&1){let l=we();T(0,"div")(1,"h3"),B(2,"Data"),k(),T(3,"form",27)(4,"mat-form-field")(5,"mat-label"),B(6,"Data de inceput"),k(),T(7,"input",28),ct("dateChange",function(){Kt(l);let s=gt();return Qt(s.onStartDateChange())}),k(),dt(8,"mat-datepicker-toggle",29)(9,"mat-datepicker",null,30),k(),dt(11,"br"),T(12,"mat-form-field")(13,"mat-label"),B(14,"Data de sfarsit"),k(),T(15,"input",31),ct("dateChange",function(){Kt(l);let s=gt();return Qt(s.onEndDateChange())}),k(),dt(16,"mat-datepicker-toggle",29)(17,"mat-datepicker",null,32),k()()()}if(a&2){let l=oo(10),n=oo(18),s=gt();z(3),W("formGroup",s.range),z(4),W("matDatepicker",l)("min",s.today),z(),W("for",l),z(7),W("matDatepicker",n)("min",s.today),z(),W("for",n)}}function Kct(a,r){if(a&1){let l=we();T(0,"div",35),B(1),T(2,"button",36),ct("click",function(){let d=Kt(l).$implicit,m=gt(2);return Qt(m.removeFilter("location",d))}),dt(3,"i",37),k()()}if(a&2){let l=r.$implicit;z(),ie(" ",l," ")}}function Qct(a,r){if(a&1&&(T(0,"div"),B(1," Locatii: "),T(2,"div",33),ut(3,Kct,4,1,"div",34),k()()),a&2){let l=gt();z(3),W("ngForOf",l.selectedLocations)}}function Jct(a,r){if(a&1){let l=we();T(0,"div",35),B(1),T(2,"button",36),ct("click",function(){let d=Kt(l).$implicit,m=gt(2);return Qt(m.removeFilter("artist",d))}),dt(3,"i",37),k()()}if(a&2){let l=r.$implicit;z(),ie(" ",l," ")}}function tdt(a,r){if(a&1&&(T(0,"div"),B(1," Artisti: "),T(2,"div",33),ut(3,Jct,4,1,"div",34),k()()),a&2){let l=gt();z(3),W("ngForOf",l.selectedArtists)}}function edt(a,r){if(a&1){let l=we();T(0,"div",35),B(1),T(2,"button",36),ct("click",function(){let d=Kt(l).$implicit,m=gt(2);return Qt(m.removeFilter("genre",d))}),dt(3,"i",37),k()()}if(a&2){let l=r.$implicit;z(),ie(" ",l," ")}}function idt(a,r){if(a&1&&(T(0,"div"),B(1," Genuri: "),T(2,"div",33),ut(3,edt,4,1,"div",34),k()()),a&2){let l=gt();z(3),W("ngForOf",l.selectedGenres)}}function ndt(a,r){if(a&1){let l=we();T(0,"div"),B(1,"Data: "),T(2,"div",33)(3,"div",35),B(4),T(5,"button",36),ct("click",function(){Kt(l);let s=gt();return Qt(s.removeFilter("date",""))}),dt(6,"i",37),k()()()()}if(a&2){let l=gt();z(4),po(" ",l.selectedStartDate," - ",l.selectedEndDate," ")}}var oj=(()=>{let r=class r{constructor(n,s,d,m){this.dialogRef=n,this.data=s,this.eventListFilterService=d,this.formBuilder=m,this.navigationItems=["Locatie","Artist","Gen","Data"],this.locations=[],this.artists=[],this.genres=[],this.selectedLocations=[],this.selectedArtists=[],this.selectedGenres=[],this.selectedStartDate="",this.selectedEndDate="",this.selectedItem="Locatie",this.today=new Date,this.searchLocation="",this.searchArtist="",this.searchGenre=""}ngOnInit(){this.eventListFilterService.getLocations().subscribe(n=>{this.locations=n,this.filteredLocations=n}),this.eventListFilterService.getArtists().subscribe(n=>{this.artists=n,this.filteredArtists=n}),this.eventListFilterService.getGenres().subscribe(n=>{this.genres=n,this.filteredGenres=n}),this.data.location!==void 0&&(this.selectedLocations=this.data.location.split(",")),this.data.artist!==void 0&&(this.selectedArtists=this.data.artist.split(",")),this.data.genre!==void 0&&(this.selectedGenres=this.data.genre.split(",")),this.data.startDate!==void 0&&(this.selectedStartDate=this.data.startDate),this.data.endDate!==void 0&&(this.selectedEndDate=this.data.endDate),this.range=this.formBuilder.group({start:[""],end:[""]})}close(){this.dialogRef.close()}onStartDateChange(){let n=this.range.get("start"),s=this.range.get("end");if(n&&s){let d=n.value,m=s.value;d>m&&s.setValue(d)}this.selectedStartDate=this.getFormattedDate(n?.value),this.selectedEndDate=this.getFormattedDate(s?.value)}onEndDateChange(){let n=this.range.get("start"),s=this.range.get("end");if(n&&s){let d=s.value,m=n.value;d<m&&n.setValue(d)}this.selectedStartDate=this.getFormattedDate(n?.value),this.selectedEndDate=this.getFormattedDate(s?.value)}getFormattedDate(n){let s=new Date(n);return s.setDate(s.getDate()+1),s.toISOString().split("T")[0]}toggleSelection(n,s){let d;switch(n){case"location":d=this.selectedLocations;break;case"artist":d=this.selectedArtists;break;case"genre":d=this.selectedGenres;break;default:return}let m=d.indexOf(s);m===-1?d.push(s):d.splice(m,1)}removeFilter(n,s){switch(n){case"location":let d=this.selectedLocations.indexOf(s);d!==-1&&this.selectedLocations.splice(d,1);break;case"artist":let m=this.selectedArtists.indexOf(s);m!==-1&&this.selectedArtists.splice(m,1);break;case"genre":let _=this.selectedGenres.indexOf(s);_!==-1&&this.selectedGenres.splice(_,1);break;case"date":this.selectedStartDate="",this.selectedEndDate="",this.range.reset();break;default:break}}saveFilter(){let n={selectedLocations:this.selectedLocations,selectedArtists:this.selectedArtists,selectedGenres:this.selectedGenres,selectedStartDate:this.selectedStartDate,selectedEndDate:this.selectedEndDate};this.dialogRef.close(n)}filter(n){switch(n){case"locations":this.filteredLocations=this.locations.filter(s=>s.toLowerCase().includes(this.searchLocation.toLowerCase()));break;case"artists":this.filteredArtists=this.artists.filter(s=>s.toLowerCase().includes(this.searchArtist.toLowerCase()));break;case"genres":this.filteredGenres=this.genres.filter(s=>s.toLowerCase().includes(this.searchGenre.toLowerCase()));break;default:break}}};r.\u0275fac=function(s){return new(s||r)(V(er),V(jr),V(rj),V(Er))},r.\u0275cmp=St({type:r,selectors:[["app-event-list-filter"]],standalone:!0,features:[ji([Py()]),At],decls:27,vars:9,consts:[[1,"container-fluid"],[1,"row","filter-container"],[1,"col-sm-3"],[1,"navigation"],[1,"text-center"],["class","navigation-item",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"col-sm-1"],[1,"vertical-line"],[1,"col-sm-8"],[4,"ngIf"],[1,"row","footer"],[1,"selected-filters-section"],[1,"bottom-buttons"],[1,"btn",3,"click"],[1,"navigation-item",3,"ngClass","click"],[1,"input-group"],["type","text","placeholder","Cauta locatie",1,"form-control",3,"ngModel","ngModelChange"],[1,"options"],["class","locatios",4,"ngFor","ngForOf"],[1,"locatios"],[1,"form-check"],["type","checkbox",1,"form-check-input",3,"id","checked","change"],[1,"form-check-label",3,"for"],["type","text","placeholder","Cauta artist",1,"form-control",3,"ngModel","ngModelChange"],["class","genre",4,"ngFor","ngForOf"],[1,"genre"],["type","text","placeholder","Cauta gen",1,"form-control",3,"ngModel","ngModelChange"],[3,"formGroup"],["matInput","","formControlName","start",3,"matDatepicker","min","dateChange"],["matSuffix","",3,"for"],["picker1",""],["matInput","","formControlName","end",3,"matDatepicker","min","dateChange"],["picker2",""],[1,"selected-filters"],["class","filter",4,"ngFor","ngForOf"],[1,"filter"],[1,"btn","btn-sm",3,"click"],[1,"fa","fa-times"]],template:function(s,d){s&1&&(T(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h4",4),B(5,"Filtru"),k(),dt(6,"hr"),ut(7,Hct,3,4,"div",5),k()(),T(8,"div",6),dt(9,"div",7),k(),T(10,"div",8),ut(11,qct,7,2,"div",9)(12,$ct,7,2,"div",9)(13,Zct,7,2,"div",9)(14,Xct,19,7,"div",9),k()(),dt(15,"hr"),T(16,"div",10)(17,"div",11),ut(18,Qct,4,1,"div",9)(19,tdt,4,1,"div",9)(20,idt,4,1,"div",9)(21,ndt,7,2,"div",9),k()(),T(22,"div",12)(23,"button",13),ct("click",function(){return d.close()}),B(24,"Close"),k(),T(25,"button",13),ct("click",function(){return d.saveFilter()}),B(26,"Save"),k()()()),s&2&&(z(7),W("ngForOf",d.navigationItems),z(4),W("ngIf",d.selectedItem==="Locatie"),z(),W("ngIf",d.selectedItem==="Artist"),z(),W("ngIf",d.selectedItem==="Gen"),z(),W("ngIf",d.selectedItem==="Data"),z(4),W("ngIf",d.selectedLocations.length>0),z(),W("ngIf",d.selectedArtists.length>0),z(),W("ngIf",d.selectedGenres.length>0),z(),W("ngIf",d.selectedStartDate!=""&&d.selectedEndDate!=""))},dependencies:[pi,Uo,Ve,Ny,nj,pN,By,vN,Lx,ij,Ni,Sr,en,qi,Cr,To,Mn,Hn,hr],styles:[".container-fluid[_ngcontent-%COMP%]{padding:20px;overflow-x:hidden;display:flex;flex-direction:column;height:100%}.navigation-item[_ngcontent-%COMP%]{padding:10px;cursor:pointer;text-align:center}.navigation-item[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.selected[_ngcontent-%COMP%]{background-color:#e0e0e0}.vertical-line[_ngcontent-%COMP%]{border-left:1px solid #ccc;height:100%}.options[_ngcontent-%COMP%]{padding:10px;display:flex;flex-wrap:wrap;gap:20px}.selected-filters[_ngcontent-%COMP%]{padding:10px;display:flex;flex-wrap:wrap;gap:10px}.filter-container[_ngcontent-%COMP%]{overflow-y:auto}.filter[_ngcontent-%COMP%]{padding:5px;background-color:#4169e1;color:#fff;border-radius:5px}.footer[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px;flex:1}.bottom-buttons[_ngcontent-%COMP%]{flex-shrink:0;width:100%;padding:10px;text-align:center}"]});let a=r;return a})();var rp=(()=>{let r=class r{constructor(n){this.router=n,this.loadingSubject=new We(!1),this.loading$=this.loadingSubject.asObservable()}ngOnInit(){this.router.events.pipe(pn(n=>n instanceof Mc)).subscribe(()=>{this.show()}),this.router.events.pipe(pn(n=>n instanceof ps)).subscribe(()=>{this.hide()})}show(){this.loadingSubject.next(!0)}hide(){this.loadingSubject.next(!1)}};r.\u0275fac=function(s){return new(s||r)(ht(zi))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();function rdt(a,r){if(a&1){let l=we();T(0,"div",10),B(1),T(2,"button",11),ct("click",function(){let d=Kt(l).$implicit,m=gt();return Qt(m.removeFilter("location",d))}),dt(3,"i",12),k()()}if(a&2){let l=r.$implicit;z(),ie(" ",l," ")}}function odt(a,r){if(a&1){let l=we();T(0,"div",10),B(1),T(2,"button",11),ct("click",function(){let d=Kt(l).$implicit,m=gt();return Qt(m.removeFilter("artist",d))}),dt(3,"i",12),k()()}if(a&2){let l=r.$implicit;z(),ie(" ",l," ")}}function sdt(a,r){if(a&1){let l=we();T(0,"div",10),B(1),T(2,"button",11),ct("click",function(){let d=Kt(l).$implicit,m=gt();return Qt(m.removeFilter("genre",d))}),dt(3,"i",12),k()()}if(a&2){let l=r.$implicit;z(),ie(" ",l," ")}}function adt(a,r){if(a&1){let l=we();T(0,"div")(1,"div",10),B(2),T(3,"button",11),ct("click",function(){Kt(l);let s=gt();return Qt(s.removeFilter("date",""))}),dt(4,"i",12),k()()()}if(a&2){let l=gt();z(2),po(" ",l.filter.startDate," - ",l.filter.endDate," ")}}function ldt(a,r){a&1&&(T(0,"div")(1,"h2"),B(2,"Nu a fost gasit niciun eveniment"),k()())}var cdt=a=>["/event",a],ddt=a=>({id:a});function udt(a,r){if(a&1&&(T(0,"div",15)(1,"div",16),dt(2,"img",17),k(),T(3,"div",18)(4,"h5",19),B(5),k(),T(6,"p",20),B(7),k(),T(8,"p",21),B(9),k()()()),a&2){let l=r.$implicit;W("routerLink",xi(8,cdt,l.title))("queryParams",xi(10,ddt,l.id)),z(2),Js("src",l.imageUrl,Vr),Qh("alt","",l.tile," image"),z(3),Te(l.title),z(2),po("",l.date," | ",l.location.name,""),z(2),ie("",l.shortDescription.substring(0,600)," ...")}}function hdt(a,r){if(a&1&&(T(0,"div",13),ut(1,udt,10,12,"div",14),k()),a&2){let l=gt();z(),W("ngForOf",l.events)}}var sj=(()=>{let r=class r{constructor(n,s,d,m,_){this.route=n,this.router=s,this.eventService=d,this.loadingService=m,this.dialog=_,this.events=[],this.page=0,this.size=10,this.loading=!1,this.reachedEnd=!1}ngOnInit(){this.loadingSubscription=this.loadingService.loading$.subscribe(n=>{setTimeout(()=>{this.loading=n},0)}),this.router.events.subscribe(n=>{n instanceof Mc&&(this.reachedEnd=!1,this.page=0)}),this.route.queryParams.subscribe(n=>Tt(this,null,function*(){this.locationNameList=n.location,this.artistNameList=n.artist,this.genreNameList=n.genre,this.startDate=n.startDate,this.endDate=n.endDate,this.filter={location:this.locationNameList?.split(","),artist:this.artistNameList?.split(","),genre:this.genreNameList?.split(","),startDate:this.startDate,endDate:this.endDate},yield this.eventService.fetchEventList(this.locationNameList,this.artistNameList,this.genreNameList,this.startDate,this.endDate,this.page,this.size),this.eventListSubscription=this.eventService.getEventList().subscribe(s=>{this.events=s.content,this.page++,this.events?.length<this.size&&(this.reachedEnd=!0)})}))}ngOnDestroy(){this.loadingSubscription?.unsubscribe(),this.eventListSubscription?.unsubscribe()}onWindowScroll(){return Tt(this,null,function*(){let s=window.innerHeight,d=document.documentElement.scrollHeight,m=window.scrollY;!this.reachedEnd&&!this.loading&&m+s>=d-20&&(yield this.loadMoreEvents())})}loadMoreEvents(){return Tt(this,null,function*(){(yield this.eventService.fetchEventList(this.locationNameList,this.artistNameList,this.genreNameList,this.startDate,this.endDate,this.page,this.size))<this.size&&(this.reachedEnd=!0),this.page++})}openFilterMenu(){this.dialog.open(oj,{width:"60%",height:"70%",data:{location:this.locationNameList,artist:this.artistNameList,genre:this.genreNameList,startDate:this.startDate,endDate:this.endDate}}).afterClosed().subscribe(s=>{if(s===void 0)return;let d={location:s.selectedLocations.join(",")||null,artist:s.selectedArtists.join(",")||null,genre:s.selectedGenres.join(",")||null,startDate:s.selectedStartDate||null,endDate:s.selectedEndDate||null};this.router.navigate(["/events"],{queryParams:d})})}removeFilter(n,s){let d={location:n==="location"?this.locationNameList?.split(",").filter(m=>m!==s).join(",")||null:this.locationNameList,artist:n==="artist"?this.artistNameList?.split(",").filter(m=>m!==s).join(",")||null:this.artistNameList,genre:n==="genre"?this.genreNameList?.split(",").filter(m=>m!==s).join(",")||null:this.genreNameList,startDate:n==="date"?null:this.startDate,endDate:n==="date"?null:this.endDate};this.router.navigate(["/events"],{queryParams:d})}};r.\u0275fac=function(s){return new(s||r)(V(Tn),V(zi),V(Gy),V(rp),V(Kr))},r.\u0275cmp=St({type:r,selectors:[["app-event-list"]],hostBindings:function(s,d){s&1&&ct("scroll",function(_){return d.onWindowScroll(_)},!1,yv)},standalone:!0,features:[At],decls:17,vars:6,consts:[[1,"container-fluid"],[1,"title-and-filter","d-flex"],[1,"flex-grow-1"],[1,"btn","btn-light",3,"click"],[1,"fas","fa-filter"],[1,"filter-options","justify-content-end"],["class","option bg-primary",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"row"],["class","col-12",4,"ngIf"],[1,"option","bg-primary"],[1,"btn","btn-light","btn-sm","remove-filter-btn",3,"click"],[1,"fas","fa-times"],[1,"col-12"],["role","button","class","card event-card rounded mb-3 mt-3",3,"routerLink","queryParams",4,"ngFor","ngForOf"],["role","button",1,"card","event-card","rounded","mb-3","mt-3",3,"routerLink","queryParams"],[1,"d-flex","justify-content-center","align-items-center"],[1,"img-fluid","event-image",3,"src","alt"],[1,"card-body"],[1,"card-title"],[1,"card-text","card-date"],[1,"card-text"]],template:function(s,d){s&1&&(T(0,"div",0)(1,"div",1)(2,"h1",2),B(3," Evenimente "),k(),T(4,"button",3),ct("click",function(){return d.openFilterMenu()}),dt(5,"i",4),k()(),T(6,"div",5)(7,"div"),ut(8,rdt,4,1,"div",6),k(),T(9,"div"),ut(10,odt,4,1,"div",6),k(),T(11,"div"),ut(12,sdt,4,1,"div",6),k(),ut(13,adt,5,2,"div",7),k(),T(14,"div",8),ut(15,ldt,3,0,"div",7)(16,hdt,2,1,"div",9),k()()),s&2&&(z(8),W("ngForOf",d.filter.location),z(2),W("ngForOf",d.filter.artist),z(2),W("ngForOf",d.filter.genre),z(),W("ngIf",d.filter.startDate&&d.filter.endDate),z(2),W("ngIf",d.events.length==0),z(),W("ngIf",d.events.length>0))},dependencies:[pi,kn,Ve],styles:[".container-fluid[_ngcontent-%COMP%]{width:90%}.event-card[_ngcontent-%COMP%]{display:flex;flex-direction:row;width:calc(100% - 20px);max-width:100%}.event-card[_ngcontent-%COMP%]:hover{box-shadow:0 0 10px #0003;opacity:.8}.event-image[_ngcontent-%COMP%]{max-height:300px;max-width:200px;height:auto;width:auto}.card-body[_ngcontent-%COMP%]{overflow:hidden}.location-image[_ngcontent-%COMP%]{width:100%}.card-text[_ngcontent-%COMP%]{font-size:16px}@media (max-width: 768px){.card-title[_ngcontent-%COMP%], .card-text[_ngcontent-%COMP%]{font-size:13px}}@media (max-width: 576px){.event-card[_ngcontent-%COMP%]{flex-direction:column;padding-top:10px}.card-title[_ngcontent-%COMP%], .card-text[_ngcontent-%COMP%]{font-size:12px}.image-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.card-title[_ngcontent-%COMP%], .card-date[_ngcontent-%COMP%]{text-align:end}}.filter-options[_ngcontent-%COMP%]{padding:10px;display:flex;flex-wrap:wrap;gap:10px}.option[_ngcontent-%COMP%]{padding:10px;color:#fff;border-radius:5px;cursor:pointer}.remove-filter-btn[_ngcontent-%COMP%]{padding:5px;border-radius:5px;cursor:pointer}"]});let a=r;return a})();var aj=(()=>{let r=class r{constructor(n){this.http=n}getGenres(){return this.http.get(be+"/broad-genres")}};r.\u0275fac=function(s){return new(s||r)(ht(Hi))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var pdt=a=>({genre:a});function fdt(a,r){if(a&1&&(T(0,"div")(1,"div",4)(2,"div",5)(3,"h5",6),B(4),k()()()()),a&2){let l=r.$implicit;z(),W("routerLink","/events")("queryParams",xi(3,pdt,l.name)),z(3),Te(l.name)}}var lj=(()=>{let r=class r{constructor(n){this.genreService=n,this.genres=[]}ngOnInit(){this.genreService.getGenres().subscribe({next:n=>{this.genres=n}})}};r.\u0275fac=function(s){return new(s||r)(V(aj))},r.\u0275cmp=St({type:r,selectors:[["app-genre-list"]],standalone:!0,features:[At],decls:6,vars:1,consts:[[1,"container-fluid"],[1,"row"],[1,"col-md-12","genre-container"],[4,"ngFor","ngForOf"],[1,"card",3,"routerLink","queryParams"],[1,"card-body"],[1,"card-title","text-center"]],template:function(s,d){s&1&&(T(0,"div",0)(1,"h1"),B(2,"Genuri"),k(),T(3,"div",1)(4,"div",2),ut(5,fdt,5,5,"div",3),k()()()),s&2&&(z(5),W("ngForOf",d.genres))},dependencies:[pi,kn],styles:[".genre-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:center;margin-top:20px}.card[_ngcontent-%COMP%]{width:200px;margin:10px;cursor:pointer}"]});let a=r;return a})();var cj=[{path:"home",redirectTo:"",pathMatch:"full"},{path:"login",canActivate:[qu],component:AN},{path:"register",canActivate:[qu],component:kN},{path:"forgot-password",canActivate:[qu],component:RN},{path:"reset-password/:token",canActivate:[qu],component:cV},{path:"account",canActivate:[Gg],component:ON,children:[{path:"",pathMatch:"full",component:pV},{path:"orders",component:oV},{path:"orders/:orderNumber",component:hV},{path:"settings",component:Ix}]},{path:"admin-dashboard",canActivate:[LN],component:FN,children:[{path:"",pathMatch:"full",component:qN},{path:"home",redirectTo:""},{path:"manage/users",component:g5},{path:"manage/locations",component:_5},{path:"manage/events",component:K5},{path:"manage/artists",component:GV},{path:"manage/orders",component:J5},{path:"statistics",component:J4},{path:"settings",component:Ix}]},{path:"validator-dashboard",canActivate:[wV],component:bV,children:[{path:"",pathMatch:"full",component:xV},{path:"scanner",component:OV},{path:"settings",component:Ix}]},{path:"",canActivate:[zN],component:Zz,children:[{path:"",pathMatch:"full",component:iN},{path:"track",canActivate:[Gg],component:_V},{path:"page-not-found",component:tV},{path:"event-details/:event",canActivate:[Gg],component:yV},{path:"shopping-cart",canActivate:[Gg],component:PN},{path:"verify-account/:token",canActivate:[qu],component:FV},{path:"resend-verify-account-email/:email",canActivate:[qu],component:LV},{path:"events",component:sj},{path:"genres",component:lj},{path:"artists",redirectTo:"artists/A",pathMatch:"full"},{path:"artists/:letter",component:NV},{path:"artist/:artist",component:BV},{path:"location/:location",pathMatch:"full",component:nN},{path:"event/:event",pathMatch:"full",component:DN}]}];var gdt=(()=>{let r=class r extends Rv{constructor(n,s,d){super(n,s,d,le(bv,{optional:!0}))}ngOnDestroy(){this.flush()}};r.\u0275fac=function(s){return new(s||r)(ht(ci),ht(Sf),ht(kv))},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})();function _dt(){return new dL}function vdt(a,r,l){return new hL(a,r,l)}var dj=[{provide:kv,useFactory:_dt},{provide:Rv,useClass:gdt},{provide:Yh,useFactory:vdt,deps:[nm,Rv,Be]}],ydt=[{provide:Sf,useFactory:()=>new uL},{provide:Eo,useValue:"BrowserAnimations"},...dj],iRt=[{provide:Sf,useClass:cL},{provide:Eo,useValue:"NoopAnimations"},...dj];function uj(){return[...ydt]}var bdt="@",xdt=(()=>{let r=class r{constructor(n,s,d,m,_){this.doc=n,this.delegate=s,this.zone=d,this.animationType=m,this.moduleImpl=_,this._rendererFactoryPromise=null,this.scheduler=le(bv,{optional:!0})}ngOnDestroy(){this._engine?.flush()}loadImpl(){return(this.moduleImpl??import("./chunk-P4N77L77.js")).catch(s=>{throw new dr(5300,!1)}).then(({\u0275createEngine:s,\u0275AnimationRendererFactory:d})=>{this._engine=s(this.animationType,this.doc,this.scheduler);let m=new d(this.delegate,this._engine,this.zone);return this.delegate=m,m})}createRenderer(n,s){let d=this.delegate.createRenderer(n,s);if(d.\u0275type===0)return d;typeof d.throwOnSyntheticProps=="boolean"&&(d.throwOnSyntheticProps=!1);let m=new MT(d);return s?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(_=>{let w=_.createRenderer(n,s);m.use(w)}).catch(_=>{m.use(d)}),m}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}};r.\u0275fac=function(s){xu()},r.\u0275prov=kt({token:r,factory:r.\u0275fac});let a=r;return a})(),MT=class{constructor(r){this.delegate=r,this.replay=[],this.\u0275type=1}use(r){if(this.delegate=r,this.replay!==null){for(let l of this.replay)l(r);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(r,l){return this.delegate.createElement(r,l)}createComment(r){return this.delegate.createComment(r)}createText(r){return this.delegate.createText(r)}get destroyNode(){return this.delegate.destroyNode}appendChild(r,l){this.delegate.appendChild(r,l)}insertBefore(r,l,n,s){this.delegate.insertBefore(r,l,n,s)}removeChild(r,l,n){this.delegate.removeChild(r,l,n)}selectRootElement(r,l){return this.delegate.selectRootElement(r,l)}parentNode(r){return this.delegate.parentNode(r)}nextSibling(r){return this.delegate.nextSibling(r)}setAttribute(r,l,n,s){this.delegate.setAttribute(r,l,n,s)}removeAttribute(r,l,n){this.delegate.removeAttribute(r,l,n)}addClass(r,l){this.delegate.addClass(r,l)}removeClass(r,l){this.delegate.removeClass(r,l)}setStyle(r,l,n,s){this.delegate.setStyle(r,l,n,s)}removeStyle(r,l,n){this.delegate.removeStyle(r,l,n)}setProperty(r,l,n){this.shouldReplay(l)&&this.replay.push(s=>s.setProperty(r,l,n)),this.delegate.setProperty(r,l,n)}setValue(r,l){this.delegate.setValue(r,l)}listen(r,l,n){return this.shouldReplay(l)&&this.replay.push(s=>s.listen(r,l,n)),this.delegate.listen(r,l,n)}shouldReplay(r){return this.replay!==null&&r.startsWith(bdt)}};function hj(a="animations"){return yu([{provide:Yh,useFactory:(r,l,n)=>new xdt(r,l,n,a),deps:[ci,nm,Be]},{provide:Eo,useValue:a==="noop"?"NoopAnimations":"BrowserAnimations"}])}var mj=(()=>{let r=class r{constructor(n){this.loadingService=n}intercept(n,s){return this.loadingService.show(),s.handle(n).pipe(ro(d=>d instanceof im?Fe(d).pipe(ff(100)):Fe(d)),OF(d=>d.pipe(ks((m,_)=>_<3&&this.isConnectionError(m)?kF(1e3):Ll(m)))),zl(d=>Ll(d)),rl(()=>{this.loadingService.hide()}))}isConnectionError(n){return n.status==="(failed)net::ERR_CONNECTION_REFUSED"||n.status===0}};r.\u0275fac=function(s){return new(s||r)(ht(rp))},r.\u0275prov=kt({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var be="https://server-backend-xmyv.onrender.com/api",kx="pk.eyJ1IjoibWF0ZHVtIiwiYSI6ImNsc29uNHdldTBoZ2cycmx6dGU1em0xNngifQ.CNxZncBUud9hmoevWrxSyg",pj={providers:[p3(cj),uj(),CL(SL()),hj(),{provide:BS,useClass:mj,multi:!0},Py()]};function wdt(a,r){a&1&&dt(0,"app-loading")}function Cdt(a,r){if(a&1){let l=we();T(0,"button",2),ct("click",function(){Kt(l);let s=gt();return Qt(s.scrollToTop())}),dt(1,"i",3),k()}}var fj=(()=>{let r=class r{constructor(n){this.loadingService=n,this.title="Bileteria",this.showScrollButton=!1}ngOnInit(){this.loadingService.loading$.subscribe(n=>{setTimeout(()=>{this.loading=n},0)})}onWindowScroll(n){this.showScrollButton=window.scrollY>600}scrollToTop(){window.scrollTo({top:0,behavior:"smooth"})}};r.\u0275fac=function(s){return new(s||r)(V(rp))},r.\u0275cmp=St({type:r,selectors:[["app-root"]],hostBindings:function(s,d){s&1&&ct("scroll",function(_){return d.onWindowScroll(_)},!1,yv)},standalone:!0,features:[At],decls:3,vars:2,consts:[[4,"ngIf"],["class","btn scroll-top-button",3,"click",4,"ngIf"],[1,"btn","scroll-top-button",3,"click"],[1,"fa","fa-arrow-up"]],template:function(s,d){s&1&&(ut(0,wdt,1,0,"app-loading",0),dt(1,"router-outlet"),ut(2,Cdt,2,0,"button",1)),s&2&&(W("ngIf",d.loading),z(2),W("ngIf",d.showScrollButton))},dependencies:[zo,Ve,cl,iy],styles:["[_nghost-%COMP%]{position:relative;width:100%;height:100%}.scroll-top-button[_ngcontent-%COMP%]{position:fixed;bottom:40px;right:20px}"]});let a=r;return a})();kL(fj,pj).catch(a=>console.error(a));
